000100*-----------------------*                                         05/02/95
000200 IDENTIFICATION DIVISION.                                         DPKCS036
000300*-----------------------*                                            LV002
000400 PROGRAM-ID.    TRKCS162.                                         DPKCS036
000500 AUTHOR.        NIRMAL KUMAR.                                     DPKCS036
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
000700 DATE-WRITTEN.  05/98.                                            DPKCS036
000800 DATE-COMPILED.                                                   DPKCS036
000900                                                                  DPKCS036
001000*---------------------------------------------------------------* DPKCS036
001100*    Y162 - CONTAINER LIST.                                     * DPKCS036
001200*                                                               * DPKCS036
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE CONTAINERS IN     * DPKCS036
001400*    WHICH THE PURCHASE ORDER IS ON. THE APPROPRIATE PROGRAM    * DPKCS036
001500*    IS INVOKED WHEN THE OPERATOR SELECTS AN ITEM AND PRESSES   * DPKCS036
001600*    A FUNCTION KEY.                                            * DPKCS036
001700*                                                               * DPKCS036
001800*---------------------------------------------------------------* DPKCS036
001810*****************************************************************         
001820* DATE  05/16/2011                                                        
001830*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL          
001840*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR                 
001850*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC           
001860*  AND TSKXREF.                                                           
001870*  MADE BY: GERMAN BANDA                                                  
001880*****************************************************************         
263697*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  DPKCS036
002000 ENVIRONMENT DIVISION.                                            DPKCS036
002100                                                                  DPKCS036
002200 DATA DIVISION.                                                   DPKCS036
002300                                                                  DPKCS036
002400 WORKING-STORAGE SECTION.                                         DPKCS036
002500                                                                  DPKCS036
002600 01  DK-DB2-KEYS.                                                 DPKCS036
002700     15  DK-PO-NBR                      PIC S9(09)  COMP.         DPKCS036
002800     15  DK-VSL-NAME                    PIC  X(20).               DPKCS036
002900     15  DK-VOY-NO                      PIC  X(10).               DPKCS036
003000                                                                  DPKCS036
003100 01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
003200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
003300                                                    'TR162A  '.   DPKCS036
003400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
003500                                                    'TRKM162 '.   DPKCS036
003600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
003700                                                    'TRKCS162'.   DPKCS036
003800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
003900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
004000     05  PC-PO-CRIT-SUMM-FORMAT         PIC  X(01)  VALUE '2'.    DPKCS036
004100     05  PC-PO-SAILING-FORMAT           PIC  X(01)  VALUE '3'.    DPKCS036
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +9      DPKCS036
004300                                                    COMP SYNC.    DPKCS036
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
004500                                                    COMP SYNC.    DPKCS036
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
004700                                                    +1000000      DPKCS036
004800                                                    COMP-3.       DPKCS036
004900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
005000                                                    COMP SYNC.    DPKCS036
005100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
005200                                                    COMP-3.       DPKCS036
005300     05  PC-INIT-DATE                   PIC  X(10)  VALUE         DPKCS036
005400                                                    '0001-01-01'. DPKCS036
005500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
005600                                                                  DPKCS036
005700     05  PC-TSYMSG-NUMBERS.                                       DPKCS036
005800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
005900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
006000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  DPKCS036
006100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
006200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
006300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
006400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
006500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
006600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
006700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
006800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
006900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
007000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
007100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
007200                                                                  DPKCS036
007300 01  PS-PROGRAM-SWITCHES.                                         DPKCS036
007400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
007500         88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
007600         88  PS-ERROR                               VALUE 'N'.    DPKCS036
007700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
007800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
007900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
008000                                                                  DPKCS036
008100 01  PV-PROGRAM-VARIABLES.                                        DPKCS036
008200     05  PV-DEPT-NBR                    PIC  X(04).                       
008300     05  PV-DEPT-NBR-N REDEFINES                                          
008301         PV-DEPT-NBR                    PIC S9(04).                       
008302     05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
008303                                                    COMP SYNC.    DPKCS036
008400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
008500                                                    COMP SYNC.    DPKCS036
008600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
008700                                                    COMP-3.       DPKCS036
008800     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      DPKCS036
008900                                                    COMP-3.       DPKCS036
009000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
009100                                                    COMP-3.       DPKCS036
009200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
009300                                                    COMP-3.       DPKCS036
009400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
009500                                                    COMP-3.       DPKCS036
009600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
009700                                                    COMP-3.       DPKCS036
009800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
009900                                                    COMP-3.       DPKCS036
010000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
010100                                                    COMP-3.       DPKCS036
010200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
010300                                                    COMP SYNC.    DPKCS036
010400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
010500                                                    COMP SYNC.    DPKCS036
010600     05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
010700                                                    COMP SYNC.    DPKCS036
010800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
010900                                                    COMP SYNC.    DPKCS036
011000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
011100                                                    COMP SYNC.    DPKCS036
011200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
011300                                                    COMP SYNC.    DPKCS036
011400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
011500                                                    COMP SYNC.    DPKCS036
011600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
011700                                                    COMP SYNC.    DPKCS036
011800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011900                                                    COMP SYNC.    DPKCS036
012000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
012100                                                    COMP SYNC.    DPKCS036
012200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
012300                                                    COMP SYNC.    DPKCS036
012400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
012500                                                    COMP SYNC.    DPKCS036
012600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
012700                                                    COMP SYNC.    DPKCS036
012800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
012900                                                    COMP SYNC.    DPKCS036
013000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
013100                                                    COMP SYNC.    DPKCS036
013200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
013300                                                    COMP SYNC.    DPKCS036
013400     05  PV-CONTNR-NBR                  PIC  X(12)  VALUE SPACE.  DPKCS036
013500     05  PV-CONTNR-SEQ-NBR              PIC S9(04)  COMP.         DPKCS036
013600     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      DPKCS036
013700                                                    COMP.         DPKCS036
013800     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      DPKCS036
013900                                                    COMP.         DPKCS036
014000     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      DPKCS036
014100                                                    COMP.         DPKCS036
014200     05  PV-SHPMT-TYPE.                                           DPKCS036
014300         10 PV-SHPMT-FROM-CDE           PIC  X(03).               DPKCS036
014400         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
014500         10 PV-SHPMT-TO-CDE             PIC  X(03).               DPKCS036
014600                                                                  DPKCS036
014700     05  PV-DATE-BREAK.                                           DPKCS036
014800         10 FILLER                      PIC  X(02).               DPKCS036
014900         10 PV-DB-YY                    PIC  X(02).               DPKCS036
015000         10 FILLER                      PIC  X(01).               DPKCS036
015100         10 PV-DB-MM                    PIC  X(02).               DPKCS036
015200         10 FILLER                      PIC  X(01).               DPKCS036
015300         10 PV-DB-DD                    PIC  X(02).               DPKCS036
015400                                                                  DPKCS036
015500     05 PV-DATE-DISPLAY.                                          DPKCS036
015600         10 PV-DD-MM                    PIC  X(02).               DPKCS036
015700         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
015800         10 PV-DD-DD                    PIC  X(02).               DPKCS036
015900         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
016000         10 PV-DD-YY                    PIC  X(02).               DPKCS036
016100                                                                  DPKCS036
016200*----------------------------------------------------------------*DPKCS036
016300*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *DPKCS036
016400*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *DPKCS036
016500*   APPLICATION-SPECIFIC COMMAREA.                               *DPKCS036
016600*----------------------------------------------------------------*DPKCS036
016700 01  LQW-LIST-QUEUE-WORK-AREA.                                    DPKCS036
016800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  DPKCS036
016900     05  LQW-ITEM-ENTRIES               OCCURS 9    TIMES         DPKCS036
017000                                        INDEXED BY  LQW-IDX.      DPKCS036
017100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       DPKCS036
017200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
017300         10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
017400             88  LQW-SELECT                         VALUE 'S'.    DPKCS036
017500             88  LQW-DESELECT                       VALUE ' '.    DPKCS036
017600         10  LQW-ACTION                 PIC  X(03).               DPKCS036
017700         10  LQW-CONTNR-NBR             PIC  X(12).               DPKCS036
017800         10  LQW-CTN                    PIC S9(04)  COMP.         DPKCS036
017900         10  LQW-UNTS                   PIC S9(09)  COMP.         DPKCS036
018000         10  LQW-CBM                    PIC S9(04)V9(2) COMP-3.   DPKCS036
018100         10  LQW-SHPMT-TYPE             PIC  X(07).               DPKCS036
018200         10  LQW-FOB                    PIC  X(03).               DPKCS036
018300         10  LQW-POE                    PIC  X(03).               DPKCS036
018400         10  LQW-VSL-NM                 PIC  X(09).               DPKCS036
018500         10  LQW-VOY-NO                 PIC  X(06).               DPKCS036
018600         10  LQW-PO-CNT                 PIC  9(03).               DPKCS036
018700         10  LQW-CONTNR-SEQ-NBR         PIC S9(04)  COMP.         DPKCS036
018800                                                                  DPKCS036
018900 EJECT                                                            DPKCS036
019000*---------------------------------------------------------------* DPKCS036
019100*  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * DPKCS036
019200*---------------------------------------------------------------* DPKCS036
019300                                                                  DPKCS036
019400     COPY TRWS101.                                                DPKCS036
019500                                                                  DPKCS036
019600 EJECT                                                            DPKCS036
019700*---------------------------------------------------------------* DPKCS036
019800*    MAP LAYOUT                                                 * DPKCS036
019900*---------------------------------------------------------------* DPKCS036
020000                                                                  DPKCS036
020100     COPY TRKM162.                                                DPKCS036
020200                                                                  DPKCS036
020300 01  MR-OCCURS-LAYOUT                   REDEFINES  TR162AO.       DPKCS036
020400     05  FILLER                         PIC X(260).               DPKCS036
020500                                                                  DPKCS036
020600     05  MR-SCROLL-AREA                 OCCURS 9  TIMES.          DPKCS036
020700         10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
020800         10  MR-SELECTA                 PIC  X(01).               DPKCS036
020900         10  MR-SELECTC                 PIC  X(01).               DPKCS036
021000         10  MR-SELECTH                 PIC  X(01).               DPKCS036
021100         10  MR-SELECTI                 PIC  X(01).               DPKCS036
021200                                                                  DPKCS036
021300         10  MR-ACTIONL                 PIC S9(04) COMP.          DPKCS036
021400         10  MR-ACTIONA                 PIC  X(01).               DPKCS036
021500         10  MR-ACTIONC                 PIC  X(01).               DPKCS036
021600         10  MR-ACTIONH                 PIC  X(01).               DPKCS036
021700         10  MR-ACTION                  PIC  X(03).               DPKCS036
021800                                                                  DPKCS036
021900         10  MR-CONTNR-NBRL             PIC S9(04) COMP.          DPKCS036
022000         10  MR-CONTNR-NBRA             PIC  X(01).               DPKCS036
022100         10  MR-CONTNR-NBRC             PIC  X(01).               DPKCS036
022200         10  MR-CONTNR-NBRH             PIC  X(01).               DPKCS036
022300         10  MR-CONTNR-NBR              PIC  X(12).               DPKCS036
022400                                                                  DPKCS036
022500         10  MR-CTNL                    PIC S9(04) COMP.          DPKCS036
022600         10  MR-CTNA                    PIC  X(01).               DPKCS036
022700         10  MR-CTNC                    PIC  X(01).               DPKCS036
022800         10  MR-CTNH                    PIC  X(01).               DPKCS036
022900         10  MR-CTN                     PIC  ZZZZ9.               DPKCS036
023000         10  MR-CTN-X REDEFINES MR-CTN  PIC  X(05).               DPKCS036
023100                                                                  DPKCS036
023200         10  MR-UNTSL                   PIC S9(04) COMP.          DPKCS036
023300         10  MR-UNTSA                   PIC  X(01).               DPKCS036
023400         10  MR-UNTSC                   PIC  X(01).               DPKCS036
023500         10  MR-UNTSH                   PIC  X(01).               DPKCS036
023600         10  MR-UNTS                    PIC  ZZZZZZZ9.            DPKCS036
023700         10  MR-UNTS-X REDEFINES MR-UNTS                          DPKCS036
023800                                        PIC  X(08).               DPKCS036
023900                                                                  DPKCS036
024000         10  MR-CBML                    PIC S9(04) COMP.          DPKCS036
024100         10  MR-CBMA                    PIC  X(01).               DPKCS036
024200         10  MR-CBMC                    PIC  X(01).               DPKCS036
024300         10  MR-CBMH                    PIC  X(01).               DPKCS036
024400         10  MR-CBM                     PIC  ZZZ9.99.             DPKCS036
024500         10  MR-CBM-X REDEFINES MR-CBM  PIC  X(07).               DPKCS036
024600                                                                  DPKCS036
024700         10  MR-FOBL                    PIC S9(04) COMP.          DPKCS036
024800         10  MR-FOBA                    PIC  X(01).               DPKCS036
024900         10  MR-FOBC                    PIC  X(01).               DPKCS036
025000         10  MR-FOBH                    PIC  X(01).               DPKCS036
025100         10  MR-FOB                     PIC  X(03).               DPKCS036
025200                                                                  DPKCS036
025300         10  MR-POEL                    PIC S9(04) COMP.          DPKCS036
025400         10  MR-POEA                    PIC  X(01).               DPKCS036
025500         10  MR-POEC                    PIC  X(01).               DPKCS036
025600         10  MR-POEH                    PIC  X(01).               DPKCS036
025700         10  MR-POE                     PIC  X(03).               DPKCS036
025800                                                                  DPKCS036
025900         10  MR-VSL-NML                 PIC S9(04) COMP.          DPKCS036
026000         10  MR-VSL-NMA                 PIC  X(01).               DPKCS036
026100         10  MR-VSL-NMC                 PIC  X(01).               DPKCS036
026200         10  MR-VSL-NMH                 PIC  X(01).               DPKCS036
026300         10  MR-VSL-NM                  PIC  X(09).               DPKCS036
026400                                                                  DPKCS036
026500         10  MR-VOY-NOL                 PIC S9(04) COMP.          DPKCS036
026600         10  MR-VOY-NOA                 PIC  X(01).               DPKCS036
026700         10  MR-VOY-NOC                 PIC  X(01).               DPKCS036
026800         10  MR-VOY-NOH                 PIC  X(01).               DPKCS036
026900         10  MR-VOY-NO                  PIC  X(06).               DPKCS036
027000                                                                  DPKCS036
027100         10  MR-TYPEL                   PIC S9(04) COMP.          DPKCS036
027200         10  MR-TYPEA                   PIC  X(01).               DPKCS036
027300         10  MR-TYPEC                   PIC  X(01).               DPKCS036
027400         10  MR-TYPEH                   PIC  X(01).               DPKCS036
027500         10  MR-TYPE                    PIC  X(07).               DPKCS036
027600                                                                  DPKCS036
027700         10  MR-PO-CNTL                 PIC S9(04) COMP.          DPKCS036
027800         10  MR-PO-CNTA                 PIC  X(01).               DPKCS036
027900         10  MR-PO-CNTC                 PIC  X(01).               DPKCS036
028000         10  MR-PO-CNTH                 PIC  X(01).               DPKCS036
028100         10  MR-PO-CNT                  PIC  ZZ9.                 DPKCS036
028200         10  MR-PO-CNT-X REDEFINES MR-PO-CNT                      DPKCS036
028300                                        PIC  X(03).               DPKCS036
028400                                                                  DPKCS036
028500     05  FILLER                         PIC  X(12).               DPKCS036
028600                                                                  DPKCS036
028700 EJECT                                                            DPKCS036
028800*---------------------------------------------------------------* DPKCS036
028900*    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
029000*---------------------------------------------------------------* DPKCS036
029100                                                                  DPKCS036
029200     COPY DPWS015.                                                DPKCS036
029300                                                                  DPKCS036
029400 EJECT                                                            DPKCS036
029500*---------------------------------------------------------------* DPKCS036
029600*    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
029700*---------------------------------------------------------------* DPKCS036
029800                                                                  DPKCS036
029900     COPY DPWS016.                                                DPKCS036
030000                                                                  DPKCS036
030100 EJECT                                                            DPKCS036
030200*---------------------------------------------------------------* DPKCS036
030300*    NUMERIC EDIT LAYOUT.                                       * DPKCS036
030400*---------------------------------------------------------------* DPKCS036
030500                                                                  DPKCS036
030600     COPY DPWS010I.                                               DPKCS036
030700                                                                  DPKCS036
030800 EJECT                                                            DPKCS036
030900*---------------------------------------------------------------* DPKCS036
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
031100*---------------------------------------------------------------* DPKCS036
031200                                                                  DPKCS036
031300     COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
031500 EJECT                                                            DPKCS036
031600*---------------------------------------------------------------* DPKCS036
031700*    STANDARD COMMAREA.                                         * DPKCS036
031800*---------------------------------------------------------------* DPKCS036
031900                                                                  DPKCS036
032000     COPY DPWS020.                                                DPKCS036
032100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
032200                                                                  DPKCS036
032300*---------------------------------------------------------------* DPKCS036
032400* INTER-APPLICATION COMMAREA.                                   * DPKCS036
032500*   TRWS105 - ARE THE INPUT LAYOUTS FOR THIS PROGRAM            * DPKCS036
032600*   TRWS107   FROM PO CRIT SPEC, SUMMARY OR SAILING LIST PGMS.  * DPKCS036
032700*   TRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * DPKCS036
032800*             THIS PROGRAM TO CONTAINER SUMMARY AND MANIFEST    * DPKCS036
032900*             PROGRAMS                                          * DPKCS036
033000*---------------------------------------------------------------* DPKCS036
033100                                                                  DPKCS036
033200         10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
033300     COPY TRWS102.                                                DPKCS036
033400     COPY TRWS105.                                                DPKCS036
033500     COPY TRWS107.                                                DPKCS036
033600                                                                  DPKCS036
033700*---------------------------------------------------------------* DPKCS036
033800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
033900*---------------------------------------------------------------* DPKCS036
034000         10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
034100             15  ASC-LIST-KEYS.                                   DPKCS036
034200                 20  ASC-KEY-PO-NBR                  PIC S9(09)   DPKCS036
034300                                                          COMP.   DPKCS036
034400                 20  ASC-KEY-VSL-NAME                PIC  X(20).  DPKCS036
034500                 20  ASC-KEY-VOY-NO                  PIC  X(10).  DPKCS036
034600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
034700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
034800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
034900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
035000                                                                  DPKCS036
035100                 20  ASC-ITEM-ARRAY.                              DPKCS036
035200                     25  ASC-ITEM-ENTRIES OCCURS  9 TIMES.        DPKCS036
035300                         30  ASC-LIST-ITEM-NUMBER                 DPKCS036
035400                                                     PIC S9(09)   DPKCS036
035500                                                     COMP-3.      DPKCS036
035600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
035700                             88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
035800                                                           'S'    DPKCS036
035900                                                           'B'    DPKCS036
036000                                                           'E'.   DPKCS036
036100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
036200                             88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
036300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
036400                             88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
036500                         30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
036600                             88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
036700                             88  ASC-SELECT          VALUE 'S'.   DPKCS036
036800                             88  ASC-BEGIN           VALUE 'B'.   DPKCS036
036900                             88  ASC-END             VALUE 'E'.   DPKCS036
037000                         30  ASC-ACTION              PIC  X(03).  DPKCS036
037100                         30  ASC-CONTNR-NBR          PIC  X(12).  DPKCS036
037200                         30  ASC-CTN                 PIC S9(04)   DPKCS036
037300                                                          COMP.   DPKCS036
037400                         30  ASC-UNTS                PIC S9(09)   DPKCS036
037500                                                          COMP.   DPKCS036
037600                         30  ASC-CBM                 PIC S9(04)V99DPKCS036
037700                                                          COMP-3. DPKCS036
037800                         30  ASC-SHPMT-TYPE          PIC  X(07).  DPKCS036
037900                         30  ASC-FOB                 PIC  X(03).  DPKCS036
038000                         30  ASC-POE                 PIC  X(03).  DPKCS036
038100                         30  ASC-VSL-NM              PIC  X(09).  DPKCS036
038200                         30  ASC-VOY-NO              PIC  X(06).  DPKCS036
038300                         30  ASC-PO-CNT              PIC  9(03).  DPKCS036
038400                         30  ASC-CONTNR-SEQ-NBR      PIC S9(04)   DPKCS036
038500                                                          COMP.   DPKCS036
038600                                                                  DPKCS036
038700             15  ASC-BLK-SUB                         PIC S9(04)   DPKCS036
038800                                                          COMP    DPKCS036
038900                                                          SYNC.   DPKCS036
039000             15  ASC-ITEM-SUB                        PIC S9(04)   DPKCS036
039100                                                          COMP    DPKCS036
039200                                                          SYNC.   DPKCS036
039300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   DPKCS036
039400                                                          COMP-3. DPKCS036
039500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   DPKCS036
039600                                                          COMP-3. DPKCS036
039700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   DPKCS036
039800                                                          COMP-3. DPKCS036
039900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   DPKCS036
040000                                                          COMP-3. DPKCS036
040100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   DPKCS036
040200                                                          COMP-3. DPKCS036
040300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   DPKCS036
040400                                                          COMP    DPKCS036
040500                                                          SYNC.   DPKCS036
040600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   DPKCS036
040700                                                          COMP-3. DPKCS036
040800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   DPKCS036
040900                                                          COMP-3. DPKCS036
041000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
041100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   DPKCS036
041200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   DPKCS036
041300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  DPKCS036
041400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
041500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
041600             15  ASC-LIST-QUEUE-NAME.                             DPKCS036
041700                 20  ASC-LIST-TERM-ID                PIC  X(04).  DPKCS036
041800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   DPKCS036
041900                                                          COMP-3. DPKCS036
042000                 20  ASC-LIST-SEQ                    PIC  9(01).  DPKCS036
042100             15  ASC-SEL-QUEUE-NAME.                              DPKCS036
042200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  DPKCS036
042300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   DPKCS036
042400                                                          COMP-3. DPKCS036
042500                 20  ASC-SEL-SEQ                     PIC  9(01).  DPKCS036
042600             15  ASC-CURSOR-SW                       PIC  X(01).  DPKCS036
042700                 88  ASC-CONTNR-CURSOR               VALUE 'C'.   DPKCS036
042800                 88  ASC-VSL-CONTNR-CURSOR           VALUE 'V'.   DPKCS036
042900             15  ASC-START-ITEM-REQUEST.                          DPKCS036
043000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  DPKCS036
043100                                                                  DPKCS036
043110             15  ASC-TOT-CARTONS                     PIC S9(04)   DPKCS036
043120                                                          COMP.   DPKCS036
043130             15  ASC-TOT-UNITS                       PIC S9(09)   DPKCS036
043140                                                          COMP.   DPKCS036
043150             15  ASC-TOT-CBM                      PIC S9(04)V99   DPKCS036
043160                                                          COMP-3. DPKCS036
043200 EJECT                                                            DPKCS036
043300*---------------------------------------------------------------* DPKCS036
043400*    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
043500*---------------------------------------------------------------* DPKCS036
043600                                                                  DPKCS036
043700     COPY DPWS013.                                                DPKCS036
043800                                                                  DPKCS036
043900 EJECT                                                            DPKCS036
044000*---------------------------------------------------------------* DPKCS036
044100*    DB2 AREA FOR TIMCNTK                                       * DPKCS036
044200*---------------------------------------------------------------* DPKCS036
044300     EXEC SQL                                                     DPKCS036
044400          INCLUDE TIMCNTK                                         DPKCS036
044500     END-EXEC.                                                    DPKCS036
044600*---------------------------------------------------------------* DPKCS036
044700*    DB2 AREA FOR TIMCNPO                                       * DPKCS036
044800*---------------------------------------------------------------* DPKCS036
044900     EXEC SQL                                                     DPKCS036
045000          INCLUDE TIMCNPO                                         DPKCS036
045100     END-EXEC.                                                    DPKCS036
045200*---------------------------------------------------------------* DPKCS036
045300*    DB2 AREA FOR TPURCHS                                       * DPKCS036
045400*---------------------------------------------------------------* DPKCS036
045500     EXEC SQL                                                     DPKCS036
045600          INCLUDE TPURCHS                                         DPKCS036
045700     END-EXEC.                                                    DPKCS036
045800*---------------------------------------------------------------* DPKCS036
045900*    DB2 AREA FOR TPURITM                                       * DPKCS036
046000*---------------------------------------------------------------* DPKCS036
046100     EXEC SQL                                                     DPKCS036
046200          INCLUDE TPURITM                                         DPKCS036
046300     END-EXEC.                                                    DPKCS036
046400*---------------------------------------------------------------* DPKCS036
046500*    DB2 AREA FOR TPLNSHP                                       * DPKCS036
046600*---------------------------------------------------------------* DPKCS036
046700     EXEC SQL                                                     DPKCS036
046800          INCLUDE TPLNSHP                                         DPKCS036
046900     END-EXEC.                                                    DPKCS036
047000*---------------------------------------------------------------* DPKCS036
047100*    DB2 AREA FOR TENTNME                                       * DPKCS036
047200*---------------------------------------------------------------* DPKCS036
047300     EXEC SQL                                                     DPKCS036
047400          INCLUDE TENTNME                                         DPKCS036
047500     END-EXEC.                                                    DPKCS036
047600*---------------------------------------------------------------* DPKCS036
047700*    DB2 AREA FOR TSKXREF                                       * DPKCS036
047800*---------------------------------------------------------------* DPKCS036
047900     EXEC SQL                                                     DPKCS036
048000          INCLUDE TSKXREF                                         DPKCS036
048100     END-EXEC.                                                    DPKCS036
048101*---------------------------------------------------------------* DPKCS036
048102*    DB2 AREA FOR TUPC TABLE                                      DPKCS036
048103*---------------------------------------------------------------* DPKCS036
048104     EXEC SQL                                                     DPKCS036
048105          INCLUDE TUPC                                            DPKCS036
048106     END-EXEC.                                                    DPKCS036
048200*---------------------------------------------------------------* DPKCS036
048300*    DB2 AREA FOR TIMFOB                                        * DPKCS036
048400*---------------------------------------------------------------* DPKCS036
048500     EXEC SQL                                                     DPKCS036
048600          INCLUDE TIMFOB                                          DPKCS036
048700     END-EXEC.                                                    DPKCS036
048800*---------------------------------------------------------------* DPKCS036
048900*    DB2 AREA FOR TIMPOE                                        * DPKCS036
049000*---------------------------------------------------------------* DPKCS036
049100     EXEC SQL                                                     DPKCS036
049200          INCLUDE TIMPOE                                          DPKCS036
049300     END-EXEC.                                                    DPKCS036
049310*---------------------------------------------------------------* DPKCS036
049320*    DB2 AREA FOR XLT_SKU                                       * DPKCS036
049330*---------------------------------------------------------------* DPKCS036
049340     EXEC SQL                                                     DPKCS036
049350          INCLUDE XLT00003                                        DPKCS036
049360     END-EXEC.                                                    DPKCS036
049370*---------------------------------------------------------------* DPKCS036
049380*    DB2 AREA FOR XLT_VND_STYL                                  * DPKCS036
049390*---------------------------------------------------------------* DPKCS036
049391     EXEC SQL                                                     DPKCS036
049392          INCLUDE XLT00004                                        DPKCS036
049393     END-EXEC.                                                    DPKCS036
049400*---------------------------------------------------------------* DPKCS036
049500*    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
049600*---------------------------------------------------------------* DPKCS036
049700     EXEC SQL                                                     DPKCS036
049800          INCLUDE SQLCA                                           DPKCS036
049900     END-EXEC.                                                    DPKCS036
050000*---------------------------------------------------------------* DPKCS036
050100*    CURSOR FOR CONTAINER LIST FOR A REQUESTED PO.              * DPKCS036
050200*---------------------------------------------------------------* DPKCS036
050300                                                                  DPKCS036
050400     EXEC SQL                                                     DPKCS036
050500          DECLARE CONTNR-CSR CURSOR                               DPKCS036
050600          FOR SELECT DISTINCT                                     DPKCS036
050700                A.CONTNR_ID                                       DPKCS036
050800              , A.FDR_FOB_CDE                                     DPKCS036
050900              , A.MOM_FOB_CDE                                     DPKCS036
051000              , A.ORGN_SHPD_FR_CDE                                DPKCS036
051100              , A.ORGN_SHPD_TO_CDE                                DPKCS036
051400              , A.MOM_TRIP_TYP_CDE                                        
051500              , A.FDR_TRIP_TYP_CDE                                        
051600              , A.MOM_DEST_POE_CDE                                        
051700              , A.MOM_IMPRT_VEH_NM                                        
051800              , A.MOM_IMPRT_TRIP_ID                                       
051900              , A.CONTNR_SEQ_NBR                                  DPKCS036
052000          FROM                                                    DPKCS036
052100                TIMCNTK A                                         DPKCS036
052200              , TIMCNPO B                                         DPKCS036
052300          WHERE                                                   DPKCS036
052400                B.PO_NBR         = :DK-PO-NBR                     DPKCS036
052500          AND   B.CONTNR_ID      =  A.CONTNR_ID                   DPKCS036
052600          AND   B.CONTNR_SEQ_NBR =  A.CONTNR_SEQ_NBR              DPKCS036
052700          ORDER BY                                                DPKCS036
052800                A.MOM_IMPRT_TRIP_ID                               DPKCS036
052900     END-EXEC.                                                    DPKCS036
053000                                                                  DPKCS036
053100 EJECT                                                            DPKCS036
053200*---------------------------------------------------------------* DPKCS036
053300*    CURSOR FOR CONTAINER LIST FOR A REQUESTED PO IN SELECTED   * DPKCS036
053400*    VESSEL/VOYAGE.                                             * DPKCS036
053500*---------------------------------------------------------------* DPKCS036
053600                                                                  DPKCS036
053700     EXEC SQL                                                     DPKCS036
053800          DECLARE VSL-CONTNR-CSR CURSOR                           DPKCS036
053900          FOR SELECT DISTINCT                                     DPKCS036
054000                A.CONTNR_ID                                       DPKCS036
054100              , A.FDR_FOB_CDE                                     DPKCS036
054200              , A.MOM_FOB_CDE                                     DPKCS036
054300              , A.ORGN_SHPD_FR_CDE                                DPKCS036
054400              , A.ORGN_SHPD_TO_CDE                                DPKCS036
054700              , A.MOM_TRIP_TYP_CDE                                        
054800              , A.FDR_TRIP_TYP_CDE                                        
054900              , A.MOM_DEST_POE_CDE                                        
055000              , A.MOM_IMPRT_VEH_NM                                        
055100              , A.MOM_IMPRT_TRIP_ID                                       
055200              , A.CONTNR_SEQ_NBR                                  DPKCS036
055300          FROM                                                    DPKCS036
055400                TIMCNTK  A                                        DPKCS036
055500              , TIMCNPO  B                                        DPKCS036
055600          WHERE                                                   DPKCS036
055700                B.PO_NBR            = :DK-PO-NBR                  DPKCS036
055800          AND   B.CONTNR_ID         =  A.CONTNR_ID                DPKCS036
055900          AND   B.CONTNR_ID         =  A.CONTNR_ID                DPKCS036
056000          AND   A.MOM_IMPRT_VEH_NM  = :DK-VSL-NAME                DPKCS036
056100          AND   A.MOM_IMPRT_TRIP_ID = :DK-VOY-NO                  DPKCS036
056200          ORDER BY                                                DPKCS036
056300                A.MOM_IMPRT_TRIP_ID                               DPKCS036
056400     END-EXEC.                                                    DPKCS036
056500                                                                  DPKCS036
056600 EJECT                                                            DPKCS036
056700*----------------------------------------------------------------*        
056800*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *        
056900*----------------------------------------------------------------*        
057000                                                                          
057100     EXEC SQL                                                     02960099
057200          DECLARE  OUTR-PCK-CSR CURSOR                            02970099
057300             FOR   SELECT                                         02980099
057400                   A.UNT_QTY                                      03000099
057500                ,  A.OUTR_PK_QTY                                  02990099
057600             FROM  TPURITM  A                                     03010099
057900             WHERE A.PO_NBR         = :DK-PO-NBR                          
058300             AND   A.VER_STATUS_CDE = 'A'                         03050099
058301             FOR   FETCH ONLY                                     03060099
058302     END-EXEC.                                                    03070099
058303                                                                          
058400 EJECT                                                                    
058401*---------------------------------------------------------------* 03880099
058403*    CURSOR DECLARATION FOR SELECTING POE CODE.                 *         
058404*---------------------------------------------------------------* 03900099
058405                                                                  03910099
058406     EXEC SQL                                                     03920099
058407          DECLARE  POE-CSR CURSOR                                 03930099
058408              FOR  SELECT DISTINCT                                03940099
058411                   POE_CDE                                                
058413             FROM  TIMPOE                                                 
058414            WHERE  POE_STD_EDI_CDE = :IMCNTK-MOM-DEST-POE-CDE             
058415              AND  STAT_CDE        = 'A'                                  
058416         ORDER BY  POE_CDE                                                
058417     END-EXEC.                                                            
058418                                                                          
058430 EJECT                                                            04110099
058500*----------------------------------------------------------------*DPKCS036
058600 LINKAGE SECTION.                                                 DPKCS036
058700                                                                  DPKCS036
058800 01  DFHCOMMAREA.                                                 DPKCS036
058900     05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
059000                                        DEPENDING ON EIBCALEN.    DPKCS036
059100         10  FILLER                     PIC X.                    DPKCS036
059200                                                                  DPKCS036
059300 EJECT                                                            DPKCS036
059400*----------------------------------------------------------------*DPKCS036
059500 PROCEDURE DIVISION.                                              DPKCS036
059600*----------------------------------------------------------------*DPKCS036
059700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *DPKCS036
059800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *DPKCS036
059900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *DPKCS036
060000*----------------------------------------------------------------*DPKCS036
060100 0000-MAIN-MODULE.                                                DPKCS036
060200                                                                  DPKCS036
060300     INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
060400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
060500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
060600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
060700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
060800     MOVE LENGTH OF TR162AI        TO DP030-MAP-LENGTH (1).       DPKCS036
060900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
061000     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
061100*                                                                 DPKCS036
061200     PERFORM 1000-CONTROL-PROCESSING.                             DPKCS036
061300*                                                                 DPKCS036
061400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
061500     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
061600                                                                  DPKCS036
061700*----------------------------------------------------------------*DPKCS036
061800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *DPKCS036
061900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *DPKCS036
062000*----------------------------------------------------------------*DPKCS036
062100 0001-CALL-CICS-ARCH-API.                                         DPKCS036
062200                                                                  DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      DPKCS036
062400                                    DFHCOMMAREA                           
062500                                    DP030-CICS-API-FIELDS                 
062600                                    DP020-STANDARD-COMMAREA               
062700                                    TR162AI.                              
062800*                                                                 DPKCS036
062900     IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
063000         CONTINUE                                                 DPKCS036
063100     ELSE                                                         DPKCS036
063200         SET DP013-NO-ROLLBACK                                    DPKCS036
063300             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
063400             DP013-CICS-ABEND      TO TRUE                        DPKCS036
063500         MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
063600                                   TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
063900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
064000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
064100     END-IF.                                                      DPKCS036
064200                                                                  DPKCS036
064300 EJECT                                                            DPKCS036
064400*----------------------------------------------------------------*DPKCS036
064500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
064600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
064700*                                                                *DPKCS036
064800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
064900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
065000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
065100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
065200*----------------------------------------------------------------*DPKCS036
065300 1000-CONTROL-PROCESSING.                                         DPKCS036
065400                                                                  DPKCS036
065500     EVALUATE TRUE                                                DPKCS036
065600         WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
065700             INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
065800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
065900                                      ASC-SEL-TERM-ID             DPKCS036
066000             MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
066100                                   TO ASC-LIST-TASK-NUMBER        DPKCS036
066200                                      ASC-SEL-TASK-NUMBER         DPKCS036
066300             MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
066400                                   TO ASC-LIST-SEQ                DPKCS036
066500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
066600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
066700*-------$TEMPLATE NOTE$------------------------------------------*DPKCS036
066800* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *DPKCS036
066900* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *DPKCS036
067000* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *DPKCS036
067100*----------------------------------------------------------------*DPKCS036
067200             IF  PS-COMMAREA-NOT-VALID                            DPKCS036
067300                 SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
067400                                   TO TRUE                        DPKCS036
067500             ELSE                                                 DPKCS036
067600                 PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
067700             END-IF                                               DPKCS036
067800                                                                  DPKCS036
067900         WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
068000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
068100                                   TO PV-TOP-ITEM                 DPKCS036
068200             PERFORM 2000-PROCESS-PANEL                           DPKCS036
068300                                                                  DPKCS036
068400         WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
068500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
068600                                   TO PV-TOP-ITEM                 DPKCS036
068700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
068800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 DPKCS036
068900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
069000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
069100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
069200                                                                  DPKCS036
069300         WHEN OTHER                                               DPKCS036
069400             SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
069500             SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
069600             MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
069700                                   TO DP013-PARAGRAPH             DPKCS036
069800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
069900                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
070000             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
070100     END-EVALUATE.                                                DPKCS036
070200                                                                  DPKCS036
070300 EJECT                                                            DPKCS036
070400*----------------------------------------------------------------*DPKCS036
070500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
070600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
070700*----------------------------------------------------------------*DPKCS036
070800 1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
070900                                                                  DPKCS036
071000     SET PS-COMMAREA-VALID         TO TRUE.                               
071100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
071200     IF  DP020-INT-APPL-FORMAT-IND = PC-PO-CRIT-SUMM-FORMAT       DPKCS036
071300         IF  DP020-NAV-KEY-DATA > SPACE                                   
071400             MOVE DP020-NAV-KEY-DATA                                      
071500                                   TO ASC-KEY-PO-NBR                      
071600                                      DK-PO-NBR                           
071700         ELSE                                                             
071800             MOVE TR105-PO-NBR     TO ASC-KEY-PO-NBR                      
071900                                      DK-PO-NBR                           
072000         END-IF                                                           
072100         SET ASC-CONTNR-CURSOR     TO TRUE                        DPKCS036
072200     ELSE                                                         DPKCS036
072300         IF  DP020-INT-APPL-FORMAT-IND = PC-PO-SAILING-FORMAT     DPKCS036
072400             SET ASC-VSL-CONTNR-CURSOR                            DPKCS036
072500                                   TO TRUE                        DPKCS036
072600             MOVE TR107-PO-NBR     TO ASC-KEY-PO-NBR              DPKCS036
072700                                      DK-PO-NBR                   DPKCS036
072800             MOVE TR107-VSL-NAME   TO ASC-KEY-VSL-NAME            DPKCS036
072900                                      DK-VSL-NAME                 DPKCS036
073000             MOVE TR107-VOY-NO     TO ASC-KEY-VOY-NO              DPKCS036
073100                                      DK-VOY-NO                   DPKCS036
073200         END-IF                                                   DPKCS036
073300     END-IF.                                                      DPKCS036
073400                                                                  DPKCS036
073500 EJECT                                                            DPKCS036
073600*----------------------------------------------------------------*DPKCS036
073700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *DPKCS036
073800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
073900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
074000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
074100* FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
074200*----------------------------------------------------------------*DPKCS036
074300 2000-PROCESS-PANEL.                                              DPKCS036
074400                                                                  DPKCS036
074500     EVALUATE TRUE                                                DPKCS036
074600         WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
074700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
074800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
074900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
075000                                                                  DPKCS036
075100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
075200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
075300             MOVE ASC-KEY-VSL-NAME TO DK-VSL-NAME                 DPKCS036
075400             MOVE ASC-KEY-VOY-NO   TO DK-VOY-NO                   DPKCS036
075500             PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
075600             PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
075700                                                                  DPKCS036
075800         WHEN OTHER                                               DPKCS036
075900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 DPKCS036
076000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
076100             IF  PS-NO-ERROR                                      DPKCS036
076200                 SET DP030-CONTINUE-GO                            DPKCS036
076300                                 TO TRUE                          DPKCS036
076400                 PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
076500             ELSE                                                 DPKCS036
076600                 SET DP030-OVERRIDE-GO                            DPKCS036
076700                                 TO TRUE                          DPKCS036
076800             END-IF                                               DPKCS036
076900     END-EVALUATE.                                                DPKCS036
077000                                                                  DPKCS036
077100 EJECT                                                            DPKCS036
077200*----------------------------------------------------------------*DPKCS036
077300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
077400*----------------------------------------------------------------*DPKCS036
077500 2050-DELETE-LIST-QUEUE.                                          DPKCS036
077600                                                                  DPKCS036
077700     EXEC CICS                                                    DPKCS036
077800         DELETEQ TS                                               DPKCS036
077900             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
078000             RESP  (PV-CICS-RESP)                                 DPKCS036
078100     END-EXEC.                                                    DPKCS036
078200                                                                  DPKCS036
078300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
078400        (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
078500         CONTINUE                                                 DPKCS036
078600     ELSE                                                         DPKCS036
078700         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
078800         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
078900                                                                  DPKCS036
079000         MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
079100                                   TO DP013-PARAGRAPH             DPKCS036
079200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
079300                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
079400         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
079500     END-IF.                                                      DPKCS036
079600                                                                  DPKCS036
079700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
079800                                                                  DPKCS036
079900 EJECT                                                            DPKCS036
080000*----------------------------------------------------------------*DPKCS036
080100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
080200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
080300* CICS ARCHITECTURE API.                                         *DPKCS036
080400*----------------------------------------------------------------*DPKCS036
080500 2100-CHECK-FUNCTION-KEY.                                         DPKCS036
080600                                                                  DPKCS036
080700     EVALUATE TRUE                                                DPKCS036
080800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              DPKCS036
080900         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              DPKCS036
080910         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              DPKCS036
080920         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              DPKCS036
080930         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              DPKCS036
081000             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                 DPKCS036
081100                 INITIALIZE TR102-INTER-APPL-COMMAREA             DPKCS036
081200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
081300                                 TO TR102-NUMBER-OF-SELECTED-ITEMSDPKCS036
081400                 MOVE ASC-KEY-PO-NBR                              DPKCS036
081500                                 TO TR102-PO-NBR                  DPKCS036
081510                 MOVE PV-CONTNR-NBR                               DPKCS036
081520                                 TO TR102-CONTNR-NO               DPKCS036
081530                 MOVE PV-CONTNR-SEQ-NBR                           DPKCS036
081540                                 TO TR102-CONTNR-SEQ-NO           DPKCS036
081600                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
081700             ELSE                                                 DPKCS036
081800                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             DPKCS036
081900                     SET DP030-OVERRIDE-GO     TO TRUE            DPKCS036
082000                     MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBERDPKCS036
082100                     SET DP020-MSG-WARNING     TO TRUE            DPKCS036
082200                 ELSE                                             DPKCS036
082300                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         DPKCS036
082400                         SET DP030-OVERRIDE-GO TO TRUE            DPKCS036
082500                         MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBERDPKCS036
082600                         SET DP020-MSG-WARNING TO TRUE            DPKCS036
082700                     END-IF                                       DPKCS036
082800                 END-IF                                           DPKCS036
082900             END-IF                                               DPKCS036
083000                                                                  DPKCS036
083100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              DPKCS036
083200             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                 DPKCS036
083300                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
083400                 INITIALIZE TR105-INTER-APPL-COMMAREA             DPKCS036
083500                 MOVE ASC-KEY-PO-NBR                              DPKCS036
083600                                TO TR105-PO-NBR                   DPKCS036
083700             ELSE                                                 DPKCS036
083800                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             DPKCS036
083900                     SET DP030-OVERRIDE-GO     TO TRUE            DPKCS036
084000                     MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBERDPKCS036
084100                     SET DP020-MSG-WARNING     TO TRUE            DPKCS036
084200                 ELSE                                             DPKCS036
084300                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         DPKCS036
084400                         SET DP030-OVERRIDE-GO TO TRUE            DPKCS036
084500                         MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBERDPKCS036
084600                         SET DP020-MSG-WARNING TO TRUE            DPKCS036
084700                     END-IF                                       DPKCS036
084800                 END-IF                                           DPKCS036
084900             END-IF                                               DPKCS036
085000                                                                  DPKCS036
085100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
085200             MOVE +1               TO PV-TOP-ITEM                 DPKCS036
085300             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
085400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
085500             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
085600                                                                  DPKCS036
085700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
085800             PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
085900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
086000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
086100             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
086200                                                                  DPKCS036
086300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
086400             PERFORM 2120-BROWSE-FORWARD                          DPKCS036
086500             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   DPKCS036
086600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
086700                                                                  DPKCS036
086800         WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
086900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
087000             IF  PS-ERROR                                         DPKCS036
087100                 CONTINUE                                         DPKCS036
087200             ELSE                                                 DPKCS036
087300                 MOVE ASC-KEY-PO-NBR                              DPKCS036
087400                                   TO DK-PO-NBR                   DPKCS036
087500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
087600                 PERFORM 3200-RESET-ATTRIBUTES                    DPKCS036
087700             END-IF                                               DPKCS036
087800                                                                  DPKCS036
087900         WHEN OTHER                                               DPKCS036
088000             SET DP013-NO-ROLLBACK                                DPKCS036
088100                 DP013-XCTL-DISPLAY-RESTART                       DPKCS036
088200                 DP013-CICS-ABEND  TO TRUE                        DPKCS036
088300             MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
088400                                   TO DP013-PARAGRAPH             DPKCS036
088500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
088600                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
088700             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
088800     END-EVALUATE.                                                DPKCS036
088900                                                                  DPKCS036
089000 EJECT                                                            DPKCS036
089100*----------------------------------------------------------------*DPKCS036
089200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
089300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
089400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
089500*    MESSAGE.                                                    *DPKCS036
089600*----------------------------------------------------------------*DPKCS036
089700 2110-BROWSE-BACKWARD.                                            DPKCS036
089800                                                                  DPKCS036
089900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
090000         GIVING PV-TOP-ITEM.                                      DPKCS036
090100*                                                                 DPKCS036
090200     IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
090300       OR (PV-TOP-ITEM = +1))                                     DPKCS036
090400         MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
090500*------- TOP OF LIST -----                                        DPKCS036
090600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
090700         SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
090800     END-IF.                                                      DPKCS036
090900                                                                  DPKCS036
091000 EJECT                                                            DPKCS036
091100*----------------------------------------------------------------*DPKCS036
091200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
091300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
091400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
091500*----------------------------------------------------------------*DPKCS036
091600 2120-BROWSE-FORWARD.                                             DPKCS036
091700                                                                  DPKCS036
091800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
091900         GIVING PV-TOP-ITEM.                                      DPKCS036
092000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
092100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
092200                                   TO PV-TOP-ITEM                 DPKCS036
092300*------- BOTTOM OF LIST -----------                               DPKCS036
092400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
092500         SET DP020-MSG-INFORMATIONAL                              DPKCS036
092600                                   TO TRUE                        DPKCS036
092700     ELSE                                                         DPKCS036
092800         COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
092900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
093000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
093100*----------- BOTTOM OF LIST ---------                             DPKCS036
093200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
093300             SET DP020-MSG-INFORMATIONAL                          DPKCS036
093400                                   TO TRUE                        DPKCS036
093500         END-IF                                                   DPKCS036
093600     END-IF.                                                      DPKCS036
093700                                                                  DPKCS036
093800 EJECT                                                            DPKCS036
093900*----------------------------------------------------------------*DPKCS036
094000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
094100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
094200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
094300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
094400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
094500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
094600*----------------------------------------------------------------*DPKCS036
094700 2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
094800                                                                  DPKCS036
094900     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
095000     IF  (ASC-START-ITEM-REQUEST = SPACE)                         DPKCS036
095100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
095200                                   TO PV-TOP-ITEM                 DPKCS036
095300     ELSE                                                         DPKCS036
095400         MOVE ASC-START-ITEM-REQUEST                              DPKCS036
095500                                   TO DP010I-UNEDITED-FIELD       DPKCS036
095600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
095700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
095800         SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
095900                                   TO TRUE                        DPKCS036
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
096100                                                                  DPKCS036
096200         IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
096300             MOVE DP010I-NUMERIC-FIELD                            DPKCS036
096400                                   TO  ASC-START-ITEM-REQUEST-N   DPKCS036
096500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
096600                 IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
096700                                          ASC-NUMBER-OF-ITEMS-READDPKCS036
096800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
096900                     COMPUTE PV-TOP-ITEM =                        DPKCS036
097000                             ASC-NUMBER-OF-ITEMS-READ             DPKCS036
097100                             - PC-ITEMS-PER-PANEL + 1             DPKCS036
097200                     IF  PV-TOP-ITEM < +1                         DPKCS036
097300                         MOVE +1   TO PV-TOP-ITEM                 DPKCS036
097400                         MOVE PC-TSYMSG-00070                     DPKCS036
097500                                   TO DP020-MSG-NUMBER            DPKCS036
097600                         SET DP020-MSG-INFORMATIONAL              DPKCS036
097700                                   TO TRUE                        DPKCS036
097800                     END-IF                                       DPKCS036
097900                 ELSE                                             DPKCS036
098000                     MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
098100                                   TO PV-TOP-ITEM                 DPKCS036
098200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
098300                     COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
098400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
098500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
098600*----------------------- BOTTOM OF LIST --------------            DPKCS036
098700                         MOVE PC-TSYMSG-00070                     DPKCS036
098800                                   TO DP020-MSG-NUMBER            DPKCS036
098900                         SET DP020-MSG-INFORMATIONAL              DPKCS036
099000                                   TO TRUE                        DPKCS036
099100                     END-IF                                       DPKCS036
099200                 END-IF                                           DPKCS036
099300             ELSE                                                 DPKCS036
099400*--------------- VALUE OUT OF RANGE ------------------            DPKCS036
099500                 MOVE PC-TSYMSG-00101                             DPKCS036
099600                                   TO DP020-MSG-NUMBER            DPKCS036
099700                 MOVE -1           TO ASTRTITL                    DPKCS036
099800                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
099900                                   TO TRUE                        DPKCS036
100000                 MOVE DP015-REVERSE                               DPKCS036
100100                                   TO ASTRTITH                    DPKCS036
100200                 MOVE DP015-RED    TO ASTRTITC                    DPKCS036
100300                 MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
100400                                   TO ASTRTITA                    DPKCS036
100500                 SET DP020-MSG-FATAL                              DPKCS036
100600                                   TO TRUE                        DPKCS036
100700                 SET PS-ERROR      TO TRUE                        DPKCS036
100800             END-IF                                               DPKCS036
100900                                                                  DPKCS036
101000         ELSE                                                     DPKCS036
101100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
101200             MOVE -1               TO ASTRTITL                    DPKCS036
101300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
101400             MOVE DP015-REVERSE    TO ASTRTITH                    DPKCS036
101500             MOVE DP015-RED        TO ASTRTITC                    DPKCS036
101600             MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
101700                                   TO ASTRTITA                    DPKCS036
101800             SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
101900             SET PS-ERROR          TO TRUE                        DPKCS036
102000         END-IF                                                   DPKCS036
102100     END-IF.                                                      DPKCS036
102200                                                                  DPKCS036
102300 EJECT                                                            DPKCS036
102400*----------------------------------------------------------------*DPKCS036
102500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
102600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
102700*----------------------------------------------------------------*DPKCS036
102800 2140-DESELECT-ALL-ITEMS.                                         DPKCS036
102900                                                                  DPKCS036
103000     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
103100                                                                  DPKCS036
103200     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
103300         VARYING ASC-ITEM-SUB                                     DPKCS036
103400         FROM 1 BY 1                                              DPKCS036
103500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
103600                                                                  DPKCS036
103700     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
103800                                                                  DPKCS036
103900     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
104000         VARYING ASC-ITEM-SUB                                     DPKCS036
104100         FROM 1 BY 1                                              DPKCS036
104200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
104300                                                                  DPKCS036
104400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
104500                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
104600                                                                  DPKCS036
104700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
104800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
104900                                                                  DPKCS036
105000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
105100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
105200         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
105300                                                                  DPKCS036
105400         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
105500                                                                  DPKCS036
105600         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
105700                                                                  DPKCS036
105800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
105900             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
106000                                                                  DPKCS036
106100         PERFORM                                                  DPKCS036
106200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
106300                                                                  DPKCS036
106400             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
106500                                                                  DPKCS036
106600             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
106700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
106800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
106900                                                                  DPKCS036
107000             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
107100                                                                  DPKCS036
107200             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
107300                                                                  DPKCS036
107400         END-PERFORM                                              DPKCS036
107500                                                                  DPKCS036
107600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
107700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
107800                                                                  DPKCS036
107900         PERFORM                                                  DPKCS036
108000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
108100                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
108200                                                                  DPKCS036
108300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
108400                                   TO PV-BLOCK-NUMBER             DPKCS036
108500                                                                  DPKCS036
108600             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
108700                                                                  DPKCS036
108800             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
108900                 VARYING ASC-ITEM-SUB                             DPKCS036
109000                 FROM 1 BY 1                                      DPKCS036
109100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
109200                                                                  DPKCS036
109300             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
109400                                                                  DPKCS036
109500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
109600                                                                  DPKCS036
109700         END-PERFORM                                              DPKCS036
109800                                                                  DPKCS036
109900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
110000                                   TO PV-BLOCK-NUMBER             DPKCS036
110100                                                                  DPKCS036
110200         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
110300     END-IF.                                                      DPKCS036
110400                                                                  DPKCS036
110500     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
110600                                      ASC-START-OF-SELECTED-RANGE DPKCS036
110700                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
110800                                                                  DPKCS036
110900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
111000                                                                  DPKCS036
111100 EJECT                                                            DPKCS036
111200*----------------------------------------------------------------*DPKCS036
111300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
111400*----------------------------------------------------------------*DPKCS036
111500 2141-CLEAR-SELECTED-INDS.                                        DPKCS036
111600                                                                  DPKCS036
111700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
111800             NOT EQUAL ZERO                                       DPKCS036
111900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
112000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
112100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
112200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
112300                                   TO TRUE                        DPKCS036
112400         END-IF                                                   DPKCS036
112500     END-IF.                                                      DPKCS036
112600                                                                  DPKCS036
112700 EJECT                                                            DPKCS036
112800*----------------------------------------------------------------*DPKCS036
112900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
113000*  FOR ALL ITEMS.                                                *DPKCS036
113100*----------------------------------------------------------------*DPKCS036
113200 2150-SELECT-ALL-ITEMS.                                           DPKCS036
113300                                                                  DPKCS036
113400     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
113500                                                                  DPKCS036
113600     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
113700         VARYING ASC-ITEM-SUB                                     DPKCS036
113800         FROM 1 BY 1                                              DPKCS036
113900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
114000                                                                  DPKCS036
114100     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
114200                                                                  DPKCS036
114300     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
114400         VARYING ASC-ITEM-SUB                                     DPKCS036
114500         FROM 1 BY 1                                              DPKCS036
114600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
114700                                                                  DPKCS036
114800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
114900                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
115000                                                                  DPKCS036
115100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
115200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
115300                                                                  DPKCS036
115400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
115500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
115600         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
115700                                                                  DPKCS036
115800         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
115900                                                                  DPKCS036
116000         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
116100                                                                  DPKCS036
116200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
116300             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
116400                                                                  DPKCS036
116500         PERFORM                                                  DPKCS036
116600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
116700                                                                  DPKCS036
116800             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
116900                                                                  DPKCS036
117000             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
117100                 VARYING ASC-ITEM-SUB                             DPKCS036
117200                 FROM 1 BY 1                                      DPKCS036
117300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
117400                                                                  DPKCS036
117500             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
117600                                                                  DPKCS036
117700             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
117800                                                                  DPKCS036
117900         END-PERFORM                                              DPKCS036
118000                                                                  DPKCS036
118100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
118200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
118300                                                                  DPKCS036
118400         PERFORM                                                  DPKCS036
118500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
118600                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
118700                                                                  DPKCS036
118800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
118900                                   TO PV-BLOCK-NUMBER             DPKCS036
119000                                                                  DPKCS036
119100             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
119200                                                                  DPKCS036
119300             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
119400                 VARYING ASC-ITEM-SUB                             DPKCS036
119500                 FROM 1 BY 1                                      DPKCS036
119600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
119700                                                                  DPKCS036
119800             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
119900                                                                  DPKCS036
120000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
120100                                                                  DPKCS036
120200         END-PERFORM                                              DPKCS036
120300                                                                  DPKCS036
120400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
120500                                   TO PV-BLOCK-NUMBER             DPKCS036
120600                                                                  DPKCS036
120700         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
120800     END-IF.                                                      DPKCS036
120900                                                                  DPKCS036
121000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
121100                       ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
121200                                                                  DPKCS036
121300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
121400                                                                  DPKCS036
121500 EJECT                                                            DPKCS036
121600*----------------------------------------------------------------*DPKCS036
121700*    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
121800*----------------------------------------------------------------*DPKCS036
121900 2151-SET-SELECTED-INDS.                                          DPKCS036
122000                                                                  DPKCS036
122100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
122200             NOT EQUAL ZERO                                       DPKCS036
122300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
122400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
122500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
122600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
122700                               TO  TRUE                           DPKCS036
122800         END-IF                                                   DPKCS036
122900     END-IF.                                                      DPKCS036
123000                                                                  DPKCS036
123100 EJECT                                                            DPKCS036
123200*----------------------------------------------------------------*DPKCS036
123300*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *DPKCS036
123400*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *DPKCS036
123500*----------------------------------------------------------------*DPKCS036
123600 2200-MOVE-SCREEN-TO-COMMAREA.                                    DPKCS036
123700                                                                  DPKCS036
123800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             DPKCS036
123900     MOVE +1                       TO PV-SUB.                     DPKCS036
124000*                                                                 DPKCS036
124100     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
124200     IF  ASTRTITL > ZERO                                          DPKCS036
124300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          DPKCS036
124400     ELSE                                                         DPKCS036
124500         IF  ASTRTITF = DP015-ERASE-EOF                           DPKCS036
124600             INITIALIZE ASC-START-ITEM-REQUEST                    DPKCS036
124700         END-IF                                                   DPKCS036
124800     END-IF.                                                      DPKCS036
124900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
125000         VARYING PV-SUB                                           DPKCS036
125100         FROM 1 BY 1                                              DPKCS036
125200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
125300                                                                  DPKCS036
125400 EJECT                                                            DPKCS036
125500*----------------------------------------------------------------*DPKCS036
125600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *DPKCS036
125700*----------------------------------------------------------------*DPKCS036
125800 2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
125900                                                                  DPKCS036
126000     IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
126100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
126200         MOVE MR-SELECTI (PV-SUB)                                 DPKCS036
126300                                   TO ASC-TEMP-SELECTED-SW        DPKCS036
126400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
126500     ELSE                                                         DPKCS036
126600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
126700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
126800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
126900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
127000         END-IF                                                   DPKCS036
127100     END-IF.                                                      DPKCS036
127200     ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
127300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
127400         ADD  +1                   TO ASC-BLK-SUB                 DPKCS036
127500         MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
127600     END-IF.                                                      DPKCS036
127700                                                                  DPKCS036
127800 EJECT                                                            DPKCS036
127900*----------------------------------------------------------------*DPKCS036
128000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *DPKCS036
128100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *DPKCS036
128200*----------------------------------------------------------------*DPKCS036
128300 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
128400                                                                  DPKCS036
128500     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
128600     PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
128700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
128800*----------------------------------------------------------------*DPKCS036
128900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *DPKCS036
129000* EDITTING IS DONE FROM THE BOTTOM UP.                           *DPKCS036
129100*----------------------------------------------------------------*DPKCS036
129200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
129300         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
129400     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
129500     PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
129600         VARYING PV-SUB                                           DPKCS036
129700         FROM PV-SUB BY -1                                        DPKCS036
129800         UNTIL PV-SUB < +1.                                       DPKCS036
129900*                                                                 DPKCS036
130000     IF  PS-NO-ERROR                                              DPKCS036
130100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
130200     END-IF.                                                      DPKCS036
130300*                                                                 DPKCS036
130400     IF  ((PS-NO-ERROR)                                           DPKCS036
130500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
130600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
130700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
130800     END-IF.                                                      DPKCS036
130900                                                                  DPKCS036
131000 EJECT                                                            DPKCS036
131100*----------------------------------------------------------------*DPKCS036
131200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
131300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *DPKCS036
131400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
131500*                                                                *DPKCS036
131600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
131700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
131800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
131900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
132000*----------------------------------------------------------------*DPKCS036
132100 3100-SET-SUBSCRIPTS.                                             DPKCS036
132200                                                                  DPKCS036
132300     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
132400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
132500                                                                  DPKCS036
132600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
132700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
132800                                                                  DPKCS036
132900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
133000     ELSE                                                         DPKCS036
133100         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
133200     END-IF.                                                      DPKCS036
133300                                                                  DPKCS036
133400 EJECT                                                            DPKCS036
133500*----------------------------------------------------------------*DPKCS036
133600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *DPKCS036
133700*----------------------------------------------------------------*DPKCS036
133800 3200-RESET-ATTRIBUTES.                                           DPKCS036
133900                                                                  DPKCS036
134000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   DPKCS036
134100     MOVE DP015-GREEN              TO ASTRTITC.                   DPKCS036
134200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   DPKCS036
134300*                                                                 DPKCS036
134400     PERFORM                                                      DPKCS036
134500         VARYING PV-SUB                                           DPKCS036
134600         FROM 1 BY 1                                              DPKCS036
134700         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   DPKCS036
134800                         ASC-ITEMS-DISPLAYED)                     DPKCS036
134900         MOVE DP015-UNP-ALP-NOR-OFF                               DPKCS036
135000                                   TO MR-SELECTA (PV-SUB)         DPKCS036
135100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         DPKCS036
135200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         DPKCS036
135300     END-PERFORM.                                                 DPKCS036
135400                                                                  DPKCS036
135500 EJECT                                                            DPKCS036
135600*----------------------------------------------------------------*DPKCS036
135700*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *DPKCS036
135800*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *DPKCS036
135900*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *DPKCS036
136000*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *DPKCS036
136100*----------------------------------------------------------------*DPKCS036
136200 3300-EDIT-SELECTIONS.                                            DPKCS036
136300                                                                  DPKCS036
136400     EVALUATE TRUE                                                DPKCS036
136500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
136600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
136700                 CONTINUE                                         DPKCS036
136800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
136900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
137000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   DPKCS036
137100                 MOVE ASC-TEMP-SELECTED-SW                        DPKCS036
137200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
137300                                TO ASC-SELECTED-SW                DPKCS036
137400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
137500             END-IF                                               DPKCS036
137600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
137700                                = SPACE                           DPKCS036
137800             EVALUATE TRUE                                        DPKCS036
137900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
138000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
138100                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
138200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
138300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
138400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    DPKCS036
138500                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
138600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
138700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
138800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      DPKCS036
138900                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
139000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
139100             END-EVALUATE                                         DPKCS036
139200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
139300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
139400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
139500             END-IF                                               DPKCS036
139600             PERFORM 3310-EDIT-RANGE                              DPKCS036
139700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
139800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
139900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
140000             END-IF                                               DPKCS036
140100             PERFORM 3310-EDIT-RANGE                              DPKCS036
140200         WHEN OTHER                                               DPKCS036
140300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           DPKCS036
140400             SET DP020-MSG-FATAL    TO TRUE                       DPKCS036
140500             MOVE -1                TO MR-SELECTL (PV-SUB)        DPKCS036
140600             SET DP030-SET-CURSOR-APPL-1                          DPKCS036
140700                                    TO TRUE                       DPKCS036
140800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        DPKCS036
140900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        DPKCS036
141000             SET PS-ERROR TO TRUE                                 DPKCS036
141100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
141200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     DPKCS036
141300                 MOVE SPACE         TO ASC-SELECTED-SW            DPKCS036
141400                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
141500             END-IF                                               DPKCS036
141600     END-EVALUATE.                                                DPKCS036
141700                                                                  DPKCS036
141800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 DPKCS036
141900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               DPKCS036
142000     IF  ASC-ITEM-SUB < 1                                         DPKCS036
142100         SUBTRACT +1 FROM ASC-BLK-SUB                             DPKCS036
142200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                DPKCS036
142300     END-IF.                                                      DPKCS036
142400                                                                  DPKCS036
142500 EJECT                                                            DPKCS036
142600*----------------------------------------------------------------*DPKCS036
142700*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *DPKCS036
142800*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *DPKCS036
142900*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *DPKCS036
143000*  THE ENDING.                                                   *DPKCS036
143100*----------------------------------------------------------------*DPKCS036
143200 3310-EDIT-RANGE.                                                 DPKCS036
143300                                                                  DPKCS036
143400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                DPKCS036
143500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   DPKCS036
143600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
143700                                   TO ASC-SELECTED-SW             DPKCS036
143800                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
143900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE DPKCS036
144000         ELSE                                                     DPKCS036
144100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     DPKCS036
144200                 CONTINUE                                         DPKCS036
144300             ELSE                                                 DPKCS036
144400*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          DPKCS036
144500                 MOVE PC-TSYMSG-00054                             DPKCS036
144600                                   TO DP020-MSG-NUMBER            DPKCS036
144700                 SET DP020-MSG-FATAL                              DPKCS036
144800                                   TO TRUE                        DPKCS036
144900                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
145000                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
145100                                   TO TRUE                        DPKCS036
145200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         DPKCS036
145300                 MOVE DP015-UNDERLINE                             DPKCS036
145400                                   TO MR-SELECTH (PV-SUB)         DPKCS036
145500                 SET PS-ERROR      TO TRUE                        DPKCS036
145600             END-IF                                               DPKCS036
145700         END-IF                                                   DPKCS036
145800     ELSE                                                         DPKCS036
145900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
146000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
146100                                   TO ASC-SELECTED-SW             DPKCS036
146200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
146300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   DPKCS036
146400         ELSE                                                     DPKCS036
146500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       DPKCS036
146600                 CONTINUE                                         DPKCS036
146700             ELSE                                                 DPKCS036
146800*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            DPKCS036
146900                 MOVE PC-TSYMSG-00055                             DPKCS036
147000                                   TO DP020-MSG-NUMBER            DPKCS036
147100                 SET DP020-MSG-FATAL                              DPKCS036
147200                                   TO TRUE                        DPKCS036
147300                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
147400                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
147500                                   TO TRUE                        DPKCS036
147600                 SET PS-ERROR      TO TRUE                        DPKCS036
147700             END-IF                                               DPKCS036
147800         END-IF                                                   DPKCS036
147900     END-IF.                                                      DPKCS036
148000                                                                  DPKCS036
148100 EJECT                                                            DPKCS036
148200*----------------------------------------------------------------*DPKCS036
148300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *DPKCS036
148400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *DPKCS036
148500*----------------------------------------------------------------*DPKCS036
148600 3400-CHECK-RANGE-SEQUENCE.                                       DPKCS036
148700                                                                  DPKCS036
148800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
148900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      DPKCS036
149000       AND  ASC-START-OF-SELECTED-RANGE >                         DPKCS036
149100                                         ASC-END-OF-SELECTED-RANGEDPKCS036
149200*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                DPKCS036
149300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 DPKCS036
149400         SET DP020-MSG-FATAL TO TRUE                              DPKCS036
149500         SET PS-ERROR TO TRUE                                     DPKCS036
149600         PERFORM 3410-POSITION-AT-ERROR                           DPKCS036
149700     END-IF.                                                      DPKCS036
149800                                                                  DPKCS036
149900 EJECT                                                            DPKCS036
150000*----------------------------------------------------------------*DPKCS036
150100*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *DPKCS036
150200*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *DPKCS036
150300*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *DPKCS036
150400*----------------------------------------------------------------*DPKCS036
150500 3410-POSITION-AT-ERROR.                                          DPKCS036
150600                                                                  DPKCS036
150700     SET DP030-SET-CURSOR-APPL-1                                  DPKCS036
150800                                   TO TRUE.                       DPKCS036
150900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
151000                    - PV-TOP-ITEM + 1.                            DPKCS036
151100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
151200         CONTINUE                                                 DPKCS036
151300     ELSE                                                         DPKCS036
151400         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
151500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
151600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
151700     END-IF.                                                      DPKCS036
151800*                                                                 DPKCS036
151900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
152000                    - PV-TOP-ITEM + 1.                            DPKCS036
152100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
152200         CONTINUE                                                 DPKCS036
152300     ELSE                                                         DPKCS036
152400         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
152500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
152600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
152700     END-IF.                                                      DPKCS036
152800                                                                  DPKCS036
152900 EJECT                                                            DPKCS036
153000*----------------------------------------------------------------*DPKCS036
153100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *DPKCS036
153200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *DPKCS036
153300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *DPKCS036
153400*----------------------------------------------------------------*DPKCS036
153500 3500-MARK-RANGE-AS-SELECTED.                                     DPKCS036
153600                                                                  DPKCS036
153700     MOVE +1                       TO  ASC-BLK-SUB.               DPKCS036
153800     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
153900         VARYING ASC-ITEM-SUB                                     DPKCS036
154000         FROM 1 BY 1                                              DPKCS036
154100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
154200                                                                  DPKCS036
154300     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
154400     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
154500         VARYING ASC-ITEM-SUB                                     DPKCS036
154600         FROM 1 BY 1                                              DPKCS036
154700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
154800                                                                  DPKCS036
154900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
155000                                   TO  PV-LIST-ITEM-NUMBER.       DPKCS036
155100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
155200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         DPKCS036
155300               PC-ITEMS-PER-PANEL).                               DPKCS036
155400                                                                  DPKCS036
155500     MOVE ASC-START-OF-SELECTED-RANGE                             DPKCS036
155600                                   TO PV-START-OF-SELECTED-RANGE. DPKCS036
155700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            DPKCS036
155800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  DPKCS036
155900               PC-ITEMS-PER-PANEL).                               DPKCS036
156000                                                                  DPKCS036
156100     MOVE ASC-END-OF-SELECTED-RANGE                               DPKCS036
156200                                   TO  PV-END-OF-SELECTED-RANGE.  DPKCS036
156300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             DPKCS036
156400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    DPKCS036
156500               PC-ITEMS-PER-PANEL).                               DPKCS036
156600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             DPKCS036
156700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             DPKCS036
156800                                                                  DPKCS036
156900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    DPKCS036
157000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        DPKCS036
157100         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
157200         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
157300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
157400             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
157500                                                                  DPKCS036
157600         PERFORM                                                  DPKCS036
157700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      DPKCS036
157800                   PV-PREV-BLOCK-IN-ARRAY                         DPKCS036
157900             MOVE PV-FIRST-BLOCK-IN-RANGE                         DPKCS036
158000                                   TO PV-BLOCK-NUMBER             DPKCS036
158100             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
158200             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
158300                 VARYING ASC-ITEM-SUB                             DPKCS036
158400                 FROM 1 BY 1                                      DPKCS036
158500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
158600             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
158700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     DPKCS036
158800         END-PERFORM                                              DPKCS036
158900                                                                  DPKCS036
159000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
159100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
159200         PERFORM                                                  DPKCS036
159300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
159400                   PV-LAST-BLOCK-IN-RANGE                         DPKCS036
159500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
159600                                   TO PV-BLOCK-NUMBER             DPKCS036
159700             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
159800             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
159900                 VARYING ASC-ITEM-SUB                             DPKCS036
160000                 FROM 1 BY 1                                      DPKCS036
160100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
160200             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
160300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
160400         END-PERFORM                                              DPKCS036
160500                                                                  DPKCS036
160600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
160700                                   TO PV-BLOCK-NUMBER             DPKCS036
160800         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
160900     END-IF.                                                      DPKCS036
161000                                                                  DPKCS036
161100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE DPKCS036
161200                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
161300                                                                  DPKCS036
161400 EJECT                                                            DPKCS036
161500*----------------------------------------------------------------*DPKCS036
161600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *DPKCS036
161700*----------------------------------------------------------------*DPKCS036
161800 3510-MARK-SELECTED-INDS.                                         DPKCS036
161900                                                                  DPKCS036
162000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
162100                                ASC-ITEM-SUB) >                   DPKCS036
162200         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
162300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
162400                                ASC-ITEM-SUB) =                   DPKCS036
162500         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
162600                                                                  DPKCS036
162700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
162800                                    ASC-ITEM-SUB) <               DPKCS036
162900             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
163000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
163100                                    ASC-ITEM-SUB) =               DPKCS036
163200             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
163300                                                                  DPKCS036
163400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
163500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
163600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
163700                               TO TRUE                            DPKCS036
163800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              DPKCS036
163900                               TO TRUE                            DPKCS036
164000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
164100             END-IF                                               DPKCS036
164200         END-IF                                                   DPKCS036
164300     END-IF.                                                      DPKCS036
164400                                                                  DPKCS036
164500 EJECT                                                            DPKCS036
164600*----------------------------------------------------------------*DPKCS036
164700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
164800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
164900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
165000*    DISPLAY THE PANEL TO USER.                                  *DPKCS036
165100*----------------------------------------------------------------*DPKCS036
165200 4000-BUILD-INITIAL-PANEL.                                        DPKCS036
165300                                                                  DPKCS036
165400     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             DPKCS036
165500                                ASC-BLOCK-ENTRIES (2)             DPKCS036
165501                                ASC-TOT-UNITS                             
165502                                ASC-TOT-CARTONS                           
165510                                ASC-TOT-CBM.                              
165600     MOVE +1                 TO ASC-BLK-SUB.                      DPKCS036
165700     SET ASC-ITEMS-LEFT-ON-DB                                     DPKCS036
165800                             TO TRUE.                             DPKCS036
165900                                                                  DPKCS036
166000     MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
166100                                ASC-NUMBER-OF-ITEMS-READ          DPKCS036
166200                                ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
166300                                ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
166400                                ASC-START-OF-SELECTED-RANGE       DPKCS036
166500                                ASC-END-OF-SELECTED-RANGE         DPKCS036
166600                                ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
166700     PERFORM 4010-OPEN-CURSOR.                                    DPKCS036
166800                                                                  DPKCS036
166900     PERFORM 4300-READ-ITEMS-FROM-DB.                             DPKCS036
167000                                                                  DPKCS036
167100     PERFORM 4020-CLOSE-CURSOR.                                   DPKCS036
167200                                                                  DPKCS036
167300     MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
167400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
167500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
167600         SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
167700*------- PURCHASE ORDER DOES NOT EXIST -----                              
167800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
167900     ELSE                                                         DPKCS036
168000         MOVE -1               TO MR-SELECTL (1)                  DPKCS036
168100         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
168200                               TO TRUE                            DPKCS036
168300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
168400     END-IF.                                                      DPKCS036
168500                                                                  DPKCS036
168600 EJECT                                                            DPKCS036
168700*----------------------------------------------------------------*DPKCS036
168800*   OPEN THE VESSEL CURSOR                                       *DPKCS036
168900*----------------------------------------------------------------*DPKCS036
169000 4010-OPEN-CURSOR.                                                DPKCS036
169100                                                                  DPKCS036
169200     PERFORM                                                      DPKCS036
169300         WITH TEST AFTER                                          DPKCS036
169400         VARYING PV-RETRY-COUNTER                                 DPKCS036
169500         FROM 1 BY 1                                              DPKCS036
169600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               DPKCS036
169700             OR (SQLCODE = ZERO))                                 DPKCS036
169800                                                                  DPKCS036
169900         EVALUATE TRUE                                            DPKCS036
170000             WHEN ASC-CONTNR-CURSOR                               DPKCS036
170100                 MOVE 'CURSOR:  CONTNR-CSR'                       DPKCS036
170200                                   TO DP013-MESSAGE-TEXT (2)      DPKCS036
170300                 EXEC SQL                                         DPKCS036
170400                      OPEN CONTNR-CSR                             DPKCS036
170500                 END-EXEC                                         DPKCS036
170600                                                                  DPKCS036
170700             WHEN ASC-VSL-CONTNR-CURSOR                           DPKCS036
170800                 MOVE 'CURSOR:  VSL-CONTNR-CSR'                   DPKCS036
170900                                   TO DP013-MESSAGE-TEXT (2)      DPKCS036
171000                 EXEC SQL                                         DPKCS036
171100                      OPEN VSL-CONTNR-CSR                         DPKCS036
171200                 END-EXEC                                         DPKCS036
171300         END-EVALUATE                                             DPKCS036
171400*                                                                 DPKCS036
171500         EVALUATE TRUE                                            DPKCS036
171600             WHEN SQLCODE = ZERO                                  DPKCS036
171700             WHEN SQLCODE = -904                                  DPKCS036
171800             WHEN SQLCODE = -913                                  DPKCS036
171900                 CONTINUE                                         DPKCS036
172000             WHEN SQLWARN0 NOT = SPACES                           DPKCS036
172100             WHEN SQLCODE < ZERO                                  DPKCS036
172200             WHEN SQLCODE > ZERO                                  DPKCS036
172300                 MOVE '4010-OPEN-CURSOR'                          DPKCS036
172400                                   TO DP013-PARAGRAPH             DPKCS036
172500                 MOVE 'OPEN CONTAINER CURSOR - '                  DPKCS036
172600                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
172700                 MOVE SQLCA        TO DP013-SQLCA                 DPKCS036
172800                 MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)    DPKCS036
172900                 SET DP013-DB2-ABEND                              DPKCS036
173000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           DPKCS036
173100                 PERFORM DP013-0000-PROCESS-ABEND                 DPKCS036
173200         END-EVALUATE                                             DPKCS036
173300     END-PERFORM.                                                 DPKCS036
173400*                                                                 DPKCS036
173500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        DPKCS036
173600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             DPKCS036
173700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   DPKCS036
173800                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
173900         MOVE SQLCA                TO DP013-SQLCA                 DPKCS036
174000         MOVE 'TIMCNTK '           TO DP013-DB2-TABLE-NAME (1)    DPKCS036
174100         SET DP013-DB2-ABEND                                      DPKCS036
174200             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
174300                                   TO TRUE                        DPKCS036
174400         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
174500     END-IF.                                                      DPKCS036
174600                                                                  DPKCS036
174700 EJECT                                                            DPKCS036
174800*----------------------------------------------------------------*DPKCS036
174900*   CLOSE THE VESSEL CURSOR.                                     *DPKCS036
175000*----------------------------------------------------------------*DPKCS036
175100 4020-CLOSE-CURSOR.                                               DPKCS036
175200                                                                  DPKCS036
175300     EVALUATE TRUE                                                DPKCS036
175400         WHEN ASC-CONTNR-CURSOR                                   DPKCS036
175500             MOVE 'CURSOR:  CONTNR-CSR'                           DPKCS036
175600                                   TO DP013-MESSAGE-TEXT (2)      DPKCS036
175700             EXEC SQL                                             DPKCS036
175800                  CLOSE CONTNR-CSR                                DPKCS036
175900             END-EXEC                                             DPKCS036
176000                                                                  DPKCS036
176100             WHEN ASC-VSL-CONTNR-CURSOR                           DPKCS036
176200                 MOVE 'CURSOR:  VSL-CONTNR-CSR'                   DPKCS036
176300                                   TO DP013-MESSAGE-TEXT (2)      DPKCS036
176400                 EXEC SQL                                         DPKCS036
176500                     CLOSE VSL-CONTNR-CSR                         DPKCS036
176600                 END-EXEC                                         DPKCS036
176700     END-EVALUATE                                                 DPKCS036
176800*                                                                 DPKCS036
176900     EVALUATE TRUE                                                DPKCS036
177000         WHEN SQLCODE = ZERO                                      DPKCS036
177100             CONTINUE                                             DPKCS036
177200         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
177300         WHEN SQLCODE < ZERO                                      DPKCS036
177400         WHEN SQLCODE > ZERO                                      DPKCS036
177500             MOVE '4020-CLOSE-CURSOR'                             DPKCS036
177600                               TO DP013-PARAGRAPH                 DPKCS036
177700             MOVE 'CLOSE CONTNR CURSOR '                          DPKCS036
177800                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
177900             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
178000             MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
178100             SET DP013-DB2-ABEND                                  DPKCS036
178200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
178300             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
178400     END-EVALUATE.                                                DPKCS036
178500                                                                  DPKCS036
178600 EJECT                                                            DPKCS036
178700*----------------------------------------------------------------*DPKCS036
178800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *DPKCS036
178900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *DPKCS036
179000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *DPKCS036
179100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *DPKCS036
179200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *DPKCS036
179300*                                                                *DPKCS036
179400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *DPKCS036
179500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *DPKCS036
179600*    UPON INITIALIZATION.                                        *DPKCS036
179700*----------------------------------------------------------------*DPKCS036
179800 4300-READ-ITEMS-FROM-DB.                                         DPKCS036
179900                                                                  DPKCS036
180000     PERFORM                                                      DPKCS036
180100         VARYING PV-READ-COUNT                                    DPKCS036
180200         FROM 1 BY 1                                              DPKCS036
180300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    DPKCS036
180400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         DPKCS036
180500                                                                  DPKCS036
180600         PERFORM 4310-FETCH                                       DPKCS036
180700                                                                  DPKCS036
180800         IF  ASC-ITEMS-LEFT-ON-DB                                 DPKCS036
180900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
181000                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
181100             ELSE                                                 DPKCS036
181200                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
181300                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
181400                                                                  DPKCS036
181500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
181600                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
181700                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
181800                                   TO TRUE                        DPKCS036
181900                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
182000                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
182100                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
182200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
182300                     ADD +1        TO ASC-BLK-SUB                 DPKCS036
182400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
182500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
182600                                   TO  TRUE                       DPKCS036
182700                 END-IF                                           DPKCS036
182800             END-IF                                               DPKCS036
182900             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   DPKCS036
183000             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
183100                                   TO  ASC-LIST-ITEM-NUMBER       DPKCS036
183200                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
183300             MOVE PV-CONTNR-NBR                                   DPKCS036
183400                                   TO  ASC-CONTNR-NBR             DPKCS036
183500                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
183600             MOVE IMCNTK-MOM-IMPRT-VEH-NM (1:9)                   DPKCS036
183700                                   TO  ASC-VSL-NM                 DPKCS036
183800                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
183900             MOVE IMCNTK-MOM-IMPRT-TRIP-ID (1:6)                  DPKCS036
184000                                   TO  ASC-VOY-NO                 DPKCS036
184100                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
184200             MOVE IMCNTK-ORGN-SHPD-FR-CDE                         DPKCS036
184300                                   TO  PV-SHPMT-FROM-CDE          DPKCS036
184400             MOVE IMCNTK-ORGN-SHPD-TO-CDE                         DPKCS036
184500                                   TO  PV-SHPMT-TO-CDE            DPKCS036
184600             MOVE PV-SHPMT-TYPE    TO  ASC-SHPMT-TYPE             DPKCS036
184700                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
184800             MOVE PV-CONTNR-SEQ-NBR                               DPKCS036
184900                                   TO  ASC-CONTNR-SEQ-NBR         DPKCS036
185000                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
185100             PERFORM  4330-SELECT-CTN-UNT-CBM                             
185200             PERFORM  4340-FOB-CDE-CHECK                                  
185300             PERFORM  4350-POE-CDE-CHECK                                  
185400             PERFORM  4390-SELECT-PO-CNT                          DPKCS036
185500             MOVE PV-PO-COUNT      TO  ASC-PO-CNT                 DPKCS036
185600                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
185700         END-IF                                                   DPKCS036
185800     END-PERFORM.                                                 DPKCS036
185900                                                                  DPKCS036
186000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
186100         MOVE +1               TO ASC-BLK-SUB                     DPKCS036
186200         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
186300         ADD +1                TO ASC-BLK-SUB                     DPKCS036
186400         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
186500                                                                  DPKCS036
186600         MOVE 1                TO ASC-BLK-SUB                     DPKCS036
186700                                  PV-BLOCK-NUMBER                 DPKCS036
186800         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
186900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
187000             MOVE 2            TO ASC-BLK-SUB                     DPKCS036
187100                                  PV-BLOCK-NUMBER                 DPKCS036
187200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
187300         END-IF                                                   DPKCS036
187400     END-IF.                                                      DPKCS036
187500                                                                  DPKCS036
187600 EJECT                                                            DPKCS036
187700*----------------------------------------------------------------*DPKCS036
187800*    FETCH THE VESSEL CURSOR.                                    *DPKCS036
187900*----------------------------------------------------------------*DPKCS036
188000 4310-FETCH.                                                      DPKCS036
188100                                                                  DPKCS036
188200     EVALUATE TRUE                                                DPKCS036
188300         WHEN ASC-CONTNR-CURSOR                                   DPKCS036
188400              EXEC SQL                                            DPKCS036
188500                  FETCH CONTNR-CSR                                DPKCS036
188600                  INTO  :PV-CONTNR-NBR                            DPKCS036
188700                      , :IMCNTK-FDR-FOB-CDE                       DPKCS036
188800                      , :IMCNTK-MOM-FOB-CDE                       DPKCS036
188900                      , :IMCNTK-ORGN-SHPD-FR-CDE                  DPKCS036
189000                      , :IMCNTK-ORGN-SHPD-TO-CDE                  DPKCS036
189300                      , :IMCNTK-MOM-TRIP-TYP-CDE                  DPKCS036
189400                      , :IMCNTK-FDR-TRIP-TYP-CDE                  DPKCS036
189500                      , :IMCNTK-MOM-DEST-POE-CDE                  DPKCS036
189600                      , :IMCNTK-MOM-IMPRT-VEH-NM                  DPKCS036
189700                      , :IMCNTK-MOM-IMPRT-TRIP-ID                 DPKCS036
189800                      , :PV-CONTNR-SEQ-NBR                        DPKCS036
189900              END-EXEC                                            DPKCS036
190000                                                                  DPKCS036
190100         WHEN ASC-VSL-CONTNR-CURSOR                               DPKCS036
190200              EXEC SQL                                            DPKCS036
190300                  FETCH  VSL-CONTNR-CSR                           DPKCS036
190400                  INTO  :PV-CONTNR-NBR                            DPKCS036
190500                      , :IMCNTK-FDR-FOB-CDE                       DPKCS036
190600                      , :IMCNTK-MOM-FOB-CDE                       DPKCS036
190700                      , :IMCNTK-ORGN-SHPD-FR-CDE                  DPKCS036
190800                      , :IMCNTK-ORGN-SHPD-TO-CDE                  DPKCS036
191100                      , :IMCNTK-MOM-TRIP-TYP-CDE                  DPKCS036
191200                      , :IMCNTK-FDR-TRIP-TYP-CDE                  DPKCS036
191300                      , :IMCNTK-MOM-DEST-POE-CDE                  DPKCS036
191400                      , :IMCNTK-MOM-IMPRT-VEH-NM                  DPKCS036
191500                      , :IMCNTK-MOM-IMPRT-TRIP-ID                 DPKCS036
191600                      , :PV-CONTNR-SEQ-NBR                        DPKCS036
191700              END-EXEC                                            DPKCS036
191800     END-EVALUATE.                                                DPKCS036
191900*                                                                 DPKCS036
192000     EVALUATE TRUE                                                DPKCS036
192100         WHEN SQLCODE = ZERO                                      DPKCS036
192200         WHEN SQLCODE = +100                                      DPKCS036
192300              CONTINUE                                            DPKCS036
192400         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
192500         WHEN SQLCODE NOT = ZERO                                  DPKCS036
192600              MOVE '4310-FETCH-CURSOR'                            DPKCS036
192700                               TO DP013-PARAGRAPH                 DPKCS036
192800              MOVE 'FETCH CONTNR CURSOR'                          DPKCS036
192900                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
193000              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
193100              SET DP013-DB2-ABEND                                 DPKCS036
193200                               TO TRUE                            DPKCS036
193300              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
193400     END-EVALUATE.                                                DPKCS036
193500*                                                                 DPKCS036
193600     IF  SQLCODE EQUAL +100                                       DPKCS036
193700         SET ASC-NO-ITEMS-LEFT-ON-DB                              DPKCS036
193800                                   TO TRUE                        DPKCS036
193900     END-IF.                                                      DPKCS036
194000                                                                  DPKCS036
194100 EJECT                                                            DPKCS036
194200*----------------------------------------------------------------*DPKCS036
194300*    FORMAT THE DB2 DATE TO MM/DD/YY.                            *DPKCS036
194400*----------------------------------------------------------------*DPKCS036
194500 4320-FORMAT-DATE.                                                DPKCS036
194600                                                                  DPKCS036
194700     MOVE PV-DB-MM          TO  PV-DD-MM.                         DPKCS036
194800     MOVE PV-DB-DD          TO  PV-DD-DD.                         DPKCS036
194900     MOVE PV-DB-YY          TO  PV-DD-YY.                         DPKCS036
195000                                                                  DPKCS036
195100 EJECT                                                            DPKCS036
195200*----------------------------------------------------------------*DPKCS036
195300*    SELECT CARTONS, UNITS AND CBM'S OF PO IN CONTAINER          *DPKCS036
195400*----------------------------------------------------------------*DPKCS036
195500 4330-SELECT-CTN-UNT-CBM.                                         DPKCS036
195600                                                                  DPKCS036
195700     PERFORM                                                              
195800         WITH TEST AFTER                                                  
195900         VARYING PV-RETRY-COUNTER                                         
196000         FROM 1 BY 1                                                      
196100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
196200            OR  (SQLCODE = ZERO)                                          
196300            OR  (SQLCODE = +100))                                         
196400                                                                          
196500         EXEC SQL                                                         
196600              SELECT                                              DPKCS036
196700                      PO_CART_CNT                                 DPKCS036
196800                   ,  PO_UNT_QTY                                  DPKCS036
196900                   ,  PO_CBMT_QTY                                 DPKCS036
197000                INTO                                              DPKCS036
197100                     :IMCNPO-PO-CART-CNT                          DPKCS036
197200                   , :IMCNPO-PO-UNT-QTY                           DPKCS036
197300                   , :IMCNPO-PO-CBMT-QTY                          DPKCS036
197400                FROM                                              DPKCS036
197500                      TIMCNPO                                     DPKCS036
197600                WHERE                                             DPKCS036
197700                      CONTNR_ID      = :PV-CONTNR-NBR             DPKCS036
197800                AND   CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR         DPKCS036
197810                AND   PO_NBR         = :DK-PO-NBR                         
197900         END-EXEC                                                         
198000*                                                                         
198100         EVALUATE TRUE                                                    
198200             WHEN SQLCODE = ZERO                                          
198300             WHEN SQLCODE = +100                                          
198400             WHEN SQLCODE = -904                                          
198500             WHEN SQLCODE = -913                                          
198600                 CONTINUE                                                 
198700             WHEN SQLWARN0 NOT = SPACES                                   
198800             WHEN SQLCODE < ZERO                                          
198900             WHEN SQLCODE > ZERO                                          
199000                 MOVE '4330-SELECT-CTN-UNT-CBM'                           
199100                                   TO DP013-PARAGRAPH                     
199200                 MOVE 'SQL ERROR SELECTING PO COUNT DETAILS'              
199300                                   TO DP013-MESSAGE-TEXT (1)              
199400                 MOVE SQLCA        TO DP013-SQLCA                         
199500                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)            
199600                 SET DP013-DB2-ABEND                                      
199700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
199800                 PERFORM DP013-0000-PROCESS-ABEND                         
199900         END-EVALUATE                                                     
200000     END-PERFORM.                                                         
200100*                                                                         
200200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
200300         MOVE '4330-SELECT-CTN-UNT-CBM'   TO DP013-PARAGRAPH              
200400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO CO        
200500-             'UNT DETAILS'        TO DP013-MESSAGE-TEXT (1)              
200600         MOVE SQLCA                TO DP013-SQLCA                         
200700         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)            
200800         SET DP013-DB2-ABEND                                              
200900             DP013-XCTL-DISPLAY-RESTART                                   
201000                                   TO TRUE                                
201100         PERFORM DP013-0000-PROCESS-ABEND                                 
201200     END-IF.                                                              
201300*                                                                 DPKCS036
201400     IF  SQLCODE = +0                                             DPKCS036
201500         MOVE IMCNPO-PO-CART-CNT   TO   ASC-CTN                   DPKCS036
201600                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
201601         ADD IMCNPO-PO-CART-CNT    TO  ASC-TOT-CARTONS                  99
201602                                                                          
201700         MOVE IMCNPO-PO-UNT-QTY    TO   ASC-UNTS                  DPKCS036
201800                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
201810         ADD IMCNPO-PO-UNT-QTY     TO  ASC-TOT-UNITS                      
201820                                                                          
201900         MOVE IMCNPO-PO-CBMT-QTY   TO   ASC-CBM                   DPKCS036
202000                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
202010         ADD IMCNPO-PO-CBMT-QTY    TO  ASC-TOT-CBM                        
202100     END-IF.                                                      DPKCS036
202200                                                                  DPKCS036
202300 EJECT                                                            DPKCS036
202400*----------------------------------------------------------------*        
202500*   CHECK FOR TRIP-TYPE-CODE AND MOVE FOB CODE                   *        
202600*----------------------------------------------------------------*        
202700 4340-FOB-CDE-CHECK.                                                      
202800                                                                          
202900     EVALUATE TRUE                                                        
203000          WHEN  ((IMCNTK-FDR-TRIP-TYP-CDE  = 'A') OR                      
203100                (IMCNTK-MOM-TRIP-TYP-CDE  = 'A'))                         
203200                IF IMCNTK-FDR-FOB-CDE = SPACES                            
203300                   MOVE IMCNTK-MOM-FOB-CDE TO ASC-FOB                     
203400                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
203500                ELSE                                                      
203600                   MOVE IMCNTK-FDR-FOB-CDE TO ASC-FOB                     
203700                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
203800                END-IF                                                    
203900                                                                          
204000          WHEN  ((IMCNTK-FDR-TRIP-TYP-CDE  = 'O' OR 'M') OR               
204100                (IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M'))                  
204200                IF IMCNTK-FDR-FOB-CDE = SPACES                            
204300                   PERFORM 4360-SELECT-MOM-FOB-CDE                        
204400                ELSE                                                      
204500                   PERFORM 4370-SELECT-FDR-FOB-CDE                        
204600                END-IF                                                    
204700                MOVE IMFOB-FOB-CDE      TO ASC-FOB                        
204800                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
204900                                                                          
205000          WHEN  OTHER                                                     
205100                MOVE SPACES             TO ASC-FOB                        
205200                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
205300     END-EVALUATE.                                                        
205400                                                                          
205500 EJECT                                                                    
205600*----------------------------------------------------------------*        
205700*   CHECK FOR TRIP-TYPE-CODE AND MOVE POE CODE                   *        
205800*----------------------------------------------------------------*        
205900 4350-POE-CDE-CHECK.                                                      
206000                                                                          
206100     EVALUATE TRUE                                                        
206610          WHEN  IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M' OR 'A'              
206620                PERFORM 4380-OPEN-POE-CURSOR                              
206621                PERFORM 4384-FETCH-POE-CURSOR                             
206622                PERFORM 4382-CLOSE-POE-CURSOR                             
206630                MOVE IMPOE-POE-CDE      TO ASC-POE                        
206640                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
206650                                                                          
207200          WHEN  OTHER                                                     
207300                MOVE SPACES             TO ASC-POE                        
207400                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
207500     END-EVALUATE.                                                        
207600                                                                          
207700 EJECT                                                                    
207800*----------------------------------------------------------------*        
207900*      SELECT MOM FOB CODE FROM TIMFOB                           *        
208000*----------------------------------------------------------------*        
208100 4360-SELECT-MOM-FOB-CDE.                                                 
208200                                                                          
208300     EXEC SQL                                                             
208400         SELECT DISTINCT                                                  
208500                A.FOB_CDE                                                 
208600         INTO  :IMFOB-FOB-CDE                                             
208700         FROM   TIMFOB A                                                  
208800         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-MOM-FOB-CDE                   
208900           AND  A.STAT_CDE        = 'A'                                   
209000     END-EXEC.                                                            
209100*                                                                         
209200     EVALUATE TRUE                                                        
209300         WHEN SQLCODE = ZERO                                              
209400              CONTINUE                                                    
209500         WHEN SQLCODE = +100                                              
209600         WHEN SQLCODE = -811                                              
209700              MOVE SPACES      TO IMFOB-FOB-CDE                           
209800         WHEN SQLWARN0 NOT = SPACE                                        
209900         WHEN SQLCODE NOT = ZERO                                          
210000              MOVE '4360-SELECT-MOM-FOB-CDE'                              
210100                               TO DP013-PARAGRAPH                         
210200              MOVE 'SQL ERROR SELECTING MOM FOB CODE'                     
210300                               TO DP013-MESSAGE-TEXT (1)                  
210400              MOVE SQLCA       TO DP013-SQLCA                             
210500              SET DP013-DB2-ABEND                                         
210600                               TO TRUE                                    
210700              PERFORM DP013-0000-PROCESS-ABEND                            
210800     END-EVALUATE.                                                        
210900                                                                          
211000 EJECT                                                                    
211100*----------------------------------------------------------------*        
211200*      SELECT FDR FOB CODE FROM TIMFOB                           *        
211300*----------------------------------------------------------------*        
211400 4370-SELECT-FDR-FOB-CDE.                                                 
211500                                                                          
211600     EXEC SQL                                                             
211700         SELECT DISTINCT                                                  
211800                A.FOB_CDE                                                 
211900         INTO  :IMFOB-FOB-CDE                                             
212000         FROM   TIMFOB A                                                  
212100         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-FDR-FOB-CDE                   
212200           AND  A.STAT_CDE        = 'A'                                   
212300     END-EXEC.                                                            
212400*                                                                         
212500     EVALUATE TRUE                                                        
212600         WHEN SQLCODE = ZERO                                              
212700              CONTINUE                                                    
212800         WHEN SQLCODE = +100                                              
212900         WHEN SQLCODE = -811                                              
213000              MOVE SPACES      TO IMFOB-FOB-CDE                           
213100         WHEN SQLWARN0 NOT = SPACE                                        
213200         WHEN SQLCODE NOT = ZERO                                          
213300              MOVE '4370-SELECT-FDR-FOB-CDE'                              
213400                               TO DP013-PARAGRAPH                         
213500              MOVE 'SQL ERROR SELECTING FDR FOB CODE'                     
213600                               TO DP013-MESSAGE-TEXT (1)                  
213700              MOVE SQLCA       TO DP013-SQLCA                             
213800              SET DP013-DB2-ABEND                                         
213900                               TO TRUE                                    
214000              PERFORM DP013-0000-PROCESS-ABEND                            
214100     END-EVALUATE.                                                        
214200                                                                          
214300 EJECT                                                                    
217410*----------------------------------------------------------------*        
217420*   OPEN THE POE CODE CURSOR                                     *        
217430*----------------------------------------------------------------*        
217434 4380-OPEN-POE-CURSOR.                                                    
217435                                                                          
217436     PERFORM                                                              
217437         WITH TEST AFTER                                                  
217438         VARYING PV-RETRY-COUNTER                                         
217439         FROM 1 BY 1                                                      
217440         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
217441                   OR (SQLCODE = ZERO))                                   
217442                                                                          
217443         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)            
217444                                                                          
217445         EXEC SQL                                                         
217446              OPEN POE-CSR                                                
217447         END-EXEC                                                         
217448                                                                          
217449         EVALUATE TRUE                                                    
217450             WHEN SQLCODE = ZERO                                          
217451             WHEN SQLCODE = -904                                          
217452             WHEN SQLCODE = -913                                          
217453                 CONTINUE                                                 
217454             WHEN SQLWARN0 NOT = SPACES                                   
217455             WHEN SQLCODE < ZERO                                          
217456             WHEN SQLCODE > ZERO                                          
217457                 MOVE '4380-OPEN-POE-CURSOR'                              
217458                                   TO DP013-PARAGRAPH                     
217459                 MOVE 'OPEN POE CURSOR - '                                
217460                                   TO DP013-MESSAGE-TEXT (1)              
217461                 MOVE SQLCA        TO DP013-SQLCA                         
217462                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
217463                 SET DP013-DB2-ABEND                                      
217464                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
217465                 PERFORM DP013-0000-PROCESS-ABEND                         
217466         END-EVALUATE                                                     
217467     END-PERFORM.                                                         
217468*                                                                         
217469     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
217470         MOVE '4382-OPEN-POE-CURSOR' TO DP013-PARAGRAPH                   
217471         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
217472                                   TO DP013-MESSAGE-TEXT (1)              
217473         MOVE SQLCA                TO DP013-SQLCA                         
217474         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)            
217475         SET DP013-DB2-ABEND                                              
217476             DP013-XCTL-DISPLAY-RESTART                                   
217477                                   TO TRUE                                
217478         PERFORM DP013-0000-PROCESS-ABEND                                 
217479     END-IF.                                                              
217480                                                                          
217481 EJECT                                                                    
217482*----------------------------------------------------------------*        
217483*   CLOSE THE POE CODE CURSOR                                    *        
217484*----------------------------------------------------------------*        
217485 4382-CLOSE-POE-CURSOR.                                                   
217486                                                                          
217487     EXEC SQL                                                             
217488          CLOSE POE-CSR                                                   
217489     END-EXEC.                                                            
217490                                                                          
217491     EVALUATE TRUE                                                        
217492         WHEN SQLCODE = ZERO                                              
217493             CONTINUE                                                     
217494         WHEN SQLWARN0 NOT = SPACES                                       
217495         WHEN SQLCODE < ZERO                                              
217496         WHEN SQLCODE > ZERO                                              
217497             MOVE '4382-CLOSE-POE-CURSOR'                                 
217498                               TO DP013-PARAGRAPH                         
217499             MOVE 'CLOSE POE CURSOR '                                     
217500                               TO DP013-MESSAGE-TEXT (1)                  
217501             MOVE SQLCA        TO DP013-SQLCA                             
217502             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
217503             SET DP013-DB2-ABEND                                          
217504                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
217505             PERFORM DP013-0000-PROCESS-ABEND                             
217506     END-EVALUATE.                                                        
217507                                                                          
217508 EJECT                                                                    
217509*----------------------------------------------------------------*11340099
217510*    FETCH THE POE CODE CURSOR                                   *11350099
217511*----------------------------------------------------------------*11360099
217512 4384-FETCH-POE-CURSOR.                                           11370099
217513                                                                  11380099
217514     EXEC SQL                                                     11390099
217515          FETCH POE-CSR                                           11400099
217516          INTO  :IMPOE-POE-CDE                                    11410099
217519     END-EXEC.                                                    11520099
217520                                                                  11530099
217521     EVALUATE TRUE                                                11540099
217522         WHEN SQLCODE = ZERO                                      11550099
217524         WHEN SQLCODE = -811                                              
217525              CONTINUE                                            11570099
217526         WHEN SQLCODE = +100                                      11560099
217527              MOVE SPACES TO IMPOE-POE-CDE                                
217528         WHEN SQLWARN0 NOT = SPACE                                11580099
217529         WHEN SQLCODE NOT = ZERO                                  11590099
217530              MOVE '4384-FETCH-POE-CURSOR'                        11600099
217531                               TO DP013-PARAGRAPH                 11610099
217532              MOVE 'FETCH POE CURSOR'                             11620099
217533                               TO DP013-MESSAGE-TEXT (1)          11630099
217534              MOVE SQLCA       TO DP013-SQLCA                     11640099
217535              SET DP013-DB2-ABEND                                 11650099
217536                               TO TRUE                            11660099
217537              PERFORM DP013-0000-PROCESS-ABEND                    11670099
217538     END-EVALUATE.                                                11680099
217539                                                                  11690099
217550 EJECT                                                            11750099
217606*----------------------------------------------------------------*DPKCS036
217610* SELECT PO COUNT IN THE CONTAINER  FOR THE REQUESTED VSL/VOY    *DPKCS036
217700*----------------------------------------------------------------*DPKCS036
217800 4390-SELECT-PO-CNT.                                              DPKCS036
217900                                                                  DPKCS036
218000     EXEC SQL                                                     DPKCS036
218100         SELECT                                                   DPKCS036
218200                COUNT (DISTINCT  PO_NBR)                          DPKCS036
218300         INTO  :PV-PO-COUNT                                       DPKCS036
218400         FROM   TIMCNPO                                           DPKCS036
218500         WHERE  CONTNR_ID      = :PV-CONTNR-NBR                   DPKCS036
218600           AND  CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR               DPKCS036
218700     END-EXEC.                                                    DPKCS036
218800*                                                                 DPKCS036
218900     EVALUATE TRUE                                                DPKCS036
219000         WHEN SQLCODE = ZERO                                      DPKCS036
219100         WHEN SQLCODE = +100                                      DPKCS036
219200              CONTINUE                                            DPKCS036
219300         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
219400         WHEN SQLCODE NOT = ZERO                                  DPKCS036
219500              MOVE '4390-SELECT-PO-COUNT'                         DPKCS036
219600                               TO DP013-PARAGRAPH                 DPKCS036
219700              MOVE 'SQL ERROR SELECTING PO COUNT'                 DPKCS036
219800                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
219900              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
220000              SET DP013-DB2-ABEND                                 DPKCS036
220100                               TO TRUE                            DPKCS036
220200              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
220300     END-EVALUATE.                                                DPKCS036
220400                                                                  DPKCS036
220500 EJECT                                                            DPKCS036
220600*----------------------------------------------------------------*DPKCS036
220700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *DPKCS036
220800*----------------------------------------------------------------*DPKCS036
220900 4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
221000                                                                  DPKCS036
221100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
221200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
221300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
221400             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
221500             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
221600             ADD +1     TO ASC-BLK-SUB                            DPKCS036
221700             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
221800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
221900                 GIVING PV-BLOCK-NUMBER                           DPKCS036
222000                 REMAINDER PV-REMAINDER                           DPKCS036
222100             IF  PV-REMAINDER > ZERO                              DPKCS036
222200                 ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
222300             END-IF                                               DPKCS036
222400             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
222500             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
222600             ADD +1     TO ASC-BLK-SUB                            DPKCS036
222700                           PV-BLOCK-NUMBER                        DPKCS036
222800             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
222900     END-IF.                                                      DPKCS036
223000     MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
223100     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
223200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
223300         + PC-ITEMS-PER-PANEL).                                   DPKCS036
223400*                                                                 DPKCS036
223500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
223600         ADD +1         TO ASC-BLK-SUB                            DPKCS036
223700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
223800     END-IF.                                                      DPKCS036
223900*                                                                 DPKCS036
224000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
224100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
224200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
224300     PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
224400         VARYING PV-SUB                                           DPKCS036
224500         FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
224600         UNTIL PV-SUB < +1.                                       DPKCS036
224700*                                                                 DPKCS036
224800     COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
224900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
225000     PERFORM 4401-SELECT-PO-DETAILS.                              DPKCS036
225100     PERFORM 4402-SELECT-AD-DTE.                                          
225210     PERFORM 4403-SELECT-VND-STYL.                                        
225300     PERFORM 4404-OPEN-OUTR-PCK-CSR.                                      
225400     PERFORM 4405-FETCH-OUTR-PCK.                                         
225500     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                                     
225600     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            DPKCS036
225700*                                                                 DPKCS036
225800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
225900                                      ASTRTITO.                   DPKCS036
226000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    DPKCS036
226100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    DPKCS036
226200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
226300                                   TO ASELITO.                    DPKCS036
226400*                                                                 DPKCS036
226500     IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
226600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
226700*----------- MORE ITEMS TO DISPLAY --------                       DPKCS036
226800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
226900             SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
227000         END-IF                                                   DPKCS036
227100     END-IF.                                                      DPKCS036
227200                                                                  DPKCS036
227300 EJECT                                                            DPKCS036
227400*----------------------------------------------------------------*DPKCS036
227500*    SELECT PO DETAILS.                                          *DPKCS036
227600*----------------------------------------------------------------*DPKCS036
227700 4401-SELECT-PO-DETAILS.                                          DPKCS036
227800                                                                  DPKCS036
227900     PERFORM                                                              
228000         WITH TEST AFTER                                                  
228100         VARYING PV-RETRY-COUNTER                                         
228200         FROM 1 BY 1                                                      
228300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
228400            OR  (SQLCODE = ZERO)                                          
228500            OR  (SQLCODE = +100))                                         
228600                                                                          
228700         EXEC SQL                                                         
228800              SELECT A.DEPT_NBR,                                          
228900                     A.OTB_PER_NBR,                                       
229000                     A.TOT_UNT_QTY,                                       
229010                     A.PROD_CNTRY_CDE,                                    
229100                     B.ENT_NAME_DESC,                                     
229200                     C.CAN_IFNOT_SHIP_DTE,                                
229300                     C.EXT_CAN_DTE,                                       
229400                     C.STRT_FCTRY_DTE,                                    
229500                     C.LAST_FCTRY_DTE,                                    
229600                     C.DONT_SHIP_BEF_DTE,                                 
229700                     C.FOB_CDE,                                           
229800                     C.POE_CDE                                            
229900              INTO  :PURCHS-DEPT-NBR,                                     
230000                    :PURCHS-OTB-PER-NBR,                                  
230100                    :PURCHS-TOT-UNT-QTY,                                  
230110                    :PURCHS-PROD-CNTRY-CDE,                               
230200                    :ENTNME-ENT-NAME-DESC,                                
230300                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                           
230400                    :PLNSHP-EXT-CAN-DTE,                                  
230500                    :PLNSHP-STRT-FCTRY-DTE,                               
230600                    :PLNSHP-LAST-FCTRY-DTE,                               
230700                    :PLNSHP-DONT-SHIP-BEF-DTE,                            
230800                    :PLNSHP-FOB-CDE,                                      
230900                    :PLNSHP-POE-CDE                                       
231000              FROM   TPURCHS A,                                           
231100                     TENTNME B,                                           
231200                     TPLNSHP C                                            
231300              WHERE  A.PO_NBR         = :DK-PO-NBR                        
231400                AND  A.VER_STATUS_CDE = 'A'                               
231500                AND  B.ENT_ID         =  A.ENT_ID                         
231600                AND  B.TYPE_CDE       = '01'                              
231700                AND  C.PO_NBR         =  A.PO_NBR                         
231800                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE                 
231900         END-EXEC                                                         
232000*                                                                         
232100         EVALUATE TRUE                                                    
232200             WHEN SQLCODE = ZERO                                          
232300             WHEN SQLCODE = +100                                          
232400             WHEN SQLCODE = -904                                          
232500             WHEN SQLCODE = -913                                          
232600                 CONTINUE                                                 
232700             WHEN SQLWARN0 NOT = SPACES                                   
232800             WHEN SQLCODE < ZERO                                          
232900             WHEN SQLCODE > ZERO                                          
233000                 MOVE '4401-SELECT-PO-DETAILS'                            
233100                                   TO DP013-PARAGRAPH                     
233200                 MOVE 'SQL ERROR SELECTING PO DETAILS'                    
233300                                   TO DP013-MESSAGE-TEXT (1)              
233400                 MOVE SQLCA        TO DP013-SQLCA                         
233500                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            
233600                 SET DP013-DB2-ABEND                                      
233700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
233800                 PERFORM DP013-0000-PROCESS-ABEND                         
233900         END-EVALUATE                                                     
234000     END-PERFORM.                                                         
234100*                                                                         
234200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
234300         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH              
234400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'          
234500                                   TO DP013-MESSAGE-TEXT (1)              
234600         MOVE SQLCA                TO DP013-SQLCA                         
234700         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)            
234800         SET DP013-DB2-ABEND                                              
234900             DP013-XCTL-DISPLAY-RESTART                                   
235000                                   TO TRUE                                
235100         PERFORM DP013-0000-PROCESS-ABEND                                 
235200     END-IF.                                                              
235300                                                                  DPKCS036
235400 EJECT                                                            DPKCS036
235500*----------------------------------------------------------------*        
235600*     SELECT AD-DTE FROM TPURITM                                 *        
235700*----------------------------------------------------------------*        
235800 4402-SELECT-AD-DTE.                                                      
235900                                                                          
236000     PERFORM                                                              
236100         WITH TEST AFTER                                                  
236200         VARYING PV-RETRY-COUNTER                                         
236300         FROM 1 BY 1                                                      
236400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
236500         OR     (SQLCODE = ZERO)                                          
236600         OR     (SQLCODE = +100))                                         
236700                                                                          
236800         EXEC SQL                                                         
236900              SELECT                                                      
237000                     MIN(AD_EVNT_DTE)                                     
237100              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND                    
237200              FROM   TPURITM                                              
237300              WHERE  PO_NBR         = :DK-PO-NBR                          
237400              AND    VER_STATUS_CDE = 'A'                                 
237500              AND    AD_EVNT_DTE   ^= '0001-01-01'                        
237600         END-EXEC                                                         
237700*                                                                         
237800         EVALUATE TRUE                                                    
237900             WHEN SQLCODE = ZERO                                          
238000             WHEN SQLCODE = +100                                          
238100             WHEN SQLCODE = -904                                          
238200             WHEN SQLCODE = -913                                          
238300                  CONTINUE                                                
238400             WHEN SQLWARN0 NOT = SPACE                                    
238500             WHEN SQLCODE NOT = ZERO                                      
238600                  MOVE '4402-SELECT-AD-DTE'                               
238700                                   TO DP013-PARAGRAPH                     
238800                  MOVE 'SQL ERROR SELECTING AD DATE'                      
238900                                   TO DP013-MESSAGE-TEXT (1)              
239000                  MOVE SQLCA       TO DP013-SQLCA                         
239100                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)            
239200                  SET DP013-DB2-ABEND                                     
239300                      DP013-XCTL-DISPLAY-RESTART TO TRUE                  
239400                  PERFORM DP013-0000-PROCESS-ABEND                        
239500         END-EVALUATE                                                     
239600     END-PERFORM.                                                         
239700*                                                                         
239800     IF SQLCODE EQUAL + 0                                                 
239900        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK                       
240000        PERFORM 4320-FORMAT-DATE                                          
240100        MOVE PV-DATE-DISPLAY       TO AADDTO                              
240200     ELSE                                                                 
240300        MOVE SPACES                TO AADDTO                              
240400     END-IF.                                                              
240500*                                                                         
240600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
240700         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH                     
240800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA        
240900-             'TE'                 TO DP013-MESSAGE-TEXT (1)              
241000         MOVE SQLCA                TO DP013-SQLCA                         
241100         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)            
241200         SET DP013-DB2-ABEND                                              
241300             DP013-XCTL-DISPLAY-RESTART                                   
241400                                   TO TRUE                                
241500         PERFORM DP013-0000-PROCESS-ABEND                                 
241600     END-IF.                                                              
241700                                                                          
241800 EJECT                                                                    
248310*----------------------------------------------------------------*        
248320*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *        
248330*----------------------------------------------------------------*        
248340 4403-SELECT-VND-STYL.                                                    
248350                                                                          
248360     PERFORM                                                              
248370         WITH TEST AFTER                                                  
248380         VARYING PV-RETRY-COUNTER                                         
248390         FROM 1 BY 1                                                      
248391         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
248392            OR  (SQLCODE = ZERO)                                          
248393            OR  (SQLCODE = +100)                                          
248394            OR  (SQLCODE = -811))                                         
248395                                                                          
248404         EXEC SQL                                                         
248405              SELECT   DISTINCT                                           
248406                       VS_NBR                                             
248407                INTO   :XLT00004-VS-NBR                                   
248408                FROM   TPURITM A                                          
248409                   ,   XLT_SKU B                                          
248410                   ,   XLT_VND_STYL C                                     
248411               WHERE   A.PO_NBR       = :DK-PO-NBR                        
248412                 AND   A.VER_STATUS_CDE = 'A'                             
248414                 AND   A.ITM_NBR = B.ITM_NBR                              
248415                 AND   B.STYL_ID = C.STYL_ID                              
248416         END-EXEC                                                         
248417                                                                          
248418         EVALUATE TRUE                                                    
248419             WHEN SQLCODE = ZERO                                          
248420             WHEN SQLCODE = +100                                          
248421             WHEN SQLCODE = -811                                          
248422             WHEN SQLCODE = -904                                          
248423             WHEN SQLCODE = -913                                          
248424                 CONTINUE                                                 
248425             WHEN SQLWARN0 NOT = SPACES                                   
248426             WHEN SQLCODE < ZERO                                          
248427             WHEN SQLCODE > ZERO                                          
248428                 MOVE '4403-SELECT-VND-STYL'                              
248429                                     TO DP013-PARAGRAPH                   
248430                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'                  
248431                                     TO DP013-MESSAGE-TEXT (1)            
248432                 MOVE SQLCA          TO DP013-SQLCA                       
248433                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)          
248434                 SET DP013-DB2-ABEND                                      
248435                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
248436                 PERFORM DP013-0000-PROCESS-ABEND                         
248437         END-EVALUATE                                                     
248438     END-PERFORM.                                                         
248439*                                                                         
248440     IF  SQLCODE EQUAL +0                                                 
248442         MOVE XLT00004-VS-NBR       TO AVNDSTYO                           
248443     ELSE                                                                 
248444         IF  SQLCODE EQUAL -811                                           
248445             MOVE '*MULTIPLES*'     TO AVNDSTYO                           
248446         END-IF                                                           
248447     END-IF.                                                              
248448*                                                                         
248449     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
248450         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH                
248451         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO        
248452-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)              
248453         MOVE SQLCA                TO DP013-SQLCA                         
248454         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)            
248455         SET DP013-DB2-ABEND                                              
248456             DP013-XCTL-DISPLAY-RESTART                                   
248457                                   TO TRUE                                
248458         PERFORM DP013-0000-PROCESS-ABEND                                 
248459     END-IF.                                                              
248460                                                                  DPKCS036
248461 EJECT                                                            DPKCS036
248470*----------------------------------------------------------------*        
248500*     OPEN THE OUTER PACK CURSOR                                 *        
248600*----------------------------------------------------------------*        
248700 4404-OPEN-OUTR-PCK-CSR.                                                  
248800                                                                  DPKCS036
248900     PERFORM                                                              
249000         WITH TEST AFTER                                                  
249100         VARYING PV-RETRY-COUNTER                                         
249200         FROM 1 BY 1                                                      
249300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
249400            OR  (SQLCODE = ZERO))                                         
249500                                                                          
249600         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)           
249700                                                                          
249800         EXEC SQL                                                         
249900              OPEN OUTR-PCK-CSR                                           
250000         END-EXEC                                                         
250100*                                                                         
250200         EVALUATE TRUE                                                    
250300             WHEN SQLCODE = ZERO                                          
250400             WHEN SQLCODE = -904                                          
250500             WHEN SQLCODE = -913                                          
250600                 CONTINUE                                                 
250700             WHEN SQLWARN0 NOT = SPACES                                   
250800             WHEN SQLCODE < ZERO                                          
250900             WHEN SQLCODE > ZERO                                          
251000                 MOVE '4404-OPEN-OUTR-PCK-CSR'                            
251100                                   TO DP013-PARAGRAPH                     
251200                 MOVE 'OPEN OUTER-PACK CURSOR - '                         
251300                                   TO DP013-MESSAGE-TEXT (1)              
251400                 MOVE SQLCA        TO DP013-SQLCA                         
251500                 MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)            
251600                 SET DP013-DB2-ABEND                                      
251700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
251800                 PERFORM DP013-0000-PROCESS-ABEND                         
251900         END-EVALUATE                                                     
252000     END-PERFORM.                                                         
252100*                                                                         
252200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
252300         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH               
252400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
252500                                   TO DP013-MESSAGE-TEXT (1)              
252600         MOVE SQLCA                TO DP013-SQLCA                         
252700         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)            
252800         SET DP013-DB2-ABEND                                              
252900             DP013-XCTL-DISPLAY-RESTART                                   
253000                                   TO TRUE                                
253100         PERFORM DP013-0000-PROCESS-ABEND                                 
253200     END-IF.                                                              
253300                                                                          
253400 EJECT                                                                    
253500*----------------------------------------------------------------*        
253600*     FETCH THE OUTER PACK QUANTITY                              *        
253700*----------------------------------------------------------------*        
253800 4405-FETCH-OUTR-PCK.                                                     
253900                                                                          
254000     PERFORM                                                              
254100         WITH TEST AFTER                                                  
254200         VARYING PV-RETRY-COUNTER                                         
254300         FROM 1 BY 1                                                      
254400         UNTIL (SQLCODE = +100)                                           
254500                                                                          
254501         EXEC SQL                                                 07910099
254502              FETCH OUTR-PCK-CSR                                  07920099
254503              INTO  :PURITM-UNT-QTY                               07940099
254504                 ,  :PURITM-OUTR-PK-QTY                           07930099
254505         END-EXEC                                                 07950099
255100*                                                                         
255200         EVALUATE TRUE                                                    
255300             WHEN SQLCODE = ZERO                                          
255400             WHEN SQLCODE = +100                                          
255500                  CONTINUE                                                
255600             WHEN SQLWARN0 NOT = SPACE                                    
255700             WHEN SQLCODE NOT = ZERO                                      
255800                  MOVE '4405-FETCH-OUTR-PCK'                              
255900                                   TO DP013-PARAGRAPH                     
256000                  MOVE 'FETCH OUTER-PACK CURSOR'                          
256100                                   TO DP013-MESSAGE-TEXT (1)              
256200                  MOVE SQLCA       TO DP013-SQLCA                         
256300                  SET DP013-DB2-ABEND                                     
256400                                   TO TRUE                                
256500                  PERFORM DP013-0000-PROCESS-ABEND                        
256600         END-EVALUATE                                                     
256700*                                                                         
256800         IF  SQLCODE EQUAL +0                                             
256900             IF PURITM-OUTR-PK-QTY = 0                                    
257000                DIVIDE 1 INTO PURITM-UNT-QTY                              
257100                GIVING PV-ITEM-CART-CNT ROUNDED                           
257200             ELSE                                                         
257300                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY             
257400                GIVING PV-ITEM-CART-CNT ROUNDED                           
257500             END-IF                                                       
257600             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT                       
257700         END-IF                                                           
257800     END-PERFORM.                                                         
257900                                                                          
258000 EJECT                                                                    
258100*----------------------------------------------------------------*        
258200*     CLOSE THE OUTER PACK CURSOR                                *        
258300*----------------------------------------------------------------*        
258400 4406-CLOSE-OUTR-PCK-CSR.                                                 
258500                                                                          
258600     EXEC SQL                                                             
258700          CLOSE OUTR-PCK-CSR                                              
258800     END-EXEC.                                                            
258900*                                                                         
259000     EVALUATE TRUE                                                        
259100         WHEN SQLCODE = ZERO                                              
259200             CONTINUE                                                     
259300         WHEN SQLWARN0 NOT = SPACES                                       
259400         WHEN SQLCODE < ZERO                                              
259500         WHEN SQLCODE > ZERO                                              
259600             MOVE '4406-CLOSE-OUTR-PCK-CSR'                               
259700                               TO DP013-PARAGRAPH                         
259800             MOVE 'CLOSE OUTER-PACK CURSOR '                              
259900                               TO DP013-MESSAGE-TEXT (1)                  
260000             MOVE SQLCA        TO DP013-SQLCA                             
260100             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)                
260200             SET DP013-DB2-ABEND                                          
260300                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
260400             PERFORM DP013-0000-PROCESS-ABEND                             
260500     END-EVALUATE.                                                        
260600                                                                          
260700 EJECT                                                                    
260800*----------------------------------------------------------------*DPKCS036
260900*    MOVE PO DETAILS TO SCREEN.                                  *DPKCS036
261000*----------------------------------------------------------------*DPKCS036
261100 4407-MOVE-PO-DTLS-TO-SCR.                                        DPKCS036
261200                                                                          
261300     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   DPKCS036
261400     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.                     
261410     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    DPKCS036
261500     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     DPKCS036
261600     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    DPKCS036
261610     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                           
261700     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  DPKCS036
261800     MOVE PLNSHP-FOB-CDE            TO AFOBPO.                    DPKCS036
261900     MOVE PLNSHP-POE-CDE            TO APOEO.                     DPKCS036
262000     MOVE PV-PO-CART-CNT            TO ACTNSO.                            
262001     MOVE ASC-TOT-CARTONS           TO ATOTCNTO.                  16620099
262002     MOVE ASC-TOT-UNITS             TO ATOTUNTO.                  16620099
262010     MOVE ASC-TOT-CBM               TO ATOTCBMO.                  16620099
262100*                                                                         
262200     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE                       
262300        MOVE SPACES                 TO ACANDTO                            
262400     ELSE                                                                 
262500        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                                    
262600                                    TO PV-DATE-BREAK                      
262700        PERFORM 4320-FORMAT-DATE                                          
262800        MOVE PV-DATE-DISPLAY        TO ACANDTO                            
262900     END-IF.                                                              
263000*                                                                         
263100     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE                       
263200        MOVE SPACES                 TO AXCANDTO                           
263300     ELSE                                                                 
263400        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK                      
263500        PERFORM 4320-FORMAT-DATE                                          
263600        MOVE PV-DATE-DISPLAY        TO AXCANDTO                           
263700     END-IF.                                                              
263800*                                                                         
263900     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE                       
264000        MOVE SPACES                 TO ASTXFDTO                           
264100     ELSE                                                                 
264200        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK                      
264300        PERFORM 4320-FORMAT-DATE                                          
264400        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                           
264500     END-IF.                                                              
264600*                                                                         
264700     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE                       
264800        MOVE SPACES                 TO ALTXFDTO                           
264900     ELSE                                                                 
265000        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK                      
265100        PERFORM 4320-FORMAT-DATE                                          
265200        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                           
265300     END-IF.                                                              
265400*                                                                         
265500     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE                       
265600        MOVE SPACES                 TO ADSHBEFO                           
265700     ELSE                                                                 
265800        MOVE PLNSHP-DONT-SHIP-BEF-DTE                                     
265900                                    TO PV-DATE-BREAK                      
266000        PERFORM 4320-FORMAT-DATE                                          
266100        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                           
266200     END-IF.                                                              
266300                                                                          
266400 EJECT                                                                    
266500*----------------------------------------------------------------*DPKCS036
266600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
266700*----------------------------------------------------------------*DPKCS036
266800 4410-READ-TEMP-STORAGE.                                          DPKCS036
266900                                                                  DPKCS036
267000     EXEC CICS                                                    DPKCS036
267100         READQ TS                                                 DPKCS036
267200             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
267300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
267400             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
267500             RESP  (PV-CICS-RESP)                                 DPKCS036
267600     END-EXEC.                                                    DPKCS036
267700*                                                                 DPKCS036
267800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
267900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
268000         CONTINUE                                                 DPKCS036
268100     ELSE                                                         DPKCS036
268200         SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
268300         SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
268400         MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
268500                                  TO DP013-PARAGRAPH              DPKCS036
268600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
268700                                  TO DP013-MESSAGE-TEXT(1)        DPKCS036
268800         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
268900     END-IF.                                                      DPKCS036
269000*                                                                 DPKCS036
269100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
269200*                                                                 DPKCS036
269300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
269400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
269500     END-IF.                                                      DPKCS036
269600                                                                  DPKCS036
269700 EJECT                                                            DPKCS036
269800*----------------------------------------------------------------*DPKCS036
269900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
270000*----------------------------------------------------------------*DPKCS036
270100 4420-FORMAT-LIST-LINES.                                          DPKCS036
270200                                                                  DPKCS036
270300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
270400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
270500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        DPKCS036
270600         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        DPKCS036
270700         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        DPKCS036
270800                                    MR-ACTION     (PV-SUB)        DPKCS036
270900                                    MR-CONTNR-NBR (PV-SUB)        DPKCS036
271000                                    MR-CTN-X      (PV-SUB)        DPKCS036
271100                                    MR-UNTS-X     (PV-SUB)        DPKCS036
271200                                    MR-CBM-X      (PV-SUB)        DPKCS036
271300                                    MR-TYPE       (PV-SUB)        DPKCS036
271400                                    MR-FOB        (PV-SUB)        DPKCS036
271500                                    MR-POE        (PV-SUB)        DPKCS036
271600                                    MR-VSL-NM     (PV-SUB)        DPKCS036
271700                                    MR-VOY-NO     (PV-SUB)        DPKCS036
271800                                    MR-PO-CNT-X   (PV-SUB)        DPKCS036
271900     ELSE                                                         DPKCS036
272000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
272100                                                   > SPACE        DPKCS036
272200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
272300                                 TO MR-SELECTI (PV-SUB)           DPKCS036
272400         ELSE                                                     DPKCS036
272500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
272600                                 TO MR-SELECTI (PV-SUB)           DPKCS036
272700         END-IF                                                   DPKCS036
272800*                                                                 DPKCS036
272900         IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
273000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
273100                 > SPACE)                                         DPKCS036
273200               OR (PV-SUB = 1))                                   DPKCS036
273300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
273400                MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
273500             END-IF                                               DPKCS036
273600         END-IF                                                   DPKCS036
273700*                                                                 DPKCS036
273800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
273900             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
274000                               TO MR-ACTION (PV-SUB)              DPKCS036
274100             MOVE ASC-CONTNR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
274200                               TO MR-CONTNR-NBR (PV-SUB)          DPKCS036
274300             MOVE ASC-CTN      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
274400                               TO MR-CTN    (PV-SUB)              DPKCS036
274500             MOVE ASC-UNTS     (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
274600                               TO MR-UNTS   (PV-SUB)              DPKCS036
274700             MOVE ASC-CBM      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
274800                               TO MR-CBM    (PV-SUB)              DPKCS036
274900             MOVE ASC-SHPMT-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
275000                               TO MR-TYPE   (PV-SUB)              DPKCS036
275100             MOVE ASC-FOB      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
275200                               TO MR-FOB    (PV-SUB)              DPKCS036
275300             MOVE ASC-POE      (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
275400                               TO MR-POE    (PV-SUB)              DPKCS036
275500             MOVE ASC-VSL-NM   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
275600                               TO MR-VSL-NM (PV-SUB)              DPKCS036
275700             MOVE ASC-VOY-NO   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
275800                               TO MR-VOY-NO (PV-SUB)              DPKCS036
275900             MOVE ASC-PO-CNT   (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
276000                               TO MR-PO-CNT (PV-SUB)              DPKCS036
276100         END-IF                                                   DPKCS036
276200     END-IF.                                                      DPKCS036
276300     SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
276400     IF  ASC-ITEM-SUB < + 1                                       DPKCS036
276500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
276600         MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
276700     END-IF.                                                      DPKCS036
276800                                                                  DPKCS036
276900 EJECT                                                            DPKCS036
277000*----------------------------------------------------------------*DPKCS036
277100*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *DPKCS036
277200*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *DPKCS036
277300*  ISSUE A WARNING.                                              *DPKCS036
277400*----------------------------------------------------------------*DPKCS036
277500 4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
277600                                                                  DPKCS036
277700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
277800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
277900*----------- NO END-OF-RANGE SPECFIED ---                         DPKCS036
278000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
278100             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
278200             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
278300         END-IF                                                   DPKCS036
278400     ELSE                                                         DPKCS036
278500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
278600*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   DPKCS036
278700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
278800             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
278900             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
279000         END-IF                                                   DPKCS036
279100     END-IF.                                                      DPKCS036
279200                                                                  DPKCS036
279300 EJECT                                                            DPKCS036
279400*----------------------------------------------------------------*DPKCS036
279500*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *DPKCS036
279600*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *DPKCS036
279700*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *DPKCS036
279800*  POSITION THE CURSOR THERE.                                    *DPKCS036
279900*----------------------------------------------------------------*DPKCS036
280000 4431-POSITION-AT-WARNING.                                        DPKCS036
280100                                                                  DPKCS036
280200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
280300                    - PV-TOP-ITEM + 1.                            DPKCS036
280400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
280500         CONTINUE                                                 DPKCS036
280600     ELSE                                                         DPKCS036
280700         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
280800                                   TO TRUE                        DPKCS036
280900         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
281000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
281100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
281200     END-IF.                                                      DPKCS036
281300*                                                                 DPKCS036
281400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
281500                    - PV-TOP-ITEM + 1.                            DPKCS036
281600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
281700         CONTINUE                                                 DPKCS036
281800     ELSE                                                         DPKCS036
281900         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
282000                                   TO TRUE                        DPKCS036
282100         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
282200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
282300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
282400     END-IF.                                                      DPKCS036
282500                                                                  DPKCS036
282600 EJECT                                                            DPKCS036
282700*----------------------------------------------------------------*DPKCS036
282800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *DPKCS036
282900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *DPKCS036
283000* FOR THE SELECTED ITEMS QUEUE.                                  *DPKCS036
283100*                                                                *DPKCS036
283200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *DPKCS036
283300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *DPKCS036
283400* THE ARRAY IS FULL.                                             *DPKCS036
283500*----------------------------------------------------------------*DPKCS036
283600 5000-PREPARE-SEL-QUEUE.                                          DPKCS036
283700                                                                  DPKCS036
283800     MOVE +1                   TO  ASC-BLK-SUB.                   DPKCS036
283900     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
284000     ADD +1                    TO  ASC-BLK-SUB.                   DPKCS036
284100     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
284200     MOVE ASC-SEL-QUEUE-NAME   TO  TR102-SEL-QUEUE-NAME.          DPKCS036
284300     PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
284400                                                                  DPKCS036
284500     SET ASC-UPDATE-TSQ        TO  TRUE.                          DPKCS036
284600                                                                  DPKCS036
284700     SET TR101-IDX             TO  1.                             DPKCS036
284800     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.       DPKCS036
284900     INITIALIZE TR101-SELECTED-ITEM-ARRAY.                        DPKCS036
285000                                                                  DPKCS036
285100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
285200             VARYING PV-ITEM                                      DPKCS036
285300             FROM 1 BY 1                                          DPKCS036
285400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
285500                                                                  DPKCS036
285600     IF  TR101-IDX > 1                                            DPKCS036
285700         PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
285800         ADD +1                    TO TR102-NUMBER-OF-TS-ITEMS    DPKCS036
285900     END-IF.                                                      DPKCS036
286000                                                                  DPKCS036
286100 EJECT                                                            DPKCS036
286200*----------------------------------------------------------------*DPKCS036
286300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
286400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
286500*----------------------------------------------------------------*DPKCS036
286600 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
286700                                                                  DPKCS036
286800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
286900                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
287000     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
287100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
287200                                                                  DPKCS036
287300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
287400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
287500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
287600             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
287700         END-IF                                                   DPKCS036
287800     ELSE                                                         DPKCS036
287900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
288000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
288100         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
288200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
288300     END-IF.                                                      DPKCS036
288400                                                                  DPKCS036
288500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
288600                                                                  DPKCS036
288700 EJECT                                                            DPKCS036
288800*----------------------------------------------------------------*DPKCS036
288900*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *DPKCS036
289000*  SPECIFIC COMMAREA.                                            *DPKCS036
289100*----------------------------------------------------------------*DPKCS036
289200 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
289300                                                                  DPKCS036
289400     EXEC CICS                                                    DPKCS036
289500         WRITEQ TS                                                DPKCS036
289600             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
289700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
289800             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
289900             REWRITE                                              DPKCS036
290000             RESP  (PV-CICS-RESP)                                 DPKCS036
290100     END-EXEC.                                                    DPKCS036
290200                                                                  DPKCS036
290300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
290400         CONTINUE                                                 DPKCS036
290500     ELSE                                                         DPKCS036
290600         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
290700         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
290800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
290900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
291000                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
291100         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
291200     END-IF.                                                      DPKCS036
291300                                                                  DPKCS036
291400 EJECT                                                            DPKCS036
291500*----------------------------------------------------------------*DPKCS036
291600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *DPKCS036
291700*  SPECIFIC COMMAREA.                                            *DPKCS036
291800*----------------------------------------------------------------*DPKCS036
291900 5110-WRITE-ASC-LISTQ.                                            DPKCS036
292000                                                                  DPKCS036
292100     EXEC CICS                                                    DPKCS036
292200         WRITEQ TS                                                DPKCS036
292300             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
292400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
292500             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
292600             RESP  (PV-CICS-RESP)                                 DPKCS036
292700     END-EXEC.                                                    DPKCS036
292800                                                                  DPKCS036
292900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
293000         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
293100         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
293200         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
293300                                   TO DP013-PARAGRAPH             DPKCS036
293400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
293500                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
293600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
293700     END-IF.                                                      DPKCS036
293800                                                                  DPKCS036
293900 EJECT                                                            DPKCS036
294000*----------------------------------------------------------------*DPKCS036
294100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *DPKCS036
294200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *DPKCS036
294300*----------------------------------------------------------------*DPKCS036
294400 5200-FILL-SEL-QUEUE-RECORD.                                      DPKCS036
294500                                                                  DPKCS036
294600     PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
294700                                                                  DPKCS036
294800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
294900         PERFORM                                                  DPKCS036
295000         VARYING LQW-IDX                                          DPKCS036
295100         FROM 1 BY 1                                              DPKCS036
295200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
295300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
295400                                                                  DPKCS036
295500             IF  LQW-SELECT (LQW-IDX)                             DPKCS036
295600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
295700                                   TO TR101-ITEM (TR101-IDX)      DPKCS036
295800                 MOVE LQW-CONTNR-NBR (LQW-IDX)                            
295900                                   TO TR102-CONTNR-NO                     
296000                                      TR101-CONTNR-NO                     
296100                                      (TR101-IDX)                         
296200                 MOVE LQW-CONTNR-SEQ-NBR (LQW-IDX)                        
296300                                   TO TR102-CONTNR-SEQ-NO                 
296400                                      TR101-CONTNR-SEQ-NO                 
296500                                      (TR101-IDX)                         
296600                 MOVE 'I'          TO TR101-ACTION-SW (TR101-IDX) DPKCS036
296700                 SET TR101-IDX UP BY 1                            DPKCS036
296800                 IF  TR101-IDX > TR101-MAX-ITEMS                  DPKCS036
296900                     PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
297000                     ADD +1        TO TR102-NUMBER-OF-TS-ITEMS    DPKCS036
297100                     INITIALIZE TR101-SELECTED-ITEM-ARRAY         DPKCS036
297200                     SET TR101-IDX TO  1                          DPKCS036
297300                 END-IF                                           DPKCS036
297400             END-IF                                               DPKCS036
297500         END-PERFORM                                              DPKCS036
297600     END-IF.                                                      DPKCS036
297700                                                                  DPKCS036
297800 EJECT                                                            DPKCS036
297900*----------------------------------------------------------------*DPKCS036
298000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
298100*----------------------------------------------------------------*DPKCS036
298200 5205-WRITE-SEL-QUEUE.                                            DPKCS036
298300                                                                  DPKCS036
298400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
298500                                   TO TR101-SELECTED-ITEMS.       DPKCS036
298600                                                                  DPKCS036
298700     EXEC CICS                                                    DPKCS036
298800          WRITEQ TS                                               DPKCS036
298900             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
299000             FROM  (TR101-VOYAGE-SEL-REC)                         DPKCS036
299100             ITEM  (PV-SEL-QUEUE-ITEM)                            DPKCS036
299200             RESP  (PV-CICS-RESP)                                 DPKCS036
299300     END-EXEC.                                                    DPKCS036
299400                                                                  DPKCS036
299500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
299600         CONTINUE                                                 DPKCS036
299700     ELSE                                                         DPKCS036
299800         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
299900         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
300000         MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
300100                                   TO DP013-PARAGRAPH             DPKCS036
300200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
300300                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
300400         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
300500     END-IF.                                                      DPKCS036
300600                                                                  DPKCS036
300700 EJECT                                                            DPKCS036
300800*----------------------------------------------------------------*DPKCS036
300900*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *DPKCS036
301000*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *DPKCS036
301100*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *DPKCS036
301200*  THE USER.                                                     *DPKCS036
301300*----------------------------------------------------------------*DPKCS036
301400 6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
301500                                                                  DPKCS036
301600     IF  ASC-UPDATE-TSQ                                           DPKCS036
301700         SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
301800         MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
301900                                      PV-SEL-QUEUE-ITEM           DPKCS036
302000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
302100                                   TO PV-HOLD-SELECTED-ITEMS      DPKCS036
302200         MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
302300         PERFORM 6100-UPDATE-TSQ                                  DPKCS036
302400             UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
302500                                     PV-HOLD-SELECTED-ITEMS       DPKCS036
302600         PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
302700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
302800                    ASC-BLOCK-ENTRIES (2)                         DPKCS036
302900     END-IF.                                                      DPKCS036
303000                                                                  DPKCS036
303100 EJECT                                                            DPKCS036
303200*----------------------------------------------------------------*DPKCS036
303300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
303400*----------------------------------------------------------------*DPKCS036
303500 6010-DELETE-SEL-QUEUE.                                           DPKCS036
303600                                                                  DPKCS036
303700     EXEC CICS                                                    DPKCS036
303800         DELETEQ TS                                               DPKCS036
303900             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
304000             RESP  (PV-CICS-RESP)                                 DPKCS036
304100     END-EXEC.                                                    DPKCS036
304200*                                                                 DPKCS036
304300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
304400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
304500         CONTINUE                                                 DPKCS036
304600     ELSE                                                         DPKCS036
304700         SET DP013-CICS-ABEND TO TRUE                             DPKCS036
304800         SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
304900         MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
305000                        TO DP013-PARAGRAPH                        DPKCS036
305100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
305200                        TO DP013-MESSAGE-TEXT (1)                 DPKCS036
305300         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
305400     END-IF.                                                      DPKCS036
305500                                                                  DPKCS036
305600 EJECT                                                            DPKCS036
305700*----------------------------------------------------------------*DPKCS036
305800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
305900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
306000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
306100*    THE TEMP QUEUE.                                             *DPKCS036
306200*----------------------------------------------------------------*DPKCS036
306300 6100-UPDATE-TSQ.                                                 DPKCS036
306400                                                                  DPKCS036
306500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
306600     PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
306700     PERFORM                                                      DPKCS036
306800         VARYING TR101-IDX                                        DPKCS036
306900         FROM 1 BY 1                                              DPKCS036
307000         UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
307100                              PV-HOLD-SELECTED-ITEMS)             DPKCS036
307200         OR (TR101-IDX GREATER THAN TR101-MAX-ITEMS))             DPKCS036
307300         IF  TR101-ACTION-SW (TR101-IDX) > SPACE                  DPKCS036
307400             PERFORM 6110-PROCESS-ITEMS                           DPKCS036
307500         END-IF                                                   DPKCS036
307600         ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
307700     END-PERFORM.                                                 DPKCS036
307800     PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
307900                                                                  DPKCS036
308000 EJECT                                                            DPKCS036
308100*----------------------------------------------------------------*DPKCS036
308200*    READ THE LIST QUEUE RECORD.                                 *DPKCS036
308300*----------------------------------------------------------------*DPKCS036
308400 6105-READ-SEL-QUEUE.                                             DPKCS036
308500                                                                  DPKCS036
308600     EXEC CICS                                                    DPKCS036
308700          READQ TS                                                DPKCS036
308800             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
308900             INTO  (TR101-VOYAGE-SEL-REC)                         DPKCS036
309000             ITEM  (PV-SEL-QUEUE-ITEM)                            DPKCS036
309100             RESP  (PV-CICS-RESP)                                 DPKCS036
309200     END-EXEC.                                                    DPKCS036
309300*                                                                 DPKCS036
309400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
309500         CONTINUE                                                 DPKCS036
309600     ELSE                                                         DPKCS036
309700         SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
309800         SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
309900         MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
310000                                   TO  DP013-PARAGRAPH            DPKCS036
310100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
310200                                   TO  DP013-MESSAGE-TEXT(1)      DPKCS036
310300         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
310400     END-IF.                                                      DPKCS036
310500                                                                  DPKCS036
310600 EJECT                                                            DPKCS036
310700*----------------------------------------------------------------*DPKCS036
310800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
310900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
311000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
311100*----------------------------------------------------------------*DPKCS036
311200 6110-PROCESS-ITEMS.                                              DPKCS036
311300                                                                  DPKCS036
311400     COMPUTE PV-ITEM = 1 + ((TR101-ITEM (TR101-IDX) - 1)          DPKCS036
311500                     / PC-ITEMS-PER-PANEL).                       DPKCS036
311600                                                                  DPKCS036
311700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
311800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
311900             PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
312000         END-IF                                                   DPKCS036
312100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
312200                                                                  DPKCS036
312300         PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
312400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
312500             CONTINUE                                             DPKCS036
312600         END-IF                                                   DPKCS036
312700     END-IF.                                                      DPKCS036
312800                                                                  DPKCS036
312900     COMPUTE PV-SUB = (TR101-ITEM (TR101-IDX)                     DPKCS036
313000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
313100     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        DPKCS036
313200     MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
313300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
313400                                                                  DPKCS036
313500     IF TR101-INQ (TR101-IDX)                                     DPKCS036
313600        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             DPKCS036
313700     END-IF.                                                      DPKCS036
313800                                                                  DPKCS036
313900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
314000                                                                  DPKCS036
314100 EJECT                                                            DPKCS036
314200*----------------------------------------------------------------*DPKCS036
314300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
314400*----------------------------------------------------------------*DPKCS036
314500 6111-WRITE-LIST-QUEUE.                                           DPKCS036
314600                                                                  DPKCS036
314700     EXEC CICS                                                    DPKCS036
314800         WRITEQ TS                                                DPKCS036
314900             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
315000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
315100             ITEM  (PV-SAVE-ITEM)                                 DPKCS036
315200             REWRITE                                              DPKCS036
315300             RESP  (PV-CICS-RESP)                                 DPKCS036
315400     END-EXEC.                                                    DPKCS036
315500*                                                                 DPKCS036
315600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
315700         CONTINUE                                                 DPKCS036
315800     ELSE                                                         DPKCS036
315900         SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
316000         SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
316100         MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
316200                               TO  DP013-PARAGRAPH                DPKCS036
316300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
316400                               TO  DP013-MESSAGE-TEXT(1)          DPKCS036
316500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
316600     END-IF.                                                      DPKCS036
316700                                                                  DPKCS036
316800 EJECT                                                            DPKCS036
316900*----------------------------------------------------------------*DPKCS036
317000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
317100*----------------------------------------------------------------*DPKCS036
317200 6112-READ-LIST-QUEUE.                                            DPKCS036
317300                                                                  DPKCS036
317400     EXEC CICS                                                    DPKCS036
317500         READQ TS                                                 DPKCS036
317600             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
317700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
317800             ITEM  (PV-ITEM)                                      DPKCS036
317900             RESP  (PV-CICS-RESP)                                 DPKCS036
318000     END-EXEC.                                                    DPKCS036
318100*                                                                 DPKCS036
318200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
318300         CONTINUE                                                 DPKCS036
318400     ELSE                                                         DPKCS036
318500         SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
318600         SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
318700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
318800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
318900                                     TO DP013-MESSAGE-TEXT(1)     DPKCS036
319000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
319100     END-IF.                                                      DPKCS036
319200                                                                  DPKCS036
319300 EJECT                                                            DPKCS036
319400*----------------------------------------------------------------*DPKCS036
319500*    ABEND PROCESSOR MODULE                                      *DPKCS036
319600*----------------------------------------------------------------*DPKCS036
319700                                                                  DPKCS036
319800     COPY DPPD013.                                                DPKCS036
