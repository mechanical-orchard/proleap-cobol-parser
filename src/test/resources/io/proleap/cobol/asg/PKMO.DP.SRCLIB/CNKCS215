000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS215.                                         00040058
000500 AUTHOR.        GERMAN BANDA.                                     00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  05-26-2000.                                       00070012
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*---------------------------------------------------------------* 00100001
001100*    Y215 - PRINTER MAINTENANCE     - PRINTER LIST              * 00110058
001200*    THIS PROGRAM WILL PRODUCE A LIST OF EXISTING PRINTER ID'S. * 00120099
001300*    THIS SCREEN IS ACCESSED BY PRESSING F17 FROM THE           * 00130099
001400*    PRINTER MAINT. CRIT SPEC.  (CNKCS214).                     * 00140099
001500*---------------------------------------------------------------* 00150001
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00151099
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00152099
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00153099
263455*----------------------------------------------------------------*00154099
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00155099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00156099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00157099
CICS  *-----------------------------------------------------------------00158099
001600 EJECT                                                            00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800                                                                  00180001
001900 DATA DIVISION.                                                   00190001
002000                                                                  00200001
002100 WORKING-STORAGE SECTION.                                         00210001
002200                                                                  00220001
002300 01  DK-DB2-KEYS.                                                 00230001
002400     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00240006
002500                                                    COMP.         00250006
002600     05  DK-FCLTY-ID                    PIC S9(04)  VALUE ZERO    00260006
002700                                                    COMP.         00270006
002800     05  DK-PRINTER-ID                  PIC  X(08)  VALUE SPACES. 00280018
002900     05  DK-PRTR-SEL-TYPE               PIC  X(01)  VALUE SPACES. 00290054
003000                                                                  00300001
003100                                                                  00310001
003200 01  PC-PROGRAM-CONSTANTS.                                        00320001
003300     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK215  '.  00330063
003400     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM215'.   00340062
003500     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS215'.  00350058
003600     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE 'DPKCS060'.  00360001
003700     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00370001
003800     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00380001
003900     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00390001
004000     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00400011
004100                                               COMP SYNC.         00410001
004200     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00420001
004300                                               COMP SYNC.         00430001
004400     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00440001
004500                                               COMP-3.            00450001
004600     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00460001
004700                                               COMP SYNC.         00470001
004800     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00480001
004900                                               COMP-3.            00490001
005000     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00500001
005100     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00510001
005200     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00520001
005300     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00530001
005400*                                                                 00540001
005500*----------------------------------------------------------------*00550001
005600*  SYSTEM MESSAGES                                               *00560001
005700*----------------------------------------------------------------*00570001
005800*   00005 = INVALID VALUE                                        *00580001
005900*   00008 = MUST BE NUMERIC                                      *00590001
006000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00600001
006100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00610001
006200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00620001
006300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00630001
006400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00640001
006500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00650001
006600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00660001
006700*   00069 - TOP OF LIST                                          *00670001
006800*   00070 - BOTTOM OF LIST                                       *00680001
006900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00690001
007000*   00279 - MORE ITEMS TO DISPLAY                                *00700001
007100*----------------------------------------------------------------*00710001
007200     05  PC-TSYMSG-NUMBERS.                                       00720001
007300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00730001
007400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00740001
007500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00750001
007600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00760001
007700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00770001
007800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00780001
007900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00790001
008000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00800001
008100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00810001
008200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00820001
008300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00830001
008400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00840001
008500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00850001
008600*                                                                 00860001
008700 01  PS-PROGRAM-SWITCHES.                                         00870001
008800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00880001
008900         88  PS-NO-ERROR                            VALUE 'Y'.    00890001
009000         88  PS-ERROR                               VALUE 'N'.    00900001
009100     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00910001
009200         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00920001
009300         88  PS-BLOCK-ERROR                         VALUE 'N'.    00930001
009400     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00940001
009500         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00950001
009600         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00960001
009700     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00970001
009800         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00980001
009900         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00990001
010000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01000001
010100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01010001
010200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01020001
010300     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    01030001
010400         88  PS-LIST-END                            VALUE 'Y'.    01040001
010500         88  PS-NO-LIST-END                         VALUE 'N'.    01050001
010600*                                                                 01060001
010700 01  DN-DB2-NULL-INDICATORS.                                      01070014
010800     05  DN-CLUSTR-NBR               PIC S9(04) COMP VALUE ZEROES.01080024
010900*                                                                 01090014
011000 01  PV-PROGRAM-VARIABLES.                                        01100001
011100     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01110001
011200                                        COMP SYNC.                01120001
011300     05  PV-SUB                         PIC S9(04)  VALUE +0      01130001
011400                                                    COMP SYNC.    01140001
011500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01150001
011600                                                    COMP SYNC.    01160001
011700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01170001
011800                                                    COMP-3.       01180001
011900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01190001
012000                                                    COMP-3.       01200001
012100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01210001
012200                                                    COMP-3.       01220001
012300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01230001
012400                                                    COMP-3.       01240001
012500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01250001
012600                                                    COMP-3.       01260001
012700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01270001
012800                                                    COMP-3.       01280001
012900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01290001
013000                                                    COMP-3.       01300001
013100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01350001
013600                                                    COMP SYNC.    01360001
013700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01370001
013800                                                    COMP SYNC.    01380001
013900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01430001
014400                                                    COMP SYNC.    01440001
014500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01450001
014600                                                    COMP SYNC.    01460001
014700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01470001
014800                                                    COMP SYNC.    01480001
014900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01490001
015000                                                    COMP SYNC.    01500001
015100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01510001
015200                                                    COMP SYNC.    01520001
015300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01530001
015400                                                    COMP SYNC.    01540001
015500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01550001
015600                                                    COMP SYNC.    01560001
015700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01570001
015800                                                    COMP SYNC.    01580001
015900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01590001
016000                                                    COMP SYNC.    01600001
016100     05  PV-SOFT-ABORT-MSG.                                       01610001
016200         10  FILLER            PIC X(12) VALUE ' CNKCS215 - '.    01620058
016300         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01630001
016400         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01640001
016500         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01650001
016600         10  PV-SOFT-PARAGRAPH PIC X(30).                         01660001
016700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01670001
016800                                                     COMP SYNC.   01680001
016900                                                                  01690001
017000                                                                  01700001
017100                                                                  01710001
017200     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01720001
017300                                                     COMP SYNC.   01730001
017400     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01740001
017500     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01750001
017600     05  PV-PRINTER-CLUSTER              PIC X(04)   VALUE SPACES.01760046
017700     05  PV-PRINTER-CLUSTER-N            PIC ZZZ9    VALUE ZEROES.01770052
017800******************************************************************01780001
017900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01790001
018000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01800001
018100**  APPLICATION-SPECIFIC COMMAREA.                              **01810001
018200******************************************************************01820001
018300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01830001
018400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01840001
018500     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01850011
018600                                        INDEXED BY LQW-IDX.       01860001
018700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01870001
018800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01880001
018900         10  LQW-SELECTED-SW            PIC  X(01).               01890001
019000             88  LQW-SELECT                         VALUE 'S'.    01900001
019100             88  LQW-DESELECT                       VALUE ' '.    01910001
019200         10  LQW-ACTION                 PIC  X(03).               01920001
019300             88  LQW-DEL                            VALUE 'DEL'.  01930001
019400             88  LQW-INQ                            VALUE 'INQ'.  01940001
019500             88  LQW-UPD                            VALUE 'UPD'.  01950001
019600             88  LQW-ERR                            VALUE 'ERR'.  01960001
019700             88  LQW-PRT                            VALUE 'PRT'.  01970001
019800         10  LQW-PRINTER-NUM            PIC  X(08).               01980070
019900         10  LQW-CLUSTER-NUM            PIC  X(04).               01990052
020000         10  LQW-PRINTER-TYP            PIC  X(08).               02000004
020100         10  LQW-PRINTER-LOC            PIC  X(25).               02010004
020200         10  LQW-STATUS-CDE             PIC  X(01).               02020004
020300                                                                  02030001
020400                                                                  02040001
020500*---------------------------------------------------------------* 02050001
020600* SELECTON QUEUE LAYOUT                                         * 02060001
020700*---------------------------------------------------------------* 02070001
020800     COPY CNWS163.                                                02080058
020900                                                                  02090001
021000                                                                  02100001
021100*---------------------------------------------------------------* 02110001
021200*    MAP LAYOUT                                                 * 02120001
021300*---------------------------------------------------------------* 02130001
021400                                                                  02140001
021500     COPY CNKM215.                                                02150058
021600*                                                                 02160001
021700 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK215O.       02170063
021800     05  FILLER                         PIC X(95).                02180011
021900     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02190003
022000         10  MR-SELECTL                 PIC S9(04) COMP.          02200001
022100         10  MR-SELECTA                 PIC  X(01).               02210001
022200         10  MR-SELECTC                 PIC  X(01).               02220001
022300         10  MR-SELECTH                 PIC  X(01).               02230001
022400         10  MR-SELECTI                 PIC  X(01).               02240001
022500                                                                  02250001
022600         10  MR-ACTIONL                 PIC S9(04) COMP.          02260001
022700         10  MR-ACTIONA                 PIC  X(01).               02270001
022800         10  MR-ACTIONC                 PIC  X(01).               02280001
022900         10  MR-ACTIONH                 PIC  X(01).               02290001
023000         10  MR-ACTION                  PIC  X(03).               02300001
023100                                                                  02310001
023200         10  MR-PRINTER-NUML            PIC S9(04) COMP.          02320003
023300         10  MR-PRINTER-NUMA            PIC  X(01).               02330003
023400         10  MR-PRINTER-NUMC            PIC  X(01).               02340003
023500         10  MR-PRINTER-NUMH            PIC  X(01).               02350003
023600         10  MR-PRINTER-NUM             PIC  X(08).               02360070
023700                                                                  02370001
023800         10  MR-CLUSTER-NUML            PIC S9(04) COMP.          02380003
023900         10  MR-CLUSTER-NUMA            PIC  X(01).               02390003
024000         10  MR-CLUSTER-NUMC            PIC  X(01).               02400003
024100         10  MR-CLUSTER-NUMH            PIC  X(01).               02410003
024200         10  MR-CLUSTER-NUM-X.                                    02420003
024300             15  MR-CLUSTER-NUM         PIC  Z(04).               02430099
024400                                                                  02440001
024500         10  MR-PRINTER-TYPL            PIC S9(04) COMP.          02450003
024600         10  MR-PRINTER-TYPA            PIC  X(01).               02460003
024700         10  MR-PRINTER-TYPC            PIC  X(01).               02470003
024800         10  MR-PRINTER-TYPH            PIC  X(01).               02480003
024900         10  MR-PRINTER-TYP             PIC  X(08).               02490003
025000                                                                  02500001
025100         10  MR-PRINTER-LOCL            PIC S9(04) COMP.          02510003
025200         10  MR-PRINTER-LOCA            PIC  X(01).               02520003
025300         10  MR-PRINTER-LOCC            PIC  X(01).               02530003
025400         10  MR-PRINTER-LOCH            PIC  X(01).               02540003
025500         10  MR-PRINTER-LOC             PIC  X(25).               02550003
025600                                                                  02560001
025700         10  MR-STATUS-CDEL            PIC S9(04) COMP.           02570003
025800         10  MR-STATUS-CDEA            PIC  X(01).                02580003
025900         10  MR-STATUS-CDEC            PIC  X(01).                02590003
026000         10  MR-STATUS-CDEH            PIC  X(01).                02600003
026100         10  MR-STATUS-CDE             PIC  X(01).                02610003
026200                                                                  02620001
026300                                                                  02630001
026400     05  FILLER                         PIC  X(12).               02640001
026500                                                                  02650001
026600                                                                  02660001
026700*----------------------------------------------------------------*02670001
026800**  SECURITY SUBROUTINE PARAMETERS                                02680001
026900*----------------------------------------------------------------*02690001
027000     COPY DPWS008.                                                02700001
027100                                                                  02710001
027200                                                                  02720001
027300*---------------------------------------------------------------* 02730001
027400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02740001
027500*---------------------------------------------------------------* 02750001
027600                                                                  02760001
027700     COPY DPWS015.                                                02770001
027800                                                                  02780001
027900*---------------------------------------------------------------* 02790001
028000*    FUNCTION KEYS COPYBOOK.                                    * 02800001
028100*---------------------------------------------------------------* 02810001
028200                                                                  02820001
028300     COPY DPWS016.                                                02830001
028400                                                                  02840001
028500*---------------------------------------------------------------* 02850001
028600*    NUMERIC EDIT LAYOUT.                                       * 02860001
028700*---------------------------------------------------------------* 02870001
028800                                                                  02880001
028900     COPY DPWS010I.                                               02890001
029000 EJECT                                                            02900001
029100*---------------------------------------------------------------* 02910001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02920099
029300*---------------------------------------------------------------* 02930001
029400                                                                  02940001
029500     COPY DPWS030.                                                02950001
CICS       COPY DPWS930.                                                02951099
029600 EJECT                                                            02960001
029700*---------------------------------------------------------------* 02970001
029800*    STANDARD COMMAREA.                                         * 02980001
029900*---------------------------------------------------------------* 02990001
030000                                                                  03000001
030100     COPY DPWS020.                                                03010001
030200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03020001
030300                                                                  03030001
030400*---------------------------------------------------------------* 03040001
030500* INTER-APPLICATION COMMAREA.                                   * 03050001
030600*   CNWS161 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03060058
030700*             SPEC SCREEN.                                      * 03070001
030800*   CNWS162 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03080058
030900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03090001
031000*---------------------------------------------------------------* 03100001
031100                                                                  03110001
031200         10  INTER-APPL-COMM-AREA       PIC X(200).               03120001
031300     COPY CNWS161.                                                03130058
031400     COPY CNWS162.                                                03140058
031500*---------------------------------------------------------------* 03150001
031600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03160001
031700*---------------------------------------------------------------* 03170001
031800         10  ASC-SPECIFIC-COMMAREA.                               03180001
031900             15  ASC-OPER-UNT-ID        PIC  X(04).               03190004
032000             15  ASC-FCLTY-ID           PIC  X(04).               03200004
032100             15  ASC-FCLTY-NME          PIC  X(25).               03210004
032200             15  ASC-PRTR-ID            PIC  X(08).               03220068
032300             15  ASC-PRTR-CLUSTR-NBR    PIC  X(04).               03230079
032400             15  ASC-PRTR-LOC           PIC  X(25).               03240077
032500             15  ASC-PRTR-STAT-CDE      PIC  X(01).               03250077
032600                                                                  03260099
032700             15  ASC-PRTR-SELECT-TYPE   PIC  X(01).               03270054
032800                 88  ASC-SELECT-TYP-VALID     VALUE 'A' 'L' 'N'   03280099
032900                                                    ' '.          03290054
033000                 88  ASC-SEL-TYP-ENTERED      VALUE 'A' 'L' 'N'.  03300099
033100                 88  ASC-SELECT-TYP-ALL           VALUE 'A'.      03310099
033200                 88  ASC-SELECT-TYP-LABEL         VALUE 'L'.      03320099
033300                 88  ASC-SELECT-TYP-LINE          VALUE 'N'.      03330099
033400                                                                  03340001
033500**********   15  FILLER                      PIC  X(124).         03350003
033600*-----------------------------------------------------------------03360001
033700             15  ASC-BLK-SUB                  PIC S9(04) COMP     03370001
033800                                                         SYNC.    03380001
033900             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03390001
034000                                                         SYNC.    03400001
034100             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03410001
034200             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03420001
034300             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03430001
034400             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03440001
034500             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03450001
034600             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03460001
034700                                                         SYNC.    03470001
034800             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03480001
034900             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03490001
035000             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03500001
035100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03510001
035200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03520001
035300             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03530001
035400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03540001
035500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03550001
035600             15  ASC-LIST-QUEUE-NAME.                             03560001
035700                 20  ASC-LIST-TERM-ID         PIC  X(04).         03570001
035800                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03580001
035900                 20  ASC-LIST-SEQ             PIC  9(01).         03590001
036000                                                                  03600001
036100             15  ASC-START-ITEM-REQUEST.                          03610001
036200                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03620001
036300                                                                  03630001
036400             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03640001
036500             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03650001
036600*                                                                 03660053
036700*IF PRINTER ID IS NOT ENTERED ON CRIT SPEC                        03670054
036800             15  ASC-CURSOR-SW                PIC  X(02).         03680054
036900                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03690054
037000                 88  ASC-PRTR-LIST-ALL-CURSOR        VALUE 'A '.  03700054
037100                 88  ASC-PRTR-LIST-LBL-CURSOR        VALUE 'B '.  03710054
037200                 88  ASC-PRTR-LIST-LNE-CURSOR        VALUE 'C '.  03720054
037300*IF PRINTER ID IS ENTERED ON CRIT SPEC                            03730054
037400                 88  ASC-PRTR-ID-ALL-CURSOR          VALUE 'D '.  03740054
037500                 88  ASC-PRTR-ID-LBL-CURSOR          VALUE 'E '.  03750054
037600                 88  ASC-PRTR-ID-LNE-CURSOR          VALUE 'F '.  03760054
037700             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03770001
037800                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03780001
037900             15  ASC-SEL-QUEUE-NAME.                              03790001
038000                 20  ASC-SEL-TERM-ID          PIC  X(04).         03800001
038100                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03810001
038200                 20  ASC-SEL-SEQ              PIC  9(01).         03820001
038300             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03830001
038400                                                                  03840001
038500*-----------------------------------------------------------------03850001
038600                                                                  03860001
038700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03870001
038800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03880001
038900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03890001
039000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03900001
039100                                                                  03910001
039200                 20  ASC-ITEM-ARRAY.                              03920001
039300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03930003
039400                         30  ASC-LIST-ITEM-NUMBER                 03940001
039500                                                     PIC S9(09)   03950001
039600                                                     COMP-3.      03960001
039700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03970001
039800                             88  ASC-VALID-SELECT    VALUE ' '    03980001
039900                                                           'S'    03990001
040000                                                           'B'    04000001
040100                                                           'E'.   04010001
040200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04020001
040300                             88  ASC-TEMP-SELECT     VALUE 'S'.   04030001
040400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04040001
040500                             88  ASC-TEMP-END        VALUE 'E'.   04050001
040600                         30  ASC-SELECTED-SW         PIC  X(01).  04060001
040700                             88  ASC-NO-SELECT       VALUE ' '.   04070001
040800                             88  ASC-SELECT          VALUE 'S'.   04080001
040900                             88  ASC-BEGIN           VALUE 'B'.   04090001
041000                             88  ASC-END             VALUE 'E'.   04100001
041100                         30  ASC-ACTION              PIC  X(03).  04110001
041200                         30  ASC-PRINTER-NUM         PIC  X(08).  04120070
041300                         30  ASC-CLUSTER-NUM         PIC  X(04).  04130052
041400                         30  ASC-PRINTER-TYP         PIC  X(08).  04140003
041500                         30  ASC-PRINTER-LOC         PIC  X(25).  04150003
041600                         30  ASC-STATUS-CDE          PIC  X(01).  04160003
041700                                                                  04170001
041800     EJECT                                                        04180001
041900*---------------------------------------------------------------* 04190001
042000*    ABEND PROCESSING COPYBOOK.                                 * 04200001
042100*---------------------------------------------------------------* 04210001
042200                                                                  04220001
042300     COPY DPWS013.                                                04230001
042400                                                                  04240001
042500 EJECT                                                            04250001
042600*---------------------------------------------------------------* 04260001
042700*    TPRTRID -  PRINTER ID                                      * 04270003
042800*---------------------------------------------------------------* 04280001
042900     EXEC SQL                                                     04290001
043000          INCLUDE TPRTRID                                         04300003
043100     END-EXEC.                                                    04310001
043200*---------------------------------------------------------------* 04320001
043300*---------------------------------------------------------------* 04330001
043400*    DB2 AREA FOR COMMUNICATIONS                                * 04340001
043500*---------------------------------------------------------------* 04350001
043600     EXEC SQL                                                     04360001
043700          INCLUDE SQLCA                                           04370001
043800     END-EXEC.                                                    04380001
043900*                                                                 04390057
044000*                                                                 04400097
044100*---------------------------------------------------------------* 04410001
044200*    PRINTER LIST CURSOR -                                      * 04420054
044300*    WHEN NO PRINTER ID IS ENTERED ON CRIT SPEC                 * 04430054
044400*    AND A=ALL PRINTER TYPE SELECTED                            * 04440054
044500*---------------------------------------------------------------* 04450001
044600     EXEC SQL                                                     04460001
044700        DECLARE PRTR-LIST-ALL-CSR CURSOR FOR                      04470054
044800           SELECT PRTR_ID                                         04480003
044900                 ,PRTR_CLUSTR_NBR                                 04490030
045000                 ,PRTR_TYP_CDE                                    04500003
045100                 ,PRTR_LOC_DESC                                   04510003
045200                 ,PRTR_PHY_STAT_CDE                               04520003
045300           FROM  TPRTRID                                          04530003
045400             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            04540003
045500             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               04550003
045600          ORDER BY  PRTR_ID                                       04560029
045700     END-EXEC.                                                    04570001
045800*                                                                 04580022
045900*---------------------------------------------------------------* 04590054
046000*    PRINTER LIST CURSOR -                                      * 04600054
046100*    WHEN NO PRINTER ID IS ENTERED ON CRIT SPEC                 * 04610054
046200*    AND L=LABEL PRINTER TYPE SELECTED                          * 04620054
046300*---------------------------------------------------------------* 04630054
046400     EXEC SQL                                                     04640054
046500        DECLARE PRTR-LIST-LBL-CSR CURSOR FOR                      04650054
046600           SELECT PRTR_ID                                         04660054
046700                 ,PRTR_CLUSTR_NBR                                 04670054
046800                 ,PRTR_TYP_CDE                                    04680054
046900                 ,PRTR_LOC_DESC                                   04690054
047000                 ,PRTR_PHY_STAT_CDE                               04700054
047100           FROM  TPRTRID                                          04710054
047200             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            04720054
047300             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               04730054
047400             AND    PRTR_ID NOT LIKE 'U%'                         04740054
047500          ORDER BY  PRTR_ID                                       04750054
047600     END-EXEC.                                                    04760054
047700*                                                                 04770054
047800*---------------------------------------------------------------* 04780054
047900*    PRINTER LIST CURSOR -                                      * 04790054
048000*    WHEN NO PRINTER ID IS ENTERED ON CRIT SPEC                 * 04800054
048100*    AND N=LINE PRINTER TYPE SELECTED                           * 04810054
048200*---------------------------------------------------------------* 04820054
048300     EXEC SQL                                                     04830054
048400        DECLARE PRTR-LIST-LNE-CSR CURSOR FOR                      04840054
048500           SELECT PRTR_ID                                         04850054
048600                 ,PRTR_CLUSTR_NBR                                 04860054
048700                 ,PRTR_TYP_CDE                                    04870054
048800                 ,PRTR_LOC_DESC                                   04880054
048900                 ,PRTR_PHY_STAT_CDE                               04890054
049000           FROM  TPRTRID                                          04900054
049100             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            04910054
049200             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               04920054
049300             AND    PRTR_ID LIKE 'U%'                             04930054
049400          ORDER BY  PRTR_ID                                       04940054
049500     END-EXEC.                                                    04950054
049600*                                                                 04960054
049700*---------------------------------------------------------------* 04970054
049800*    PRINTER ID CURSOR -                                        * 04980054
049900*    WHEN PRINTER ID IS ENTERED ON CRIT SPEC                    * 04990054
050000*    AND A=ALL PRINTER TYPE SELECTED                            * 05000054
050100*---------------------------------------------------------------* 05010054
050200     EXEC SQL                                                     05020054
050300        DECLARE PRTR-ID-ALL-CSR CURSOR FOR                        05030054
050400           SELECT PRTR_ID                                         05040054
050500                 ,PRTR_CLUSTR_NBR                                 05050054
050600                 ,PRTR_TYP_CDE                                    05060054
050700                 ,PRTR_LOC_DESC                                   05070054
050800                 ,PRTR_PHY_STAT_CDE                               05080054
050900           FROM  TPRTRID                                          05090054
051000             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            05100054
051100             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               05110054
051200             AND    PRTR_ID          = :DK-PRINTER-ID             05120054
051300          ORDER BY  PRTR_ID                                       05130054
051400     END-EXEC.                                                    05140054
051500*                                                                 05150054
051600*---------------------------------------------------------------* 05160054
051700*    PRINTER ID CURSOR -                                        * 05170054
051800*    WHEN PRINTER ID IS ENTERED ON CRIT SPEC                    * 05180054
051900*    AND L=LABEL PRINTER TYPE SELECTED                          * 05190054
052000*---------------------------------------------------------------* 05200054
052100     EXEC SQL                                                     05210054
052200        DECLARE PRTR-ID-LBL-CSR CURSOR FOR                        05220054
052300           SELECT PRTR_ID                                         05230054
052400                 ,PRTR_CLUSTR_NBR                                 05240054
052500                 ,PRTR_TYP_CDE                                    05250054
052600                 ,PRTR_LOC_DESC                                   05260054
052700                 ,PRTR_PHY_STAT_CDE                               05270054
052800           FROM  TPRTRID                                          05280054
052900             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            05290054
053000             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               05300054
053100             AND    PRTR_ID          = :DK-PRINTER-ID             05310054
053200             AND    PRTR_ID NOT LIKE 'U%'                         05320054
053300          ORDER BY  PRTR_ID                                       05330054
053400     END-EXEC.                                                    05340054
053500*                                                                 05350054
053600*---------------------------------------------------------------* 05360054
053700*    PRINTER ID CURSOR -                                        * 05370054
053800*    WHEN PRINTER ID IS ENTERED ON CRIT SPEC                    * 05380054
053900*    AND N=LINE PRINTER TYPE SELECTED                           * 05390054
054000*---------------------------------------------------------------* 05400054
054100     EXEC SQL                                                     05410054
054200        DECLARE PRTR-ID-LNE-CSR CURSOR FOR                        05420054
054300           SELECT PRTR_ID                                         05430054
054400                 ,PRTR_CLUSTR_NBR                                 05440054
054500                 ,PRTR_TYP_CDE                                    05450054
054600                 ,PRTR_LOC_DESC                                   05460054
054700                 ,PRTR_PHY_STAT_CDE                               05470054
054800           FROM  TPRTRID                                          05480054
054900             WHERE  PRTR_OPER_UNT_ID = :DK-OPER-UNT-ID            05490054
055000             AND    PRTR_FCLTY_ID    = :DK-FCLTY-ID               05500054
055100             AND    PRTR_ID          = :DK-PRINTER-ID             05510054
055200             AND    PRTR_ID LIKE 'U%'                             05520054
055300          ORDER BY  PRTR_ID                                       05530054
055400     END-EXEC.                                                    05540054
055500*                                                                 05550054
055600*                                                                 05560054
055700 LINKAGE SECTION.                                                 05570054
055800                                                                  05580054
055900 01  DFHCOMMAREA.                                                 05590054
056000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05600054
056100                                        DEPENDING ON EIBCALEN.    05610054
056200         10  FILLER                     PIC X.                    05620054
056300                                                                  05630054
056400 EJECT                                                            05640054
056500 PROCEDURE DIVISION.                                              05650054
056600******************************************************************05660054
056700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05670054
056800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05680054
056900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05690054
057000******************************************************************05700054
057100 0000-MAIN-MODULE.                                                05710054
057200     INITIALIZE DP030-CICS-API-FIELDS.                            05720054
057300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05730054
057400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05740054
057500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05750054
057600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05760054
057700     MOVE LENGTH OF CNK215I        TO DP030-MAP-LENGTH (1).       05770063
057800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05780054
057900     PERFORM 0001-CALL-CICS-ARCH-API.                             05790054
058000                                                                  05800057
058100     PERFORM 1000-CONTROL-PROCESSING                              05810054
058200                                                                  05820057
058300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05830054
058400     PERFORM 0001-CALL-CICS-ARCH-API.                             05840054
058500                                                                  05850054
058600******************************************************************05860054
058700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05870054
058800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05880054
058900******************************************************************05890054
059000 0001-CALL-CICS-ARCH-API.                                         05900054
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05910099
059200                                    DFHCOMMAREA                   05920099
059300                                    DP030-CICS-API-FIELDS         05930099
059400                                    DP020-STANDARD-COMMAREA       05940099
059500                                    CNK215I.                      05950099
059600                                                                  05960057
059700     IF  DP030-RC-CALL-SUCCESSFUL                                 05970054
059800         CONTINUE                                                 05980054
059900     ELSE                                                         05990054
060000         SET DP013-NO-ROLLBACK                                    06000054
060100             DP013-XCTL-DISPLAY-RESTART                           06010054
060200             DP013-CICS-ABEND      TO TRUE                        06020054
060300         MOVE '0001-CALL-CICS-ARCH-API'                           06030054
060400                                   TO DP013-PARAGRAPH             06040054
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06041099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06042099
060700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06070054
060800         PERFORM DP013-0000-PROCESS-ABEND                         06080054
060900     END-IF.                                                      06090054
061000*----------------------------------------------------------------*06100054
061100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06110054
061200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06120054
061300*                                                                *06130054
061400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06140054
061500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06150054
061600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06160054
061700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06170054
061800*----------------------------------------------------------------*06180054
061900                                                                  06190054
062000 1000-CONTROL-PROCESSING.                                         06200054
062100                                                                  06210054
062200     EVALUATE TRUE                                                06220054
062300         WHEN DP020-NEXT-ACT-INITIAL                              06230054
062400             INITIALIZE ASC-SPECIFIC-COMMAREA                     06240054
062500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06250054
062600                                      ASC-SEL-TERM-ID             06260054
062700             MOVE DP020-SRC-TASK-NUMBER                           06270054
062800                                   TO ASC-LIST-TASK-NUMBER        06280054
062900                                      ASC-SEL-TASK-NUMBER         06290054
063000             MOVE PC-LIST-QUEUE-SEQ                               06300054
063100                                   TO ASC-LIST-SEQ                06310054
063200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06320054
063300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06330054
063400***-----$TEMPLATE NOTE$-------------------------------------------06340054
063500*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06350054
063600*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06360054
063700*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06370054
063800***---------------------------------------------------------------06380054
063900             IF  PS-COMMAREA-NOT-VALID                            06390054
064000                 SET DP020-NEXT-ACT-APPL-ERROR                    06400054
064100                                   TO TRUE                        06410054
064200             ELSE                                                 06420054
064300                 PERFORM 4000-BUILD-INITIAL-PANEL                 06430054
064400             END-IF                                               06440054
064500                                                                  06450054
064600         WHEN DP020-NEXT-ACT-READ-MAP                             06460054
064700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06470054
064800                                   TO PV-TOP-ITEM                 06480054
064900             PERFORM 2000-PROCESS-PANEL                           06490054
065000                                                                  06500073
065100*F3-END                                                           06510073
065200         WHEN DP020-NEXT-ACT-RETURN                               06520054
065300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06530054
065400                                   TO PV-TOP-ITEM                 06540054
065500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06550054
065600             IF CN162-ADD                                         06560099
065700                PERFORM 2050-DELETE-LIST-QUEUE                    06570099
065800                PERFORM 4000-BUILD-INITIAL-PANEL                  06580099
065900             ELSE                                                 06590099
066000                PERFORM 6000-REFRESH-PANEL-FROM-TEMP              06600099
066100                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              06610099
066200             END-IF                                               06620099
066300                                                                  06630099
066400         WHEN OTHER                                               06640054
066500             SET DP013-LOGIC-ABEND TO TRUE                        06650054
066600             SET DP013-NO-ROLLBACK TO TRUE                        06660054
066700             MOVE '1000-CONTROL-PROCESSING'                       06670054
066800                                   TO DP013-PARAGRAPH             06680054
066900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06690054
067000                                   TO DP013-MESSAGE-TEXT(1)       06700054
067100             PERFORM DP013-0000-PROCESS-ABEND                     06710054
067200     END-EVALUATE.                                                06720054
067300                                                                  06730054
067400 EJECT                                                            06740054
067500*----------------------------------------------------------------*06750054
067600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06760054
067700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06770054
067800*----------------------------------------------------------------*06780054
067900                                                                  06790054
068000 1100-PROCESS-INTER-APPL-COMM.                                    06800054
068100                                                                  06810054
068200     SET PS-COMMAREA-VALID         TO TRUE.                       06820054
068300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06830054
068400                                                                  06840054
068500                                                                  06850099
068600*IF COMING FROM CRIT SPEC (CNKCS214)                              06860099
068700     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06870054
068800         MOVE CN161-OPER-UNT-ID       TO ASC-OPER-UNT-ID          06880058
068900         MOVE CN161-FCLTY-ID          TO ASC-FCLTY-ID             06890058
069000         MOVE CN161-FCLTY-NME         TO ASC-FCLTY-NME            06900058
069100         MOVE CN161-PRINTER-ID        TO ASC-PRTR-ID              06910068
069200         MOVE CN161-PRINTER-SELECT-TYPE                           06920058
069300                                      TO ASC-PRTR-SELECT-TYPE     06930055
069400     ELSE                                                         06940054
069500         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           06950054
069600         SET  PS-COMMAREA-NOT-VALID TO TRUE                       06960054
069700     END-IF.                                                      06970099
069800                                                                  06980054
069900                                                                  06990054
070000*----------------------------------------------------------------*07000054
070100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07010054
070200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07020054
070300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07030054
070400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07040054
070500* FUNCTION KEYS CAN GET THIS FAR.                                *07050054
070600*----------------------------------------------------------------*07060054
070700                                                                  07070054
070800 2000-PROCESS-PANEL.                                              07080054
070900     EVALUATE TRUE                                                07090054
071000         WHEN DP020-SRC-AID = DP016-CLEAR                         07100054
071100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07110054
071200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07120054
071300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07130054
071400                                                                  07140054
071500*F5-REFRESH                                                       07150073
071600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07160054
071700             PERFORM 2050-DELETE-LIST-QUEUE                       07170054
071800             PERFORM 4000-BUILD-INITIAL-PANEL                     07180054
071900                                                                  07190054
072000*F9-DESELECT                                                      07200073
072100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07210054
072200             PERFORM 2140-DESELECT-ALL-ITEMS                      07220054
072300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07230054
072400                                                                  07240054
072500*F21-SELECT ALL                                                   07250073
072600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07260054
072700             PERFORM 2150-SELECT-ALL-ITEMS                        07270054
072800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07280054
072900                                                                  07290054
073000         WHEN OTHER                                               07300054
073100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07310054
073200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07320054
073300             IF  PS-NO-ERROR                                      07330054
073400                 SET DP030-CONTINUE-GO                            07340054
073500                                 TO TRUE                          07350054
073600                 PERFORM 2100-CHECK-FUNCTION-KEY                  07360054
073700             ELSE                                                 07370054
073800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07380054
073900                 SET DP030-OVERRIDE-GO                            07390054
074000                                 TO TRUE                          07400054
074100             END-IF                                               07410054
074200     END-EVALUATE.                                                07420054
074300 EJECT                                                            07430054
074400*----------------------------------------------------------------*07440054
074500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07450054
074600*----------------------------------------------------------------*07460054
074700 2050-DELETE-LIST-QUEUE.                                          07470054
074800                                                                  07480089
074900     EXEC CICS                                                    07490054
075000         DELETEQ TS                                               07500054
075100             QUEUE (ASC-LIST-QUEUE-NAME)                          07510054
075200             RESP  (PV-CICS-RESP)                                 07520054
075300     END-EXEC.                                                    07530054
075400                                                                  07540054
075500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07550054
075600        (PV-CICS-RESP = DFHRESP(QIDERR))                          07560054
075700         CONTINUE                                                 07570054
075800     ELSE                                                         07580054
075900         SET DP013-CICS-ABEND      TO TRUE                        07590054
076000         SET DP013-NO-ROLLBACK     TO TRUE                        07600054
076100                                                                  07610054
076200         MOVE '2050-DELETE-LIST-QUEUE'                            07620054
076300                                   TO DP013-PARAGRAPH             07630054
076400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07640054
076500                                   TO DP013-MESSAGE-TEXT (1)      07650054
076600         PERFORM DP013-0000-PROCESS-ABEND                         07660054
076700     END-IF.                                                      07670054
076800                                                                  07680054
076900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07690054
077000 EJECT                                                            07700054
077100*----------------------------------------------------------------*07710054
077200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07720054
077300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07730054
077400* CICS ARCHITECTURE API.                                         *07740054
077500*----------------------------------------------------------------*07750054
077600 2100-CHECK-FUNCTION-KEY.                                         07760054
077700                                                                  07770054
077800     EVALUATE TRUE                                                07780054
077900*                                                                 07790054
078000* F13 - PRINTER ADD   (LOCAL-FUNC-01)                             07800054
078100* GOES TO CNKCS216 TO PROCESS PRINTER ID ADD                      07810099
078200* SINCE USER DOES NOT SELECT A LIST ITEM, SELECT QUEUE NOT USED   07820072
078300*                                                                 07830072
078400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07840054
078500                 INITIALIZE CN162-INTER-APPL-COMMAREA             07850058
078600                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07860054
078700                                TO CN162-NUMBER-OF-SELECTED-ITEMS 07870058
078800                 MOVE ASC-OPER-UNT-ID                             07880054
078900                                    TO CN162-OPER-UNT-ID          07890058
079000                 MOVE ASC-FCLTY-ID                                07900054
079100                                    TO CN162-FCLTY-ID             07910058
079200                 MOVE ASC-FCLTY-NME                               07920054
079300                                    TO CN162-FCLTY-NME            07930058
079400                 SET CN162-ADD      TO TRUE                       07940099
079500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07950054
079600*                                                                 07960054
079700* F15 - PRINTER UPDATE  (LOCAL-FUNC-02)                           07970054
079800* GOES TO CNKCS216 TO PROCESS PRINTER ID UPDATE                   07980099
079900* SINCE USER SELECTS A LIST ITEM, SELECT QUEUE IS USED            07990072
080000*                                                                 08000054
080100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08010054
080200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08020054
080300                 INITIALIZE CN162-INTER-APPL-COMMAREA             08030058
080400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08040054
080500                                TO CN162-NUMBER-OF-SELECTED-ITEMS 08050058
080600                 MOVE ASC-OPER-UNT-ID                             08060054
080700                                    TO CN162-OPER-UNT-ID          08070058
080800                 MOVE ASC-FCLTY-ID                                08080054
080900                                    TO CN162-FCLTY-ID             08090058
081000                 MOVE ASC-FCLTY-NME                               08100054
081100                                    TO CN162-FCLTY-NME            08110058
081200                 SET CN162-UPD      TO TRUE                       08120099
081300                 PERFORM 5000-PREPARE-SEL-QUEUE                   08130054
081400             ELSE                                                 08140054
081500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08150054
081600                 SET DP030-OVERRIDE-GO                            08160054
081700                                   TO TRUE                        08170054
081800                 MOVE PC-TSYMSG-00057                             08180054
081900                                   TO DP020-MSG-NUMBER            08190054
082000                 SET DP020-MSG-WARNING                            08200054
082100                                   TO TRUE                        08210054
082200             END-IF                                               08220054
082300*                                                                 08230064
082400* F16 - PRINTER DELETE  (LOCAL-FUNC-03)                           08240064
082500* GOES TO CNKCS216 TO PROCESS PRINTER ID DELETE                   08250099
082600* SINCE USER SELECTS A LIST ITEM, SELECT QUEUE IS USED            08260072
082700*                                                                 08270072
082800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08280065
082900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08290065
083000                 INITIALIZE CN162-INTER-APPL-COMMAREA             08300065
083100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08310065
083200                                TO CN162-NUMBER-OF-SELECTED-ITEMS 08320065
083300                 MOVE ASC-OPER-UNT-ID                             08330065
083400                                    TO CN162-OPER-UNT-ID          08340065
083500                 MOVE ASC-FCLTY-ID                                08350065
083600                                    TO CN162-FCLTY-ID             08360065
083700                 MOVE ASC-FCLTY-NME                               08370065
083800                                    TO CN162-FCLTY-NME            08380065
083900                 SET CN162-DEL      TO TRUE                       08390099
084000                 PERFORM 5000-PREPARE-SEL-QUEUE                   08400065
084100             ELSE                                                 08410065
084200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08420065
084300                 SET DP030-OVERRIDE-GO                            08430065
084400                                   TO TRUE                        08440065
084500                 MOVE PC-TSYMSG-00057                             08450065
084600                                   TO DP020-MSG-NUMBER            08460065
084700                 SET DP020-MSG-WARNING                            08470065
084800                                   TO TRUE                        08480065
084900             END-IF                                               08490065
085000*                                                                 08500072
085100*                                                                 08510064
085200* F6 - FIRST PAGE                                                 08520054
085300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08530054
085400             MOVE +1               TO PV-TOP-ITEM                 08540054
085500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08550054
085600*                                                                 08560054
085700* F7 - PREVIOUS PAGE                                              08570054
085800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08580054
085900             PERFORM 2110-BROWSE-BACKWARD                         08590054
086000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08600054
086100*                                                                 08610054
086200* F8 - NEXT PAGE                                                  08620054
086300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08630054
086400             PERFORM 2120-BROWSE-FORWARD                          08640054
086500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08650054
086600*                                                                 08660054
086700* ENTER KEY                                                       08670054
086800         WHEN DP020-SRC-AID = DP016-ENTER                         08680054
086900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08690054
087000             IF  PS-ERROR                                         08700054
087100                 CONTINUE                                         08710054
087200             ELSE                                                 08720054
087300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08730054
087400             END-IF                                               08740054
087500                                                                  08750054
087600         WHEN OTHER                                               08760054
087700             SET DP013-NO-ROLLBACK                                08770054
087800                 DP013-XCTL-DISPLAY-RESTART                       08780054
087900                 DP013-CICS-ABEND  TO TRUE                        08790054
088000             MOVE '2100-CHECK-FUNCTION-KEY'                       08800054
088100                                   TO DP013-PARAGRAPH             08810054
088200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08820054
088300                                   TO DP013-MESSAGE-TEXT (1)      08830054
088400             PERFORM DP013-0000-PROCESS-ABEND                     08840054
088500     END-EVALUATE.                                                08850054
088600*                                                                 08860099
088700*                                                                 08870099
088800*----------------------------------------------------------------*08880054
088900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08890054
089000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08900054
089100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08910054
089200*    MESSAGE.                                                    *08920054
089300*----------------------------------------------------------------*08930054
089400                                                                  08940054
089500 2110-BROWSE-BACKWARD.                                            08950054
089600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08960054
089700         GIVING PV-TOP-ITEM.                                      08970054
089800*                                                                 08980054
089900     IF  ((PV-TOP-ITEM < +1)                                      08990054
090000       OR (PV-TOP-ITEM = +1))                                     09000054
090100         MOVE +1                   TO PV-TOP-ITEM                 09010054
090200*        -- TOP OF LIST --                                        09020054
090300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09030054
090400         SET DP020-MSG-INFORMATIONAL TO TRUE                      09040054
090500     END-IF.                                                      09050054
090600                                                                  09060054
090700 EJECT                                                            09070054
090800*----------------------------------------------------------------*09080054
090900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09090054
091000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09100054
091100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09110054
091200*----------------------------------------------------------------*09120054
091300                                                                  09130054
091400 2120-BROWSE-FORWARD.                                             09140054
091500                                                                  09150054
091600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09160054
091700         GIVING PV-TOP-ITEM.                                      09170054
091800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09180054
091900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09190054
092000                                   TO PV-TOP-ITEM                 09200054
092100*        -- BOTTOM OF LIST --                                     09210054
092200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09220054
092300         SET DP020-MSG-INFORMATIONAL                              09230054
092400                                   TO TRUE                        09240054
092500     ELSE                                                         09250054
092600         COMPUTE PV-BOTTOM-ITEM =                                 09260054
092700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09270054
092800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09280054
092900*            -- BOTTOM OF LIST --                                 09290054
093000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09300054
093100             SET DP020-MSG-INFORMATIONAL                          09310054
093200                                   TO TRUE                        09320054
093300         END-IF                                                   09330054
093400     END-IF.                                                      09340054
093500 EJECT                                                            09350054
093600*----------------------------------------------------------------*09360054
093700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09370054
093800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09380054
093900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09390054
094000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09400054
094100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09410054
094200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09420054
094300*----------------------------------------------------------------*09430054
094400                                                                  09440054
094500 2130-CHECK-FOR-JUMP-BROWSE.                                      09450054
094600     SET PS-NO-ERROR               TO TRUE.                       09460054
094700     IF (ASC-START-ITEM-REQUEST = SPACE)                          09470054
094800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09480054
094900                                   TO PV-TOP-ITEM                 09490054
095000     ELSE                                                         09500054
095100         MOVE ASC-START-ITEM-REQUEST                              09510054
095200                                   TO DP010I-UNEDITED-FIELD       09520054
095300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09530054
095400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09540054
095500         SET DP010I-NEGATIVE-NOT-ALLOWED                          09550054
095600                                   TO TRUE                        09560054
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09571099
263455              USING DP010I-NUMERIC-EDIT-AREA                      09572099
095800                                                                  09580054
095900         IF  NOT DP010I-ERROR-DETECTED                            09590054
096000             MOVE DP010I-NUMERIC-FIELD                            09600054
096100                                   TO  ASC-START-ITEM-REQUEST-N   09610054
096200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09620054
096300                 IF  ASC-START-ITEM-REQUEST-N >                   09630054
096400                                          ASC-NUMBER-OF-ITEMS-READ09640054
096500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09650054
096600                     COMPUTE PV-TOP-ITEM =                        09660054
096700                             ASC-NUMBER-OF-ITEMS-READ             09670054
096800                             - PC-ITEMS-PER-PANEL + 1             09680054
096900                     IF  PV-TOP-ITEM < +1                         09690054
097000                         MOVE +1   TO PV-TOP-ITEM                 09700054
097100                         MOVE PC-TSYMSG-00070                     09710054
097200                                   TO DP020-MSG-NUMBER            09720054
097300                         SET DP020-MSG-INFORMATIONAL              09730054
097400                                   TO TRUE                        09740054
097500                     END-IF                                       09750054
097600                 ELSE                                             09760054
097700                     MOVE ASC-START-ITEM-REQUEST-N                09770054
097800                                   TO PV-TOP-ITEM                 09780054
097900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09790054
098000                     COMPUTE PV-BOTTOM-ITEM =                     09800054
098100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09810054
098200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09820054
098300*                        -- BOTTOM OF LIST --                     09830054
098400                         MOVE PC-TSYMSG-00070                     09840054
098500                                   TO DP020-MSG-NUMBER            09850054
098600                         SET DP020-MSG-INFORMATIONAL              09860054
098700                                   TO TRUE                        09870054
098800                     END-IF                                       09880054
098900                 END-IF                                           09890054
099000             ELSE                                                 09900054
099100*                --- VALUE OUT OF RANGE ----                      09910054
099200                 MOVE PC-TSYMSG-00101                             09920054
099300                                   TO DP020-MSG-NUMBER            09930054
099400                 MOVE -1           TO ASTRTITL                    09940054
099500                 SET DP030-SET-CURSOR-APPL-1                      09950054
099600                                   TO TRUE                        09960054
099700                 MOVE DP015-REVERSE                               09970054
099800                                   TO ASTRTITH                    09980054
099900                 MOVE DP015-RED    TO ASTRTITC                    09990054
100000                 MOVE DP015-UNP-NUM-BRT-MDT                       10000054
100100                                   TO ASTRTITA                    10010054
100200                 SET DP020-MSG-FATAL                              10020054
100300                                   TO TRUE                        10030054
100400                 SET PS-ERROR      TO TRUE                        10040054
100500             END-IF                                               10050054
100600                                                                  10060054
100700         ELSE                                                     10070054
100800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10080054
100900             MOVE -1               TO ASTRTITL                    10090054
101000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10100054
101100             MOVE DP015-REVERSE    TO ASTRTITH                    10110054
101200             MOVE DP015-RED        TO ASTRTITC                    10120054
101300             MOVE DP015-UNP-NUM-BRT-MDT                           10130054
101400                                   TO ASTRTITA                    10140054
101500             SET DP020-MSG-FATAL   TO TRUE                        10150054
101600             SET PS-ERROR          TO TRUE                        10160054
101700         END-IF                                                   10170054
101800     END-IF.                                                      10180054
101900 EJECT                                                            10190054
102000*----------------------------------------------------------------*10200054
102100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10210054
102200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10220054
102300*----------------------------------------------------------------*10230054
102400 2140-DESELECT-ALL-ITEMS.                                         10240054
102500     MOVE +1                       TO ASC-BLK-SUB.                10250054
102600                                                                  10260054
102700     PERFORM 2141-CLEAR-SELECTED-INDS                             10270054
102800         VARYING ASC-ITEM-SUB                                     10280054
102900         FROM 1 BY 1                                              10290054
103000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10300054
103100                                                                  10310054
103200     ADD +1                        TO ASC-BLK-SUB.                10320054
103300                                                                  10330054
103400     PERFORM 2141-CLEAR-SELECTED-INDS                             10340054
103500         VARYING ASC-ITEM-SUB                                     10350054
103600         FROM 1 BY 1                                              10360054
103700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10370054
103800                                                                  10380054
103900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10390054
104000                                   TO PV-LIST-ITEM-NUMBER.        10400054
104100                                                                  10410054
104200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10420054
104300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10430054
104400                                                                  10440054
104500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10450054
104600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10460054
104700         MOVE +1                   TO ASC-BLK-SUB                 10470054
104800                                                                  10480054
104900         PERFORM 5100-WRITE-TEMP-STORAGE                          10490054
105000                                                                  10500054
105100         MOVE +1                   TO PV-BLOCK-NUMBER             10510054
105200                                                                  10520054
105300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10530054
105400             PV-FIRST-BLOCK-IN-ARRAY - 1                          10540054
105500                                                                  10550054
105600         PERFORM                                                  10560054
105700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10570054
105800                                                                  10580054
105900             PERFORM 4410-READ-TEMP-STORAGE                       10590054
106000                                                                  10600054
106100             PERFORM 2141-CLEAR-SELECTED-INDS                     10610054
106200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10620054
106300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10630054
106400                                                                  10640054
106500             PERFORM 5100-WRITE-TEMP-STORAGE                      10650054
106600                                                                  10660054
106700             ADD +1                TO PV-BLOCK-NUMBER             10670054
106800                                                                  10680054
106900         END-PERFORM                                              10690054
107000                                                                  10700054
107100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10710054
107200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10720054
107300                                                                  10730054
107400         PERFORM                                                  10740054
107500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10750054
107600                   ASC-HIGHEST-BLOCK-WRITTEN                      10760054
107700                                                                  10770054
107800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10780054
107900                                   TO PV-BLOCK-NUMBER             10790054
108000                                                                  10800054
108100             PERFORM 4410-READ-TEMP-STORAGE                       10810054
108200                                                                  10820054
108300             PERFORM 2141-CLEAR-SELECTED-INDS                     10830054
108400                 VARYING ASC-ITEM-SUB                             10840054
108500                 FROM 1 BY 1                                      10850054
108600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10860054
108700                                                                  10870054
108800             PERFORM 5100-WRITE-TEMP-STORAGE                      10880054
108900                                                                  10890054
109000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10900054
109100                                                                  10910054
109200         END-PERFORM                                              10920054
109300                                                                  10930054
109400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10940054
109500                                   TO PV-BLOCK-NUMBER             10950054
109600                                                                  10960054
109700         PERFORM 4410-READ-TEMP-STORAGE                           10970054
109800     END-IF.                                                      10980054
109900                                                                  10990054
110000                                                                  11000054
110100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11010054
110200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11020054
110300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11030054
110400                                                                  11040054
110500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11050054
110600                                                                  11060054
110700 EJECT                                                            11070054
110800*----------------------------------------------------------------*11080054
110900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11090054
111000*----------------------------------------------------------------*11100054
111100                                                                  11110054
111200 2141-CLEAR-SELECTED-INDS.                                        11120054
111300                                                                  11130054
111400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11140054
111500             NOT EQUAL ZERO                                       11150054
111600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11160054
111700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11170054
111800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11180054
111900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11190054
112000                                   TO TRUE                        11200054
112100         END-IF                                                   11210054
112200     END-IF.                                                      11220054
112300                                                                  11230054
112400 EJECT                                                            11240054
112500*----------------------------------------------------------------*11250054
112600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11260054
112700*  FOR ALL ITEMS.                                                *11270054
112800*----------------------------------------------------------------*11280054
112900                                                                  11290054
113000 2150-SELECT-ALL-ITEMS.                                           11300054
113100                                                                  11310054
113200     MOVE +1                       TO ASC-BLK-SUB.                11320054
113300                                                                  11330054
113400     PERFORM 2151-SET-SELECTED-INDS                               11340054
113500         VARYING ASC-ITEM-SUB                                     11350054
113600         FROM 1 BY 1                                              11360054
113700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11370054
113800                                                                  11380054
113900     ADD +1                        TO ASC-BLK-SUB.                11390054
114000                                                                  11400054
114100     PERFORM 2151-SET-SELECTED-INDS                               11410054
114200         VARYING ASC-ITEM-SUB                                     11420054
114300         FROM 1 BY 1                                              11430054
114400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11440054
114500                                                                  11450054
114600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11460054
114700                                   TO PV-LIST-ITEM-NUMBER.        11470054
114800                                                                  11480054
114900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11490054
115000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11500054
115100                                                                  11510054
115200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11520054
115300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11530054
115400         MOVE +1                   TO ASC-BLK-SUB                 11540054
115500                                                                  11550054
115600         PERFORM 5100-WRITE-TEMP-STORAGE                          11560054
115700                                                                  11570054
115800         MOVE +1                   TO PV-BLOCK-NUMBER             11580054
115900                                                                  11590054
116000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11600054
116100             PV-FIRST-BLOCK-IN-ARRAY - 1                          11610054
116200                                                                  11620054
116300         PERFORM                                                  11630054
116400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11640054
116500                                                                  11650054
116600             PERFORM 4410-READ-TEMP-STORAGE                       11660054
116700                                                                  11670054
116800             PERFORM 2151-SET-SELECTED-INDS                       11680054
116900                 VARYING ASC-ITEM-SUB                             11690054
117000                 FROM 1 BY 1                                      11700054
117100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11710054
117200                                                                  11720054
117300             PERFORM 5100-WRITE-TEMP-STORAGE                      11730054
117400                                                                  11740054
117500             ADD +1                TO PV-BLOCK-NUMBER             11750054
117600                                                                  11760054
117700         END-PERFORM                                              11770054
117800                                                                  11780054
117900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11790054
118000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11800054
118100                                                                  11810054
118200         PERFORM                                                  11820054
118300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11830054
118400                   ASC-HIGHEST-BLOCK-WRITTEN                      11840054
118500                                                                  11850054
118600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11860054
118700                                   TO PV-BLOCK-NUMBER             11870054
118800                                                                  11880054
118900             PERFORM 4410-READ-TEMP-STORAGE                       11890054
119000                                                                  11900054
119100             PERFORM 2151-SET-SELECTED-INDS                       11910054
119200                 VARYING ASC-ITEM-SUB                             11920054
119300                 FROM 1 BY 1                                      11930054
119400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11940054
119500                                                                  11950054
119600             PERFORM 5100-WRITE-TEMP-STORAGE                      11960054
119700                                                                  11970054
119800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11980054
119900                                                                  11990054
120000         END-PERFORM                                              12000054
120100                                                                  12010054
120200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12020054
120300                                   TO PV-BLOCK-NUMBER             12030054
120400                                                                  12040054
120500         PERFORM 4410-READ-TEMP-STORAGE                           12050054
120600     END-IF.                                                      12060054
120700                                                                  12070054
120800                                                                  12080054
120900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12090054
121000                       ASC-NUMBER-OF-SELECTED-ITEMS.              12100054
121100                                                                  12110054
121200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12120054
121300                                                                  12130054
121400 EJECT                                                            12140054
121500*----------------------------------------------------------------*12150054
121600*    MARK EACH ITEM AS BEING SELECTED.                           *12160054
121700*----------------------------------------------------------------*12170054
121800                                                                  12180054
121900 2151-SET-SELECTED-INDS.                                          12190054
122000                                                                  12200054
122100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12210054
122200             NOT EQUAL ZERO                                       12220054
122300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12230054
122400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12240054
122500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12250054
122600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12260054
122700                               TO  TRUE                           12270054
122800         END-IF                                                   12280054
122900     END-IF.                                                      12290054
123000******************************************************************12300054
123100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12310054
123200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12320054
123300******************************************************************12330054
123400 2200-MOVE-SCREEN-TO-COMMAREA.                                    12340054
123500                                                                  12350054
123600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12360054
123700     MOVE +1                       TO PV-SUB.                     12370054
123800                                                                  12380099
123900     PERFORM 3100-SET-SUBSCRIPTS.                                 12390054
124000     IF  ASTRTITL > ZERO                                          12400054
124100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12410054
124200     ELSE                                                         12420054
124300         IF  ASTRTITF = DP015-ERASE-EOF                           12430054
124400             INITIALIZE ASC-START-ITEM-REQUEST                    12440054
124500         END-IF                                                   12450054
124600     END-IF.                                                      12460054
124700                                                                  12470054
124800                                                                  12480054
124900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12490054
125000         VARYING PV-SUB                                           12500054
125100         FROM 1 BY 1                                              12510054
125200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12520054
125300******************************************************************12530054
125400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12540054
125500******************************************************************12550054
125600 2210-MOVE-LINES-TO-COMMAREA.                                     12560054
125700     IF  MR-SELECTL (PV-SUB) > ZERO                               12570054
125800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12580054
125900         MOVE MR-SELECTI (PV-SUB)                                 12590054
126000                                   TO ASC-TEMP-SELECTED-SW        12600054
126100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12610054
126200     ELSE                                                         12620054
126300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12630054
126400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12640054
126500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12650054
126600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12660054
126700         END-IF                                                   12670054
126800     END-IF.                                                      12680054
126900                                                                  12690054
127000     ADD +1                        TO ASC-ITEM-SUB.               12700054
127100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12710054
127200         ADD +1                    TO ASC-BLK-SUB                 12720054
127300         MOVE +1                   TO ASC-ITEM-SUB                12730054
127400     END-IF.                                                      12740054
127500******************************************************************12750054
127600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12760054
127700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12770054
127800******************************************************************12780054
127900 3000-EDIT-DATA-IN-COMMAREA.                                      12790054
128000     SET PS-NO-ERROR               TO TRUE.                       12800054
128100     PERFORM 3200-RESET-ATTRIBUTES.                               12810054
128200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12820054
128300                                                                  12830054
128400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12840054
128500* EDITTING IS DONE FROM THE BOTTOM UP.                            12850054
128600**                                                                12860054
128700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12870054
128800         ASC-ITEMS-DISPLAYED - 1.                                 12880054
128900     PERFORM 3100-SET-SUBSCRIPTS.                                 12890054
129000                                                                  12900054
129100      IF  PS-NO-ERROR                                             12910054
129200          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       12920054
129300      END-IF.                                                     12930054
129400*                                                                 12940054
129500     IF  PS-NO-ERROR                                              12950054
129600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12960054
129700     END-IF.                                                      12970054
129800*                                                                 12980054
129900     IF  ((PS-NO-ERROR)                                           12990054
130000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13000054
130100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13010054
130200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13020054
130300     END-IF.                                                      13030054
130400                                                                  13040054
130500                                                                  13050054
130600*----------------------------------------------------------------*13060054
130700* 3005-EDIT-COMMAREA-BLOCKS                                      *13070054
130800*----------------------------------------------------------------*13080054
130900 3005-EDIT-COMMAREA-BLOCKS.                                       13090054
131000     MOVE +1                       TO PV-BLOCK-NUMBER.            13100054
131100     MOVE +1                       TO ASC-BLK-SUB.                13110054
131200     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               13120054
131300                                                                  13130054
131400     COMPUTE PV-BLOCK-NUMBER  =                                   13140054
131500             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            13150054
131600             PC-ITEMS-PER-PANEL.                                  13160054
131700                                                                  13170054
131800     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          13180054
131900                                                                  13190054
132000     PERFORM                                                      13200054
132100        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         13210054
132200           OR PS-ERROR                                            13220054
132300           OR PS-BLOCK-ERROR                                      13230054
132400                                                                  13240054
132500              COMPUTE PV-ITEMS-HOLD  =                            13250054
132600                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       13260054
132700                      PC-ITEMS-PER-PANEL - 1                      13270054
132800                                                                  13280054
132900               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     13290054
133000                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             13300054
133100                       FROM  PV-ITEMS-HOLD                        13310054
133200                     GIVING  PV-ITEMS-DIFF                        13320054
133300                   SUBTRACT  PV-ITEMS-DIFF                        13330054
133400                       FROM  PC-ITEMS-PER-PANEL                   13340054
133500                     GIVING  PV-ITEMS-HOLD                        13350054
133600                       MOVE  PV-ITEMS-HOLD TO PV-SUB              13360054
133700                                              ASC-ITEM-SUB        13370054
133800                                              ASC-ITEMS-DISPLAYED 13380054
133900                                                                  13390054
134000               ELSE                                               13400054
134100                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            13410054
134200                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      13420054
134300               END-IF                                             13430054
134400                                                                  13440054
134500               PERFORM 3300-EDIT-SELECTIONS                       13450054
134600                       VARYING PV-SUB                             13460054
134700                          FROM PV-SUB BY -1                       13470054
134800                          UNTIL PV-SUB < +1                       13480054
134900                                                                  13490054
135000                                                                  13500054
135100               MOVE +1               TO ASC-BLK-SUB               13510054
135200                                                                  13520054
135300               PERFORM 5105-REWRITE-ASC-LISTQ                     13530054
135400                                                                  13540054
135500               MOVE +1                TO ASC-BLK-SUB              13550054
135600                                                                  13560054
135700               IF  PS-BLOCK-ERROR                                 13570054
135800                   SET  PS-ERROR     TO TRUE                      13580054
135900                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      13590054
136000                                     TO PV-TOP-ITEM               13600054
136100               ELSE                                               13610054
136200                   ADD  +1           TO PV-BLOCK-NUMBER           13620054
136300                   IF  PV-BLOCK-NUMBER >                          13630054
136400                       ASC-HIGHEST-BLOCK-WRITTEN                  13640054
136500                       MOVE +2       TO ASC-BLK-SUB               13650054
136600                       PERFORM 4410-READ-TEMP-STORAGE             13660054
136700                       MOVE +1       TO ASC-BLK-SUB               13670054
136800                   ELSE                                           13680054
136900                       PERFORM 4410-READ-TEMP-STORAGE             13690054
137000                       ADD  +1        TO PV-BLOCK-NUMBER          13700054
137100                       MOVE +2        TO ASC-BLK-SUB              13710054
137200                       PERFORM 4410-READ-TEMP-STORAGE             13720054
137300                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          13730054
137400                       MOVE +1        TO ASC-BLK-SUB              13740054
137500               END-IF                                             13750054
137600           END-IF                                                 13760054
137700     END-PERFORM.                                                 13770054
137800                                                                  13780054
137900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            13790054
138000         PS-ERROR                   OR                            13800054
138100         PS-BLOCK-ERROR                                           13810054
138200             CONTINUE                                             13820054
138300     ELSE                                                         13830054
138400         MOVE +1                 TO PV-BLOCK-NUMBER               13840054
138500         MOVE +1                 TO ASC-BLK-SUB                   13850054
138600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13860054
138700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           13870054
138800         PERFORM 4410-READ-TEMP-STORAGE                           13880054
138900                                                                  13890054
139000         PERFORM                                                  13900054
139100            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             13910054
139200               OR PS-ERROR                                        13920054
139300               OR PS-BLOCK-ERROR                                  13930054
139400                                                                  13940054
139500                  COMPUTE PV-ITEMS-HOLD  =                        13950054
139600                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   13960054
139700                          PC-ITEMS-PER-PANEL - 1                  13970054
139800                                                                  13980054
139900                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    13990054
140000                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          14000054
140100                          FROM  PV-ITEMS-HOLD                     14010054
140200                        GIVING  PV-ITEMS-DIFF                     14020054
140300                      SUBTRACT  PV-ITEMS-DIFF                     14030054
140400                          FROM  PC-ITEMS-PER-PANEL                14040054
140500                        GIVING  PV-ITEMS-HOLD                     14050054
140600                          MOVE  PV-ITEMS-HOLD TO PV-SUB           14060054
140700                                                 ASC-ITEM-SUB     14070054
140800                                              ASC-ITEMS-DISPLAYED 14080054
140900                  ELSE                                            14090054
141000                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         14100054
141100                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   14110054
141200                  END-IF                                          14120054
141300                                                                  14130054
141400                  PERFORM 3300-EDIT-SELECTIONS                    14140054
141500                          VARYING PV-SUB                          14150054
141600                             FROM PV-SUB BY -1                    14160054
141700                            UNTIL PV-SUB < +1                     14170054
141800                                                                  14180054
141900                                                                  14190054
142000                  MOVE +1               TO ASC-BLK-SUB            14200054
142100                                                                  14210054
142200                  PERFORM 5105-REWRITE-ASC-LISTQ                  14220054
142300                                                                  14230054
142400                  MOVE +1                TO ASC-BLK-SUB           14240054
142500                                                                  14250054
142600                  IF  PS-BLOCK-ERROR                              14260054
142700                      SET  PS-ERROR     TO TRUE                   14270054
142800                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   14280054
142900                                        TO PV-TOP-ITEM            14290054
143000                  ELSE                                            14300054
143100                      ADD  +1            TO PV-BLOCK-NUMBER       14310054
143200                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     14320054
143300                          MOVE +2        TO ASC-BLK-SUB           14330054
143400                          PERFORM 4410-READ-TEMP-STORAGE          14340054
143500                          MOVE +1        TO ASC-BLK-SUB           14350054
143600                      ELSE                                        14360054
143700                          PERFORM 4410-READ-TEMP-STORAGE          14370054
143800                          ADD  +1        TO PV-BLOCK-NUMBER       14380054
143900                          MOVE +2        TO ASC-BLK-SUB           14390054
144000                          PERFORM 4410-READ-TEMP-STORAGE          14400054
144100                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       14410054
144200                          MOVE +1        TO ASC-BLK-SUB           14420054
144300                      END-IF                                      14430054
144400                  END-IF                                          14440054
144500     END-PERFORM.                                                 14450054
144600*                                                                 14460099
144700*                                                                 14470099
144800*----------------------------------------------------------------*14480054
144900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14490054
145000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14500054
145100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14510054
145200*                                                                *14520054
145300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14530054
145400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14540054
145500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14550054
145600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14560054
145700*----------------------------------------------------------------*14570054
145800                                                                  14580054
145900 3100-SET-SUBSCRIPTS.                                             14590054
146000                                                                  14600054
146100     COMPUTE ASC-ITEM-SUB =                                       14610054
146200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14620054
146300                                                                  14630054
146400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14640054
146500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14650054
146600                                                                  14660054
146700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14670054
146800     ELSE                                                         14680054
146900         MOVE +1                     TO ASC-BLK-SUB               14690054
147000     END-IF.                                                      14700054
147100******************************************************************14710054
147200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14720054
147300******************************************************************14730054
147400                                                                  14740054
147500 3200-RESET-ATTRIBUTES.                                           14750054
147600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    14760054
147700     MOVE DP015-GREEN              TO ASTRTITC                    14770054
147800     MOVE DP015-UNDERLINE          TO ASTRTITH                    14780054
147900                                                                  14790099
148000     PERFORM                                                      14800054
148100         VARYING PV-SUB                                           14810054
148200         FROM 1 BY 1                                              14820054
148300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14830054
148400         MOVE DP015-UNP-ALP-NOR-OFF                               14840054
148500                                   TO MR-SELECTA (PV-SUB)         14850054
148600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14860054
148700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14870054
148800     END-PERFORM.                                                 14880054
148900******************************************************************14890054
149000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14900054
149100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14910054
149200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14920054
149300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14930054
149400******************************************************************14940054
149500 3300-EDIT-SELECTIONS.                                            14950054
149600     EVALUATE TRUE                                                14960054
149700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14970054
149800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14980054
149900                 CONTINUE                                         14990054
150000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15000054
150100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15010054
150200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15020054
150300                 MOVE ASC-TEMP-SELECTED-SW                        15030054
150400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15040054
150500                                TO ASC-SELECTED-SW                15050054
150600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15060054
150700             END-IF                                               15070054
150800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15080054
150900                 = SPACE                                          15090054
151000             EVALUATE TRUE                                        15100054
151100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15110054
151200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15120054
151300                     MOVE SPACE TO ASC-SELECTED-SW                15130054
151400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15140054
151500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15150054
151600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15160054
151700                     MOVE SPACE TO ASC-SELECTED-SW                15170054
151800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15180054
151900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15190054
152000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15200054
152100                     MOVE SPACE TO ASC-SELECTED-SW                15210054
152200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15220054
152300             END-EVALUATE                                         15230054
152400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15240054
152500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15250054
152600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15260054
152700             END-IF                                               15270054
152800             PERFORM 3310-EDIT-RANGE                              15280054
152900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15290054
153000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15300054
153100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15310054
153200             END-IF                                               15320054
153300             PERFORM 3310-EDIT-RANGE                              15330054
153400         WHEN OTHER                                               15340054
153500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15350054
153600             SET DP020-MSG-FATAL    TO TRUE                       15360054
153700             MOVE -1                TO MR-SELECTL (PV-SUB)        15370054
153800             SET DP030-SET-CURSOR-APPL-1                          15380054
153900                                    TO TRUE                       15390054
154000             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15400054
154100             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15410054
154200             SET PS-ERROR TO TRUE                                 15420054
154300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15430054
154400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15440054
154500                 MOVE SPACE         TO ASC-SELECTED-SW            15450054
154600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15460054
154700             END-IF                                               15470054
154800     END-EVALUATE.                                                15480054
154900                                                                  15490054
155000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15500054
155100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15510054
155200     IF  ASC-ITEM-SUB < 1                                         15520054
155300         SUBTRACT +1 FROM ASC-BLK-SUB                             15530054
155400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15540054
155500     END-IF.                                                      15550054
155600                                                                  15560054
155700                                                                  15570054
155800******************************************************************15580054
155900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15590054
156000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15600054
156100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15610054
156200** THE ENDING.                                                  **15620054
156300******************************************************************15630054
156400 3310-EDIT-RANGE.                                                 15640054
156500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15650054
156600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15660054
156700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15670054
156800                                   TO ASC-SELECTED-SW             15680054
156900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15690054
157000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15700054
157100         ELSE                                                     15710054
157200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15720054
157300                 CONTINUE                                         15730054
157400             ELSE                                                 15740054
157500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15750054
157600                 MOVE PC-TSYMSG-00054                             15760054
157700                                   TO DP020-MSG-NUMBER            15770054
157800                 SET DP020-MSG-FATAL                              15780054
157900                                   TO TRUE                        15790054
158000                 MOVE -1           TO MR-SELECTL (PV-SUB)         15800054
158100                 SET DP030-SET-CURSOR-APPL-1                      15810054
158200                                   TO TRUE                        15820054
158300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15830054
158400                 MOVE DP015-UNDERLINE                             15840054
158500                                   TO MR-SELECTH (PV-SUB)         15850054
158600                 SET PS-ERROR      TO TRUE                        15860054
158700             END-IF                                               15870054
158800         END-IF                                                   15880054
158900     ELSE                                                         15890054
159000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15900054
159100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15910054
159200                                   TO ASC-SELECTED-SW             15920054
159300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15930054
159400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15940054
159500         ELSE                                                     15950054
159600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15960054
159700                 CONTINUE                                         15970054
159800             ELSE                                                 15980054
159900*                -- ONLY ONE END-OF-RANGE ALLOWED --              15990054
160000                 MOVE PC-TSYMSG-00055                             16000054
160100                                   TO DP020-MSG-NUMBER            16010054
160200                 SET DP020-MSG-FATAL                              16020054
160300                                   TO TRUE                        16030054
160400                 MOVE -1           TO MR-SELECTL (PV-SUB)         16040054
160500                 SET DP030-SET-CURSOR-APPL-1                      16050054
160600                                   TO TRUE                        16060054
160700                 SET PS-ERROR      TO TRUE                        16070054
160800             END-IF                                               16080054
160900         END-IF                                                   16090054
161000     END-IF.                                                      16100054
161100*                                                                 16110054
161200******************************************************************16120054
161300** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **16130054
161400** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **16140054
161500******************************************************************16150054
161600 3400-CHECK-RANGE-SEQUENCE.                                       16160054
161700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16170054
161800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16180054
161900       AND  ASC-START-OF-SELECTED-RANGE >                         16190054
162000                                         ASC-END-OF-SELECTED-RANGE16200054
162100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16210054
162200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16220054
162300         SET DP020-MSG-FATAL TO TRUE                              16230054
162400         SET PS-ERROR TO TRUE                                     16240054
162500         PERFORM 3410-POSITION-AT-ERROR                           16250054
162600     END-IF.                                                      16260054
162700******************************************************************16270054
162800** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16280054
162900** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16290054
163000** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16300054
163100******************************************************************16310054
163200 3410-POSITION-AT-ERROR.                                          16320054
163300     SET DP030-SET-CURSOR-APPL-1                                  16330054
163400                                   TO TRUE.                       16340054
163500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16350054
163600                    - PV-TOP-ITEM + 1.                            16360054
163700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16370054
163800         CONTINUE                                                 16380054
163900     ELSE                                                         16390054
164000         MOVE -1                   TO MR-SELECTL (PV-SUB)         16400054
164100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16410054
164200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16420054
164300     END-IF.                                                      16430054
164400*                                                                 16440054
164500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16450054
164600                    - PV-TOP-ITEM + 1.                            16460054
164700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16470054
164800         CONTINUE                                                 16480054
164900     ELSE                                                         16490054
165000         MOVE -1                   TO MR-SELECTL (PV-SUB)         16500054
165100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16510054
165200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16520054
165300     END-IF.                                                      16530054
165400 EJECT                                                            16540054
165500*----------------------------------------------------------------*16550054
165600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16560054
165700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16570054
165800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16580054
165900*----------------------------------------------------------------*16590054
166000                                                                  16600054
166100 3500-MARK-RANGE-AS-SELECTED.                                     16610054
166200     MOVE +1                       TO  ASC-BLK-SUB.               16620054
166300     PERFORM 3510-MARK-SELECTED-INDS                              16630054
166400         VARYING ASC-ITEM-SUB                                     16640054
166500         FROM 1 BY 1                                              16650054
166600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16660054
166700                                                                  16670054
166800     ADD +1                        TO ASC-BLK-SUB.                16680054
166900     PERFORM 3510-MARK-SELECTED-INDS                              16690054
167000         VARYING ASC-ITEM-SUB                                     16700054
167100         FROM 1 BY 1                                              16710054
167200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16720054
167300                                                                  16730054
167400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16740054
167500                                   TO  PV-LIST-ITEM-NUMBER.       16750054
167600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16760054
167700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16770054
167800               PC-ITEMS-PER-PANEL).                               16780054
167900                                                                  16790054
168000     MOVE ASC-START-OF-SELECTED-RANGE                             16800054
168100                                   TO PV-START-OF-SELECTED-RANGE. 16810054
168200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16820054
168300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16830054
168400               PC-ITEMS-PER-PANEL).                               16840054
168500                                                                  16850054
168600     MOVE ASC-END-OF-SELECTED-RANGE                               16860054
168700                                   TO  PV-END-OF-SELECTED-RANGE.  16870054
168800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16880054
168900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16890054
169000               PC-ITEMS-PER-PANEL).                               16900054
169100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16910054
169200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16920054
169300                                                                  16930054
169400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16940054
169500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16950054
169600         MOVE +1                   TO ASC-BLK-SUB                 16960054
169700         PERFORM 5100-WRITE-TEMP-STORAGE                          16970054
169800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16980054
169900             PV-FIRST-BLOCK-IN-ARRAY - 1                          16990054
170000                                                                  17000054
170100         PERFORM                                                  17010054
170200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17020054
170300                   PV-PREV-BLOCK-IN-ARRAY                         17030054
170400             MOVE PV-FIRST-BLOCK-IN-RANGE                         17040054
170500                                   TO PV-BLOCK-NUMBER             17050054
170600             PERFORM 4410-READ-TEMP-STORAGE                       17060054
170700             PERFORM 3510-MARK-SELECTED-INDS                      17070054
170800                 VARYING ASC-ITEM-SUB                             17080054
170900                 FROM 1 BY 1                                      17090054
171000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17100054
171100             PERFORM 5100-WRITE-TEMP-STORAGE                      17110054
171200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17120054
171300         END-PERFORM                                              17130054
171400                                                                  17140054
171500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17150054
171600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17160054
171700         PERFORM                                                  17170054
171800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17180054
171900                   PV-LAST-BLOCK-IN-RANGE                         17190054
172000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17200054
172100                                   TO PV-BLOCK-NUMBER             17210054
172200             PERFORM 4410-READ-TEMP-STORAGE                       17220054
172300             PERFORM 3510-MARK-SELECTED-INDS                      17230054
172400                 VARYING ASC-ITEM-SUB                             17240054
172500                 FROM 1 BY 1                                      17250054
172600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17260054
172700             PERFORM 5100-WRITE-TEMP-STORAGE                      17270054
172800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17280054
172900         END-PERFORM                                              17290054
173000                                                                  17300054
173100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17310054
173200                                   TO PV-BLOCK-NUMBER             17320054
173300         PERFORM 4410-READ-TEMP-STORAGE                           17330054
173400     END-IF.                                                      17340054
173500                                                                  17350054
173600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17360054
173700                                      ASC-END-OF-SELECTED-RANGE.  17370054
173800                                                                  17380054
173900 EJECT                                                            17390054
174000*----------------------------------------------------------------*17400054
174100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17410054
174200*----------------------------------------------------------------*17420054
174300                                                                  17430054
174400 3510-MARK-SELECTED-INDS.                                         17440054
174500                                                                  17450054
174600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17460054
174700                                ASC-ITEM-SUB) >                   17470054
174800         ASC-START-OF-SELECTED-RANGE)                             17480054
174900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17490054
175000                                ASC-ITEM-SUB) =                   17500054
175100         ASC-START-OF-SELECTED-RANGE)                             17510054
175200                                                                  17520054
175300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17530054
175400                                    ASC-ITEM-SUB) <               17540054
175500             ASC-END-OF-SELECTED-RANGE)                           17550054
175600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17560054
175700                                    ASC-ITEM-SUB) =               17570054
175800             ASC-END-OF-SELECTED-RANGE)                           17580054
175900                                                                  17590054
176000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17600054
176100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17610054
176200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17620054
176300                               TO TRUE                            17630054
176400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17640054
176500                               TO TRUE                            17650054
176600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17660054
176700             END-IF                                               17670054
176800         END-IF                                                   17680054
176900     END-IF.                                                      17690054
177000                                                                  17700054
177100                                                                  17710054
177200*----------------------------------------------------------------*17720054
177300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17730054
177400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17740054
177500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17750054
177600*    DISPLAY THE PANEL TO USER.                                  *17760054
177700*----------------------------------------------------------------*17770054
177800                                                                  17780054
177900 4000-BUILD-INITIAL-PANEL.                                        17790054
178000                                                                  17800054
178100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17810054
178200                                 ASC-BLOCK-ENTRIES (2).           17820054
178300     MOVE +1                 TO ASC-BLK-SUB.                      17830054
178400     SET ASC-ITEMS-LEFT-ON-DB                                     17840054
178500                             TO TRUE.                             17850054
178600                                                                  17860054
178700     MOVE +0                 TO ASC-ITEM-SUB                      17870054
178800                                ASC-NUMBER-OF-ITEMS-READ          17880054
178900                                ASC-NUMBER-OF-SELECTED-ITEMS      17890054
179000                                ASC-HIGHEST-BLOCK-WRITTEN         17900054
179100                                ASC-START-OF-SELECTED-RANGE       17910054
179200                                ASC-END-OF-SELECTED-RANGE         17920054
179300                                ASC-ITEM-AT-TOP-OF-PANEL.         17930054
179400                                                                  17940054
179500     PERFORM 4100-PREPARE-CURSOR                                  17950054
179600                                                                  17960054
179700     PERFORM 4010-OPEN-CURSOR.                                    17970054
179800                                                                  17980054
179900     PERFORM 4300-READ-ITEMS-FROM-DB.                             17990054
180000                                                                  18000054
180100     PERFORM 4020-CLOSE-CURSOR.                                   18010054
180200                                                                  18020054
180300     MOVE +1                   TO  PV-TOP-ITEM.                   18030054
180400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18040054
180500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    18050054
180600         SET DP020-MSG-FATAL   TO  TRUE                           18060054
180700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               18070054
180800     ELSE                                                         18080054
180900         MOVE -1               TO MR-SELECTL (1)                  18090054
181000         SET DP030-SET-CURSOR-APPL-1                              18100054
181100                               TO TRUE                            18110054
181200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18120054
181300     END-IF.                                                      18130054
181400 EJECT                                                            18140054
181500*                                                                 18150054
181600*----------------------------------------------------------------*18160054
181700* OPEN CURSOR                                                    *18170054
181800*----------------------------------------------------------------*18180054
181900 4010-OPEN-CURSOR.                                                18190054
182000     PERFORM                                                      18200054
182100         WITH TEST AFTER                                          18210054
182200         VARYING PV-RETRY-COUNTER                                 18220054
182300         FROM 1 BY 1                                              18230054
182400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18240054
182500                   OR (SQLCODE = ZERO))                           18250054
182600                                                                  18260054
182700         EVALUATE TRUE                                            18270054
182800             WHEN ASC-PRTR-LIST-ALL-CURSOR                        18280054
182900                  MOVE 'CURSOR:  PRTR-LIST-ALL-CSR'               18290054
183000                              TO DP013-MESSAGE-TEXT (2)           18300054
183100                  EXEC SQL                                        18310054
183200                       OPEN PRTR-LIST-ALL-CSR                     18320054
183300                  END-EXEC                                        18330054
183400                                                                  18340054
183500             WHEN ASC-PRTR-LIST-LBL-CURSOR                        18350054
183600                  MOVE 'CURSOR:  PRTR-LIST-LBL-CSR'               18360054
183700                              TO DP013-MESSAGE-TEXT (2)           18370054
183800                  EXEC SQL                                        18380054
183900                       OPEN PRTR-LIST-LBL-CSR                     18390054
184000                  END-EXEC                                        18400054
184100                                                                  18410054
184200             WHEN ASC-PRTR-LIST-LNE-CURSOR                        18420054
184300                  MOVE 'CURSOR:  PRTR-LIST-LNE-CSR'               18430054
184400                              TO DP013-MESSAGE-TEXT (2)           18440054
184500                  EXEC SQL                                        18450054
184600                       OPEN PRTR-LIST-LNE-CSR                     18460054
184700                  END-EXEC                                        18470054
184800                                                                  18480054
184900             WHEN ASC-PRTR-ID-ALL-CURSOR                          18490054
185000                  MOVE 'CURSOR:  PRTR-ID-ALL-CSR'                 18500054
185100                              TO DP013-MESSAGE-TEXT (2)           18510054
185200                  EXEC SQL                                        18520054
185300                       OPEN PRTR-ID-ALL-CSR                       18530054
185400                  END-EXEC                                        18540054
185500                                                                  18550054
185600             WHEN ASC-PRTR-ID-LBL-CURSOR                          18560054
185700                  MOVE 'CURSOR:  PRTR-ID-LBL-CSR'                 18570054
185800                              TO DP013-MESSAGE-TEXT (2)           18580054
185900                  EXEC SQL                                        18590054
186000                       OPEN PRTR-ID-LBL-CSR                       18600054
186100                  END-EXEC                                        18610054
186200                                                                  18620054
186300             WHEN ASC-PRTR-ID-LNE-CURSOR                          18630054
186400                  MOVE 'CURSOR:  PRTR-ID-LNE-CSR'                 18640054
186500                              TO DP013-MESSAGE-TEXT (2)           18650054
186600                  EXEC SQL                                        18660054
186700                       OPEN PRTR-ID-LNE-CSR                       18670054
186800                  END-EXEC                                        18680054
186900         END-EVALUATE                                             18690054
187000                                                                  18700054
187100         EVALUATE TRUE                                            18710054
187200             WHEN SQLCODE = ZERO                                  18720054
187300             WHEN SQLCODE = -904                                  18730054
187400             WHEN SQLCODE = -913                                  18740054
187500                 CONTINUE                                         18750054
187600             WHEN SQLWARN0 NOT = SPACES                           18760054
187700             WHEN SQLCODE < ZERO                                  18770054
187800             WHEN SQLCODE > ZERO                                  18780054
187900                 MOVE '4010-OPEN-CURSOR'                          18790054
188000                                   TO DP013-PARAGRAPH             18800054
188100                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             18810054
188200                                   TO DP013-MESSAGE-TEXT (1)      18820054
188300                 MOVE SQLCA        TO DP013-SQLCA                 18830054
188400                 MOVE 'TPRTRID '   TO DP013-DB2-TABLE-NAME (1)    18840054
188500                 SET DP013-DB2-ABEND                              18850054
188600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18860054
188700                 PERFORM DP013-0000-PROCESS-ABEND                 18870054
188800         END-EVALUATE                                             18880054
188900     END-PERFORM                                                  18890054
189000*                                                                 18900054
189100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18910054
189200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18920054
189300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18930054
189400                                   TO DP013-MESSAGE-TEXT (1)      18940054
189500         MOVE SQLCA                TO DP013-SQLCA                 18950054
189600         MOVE 'TPRTRID '           TO DP013-DB2-TABLE-NAME (1)    18960054
189700         SET DP013-DB2-ABEND                                      18970054
189800             DP013-XCTL-DISPLAY-RESTART                           18980054
189900                                   TO TRUE                        18990054
190000         PERFORM DP013-0000-PROCESS-ABEND                         19000054
190100     END-IF.                                                      19010054
190200                                                                  19020054
190300 EJECT                                                            19030054
190400*                                                                 19040054
190500*----------------------------------------------------------------*19050054
190600* CLOSE CURSOR                                                   *19060054
190700*----------------------------------------------------------------*19070054
190800 4020-CLOSE-CURSOR.                                               19080054
190900     EVALUATE TRUE                                                19090054
191000         WHEN ASC-PRTR-LIST-ALL-CURSOR                            19100054
191100              MOVE 'CURSOR:  PRTR-LIST-ALL-CSR'                   19110054
191200                          TO DP013-MESSAGE-TEXT (2)               19120054
191300              EXEC SQL                                            19130054
191400                  CLOSE PRTR-LIST-ALL-CSR                         19140054
191500              END-EXEC                                            19150054
191600                                                                  19160054
191700         WHEN ASC-PRTR-LIST-LBL-CURSOR                            19170054
191800              MOVE 'CURSOR:  PRTR-LIST-LBL-CSR'                   19180054
191900                          TO DP013-MESSAGE-TEXT (2)               19190054
192000              EXEC SQL                                            19200054
192100                  CLOSE PRTR-LIST-LBL-CSR                         19210054
192200              END-EXEC                                            19220054
192300                                                                  19230054
192400         WHEN ASC-PRTR-LIST-LNE-CURSOR                            19240054
192500              MOVE 'CURSOR:  PRTR-LIST-LNE-CSR'                   19250054
192600                          TO DP013-MESSAGE-TEXT (2)               19260054
192700              EXEC SQL                                            19270054
192800                  CLOSE PRTR-LIST-LNE-CSR                         19280054
192900              END-EXEC                                            19290054
193000                                                                  19300054
193100         WHEN ASC-PRTR-ID-ALL-CURSOR                              19310054
193200              MOVE 'CURSOR:  PRTR-ID-ALL-CSR'                     19320054
193300                          TO DP013-MESSAGE-TEXT (2)               19330054
193400              EXEC SQL                                            19340054
193500                  CLOSE PRTR-ID-ALL-CSR                           19350054
193600              END-EXEC                                            19360054
193700                                                                  19370054
193800         WHEN ASC-PRTR-ID-LBL-CURSOR                              19380054
193900              MOVE 'CURSOR:  PRTR-ID-LBL-CSR'                     19390054
194000                          TO DP013-MESSAGE-TEXT (2)               19400054
194100              EXEC SQL                                            19410054
194200                  CLOSE PRTR-ID-LBL-CSR                           19420054
194300              END-EXEC                                            19430054
194400                                                                  19440054
194500         WHEN ASC-PRTR-ID-LNE-CURSOR                              19450054
194600              MOVE 'CURSOR:  PRTR-ID-LNE-CSR'                     19460054
194700                          TO DP013-MESSAGE-TEXT (2)               19470054
194800              EXEC SQL                                            19480054
194900                  CLOSE PRTR-ID-LNE-CSR                           19490054
195000              END-EXEC                                            19500054
195100     END-EVALUATE                                                 19510054
195200*                                                                 19520054
195300     EVALUATE TRUE                                                19530054
195400         WHEN SQLCODE = ZERO                                      19540054
195500             CONTINUE                                             19550054
195600         WHEN SQLWARN0 NOT = SPACES                               19560054
195700         WHEN SQLCODE < ZERO                                      19570054
195800         WHEN SQLCODE > ZERO                                      19580054
195900             MOVE '4020-CLOSE-CURSOR'                             19590054
196000                               TO DP013-PARAGRAPH                 19600054
196100             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  19610054
196200                               TO DP013-MESSAGE-TEXT (1)          19620054
196300             MOVE SQLCA        TO DP013-SQLCA                     19630054
196400             MOVE 'TPRTRID '   TO DP013-DB2-TABLE-NAME (1)        19640054
196500             SET DP013-DB2-ABEND                                  19650054
196600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19660054
196700             PERFORM DP013-0000-PROCESS-ABEND                     19670054
196800     END-EVALUATE.                                                19680054
196900                                                                  19690054
197000 EJECT                                                            19700054
197100*----------------------------------------------------------------*19710054
197200*    SET UP THE HOST VARIABLES.                                  *19720054
197300*----------------------------------------------------------------*19730054
197400                                                                  19740054
197500 4100-PREPARE-CURSOR.                                             19750054
197600     SET ASC-NO-CURSOR                  TO TRUE.                  19760054
197700                                                                  19770054
197800     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 19780054
197900     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    19790054
198000     MOVE ASC-PRTR-ID          TO DK-PRINTER-ID.                  19800068
198100     MOVE ASC-PRTR-SELECT-TYPE TO DK-PRTR-SEL-TYPE.               19810054
198200                                                                  19820054
198300     EVALUATE TRUE                                                19830054
198400         WHEN ASC-PRTR-ID > SPACES AND                            19840068
198500            ASC-PRTR-SELECT-TYPE = 'A'                            19850054
198600            SET ASC-PRTR-ID-ALL-CURSOR TO TRUE                    19860054
198700         WHEN ASC-PRTR-ID > SPACES AND                            19870068
198800            ASC-PRTR-SELECT-TYPE = 'L'                            19880054
198900            SET ASC-PRTR-ID-LBL-CURSOR TO TRUE                    19890054
199000         WHEN ASC-PRTR-ID > SPACES AND                            19900068
199100            ASC-PRTR-SELECT-TYPE = 'N'                            19910054
199200            SET ASC-PRTR-ID-LNE-CURSOR TO TRUE                    19920054
199300                                                                  19930054
199400         WHEN ASC-PRTR-SELECT-TYPE = 'A'                          19940054
199500            SET ASC-PRTR-LIST-ALL-CURSOR TO TRUE                  19950054
199600         WHEN ASC-PRTR-SELECT-TYPE = 'L'                          19960054
199700            SET ASC-PRTR-LIST-LBL-CURSOR TO TRUE                  19970054
199800         WHEN ASC-PRTR-SELECT-TYPE = 'N'                          19980054
199900            SET ASC-PRTR-LIST-LNE-CURSOR TO TRUE                  19990054
200000     END-EVALUATE.                                                20000054
200100*                                                                 20010054
200200*                                                                 20020054
200300*----------------------------------------------------------------*20030054
200400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20040054
200500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20050054
200600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20060054
200700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20070054
200800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20080054
200900*                                                                *20090054
201000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20100054
201100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20110054
201200*    UPON INITIALIZATION.                                        *20120054
201300*----------------------------------------------------------------*20130054
201400 4300-READ-ITEMS-FROM-DB.                                         20140054
201500                                                                  20150054
201600     PERFORM                                                      20160054
201700         VARYING PV-READ-COUNT                                    20170054
201800         FROM 1 BY 1                                              20180054
201900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20190054
202000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20200054
202100                                                                  20210054
202200         PERFORM 4310-FETCH                                       20220054
202300                                                                  20230054
202400         IF  ASC-ITEMS-LEFT-ON-DB                                 20240054
202500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20250054
202600                 ADD +1            TO ASC-ITEM-SUB                20260054
202700             ELSE                                                 20270054
202800                 ADD +1            TO ASC-BLK-SUB                 20280054
202900                 MOVE +1           TO ASC-ITEM-SUB                20290054
203000                                                                  20300054
203100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20310054
203200                     MOVE +1       TO ASC-BLK-SUB                 20320054
203300                     SET ASC-BLOCK-MODIFIED (1)                   20330054
203400                                   TO TRUE                        20340054
203500                     PERFORM 5100-WRITE-TEMP-STORAGE              20350054
203600                     MOVE ASC-BLOCK-ENTRIES                       20360054
203700                               (PC-MAX-BLOCKS-IN-ARRAY)           20370054
203800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20380054
203900                     ADD +1        TO ASC-BLK-SUB                 20390054
204000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20400054
204100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20410054
204200                                   TO TRUE                        20420054
204300                 END-IF                                           20430054
204400             END-IF                                               20440054
204500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    20450054
204600             MOVE ASC-NUMBER-OF-ITEMS-READ                        20460054
204700                                   TO ASC-LIST-ITEM-NUMBER        20470054
204800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20480054
204900             MOVE SPACES           TO  ASC-ACTION                 20490094
205000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20500094
205100             MOVE PRTRID-PRTR-ID                                  20510054
205200                              TO  ASC-PRINTER-NUM                 20520054
205300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20530054
205400             MOVE PV-PRINTER-CLUSTER                              20540054
205500                              TO  ASC-CLUSTER-NUM                 20550054
205600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20560054
205700             MOVE PRTRID-PRTR-TYP-CDE                             20570054
205800                              TO  ASC-PRINTER-TYP                 20580054
205900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20590054
206000             MOVE PRTRID-PRTR-LOC-DESC                            20600054
206100                              TO  ASC-PRINTER-LOC                 20610054
206200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20620054
206300             MOVE PRTRID-PRTR-PHY-STAT-CDE                        20630054
206400                              TO  ASC-STATUS-CDE                  20640054
206500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20650054
206600         END-IF                                                   20660054
206700     END-PERFORM.                                                 20670054
206800                                                                  20680054
206900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20690054
207000         MOVE +1               TO ASC-BLK-SUB                     20700054
207100         PERFORM 5100-WRITE-TEMP-STORAGE                          20710054
207200         ADD +1                TO ASC-BLK-SUB                     20720054
207300         PERFORM 5100-WRITE-TEMP-STORAGE                          20730054
207400                                                                  20740054
207500         MOVE 1                TO ASC-BLK-SUB                     20750054
207600                                  PV-BLOCK-NUMBER                 20760054
207700         PERFORM 4410-READ-TEMP-STORAGE                           20770054
207800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20780054
207900             MOVE 2            TO ASC-BLK-SUB                     20790054
208000                                  PV-BLOCK-NUMBER                 20800054
208100             PERFORM 4410-READ-TEMP-STORAGE                       20810054
208200         END-IF                                                   20820054
208300     END-IF.                                                      20830054
208400 EJECT                                                            20840054
208500*----------------------------------------------------------------*20850054
208600*    FETCH THE PRTR LIST ITEMS                                   *20860054
208700*----------------------------------------------------------------*20870054
208800                                                                  20880054
208900 4310-FETCH.                                                      20890054
209000     EVALUATE TRUE                                                20900054
209100         WHEN ASC-PRTR-LIST-ALL-CURSOR                            20910054
209200           EXEC SQL                                               20920054
209300                FETCH PRTR-LIST-ALL-CSR                           20930054
209400                 INTO  :PRTRID-PRTR-ID                            20940054
209500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     20950054
209600                     , :PRTRID-PRTR-TYP-CDE                       20960054
209700                     , :PRTRID-PRTR-LOC-DESC                      20970054
209800                     , :PRTRID-PRTR-PHY-STAT-CDE                  20980054
209900           END-EXEC                                               20990054
210000                                                                  21000054
210100         WHEN ASC-PRTR-LIST-LBL-CURSOR                            21010056
210200           EXEC SQL                                               21020056
210300                FETCH PRTR-LIST-LBL-CSR                           21030056
210400                 INTO  :PRTRID-PRTR-ID                            21040056
210500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     21050056
210600                     , :PRTRID-PRTR-TYP-CDE                       21060056
210700                     , :PRTRID-PRTR-LOC-DESC                      21070056
210800                     , :PRTRID-PRTR-PHY-STAT-CDE                  21080056
210900           END-EXEC                                               21090056
211000                                                                  21100056
211100         WHEN ASC-PRTR-LIST-LNE-CURSOR                            21110056
211200           EXEC SQL                                               21120056
211300                FETCH PRTR-LIST-LNE-CSR                           21130056
211400                 INTO  :PRTRID-PRTR-ID                            21140056
211500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     21150056
211600                     , :PRTRID-PRTR-TYP-CDE                       21160056
211700                     , :PRTRID-PRTR-LOC-DESC                      21170056
211800                     , :PRTRID-PRTR-PHY-STAT-CDE                  21180056
211900           END-EXEC                                               21190056
212000                                                                  21200056
212100         WHEN ASC-PRTR-ID-ALL-CURSOR                              21210056
212200           EXEC SQL                                               21220054
212300                FETCH PRTR-ID-ALL-CSR                             21230054
212400                 INTO  :PRTRID-PRTR-ID                            21240054
212500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     21250054
212600                     , :PRTRID-PRTR-TYP-CDE                       21260054
212700                     , :PRTRID-PRTR-LOC-DESC                      21270054
212800                     , :PRTRID-PRTR-PHY-STAT-CDE                  21280054
212900           END-EXEC                                               21290054
213000                                                                  21300056
213100         WHEN ASC-PRTR-ID-LBL-CURSOR                              21310056
213200           EXEC SQL                                               21320056
213300                FETCH PRTR-ID-LBL-CSR                             21330056
213400                 INTO  :PRTRID-PRTR-ID                            21340056
213500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     21350056
213600                     , :PRTRID-PRTR-TYP-CDE                       21360056
213700                     , :PRTRID-PRTR-LOC-DESC                      21370056
213800                     , :PRTRID-PRTR-PHY-STAT-CDE                  21380056
213900           END-EXEC                                               21390056
214000                                                                  21400056
214100         WHEN ASC-PRTR-ID-LNE-CURSOR                              21410056
214200           EXEC SQL                                               21420056
214300                FETCH PRTR-ID-LNE-CSR                             21430056
214400                 INTO  :PRTRID-PRTR-ID                            21440056
214500                     , :PRTRID-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     21450056
214600                     , :PRTRID-PRTR-TYP-CDE                       21460056
214700                     , :PRTRID-PRTR-LOC-DESC                      21470056
214800                     , :PRTRID-PRTR-PHY-STAT-CDE                  21480056
214900           END-EXEC                                               21490056
215000     END-EVALUATE.                                                21500056
215100                                                                  21510054
215200           EVALUATE TRUE                                          21520054
215300               WHEN SQLCODE = ZERO                                21530054
215400               WHEN SQLCODE = +100                                21540054
215500                   IF DN-CLUSTR-NBR = -1                          21550054
215600                      MOVE SPACES TO PV-PRINTER-CLUSTER           21560054
215700                   ELSE                                           21570054
215800                      MOVE LOW-VALUES TO PV-PRINTER-CLUSTER       21580099
215900                      MOVE PRTRID-PRTR-CLUSTR-NBR                 21590054
216000                         TO PV-PRINTER-CLUSTER-N                  21600054
216100                      MOVE PV-PRINTER-CLUSTER-N                   21610054
216200                         TO PV-PRINTER-CLUSTER                    21620054
216300                   END-IF                                         21630054
216400               WHEN SQLWARN0 NOT = SPACE                          21640054
216500               WHEN SQLCODE NOT = ZERO                            21650054
216600                    MOVE '4310-FETCH-CURSOR'                      21660054
216700                                     TO DP013-PARAGRAPH           21670054
216800                    MOVE 'FETCH MESSAGE CURSOR'                   21680054
216900                                     TO DP013-MESSAGE-TEXT (1)    21690054
217000                    MOVE SQLCA       TO DP013-SQLCA               21700054
217100                    SET DP013-DB2-ABEND                           21710054
217200                                     TO TRUE                      21720054
217300                    PERFORM DP013-0000-PROCESS-ABEND              21730054
217400           END-EVALUATE.                                          21740054
217500                                                                  21750054
217600     IF  SQLCODE EQUAL +100                                       21760054
217700         SET ASC-NO-ITEMS-LEFT-ON-DB                              21770054
217800                                   TO TRUE                        21780054
217900     END-IF.                                                      21790054
218000                                                                  21800054
218100                                                                  21810054
218200*----------------------------------------------------------------*21820054
218300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21830054
218400*----------------------------------------------------------------*21840054
218500                                                                  21850054
218600 4400-MOVE-COMMAREA-TO-SCREEN.                                    21860054
218700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21870054
218800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21880054
218900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21890054
219000             MOVE +1    TO ASC-BLK-SUB                            21900054
219100             PERFORM 5100-WRITE-TEMP-STORAGE                      21910054
219200             ADD +1     TO ASC-BLK-SUB                            21920054
219300             PERFORM 5100-WRITE-TEMP-STORAGE                      21930054
219400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21940054
219500                 GIVING PV-BLOCK-NUMBER                           21950054
219600                 REMAINDER PV-REMAINDER                           21960054
219700             IF  PV-REMAINDER > ZERO                              21970054
219800                 ADD +1 TO PV-BLOCK-NUMBER                        21980054
219900             END-IF                                               21990054
220000             MOVE +1    TO ASC-BLK-SUB                            22000054
220100             PERFORM 4410-READ-TEMP-STORAGE                       22010054
220200             ADD +1     TO ASC-BLK-SUB                            22020054
220300                           PV-BLOCK-NUMBER                        22030054
220400             PERFORM 4410-READ-TEMP-STORAGE                       22040054
220500     END-IF.                                                      22050054
220600     MOVE +1            TO ASC-BLK-SUB.                           22060054
220700     COMPUTE ASC-ITEM-SUB =                                       22070054
220800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22080054
220900         + PC-ITEMS-PER-PANEL).                                   22090054
221000*                                                                 22100054
221100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22110054
221200         ADD +1         TO ASC-BLK-SUB                            22120054
221300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22130054
221400     END-IF.                                                      22140054
221500*                                                                 22150054
221600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22160054
221700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22170054
221800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22180054
221900     PERFORM 4420-FORMAT-LIST-LINES                               22190054
222000         VARYING PV-SUB                                           22200054
222100         FROM PC-ITEMS-PER-PANEL BY -1                            22210054
222200         UNTIL PV-SUB < +1.                                       22220054
222300*                                                                 22230054
222400     COMPUTE ASC-ITEMS-DISPLAYED =                                22240054
222500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22250054
222600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22260054
222700                                      ASTRTITO.                   22270054
222800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22280054
222900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22290054
223000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22300054
223100                                   TO ASELITO.                    22310054
223200                                                                  22320054
223300     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     22330054
223400     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    22340054
223500     MOVE ASC-FCLTY-NME            TO ANAMEO.                     22350054
223600*                                                                 22360054
223700     IF  DP020-MSG-NUMBER-X = SPACE                               22370054
223800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22380054
223900*            --- MORE ITEMS TO DISPLAY ----                       22390054
224000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22400054
224100             SET DP020-MSG-INFORMATIONAL TO TRUE                  22410054
224200         END-IF                                                   22420054
224300     END-IF.                                                      22430054
224400*----------------------------------------------------------------*22440054
224500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22450054
224600*----------------------------------------------------------------*22460054
224700                                                                  22470054
224800 4410-READ-TEMP-STORAGE.                                          22480054
224900                                                                  22490054
225000     EXEC CICS                                                    22500054
225100         READQ TS                                                 22510054
225200             QUEUE (ASC-LIST-QUEUE-NAME)                          22520054
225300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22530054
225400             ITEM  (PV-BLOCK-NUMBER)                              22540054
225500             RESP  (PV-CICS-RESP)                                 22550054
225600     END-EXEC.                                                    22560054
225700                                                                  22570054
225800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22580054
225900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22590054
226000         CONTINUE                                                 22600054
226100     ELSE                                                         22610054
226200         SET DP013-CICS-ABEND     TO TRUE                         22620054
226300         SET DP013-NO-ROLLBACK    TO TRUE                         22630054
226400         MOVE '4410-READ-TEMP-STORAGE'                            22640054
226500                                  TO DP013-PARAGRAPH              22650054
226600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22660054
226700                                  TO DP013-MESSAGE-TEXT(1)        22670054
226800         PERFORM DP013-0000-PROCESS-ABEND                         22680054
226900     END-IF.                                                      22690054
227000                                                                  22700054
227100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22710054
227200*                                                                 22720054
227300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22730054
227400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22740054
227500     END-IF.                                                      22750054
227600 EJECT                                                            22760054
227700*----------------------------------------------------------------*22770054
227800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22780054
227900*----------------------------------------------------------------*22790054
228000                                                                  22800054
228100 4420-FORMAT-LIST-LINES.                                          22810054
228200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22820054
228300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22830054
228400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           22840054
228500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           22850054
228600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           22860054
228700                                    MR-ACTION (PV-SUB)            22870054
228800                                    MR-PRINTER-NUM (PV-SUB)       22880054
228900                                    MR-CLUSTER-NUM-X (PV-SUB)     22890099
229000                                    MR-PRINTER-TYP (PV-SUB)       22900054
229100                                    MR-PRINTER-LOC (PV-SUB)       22910054
229200                                    MR-STATUS-CDE (PV-SUB)        22920054
229300     ELSE                                                         22930054
229400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22940054
229500                                                   > SPACE        22950054
229600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22960054
229700                                 TO MR-SELECTI (PV-SUB)           22970054
229800         ELSE                                                     22980054
229900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22990054
230000                                 TO MR-SELECTI (PV-SUB)           23000054
230100         END-IF                                                   23010054
230200*                                                                 23020054
230300         IF  DP030-SET-CURSOR-TRAILER                             23030054
230400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23040054
230500                 > SPACE)                                         23050054
230600               OR (PV-SUB = 1))                                   23060054
230700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23070054
230800                MOVE -1          TO MR-SELECTL (PV-SUB)           23080054
230900             END-IF                                               23090054
231000         END-IF                                                   23100054
231100*                                                                 23110054
231200*                                                                 23120054
231300         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               23130054
231400                                 TO MR-ACTION (PV-SUB)            23140054
231500         MOVE ASC-PRINTER-NUM (ASC-BLK-SUB ASC-ITEM-SUB)          23150054
231600                                 TO MR-PRINTER-NUM (PV-SUB)       23160054
231700         MOVE ASC-CLUSTER-NUM (ASC-BLK-SUB ASC-ITEM-SUB)          23170054
231800                                 TO MR-CLUSTER-NUM (PV-SUB)       23180054
231900         MOVE ASC-PRINTER-TYP (ASC-BLK-SUB ASC-ITEM-SUB)          23190054
232000                                 TO MR-PRINTER-TYP (PV-SUB)       23200054
232100         MOVE ASC-PRINTER-LOC (ASC-BLK-SUB ASC-ITEM-SUB)          23210054
232200                                 TO MR-PRINTER-LOC (PV-SUB)       23220054
232300         MOVE ASC-STATUS-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)          23230054
232400                                 TO MR-STATUS-CDE  (PV-SUB)       23240054
232500     END-IF.                                                      23250054
232600     SUBTRACT +1 FROM ASC-ITEM-SUB                                23260054
232700     IF  ASC-ITEM-SUB < + 1                                       23270054
232800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23280054
232900         MOVE +1                 TO ASC-BLK-SUB                   23290054
233000     END-IF.                                                      23300054
233100******************************************************************23310054
233200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **23320054
233300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **23330054
233400** ISSUE A WARNING.                                             **23340054
233500******************************************************************23350054
233600 4430-CHECK-FOR-BEGIN-AND-END.                                    23360054
233700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23370054
233800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23380054
233900*            -- NO END-OF-RANGE SPECFIED ---                      23390054
234000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23400054
234100             SET DP020-MSG-WARNING TO TRUE                        23410054
234200             PERFORM 4431-POSITION-AT-WARNING                     23420054
234300         END-IF                                                   23430054
234400     ELSE                                                         23440054
234500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23450054
234600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23460054
234700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23470054
234800             SET DP020-MSG-WARNING TO TRUE                        23480054
234900             PERFORM 4431-POSITION-AT-WARNING                     23490054
235000         END-IF                                                   23500054
235100     END-IF.                                                      23510054
235200******************************************************************23520054
235300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **23530054
235400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **23540054
235500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **23550054
235600** POSITION THE CURSOR THERE.                                   **23560054
235700******************************************************************23570054
235800 4431-POSITION-AT-WARNING.                                        23580054
235900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23590054
236000                    - PV-TOP-ITEM + 1.                            23600054
236100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23610054
236200         CONTINUE                                                 23620054
236300     ELSE                                                         23630054
236400         SET DP030-SET-CURSOR-APPL-1                              23640054
236500                                   TO TRUE                        23650054
236600         MOVE -1                   TO MR-SELECTL (PV-SUB)         23660054
236700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23670054
236800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23680054
236900     END-IF.                                                      23690054
237000*                                                                 23700054
237100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23710054
237200                    - PV-TOP-ITEM + 1.                            23720054
237300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23730054
237400         CONTINUE                                                 23740054
237500     ELSE                                                         23750054
237600         SET DP030-SET-CURSOR-APPL-1                              23760054
237700                                   TO TRUE                        23770054
237800         MOVE -1                   TO MR-SELECTL (PV-SUB)         23780054
237900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23790054
238000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23800054
238100     END-IF.                                                      23810054
238200                                                                  23820054
238300                                                                  23830054
238400*----------------------------------------------------------------*23840054
238500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23850054
238600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23860054
238700* FOR THE SELECTED ITEMS QUEUE.                                  *23870054
238800*                                                                *23880054
238900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23890054
239000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23900054
239100* THE ARRAY IS FULL.                                             *23910054
239200*----------------------------------------------------------------*23920054
239300                                                                  23930054
239400 5000-PREPARE-SEL-QUEUE.                                          23940054
239500                                                                  23950054
239600     MOVE +1                   TO  ASC-BLK-SUB.                   23960054
239700     PERFORM 5100-WRITE-TEMP-STORAGE.                             23970054
239800     ADD +1                    TO  ASC-BLK-SUB.                   23980054
239900     PERFORM 5100-WRITE-TEMP-STORAGE.                             23990054
240000                                                                  24000054
240100     MOVE ASC-SEL-QUEUE-NAME   TO  CN162-SEL-QUEUE-NAME.          24010058
240200     PERFORM 6010-DELETE-SEL-QUEUE.                               24020054
240300                                                                  24030054
240400     SET ASC-UPDATE-TSQ        TO  TRUE.                          24040054
240500                                                                  24050054
240600     SET CN163-IDX             TO  1.                             24060058
240700     MOVE ZERO                 TO CN162-NUMBER-OF-TS-ITEMS.       24070058
240800     INITIALIZE CN163-SELECTED-ITEM-ARRAY.                        24080058
240900                                                                  24090054
241000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24100054
241100             VARYING PV-ITEM                                      24110054
241200             FROM 1 BY 1                                          24120054
241300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24130054
241400                                                                  24140054
241500     IF  CN163-IDX > 1                                            24150058
241600         PERFORM 5205-WRITE-SEL-QUEUE                             24160054
241700         ADD +1                TO CN162-NUMBER-OF-TS-ITEMS        24170058
241800     END-IF.                                                      24180054
241900 EJECT                                                            24190054
242000*----------------------------------------------------------------*24200054
242100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24210054
242200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24220054
242300*----------------------------------------------------------------*24230054
242400                                                                  24240054
242500 5100-WRITE-TEMP-STORAGE.                                         24250054
242600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24260054
242700                                   TO PV-LIST-ITEM-NUMBER.        24270054
242800     COMPUTE PV-BLOCK-NUMBER =                                    24280054
242900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24290054
243000                                                                  24300054
243100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24310054
243200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24320054
243300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24330054
243400             PERFORM 5105-REWRITE-ASC-LISTQ                       24340054
243500         END-IF                                                   24350054
243600     ELSE                                                         24360054
243700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24370054
243800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24380054
243900         PERFORM 5110-WRITE-ASC-LISTQ                             24390054
244000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24400054
244100     END-IF.                                                      24410054
244200                                                                  24420054
244300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24430054
244400******************************************************************24440054
244500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **24450054
244600** SPECIFIC COMMAREA.                                           **24460054
244700******************************************************************24470054
244800 5105-REWRITE-ASC-LISTQ.                                          24480054
244900     EXEC CICS                                                    24490054
245000         WRITEQ TS                                                24500054
245100             QUEUE (ASC-LIST-QUEUE-NAME)                          24510054
245200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24520054
245300             ITEM  (PV-BLOCK-NUMBER)                              24530054
245400             REWRITE                                              24540054
245500             RESP  (PV-CICS-RESP)                                 24550054
245600     END-EXEC.                                                    24560054
245700                                                                  24570054
245800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24580054
245900         CONTINUE                                                 24590054
246000     ELSE                                                         24600054
246100         SET DP013-CICS-ABEND            TO TRUE                  24610054
246200         SET DP013-NO-ROLLBACK           TO TRUE                  24620054
246300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24630054
246400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24640054
246500                                         TO DP013-MESSAGE-TEXT(1) 24650054
246600         PERFORM DP013-0000-PROCESS-ABEND                         24660054
246700     END-IF.                                                      24670054
246800                                                                  24680054
246900******************************************************************24690054
247000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24700054
247100** SPECIFIC COMMAREA.                                           **24710054
247200******************************************************************24720054
247300 5110-WRITE-ASC-LISTQ.                                            24730054
247400     EXEC CICS                                                    24740054
247500         WRITEQ TS                                                24750054
247600             QUEUE (ASC-LIST-QUEUE-NAME)                          24760054
247700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24770054
247800             ITEM  (PV-BLOCK-NUMBER)                              24780054
247900             RESP  (PV-CICS-RESP)                                 24790054
248000     END-EXEC.                                                    24800054
248100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24810054
248200         SET DP013-CICS-ABEND      TO TRUE                        24820054
248300         SET DP013-NO-ROLLBACK     TO TRUE                        24830054
248400         MOVE '5110-WRITE-ASC-LISTQ'                              24840054
248500                                   TO DP013-PARAGRAPH             24850054
248600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24860054
248700                                   TO DP013-MESSAGE-TEXT(1)       24870054
248800         PERFORM DP013-0000-PROCESS-ABEND                         24880054
248900     END-IF.                                                      24890054
249000 EJECT                                                            24900054
249100*----------------------------------------------------------------*24910054
249200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24920054
249300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24930054
249400*----------------------------------------------------------------*24940054
249500                                                                  24950054
249600 5200-FILL-SEL-QUEUE-RECORD.                                      24960054
249700                                                                  24970054
249800     PERFORM 6112-READ-LIST-QUEUE.                                24980054
249900                                                                  24990054
250000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25000054
250100         PERFORM                                                  25010054
250200         VARYING LQW-IDX                                          25020054
250300         FROM 1 BY 1                                              25030054
250400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25040054
250500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25050054
250600                                                                  25060054
250700             IF  LQW-SELECT (LQW-IDX)                             25070054
250800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25080054
250900                                  TO CN163-ITEM (CN163-IDX)       25090058
251000                 MOVE SPACE       TO CN163-ACTION-SW (CN163-IDX)  25100058
251100                                                                  25110054
251200                 MOVE LQW-PRINTER-NUM (LQW-IDX)                   25120054
251300                                  TO CN163-PRTR-ID                25130058
251400                                      (CN163-IDX)                 25140058
251500                 MOVE LQW-CLUSTER-NUM (LQW-IDX)                   25150054
251600                                  TO CN163-CLUSTR-NBR             25160058
251700                                      (CN163-IDX)                 25170058
251800*                                                                 25180099
251900                 IF  LQW-CLUSTER-NUM (LQW-IDX) = SPACES           25190099
252000                     SET CN163-CLUSTR-NULL-YES(CN163-IDX) TO TRUE 25200099
252100                 ELSE                                             25210099
252200                     SET CN163-CLUSTR-NULL-NO (CN163-IDX) TO TRUE 25220099
252300                 END-IF                                           25230099
252400                                                                  25240099
252500                 MOVE LQW-PRINTER-TYP (LQW-IDX)                   25250054
252600                                  TO CN163-PRTR-TYP-CDE           25260058
252700                                      (CN163-IDX)                 25270058
252800                 MOVE LQW-PRINTER-LOC (LQW-IDX)                   25280054
252900                                  TO  CN163-PRTR-LOC-DESC         25290058
253000                                       (CN163-IDX)                25300058
253100                 MOVE LQW-STATUS-CDE (LQW-IDX)                    25310054
253200                                  TO  CN163-PRTR-PHY-STAT-CDE     25320058
253300                                       (CN163-IDX)                25330058
253400                                                                  25340054
253500                 SET CN163-IDX UP BY 1                            25350058
253600                 IF  CN163-IDX > CN163-MAX-ITEMS                  25360058
253700                     PERFORM 5205-WRITE-SEL-QUEUE                 25370054
253800                     ADD +1        TO CN162-NUMBER-OF-TS-ITEMS    25380058
253900                     INITIALIZE CN163-SELECTED-ITEM-ARRAY         25390058
254000                     SET CN163-IDX TO  1                          25400058
254100                 END-IF                                           25410054
254200             END-IF                                               25420054
254300         END-PERFORM                                              25430054
254400     END-IF.                                                      25440054
254500                                                                  25450054
254600*----------------------------------------------------------------*25460054
254700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25470054
254800*----------------------------------------------------------------*25480054
254900                                                                  25490054
255000 5205-WRITE-SEL-QUEUE.                                            25500054
255100                                                                  25510054
255200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25520054
255300                                   TO CN163-SELECTED-ITEMS.       25530058
255400                                                                  25540054
255500     EXEC CICS                                                    25550054
255600          WRITEQ TS                                               25560054
255700              QUEUE (ASC-SEL-QUEUE-NAME)                          25570054
255800              FROM  (CN163-SELECT-RECORD)                         25580058
255900              ITEM  (PV-SEL-QUEUE-ITEM)                           25590054
256000              RESP  (PV-CICS-RESP)                                25600054
256100     END-EXEC.                                                    25610054
256200                                                                  25620054
256300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25630054
256400         CONTINUE                                                 25640054
256500     ELSE                                                         25650054
256600         SET DP013-CICS-ABEND      TO TRUE                        25660054
256700         SET DP013-NO-ROLLBACK     TO TRUE                        25670054
256800         MOVE '5205-WRITE-SEL-QUEUE'                              25680054
256900                                   TO DP013-PARAGRAPH             25690054
257000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25700054
257100                                   TO DP013-MESSAGE-TEXT(1)       25710054
257200         PERFORM DP013-0000-PROCESS-ABEND                         25720054
257300     END-IF.                                                      25730054
257400 EJECT                                                            25740054
257500******************************************************************25750054
257600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **25760054
257700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **25770054
257800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **25780054
257900** THE USER.                                                    **25790054
258000******************************************************************25800054
258100 6000-REFRESH-PANEL-FROM-TEMP.                                    25810054
258200     IF  ASC-UPDATE-TSQ                                           25820054
258300         SET ASC-NO-TSQ-UPDATE TO TRUE                            25830054
258400         MOVE ZERO                 TO PV-SAVE-ITEM                25840054
258500                                      PV-SEL-QUEUE-ITEM           25850054
258600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25860054
258700                                   TO PV-HOLD-SELECTED-ITEMS      25870054
258800         MOVE +1                   TO PV-ITEMS-PROCESSED          25880054
258900         PERFORM 6100-UPDATE-TSQ                                  25890054
259000             UNTIL PV-ITEMS-PROCESSED >                           25900054
259100                                     PV-HOLD-SELECTED-ITEMS       25910054
259200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25920054
259300                    ASC-BLOCK-ENTRIES (2)                         25930054
259400     END-IF.                                                      25940054
259500                                                                  25950054
259600*----------------------------------------------------------------*25960054
259700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25970054
259800*----------------------------------------------------------------*25980054
259900 6010-DELETE-SEL-QUEUE.                                           25990054
260000                                                                  26000054
260100     EXEC CICS                                                    26010054
260200         DELETEQ TS                                               26020054
260300             QUEUE (ASC-SEL-QUEUE-NAME)                           26030054
260400             RESP  (PV-CICS-RESP)                                 26040054
260500     END-EXEC.                                                    26050054
260600*                                                                 26060054
260700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26070054
260800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26080054
260900         CONTINUE                                                 26090054
261000     ELSE                                                         26100054
261100         SET DP013-CICS-ABEND TO TRUE                             26110054
261200         SET DP013-NO-ROLLBACK TO TRUE                            26120054
261300         MOVE '6010-DELETE-SEL-QUEUE'                             26130054
261400                        TO DP013-PARAGRAPH                        26140054
261500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26150054
261600                        TO DP013-MESSAGE-TEXT (1)                 26160054
261700         PERFORM DP013-0000-PROCESS-ABEND                         26170054
261800     END-IF.                                                      26180054
261900                                                                  26190054
262000*----------------------------------------------------------------*26200054
262100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26210054
262200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26220054
262300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26230054
262400*    THE TEMP QUEUE.                                             *26240054
262500*----------------------------------------------------------------*26250054
262600                                                                  26260054
262700 6100-UPDATE-TSQ.                                                 26270054
262800                                                                  26280054
262900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26290054
263000     PERFORM 6105-READ-SEL-QUEUE.                                 26300054
263100     PERFORM                                                      26310054
263200         VARYING CN163-IDX                                        26320058
263300         FROM 1 BY 1                                              26330054
263400         UNTIL ((PV-ITEMS-PROCESSED >                             26340054
263500                              PV-HOLD-SELECTED-ITEMS)             26350054
263600         OR (CN163-IDX GREATER THAN CN163-MAX-ITEMS))             26360058
263700         IF  CN163-ACTION-SW (CN163-IDX) > SPACE                  26370058
263800             PERFORM 6110-PROCESS-ITEMS                           26380054
263900         END-IF                                                   26390054
264000         ADD +1                TO PV-ITEMS-PROCESSED              26400054
264100     END-PERFORM.                                                 26410054
264200     PERFORM 6111-WRITE-LIST-QUEUE.                               26420054
264300*----------------------------------------------------------------*26430054
264400*    READ THE LIST QUEUE RECORD.                                 *26440054
264500*----------------------------------------------------------------*26450054
264600                                                                  26460054
264700 6105-READ-SEL-QUEUE.                                             26470054
264800                                                                  26480054
264900     EXEC CICS                                                    26490054
265000          READQ TS                                                26500054
265100              QUEUE (ASC-SEL-QUEUE-NAME)                          26510054
265200              INTO  (CN163-SELECT-RECORD)                         26520058
265300              ITEM  (PV-SEL-QUEUE-ITEM)                           26530054
265400              RESP  (PV-CICS-RESP)                                26540054
265500     END-EXEC.                                                    26550054
265600*                                                                 26560054
265700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26570054
265800         CONTINUE                                                 26580054
265900     ELSE                                                         26590054
266000         SET DP013-CICS-ABEND      TO  TRUE                       26600054
266100         SET DP013-NO-ROLLBACK     TO  TRUE                       26610054
266200         MOVE '6105-READ-SEL-QUEUE'                               26620054
266300                                   TO  DP013-PARAGRAPH            26630054
266400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26640054
266500                                   TO  DP013-MESSAGE-TEXT(1)      26650054
266600         PERFORM DP013-0000-PROCESS-ABEND                         26660054
266700     END-IF.                                                      26670054
266800 EJECT                                                            26680054
266900*----------------------------------------------------------------*26690054
267000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26700054
267100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26710054
267200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26720054
267300*----------------------------------------------------------------*26730054
267400                                                                  26740054
267500 6110-PROCESS-ITEMS.                                              26750054
267600                                                                  26760054
267700     COMPUTE PV-ITEM = 1 + ((CN163-ITEM (CN163-IDX) - 1)          26770058
267800                     / PC-ITEMS-PER-PANEL).                       26780054
267900                                                                  26790054
268000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26800054
268100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26810054
268200             PERFORM 6111-WRITE-LIST-QUEUE                        26820054
268300         END-IF                                                   26830054
268400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26840054
268500                                                                  26850054
268600         PERFORM 6112-READ-LIST-QUEUE                             26860054
268700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26870054
268800             CONTINUE                                             26880054
268900         END-IF                                                   26890054
269000     END-IF.                                                      26900054
269100                                                                  26910054
269200     COMPUTE PV-SUB = (CN163-ITEM (CN163-IDX)                     26920058
269300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26930054
269400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26940054
269500     MOVE LQW-SELECTED-SW (PV-SUB)                                26950054
269600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26960054
269700     EVALUATE TRUE                                                26970054
269800         WHEN CN163-INQ (CN163-IDX)                               26980058
269900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26990054
270000                                                                  27000099
270100*FIELDS THAT CAN BE UPDATED:  CLUSTER NUMBER, PRTR TYPE CODE,     27010099
270200*PRTR LOCATION DESC, PRTR STATUS CODE                             27020099
270300         WHEN CN163-UPD (CN163-IDX)                               27030098
270400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             27040097
270500              IF  CN163-CLUSTR-NULL-YES (CN163-IDX)               27050099
270600                   MOVE  LOW-VALUES                               27060099
270700                               TO LQW-CLUSTER-NUM (PV-SUB)        27070099
270800              ELSE                                                27080099
270900                  MOVE CN163-CLUSTR-NBR (CN163-IDX)               27090099
271000                               TO LQW-CLUSTER-NUM (PV-SUB)        27100097
271100              END-IF                                              27110099
271200              MOVE CN163-PRTR-TYP-CDE (CN163-IDX)                 27120099
271300                               TO LQW-PRINTER-TYP (PV-SUB)        27130097
271400              MOVE CN163-PRTR-LOC-DESC (CN163-IDX)                27140099
271500                               TO LQW-PRINTER-LOC (PV-SUB)        27150097
271600              MOVE CN163-PRTR-PHY-STAT-CDE (CN163-IDX)            27160099
271700                               TO LQW-STATUS-CDE (PV-SUB)         27170097
271800                                                                  27180099
271900         WHEN CN163-DEL (CN163-IDX)                               27190099
272000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             27200099
272100                                                                  27210099
272200         WHEN CN163-ERR (CN163-IDX)                               27220099
272300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             27230099
272400     END-EVALUATE.                                                27240099
272500                                                                  27250099
272600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27260099
272700                                                                  27270099
272800*----------------------------------------------------------------*27280099
272900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN CNKCS216.         *27290099
273000*----------------------------------------------------------------*27300099
273100                                                                  27310099
273200 6111-WRITE-LIST-QUEUE.                                           27320099
273300                                                                  27330099
273400     EXEC CICS                                                    27340099
273500         WRITEQ TS                                                27350099
273600             QUEUE (ASC-LIST-QUEUE-NAME)                          27360099
273700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27370099
273800             ITEM  (PV-SAVE-ITEM)                                 27380099
273900             REWRITE                                              27390099
274000             RESP  (PV-CICS-RESP)                                 27400099
274100     END-EXEC.                                                    27410099
274200*                                                                 27420099
274300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27430099
274400         CONTINUE                                                 27440099
274500     ELSE                                                         27450099
274600         SET DP013-CICS-ABEND  TO  TRUE                           27460099
274700         SET DP013-NO-ROLLBACK TO  TRUE                           27470099
274800         MOVE '6111-WRITE-LIST-QUEUE'                             27480099
274900                               TO  DP013-PARAGRAPH                27490099
275000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27500099
275100                               TO  DP013-MESSAGE-TEXT(1)          27510099
275200         PERFORM DP013-0000-PROCESS-ABEND                         27520099
275300     END-IF.                                                      27530099
275400                                                                  27540099
275500 EJECT                                                            27550099
275600*----------------------------------------------------------------*27560099
275700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27570099
275800*----------------------------------------------------------------*27580099
275900                                                                  27590099
276000 6112-READ-LIST-QUEUE.                                            27600099
276100                                                                  27610099
276200     EXEC CICS                                                    27620099
276300         READQ TS                                                 27630099
276400             QUEUE (ASC-LIST-QUEUE-NAME)                          27640099
276500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27650099
276600             ITEM  (PV-ITEM)                                      27660099
276700             RESP  (PV-CICS-RESP)                                 27670099
276800     END-EXEC.                                                    27680099
276900                                                                  27690099
277000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27700099
277100         CONTINUE                                                 27710099
277200     ELSE                                                         27720099
277300         SET DP013-CICS-ABEND        TO TRUE                      27730099
277400         SET DP013-NO-ROLLBACK       TO TRUE                      27740099
277500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27750099
277600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27760099
277700                                     TO DP013-MESSAGE-TEXT(1)     27770099
277800         PERFORM DP013-0000-PROCESS-ABEND                         27780099
277900     END-IF.                                                      27790099
278000                                                                  27800099
278100                                                                  27810099
278200*----------------------------------------------------------------*27820099
278300*    ABEND PROCESSOR MODULE                                      *27830099
278400*----------------------------------------------------------------*27840099
278500                                                                  27850099
278600     COPY DPPD013.                                                27860099
