000100******************************************************************04/11/95
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************   LV002
000400                                                                          
000500 PROGRAM-ID.                VLKCS591.                                     
000600 AUTHOR.                    MARY SARDINA.                                 
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.                      
000800 DATE-WRITTEN.              01-25-97.                                     
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  CICS PROGRAM - VLKCS591 - V591                                *        
001300*                                                                *        
001400*       VL-PRETIC PRINT ACTIVITY QUEUE                                    
001500*                                                                *        
001600*  THIS SCREEN WILL LIST THE PRINT ACTIVITY BY USERID AND BY     *        
001700*  PO.                                                                    
001800******************************************************************        
263627*---------------------------------------------------------------*         
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001900 ENVIRONMENT DIVISION.                                                    
002000                                                                          
002100 DATA DIVISION.                                                           
002200                                                                          
002300 WORKING-STORAGE SECTION.                                                 
002400                                                                          
002500 01  DK-DB2-KEYS.                                                         
002600     15  DK-REQ-TYPE1                   PIC  X(01).                       
002700     15  DK-REQ-TYPE2                   PIC  X(01).                       
002800     15  DK-REQ-STAT1                   PIC  X(01).                       
002900     15  DK-REQ-STAT2                   PIC  X(01).                       
003000                                                                          
003100 01  PS-PROGRAM-CONSTANTS.                                                
003500     05  PC-PO-PRINT-TRANID             PIC  X(4)   VALUE 'V591'.         
003501     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
003502                                                    'VL591A  '.           
003503     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
003504                                                    'VLKM591 '.           
003600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
003700                                                    'VLKCS591'.           
003800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
003900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15             
004100                                                    COMP SYNC.            
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
004300                                                    COMP SYNC.            
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
004500                                                    +1000000              
004600                                                    COMP-3.               
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
004800                                                    COMP SYNC.            
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3               
005000                                                    COMP-3.               
005100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.            
005200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
005300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.          
005400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.          
005500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.          
005600*                                                                         
005700     05  PC-TSYMSG-NUMBERS.                                               
005800         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.          
005900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005910         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.          
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
006200         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.          
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
006800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
007000         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.          
007100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
007110         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.          
007200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
007300         10  PC-TSYMSG-00118            PIC  9(05)  VALUE 00118.          
007400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
007500         10  PC-TSYMSG-01339            PIC  9(05)  VALUE 01339.          
007510         10  PC-TSYMSG-01383            PIC  9(05)  VALUE 01383.          
007600         10  PC-TSYMSG-01386            PIC  9(05)  VALUE 01386.          
007700         10  PC-TSYMSG-01387            PIC  9(05)  VALUE 01387.          
007800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
007900*                                                                         
008000 01  PS-PROGRAM-SWITCHES.                                                 
008100     05  PS-SELECTED-RECORD-SW          PIC  X(01)  VALUE 'Y'.            
008200         88  PS-SEL-RECORD-FOUND                    VALUE 'Y'.            
008300         88  PS-SEL-RECORD-NOT-FOUND                VALUE 'N'.            
008400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
008500         88  PS-NO-ERROR                            VALUE 'Y'.            
008600         88  PS-ERROR                               VALUE 'N'.            
008700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
008800         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
008900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
009000*                                                                         
009100 01  PV-PROGRAM-VARIABLES.                                                
009200     05  PV-COMMAREA-LENGTH             PIC S9(04) COMP                   
009300                                                   VALUE ZERO.            
009301     05  PV-DISPLAY-ABEND-MESSAGE       PIC  X(79) VALUE SPACES.          
009302     05  PV-DISPLAY-COMP1               PIC  9(09) VALUE ZERO.            
009400     05  PV-DISPLAY-COMP2               PIC  9(09) VALUE ZERO.            
009500     05  PV-DISPLAY-COMP3               PIC  9(09) VALUE ZERO.            
009600     05  PV-WORK-DATE.                                                    
009700         10  PV-WORK-CC                 PIC XX.                           
009800         10  PV-WORK-YY                 PIC XX.                           
009900         10  FILLER                     PIC X.                            
010000         10  PV-DISPLAY-DATE.                                             
010100             15 PV-WORK-MM              PIC XX.                           
010200             15 FILLER                  PIC X.                            
010300             15 PV-WORK-DD              PIC XX.                           
010400     05  PV-SEL-PO-REQ-NBR              PIC S9(09)  VALUE +0              
010500                                                    COMP SYNC.            
010600     05  PV-SEL-PO-NBR                  PIC S9(09)  VALUE +0              
010700                                                    COMP SYNC.            
010800     05  PV-SEL-RQST-STAT               PIC  X(01)  VALUE SPACE.          
010810     05  PV-SEL-VENDOR-NAME             PIC  X(30)  VALUE SPACE.          
011300     05  PV-REQUEST-TICKET-TOTAL        PIC S9(09)  VALUE +0              
011400                                                    COMP SYNC.            
011500     05  PV-REQUEST-LINE-COUNT          PIC S9(04)  VALUE +0              
011600                                                    COMP SYNC.            
011700     05  PV-SUB                         PIC S9(04)  VALUE +0              
011800                                                    COMP SYNC.            
011900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
012000                                                    COMP SYNC.            
012100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
012200                                                    COMP-3.               
012300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
012400                                                    COMP-3.               
012500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
012600                                                    COMP-3.               
012700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
012800                                                    COMP-3.               
012900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
013000                                                    COMP-3.               
013100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
013200                                                    COMP-3.               
013300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
013400                                                    COMP-3.               
013500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
013600                                                    COMP SYNC.            
013700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
013800                                                    COMP SYNC.            
013900     05  PV-ITEM                        PIC S9(04)  VALUE +0              
014000                                                    COMP SYNC.            
014100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
014200                                                    COMP SYNC.            
014300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
014400                                                    COMP SYNC.            
014500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
014600                                                    COMP SYNC.            
014700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
014800                                                    COMP SYNC.            
014900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
015000                                                    COMP SYNC.            
015100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
015200                                                    COMP SYNC.            
015300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
015400                                                    COMP SYNC.            
015500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
015600                                                    COMP SYNC.            
015700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
015800                                                    COMP SYNC.            
015900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
016000                                                    COMP SYNC.            
016100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
016200                                                    COMP SYNC.            
016300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
016400                                                    COMP SYNC.            
016500     05  PV-DATE-ISO.                                                     
016600         10 PV-DATE-CC                  PIC  X(02).                       
016700         10 PV-DATE-YY                  PIC  X(02).                       
016800         10 FILLER                      PIC  X(01) VALUE '-'.             
016900         10 PV-DATE-MM                  PIC  X(02).                       
017000         10 FILLER                      PIC  X(01) VALUE '-'.             
017100         10 PV-DATE-DD                  PIC  X(02).                       
017101     05  PV-DATE-6BYTE.                                           00310845
017102         10  PV-DATE-YY                 PIC  X(02).               00310945
017103         10  PV-DATE-MM                 PIC  X(02).               00311045
017110         10  PV-DATE-DD                 PIC  X(02).               00311145
017200     05  PV-DATE-USA.                                                     
017300         10 PV-DATE-MM                  PIC  X(02).                       
017400         10 FILLER                      PIC  X(01) VALUE '/'.             
017500         10 PV-DATE-DD                  PIC  X(02).                       
017600         10 FILLER                      PIC  X(01) VALUE '/'.             
017700         10 PV-DATE-CC                  PIC  X(02).                       
017800         10 PV-DATE-YY                  PIC  X(02).                       
017810     05  PV-DATE-USA-1.                                                   
017820         10 PV-DATE-MM-1                PIC  X(02).                       
017830         10 SLASH-1                     PIC  X(01) VALUE '/'.             
017840         10 PV-DATE-DD-1                PIC  X(02).                       
017850         10 SLASH-2                     PIC  X(01) VALUE '/'.             
017860         10 PV-DATE-CC-1                PIC  X(02).                       
017870         10 PV-DATE-YY-1                PIC  X(02).                       
017900     05  PV-DATE-DISPLAY.                                                 
018000         10 PV-DATE-MM                  PIC  X(02).                       
018100         10 FILLER                      PIC  X(01) VALUE '/'.             
018200         10 PV-DATE-DD                  PIC  X(02).                       
018300         10 FILLER                      PIC  X(01) VALUE '/'.             
018400         10 PV-DATE-YY                  PIC  X(02).                       
018500******************************************************************        
018600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **        
018700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **        
018800**  APPLICATION-SPECIFIC COMMAREA.                              **        
018900******************************************************************        
019000 01  LQW-LIST-QUEUE-WORK-AREA.                                            
019100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
019200     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES                   
019300                                        INDEXED BY LQW-IDX.               
019400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
020200         10  LQW-USERID                 PIC X(08).                        
020210         10  LQW-PO-NUMBER              PIC 9(09).                        
021000         10  LQW-RQST-STAT              PIC X(01).                        
021100         10  LQW-REQUEST-DATE           PIC X(08).                        
021110         10  LQW-PRINT-DUE-DATE         PIC X(08).                        
021120         10  LQW-ACTUAL-PRT-DATE        PIC X(08).                        
021300         10  LQW-RQSTD-TICKETS          PIC S9(07)                        
021400                                         COMP.                            
021500         10  LQW-LINE-COUNT             PIC S9(04)                        
021600                                         COMP.                            
021700         10  LQW-TICKET-TYPE            PIC X(09).                        
021800         10  LQW-PRIORITY               PIC 9(02).                        
021900                                                                          
022000     EJECT                                                                
022100*---------------------------------------------------------------*         
022200*    MAP LAYOUT                                                 *         
022300*---------------------------------------------------------------*         
022400                                                                          
022500     COPY VLKM591.                                                        
022600*                                                                         
022700 01  MR-OCCURS-LAYOUT                   REDEFINES  VL591AO.               
022800     05  FILLER                         PIC X(57).                        
022900     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.                  
024100                                                                          
024200         10  FILLER                     PIC  X(03).                     86
024201         10  MR-USERIDC                 PIC  X(01).                       
024202         10  MR-USERIDH                 PIC  X(01).                       
024300         10  MR-USERID                  PIC  X(08).                       
024410                                                                          
024420         10  FILLER                     PIC  X(03).                     86
024430         10  MR-PO-NUMBERC              PIC  X(01).                       
024440         10  MR-PO-NUMBERH              PIC  X(01).                       
024450         10  MR-PO-NUMBER.                                                
024460             15  MR-PO-NUMBER-N         PIC  9(08).                       
024470                                                                          
024480         10  FILLER                     PIC  X(03).                     86
024490         10  MR-RQST-STATC              PIC  X(01).                       
024491         10  MR-RQST-STATH              PIC  X(01).                       
024492         10  MR-RQST-STAT               PIC  X(01).                       
024500                                                                          
024501         10  FILLER                     PIC  X(03).                     86
024502         10  MR-REQUEST-DATEC           PIC  X(01).                       
024503         10  MR-REQUEST-DATEH           PIC  X(01).                       
024700         10  MR-REQUEST-DATE            PIC  X(08).                       
024710                                                                          
024720         10  FILLER                     PIC  X(03).                     86
024730         10  MR-PRINT-DUE-DATEC         PIC  X(01).                       
024740         10  MR-PRINT-DUE-DATEH         PIC  X(01).                       
024750         10  MR-PRINT-DUE-DATE          PIC  X(08).                       
024760                                                                          
024770         10  FILLER                     PIC  X(03).                     86
024780         10  MR-ACTUAL-PRT-DATEC        PIC  X(01).                       
024790         10  MR-ACTUAL-PRT-DATEH        PIC  X(01).                       
024791         10  MR-ACTUAL-PRT-DATE         PIC  X(08).                       
024800                                                                          
025100                                                                          
025101         10  FILLER                     PIC  X(03).                     86
025102         10  MR-RQSTD-TICKETSC          PIC  X(01).                       
025103         10  MR-RQSTD-TICKETSH          PIC  X(01).                       
025300         10  MR-RQSTD-TICKETS-X.                                          
025400             15  MR-RQSTD-TICKETS       PIC  ZZZZ,ZZ9.                    
025500                                                                          
025501         10  FILLER                     PIC  X(03).                     86
025502         10  MR-LINE-COUNTC             PIC  X(01).                       
025503         10  MR-LINE-COUNTH             PIC  X(01).                       
025700         10  MR-LINE-COUNT-X.                                             
025800             15  MR-LINE-COUNT          PIC  Z,ZZ9.                       
025900                                                                          
025901         10  FILLER                     PIC  X(03).                     86
025902         10  MR-TICKET-TYPEC            PIC  X(01).                       
025903         10  MR-TICKET-TYPEH            PIC  X(01).                       
026100         10  MR-TICKET-TYPE             PIC  X(09).                       
026200                                                                          
026201         10  FILLER                     PIC  X(03).                     86
026202         10  MR-PRIORITYC               PIC  X(01).                       
026203         10  MR-PRIORITYH               PIC  X(01).                       
026400         10  MR-PRIORITY                PIC  X(02).                       
026500                                                                          
026600     EJECT                                                                
026700*---------------------------------------------------------------*         
026800*    COMMAREA FOR PRINTING THE PO.                              *         
026900*---------------------------------------------------------------*         
027000                                                                          
027100     COPY VLWS010.                                                        
027200                                                                          
027201*---------------------------------------------------------------*         
027202*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
027203*---------------------------------------------------------------*         
027204                                                                          
027205     COPY DPWS015.                                                        
027206                                                                          
027300*---------------------------------------------------------------*         
027400*    FUNCTION KEYS COPYBOOK.                                    *         
027500*---------------------------------------------------------------*         
027600                                                                          
027700     COPY DPWS016.                                                        
027800                                                                          
027900*---------------------------------------------------------------*         
028000*    NUMERIC EDIT LAYOUT.                                       *         
028100*---------------------------------------------------------------*         
028200                                                                          
028300     COPY DPWS010I.                                                       
028400 EJECT                                                                    
028500*---------------------------------------------------------------*         
028600*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
028700*---------------------------------------------------------------*         
028800                                                                          
028900     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
028901*----------------------------------------------------------------*01160248
028902*  WORK AREA PASSED IN CALL TO DPKUT500                          *01160348
028903*----------------------------------------------------------------*01160448
028904     COPY DPWS500.                                                01160548
028910                                                                  01161048
029000 EJECT                                                                    
029100*---------------------------------------------------------------*         
029200*    STANDARD COMMAREA.                                         *         
029300*---------------------------------------------------------------*         
029400                                                                          
029500     COPY DPWS020.                                                        
029600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
029700                                                                          
029800*---------------------------------------------------------------*         
029900* INTER-APPLICATION COMMAREA.                                   *         
030400*---------------------------------------------------------------*         
030500                                                                          
030600         10  INTER-APPL-COMM-AREA       PIC X(200).                       
030800*---------------------------------------------------------------*         
030900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
031000*---------------------------------------------------------------*         
031100         10  ASC-SPECIFIC-COMMAREA.                                       
031200             15  ASC-LIST-KEYS.                                           
031300                 20  ASC-DATE-LIMIT                  PIC  X(10).          
031301                 20  ASC-CURRENT-DATE                PIC  X(10).        23
031310                 20  ASC-DEFAULT-DATE-LIMIT          PIC  X(10).        46
031400                 20  ASC-KEY-REQ-STAT                PIC  X(01).          
031500                     88 ASC-ACT-REQ-STAT             VALUE 'A'.           
031600                 20  ASC-KEY-REQ-TYPE                PIC  X(01).          
031700                     88 ASC-BOTH-REQ-TYPE            VALUE 'B'.           
031800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
031900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
032000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
032100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
032200                                                                          
032300                 20  ASC-ITEM-ARRAY.                                      
032400                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.                
032500                         30  ASC-LIST-ITEM-NUMBER                         
032600                                                     PIC S9(09)           
032700                                                     COMP-3.              
034500                         30  ASC-USERID              PIC  X(08).          
034510                         30  ASC-PO-NUMBER           PIC  9(09).          
035300                         30  ASC-RQST-STAT           PIC X(01).           
035410                         30  ASC-REQUEST-DATE       PIC X(08).            
035420                         30  ASC-PRINT-DUE-DATE      PIC X(08).           
035430                         30  ASC-ACTUAL-PRT-DATE     PIC X(08).           
035600                         30  ASC-RQSTD-TICKETS       PIC S9(07)           
035700                                                         COMP.            
035800                         30  ASC-LINE-COUNT          PIC S9(04)           
035900                                                         COMP.            
036000                         30  ASC-TICKET-TYPE         PIC X(09).           
036100                         30  ASC-PRIORITY            PIC 9(02).           
036200                                                                          
036300             15  ASC-BLK-SUB                         PIC S9(04)           
036400                                                          COMP            
036500                                                          SYNC.           
036600             15  ASC-ITEM-SUB                        PIC S9(04)           
036700                                                          COMP            
036800                                                          SYNC.           
036900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
037000                                                          COMP-3.         
037100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
037200                                                          COMP-3.         
037300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
037400                                                          COMP-3.         
037500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
037600                                                          COMP-3.         
037700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
037800                                                          COMP-3.         
037900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
038000                                                          COMP            
038100                                                          SYNC.           
038200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
038300                                                          COMP-3.         
038400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
038500                                                          COMP-3.         
038600             15  ASC-DELETE-INDICATOR                PIC  X(01).          
038700                 88  ASC-NO-DELETE                   VALUE ' '.           
038800                 88  ASC-DELETE-PENDING              VALUE 'P'.           
038900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
039000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
039100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
039200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
039300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
039400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
039500             15  ASC-LIST-QUEUE-NAME.                                     
039600                 20  ASC-LIST-TERM-ID                PIC  X(04).          
039700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
039800                                                          COMP-3.         
039900                 20  ASC-LIST-SEQ                    PIC  9(01).          
040000                                                                          
040100             15  ASC-START-ITEM-REQUEST.                                  
040200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
040300     EJECT                                                                
040400*---------------------------------------------------------------*         
040500*    ABEND PROCESSING COPYBOOK.                                 *         
040600*---------------------------------------------------------------*         
040700                                                                          
040800     COPY DPWS013.                                                        
040900                                                                          
041000 EJECT                                                                    
041100*---------------------------------------------------------------*         
041200*    DB2 AREA FOR TMESSAGE                                      *         
041300*---------------------------------------------------------------*         
041400     EXEC SQL                                                             
041500          INCLUDE TSYMSG                                                  
041600     END-EXEC.                                                            
041700*---------------------------------------------------------------*         
041800*    DB2 AREA FOR COMMUNICATIONS                                *         
041900*---------------------------------------------------------------*         
042000     EXEC SQL                                                             
042100          INCLUDE SQLCA                                                   
042200     END-EXEC.                                                            
042300                                                                          
042400*---------------------------------------------------------------*         
042500*    DB2 AREA THE PRETICKET REQUEST TABLE                       *         
042600*---------------------------------------------------------------*         
042700     EXEC SQL                                                             
042800          INCLUDE TPTKREQ                                                 
042900     END-EXEC.                                                            
043000                                                                          
043100*---------------------------------------------------------------*         
043200*    DB2 AREA THE PRETICKET REQEUST LINE TABLE                  *         
043300*---------------------------------------------------------------*         
043400     EXEC SQL                                                             
043500          INCLUDE TPTKLNE                                                 
043600     END-EXEC.                                                            
043700                                                                          
045100                                                                          
045200*---------------------------------------------------------------*         
045300*    DB2 AREA THE ENTERPRISE NAME TABLE                         *         
045400*---------------------------------------------------------------*         
045500     EXEC SQL                                                             
045600          INCLUDE TENTNME                                                 
045700     END-EXEC.                                                            
045800                                                                          
045900*---------------------------------------------------------------*         
046000*    THE PRINT-QUEUE-CURSOR                                     *         
046100*---------------------------------------------------------------*         
046200                                                                          
046300     EXEC SQL                                                             
046400          DECLARE PRINT_QUEUE_CURSOR CURSOR                             86
046500          FOR SELECT                                                      
046521          A.PO_REQ_NBR                                            00000300
046530        , A.PO_NBR                                                00000400
046540        , A.REQ_CREN_DTE                                          00000500
046550        , A.PRT_BY_DTE                                            00000600
046560        , A.ACTL_PRT_DTE                                          00000700
046570        , SUM(B.TKT_QTY)                                          00000800
046580        , COUNT(DISTINCT B.PO_LNE_NBR)                            00000900
046590        , A.PRTY_STAT_CDE                                         00001000
046591        , A.REQ_STAT_CDE                                          00001100
046592        , A.PRT_RQSTR_ID                                          00001200
046593                                                                  00001300
046594    FROM                                                          00001400
046595          TPTKREQ A                                                     01
046596        , TPTKLNE B                                                     01
046597    WHERE                                                         00001700
046599          A.ACTL_PRT_DTE  = :ASC-DATE-LIMIT                       00001905
046601      AND A.PO_REQ_NBR   = B.PO_REQ_NBR                           00002105
046604    GROUP BY                                                      00002400
046605          A.PO_REQ_NBR                                            00002500
046606        , A.PO_NBR                                                00002600
046607        , A.PRT_BY_DTE                                            00002700
046609        , A.PRTY_STAT_CDE                                         00002900
046610        , A.REQ_CREN_DTE                                          00003103
046611        , A.ACTL_PRT_DTE                                          00003303
046612        , A.REQ_STAT_CDE                                          00003703
046613        , A.PRT_RQSTR_ID                                          00003803
046614     ORDER BY                                                           00
046615          A.PRT_RQSTR_ID,                                         00005006
046616          A.PRT_BY_DTE, A.PRTY_STAT_CDE, A.PO_NBR                 00006006
046617     END-EXEC.                                                            
046618                                                                  00010000
049600                                                                          
049700 EJECT                                                                    
049800 LINKAGE SECTION.                                                         
049900                                                                          
050000 01  DFHCOMMAREA.                                                         
050100     05  FILLER                         OCCURS  1 TO 4072 TIMES           
050200                                        DEPENDING ON EIBCALEN.            
050300         10  FILLER                     PIC X.                            
050400                                                                          
050500 EJECT                                                                    
050600 PROCEDURE DIVISION.                                                      
050700******************************************************************        
050800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **        
050900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **        
051000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **        
051100******************************************************************        
051200 0000-MAIN-MODULE.                                                        
051300     INITIALIZE DP030-CICS-API-FIELDS.                                    
051400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
051500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
051600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
051700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
051800     MOVE LENGTH OF VL591AI        TO DP030-MAP-LENGTH (1).               
051900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
052000     PERFORM 0001-CALL-CICS-ARCH-API.                                     
052100*                                                                         
052200     PERFORM 1000-CONTROL-PROCESSING                                      
052300*                                                                         
052400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
052500     PERFORM 0001-CALL-CICS-ARCH-API.                                     
052600                                                                          
052700******************************************************************        
052800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
052900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
053000******************************************************************        
053100 0001-CALL-CICS-ARCH-API.                                                 
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
053300                                    DFHCOMMAREA                           
053400                                    DP030-CICS-API-FIELDS                 
053500                                    DP020-STANDARD-COMMAREA               
053600                                    VL591AI.                              
053700*                                                                         
053800     IF  DP030-RC-CALL-SUCCESSFUL                                         
053900         CONTINUE                                                         
054000     ELSE                                                                 
054100         SET DP013-NO-ROLLBACK                                            
054200             DP013-XCTL-DISPLAY-RESTART                                   
054300             DP013-CICS-ABEND      TO TRUE                                
054400         MOVE '0001-CALL-CICS-ARCH-API'                                   
054500                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
054800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
054900         PERFORM DP013-0000-PROCESS-ABEND                                 
055000     END-IF.                                                              
055100*----------------------------------------------------------------*        
055200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
055300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
055400*                                                                *        
055500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
055600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
055700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
055800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
055900*----------------------------------------------------------------*        
056000                                                                          
056100 1000-CONTROL-PROCESSING.                                                 
056200                                                                          
056300     EVALUATE TRUE                                                        
056400         WHEN DP020-NEXT-ACT-INITIAL                                      
056500             INITIALIZE ASC-SPECIFIC-COMMAREA                             
056600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
056700             MOVE DP020-SRC-TASK-NUMBER                                   
056800                                   TO ASC-LIST-TASK-NUMBER                
056900             MOVE PC-LIST-QUEUE-SEQ                                       
057000                                   TO ASC-LIST-SEQ                        
057100             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
057200***-----$TEMPLATE NOTE$-------------------------------------------        
057300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,        
057400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO          
057500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.        
057600***---------------------------------------------------------------        
057700             IF  PS-COMMAREA-NOT-VALID                                    
057800***              MOVE PC-TSYMSG-99901                                     
057900***                                TO DP020-MSG-NUMBER                    
058000***              SET DP020-MSG-FATAL                                      
058100***                                TO TRUE                                
058200                 SET DP020-NEXT-ACT-APPL-ERROR                            
058300                                   TO TRUE                                
058400             ELSE                                                         
058500                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                     
058501                 PERFORM 3000-EDIT-DATA-IN-COMMAREA                       
058502                 IF PS-NO-ERROR                                           
058503                     PERFORM 4000-BUILD-INITIAL-PANEL                     
530127                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 
530128                 ELSE                                                     
530129                     SET DP030-OVERRIDE-GO TO TRUE                        
530130                 END-IF                                                   
530131             END-IF                                                       
530132                                                                          
530133         WHEN DP020-NEXT-ACT-READ-MAP                                     
530134             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
530135                                   TO PV-TOP-ITEM                         
530136             PERFORM 2000-PROCESS-PANEL                                   
530137                                                                          
530138         WHEN DP020-NEXT-ACT-RETURN                                       
530139             PERFORM 2050-DELETE-LIST-QUEUE                               
530140             PERFORM 4000-BUILD-INITIAL-PANEL                             
530141                                                                          
530142         WHEN OTHER                                                       
530143             SET DP013-LOGIC-ABEND TO TRUE                                
530144             SET DP013-NO-ROLLBACK TO TRUE                                
530145             MOVE '1000-CONTROL-PROCESSING'                               
530146                                   TO DP013-PARAGRAPH                     
530147             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
530148                                   TO DP013-MESSAGE-TEXT(1)               
530149             PERFORM DP013-0000-PROCESS-ABEND                             
530150     END-EVALUATE.                                                        
530151                                                                          
530152 EJECT                                                                    
530153*----------------------------------------------------------------*        
530154* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
530155* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
530156*----------------------------------------------------------------*        
530157                                                                          
530158 1100-PROCESS-INTER-APPL-COMM.                                            
530159     SET PS-COMMAREA-VALID        TO TRUE.                                
530160     PERFORM 4200-GET-CURRENT-DATE.                                       
530161     MOVE SPACE                TO ASC-START-ITEM-REQUEST.                 
530162 EJECT                                                                    
530163*----------------------------------------------------------------*        
530164* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
530165* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
530166* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
530167* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
530168* FUNCTION KEYS CAN GET THIS FAR.                                *        
530169*----------------------------------------------------------------*        
530170                                                                          
530171 2000-PROCESS-PANEL.                                                      
530172     EVALUATE TRUE                                                        
530173         WHEN DP020-SRC-AID = DP016-CLEAR                                 
530174             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
530175             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
530176             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530177                                                                          
530178         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
530179             PERFORM 2050-DELETE-LIST-QUEUE                               
530180             PERFORM 4000-BUILD-INITIAL-PANEL                             
530181                                                                          
530182         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                            
530183*            PERFORM 2140-DESELECT-ALL-ITEMS                              
530184             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530185                                                                          
530186         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                          
530187*            PERFORM 2150-SELECT-ALL-ITEMS                                
530188             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530189                                                                          
530190         WHEN OTHER                                                       
530191             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
530192             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
530195             IF  PS-NO-ERROR                                              
530196                 SET DP030-CONTINUE-GO                                    
530197                                 TO TRUE                                  
530198                 PERFORM 2050-DELETE-LIST-QUEUE                           
530199                 PERFORM 4000-BUILD-INITIAL-PANEL                         
530200                 PERFORM 2100-CHECK-FUNCTION-KEY                          
530201             ELSE                                                         
530202                 SET DP030-OVERRIDE-GO                                    
530203                                 TO TRUE                                  
530204             END-IF                                                       
530205     END-EVALUATE.                                                        
530206 EJECT                                                                    
530207*----------------------------------------------------------------*        
530208*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
530209*----------------------------------------------------------------*        
530210 2050-DELETE-LIST-QUEUE.                                                  
530211                                                                          
530212     EXEC CICS                                                            
530213         DELETEQ TS                                                       
530214             QUEUE (ASC-LIST-QUEUE-NAME)                                  
530215             RESP  (PV-CICS-RESP)                                         
530216     END-EXEC.                                                            
530217                                                                          
530218     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
530219        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
530220         CONTINUE                                                         
530221     ELSE                                                                 
530222         SET DP013-CICS-ABEND      TO TRUE                                
530223         SET DP013-NO-ROLLBACK     TO TRUE                                
530224                                                                          
530225         MOVE '2050-DELETE-LIST-QUEUE'                                    
530226                                   TO DP013-PARAGRAPH                     
530227         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
530228                                   TO DP013-MESSAGE-TEXT (1)              
530229         PERFORM DP013-0000-PROCESS-ABEND                                 
530230     END-IF.                                                              
530231                                                                          
530232     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
530233 EJECT                                                                    
530234*----------------------------------------------------------------*        
530235* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
530236* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
530237* CICS ARCHITECTURE API.                                         *        
530238*----------------------------------------------------------------*        
530239 2100-CHECK-FUNCTION-KEY.                                                 
530240     EVALUATE TRUE                                                        
530250                                                                          
530331         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
530332             MOVE +1               TO PV-TOP-ITEM                         
530333             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530334                                                                          
530335         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
530336             PERFORM 2110-BROWSE-BACKWARD                                 
530337             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530338             PERFORM 3200-RESET-ATTRIBUTES                                
530339                                                                          
530340         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
530341             PERFORM 2120-BROWSE-FORWARD                                  
530342             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
530343             PERFORM 3200-RESET-ATTRIBUTES                                
530344                                                                          
530345         WHEN DP020-SRC-AID = DP016-ENTER                                 
530346             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
530347             IF  PS-ERROR                                                 
530348                 CONTINUE                                                 
530349             ELSE                                                         
530350                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
530351                 PERFORM 3200-RESET-ATTRIBUTES                            
530352             END-IF                                                       
530353                                                                          
530354         WHEN OTHER                                                       
530355             SET DP013-NO-ROLLBACK                                        
530356                 DP013-XCTL-DISPLAY-RESTART                               
530357                 DP013-CICS-ABEND  TO TRUE                                
530358             MOVE '2100-CHECK-FUNCTION-KEY'                               
530359                                   TO DP013-PARAGRAPH                     
530360             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
530361                                   TO DP013-MESSAGE-TEXT (1)              
530362             PERFORM DP013-0000-PROCESS-ABEND                             
530363     END-EVALUATE.                                                        
530364*                                                                         
530365*----------------------------------------------------------------*        
530366*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
530367*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
530368*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
530369*    MESSAGE.                                                    *        
530370*----------------------------------------------------------------*        
530371                                                                          
530372 2110-BROWSE-BACKWARD.                                                    
530373     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
530374         GIVING PV-TOP-ITEM.                                              
530375*                                                                         
530376     IF  ((PV-TOP-ITEM < +1)                                              
530377       OR (PV-TOP-ITEM = +1))                                             
530378         MOVE +1                   TO PV-TOP-ITEM                         
530379*        -- TOP OF LIST --                                                
530380         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
530381         SET DP020-MSG-INFORMATIONAL TO TRUE                              
530382     END-IF.                                                              
530383                                                                          
530384 EJECT                                                                    
530385*----------------------------------------------------------------*        
530386*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
530387*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
530388*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
530389*----------------------------------------------------------------*        
530390                                                                          
530391 2120-BROWSE-FORWARD.                                                     
530392                                                                          
530393     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
530394         GIVING PV-TOP-ITEM.                                              
530395     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
530396         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
530397                                   TO PV-TOP-ITEM                         
530398*        -- BOTTOM OF LIST --                                             
530399         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
530400         SET DP020-MSG-INFORMATIONAL                                      
530401                                   TO TRUE                                
530402     ELSE                                                                 
530403         COMPUTE PV-BOTTOM-ITEM =                                         
530404             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
530405         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
530406*            -- BOTTOM OF LIST --                                         
530407             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
530408             SET DP020-MSG-INFORMATIONAL                                  
530409                                   TO TRUE                                
530410         END-IF                                                           
530411     END-IF.                                                              
530412 EJECT                                                                    
530413*----------------------------------------------------------------*        
530414*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
530415*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
530416*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
530417*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
530418*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
530419*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
530420*----------------------------------------------------------------*        
530421                                                                          
530422 2130-CHECK-FOR-JUMP-BROWSE.                                              
530423     SET PS-NO-ERROR               TO TRUE.                               
530424     IF (ASC-START-ITEM-REQUEST = SPACE)                                  
530425         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
530426                                   TO PV-TOP-ITEM                         
530427     ELSE                                                                 
530428         MOVE ASC-START-ITEM-REQUEST                                      
530429                                   TO DP010I-UNEDITED-FIELD               
530430         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
530431         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
530432         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
530433                                   TO TRUE                                
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
530435                                                                          
530436         IF  NOT DP010I-ERROR-DETECTED                                    
530437             MOVE DP010I-NUMERIC-FIELD                                    
530438                                   TO  ASC-START-ITEM-REQUEST-N           
530439             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
530440                 IF  ASC-START-ITEM-REQUEST-N >                           
530441                                          ASC-NUMBER-OF-ITEMS-READ        
530442                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
530443                     COMPUTE PV-TOP-ITEM =                                
530444                             ASC-NUMBER-OF-ITEMS-READ                     
530445                             - PC-ITEMS-PER-PANEL + 1                     
530446                     IF  PV-TOP-ITEM < +1                                 
530447                         MOVE +1   TO PV-TOP-ITEM                         
530448                         MOVE PC-TSYMSG-00070                             
530449                                   TO DP020-MSG-NUMBER                    
530450                         SET DP020-MSG-INFORMATIONAL                      
530451                                   TO TRUE                                
530452                     END-IF                                               
530453                 ELSE                                                     
530454                     MOVE ASC-START-ITEM-REQUEST-N                        
530455                                   TO PV-TOP-ITEM                         
530456                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
530457                     COMPUTE PV-BOTTOM-ITEM =                             
530458                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
530459                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
530460*                        -- BOTTOM OF LIST --                             
530461                         MOVE PC-TSYMSG-00070                             
530462                                   TO DP020-MSG-NUMBER                    
530463                         SET DP020-MSG-INFORMATIONAL                      
530464                                   TO TRUE                                
530465                     END-IF                                               
530466                 END-IF                                                   
530467             ELSE                                                         
530468*                --- VALUE OUT OF RANGE ----                              
530469                 MOVE PC-TSYMSG-00101                                     
530470                                   TO DP020-MSG-NUMBER                    
530471                 MOVE -1           TO ASTRTITL                            
530472                 SET DP030-SET-CURSOR-APPL-1                              
530473                                   TO TRUE                                
530474                 MOVE DP015-REVERSE                                       
530475                                   TO ASTRTITH                            
530476                 MOVE DP015-RED    TO ASTRTITC                            
530477                 MOVE DP015-UNP-NUM-BRT-MDT                               
530478                                   TO ASTRTITA                            
530479                 SET DP020-MSG-FATAL                                      
530480                                   TO TRUE                                
530481                 SET PS-ERROR      TO TRUE                                
530482             END-IF                                                       
530483                                                                          
530484         ELSE                                                             
530485             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
530486             MOVE -1               TO ASTRTITL                            
530487             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
530488             MOVE DP015-REVERSE    TO ASTRTITH                            
530489             MOVE DP015-RED        TO ASTRTITC                            
530490             MOVE DP015-UNP-NUM-BRT-MDT                                   
530491                                   TO ASTRTITA                            
530492             SET DP020-MSG-FATAL   TO TRUE                                
530493             SET PS-ERROR          TO TRUE                                
530494         END-IF                                                           
530495     END-IF.                                                              
530496 EJECT                                                                    
530583                                                                          
530690                                                                          
530707******************************************************************        
530708** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
530709** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
530710******************************************************************        
530711 2200-MOVE-SCREEN-TO-COMMAREA.                                            
530712                                                                          
530713     PERFORM 4200-GET-CURRENT-DATE.                                       
530714                                                                          
530715     IF  ADATEL > ZERO                                                  47
530716         MOVE ADATEI               TO PV-DATE-USA                 05930053
530724         MOVE CORR PV-DATE-USA     TO PV-DATE-ISO                 05931053
530725         MOVE PV-DATE-ISO          TO ASC-DATE-LIMIT              05932053
530726     ELSE                                                         05940001
530727         IF  ADATEF   = DP015-ERASE-EOF                           05950047
530728             MOVE SPACES           TO ASC-DATE-LIMIT              05961055
530729         END-IF                                                   05970001
530730     END-IF.                                                      05980001
530731                                                                  05980155
530732     IF ASC-DATE-LIMIT  = SPACES                                  05980255
530733         MOVE ASC-DEFAULT-DATE-LIMIT                              05981055
530734                                   TO ASC-DATE-LIMIT              05982055
530735                                      PV-DATE-ISO                 05982158
530736         MOVE CORR PV-DATE-ISO     TO PV-DATE-USA                 05982258
530738         MOVE PV-DATE-USA          TO PV-DATE-USA-1               05982458
530739         MOVE '/'                  TO SLASH-1                             
530740                                      SLASH-2                             
530741         MOVE PV-DATE-USA-1        TO PV-DATE-USA                 05982458
530742         MOVE PV-DATE-USA          TO ADATEO                      05982458
530743     END-IF.                                                      05983055
530744     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
530745     MOVE +1                       TO PV-SUB.                             
530746*                                                                         
530747     PERFORM 3100-SET-SUBSCRIPTS.                                         
530748     IF  ASTRTITL > ZERO                                                  
530749         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
530750     ELSE                                                                 
530751         IF  ASTRTITF = DP015-ERASE-EOF                                   
530752             INITIALIZE ASC-START-ITEM-REQUEST                            
530753         END-IF                                                           
530760     END-IF.                                                              
530768******************************************************************        
530769** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **        
530770** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **        
530771******************************************************************        
530772 3000-EDIT-DATA-IN-COMMAREA.                                              
530773     SET PS-NO-ERROR               TO TRUE.                               
530774     PERFORM 3200-RESET-ATTRIBUTES.                                       
530775     IF  ASC-DATE-LIMIT = SPACES                                  06260047
530776         SET PS-ERROR                                             06290046
530777             DP020-MSG-FATAL         TO TRUE                      06300046
530778         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          06310047
530779         MOVE DP015-UNP-ALP-BRT-OFF                               06320046
530780                                     TO ADATEA                    06330046
530781         MOVE DP015-RED              TO ADATEC                    06340046
530782         MOVE DP015-REVERSE          TO ADATEH                    06350046
530783         MOVE -1                     TO ADATEL                    06360046
530784         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06370046
530785     ELSE                                                         06390046
530786         IF ASC-DATE-LIMIT = ASC-DEFAULT-DATE-LIMIT               06390147
530787             CONTINUE                                             06390256
530788         ELSE                                                     06390356
530789             MOVE ASC-DATE-LIMIT TO ASC-CURRENT-DATE                      
530790             PERFORM 3500-VALIDATE-DATE-LIMIT                     06391047
530791         END-IF                                                   06392047
530792     END-IF.                                                      06399446
530793*                                                                 06400001
530794     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                             
530795**                                                                        
530796* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.                      
530797* EDITTING IS DONE FROM THE BOTTOM UP.                                    
530798**                                                                        
530799     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                               
530800         ASC-ITEMS-DISPLAYED - 1.                                         
530810     PERFORM 3100-SET-SUBSCRIPTS.                                         
530815 EJECT                                                                    
530816*----------------------------------------------------------------*        
530817*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
530818*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
530819*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
530820*                                                                *        
530821*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
530822*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
530823*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
530824*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
530825*----------------------------------------------------------------*        
530826                                                                          
530827 3100-SET-SUBSCRIPTS.                                                     
530828                                                                          
530829     COMPUTE ASC-ITEM-SUB =                                               
530830         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
530831                                                                          
530832     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
530833         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
530834                                                                          
530835         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
530836     ELSE                                                                 
530837         MOVE +1                     TO ASC-BLK-SUB                       
530838     END-IF.                                                              
530839******************************************************************        
530840** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
530841******************************************************************        
530842                                                                          
530843 3200-RESET-ATTRIBUTES.                                                   
530844     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
530845     MOVE DP015-GREEN              TO ASTRTITC.                           
530846     MOVE DP015-UNDERLINE          TO ASTRTITH.                           
530848     MOVE -1                       TO ADATEL.                             
530849     SET DP030-SET-CURSOR-APPL-1                                          
530850                                    TO TRUE.                              
531030 EJECT                                                                    
531114                                                                          
531115*----------------------------------------------------------------*13991045
531116*    VALIDATE THE USER-ENTERED DATE LIMIT                        *13992045
531117*----------------------------------------------------------------*13993045
531118 3500-VALIDATE-DATE-LIMIT.                                        13994045
           INITIALIZE DPG51 DPG52 DPG53                                         
                      DPG54 DPG55 DPG56.                                        
531123                                                                  13999045
531124     SET DPG51-ACTUAL-CALENDAR-ONLY                               13999145
531125                                  TO TRUE.                        13999245
531126                                                                  13999345
531127     MOVE ASC-DATE-LIMIT              TO DPG52-LK-DATE-INPUT.     13999645
531128     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    13999745
531129                                                                  13999845
531130     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13999945
531131                                             DPG54 DPG55 DPG56.   14000045
531132                                                                  14000145
531133     EVALUATE TRUE                                                14000245
531134         WHEN DPG54-NO-ERROR                                      14000345
531135         MOVE CORR PV-DATE-ISO     TO PV-DATE-USA                 05982258
531136         MOVE PV-DATE-USA          TO PV-DATE-USA-1               05982458
531137         MOVE '/'                  TO SLASH-1                             
531138                                      SLASH-2                             
531139         MOVE PV-DATE-USA-1        TO PV-DATE-USA                 05982458
531141         MOVE PV-DATE-USA          TO ADATEO                      05982458
531142         MOVE DP015-GREEN              TO ADATEC                          
531143         MOVE DP015-UNDERLINE          TO ADATEH                          
531144                                                                  14000545
531145         WHEN (DPG54-DATE-INVALID  OR  DPG54-SEVERE-ERROR               45
531146             OR DPG54-WARNING-ERROR)                                      
531147*            DISPLAY INVALID DATE ERROR MESSAGE                   14000745
531148             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 14000845
531149             MOVE PC-TSYMSG-01339         TO DP020-MSG-NUMBER     14000945
531150             MOVE CORR PV-DATE-ISO        TO PV-DATE-USA                98
531151             MOVE PV-DATE-USA             TO PV-DATE-USA-1              98
531152             MOVE '/'                     TO SLASH-1                      
531153                                             SLASH-2                      
531154             MOVE PV-DATE-USA-1           TO PV-DATE-USA                98
531155             MOVE PV-DATE-USA             TO ADATEO                     98
531156             MOVE -1                      TO ADATEL                     45
531157             MOVE DP015-REVERSE           TO ADATEH                     45
531158             MOVE DP015-RED               TO ADATEC                     45
531159             SET DP020-MSG-FATAL                                  14001345
531160                 PS-ERROR                 TO TRUE                 14001445
531161                                                                  14001546
531162         WHEN OTHER                                               14001645
531163             SET DP013-LOGIC-ABEND TO TRUE                        14001745
531164             SET DP013-NO-ROLLBACK TO TRUE                        14001845
531165             MOVE '3000-EDIT-DATA-IN-COMMAREA'                    14001945
531166                                   TO DP013-PARAGRAPH             14002045
531167             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           14002145
531168                                   TO DP013-MESSAGE-TEXT(1)       14002245
531169             MOVE DPG54-ERROR-MESSAGE                             14002345
531170                                   TO DP013-MESSAGE-TEXT(2)       14002445
531171             PERFORM DP013-0000-PROCESS-ABEND                     14002545
531172     END-EVALUATE.                                                14002645
531180 EJECT                                                                    
531189                                                                          
531190 EJECT                                                                    
531191*----------------------------------------------------------------*        
531192*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
531193*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
531194*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
531195*    DISPLAY THE PANEL TO USER.                                  *        
531196*----------------------------------------------------------------*        
531197                                                                          
531198 4000-BUILD-INITIAL-PANEL.                                                
531199                                                                          
531200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
531201                                 ASC-BLOCK-ENTRIES (2).                   
531202     MOVE +1                 TO ASC-BLK-SUB.                              
531203     SET ASC-ITEMS-LEFT-ON-DB                                             
531204                             TO TRUE.                                     
531205                                                                          
531206     MOVE +0                 TO ASC-ITEM-SUB                              
531207                                ASC-NUMBER-OF-ITEMS-READ                  
531208                                ASC-NUMBER-OF-SELECTED-ITEMS              
531209                                ASC-HIGHEST-BLOCK-WRITTEN                 
531210                                ASC-START-OF-SELECTED-RANGE               
531211                                ASC-END-OF-SELECTED-RANGE                 
531212                                ASC-ITEM-AT-TOP-OF-PANEL.                 
531213                                                                          
531214     PERFORM 4100-PREPARE-CURSOR.                                         
531215                                                                          
531216     PERFORM 4010-OPEN-CURSOR.                                            
531217                                                                          
531218     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
531219                                                                          
531220     PERFORM 4020-CLOSE-CURSOR.                                           
531221                                                                          
531222*    MOVE +1                   TO  PV-TOP-ITEM.                           
531223     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
531224         IF DP020-FK-REFRESH (DP020-SRC-AID)                              
531225                 CONTINUE                                                 
531226         ELSE                                                             
531228             MOVE +1 TO ASC-ITEM-AT-TOP-OF-PANEL                          
531229             SET DP030-OVERRIDE-GO                                        
531230*            SET DP020-NEXT-ACT-APPL-ERROR                                
531231                               TO  TRUE                                   
531232         END-IF                                                           
531233         SET DP020-MSG-FATAL   TO  TRUE                                   
531234         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                       
531235     ELSE                                                                 
531236*        MOVE -1               TO MR-SELECTL (1)                          
531237         SET DP030-SET-CURSOR-APPL-1                                      
531238                               TO TRUE                                    
531239         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
531240     END-IF.                                                              
531241 EJECT                                                                    
531242*----------------------------------------------------------------*        
531243* OPEN THE TMESSAGE CURSOR.                                      *        
531244*   IN THIS PARTICULAR APPLICATION ONE OF 4 DIFFERENT CURSORS    *        
531245*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
531246*   USER.                                                        *        
531247*----------------------------------------------------------------*        
531248                                                                          
531249 4010-OPEN-CURSOR.                                                        
531250     PERFORM                                                              
531251         WITH TEST AFTER                                                  
531252         VARYING PV-RETRY-COUNTER                                         
531253         FROM 1 BY 1                                                      
531254         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
531255                   OR (SQLCODE = ZERO))                                   
531256                                                                          
531257         EXEC SQL                                                         
531258             OPEN PRINT_QUEUE_CURSOR                                      
531259         END-EXEC                                                         
531260                                                                          
531261         EVALUATE TRUE                                                    
531262             WHEN SQLCODE = ZERO                                          
531263             WHEN SQLCODE = -904                                          
531264             WHEN SQLCODE = -913                                          
531265                 CONTINUE                                                 
531266             WHEN SQLWARN0 NOT = SPACES                                   
531267             WHEN SQLCODE < ZERO                                          
531268             WHEN SQLCODE > ZERO                                          
531269                 MOVE '4010-OPEN-CURSOR'                                  
531270                                   TO DP013-PARAGRAPH                     
531271                 MOVE 'OPEN PRINT_QUEUE_CURSOR'                           
531272                                   TO DP013-MESSAGE-TEXT (1)              
531273                 MOVE SQLCA        TO DP013-SQLCA                         
531274                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)            
531275                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)            
531276                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (3)            
531277                 SET DP013-DB2-ABEND                                      
531278                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
531279                 PERFORM DP013-0000-PROCESS-ABEND                         
531280         END-EVALUATE                                                     
531281     END-PERFORM.                                                         
531282*                                                                         
531283     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
531284         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH                     
531285         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
531286                                   TO DP013-MESSAGE-TEXT (1)              
531287         MOVE SQLCA                TO DP013-SQLCA                         
531288         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)            
531289         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (2)            
531290         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (3)            
531291         SET DP013-DB2-ABEND                                              
531292             DP013-XCTL-DISPLAY-RESTART                                   
531293                                   TO TRUE                                
531294         PERFORM DP013-0000-PROCESS-ABEND                                 
531295     END-IF.                                                              
531296                                                                          
531297 EJECT                                                                    
531298*----------------------------------------------------------------*        
531299* CLOSE THE TMESSAGE CURSOR.                                     *        
531300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *        
531301*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
531302*   USER.                                                        *        
531303*----------------------------------------------------------------*        
531304                                                                          
531305 4020-CLOSE-CURSOR.                                                       
531306         EXEC SQL                                                         
531307             CLOSE PRINT_QUEUE_CURSOR                                     
531308         END-EXEC                                                         
531309*                                                                         
531310     EVALUATE TRUE                                                        
531311         WHEN SQLCODE = ZERO                                              
531312             CONTINUE                                                     
531313         WHEN SQLWARN0 NOT = SPACES                                       
531314         WHEN SQLCODE < ZERO                                              
531315         WHEN SQLCODE > ZERO                                              
531316             MOVE '4020-CLOSE-CURSOR'                                     
531317                               TO DP013-PARAGRAPH                         
531318             MOVE 'CLOSE PRETICKET REQUEST CURSOR'                        
531319                               TO DP013-MESSAGE-TEXT (1)                  
531320             MOVE SQLCA        TO DP013-SQLCA                             
531321             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)                
531322             MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)                
531323             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (3)                
531324             SET DP013-DB2-ABEND                                          
531325                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
531326             PERFORM DP013-0000-PROCESS-ABEND                             
531327     END-EVALUATE.                                                        
531328                                                                          
531329 EJECT                                                                    
531330*----------------------------------------------------------------*        
531331*    SET UP THE HOST VARIABLES.                                  *        
531332*----------------------------------------------------------------*        
531333                                                                          
531334 4100-PREPARE-CURSOR.                                                     
531335                                                                          
531336******************************************************************14640023
531337** GETS THE CURRENT DATE.                                         14650023
531338******************************************************************14660023
531339 4200-GET-CURRENT-DATE.                                           14670023
531340                                                                  14680023
531341     EXEC SQL                                                     14690023
531342        SET :ASC-CURRENT-DATE = CURRENT DATE                      14700023
531343     END-EXEC.                                                    14710023
531344                                                                  14720023
531345     EVALUATE TRUE                                                14730023
531346         WHEN SQLCODE = ZERO                                      14740023
531347             CONTINUE                                             14750023
531348         WHEN OTHER                                               14760023
531349             MOVE '4200-GET-CURRENT-DATE'                         14770023
531350                               TO DP013-PARAGRAPH                 14780023
531351             MOVE SQLCA        TO DP013-SQLCA                     14790023
531352             SET DP013-DB2-ABEND                                  14800023
531353                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14810023
531354             PERFORM DP013-0000-PROCESS-ABEND                     14820023
531355     END-EVALUATE.                                                14830023
531356                                                                  14830145
531357*----------------------------------------------------------------*14830245
531358*    GET THE DEFAULT DATE LIMIT --                                      45
531359*----------------------------------------------------------------*14830445
           INITIALIZE DPG51 DPG52 DPG53                                         
                      DPG54 DPG55 DPG56.                                        
531364                                                                  14831145
531365     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     14831245
531366                                                                  14832145
531367     MOVE ASC-CURRENT-DATE            TO DPG52-LK-DATE-INPUT.     14832245
531368     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    14832345
531369                                                                  14832445
531370     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    14832545
531371                                             DPG54 DPG55 DPG56.   14832645
531372                                                                  14832745
531373     EVALUATE TRUE                                                14832845
531374         WHEN DPG54-NO-ERROR                                      14832945
531375             MOVE DPG55-DB2-ISO-DATE-FMT  TO ASC-DATE-LIMIT       14835745
531376                                          ASC-DEFAULT-DATE-LIMIT  14835847
531377                                                                  14839045
531378         WHEN OTHER                                               14840045
531379             SET DP013-LOGIC-ABEND TO TRUE                        14840145
531380             SET DP013-NO-ROLLBACK TO TRUE                        14840245
531381             MOVE '4200-GET-CURRENT-DATE'                         14840346
531382                                   TO DP013-PARAGRAPH             14840445
531383             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           14840545
531384                                   TO DP013-MESSAGE-TEXT(1)       14840645
531385             MOVE 'TO GET THE DEFAULT DATE LIMIT'                 14840746
531386                                   TO DP013-MESSAGE-TEXT(2)       14840845
531387             MOVE DPG54-ERROR-MESSAGE                             14840946
531388                                   TO DP013-MESSAGE-TEXT(3)       14841046
531389             PERFORM DP013-0000-PROCESS-ABEND                     14841146
531390     END-EVALUATE.                                                14841246
531391                                                                  14841346
531392                                                                          
531393 EJECT                                                                    
531394*----------------------------------------------------------------*        
531395*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
531396*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
531397*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
531398*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
531399*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
531400*                                                                *        
531401*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
531402*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
531403*    UPON INITIALIZATION.                                        *        
531404*----------------------------------------------------------------*        
531405                                                                          
531406 4300-READ-ITEMS-FROM-DB.                                                 
531407                                                                          
531408     PERFORM                                                              
531409         VARYING PV-READ-COUNT                                            
531410         FROM 1 BY 1                                                      
531411         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
531412            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
531413                                                                          
531414         PERFORM 4310-FETCH                                               
531415                                                                          
531416         IF  ASC-ITEMS-LEFT-ON-DB                                         
531417             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
531418                 ADD +1            TO ASC-ITEM-SUB                        
531419             ELSE                                                         
531420                 ADD +1            TO ASC-BLK-SUB                         
531421                 MOVE +1           TO ASC-ITEM-SUB                        
531422                                                                          
531423                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
531424                     MOVE +1       TO ASC-BLK-SUB                         
531425                     SET ASC-BLOCK-MODIFIED (1)                           
531426                                   TO TRUE                                
531427                     PERFORM 5100-WRITE-TEMP-STORAGE                      
531428                     MOVE ASC-BLOCK-ENTRIES                               
531429                               (PC-MAX-BLOCKS-IN-ARRAY)                   
531430                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
531431                     ADD +1        TO ASC-BLK-SUB                         
531432                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
531433                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
531434                                   TO TRUE                                
531435                 END-IF                                                   
531436             END-IF                                                       
531437             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
531438             MOVE ASC-NUMBER-OF-ITEMS-READ                                
531439                                   TO ASC-LIST-ITEM-NUMBER                
531440                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
531441             MOVE PTKREQ-PRT-RQSTR-ID TO ASC-USERID                       
531442                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531443             MOVE PTKREQ-PO-NBR    TO ASC-PO-NUMBER                       
531444                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531445*            MOVE PTKREQ-PO-REQ-NBR                                       
531446*                                  TO ASC-RQST-NBR                        
531447*                                     (ASC-BLK-SUB ASC-ITEM-SUB)        86
531448             MOVE PTKREQ-REQ-STAT-CDE                                     
531449                                   TO ASC-RQST-STAT                       
531450                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531451*            IF PTKREQ-REQ-STAT-CDE = 'I'                                 
531452*               SET ASC-INPROCESS (ASC-BLK-SUB ASC-ITEM-SUB)              
531453*                   TO TRUE                                               
531454*            END-IF                                                       
531455                                                                          
531456             MOVE PTKREQ-REQ-CREN-DTE                                     
531457                                   TO PV-DATE-ISO                         
531458             MOVE CORR PV-DATE-ISO TO PV-DATE-DISPLAY                     
531459             MOVE PV-DATE-DISPLAY  TO ASC-REQUEST-DATE                    
531460                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531461             MOVE PTKREQ-ACTL-PRT-DTE                                     
531462                                   TO PV-DATE-ISO                         
531463             MOVE CORR PV-DATE-ISO TO PV-DATE-DISPLAY                     
531464             MOVE PV-DATE-DISPLAY  TO ASC-ACTUAL-PRT-DATE                 
531465                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531466             MOVE PTKREQ-PRT-BY-DTE                                       
531467                                   TO PV-DATE-ISO                         
531468             MOVE CORR PV-DATE-ISO TO PV-DATE-DISPLAY                     
531469             MOVE PV-DATE-DISPLAY  TO ASC-PRINT-DUE-DATE                  
531470                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531471*            MOVE ENTNME-ENT-NAME-DESC                                    
531472*                                  TO ASC-VENDOR-NAME                     
531473*                                     (ASC-BLK-SUB ASC-ITEM-SUB)        86
531474             IF PV-REQUEST-TICKET-TOTAL > 9999999                         
531475                 MOVE '4300-READ-ITEMS-FROM-DB'                           
531476                               TO DP013-PARAGRAPH                         
531477                 MOVE 'TICKET QUANTITY TOO LARGE FOR FIELDS'              
531478                               TO DP013-MESSAGE-TEXT (1)                  
531479                 MOVE PTKREQ-PO-NBR                                       
531480                               TO PV-DISPLAY-COMP1                        
531481                 MOVE PV-REQUEST-TICKET-TOTAL                             
531482                               TO PV-DISPLAY-COMP2                        
531483                 STRING 'PO: '          DELIMITED BY SIZE                 
531484                        PV-DISPLAY-COMP1                                  
531485                                        DELIMITED BY SIZE                 
531486                        ' - TICKET QUANTITY: '                            
531487                                        DELIMITED BY SIZE                 
531488                        PV-DISPLAY-COMP2                                  
531489                                        DELIMITED BY SIZE                 
531490                               INTO PV-DISPLAY-ABEND-MESSAGE              
531491                 MOVE PV-DISPLAY-ABEND-MESSAGE                            
531492                               TO DP013-MESSAGE-TEXT (2)                  
531493                 MOVE PV-REQUEST-TICKET-TOTAL                             
531494                               TO DP013-MESSAGE-TEXT (3)                  
531495                 SET DP013-LOGIC-ABEND                                    
531496                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
531497                 PERFORM DP013-0000-PROCESS-ABEND                         
531498             ELSE                                                         
531499                 MOVE PV-REQUEST-TICKET-TOTAL                             
531500                                   TO ASC-RQSTD-TICKETS                   
531501                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531502             END-IF                                                       
531503                                                                          
531504             IF PV-REQUEST-LINE-COUNT > 9999                              
531505                 MOVE '4300-READ-ITEMS-FROM-DB'                           
531506                               TO DP013-PARAGRAPH                         
531507                 MOVE 'LINE COUNT TOO LARGE FOR FIELDS'                   
531508                               TO DP013-MESSAGE-TEXT (1)                  
531509                 MOVE PTKREQ-PO-NBR                                       
531510                               TO PV-DISPLAY-COMP1                        
531511                 MOVE PV-REQUEST-LINE-COUNT                               
531512                               TO PV-DISPLAY-COMP2                        
531513                 STRING 'PO: '          DELIMITED BY SIZE                 
531514                        PV-DISPLAY-COMP1                                  
531515                                        DELIMITED BY SIZE                 
531516                        ' - LINE COUNT: '                                 
531517                                        DELIMITED BY SIZE                 
531518                        PV-DISPLAY-COMP2                                  
531519                                        DELIMITED BY SIZE                 
531520                               INTO PV-DISPLAY-ABEND-MESSAGE              
531521                 MOVE PV-DISPLAY-ABEND-MESSAGE                            
531522                               TO DP013-MESSAGE-TEXT (2)                  
531523                 MOVE PV-REQUEST-LINE-COUNT                               
531524                               TO DP013-MESSAGE-TEXT (3)                  
531525                 SET DP013-LOGIC-ABEND                                    
531526                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
531527                 PERFORM DP013-0000-PROCESS-ABEND                         
531528             ELSE                                                         
531529                 MOVE PV-REQUEST-LINE-COUNT                               
531530                                   TO ASC-LINE-COUNT                      
531531                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531532             END-IF                                                       
531533                                                                          
531534             PERFORM 4320-GET-TICKET-TYPE                                 
531535             MOVE PTKLNE-TKT-DESC  TO ASC-TICKET-TYPE                     
531536                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531537                                                                          
531538             MOVE PTKREQ-PRTY-STAT-CDE                                    
531539                                   TO ASC-PRIORITY                        
531540                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
531541         END-IF                                                           
531542     END-PERFORM.                                                         
531543                                                                          
531544     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
531545         MOVE +1               TO ASC-BLK-SUB                             
531546         PERFORM 5100-WRITE-TEMP-STORAGE                                  
531547         ADD +1                TO ASC-BLK-SUB                             
531548         PERFORM 5100-WRITE-TEMP-STORAGE                                  
531549                                                                          
531550         MOVE 1                TO ASC-BLK-SUB                             
531551                                  PV-BLOCK-NUMBER                         
531552         PERFORM 4410-READ-TEMP-STORAGE                                   
531553         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
531554             MOVE 2            TO ASC-BLK-SUB                             
531555                                  PV-BLOCK-NUMBER                         
531556             PERFORM 4410-READ-TEMP-STORAGE                               
531557         END-IF                                                           
531558     END-IF.                                                              
531559 EJECT                                                                    
531560*----------------------------------------------------------------*        
531561*    FETCH THE MESSAGE CURSOR.                                   *        
531562*----------------------------------------------------------------*        
531563                                                                          
531564 4310-FETCH.                                                              
531565                                                                          
531566     EXEC SQL                                                             
531567          FETCH PRINT_QUEUE_CURSOR                                        
531568          INTO                                                            
531569                :PTKREQ-PO-REQ-NBR                                        
531570              , :PTKREQ-PO-NBR                                            
531571              , :PTKREQ-REQ-CREN-DTE                                      
531572              , :PTKREQ-PRT-BY-DTE                                        
531573              , :PTKREQ-ACTL-PRT-DTE                                      
531574              , :PV-REQUEST-TICKET-TOTAL                                  
531575              , :PV-REQUEST-LINE-COUNT                                    
531576              , :PTKREQ-PRTY-STAT-CDE                                     
531577              , :PTKREQ-REQ-STAT-CDE                                      
531578              , :PTKREQ-PRT-RQSTR-ID                                    00
531579     END-EXEC                                                             
531580                                                                          
531581     EVALUATE TRUE                                                        
531582         WHEN SQLCODE = ZERO                                              
531583         WHEN SQLCODE = +100                                              
531584              CONTINUE                                                    
531585         WHEN SQLWARN0 NOT = SPACE                                        
531586         WHEN SQLCODE NOT = ZERO                                          
531587              MOVE '4310-FETCH-CURSOR'                                    
531588                               TO DP013-PARAGRAPH                         
531589              MOVE 'FETCH PRINT_QUEUE_CURSOR'                             
531590                               TO DP013-MESSAGE-TEXT (1)                  
531591              MOVE SQLCA       TO DP013-SQLCA                             
531592              SET DP013-DB2-ABEND                                         
531593                               TO TRUE                                    
531594              PERFORM DP013-0000-PROCESS-ABEND                            
531595     END-EVALUATE.                                                        
531596                                                                          
531597     IF  SQLCODE EQUAL +100                                               
531598         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
531599                                   TO TRUE                                
531600     END-IF.                                                              
531601                                                                          
531602*----------------------------------------------------------------*        
531603*    GET THE TICKET TYPE FROM THE REQUEST                        *        
531604*----------------------------------------------------------------*        
531605                                                                          
531606 4320-GET-TICKET-TYPE.                                                    
531607                                                                          
531608     EXEC SQL                                                             
531609          SELECT                                                          
531610                 DISTINCT(TKT_DESC)                                       
531611          INTO                                                            
531612                :PTKLNE-TKT-DESC                                          
531613          FROM                                                            
531614                TPTKLNE                                                   
531615          WHERE                                                           
531616                PO_REQ_NBR = :PTKREQ-PO-REQ-NBR                           
531617     END-EXEC                                                             
531618                                                                          
531619     EVALUATE TRUE                                                        
531620         WHEN SQLCODE = ZERO                                              
531621              CONTINUE                                                    
531622         WHEN SQLCODE = -811                                              
531623              MOVE 'MULTIPLE' TO PTKLNE-TKT-DESC                          
531624         WHEN SQLWARN0 NOT = SPACE                                        
531625         WHEN SQLCODE NOT = ZERO                                          
531626              MOVE '4320-GET-TICKET-TYPE'                                 
531627                               TO DP013-PARAGRAPH                         
531628              MOVE 'SELECT TICKET TYPE FROM REQUEST LINE TABLE'           
531629                               TO DP013-MESSAGE-TEXT (1)                  
531630              MOVE SQLCA       TO DP013-SQLCA                             
531631              SET DP013-DB2-ABEND                                         
531632                               TO TRUE                                    
531633              PERFORM DP013-0000-PROCESS-ABEND                            
531634     END-EVALUATE.                                                        
531635                                                                          
531636     IF  SQLCODE EQUAL +100                                               
531637         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
531638                                   TO TRUE                                
531639     END-IF.                                                              
531640                                                                          
531641 EJECT                                                                    
531642*----------------------------------------------------------------*        
531643* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
531644*----------------------------------------------------------------*        
531645                                                                          
531646 4400-MOVE-COMMAREA-TO-SCREEN.                                            
531647     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
531648         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
531649         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
531650             IF PV-TOP-ITEM = +0                                          
531651                MOVE +0 TO ASC-ITEM-AT-TOP-OF-PANEL                       
531652                MOVE +1 TO PV-TOP-ITEM                                    
531653             END-IF                                                       
531654             MOVE +1    TO ASC-BLK-SUB                                    
531655             PERFORM 5100-WRITE-TEMP-STORAGE                              
531656             ADD +1     TO ASC-BLK-SUB                                    
531657             PERFORM 5100-WRITE-TEMP-STORAGE                              
531658             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
531659                 GIVING PV-BLOCK-NUMBER                                   
531660                 REMAINDER PV-REMAINDER                                   
531661             IF  PV-REMAINDER > ZERO                                      
531662                 ADD +1 TO PV-BLOCK-NUMBER                                
531663             END-IF                                                       
531664             MOVE +1    TO ASC-BLK-SUB                                    
531665             PERFORM 4410-READ-TEMP-STORAGE                               
531666             ADD +1     TO ASC-BLK-SUB                                    
531667                           PV-BLOCK-NUMBER                                
531668             PERFORM 4410-READ-TEMP-STORAGE                               
531669     END-IF.                                                              
531670     MOVE +1            TO ASC-BLK-SUB.                                   
531671     COMPUTE ASC-ITEM-SUB =                                               
531672         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
531673         + PC-ITEMS-PER-PANEL).                                           
531674*                                                                         
531675     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
531676         ADD +1         TO ASC-BLK-SUB                                    
531677         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
531678     END-IF.                                                              
531679*                                                                         
531680     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
531681         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
531682*    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
531683     PERFORM 4420-FORMAT-LIST-LINES                                       
531684         VARYING PV-SUB                                                   
531685         FROM PC-ITEMS-PER-PANEL BY -1                                    
531686         UNTIL PV-SUB < +1.                                               
531687*                                                                         
531688     COMPUTE ASC-ITEMS-DISPLAYED =                                        
531689         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
531690     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
531691                                      ASTRTITO.                           
531692     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
531693     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
531694*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
531695*                                  TO ASELITO.                            
531696     MOVE ASC-DATE-LIMIT           TO PV-DATE-ISO.                        
531697     MOVE CORR PV-DATE-ISO         TO PV-DATE-USA.                        
531698     MOVE PV-DATE-USA              TO PV-DATE-USA-1.                      
531699     MOVE '/'                      TO SLASH-1                             
531700                                      SLASH-2.                            
531701     MOVE PV-DATE-USA-1            TO PV-DATE-USA.                        
531702     MOVE PV-DATE-USA              TO ADATEO.                             
531704*                                                                         
531705     IF  DP020-MSG-NUMBER-X = SPACE                                       
531706         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
531707*            --- MORE ITEMS TO DISPLAY ----                               
531708             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
531709             SET DP020-MSG-INFORMATIONAL TO TRUE                          
531710         END-IF                                                           
531711     END-IF.                                                              
531712*----------------------------------------------------------------*        
531713*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
531714*----------------------------------------------------------------*        
531715                                                                          
531716 4410-READ-TEMP-STORAGE.                                                  
531717                                                                          
531718     EXEC CICS                                                            
531719         READQ TS                                                         
531720             QUEUE (ASC-LIST-QUEUE-NAME)                                  
531721             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
531722             ITEM  (PV-BLOCK-NUMBER)                                      
531723             RESP  (PV-CICS-RESP)                                         
531724     END-EXEC.                                                            
531725                                                                          
531726     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
531727       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
531728         CONTINUE                                                         
531729     ELSE                                                                 
531730         SET DP013-CICS-ABEND     TO TRUE                                 
531731         SET DP013-NO-ROLLBACK    TO TRUE                                 
531732         MOVE '4410-READ-TEMP-STORAGE'                                    
531733                                  TO DP013-PARAGRAPH                      
531734         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
531735                                  TO DP013-MESSAGE-TEXT(1)                
531736         PERFORM DP013-0000-PROCESS-ABEND                                 
531737     END-IF.                                                              
531738                                                                          
531739     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
531740*                                                                         
531741     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
531742         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
531743     END-IF.                                                              
531744 EJECT                                                                    
531745*----------------------------------------------------------------*        
531746*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
531747*----------------------------------------------------------------*        
531748                                                                          
531749 4420-FORMAT-LIST-LINES.                                                  
531750     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
531751         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
531752         MOVE SPACE              TO                                       
531753                                    MR-PO-NUMBER (PV-SUB)                 
531754                                    MR-PRINT-DUE-DATE (PV-SUB)          86
531755                                    MR-PRIORITY (PV-SUB)                86
531756                                    MR-TICKET-TYPE (PV-SUB)             86
531757                                    MR-LINE-COUNT-X (PV-SUB)            86
531758                                    MR-RQSTD-TICKETS-X (PV-SUB)         86
531759                                    MR-REQUEST-DATE (PV-SUB)              
531760                                    MR-ACTUAL-PRT-DATE (PV-SUB)           
531761                                    MR-USERID (PV-SUB)                    
531762                                    MR-RQST-STAT (PV-SUB)                 
531763      ELSE                                                                
531764         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
531765             MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)                   
531766                  TO MR-USERID (PV-SUB)                                   
531767             MOVE ASC-PO-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)                
531768                  TO MR-PO-NUMBER-N (PV-SUB)                              
531769             MOVE ASC-RQST-STAT (ASC-BLK-SUB ASC-ITEM-SUB)                
531770                  TO MR-RQST-STAT (PV-SUB)                                
531771             MOVE ASC-RQSTD-TICKETS (ASC-BLK-SUB ASC-ITEM-SUB)            
531772                  TO  MR-RQSTD-TICKETS (PV-SUB)                           
531773             MOVE ASC-PRINT-DUE-DATE (ASC-BLK-SUB ASC-ITEM-SUB)           
531774                  TO  MR-PRINT-DUE-DATE (PV-SUB)                          
531775             MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)              
531776                  TO  MR-TICKET-TYPE (PV-SUB)                             
531777             MOVE ASC-PRIORITY (ASC-BLK-SUB ASC-ITEM-SUB)                 
531778                  TO  MR-PRIORITY (PV-SUB)                                
531779             MOVE ASC-LINE-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)               
531780                  TO  MR-LINE-COUNT (PV-SUB)                              
531781             MOVE ASC-REQUEST-DATE (ASC-BLK-SUB ASC-ITEM-SUB)             
531782                  TO  MR-REQUEST-DATE (PV-SUB)                            
531783             MOVE ASC-ACTUAL-PRT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)          
531784                  TO  MR-ACTUAL-PRT-DATE (PV-SUB)                         
531785                                                                          
531786                 MOVE DP015-BLUE                                          
531787                             TO  MR-PO-NUMBERC (PV-SUB)                   
531788                                 MR-PRINT-DUE-DATEC (PV-SUB)              
531789                                 MR-RQSTD-TICKETSC (PV-SUB)               
531790                                 MR-LINE-COUNTC (PV-SUB)                  
531791                                 MR-TICKET-TYPEC (PV-SUB)                 
531792                                 MR-PRIORITYC (PV-SUB)                    
531793                                                                          
531794         END-IF                                                           
531795     END-IF.                                                              
531796     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
531797     IF  ASC-ITEM-SUB < + 1                                               
531798         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
531799         MOVE +1                 TO ASC-BLK-SUB                           
531800     END-IF.                                                              
531865 EJECT                                                                    
531866*----------------------------------------------------------------*        
531867*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
531868*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
531869*----------------------------------------------------------------*        
531870                                                                          
531871 5100-WRITE-TEMP-STORAGE.                                                 
531872     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
531873                                   TO PV-LIST-ITEM-NUMBER.                
531874     COMPUTE PV-BLOCK-NUMBER =                                            
531875         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
531876                                                                          
531877     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
531878     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
531879         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
531880             PERFORM 5105-REWRITE-ASC-LISTQ                               
531881         END-IF                                                           
531882     ELSE                                                                 
531883         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
531884         ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
531885         PERFORM 5110-WRITE-ASC-LISTQ                                     
531886         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
531887     END-IF.                                                              
531888                                                                          
531889     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
531890******************************************************************        
531891** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **        
531892** SPECIFIC COMMAREA.                                           **        
531893******************************************************************        
531894 5105-REWRITE-ASC-LISTQ.                                                  
531895     EXEC CICS                                                            
531896         WRITEQ TS                                                        
531897             QUEUE (ASC-LIST-QUEUE-NAME)                                  
531898             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
531899             ITEM  (PV-BLOCK-NUMBER)                                      
531900             REWRITE                                                      
531901             RESP  (PV-CICS-RESP)                                         
531902     END-EXEC.                                                            
531903                                                                          
531904     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
531905         CONTINUE                                                         
531906     ELSE                                                                 
531907         SET DP013-CICS-ABEND            TO TRUE                          
531908         SET DP013-NO-ROLLBACK           TO TRUE                          
531909         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
531910         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
531911                                         TO DP013-MESSAGE-TEXT(1)         
531912         PERFORM DP013-0000-PROCESS-ABEND                                 
531913     END-IF.                                                              
531914                                                                          
531915******************************************************************        
531916** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **        
531917** SPECIFIC COMMAREA.                                           **        
531918******************************************************************        
531919 5110-WRITE-ASC-LISTQ.                                                    
531920     EXEC CICS                                                            
531921         WRITEQ TS                                                        
531922             QUEUE (ASC-LIST-QUEUE-NAME)                                  
531923             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
531924             ITEM  (PV-BLOCK-NUMBER)                                      
531925             RESP  (PV-CICS-RESP)                                         
531926     END-EXEC.                                                            
531927     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
531928         SET DP013-CICS-ABEND      TO TRUE                                
531929         SET DP013-NO-ROLLBACK     TO TRUE                                
531930         MOVE '5110-WRITE-ASC-LISTQ'                                      
531931                                   TO DP013-PARAGRAPH                     
531932         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
531933                                   TO DP013-MESSAGE-TEXT(1)               
531934         PERFORM DP013-0000-PROCESS-ABEND                                 
531935     END-IF.                                                              
531936 EJECT                                                                    
531967                                                                          
531968*----------------------------------------------------------------*        
531969* CHANGE EACH SELECTED REQUEST TO BE "COMPLETED"                          
531970*----------------------------------------------------------------*        
531971                                                                          
531972 5300-COMPLETE-SELECTED-ITEMS.                                            
531973                                                                          
531974     MOVE +1                   TO  ASC-BLK-SUB.                           
531975     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
531976     ADD +1                    TO  ASC-BLK-SUB.                           
531977     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
531978                                                                          
531979     PERFORM VARYING PV-ITEM FROM 1 BY 1                                  
531980     UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN                      
531981                                                                          
531982         PERFORM 6112-READ-LIST-QUEUE                                     
531983                                                                          
531984         IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                           
531985             PERFORM VARYING LQW-IDX FROM 1 BY 1                          
531986             UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                
531987               OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO              
531988                                                                          
531989*                IF  LQW-SELECT (LQW-IDX)                                 
531990*                    PERFORM 5310-COMPLETE-ITEM                           
531991*                END-IF                                                   
531992                                                                          
531993             END-PERFORM                                                  
531994             PERFORM 6113-REWRITE-LIST-QUEUE                              
531995         END-IF                                                           
531996     END-PERFORM.                                                         
531997                                                                          
532034*----------------------------------------------------------------*        
532035*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
532036*----------------------------------------------------------------*        
532037                                                                          
532038 6112-READ-LIST-QUEUE.                                                    
532039                                                                          
532040     EXEC CICS                                                            
532041         READQ TS                                                         
532042             QUEUE (ASC-LIST-QUEUE-NAME)                                  
532043             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
532044             ITEM  (PV-ITEM)                                              
532045             RESP  (PV-CICS-RESP)                                         
532046     END-EXEC.                                                            
532047*                                                                         
532048     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
532049         CONTINUE                                                         
532050     ELSE                                                                 
532051         SET DP013-CICS-ABEND        TO TRUE                              
532052         SET DP013-NO-ROLLBACK       TO TRUE                              
532053         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
532054         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
532055                                     TO DP013-MESSAGE-TEXT(1)             
532056         PERFORM DP013-0000-PROCESS-ABEND                                 
532057     END-IF.                                                              
532058                                                                          
532059******************************************************************        
532060** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE WORK AREA       **        
532061******************************************************************        
532062 6113-REWRITE-LIST-QUEUE.                                                 
532063     EXEC CICS                                                            
532064         WRITEQ TS                                                        
532065             QUEUE (ASC-LIST-QUEUE-NAME)                                  
532066             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
532067             ITEM  (PV-ITEM)                                              
532068             REWRITE                                                      
532069             RESP  (PV-CICS-RESP)                                         
532070     END-EXEC.                                                            
532071                                                                          
532072     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
532073         CONTINUE                                                         
532074     ELSE                                                                 
532075         SET DP013-CICS-ABEND            TO TRUE                          
532076         SET DP013-NO-ROLLBACK           TO TRUE                          
532077         MOVE '61113-REWRITE-LIST-QUEUE' TO DP013-PARAGRAPH               
532078         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
532079                                         TO DP013-MESSAGE-TEXT(1)         
532080         PERFORM DP013-0000-PROCESS-ABEND                                 
532081     END-IF.                                                              
532082                                                                          
532083 EJECT                                                                    
532084*----------------------------------------------------------------*        
532085*    ABEND PROCESSOR MODULE                                      *        
532086*----------------------------------------------------------------*        
532087                                                                          
532088     COPY DPPD013.                                                        
