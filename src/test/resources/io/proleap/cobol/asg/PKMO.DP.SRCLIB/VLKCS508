00001 ******************************************************************00010001
00002  IDENTIFICATION DIVISION.                                         00020001
00003 ******************************************************************00030001
00004                                                                   00040001
00005  PROGRAM-ID.                VLKCS508.                             00050001
00006  AUTHOR.                    MICHAEL WALTERS.                      00060001
00007  INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
00008  DATE-WRITTEN.              06-03-96.                             00080001
00009  DATE-COMPILED.                                                   00090001
00010                                                                   00100001
00011 ******************************************************************00110001
00012 *  CICS PROGRAM - VLKCS508 - V508                                *00120001
00013 *                                                                *00130001
00014 *       PO SYSTEM PRETICKET DETAIL INQUIRE SCREEN                *00140001
00015 *                                                                *00150001
      *  THIS SCREEN WILL SHOW THE DETAIL OF ONE PRETICKET REQUEST     *00160001
00027 ******************************************************************00170001
263627*----------------------------------------------------------------*00171052
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00172052
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00173052
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00174052
263627*----------------------------------------------------------------*00175052
CICS  * CHANGED 11/11/2022    BY JIM HUNTER      WR: CHG0278236         00176053
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00177053
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00178053
CICS  ***************************************************************** 00179053
00028                                                                   00180001
002000 EJECT                                                            00190001
002100 ENVIRONMENT DIVISION.                                            00200001
002200                                                                  00210001
002300 DATA DIVISION.                                                   00220001
002400                                                                  00230001
002500 WORKING-STORAGE SECTION.                                         00240001
002600                                                                  00250001
002700 01  DK-DB2-KEYS.                                                 00260001
002800     05  DK-PO-NUMBER                   PIC S9(09) COMP.          00270001
003000     05  DK-PO-REQ-NBR                  PIC S9(09) COMP.          00280001
003100     05  DK-ENT-ID                      PIC S9(09) COMP.          00290001
003400                                                                  00380001
003500 01  PC-PROGRAM-CONSTANTS.                                        00390001
004000     05  PC-MAX-XTRA-LINES              PIC S9(04) COMP           00400001
004000                                                   VALUE +20.     00410001
004100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00520001
004200                                                    'VL508A  '.   00530001
004300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00540001
004400                                                    'VLKM508 '.   00550001
004500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00560001
004600                                                    'VLKCS508'.   00570001
004900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00600001
005200     05  PC-FORMAT-INDICATOR            PIC  X(01) .              00620001
005400         88 PC-LIST-FORMAT-IND          VALUE '1'.                00630001
005500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +16     00640008
005600                                                    COMP SYNC.    00650001
005700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00660001
005800                                                    COMP SYNC.    00670001
007200     05  PC-TSYMSG-NUMBERS.                                       00790001
007400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00830001
007600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00850001
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00930001
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00940001
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00950001
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00960001
008800         10  PC-TSYMSG-00342            PIC  9(05)  VALUE 00342.  00970001
008900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01000001
009000*                                                                 01010001
009100 01  PS-PROGRAM-SWITCHES.                                         01020001
009200     05  PS-SHIPMENTS-SW                PIC  X(01)  VALUE 'Y'.    01030001
009300         88  PS-NO-SHIPMENTS-LEFT                   VALUE 'N'.    01040001
009400         88  PS-SHIPMENTS-LEFT                      VALUE 'Y'.    01050001
009500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01090001
009600         88  PS-NO-ERROR                            VALUE 'Y'.    01100001
009700         88  PS-ERROR                               VALUE 'N'.    01110001
010100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180001
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190001
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200001
011000*                                                                 01240001
011100 01  PV-PROGRAM-VARIABLES.                                        01250001
011300     05  PV-NUMBER-OF-EXTRA-LINES       PIC S9(09) COMP.          01260001
014700                                                                  01840001
016300     05  PV-SUB                         PIC S9(04)  VALUE +0      02000001
016400                                                    COMP SYNC.    02010001
016500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02020001
016600                                                    COMP SYNC.    02030001
016900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02060001
017000                                                    COMP-3.       02070001
017100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02080001
017200                                                    COMP-3.       02090001
017300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02100001
017400                                                    COMP-3.       02110001
017500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02120001
017600                                                    COMP-3.       02130001
017700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02140001
017800                                                    COMP-3.       02150001
018100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02180001
018200                                                    COMP SYNC.    02190001
018300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02200001
018400                                                    COMP SYNC.    02210001
018500     05  PV-ITEM                        PIC S9(04)  VALUE +0      02220001
018600                                                    COMP SYNC.    02230001
018500     05  PV-SHIP-ITEM                   PIC S9(04)  VALUE +0      02240005
018600                                                    COMP SYNC.    02250005
018700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02260001
018800                                                    COMP SYNC.    02270001
018900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02280001
019000                                                    COMP SYNC.    02290001
019100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02300001
019200                                                    COMP SYNC.    02310001
019300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02320001
019400                                                    COMP SYNC.    02330001
021300******************************************************************02500001
021400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02510001
021500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02520001
021600**  APPLICATION-SPECIFIC COMMAREA.                              **02530001
021700******************************************************************02540001
021800 01  LQW-LIST-QUEUE-WORK-AREA.                                    02550001
021900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02560001
022000     05  LQW-ITEM-ENTRIES               OCCURS 16 TIMES           02570011
022100                                        INDEXED BY LQW-IDX.       02580001
022200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02590001
041300         10  LQW-CARRIER-SHIP-NBR       PIC  X(18).               02600002
041300         10  LQW-PACKAGE-COUNT          PIC  9(03).               02610044
041300         10  LQW-SHIPMENT-MOD-SW        PIC  X(01).               02620002
041300             88 LQW-SHIPMENT-NO-UPD     VALUE ' '.                02630002
041300             88 LQW-SHIPMENT-UPD        VALUE 'U'.                02640002
041300             88 LQW-SHIPMENT-DEL        VALUE 'D'.                02650002
024900                                                                  02660001
023000*---------------------------------------------------------------* 02740000
023100*  RECORD LAYOUT FOR THE MULTIPLE SHIPMENT TEMP STORAGE QUEUE.  * 02750000
023200*---------------------------------------------------------------* 02760000
023300                                                                  02770000
023400     COPY VLWS004.                                                02780052
023500                                                                  02790000
026500*---------------------------------------------------------------* 02800001
026600*    MAP LAYOUT                                                 * 02810001
026700*---------------------------------------------------------------* 02820001
026800                                                                  02830001
026900     COPY VLKM508.                                                02840001
027000*                                                                 02850001
027100 01  MR-OCCURS-LAYOUT                   REDEFINES  VL508AO.       02860001
027200     05  FILLER                         PIC X(42).                02870004
027300     05  MR-SCROLL-AREA                 OCCURS 16 TIMES.          02880008
028700         10  MR-CARRIER-SHIP-NBRL       PIC S9(04) COMP.          02890001
028800         10  MR-CARRIER-SHIP-NBRA       PIC  X(01).               02900001
028900         10  MR-CARRIER-SHIP-NBRC       PIC  X(01).               02910001
029000         10  MR-CARRIER-SHIP-NBRH       PIC  X(01).               02920001
028100         10  MR-CARRIER-SHIP-NBR        PIC  X(18).               02930001
029200                                                                  02940001
028700         10  MR-PACKAGE-COUNTL          PIC S9(04) COMP.          02950002
028800         10  MR-PACKAGE-COUNTA          PIC  X(01).               02960002
028900         10  MR-PACKAGE-COUNTC          PIC  X(01).               02970002
029000         10  MR-PACKAGE-COUNTH          PIC  X(01).               02980002
028100         10  MR-PACKAGE-COUNT-X.                                  02990042
028100             11 MR-PACKAGE-COUNT        PIC  ZZZ.                 03000044
029200                                                                  03010001
031600                                                                  03020001
031900*---------------------------------------------------------------* 03040001
032000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03050001
032100*---------------------------------------------------------------* 03060001
032200                                                                  03070001
032300     COPY DPWS015.                                                03080052
032400                                                                  03090001
032500*---------------------------------------------------------------* 03100001
032600*    FUNCTION KEYS COPYBOOK.                                    * 03110001
032700*---------------------------------------------------------------* 03120001
032800                                                                  03130001
032900     COPY DPWS016.                                                03140052
033000                                                                  03150001
00228                                                                   03160001
00229 *---------------------------------------------------------------* 03240001
00230 *    NUMERIC EDIT LAYOUT.                                       * 03250001
00231 *---------------------------------------------------------------* 03260001
00232                                                                   03270001
00233      COPY DPWS010I.                                               03280052
00234                                                                   03290049
033700*---------------------------------------------------------------* 03300001
033800*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API           * 03310053
033900*---------------------------------------------------------------* 03320001
034000                                                                  03330001
034100     COPY DPWS030.                                                03340052
CICS       COPY DPWS930.                                                03341053
034101                                                                  03350001
034108*---------------------------------------------------------------* 03370001
034109*    STANDARD COMMAREA.                                         * 03380001
034110*---------------------------------------------------------------* 03390001
034120                                                                  03400001
034130     COPY DPWS020.                                                03410052
034140     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03420001
034150                                                                  03430001
034160*---------------------------------------------------------------* 03440001
034170* INTER-APPLICATION COMMAREA.                                   * 03450001
034180*   VLWS002 - IS THE INPUT LAYOUT WHEN COMING FROM THE SHIPPING * 03460004
034190*             MAINTENANCE SCREEN (VLKCS507)                     * 03470004
034200*   VLWS002 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03480004
034300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03490001
034400*---------------------------------------------------------------* 03500001
034500                                                                  03510001
034600         10  INTER-APPL-COMM-AREA       PIC X(200).               03520001
034700     COPY VLWS002.                                                03530052
034800*---------------------------------------------------------------* 03540001
034900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03550001
035000*---------------------------------------------------------------* 03560001
035100         10  ASC-SPECIFIC-COMMAREA.                               03570001
035200             15  ASC-PO-REQ-NBR                      PIC S9(09)   03580001
035300                                                     COMP.        03590001
035400             15  ASC-ENT-ID                          PIC S9(09)   03600001
035500                                                     COMP.        03610001
035400             15  ASC-MAX-COMMENT-SEQ-NBR             PIC S9(04)   03620001
035500                                                     COMP.        03630001
035400             15  ASC-CURRENT-DATE                    PIC  X(10).  03640001
035600             15  ASC-SCREEN-FIELDS.                               03650001
035700                 20  ASC-PO-NUMBER                   PIC S9(09)   03660001
035800                                                     COMP.        03670001
036600                 20  ASC-DPT-NBR                     PIC  X(03).  03680001
036600                 20  ASC-REQUEST-DATE                PIC  X(10).  03690001
036700                 20  ASC-VENDOR-DUE-DATE             PIC  X(10).  03700001
036700                 20  ASC-VENDOR-NAME                 PIC  X(40).  03710001
036600                 20  ASC-PRINT-DUE-DATE              PIC  X(10).  03720001
036500                 20  ASC-REQ-STAT-CDE                PIC  X(01).  03730001
286900                     88 ASC-VALID-STATUS                          03740001
                              VALUE 'A', 'H', 'R'.                      03750050
286900                     88 ASC-ACTIVE-STATUS             VALUE 'A'.  03760001
286900                     88 ASC-CANCELLED-STATUS          VALUE 'C'.  03770001
286900                     88 ASC-HOLD-STATUS               VALUE 'H'.  03780001
286900                     88 ASC-INPROCESS-STATUS          VALUE 'I'.  03790001
286900                     88 ASC-PRINT-STATUS              VALUE 'P'.  03800001
286900                     88 ASC-RUSH-STATUS               VALUE 'R'.  03810001
286900                     88 ASC-SHIPPED-STATUS            VALUE 'S'.  03820001
036200                 20  ASC-REQ-STAT-CDE-DESC           PIC  X(10).  03830001
286900                     88 ASC-ACTIVE-STATUS-DESC                    03840001
287000                     VALUE 'ACTIVE    '.                          03850001
286900                     88 ASC-CANCELLED-STATUS-DESC                 03860001
287000                     VALUE 'CANCELLED '.                          03870001
286900                     88 ASC-HOLD-STATUS-DESC                      03880001
287000                     VALUE 'HOLD      '.                          03890001
286900                     88 ASC-INPROCESS-STATUS-DESC                 03900001
287000                     VALUE 'INPROCESS '.                          03910001
286900                     88 ASC-PRINT-STATUS-DESC                     03920001
287000                     VALUE 'PRINTED   '.                          03930001
286900                     88 ASC-RUSH-STATUS-DESC                      03940001
287000                     VALUE 'RUSH      '.                          03950001
286900                     88 ASC-SHIPPED-STATUS-DESC                   03960001
287000                     VALUE 'SHIPPED   '.                          03970001
036700                 20  ASC-PRIORITY.                                03980001
036700                     25 ASC-PRIORITY-N               PIC  9(02).  03990001
037900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04000001
038000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04010001
038100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04020001
038200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04030001
038300                                                                  04040001
038400                 20  ASC-ITEM-ARRAY.                              04050001
038500                     25  ASC-ITEM-ENTRIES OCCURS 16 TIMES.        04060011
038600                         30  ASC-LIST-ITEM-NUMBER                 04070001
038700                                                     PIC S9(09)   04080001
038800                                                     COMP-3.      04090001
041300                         30  ASC-CARRIER-SHIP-NBR    PIC X(18).   04100002
041300                         30  ASC-PACKAGE-COUNT-X.                 04110005
                                   31 ASC-PACKAGE-COUNT    PIC 9(03).   04120044
041300                         30  ASC-SHIP-MOD-SW         PIC  X(01).  04130002
041300                             88 ASC-SHIPMENT-NO-UPD  VALUE ' '.   04140002
041300                             88 ASC-SHIPMENT-UPD     VALUE 'U'.   04150002
041300                             88 ASC-SHIPMENT-DEL     VALUE 'D'.   04160002
042800                                                                  04170001
042900             15  ASC-BLK-SUB                         PIC S9(04)   04180001
043000                                                          COMP    04190001
043100                                                          SYNC.   04200001
043200             15  ASC-ITEM-SUB                        PIC S9(04)   04210001
043300                                                          COMP    04220001
043400                                                          SYNC.   04230001
043500             15  ASC-SEL-SUB                         PIC S9(04)   04240001
043600                                                         COMP.    04250001
043700             15  ASC-SEL-ITEM                        PIC S9(04)   04260001
043800                                                         COMP.    04270001
043900             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  04280001
044000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04290001
044100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04300001
044200                                                          COMP-3. 04310001
044300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04320001
044400                                                          COMP-3. 04330001
044500             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04340001
044600                                                          COMP-3. 04350001
044100             15  ASC-NUMBER-OF-SHIP-RECS             PIC S9(09)   04360001
044200                                                          COMP-3. 04370001
044500             15  ASC-NUMBER-OF-SHIP-TS-ITEMS         PIC S9(05)   04380001
044600                                                          COMP-3. 04390001
044700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04400001
044800                                                          COMP-3. 04410001
044900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04420001
045000                                                          COMP-3. 04430001
045100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04440001
045200                                                          COMP-3. 04450001
045900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04460001
046000                                                          COMP    04470001
046100                                                          SYNC.   04480001
046200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04490001
046300                                                          COMP-3. 04500001
046400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04510001
046500                                                          COMP-3. 04520001
046600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04530001
046700                 88  ASC-ITEMS-LEFT-ON-TS            VALUE 'Y'.   04540001
046800                 88  ASC-NO-ITEMS-LEFT-ON-TS         VALUE 'N'.   04550001
046900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04560001
047000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04570001
047100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04580001
047200             15  ASC-LIST-QUEUE-NAME.                             04590001
047300                 20  ASC-LIST-TERM-ID                PIC  X(04).  04600001
047400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04610001
047500                                                          COMP-3. 04620001
047600                 20  ASC-LIST-SEQ                    PIC  9(01).  04630001
048200             15  ASC-SEL-QUEUE-NAME.                              04640001
048300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04650001
048400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04660001
048500                                                          COMP-3. 04670001
048600                 20  ASC-SEL-SEQ                     PIC  9(01).  04680001
048700                                                                  04690001
048200             15  ASC-SHIP-QUEUE-NAME                 PIC  X(08).  04700001
048800             15  ASC-START-ITEM-REQUEST.                          04710001
048900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04720001
049000                                                                  04730049
049100*---------------------------------------------------------------* 04740001
049200*    ABEND PROCESSING COPYBOOK.                                 * 04750001
049300*---------------------------------------------------------------* 04760001
049400                                                                  04770001
049500     COPY DPWS013.                                                04780052
049600                                                                  04790001
065600 LINKAGE SECTION.                                                 04810001
065700                                                                  04820001
065800 01  DFHCOMMAREA.                                                 04830001
065900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04840001
066000                                        DEPENDING ON EIBCALEN.    04850001
066100         10  FILLER                     PIC X.                    04860001
066200                                                                  04870001
066300                                                                  04880049
066400 PROCEDURE DIVISION.                                              04890001
066500******************************************************************04900001
066600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04910001
066700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04920001
066800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04930001
066900******************************************************************04940001
067000 0000-MAIN-MODULE.                                                04950001
067100     INITIALIZE DP030-CICS-API-FIELDS.                            04960001
067200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04970001
067300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04980001
067400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04990001
067500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05000001
067600     MOVE LENGTH OF VL508AI        TO DP030-MAP-LENGTH (1).       05010005
067700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05020001
067800     PERFORM 0001-CALL-CICS-ARCH-API.                             05030001
067900*                                                                 05040001
068000     PERFORM 1000-CONTROL-PROCESSING                              05050001
068100*                                                                 05060001
068200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05070001
068300     PERFORM 0001-CALL-CICS-ARCH-API.                             05080001
068400                                                                  05090001
068500******************************************************************05100001
068600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05110001
068700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05120001
068800******************************************************************05130001
068900 0001-CALL-CICS-ARCH-API.                                         05140001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05150053
069100                                    DFHCOMMAREA                   05160053
069200                                    DP030-CICS-API-FIELDS         05170053
069300                                    DP020-STANDARD-COMMAREA       05180053
069400                                    VL508AI.                      05190053
069500*                                                                 05200001
069600     IF  DP030-RC-CALL-SUCCESSFUL                                 05210001
069700         CONTINUE                                                 05220001
069800     ELSE                                                         05230001
069900         SET DP013-NO-ROLLBACK                                    05240001
070000             DP013-XCTL-DISPLAY-RESTART                           05250001
070100             DP013-CICS-ABEND      TO TRUE                        05260001
070200         MOVE '0001-CALL-CICS-ARCH-API'                           05270001
070300                                   TO DP013-PARAGRAPH             05280001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05281053
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05282053
070600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05310001
070700         PERFORM DP013-0000-PROCESS-ABEND                         05320001
070800     END-IF.                                                      05330001
070800                                                                  05331049
070900*----------------------------------------------------------------*05340001
071000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05350001
071100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05360001
071200*                                                                *05370001
071300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05380001
071400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05390001
071500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05400001
071600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05410001
071700*----------------------------------------------------------------*05420001
071900 1000-CONTROL-PROCESSING.                                         05440001
072100     EVALUATE TRUE                                                05460001
072200         WHEN DP020-NEXT-ACT-INITIAL                              05470001
072300             INITIALIZE ASC-SPECIFIC-COMMAREA                     05480001
072400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05490001
072700             MOVE DP020-SRC-TASK-NUMBER                           05500001
072800                                   TO ASC-LIST-TASK-NUMBER        05510001
073100             MOVE DP020-INT-APPL-FORMAT-IND                       05520001
073200                                   TO  PC-FORMAT-INDICATOR        05530001
073300             MOVE PC-LIST-QUEUE-SEQ                               05540001
073400                                   TO ASC-LIST-SEQ                05550001
073800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05560001
073900***-----$TEMPLATE NOTE$-------------------------------------------05570001
074000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05580001
074100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05590001
074200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05600001
074300***---------------------------------------------------------------05610001
074400             IF  PS-COMMAREA-NOT-VALID                            05620001
074500                 MOVE PC-TSYMSG-99901                             05630001
074600                                   TO DP020-MSG-NUMBER            05640001
074700                 SET DP020-MSG-FATAL                              05650001
074800                                   TO TRUE                        05660001
074900                 SET DP020-NEXT-ACT-APPL-ERROR                    05670001
075000                                   TO TRUE                        05680001
075100             ELSE                                                 05690001
075200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05700001
075300             END-IF                                               05710001
075400                                                                  05720001
075500         WHEN DP020-NEXT-ACT-READ-MAP                             05730001
075600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05740001
075700                                   TO PV-TOP-ITEM                 05750001
075800             PERFORM 2000-PROCESS-PANEL                           05760001
075900                                                                  05770001
076000         WHEN DP020-NEXT-ACT-RETURN                               05780001
076100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05790001
076200                                   TO PV-TOP-ITEM                 05800001
076300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05810001
076400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05820001
076500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05830001
076700                                                                  05840001
076800         WHEN OTHER                                               05850001
076900             SET DP013-LOGIC-ABEND TO TRUE                        05860001
077000             SET DP013-NO-ROLLBACK TO TRUE                        05870001
077100             MOVE '1000-CONTROL-PROCESSING'                       05880001
077200                                   TO DP013-PARAGRAPH             05890001
077300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05900001
077400                                   TO DP013-MESSAGE-TEXT(1)       05910001
077500             PERFORM DP013-0000-PROCESS-ABEND                     05920001
077600     END-EVALUATE.                                                05930001
077700                                                                  05940001
077900*----------------------------------------------------------------*05960001
078000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05970001
078100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05980001
078200*----------------------------------------------------------------*05990001
078400 1100-PROCESS-INTER-APPL-COMM.                                    06010001
078600     SET PS-COMMAREA-VALID         TO TRUE.                       06030001
078700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06040001
078800     EVALUATE TRUE                                                06050001
080300         WHEN PC-LIST-FORMAT-IND                                  06060001
080300             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06070049
080400             MOVE VL002-NUMBER-OF-SHIP-RECS                       06080049
080300                 TO ASC-NUMBER-OF-SHIP-RECS                       06090049
080400             MOVE VL002-NUMBER-OF-SHIP-TS-ITEMS                   06100049
041900                 TO ASC-NUMBER-OF-SHIP-TS-ITEMS                   06110001
080300             MOVE VL002-SHIP-QUEUE-NAME                           06120049
080400                 TO ASC-SHIP-QUEUE-NAME                           06130049
081000         WHEN OTHER                                               06140001
081100             SET PS-COMMAREA-NOT-VALID TO TRUE                    06150001
081200     END-EVALUATE.                                                06160001
082300                                                                  06170001
090600*----------------------------------------------------------------*06190001
090700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06200001
090800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06210001
090900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06220001
091000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06230001
091100* FUNCTION KEYS CAN GET THIS FAR.                                *06240001
091200*----------------------------------------------------------------*06250001
091400 2000-PROCESS-PANEL.                                              06270001
091500     EVALUATE TRUE                                                06280001
091600         WHEN DP020-SRC-AID = DP016-CLEAR                         06290001
091700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06300001
091900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06310001
092000                                                                  06320001
092100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06330001
092200             MOVE ASC-PO-NUMBER    TO DK-PO-NUMBER                06340001
092300             MOVE ASC-PO-REQ-NBR   TO DK-PO-REQ-NBR               06350001
092400             MOVE ASC-ENT-ID       TO DK-ENT-ID                   06360001
092600             MOVE DP020-INT-APPL-FORMAT-IND                       06370001
092700                                   TO  PC-FORMAT-INDICATOR        06380001
092800             PERFORM 2050-DELETE-LIST-QUEUE                       06390001
093000             PERFORM 4000-BUILD-INITIAL-PANEL                     06400001
093100                                                                  06410001
093900                                                                  06420001
094000         WHEN OTHER                                               06430001
098200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06440001
098300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06450001
098400             IF  PS-NO-ERROR                                      06460001
098500                 SET DP030-CONTINUE-GO                            06470001
098600                                 TO TRUE                          06480001
098700                 PERFORM 2100-CHECK-FUNCTION-KEY                  06490001
098800             ELSE                                                 06500001
098900                 SET DP030-OVERRIDE-GO                            06510001
099000                                 TO TRUE                          06520001
099100             END-IF                                               06530001
095100     END-EVALUATE.                                                06540001
097900                                                                  06550049
095300*----------------------------------------------------------------*06560001
095400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06570001
095500*----------------------------------------------------------------*06580001
095600 2050-DELETE-LIST-QUEUE.                                          06590001
095800     EXEC CICS                                                    06610001
095900         DELETEQ TS                                               06620001
096000             QUEUE (ASC-LIST-QUEUE-NAME)                          06630001
096100             RESP  (PV-CICS-RESP)                                 06640001
096200     END-EXEC.                                                    06650001
096300                                                                  06660001
096400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06670001
096500        (PV-CICS-RESP = DFHRESP(QIDERR))                          06680001
096600         CONTINUE                                                 06690001
096700     ELSE                                                         06700001
096800         SET DP013-CICS-ABEND      TO TRUE                        06710001
096900         SET DP013-NO-ROLLBACK     TO TRUE                        06720001
097000                                                                  06730001
097100         MOVE '2050-DELETE-LIST-QUEUE'                            06740001
097200                                   TO DP013-PARAGRAPH             06750001
097300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06760001
097400                                   TO DP013-MESSAGE-TEXT (1)      06770001
097500         PERFORM DP013-0000-PROCESS-ABEND                         06780001
097600     END-IF.                                                      06790001
097700                                                                  06800001
097800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06810001
097900                                                                  06820049
098000*----------------------------------------------------------------*06830001
098100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06840001
098200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06850001
098300* CICS ARCHITECTURE API.                                         *06860001
098400*----------------------------------------------------------------*06870001
098500 2100-CHECK-FUNCTION-KEY.                                         06880001
098600     EVALUATE TRUE                                                06890001
105800                                                                  06900001
105900* COPY SHIP KEY WAS PRESSED                                       06910035
106000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06920035
105900* DELETE KEY WAS PRESSED                                          06930035
106000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06940035
                   CONTINUE                                             06950035
105900* INCLUDE KEY WAS PRESSED                                         06960035
106000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06970035
326900             MOVE +1               TO ASC-BLK-SUB                 06980012
327000             PERFORM 5100-WRITE-TEMP-STORAGE                      06990012
                   IF ASC-HIGHEST-BLOCK-WRITTEN > 1                     07000029
327100                 ADD +1                TO ASC-BLK-SUB             07010029
327200                 PERFORM 5100-WRITE-TEMP-STORAGE                  07020029
                   END-IF                                               07030029
                                                                        07040036
                   PERFORM 8200-DELETE-SHIP-QUEUE                       07050036
                                                                        07060012
                   INITIALIZE VL004-SHIPMENT-ARRAY                      07070021
                   MOVE +0               TO ASC-NUMBER-OF-SHIP-RECS     07080012
                                            ASC-NUMBER-OF-SHIP-TS-ITEMS 07090036
                                            PV-SHIP-ITEM                07100012
                   SET VL004-IDX         TO +1                          07110046
                                                                        07120012
                   PERFORM 2500-MOVE-TO-SHIP-QUEUE                      07130017
                       VARYING PV-ITEM                                  07140017
                       FROM 1 BY 1                                      07150017
                       UNTIL PV-ITEM                                    07160017
                       GREATER ASC-HIGHEST-BLOCK-WRITTEN                07170017
                                                                        07180017
                   PERFORM 8000-WRITE-SHIP-TS                           07190030
                                                                        07200030
                   MOVE ASC-NUMBER-OF-SHIP-RECS                         07210015
                       TO VL002-NUMBER-OF-SHIP-RECS                     07220015
                   MOVE ASC-NUMBER-OF-SHIP-TS-ITEMS                     07230030
                       TO VL002-NUMBER-OF-SHIP-TS-ITEMS                 07240030
                   MOVE ASC-SHIP-QUEUE-NAME                             07250030
                       TO VL002-SHIP-QUEUE-NAME                         07260030
                                                                        07270030
      * ENTER KEY WAS PRESSED                                           07280030
               WHEN DP020-SRC-AID = DP016-ENTER                         07290030
                   PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07300030
                   IF  PS-ERROR                                         07310030
00691                  CONTINUE                                         07320001
00692              ELSE                                                 07330001
00693                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07340001
00694              END-IF                                               07350001
00695                                                                   07360001
106700                                                                  07370001
00680          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07380001
00681              PERFORM 2110-BROWSE-BACKWARD                         07390001
00682              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07400001
00683                                                                   07410001
00684          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07420001
00685              PERFORM 2120-BROWSE-FORWARD                          07430001
00686              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07440001
00679                                                                   07450001
106800         WHEN OTHER                                               07460001
106900             SET DP013-NO-ROLLBACK                                07470001
107000                 DP013-XCTL-DISPLAY-RESTART                       07480001
107100                 DP013-CICS-ABEND  TO TRUE                        07490001
107200             MOVE '2100-CHECK-FUNCTION-KEY'                       07500001
107300                                   TO DP013-PARAGRAPH             07510001
107400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07520001
107500                                   TO DP013-MESSAGE-TEXT (1)      07530001
107600             PERFORM DP013-0000-PROCESS-ABEND                     07540001
107700     END-EVALUATE.                                                07550001
00706 *                                                                 07560001
00707 *----------------------------------------------------------------*07570001
00708 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07580001
00709 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07590001
00710 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07600001
00711 *    MESSAGE.                                                    *07610001
00712 *----------------------------------------------------------------*07620001
00714  2110-BROWSE-BACKWARD.                                            07640001
00715      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07650001
00716          GIVING PV-TOP-ITEM.                                      07660001
00717 *                                                                 07670001
00718      IF  ((PV-TOP-ITEM < +1)                                      07680001
00719        OR (PV-TOP-ITEM = +1))                                     07690001
00720          MOVE +1                   TO PV-TOP-ITEM                 07700001
00721 *        -- TOP OF LIST --                                        07710001
00722          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07720001
00723          SET DP020-MSG-INFORMATIONAL TO TRUE                      07730001
00724      END-IF.                                                      07740001
00725                                                                   07750001
00727 *----------------------------------------------------------------*07770001
00728 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07780001
00729 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07790001
00730 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07800001
00731 *----------------------------------------------------------------*07810001
00733  2120-BROWSE-FORWARD.                                             07830001
00735      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07850001
00736          GIVING PV-TOP-ITEM.                                      07860001
00737      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07870001
00738          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07880001
00739                                    TO PV-TOP-ITEM                 07890001
00740 *        -- BOTTOM OF LIST --                                     07900001
00741          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07910001
00742          SET DP020-MSG-INFORMATIONAL                              07920001
00743                                    TO TRUE                        07930001
00744      ELSE                                                         07940001
00745          COMPUTE PV-BOTTOM-ITEM =                                 07950001
00746              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07960001
00747          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07970001
00748 *            -- BOTTOM OF LIST --                                 07980001
00749              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07990001
00750              SET DP020-MSG-INFORMATIONAL                          08000001
00751                                    TO TRUE                        08010001
00752          END-IF                                                   08020001
00753      END-IF.                                                      08030001
00754                                                                   08040049
00755 *----------------------------------------------------------------*08050001
00756 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08060001
00757 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08070001
00758 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08080001
00759 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08090001
00760 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08100001
00761 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08110001
00762 *----------------------------------------------------------------*08120001
00764  2130-CHECK-FOR-JUMP-BROWSE.                                      08140001
00765      SET PS-NO-ERROR               TO TRUE.                       08150001
00766      IF (ASC-START-ITEM-REQUEST = SPACE)                          08160001
00767          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08170001
00768                                    TO PV-TOP-ITEM                 08180001
00769      ELSE                                                         08190001
00770          MOVE ASC-START-ITEM-REQUEST                              08200001
00771                                    TO DP010I-UNEDITED-FIELD       08210001
00772          MOVE +5                   TO DP010I-MAXIMUM-DIGITS       08220001
00773          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08230001
00774          SET DP010I-NEGATIVE-NOT-ALLOWED                          08240001
00775                                    TO TRUE                        08250001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08261052
263627              USING DP010I-NUMERIC-EDIT-AREA                      08262052
00777                                                                   08270001
00778          IF  NOT DP010I-ERROR-DETECTED                            08280001
00779              MOVE DP010I-NUMERIC-FIELD                            08290001
00780                                    TO  ASC-START-ITEM-REQUEST-N   08300001
00781              IF  ASC-START-ITEM-REQUEST-N > ZERO                  08310001
00782                  IF  ASC-START-ITEM-REQUEST-N >                   08320001
00783                                           ASC-NUMBER-OF-ITEMS-READ08330001
00784                      MOVE SPACE TO ASC-START-ITEM-REQUEST         08340001
00785                      COMPUTE PV-TOP-ITEM =                        08350001
00786                              ASC-NUMBER-OF-ITEMS-READ             08360001
00787                              - PC-ITEMS-PER-PANEL + 1             08370001
00788                      IF  PV-TOP-ITEM < +1                         08380001
00789                          MOVE +1   TO PV-TOP-ITEM                 08390001
00790                          MOVE PC-TSYMSG-00070                     08400001
00791                                    TO DP020-MSG-NUMBER            08410001
00792                          SET DP020-MSG-INFORMATIONAL              08420001
00793                                    TO TRUE                        08430001
00794                      END-IF                                       08440001
00795                  ELSE                                             08450001
00796                      MOVE ASC-START-ITEM-REQUEST-N                08460001
00797                                    TO PV-TOP-ITEM                 08470001
00798                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      08480001
00799                      COMPUTE PV-BOTTOM-ITEM =                     08490001
00800                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08500001
00801                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08510001
00802 *                        -- BOTTOM OF LIST --                     08520001
00803                          MOVE PC-TSYMSG-00070                     08530001
00804                                    TO DP020-MSG-NUMBER            08540001
00805                          SET DP020-MSG-INFORMATIONAL              08550001
00806                                    TO TRUE                        08560001
00807                      END-IF                                       08570001
00808                  END-IF                                           08580001
00809              ELSE                                                 08590001
00810 *                --- VALUE OUT OF RANGE ----                      08600001
00811                  MOVE PC-TSYMSG-00101                             08610001
00812                                    TO DP020-MSG-NUMBER            08620001
00813                  MOVE -1           TO ASTRTITL                    08630001
00814                  SET DP030-SET-CURSOR-APPL-1                      08640001
00815                                    TO TRUE                        08650001
00816                  MOVE DP015-REVERSE                               08660001
00817                                    TO ASTRTITH                    08670001
00818                  MOVE DP015-RED    TO ASTRTITC                    08680001
00819                  MOVE DP015-UNP-NUM-BRT-MDT                       08690001
00820                                    TO ASTRTITA                    08700001
00821                  SET DP020-MSG-FATAL                              08710001
00822                                    TO TRUE                        08720001
00823                  SET PS-ERROR      TO TRUE                        08730001
00824              END-IF                                               08740001
00825                                                                   08750001
00826          ELSE                                                     08760001
00827              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08770001
00828              MOVE -1               TO ASTRTITL                    08780001
00829              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08790001
00830              MOVE DP015-REVERSE    TO ASTRTITH                    08800001
00831              MOVE DP015-RED        TO ASTRTITC                    08810001
00832              MOVE DP015-UNP-NUM-BRT-MDT                           08820001
00833                                    TO ASTRTITA                    08830001
00834              SET DP020-MSG-FATAL   TO TRUE                        08840001
00835              SET PS-ERROR          TO TRUE                        08850001
00836          END-IF                                                   08860001
00837      END-IF.                                                      08870001
00838                                                                   08880049
157200******************************************************************08890001
157300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **08900001
157400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **08910001
157500******************************************************************08920001
157600 2200-MOVE-SCREEN-TO-COMMAREA.                                    08930001
157800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08950001
157900     MOVE +1                       TO PV-SUB.                     08960001
158000*                                                                 08970001
158100     PERFORM 3100-SET-SUBSCRIPTS.                                 08980001
160500                                                                  08990001
160600     IF  ASTRTITL > ZERO                                          09000001
160700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09010001
160800     ELSE                                                         09020001
160900         IF  ASTRTITF = DP015-ERASE-EOF                           09030001
161000             INITIALIZE ASC-START-ITEM-REQUEST                    09040001
161100         END-IF                                                   09050001
161200     END-IF.                                                      09060001
162100                                                                  09070001
162200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09080001
162300         VARYING PV-SUB                                           09090001
162400         FROM 1 BY 1                                              09100001
162500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09110001
162500                                                                  09111049
162600******************************************************************09120001
162700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09130001
162800******************************************************************09140001
162900 2210-MOVE-LINES-TO-COMMAREA.                                     09150001
164300     IF  MR-CARRIER-SHIP-NBRL (PV-SUB) > ZERO                     09160002
164400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     09170001
                                         TO TRUE                        09180001
164700         MOVE MR-CARRIER-SHIP-NBR (PV-SUB)                        09190002
164800                                   TO ASC-CARRIER-SHIP-NBR        09200002
164900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09210001
165000     ELSE                                                         09220001
165100         IF  MR-CARRIER-SHIP-NBRA (PV-SUB) = DP015-ERASE-EOF      09230002
165200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             09240001
R65300                                   TO TRUE                        09250001
164800                 MOVE SPACES       TO ASC-CARRIER-SHIP-NBR        09260024
164900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09270024
165500         END-IF                                                   09280001
165600     END-IF.                                                      09290001
165700                                                                  09300001
164300     IF  MR-PACKAGE-COUNTL (PV-SUB) > ZERO                        09310002
164400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     09320002
                                         TO TRUE                        09330002
               MOVE MR-PACKAGE-COUNT-X (PV-SUB)                         09340042
164800                                   TO ASC-PACKAGE-COUNT-X         09350041
164900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09360002
165000     ELSE                                                         09370002
165100         IF  MR-PACKAGE-COUNTA (PV-SUB) = DP015-ERASE-EOF         09380002
165200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 09390010
R65300                                   TO TRUE                        09400002
164800             MOVE SPACES           TO ASC-PACKAGE-COUNT-X         09410018
164900                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  09420010
165500         END-IF                                                   09430002
165600     END-IF.                                                      09440002
165700                                                                  09450002
170700                                                                  09460001
170800     ADD +1                        TO ASC-ITEM-SUB.               09470001
170900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09480001
171000         ADD +1                    TO ASC-BLK-SUB                 09490001
171100         MOVE +1                   TO ASC-ITEM-SUB                09500001
171200     END-IF.                                                      09510001
                                                                        09520012
431200*----------------------------------------------------------------*09530012
431300*  SCROLL THROUGH ALL THE DETAIL ITEMS AND MOVE THEM TO THE      *09540012
431400*  SHIPMENT QUEUE                                                 09550012
431500*----------------------------------------------------------------*09560012
431700 2500-MOVE-TO-SHIP-QUEUE.                                         09580012
431900     PERFORM 6112-READ-LIST-QUEUE.                                09600012
                                                                        09610016
432100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       09620012
432200         PERFORM                                                  09630012
432300         VARYING LQW-IDX                                          09640012
432400         FROM 1 BY 1                                              09650012
432500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            09660012
432600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          09670012
432700                                                                  09680012
                   IF LQW-CARRIER-SHIP-NBR (LQW-IDX) > SPACES           09690027
                       ADD  +1          TO ASC-NUMBER-OF-SHIP-RECS      09720026
                       IF VL004-IDX > VL004-MAX-ITEMS                   09740026
                           PERFORM 8000-WRITE-SHIP-TS                   09750026
                           INITIALIZE VL004-SHIPMENT-ARRAY              09760043
                           SET VL004-IDX TO +1                          09770026
                       END-IF                                           09780026
                       MOVE ASC-NUMBER-OF-SHIP-RECS                     09800032
                            TO VL004-ITEM (VL004-IDX)                   09810034
432800                 MOVE LQW-CARRIER-SHIP-NBR (LQW-IDX)              09820026
432900                      TO VL004-CARRIER-SHIP-NBR (VL004-IDX)       09830026
433000                 MOVE LQW-PACKAGE-COUNT (LQW-IDX)                 09840026
433100                      TO VL004-PACKAGE-COUNT (VL004-IDX)          09850026
                       SET VL004-IDX UP BY +1                           09860048
                   END-IF                                               09880026
434100         END-PERFORM                                              09890012
434300     END-IF.                                                      09910012
434400                                                                  09920012
171300******************************************************************09930001
171400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09940001
171500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09950001
171600******************************************************************09960001
171700 3000-EDIT-DATA-IN-COMMAREA.                                      09970001
171800     SET PS-NO-ERROR               TO TRUE.                       09990001
171900     PERFORM 3200-RESET-ATTRIBUTES.                               10000001
172000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10010001
172100**                                                                10020001
172200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10030001
172300* EDITTING IS DONE FROM THE BOTTOM UP.                            10040001
172400**                                                                10050001
172500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10060001
172600         ASC-ITEMS-DISPLAYED - 1.                                 10070001
172700     PERFORM 3100-SET-SUBSCRIPTS.                                 10080001
424019     PERFORM 3300-EDIT-SELECTIONS                                 10090012
424020         VARYING PV-SUB                                           10100012
424021         FROM PV-SUB BY -1                                        10110012
424022         UNTIL PV-SUB < +1.                                       10120012
182200                                                                  10130001
211000*----------------------------------------------------------------*10140001
211100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10150001
211200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10160001
211300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10170001
211400*                                                                *10180001
211500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10190001
211600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10200001
211700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10210001
211800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10220001
211900*----------------------------------------------------------------*10230001
212100 3100-SET-SUBSCRIPTS.                                             10250001
212300     COMPUTE ASC-ITEM-SUB =                                       10270001
212400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10280001
212500                                                                  10290001
212600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10300001
212700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10310001
212800                                                                  10320001
212900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10330001
213000     ELSE                                                         10340001
213100         MOVE +1                     TO ASC-BLK-SUB               10350001
213200     END-IF.                                                      10360001
213600                                                                  10361049
213300******************************************************************10370001
213400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10380001
213500******************************************************************10390001
213700 3200-RESET-ATTRIBUTES.                                           10410001
213800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10430002
214300     MOVE DP015-GREEN              TO ASTRTITC.                   10440002
214800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10450002
215300*                                                                 10460001
215400     PERFORM                                                      10470001
215500         VARYING PV-SUB                                           10480001
215600         FROM 1 BY 1                                              10490001
215700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10500001
215800         MOVE DP015-UNP-ALP-NOR-OFF                               10510001
215900                              TO MR-PACKAGE-COUNTA (PV-SUB)       10520002
                                       MR-CARRIER-SHIP-NBRA (PV-SUB)    10530002
216400         MOVE DP015-GREEN     TO MR-CARRIER-SHIP-NBRC (PV-SUB)    10540002
                                       MR-PACKAGE-COUNTC (PV-SUB)       10550002
216900         MOVE DP015-UNDERLINE TO MR-CARRIER-SHIP-NBRH (PV-SUB)    10560002
                                       MR-PACKAGE-COUNTH (PV-SUB)       10570002
217400     END-PERFORM.                                                 10580001
424595******************************************************************10590012
424596** EDIT THE SELECTIONS MADE (WILL EDIT THE ENTIRE LIST)           10600012
424600******************************************************************10610012
424601 3300-EDIT-SELECTIONS.                                            10620012
424656                                                                  10630012
           IF ASC-PACKAGE-COUNT (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO       10640018
           OR ASC-PACKAGE-COUNT-X (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES   10650021
               IF ASC-CARRIER-SHIP-NBR                                  10660018
                     (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES                10670018
                   MOVE +1  TO ASC-PACKAGE-COUNT                        10680018
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        10690018
               ELSE                                                     10700018
424658             MOVE SPACES TO ASC-PACKAGE-COUNT-X                   10710018
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        10720018
               END-IF                                                   10730019
424660     ELSE                                                         10740012
               IF ASC-CARRIER-SHIP-NBR                                  10750021
                     (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES                10760021
                   CONTINUE                                             10770021
               ELSE                                                     10780021
424658             MOVE SPACES TO ASC-PACKAGE-COUNT-X                   10790021
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        10800021
               END-IF                                                   10810022
424661         MOVE ASC-PACKAGE-COUNT-X (ASC-BLK-SUB ASC-ITEM-SUB)      10820041
424662                                   TO DP010I-UNEDITED-FIELD       10830012
424663         MOVE +3                   TO DP010I-MAXIMUM-DIGITS       10840044
424664         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10850012
424665         SET DP010I-NEGATIVE-NOT-ALLOWED                          10860012
424666                                   TO TRUE                        10870012
424667                                                                  10880012
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10891052
263627              USING DP010I-NUMERIC-EDIT-AREA                      10892052
424669                                                                  10900012
424670         EVALUATE TRUE                                            10910012
424671         WHEN DP010I-NO-ERROR-DETECTED                            10920012
424672             MOVE DP010I-NUMERIC-FIELD                            10930012
424673             TO  ASC-PACKAGE-COUNT   (ASC-BLK-SUB ASC-ITEM-SUB)   10940012
424689         WHEN DP010I-NEG-NOT-ALLOWED                              10950012
424690         WHEN DP010I-MAX-DIGITS-EXCEEDED                          10960012
424691              MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER          10970012
424692              SET DP020-MSG-FATAL    TO TRUE                      10980012
424693              MOVE -1                TO MR-PACKAGE-COUNTL (PV-SUB)10990013
424694              SET DP030-SET-CURSOR-APPL-1                         11000012
424695                                     TO TRUE                      11010012
424696              MOVE DP015-RED         TO MR-PACKAGE-COUNTC (PV-SUB)11020013
424697              MOVE DP015-REVERSE     TO MR-PACKAGE-COUNTH (PV-SUB)11030013
424698              SET PS-ERROR TO TRUE                                11040012
424699         WHEN OTHER                                               11050012
424700              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          11060012
424701              SET DP020-MSG-FATAL    TO TRUE                      11070012
424702              MOVE -1                TO MR-PACKAGE-COUNTL (PV-SUB)11080013
424703              SET DP030-SET-CURSOR-APPL-1                         11090012
424704                                     TO TRUE                      11100012
424705              MOVE DP015-RED         TO MR-PACKAGE-COUNTC (PV-SUB)11110013
424706              MOVE DP015-REVERSE     TO MR-PACKAGE-COUNTH (PV-SUB)11120013
424707              SET PS-ERROR TO TRUE                                11130012
424708         END-EVALUATE                                             11140012
424709     END-IF.                                                      11150012
424710                                                                  11160012
424807     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11170014
424808     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11180014
424809     IF  ASC-ITEM-SUB < 1                                         11190014
424810         SUBTRACT +1 FROM ASC-BLK-SUB                             11200014
424811         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11210014
424812     END-IF.                                                      11220014
424806                                                                  11230014
242800*----------------------------------------------------------------*11240001
242900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *11250001
243000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *11260001
243100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *11270001
243200*    DISPLAY THE PANEL TO USER.                                  *11280001
243300*----------------------------------------------------------------*11290001
243500 4000-BUILD-INITIAL-PANEL.                                        11310001
243700     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             11330001
243800                                ASC-BLOCK-ENTRIES (2).            11340001
243900     MOVE +1                 TO ASC-BLK-SUB.                      11350001
244000     SET ASC-ITEMS-LEFT-ON-TS                                     11360001
244100         PS-SHIPMENTS-LEFT   TO TRUE.                             11370001
244200                                                                  11380001
244300     MOVE +0                 TO ASC-ITEM-SUB                      11390001
244400                                ASC-NUMBER-OF-ITEMS-READ          11400001
244500                                ASC-NUMBER-OF-SELECTED-ITEMS      11410001
244600                                ASC-HIGHEST-BLOCK-WRITTEN         11420001
244700                                ASC-START-OF-SELECTED-RANGE       11430001
244800                                ASC-END-OF-SELECTED-RANGE         11440001
244900                                ASC-ITEM-AT-TOP-OF-PANEL          11450001
244900                                PV-NUMBER-OF-EXTRA-LINES.         11460001
245000                                                                  11470001
247600* LOAD ALL REQUEST SHIPMENTS INTO A QUEUE TO ALLOW DISPLAY        11480001
247800                                                                  11490001
           MOVE +1 TO PV-SHIP-ITEM.                                     11500001
248000                                                                  11510001
248100     PERFORM 4300-READ-ITEMS-FROM-TS.                             11520001
248200                                                                  11530001
248500     MOVE +1                   TO  PV-TOP-ITEM.                   11540001
248600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          11550001
248800         SET DP020-MSG-INFORMATIONAL                              11560001
                                     TO TRUE                            11570001
248900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               11580001
249000     ELSE                                                         11590001
249200         SET DP030-SET-CURSOR-APPL-1                              11600001
249300                               TO TRUE                            11610001
249500     END-IF.                                                      11620001
                                                                        11630001
249400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11640001
318400                                                                  11650049
318500*----------------------------------------------------------------*11660001
318600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *11670001
318700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *11680001
318800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *11690001
318900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *11700001
319000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *11710001
319100*                                                                *11720001
319200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *11730001
319300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *11740001
319400*    UPON INITIALIZATION.                                        *11750001
319500*----------------------------------------------------------------*11760001
319700 4300-READ-ITEMS-FROM-TS.                                         11780001
319900     PERFORM                                                      11800001
320000         VARYING PV-SHIP-ITEM                                     11810001
320100         FROM 1 BY 1                                              11820001
               UNTIL  (PS-NO-SHIPMENTS-LEFT )                           11830036
320400                                                                  11840001
               IF PV-SHIP-ITEM > ASC-NUMBER-OF-SHIP-TS-ITEMS            11850037
                   INITIALIZE VL004-SHIPMENT-ARRAY                      11860036
               ELSE                                                     11870036
320500             PERFORM 8100-READ-SHIP-QUEUE                         11880036
               END-IF                                                   11890036
320600                                                                  11900001
               SET VL004-IDX TO +1                                      11910002
                                                                        11920002
319900         PERFORM                                                  11930001
320200             UNTIL ((VL004-IDX > VL004-MAX-ITEMS)                 11940001
320300                OR  (PS-NO-SHIPMENTS-LEFT ))                      11950006
320600                                                                  11960001
320700             IF  PS-SHIPMENTS-LEFT                                11970001
320800                 IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL            11980001
320900                     ADD +1            TO ASC-ITEM-SUB            11990001
321000                 ELSE                                             12000001
321100                     ADD +1            TO ASC-BLK-SUB             12010001
321200                     MOVE +1           TO ASC-ITEM-SUB            12020001
321300                                                                  12030001
321400                     IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY     12040001
321500                         MOVE +1       TO ASC-BLK-SUB             12050001
321600                         SET ASC-BLOCK-MODIFIED (1)               12060001
321700                                       TO TRUE                    12070001
321800                         PERFORM 5100-WRITE-TEMP-STORAGE          12080001
321900                         MOVE ASC-BLOCK-ENTRIES                   12090001
322000                                   (PC-MAX-BLOCKS-IN-ARRAY)       12100001
322100                              TO ASC-BLOCK-ENTRIES                12110001
322100                                   (ASC-BLK-SUB)                  12120001
322200                         ADD +1        TO ASC-BLK-SUB             12130001
322300                         INITIALIZE ASC-BLOCK-ENTRIES             12140001
322300                                    (ASC-BLK-SUB)                 12150001
322400                         SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)  12160001
322500                                       TO TRUE                    12170001
322600                     END-IF                                       12180001
322700                 END-IF                                           12190001
322800                 ADD +1               TO ASC-NUMBER-OF-ITEMS-READ 12200002
                                                                        12210001
338900                 MOVE ASC-NUMBER-OF-ITEMS-READ                    12220001
339000                                       TO ASC-LIST-ITEM-NUMBER    12230001
323100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12240001
      * FOR EACH LINE ON THE DATABASE, MOVE IT TO THE SCREEN            12250002
320700                 IF  VL004-ITEM (VL004-IDX) > 0                   12260006
057200                    MOVE VL004-CARRIER-SHIP-NBR (VL004-IDX)       12270002
041300                             TO  ASC-CARRIER-SHIP-NBR             12280002
323100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12290001
057000                    MOVE VL004-PACKAGE-COUNT (VL004-IDX)          12300005
041500                             TO  ASC-PACKAGE-COUNT                12310002
323100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12320001
                          SET VL004-IDX     UP BY +1                    12330007
                       ELSE                                             12340001
      * AFTER ALL THE EXISTING LINES HAVE BEEN READ, ADD BLANK LINES    12350002
      * FOR THE USER TO ENTER NEW COMMENTS ON (PC-MAX-XTRA-LINES)       12360002
                          ADD +1   TO  PV-NUMBER-OF-EXTRA-LINES         12370001
                          IF PV-NUMBER-OF-EXTRA-LINES                   12380001
                                                  = PC-MAX-XTRA-LINES   12390001
                              SET PS-NO-SHIPMENTS-LEFT TO TRUE          12400001
                          END-IF                                        12410001
057000                    MOVE SPACES                                   12420001
041300                             TO  ASC-CARRIER-SHIP-NBR             12430002
323100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12440002
041500                                 ASC-PACKAGE-COUNT-X              12450005
323100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12460002
                       END-IF                                           12470001
326500             END-IF                                               12480001
326600         END-PERFORM                                              12490006
326600     END-PERFORM.                                                 12500006
326700                                                                  12510001
326800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          12520001
326900         MOVE +1               TO ASC-BLK-SUB                     12530001
327000         PERFORM 5100-WRITE-TEMP-STORAGE                          12540001
327100         ADD +1                TO ASC-BLK-SUB                     12550001
327200         PERFORM 5100-WRITE-TEMP-STORAGE                          12560001
327300                                                                  12570001
327400         MOVE 1                TO ASC-BLK-SUB                     12580001
327500                                  PV-BLOCK-NUMBER                 12590001
327600         PERFORM 4410-READ-TEMP-STORAGE                           12600001
327700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             12610001
327800             MOVE 2            TO ASC-BLK-SUB                     12620001
327900                                  PV-BLOCK-NUMBER                 12630001
328000             PERFORM 4410-READ-TEMP-STORAGE                       12640001
328100         END-IF                                                   12650001
328200     END-IF.                                                      12660001
328300                                                                  12670001
332900*----------------------------------------------------------------*12690001
333000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *12700001
333100*----------------------------------------------------------------*12710001
333300 4400-MOVE-COMMAREA-TO-SCREEN.                                    12730001
333400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             12740001
333500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12750001
333600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12760001
333700             MOVE +1    TO ASC-BLK-SUB                            12770001
333800             PERFORM 5100-WRITE-TEMP-STORAGE                      12780001
333900             ADD +1     TO ASC-BLK-SUB                            12790001
334000             PERFORM 5100-WRITE-TEMP-STORAGE                      12800001
334100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12810001
334200                 GIVING PV-BLOCK-NUMBER                           12820001
334300                 REMAINDER PV-REMAINDER                           12830001
334400             IF  PV-REMAINDER > ZERO                              12840001
334500                 ADD +1 TO PV-BLOCK-NUMBER                        12850001
334600             END-IF                                               12860001
334700             MOVE +1    TO ASC-BLK-SUB                            12870001
334800             PERFORM 4410-READ-TEMP-STORAGE                       12880001
334900             ADD +1     TO ASC-BLK-SUB                            12890001
335000                           PV-BLOCK-NUMBER                        12900001
335100             PERFORM 4410-READ-TEMP-STORAGE                       12910001
335200     END-IF.                                                      12920001
335300     MOVE +1            TO ASC-BLK-SUB.                           12930001
335400     COMPUTE ASC-ITEM-SUB =                                       12940001
335500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12950001
335600         + PC-ITEMS-PER-PANEL).                                   12960001
335700*                                                                 12970001
335800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12980001
335900         ADD +1         TO ASC-BLK-SUB                            12990001
336000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13000001
336100     END-IF.                                                      13010001
336200*                                                                 13020001
336300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           13030001
336400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                13040001
336600     PERFORM 4420-FORMAT-LIST-LINES                               13050001
336700         VARYING PV-SUB                                           13060001
336800         FROM PC-ITEMS-PER-PANEL BY -1                            13070001
336900         UNTIL PV-SUB < +1.                                       13080001
337000*                                                                 13090001
337100     COMPUTE ASC-ITEMS-DISPLAYED =                                13100001
337200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          13110001
337300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    13120001
337400                                      ASTRTITO.                   13130001
337500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    13140001
337600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    13150001
339400*                                                                 13180001
339500     IF  DP020-MSG-NUMBER-X = SPACE                               13190001
339600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13200001
339700*            --- MORE ITEMS TO DISPLAY ----                       13210001
339800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13220001
339900             SET DP020-MSG-INFORMATIONAL TO TRUE                  13230001
340000         END-IF                                                   13240001
340100     END-IF.                                                      13250001
340500                                                                  13251049
340200*----------------------------------------------------------------*13260001
340300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *13270001
340400*----------------------------------------------------------------*13280001
340600 4410-READ-TEMP-STORAGE.                                          13300001
340800     EXEC CICS                                                    13320001
340900         READQ TS                                                 13330001
341000             QUEUE (ASC-LIST-QUEUE-NAME)                          13340001
341100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13350001
341200             ITEM  (PV-BLOCK-NUMBER)                              13360001
341300             RESP  (PV-CICS-RESP)                                 13370001
341400     END-EXEC.                                                    13380001
341500                                                                  13390001
341600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       13400001
341700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     13410001
341800         CONTINUE                                                 13420001
341900     ELSE                                                         13430001
342000         SET DP013-CICS-ABEND     TO TRUE                         13440001
342100         SET DP013-NO-ROLLBACK    TO TRUE                         13450001
342200         MOVE '4410-READ-TEMP-STORAGE'                            13460001
342300                                  TO DP013-PARAGRAPH              13470001
342400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      13480001
342500                                  TO DP013-MESSAGE-TEXT(1)        13490001
342600         PERFORM DP013-0000-PROCESS-ABEND                         13500001
342700     END-IF.                                                      13510001
342800                                                                  13520001
342900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             13530001
343000*                                                                 13540001
343100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         13550001
343200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               13560001
343300     END-IF.                                                      13570001
343400                                                                  13580049
343500*----------------------------------------------------------------*13590001
343600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *13600001
343700*----------------------------------------------------------------*13610001
343900 4420-FORMAT-LIST-LINES.                                          13630001
344100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      13650001
344200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                13660001
215800         MOVE DP015-ASK-DRK-OFF                                   13670025
215900                              TO MR-PACKAGE-COUNTA (PV-SUB)       13680025
                                       MR-CARRIER-SHIP-NBRA (PV-SUB)    13690025
216900         MOVE DP015-HL-OFF    TO MR-CARRIER-SHIP-NBRH (PV-SUB)    13700025
                                       MR-PACKAGE-COUNTH (PV-SUB)       13710025
028100         MOVE SPACE           TO MR-CARRIER-SHIP-NBR (PV-SUB)     13720025
                                       MR-PACKAGE-COUNT-X (PV-SUB)      13730042
346300     ELSE                                                         13740001
348400         MOVE ASC-CARRIER-SHIP-NBR                                13770049
                    (ASC-BLK-SUB ASC-ITEM-SUB)                          13780049
348500           TO MR-CARRIER-SHIP-NBR (PV-SUB)                        13790049
348400         MOVE ASC-PACKAGE-COUNT                                   13800049
                    (ASC-BLK-SUB ASC-ITEM-SUB)                          13810049
348500           TO MR-PACKAGE-COUNT (PV-SUB)                           13820049
351400     END-IF.                                                      13840001
351500     SUBTRACT +1 FROM ASC-ITEM-SUB                                13850001
351600     IF  ASC-ITEM-SUB < + 1                                       13860001
351700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13870001
351800         MOVE +1                 TO ASC-BLK-SUB                   13880001
351900     END-IF.                                                      13890001
360700                                                                  13900049
360800*----------------------------------------------------------------*13910001
360900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *13920001
361000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *13930001
361100*----------------------------------------------------------------*13940001
361300 5100-WRITE-TEMP-STORAGE.                                         13960001
361400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     13970001
361500                                   TO PV-LIST-ITEM-NUMBER.        13980001
361600     COMPUTE PV-BLOCK-NUMBER =                                    13990001
361700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14000001
361800                                                                  14010001
361900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             14020001
362000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             14030001
362100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      14040001
362200             PERFORM 5105-REWRITE-ASC-LISTQ                       14050001
362300         END-IF                                                   14060001
362400     ELSE                                                         14070001
362500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       14080001
362600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            14090001
362700         PERFORM 5110-WRITE-ASC-LISTQ                             14100001
362800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   14110001
362900     END-IF.                                                      14120001
363000                                                                  14130001
363100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             14140001
363000                                                                  14141049
363200******************************************************************14150001
363300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **14160001
363400** SPECIFIC COMMAREA.                                           **14170001
363500******************************************************************14180001
363600 5105-REWRITE-ASC-LISTQ.                                          14190001
363700     EXEC CICS                                                    14200001
363800         WRITEQ TS                                                14210001
363900             QUEUE (ASC-LIST-QUEUE-NAME)                          14220001
364000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14230001
364100             ITEM  (PV-BLOCK-NUMBER)                              14240001
364200             REWRITE                                              14250001
364300             RESP  (PV-CICS-RESP)                                 14260001
364400     END-EXEC.                                                    14270001
364500                                                                  14280001
364600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           14290001
364700         CONTINUE                                                 14300001
364800     ELSE                                                         14310001
364900         SET DP013-CICS-ABEND            TO TRUE                  14320001
365000         SET DP013-NO-ROLLBACK           TO TRUE                  14330001
365100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       14340001
365200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     14350001
365300                                         TO DP013-MESSAGE-TEXT(1) 14360001
365400         PERFORM DP013-0000-PROCESS-ABEND                         14370001
365500     END-IF.                                                      14380001
365600                                                                  14390001
365700******************************************************************14400001
365800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **14410001
365900** SPECIFIC COMMAREA.                                           **14420001
366000******************************************************************14430001
366100 5110-WRITE-ASC-LISTQ.                                            14440001
366200     EXEC CICS                                                    14450001
366300         WRITEQ TS                                                14460001
366400             QUEUE (ASC-LIST-QUEUE-NAME)                          14470001
366500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14480001
366600             ITEM  (PV-BLOCK-NUMBER)                              14490001
366700             RESP  (PV-CICS-RESP)                                 14500001
366800     END-EXEC.                                                    14510001
366900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      14520001
367000         SET DP013-CICS-ABEND      TO TRUE                        14530001
367100         SET DP013-NO-ROLLBACK     TO TRUE                        14540001
367200         MOVE '5110-WRITE-ASC-LISTQ'                              14550001
367300                                   TO DP013-PARAGRAPH             14560001
367400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           14570001
367500                                   TO DP013-MESSAGE-TEXT(1)       14580001
367600         PERFORM DP013-0000-PROCESS-ABEND                         14590001
367700     END-IF.                                                      14600001
367800 EJECT                                                            14610001
374200******************************************************************14620001
374300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **14630001
374400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **14640001
374500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **14650001
374600** THE USER.                                                    **14660001
374700******************************************************************14670001
374800 6000-REFRESH-PANEL-FROM-TEMP.                                    14680001
374900     IF  ASC-UPDATE-TSQ                                           14690001
375000         SET ASC-NO-TSQ-UPDATE TO TRUE                            14700001
375100         MOVE ZERO                 TO PV-SAVE-ITEM                14710001
375200                                      PV-SEL-QUEUE-ITEM           14720001
375300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        14730001
375400                                   TO PV-HOLD-SELECTED-ITEMS      14740001
375500         MOVE +1                   TO PV-ITEMS-PROCESSED          14750001
376000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         14760001
376100                    ASC-BLOCK-ENTRIES (2)                         14770001
376200     END-IF.                                                      14780001
376300                                                                  14790001
412100*----------------------------------------------------------------*14800001
412200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *14810001
412200*    NOTE :  PARAGRAPH NOT CALLED FROM ANYWHERE THAT I CAN FIND  *14811051
412300*----------------------------------------------------------------*14820001
412500*6111-WRITE-LIST-QUEUE.                                           14840051
412700*VL  EXEC CICS                                                    14860051
412800*VL      WRITEQ TS                                                14870051
412900*VL          QUEUE (ASC-LIST-QUEUE-NAME)                          14880051
413000*VL          FROM  (LQW-LIST-QUEUE-WORK-AREA)                     14890051
413100*VL          ITEM  (PV-SAVE-ITEM)                                 14900051
413200*VL          REWRITE                                              14910051
413300*VL          RESP  (PV-CICS-RESP)                                 14920051
413400*VL  END-EXEC.                                                    14930051
413500*VL                                                               14940051
413600*VL  IF  PV-CICS-RESP = DFHRESP (NORMAL)                          14950051
413700*VL      CONTINUE                                                 14960051
413800*VL  ELSE                                                         14970051
413900*VL      SET DP013-CICS-ABEND  TO  TRUE                           14980051
414000*VL      SET DP013-NO-ROLLBACK TO  TRUE                           14990051
414100*VL      MOVE '6111-WRITE-LIST-QUEUE'                             15000051
414200*VL                            TO  DP013-PARAGRAPH                15010051
414300*VL      MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  15020051
414400*VL                            TO  DP013-MESSAGE-TEXT(1)          15030051
414500*VL      PERFORM DP013-0000-PROCESS-ABEND                         15040051
414600*VL  END-IF.                                                      15050051
414700*VL                                                               15060051
391200*----------------------------------------------------------------*15090001
391300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*15100001
391400*----------------------------------------------------------------*15110001
391600 6112-READ-LIST-QUEUE.                                            15130001
391800     EXEC CICS                                                    15150001
391900         READQ TS                                                 15160001
392000             QUEUE (ASC-LIST-QUEUE-NAME)                          15170001
392100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     15180001
392200             ITEM  (PV-ITEM)                                      15190001
392300             RESP  (PV-CICS-RESP)                                 15200001
392400     END-EXEC.                                                    15210001
392500*                                                                 15220001
392600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          15230001
392700         CONTINUE                                                 15240001
392800     ELSE                                                         15250001
392900         SET DP013-CICS-ABEND        TO TRUE                      15260001
393000         SET DP013-NO-ROLLBACK       TO TRUE                      15270001
393100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           15280001
393200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    15290001
393300                                     TO DP013-MESSAGE-TEXT(1)     15300001
393400         PERFORM DP013-0000-PROCESS-ABEND                         15310001
393500     END-IF.                                                      15320001
393600                                                                  15330001
363300*----------------------------------------------------------------*15350001
363400*    WRITE A NEW RECORD TO THE SHIPMENT TEMP STORAGE QUEUE.      *15360001
363600*----------------------------------------------------------------*15370001
363800 8000-WRITE-SHIP-TS.                                              15380001
           ADD +1 TO PV-SHIP-ITEM                                       15400012
                                                                        15410012
           MOVE PV-SHIP-ITEM TO ASC-NUMBER-OF-SHIP-TS-ITEMS             15420036
                                                                        15430036
368700     EXEC CICS                                                    15440036
368800         WRITEQ TS                                                15450036
368900             QUEUE (ASC-SHIP-QUEUE-NAME)                          15460036
369000             FROM  (VL004-SHIPMENT-REC)                           15470036
369100             ITEM  (PV-SHIP-ITEM)                                 15480036
369200             RESP  (PV-CICS-RESP)                                 15490036
369300     END-EXEC.                                                    15500036
                                                                        15510012
369400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      15520001
369500         SET DP013-CICS-ABEND      TO TRUE                        15530001
369600         SET DP013-NO-ROLLBACK     TO TRUE                        15540001
369700         MOVE '8000-WRITE-SHIP-TS'                                15550001
369800                                   TO DP013-PARAGRAPH             15560001
369900         MOVE 'ATTEMPTING TO WRITE SHIP TEMP STORAGE'             15570001
370000                                   TO DP013-MESSAGE-TEXT(1)       15580001
370100         PERFORM DP013-0000-PROCESS-ABEND                         15590001
370200     END-IF.                                                      15600001
                                                                        15610001
422949*----------------------------------------------------------------*15620001
422950*    READ A RECORD FROM THE SHIPMENT TS QUEUE                   * 15630001
422951*----------------------------------------------------------------*15640001
422953 8100-READ-SHIP-QUEUE.                                            15660036
422955     EXEC CICS                                                    15680001
422956         READQ TS                                                 15690001
422957             QUEUE (ASC-SHIP-QUEUE-NAME)                          15700001
366500             INTO  (VL004-SHIPMENT-REC)                           15710001
422959             ITEM  (PV-SHIP-ITEM)                                 15720001
422960             RESP  (PV-CICS-RESP)                                 15730001
422961     END-EXEC.                                                    15740001
422962*                                                                 15750001
422963     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          15760001
422964         CONTINUE                                                 15770001
           ELSE                                                         15780002
422963         IF  PV-CICS-RESP = DFHRESP (ITEMERR)                     15790002
422963         OR  PV-CICS-RESP = DFHRESP (QIDERR)                      15800005
332400             SET ASC-NO-ITEMS-LEFT-ON-TS                          15810002
332500                                   TO TRUE                        15820002
422965         ELSE                                                     15830002
422966             SET DP013-CICS-ABEND        TO TRUE                  15840002
422967             SET DP013-NO-ROLLBACK       TO TRUE                  15850002
422968             MOVE '8100-READ-SHIP-QUEUE' TO DP013-PARAGRAPH       15860036
422969             MOVE 'ATTEMPTING TO READQ SHIP QUEUE'                15870002
422970                                         TO DP013-MESSAGE-TEXT(1) 15880002
422971             PERFORM DP013-0000-PROCESS-ABEND                     15890002
422972         END-IF                                                   15900002
422972     END-IF.                                                      15910002
422973                                                                  15920001
422949*----------------------------------------------------------------*15930036
422950*    DELETE THE SHIPMENT QUEUE - WILL BE RECREATED WITH LIST     *15940036
422951*----------------------------------------------------------------*15950049
422953 8200-DELETE-SHIP-QUEUE.                                          15970036
422955     EXEC CICS                                                    15990036
423180         DELETEQ TS                                               16000036
423181             QUEUE (ASC-SHIP-QUEUE-NAME)                          16010036
423182             RESP  (PV-CICS-RESP)                                 16020036
423183     END-EXEC.                                                    16030036
423184                                                                  16040036
423185     IF (PV-CICS-RESP = DFHRESP(NORMAL)  OR                       16050037
423186         PV-CICS-RESP = DFHRESP(QIDERR))                          16060037
               CONTINUE                                                 16070038
           ELSE                                                         16080036
422966             SET DP013-CICS-ABEND        TO TRUE                  16090036
422967             SET DP013-NO-ROLLBACK       TO TRUE                  16100036
422968             MOVE '8200-DELETE-SHIP-QUEUE' TO DP013-PARAGRAPH     16110036
422969             MOVE 'ATTEMPTING TO DELETE SHIP QUEUE'               16120036
422970                                         TO DP013-MESSAGE-TEXT(1) 16130036
422971             PERFORM DP013-0000-PROCESS-ABEND                     16140036
422972     END-IF.                                                      16150036
422973                                                                  16160036
461400*----------------------------------------------------------------*16660001
461500*    ABEND PROCESSOR MODULE                                      *16670001
461600*----------------------------------------------------------------*16680001
461700                                                                  16690001
461800     COPY DPPD013.                                                16700052
