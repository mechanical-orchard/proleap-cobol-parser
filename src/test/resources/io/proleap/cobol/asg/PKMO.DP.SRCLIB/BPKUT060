       ID DIVISION.                                                     00010000
       PROGRAM-ID.      BPKUT060.                                       00020000
       AUTHOR.          MIKE WEHRLEY.                                   00030000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
       DATE-WRITTEN     08/10/2012.                                     00050004
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      *  BPKUT060 - RETRIEVE APPROVED SEASON'S BEGIN DATE FOR FDE       00090000
      *             PROCESSING.                                         00100000
      *                                                                 00120000
      *  THIS PROGRAM READS THE DATE ATTRIBUTE TABLE, USING A SPECIFIC  00130008
      *  SEASON AND YEAR, RETRIEVES THE SEASON BEGIN DATE AND WRITES    00131008
      *  IT TO THE OUTPUT FILE.                                         00140008
      ******************************************************************00350000
      *    CHANGED: MM/DD/YY    BY:                 WR#=                00360000
      *                                                                 00450000
      ******************************************************************00460000
                                                                        00530000
       ENVIRONMENT DIVISION.                                            00540000
                                                                        00550000
       CONFIGURATION SECTION.                                           00560000
                                                                        00570000
       SOURCE-COMPUTER.        IBM-3090.                                00580000
       OBJECT-COMPUTER.        IBM-3090.                                00590000
                                                                        00600000
       INPUT-OUTPUT SECTION.                                            00610000
                                                                        00620000
       FILE-CONTROL.                                                    00630000
                                                                        00640000
           SELECT  SEASON-YEAR-FILE                                     00650001
               ASSIGN TO INP01.                                         00660000
                                                                        00670000
           SELECT DATE-ATTRIBUTE-FILE                                   00680001
               ASSIGN TO OUT01.                                         00690000
                                                                        00700000
       DATA DIVISION.                                                   00770000
                                                                        00780000
       FILE SECTION.                                                    00790000
                                                                        00800000
       FD  SEASON-YEAR-FILE                                             00810001
           RECORDING MODE F                                             00820000
           LABEL RECORDS ARE STANDARD                                   00830000
           BLOCK CONTAINS  0 RECORDS                                    00840000
           DATA RECORD IS SEASON-YEAR-REC.                              00860001
                                                                        00870000
       01  SEASON-YEAR-REC             PIC X(5).                        00880004
                                                                        00890000
       FD  DATE-ATTRIBUTE-FILE                                          00900001
           RECORDING MODE IS F                                          00910000
           LABEL RECORDS ARE STANDARD                                   00920000
           BLOCK CONTAINS 0 RECORDS                                     00930002
           DATA RECORD IS DATE-ATTRIBUTE-REC.                           00932002
                                                                        00940000
       01  DATE-ATTRIBUTE-REC          PIC X(600).                      00950009
                                                                        00960001
                                                                        01120000
       WORKING-STORAGE SECTION.                                         01130000
                                                                        01140000
       01  WS-SEASON-YEAR-REC.                                          01141001
           05  WS-SEASON               PIC X(01).                       01141101
           05  WS-YEAR                 PIC X(04).                       01141201
                                                                        01141401
       01  WS-SEASON-NAME              PIC X(06).                       01141502
                                                                        01141602
       01  WS-SEA-BEG-DTE.                                              01141701
           05  WS-SEA-BEG-YEAR         PIC X(04).                       01142001
           05  FILLER                  PIC X(01).                       01143001
           05  WS-SEA-BEG-MONTH        PIC X(02).                       01144001
           05  FILLER                  PIC X(01).                       01145001
           05  WS-SEA-BEG-DAY          PIC X(02).                       01146001
                                                                        01147004
       01  PS-PROGRAM-SWITCHES.                                         01410000
           05  PS-SEASON-YEAR-SW            PIC X     VALUE 'N'.        01420001
               88  PS-SEASON-YEAR-EOF                 VALUE 'Y'.        01430001
                                                                        01440000
           05  PS-DATE-FOUND-SW             PIC X     VALUE 'N'.        01450000
               88  PS-DATE-FOUND                      VALUE 'Y'.        01460000
               88  PS-DATE-NOT-FOUND                  VALUE 'N'.        01470000
                                                                        01480000
       01  PV-PROGRAM-VARIABLES.                                        01600000
                                                                        01641004
           05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACE.      01650000
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)      VALUE SPACE.      01660000
           05  PV-PGM-NAME             PIC X(08)      VALUE 'BPKUT060'. 01670000
           05  PV-ABEND-CODE           PIC S9(04)     COMP SYNC         01680000
                                                      VALUE ZERO.       01690000
                                                                        01691004
           05  WS-SEASON-YEAR-CNT      PIC S9(09) COMP-3 VALUE +0.      01800001
                                                                        01960000
       01 BP045-EXTENDED-REC           PIC X(600)     VALUE SPACES.     01970009
                                                                        01980009
      *************************************************************     02020001
      * COPYBOOK FOR THE MERCHANISE PLANNING CONTROL CARD         *     02030000
      *************************************************************     02040000
           COPY BPRD045.                                                02050001
                                                                        02260000
      *************************************************************     02270000
      *  DATE ATTRIBUTE TABLE                                     *     02280000
      *************************************************************     02290000
           EXEC SQL                                                     02300000
               INCLUDE TDTATTR                                          02310000
           END-EXEC.                                                    02320000
                                                                        02330000
      *************************************************************     02340000
      * DB2 ERROR MESSAGE AREA                                    *     02350000
      *************************************************************     02360000
           COPY DPWS004.                                                02370000
                                                                        02380000
      *************************************************************     02390000
      * DB2 COMMUNICATION AREA                                    *     02400000
      *************************************************************     02410000
           EXEC SQL                                                     02420000
               INCLUDE SQLCA                                            02430000
           END-EXEC.                                                    02440000
                                                                        02640000
       EJECT                                                            02650000
                                                                        02660000
       PROCEDURE DIVISION.                                              02670000
                                                                        02680000
       0000-MAINLINE.                                                   02690004
                                                                        02700000
           PERFORM 1000-INITIALIZATION.                                 02710004
                                                                        02720000
           PERFORM 2000-PROCESS-DATA.                                   02730002
                                                                        02750000
           PERFORM 9000-EOJ.                                            02760000
                                                                        02810000
           GOBACK.                                                      02820000
                                                                        02830000
      ******************************************************************02840000
      *  OPEN FILES.                                                    02850004
      ******************************************************************02880000
       1000-INITIALIZATION.                                             02890004
                                                                        02900000
           DISPLAY SPACES.                                              03830000
                                                                        03840000
           OPEN INPUT  SEASON-YEAR-FILE                                 03860001
                OUTPUT DATE-ATTRIBUTE-FILE.                             03870001
                                                                        03910000
       2000-PROCESS-DATA.                                               04050000
                                                                        04050101
           PERFORM 2100-READ-SEASON-YEAR-FILE.                          04050204
           IF PS-SEASON-YEAR-EOF                                        04050302
               DISPLAY '** ABEND **'                                    04050402
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  04050502
               DISPLAY '** PARAGRAPH 1000-INITIALIZATION'               04050604
               DISPLAY '** THE INPUT DEPARTMENT PLAN FILE WAS EMPTY.'   04050702
               MOVE +4008 TO PV-ABEND-CODE                              04050802
               PERFORM 9999-ABEND                                       04050902
           END-IF.                                                      04051002
                                                                        04051102
           IF WS-SEASON = "S"                                           04051202
               MOVE "SPRING" TO WS-SEASON-NAME                          04051302
           ELSE                                                         04051402
               MOVE "FALL" TO WS-SEASON-NAME                            04051502
           END-IF.                                                      04051602
                                                                        04051702
           PERFORM  2200-GET-DATE-ATTRIBUTES.                           04051804
           IF PS-DATE-NOT-FOUND                                         04052001
               DISPLAY '** ABEND **'                                    04053001
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  04054001
               DISPLAY '** PARAGRAPH 2000-PROCESS-DATA **'              04055007
               DISPLAY '** SEASON START DATE NOT FOUND ON TDTATTR.'     04056007
               DISPLAY '** WS-YEAR: ' WS-YEAR                           04057106
               DISPLAY '** WS-SEASON-NAME: ' WS-SEASON-NAME             04057206
               MOVE +4003 TO PV-ABEND-CODE                              04059001
               PERFORM 9999-ABEND                                       04059101
           END-IF.                                                      04059201
                                                                        04059301
           MOVE DTATTR-SEA-BEG-DTE TO WS-SEA-BEG-DTE.                   04059401
           MOVE SPACES             TO BP045-REC.                        04059501
           MOVE WS-SEA-BEG-YEAR    TO BP045-SEASON-START-YEAR.          04059701
           MOVE WS-SEA-BEG-MONTH   TO BP045-SEASON-START-MONTH.         04059801
           MOVE WS-SEA-BEG-DAY     TO BP045-SEASON-START-DAY.           04059901
           SET BP045-TY-RUN-MODE   TO TRUE.                             04060001
                                                                        04060101
           MOVE BP045-REC TO BP045-EXTENDED-REC.                        04060209
           WRITE DATE-ATTRIBUTE-REC FROM BP045-EXTENDED-REC.            04060309
                                                                        06140000
       2100-READ-SEASON-YEAR-FILE.                                      06150004
                                                                        06160000
           READ SEASON-YEAR-FILE                                        06170001
               INTO WS-SEASON-YEAR-REC                                  06180001
                   AT END SET PS-SEASON-YEAR-EOF TO TRUE.               06190001
                                                                        06200000
           IF NOT PS-SEASON-YEAR-EOF                                    06210001
             ADD +1 TO WS-SEASON-YEAR-CNT                               06220001
           END-IF.                                                      06230000
                                                                        06240000
                                                                        06500000
       2200-GET-DATE-ATTRIBUTES.                                        06510004
                                                                        06520000
           EXEC SQL                                                     06530000
                SELECT DISTINCT SEA_BEG_DTE                             06540001
                  INTO :DTATTR-SEA-BEG-DTE                              06570001
                  FROM TDTATTR                                          06590001
                 WHERE FSCL_YR_NBR = :WS-YEAR                           06610002
                   AND SEA_DESC = :WS-SEASON-NAME                       06611002
           END-EXEC.                                                    06620000
                                                                        06630000
           EVALUATE TRUE                                                06640000
               WHEN SQLCODE = ZERO                                      06650000
                   SET PS-DATE-FOUND     TO TRUE                        06660000
               WHEN SQLCODE = +100                                      06670000
                   SET PS-DATE-NOT-FOUND TO TRUE                        06680000
               WHEN OTHER                                               06690000
                   DISPLAY '** WS-YEAR: ' WS-YEAR                       06700004
                   DISPLAY '** WS-SEASON-NAME: ' WS-SEASON-NAME         06701004
                   MOVE    '2200-GET-DATE-ATTRIBUTES'                   06710004
                                                TO PV-PARAGRAPH-NAME    06720000
                   MOVE    'SELECT ROW FROM TDTATTR'                    06730000
                                                TO PV-DB2-OPER-ATTEMPTED06740000
                   PERFORM 9998-SQL-ABEND                               06750000
           END-EVALUATE.                                                06760000
                                                                        06770000
      ******************************************************************07390000
      *  CLOSE FILES AND DISPLAY INPUT/OUTPUT RECORD COUNTS             07400000
      ******************************************************************07410000
       9000-EOJ.                                                        07420000
                                                                        07510000
           CLOSE SEASON-YEAR-FILE                                       07520001
                 DATE-ATTRIBUTE-FILE.                                   07530001
                                                                        07560000
           DISPLAY "**************************************".            07561005
           DISPLAY 'SEASON/YEAR INPUT RECS READ = '  WS-SEASON-YEAR-CNT.07570004
           DISPLAY "**************************************".            07580005
                                                                        07610000
       9998-SQL-ABEND.                                                  07620000
                                                                        07630000
           MOVE +4013 TO PV-ABEND-CODE.                                 07640000
           DISPLAY ' '.                                                 07650000
           DISPLAY '** ABEND **         ** = SQLERROR'.                 07660000
           DISPLAY '** PROGRAM          ** = ' PV-PGM-NAME.             07670000
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       07680000
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   07690000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07700000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07710000
           COPY DPPD004.                                                07720000
           PERFORM 9999-ABEND.                                          07730000
                                                                        07740000
                                                                        07750000
       9999-ABEND.                                                      07760000
                                                                        07770000
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        07780000
