000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.         ARKUT066.                                    00020001
000300 AUTHOR.             COGNIZANT.                                   00030001
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040001
000500 DATE-WRITTEN.       AUGUST  2015.                                00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800******************************************************************00080001
000810* PURPOSE:                                                       *00081047
000820* THIS PROGRAM DETOKENIZES THE SSN NUMBER FIELD AR056-SS-NBR     *00082052
000830* IN THE EMPLOYEE EXTRACT FILE.                                  *00083047
000840*                                                                *00084047
000850* PROTEGRITY MODULE WILL BE INVOKED TO DETOKENIZE THE SSN NUMBER *00085047
000860*                                                                *00086047
000870* INPUT FILES:   EMP-SSN-FILE              DDNAME = INP01        *00087047
000880*                                                                *00088047
000890* OUTPUT FILES:  EMP-SSN-FILE-DETOKEN      DDNAME = OUT01        *00089047
000900*                                                                *00090047
001000******************************************************************00100047
001100*----------------------------------------------------------------*00110047
001200*                                                                *00120047
001300* DATE:        08/07/2015                                        *00130047
001400* WR/IR#:      CHG0125054                                        *00140051
001500* PROGRAMMER:  COGNIZANT                                         *00150047
001600* DESCRIPTION: INITIAL VERSION CREATED FOR COSA DATA SECURITY    *00160047
001700*              PROJECT                                           *00170047
001100*----------------------------------------------------------------*00171052
001200*                                                                *00172052
001300* DATE:        04/25/2017                                        *00173052
001400* WR/IR#:      CHG0168613                                        *00174056
001500* PROGRAMMER:  CHERI PARMLEY                                     *00175052
001600* DESCRIPTION: SOMEHOW ARRD053 WAS CHANGED TO BE A LARGER COPY   *00176052
001700*              BOOK - NOT COMPATIBLE WITH THIS PROGRAM. CREATED  *00177052
001800*              NEW ARRD056 FOR CORRECT LAYOUT.                   *00180052
001900*----------------------------------------------------------------*00190047
002000***************************************************************** 00200047
002100 ENVIRONMENT DIVISION.                                            00210047
002200***************************************************************** 00220047
002300                                                                  00230047
002400 CONFIGURATION SECTION.                                           00240047
002500                                                                  00250047
002600 SOURCE-COMPUTER.        IBM-3090.                                00260047
002700 OBJECT-COMPUTER.        IBM-3090.                                00270047
002800                                                                  00280047
002900 INPUT-OUTPUT SECTION.                                            00290047
003000                                                                  00300047
003100 FILE-CONTROL.                                                    00310047
003200                                                                  00320047
003300     SELECT EMP-SSN-FILE                                          00330047
003400         ASSIGN TO INP01.                                         00340047
003500                                                                  00350047
003600     SELECT SORT-WORK-FILE                                        00360047
003700         ASSIGN TO SORTWK01                                       00370047
003800                   SORTWK02                                       00380047
003900                   SORTWK03                                       00390047
004000                   SORTWK04                                       00400047
004100                   SORTWK05                                       00410047
004200                   SORTWK06.                                      00420047
004300                                                                  00430047
004400     SELECT EMP-SSN-FILE-DETOKEN                                  00440047
004500         ASSIGN TO OUT01.                                         00450047
004600                                                                  00460047
004700******************************************************************00470047
004800 DATA DIVISION.                                                   00480047
004900******************************************************************00490047
005000                                                                  00500047
005100 FILE SECTION.                                                    00510047
005200                                                                  00520047
005300 FD  EMP-SSN-FILE                                                 00530047
005400     RECORDING MODE IS F                                          00540047
005500     BLOCK CONTAINS 0 RECORDS                                     00550047
005600     LABEL RECORDS ARE STANDARD.                                  00560047
005700                                                                  00570047
005800 01  EMP-SSN-FILE-REC                PIC  X(10).                  00580047
005900                                                                  00590047
006000 SD  SORT-WORK-FILE                                               00600047
006100     RECORD CONTAINS 10 CHARACTERS                                00610047
006200     DATA RECORD IS SORT-WORK-RECORD.                             00620047
006300                                                                  00630047
006400 01  SORT-WORK-RECORD.                                            00640047
006500      05  SR-SS-NBR                  PIC  X(9).                   00650047
006600      05  SR-DISC-STAT-CDE           PIC  X(1).                   00660047
006700                                                                  00670047
006800 FD  EMP-SSN-FILE-DETOKEN                                         00680047
006900     RECORDING MODE IS F                                          00690047
007000     BLOCK CONTAINS 0 RECORDS                                     00700047
007100     LABEL RECORDS ARE STANDARD.                                  00710047
007200                                                                  00720047
007300 01  EMP-SSN-FILE-DETOKEN-REC        PIC  X(10).                  00730047
007400                                                                  00740047
007500******************************************************************00750047
007600 WORKING-STORAGE SECTION.                                         00760047
007700******************************************************************00770047
007800                                                                  00780047
007900 01  FILLER                          PIC  X(50)  VALUE            00790047
008000     ' *** WORKING STORAGE STARTS HERE FOR ARKUT066 *** '.        00800047
008100                                                                  00810047
008200 01  PS-PROGRAM-SWITCHES.                                         00820047
008300     05  PS-END-OF-FILE-SW           PIC  X(01)  VALUE 'N'.       00830047
008400         88  PS-NOT-END-OF-FILE                  VALUE 'N'.       00840047
008500         88  PS-END-OF-FILE                      VALUE 'Y'.       00850047
008600     05 PS-END-OF-SORTW-FILE-SW      PIC  X(1)   VALUE 'N'.       00860047
008700         88  PS-END-OF-SORTW-FILE                VALUE 'Y'.       00870047
008800                                                                  00880047
008900 01  PC-CONSTANTS.                                                00890047
009000     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE            00900047
009100                                                 'ARKUT066'.      00910047
009200 01  PV-PROGRAM-VARIABLES.                                        00920047
009300     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACE.     00930047
009400     05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACE.     00940047
009500     05  PV-OPERATION-MSG-2          PIC  X(40)  VALUE SPACE.     00950047
009600     05  PV-SORT-RETURN              PIC  9(02)  VALUE ZEROES.    00960047
009700     05  PV-RECORDS-INTO-SORT        PIC  9(09)  VALUE ZEROES.    00970047
009800     05  PV-RECORDS-OUT-OF-SORT      PIC  9(09)  VALUE ZEROES.    00980047
009900     05  PV-SS-NBR-LEN               PIC  9(09)  VALUE ZEROES.    00990047
010000                                                                  01000047
010100 01  ABEND-CODE                      PIC  S9(4)  VALUE ZEROS      01010047
010200                                                 COMP SYNC.       01020047
010300     88  ABEND-4012-INTERNAL-SORT-ERROR          VALUE +4012.     01030047
010400                                                                  01040047
010500******************************************************************01050047
010600*  LAYOUT OF INPUT AND OUTPUT FILE                                01060047
010700******************************************************************01070047
010800     COPY ARRD056.                                                01080052
010900                                                                  01090047
011000******************************************************************01100047
011100* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY  01110047
011200* MODULE                                                          01120047
011300******************************************************************01130047
011400     COPY PTYCCSIP.                                               01140047
011500                                                                  01150047
011600******************************************************************01160047
011700* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY  01170047
011800* MODULE                                                          01180047
011900******************************************************************01190047
012000     COPY DPWS031.                                                01200047
012100                                                                  01210047
012200 PROCEDURE DIVISION.                                              01220047
012300                                                                  01230047
012400 0000-MAINLINE-PARA.                                              01240047
012500                                                                  01250047
012600     PERFORM 1000-INITIALIZE.                                     01260047
012700     PERFORM 2000-PROCESS-PARA.                                   01270047
012800                                                                  01280047
012900     PERFORM 9000-EOJ-ROUTINE.                                    01290047
013000     STOP RUN.                                                    01300047
013100                                                                  01310047
013200******************************************************************01320047
013300* 1000-INITIALIZE                                                 01330047
013400*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   01340047
013500******************************************************************01350047
013600 1000-INITIALIZE.                                                 01360047
013700                                                                  01370047
013800     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        01380047
013900     INITIALIZE PV-PROGRAM-VARIABLES.                             01390047
014000     MOVE PC-PROGRAM-NAME              TO DP031-PROGRAM-NAME.     01400047
014100                                                                  01410047
014200     OPEN INPUT  EMP-SSN-FILE                                     01420047
014300          OUTPUT EMP-SSN-FILE-DETOKEN.                            01430047
014400                                                                  01440047
014500******************************************************************01450047
014600* 2000-PROCESS-PARA                                               01460047
014700*     THIS PARA PROCESS THE INTERNAL SORT                         01470047
014800******************************************************************01480047
014900 2000-PROCESS-PARA.                                               01490047
015000                                                                  01500047
015100     SORT SORT-WORK-FILE                                          01510047
015200        ON ASCENDING KEY SR-SS-NBR                                01520047
015300        INPUT PROCEDURE IS 2200-RELEASE-RECORDS-TO-SORT           01530047
015400        OUTPUT PROCEDURE IS 2300-RETURN-SORT-WORK-FILE.           01540047
015500                                                                  01550047
015600     MOVE SORT-RETURN                 TO PV-SORT-RETURN.          01560047
015700     IF PV-SORT-RETURN NOT = ZERO                                 01570047
015800        MOVE '2000-PROCESS-PARA'      TO PV-PARAGRAPH-NAME        01580047
015900        MOVE 'INTERNAL SORT ERROR'    TO PV-OPERATION-MSG-1       01590047
016000        MOVE PV-SORT-RETURN           TO PV-OPERATION-MSG-2       01600047
016100        SET ABEND-4012-INTERNAL-SORT-ERROR                        01610047
016200                                       TO TRUE                    01620047
016300        PERFORM 9999-ABEND                                        01630047
016400     END-IF.                                                      01640047
016500                                                                  01650047
016600******************************************************************01660047
016700* 2200-RELEASE-RECORDS-TO-SORT SECTION                            01670047
016800*     CONTROLS THE PROCESSING FOR RELEASING THE RECORDS INTO THE  01680047
016900* SORT.                                                           01690047
017000******************************************************************01700047
017100 2200-RELEASE-RECORDS-TO-SORT SECTION.                            01710047
017200                                                                  01720047
017300     PERFORM 3000-READ-INPUT-FILE                                 01730047
017400        UNTIL PS-END-OF-FILE.                                     01740047
017500                                                                  01750047
017600 2200-EXIT SECTION.                                               01760047
017700                                                                  01770047
017800******************************************************************01780047
017900* 2300-RETURN-SORT-WORK-FILE                                      01790047
018000*     CONTROLS THE PROCESSING FOR RETURNING THE RECORDS FROM THE  01800047
018100* SORT.                                                           01810047
018200******************************************************************01820047
018300 2300-RETURN-SORT-WORK-FILE SECTION.                              01830047
018400                                                                  01840047
018500     RETURN SORT-WORK-FILE AT END                                 01850047
018600        SET PS-END-OF-SORTW-FILE       TO TRUE                    01860047
018700     END-RETURN.                                                  01870047
018800                                                                  01880047
018900     PERFORM UNTIL PS-END-OF-SORTW-FILE                           01890047
019000        INITIALIZE AR056-EMPLOYEE-ACCOUNT-REC                     01900052
019100        MOVE SORT-WORK-RECORD          TO                         01910047
019200                                     AR056-EMPLOYEE-ACCOUNT-REC   01920053
019300        PERFORM 3300-WRITE-OUTPUT-FILE                            01930047
019400        RETURN SORT-WORK-FILE AT END                              01940047
019500           SET PS-END-OF-SORTW-FILE    TO TRUE                    01950047
019600        END-RETURN                                                01960047
019700        ADD +1                         TO PV-RECORDS-OUT-OF-SORT  01970047
019800     END-PERFORM.                                                 01980047
019900                                                                  01990047
020000 2300-EXIT SECTION.                                               02000047
020100                                                                  02010047
020200******************************************************************02020047
020300* 3000-READ-INPUT-FILE                                            02030047
020400*      READ THE RECORDS AND DETOKENIZE SSN NUMBER                 02040047
020500******************************************************************02050047
020600 3000-READ-INPUT-FILE.                                            02060047
020700                                                                  02070047
020800     READ EMP-SSN-FILE                                            02080047
020900        INTO AR056-EMPLOYEE-ACCOUNT-REC                           02090052
021000        AT END                                                    02100047
021100           SET PS-END-OF-FILE          TO TRUE                    02110047
021200        NOT AT END                                                02120047
021300           ADD +1                      TO PV-RECORDS-INTO-SORT    02130047
021400           PERFORM 3100-PROCESS-SSN                               02140047
021500           MOVE AR056-DISC-STAT-CDE    TO SR-DISC-STAT-CDE        02150052
021600           RELEASE SORT-WORK-RECORD                               02160047
021700     END-READ.                                                    02170047
021800                                                                  02180047
021900******************************************************************02190047
022000* 3100-PROCESS-SSN                                                02200047
022100*      COMPUTES THE LENGTH OF AR056-SS-NBR AND VALIDATES FOR      02210052
022200*      SPACE AND LENGTH LESS THAN 9                               02220048
022300******************************************************************02230047
022400 3100-PROCESS-SSN.                                                02240047
022500                                                                  02250047
022600     INITIALIZE PV-SS-NBR-LEN.                                    02260047
022700     INSPECT FUNCTION REVERSE(AR056-SS-NBR)                       02270052
022800         TALLYING PV-SS-NBR-LEN FOR LEADING SPACES.               02280047
022900     COMPUTE PV-SS-NBR-LEN  = LENGTH OF AR056-SS-NBR -            02290052
023000                                        PV-SS-NBR-LEN.            02300047
023100     IF PV-SS-NBR-LEN = 9                                         02310049
023200        PERFORM 3200-DETOKENIZE-SSN                               02320049
023300     ELSE                                                         02330049
023400        MOVE AR056-SS-NBR              TO SR-SS-NBR               02340052
023500     END-IF.                                                      02350047
023600                                                                  02360047
023700******************************************************************02370047
023800* 3200-DETOKENIZE-SSN                                             02380047
023900*      DETOKENIZE SSN NUMBER FIELD                                02390047
024000******************************************************************02400047
024100 3200-DETOKENIZE-SSN.                                             02410047
024200                                                                  02420047
024300     INITIALIZE CSI-PARAMETERS                                    02430047
024400                DP031-PROTEG-PGM-PARAMETERS.                      02440047
024500     SET CSI-DECRYPT-FUNCTION          TO TRUE.                   02450047
024600     SET DP031-SSN                     TO TRUE.                   02460047
024700     MOVE 'SSN#'                       TO DP031-FIELD.            02470047
024800     MOVE AR056-SS-NBR                 TO DP031-CIPHER-TEXT.      02480052
024900     MOVE PV-SS-NBR-LEN                TO DP031-INPUT-LEN.        02490047
025000     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      02500047
025100     IF CSI-RETURN-CODE NOT = ZERO                                02510047
025200        DISPLAY 'RECORD NUMBER     : ' PV-RECORDS-INTO-SORT       02520047
025300        DISPLAY 'INPUT SSN LENGTH  : ' PV-SS-NBR-LEN              02530047
025400        DISPLAY 'SSN NUMBER        : ' AR056-SS-NBR               02540052
025500        PERFORM DP031-9999-ABEND                                  02550047
025600     ELSE                                                         02560047
025700        MOVE DP031-CLEAR-TEXT          TO SR-SS-NBR               02570047
025800     END-IF.                                                      02580047
025900                                                                  02590047
026000******************************************************************02600047
026100* 3300-WRITE-OUTPUT-FILE                                          02610047
026200*      WRITE THE RECORDS HAVING DETOKENIZED SSN NUMBER            02620047
026300******************************************************************02630047
026400 3300-WRITE-OUTPUT-FILE.                                          02640047
026500                                                                  02650047
026600     WRITE EMP-SSN-FILE-DETOKEN-REC                               02660047
026700        FROM AR056-EMPLOYEE-ACCOUNT-REC.                          02670052
026800                                                                  02680047
026900******************************************************************02690047
027000* 9000-EOJ-ROUTINE                                                02700047
027100*      INPUT AND OUTPUT FILES ARE CLOSED AND DISPLAYS THE NUMBER  02710047
027200*      OF RECORDS READ AND WRITTEN                                02720047
027300******************************************************************02730047
027400 9000-EOJ-ROUTINE.                                                02740047
027500                                                                  02750047
027600     CLOSE EMP-SSN-FILE                                           02760047
027700           EMP-SSN-FILE-DETOKEN.                                  02770047
027800     IF  PV-RECORDS-INTO-SORT = 0                                 02780047
027900       DISPLAY 'EMPL DISC ACCOUNT FILE IS EMPTY'                  02790047
028000     END-IF.                                                      02800047
028100     DISPLAY 'NUMBER OF EMPL DISC ACCOUNT RECORDS READ: '         02810047
028200                                    PV-RECORDS-INTO-SORT.         02820047
028300     DISPLAY 'NUMBER OF EMPL DISC ACCOUNT RECORDS WRITTEN: '      02830047
028400                                    PV-RECORDS-OUT-OF-SORT.       02840047
028500                                                                  02850047
028600******************************************************************02860047
028700* 9999-ABEND                                                     *02870047
028800*      ABEND ROUTINE                                             *02880047
028900******************************************************************02890047
029000                                                                  02900047
029100 9999-ABEND.                                                      02910047
029200                                                                  02920047
029300     DISPLAY '** ABEND           **'.                             02930047
029400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02940047
029500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02950047
029600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02960047
029700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       02970047
029800     CALL 'ILBOABN0' USING ABEND-CODE.                            02980047
029900                                                                  02990047
030000******************************************************************03000047
030100*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   03010047
030200*      PROTEGRITY MODULE FOR PROTECTION/UNPROTECTION              03020047
030300******************************************************************03030047
030400        COPY DPPD031.                                             03040047
030500                                                                  03050047
