000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    PCKUP022.                                         00040000
000500 AUTHOR.        EKTA AGRAWAL.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  JUNE 2010.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM DELETES ALL THE IR RECORDS FROM THE             * 00100000
001100*  RECIEVER LINE DETAIL TABLE FOR THE PULL NUMBER AND THE PULL  * 00110000
001200*  LINE NUMBER AND WRITES IT TO THE OUTPUT FILE.                * 00120000
001300***************************************************************** 00130000
002700 ENVIRONMENT DIVISION.                                            00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT RCVR-LNE-DTL-FILE                                     00320000
003300         ASSIGN TO INP01.                                         00330000
003400                                                                  00340000
003500***************************************************************** 00350000
003600 DATA DIVISION.                                                   00360000
003700***************************************************************** 00370000
003800 FILE SECTION.                                                    00380000
003900                                                                  00390000
004000 FD  RCVR-LNE-DTL-FILE                                            00400000
004100     RECORDING MODE IS F                                          00410000
004200     BLOCK CONTAINS 0 RECORDS                                     00420000
004300     LABEL RECORDS ARE STANDARD.                                  00430000
004400                                                                  00440000
004500 01 RCVR-LNE-DTL-RECORD    PIC X(107).                            00450000
004600                                                                  00460000
004700***************************************************************** 00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900                                                                  00490000
005000 01  PS-PROGRAM-SWITCHES.                                         00500000
005100     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00510000
005200         88  PS-END-OF-FILE                      VALUE 'Y'.       00520000
005300         88  PS-NOT-END-OF-FILE                  VALUE 'N'.       00530000
005400                                                                  00540000
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-REC-COUNT                 PIC  9(09) VALUE  0.        00560000
005700     05  PV-REC-DELETED               PIC  9(09) VALUE  0.        00570000
005800     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00580000
005900                                                                  00590000
006000 01  PV-ABEND-FIELDS.                                             00600000
006100     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00610000
006200                                                 COMP SYNC.       00620000
006300     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUP022'.00630000
006400     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00640000
006500     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00650000
006600     05  PV-DB2-TABLE-NAME            PIC  X(20) VALUE SPACES.    00660000
006700     05  PV-ABEND-PULL-NBR            PIC  X(7).                  00670000
006800     05  PV-ABEND-PULL-LNE-NBR        PIC  X(7).                  00680000
006900     05  PV-ABEND-OPER-UNT-ID         PIC  X(4).                  00690000
006910     05  PV-ABEND-WRKD-UNT-TMST       PIC  X(26).                 00691000
007000                                                                  00700000
007010 01  DK-DB2-KEY-FIELDS.                                           00701000
007020     10 DK-PO-NBR                  PIC  S9(9) COMP.               00702000
007030     10 DK-RCVR-SEQ-NBR            PIC  S9(9) COMP.               00703000
007040     10 DK-PO-LNE-NBR              PIC  S9(9) COMP.               00704000
007050     10 DK-ACTN-CDE                PIC  X(1).                     00705000
007060     10 DK-WRKD-UNT-TMST           PIC  X(26).                    00706000
007093     10 DK-PRCG-AREA-CDE           PIC  X(6).                     00709300
007100***********************************************************       00710000
007200*  COPYBOOK USED FOR THE RCVR-LNE-DTL-FILE  OUTPUT FILE   *       00720000
007300***********************************************************       00730000
007400     COPY PCWS261.                                                00740000
007500                                                                  00750000
007600***********************************************************       00760000
007700*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00770000
007800***********************************************************       00780000
007900     COPY DPWS004.                                                00790000
008000                                                                  00800000
008100***********************************************************       00810000
008200*  DB2 SQL COMMUNICATION AREA                             *       00820000
008300***********************************************************       00830000
008400     EXEC SQL                                                     00840000
008500          INCLUDE SQLCA                                           00850000
008600     END-EXEC.                                                    00860000
008700                                                                  00870000
008800***********************************************************       00880000
008900*  PCT_RCVR_LNE_DTL TABLE                                 *       00890000
009000***********************************************************       00900000
009100     EXEC SQL                                                     00910000
009200          INCLUDE PCT00007                                        00920000
009300     END-EXEC.                                                    00930000
009400                                                                  00940000
009500***************************************************************** 00950000
009600 PROCEDURE DIVISION.                                              00960000
009700***************************************************************** 00970000
009800     DISPLAY '**** BEGINNING PCKUP022 ****'.                      00980000
009900     DISPLAY '****************************************'.          00990000
010000     DISPLAY ' '.                                                 01000000
010100     PERFORM 0100-INITIALIZATION.                                 01010000
010200                                                                  01020000
010300*PROCESS INPUT FILE.                                              01030000
010400     PERFORM 1000-PROCESS-RCVR-LNE-DTL-FILE                       01040000
010500         UNTIL PS-END-OF-FILE.                                    01050000
010600                                                                  01060000
010700     DISPLAY 'NO. OF RCVR INP REC ==>' PV-REC-COUNT.              01070000
010800     DISPLAY 'NO. OF RCVR REC DELETED ==>' PV-REC-DELETED.        01080000
010900     DISPLAY ' '.                                                 01090000
011000     DISPLAY '****************************************'.          01100000
011100*CLOSE FILE.                                                      01110000
011200     CLOSE RCVR-LNE-DTL-FILE.                                     01120010
011220                                                                  01122000
011230     PERFORM 4000-TABLE-COMMIT.                                   01123000
011400                                                                  01140000
011500     DISPLAY '****  END OF PCKUP022  ****'.                       01150000
011600                                                                  01160000
011700     STOP RUN.                                                    01170000
011800                                                                  01180000
011900******************************************************************01190000
012000 0100-INITIALIZATION.                                             01200000
012100******************************************************************01210000
012200     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    01220000
012300                                                                  01230000
012400     OPEN INPUT  RCVR-LNE-DTL-FILE.                               01240010
012800                                                                  01280000
012810******************************************************************01281000
012900 1000-PROCESS-RCVR-LNE-DTL-FILE.                                  01290000
013000******************************************************************01300000
013100     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    01310000
013200                                                                  01320000
013210*READ INPUT RECORD.                                               01321000
013220     PERFORM 2000-READ-INPUT-FILE.                                01322000
013221                                                                  01322100
013230     IF PS-NOT-END-OF-FILE                                        01323000
013300        ADD +1 TO PV-REC-COUNT                                    01330000
013500        PERFORM 3000-DELETE-RECORD                                01350000
013600     END-IF.                                                      01360000
013900                                                                  01390000
014000***************************************************************** 01400000
014100 2000-READ-INPUT-FILE.                                            01410000
014200***************************************************************** 01420000
014300                                                                  01430000
014400     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    01440000
014500                                                                  01450000
014600     READ RCVR-LNE-DTL-FILE                                       01460000
014700       INTO PC261-RCVR-LNE-RECORD                                 01470000
014800         AT END                                                   01480000
014900           SET PS-END-OF-FILE TO TRUE.                            01490000
015000                                                                  01500000
015100                                                                  01510000
015200***************************************************************** 01520000
015300 3000-DELETE-RECORD.                                              01530000
015400***************************************************************** 01540000
015500     MOVE '3000-DELETE-RECORD         ' TO PV-ABEND-PARAGRAPH.    01550000
015600     INITIALIZE DK-PO-NBR                                         01560000
015700                DK-RCVR-SEQ-NBR                                   01570000
015710                DK-PO-LNE-NBR                                     01571000
015720                DK-ACTN-CDE                                       01572000
015730                DK-WRKD-UNT-TMST                                  01573000
015740                DK-PRCG-AREA-CDE.                                 01574000
015760                                                                  01576000
015800     MOVE PC261-PO-NBR         TO    DK-PO-NBR.                   01580000
015900     MOVE PC261-RCVR-SEQ-NBR   TO    DK-RCVR-SEQ-NBR.             01590000
016000     MOVE PC261-PO-LNE-NBR     TO    DK-PO-LNE-NBR.               01600000
016100     MOVE PC261-ACTN-CDE       TO    DK-ACTN-CDE.                 01610000
016200     MOVE PC261-WRKD-UNT-TMST  TO    DK-WRKD-UNT-TMST.            01620000
016800     MOVE PC261-PRCG-AREA-CDE  TO    DK-PRCG-AREA-CDE.            01680000
017000                                                                  01700000
017100     EXEC SQL                                                     01710000
017200         DELETE FROM PCT_RCVR_LNE_DTL                             01720000
017210         WHERE PO_NBR         = :DK-PO-NBR                        01721000
017300          AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                  01730000
017400          AND  PO_LNE_NBR     = :DK-PO-LNE-NBR                    01740000
017500          AND  ACTN_CDE       = :DK-ACTN-CDE                      01750000
017600          AND  WRKD_UNT_TMST  = :DK-WRKD-UNT-TMST                 01760000
017700          AND  PRCG_AREA_CDE  = :DK-PRCG-AREA-CDE                 01770000
019800     END-EXEC.                                                    01980000
019900                                                                  01990000
020000     EVALUATE TRUE                                                02000000
020100       WHEN SQLCODE = ZERO                                        02010000
020200           ADD 1 TO PV-REC-DELETED                                02020000
020300       WHEN SQLCODE = +100                                        02030000
020400           DISPLAY '****PULL NUMBER       ' PC261-PO-NBR          02040000
020410           DISPLAY '****PULL LINE NUMBER  ' PC261-PO-LNE-NBR      02041000
020420           DISPLAY '****TIMESTAMP         ' PC261-WRKD-UNT-TMST   02042000
020500                   ' NOT THERE IN THE TABLE****'                  02050000
020600       WHEN OTHER                                                 02060000
020700         MOVE SQLCODE TO PV-SQLCODE                               02070000
020800         MOVE 'PCT_RCVR_LNR_DTL'  TO PV-DB2-TABLE-NAME            02080000
020900         MOVE PC261-PO-NBR            TO PV-ABEND-PULL-NBR        02090000
021000         MOVE PC261-PO-LNE-NBR        TO PV-ABEND-PULL-LNE-NBR    02100000
021100         MOVE PC261-WRKD-UNT-TMST     TO PV-ABEND-WRKD-UNT-TMST   02110000
021200         PERFORM 9900-DB2-ABEND                                   02120000
021300     END-EVALUATE.                                                02130000
021400                                                                  02140000
021540***************************************************************** 02154000
021600* COMMIT THE PENDING TABLE CHANGES.                             * 02160000
021700***************************************************************** 02170000
021800 4000-TABLE-COMMIT.                                               02180000
021900                                                                  02190000
022000     EXEC SQL                                                     02200000
022100          COMMIT                                                  02210000
022200     END-EXEC.                                                    02220000
022300                                                                  02230000
022400******************************************************************02240000
022500 9900-DB2-ABEND.                                                  02250000
022600******************************************************************02260000
022700     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    02270000
022800                                                                  02280000
022900     DISPLAY '*** DB2 ERROR '.                                    02290000
023000     DISPLAY '*** SQLCODE       = ' PV-SQLCODE.                   02300000
023100     DISPLAY '*** PROGRAM       = ' PV-ABEND-PROGRAM.             02310000
023200     DISPLAY '*** PARAGRAPH     = ' PV-ABEND-PARAGRAPH.           02320000
023300     DISPLAY '*** TABLE NAME    = ' PV-DB2-TABLE-NAME.            02330000
023400     DISPLAY '*** PULL NUMBER   = ' PV-ABEND-PULL-NBR.            02340000
023500     DISPLAY '*** PULL LINE NUM = ' PV-ABEND-PULL-LNE-NBR.        02350000
023600     DISPLAY '*** OPER UNIT ID  = ' PV-ABEND-OPER-UNT-ID.         02360000
023610     DISPLAY '*** WRKD UNT TMST = ' PV-ABEND-WRKD-UNT-TMST.       02361000
023700                                                                  02370000
023800     COPY DPPD004.                                                02380000
023900                                                                  02390000
024000     MOVE +4013 TO PV-ABEND-CODE.                                 02400000
024100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02410000
