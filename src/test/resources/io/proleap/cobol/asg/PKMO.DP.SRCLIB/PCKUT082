000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 TITLE 'MONITOR TUPLDER TABLE FOR P2L TO LABOR INTERFACE'.        00040000
000500*                                                                 00050000
000600 PROGRAM-ID.    PCKUT082.                                         00060000
000700 AUTHOR.        JEAN KURKOWSKI.                                   00070000
000800 INSTALLATION.  KOHLS.                                            00080000
000900 DATE-WRITTEN   AUGUST 2007.                                      00090000
001000 DATE-COMPILED.                                                   00100000
001100                                                                  00110000
001200***************************************************************** 00120000
001300*    PROGRAM WILL PULL MESSAGES FROM THE TUPLDER TABLE USING    * 00130000
001400*    THE PREVIOUS RUN TIMESTAMP AND THE CURRENT TIMESTAMP.      * 00140000
001500*    IF MESSAGES ARE FOUND, THEY WILL BE WRITTEN TO A DATASET   * 00150000
001600*    AND THE RETURN CODE WILL BE SET TO 4095, SO THAT THE       * 00160000
001700*    FOLLOWING STEP WILL SEND OUT AN EMAIL.                     * 00170000
001800*                                                               * 00180000
001900***************************************************************** 00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200                                                                  00220000
002300 FILE-CONTROL.                                                    00230000
002400                                                                  00240000
002500     SELECT TIMESTAMP-FILE                                        00250002
002600         ASSIGN TO INP01.                                         00260000
002700                                                                  00270000
002800     SELECT ERROR-OUT-FILE                                        00280000
002900         ASSIGN TO OUT01.                                         00290000
003000                                                                  00300000
003100***************************************************************** 00310000
003200 DATA DIVISION.                                                   00320000
003300***************************************************************** 00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350000
003600 FD  TIMESTAMP-FILE                                               00360002
003700     RECORDING MODE IS F                                          00370002
003800     BLOCK CONTAINS 0 RECORDS                                     00380002
003900     LABEL RECORDS ARE STANDARD.                                  00390002
004000                                                                  00400002
004100 01  TIMESTAMP-REC                PIC X(80).                      00410002
004200                                                                  00420002
004300 FD  ERROR-OUT-FILE                                               00430000
004400     RECORDING MODE IS F                                          00440000
004500     BLOCK CONTAINS 0 RECORDS                                     00450000
004600     LABEL RECORDS ARE STANDARD.                                  00460000
004700                                                                  00470000
004800 01  ERROR-OUT-RECORD             PIC X(80).                      00480000
004900                                                                  00490000
005000***************************************************************** 00500000
005100 WORKING-STORAGE SECTION.                                         00510000
005200                                                                  00520000
005300***************************************************************** 00530004
005400*    INPUT CONTROL CARD                                           00540004
005500*    ADDED - 12/10/2009                                           00550004
005600***************************************************************** 00560004
005700 01  CC-CONTROL-CARD.                                             00570004
005800     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00580004
005900     05  FILLER                      PIC X(03)     VALUE SPACES.  00590004
006000     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00600004
006100                                                                  00610004
006200 01  DK-DB2-KEYS.                                                 00620004
006300     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00630004
006400                                                   COMP SYNC.     00640004
006500                                                                  00650004
006600 01  TIMESTAMP-REC-IN.                                            00660002
006700     05  FILLER                       PIC X(1)    VALUE SPACES.   00670002
006800     05  TR-FROM-TIMESTAMP            PIC X(26)   VALUE SPACES.   00680002
006900     05  FILLER                       PIC X(1)    VALUE SPACES.   00690002
007000     05  TR-TO-TIMESTAMP              PIC X(26)   VALUE SPACES.   00700002
007100     05  FILLER                       PIC X(26)   VALUE SPACES.   00710002
007200                                                                  00720002
007300 01  PS-PROGRAM-SWITCHES.                                         00730000
007400     05  PS-EOF-ERROR-CSR-SW          PIC X(01)  VALUE 'N'.       00740000
007500         88  PS-EOF-ERROR-CSR-YES                VALUE 'Y'.       00750000
007600         88  PS-EOF-ERROR-CSR-NO                 VALUE 'N'.       00760000
007700                                                                  00770000
007800 01  PC-PROGRAM-CONSTANTS.                                        00780000
007900     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PCKUT082'.00790000
008000                                                                  00800000
008100 01  PV-PROGRAM-VARIABLES.                                        00810000
008110     05  PV-LOCAL-FROM-TIMESTAMP      PIC X(26)   VALUE SPACES.   00811007
008130     05  PV-LOCAL-TO-TIMESTAMP        PIC X(26)   VALUE SPACES.   00813007
008140*                                                                 00814007
008200     05  PV-REC-CNT                   PIC  9(09) VALUE  0.        00820000
008300     05  PV-BAD-TK-CNT                PIC  9(09) VALUE  0.        00830000
008400     05  PV-ERR-CNT                   PIC S9(09) COMP VALUE +0.   00840000
008500     05  PV-THIS-TIMESTAMP            PIC X(26) VALUE SPACES.     00850000
008600     05  PV-LAST-TIMESTAMP            PIC X(26) VALUE SPACES.     00860000
008700     05  PV-SQL-RETURN-CD             PIC -9(04).                 00870000
008800     05  PV-DISPLAY-ERR               PIC -9(04).                 00880000
008900     05  PV-PREV-UPLD-TRN-CDE         PIC X(01).                  00890000
009000     05  PV-CURR-UPLD-TRN-CDE         PIC X(01).                  00900000
009010     05  PV-USER-ID                   PIC X(08).                  00901006
009100                                                                  00910000
009200 01  PV-ABEND-FIELDS.                                             00920000
009300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00930000
009400     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00940000
009500     05  PV-DB2-MESSAGE               PIC  X(50) VALUE SPACES.    00950000
009600     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00960000
009700                                                 VALUE +0.        00970000
009800                                                                  00980000
009900 01  HEADING-OUT.                                                 00990000
010000     05  HEAD-REC                     PIC X(80)   VALUE SPACES.   01000000
010100 01  RECORD-OUT.                                                  01010000
010200     05  FILLER                       PIC X(1)    VALUE SPACES.   01020000
010300     05  REC-OPER                     PIC ZZZ9    VALUE ZEROES.   01030000
010400     05  FILLER                       PIC X(1)    VALUE SPACES.   01040000
010500     05  FILLER                       PIC X(08)   VALUE           01050000
010600         'USER ID:'.                                              01060006
010700     05  REC-USER-ID                  PIC X(08).                  01070008
010800     05  FILLER                       PIC X(01)   VALUE SPACES.   01080000
010900     05  REC-CNT                      PIC ZZZ,ZZ9.                01090000
011000     05  FILLER                       PIC X(01)   VALUE SPACES.   01100000
011100     05  REC-MESSAGE                  PIC X(49).                  01110006
011300                                                                  01130000
011800* * * TUPLDER TABLE - UPLOAD ERROR TABLE                          01180000
011900     EXEC SQL                                                     01190000
012000         INCLUDE TUPLDER                                          01200000
012100     END-EXEC.                                                    01210000
012200                                                                  01220000
012260* * * COMMUNICATIONS AREA FOR DB2                                 01226016
012270     EXEC SQL                                                     01227016
012280          INCLUDE SQLCA                                           01228016
012290     END-EXEC.                                                    01229016
012291                                                                  01229116
012300**DECLARE THE ERROR-REC-CSR                                       01230000
012400     EXEC SQL                                                     01240000
012500          DECLARE ERROR-REC-CSR CURSOR FOR                        01250000
012510           SELECT   DISTINCT                                      01251027
012600                    UPLD_TRN_CDE                                  01260027
012700                   ,OPER_UNT_ID                                   01270000
012800                   ,ERR_CDE                                       01280000
012810                   ,SUBSTR(PKT_TXT,6,8)                           01281026
012900                   ,COUNT(*)                                      01290028
013000           FROM     TUPLDER                                       01300000
013100           WHERE    UPLD_TRN_CDE  IN ('F')                        01310001
013200***        AND      ERR_CDE       <>  '102'                       01320030
013300           AND      PRC_TMST       > :TR-FROM-TIMESTAMP           01330002
013400           AND      PRC_TMST      <= :TR-TO-TIMESTAMP             01340002
013500           AND      OPER_UNT_ID    = :DK-OPER-UNT-ID              01350004
013600           GROUP BY UPLD_TRN_CDE                                  01360028
013700                   ,OPER_UNT_ID                                   01370028
013800                   ,ERR_CDE                                       01380028
013810                   ,SUBSTR(PKT_TXT,6,8)                           01381028
013900           ORDER BY UPLD_TRN_CDE                                  01390000
014000                   ,OPER_UNT_ID                                   01400000
014100                   ,ERR_CDE                                       01410000
014110                   ,4                                             01411025
014200     END-EXEC.                                                    01420000
014300                                                                  01430000
014400     COPY DPWS004.                                                01440000
014500                                                                  01450000
014600                                                                  01460000
014700***************************************************************** 01470000
014800 PROCEDURE DIVISION.                                              01480000
014900***************************************************************** 01490000
015000                                                                  01500000
015100     OPEN INPUT  TIMESTAMP-FILE                                   01510002
015200          OUTPUT ERROR-OUT-FILE.                                  01520002
015300                                                                  01530004
015400*** DMH - 12/10/2009 - BEGIN                                      01540004
015500     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01550004
015600                                                                  01560004
015700     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              01570004
015800                                                                  01580004
015900     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID.                 01590004
015901                                                                  01590106
015907     MOVE '*****************************************'             01590731
015908                                        TO HEAD-REC.              01590831
015909     DISPLAY HEAD-REC.                                            01590931
015910     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01591031
015911                                                                  01591131
015913     MOVE SPACES                        TO HEAD-REC.              01591331
015914     DISPLAY HEAD-REC.                                            01591431
015915     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01591531
015916                                                                  01591631
015920     MOVE  CC-CONTROL-CARD  TO  HEAD-REC                          01592006
015960     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01596006
016000*** DMH - 12/10/2009 - END                                        01600004
016100                                                                  01610004
016200     PERFORM 1000-GET-TIMESTAMP.                                  01620002
016300                                                                  01630000
016400     PERFORM 2000-OPEN-ERROR-CSR.                                 01640000
016500     PERFORM 2010-FETCH-ERROR-CSR                                 01650000
016600         UNTIL PS-EOF-ERROR-CSR-YES.                              01660000
016700     PERFORM 2020-CLOSE-ERROR-CSR.                                01670000
016800                                                                  01680000
016900     MOVE SPACES  TO  HEAD-REC.                                   01690000
017000     DISPLAY HEADING-OUT.                                         01700000
017100     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01710000
017200                                                                  01720000
017300     CLOSE TIMESTAMP-FILE                                         01730003
017400           ERROR-OUT-FILE.                                        01740002
017500                                                                  01750000
017600*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       01760000
017700*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            01770000
017800                                                                  01780000
017900     IF PV-REC-CNT > 0                                            01790000
018000         MOVE 4095 TO RETURN-CODE                                 01800000
018100     END-IF.                                                      01810000
018200                                                                  01820000
018300     GOBACK.                                                      01830000
018400                                                                  01840000
018500***************************************************************** 01850000
018600*  GET THE CURRENT TIMESTAMP                                      01860000
018700***************************************************************** 01870000
018800 1000-GET-TIMESTAMP.                                              01880003
018900                                                                  01890000
019000                                                                  01900002
019100     READ TIMESTAMP-FILE                                          01910002
019200     INTO TIMESTAMP-REC-IN                                        01920002
019300            AT END                                                01930002
019400               MOVE 'MISSING TIMESTAMP FILE '                     01940002
019500                                TO PV-DB2-MESSAGE                 01950002
019600               MOVE '1000-GET-TIMESTAMP'                          01960002
019700                                TO PV-ABEND-PARAGRAPH             01970002
019800               MOVE 'INP01'     TO PV-ABEND-TABLE                 01980002
019900               PERFORM 9100-SQL-ABEND                             01990002
020000     END-READ.                                                    02000002
020100                                                                  02010002
020810     MOVE SPACES                        TO HEAD-REC.              02081006
020900     MOVE  'PROGRAM - PCKUT082'         TO HEAD-REC.              02090009
021300     DISPLAY HEAD-REC.                                            02130002
021501                                                                  02150131
021502     MOVE SPACES                        TO HEAD-REC.              02150231
021503     DISPLAY HEAD-REC.                                            02150331
021504     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02150431
021505                                                                  02150531
021506     MOVE SPACES                        TO HEAD-REC.              02150606
021510     STRING  'FROM DATE - '     TR-FROM-TIMESTAMP                 02151006
021520             '    CENTRAL TIME'                                   02152007
021530                  DELIMITED BY SIZE                               02153006
021540                                      INTO HEAD-REC.              02154006
021800     DISPLAY HEAD-REC.                                            02180002
021900     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02190002
022100                                                                  02210002
022200     STRING  'TO DATE   - '     TR-TO-TIMESTAMP                   02220002
022210             '    CENTRAL TIME'                                   02221007
022400                  DELIMITED BY SIZE                               02240002
022500                                      INTO HEAD-REC.              02250002
022600     DISPLAY HEAD-REC.                                            02260002
022700     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02270002
022900                                                                  02290002
022910     MOVE SPACES                        TO HEAD-REC.              02291007
022970     DISPLAY HEAD-REC.                                            02297007
022980     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02298007
023003                                                                  02300307
023004     MOVE SPACES                        TO HEAD-REC.              02300433
023010     MOVE '*****************************************'             02301002
023100                                        TO HEAD-REC.              02310002
023200     DISPLAY HEAD-REC.                                            02320002
023300     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02330002
023400                                                                  02340002
023500                                                                  02350002
023600     MOVE SPACES                        TO HEAD-REC.              02360002
023700     DISPLAY HEAD-REC.                                            02370002
023800     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02380002
023900                                                                  02390002
024000                                                                  02400002
024100     MOVE 'LABOR ASSIGNMENT ERRORS'                               02410037
024200                                        TO HEAD-REC.              02420002
024300     DISPLAY HEAD-REC.                                            02430002
024400     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02440002
024600                                                                  02460002
026100                                                                  02610002
026300***************************************************************** 02630000
026400*  OPEN THE ERROR REC CURSOR                                      02640000
026500***************************************************************** 02650000
026600 2000-OPEN-ERROR-CSR.                                             02660000
026700                                                                  02670000
026800     SET PS-EOF-ERROR-CSR-NO        TO TRUE.                      02680000
026900                                                                  02690000
027000     EXEC SQL                                                     02700000
027100          OPEN ERROR-REC-CSR                                      02710000
027200     END-EXEC.                                                    02720000
027300                                                                  02730000
027400     EVALUATE TRUE                                                02740000
027500         WHEN SQLCODE = ZERO                                      02750000
027600         WHEN SQLCODE = -904                                      02760000
027700         WHEN SQLCODE = -913                                      02770000
027800         WHEN SQLCODE = -911                                      02780000
027900              CONTINUE                                            02790000
028000         WHEN SQLWARN0 NOT = SPACES                               02800000
028100         WHEN SQLCODE NOT = ZERO                                  02810000
028200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02820000
028300             STRING 'SQL='                                        02830000
028400                  PV-SQL-RETURN-CD                                02840000
028500                  DELIMITED BY SIZE                               02850000
028600                            INTO PV-DB2-MESSAGE                   02860000
028700             MOVE '2000-OPEN-ERROR-CSR'                           02870000
028800                              TO PV-ABEND-PARAGRAPH               02880000
028900             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02890000
029000             PERFORM 9100-SQL-ABEND                               02900000
029100     END-EVALUATE.                                                02910000
029200                                                                  02920000
029300                                                                  02930000
029400***************************************************************** 02940000
029500*  FETCH THE ERROR REC CURSOR RECORDS                             02950000
029600***************************************************************** 02960000
029700 2010-FETCH-ERROR-CSR.                                            02970000
029800                                                                  02980000
029900     EXEC SQL                                                     02990000
030000          FETCH ERROR-REC-CSR                                     03000000
030100          INTO  :UPLDER-UPLD-TRN-CDE                              03010000
030200               ,:UPLDER-OPER-UNT-ID                               03020000
030300               ,:UPLDER-ERR-CDE                                   03030000
030310               ,:PV-USER-ID                                       03031006
030400               ,:PV-ERR-CNT                                       03040028
030500     END-EXEC.                                                    03050000
030600                                                                  03060000
030700     EVALUATE TRUE                                                03070000
030800         WHEN SQLCODE = ZERO                                      03080000
030900              PERFORM 2100-WRITE-RECORD                           03090000
031000         WHEN SQLCODE = +100                                      03100000
031100              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  03110000
031101                                                                  03110133
031110              MOVE SPACES                TO HEAD-REC              03111033
031140              DISPLAY HEAD-REC                                    03114035
031150              WRITE ERROR-OUT-RECORD FROM HEAD-REC                03115033
031160                                                                  03116033
031170              MOVE SPACES                TO HEAD-REC              03117033
031180              MOVE '*****************************************'    03118033
031190                                         TO HEAD-REC              03119033
031191              DISPLAY HEAD-REC                                    03119134
031192              WRITE ERROR-OUT-RECORD FROM HEAD-REC                03119233
031193                                                                  03119333
031194              MOVE SPACES                TO HEAD-REC              03119433
031195              DISPLAY HEAD-REC                                    03119534
031196              WRITE ERROR-OUT-RECORD FROM HEAD-REC                03119633
031197                                                                  03119733
031200         WHEN SQLCODE = -904                                      03120000
031300         WHEN SQLCODE = -913                                      03130000
031400         WHEN SQLCODE = -911                                      03140000
031500              CONTINUE                                            03150000
031600         WHEN SQLWARN0 NOT = SPACES                               03160000
031700         WHEN SQLCODE NOT = ZERO                                  03170000
031800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03180000
031900             STRING 'SQL='                                        03190000
032000                  PV-SQL-RETURN-CD                                03200000
032100                  DELIMITED BY SIZE                               03210000
032200                            INTO PV-DB2-MESSAGE                   03220000
032300             MOVE '2010-FETCH-ERROR-CSR'                          03230000
032400                              TO PV-ABEND-PARAGRAPH               03240000
032500             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03250000
032600             PERFORM 9100-SQL-ABEND                               03260000
032700     END-EVALUATE.                                                03270000
032800                                                                  03280000
032900                                                                  03290000
033000***************************************************************** 03300000
033100*  CLOSE THE ERROR REC CURSOR                                     03310000
033200***************************************************************** 03320000
033300 2020-CLOSE-ERROR-CSR.                                            03330000
033400                                                                  03340000
033500     EXEC SQL                                                     03350000
033600          CLOSE ERROR-REC-CSR                                     03360000
033700     END-EXEC.                                                    03370000
033800                                                                  03380000
033900     EVALUATE TRUE                                                03390000
034000         WHEN SQLCODE = ZERO                                      03400000
034100         WHEN SQLCODE = -904                                      03410000
034200         WHEN SQLCODE = -913                                      03420000
034300         WHEN SQLCODE = -911                                      03430000
034400             CONTINUE                                             03440000
034500         WHEN SQLWARN0 NOT = SPACES                               03450000
034600         WHEN SQLCODE NOT = ZERO                                  03460000
034700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03470000
034800             STRING 'SQL='                                        03480000
034900                  PV-SQL-RETURN-CD                                03490000
035000                  DELIMITED BY SIZE                               03500000
035100                            INTO PV-DB2-MESSAGE                   03510000
035200             MOVE '2020-CLOSE-ERROR-CSR'                          03520000
035300                              TO PV-ABEND-PARAGRAPH               03530000
035400             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03540000
035500             PERFORM 9100-SQL-ABEND                               03550000
035600     END-EVALUATE.                                                03560000
035700                                                                  03570000
035800                                                                  03580000
035900***************************************************************** 03590000
036000*  WRITE A RMS RECORD TO THE ERROR FILE                           03600000
036100***************************************************************** 03610000
036200 2100-WRITE-RECORD.                                               03620000
036300     IF  UPLDER-UPLD-TRN-CDE  =  PV-PREV-UPLD-TRN-CDE             03630000
036400         CONTINUE                                                 03640000
036500     ELSE                                                         03650000
036600         IF  UPLDER-UPLD-TRN-CDE  =  'F'                          03660000
036700             MOVE '                                         '     03670000
036800                                   TO HEAD-REC                    03680000
036900             DISPLAY HEADING-OUT                                  03690000
037000             WRITE ERROR-OUT-RECORD FROM HEADING-OUT              03700000
037100             MOVE 'ASSOCIATES ON MULTIPLE ACTIVE ASSIGNMENTS'     03710006
037200                                   TO HEAD-REC                    03720000
037300             DISPLAY HEADING-OUT                                  03730000
037400             WRITE ERROR-OUT-RECORD FROM HEADING-OUT              03740000
037401                                                                  03740131
037420             MOVE SPACES           TO HEAD-REC                    03742031
037430             DISPLAY HEADING-OUT                                  03743031
037440             WRITE ERROR-OUT-RECORD FROM HEADING-OUT              03744031
037450                                                                  03745031
037500             MOVE UPLDER-UPLD-TRN-CDE TO  PV-PREV-UPLD-TRN-CDE    03750000
037600         END-IF                                                   03760000
037700     END-IF.                                                      03770000
037800                                                                  03780000
037900                                                                  03790000
038000     MOVE UPLDER-OPER-UNT-ID       TO REC-OPER.                   03800000
038100***  MOVE UPLDER-ERR-CDE           TO REC-ERR-CDE.                03810006
038200     MOVE PV-ERR-CNT               TO REC-CNT.                    03820000
038210     MOVE PV-USER-ID               TO REC-USER-ID.                03821006
038300                                                                  03830000
038400     IF  UPLDER-UPLD-TRN-CDE  =  'F'                              03840000
038500       EVALUATE TRUE                                              03850000
038600         WHEN UPLDER-ERR-CDE = '101'                              03860000
038700             MOVE 'EVENTS LOST - ASSOCIATE ON MULTIPLE ASGMTS'    03870031
038800                                   TO REC-MESSAGE                 03880000
038900         WHEN UPLDER-ERR-CDE = '102'                              03890000
039000             MOVE 'EVENTS LOST - MULT ASGMT FOR SAME WORK AREA'   03900031
039100                                   TO REC-MESSAGE                 03910000
039200       END-EVALUATE                                               03920000
039300     END-IF.                                                      03930000
039400                                                                  03940000
039500     DISPLAY RECORD-OUT.                                          03950000
039600     WRITE ERROR-OUT-RECORD FROM RECORD-OUT.                      03960000
039700                                                                  03970000
039800     IF  UPLDER-UPLD-TRN-CDE  =  'F'                              03980000
039900                  ADD +1         TO PV-REC-CNT                    03990000
040000     END-IF.                                                      04000000
040100                                                                  04010000
040200                                                                  04020000
040300******************************************************************04030000
040400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04040000
040500*  ERROR OR WARNING CODE OCCURS.                                  04050000
040600******************************************************************04060000
040700 9100-SQL-ABEND.                                                  04070002
040800     DISPLAY '9100-SQL-ABEND'.                                    04080000
040900     DISPLAY '** ABEND     **'.                                   04090000
041000     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04100000
041100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04110000
041200     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 04120000
041300     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 04130000
041400     COPY DPPD004.                                                04140000
041500                                                                  04150000
041600     MOVE +4013                  TO PV-ABEND-CODE.                04160000
041700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04170000
041800                                                                  04180000
