000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKUT091.                                00050000
000600 AUTHOR.                 GERMAN BANDA.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            DECEMBER, 2009.                          00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL TAKE IN A PO DETAIL FILE FROM ENROUTE AND    *00120000
001300* ARRIVED TRAILERS. THE FILE WILL BE SORTED IN TRIP/PO/RCVR/LINE *00130000
001400* ORDER.  THE PROGRAM WILL THEN CALL AND AUDIT DETERMINATION     *00140000
001500* MODULE(PCKUT090) WHICH WILL CALCULATE AUDITS REQUIREMENTS FOR  *00150000
001600* EACH AUDIT GROUP.                                              *00160000
001700*                                                                *00170000
001800* THE INPUT AND OUTPUT FILE LAYOUTS ARE PCRD068.                 *00180000
001900*----------------------------------------------------------------*00190000
W40392***************************************************************** 00200000
W40392*  CHANGE LOG.                                                    00210000
W40392*  DATE         CHANGED BY      DESC                              00220000
W40392*  -----------  -------------- ---------------------------------- 00230000
W40392*  10/07/2011   S. ANDERSON    EFC OPTIMIZATION AND HOLIDAY PREP  00240000
W40392*               (CODEWORKS)     - ADDITIONAL DATA NEEDED FOR      00250000
W40392*                                 SUMMARY REPORTS                 00260000
W40392*                              PROJ ID:   3253                    00270000
W40392*                              WR/IR#:   WR40392                  00280000
W40392*  01/15/2014   SHOBHIT BAIJAL ADDED LOGIC TO CALL PCKUT090 AT    00281000
W40392*               (COGNIZANT)    RECEIVER LEVEL FOR RFID AND        00282000
W40392*                              CALCULATE THE CARTONS TO AUDIT     00283000
W40392*                              PROJ ID:   5148D                   00284000
W40392*                              CHANGES MARKED *SB 01/15/14        00285000
W40392*  03/28/2014   SHOBHIT BAIJAL ADDED LOGIC TO CALCULATE COMBO RF  00286000
W40392*               (COGNIZANT)    AND QC AUDITS AT RECEIVER LEVEL    00287000
W40392*                              TO BE USED IN PCKUT092             00288000
W40392*                              PROJ ID:   5148D                   00289000
W40392*                              CHANGES MARKED *SB 03/28/14        00289100
W40392***************************************************************** 00290000
002000                                                                  00300000
002100***************************************************************** 00310000
002200 ENVIRONMENT DIVISION.                                            00320000
002300***************************************************************** 00330000
002400 INPUT-OUTPUT SECTION.                                            00340000
002500                                                                  00350000
002600 FILE-CONTROL.                                                    00360000
002700                                                                  00370000
002800     SELECT INPUT-FILE ASSIGN TO INP01.                           00380000
002900                                                                  00390000
003000     SELECT EXTRACT-PO-DTL-FILE ASSIGN TO OUT01.                  00400000
003100                                                                  00410000
003200                                                                  00420000
003300***************************************************************** 00430000
003400 DATA DIVISION.                                                   00440000
003500***************************************************************** 00450000
003600 FILE SECTION.                                                    00460000
003700*                                                                 00470000
003800*                                                                 00480000
003900 FD  INPUT-FILE                                                   00490000
004000     RECORDING MODE IS F                                          00500000
004100     LABEL RECORDS ARE STANDARD                                   00510000
004200     BLOCK CONTAINS 0 RECORDS.                                    00520000
      *SB 01/15/14 - BEGIN PR#5148D                                     00521000
004300*01  INPUT-RECORD                PIC X(326).                      00530000
004300 01  INPUT-RECORD                PIC X(400).                      00530100
      *SB 01/15/14 - END PR#5148D                                       00531000
004400                                                                  00540000
004500 FD  EXTRACT-PO-DTL-FILE                                          00550000
004600     RECORDING MODE IS F                                          00560000
004700     LABEL RECORDS ARE STANDARD                                   00570000
004800     BLOCK CONTAINS 0 RECORDS.                                    00580000
      *SB 01/15/14 - BEGIN PR#5148D                                     00581000
004900*01  EXTRACT-DTL-RECORD          PIC X(326).                      00590000
004900 01  EXTRACT-DTL-RECORD          PIC X(400).                      00590100
      *SB 01/15/14 - END PR#5148D                                       00591000
005000                                                                  00600000
005100*                                                                 00610000
005200*                                                                 00620000
005300***************************************************************** 00630000
005400 WORKING-STORAGE SECTION.                                         00640000
005500                                                                  00650000
005600 01  PS-PROGRAM-SWITCHES.                                         00660000
005700     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00670000
005800         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00680000
005900         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00690000
006000                                                                  00700000
006100     05  PS-WRITE-ZERO-COUNTS-SW      PIC X(01)  VALUE 'N'.       00710000
006200         88  PS-WRITE-ZERO-COUNTS-YES            VALUE 'Y'.       00720000
006300         88  PS-WRITE-ZERO-COUNTS-NO             VALUE 'N'.       00730000
006310     05  PS-SEASET-DIVERT-PO-SW       PIC X(01)  VALUE 'N'.       00740000
006320         88  PS-SEASET-DIVERT-PO-YES             VALUE 'Y'.       00750000
006330         88  PS-SEASET-DIVERT-PO-NO              VALUE 'N'.       00760000
      *SB 01/15/14 - BEGIN PR#5148D                                     00760100
006100     05  PS-WRITE-ZERO-RFID-SW        PIC X(01)  VALUE 'N'.       00761000
006200         88  PS-WRITE-ZERO-RFID-YES              VALUE 'Y'.       00762000
006300         88  PS-WRITE-ZERO-RFID-NO               VALUE 'N'.       00763000
006100     05  PS-RFID-CHECK-SW             PIC X(01)  VALUE 'N'.       00763100
006200         88  PS-RFID-CHECK-YES                   VALUE 'Y'.       00763200
006300         88  PS-RFID-CHECK-NO                    VALUE 'N'.       00763300
      *SB 01/15/14 - END PR#5148D                                       00764000
006400                                                                  00770000
006500                                                                  00780000
006600 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00790000
006700                                                 COMP SYNC.       00800000
006800     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00810000
006900                                                                  00820000
007000 01  PV-PROGRAM-VARIABLES.                                        00830000
007100     05  PV-ATTR-DEPT                 PIC  S9(10)V9(5) COMP-3.    00840000
007200     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00850000
007300                                                  COMP SYNC.      00860000
007400     05  PV-WRITE-PBS-EXTR-COUNT      PIC S9(09) VALUE ZERO       00870000
007500                                                  COMP SYNC.      00880000
007600     05  PV-WRITE-NON-PBS-EXTR-COUNT  PIC S9(09) VALUE ZERO       00890000
007700                                                  COMP SYNC.      00900000
007800     05  PV-MAX-PO-LINE-COUNT         PIC S9(09) VALUE ZERO       00910000
007900                                                  COMP SYNC.      00920000
008000     05  PV-MAX-PO-LNE-QTY            PIC S9(09) VALUE ZERO       00930000
008100                                                  COMP SYNC.      00940000
      *SB 01/15/14 - BEGIN PR#5148D                                     00940100
008000     05  PV-RFID-MAX-PO-LNE-QTY       PIC S9(09) VALUE ZERO       00941000
008100                                                  COMP SYNC.      00942000
      *SB 01/15/14 - END PR#5148D                                       00943000
008200                                                                  00950000
008300     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00960000
008400     05  PV-DISPLAY-WRITE-PBS-CNT     PIC ZZZ,ZZZ,ZZ9.            00970000
008500     05  PV-DISPLAY-WRITE-NON-PBS-CNT PIC ZZZ,ZZZ,ZZ9.            00980000
008600                                                                  00990000
008700     05  PV-DISPLAY-TRIP-ID           PIC Z(8)9-.                 01000000
008800     05  PV-DISPLAY-PO-NBR            PIC Z(8)9-.                 01010000
008900     05  PV-DISPLAY-PO-LNE-NBR        PIC Z(8)9-.                 01020000
009000     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 9999-.                  01030000
009100     05  PV-DISPLAY-PACK-ID           PIC Z(8)9-.                 01040000
009200     05  PV-DISPLAY-OPER-UNT-ID       PIC 9999-.                  01050000
009300                                                                  01060000
009400     05  PV-PREV-PO-NBR              PIC S9(09)    VALUE ZERO.    01070000
009500     05  PV-PREV-REC-SEQ-NBR         PIC S9(04)    VALUE ZERO.    01080000
009600     05  PV-PREV-PREPK-ID            PIC S9(04)    VALUE ZERO.    01090000
009700                                                                  01100000
009800     05  PV-SEASET-COUNT              PIC S9(9) VALUE +0          01110000
009900                                                COMP-3.           01120000
009910     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0          01130000
009920                                                COMP-3.           01140000
010000     05  PV-PO-COUNT                  PIC S9(9) VALUE +0          01150000
010100                                                COMP-3.           01160000
W40392     05  PV-PO-COUNT-CURR             PIC S9(9) VALUE +0          01170000
W40392                                                COMP-3.           01180000
010200     05  PV-SCAN-COUNT                PIC S9(9) VALUE +0          01190000
010300                                                COMP-3.           01200000
010400     05  PV-CURR-TMST                 PIC X(26).                  01210000
010500     05  PV-U-CARTON-COUNT            PIC S9(9)  VALUE +0         01220000
010600                                                    COMP.         01230000
      *SB 01/15/14 - BEGIN PR#5148D                                     01230100
010500     05  PV-RFID-U-CARTON-COUNT       PIC S9(9)  VALUE +0         01231000
010600                                                    COMP.         01232000
           05  PV-RFID-CTN-CNT              PIC S9(09) VALUE +0 COMP-3. 01232100
      *SB 01/15/14 - END PR#5148D                                       01232200
      *SB 03/28/14 - BEGIN PR#5148D                                     01232300
           05  PV-TOTAL-AUD-CTNS           PIC  S9(09) VALUE ZERO       01232400
                                                        COMP SYNC.      01232500
           05  PV-TOTAL-U-CTNS             PIC  S9(09) VALUE ZERO       01232600
                                                        COMP SYNC.      01232700
           05  PV-TOTAL-RFID-AUD-CTNS      PIC  S9(09) VALUE ZERO       01232800
                                                        COMP SYNC.      01232900
           05  PV-TOTAL-RFID-U-CTNS        PIC  S9(09) VALUE ZERO       01233000
                                                        COMP SYNC.      01233100
           05  PV-TOTAL-COMBO-CTNS         PIC  S9(09) VALUE ZERO       01233200
                                                        COMP SYNC.      01233300
      *SB 03/28/14 - END PR#5148D                                       01233400
010700     05  PV-Q-CARTON-COUNT            PIC S9(9)  VALUE +0         01240000
010800                                                    COMP.         01250000
010900     05  PV-TOT-CTN-CNT-LINE          PIC S9(9)  VALUE +0         01260000
011000                                                    COMP.         01270000
011100                                                                  01280000
011200     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.    01290000
011300     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACES.    01300000
011400     05  PV-DB2-TABLE-NAME1           PIC X(15)  VALUE SPACES.    01310000
011500     05  PV-DB2-TABLE-NAME2           PIC X(15)  VALUE SPACES.    01320000
011600     05  PV-DB2-TABLE-NAME3           PIC X(15)  VALUE SPACES.    01330000
011700                                                                  01340000
011800                                                                  01350000
011900 01  PV-SAVE-FIELDS.                                              01360000
012000     05  PV-SAVE-TRIP-ID             PIC  S9(9) COMP.             01370000
012100     05  PV-SAVE-PO-NBR              PIC  S9(9) COMP.             01380000
012200     05  PV-SAVE-REC-SEQ-NBR         PIC  S9(9) COMP.             01390000
012300     05  PV-SAVE-PO-LNE-NBR          PIC  S9(9) COMP.             01400000
012400     05  PV-SAVE-MAX-PO-LNE-QTY      PIC  S9(9) COMP.             01410000
012500                                                                  01420000
      *SB 01/10/14 - BEGIN PR#5148D                                     01420100
       01  PV-TEMP-PCRD068.                                             01421000
           05  FILLER                      PIC   X(028).                01422000
           05  PV-PO-NBR                   PIC  S9(009) COMP.           01423000
           05  PV-REC-SEQ-NBR              PIC  S9(009) COMP.           01424000
           05  FILLER                      PIC   X(364).                01425000
      *SB 01/10/14 - END   PR#5148D                                     01425100
                                                                        01426000
012600 01  DK-DB-KEYS.                                                  01430000
012700     05  DK-TRIP-ID                  PIC  S9(9) COMP.             01440000
012800     05  DK-SCAC                     PIC   X(4).                  01450000
012900     05  DK-TRAILER                  PIC   X(10).                 01460000
013000     05  DK-PO-NBR                   PIC  S9(9) COMP.             01470000
013100     05  DK-REC-SEQ-NBR              PIC  S9(9) COMP.             01480000
013200     05  DK-LINE-NBR                 PIC  S9(9) COMP.             01490000
013300     05  DK-DEPT-NBR                 PIC   X(03).                 01500000
013400     05  DK-SUB-CL-NBR               PIC   X(03).                 01510000
013500     05  DK-AGRMT-TYP-ID             PIC   X(01).                 01520000
013600     05  DK-TYP-CDE                  PIC  S9(4) COMP.             01530000
013700     05  DK-ITEM-NBR                 PIC  S9(15)V COMP-3.         01540000
013800     05  DK-CHARTC-SEQ-NBR           PIC   X(01).                 01550000
013900     05  DK-CONV-HANG-DESC           PIC   X(01).                 01560000
014000                                                                  01570000
014100 01 PC-PROGRAM-CONSTANTS.                                         01580000
014200     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT091'. 01590000
014300                                                                  01600000
014400 01  PV-ABEND-FIELDS.                                             01610000
014500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01620000
014600                                                 COMP SYNC.       01630000
014700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUT087'.01640000
014800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01650000
014900     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01660000
015000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01670000
015100     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01680000
015200     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01690000
015300     05  PV-SQL-RETURN-CD             PIC  999-.                  01700000
015400     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01710000
015500     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01720000
015600     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01730000
015700     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01740000
015800                                                                  01750000
015900     05  PV-MAJ-CL-NBR                PIC   X(04).                01760000
016000                                                                  01770000
016100******************************************************************01780000
016200*  USED FOR DB2 ERROR MESSAGE BUILDING                            01790000
016300******************************************************************01800000
016400     COPY DPWS004.                                                01810000
016500                                                                  01820000
016600*----------------------------------------------------------------*01830000
016700*    ABEND PROCESSING COPYBOOK.                                  *01840000
016800*----------------------------------------------------------------*01850000
016900                                                                  01860000
017000     COPY DPWS013.                                                01870000
017100******************************************************************01880000
017200*  COPY BOOK FOR COMPANY CONTROL                                  01890000
017300******************************************************************01900000
017400     EXEC SQL                                                     01910000
017500          INCLUDE TSHIPMT                                         01920000
017600     END-EXEC.                                                    01930000
017700******************************************************************01940000
017710     EXEC SQL                                                     01950000
017720          INCLUDE TVHTRIP                                         01960000
017730     END-EXEC.                                                    01970000
017740******************************************************************01980000
017750*  COPY BOOK FOR SHIPMENT TO PO TABLE                             01990000
017760******************************************************************02000000
017770     EXEC SQL                                                     02010000
017780          INCLUDE TSHPTPO                                         02020000
017790     END-EXEC.                                                    02030000
017791******************************************************************02040000
017792     EXEC SQL                                                     02050000
017793          INCLUDE TRECEIV                                         02060000
017794     END-EXEC.                                                    02070000
017795******************************************************************02080000
017796     EXEC SQL                                                     02090000
017797          INCLUDE TSHUNLO                                         02100000
017798     END-EXEC.                                                    02110000
017799******************************************************************02120000
017800     EXEC SQL                                                     02130000
017801          INCLUDE TPKSLIP                                         02140000
017802     END-EXEC.                                                    02150000
017803******************************************************************02160000
017804******************************************************************02170000
017805     EXEC SQL                                                     02180000
017806          INCLUDE TINPKSU                                         02190000
017807     END-EXEC.                                                    02200000
017808******************************************************************02210000
017809******************************************************************02220000
017810     EXEC SQL                                                     02230000
017820          INCLUDE TSHPUNT                                         02240000
017830     END-EXEC.                                                    02250000
017840******************************************************************02260000
017841******************************************************************02270000
017842******************************************************************02280000
017843     EXEC SQL                                                     02290000
017844          INCLUDE TSHUUPC                                         02300000
017845     END-EXEC.                                                    02310000
017846******************************************************************02320000
017850     EXEC SQL                                                     02330000
017860          INCLUDE TSEASET                                         02340000
017870     END-EXEC.                                                    02350000
017880******************************************************************02360000
017881******************************************************************02370000
017882     EXEC SQL                                                     02380000
017883          INCLUDE TPURCHS                                         02390000
017884     END-EXEC.                                                    02400000
017885******************************************************************02410000
017886******************************************************************02420000
017887     EXEC SQL                                                     02430000
017888          INCLUDE TKRPRPM                                         02440000
017889     END-EXEC.                                                    02450000
017890******************************************************************02460000
017886******************************************************************02470000
017887     EXEC SQL                                                     02480000
017888          INCLUDE XLT00010                                        02490000
017889     END-EXEC.                                                    02500000
017890******************************************************************02510000
      *SB 01/15/14 - BEGIN PR#5148D                                     02510100
017886******************************************************************02511000
017887     EXEC SQL                                                     02512000
017888          INCLUDE TENTNME                                         02513000
017889     END-EXEC.                                                    02514000
017890******************************************************************02515000
017886******************************************************************02516000
017887     EXEC SQL                                                     02517000
017888          INCLUDE TVNDAGR                                         02518000
017889     END-EXEC.                                                    02519000
      *SB 01/15/14 - END PR#5148D                                       02519100
017890******************************************************************02519200
017891*   DB2 SQL COMMUNICATION AREA                                    02520000
017900******************************************************************02530000
018000     EXEC SQL                                                     02540000
018100          INCLUDE SQLCA                                           02550000
018200     END-EXEC.                                                    02560000
018300*                                                                 02570000
018400*DB2 AREA FOR COMMUNICATIONS AREA2                                02580000
018500     COPY SQLCA2.                                                 02590000
018600                                                                  02600000
018700******************************************************************02610000
018800*  RECORD LAYOUT FOR AN AUDIT DETERMINATION MODULE                02620000
018900***********************************************************       02630000
019000     COPY PCWS259.                                                02640000
019100***********************************************************       02650000
019200*  RECORD LAYOUT FOR AN EXTRACT FILE CONTAINING THE               02660000
019300*  PO/RCVR/LINE INFORMATION FOR A TRAILER                         02670000
019400***********************************************************       02680000
019500*OUTPUT FILE LAYOUT                                               02690000
019600     COPY PCRD068.                                                02700000
019700                                                                  02710000
019800 EJECT                                                            02720000
019900                                                                  02730000
020000***********************************************************       02740000
020100 PROCEDURE DIVISION.                                              02750000
020200***********************************************************       02760000
020300     DISPLAY '***BEGINNING PCKUT091***'.                          02770000
020400                                                                  02780000
020500     PERFORM 1000-INITIALIZE.                                     02790000
020600                                                                  02800000
020700     PERFORM 2000-PROCESS-EXTRACTS                                02810000
020800         UNTIL PS-END-OF-INPUT-FILE.                              02820000
020810                                                                  02830000
      *SB 01/10/14 - BEGIN PR#5148D                                     02830100
      * PROCESS LAST RECORD                                             02831000
           ADD PC068-TOT-CTN-CNT TO PV-RFID-CTN-CNT.                    02831100
           PERFORM 5000-CHECK-RFID-STATUS                               02831300
           IF PC068-RFID-STATUS = 'T' OR 'C'                            02831400
              SET PS-RFID-CHECK-YES TO TRUE                             02832000
           ELSE                                                         02833000
              INITIALIZE PV-RFID-CTN-CNT                                02833200
              SET PS-RFID-CHECK-NO  TO TRUE                             02833300
           END-IF.                                                      02833400
           PERFORM 2010-PROCESS-AUDIT-GROUPS.                           02834000
           PERFORM 3000-FORMAT-DTL-FILE.                                02835000
      *SB 03/28/14 - BEGIN PR#5148D                                     02835100
           PERFORM 3500-CALCULATE-COMBO.                                02835200
      *SB 03/28/14 - END PR#5148D                                       02835300
           PERFORM 8000-WRITE-TO-DTL-FILE.                              02836000
      *SB 01/10/14 - END   PR#5148D                                     02836100
                                                                        02837000
020900     PERFORM 8900-CHECK-PARM-DETAIL-REPORT.                       02840000
021010     PERFORM 9000-CLOSE-FILES.                                    02850000
021100                                                                  02860000
021200     GOBACK.                                                      02870000
021300                                                                  02880000
021400                                                                  02890000
021500******************************************************************02900000
021600*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02910000
021700 1000-INITIALIZE.                                                 02920000
021800******************************************************************02930000
021900     OPEN INPUT  INPUT-FILE                                       02940000
022000          OUTPUT EXTRACT-PO-DTL-FILE.                             02950000
022100                                                                  02960000
022200     INITIALIZE PC068-RECORD-LAYOUT.                              02970000
      *SB 01/10/14 - BEGIN PR#5148D                                     02970100
           INITIALIZE PV-RFID-CTN-CNT.                                  02971000
022400     MOVE +1 TO PV-RFID-MAX-PO-LNE-QTY                            02971100
      *SB 01/10/14 - END   PR#5148D                                     02972000
022300     MOVE +0 TO PV-MAX-PO-LINE-COUNT                              02980000
022400     MOVE +1 TO PV-MAX-PO-LNE-QTY                                 02990000
022500*FIRST READ                                                       03000000
022600     PERFORM 7000-READ-INPUT-FILE.                                03010000
022610     PERFORM 8900-CHECK-PARM-DETAIL-REPORT.                       03020000
022700                                                                  03030000
022800     IF PS-END-OF-INPUT-FILE                                      03040000
022900         DISPLAY '** FILE IS EMPTY **'                            03050000
023000     ELSE                                                         03060000
023100         MOVE PC068-TRIP-ID     TO PV-SAVE-TRIP-ID                03070000
023200         MOVE PC068-PO-NBR      TO PV-PREV-PO-NBR                 03080000
023300         MOVE PC068-REC-SEQ-NBR TO PV-PREV-REC-SEQ-NBR            03090000
023400         MOVE PC068-PO-LNE-NBR  TO PV-SAVE-PO-LNE-NBR             03100000
      *SB 01/15/14 - BEGIN PR#5148D                                     03100100
               MOVE PV-TEMP-PCRD068 TO PC068-RECORD-LAYOUT              03101100
               PERFORM 7000-READ-INPUT-FILE                             03101200
      *SB 01/15/14 - END PR#5148D                                       03102000
023500     END-IF.                                                      03110000
023600                                                                  03120000
023700                                                                  03130000
023800***************************************************************** 03140000
023900 2000-PROCESS-EXTRACTS.                                           03150000
024000**AUDIT GROUP  COMBINATION :                                    * 03160000
024100*              BULK/CASE     PO/RCVR/LINE                         03170000
024200*              PREPACK       PO/RCVR/PACK ID                      03180000
024300*              PACK BY STORE PO/RCVR                              03190000
024400***************************************************************** 03200000
024500***************************************************************** 03210000
024600     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       03220000
024700                                                                  03230000
      *SB 01/10/14 - BEGIN PR#5148D                                     03230100
           PERFORM 5000-CHECK-RFID-STATUS                               03230200
           ADD PC068-TOT-CTN-CNT TO PV-RFID-CTN-CNT                     03230300
           IF ((PC068-PO-NBR  = PV-PO-NBR) AND                          03231000
               (PC068-REC-SEQ-NBR = PV-REC-SEQ-NBR))                    03232000
               SET  PS-RFID-CHECK-NO  TO TRUE                           03233000
           ELSE                                                         03233100
               IF PC068-RFID-STATUS = 'T' OR 'C'                        03233200
                  SET PS-RFID-CHECK-YES TO TRUE                         03233300
               ELSE                                                     03233400
                  SET PS-RFID-CHECK-NO  TO TRUE                         03233500
                  INITIALIZE PV-RFID-CTN-CNT                            03233600
               END-IF                                                   03233800
           END-IF.                                                      03234000
      *SB 01/10/14 - END   PR#5148D                                     03234100
                                                                        03235000
024800     PERFORM 2010-PROCESS-AUDIT-GROUPS                            03240000
024900     PERFORM 3000-FORMAT-DTL-FILE.                                03250000
      *SB 03/28/14 - BEGIN PR#5148D                                     03250100
           IF ((PC068-PO-NBR  = PV-PO-NBR) AND                          03251000
               (PC068-REC-SEQ-NBR = PV-REC-SEQ-NBR))                    03252000
              CONTINUE                                                  03252100
           ELSE                                                         03253000
              PERFORM 3500-CALCULATE-COMBO                              03253100
              INITIALIZE PV-TOTAL-AUD-CTNS                              03253200
                         PV-TOTAL-U-CTNS                                03253300
                         PV-TOTAL-RFID-AUD-CTNS                         03253400
                         PV-TOTAL-RFID-U-CTNS                           03253500
                         PV-TOTAL-COMBO-CTNS                            03253600
           END-IF.                                                      03254000
      *SB 03/28/14 - END PR#5148D                                       03255000
025000     PERFORM 8000-WRITE-TO-DTL-FILE.                              03260000
                                                                        03260100
      *SB 01/10/14 - BEGIN PR#5148D                                     03260200
           IF  PS-RFID-CHECK-YES                                        03261000
               INITIALIZE PV-RFID-CTN-CNT                               03261100
           END-IF.                                                      03262000
                                                                        03270000
           MOVE PV-TEMP-PCRD068 TO PC068-RECORD-LAYOUT.                 03271000
      *SB 01/10/14 - END   PR#5148D                                     03272000
025200     PERFORM 7000-READ-INPUT-FILE.                                03280000
025300                                                                  03290000
025400***************************************************************** 03300000
025500 2010-PROCESS-AUDIT-GROUPS.                                       03310000
025600*    PV-MAX-PO-LNE-QTY    -  FROM AUDIT MODULE                    03320000
025700*    PV-MAX-PO-LINE-COUNT -  COUNTER IN PGM                       03330000
025800***************************************************************** 03340000
025900     MOVE '2010-PROCESS-AUDIT-GROUPS ' TO PV-ABEND-PARAGRAPH.     03350000
026000                                                                  03360000
026100     SET PS-WRITE-ZERO-COUNTS-NO TO TRUE                          03370000
      *SB 01/15/14 - BEGIN PR#5148D                                     03370100
026100     SET PS-WRITE-ZERO-RFID-NO   TO TRUE                          03371000
      *SB 01/15/14 - END PR#5148D                                       03372000
026200                                                                  03380000
026300     IF PC068-PKG-TYPE = 'B' OR 'C'                               03390000
026400        IF (PC068-PO-NBR    = PV-PREV-PO-NBR ) AND                03400000
026500           (PC068-REC-SEQ-NBR  = PV-PREV-REC-SEQ-NBR )            03410000
026600            IF PV-MAX-PO-LINE-COUNT  <  PV-MAX-PO-LNE-QTY         03420000
026700               PERFORM 2100-LOAD-AUDIT-CALL                       03430000
026800               PERFORM 2200-CALL-TO-AUDIT-MOD                     03440000
026810               IF PC068-UCC128-IND-USED                           03450000
026900                  MOVE PC259-MAX-PO-LNE-QTY TO PV-MAX-PO-LNE-QTY  03460000
027000                  ADD +1 TO PV-MAX-PO-LINE-COUNT                  03470000
027010               END-IF                                             03480000
      *SB 01/15/14 - BEGIN PR#5148D                                     03480100
                     IF PS-RFID-CHECK-NO                                03480200
027200                  SET PS-WRITE-ZERO-RFID-YES   TO TRUE            03480300
                     END-IF                                             03480400
                  ELSE                                                  03481000
                     IF PS-RFID-CHECK-YES                               03500200
026700                  PERFORM 2100-LOAD-AUDIT-CALL                    03500300
026800                  PERFORM 2200-CALL-TO-AUDIT-MOD                  03500400
                     ELSE                                               03500500
027200                  SET PS-WRITE-ZERO-RFID-YES   TO TRUE            03501000
                     END-IF                                             03501100
027200               SET PS-WRITE-ZERO-COUNTS-YES TO TRUE               03501200
                  END-IF                                                03512000
027210        ELSE                                                      03520000
                  IF PS-RFID-CHECK-NO                                   03521100
                     SET PS-WRITE-ZERO-RFID-YES   TO TRUE               03521200
                  END-IF                                                03521300
      *SB 01/15/14 - END PR#5148D                                       03522000
027212            PERFORM 2100-LOAD-AUDIT-CALL                          03530000
027213            PERFORM 2200-CALL-TO-AUDIT-MOD                        03540000
027214            IF PC068-UCC128-IND-USED                              03550000
027215               MOVE PC259-MAX-PO-LNE-QTY TO PV-MAX-PO-LNE-QTY     03560000
027216               MOVE +1 TO PV-MAX-PO-LINE-COUNT                    03570000
027217            END-IF                                                03580000
027220            MOVE PC068-PO-NBR TO PV-PREV-PO-NBR                   03590000
027230            MOVE PC068-REC-SEQ-NBR TO PV-PREV-REC-SEQ-NBR         03600000
027300        END-IF                                                    03610000
027400     ELSE                                                         03620000
      *SB 01/10/14 - BEGIN PR#5148D                                     03621000
              IF PS-RFID-CHECK-NO                                       03624000
                 SET PS-WRITE-ZERO-RFID-YES   TO TRUE                   03625000
              END-IF                                                    03626000
      *SB 01/10/14 - END   PR#5148D                                     03627000
027500        PERFORM 2100-LOAD-AUDIT-CALL                              03630000
027600        PERFORM 2200-CALL-TO-AUDIT-MOD                            03640000
      *SB 01/15/14 - BEGIN PR#5148D                                     03640100
027220        MOVE PC068-PO-NBR      TO PV-PREV-PO-NBR                  03641000
027230        MOVE PC068-REC-SEQ-NBR TO PV-PREV-REC-SEQ-NBR             03642000
      *SB 01/15/14 - END PR#5148D                                       03643000
027700     END-IF.                                                      03650000
027900                                                                  03670000
028000 2100-LOAD-AUDIT-CALL.                                            03680000
028100     MOVE '2100-LOAD-AUDIT-CALL '     TO PV-ABEND-PARAGRAPH.      03690000
028200     INITIALIZE   PC259-AUDIT-FIELDS.                             03700000
028300     MOVE PC068-TRIP-ID            TO PC259-INBOUND-TRIP-ID.      03710000
028400     MOVE PC068-PO-NBR             TO PC259-PO-NUMBER.            03720000
028500     MOVE PC068-REC-SEQ-NBR        TO PC259-REC-SEQ-NBR.          03730000
028600     MOVE PC068-PACK-ID            TO PC259-PRE-PACK-ID.          03740000
028700     MOVE PC068-OPER-UNT-ID        TO PC259-OPER-UNT-ID.          03750000
028710     MOVE PC068-TOT-CTN-CNT        TO PC259-EXPCTD-CRTNS.         03760000
      *SB 01/10/14 - BEGIN PR#5148D                                     03761000
           IF PS-RFID-CHECK-YES                                         03761100
              MOVE PV-RFID-CTN-CNT       TO PC259-RFID-EXPCTD-CRTNS     03761200
           ELSE                                                         03761300
              MOVE 0                     TO PC259-RFID-EXPCTD-CRTNS     03762000
           END-IF.                                                      03763000
      *SB 01/10/14 - END   PR#5148D                                     03764000
028720                                                                  03770000
028900     EVALUATE TRUE                                                03780000
029000        WHEN PC068-PKG-TYPE    = 'B' OR 'C'                       03790000
029100              MOVE 'BC'   TO PC259-PKG-TYPE                       03800000
029200              MOVE PC068-PO-LNE-NBR  TO PC259-LINE-NBR            03810000
029300        WHEN PC068-PKG-TYPE    = 'M' OR 'I'                       03820000
029400             MOVE 'PP'   TO PC259-PKG-TYPE                        03830000
029500             MOVE PC068-PO-LNE-NBR TO PC259-DRIVER-LINE-NBR       03840000
029600        WHEN PC068-PBS-ORDER                                      03850000
029700              MOVE 'PS'   TO PC259-PKG-TYPE                       03860000
029800     END-EVALUATE.                                                03870000
029900                                                                  03880000
      *SB 01/10/14 - BEGIN PR#5148D                                     03881000
           IF PS-RFID-CHECK-YES                                         03881100
              SET PC259-RFID-CHECK-YES TO TRUE                          03881200
           ELSE                                                         03882100
              SET PC259-RFID-CHECK-NO  TO TRUE                          03883000
           END-IF.                                                      03888000
      *SB 01/10/14 - END   PR#5148D                                     03888100
                                                                        03889000
030000***************************************************************** 03890000
030100 2200-CALL-TO-AUDIT-MOD.                                          03900000
030200***************************************************************** 03910000
030300     MOVE '2200-CALL-TO-AUDIT-MOD  ' TO PV-ABEND-PARAGRAPH.       03920000
030400     IF PC068-UCC128-IND-USED                                     03930000
030500       CALL PC259-AUDIT-PGM USING PC259-AUDIT-FIELDS              03940000
030600       EVALUATE TRUE                                              03950000
030700         WHEN PC259-SUCCESSFUL                                    03960000
030800              CONTINUE                                            03970000
030900         WHEN OTHER                                               03980000
031000             MOVE PC068-TRIP-ID     TO PV-DISPLAY-TRIP-ID         03990000
031100             MOVE PC068-PO-NBR      TO PV-DISPLAY-PO-NBR          04000000
031200             MOVE PC068-REC-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR    04010000
031300             MOVE PC068-PACK-ID     TO PV-DISPLAY-PACK-ID         04020000
031400             MOVE PC068-PO-LNE-NBR  TO PV-DISPLAY-PO-LNE-NBR      04030000
031500             MOVE PC068-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID     04040000
031600             PERFORM Z999-SQL-ABEND                               04050000
031601       END-EVALUATE                                               04060000
031610     ELSE                                                         04070000
031611         SET PS-WRITE-ZERO-COUNTS-YES TO TRUE                     04080000
031620     END-IF.                                                      04090000
031800***************************************************************** 04100000
031900 3000-FORMAT-DTL-FILE.                                            04110000
032000***************************************************************** 04120000
032100     EVALUATE TRUE                                                04130000
032200        WHEN PC259-AUDIT-IS-COMPLETE                              04140000
032300        WHEN PS-WRITE-ZERO-COUNTS-YES                             04150000
032400             MOVE +0      TO PC068-AUD-CRTNS-LINE-U               04160000
032500                             PC068-AUD-CRTNS-LINE                 04170000
032600                             PC068-AUD-CRTNS-100-PO               04180000
032900        WHEN PC259-AUDIT-REQUIRED                                 04190000
033000        WHEN PC259-AUDIT-PENDING                                  04200000
033100           MOVE PC259-CARTONS-TO-AUDIT TO PC068-AUD-CRTNS-LINE    04210000
033200           MOVE PC259-UNITS-TO-AUDIT   TO PC068-UNITS-TO-AUDIT    04220000
033300           IF PC068-TOT-CTN-CNT > 0                               04230000
033400              COMPUTE PV-U-CARTON-COUNT =                         04240000
033500                  PC068-TOT-CTN-CNT   - PC068-AUD-CRTNS-LINE      04250000
033600           ELSE                                                   04260000
033700               MOVE +0   TO PV-U-CARTON-COUNT                     04270000
033800           END-IF                                                 04280000
033900           MOVE PV-U-CARTON-COUNT   TO PC068-AUD-CRTNS-LINE-U     04290000
034200           MOVE +0                  TO PC068-AUD-CRTNS-100-PO     04300000
034300        WHEN PC259-100-PC-AUDIT-REQD                              04310000
034400             MOVE PC068-TOT-CTN-CNT TO PC068-AUD-CRTNS-100-PO     04320000
034600             MOVE +0      TO PC068-AUD-CRTNS-LINE-U               04330000
034700                             PC068-AUD-CRTNS-LINE                 04340000
034900        WHEN PC259-REWORK                                         04350000
035000             MOVE PC068-TOT-CTN-CNT  TO PC068-AUD-CRTNS-LINE      04360000
035100             MOVE +0      TO PC068-AUD-CRTNS-LINE-U               04370000
035200                             PC068-AUD-CRTNS-100-PO               04380000
035500     END-EVALUATE                                                 04380100
                                                                        04380200
      *SB 01/15/14 - BEGIN PR#5148D                                     04381000
           EVALUATE TRUE                                                04381100
032200        WHEN PC259-RFID-AUDIT-IS-COMPLETE                         04381200
032300        WHEN PS-WRITE-ZERO-RFID-YES                               04381300
032400             MOVE +0      TO PC068-RFID-AUD-CRTNS-LINE-U          04381400
032500                             PC068-RFID-AUD-CRTNS-LINE            04381500
032600                             PC068-RFID-AUD-CRTNS-100-PO          04381600
032900        WHEN PC259-RFID-AUDIT-REQUIRED                            04381700
033000        WHEN PC259-RFID-AUDIT-PENDING                             04381800
                 IF PC068-COMPLIANT                                     04382000
032400              MOVE +0      TO PC068-RFID-AUD-CRTNS-LINE-U         04382100
032500                              PC068-RFID-AUD-CRTNS-LINE           04382200
032600                              PC068-RFID-AUD-CRTNS-100-PO         04382300
                 ELSE                                                   04382500
033100              MOVE PC259-RFID-CARTONS-TO-AUDIT TO                 04382600
033100                                       PC068-RFID-AUD-CRTNS-LINE  04382700
033200              MOVE PC259-RFID-UNITS-TO-AUDIT TO                   04382800
033200                                       PC068-RFID-UNITS-TO-AUDIT  04382900
033300              IF PV-RFID-CTN-CNT > 0                              04383000
033400                 COMPUTE PV-RFID-U-CARTON-COUNT =                 04383100
033500                      PV-RFID-CTN-CNT - PC068-RFID-AUD-CRTNS-LINE 04383200
033600              ELSE                                                04383300
033700                 MOVE +0   TO PV-RFID-U-CARTON-COUNT              04383400
033800              END-IF                                              04383500
033900              MOVE PV-RFID-U-CARTON-COUNT TO                      04383600
033900                                 PC068-RFID-AUD-CRTNS-LINE-U      04383700
034200              MOVE +0         TO PC068-RFID-AUD-CRTNS-100-PO      04383800
                 END-IF                                                 04383900
034300        WHEN PC259-RFID-100-PC-AUDIT-REQD                         04384000
034400             MOVE PV-RFID-CTN-CNT TO PC068-RFID-AUD-CRTNS-100-PO  04384100
034600             MOVE +0      TO PC068-RFID-AUD-CRTNS-LINE-U          04384300
034700                              PC068-RFID-AUD-CRTNS-LINE           04384400
034900        WHEN PC259-RFID-REWORK                                    04384500
035000             MOVE PV-RFID-CTN-CNT  TO PC068-RFID-AUD-CRTNS-LINE   04384600
035100             MOVE +0      TO PC068-RFID-AUD-CRTNS-LINE-U          04384700
035200                             PC068-RFID-AUD-CRTNS-100-PO          04384800
035500     END-EVALUATE                                                 04390000
      *SB 01/15/14 - END PR#5148D                                       04391000
035510                                                                  04400000
035520                                                                  04410000
035600     IF PC068-UCC128-IND-USED                                     04420000
035610       IF PC068-PKG-TYPE = 'B' OR 'C'                             04430000
035701          MOVE PC259-MAX-PO-LNE-QTY-TABLE TO PC068-PROMPTED-LINES 04440000
      *SB 01/15/14 - BEGIN PR#5148D                                     04440100
035701          MOVE PC259-RFID-MAX-PO-LNE-QTY-TABL TO                  04441000
035701                                        PC068-RFID-PROMPTED-LINES 04442000
      *SB 01/15/14 - END PR#5148D                                       04443000
035710       ELSE                                                       04450000
035720          MOVE +0  TO PC068-PROMPTED-LINES                        04460000
      *SB 01/15/14 - BEGIN PR#5148D                                     04460100
035720          MOVE +0  TO PC068-RFID-PROMPTED-LINES                   04461000
      *SB 01/15/14 - END PR#5148D                                       04462000
035730       END-IF                                                     04470000
035740                                                                  04480000
035800       MOVE PC259-VND-RNKG-CDE TO PC068-VENDOR-RANKING            04490000
035810                                                                  04500000
035900       IF NOT PC259-100-PC-AUDIT-REQD                             04510000
036000          MOVE PC259-MIN-CART-CKD-QTY TO PC068-MIN-CRTN-CHECK     04520000
036100          MOVE PC259-MAX-CART-CKD-QTY TO PC068-MAX-CRTN-CHECK     04530000
036300          MOVE PC259-AUD-PCT          TO PC068-PCNT-TO-AUDIT      04540000
036301       END-IF                                                     04550000
036302                                                                  04560000
036310       IF PC259-FAILED-AUDITS                                     04570000
036402          MOVE 'Y'                    TO PC068-PREV-AUD-FAIL      04580000
036404       END-IF                                                     04590000
036406       IF PC259-REWORK                                            04600000
036407          MOVE 'R'                     TO PC068-AUD-COMPLETE      04610000
036408       END-IF                                                     04620000
036409       IF PC259-PASSED-AUDITS                                     04630000
036410          MOVE 'Y'                     TO PC068-AUD-COMPLETE      04640000
036411       END-IF                                                     04650000
036412       IF PC259-PASS-AUDIT-AT-DC                                  04660000
036413          MOVE 'D'                     TO PC068-AUD-COMPLETE      04670000
036414       END-IF                                                     04680000
036440                                                                  04780000
      *SB 01/15/14 - BEGIN PR#5148D                                     04781000
035800       MOVE PC259-RFID-VND-RNKG-CDE TO PC068-RFID-VENDOR-RANKING  04782000
                                                                        04782100
035900       IF NOT PC259-RFID-100-PC-AUDIT-REQD                        04782200
036000          MOVE PC259-RFID-MIN-CART-CKD-QTY TO                     04782300
036000                                         PC068-RFID-MIN-CRTN-CHECK04782400
036100          MOVE PC259-RFID-MAX-CART-CKD-QTY TO                     04782500
036100                                         PC068-RFID-MAX-CRTN-CHECK04782600
036300          MOVE PC259-RFID-AUD-PCT          TO                     04782700
036300                                         PC068-RFID-PCNT-TO-AUDIT 04782800
036301       END-IF                                                     04782900
036302                                                                  04783000
036310       IF PC259-RFID-FAILED-AUDITS                                04783100
036402          MOVE 'Y'                    TO PC068-RFID-PREV-AUD-FAIL 04783200
036404       END-IF                                                     04783300
036406       IF PC259-RFID-REWORK                                       04783400
036407          MOVE 'R'                     TO PC068-RFID-AUD-COMPLETE 04783500
036408       END-IF                                                     04783600
036409       IF PC259-RFID-PASSED-AUDITS                                04783700
036410          MOVE 'Y'                     TO PC068-RFID-AUD-COMPLETE 04783800
036411       END-IF                                                     04783900
036412       IF PC259-RFID-PASS-AUDIT-AT-DC                             04784000
036413          MOVE 'D'                     TO PC068-RFID-AUD-COMPLETE 04784100
036414       END-IF                                                     04784200
036420     ELSE                                                         04784300
036421          MOVE +0    TO PC068-PROMPTED-LINES                      04784400
036422                        PC068-MIN-CRTN-CHECK                      04784500
036423                        PC068-MAX-CRTN-CHECK                      04784600
036424                        PC068-PCNT-TO-AUDIT                       04784700
036421                        PC068-RFID-PROMPTED-LINES                 04784800
036422                        PC068-RFID-MIN-CRTN-CHECK                 04784900
036423                        PC068-RFID-MAX-CRTN-CHECK                 04785000
036424                        PC068-RFID-PCNT-TO-AUDIT                  04785100
036425          MOVE SPACE TO PC068-VENDOR-RANKING                      04785200
036426                        PC068-PREV-AUD-FAIL                       04785300
036427                        PC068-AUD-COMPLETE                        04785400
036425                        PC068-RFID-VENDOR-RANKING                 04785600
036426                        PC068-RFID-PREV-AUD-FAIL                  04785700
036427                        PC068-RFID-AUD-COMPLETE                   04785800
036430     END-IF                                                       04785900
036440                                                                  04786000
      *SB 03/28/14 - BEGIN PR#5148D                                     04786100
           ADD PC068-AUD-CRTNS-LINE        TO PV-TOTAL-AUD-CTNS         04786200
           ADD PC068-AUD-CRTNS-LINE-U      TO PV-TOTAL-U-CTNS           04786300
           ADD PC068-RFID-AUD-CRTNS-LINE   TO PV-TOTAL-RFID-AUD-CTNS    04786400
           ADD PC068-RFID-AUD-CRTNS-LINE-U TO PV-TOTAL-RFID-U-CTNS      04786500
      *SB 03/28/14 - END PR#5148D                                       04786600
      *SB 01/15/14 - END PR#5148D                                       04787000
036450                                                                  04790000
036500     PERFORM 4000-SELECT-ADDTL-COUNTS.                            04800000
036600     MOVE PV-PO-COUNT   TO  PC068-PO-CNT-TRLR.                    04810000
W40392     MOVE PV-PO-COUNT-CURR TO  PC068-EFC-PO-CNT-TRLR.             04820000
036700     MOVE PV-SCAN-COUNT TO  PC068-CRTNS-TO-SCAN.                  04840000
036710     IF PS-SEASET-DIVERT-PO-YES                                   04850000
036720        MOVE PC068-TOT-CTN-CNT  TO PC068-SET-DIVERT-CNT-PO        04860000
036730     ELSE                                                         04870000
036740        MOVE +0       TO PC068-SET-DIVERT-CNT-PO                  04880000
036750     END-IF.                                                      04890000
                                                                        04891000
      *SB 03/28/14 - BEGIN PR#5148D                                     04891100
       3500-CALCULATE-COMBO.                                            04892000
           IF PV-TOTAL-AUD-CTNS > 0 AND PV-TOTAL-RFID-AUD-CTNS > 0      04892100
      *    THERE ARE COMBO AUDITS SINCE BOTH QC & RF GREATER THAN 0     04892200
              IF PV-TOTAL-AUD-CTNS > PV-TOTAL-RFID-AUD-CTNS             04892300
      *       IF # OF RFID AUDITS LESS THAN QC THEN THAT IS # OF COMBOS 04892400
                 MOVE PV-TOTAL-RFID-AUD-CTNS TO                         04892500
                      PC068-COMB-AUD-CRTNS-TRLR                         04892600
                 MOVE 0                      TO                         04892700
                      PC068-RFID-AUD-CRTNS-TRLR                         04892800
                 COMPUTE PC068-AUD-CRTNS-TRLR = PV-TOTAL-AUD-CTNS -     04892900
                                              PC068-COMB-AUD-CRTNS-TRLR 04893000
              ELSE                                                      04893100
      *       IF # OF QC AUDITS LESS THAN RFID THEN THAT IS # OF COMBOS 04893200
                 IF PV-TOTAL-AUD-CTNS < PV-TOTAL-RFID-AUD-CTNS OR       04893300
                    PV-TOTAL-AUD-CTNS = PV-TOTAL-RFID-AUD-CTNS          04893400
                    MOVE PV-TOTAL-AUD-CTNS   TO                         04893500
                         PC068-COMB-AUD-CRTNS-TRLR                      04893600
                    MOVE 0                      TO                      04893700
                         PC068-AUD-CRTNS-TRLR                           04893800
                    COMPUTE PC068-RFID-AUD-CRTNS-TRLR =                 04893900
                            PV-TOTAL-RFID-AUD-CTNS  -                   04894000
                            PC068-COMB-AUD-CRTNS-TRLR                   04894100
                 ELSE                                                   04894200
      *       IF # OF QC AUDITS = # OF RFID THEN ALL COMBOS ONLY        04894300
                    MOVE PV-TOTAL-AUD-CTNS   TO                         04894400
                         PC068-COMB-AUD-CRTNS-TRLR                      04894500
                    MOVE 0                      TO                      04894600
                         PC068-AUD-CRTNS-TRLR                           04894700
                         PC068-RFID-AUD-CRTNS-TRLR                      04894800
                 END-IF                                                 04894900
              END-IF                                                    04895000
              IF PV-TOTAL-U-CTNS > PV-TOTAL-RFID-U-CTNS                 04895100
                 MOVE PV-TOTAL-RFID-U-CTNS TO PC068-AUD-CRTNS-TRLR-U    04895200
              ELSE                                                      04895300
                 IF PV-TOTAL-RFID-U-CTNS > PV-TOTAL-U-CTNS OR           04895400
                    PV-TOTAL-RFID-U-CTNS = PV-TOTAL-U-CTNS              04895500
                    MOVE PV-TOTAL-U-CTNS   TO PC068-AUD-CRTNS-TRLR-U    04895600
                 END-IF                                                 04895700
              END-IF                                                    04895800
           ELSE                                                         04895900
              MOVE PV-TOTAL-AUD-CTNS      TO PC068-AUD-CRTNS-TRLR       04896000
              MOVE PV-TOTAL-RFID-AUD-CTNS TO PC068-RFID-AUD-CRTNS-TRLR  04896100
              IF PV-TOTAL-AUD-CTNS > 0                                  04896200
                 MOVE PV-TOTAL-U-CTNS     TO PC068-AUD-CRTNS-TRLR-U     04896300
              ELSE IF PV-TOTAL-RFID-AUD-CTNS > 0                        04896400
                      MOVE PV-TOTAL-RFID-U-CTNS   TO                    04896500
                                             PC068-AUD-CRTNS-TRLR-U     04896600
                   END-IF                                               04896700
              END-IF                                                    04896800
           END-IF.                                                      04896900
      *SB 03/28/14 - END PR#5148D                                       04897000
                                                                        04898000
036900***************************************************************** 04900000
037000                                                                  04910000
037100 4000-SELECT-ADDTL-COUNTS.                                        04920000
037200      PERFORM 4100-SELECT-PO-COUNTS.                              04930000
037200      PERFORM 4150-SELECT-PO-COUNTS-CURR.                         04940000
037300      IF PC068-PBS-ORDER                                          04950000
037400         PERFORM 4300-CARTON-SCANNED-PBS                          04960000
037500      ELSE                                                        04970000
037510        IF PC068-UCC128-IND = ' ' AND                             04980000
037520           PC068-CASEPK-IND = 'Y'                                 04990000
037530            MOVE +0 TO PV-SCAN-COUNT                              05000000
037540        ELSE                                                      05010000
037550           IF PC068-UCC128-IND = ' ' AND                          05020000
037560              PC068-CASEPK-IND = ' '                              05030000
037561              MOVE PC068-TOT-CTN-CNT TO PV-SCAN-COUNT             05040000
037580           ELSE                                                   05050000
037600               PERFORM 4200-CARTON-SCANNED                        05060000
037610           END-IF                                                 05070000
037620         END-IF                                                   05080000
037700      END-IF.                                                     05090000
037710                                                                  05100000
037720      IF PC068-PO-NBR   = PV-SAVE-PO-NBR                          05110000
037740           CONTINUE                                               05120000
037750      ELSE                                                        05130000
037751         PERFORM 4400-SELECT-SET-DVRT-COUNTS                      05140000
037752         MOVE PC068-PO-NBR  TO PV-SAVE-PO-NBR                     05150000
037760      END-IF.                                                     05160000
037800                                                                  05170000
037900 4100-SELECT-PO-COUNTS.                                           05180000
038000      MOVE '4100-SELECT-PO-COUNTS' TO PV-PARAGRAPH-NAME.          05190000
038100                                                                  05200000
038200      MOVE PC068-TRIP-ID  TO   DK-TRIP-ID.                        05210000
038300      MOVE PC068-SCAC     TO   DK-SCAC.                           05220000
038400      MOVE PC068-TRLR-NBR TO   DK-TRAILER.                        05230000
038500      MOVE +0             TO   PV-PO-COUNT.                       05240000
038600                                                                  05250000
038700      EXEC SQL                                                    05260000
038800        SELECT COUNT(*)                                           05270000
038900           INTO :PV-PO-COUNT                                      05280000
039000           FROM TSHPTPO A                                         05290000
039100               ,TSHIPMT B                                         05300000
039200               ,TVHTRIP C                                         05310000
039300               ,TRECEIV F                                         05320000
039400          WHERE C.OWNER_SCAC_ID = :DK-SCAC                        05330000
039500            AND C.VEH_NBR       = :DK-TRAILER                     05340000
039600            AND C.TRIP_ID       = :DK-TRIP-ID                     05350000
039700            AND A.SHIPT_ID        = B.SHIPT_ID                    05360000
039800            AND B.TRIP_ID         = C.TRIP_ID                     05370000
039900            AND A.PO_NBR          = F.ORD_NBR                     05380000
040000            AND A.REC_SEQ_NBR     = F.REC_SEQ_NBR                 05390000
040100            AND F.VER_STATUS_CDE  = 'A'                           05400000
040110           WITH UR                                                05410000
040200      END-EXEC                                                    05420000
040300                                                                  05430000
040400      EVALUATE TRUE                                               05440000
040500        WHEN SQLCODE = ZERO                                       05450000
040600          CONTINUE                                                05460000
040700        WHEN SQLCODE = +100                                       05470000
040800           MOVE +0 TO PV-PO-COUNT                                 05480000
040900        WHEN SQLWARN0 NOT = SPACES                                05490000
041000        WHEN SQLCODE NOT = ZERO                                   05500000
041100          MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     05510000
041200          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          05520000
041300          MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID         05530000
041400                                                                  05540000
041500          MOVE 'GET PO COUNT FOR TRLR '                           05550000
041600                                    TO PV-DB2-OPERATION-MESSAGE-1 05560000
041700          MOVE 'TSHPTPO '     TO PV-DB2-TABLE-NAME1               05570000
041800          PERFORM Z999A-SQL-ABEND                                 05580000
041900      END-EVALUATE.                                               05590000
037800                                                                  05600000
W40392 4150-SELECT-PO-COUNTS-CURR.                                      05610000
W40392      MOVE '4150-SELECT-PO-COUNTS-CURR' TO PV-PARAGRAPH-NAME.     05620000
W40392                                                                  05630000
W40392      MOVE PC068-TRIP-ID  TO   DK-TRIP-ID.                        05640000
W40392      MOVE PC068-SCAC     TO   DK-SCAC.                           05650000
W40392      MOVE PC068-TRLR-NBR TO   DK-TRAILER.                        05660000
W40392      MOVE +0             TO   PV-PO-COUNT-CURR.                  05670000
W40392                                                                  05680000
W40392      EXEC SQL                                                    05690000
W40392        SELECT COUNT(*)                                           05700000
W40392           INTO :PV-PO-COUNT-CURR                                 05710000
W40392           FROM TSHPTPO A                                         05720000
W40392               ,TSHIPMT B                                         05730000
W40392               ,TVHTRIP C                                         05740000
W40392               ,TRECEIV F                                         05750000
W40392               ,XLT_LOC G                                         05760000
W40392          WHERE C.OWNER_SCAC_ID = :DK-SCAC                        05770000
W40392            AND C.VEH_NBR       = :DK-TRAILER                     05780000
W40392            AND C.TRIP_ID       = :DK-TRIP-ID                     05790000
W40392            AND A.SHIPT_ID        = B.SHIPT_ID                    05800000
W40392            AND B.TRIP_ID         = C.TRIP_ID                     05810000
W40392            AND A.PO_NBR          = F.ORD_NBR                     05820000
W40392            AND A.REC_SEQ_NBR     = F.REC_SEQ_NBR                 05830000
W40392            AND F.VER_STATUS_CDE  = 'A'                           05840000
W40392            AND F.OPER_UNT_ID   <>  F.CURR_OPER_UNT_ID            05850000
W40392            AND F.OPER_UNT_ID     = G.LOC_NBR                     05860000
W40392            AND G.E_BUS_IND       = 'Y'                           05870000
W40392           WITH UR                                                05880000
W40392      END-EXEC                                                    05890000
W40392                                                                  05900000
W40392      EVALUATE TRUE                                               05910000
W40392        WHEN SQLCODE = ZERO                                       05920000
W40392*SMA      CONTINUE                                                05930000
W40392          MOVE PV-PO-COUNT-CURR  TO PC068-EFC-PO-CNT-TRLR         05940000
W40392        WHEN SQLCODE = +100                                       05980000
W40392           MOVE +0 TO PV-PO-COUNT-CURR                            05990000
W40392        WHEN SQLWARN0 NOT = SPACES                                06000000
W40392        WHEN SQLCODE NOT = ZERO                                   06010000
W40392          MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     06020000
W40392          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          06030000
W40392          MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID         06040000
W40392                                                                  06050000
W40392          MOVE 'GET CURR PO COUNT FOR TRLR'                       06060000
W40392                                    TO PV-DB2-OPERATION-MESSAGE-1 06070000
W40392          MOVE 'TSHPTPO '     TO PV-DB2-TABLE-NAME1               06080000
W40392          PERFORM Z999A-SQL-ABEND                                 06090000
W40392      END-EVALUATE.                                               06100000
W40392                                                                  06110000
042000***************************************************************** 06120000
042100** COUNT OF CARTONS SCANNED , COUNT ON TSHUNLO WHICH IS           06130000
042200** NOT THE SAME AS THE NUMBER CARTONS MANIFESTED                  06140000
042300***************************************************************** 06150000
042400                                                                  06160000
042500 4200-CARTON-SCANNED.                                             06170000
042600      MOVE '4200-CARTON-SCANNED  ' TO PV-PARAGRAPH-NAME.          06180000
042700      MOVE PC068-TRIP-ID     TO DK-TRIP-ID.                       06190000
042800      MOVE PC068-PO-NBR      TO DK-PO-NBR.                        06200000
042900      MOVE PC068-REC-SEQ-NBR TO DK-REC-SEQ-NBR.                   06210000
043000      MOVE PC068-PO-LNE-NBR  TO DK-LINE-NBR.                      06220000
043100      MOVE +0                TO PV-SCAN-COUNT.                    06230000
043200                                                                  06240000
043300      EXEC SQL                                                    06250000
043400          SELECT COUNT(DISTINCT(F.SHIPT_UNT_ID))                  06260000
043500          INTO  :PV-SCAN-COUNT                                    06270000
043600          FROM   TSHPTPO B                                        06280000
043700                ,TPKSLIP C                                        06290000
043800                ,TINPKSU D                                        06300000
043900                ,TSHPUNT F                                        06310000
044000                ,TSHUUPC G                                        06320000
044100          WHERE B.PO_NBR         = :DK-PO-NBR                     06330000
044200            AND B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                06340000
044300            AND B.PO_NBR         = C.PO_NBR                       06350000
044400            AND B.REC_SEQ_NBR    = C.REC_SEQ_NBR                  06360000
044500            AND B.PRIM_SHIPT_IND = 'Y'                            06370000
044600            AND C.VER_STAT_CDE   = 'A'                            06380000
044700            AND B.PO_NBR         = D.PO_NBR                       06390000
044800            AND D.SEQ_NBR        = C.SEQ_NBR                      06400000
044900            AND D.SHIPT_UNT_ID   = F.SHIPT_UNT_ID                 06410000
045000            AND F.SHIPT_UNT_ID   = G.SHIPT_UNT_ID                 06420000
045100            AND G.TRN_LNE_NBR    = :DK-LINE-NBR                   06430000
045200            AND NOT EXISTS                                        06440000
045300             (SELECT *                                            06450000
045400                FROM TSHUNLO E                                    06460000
045500               WHERE  E.SHIPT_UNT_ID   = D.SHIPT_UNT_ID           06470000
045600                 AND  E.ACTV_CDE       = 'A'                      06480000
045700                 AND  E.TRIP_ID        = :DK-TRIP-ID              06490000
045800                 AND  E.SCN_LOC_ID     = 'RECV')                  06500000
045810           WITH UR                                                06510000
045900      END-EXEC                                                    06520000
046000                                                                  06530000
046100      EVALUATE TRUE                                               06540000
046200        WHEN SQLCODE = ZERO                                       06550000
046300          CONTINUE                                                06560000
046400        WHEN SQLCODE = +100                                       06570000
046500           MOVE +0 TO PV-SCAN-COUNT                               06580000
046600        WHEN SQLWARN0 NOT = SPACES                                06590000
046700        WHEN SQLCODE NOT = ZERO                                   06600000
046800          MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     06610000
046900          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          06620000
047000          MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID         06630000
047100                                                                  06640000
047200          MOVE 'GET CARTONS SCANNED COUNT '                       06650000
047300                                    TO PV-DB2-OPERATION-MESSAGE-1 06660000
047400          MOVE 'TSHUNLO '     TO PV-DB2-TABLE-NAME1               06670000
047500          PERFORM Z999A-SQL-ABEND                                 06680000
047600      END-EVALUATE.                                               06690000
047700***************************************************************** 06700000
047800** COUNT OF CARTONS SCANNED-PBS , COUNT ON TSHUNLO WHICH IS       06710000
047900** NOT THE SAME AS THE NUMBER CARTONS MANIFESTED                  06720000
048000***************************************************************** 06730000
048100                                                                  06740000
048200 4300-CARTON-SCANNED-PBS.                                         06750000
048300      MOVE '4300-CARTON-SCANNED-PBS ' TO PV-PARAGRAPH-NAME.       06760000
048400      MOVE PC068-TRIP-ID     TO DK-TRIP-ID.                       06770000
048500      MOVE PC068-PO-NBR      TO DK-PO-NBR.                        06780000
048600      MOVE PC068-REC-SEQ-NBR TO DK-REC-SEQ-NBR.                   06790000
048700      MOVE +0                TO PV-SCAN-COUNT.                    06800000
048800                                                                  06810000
048900                                                                  06820000
049000      EXEC SQL                                                    06830000
049100          SELECT COUNT(DISTINCT(F.SHIPT_UNT_ID))                  06840000
049200          INTO  :PV-SCAN-COUNT                                    06850000
049300          FROM   TSHPTPO B                                        06860000
049400                ,TPKSLIP C                                        06870000
049500                ,TINPKSU D                                        06880000
049600                ,TSHPUNT F                                        06890000
049700                ,TSHUUPC G                                        06900000
049800          WHERE B.PO_NBR         = :DK-PO-NBR                     06910000
049900            AND B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                06920000
050000            AND B.PO_NBR         = C.PO_NBR                       06930000
050100            AND B.REC_SEQ_NBR    = C.REC_SEQ_NBR                  06940000
050200            AND B.PRIM_SHIPT_IND = 'Y'                            06950000
050300            AND C.VER_STAT_CDE   = 'A'                            06960000
050400            AND B.PO_NBR         = D.PO_NBR                       06970000
050500            AND D.SEQ_NBR        = C.SEQ_NBR                      06980000
050600            AND D.SHIPT_UNT_ID   = F.SHIPT_UNT_ID                 06990000
050700            AND F.SHIPT_UNT_ID   = G.SHIPT_UNT_ID                 07000000
050800            AND NOT EXISTS                                        07010000
050900             (SELECT *                                            07020000
051000                FROM TSHUNLO E                                    07030000
051100               WHERE  E.SHIPT_UNT_ID   = D.SHIPT_UNT_ID           07040000
051200                 AND  E.ACTV_CDE       = 'A'                      07050000
051300                 AND  E.TRIP_ID        = :DK-TRIP-ID              07060000
051400                 AND  E.SCN_LOC_ID     = 'RECV')                  07070000
051410           WITH UR                                                07080000
051500      END-EXEC                                                    07090000
051600                                                                  07100000
051700      EVALUATE TRUE                                               07110000
051800        WHEN SQLCODE = ZERO                                       07120000
051900          CONTINUE                                                07130000
052000        WHEN SQLCODE = +100                                       07140000
052100           MOVE +0 TO PV-SCAN-COUNT                               07150000
052200        WHEN SQLWARN0 NOT = SPACES                                07160000
052300        WHEN SQLCODE NOT = ZERO                                   07170000
052400          MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     07180000
052500          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          07190000
052600          MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID         07200000
052700                                                                  07210000
052800          MOVE 'GET CARTONS SCANNED COUNT -PBS '                  07220000
052900                                    TO PV-DB2-OPERATION-MESSAGE-1 07230000
053000          MOVE 'TSHUNLO '     TO PV-DB2-TABLE-NAME1               07240000
053100          PERFORM Z999A-SQL-ABEND                                 07250000
053200      END-EVALUATE.                                               07260000
053300***************************************************************** 07270000
053301 4400-SELECT-SET-DVRT-COUNTS.                                     07280000
053302      MOVE '4400-SELECT-SET-DVRT-COUNTS ' TO PV-PARAGRAPH-NAME.   07290000
053304      MOVE PC068-PO-NBR      TO DK-PO-NBR.                        07300000
053305      MOVE +0                TO PV-SEASET-COUNT                   07310000
053307      SET PS-SEASET-DIVERT-PO-NO TO TRUE                          07320000
053308                                                                  07330000
053309      EXEC SQL                                                    07340000
053310          SELECT                                                  07350000
053313                COUNT(*)                                          07360000
053314          INTO :PV-SEASET-COUNT                                   07370000
053315          FROM                                                    07380000
053316              TPURCHS A                                           07390000
053317            , TSEASET B                                           07400000
053318          WHERE  PO_NBR           = :DK-PO-NBR                    07410000
053319            AND A.SEASET_YR      = B.SEASET_YR                    07420000
053320            AND A.SEASET_SHRT_NM = B.SEASET_SHRT_NM               07430000
053321            AND A.VER_STATUS_CDE = 'A'                            07440000
053322            AND DIVERT_PFX_NBR  >  0                              07450000
053323            AND CURRENT DATE    <  STR_RLSE_END_DTE               07460000
053324           WITH UR                                                07470000
053347      END-EXEC                                                    07480000
053348                                                                  07490000
053349      EVALUATE TRUE                                               07500000
053350        WHEN SQLCODE = ZERO                                       07510000
053351            IF PV-SEASET-COUNT > 0                                07520000
053352               SET PS-SEASET-DIVERT-PO-YES TO TRUE                07530000
053353            END-IF                                                07540000
053355        WHEN SQLWARN0 NOT = SPACES                                07550000
053356        WHEN SQLCODE NOT = ZERO                                   07560000
053357          MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     07570000
053358          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          07580000
053359          MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID         07590000
053360                                                                  07600000
053361          MOVE 'GET CHECK FOR SEASONAL SET     '                  07610000
053362                                    TO PV-DB2-OPERATION-MESSAGE-1 07620000
053363          MOVE 'TSEASET '     TO PV-DB2-TABLE-NAME1               07630000
053364          PERFORM Z999A-SQL-ABEND                                 07640000
053365      END-EVALUATE.                                               07650000
053366***************************************************************** 07660000
053370***************************************************************** 07670000
053438***************************************************************** 07680000
053440                                                                  07690000
      *SB 01/10/14 - BEGIN PR#5148D                                     07690100
       5000-CHECK-RFID-STATUS.                                          07691000
                                                                        07692000
           EXEC SQL                                                     07693000
                SELECT B.TYP_CDE                                        07694000
                INTO  :VNDAGR-TYP-CDE                                   07695000
                FROM   TENTNME  A,                                      07696000
                       TVNDAGR  B                                       07697000
                WHERE  B.AGRMT_TYP_ID = '4'                             07698000
                AND    B.TYP_CDE IN (11,12)                             07699000
                AND    B.ENT_ID = :PC068-ENT-ID                         07699100
                AND    B.EFFECTIVE_DATE <= CURRENT DATE                 07699200
                AND    B.EXPIRATION_DATE > CURRENT DATE                 07699300
                AND    A.SEQ_NBR = 1                                    07699400
                AND    B.DEPT_NBR = :PC068-DEPT-NBR                     07699500
                AND    B.ENT_ID = A.ENT_ID                              07699600
           END-EXEC.                                                    07699700
                                                                        07699800
           EVALUATE TRUE                                                07699900
             WHEN SQLCODE = ZERO                                        07700000
                  IF VNDAGR-TYP-CDE = 11                                07700100
                     MOVE 'T'         TO PC068-RFID-STATUS              07700200
                  ELSE                                                  07700300
                     MOVE 'C'         TO PC068-RFID-STATUS              07700400
                  END-IF                                                07700500
             WHEN OTHER                                                 07700600
                 MOVE 'N'             TO PC068-RFID-STATUS              07700700
           END-EVALUATE.                                                07700800
      *SB 01/10/14 - END   PR#5148D                                     07700900
                                                                        07701000
053500 7000-READ-INPUT-FILE.                                            07702000
053600***************************************************************** 07710000
053700      READ INPUT-FILE INTO PV-TEMP-PCRD068                        07720000
053800        AT END                                                    07730000
053900           SET PS-END-OF-INPUT-FILE TO TRUE                       07740000
054000        NOT AT END                                                07750000
054100           ADD +1 TO PV-READ-COUNT                                07760000
      *SB 01/15/14 - BEGIN PR#5148D                                     07760100
                 INITIALIZE PC068-RFID-AUD-CRTNS-LINE                   07761000
                            PC068-RFID-AUD-CRTNS-LINE-U                 07762000
                            PC068-RFID-AUD-CRTNS-100-PO                 07763000
                            PC068-RFID-UNITS-TO-AUDIT                   07764000
                            PC068-RFID-PROMPTED-LINES                   07765000
                            PC068-RFID-VENDOR-RANKING                   07766000
                            PC068-RFID-MIN-CRTN-CHECK                   07767000
                            PC068-RFID-MAX-CRTN-CHECK                   07768000
                            PC068-RFID-PCNT-TO-AUDIT                    07769000
                            PC068-RFID-PREV-AUD-FAIL                    07769100
                            PC068-RFID-AUD-COMPLETE                     07769200
      *SB 01/15/14 - END PR#5148D                                       07769300
054200      END-READ.                                                   07770000
054300***************************************************************** 07780000
054400***************************************************************** 07790000
054500 8000-WRITE-TO-DTL-FILE.                                          07800000
054600***************************************************************** 07810000
054700     WRITE EXTRACT-DTL-RECORD                                     07820000
054800       FROM PC068-RECORD-LAYOUT.                                  07830000
054900                                                                  07840000
055000     ADD +1 TO PV-WRITE-PBS-EXTR-COUNT.                           07850000
055100                                                                  07860000
055101***************************************************************** 07870000
055102**CHECK PARM TO DETERMINE IF RC SHOULD BE PASSED TO NOT           07880000
055103**CREATE INBOUND FORECAST DETAIL REPORT                           07890000
055104***************************************************************** 07900000
055110 8900-CHECK-PARM-DETAIL-REPORT.                                   07910000
055111     MOVE   PC068-OPER-UNT-ID  TO KRPRPM-LOC-ID.                  07920000
055120     EXEC SQL                                                     07930000
055130         SELECT FUNC_TXT                                          07940000
055140           INTO :KRPRPM-FUNC-TXT                                  07950000
055150           FROM TKRPRPM                                           07960000
055170          WHERE LOC_ID            = :KRPRPM-LOC-ID                07970000
055180            AND FUNC_PRC_STAT_CDE = 'AC'                          07980000
055190            AND SYS_PRC_FUNC_CDE  = 'INFRDT'                      07990000
055191           WITH UR                                                08000000
055192     END-EXEC.                                                    08010000
055193                                                                  08020000
055194     EVALUATE TRUE                                                08030000
055195         WHEN SQLCODE = ZERO                                      08040000
055196             IF KRPRPM-FUNC-TXT = 'N'                             08050000
055197                MOVE 4095 TO RETURN-CODE                          08060000
055198             END-IF                                               08070000
055199         WHEN SQLCODE = +100                                      08080000
055200             CONTINUE                                             08090000
055201         WHEN SQLWARN0 NOT = SPACE                                08100000
055202         WHEN SQLCODE  NOT = ZERO                                 08110000
055207             MOVE PC068-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID  08120000
055208             MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR       08130000
055209             MOVE DK-TRIP-ID           TO PV-DISPLAY-TRIP-ID      08140000
055211             MOVE 'SELECT TXT QTY'   TO PV-DB2-OPERATION-MESSAGE-108150000
055213             MOVE 'TKRPRPM '     TO PV-DB2-TABLE-NAME1            08160000
055214             PERFORM Z999A-SQL-ABEND                              08170000
055215     END-EVALUATE.                                                08180000
055220***************************************************************** 08190000
055300 9000-CLOSE-FILES.                                                08200000
055400                                                                  08210000
055500     DISPLAY ' '.                                                 08220000
055600     DISPLAY '**************************************************'.08230000
055700     DISPLAY 'PROGRAM.................'   PC-PROGRAM-NAME.        08240000
055800     DISPLAY ' '.                                                 08250000
055900     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      08260000
056000     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      08270000
056100     DISPLAY ' '.                                                 08280000
056110     DISPLAY 'RETURN CODE        = ' RETURN-CODE                  08290000
056200                                                                  08300000
056300     MOVE PV-WRITE-PBS-EXTR-COUNT     TO PV-DISPLAY-WRITE-PBS-CNT.08310000
056400     DISPLAY 'TOT AUDIT EXT WRITTEN: '   PV-DISPLAY-WRITE-PBS-CNT.08320000
056500                                                                  08330000
057000                                                                  08340000
057100     CLOSE INPUT-FILE                                             08350000
057200           EXTRACT-PO-DTL-FILE.                                   08360000
057300                                                                  08370000
057400***************************************************************** 08380000
057500 Z999-SQL-ABEND.                                                  08390000
057600***************************************************************** 08400000
057700     MOVE PC259-SQL-CODE              TO PV-DISPLAY-SQLCODE.      08410000
057800     MOVE PC259-SQLCA  TO SQLCA                                   08420000
057900     DISPLAY '** ABEND **         ** = SQLERROR'.                 08430000
058000     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             08440000
058100     DISPLAY '** OPER UNIT ID ** = ' PV-DISPLAY-OPER-UNT-ID       08450000
058200     DISPLAY '** TRIP ID      ** = ' PV-DISPLAY-TRIP-ID.          08460000
058300     DISPLAY '** PO NBR       ** = ' PV-DISPLAY-PO-NBR.           08470000
058400     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     08480000
058500     DISPLAY '** LINE NUMBER  ** = ' PV-DISPLAY-PO-LNE-NBR        08490000
058600     DISPLAY '** PACK ID      ** = ' PV-DISPLAY-PACK-ID           08500000
058700     DISPLAY '** PARAGRAPH ** = ' PC259-ERROR-PARA-NBR.           08510000
058800     DISPLAY '** DB2 TABLE ** = ' PC259-ERROR-TABLE-NME           08520000
058900     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE              08530000
059000                                                                  08540000
059100     MOVE +4013                  TO PV-ABEND-CODE.                08550000
059200***************************************************************** 08560000
059300 Z999A-SQL-ABEND.                                                 08570000
059400***************************************************************** 08580000
059500     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      08590000
059600     DISPLAY '** ABEND **         ** = SQLERROR'.                 08600000
059700     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             08610000
059800     DISPLAY '** '  PV-DB2-OPERATION-MESSAGE-1                    08620000
059900     DISPLAY '** OPER UNIT ID ** = ' PV-DISPLAY-OPER-UNT-ID       08630000
060000     DISPLAY '** TRIP ID      ** = ' PV-DISPLAY-TRIP-ID.          08640000
060100     DISPLAY '** SCAC         ** = ' DK-SCAC.                     08650000
060200     DISPLAY '** TRAILER      ** = ' DK-TRAILER.                  08660000
060300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME               08670000
060400     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1              08680000
060500     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE              08690000
060600                                                                  08700000
060700     MOVE +4013                  TO PV-ABEND-CODE.                08710000
