       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.             DAKUT302.                                00030000
       AUTHOR.                 BOB MCASEY.                              00040000
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
       DATE-WRITTEN.           JUNE 2000.                               00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ***************************************************************** 00090000
      *  PROGRAM NARRATIVE:                                           * 00100000
      *  THIS PROGRAM READS AN EXTRACT FROM THE DEBIT ALLOWANCE ORACLE* 00110000
      *  ONLINE APPLICATION AND CREATES ML PRICE CHANGE TRANSACTIONS. * 00120000
      *  IT ALSO CREATES AN ADDITIONAL DEBIT ALLOWANCE FILE USED      * 00130000
      *  FURTHER ALONG IN DAK001.  THIS FILE HAS THE BATCH NUMBER     * 00140000
      *  APPENDED TO IT.                                              * 00150000
      ***************************************************************** 00160000
      *    WR/PITS#     DATE        DESCRIPTION                         00170000
      *    --------   ----------   ---------------------------------    00180000
0701RM*   WR22467     07/20/2001   CHANGED RECORD LENGTH OF AP TRANS    00190000
      *                            FILE AND ALL PROCESSING ASSOCIATE    00200000
      *   WR23724     05/15/2002   RECOMPILED FOR CHANGES IN COPYBOOK   00210000
      *                            APRD045                              00220000
21732 *   21732       04/24/2003   MLRD017 ENHANCEMENT FOR              00230000
21732 *                            ML017-PC-LINE-NBR -ROD JANSSEN       00240000
22405 * 22405  05-31-2001 R JANSSEN  DAII - ASSET RECOVERY ENHANCEMENT  00250000
      *W26601  04-20-2004 S JACKSON  STORE NUMBER EXPANSION EFFORT.     00260000
      *                              MLRD017 EXPANDED TO 120 BYTES.     00270000
W29145*W29145  11-20-2005 S JACKSON  SAS MARKDOWN OPTIMIZATION EFFORT.  00280000
W29145*                              MLRD017 EXPANDED TO 200 BYTES.     00290000
W28582*W28582  11-22-2005 C MCCAMMON DEBIT ALLOWANCE/ADD BRAND (SHORT)  00300000
W28582*                              DATAMAP AP045-DOC-NBR & AP-TRN-CDE.00310000
PM3403*PM3403  04-20-2012 S JACKSON  RECOMPILE FOR LARGE RETAIL PROJECT 00320000
PM3403*                              EXPANDS MLRD017 PRICE/DIFF AMTS    00330000
      ******************************************************************00340000
                                                                        00350000
       ENVIRONMENT DIVISION.                                            00360000
       CONFIGURATION SECTION.                                           00370000
       SOURCE-COMPUTER.                        IBM-3090.                00380000
       OBJECT-COMPUTER.                        IBM-3090.                00390000
       INPUT-OUTPUT SECTION.                                            00400000
       FILE-CONTROL.                                                    00410000
                                                                        00420000
           SELECT AP-TRANS-FILE             ASSIGN TO INP01.            00430000
           SELECT FISCAL-WEEK-FILE          ASSIGN TO INP02.            00440000
           SELECT ML-TRANS-FILE             ASSIGN TO OUT01.            00450000
                                                                        00460000
       DATA DIVISION.                                                   00470000
       FILE SECTION.                                                    00480000
      *                                                                 00490000
       FD  AP-TRANS-FILE                                                00500000
           LABEL RECORDS ARE STANDARD                                   00510000
           RECORDING MODE IS F                                          00520000
           BLOCK CONTAINS 0 RECORDS.                                    00530000
0701RM*01  AP-TRANS-RECORD               PIC X(450).                    00540000
0701RM 01  AP-TRANS-RECORD               PIC X(550).                    00550000
                                                                        00560000
       FD  FISCAL-WEEK-FILE                                             00570000
           RECORDING MODE IS F                                          00580000
           LABEL RECORDS ARE STANDARD                                   00590000
           BLOCK CONTAINS 0 RECORDS.                                    00600000
       01  CONTROL-CARD-RECORD           PIC X(50).                     00610000
                                                                        00620000
       FD  ML-TRANS-FILE                                                00630000
           RECORDING MODE IS F                                          00640000
           LABEL RECORDS ARE STANDARD                                   00650000
           BLOCK CONTAINS 0 RECORDS.                                    00660000
21732 *01  ML-TRANS-RECORD               PIC X(100).                    00670000
W26601*01  ML-TRANS-RECORD               PIC X(120).                    00680000
W29145 01  ML-TRANS-RECORD               PIC X(200).                    00690000
                                                                        00700000
      /**************************************************************** 00710000
       WORKING-STORAGE SECTION.                                         00720000
      ***************************************************************** 00730000
                                                                        00740000
       01  PA-PROGRAM-ACCUMULATORS.                                     00750000
           05  PA-IN-COUNT             PIC S9(09) COMP-3 VALUE 0.       00760000
           05  PA-TOTAL-READ           PIC S9(09) COMP-3 VALUE 0.       00770000
           05  PA-ML-TOTAL-WRITTEN     PIC S9(09) COMP-3 VALUE 0.       00780000
                                                                        00790000
       01  PC-CONSTANTS.                                                00800000
           05  PC-F2                   PIC  X(02)     VALUE 'F2'.       00810000
           05  PC-ALPHA-ZEROES         PIC  X(03)     VALUE '000'.      00820000
           05  PC-ALPHA-NINES          PIC  X(03)     VALUE '999'.      00830000
22405      05  PC-ASST-RECOV-501       PIC  X(03)     VALUE '501'.      00840000
           05  PC-DAK001-JOB           PIC  X(06)     VALUE 'DAK001'.   00850000
           05  PC-DPKUT500-PGM         PIC  X(08)     VALUE 'DPKUT500'. 00860000
           05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'DAKUT302'. 00870000
           05  PC-QTY-1                PIC  9(03)     VALUE 1.          00880000
           05  PC-NUM-ZEROES           PIC  9(03)     VALUE 000.        00890000
      *    05  PC-400                  PIC  9(03)     VALUE 400.        00900000
W26601     05  PC-400                  PIC  9(05)     VALUE 00400.      00910000
           05  PC-POS-MAX              PIC S9(04)V99  VALUE +9999.99.   00920000
           05  PC-NEG-MAX              PIC S9(04)V99  VALUE -9999.99.   00930000
                                                                        00940000
       01  PS-SWITCHES.                                                 00950000
           05  PS-EOF-EXTRACT-SWITCH   PIC X(01)      VALUE 'N'.        00960000
               88  PS-EOF-EXTRACT                     VALUE 'Y'.        00970000
           05  PS-END-OF-RTL-AMTS-SW   PIC X(01)      VALUE 'N'.        00980000
               88  PS-END-OF-RTL-AMTS                 VALUE 'Y'.        00990000
                                                                        01000000
       01  ABEND-CODE                  PIC S9(04)     VALUE ZERO        01010000
                                                       COMP SYNC.       01020000
       01  PV-VARIABLES.                                                01030000
           05  PV-PREV-DEPT-NBR        PIC X(03)      VALUE SPACES.     01040000
           05  PV-BTCH-SRC-CDE         PIC X(03)      VALUE SPACES.     01050000
           05  PV-EFF-DTE-TIME.                                         01060000
               10  PV-EFF-DTE.                                          01070000
                   15  PV-EFF-CC       PIC X(02).                       01080000
                   15  PV-EFF-YY       PIC X(02).                       01090000
                   15  FILLER          PIC X(01).                       01100000
                   15  PV-EFF-MM       PIC X(02).                       01110000
                   15  FILLER          PIC X(01).                       01120000
                   15  PV-EFF-DD       PIC X(02).                       01130000
1000RM*        10  PV-EFF-TIME         PIC X(09).                       01140000
           05  PV-EFF-DTE2             PIC X(10).                       01150000
           05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACES.     01160000
           05  PV-OPERATION-ATTEMPTED  PIC X(40)      VALUE SPACES.     01170000
           05  PV-ABEND-MESSAGE        PIC X(75)      VALUE SPACES.     01180000
           05  PV-CENPPC-NBR           PIC  9(07)     VALUE 0.          01190000
           05  PV-CENPPC-NBR-7  REDEFINES PV-CENPPC-NBR.                01200000
22405          10  PV-CENPPC-NBR-7-X.                                   01210000
22405              15  PV-CENPPC-AR-TRN PIC X(01).                      01220000
22405                  88  PV-CENPPC-ASSET-RECOVERY  VALUE '5'.         01230000
22405              15  FILLER           PIC X(01).                      01240000
               10  PV-CENPPC-NBR-5     PIC  X(05).                      01250000
           05  PV-ENT-ID               PIC S9(09)    COMP   VALUE 0.    01260000
           05  PV-STMT-DTL-SEQ-NBR     PIC S9(05)    COMP-3 VALUE 0.    01270000
           05  PV-TOTAL-CHARGES        PIC S9(09)V99 COMP-3 VALUE 0.    01280000
           05  PV-TOTAL-CREDITS        PIC S9(09)V99 COMP-3 VALUE 0.    01290000
           05  PV-TOTAL-CREDIT-AMT     PIC S9(09)V99 COMP-3 VALUE 0.    01300000
           05  PV-TOTAL-RTL            PIC S9(09)V99 COMP-3 VALUE 0.    01310000
           05  PV-NET-AMT              PIC S9(09)V99 COMP-3 VALUE 0.    01320000
           05  PV-TOTAL-RTL-AMT        PIC S9(09)V99 COMP-3 VALUE 0.    01330000
           05  PV-PREV-ENT-ID          PIC S9(10) VALUE 0.              01340000
           05  PV-CALC-CUR-RTL         PIC S9(11)V99 COMP-3 VALUE 0.    01350000
           05  PV-DISP-NUMBER          PIC Z,ZZZ,ZZ9.                   01360000
21732      05  PV-EDIT-SKU-NBR.                                         01370000
21732          10  PV-EDIT-DEPT         PIC X(03).                      01380000
21732          10  PV-EDIT-CLASS        PIC X(02).                      01390000
21732          10  PV-EDIT-SEQ          PIC X(03).                      01400000
21732      05  PV-EDIT-SUB-CLASS.                                       01410000
21732          10  PV-EDIT-SUB-CLASS-B1 PIC X(01).                      01420000
21732          10  PV-EDIT-SUB-CLASS-B2 PIC X(01).                      01430000
                                                                        01440000
      ***************************************************************** 01450000
      *  INPUT/OUTPUT AP RECORD (AND THEN SOME)                       * 01460000
      ***************************************************************** 01470000
           COPY APRD045.                                                01480000
           05  PV-APRD045-BATCH-NBR    PIC X(03).                       01490000
           05  PV-APRD045-CENPPC-NBR   PIC S9(07)    COMP-3.            01500000
           05  PV-APRD045-RTL-AMT      PIC S9(09)V99 COMP-3.            01510000
           05  PV-APRD045-NET-CST-AMT  PIC S9(09)V99 COMP-3.            01520000
           05  PV-APRD045-EFF-DTE      PIC X(19).                       01530000
           05  FILLER                  PIC X(12).                       01540000
      ****************************************************************  01550000
      * RECORD LAYOUT FOR CONTROL CARD FILE.                            01560000
      ****************************************************************  01570000
       01  CC-CONTROL-CARD.                                             01580000
           05  CC-CTL-DTE                   PIC X(10).                  01590000
           05  CC-CTL-FILLER                PIC X(70).                  01600000
                                                                        01610000
      ***************************************************************** 01620000
      *  INPUT RECORD FORMAT                                          * 01630000
      ***************************************************************** 01640000
           COPY DARD104.                                                01650000
                                                                        01660000
      ***************************************************************** 01670000
      *  MERCHANDISE LEDGER TRANSACTION RECORD LAYOUT                 * 01680000
      ***************************************************************** 01690000
21732      COPY MLRD017.                                                01700000
                                                                        01710000
      *---------------------------------------------------------------* 01720000
      *  VENDOR DEPARTMENT INHOUSE TABLE                              * 01730000
      *---------------------------------------------------------------* 01740000
           EXEC SQL                                                     01750000
               INCLUDE TVNDDPT                                          01760000
           END-EXEC.                                                    01770000
                                                                        01780000
      *---------------------------------------------------------------* 01790000
      *  M/L DATE ATTRIBUTE TABLE                                     * 01800000
      *---------------------------------------------------------------* 01810000
           EXEC SQL                                                     01820000
               INCLUDE TDTATTR                                          01830000
           END-EXEC.                                                    01840000
                                                                        01850000
      *---------------------------------------------------------------* 01860000
      *    SQL COMMUNICATIONS AREA DCLGEN                             * 01870000
      *---------------------------------------------------------------* 01880000
           EXEC SQL                                                     01890000
               INCLUDE SQLCA                                            01900000
           END-EXEC.                                                    01910000
                                                                        01920000
      *---------------------------------------------------------------* 01930000
      *  ERROR MESSAGE AREA FOR DB2                                   * 01940000
      *---------------------------------------------------------------* 01950000
           COPY DPWS004.                                                01960000
                                                                        01970000
                                                                        01980000
       PROCEDURE DIVISION.                                              01990000
                                                                        02000000
       0000-DAKUT302.                                                   02010000
                                                                        02020000
           PERFORM 1000-INITIALIZE                                      02030000
                                                                        02040000
           PERFORM 2000-PROCESS-EXTRACT                                 02050000
               UNTIL PS-EOF-EXTRACT.                                    02060000
                                                                        02070000
           PERFORM 9000-EOJ.                                            02080000
                                                                        02090000
           GOBACK.                                                      02100000
                                                                        02110000
                                                                        02120000
       1000-INITIALIZE.                                                 02130000
                                                                        02140000
           DISPLAY '**------ BEGIN DAKUT302 ------**'.                  02150000
           OPEN INPUT  AP-TRANS-FILE                                    02160000
                INPUT  FISCAL-WEEK-FILE.                                02170000
           OPEN OUTPUT ML-TRANS-FILE.                                   02180000
                                                                        02190000
           PERFORM 8000-READ-EXTRACT.                                   02200000
                                                                        02210000
           IF PS-EOF-EXTRACT                                            02220000
               DISPLAY '*--------------------------------*'             02230000
               DISPLAY 'NO DA INPUT -- OUT01 WILL BE EMPTY'             02240000
               DISPLAY '*--------------------------------*'             02250000
           ELSE                                                         02260000
               PERFORM 8200-READ-DATE-FILE                              02270000
           END-IF.                                                      02280000
                                                                        02290000
                                                                        02300000
      ******************************************************************02310000
      * THIS PARAGRAPH CONTTOLS THE PROCESSING OF INPUT AND OUTPUT      02320000
      ******************************************************************02330000
       2000-PROCESS-EXTRACT.                                            02340000
                                                                        02350000
           PERFORM 2050-BUILD-OUTPUT-FIELDS.                            02360000
                                                                        02370000
           PERFORM 8000-READ-EXTRACT.                                   02380000
                                                                        02390000
       2050-BUILD-OUTPUT-FIELDS.                                        02400000
                                                                        02410000
21732      INITIALIZE ML017-PRICE-CHANGE-RECORD.                        02420000
                                                                        02430000
      * - DOCUMENT NUMBERS                                              02440000
           MOVE PV-APRD045-CENPPC-NBR TO PV-CENPPC-NBR.                 02450000
21732      MOVE PV-CENPPC-NBR-7       TO ML017-PC-DOC-7-NBR-PIC9.       02460000
21732      MOVE PV-CENPPC-NBR-5       TO ML017-PC-DOC-5-NBR.            02470000
                                                                        02480000
22405 * - DEFINE THE TYPE OF PROCE CHANGE TO PROCESS.                   02490000
22405      IF PV-CENPPC-ASSET-RECOVERY                                  02500000
22405        SET ML017-MKDOWN                                           02510000
22405            ML017-MARKDOWN-CANCEL                                  02520000
22405            ML017-RC-MISCELLANEOUS                                 02530000
22405            ML017-STORE-MKDN-MKON    TO TRUE                       02540000
22405      ELSE                                                         02550000
21732        SET ML017-MKDOWN                                           02560000
21732            ML017-MARKDOWN-CANCEL                                  02570000
21732            ML017-RC-MISCELLANEOUS                                 02580000
21732            ML017-BUYER-MKDN-MKON    TO TRUE                       02590000
22405      END-IF.                                                      02600000
                                                                        02610000
21732 * - ML017-DATE STUFF                                              02620000
           MOVE DA104-OPN-FSCL-WK-DTE TO PV-EFF-DTE-TIME.               02630000
21732      MOVE PV-EFF-MM             TO ML017-PC-DTE-MM.               02640000
           MOVE PV-EFF-DTE            TO PV-EFF-DTE2.                   02650000
21732      MOVE DA104-OPN-FSCL-MN-NBR TO ML017-PC-KOHLS-MM.             02660000
                                                                        02670000
21732      MOVE PV-EFF-DD             TO ML017-PC-DTE-DD.               02680000
                                                                        02690000
21732 * - ML017-PC-SKU                                                  02700000
21732      MOVE AP045-DEPT-NBR        TO PV-EDIT-DEPT.                  02710000
21732      MOVE AP045-CL-NBR          TO PV-EDIT-CLASS.                 02720000
21732      MOVE PC-ALPHA-ZEROES       TO PV-EDIT-SEQ.                   02730000
21732      MOVE PV-EDIT-SKU-NBR       TO ML017-PC-SKU.                  02740000
                                                                        02750000
21732 * - ML017-PC-MAJ-CLASS                                            02760000
21732      MOVE AP045-DEPT-NBR        TO ML017-PC-DEPT-NBR.             02770000
21732      MOVE AP045-CL-NBR          TO ML017-PC-CLASS-NBR.            02780000
21732      MOVE AP045-CL-NBR          TO PV-EDIT-SUB-CLASS.             02790000
21732      STRING '00' DELIMITED BY SIZE                                02800000
21732             PV-EDIT-SUB-CLASS-B1 DELIMITED BY SIZE                02810000
21732             '0' DELIMITED BY SIZE                                 02820000
21732                                 INTO ML017-PC-MAJ-CLASS.          02830000
21732                                                                   02840000
22405 *-- MKDN/MKUP REASON CODE.                                        02850000
21732      MOVE PC-ALPHA-NINES        TO ML017-PC-MKDN-MKUP-RSN-CDE.    02860000
22405      IF PV-CENPPC-ASSET-RECOVERY                                  02870000
22405          MOVE PC-ASST-RECOV-501 TO ML017-PC-MKDN-MKUP-RSN-CDE     02880000
22405      END-IF.                                                      02890000
22405                                                                   02900000
21732 *    MOVE AP045-STR-NBR (3:3)   TO ML017-PC-STORE-NBR.            02910000
W26601     MOVE AP045-STR-NBR         TO ML017-PC-STORE-NBR.            02920000
                                                                        02930000
      *-- CREATE BATCH NUMBER                                           02940000
21732      MOVE PV-APRD045-BATCH-NBR  TO ML017-PC-BATCH-NBR.            02950000
                                                                        02960000
      *-- RETRIEVE INHOUSE NUMBER                                       02970000
           IF AP045-ENT-ID = PV-PREV-ENT-ID                             02980000
              AND                                                       02990000
              AP045-DEPT-NBR = PV-PREV-DEPT-NBR                         03000000
               CONTINUE                                                 03010000
           ELSE                                                         03020000
               PERFORM 7200-GET-TNVDDPT-INHSE-NBR                       03030000
               MOVE AP045-ENT-ID       TO PV-PREV-ENT-ID                03040000
               MOVE AP045-DEPT-NBR     TO PV-PREV-DEPT-NBR              03050000
           END-IF.                                                      03060000
21732      MOVE VNDDPT-INHOUSE-NBR     TO ML017-PC-VENDOR-INHSE-NMBR.   03070000
W26601     MOVE AP045-ENT-ID           TO ML017-PC-ENT-ID.              03080000
W28582     MOVE AP045-DOC-NBR          TO ML017-PC-DOC-16-NBR.          03090000
W28582     MOVE AP045-AP-TRN-CDE       TO ML017-PC-AP-TRANS-CDE.        03100000
                                                                        03110000
21732      MOVE PC-QTY-1               TO ML017-PC-QTY                  03120000
21732                                     ML017-PC-TOT-DOC-QTY.         03130000
                                                                        03140000
      *-- INITITALIZE POS FIELDS FOR MBS AND POS REGISTER INFORMATION   03150000
W26601     MOVE ZEROES                 TO ML017-POS-NBR.                03160000
W26601     MOVE SPACES                 TO ML017-GMM                     03170000
W26601                                    ML017-DMM                     03180000
W26601                                    ML017-BUYER.                  03190000
      *                                                                 03200000
      *-- COMPUTE RETAIL AMOUNT                                         03210000
           IF (PV-APRD045-RTL-AMT < PC-NEG-MAX)                         03220000
           OR                                                           03230000
              (PV-APRD045-RTL-AMT > PC-POS-MAX)                         03240000
               PERFORM 3000-WRITE-MULTIPLE-RECS                         03250000
           ELSE                                                         03260000
21732          MOVE PV-APRD045-RTL-AMT TO ML017-PC-NEW-PR-AMT           03270000
21732          COMPUTE ML017-PC-DIFFER-AMT =                            03280000
21732                  ML017-PC-OLD-PR-AMT - ML017-PC-NEW-PR-AMT        03290000
               PERFORM 8500-WRITE-ML-TRANS-REC                          03300000
           END-IF.                                                      03310000
                                                                        03320000
                                                                        03330000
      ******************************************************************03340000
      * THIS PARAGRAPH CONTROLS THE WRITING OF MULTIPLE RECORDS WHEN    03350000
      * THE DOLLAR AMOUNT IS GREATER THAN 9999.99.                      03360000
      ******************************************************************03370000
       3000-WRITE-MULTIPLE-RECS.                                        03380000
           MOVE 'N' TO PS-END-OF-RTL-AMTS-SW                            03390000
                                                                        03400000
           MOVE PV-APRD045-RTL-AMT     TO PV-CALC-CUR-RTL.              03410000
                                                                        03420000
           PERFORM 3025-CALC-CURRENT-RTL                                03430000
               UNTIL PS-END-OF-RTL-AMTS.                                03440000
                                                                        03450000
       EJECT                                                            03460000
                                                                        03470000
      ****************************************************************  03480000
      *    DETERMINE THE CURRENT RETAIL AMT BASED ON THE                03490000
      *    DOLLARS REMAINING IN EACH BUCKET. WRITE AN EXTRACT RECORD.   03500000
      ****************************************************************  03510000
       3025-CALC-CURRENT-RTL.                                           03520000
                                                                        03530000
           IF PV-CALC-CUR-RTL > PC-POS-MAX                              03540000
               SUBTRACT PC-POS-MAX FROM PV-CALC-CUR-RTL                 03550000
21732          MOVE PC-POS-MAX     TO ML017-PC-NEW-PR-AMT               03560000
           ELSE                                                         03570000
               IF PV-CALC-CUR-RTL < PC-NEG-MAX                          03580000
                   SUBTRACT PC-NEG-MAX FROM  PV-CALC-CUR-RTL            03590000
21732              MOVE PC-NEG-MAX     TO ML017-PC-NEW-PR-AMT           03600000
               ELSE                                                     03610000
                   IF PV-CALC-CUR-RTL NOT = 0                           03620000
                       MOVE PV-CALC-CUR-RTL                             03630000
21732                                  TO ML017-PC-NEW-PR-AMT           03640000
                       MOVE +0         TO PV-CALC-CUR-RTL               03650000
                       SET PS-END-OF-RTL-AMTS TO TRUE                   03660000
                   ELSE                                                 03670000
                       MOVE PV-CALC-CUR-RTL                             03680000
21732                                  TO ML017-PC-NEW-PR-AMT           03690000
                   END-IF                                               03700000
               END-IF                                                   03710000
           END-IF.                                                      03720000
                                                                        03730000
21732      COMPUTE ML017-PC-DIFFER-AMT =                                03740000
21732              ML017-PC-OLD-PR-AMT - ML017-PC-NEW-PR-AMT.           03750000
                                                                        03760000
           PERFORM 8500-WRITE-ML-TRANS-REC.                             03770000
                                                                        03780000
      ******************************************************************03790000
      * GET IN HOUSE NUMBER BASED ON DEPT AND ENT ID                    03800000
      * IF NOT FOUND DEFAULT TO ZEROES                                  03810000
      ******************************************************************03820000
       7200-GET-TNVDDPT-INHSE-NBR.                                      03830000
                                                                        03840000
           MOVE AP045-ENT-ID TO PV-ENT-ID.                              03850000
           EXEC SQL                                                     03860000
               SELECT INHOUSE_NBR                                       03870000
                 INTO :VNDDPT-INHOUSE-NBR                               03880000
                 FROM TVNDDPT                                           03890000
                WHERE DEPT_NBR = :AP045-DEPT-NBR                        03900000
                  AND ENT_ID   = :PV-ENT-ID                             03910000
           END-EXEC.                                                    03920000
                                                                        03930000
           EVALUATE SQLCODE                                             03940000
               WHEN 0                                                   03950000
                   CONTINUE                                             03960000
               WHEN +100                                                03970000
                   MOVE PC-ALPHA-ZEROES    TO VNDDPT-INHOUSE-NBR        03980000
               WHEN OTHER                                               03990000
                  MOVE '7200-GET-TNVDDPT-INHSE-NBR' TO                  04000000
                       PV-PARAGRAPH-NAME                                04010000
                  PERFORM 9999-SQL-ABEND                                04020000
           END-EVALUATE.                                                04030000
                                                                        04040000
      *                                                                 04050000
       8000-READ-EXTRACT.                                               04060000
           READ AP-TRANS-FILE INTO AP045-TRANSACTION-FILE               04070000
           AT END                                                       04080000
               SET PS-EOF-EXTRACT           TO TRUE                     04090000
           NOT AT END                                                   04100000
               ADD 1                        TO PA-TOTAL-READ            04110000
           END-READ.                                                    04120000
                                                                        04130000
      *-----------------------------------------------------------*     04140000
      *  8200-READ-DATE-FILE GETS THE FISCAL WEEK DATA            *     04150000
      *-----------------------------------------------------------*     04160000
       8200-READ-DATE-FILE.                                             04170000
            READ FISCAL-WEEK-FILE INTO DARD104-RECORD.                  04180000
                                                                        04190000
       8500-WRITE-ML-TRANS-REC.                                         04200000
           WRITE ML-TRANS-RECORD                                        04210000
21732          FROM ML017-PRICE-CHANGE-RECORD.                          04220000
           ADD 1                            TO PA-ML-TOTAL-WRITTEN.     04230000
                                                                        04240000
      *************************************************************     04250000
      *  9000-EOJ IS PERFORMED FROM 0000-DAKUT302.  IT PRODUCES   *     04260000
      *  A 'NO ERROR MESSAGE' ON THE REPORT IF NONE WERE FOUND    *     04270000
      *  IF ERRORS WERE FOUND, THE RETURN CODE IS SET TO 4095     *     04280000
      *  WHICH IS USED TO ALERT THE ML TEAM VIA AN EMAIL THAT     *     04290000
      *  ERRORS OCCURED.  RECORD COUNTS ARE ALSO DISPLAYED.       *     04300000
      *************************************************************     04310000
       9000-EOJ.                                                        04320000
                                                                        04330000
           CLOSE AP-TRANS-FILE                                          04340000
                 FISCAL-WEEK-FILE                                       04350000
                 ML-TRANS-FILE.                                         04360000
                                                                        04370000
           DISPLAY SPACES.                                              04380000
           MOVE PA-TOTAL-READ        TO PV-DISP-NUMBER.                 04390000
           DISPLAY 'RECS READ    =    ' PV-DISP-NUMBER.                 04400000
           MOVE PA-ML-TOTAL-WRITTEN  TO PV-DISP-NUMBER.                 04410000
           DISPLAY 'ML RECS WRITTEN = ' PV-DISP-NUMBER.                 04420000
           DISPLAY '**------ END DAKUT302 ------**'.                    04430000
                                                                        04440000
      ******************************************************************04450000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               04460000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             04470000
      ******************************************************************04480000
       9999-SQL-ABEND.                                                  04490000
                                                                        04500000
           MOVE +4013                 TO ABEND-CODE.                    04510000
           DISPLAY '**  ABEND     **'.                                  04520000
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              04530000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            04540000
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       04550000
                                                                        04560000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         04570000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        04580000
                                                                        04590000
           COPY DPPD004.                                                04600000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           04610000
      *                                                                 04620000
