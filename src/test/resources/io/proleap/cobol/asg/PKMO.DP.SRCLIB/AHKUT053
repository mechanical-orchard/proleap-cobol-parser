000500 IDENTIFICATION DIVISION.                                         00050001
000600 PROGRAM-ID.    AHKUT053.                                         00060001
000700 AUTHOR.        PATRICK BURKE.                                    00070001
000800 INSTALLATION.  KOHLS.                                            00080001
000900 DATE-WRITTEN   MAY, 2000.                                        00090001
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200* ************************************************************** *00120001
001300* * AHKUT053.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.    * *00130001
001400* *                                                            * *00140001
001500* * PURPOSE:                                                   * *00150001
001600* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TWKORIN.        * *00160001
001700* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:         * *00170001
001800* * 1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES. * *00180001
001900* * 2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.    * *00190001
002000* *                                                            * *00200001
002100* * PROCESSING OVERVIEW:                                       * *00210001
002200* * THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,  * *00220001
002300* * 1) INCREMENT COUNT OF RECORDS READ.                        * *00230001
002400* * 2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.            * *00240001
002500* *    2.A) IF NO MATCH(ES):                                   * *00250001
002600* *         2.A.1) PROCESSING CONTINUES                        * *00260001
002700* *         2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;    * *00270001
002800* *                THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT* *00280001
002900* *                ON UNCLEAN DATA.  IT SIMPLY MIGRATES        * *00290001
003000* *                CONDITIONS OCCURRING IN OPERATIONAL         * *00300001
003100* *                TABLES OVER TO THE ARCHIVE/HISTORY TABLES.  * *00310001
003200* *    2.B) IF MATCH(ES):                                      * *00320001
003300* *         2.B.1) INCREMENT COUNT OF ROW(S) FOUND.            * *00330001
003400* *         2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.     * *00340001
003500* *         2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.         * *00350001
003600* *         2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE     * *00360001
003700* *                AT THIS TIME.  THEY WILL BE REMOVED IN OTHER* *00370001
003800* *                PROCESSING, AFTER HAVING BEEN LOADED TO THE * *00380001
003900* *                ARCHIVE/HISTORY TABLE.                      * *00390001
004000* * 3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *00400001
004100* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *00410001
004200* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *00420001
004300* ************************************************************** *00430001
004400 ENVIRONMENT DIVISION.                                            00440001
004500 CONFIGURATION SECTION.                                           00450001
004600 SOURCE-COMPUTER.        IBM-3090.                                00460001
004700 OBJECT-COMPUTER.        IBM-3090.                                00470001
004800                                                                  00480001
004900 INPUT-OUTPUT SECTION.                                            00490001
005000 FILE-CONTROL.                                                    00500001
005100                                                                  00510001
005200     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00520001
005300     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00530001
005400                                                                  00540001
005500******************************************************************00550001
005600 DATA DIVISION.                                                   00560001
005700 FILE SECTION.                                                    00570001
005800                                                                  00580001
005900 FD  IN-DRIVER-FILE                                               00590001
006000     RECORDING MODE IS F                                          00600001
006100     LABEL RECORDS ARE STANDARD                                   00610001
006200     BLOCK CONTAINS 0 RECORDS.                                    00620001
006300 01  IN-DRIVER-RECORD                PIC  X(004).                 00630001
006400                                                                  00640001
006500**** TWKORIN:                                                     00650001
006600 FD  OUT-EXTRACT-FILE                                             00660001
006700     RECORDING MODE IS F                                          00670001
006800     LABEL RECORDS ARE STANDARD                                   00680001
006900     BLOCK CONTAINS 0 RECORDS.                                    00690001
007000 01  OUT-EXTRACT-RECORD              PIC  X(137).                 00700005
007100                                                                  00710001
007200                                                                  00720001
007300                                                                  00730001
007400 WORKING-STORAGE SECTION.                                         00740001
007500                                                                  00750001
007600 01  PC-PROGRAM-CONSTANTS.                                        00760001
007700     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT053'.  00770001
007800     05  PC-PGM-PROGRESS-DESC.                                    00780001
007900         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00790001
008000         10  PC-CONTINUING           PIC X(10) VALUE              00800001
008100                                               'CONTINUING'.      00810001
008200         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00820001
008300         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00830001
008400     05  PC-ABEND-INFO.                                           00840001
008500         10  PC-ABEND                PIC X(11) VALUE              00850001
008600                                               '** ABEND **'.     00860001
008700         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00870001
008800                                               '- PARA       : '. 00880001
008900         10  PC-ABEND-MSG-DISPLAY-PARA                            00890001
009000                                     PIC X(15) VALUE              00900001
009100                                               '  CALLED PARA: '. 00910001
009200         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00920001
009300                                               '  FOR ABEND# : '. 00930001
009400         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00940001
009500                                               '- ERROR IS   : '. 00950001
009600         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00960001
009700         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00970001
009800                                               '- ACTION     : '. 00980001
009900     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00990001
010000                                                                  01000001
010100 01  PS-PROGRAM-SWITCHES.                                         01010001
010200     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         01020001
010300         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         01030001
010400         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01040001
010500     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01050001
010600         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01060001
010700         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01070001
010800     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01080001
010900         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01090001
011000         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01100001
011100                                                                  01110001
011200 01  PV-PROGRAM-VARIABLES.                                        01120001
011300     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01130001
011400     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01140001
011500     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01150001
011600     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01160001
011700     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01170001
011800     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01180001
011900                                                                  01190001
012000     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01200001
012100     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01210001
012200     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01220001
012300     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01230001
012400     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01240001
012500     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01250001
012600                                                                  01260001
012700     05  PV-TMST                     PIC X(26) VALUE SPACES.      01270001
012800     05  PV-TIMESTAMP-DETAIL                                      01280001
012900         REDEFINES                                                01290001
013000         PV-TMST.                                                 01300001
013100         10  PV-TIMESTAMP-19.                                     01310001
013200             15  PV-TMS-DATE.                                     01320001
013300                 20  PV-TMS-YEAR.                                 01330001
013400                     25  PV-TMS-CC   PIC X(02).                   01340001
013500                     25  PV-TMS-YY   PIC X(02).                   01350001
013600                 20  FILLER          PIC X(01).                   01360001
013700                 20  PV-TMS-MONTH    PIC X(02).                   01370001
013800                 20  FILLER          PIC X(01).                   01380001
013900                 20  PV-TMS-DAY      PIC X(02).                   01390001
014000             15  FILLER              PIC X(01).                   01400001
014100             15  PV-TMS-HOUR         PIC X(02).                   01410001
014200             15  FILLER              PIC X(01).                   01420001
014300             15  PV-TMS-MINUTE       PIC X(02).                   01430001
014400             15  FILLER              PIC X(01).                   01440001
014500             15  PV-TMS-SECOND       PIC X(02).                   01450001
014600         10  FILLER                  PIC X(01).                   01460001
014700         10  PV-TMS-MSECOND          PIC X(06).                   01470001
014800                                                                  01480001
014900 01  DM-DISPLAY-MESSAGE.                                          01490001
015000     05  DM-01-10.                                                01500001
015100         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01510001
015200         10  FILLER                  PIC X(02) VALUE ': '.        01520001
015300     05  DM-11-80.                                                01530001
015400         10  FILLER                  PIC X(37) VALUE              01540001
015500                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01550001
015600         10  FILLER                  PIC X(30) VALUE              01560001
015700                        'CREATING TWKORIN EXTRACT FILE.'.         01570001
015800         10  FILLER                  PIC X(01) VALUE SPACE.       01580001
015900         10  FILLER                  PIC X(01) VALUE ALL '*'.     01590001
016000     05  DM-81-120.                                               01600001
016100         10  FILLER                  PIC X(40) VALUE ALL '*'.     01610001
016200                                                                  01620001
016300 01  DP-DISPLAY-PROGRESS-MSG.                                     01630001
016400     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01640001
016500     05  FILLER                      PIC X(02) VALUE SPACE.       01650001
016600     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01660001
016700     05  FILLER                      PIC X(04) VALUE ' AT '.      01670001
016800     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01680001
016900     05  FILLER                      PIC X(03) VALUE '.  '.       01690001
017000     05  FILLER                      PIC X(03) VALUE              01700001
017100                                         'IN:'.                   01710001
017200     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01720001
017300                                               VALUE ZERO.        01730001
017400     05  FILLER                      PIC X(02) VALUE ', '.        01740001
017500*    05  FILLER                      PIC X(16) VALUE              01750001
017600*                                        'DRIVER W/ROW(S):'.      01760001
017700*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01770001
017800*                                              VALUE ZERO.        01780001
017900*    05  FILLER                      PIC X(02) VALUE ', '.        01790001
018000     05  FILLER                      PIC X(14) VALUE              01800001
018100                                         'ROWS SELECTED:'.        01810001
018200     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01820001
018300                                               VALUE ZERO.        01830001
018400     05  FILLER                      PIC X(02) VALUE ', '.        01840001
018500     05  FILLER                      PIC X(04) VALUE              01850001
018600                                         'OUT:'.                  01860001
018700     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01870001
018800                                               VALUE ZERO.        01880001
018900     05  FILLER                      PIC X(01) VALUE '.'.         01890001
019000                                                                  01900001
019100 01  ABEND-CODE                      PIC S9(04)                   01910001
019200                                               VALUE ZEROES       01920001
019300                                               COMP SYNC.         01930001
019400                                                                  01940001
019500*---------------------------------------------------------------* 01950001
019600*  DB2 FORMATTED MESSAGE AREA                                     01960001
019700*---------------------------------------------------------------* 01970001
019800     COPY DPWS004.                                                01980001
019900                                                                  01990001
020000                                                                  02000001
020100*---------------------------------------------------------------* 02010001
020200*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 02020001
020300*---------------------------------------------------------------* 02030001
020400     COPY AHRD002.                                                02040001
020500                                                                  02050001
020600                                                                  02060001
020700*---------------------------------------------------------------* 02070001
020800*    DB2 AREA FOR TWKORIN                                       * 02080001
020900*---------------------------------------------------------------* 02090001
021000     EXEC SQL                                                     02100001
021100          INCLUDE TWKORIN                                         02110001
021200     END-EXEC.                                                    02120001
021300                                                                  02130001
021400*---------------------------------------------------------------* 02140001
021500*    DB2 AREA FOR COMMUNICATIONS                                * 02150001
021600*---------------------------------------------------------------* 02160001
021700     EXEC SQL                                                     02170001
021800          INCLUDE SQLCA                                           02180001
021900     END-EXEC.                                                    02190001
022000                                                                  02200001
022100*---------------------------------------------------------------* 02210001
022200*    DEFINE CURSOR FOR TWKORIN :                                * 02220001
022300*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02230001
022400*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02240001
022500*---------------------------------------------------------------* 02250001
022600     EXEC SQL                                                     02260001
022700          DECLARE TABLE-CURSOR CURSOR FOR                         02270001
022800           SELECT ORD_NBR                                         02280001
022900                 ,RCVR_SEQ_NBR                                    02290001
023000                 ,ORD_LNE_NBR                                     02300001
023100                 ,WORK_ORD_SEQ_NBR                                02310001
023200                 ,OPER_UNT_ID                                     02320001
023300                 ,FCLTY_ID                                        02330001
023400                 ,WO_INSTR_SEQ_NBR                                02340001
023500                 ,CRE_TMST                                        02350001
023600                 ,VER_STATUS_CDE                                  02360001
023700                 ,CRE_UID_ID                                      02370001
023800                 ,OPER_ID                                         02380001
023900                 ,FCLTY_AREA_ID                                   02390001
024000                 ,PRC_FCLTY_AREA_ID                               02400001
024100                 ,EXPTED_CART_CNT                                 02410001
024200                 ,ACTL_CART_CNT                                   02420004
024300                 ,ALLOC_IND                                       02430001
024400                 ,REPACK_IND                                      02440001
024500                 ,STRT_TMST                                       02450001
024600                 ,STOP_TMST                                       02460001
024610                 ,SCREEN_SEQ_NBR                                  02461001
024700                 ,LNE_LOC_CDE                                     02470001
024800                 ,REC_SEL_IND                                     02480001
024900           FROM   TWKORIN                                         02490001
025000          WHERE  (ORD_NBR = :PV-PO-NBR-COMP)                      02500001
025100*      ORDER BY                                                   02510001
025200            FOR  FETCH ONLY                                       02520001
025300           WITH  UR                                               02530001
025400     END-EXEC.                                                    02540001
025500                                                                  02550001
025600                                                                  02560001
025700 PROCEDURE DIVISION.                                              02570001
025800********************                                              02580001
025900                                                                  02590001
026000 0000-PROGRAM-MAINLINE.                                           02600001
026100                                                                  02610001
026200     PERFORM 1000-INITIALIZE.                                     02620001
026300                                                                  02630001
026400     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02640001
026500     PERFORM 2000-PROCESS-DRIVER-FILE                             02650001
026600         UNTIL PS-IN-DRIVER-EOF.                                  02660001
026700                                                                  02670001
026800     PERFORM 6000-EOJ-ROUTINE.                                    02680001
026900     STOP RUN.                                                    02690001
027000                                                                  02700001
027100                                                                  02710001
027200* ************************************************************** *02720001
027300* * INITIALIZATIONS                                            * *02730001
027400* ************************************************************** *02740001
027500 1000-INITIALIZE.                                                 02750001
027600                                                                  02760001
027700     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02770001
027800     DISPLAY DM-DISPLAY-MESSAGE.                                  02780001
027900                                                                  02790001
028000     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02800001
028100     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02810001
028200                                                                  02820001
028300     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02830001
028400     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02840001
028500                                                                  02850001
028600                                                                  02860001
028700* ************************************************************** *02870001
028800* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02880001
028900* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02890001
029000* *    1B- OPEN TABLE CURSOR                                   * *02900001
029100* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02910001
029200* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02920001
029300* *    2) FOR EACH ROW,                                        * *02930001
029400* *       2A- INCREMENT COUNTS                                 * *02940001
029500* *       2B- WRITE EXTRACT RECORD                             * *02950001
029600* *    1D- CLOSE TABLE CURSOR                                  * *02960001
029700* ************************************************************** *02970001
029800 2000-PROCESS-DRIVER-FILE.                                        02980001
029900                                                                  02990001
030000     PERFORM 9050-READ-IN-DRIVER-FILE.                            03000001
030100     IF PS-IN-DRIVER-EOF                                          03010001
030200         CONTINUE                                                 03020001
030300     ELSE                                                         03030001
030400         MOVE AH002-PO-NBR TO         PV-PO-NBR-COMP              03040001
030500                                      PV-PO-NBR-NUM               03050001
030600         PERFORM 2100-CHECK-PGM-PROGRESS                          03060001
030700         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     03070001
030800         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     03080001
030900         PERFORM 9100-OPEN-TABLE-CURSOR                           03090001
031000         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     03100001
031100             UNTIL PS-TABLE-LOOP-DONE                             03110001
031200         PERFORM 9190-CLOSE-TABLE-CURSOR                          03120001
031300     END-IF.                                                      03130001
031400                                                                  03140001
031500                                                                  03150001
031600* ************************************************************** *03160001
031700* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03170001
031800* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03180001
031900* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03190001
032000* ************************************************************** *03200001
032100 2100-CHECK-PGM-PROGRESS.                                         03210001
032200     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03220001
032300         BY        PC-HOW-OFTEN-TO-DISPLAY                        03230001
032400         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03240001
032500         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03250001
032600                                                                  03260001
032700     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03270001
032800         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03280001
032900         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03290001
033000     END-IF.                                                      03300001
033100                                                                  03310001
033200                                                                  03320001
033300* ************************************************************** *03330001
033400* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03340001
033500* ************************************************************** *03350001
033600 3000-EXTRACT-ROWS-FROM-TABLE.                                    03360001
033700     INITIALIZE DCLTWKORIN.                                       03370001
033800     PERFORM 9150-FETCH-TABLE-CURSOR.                             03380001
033900     IF PS-TABLE-LOOP-DONE                                        03390001
034000         CONTINUE                                                 03400001
034100     ELSE                                                         03410001
034200         PERFORM 9750-WRITE-EXTRACT-RECORD                        03420001
034300     END-IF.                                                      03430001
034400                                                                  03440001
034500                                                                  03450001
034600* ************************************************************** *03460001
034700* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03470001
034800* ************************************************************** *03480001
034900 6000-EOJ-ROUTINE.                                                03490001
035000                                                                  03500001
035100     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03510001
035200     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03520001
035300                                                                  03530001
035400     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03540001
035500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03550001
035600                                                                  03560001
035700                                                                  03570001
035800* ************************************************************** *03580001
035900* * DISPLAY PROGRAM PROGRESS.                                  * *03590001
036000* ************************************************************** *03600001
036100 6200-DISPLAY-PGM-PROGRESS.                                       03610001
036200                                                                  03620001
036300     EXEC SQL                                                     03630001
036400          SET :PV-TMST = CURRENT TIMESTAMP                        03640001
036500     END-EXEC.                                                    03650001
036600                                                                  03660001
036700     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03670001
036800     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03680001
036900     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03690001
037000                                    TO DP-IN-CNT.                 03700001
037100*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03710001
037200     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03720001
037300     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03730001
037400                                                                  03740001
037500     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03750001
037600                                                                  03760001
037700                                                                  03770001
037800* ************************************************************** *03780001
037900* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03790001
038000* * 90XX- INPUT:  DRIVER FILE                                  * *03800001
038100* * 91XX- INPUT:  TABLE CURSOR                                 * *03810001
038200* * 97XX- OUTPUT: TABLE EXTRACT                                * *03820001
038300* ************************************************************** *03830001
038400                                                                  03840001
038500* ************************************************************** *03850001
038600* * OPEN  INPUT DRIVER FILE                                    * *03860001
038700* ************************************************************** *03870001
038800 9000-OPEN-IN-DRIVER-FILE.                                        03880001
038900     OPEN  INPUT  IN-DRIVER-FILE.                                 03890001
039000                                                                  03900001
039100                                                                  03910001
039200* ************************************************************** *03920001
039300* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03930001
039400* ************************************************************** *03940001
039500 9050-READ-IN-DRIVER-FILE.                                        03950001
039600     READ IN-DRIVER-FILE                                          03960001
039700          INTO AH002-DRIVER-RECORD-LAYOUT                         03970001
039800          AT END                                                  03980001
039900              SET PS-IN-DRIVER-EOF TO TRUE.                       03990001
040000                                                                  04000001
040100     IF PS-IN-DRIVER-EOF                                          04010001
040200         CONTINUE                                                 04020001
040300     ELSE                                                         04030001
040400         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     04040001
040500     END-IF.                                                      04050001
040600                                                                  04060001
040700                                                                  04070001
040800* ************************************************************** *04080001
040900* * CLOSE INPUT DRIVER FILE                                    * *04090001
041000* ************************************************************** *04100001
041100 9090-CLOSE-IN-DRIVER-FILE.                                       04110001
041200     CLOSE IN-DRIVER-FILE.                                        04120001
041300                                                                  04130001
041400                                                                  04140001
041500* ************************************************************** *04150001
041600* * OPEN  TABLE CURSOR                                         * *04160001
041700* ************************************************************** *04170001
041800 9100-OPEN-TABLE-CURSOR.                                          04180001
041900     EXEC SQL                                                     04190001
042000          OPEN TABLE-CURSOR                                       04200001
042100     END-EXEC.                                                    04210001
042200                                                                  04220001
042300     EVALUATE TRUE                                                04230001
042400         WHEN SQLCODE = ZERO                                      04240001
042500              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04250001
042600              SET PS-CURSOR-HAS-DATA TO TRUE                      04260001
042700         WHEN SQLCODE = +100                                      04270001
042800              SET PS-TABLE-LOOP-DONE TO TRUE                      04280001
042900         WHEN SQLWARN0 NOT EQUAL SPACE                            04290001
043000         WHEN SQLCODE  NOT EQUAL ZERO                             04300001
043100              MOVE '9100-OPEN-TABLE-CURSOR'                       04310001
043200                                 TO PV-PARAGRAPH-NAME             04320001
043300              MOVE 'OPEN TABLE CURSOR'                            04330001
043400                                 TO PV-DB2-OPERATION-MSG-1        04340001
043500              MOVE 'TWKORIN'     TO PV-DB2-TABLE-NAME             04350001
043600              PERFORM 9999-DB2-ABEND                              04360001
043700     END-EVALUATE.                                                04370001
043800                                                                  04380001
043900                                                                  04390001
044000* ************************************************************** *04400001
044100* * FETCH TABLE CURSOR                                         * *04410001
044200* ************************************************************** *04420001
044300 9150-FETCH-TABLE-CURSOR.                                         04430001
044400     EXEC SQL                                                     04440001
044500         FETCH TABLE-CURSOR                                       04450001
044600          INTO  :WKORIN-ORD-NBR                                   04460001
044700               ,:WKORIN-RCVR-SEQ-NBR                              04470001
044800               ,:WKORIN-ORD-LNE-NBR                               04480001
044900               ,:WKORIN-WORK-ORD-SEQ-NBR                          04490001
045000               ,:WKORIN-OPER-UNT-ID                               04500001
045100               ,:WKORIN-FCLTY-ID                                  04510001
045200               ,:WKORIN-WO-INSTR-SEQ-NBR                          04520001
045300               ,:WKORIN-CRE-TMST                                  04530001
045400               ,:WKORIN-VER-STATUS-CDE                            04540001
045500               ,:WKORIN-CRE-UID-ID                                04550001
045600               ,:WKORIN-OPER-ID                                   04560001
045700               ,:WKORIN-FCLTY-AREA-ID                             04570001
045800               ,:WKORIN-PRC-FCLTY-AREA-ID                         04580001
045900               ,:WKORIN-EXPTED-CART-CNT                           04590001
046000               ,:WKORIN-ACTL-CART-CNT                             04600004
046100               ,:WKORIN-ALLOC-IND                                 04610001
046200               ,:WKORIN-REPACK-IND                                04620001
046300               ,:WKORIN-STRT-TMST                                 04630001
046400               ,:WKORIN-STOP-TMST                                 04640001
046410               ,:WKORIN-SCREEN-SEQ-NBR                            04641001
046500               ,:WKORIN-LNE-LOC-CDE                               04650001
046600               ,:WKORIN-REC-SEL-IND                               04660001
046700     END-EXEC.                                                    04670001
046800                                                                  04680001
046900     EVALUATE TRUE                                                04690001
047000         WHEN SQLCODE = ZERO                                      04700001
047100              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04710001
047200              SET PS-CURSOR-HAS-DATA TO TRUE                      04720001
047300         WHEN SQLCODE = +100                                      04730001
047400              SET PS-TABLE-LOOP-DONE TO TRUE                      04740001
047500         WHEN SQLWARN0 NOT EQUAL SPACE                            04750001
047600         WHEN SQLCODE NOT EQUAL ZERO                              04760001
047700              MOVE '9150-FETCH-TABLE-CURSOR'                      04770001
047800                                 TO PV-PARAGRAPH-NAME             04780001
047900              MOVE 'FETCH TABLE CURSOR'                           04790001
048000                                 TO PV-DB2-OPERATION-MSG-1        04800001
048100              MOVE 'TWKORIN'     TO PV-DB2-TABLE-NAME             04810001
048200              PERFORM 9999-DB2-ABEND                              04820001
048300     END-EVALUATE.                                                04830001
048400                                                                  04840001
048500                                                                  04850001
048600* ************************************************************** *04860001
048700* * CLOSE TABLE CURSOR                                         * *04870001
048800* ************************************************************** *04880001
048900 9190-CLOSE-TABLE-CURSOR.                                         04890001
049000     EXEC SQL                                                     04900001
049100          CLOSE TABLE-CURSOR                                      04910001
049200     END-EXEC.                                                    04920001
049300                                                                  04930001
049400     EVALUATE TRUE                                                04940001
049500         WHEN SQLCODE = ZERO                                      04950001
049600              CONTINUE                                            04960001
049700         WHEN SQLWARN0 NOT EQUAL SPACE                            04970001
049800         WHEN SQLCODE NOT EQUAL ZERO                              04980001
049900              MOVE '9190-CLOSE-TABLE-CURSOR'                      04990001
050000                                 TO PV-PARAGRAPH-NAME             05000001
050100              MOVE 'CLOSE TABLE CURSOR'                           05010001
050200                                 TO PV-DB2-OPERATION-MSG-1        05020001
050300              MOVE 'TWKORIN'     TO PV-DB2-TABLE-NAME             05030001
050400              PERFORM 9999-DB2-ABEND                              05040001
050500     END-EVALUATE.                                                05050001
050600                                                                  05060001
050700                                                                  05070001
050800* ************************************************************** *05080001
050900* * OPEN OUTPUT EXTRACT FILE                                   * *05090001
051000* ************************************************************** *05100001
051100 9700-OPEN-OUT-EXTRACT-FILE.                                      05110001
051200     OPEN OUTPUT OUT-EXTRACT-FILE.                                05120001
051300                                                                  05130001
051400                                                                  05140001
051500* ************************************************************** *05150001
051600* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05160001
051700* ************************************************************** *05170001
051800 9750-WRITE-EXTRACT-RECORD.                                       05180001
051900     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTWKORIN.                 05190004
052000     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05200001
052100                                                                  05210001
052200                                                                  05220001
052300* ************************************************************** *05230001
052400* * CLOSE OUTPUT EXTRACT FILE                                  * *05240001
052500* ************************************************************** *05250001
052600 9790-CLOSE-OUT-EXTRACT-FILE.                                     05260001
052700     CLOSE OUT-EXTRACT-FILE.                                      05270001
052800                                                                  05280001
052900                                                                  05290001
053000* ************************************************************** *05300001
053100* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05310001
053200* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05320001
053300* * SQL ERROR OR WARNING CODE OCCURS.                          * *05330001
053400* ************************************************************** *05340001
053500 9999-DB2-ABEND.                                                  05350001
053600                                                                  05360001
053700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05370001
053800             ' 9999-DB2-ABEND'.                                   05380001
053900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05390001
054000             ' ** ABEND           **'.                            05400001
054100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05410001
054200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05420001
054300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05430001
054400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05440001
054500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05450001
054600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05460001
054700                                                                  05470001
054800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05480001
054900             ' ** SQLCODE         ** = ' SQLCODE.                 05490001
055000     MOVE SQLCODE TO PV-SQLCODE.                                  05500001
055100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05510001
055200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05520001
055300                                                                  05530001
055400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05540001
055500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05550001
055600                                                                  05560001
055700                                                                  05570001
055800*----------------------------------------------------------------*05580001
055900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05590001
056000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05600001
056100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05610001
056200* FORMAT.                                                        *05620001
056300*----------------------------------------------------------------*05630001
056400     COPY DPPD004.                                                05640001
056500                                                                  05650001
056600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05660001
056700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05670001
056800     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05680001
056900     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05690001
057000                                                                  05700001
057100*----------------------------------------------------------------*05710001
057200* CALL ABEND                                                     *05720001
057300*----------------------------------------------------------------*05730001
057400     MOVE +4013                  TO ABEND-CODE.                   05740001
057500     CALL 'ILBOABN0' USING ABEND-CODE.                            05750001
057600*                                                                 05760001
