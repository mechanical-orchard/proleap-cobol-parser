000100 IDENTIFICATION DIVISION.                                         00010024
000200 PROGRAM-ID.             VLKUT047.                                00020024
000300 AUTHOR.                 VIRGENE LENNEMAN.                        00030024
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040024
000500 DATE-WRITTEN.           MAY 2007.                                00050024
000600 DATE-COMPILED.                                                   00060024
000700                                                                  00070024
000800******************************************************************00080024
000900*  INPUT: FILE FROM COMPLIANCE MGMT SYSTEM, COPYBOOK VLRD049      00090024
001000*         CALLS DPKUP150 PRORATION ROUNTINE, COPYBOOK APWS150     00100024
001100*  OUTPUT: AP TRANSACTIONS '3H' (CHARGES) & '3I' (CREDITS),       00110024
001200*          '3U' (PO FILL CHARGES) & '3V' (PO FILL CREDITS),       00120024
001300*          COPYBOOK APRD045                                       00130024
001400*                                                                 00140024
001500*  DB2 TABLES: TAPCNTL, TTRNCDE, TAJPRRT, TRECEIV, XLT_DOC        00150024
001600*                                                                 00160024
001700*  PROGRAM NARRATIVE:                                             00170024
001800*  THIS PROGRAM READS A FILE OF DEBIT INFORMATION FROM THE        00180024
001900*    COMPLIANCE MGMT SYS., ADDS ADDITIONAL INFORMATION FROM THE   00190024
002000*    AP TABLES AND CREATES A NEW RECORD MATCHING THE COPYBOOK     00200024
002100*    APRD045. THE TRANSACTIONS BEING PROCESSED HERE ARE 3H AND 3I.00210024
002200*    THESE ARE RELATED TO FREIGHT CHARGES.                        00220024
002300*    THE PROGRAM ALSO PROCESSES 3U AND IV - PO FILL CHARGES.      00230024
002400*                                                                 00240024
002500*  BEFORE THE PROCESSING FOR THE AP FILE IS DONE, THE INPUT FILE  00250024
002600*    IS PROCESSED TO ADD UP THE NUMBER OF RECORDS AND THE SENT    00260024
002700*    AMOUNTS. THESE AMOUNTS ARE THEN COMPARED TO WHAT CMS SENT    00270024
002800*    ON THE CONTROL RECORD.  IF ALL MATCH THEN PROCESSING CAN     00280024
002900*    CONTINUE, OTHERWISE PROGRAM WILL ABEND.                      00290024
003000*                                                                 00300024
003100*  CREATING THE AP FILE:                                          00310024
003200*  THE MINIMUM RECEIVER IS DETERMINED FOR EACH INPUT PO. THE      00320024
003300*  PRORATION ROUTINE IS CALLED. THIS CREATES A NBR OF ROWS IN     00330024
003400*  TAJPRRT WHICH IS A GLOBAL TEMP TABLE THAT HOLDS A PRORATION    00340024
003500*  PERCENTAGE FOR EACH SKU. THE PROCESSING USES THIS PERCENTAGE   00350024
003600*  TO CALCULATE THE PRORATED FREIGHT AMOUNT FOR EACH SKU.         00360024
003700*  SOMETIMES IF ALL THE ROWS FROM TAJPRRT ARE USED TO CALCULATE   00370024
003800*  THE PRORATED AMOUNTS, ARE THEN SUB-TOTALLED - THE SUB-TOTALLED 00380024
003900*  AMOUNT DOES NOT ALWAYS EQUAL THE AMOUNT SENT ON THE INPUT FILE.00390024
004000*  ONE INPUT PO MAY GENERATE 1 TO N ROWS TO THE OUTPUT (DEPENDING 00400024
004100*  ON HOW MANY TAJPRRT ROWS THE PRORATION ROUTINE CREATED). IF    00410024
004200*  ALL THE FREIGHT CHARGES OR REVERSALS ARE TABLULATED, THEY MAY  00420024
004300*  NOT EQUAL THE AMOUNT SENT ON THE INPUT - SO WHEN PROCESSING    00430024
004400*  IS SITTING ON THE LAST RECORD, AN ADJUSTMENT MAY NEED TO BE    00440024
004500*  DONE TO THE LAST CHARGE OR CREDIT -OR- IF BY CHANCE THE        00450024
004600*  TABULATED AMOUNT IS EQUAL TO THE INPUT AMOUNT AND THE LAST     00460024
004700*  RECORD HAS NOT BEEN REACHED, NO MORE RECORDS ARE WRITTEN TO    00470024
004800*  THE OUTPUT.                                                    00480024
004900*                                                                 00490024
005000*  _______________________________________________________________00500024
005100*  REC TYP| REC FUNCTION |  VALUE     |POSTING TYPE               00510024
005200*  _______|______________|____________|___________________________00520024
005300*         |              |            |                           00530024
005400*   3I    |    CREDIT    |     +      |      CH                   00540024
005500*         |   (REVERSAL) |            |                           00550024
005600*  _______|______________|____________|___________________________00560024
005700*         |              |            |                           00570024
005800*   3H    |    CHARGE    |     -      |      CR                   00580024
005900*  _______|______________|____________|___________________________00590024
006000*         |    PO FILL   |            |                           00600024
006100*   3U    |    CREDIT    |     +      |      CH                   00610024
006200*         |   (REVERSAL) |            |                           00620024
006300*  _______|______________|____________|___________________________00630024
006400*         |    PO FILL   |            |                           00640024
006500*   3V    |    CHARGE    |     -      |      CR                   00650024
006600*  _______|______________|____________|___________________________00660024
006700*                                                                 00670024
006800*                                                                 00680024
006900*    CC-CONTROL-CARD         FORMAT   BYTES                       00690024
007000*    _______________________________________                      00700024
007100*     CC-SCHEDULE-DATE       CCYYMMDD  1:8                        00710024
007200*     CC-DISP-PO-DETAILS      Y/N      9:1                        00720024
007300*     CC-DISP-PO-SUMMARY      Y/N     10:1                        00730024
007400*     CC-DISP-PRORATE-CALL    Y/N     11:1                        00740024
007500*     CC-TYPE-RUN            PO/FR    13:2                        00750024
007600*                                                                 00760024
007700*  NOTE: THE LAST 3 BYTES OF THE CONTROL CARD CAN BE USED TO      00770024
007800*        TURN THE SYSOUT DISPLAYS ON OR OFF                       00780024
007900*                                                                 00790024
008000* ----------------------------     ---------------------          00800024
008100* ACCUMULATORS AND WORK FIELDS   - NOTES AND THEIR USAGE          00810024
008200* ----------------------------     ---------------------          00820024
008300* PA-RECS-WRIT-THIS-PO.............NBR OUTRECS WRITTEN OUT FOR PO 00830024
008400* PA-TOT-TAJPRRT-RECS-FOR-PO.......TOT NBR PRORATE RECS FOR A PO  00840024
008500* PA-PRORATE-REC-COUNT.............INCREMENTED COUNT FOR A PO     00850024
008600* PA-TOT-RECS-WRIT.................TOT OUTRECS WRITTEN FOR FILE   00860024
008700* PA-TOTAL-CHARGES.................TOT CHARGES SUMMED FROM INPUT  00870024
008800* PA-TOTAL-CHARGES-THIS-PO.........SUBTOT CHARGES SUMMED FROM A PO00880024
008900* PA-TOTAL-CREDITS-THIS-PO.........SUBTOT CREDITS SUMMED FROM A PO00890024
009000* PA-TOTAL-CREDITS.................TOT CREDITS SUMMED FROM INPUT  00900024
P47422* PA-TOT-WRAP-RECS-WRIT............TOT WRAPRECS WRITTEN FOR FILE  00910024
P47422* PA-TOTAL-WRAP-CHARGES............TOT CHARGES SUMMED FROM WRAP   00920024
P47422* PA-TOTAL-WRAP-CREDITS............TOT CREDITS SUMMED FROM WRAP   00930024
009100*                                                                 00940024
009200* PV-DIFFERENCE....................WORK FIELD TO HOLD ANY         00950024
009300*                                  DIFFERENCE THAT WAS CALCULATED 00960024
009400*                                                                 00970024
009500* PV-SIGNED-FIELD..................WORK FIELD USED TO MULTIPLY    00980024
009600*                                  BY (-1) TO CHANGE A SIGN VALUE 00990024
009700*                                                                 01000024
009800* PV-VL049-TOT-FRGT-SIGNED.........WORK FIELD USED TO CHANGE THE  01010024
009900*                                  SIGN VALUE OF CHARGES (* -1)   01020024
010000*                                                                 01030024
010100* PV-ADJUSTED-FIELD................WORK FIELD USED TO HOLD A      01040024
010200*                                  VALUE THAT HAS PV-DIFFERENCE   01050024
010300*                                  EITHER ADDED OR SUBTRACTED FROM01060024
010400*                                  IT                             01070024
010500*                                                                 01080024
010600* PV-ADJUSTED-TOT-FOR-PO...........HOLDS TOT ADJUSTED VALUE FOR   01090024
010700*                                  THAT PO - CAN BE CHRG OR CREDIT01100024
010800*                                                                 01110024
010900* PV-ADJ-GRAND-CHARGE..............USED TO DISPLAY SUMM STATS,    01120024
011000*                                  THIS KEEPS A RUNNING GRAND     01130024
011100*                                  TOTAL OF THE ADJUSTED CHARGES  01140024
011200*                                                                 01150024
011300* PV-ADJ-GRAND-CREDIT..............USED TO DISPLAY SUMM STATS,    01160024
011400*                                  THIS KEEPS A RUNNING GRAND     01170024
011500*                                  TOTAL OF THE ADJUSTED CREDITS  01180024
P47422*                                                                 01190024
P47422* PV-MAX-WRAP-DAYS.................RECS CAN BE REPROCESSED FOR    01200024
P47422*                                  MAX DAYS FROM WRAP FILE        01210024
011600******************************************************************01220024
263627*---------------------------------------------------------------* 01221025
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         01222025
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     01223025
263627* MAKING THE CALL DYNAMIC VS STATIC.                              01224025
263627*---------------------------------------------------------------* 01225025
011700/                                                                 01230024
011800 ENVIRONMENT DIVISION.                                            01240024
011900                                                                  01250024
012000 CONFIGURATION SECTION.                                           01260024
012100                                                                  01270024
012200 SOURCE-COMPUTER.                        IBM-3090.                01280024
012300 OBJECT-COMPUTER.                        IBM-3090.                01290024
012400                                                                  01300024
012500 INPUT-OUTPUT SECTION.                                            01310024
012600                                                                  01320024
012700 FILE-CONTROL.                                                    01330024
012800                                                                  01340024
012900     SELECT  CMS-EXT-FILE                                         01350024
013000         ASSIGN TO INP01.                                         01360024
013100                                                                  01370024
P47422     SELECT  CMS-WRAP-RECORD-FILE                                 01380024
P47422         ASSIGN TO INP02.                                         01390024
P47422                                                                  01400024
013200     SELECT  AP-TRANSACTION-FILE                                  01410024
013300         ASSIGN TO OUT01.                                         01420024
013400                                                                  01430024
013500     SELECT  AP-COMPLETE-FILE                                     01440024
013600         ASSIGN TO OUT02.                                         01450024
013700                                                                  01460024
P47422     SELECT  CMS-WRAP-ERROR-FILE                                  01470024
P47422         ASSIGN TO OUT03.                                         01480024
P47422                                                                  01490024
013800     SELECT  AP-ERROR-FILE                                        01500024
013900         ASSIGN TO RPT01.                                         01510024
014000                                                                  01520024
014100******************************************************************01530024
014200 DATA DIVISION.                                                   01540024
014300******************************************************************01550024
014400                                                                  01560024
014500 FILE SECTION.                                                    01570024
014600*                                                                 01580024
014700 FD  CMS-EXT-FILE                                                 01590024
014800     RECORDING MODE IS F                                          01600024
014900     LABEL RECORDS ARE STANDARD                                   01610024
015000     BLOCK CONTAINS 0 RECORDS.                                    01620024
015100 01  CMS-EXTRACT-RECORD               PIC  X(275).                01630024
015200*                                                                 01640024
P47422 FD  CMS-WRAP-RECORD-FILE                                         01650024
P47422     RECORDING MODE IS F                                          01660024
P47422     LABEL RECORDS ARE STANDARD                                   01670024
P47422     BLOCK CONTAINS 0 RECORDS.                                    01680024
P47422 01  CMS-EXTRACT-WRAP-RECORD          PIC  X(275).                01690024
P47422                                                                  01700024
015300 FD  AP-TRANSACTION-FILE                                          01710024
015400     RECORDING MODE IS F                                          01720024
015500     LABEL RECORDS ARE STANDARD                                   01730024
015600     BLOCK CONTAINS 0 RECORDS.                                    01740024
015700 01  AP-TRANSACTION-RECORD            PIC  X(500).                01750024
015800                                                                  01760024
015900 FD  AP-COMPLETE-FILE                                             01770024
016000     RECORDING MODE IS F                                          01780024
016100     LABEL RECORDS ARE STANDARD                                   01790024
016200     BLOCK CONTAINS 0 RECORDS.                                    01800024
016300 01  AP-COMPLETE-RECORD               PIC  X(30).                 01810024
016400                                                                  01820024
P47422 FD  CMS-WRAP-ERROR-FILE                                          01830024
P47422     RECORDING MODE IS F                                          01840024
P47422     LABEL RECORDS ARE STANDARD                                   01850024
P47422     BLOCK CONTAINS 0 RECORDS.                                    01860024
P47422 01  CMS-EXTRACT-WRAP-ERROR-RECORD    PIC  X(275).                01870024
P47422                                                                  01880024
016500 FD  AP-ERROR-FILE                                                01890024
016600     RECORDING MODE IS F                                          01900024
016700     LABEL RECORDS ARE STANDARD                                   01910024
016800     BLOCK CONTAINS 0 RECORDS.                                    01920024
P47422*01  AP-ERROR-RECORD                  PIC  X(132).                01930024
P47422 01  AP-ERROR-RECORD                  PIC  X(138).                01940024
017000                                                                  01950024
017100 WORKING-STORAGE SECTION.                                         01960024
017200 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       01970024
017300                                                 COMP SYNC.       01980024
017400     88  AC-BAD-WRITE                        VALUE +4001.         01990024
017500     88  AC-CONTROL-CARD-ERROR               VALUE +4003.         02000024
017600     88  AC-OPEN-ERROR                       VALUE +4005.         02010024
017700     88  AC-CLOSE-ERROR                      VALUE +4006.         02020024
017800     88  AC-BAD-DATA                         VALUE +4008.         02030024
017900     88  AC-DB2-ERROR                        VALUE +4013.         02040024
018000     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         02050024
018100     88  AC-MAX-RETRIES-EXCEEDED             VALUE +4016.         02060024
018200     88  AC-DATE-ERROR                       VALUE +4019.         02070024
018300 01  ABEND-AREAS.                                                 02080024
018400     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02090024
018500             '*****       ABEND'.                                 02100024
018600     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02110024
018700             '*****   PROGRAM: VLKUT047'.                         02120024
018800     05  AA-PARAGRAPH-LIT.                                        02130024
018900         10  FILLER              PIC  X(17)  VALUE                02140024
019000             '***** PARAGRAPH: '.                                 02150024
019100         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02160024
019200     05  AA-MESSAGE-LINE.                                         02170024
019300         10  FILLER              PIC  X(06)  VALUE '*****'.       02180024
019400         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02190024
019500         10  FILLER REDEFINES AA-MESSAGE.                         02200024
019600             15 AA-MESSAGE-1     PIC  X(45).                      02210024
019700             15 AA-MESSAGE-2     PIC  X(45).                      02220024
019800             15 AA-MESSAGE-3     PIC  X(37).                      02230024
019900                                                                  02240024
020000 01  CC-CONTROL-CARD.                                             02250024
020100     05  CC-SCHEDULE-DATE.                                        02260024
020200         10  CC-CCYY                 PIC X(04).                   02270024
020300         10  CC-MM                   PIC X(02).                   02280024
020400         10  CC-DD                   PIC X(02).                   02290024
020500     05  CC-DISP-PO-DETAILS          PIC X(01).                   02300024
020600     05  CC-DISP-PO-SUMMARY          PIC X(01).                   02310024
020700     05  CC-DISP-PRORATE-CALL        PIC X(01).                   02320024
020800     05  FILLER                      PIC X(01).                   02330024
020900     05  CC-TYPE-RUN                 PIC X(02).                   02340024
021000     05  FILLER                      PIC X(66).                   02350024
021100                                                                  02360024
021200 01  SD-SYSTEM-DATE.                                              02370024
021300     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 02380024
021400     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 02390024
021500     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 02400024
021600                                                                  02410024
021700 01  ST-SYSTEM-TIME-DATE-AREA.                                    02420024
021800     05  ST-ABSTIME                      PIC S9(16)  VALUE +0     02430024
021900                                                     COMP SYNC.   02440024
022000     05  ST-SYSTEM-TIME.                                          02450024
022100         10  ST-HHMMSS-FORMAT            PIC  X(08)  VALUE SPACES.02460024
022200         10  FILLER  REDEFINES  ST-HHMMSS-FORMAT.                 02470024
022300             15  ST-SYSTEM-HOUR          PIC  X(02).              02480024
022400             15  FILLER                  PIC  X(01).              02490024
022500             15  ST-SYSTEM-MINUTE        PIC  X(02).              02500024
022600             15  FILLER                  PIC  X(01).              02510024
022700             15  ST-SYSTEM-SECOND        PIC  X(02).              02520024
022800                                                                  02530024
022900 01  PC-CONSTANTS.                                                02540024
023000     05  PC-CURRENT-PGM-VLKUT047      PIC  X(08) VALUE 'VLKUT047'.02550024
023100     05  PC-PRORATION-ROUTINE         PIC  X(08) VALUE 'DPKUP150'.02560024
023200     05  PC-Y                         PIC  X(01) VALUE 'Y'.       02570024
023300     05  PC-CORPORATE                 PIC S9(04) VALUE  +090      02580024
023400                                                        COMP SYNC.02590024
023500 01  PS-SWITCHES.                                                 02600024
023600     05  PS-END-INPUT-SWITCH          PIC  X(01) VALUE 'N'.       02610024
023700         88  PS-END-INPUT                        VALUE 'Y'.       02620024
023800         88  PS-NOT-END-INPUT                    VALUE 'N'.       02630024
023900     05  PS-AMOUNTS-MATCH-SWITCH      PIC  X(01) VALUE 'Y'.       02640024
024000         88  PS-AMOUNTS-MATCH                    VALUE 'Y'.       02650024
024100         88  PS-AMOUNTS-NOT-MATCH                VALUE 'N'.       02660024
024200     05  PS-DTL-CNTL-SWITCH           PIC  X(01) VALUE 'Y'.       02670024
024300         88  PS-DTLS-AND-CNTL                    VALUE 'Y'.       02680024
024400         88  PS-CNTL-ONLY                        VALUE 'N'.       02690024
024500     05  PS-PRORATION-CSR-SWITCH      PIC  X(01) VALUE 'N'.       02700024
024600         88  PS-NOT-END-OF-PRORATION-CSR         VALUE 'N'.       02710024
024700         88  PS-END-OF-PRORATION-CSR             VALUE 'Y'.       02720024
024800     05  PS-SITTING-ON-LAST-REC-SW    PIC  X(01) VALUE 'N'.       02730024
024900         88  PS-SITTING-ON-LAST-REC-YES          VALUE 'Y'.       02740024
025000         88  PS-SITTING-ON-LAST-REC-NO           VALUE 'N'.       02750024
025100     05  PS-STOP-WRITING-OUTRECS-SW   PIC  X(01) VALUE 'N'.       02760024
025200         88  PS-STOP-WRITING-OUTRECS-YES         VALUE 'Y'.       02770024
025300         88  PS-STOP-WRITING-OUTRECS-NO          VALUE 'N'.       02780024
P47422     05  PS-INPUT-FILE-SW             PIC  X(01) VALUE 'N'.       02790024
P47422         88  PS-INPUT-I01-YES                    VALUE 'Y'.       02800024
P47422         88  PS-INPUT-I01-NO                     VALUE 'N'.       02810024
P47422     05  PS-WRITE-WRAP-SW             PIC  X(01) VALUE 'Y'.       02820024
P47422         88  PS-WRITE-WRAP-YES                   VALUE 'Y'.       02830024
P47422         88  PS-WRITE-WRAP-NO                    VALUE 'N'.       02840024
P47422     05  PS-END-OF-WRAP-RECS-SW       PIC  X(01) VALUE 'N'.       02850024
P47422         88  PS-END-OF-WRAP-RECS                 VALUE 'Y'.       02860024
P47422         88  PS-NOT-END-OF-WRAP-RECS             VALUE 'N'.       02870024
025400                                                                  02880024
025500 01  PV-SAVE-TTRNCDE-TABLE.                                       02890024
025600     05  FILLER OCCURS 4 TIMES.                                   02900024
025700         10 PV-SUB-CL-REQR-IND        PIC X(01).                  02910024
025800         10 PV-SKU-SEQ-REQR-IND       PIC X(01).                  02920024
025900         10 PV-PSTG-TYP-CDE           PIC X(02).                  02930024
026000         10 PV-TRN-TYP-CDE            PIC X(03).                  02940024
026100         10 PV-BTCH-SRC-CDE           PIC X(03).                  02950024
026200                                                                  02960024
026300 01  PA-ACCUMULATORS.                                             02970024
026400     05  PA-RECS-WRIT-THIS-PO         PIC 9(09) VALUE ZERO.       02980024
026500     05  PA-TOT-TAJPRRT-RECS-FOR-PO   PIC S9(04) VALUE +0 COMP.   02990024
026600     05  PA-PRORATE-REC-COUNT         PIC 9(09) VALUE ZERO.       03000024
026700     05  PA-TOT-RECS-WRIT             PIC 9(09) VALUE ZERO.       03010024
P47422     05  PA-TOT-WRAP-RECS-WRIT        PIC 9(09) VALUE ZERO.       03020024
026800     05  PA-TOTAL-CHARGES             PIC S9(11)V99 VALUE +0.     03030024
P47422     05  PA-TOTAL-WRAP-CHARGES        PIC S9(11)V99 VALUE +0.     03040024
026900     05  PA-TOTAL-CHARGES-THIS-PO     PIC S9(11)V99 VALUE +0.     03050024
027000     05  PA-TOTAL-CREDITS-THIS-PO     PIC S9(11)V99 VALUE +0.     03060024
027100     05  PA-TOTAL-CREDITS             PIC S9(11)V99 VALUE +0.     03070024
P47422     05  PA-TOTAL-WRAP-CREDITS        PIC S9(11)V99 VALUE +0.     03080024
027200     05  PA-ERR-INV-TRN               PIC 9(07) VALUE 0.          03090024
027300     05  PA-ERR-RCVR-PODC             PIC 9(07) VALUE 0.          03100024
027400     05  PA-ERR-RCVR-PO               PIC 9(07) VALUE 0.          03110024
027500     05  PA-ERR-LOC-NBR               PIC 9(07) VALUE 0.          03120024
027600     05  PA-ERR-REV-SEQ               PIC 9(07) VALUE 0.          03130024
027700     05  PA-ERR-VND-NBR               PIC 9(07) VALUE 0.          03140024
027800     05  PA-ERR-DOC-NBR               PIC 9(07) VALUE 0.          03150024
027900     05  PA-ERR-DOC-DTE               PIC 9(07) VALUE 0.          03160024
028000     05  PA-ERR-REC-TYP               PIC 9(07) VALUE 0.          03170024
028100     05  PA-ERR-DPT-NBR               PIC 9(07) VALUE 0.          03180024
028200     05  PA-ERR-ENT-ID                PIC 9(07) VALUE 0.          03190024
028300     05  PA-ERR-ENT-NME               PIC 9(07) VALUE 0.          03200024
028400     05  PA-ERR-CHG-AMT               PIC 9(07) VALUE 0.          03210024
028500     05  PA-ERR-TOTAL                 PIC 9(07) VALUE 0.          03220024
028600                                                                  03230024
028700 01  PV-VARIABLES.                                                03240024
028800     05  PV-SUB                       PIC 9 VALUE ZERO.           03250024
028900     05  PV-MEMO-LINE-CHRG.                                       03260024
029000         10  FILLER                   PIC X(33) VALUE             03270024
029100         'COMPLIANCE FRGT CHARGE : DEBIT # '.                     03280024
029200         10  PV-AP-DOC-NBR-CH         PIC X(16).                  03290024
029300         10  FILLER                   PIC X(01) VALUE '.'.        03300024
029400     05  PV-MEMO-LINE-CREDIT.                                     03310024
029500         10  FILLER                   PIC X(33) VALUE             03320024
029600         'COMPLIANCE FRGT CREDIT : DEBIT # '.                     03330024
029700         10  PV-AP-DOC-NBR-CR         PIC X(16).                  03340024
029800         10  FILLER                   PIC X(01) VALUE '.'.        03350024
029900     05  PV-MEMO-LINE-PO-CHRG.                                    03360024
030000         10  FILLER                   PIC X(36) VALUE             03370024
030100         'COMPLIANCE PO FILL CHARGE : DEBIT # '.                  03380024
030200         10  PV-AP-DOC-NBR-PO-CH      PIC X(16).                  03390024
030300         10  FILLER                   PIC X(01) VALUE '.'.        03400024
030400     05  PV-MEMO-LINE-PO-CREDIT.                                  03410024
030500         10  FILLER                   PIC X(36) VALUE             03420024
030600         'COMPLIANCE PO FILL CREDIT : DEBIT # '.                  03430024
030700         10  PV-AP-DOC-NBR-PO-CR      PIC X(16).                  03440024
030800         10  FILLER                   PIC X(01) VALUE '.'.        03450024
030900     05  PV-COMPLETE-LINE.                                        03460024
031000         10  FILLER                   PIC X(20) VALUE             03470024
031100         'PROCESSING COMPLETE '.                                  03480024
031200         10  PV-PROCESS-DATE          PIC X(10) VALUE SPACES.     03490024
031300     05  PV-DIFFERENCE                PIC S9(11)V99 VALUE +0.     03500024
031400     05  PV-SIGNED-FIELD              PIC S9(11)V99 VALUE +0.     03510024
031500     05  PV-VL049-TOT-FRGT-SIGNED     PIC S9(09)V99 VALUE +0.     03520024
031600     05  PV-ADJUSTED-FIELD            PIC S9(11)V99 VALUE +0.     03530024
031700     05  PV-ADJUSTED-TOT-FOR-PO       PIC S9(11)V99 VALUE +0.     03540024
031800     05  PV-ADJ-GRAND-CHARGE          PIC S9(11)V99 VALUE +0.     03550024
031900     05  PV-ADJ-GRAND-CREDIT          PIC S9(11)V99 VALUE +0.     03560024
032000     05  PV-LOCATION-DC               PIC S9(04)    VALUE +0.     03570024
032100     05  PV-VL049-PO-NBR-COMP         PIC S9(09) COMP.            03580024
032200     05  PV-VL049-LOCATION-COMP       PIC S9(04) COMP.            03590024
032300     05  PV-DISP-TALLY                PIC  9(04) VALUE  0.        03600024
032400     05  PV-DISP-ADJUSTED-FIELD       PIC -ZZZZZZZZ9.99.          03610024
032500                                                                  03620024
032600     05  PV-READ-COUNT                PIC S9(07)    VALUE +0.     03630024
P47422     05  PV-WRAP-READ-COUNT           PIC S9(07)    VALUE +0.     03640024
P47422     05  PV-MAX-WRAP-DAYS             PIC S9(09) VALUE +0 COMP.   03650024
032700***  THESE ARE TALLIED IN THE PROGRAM                             03660024
032800***  PV-COMPARE-DOLLAR-AMT = CHARGES + CREDITS (NET AMT = GRS AMT)03670024
032900     05  PV-COMPARE-TOTALS.                                       03680024
033000         10  PV-COMPARE-REC-CNT       PIC S9(11)    VALUE +0.     03690024
033100         10  PV-COMPARE-DOLLAR-AMT    PIC S9(11)V99 VALUE +0.     03700024
033200         10  PV-COMPARE-CHARGE-AMT    PIC S9(11)V99 VALUE +0.     03710024
033300         10  PV-COMPARE-CREDIT-AMT    PIC S9(11)V99 VALUE +0.     03720024
033400***  THESE ARE SENT FROM CMS AS VALUES IN THE FIRST REC OF INPUT  03730024
033500***  THE FIRST RECORD OF THE INPUT IS THE CONTROL RECORD.         03740024
033600     05  PV-CMS-CTL-TOTALS.                                       03750024
033700         10  PV-CMS-CTL-REC-CNT-TOT   PIC S9(11)    VALUE +0.     03760024
033800         10  PV-CMS-CTL-REC-CNT       PIC S9(11)    VALUE +0.     03770024
033900         10  PV-CMS-CTL-CHARGE-AMT    PIC S9(11)V99 VALUE +0.     03780024
034000         10  PV-CMS-CTL-CREDIT-AMT    PIC S9(11)V99 VALUE +0.     03790024
034100                                                                  03800024
034200     05  PV-CALC-DOLLAR-AMT           PIC S9(11)V99 VALUE +0.     03810024
034300     05  PV-CALC-REC-CNT              PIC S9(11)    VALUE +0.     03820024
034400     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    03830024
034500     05  PV-DB2-TEXT                  PIC  X(60) VALUE SPACES.    03840024
034600     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    03850024
034700     05  PV-DB2-TABLE-1               PIC  X(20) VALUE SPACES.    03860024
034800     05  PV-DB2-TABLE-2               PIC  X(20) VALUE SPACES.    03870024
034900     05  PV-DISP-NUMBER               PIC  ZZ,ZZZ,ZZZ,ZZ9.        03880024
035000     05  PV-DISP-DOLLAR               PIC  ZZ,ZZZ,ZZZ,ZZ9.99-.    03890024
035100     05  PV-RUN-TIME                  PIC  X(08) VALUE SPACES.    03900024
035200     05  PV-LINE-CNT                  PIC S9(03) VALUE +70.       03910024
035300     05  PV-PAGE-CNT                  PIC S9(07) VALUE +0.        03920024
035400                                                                  03930024
035500     05  PV-HOLD-SEQ                  PIC  9(04).                 03940024
035600     05  PV-HOLD-SEQ-PARTS REDEFINES PV-HOLD-SEQ.                 03950024
035700         10  PV-HOLD-SEQ-PART1        PIC  9(01).                 03960024
035800         10  PV-HOLD-SEQ-PART2        PIC  9(01).                 03970024
035900         10  PV-HOLD-SEQ-PART3        PIC  9(01).                 03980024
036000         10  PV-HOLD-SEQ-PART4        PIC  9(01).                 03990024
036100                                                                  04000024
036200     05  PV-FIELD-SIGNS               PIC  X(01) VALUE ' '.       04010024
036300         88  PV-VALID-SIGNS                VALUE ' ', '-'.        04020024
036400         88  PV-POSITIVE                   VALUE ' '.             04030024
036500         88  PV-NEGATIVE                   VALUE '-'.             04040024
036600                                                                  04050024
036700     05  PV-TEMP-SEQ.                                             04060024
036800         10  PV-TEMP-SEQ-PART1        PIC  X(01).                 04070024
036900         10  PV-TEMP-SEQ-PART2        PIC  X(01).                 04080024
037000         10  PV-TEMP-SEQ-PART3        PIC  X(01).                 04090024
037100         10  PV-TEMP-SEQ-PART4        PIC  X(01).                 04100024
037200     05  PV-DOC-NBR-SEQ               PIC  X(16) VALUE SPACES.    04110024
037300     05  PV-ERROR-MSG                 PIC  X(30) VALUE SPACES.    04120024
037400     05  PV-TITLE-POFILL              PIC  X(39) VALUE            04130024
037500         'CN - PO FILL DEDUCTION FILE DATA ERRORS'.               04140024
037600     05  PV-TITLE-FREIGHT             PIC  X(39) VALUE            04150024
037700         'CN - FREIGHT DEDUCTION FILE DATA ERRORS'.               04160024
037800     05  PV-DTL-POFILL                PIC  X(08) VALUE 'PO FILL'. 04170024
037900     05  PV-DTL-FREIGHT               PIC  X(08) VALUE 'FREIGHT'. 04180024
038000     05  PV-DTL-DC                    PIC  X(02) VALUE 'DC'.      04190024
038100     05  PV-DTL-NBR                   PIC  X(03) VALUE 'NBR'.     04200024
038200     05  PV-DTL-LOC                   PIC  X(03) VALUE 'LOC'.     04210024
038300     05  PV-ERROR-FOUND               PIC  X(01) VALUE 'N'.       04220024
038400     05  PV-NUMBER-CHAR4              PIC  X(04).                 04230024
038500     05  PV-NUMBER-CHAR4-RED          REDEFINES PV-NUMBER-CHAR4.  04240024
038600         10  PV-NUMBER-PIC4           PIC  9(04).                 04250024
038700     05  PV-NUMBER-PIC5               PIC  9(05).                 04260024
038800     05  PV-NUMBER-PIC5-RED           REDEFINES PV-NUMBER-PIC5.   04270024
038900         10  PV-NBR-CHAR4             PIC  X(04).                 04280024
039000         10  PV-NBR-CHAR1             PIC  X(01).                 04290024
039100     05  PV-NUMBER-PIC5-RED2          REDEFINES PV-NUMBER-PIC5.   04300024
039200         10  PV-NUMBER-CHAR5          PIC  X(05).                 04310024
039300     05  PV-NUMBER-CHAR9              PIC  X(09).                 04320024
039400     05  PV-NUMBER-CHAR9-RED          REDEFINES PV-NUMBER-CHAR9.  04330024
039500         10  PV-NUMBER-PIC9           PIC  9(07)V99.              04340024
039600     05  PV-HOLD-FIELDS.                                          04350024
039700         10  PV-MDSEAR-MDSELV-CDE                                 04360024
039800                                 PIC  X(03)     VALUE SPACES.     04370024
039900         10  PV-MDSEAR-MAJ-CL-CDE                                 04380024
040000                                 PIC  X(02)     VALUE SPACES.     04390024
040100         10  PV-MDSEAR-SUB-CL-CDE                                 04400024
040200                                 PIC  X(03)     VALUE SPACES.     04410024
040300         10  PV-DB2-CL-NBR.                                       04420024
040400             15  FILLER          PIC  X         VALUE ZEROES.     04430024
040500             15  PV-CL-NBR.                                       04440024
040600                 20  PV-MAJ-IND  PIC  X         VALUE SPACES.     04450024
040700                 20  PV-SUB-IND  PIC  X         VALUE SPACES.     04460024
P47422     05  PV-PRC-CNT-DROPPED.                                      04470024
P47422         10  PV-PRC-CNT          PIC  X(02)     VALUE SPACE.      04480024
P47422         10  PV-WRAP-DROP-IND    PIC  X(01)     VALUE 'D'.        04490024
      *CHG0211865                                                       04500024
           05 PV-TEMP-DOC-NBR          PIC  X(8)      VALUE SPACE.      04510024
           05 PV-DOC-NBR               PIC  X(16)     VALUE SPACE.      04520024
           05 PV-DOC-DTE.                                               04530024
               10 PV-DTE-YY            PIC  X(2)      VALUE SPACES.     04540024
               10 PV-DTE-MM            PIC  X(2)      VALUE SPACES.     04550024
               10 PV-DTE-DD            PIC  X(2)      VALUE SPACES.     04560024
      *CHG0211865                                                       04570024
040900                                                                  04580024
041000 01  HL1-HEADING-LINE-1.                                          04590024
041100     05  FILLER                          PIC  X(03)  VALUE SPACE. 04600024
041200     05  HL1-RUN-DATE.                                            04610024
041300         10  HL1-RUN-MONTH               PIC  9(02)  VALUE ZERO.  04620024
041400         10  FILLER                      PIC  X(01)  VALUE '/'.   04630024
041500         10  HL1-RUN-DAY                 PIC  9(02)  VALUE ZERO.  04640024
041600         10  FILLER                      PIC  X(01)  VALUE '/'.   04650024
041700         10  HL1-RUN-YEAR                PIC  9(02)  VALUE ZERO.  04660024
041800     05  FILLER                          PIC  X(02)  VALUE SPACE. 04670024
041900     05  HL1-RUN-TIME.                                            04680024
042000         10  HL1-RUN-HOUR                PIC  9(02)  VALUE ZERO.  04690024
042100         10  FILLER                      PIC  X(01)  VALUE ':'.   04700024
042200         10  HL1-RUN-MINUTE              PIC  9(02)  VALUE ZERO.  04710024
042300     05  FILLER                          PIC  X(27)  VALUE SPACE. 04720024
042400     05  FILLER                          PIC  X(45)  VALUE        04730024
042500         'K O H L S   D E P A R T M E N T   S T O R E S'.         04740024
042600     05  FILLER                          PIC  X(20)  VALUE SPACE. 04750024
042700     05  HL1-PGM-NME                     PIC  X(08)  VALUE SPACE. 04760024
042800     05  FILLER                          PIC  X(01)  VALUE '-'.   04770024
042900     05  HL1-RPT-NBR                     PIC  9(01)  VALUE ZERO.  04780024
043000     05  FILLER                          PIC  X(02)  VALUE SPACE. 04790024
043100     05  FILLER                          PIC  X(04)  VALUE 'PAGE'.04800024
043200     05  FILLER                          PIC  X(01)  VALUE SPACE. 04810024
043300     05  HL1-PG-NBR                      PIC ZZZZ9   VALUE ZERO.  04820024
043400                                                                  04830024
043500 01  HL2-HEADING-LINE-2.                                          04840024
043600     05  FILLER                          PIC  X(49)  VALUE SPACE. 04850024
043700     05  HL2-TITLE                       PIC  X(39).              04860024
043800     05  FILLER                          PIC  X(44)  VALUE SPACE. 04870024
043900                                                                  04880024
044000 01  DH1-DETAIL-HEADING-1.                                        04890024
044100     05  FILLER                          PIC  X(70) VALUE SPACES. 04900024
044200     05  FILLER                          PIC  X(04) VALUE         04910024
044300         'RVSL'.                                                  04920024
044400     05  FILLER                          PIC  X(02) VALUE SPACES. 04930024
044500     05  FILLER                          PIC  X(02) VALUE         04940024
044600         'AP'.                                                    04950024
044700     05  FILLER                          PIC  X(03) VALUE SPACES. 04960024
044800     05  DH1-CHRG-TITLE1                 PIC  X(07).              04970024
044900     05  FILLER                          PIC  X(02) VALUE SPACES. 04980024
045000     05  DH1-CHRG-TITLE2                 PIC  X(07).              04990024
045100     05  FILLER                          PIC  X(02) VALUE SPACES. 05000024
045200                                                                  05010024
045300 01  DH2-DETAIL-HEADING-2.                                        05020024
045400     05  FILLER                          PIC  X(11) VALUE SPACES. 05030024
045500     05  FILLER                          PIC  X(06) VALUE         05040024
045600         'VENDOR'.                                                05050024
045700     05  FILLER                          PIC  X(36) VALUE SPACES. 05060024
045800     05  FILLER                          PIC  X(11) VALUE         05070024
045900         'AP DOCUMENT'.                                           05080024
046000     05  FILLER                          PIC  X(06) VALUE SPACES. 05090024
046100     05  FILLER                          PIC  X(03) VALUE         05100024
046200         'SEQ'.                                                   05110024
046300     05  FILLER                          PIC  X(03) VALUE SPACES. 05120024
046400     05  FILLER                          PIC  X(03) VALUE         05130024
046500         'TRN'.                                                   05140024
046600     05  FILLER                          PIC  X(02) VALUE SPACES. 05150024
046700     05  FILLER                          PIC  X(06) VALUE         05160024
046800         'CHARGE'.                                                05170024
046900     05  FILLER                          PIC  X(03) VALUE SPACES. 05180024
047000     05  FILLER                          PIC  X(06) VALUE         05190024
047100         'CHARGE'.                                                05200024
047200     05  FILLER                          PIC  X(03) VALUE SPACES. 05210024
047300     05  DH2-DC-TITLE                    PIC  X(02).              05220024
P47422     05  FILLER                          PIC  X(03) VALUE SPACES. 05230024
P47422     05  FILLER                          PIC  X(03) VALUE         05240024
P47422         'PRC'.                                                   05250024
047400     05  FILLER                          PIC  X(07) VALUE SPACES. 05260024
047500                                                                  05270024
047600 01  DH3-DETAIL-HEADING-3.                                        05280024
047700     05  FILLER                          PIC  X(06) VALUE         05290024
047800         'PO NBR'.                                                05300024
047900     05  FILLER                          PIC  X(05) VALUE SPACES. 05310024
048000     05  FILLER                          PIC  X(06) VALUE         05320024
048100         'NUMBER'.                                                05330024
048200     05  FILLER                          PIC  X(05) VALUE SPACES. 05340024
048300     05  FILLER                          PIC  X(11) VALUE         05350024
048400         'VENDOR NAME'.                                           05360024
048500     05  FILLER                          PIC  X(20) VALUE SPACES. 05370024
048600     05  FILLER                          PIC  X(06) VALUE         05380024
048700         'NUMBER'.                                                05390024
048800     05  FILLER                          PIC  X(11) VALUE SPACES. 05400024
048900     05  FILLER                          PIC  X(03) VALUE         05410024
049000         'NBR'.                                                   05420024
049100     05  FILLER                          PIC  X(03) VALUE SPACES. 05430024
049200     05  FILLER                          PIC  X(03) VALUE         05440024
049300         'CDE'.                                                   05450024
049400     05  FILLER                          PIC  X(02) VALUE SPACES. 05460024
049500     05  FILLER                          PIC  X(04) VALUE         05470024
049600         'SIGN'.                                                  05480024
049700     05  FILLER                          PIC  X(05) VALUE SPACES. 05490024
049800     05  FILLER                          PIC  X(06) VALUE         05500024
049900         'AMOUNT'.                                                05510024
050000     05  FILLER                          PIC  X(03) VALUE SPACES. 05520024
050100     05  DH3-DC-TITLE                    PIC  X(03).              05530024
050200     05  FILLER                          PIC  X(02) VALUE SPACES. 05540024
P47422     05  FILLER                          PIC  X(03) VALUE         05550024
P47422         'CNT'.                                                   05560024
P47422     05  FILLER                          PIC  X(01) VALUE SPACES. 05570024
050300     05  FILLER                          PIC  X(13) VALUE         05580024
050400         'ERROR MESSAGE'.                                         05590024
050500     05  FILLER                          PIC  X(02) VALUE SPACES. 05600024
050600                                                                  05610024
050700 01  DL-DETAIL-LINE.                                              05620024
050800     05  DL-PO-NBR                       PIC  X(09).              05630024
050900     05  FILLER                          PIC  X(02)  VALUE SPACES.05640024
051000     05  DL-VENDOR-NBR                   PIC  X(09).              05650024
051100     05  FILLER                          PIC  X(02)  VALUE SPACES.05660024
051200     05  DL-VENDOR-NAME                  PIC  X(30).              05670024
051300     05  FILLER                          PIC  X(01)  VALUE SPACES.05680024
051400     05  DL-DOC-NBR                      PIC  X(16).              05690024
051500     05  FILLER                          PIC  X(01)  VALUE SPACES.05700024
051600     05  DL-RVSL-SEQ-NBR                 PIC  9999.               05710024
051700     05  FILLER                          PIC  X(02)  VALUE SPACES.05720024
051800     05  DL-TRN-CDE                      PIC  X(02).              05730024
051900     05  FILLER                          PIC  X(03)  VALUE SPACES.05740024
052000     05  DL-CHG-SIGN                     PIC  X(01).              05750024
052100     05  FILLER                          PIC  X(02)  VALUE SPACES.05760024
052200     05  DL-CHG-AMT                      PIC  Z,ZZZ,ZZ9.99.       05770024
052300     05  FILLER                          PIC  X(02)  VALUE SPACES.05780024
052400     05  DL-DC-NBR                       PIC  X(05).              05790024
052500     05  FILLER                          PIC  X(01)  VALUE SPACES.05800024
P47422     05  DL-PRC-CNT                      PIC  X(03)  VALUE SPACES.05810024
P47422     05  FILLER                          PIC  X(01)  VALUE SPACES.05820024
052600     05  DL-ERROR-MSG                    PIC  X(30).              05830024
052700                                                                  05840024
052800 01  TT-TOTAL-TITLE.                                              05850024
052900     05  FILLER                          PIC  X(04)  VALUE SPACES.05860024
053000     05  TT-MESSAGE                      PIC  X(19)  VALUE        05870024
053100         'ERROR COUNT TOTALS:'.                                   05880024
053200     05  FILLER                          PIC  X(29)  VALUE SPACES.05890024
053300                                                                  05900024
053400 01  TL-TOTAL-LINE.                                               05910024
053500     05  FILLER                          PIC  X(04)  VALUE SPACES.05920024
053600     05  TL-ERROR-MESSAGE                PIC  X(30).              05930024
053700     05  FILLER                          PIC  X(07)  VALUE SPACES.05940024
053800     05  TL-ERROR-CNT                    PIC  ZZZ,ZZ9.            05950024
053900     05  FILLER                          PIC  X(29)  VALUE SPACES.05960024
054000                                                                  05970024
054100 01  BLANK-LINE.                                                  05980024
054200     05  FILLER                          PIC  X(132) VALUE SPACE. 05990024
054300                                                                  06000024
054400 01  END-OF-REPORT-LINE.                                          06010024
054500     05  FILLER                          PIC  X(53)  VALUE SPACE. 06020024
054600     05  FILLER                          PIC  X(26)  VALUE        06030024
054700         '***** END OF REPORT *****'.                             06040024
054800     05  FILLER                          PIC  X(54)  VALUE SPACE. 06050024
054900                                                                  06060024
055000 01  NO-OUTPUT-LINE.                                              06070024
055100     05  FILLER                          PIC  X(53)  VALUE SPACE. 06080024
055200     05  FILLER                          PIC  X(30)  VALUE        06090024
055300         '***** NO ERRORS FOUND *****'.                           06100024
055400                                                                  06110024
055500*** COPYBOOK FOR FILE FROM CMS                                    06120024
055600     COPY VLRD049.                                                06130024
055700                                                                  06140024
055800*** COPYBOOK FOR AP ADJUSTMENT FILE                               06150024
055900     COPY APRD045.                                                06160024
056000                                                                  06170024
056100*** COPYBOOK FOR LINKAGE SECION FOR DPKUT150                      06180024
056200     COPY APWS150.                                                06190024
056300                                                                  06200024
056400*** COPYBOOK FOR CALENDAR ROUTINE                                 06210024
056500     COPY DPWS500.                                                06220024
056600                                                                  06230024
056700*** COPYBOOK FOR NUMERIC EDIT ROUTINE                             06240024
056800     COPY DPWS010I.                                               06250024
056900                                                                  06260024
057000***STANDARD REPORT HEADER FOR A 132 COLUMN REPORT.                06270024
057100     COPY DPWS132O.                                               06280024
057200                                                                  06290024
057300     COPY DPWS004.                                                06300024
057400                                                                  06310024
057500     EXEC SQL                                                     06320024
057600         INCLUDE SQLCA                                            06330024
057700     END-EXEC.                                                    06340024
057800                                                                  06350024
057900     COPY SQLCA2.                                                 06360024
058000                                                                  06370024
058100     EXEC SQL                                                     06380024
058200         INCLUDE TAPCNTL                                          06390024
058300     END-EXEC.                                                    06400024
058400                                                                  06410024
058500     EXEC SQL                                                     06420024
058600         INCLUDE TTRNCDE                                          06430024
058700     END-EXEC.                                                    06440024
058800                                                                  06450024
058900     EXEC SQL                                                     06460024
059000         INCLUDE TAJPRRT                                          06470024
059100     END-EXEC.                                                    06480024
059200                                                                  06490024
P47422***********************************************************       06500024
P47422*  TKRPRPM TABLE                                          *       06510024
P47422***********************************************************       06520024
P47422     EXEC SQL                                                     06530024
P47422          INCLUDE TKRPRPM                                         06540024
P47422     END-EXEC.                                                    06550024
P47422                                                                  06560024
059300*****************  DCLGEN FOR TRECEIV                             06570024
059400     EXEC SQL                                                     06580024
059500         INCLUDE TRECEIV                                          06590024
059600     END-EXEC.                                                    06600024
059700                                                                  06610024
059800*****************  DCLGEN FOR XLT_LOC                             06620024
059900     EXEC SQL                                                     06630024
060000         INCLUDE XLT00010                                         06640024
060100     END-EXEC.                                                    06650024
060200*****************  DCLGEN FOR TMDSEAR                             06660024
060300     EXEC SQL                                                     06670024
060400         INCLUDE TMDSEAR                                          06680024
060500     END-EXEC.                                                    06690024
060600*****************  DCLGEN FOR XLT_VND_STYL                        06700024
060700     EXEC SQL                                                     06710024
060800         INCLUDE XLT00004                                         06720024
060900     END-EXEC.                                                    06730024
061000*****************  DCLGEN FOR XLT_SKU                             06740024
061100     EXEC SQL                                                     06750024
061200         INCLUDE XLT00003                                         06760024
061300     END-EXEC.                                                    06770024
061400                                                                  06780024
061500                                                                  06790024
061600*--------------------------------------------------------------*  06800024
061700*  PRORATION_CSR FOR TAJPRRT TABLE                             *  06810024
061800*--------------------------------------------------------------*  06820024
061900     EXEC SQL                                                     06830024
062000       DECLARE PRORATION_CSR CURSOR FOR                           06840024
062100       SELECT PO_NBR                                              06850024
062200            , RCVR_SEQ_NBR                                        06860024
062300            , PO_LNE_NBR                                          06870024
062400            , DEPT_NBR                                            06880024
062500            , CL_NBR                                              06890024
062600            , SKU_NBR                                             06900024
062700            , STR_NBR                                             06910024
062800            , PRRT_PCT                                            06920024
062900         FROM TAJPRRT                                             06930024
063000        WHERE PO_NBR = :PV-VL049-PO-NBR-COMP                      06940024
063100     END-EXEC.                                                    06950024
063200                                                                  06960024
063300                                                                  06970024
063400 LINKAGE SECTION.                                                 06980024
063500                                                                  06990024
063600 PROCEDURE DIVISION.                                              07000024
063700                                                                  07010024
063800 0000-MAINLINE.                                                   07020024
063900     PERFORM 1000-INITIALIZE                                      07030024
064000     PERFORM 2000-PROCESS-INPUT                                   07040024
064100         UNTIL PS-END-INPUT.                                      07050024
P47422     MOVE CMS-EXTRACT-WRAP-RECORD TO VL049-AP-INTERFACE-RECORD.   07060024
P47422     SET PS-INPUT-I01-NO TO TRUE.                                 07070024
P47422     PERFORM 2000-PROCESS-INPUT                                   07080024
P47422         UNTIL PS-END-OF-WRAP-RECS.                               07090024
064200     IF PV-CALC-REC-CNT > 0                                       07100024
064300         PERFORM 3100-WRITE-CONTROL-RECORD.                       07110024
064400     PERFORM 9000-EOJ.                                            07120024
064500     GOBACK.                                                      07130024
064600                                                                  07140024
064700 1000-INITIALIZE.                                                 07150024
064800     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           07160024
064900                                                                  07170024
065000     DISPLAY '*********************************************'      07180024
065100     DISPLAY '*******  CONTROL CARD ====>  ' CC-CONTROL-CARD.     07190024
065200                                                                  07200024
065300     PERFORM 1050-VALIDATE-CONTROL-CARD.                          07210024
065400     IF CC-TYPE-RUN = 'PO'                                        07220024
065500         MOVE PV-TITLE-POFILL       TO HL2-TITLE                  07230024
065600         MOVE PV-DTL-POFILL         TO DH1-CHRG-TITLE1            07240024
065700         MOVE PV-DTL-POFILL         TO DH1-CHRG-TITLE2            07250024
065800         MOVE '  '                  TO DH2-DC-TITLE               07260024
065900         MOVE PV-DTL-LOC            TO DH3-DC-TITLE               07270024
066000         MOVE 2                     TO HL1-RPT-NBR                07280024
066100     ELSE                                                         07290024
066200         MOVE PV-TITLE-FREIGHT      TO HL2-TITLE                  07300024
066300         MOVE PV-DTL-FREIGHT        TO DH1-CHRG-TITLE1            07310024
066400         MOVE PV-DTL-FREIGHT        TO DH1-CHRG-TITLE2            07320024
066500         MOVE PV-DTL-DC             TO DH2-DC-TITLE               07330024
066600         MOVE PV-DTL-NBR            TO DH3-DC-TITLE               07340024
066700         MOVE 1                     TO HL1-RPT-NBR                07350024
066800     END-IF.                                                      07360024
066900                                                                  07370024
067000     MOVE PC-CURRENT-PGM-VLKUT047   TO HL1-PGM-NME.               07380024
067100     ACCEPT SD-SYSTEM-DATE FROM DATE.                             07390024
067200     MOVE SD-SYSTEM-MONTH     TO  HL1-RUN-MONTH.                  07400024
067300     MOVE SD-SYSTEM-DAY       TO  HL1-RUN-DAY.                    07410024
067400     MOVE SD-SYSTEM-YEAR      TO  HL1-RUN-YEAR.                   07420024
067500     ACCEPT ST-SYSTEM-TIME FROM TIME.                             07430024
067600     MOVE ST-SYSTEM-HOUR      TO  HL1-RUN-HOUR.                   07440024
067700     MOVE ST-SYSTEM-MINUTE    TO  HL1-RUN-MINUTE.                 07450024
067800                                                                  07460024
067900*****TIME IS CONTAINED WITHIN CURRENT-DATE IN POSITION 9 FOR 8    07470024
068000     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME.              07480024
068100                                                                  07490024
068200     DISPLAY '*******  RUN TIME ====> '  PV-RUN-TIME.             07500024
068300     DISPLAY '*********************************************'      07510024
068400     DISPLAY ' '.                                                 07520024
068500                                                                  07530024
068600***** BEFORE CREATING AN AP FILE, DETAIL RECORDS WILL BE TOTALED  07540024
068700***** IF RECORD COUNTS, FRGT CHARGE AMT AND REVERSAL AMOUNTS ON   07550024
068800***** THE CONTROL RECORD MATCH, PROCESSING CAN CONTINUE,          07560024
068900***** ELSE ABEND.                                                 07570024
069000     OPEN INPUT CMS-EXT-FILE.                                     07580024
P47422     OPEN INPUT CMS-WRAP-RECORD-FILE.                             07590024
P47422     OPEN OUTPUT CMS-WRAP-ERROR-FILE.                             07600024
069100                                                                  07610024
069200     INITIALIZE VL049-AP-INTERFACE-RECORD.                        07620024
069300     INITIALIZE AP045-KEY-FIELDS                                  07630024
069400                AP045-COMMON-FIELDS                               07640024
069500                AP045-DETAIL-FIELDS.                              07650024
069600     MOVE 0 TO PA-PRORATE-REC-COUNT                               07660024
069700               PV-COMPARE-REC-CNT                                 07670024
069800               PV-COMPARE-DOLLAR-AMT                              07680024
069900               PV-COMPARE-CHARGE-AMT                              07690024
070000               PV-COMPARE-CREDIT-AMT.                             07700024
070100                                                                  07710024
P47422     INITIALIZE PA-TOT-WRAP-RECS-WRIT                             07720024
P47422                PV-WRAP-READ-COUNT.                               07730024
P47422     SET PS-INPUT-I01-NO          TO TRUE.                        07740024
P47422     PERFORM 8700-READ-INPUT-I02.                                 07750024
P47422     MOVE CMS-EXTRACT-WRAP-RECORD TO                              07760024
P47422          VL049-AP-INTERFACE-RECORD.                              07770024
P47422     IF PS-NOT-END-OF-WRAP-RECS                                   07780024
P47422        PERFORM 8800-GET-WRAP-ERROR-DAYS                          07790024
P47422        PERFORM 1100-CHECK-INPUT                                  07800024
P47422             UNTIL PS-END-OF-WRAP-RECS                            07810024
P47422     END-IF.                                                      07820024
P47422     SET PS-INPUT-I01-YES                                         07830024
P47422         PS-NOT-END-OF-WRAP-RECS  TO TRUE.                        07840024
P47422     CLOSE CMS-WRAP-RECORD-FILE.                                  07850024
P47422     OPEN INPUT CMS-WRAP-RECORD-FILE.                             07860024
P47422     INITIALIZE PV-WRAP-READ-COUNT.                               07870024
P47422     PERFORM 8700-READ-INPUT-I02.                                 07880024
070200     PERFORM 8000-READ-INPUT.                                     07890024
070300*    IF PS-NOT-END-INPUT                                          07900024
070400         IF VL049-CONTROL-RECORD AND                              07910024
070500             VL049-CTL-RECORD-COUNT = 0                           07920024
070600******* THIS MEANS THERE WERE NO CHARGES OR CREDITS. CMS SENT     07930024
070700******* ONLY CONTROL RECORD WITH A ZERO RECORD COUNT              07940024
070800******* CMS WILL ALWAYS SEND AT LEAST A CONTROL RECORD, THEY WILL 07950024
070900******* NEVER SEND TOTALLY EMPTY FILE.  IF THAT HAPPENS IT'S A    07960024
071000******* PROBLEM ON THEIR SIDE.                                    07970024
071100             SET PS-END-INPUT TO TRUE                             07980024
P47422          IF PS-END-OF-WRAP-RECS                                  07990024
P47422             CLOSE CMS-EXT-FILE                                   08000024
P47422             SET PS-CNTL-ONLY TO TRUE                             08010024
071400*            DISPLAY '*****************************************'  08020024
071500*            DISPLAY '*************   EMPTY   FILE  ***********'  08030024
071600*            DISPLAY '** PROGRAM = VLKUT047                    '  08040024
071700*            DISPLAY '** PARAGRAPH = 1000-INITIALIZE           '  08050024
071800*            DISPLAY '** NO CHARGES OR CREDITS -- OUT01   EMPTY'  08060024
071900*            DISPLAY '*****************************************'  08070024
P47422          END-IF                                                  08080024
P47422                 OPEN OUTPUT AP-TRANSACTION-FILE                  08090024
P47422                             AP-COMPLETE-FILE                     08100024
P47422                             AP-ERROR-FILE                        08110024
072000         ELSE                                                     08120024
072100             PERFORM 1100-CHECK-INPUT                             08130024
072200                 UNTIL PS-END-INPUT                               08140024
072300             PERFORM 1350-CHECK-TOTALS                            08150024
072400*            IF PS-AMOUNTS-MATCH                                  08160024
072500                 CLOSE CMS-EXT-FILE                               08170024
072600                 SET PS-NOT-END-INPUT TO TRUE                     08180024
072700                 INITIALIZE PA-TOTAL-CHARGES                      08190024
072800                            PA-TOTAL-CHARGES-THIS-PO              08200024
072900                            PA-TOTAL-CREDITS-THIS-PO              08210024
073000                            PA-TOTAL-CREDITS                      08220024
073100                            PA-TOT-RECS-WRIT                      08230024
073200                            PV-READ-COUNT                         08240024
073300                 OPEN INPUT CMS-EXT-FILE                          08250024
073400                 OPEN OUTPUT AP-TRANSACTION-FILE                  08260024
073500                             AP-COMPLETE-FILE                     08270024
073600                             AP-ERROR-FILE                        08280024
073700                                                                  08290024
073800                 INITIALIZE VL049-AP-INTERFACE-RECORD             08300024
073900*                READ CONTROL RECORD                              08310024
074000                 PERFORM 8000-READ-INPUT                          08320024
074100                 PERFORM 7000-SELECT-TAPCNTL                      08330024
074200                                                                  08340024
074300                 INITIALIZE DCLTTRNCDE                            08350024
074400                 MOVE '3H'            TO TRNCDE-AP-TRN-CDE        08360024
074500                 MOVE 1               TO PV-SUB                   08370024
074600                 PERFORM 7050-SELECT-TTRNCDE                      08380024
074700                                                                  08390024
074800                 INITIALIZE DCLTTRNCDE                            08400024
074900                 MOVE '3I'            TO TRNCDE-AP-TRN-CDE        08410024
075000                 MOVE 2               TO PV-SUB                   08420024
075100                 PERFORM 7050-SELECT-TTRNCDE                      08430024
075200                                                                  08440024
075300                 INITIALIZE DCLTTRNCDE                            08450024
075400                 MOVE '3U'            TO TRNCDE-AP-TRN-CDE        08460024
075500                 MOVE 3               TO PV-SUB                   08470024
075600                 PERFORM 7050-SELECT-TTRNCDE                      08480024
075700                                                                  08490024
075800                 INITIALIZE DCLTTRNCDE                            08500024
075900                 MOVE '3V'            TO TRNCDE-AP-TRN-CDE        08510024
076000                 MOVE 4               TO PV-SUB                   08520024
076100                 PERFORM 7050-SELECT-TTRNCDE                      08530024
076200*                READ FIRST DATA RECORD                           08540024
076300                 PERFORM 8000-READ-INPUT                          08550024
076400*            END-IF                                               08560024
076500         END-IF.                                                  08570024
076600*    ELSE                                                         08580024
076700******* THIS MEANS A VERY BAD ERROR ON CN SIDE --                 08590024
076800******* ONLY THEY CAN DETERMINE WHY A COMPLETELY EMPTY FILE CAME  08600024
076900*        DISPLAY '***********************************************'08610024
077000*        DISPLAY '*************   EMPTY   FILE   ****************'08620024
077100*        DISPLAY '** ABEND                                       '08630024
077200*        DISPLAY '** PROGRAM = VLKUT047                          '08640024
077300*        DISPLAY '** PARAGRAPH = 1000-INITIALIZE                 '08650024
077400*        DISPLAY '** THIS IS VERY BAD ERROR ON THE SIDE OF CN    '08660024
077500*        DISPLAY '** NO CHARGES OR CREDITS -- OUT01 WILL BE EMPTY'08670024
077600*        DISPLAY '***********************************************'08680024
077700*        CLOSE CMS-EXT-FILE                                       08690024
077800*        MOVE +4008 TO ABEND-CODE                                 08700024
077900*        CALL 'ILBOABN0' USING ABEND-CODE                         08710024
078000*    END-IF.                                                      08720024
078100                                                                  08730024
078200******************************************************************08740024
078300**  VALIDATE THE DATE FROM THE SCHEDULE                           08750024
078400******************************************************************08760024
078500 1050-VALIDATE-CONTROL-CARD.                                      08770024
078600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              08780024
078700     SET DPG51-FISCAL-454-CALENDAR                                08790024
078800         DPG51-DO-NOT-INCR-DECR-DATE                              08800024
078900         DPG52-LK-DTE-ISO           TO TRUE.                      08810024
079000                                                                  08820024
079100     MOVE CC-SCHEDULE-DATE     TO DPG52-LK-DATE-INPUT.            08830024
079200                                                                  08840024
079300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      08850024
079400             DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 08860024
079500                                                                  08870024
079600     IF DPG54-NO-ERROR                                            08880024
079700         MOVE CC-SCHEDULE-DATE     TO PV-PROCESS-DATE             08890024
079800     ELSE                                                         08900024
079900         DISPLAY '** ABEND **'                                    08910024
080000         DISPLAY '** PROGRAM = VLKUT047 -- CALLED MODULE '        08920024
080100                  'DPKUT500 **'                                   08930024
080200         DISPLAY '** PARAGRAPH = 1050-VALIDATE-CONTROL-CARD **'   08940024
080300         DISPLAY '** INVALID SCHEDULE DATE: ' CC-SCHEDULE-DATE    08950024
080400         DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '        08960024
080500         DISPLAY DPG54-ERROR-MESSAGE                              08970024
080600         MOVE +4003 TO ABEND-CODE                                 08980024
080700         CALL 'ILBOABN0' USING ABEND-CODE                         08990024
080800     END-IF.                                                      09000024
080900                                                                  09010024
081000******************************************************************09020024
081100*    BEFORE DOING ANY PROCESSING SPIN THROUGH THE INPUT FILE      09030024
081200*      ADDING THE AMOUNT FIELDS. IF THE TOTALS MATCH WHAT IS ON   09040024
081300*      THE CONTROL RECORD FROM CMS, PROCESSING CAN CONTINUE TO    09050024
081400*      CREATE THE AP FILE.  WE DON'T WANT TO PASS A FILE TO AP IF 09060024
081500*      THE AMOUNTS DON'T MATCH.  THE DISCREPANCY MUST BE CORRECTED09070024
081600*      BEFORE A FILE CAN BE SENT.                                 09080024
081700******************************************************************09090024
081800 1100-CHECK-INPUT.                                                09100024
081900     EVALUATE TRUE                                                09110024
082000         WHEN VL049-DETAIL-RECORD                                 09120024
082100             PERFORM 1200-ADD-AMOUNTS                             09130024
082200         WHEN VL049-CONTROL-RECORD                                09140024
082300             PERFORM 1300-CTL-REC                                 09150024
082400     END-EVALUATE.                                                09160024
082500                                                                  09170024
082600     INITIALIZE VL049-AP-INTERFACE-RECORD.                        09180024
082700                                                                  09190024
P47422     IF PS-INPUT-I01-YES                                          09200024
P47422        PERFORM 8000-READ-INPUT                                   09210024
P47422     ELSE                                                         09220024
P47422        PERFORM 8700-READ-INPUT-I02                               09230024
P47422        MOVE CMS-EXTRACT-WRAP-RECORD TO                           09240024
P47422             VL049-AP-INTERFACE-RECORD                            09250024
P47422     END-IF.                                                      09260024
082900                                                                  09270024
083000******************************************************************09280024
083100*    ADD FRGT CHARGE AMOUNT TO TOTALS                             09290024
083200*                                                                 09300024
083300******************************************************************09310024
083400 1200-ADD-AMOUNTS.                                                09320024
083500                                                                  09330024
083600     MOVE VL049-CHRG-SIGN TO PV-FIELD-SIGNS                       09340024
083700     EVALUATE TRUE                                                09350024
083800         WHEN PV-POSITIVE                                         09360024
083900             COMPUTE PV-COMPARE-CREDIT-AMT                        09370024
084000                              = VL049-CHRG-AMT * +1               09380024
P47422         IF PS-INPUT-I01-YES                                      09390024
P47422             ADD PV-COMPARE-CREDIT-AMT TO                         09400024
P47422                 PA-TOTAL-CREDITS                                 09410024
P47422         ELSE                                                     09420024
P47422             ADD PV-COMPARE-CREDIT-AMT TO                         09430024
P47422                 PA-TOTAL-WRAP-CREDITS                            09440024
P47422         END-IF                                                   09450024
084200         WHEN PV-NEGATIVE                                         09460024
084300             COMPUTE PV-COMPARE-CHARGE-AMT                        09470024
084400                              = VL049-CHRG-AMT * -1               09480024
P47422         IF PS-INPUT-I01-YES                                      09490024
P47422             ADD PV-COMPARE-CHARGE-AMT TO                         09500024
P47422                 PA-TOTAL-CHARGES                                 09510024
P47422         ELSE                                                     09520024
P47422             ADD PV-COMPARE-CHARGE-AMT TO                         09530024
P47422                 PA-TOTAL-WRAP-CHARGES                            09540024
P47422         END-IF                                                   09550024
084600     END-EVALUATE.                                                09560024
084700                                                                  09570024
084800******************************************************************09580024
084900*  GET THE INPUT FREIGHT CHARGE & CREDIT AMOUNTS INTO THEIR       09590024
085000*  REPSECTIVE COPYBOOK FIELDS.                                    09600024
085100******************************************************************09610024
085200 1300-CTL-REC.                                                    09620024
085300                                                                  09630024
085400***  WE NEED TO HAVE THE CHARGE AMOUNT SIGNED                     09640024
085500***  CMS CANNOT PROVIDE SIGNED PACKED DATA, SO WE HAVE TO DO IT   09650024
085600     MOVE VL049-CTL-FRGT-CHRG-SIGN TO PV-FIELD-SIGNS.             09660024
085700     EVALUATE TRUE                                                09670024
085800         WHEN PV-NEGATIVE                                         09680024
085900             COMPUTE PV-CMS-CTL-CHARGE-AMT                        09690024
086000                              = VL049-CTL-FRGT-CHRG-AMT * -1      09700024
086100     END-EVALUATE.                                                09710024
086200                                                                  09720024
086300***  WE NEED TO HAVE THE REVERSAL (CREDIT) AMOUNT SIGNED          09730024
086400***  CMS CANNOT PROVIDE SIGNED PACKED DATA, SO WE HAVE TO DO IT   09740024
086500     MOVE VL049-CTL-REVERSAL-SIGN TO PV-FIELD-SIGNS.              09750024
086600     EVALUATE TRUE                                                09760024
086700         WHEN PV-POSITIVE                                         09770024
086800             COMPUTE PV-CMS-CTL-CREDIT-AMT                        09780024
086900                              = VL049-CTL-REVERSAL-AMT * +1       09790024
087000     END-EVALUATE.                                                09800024
087100                                                                  09810024
087200***  MOVE THE INPUT TOTAL REC COUNT TO HOLD FIELD                 09820024
087300     COMPUTE PV-CMS-CTL-REC-CNT-TOT = VL049-CTL-RECORD-COUNT * +1.09830024
087400                                                                  09840024
087500******************************************************************09850024
087600*  CHECK THE CONTROL RECORD FROM CMS TO WHAT WAS CALCULATED HERE  09860024
087700******************************************************************09870024
087800 1350-CHECK-TOTALS.                                               09880024
087900                                                                  09890024
088000***  CONTROL RECORD IS SUBTRACTED FROM THE RECORDS READ LEAVING   09900024
088100***  ONLY THE NBR OF DETAIL RECORDS READ                          09910024
088200     COMPUTE PV-COMPARE-REC-CNT = PV-COMPARE-REC-CNT - +1.        09920024
088300                                                                  09930024
088400***  THIS FIELD IS THE INPUT TOT REC COUNT MINUS 1 CONTROL REC    09940024
088500***  LEAVING THE TOT DETAILS SENT AS INPUT                        09950024
088600     COMPUTE PV-CMS-CTL-REC-CNT = PV-CMS-CTL-REC-CNT-TOT - +1.    09960024
088700                                                                  09970024
088800***  THIS IS THE TOTAL OF THE INPUT CHARGES AND CREDITS           09980024
088900***  THAT WERE TALLIED AS THEY WERE READ - WHICH WILL NEED        09990024
089000***  TO MATCH THE TOTAL CHARGES & TOTAL CREDITS SENT ON THE       10000024
089100***  CONTROL RECORD                                               10010024
089200     COMPUTE PV-COMPARE-DOLLAR-AMT = PA-TOTAL-CHARGES             10020024
089300                                            + PA-TOTAL-CREDITS.   10030024
089400                                                                  10040024
089500*    DISPLAY '*********************************************'      10050024
089600*        MOVE PV-CMS-CTL-REC-CNT         TO PV-DISP-NUMBER        10060024
089700*        DISPLAY '** CMS REC CNT:  ' PV-DISP-NUMBER               10070024
089800*        MOVE PV-COMPARE-REC-CNT         TO PV-DISP-NUMBER        10080024
089900*        DISPLAY '** KOHLS REC CNT:  ' PV-DISP-NUMBER             10090024
090000*        MOVE PV-CMS-CTL-CHARGE-AMT      TO PV-DISP-DOLLAR        10100024
090100*        DISPLAY '** CMS FRGT AMT: ' PV-DISP-DOLLAR               10110024
090200*        MOVE PA-TOTAL-CHARGES          TO PV-DISP-DOLLAR         10120024
090300*        DISPLAY '** KOHLS FRGT AMT: ' PV-DISP-DOLLAR             10130024
P47422*        MOVE PA-TOTAL-WRAP-CHARGES      TO PV-DISP-DOLLAR        10140024
P47422*        DISPLAY '** KOHLS WRAP FRGT AMT : ' PV-DISP-DOLLAR       10150024
090400*        MOVE PV-CMS-CTL-CREDIT-AMT      TO PV-DISP-DOLLAR        10160024
090500*        DISPLAY '** CMS REVERSAL AMT: ' PV-DISP-DOLLAR           10170024
090600*        MOVE PA-TOTAL-CREDITS           TO PV-DISP-DOLLAR        10180024
090700*        DISPLAY '** KOHLS CREDIT AMT: ' PV-DISP-DOLLAR           10190024
P47422*        MOVE PA-TOTAL-WRAP-CREDITS      TO PV-DISP-DOLLAR        10200024
P47422*        DISPLAY '** KOHLS WRAP CREDIT AMT: ' PV-DISP-DOLLAR      10210024
090800*        DISPLAY '**********************************************' 10220024
090900*    MOVE PA-TOTAL-CHARGES            TO PV-DISP-DOLLAR           10230024
091000*    DISPLAY '** TOTAL CHARGES ==> ' PV-DISP-DOLLAR               10240024
P47422*    MOVE PA-TOTAL-WRAP-CHARGES       TO PV-DISP-DOLLAR           10250024
P47422*    DISPLAY '** TOTAL WRAP CHARGES ==> ' PV-DISP-DOLLAR          10260024
091100*    MOVE PA-TOTAL-CREDITS            TO PV-DISP-DOLLAR           10270024
091200*    DISPLAY '** TOTAL CREDITS ==> ' PV-DISP-DOLLAR               10280024
P47422*    MOVE PA-TOTAL-WRAP-CREDITS       TO PV-DISP-DOLLAR           10290024
P47422*    DISPLAY '** TOTAL WRAP CREDITS ==> ' PV-DISP-DOLLAR          10300024
091300*    MOVE PV-COMPARE-DOLLAR-AMT       TO PV-DISP-DOLLAR           10310024
091400*    DISPLAY '** FREIGHT AMT   ==> ' PV-DISP-DOLLAR               10320024
091500*    DISPLAY '*********************************************'      10330024
091600*                                                                 10340024
091700***  GRO-COST AND NET COST WILL BE THE SAME                       10350024
091800*    IF PV-COMPARE-REC-CNT = PV-CMS-CTL-REC-CNT AND               10360024
091900*        PA-TOTAL-CHARGES    = PV-CMS-CTL-CHARGE-AMT AND          10370024
092000*        PA-TOTAL-CREDITS    = PV-CMS-CTL-CREDIT-AMT              10380024
092100*        SET PS-AMOUNTS-MATCH TO TRUE                             10390024
092200*    ELSE                                                         10400024
092300*        SET PS-AMOUNTS-NOT-MATCH TO TRUE                         10410024
092400*        DISPLAY '**********************************************' 10420024
092500*        DISPLAY '** ABEND                                      ' 10430024
092600*        DISPLAY '** PROGRAM = VLKUT047                         ' 10440024
092700*        DISPLAY '** PARAGRAPH = 1350-CHECK-TOTALS              ' 10450024
092800*        DISPLAY '** DISCREPANCY IN CONTROL AMT FROM CMS AND    ' 10460024
092900*        DISPLAY '**   CALULATED AMOUNT IN THIS PGM             ' 10470024
093000*        MOVE PV-CMS-CTL-REC-CNT         TO PV-DISP-NUMBER        10480024
093100*        DISPLAY '** CMS REC CNT:  ' PV-DISP-NUMBER               10490024
093200*        MOVE PV-COMPARE-REC-CNT         TO PV-DISP-NUMBER        10500024
093300*        DISPLAY '** KOHLS REC CNT:  ' PV-DISP-NUMBER             10510024
093400*        MOVE PV-CMS-CTL-CHARGE-AMT      TO PV-DISP-DOLLAR        10520024
093500*        DISPLAY '** CMS FRGT AMT: ' PV-DISP-DOLLAR               10530024
093600*        MOVE PA-TOTAL-CHARGES          TO PV-DISP-DOLLAR         10540024
093700*        DISPLAY '** KOHLS FRGT AMT: ' PV-DISP-DOLLAR             10550024
093800*        MOVE PV-CMS-CTL-CREDIT-AMT      TO PV-DISP-DOLLAR        10560024
093900*        DISPLAY '** CMS REVERSAL AMT: ' PV-DISP-DOLLAR           10570024
094000*        MOVE PA-TOTAL-CREDITS           TO PV-DISP-DOLLAR        10580024
094100*        DISPLAY '** KOHLS CREDIT AMT: ' PV-DISP-DOLLAR           10590024
094200*        DISPLAY '**********************************************' 10600024
094300*        PERFORM 9100-ABEND-BAD-AMTS                              10610024
094400*    END-IF.                                                      10620024
094500*                                                                 10630024
094600******************************************************************10640024
094700*    PROCESS EACH RECORD FROM CMS ADDING INFORMATION NOT AVAILABLE10650024
094800*      TO CMS IN ORDER TO CREATE COMPLETE AP RECORD               10660024
094900******************************************************************10670024
095000 2000-PROCESS-INPUT.                                              10680024
095100     INITIALIZE AP045-KEY-FIELDS                                  10690024
095200                AP045-COMMON-FIELDS                               10700024
095300                AP045-DETAIL-FIELDS                               10710024
      *CHG0211865                                                       10720024
                      PV-TEMP-DOC-NBR                                   10730024
                      PV-DOC-NBR.                                       10740024
      *CHG0211865                                                       10750024
095400                                                                  10760024
095500     PERFORM 2400-EDIT-INPUT.                                     10770024
095600     IF PV-ERROR-FOUND = 'N'                                      10780024
095700         EVALUATE TRUE                                            10790024
095800             WHEN VL049-DETAIL-RECORD                             10800024
095900                 PERFORM 2100-POPULATE-FIELDS                     10810024
096000             WHEN VL049-CONTROL-RECORD                            10820024
096100                 PERFORM 3000-CONTROL-RECORD                      10830024
096200         END-EVALUATE                                             10840024
096300     END-IF.                                                      10850024
096400                                                                  10860024
P47422     IF PS-INPUT-I01-YES                                          10870024
P47422        PERFORM 8000-READ-INPUT                                   10880024
P47422     ELSE                                                         10890024
P47422        PERFORM 8700-READ-INPUT-I02                               10900024
P47422        MOVE CMS-EXTRACT-WRAP-RECORD TO                           10910024
P47422             VL049-AP-INTERFACE-RECORD                            10920024
P47422     END-IF.                                                      10930024
096600                                                                  10940024
096700******************************************************************10950024
096800* THIS PARAGRAPH WILL FILL IN THE AP COPYBOOK WITH DATA FROM CMS, 10960024
096900*     THE AP TABLES AND THE PRORATED FRGT AMT FROM THE PRORATION  10970024
097000*     ROUTINE.                                                    10980024
097100******************************************************************10990024
097200 2100-POPULATE-FIELDS.                                            11000024
097300     MOVE VL049-VND-NBR               TO AP045-VND-NBR.           11010024
097400     EVALUATE TRUE                                                11020024
097500         WHEN VL049-CHARGE-3H                                     11030024
      *CHG0211865                                                       11040024
                   MOVE VL049-DOC-NBR       TO PV-TEMP-DOC-NBR          11050024
                   MOVE VL049-DOC-YY        TO PV-DTE-YY                11060024
                   MOVE VL049-DOC-MM        TO PV-DTE-MM                11070024
                   MOVE VL049-DOC-DD        TO PV-DTE-DD                11080024
                   STRING PV-TEMP-DOC-NBR   DELIMITED BY SPACE          11090024
                          '_'               DELIMITED BY SPACE          11100024
                          PV-DOC-DTE        DELIMITED BY SPACE          11110024
                     INTO PV-DOC-NBR                                    11120024
                   MOVE PV-DOC-NBR          TO AP045-DOC-NBR            11130024
      *CHG0211865                                                       11140024
097700         WHEN VL049-CREDIT-3I                                     11150024
097800             PERFORM 2300-STRING-DOC-NBR-SEQ                      11160024
      *CHG0211865                                                       11170024
097900             MOVE PV-DOC-NBR-SEQ      TO PV-TEMP-DOC-NBR          11180024
                   MOVE VL049-DOC-YY        TO PV-DTE-YY                11190024
                   MOVE VL049-DOC-MM        TO PV-DTE-MM                11200024
                   MOVE VL049-DOC-DD        TO PV-DTE-DD                11210024
                   STRING PV-TEMP-DOC-NBR   DELIMITED BY SPACE          11220024
                          '_'               DELIMITED BY SPACE          11230024
                          PV-DOC-DTE        DELIMITED BY SPACE          11240024
                     INTO PV-DOC-NBR                                    11250024
                   MOVE PV-DOC-NBR          TO AP045-DOC-NBR            11260024
      *CHG0211865                                                       11270024
098000         WHEN VL049-PO-CHARGE-3U                                  11280024
      *CHG0211865                                                       11290024
098100             MOVE VL049-DOC-NBR       TO PV-TEMP-DOC-NBR          11300024
                   MOVE VL049-DOC-YY        TO PV-DTE-YY                11310024
                   MOVE VL049-DOC-MM        TO PV-DTE-MM                11320024
                   MOVE VL049-DOC-DD        TO PV-DTE-DD                11330024
                   STRING PV-TEMP-DOC-NBR   DELIMITED BY SPACE          11340024
                          '_'               DELIMITED BY SPACE          11350024
                          PV-DOC-DTE        DELIMITED BY SPACE          11360024
                     INTO PV-DOC-NBR                                    11370024
                   MOVE PV-DOC-NBR          TO  AP045-DOC-NBR           11380024
      *CHG0211865                                                       11390024
098200         WHEN VL049-PO-CREDIT-3V                                  11400024
      *CHG0211865                                                       11410024
098300             PERFORM 2300-STRING-DOC-NBR-SEQ                      11420024
098400             MOVE PV-DOC-NBR-SEQ      TO PV-TEMP-DOC-NBR          11430024
                   MOVE VL049-DOC-YY        TO PV-DTE-YY                11440024
                   MOVE VL049-DOC-MM        TO PV-DTE-MM                11450024
                   MOVE VL049-DOC-DD        TO PV-DTE-DD                11460024
                   STRING PV-TEMP-DOC-NBR   DELIMITED BY SPACE          11470024
                          '_'               DELIMITED BY SPACE          11480024
                          PV-DOC-DTE        DELIMITED BY SPACE          11490024
                     INTO PV-DOC-NBR                                    11500024
                   MOVE PV-DOC-NBR          TO  AP045-DOC-NBR           11510024
      *CHG0211865                                                       11520024
098500     END-EVALUATE.                                                11530024
098600     MOVE VL049-AP-TRN-CDE            TO AP045-AP-TRN-CDE.        11540024
098700     MOVE VL049-DOC-DTE               TO AP045-DOC-DTE.           11550024
098800     MOVE VL049-RECD-TYP-CDE          TO AP045-RECD-TYP-CDE.      11560024
098900     MOVE 'VLKUT047'                  TO AP045-ENTR-ID.           11570024
099000     MOVE 'A'                         TO AP045-ORGN-CDE.          11580024
099100     MOVE VL049-ENT-ID                TO AP045-ENT-ID.            11590024
099200     MOVE VL049-ENT-NME-DESC          TO AP045-ENT-NME-DESC       11600024
099300**** STR-NBR SHOULD BE DC THE TRANSACTION IS FOR                  11610024
099400     MOVE VL049-LOCATION              TO AP045-STR-NBR            11620024
099500                                        PV-VL049-LOCATION-COMP.   11630024
099600     PERFORM 2200-ADD-AP-FIELDS.                                  11640024
099700                                                                  11650024
099800**** GET 1 RECEIVER THAT IS ASSOCIATED TO THAT PO AND DC          11660024
099900     MOVE VL049-PO-NBR         TO PV-VL049-PO-NBR-COMP.           11670024
060716*    IF CC-TYPE-RUN = 'PO'                                        11680024
060716*        PERFORM 5100-GET-RECEIVER                                11690024
060716*    ELSE                                                         11700024
100300         IF PV-VL049-LOCATION-COMP = PC-CORPORATE                 11710024
100400            PERFORM 5100-GET-RECEIVER                             11720024
100500         ELSE                                                     11730024
100600            PERFORM 5000-GET-RECEIVER                             11740024
100700         END-IF                                                   11750024
060716*    END-IF                                                       11760024
100900                                                                  11770024
101000     IF RECEIV-REC-SEQ-NBR NOT = 0                                11780024
101100                                                                  11790024
101200***  WE NEED TO PRORATE THE FREIGHT CHARGE DOWN TO THE SKU LEVEL  11800024
101300** BUILD PARAMETER LIST BEFORE CALLING PRORATE ROUTINE (DPKUP150) 11810024
101400         MOVE PV-VL049-PO-NBR-COMP TO WS150-PO-NBR                11820024
101500         MOVE RECEIV-REC-SEQ-NBR   TO WS150-REC-SEQ-NBR           11830024
101600         MOVE ZEROS                TO WS150-PO-LNE-NBR            11840024
101700                                      WS150-STR-NBR               11850024
101800                                                                  11860024
101900         SET  WS150-BASE-ON-COST   TO TRUE                        11870024
102000*    MOVE 'C'                  TO WS150-PRORATE-BASIS             11880024
102100         SET  WS150-SKU            TO TRUE                        11890024
102110** WR38804                                                        11900024
102120         MOVE PV-VL049-LOCATION-COMP TO WS150-DC-NBR              11910024
102130****     MOVE SPACES                 TO WS150-CL-NBR              11920024
102140** WR38804                                                        11930024
102150                                                                  11940024
102160         PERFORM 4000-CALL-PRORATION-ROUTINE                      11950024
102170                                                                  11960024
102180         SET PS-NOT-END-OF-PRORATION-CSR                          11970024
102190             PS-STOP-WRITING-OUTRECS-NO                           11980024
102200             PS-SITTING-ON-LAST-REC-NO   TO TRUE                  11990024
102300         PERFORM 4200-OPEN-PRORATION-CSR                          12000024
102400         PERFORM 4600-TALLY-TAJPRRT-RECS-FOR-PO                   12010024
102500                                                                  12020024
102600         PERFORM UNTIL PS-END-OF-PRORATION-CSR OR                 12030024
102700                       PS-STOP-WRITING-OUTRECS-YES                12040024
102800             PERFORM 4300-FETCH-PRORATION-CSR                     12050024
102900         END-PERFORM                                              12060024
103000                                                                  12070024
103100         PERFORM 4400-CLOSE-PRORATION-CSR                         12080024
103200** WR38804                                                        12090024
103300         PERFORM 4450-DELETE-FROM-TAJPRRT                         12100024
103400** WR38804                                                        12110024
103500         ADD 1 TO PV-CALC-REC-CNT                                 12120024
103600         MOVE VL049-CHRG-SIGN TO PV-FIELD-SIGNS                   12130024
103700         EVALUATE TRUE                                            12140024
103800             WHEN PV-POSITIVE                                     12150024
103900                 COMPUTE PV-COMPARE-CREDIT-AMT                    12160024
104000                                  = VL049-CHRG-AMT * +1           12170024
104100                 ADD PV-COMPARE-CREDIT-AMT TO PV-CALC-DOLLAR-AMT  12180024
104200             WHEN PV-NEGATIVE                                     12190024
104300                 COMPUTE PV-COMPARE-CHARGE-AMT                    12200024
104400                                  = VL049-CHRG-AMT * -1           12210024
104500                 ADD PV-COMPARE-CHARGE-AMT TO PV-CALC-DOLLAR-AMT  12220024
104600         END-EVALUATE                                             12230024
104700     END-IF.                                                      12240024
104800                                                                  12250024
104900******************************************************************12260024
105000* ADD THE FIELDS FROM AP TABLES TO THE OUTPUT RECORD              12270024
105100******************************************************************12280024
105200 2200-ADD-AP-FIELDS.                                              12290024
105300     MOVE APCNTL-NEXT-BTCH-PRC-DTE    TO AP045-ENTR-DTE           12300024
105400                                         AP045-INV-CUTOFF-DTE.    12310024
105500     EVALUATE TRUE                                                12320024
105600         WHEN VL049-CHARGE-3H                                     12330024
105700             MOVE PV-PSTG-TYP-CDE (1) TO AP045-PSTG-TYP-CDE       12340024
105800             MOVE PV-TRN-TYP-CDE (1)  TO AP045-TRN-TYP-CDE        12350024
105900             STRING AP045-ENTR-DTE                                12360024
106000                    PV-BTCH-SRC-CDE (1)                           12370024
106100                    '00' DELIMITED BY SIZE                        12380024
106200                INTO AP045-PS-BTCH-NBR                            12390024
106300                                                                  12400024
106400             MOVE VL049-DOC-NBR       TO PV-AP-DOC-NBR-CH         12410024
106500             MOVE PV-MEMO-LINE-CHRG   TO AP045-RSN-1ST-LNE-TXT    12420024
106600         WHEN VL049-CREDIT-3I                                     12430024
106700             MOVE PV-PSTG-TYP-CDE (2) TO AP045-PSTG-TYP-CDE       12440024
106800             MOVE PV-TRN-TYP-CDE (2)  TO AP045-TRN-TYP-CDE        12450024
106900             STRING AP045-ENTR-DTE                                12460024
107000                    PV-BTCH-SRC-CDE (2)                           12470024
107100                    '00' DELIMITED BY SIZE                        12480024
107200               INTO AP045-PS-BTCH-NBR                             12490024
107300*** FOR THE LINE OF TEXT WE ONLY WANT THE AP DOC NBR WITHOUT THE  12500024
107400*** REVERSAL SEQUENCE NUMBER                                      12510024
107500             MOVE VL049-DOC-NBR       TO PV-AP-DOC-NBR-CR         12520024
107600             MOVE PV-MEMO-LINE-CREDIT TO AP045-RSN-1ST-LNE-TXT    12530024
107700         WHEN VL049-PO-CHARGE-3U                                  12540024
107800             MOVE PV-PSTG-TYP-CDE (3) TO AP045-PSTG-TYP-CDE       12550024
107900             MOVE PV-TRN-TYP-CDE (3)  TO AP045-TRN-TYP-CDE        12560024
108000             STRING AP045-ENTR-DTE                                12570024
108100                    PV-BTCH-SRC-CDE (3)                           12580024
108200                    '00' DELIMITED BY SIZE                        12590024
108300                INTO AP045-PS-BTCH-NBR                            12600024
108400                                                                  12610024
108500             MOVE VL049-DOC-NBR       TO PV-AP-DOC-NBR-PO-CH      12620024
108600             MOVE PV-MEMO-LINE-PO-CHRG TO AP045-RSN-1ST-LNE-TXT   12630024
108700         WHEN VL049-PO-CREDIT-3V                                  12640024
108800             MOVE PV-PSTG-TYP-CDE (4) TO AP045-PSTG-TYP-CDE       12650024
108900             MOVE PV-TRN-TYP-CDE (4)  TO AP045-TRN-TYP-CDE        12660024
109000             STRING AP045-ENTR-DTE                                12670024
109100                    PV-BTCH-SRC-CDE (4)                           12680024
109200                    '00' DELIMITED BY SIZE                        12690024
109300               INTO AP045-PS-BTCH-NBR                             12700024
109400*** FOR THE LINE OF TEXT WE ONLY WANT THE AP DOC NBR WITHOUT THE  12710024
109500*** REVERSAL SEQUENCE NUMBER                                      12720024
109600             MOVE VL049-DOC-NBR       TO PV-AP-DOC-NBR-PO-CR      12730024
109700             MOVE PV-MEMO-LINE-PO-CREDIT TO AP045-RSN-1ST-LNE-TXT 12740024
109800     END-EVALUATE.                                                12750024
109900                                                                  12760024
110000     MOVE '-22.00.00.000000'          TO AP045-ENTR-TME.          12770024
110100                                                                  12780024
110200                                                                  12790024
110300******************************************************************12800024
110400* FOR A CREDIT (REVERSAL) THE SEQUENCE NBR NEEDS TO BE ATTACHED   12810024
110500*    TO THE DOC-NBR THAT IS SENT TO AP                            12820024
110600******************************************************************12830024
110700 2300-STRING-DOC-NBR-SEQ.                                         12840024
110800     MOVE VL049-REVERSAL-SEQ        TO PV-HOLD-SEQ.               12850024
110900     MOVE SPACES                    TO PV-TEMP-SEQ.               12860024
111000     IF PV-HOLD-SEQ-PART1 > 0                                     12870024
111100         MOVE PV-HOLD-SEQ TO PV-TEMP-SEQ                          12880024
111200     ELSE                                                         12890024
111300         IF PV-HOLD-SEQ-PART2 > 0                                 12900024
111400             MOVE PV-HOLD-SEQ-PART2 TO PV-TEMP-SEQ-PART1          12910024
111500             MOVE PV-HOLD-SEQ-PART3 TO PV-TEMP-SEQ-PART2          12920024
111600             MOVE PV-HOLD-SEQ-PART4 TO PV-TEMP-SEQ-PART3          12930024
111700             MOVE SPACES            TO PV-TEMP-SEQ-PART4          12940024
111800         ELSE                                                     12950024
111900             IF PV-HOLD-SEQ-PART3 > 0                             12960024
112000                 MOVE PV-HOLD-SEQ-PART3 TO PV-TEMP-SEQ-PART1      12970024
112100                 MOVE PV-HOLD-SEQ-PART4 TO PV-TEMP-SEQ-PART2      12980024
112200                 MOVE SPACES            TO PV-TEMP-SEQ-PART3      12990024
112300                                           PV-TEMP-SEQ-PART4      13000024
112400             ELSE                                                 13010024
112500                 IF PV-HOLD-SEQ-PART4 > 0                         13020024
112600                     MOVE PV-HOLD-SEQ-PART4 TO PV-TEMP-SEQ-PART1  13030024
112700                     MOVE SPACES            TO PV-TEMP-SEQ-PART2  13040024
112800                                               PV-TEMP-SEQ-PART3  13050024
112900                                               PV-TEMP-SEQ-PART4  13060024
113000                 END-IF                                           13070024
113100             END-IF                                               13080024
113200         END-IF                                                   13090024
113300     END-IF.                                                      13100024
113400                                                                  13110024
113500     STRING VL049-DOC-NBR DELIMITED BY ' '                        13120024
113600            PV-TEMP-SEQ DELIMITED BY ' '                          13130024
113700            ' ' DELIMITED BY SIZE                                 13140024
113800       INTO PV-DOC-NBR-SEQ.                                       13150024
113900                                                                  13160024
114000******************************************************************13170024
114100* CHECK FOR VALID DATA ON THE INPUT RECORD                        13180024
114200******************************************************************13190024
114300 2400-EDIT-INPUT.                                                 13200024
114400                                                                  13210024
114500     MOVE 'N' TO PV-ERROR-FOUND.                                  13220024
114600                                                                  13230024
114700     IF CC-TYPE-RUN = 'PO'                                        13240024
114800         IF NOT VL049-PO-CHARGE-3U AND                            13250024
114900            NOT VL049-PO-CREDIT-3V                                13260024
115000             MOVE 'INVALID TRAN TYPE' TO PV-ERROR-MSG             13270024
115100             PERFORM 8500-PRINT-ERROR-RPT                         13280024
115200             ADD 1 TO PA-ERR-INV-TRN                              13290024
115300             MOVE 'Y' TO PV-ERROR-FOUND                           13300024
115400         END-IF                                                   13310024
115500     ELSE                                                         13320024
115600         IF NOT VL049-CHARGE-3H AND                               13330024
115700            NOT VL049-CREDIT-3I                                   13340024
115800             MOVE 'INVALID TRAN TYPE' TO PV-ERROR-MSG             13350024
115900             PERFORM 8500-PRINT-ERROR-RPT                         13360024
116000             ADD 1 TO PA-ERR-INV-TRN                              13370024
116100             MOVE 'Y' TO PV-ERROR-FOUND                           13380024
116200         END-IF                                                   13390024
116300     END-IF.                                                      13400024
116400                                                                  13410024
116500     IF VL049-CREDIT-3I OR                                        13420024
116600        VL049-PO-CREDIT-3V                                        13430024
116700         MOVE VL049-REVERSAL-SEQ TO PV-NUMBER-CHAR4               13440024
116800         MOVE PV-NUMBER-CHAR4    TO DP010I-UNEDITED-FIELD         13450024
116900         MOVE 4                  TO DP010I-MAXIMUM-DIGITS         13460024
117000         MOVE 0                  TO DP010I-MAXIMUM-DECIMALS       13470024
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13481025
263627              USING DP010I-NUMERIC-EDIT-AREA                      13482025
117200         IF DP010I-ERROR-DETECTED                                 13490024
117300             MOVE 'REV SEQ IS INVALID' TO PV-ERROR-MSG            13500024
117400             PERFORM 8500-PRINT-ERROR-RPT                         13510024
117500             ADD 1 TO PA-ERR-REV-SEQ                              13520024
117600             MOVE 'Y' TO PV-ERROR-FOUND                           13530024
117700         ELSE                                                     13540024
117800             IF VL049-REVERSAL-SEQ = 0 OR                         13550024
117900                PV-NUMBER-CHAR4 = '   0' OR                       13560024
118000                PV-NUMBER-CHAR4 = '    '                          13570024
118100                 MOVE 'REV SEQ IS MISSING' TO PV-ERROR-MSG        13580024
118200                 PERFORM 8500-PRINT-ERROR-RPT                     13590024
118300                 ADD 1 TO PA-ERR-REV-SEQ                          13600024
118400                 MOVE 'Y' TO PV-ERROR-FOUND                       13610024
118500             END-IF                                               13620024
118600         END-IF                                                   13630024
118700     END-IF.                                                      13640024
118800                                                                  13650024
118900*    MOVE VL049-LOCATION     TO PV-NUMBER-PIC5.                   13660024
119000*    MOVE PV-NBR-CHAR4       TO DP010I-UNEDITED-FIELD.            13670024
119100     MOVE VL049-LOCATION     TO PV-NUMBER-PIC5.                   13680024
119200     MOVE PV-NUMBER-CHAR5    TO DP010I-UNEDITED-FIELD.            13690024
119300     MOVE 5                  TO DP010I-MAXIMUM-DIGITS.            13700024
119400     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          13710024
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             13721025
263627          USING DP010I-NUMERIC-EDIT-AREA.                         13722025
119600     IF DP010I-ERROR-DETECTED                                     13730024
119700         MOVE 'INVALID LOCATION  ' TO PV-ERROR-MSG                13740024
119800         PERFORM 8500-PRINT-ERROR-RPT                             13750024
119900         ADD 1 TO PA-ERR-LOC-NBR                                  13760024
120000         MOVE 'Y' TO PV-ERROR-FOUND                               13770024
120100     ELSE                                                         13780024
120200         IF VL049-LOCATION = 0 OR                                 13790024
120300            PV-NBR-CHAR4 = '   0' OR                              13800024
120400            PV-NBR-CHAR4 = '    '                                 13810024
120500             MOVE 'INVALID LOCATION' TO PV-ERROR-MSG              13820024
120600             PERFORM 8500-PRINT-ERROR-RPT                         13830024
120700             ADD 1 TO PA-ERR-LOC-NBR                              13840024
120800             MOVE 'Y' TO PV-ERROR-FOUND                           13850024
120900         ELSE                                                     13860024
060716*            IF CC-TYPE-RUN = 'PO'                                13870024
060716*                PERFORM 5200-CHECK-LOCN                          13880024
060716*            ELSE                                                 13890024
121300                 PERFORM 5300-CHECK-LOC-FR                        13900024
060716*            END-IF                                               13910024
121500         END-IF                                                   13920024
121600     END-IF.                                                      13930024
121700                                                                  13940024
121800     MOVE VL049-CHRG-AMT     TO PV-NUMBER-PIC9.                   13950024
121900     MOVE PV-NUMBER-CHAR9    TO DP010I-UNEDITED-FIELD.            13960024
122000     MOVE 9                  TO DP010I-MAXIMUM-DIGITS.            13970024
122100     MOVE 2                  TO DP010I-MAXIMUM-DECIMALS.          13980024
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             13991025
263627          USING DP010I-NUMERIC-EDIT-AREA.                         13992025
122300     IF DP010I-ERROR-DETECTED                                     14000024
122400         MOVE 'CHARGE AMT IS INVALID' TO PV-ERROR-MSG             14010024
122500         PERFORM 8500-PRINT-ERROR-RPT                             14020024
122600         ADD 1 TO PA-ERR-CHG-AMT                                  14030024
122700         MOVE 'Y' TO PV-ERROR-FOUND                               14040024
122800     ELSE                                                         14050024
122900         IF VL049-CHRG-AMT = 0 OR                                 14060024
123000            PV-NUMBER-CHAR9 = '        0' OR                      14070024
123100            PV-NUMBER-CHAR9 = SPACES                              14080024
123200             MOVE 'CHARGE AMT IS MISSING' TO PV-ERROR-MSG         14090024
123300             PERFORM 8500-PRINT-ERROR-RPT                         14100024
123400             ADD 1 TO PA-ERR-CHG-AMT                              14110024
123500             MOVE 'Y' TO PV-ERROR-FOUND                           14120024
123600         END-IF                                                   14130024
123700     END-IF.                                                      14140024
123800                                                                  14150024
123900     IF VL049-VND-NBR = SPACES                                    14160024
124000         MOVE 'VENDOR NUMBER IS MISSING' TO PV-ERROR-MSG          14170024
124100         PERFORM 8500-PRINT-ERROR-RPT                             14180024
124200         ADD 1 TO PA-ERR-VND-NBR                                  14190024
124300         MOVE 'Y' TO PV-ERROR-FOUND                               14200024
124400     END-IF.                                                      14210024
124500                                                                  14220024
124600     IF VL049-DOC-NBR = SPACES                                    14230024
124700         MOVE 'DOCUMENT NUMBER IS MISSING' TO PV-ERROR-MSG        14240024
124800         PERFORM 8500-PRINT-ERROR-RPT                             14250024
124900         ADD 1 TO PA-ERR-DOC-NBR                                  14260024
125000         MOVE 'Y' TO PV-ERROR-FOUND                               14270024
125100     END-IF.                                                      14280024
125200                                                                  14290024
125300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              14300024
125400     SET DPG51-FISCAL-454-CALENDAR                                14310024
125500         DPG51-DO-NOT-INCR-DECR-DATE                              14320024
125600         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      14330024
125700                                                                  14340024
125800     MOVE VL049-DOC-DTE        TO DPG52-LK-DATE-INPUT.            14350024
125900                                                                  14360024
126000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      14370024
126100             DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 14380024
126200                                                                  14390024
126300     IF NOT DPG54-NO-ERROR                                        14400024
126400         MOVE 'INVALID DOC DATE' TO PV-ERROR-MSG                  14410024
126500         PERFORM 8500-PRINT-ERROR-RPT                             14420024
126600         ADD 1 TO PA-ERR-DOC-DTE                                  14430024
126700         MOVE 'Y' TO PV-ERROR-FOUND                               14440024
126800     END-IF.                                                      14450024
126900                                                                  14460024
127000     IF VL049-RECD-TYP-CDE NOT = '2' AND                          14470024
127100        VL049-RECD-TYP-CDE NOT = '9'                              14480024
127200         MOVE 'INVALID RECORD TYPE CODE' TO PV-ERROR-MSG          14490024
127300         PERFORM 8500-PRINT-ERROR-RPT                             14500024
127400         ADD 1 TO PA-ERR-REC-TYP                                  14510024
127500         MOVE 'Y' TO PV-ERROR-FOUND                               14520024
127600     END-IF.                                                      14530024
127700                                                                  14540024
127800     IF VL049-DEPT-NBR = SPACES                                   14550024
127900         MOVE 'INVALID DEPT NUMBER' TO PV-ERROR-MSG               14560024
128000         PERFORM 8500-PRINT-ERROR-RPT                             14570024
128100         ADD 1 TO PA-ERR-DPT-NBR                                  14580024
128200         MOVE 'Y' TO PV-ERROR-FOUND                               14590024
128300     END-IF.                                                      14600024
128400                                                                  14610024
128500     IF VL049-ENT-ID = SPACES                                     14620024
128600         MOVE 'INVALID ENTITY ID' TO PV-ERROR-MSG                 14630024
128700         PERFORM 8500-PRINT-ERROR-RPT                             14640024
128800         ADD 1 TO PA-ERR-ENT-ID                                   14650024
128900         MOVE 'Y' TO PV-ERROR-FOUND                               14660024
129000     END-IF.                                                      14670024
129100                                                                  14680024
129200     IF VL049-ENT-NME-DESC = SPACES                               14690024
129300         MOVE 'INVALID VENDOR NAME' TO PV-ERROR-MSG               14700024
129400         PERFORM 8500-PRINT-ERROR-RPT                             14710024
129500         ADD 1 TO PA-ERR-ENT-NME                                  14720024
129600         MOVE 'Y' TO PV-ERROR-FOUND                               14730024
129700     END-IF.                                                      14740024
129800                                                                  14750024
129900******************************************************************14760024
130000* CREATE THE CONTROL RECORD, THE RECORD COUNTS AND FRGT CHRG AMT  14770024
130100*    FROM CMS WILL BE COMPARED TO THE TOTALS CREATED              14780024
130200*    AS THE DETAIL RECORDS ARE PROCESSED IN THIS PROGRAM.         14790024
130300******                                                            14800024
130400*    IF THE TWO SETS OF TOTALS DON'T MATCH, THEN THE PROGRAM      14810024
130500*    NEEDS TO ABEND, A DETERMINATION MUST BE MADE AS TO WHERE THE 14820024
130600*    PROBLEM IS.                                                  14830024
130700******************************************************************14840024
130800 3000-CONTROL-RECORD.                                             14850024
130900     INITIALIZE AP045-KEY-FIELDS                                  14860024
131000                AP045-DETAIL-FIELDS                               14870024
131100                AP045-COMMON-FIELDS                               14880024
131200                AP045-CONTROL-FIELDS.                             14890024
131300                                                                  14900024
131400     MOVE '9'              TO AP045-RECD-TYP-CDE.                 14910024
131500                                                                  14920024
131600***  WE NEED TO HAVE THE FRGT-CHRG-AMT SIGNED                     14930024
131700***  CMS CANNOT PROVIDE SIGNED PACKED DATA, SO WE HAVE TO DO IT   14940024
131800     MOVE VL049-CTL-FRGT-CHRG-SIGN       TO PV-FIELD-SIGNS        14950024
131900     EVALUATE TRUE                                                14960024
132000         WHEN PV-POSITIVE                                         14970024
132100             COMPUTE PV-CMS-CTL-CREDIT-AMT                        14980024
132200                              = VL049-CTL-REVERSAL-AMT    * +1    14990024
132300         WHEN PV-NEGATIVE                                         15000024
132400             COMPUTE PV-CMS-CTL-CHARGE-AMT                        15010024
132500                              = VL049-CTL-FRGT-CHRG-AMT   * -1    15020024
132600     END-EVALUATE.                                                15030024
132700                                                                  15040024
132800     COMPUTE PV-CMS-CTL-REC-CNT = VL049-CTL-RECORD-COUNT * +1.    15050024
132900     MOVE PV-CMS-CTL-REC-CNT    TO AP045-CTL-RECORD-COUNT.        15060024
133000                                                                  15070024
133100                                                                  15080024
133200****   FRGT CHRG AMT AND NET AMOUNT WILL BE THE SAME              15090024
133300     IF CC-TYPE-RUN = 'PO'                                        15100024
133400        MOVE PV-COMPARE-DOLLAR-AMT    TO AP045-CTL-GRO-COST-AMT   15110024
133500                                         AP045-CTL-NET-COST-AMT   15120024
133600     ELSE                                                         15130024
133700        MOVE PV-COMPARE-DOLLAR-AMT    TO AP045-CTL-FRGT-AMT       15140024
133800                                         AP045-CTL-NET-COST-AMT   15150024
133900     END-IF.                                                      15160024
134000                                                                  15170024
134100     DISPLAY '************* 3000-CONTROL-RECORD ***********'      15180024
134200     MOVE PV-COMPARE-DOLLAR-AMT TO PV-DISP-DOLLAR                 15190024
134300     DISPLAY 'NET AMT        =>  ' PV-DISP-DOLLAR                 15200024
134400     MOVE PV-CMS-CTL-CHARGE-AMT TO PV-DISP-DOLLAR.                15210024
134500     DISPLAY 'CMS CHARGE AMT =>  ' PV-DISP-DOLLAR.                15220024
134600     MOVE PV-CMS-CTL-CREDIT-AMT TO PV-DISP-DOLLAR.                15230024
134700     DISPLAY 'CMS CREDIT AMT =>  ' PV-DISP-DOLLAR.                15240024
134800     DISPLAY ' '.                                                 15250024
134900                                                                  15260024
135000******************************************************************15270024
135100 3100-WRITE-CONTROL-RECORD.                                       15280024
135200     INITIALIZE AP045-KEY-FIELDS                                  15290024
135300                AP045-DETAIL-FIELDS                               15300024
135400                AP045-COMMON-FIELDS                               15310024
135500                AP045-CONTROL-FIELDS.                             15320024
135600     SET  VL049-CONTROL-RECORD TO TRUE.                           15330024
135700     MOVE '9'              TO AP045-RECD-TYP-CDE.                 15340024
135800     MOVE PA-TOT-RECS-WRIT      TO AP045-CTL-RECORD-COUNT.        15350024
135900                                                                  15360024
136000                                                                  15370024
136100****   FRGT CHRG AMT AND NET AMOUNT WILL BE THE SAME              15380024
136200     IF CC-TYPE-RUN = 'PO'                                        15390024
136300*       MOVE PV-COMPARE-DOLLAR-AMT    TO AP045-CTL-GRO-COST-AMT   15400024
136400        MOVE PV-CALC-DOLLAR-AMT       TO AP045-CTL-GRO-COST-AMT   15410024
136500                                         AP045-CTL-NET-COST-AMT   15420024
136600     ELSE                                                         15430024
136700*       MOVE PV-COMPARE-DOLLAR-AMT    TO AP045-CTL-FRGT-AMT       15440024
136800        MOVE PV-CALC-DOLLAR-AMT       TO AP045-CTL-FRGT-AMT       15450024
136900                                         AP045-CTL-NET-COST-AMT   15460024
137000     END-IF.                                                      15470024
137100     PERFORM 8100-WRITE-AP-TRANS-REC.                             15480024
137200                                                                  15490024
137300     DISPLAY '************* 3100-CONTROL-RECORD ***********'      15500024
137400*    MOVE PV-COMPARE-DOLLAR-AMT TO PV-DISP-DOLLAR                 15510024
137500     MOVE PV-CALC-DOLLAR-AMT    TO PV-DISP-DOLLAR                 15520024
137600     DISPLAY 'NET AMT        =>  ' PV-DISP-DOLLAR                 15530024
137700     MOVE PV-CMS-CTL-CHARGE-AMT TO PV-DISP-DOLLAR.                15540024
137800     DISPLAY 'CMS CHARGE AMT =>  ' PV-DISP-DOLLAR.                15550024
137900     MOVE PV-CMS-CTL-CREDIT-AMT TO PV-DISP-DOLLAR.                15560024
138000     DISPLAY 'CMS CREDIT AMT =>  ' PV-DISP-DOLLAR.                15570024
138100     DISPLAY ' '.                                                 15580024
138200                                                                  15590024
138300*--------------------------------------------------------------*  15600024
138400*  THIS PARAGRAPH CALLS THE ADJUSTMENT PRORATION ROUTINE       *  15610024
138500*  (DPKUP150) USING THE WS150-PRORATE-PARAMETERS.  THE         *  15620024
138600*  PRORATION ROUTINE FILLS A GLOBAL DB2 TABLE (TAJPRRT) WHICH  *  15630024
138700*  HOLDS THE PRORATION PERCENT USED TO CALCULATE THE FREIGHT   *  15640024
138800*  AMOUNT.                                                     *  15650024
138900*--------------------------------------------------------------*  15660024
139000 4000-CALL-PRORATION-ROUTINE.                                     15670024
139100                                                                  15680024
139200     IF CC-DISP-PRORATE-CALL = PC-Y                               15690024
139300        DISPLAY '=== CALL DPKUP150 =============================='15700024
139400                '================================================'15710024
139500        DISPLAY ' PO NBR:' WS150-PO-NBR                           15720024
139600                ' SEQ:' WS150-REC-SEQ-NBR                         15730024
139700                ' STORE:' WS150-STR-NBR                           15740024
139800** WR38804                                                        15750024
139900                ' DC NBR: ' WS150-DC-NBR                          15760024
140000****            ' CL NBR: ' WS150-CL-NBR                          15770024
140010** WR38804                                                        15780024
140020                ' LINE:' WS150-PO-LNE-NBR                         15790024
140030                ' BASIS:' WS150-PRORATE-BASIS                     15800024
140040                ' LEVEL:' WS150-PRORATE-LEVEL                     15810024
140050        DISPLAY '================================================'15820024
140060                '================================================'15830024
140070     END-IF.                                                      15840024
140080                                                                  15850024
140090     CALL PC-PRORATION-ROUTINE USING WS150-PRORATE-PARAMETERS.    15860024
140100                                                                  15870024
140200     IF WS150-ERRORS-FOUND                                        15880024
140300         SET AC-BAD-DATA TO TRUE                                  15890024
140400         MOVE '4000-CALL-PRORATION-ROUTINE'                       15900024
140500                                 TO AA-PARAGRAPH-NAME             15910024
140600         MOVE 'ERRORS FOUND IN THE PRORATION ROUTINE '            15920024
140700                                 TO AA-MESSAGE                    15930024
140800         PERFORM Z999-ABEND                                       15940024
140900     END-IF.                                                      15950024
141000                                                                  15960024
141100*--------------------------------------------------------------*  15970024
141200*  OPENS THE PRORATION CURSOR                                  *  15980024
141300*--------------------------------------------------------------*  15990024
141400 4200-OPEN-PRORATION-CSR.                                         16000024
141500     EXEC SQL                                                     16010024
141600          OPEN PRORATION_CSR                                      16020024
141700     END-EXEC.                                                    16030024
141800                                                                  16040024
141900     EVALUATE TRUE                                                16050024
142000         WHEN SQLCODE = ZERO                                      16060024
142100              CONTINUE                                            16070024
142200         WHEN SQLCODE = +100                                      16080024
142300              SET PS-END-OF-PRORATION-CSR TO TRUE                 16090024
142400         WHEN OTHER                                               16100024
142500             SET AC-OPEN-ERROR TO TRUE                            16110024
142600             MOVE '4200-OPEN-PRORATION-CSR'                       16120024
142700                                 TO PV-PARAGRAPH                  16130024
142800             MOVE 'OPEN CURSOR'  TO PV-DB2-FUNCTION               16140024
142900             MOVE 'TAJPRRT'      TO PV-DB2-TABLE-1                16150024
143000             PERFORM 9200-SQL-ERROR                               16160024
143100     END-EVALUATE.                                                16170024
143200                                                                  16180024
143300*--------------------------------------------------------------*  16190024
143400*  RETRIEVES THE PO NUMBER, DEPARTMENT NUMBER, CLASS NUMBER,   *  16200024
143500*  SKU SEQUENCE NUMBER, STORE NUMBER, AND PRORATION PERCENTAGE *  16210024
143600*  TO CREATE THE INDIVIDUAL TRANSACTIONS.                      *  16220024
143700*--------------------------------------------------------------*  16230024
143800*  FOR OUR PURPOSES WE WILL NOT USE THE STORE NUMBER RETURNED  *  16240024
143900*  HERE BUT WILL USE THE DC NUMBER FROM THE INPUT FILE         *  16250024
144000*--------------------------------------------------------------*  16260024
144100 4300-FETCH-PRORATION-CSR.                                        16270024
144200                                                                  16280024
144300     EXEC SQL                                                     16290024
144400       FETCH PRORATION_CSR                                        16300024
144500         INTO :AJPRRT-PO-NBR                                      16310024
144600            , :AJPRRT-RCVR-SEQ-NBR                                16320024
144700            , :AJPRRT-PO-LNE-NBR                                  16330024
144800            , :AJPRRT-DEPT-NBR                                    16340024
144900            , :AJPRRT-CL-NBR                                      16350024
145000            , :AJPRRT-SKU-NBR                                     16360024
145100            , :AJPRRT-STR-NBR                                     16370024
145200            , :AJPRRT-PRRT-PCT                                    16380024
145300     END-EXEC.                                                    16390024
145400                                                                  16400024
145500     EVALUATE TRUE                                                16410024
145600         WHEN SQLCODE = ZERO                                      16420024
145700             ADD 1 TO PA-PRORATE-REC-COUNT                        16430024
145800             PERFORM 4500-PROCESS-THE-RESULT-SET                  16440024
145900             IF PS-STOP-WRITING-OUTRECS-YES                       16450024
146000                PERFORM 8300-DISPLAY-STATS-FOR-PO                 16460024
146100             END-IF                                               16470024
146200         WHEN SQLCODE = +100                                      16480024
146300             SET PS-END-OF-PRORATION-CSR   TO TRUE                16490024
146400             PERFORM 8300-DISPLAY-STATS-FOR-PO                    16500024
146500         WHEN OTHER                                               16510024
146600             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                16520024
146700             MOVE '4300-FETCH-PRORATION-CSR'                      16530024
146800                                 TO PV-PARAGRAPH                  16540024
146900             MOVE 'UNSUCCESSFUL FETCH ON PRORATION_CSR'           16550024
147000                                 TO PV-DB2-FUNCTION               16560024
147100             MOVE 'TAJPRRT'      TO PV-DB2-TABLE-1                16570024
147200             PERFORM 9200-SQL-ERROR                               16580024
147300     END-EVALUATE.                                                16590024
147400                                                                  16600024
147500*--------------------------------------------------------------*  16610024
147600*  CLOSES THE PRORATION CURSOR                                 *  16620024
147700*--------------------------------------------------------------*  16630024
147800 4400-CLOSE-PRORATION-CSR.                                        16640024
147900     EXEC SQL                                                     16650024
148000          CLOSE PRORATION_CSR                                     16660024
148100     END-EXEC.                                                    16670024
148200                                                                  16680024
148300     EVALUATE TRUE                                                16690024
148400         WHEN SQLCODE = ZERO                                      16700024
148500             CONTINUE                                             16710024
148600         WHEN OTHER                                               16720024
148700             SET AC-CLOSE-ERROR TO TRUE                           16730024
148800             MOVE '4400-CLOSE-PRORATION-CSR' TO PV-PARAGRAPH      16740024
148900             MOVE 'CLOSE CURSOR'             TO PV-DB2-FUNCTION   16750024
149000             MOVE 'TAJPRRT'                  TO PV-DB2-TABLE-1    16760024
149100             PERFORM 9200-SQL-ERROR                               16770024
149200     END-EVALUATE.                                                16780024
149300                                                                  16790024
149400*--------------------------------------------------------------*  16800024
149500* DELETE THE DATA FROM THE TAJPRRT TABLE THAT WAS JUST         *  16810024
149600* PROCESSED                                                    *  16820024
149700*--------------------------------------------------------------*  16830024
149800 4450-DELETE-FROM-TAJPRRT.                                        16840024
149900                                                                  16850024
150000     EXEC SQL                                                     16860024
150100       DELETE FROM TAJPRRT                                        16870024
150110     END-EXEC.                                                    16880024
150120                                                                  16890024
150130     EVALUATE TRUE                                                16900024
150140       WHEN SQLCODE = ZERO                                        16910024
150150         CONTINUE                                                 16920024
150160       WHEN OTHER                                                 16930024
150170         SET AC-DB2-ERROR                   TO TRUE               16940024
150180         MOVE '4450-DELETE-FROM-TAJPRRT'    TO PV-PARAGRAPH       16950024
150190         MOVE 'UNSUCCESSFUL DELETE'         TO PV-DB2-FUNCTION    16960024
150191         MOVE 'TAJPRRT'                     TO PV-DB2-TABLE-1     16970024
150192         MOVE SPACES                        TO PV-DB2-TABLE-2     16980024
150193         PERFORM 9200-SQL-ERROR                                   16990024
150194     END-EVALUATE.                                                17000024
150195                                                                  17010024
150196****************************************************************  17020024
150197*  THIS PARAGRAPH PROCESSES EACH ROW IN THE TAJPRRT TABLE      *  17030024
150198*  FOR THE PO-BEING-PROCESSED.  IT WAITS TO WRITE THE PREVIOUS *  17040024
150199*  TO VERIFY THE SUMMED AMT EQUALS INPUT AMT.                  *  17050024
150200*  IF NO ROW IS RETURNED, PROGRAM WILL ABEND.  IT MUST BE      *  17060024
150300*  DETERMINED WHY THERE ARE NO ROWS ON TAJPRRT                 *  17070024
150400****************************************************************  17080024
150500 4500-PROCESS-THE-RESULT-SET.                                     17090024
150600                                                                  17100024
150700***  DETERMINE IF PROCESSING IS ON THE LAST REC FOR PO,  USE THE  17110024
150800***  SWITCH TO DETERMINE IF ANY PRORATE ADJUSTING IS NEEDED       17120024
150900     IF PA-PRORATE-REC-COUNT = PA-TOT-TAJPRRT-RECS-FOR-PO         17130024
151000        SET PS-SITTING-ON-LAST-REC-YES    TO TRUE                 17140024
151100     END-IF.                                                      17150024
151200                                                                  17160024
151300***  TAKE THE INPUT DOLLAR AMOUNT (CHARGE OR CREDIT) AMD MULTIPLY 17170024
151400***  IT BY THE PRORATION PERCENTAGE FROM THE FETCH AND PLACE IT   17180024
151500***  IN THE APPROPRIATE SUMMARY BUCKET - GET RID OF NEG SIGN TOO  17190024
151600***  NOTE: USE SIX DECIMAL PLACES OF PERCENTAGE TO CALC THE AMOUNT17200024
151700***        (EX: .002345 * VL049-CHRG-AMT)                         17210024
151800     EVALUATE TRUE                                                17220024
151900         WHEN VL049-CHARGE-3H                                     17230024
152000             COMPUTE AP045-FRGT-AMT =                             17240024
152100             ((VL049-CHRG-AMT * AJPRRT-PRRT-PCT)                  17250024
152200              + .005)                                             17260024
152300             ADD AP045-FRGT-AMT       TO PA-TOTAL-CHARGES         17270024
152400                                     PA-TOTAL-CHARGES-THIS-PO     17280024
152500         WHEN VL049-CREDIT-3I                                     17290024
152600             COMPUTE AP045-FRGT-AMT =                             17300024
152700             ((VL049-CHRG-AMT * AJPRRT-PRRT-PCT)                  17310024
152800              + .005)                                             17320024
152900             ADD AP045-FRGT-AMT       TO PA-TOTAL-CREDITS         17330024
153000                                     PA-TOTAL-CREDITS-THIS-PO     17340024
153100         WHEN VL049-PO-CHARGE-3U                                  17350024
153200             COMPUTE AP045-GRO-COST-AMT =                         17360024
153300             ((VL049-CHRG-AMT * AJPRRT-PRRT-PCT)                  17370024
153400              + .005)                                             17380024
153500             ADD AP045-GRO-COST-AMT   TO PA-TOTAL-CHARGES         17390024
153600                                     PA-TOTAL-CHARGES-THIS-PO     17400024
153700         WHEN VL049-PO-CREDIT-3V                                  17410024
153800             COMPUTE AP045-GRO-COST-AMT =                         17420024
153900             ((VL049-CHRG-AMT * AJPRRT-PRRT-PCT)                  17430024
154000              + .005)                                             17440024
154100             ADD AP045-GRO-COST-AMT   TO PA-TOTAL-CREDITS         17450024
154200                                     PA-TOTAL-CREDITS-THIS-PO     17460024
154300     END-EVALUATE                                                 17470024
154400                                                                  17480024
154500***  IF THE INPUT DOLLAR AMOUNT (CHARGE OR CREDIT) IS EQUAL TO    17490024
154600***  THE AMOUNT SUMMED FROM FETCHES - THEN THIS SHOULD BE THE     17500024
154700***  LAST RECORD WRITTEN (EVEN IF MORE EXIST). OTHERWISE THE      17510024
154800***  CALCULATED AMOUNTS USING ALL THE TAJPRRT ROWS MAY ACTUALLY   17520024
154900***  BE MORE THAN THE TOT INPUT FREIGHT SENT. VALUES MUST BE EQUAL17530024
155000***  OR ADJUSTED TO BE EQUAL.                                     17540024
155100     IF VL049-CHARGE-3H OR                                        17550024
155200        VL049-PO-CHARGE-3U                                        17560024
155300        IF PA-TOTAL-CHARGES-THIS-PO = VL049-CHRG-AMT              17570024
155400           ADD PA-TOTAL-CHARGES-THIS-PO TO PV-ADJ-GRAND-CHARGE    17580024
155500           PERFORM 4700-LOAD-OUTPUT-FIELDS                        17590024
155600           PERFORM 8100-WRITE-AP-TRANS-REC                        17600024
155700           SET PS-STOP-WRITING-OUTRECS-YES  TO TRUE               17610024
155800        END-IF                                                    17620024
155900     ELSE                                                         17630024
156000        IF PA-TOTAL-CREDITS-THIS-PO = VL049-CHRG-AMT              17640024
156100           ADD PA-TOTAL-CREDITS-THIS-PO TO PV-ADJ-GRAND-CREDIT    17650024
156200           PERFORM 4700-LOAD-OUTPUT-FIELDS                        17660024
156300           PERFORM 8100-WRITE-AP-TRANS-REC                        17670024
156400           SET PS-STOP-WRITING-OUTRECS-YES  TO TRUE               17680024
156500        END-IF                                                    17690024
156600     END-IF.                                                      17700024
156700                                                                  17710024
156800***  IF ON THE LAST RECORD FROM TAJPPRT CSR  --OR--               17720024
156900***  THE RUNNING TOTAL CHARGES/CREDITS ARE NOT EQUAL TO THE       17730024
157000***  TOTAL INPUT FIELD SENT FROM CMS...                           17740024
157100     IF VL049-CHARGE-3H OR                                        17750024
157200        VL049-PO-CHARGE-3U                                        17760024
157300***     CHARGES                                                   17770024
157400        IF PA-TOTAL-CHARGES-THIS-PO < VL049-CHRG-AMT              17780024
157500        AND PS-SITTING-ON-LAST-REC-NO                             17790024
157600           PERFORM 4700-LOAD-OUTPUT-FIELDS                        17800024
157700           PERFORM 8100-WRITE-AP-TRANS-REC                        17810024
157800        END-IF                                                    17820024
157900        IF (PS-SITTING-ON-LAST-REC-YES                            17830024
158000        AND PA-TOTAL-CHARGES-THIS-PO NOT = VL049-CHRG-AMT)        17840024
158100         OR PA-TOTAL-CHARGES-THIS-PO > VL049-CHRG-AMT             17850024
158200           PERFORM 4800-FRGT-ADJUSTMENTS                          17860024
158300           PERFORM 4700-LOAD-OUTPUT-FIELDS                        17870024
158400           PERFORM 8100-WRITE-AP-TRANS-REC                        17880024
158500           SET PS-STOP-WRITING-OUTRECS-YES TO TRUE                17890024
158600        END-IF                                                    17900024
158700     ELSE                                                         17910024
158800***     CREDITS                                                   17920024
158900        IF PA-TOTAL-CREDITS-THIS-PO < VL049-CHRG-AMT              17930024
159000        AND PS-SITTING-ON-LAST-REC-NO                             17940024
159100           PERFORM 4700-LOAD-OUTPUT-FIELDS                        17950024
159200           PERFORM 8100-WRITE-AP-TRANS-REC                        17960024
159300        END-IF                                                    17970024
159400*       IF PS-SITTING-ON-LAST-REC-YES                             17980024
159500*        OR PA-TOTAL-CREDITS-THIS-PO > VL049-CHRG-AMT             17990024
159600        IF (PS-SITTING-ON-LAST-REC-YES                            18000024
159700        AND PA-TOTAL-CREDITS-THIS-PO NOT = VL049-CHRG-AMT)        18010024
159800         OR PA-TOTAL-CREDITS-THIS-PO > VL049-CHRG-AMT             18020024
159900           PERFORM 4800-FRGT-ADJUSTMENTS                          18030024
160000           PERFORM 4700-LOAD-OUTPUT-FIELDS                        18040024
160100           PERFORM 8100-WRITE-AP-TRANS-REC                        18050024
160200           SET PS-STOP-WRITING-OUTRECS-YES TO TRUE                18060024
160300        END-IF                                                    18070024
160400     END-IF.                                                      18080024
160500                                                                  18090024
160600****************************************************************  18100024
160700* COUNT ALL THE TAJPRRT RECS THAT WERE CREATED FOR AN INPUT PO.   18110024
160800* THIS COUNT IS USED TO DETERMINE IF PROCESSING HAS REACHED THE   18120024
160900* LAST RECORD.                                                    18130024
161000* (TAJPRRT IS A GLOBAL TEMP TABLE).                               18140024
161100****************************************************************  18150024
161200 4600-TALLY-TAJPRRT-RECS-FOR-PO.                                  18160024
161300                                                                  18170024
161400     EXEC SQL                                                     18180024
161500       SELECT COUNT(*)                                            18190024
161600        INTO :PA-TOT-TAJPRRT-RECS-FOR-PO                          18200024
161700         FROM TAJPRRT                                             18210024
161800        WHERE PO_NBR = :PV-VL049-PO-NBR-COMP                      18220024
161900     END-EXEC.                                                    18230024
162000                                                                  18240024
162100     EVALUATE TRUE                                                18250024
162200         WHEN SQLCODE = ZERO                                      18260024
162300              IF CC-DISP-PO-DETAILS = PC-Y                        18270024
162400                 MOVE PA-TOT-TAJPRRT-RECS-FOR-PO                  18280024
162500                   TO PV-DISP-TALLY                               18290024
162600                 DISPLAY '====>>>  TOT TAJPRRT RECS : '           18300024
162700                         PV-DISP-TALLY                            18310024
162800                         ' FOR PO NBR: '                          18320024
162900                         VL049-PO-NBR                             18330024
163000              END-IF                                              18340024
163100         WHEN SQLCODE = +100                                      18350024
163200             DISPLAY 'NO ROWS ON TAJPRRT TABLE'                   18360024
163300             DISPLAY '**********************************'         18370024
163400             DISPLAY '*******   EMPTY   TABLE  *********'         18380024
163500             DISPLAY '*ABEND                          '           18390024
163600             DISPLAY '*PROGRAM = VLKUT047             '           18400024
163700             DISPLAY '*PARAGRAPH = 4600-TALLY-TAJPRRT-RECS-FOR-PO'18410024
163800             DISPLAY '*TAJPRRT IS EMPTY               '           18420024
163900             DISPLAY '**********************************'         18430024
164000             CLOSE CMS-EXT-FILE                                   18440024
164100             PERFORM 4400-CLOSE-PRORATION-CSR                     18450024
164200             MOVE +4013 TO ABEND-CODE                             18460024
164300             CALL 'ILBOABN0' USING ABEND-CODE                     18470024
164400                                                                  18480024
164500         WHEN OTHER                                               18490024
164600             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                18500024
164700             MOVE '4600-TALLY-TAJPRRT-RECS-FOR-PO'                18510024
164800                                 TO PV-PARAGRAPH                  18520024
164900             MOVE 'UNSUCCESSFUL FETCH ON TAJPRRT'                 18530024
165000                                 TO PV-DB2-FUNCTION               18540024
165100             MOVE 'TAJPRRT'      TO PV-DB2-TABLE-1                18550024
165200             PERFORM 9200-SQL-ERROR                               18560024
165300     END-EVALUATE.                                                18570024
165400                                                                  18580024
165500****************************************************************  18590024
165600*                                                              *  18600024
165700****************************************************************  18610024
165800 4700-LOAD-OUTPUT-FIELDS.                                         18620024
165900                                                                  18630024
166000***  REMEMBER, AP045-FRGT-AMT, WAS COMPUTED ABOVED IN 4500-       18640024
166100***  JUST ADD THE NEGATIVE SIGN IF THIS IS A CHARGE               18650024
166200     IF VL049-CHARGE-3H                                           18660024
166300        COMPUTE AP045-FRGT-AMT =                                  18670024
166400                AP045-FRGT-AMT * -1                               18680024
166500     END-IF.                                                      18690024
166600                                                                  18700024
166700     IF VL049-PO-CHARGE-3U                                        18710024
166800        COMPUTE AP045-GRO-COST-AMT =                              18720024
166900                AP045-GRO-COST-AMT * -1                           18730024
167000     END-IF.                                                      18740024
167100                                                                  18750024
167200     MOVE AJPRRT-PO-NBR           TO  AP045-PO-NBR.               18760024
167300     MOVE AJPRRT-DEPT-NBR         TO  AP045-DEPT-NBR.             18770024
167400     MOVE AJPRRT-CL-NBR           TO  AP045-CL-NBR.               18780024
167500     IF AJPRRT-SKU-NBR EQUAL ZEROS                                18790024
167600         MOVE ZEROS               TO AP045-SKU-NBR                18800024
167700     ELSE                                                         18810024
167800         MOVE AJPRRT-SKU-NBR      TO AP045-SKU-NBR                18820024
167900     END-IF.                                                      18830024
168000                                                                  18840024
168100     PERFORM 4750-CHECK-RECLASS                                   18850024
168200                                                                  18860024
168300     MOVE ZEROES            TO  AP045-DTL-TERM-DISC-AMT.          18870024
168400     MOVE ZEROES            TO  AP045-DTL-NW-STR-DISC-AMT.        18880024
168500     MOVE ZEROES            TO  AP045-DTL-TRD-DISC-AMT.           18890024
168600     IF VL049-CHARGE-3H OR                                        18900024
168700        VL049-CREDIT-3I                                           18910024
168800         MOVE AP045-FRGT-AMT TO AP045-NET-COST-AMT                18920024
168900     END-IF.                                                      18930024
169000     IF VL049-PO-CHARGE-3U OR                                     18940024
169100        VL049-PO-CREDIT-3V                                        18950024
169200         MOVE AP045-GRO-COST-AMT TO AP045-NET-COST-AMT            18960024
169300     END-IF.                                                      18970024
169400     MOVE ZEROES            TO  AP045-DTL-MOS-DISC-AMT.           18980024
169500                                                                  18990024
169600****************************************************************  19000024
169700* DPKUP150 GETS SUBCLASS FROM TPURITM. CLASS AND SUBCLASS ARE     19010024
169800* NOT UPDATED ON THE PO, SO IF A SKU IS RECLASSED, THE CLASS AND  19020024
169900* SUBCLASS WILL BE WRONG WHEN IT IS PASSED TO A/P                 19030024
170000* VALIDATE AGAINST TMDSEAR AS A/P DOES IN APKUT136, IF FOUND      19040024
170100* CONTINUE.  NOT FOUND, GET THE SUBCLASS AT THE ITEM LEVEL        19050024
170200****************************************************************  19060024
170300 4750-CHECK-RECLASS.                                              19070024
170400                                                                  19080024
170500     INITIALIZE DCLTMDSEAR.                                       19090024
170600     MOVE AP045-CL-NBR       TO PV-CL-NBR.                        19100024
170700     MOVE 'SCL'              TO PV-MDSEAR-MDSELV-CDE.             19110024
170800     MOVE PV-DB2-CL-NBR      TO PV-MDSEAR-SUB-CL-CDE.             19120024
170900     MOVE ZEROES             TO PV-SUB-IND.                       19130024
171000     MOVE PV-CL-NBR          TO PV-MDSEAR-MAJ-CL-CDE.             19140024
171100                                                                  19150024
171200     EXEC SQL                                                     19160024
171300         SELECT                                                   19170024
171400             DEPT_NBR                                             19180024
171500            ,MAJ_CL_NBR                                           19190024
171600            ,SUB_CL_NBR                                           19200024
171700            ,MDSELV_CDE                                           19210024
171800         INTO                                                     19220024
171900             :MDSEAR-DEPT-NBR                                     19230024
172000            ,:MDSEAR-MAJ-CL-NBR                                   19240024
172100            ,:MDSEAR-SUB-CL-NBR                                   19250024
172200            ,:MDSEAR-MDSELV-CDE                                   19260024
172300         FROM TMDSEAR                                             19270024
172400         WHERE DEPT_NBR     =  :AP045-DEPT-NBR                    19280024
172500         AND   MDSELV_CDE   =  :PV-MDSEAR-MDSELV-CDE              19290024
172600         AND   MAJ_CL_NBR   =  :PV-MDSEAR-MAJ-CL-CDE              19300024
172700         AND   SUB_CL_NBR   =  :PV-MDSEAR-SUB-CL-CDE              19310024
172800         AND   STRT_DTE     <=  CURRENT DATE                      19320024
172900         AND   END_DTE      >=  CURRENT DATE                      19330024
173000     END-EXEC.                                                    19340024
173100                                                                  19350024
173200     EVALUATE TRUE                                                19360024
173300         WHEN SQLCODE = ZERO                                      19370024
173400             CONTINUE                                             19380024
173500         WHEN SQLCODE = +100                                      19390024
173600             DISPLAY 'PO NUMBER ==>   ' AP045-PO-NBR              19400024
173700             DISPLAY 'DEPARTMENT==>   ' AP045-DEPT-NBR            19410024
173800             DISPLAY 'CLASS     ==>   ' PV-MDSEAR-MAJ-CL-CDE      19420024
173900             DISPLAY 'SUBCLASS  ==>   ' PV-MDSEAR-SUB-CL-CDE      19430024
174000             IF AP045-SKU-NBR > 0                                 19440024
174100                PERFORM 4770-CLASS-BY-ITEM                        19450024
174200             END-IF                                               19460024
174300         WHEN SQLCODE < ZERO                                      19470024
174400         WHEN SQLCODE > ZERO                                      19480024
174500         WHEN SQLWARN0 NOT = SPACES                               19490024
174600             DISPLAY 'PO NUMBER ==>   ' AP045-PO-NBR              19500024
174700             DISPLAY 'DEPARTMENT==>   ' AP045-DEPT-NBR            19510024
174800             DISPLAY 'CLASS     ==>   ' PV-MDSEAR-MAJ-CL-CDE      19520024
174900             DISPLAY 'SUBCLASS  ==>   ' PV-MDSEAR-SUB-CL-CDE      19530024
175000     END-EVALUATE.                                                19540024
175100****************************************************************  19550024
175200 4770-CLASS-BY-ITEM.                                              19560024
175300                                                                  19570024
175400                                                                  19580024
175500     EXEC SQL                                                     19590024
175600        SELECT SUB_CL_NBR                                         19600024
175700        INTO :XLT00004-SUB-CL-NBR                                 19610024
175800        FROM XLT_SKU      A                                       19620024
175900          ,  XLT_VND_STYL B                                       19630024
176000        WHERE SKU_NBR =  :XLT00003-SKU-NBR                        19640024
176100          AND A.STYL_ID = B.STYL_ID                               19650024
176200          AND A.SKU_STAT_CDE <> '98'                              19660024
176300     END-EXEC.                                                    19670024
176400     EVALUATE TRUE                                                19680024
176500         WHEN SQLCODE = ZERO                                      19690024
176600             MOVE XLT00004-SUB-CL-NBR TO AP045-CL-NBR             19700024
176700         WHEN SQLCODE < ZERO                                      19710024
176800         WHEN SQLCODE > ZERO                                      19720024
176900         WHEN SQLWARN0 NOT = SPACES                               19730024
177000             CONTINUE                                             19740024
177100     END-EVALUATE.                                                19750024
177200****************************************************************  19760024
177300 4800-FRGT-ADJUSTMENTS.                                           19770024
177400                                                                  19780024
177500***  ZERO OUT THE WORK FIELDS                                     19790024
177600     MOVE 0 TO PV-DIFFERENCE                                      19800024
177700               PV-ADJUSTED-FIELD.                                 19810024
177800                                                                  19820024
177900*-----------                                                      19830024
178000*  CHARGES                                                        19840024
178100*-----------                                                      19850024
178200     IF VL049-CHARGE-3H                                           19860024
178300***  WHEN THE CALCULATED AMT IS GREATER THAN WHAT CMS SENT...     19870024
178400        IF PA-TOTAL-CHARGES-THIS-PO > VL049-CHRG-AMT              19880024
178500           COMPUTE PV-DIFFERENCE =                                19890024
178600                   PA-TOTAL-CHARGES-THIS-PO - VL049-CHRG-AMT      19900024
178700***     ADJ GRAND TOT CHARGE                                      19910024
178800           MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-ADJUSTED-FIELD     19920024
178900           COMPUTE PV-ADJUSTED-FIELD =                            19930024
179000                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              19940024
179100           MOVE PV-ADJUSTED-FIELD TO PV-ADJUSTED-TOT-FOR-PO       19950024
179200           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CHARGE           19960024
179300***     ADJ CHARGE FOR THIS PO                                    19970024
179400           MOVE 0 TO PV-ADJUSTED-FIELD                            19980024
179500           MOVE AP045-FRGT-AMT    TO PV-ADJUSTED-FIELD            19990024
179600           COMPUTE PV-ADJUSTED-FIELD =                            20000024
179700                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              20010024
179800           MOVE PV-ADJUSTED-FIELD TO AP045-FRGT-AMT               20020024
179900***NEW LOGIC   ***************************************************20030024
180000           COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES -          20040024
180100                               PV-DIFFERENCE                      20050024
180200           COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     20060024
180300                   PA-TOTAL-CHARGES-THIS-PO -                     20070024
180400                                      PV-DIFFERENCE               20080024
180500        END-IF                                                    20090024
180600                                                                  20100024
180700***  WHEN THE CALCULATED AMT IS LESS THAN WHAT CMS SENT...        20110024
180800        IF PA-TOTAL-CHARGES-THIS-PO < VL049-CHRG-AMT              20120024
180900           COMPUTE PV-DIFFERENCE =                                20130024
181000                   VL049-CHRG-AMT - PA-TOTAL-CHARGES-THIS-PO      20140024
181100***     ADJ GRAND TOT CHARGE                                      20150024
181200           MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-ADJUSTED-FIELD     20160024
181300           COMPUTE PV-ADJUSTED-FIELD =                            20170024
181400                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              20180024
181500           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CHARGE           20190024
181600***     ADJ CHARGE FOR THIS PO                                    20200024
181700           MOVE 0 TO PV-ADJUSTED-FIELD                            20210024
181800           MOVE AP045-FRGT-AMT    TO PV-ADJUSTED-FIELD            20220024
181900           COMPUTE PV-ADJUSTED-FIELD =                            20230024
182000                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              20240024
182100           MOVE PV-ADJUSTED-FIELD TO AP045-FRGT-AMT               20250024
182200***NEW LOGIC   ***************************************************20260024
182300           COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES +          20270024
182400                               PV-DIFFERENCE                      20280024
182500           COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     20290024
182600                   PA-TOTAL-CHARGES-THIS-PO +                     20300024
182700                                      PV-DIFFERENCE               20310024
182800***NEW LOGIC   ***************************************************20320024
182900        END-IF                                                    20330024
183000     END-IF.                                                      20340024
183100                                                                  20350024
183200*-----------                                                      20360024
183300*  CREDITS                                                        20370024
183400*-----------                                                      20380024
183500     IF VL049-CREDIT-3I                                           20390024
183600***  WHEN THE CALCULATED AMT IS GREATER THAN WHAT CMS SENT...     20400024
183700        IF PA-TOTAL-CREDITS-THIS-PO > VL049-CHRG-AMT              20410024
183800           COMPUTE PV-DIFFERENCE =                                20420024
183900                   PA-TOTAL-CREDITS-THIS-PO - VL049-CHRG-AMT      20430024
184000***     ADJ GRAND TOT CREDIT                                      20440024
184100           MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-ADJUSTED-FIELD     20450024
184200           COMPUTE PV-ADJUSTED-FIELD =                            20460024
184300                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              20470024
184400           MOVE PV-ADJUSTED-FIELD TO PV-ADJUSTED-TOT-FOR-PO       20480024
184500           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CREDIT           20490024
184600***     ADJ CREDIT FOR THIS PO                                    20500024
184700           MOVE 0 TO PV-ADJUSTED-FIELD                            20510024
184800           MOVE AP045-FRGT-AMT    TO PV-ADJUSTED-FIELD            20520024
184900           COMPUTE PV-ADJUSTED-FIELD =                            20530024
185000                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              20540024
185100           MOVE PV-ADJUSTED-FIELD TO AP045-FRGT-AMT               20550024
185200***NEW LOGIC   ***************************************************20560024
185300*          COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES -          20570024
185400*                              PV-DIFFERENCE                      20580024
185500*          COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     20590024
185600*                  PA-TOTAL-CHARGES-THIS-PO -                     20600024
185700*                                     PV-DIFFERENCE               20610024
185800           COMPUTE PA-TOTAL-CREDITS = PA-TOTAL-CREDITS -          20620024
185900                               PV-DIFFERENCE                      20630024
186000           COMPUTE PA-TOTAL-CREDITS-THIS-PO =                     20640024
186100                   PA-TOTAL-CREDITS-THIS-PO -                     20650024
186200                                      PV-DIFFERENCE               20660024
186300                                                                  20670024
186400        END-IF                                                    20680024
186500***  WHEN THE CALCULATED AMT IS LESS THAN WHAT CMS SENT...        20690024
186600        IF PA-TOTAL-CREDITS-THIS-PO < VL049-CHRG-AMT              20700024
186700           COMPUTE PV-DIFFERENCE =                                20710024
186800                   VL049-CHRG-AMT - PA-TOTAL-CREDITS-THIS-PO      20720024
186900***     ADJ GRAND TOT CREDIT                                      20730024
187000           MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-ADJUSTED-FIELD     20740024
187100           COMPUTE PV-ADJUSTED-FIELD =                            20750024
187200                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              20760024
187300           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CREDIT           20770024
187400***     ADJ CREDIT FOR THIS PO                                    20780024
187500           MOVE 0 TO PV-ADJUSTED-FIELD                            20790024
187600           MOVE AP045-FRGT-AMT    TO PV-ADJUSTED-FIELD            20800024
187700           COMPUTE PV-ADJUSTED-FIELD =                            20810024
187800                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              20820024
187900           MOVE PV-ADJUSTED-FIELD TO AP045-FRGT-AMT               20830024
188000***NEW LOGIC   ***************************************************20840024
188100*          COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES +          20850024
188200*                              PV-DIFFERENCE                      20860024
188300*          COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     20870024
188400*                  PA-TOTAL-CHARGES-THIS-PO +                     20880024
188500*                                     PV-DIFFERENCE               20890024
188600           COMPUTE PA-TOTAL-CREDITS = PA-TOTAL-CREDITS +          20900024
188700                               PV-DIFFERENCE                      20910024
188800           COMPUTE PA-TOTAL-CREDITS-THIS-PO =                     20920024
188900                   PA-TOTAL-CREDITS-THIS-PO +                     20930024
189000                                      PV-DIFFERENCE               20940024
189100***NEW LOGIC   ***************************************************20950024
189200        END-IF                                                    20960024
189300     END-IF.                                                      20970024
189400                                                                  20980024
189500*-----------                                                      20990024
189600*  PO FILL CHARGES                                                21000024
189700*-----------                                                      21010024
189800     IF VL049-PO-CHARGE-3U                                        21020024
189900***  WHEN THE CALCULATED AMT IS GREATER THAN WHAT CMS SENT...     21030024
190000        IF PA-TOTAL-CHARGES-THIS-PO > VL049-CHRG-AMT              21040024
190100           COMPUTE PV-DIFFERENCE =                                21050024
190200                   PA-TOTAL-CHARGES-THIS-PO - VL049-CHRG-AMT      21060024
190300***     ADJ GRAND TOT CHARGE                                      21070024
190400           MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-ADJUSTED-FIELD     21080024
190500           COMPUTE PV-ADJUSTED-FIELD =                            21090024
190600                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              21100024
190700           MOVE PV-ADJUSTED-FIELD TO PV-ADJUSTED-TOT-FOR-PO       21110024
190800           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CHARGE           21120024
190900***     ADJ CHARGE FOR THIS PO                                    21130024
191000           MOVE 0 TO PV-ADJUSTED-FIELD                            21140024
191100           MOVE AP045-GRO-COST-AMT    TO PV-ADJUSTED-FIELD        21150024
191200           COMPUTE PV-ADJUSTED-FIELD =                            21160024
191300                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              21170024
191400           MOVE PV-ADJUSTED-FIELD TO AP045-GRO-COST-AMT           21180024
191500           COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES -          21190024
191600                               PV-DIFFERENCE                      21200024
191700           COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     21210024
191800                   PA-TOTAL-CHARGES-THIS-PO -                     21220024
191900                                      PV-DIFFERENCE               21230024
192000        END-IF                                                    21240024
192100                                                                  21250024
192200***  WHEN THE CALCULATED AMT IS LESS THAN WHAT CMS SENT...        21260024
192300        IF PA-TOTAL-CHARGES-THIS-PO < VL049-CHRG-AMT              21270024
192400           COMPUTE PV-DIFFERENCE =                                21280024
192500                   VL049-CHRG-AMT - PA-TOTAL-CHARGES-THIS-PO      21290024
192600***     ADJ GRAND TOT CHARGE                                      21300024
192700           MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-ADJUSTED-FIELD     21310024
192800           COMPUTE PV-ADJUSTED-FIELD =                            21320024
192900                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              21330024
193000           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CHARGE           21340024
193100***     ADJ CHARGE FOR THIS PO                                    21350024
193200           MOVE 0 TO PV-ADJUSTED-FIELD                            21360024
193300           MOVE AP045-GRO-COST-AMT TO PV-ADJUSTED-FIELD           21370024
193400           COMPUTE PV-ADJUSTED-FIELD =                            21380024
193500                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              21390024
193600           MOVE PV-ADJUSTED-FIELD TO AP045-GRO-COST-AMT           21400024
193700           COMPUTE PA-TOTAL-CHARGES = PA-TOTAL-CHARGES +          21410024
193800                               PV-DIFFERENCE                      21420024
193900           COMPUTE PA-TOTAL-CHARGES-THIS-PO =                     21430024
194000                   PA-TOTAL-CHARGES-THIS-PO +                     21440024
194100                                      PV-DIFFERENCE               21450024
194200        END-IF                                                    21460024
194300     END-IF.                                                      21470024
194400                                                                  21480024
194500*-----------                                                      21490024
194600*  PO FILL CREDITS                                                21500024
194700*-----------                                                      21510024
194800     IF VL049-PO-CREDIT-3V                                        21520024
194900***  WHEN THE CALCULATED AMT IS GREATER THAN WHAT CMS SENT...     21530024
195000        IF PA-TOTAL-CREDITS-THIS-PO > VL049-CHRG-AMT              21540024
195100           COMPUTE PV-DIFFERENCE =                                21550024
195200                   PA-TOTAL-CREDITS-THIS-PO - VL049-CHRG-AMT      21560024
195300***     ADJ GRAND TOT CREDIT                                      21570024
195400           MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-ADJUSTED-FIELD     21580024
195500           COMPUTE PV-ADJUSTED-FIELD =                            21590024
195600                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              21600024
195700           MOVE PV-ADJUSTED-FIELD TO PV-ADJUSTED-TOT-FOR-PO       21610024
195800           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CREDIT           21620024
195900***     ADJ CREDIT FOR THIS PO                                    21630024
196000           MOVE 0 TO PV-ADJUSTED-FIELD                            21640024
196100           MOVE AP045-GRO-COST-AMT   TO PV-ADJUSTED-FIELD         21650024
196200           COMPUTE PV-ADJUSTED-FIELD =                            21660024
196300                   PV-ADJUSTED-FIELD - PV-DIFFERENCE              21670024
196400           MOVE PV-ADJUSTED-FIELD TO AP045-GRO-COST-AMT           21680024
196500           COMPUTE PA-TOTAL-CREDITS = PA-TOTAL-CREDITS -          21690024
196600                               PV-DIFFERENCE                      21700024
196700           COMPUTE PA-TOTAL-CREDITS-THIS-PO =                     21710024
196800                   PA-TOTAL-CREDITS-THIS-PO -                     21720024
196900                                      PV-DIFFERENCE               21730024
197000                                                                  21740024
197100        END-IF                                                    21750024
197200***  WHEN THE CALCULATED AMT IS LESS THAN WHAT CMS SENT...        21760024
197300        IF PA-TOTAL-CREDITS-THIS-PO < VL049-CHRG-AMT              21770024
197400           COMPUTE PV-DIFFERENCE =                                21780024
197500                   VL049-CHRG-AMT - PA-TOTAL-CREDITS-THIS-PO      21790024
197600***     ADJ GRAND TOT CREDIT                                      21800024
197700           MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-ADJUSTED-FIELD     21810024
197800           COMPUTE PV-ADJUSTED-FIELD =                            21820024
197900                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              21830024
198000           ADD PV-ADJUSTED-FIELD TO PV-ADJ-GRAND-CREDIT           21840024
198100***     ADJ CREDIT FOR THIS PO                                    21850024
198200           MOVE 0 TO PV-ADJUSTED-FIELD                            21860024
198300           MOVE AP045-GRO-COST-AMT    TO PV-ADJUSTED-FIELD        21870024
198400           COMPUTE PV-ADJUSTED-FIELD =                            21880024
198500                   PV-ADJUSTED-FIELD + PV-DIFFERENCE              21890024
198600           MOVE PV-ADJUSTED-FIELD TO AP045-GRO-COST-AMT           21900024
198700           COMPUTE PA-TOTAL-CREDITS = PA-TOTAL-CREDITS +          21910024
198800                               PV-DIFFERENCE                      21920024
198900           COMPUTE PA-TOTAL-CREDITS-THIS-PO =                     21930024
199000                   PA-TOTAL-CREDITS-THIS-PO +                     21940024
199100                                      PV-DIFFERENCE               21950024
199200        END-IF                                                    21960024
199300     END-IF.                                                      21970024
199400                                                                  21980024
199500******************************************************************21990024
199600* GET A RECEIVER THAT IS ASSOCIATED TO THE DC BEING PROVIDED FOR  22000024
199700*    A SPECIFIC PURCHASE ORDER                                    22010024
199800******************************************************************22020024
199900 5000-GET-RECEIVER.                                               22030024
200000     INITIALIZE DCLTRECEIV.                                       22040024
200100     EXEC SQL                                                     22050024
200200          SELECT MIN(REC_SEQ_NBR)                                 22060024
200300            INTO :RECEIV-REC-SEQ-NBR                              22070024
200400            FROM TRECEIV                                          22080024
200500           WHERE ORD_NBR           = :PV-VL049-PO-NBR-COMP        22090024
200600             AND (CURR_OPER_UNT_ID = :PV-VL049-LOCATION-COMP OR   22100024
200700                  OPER_UNT_ID      = :PV-VL049-LOCATION-COMP)     22110024
200800             AND FCLTY_ID          = 1                            22120024
200900             AND STATUS_CDE        = 'VE'                         22130024
201000             AND VER_STATUS_CDE    = 'A'                          22140024
201010             AND FS_POST_TMST    ^= '9999-09-09-09.09.09.999999'  22150024
201100     END-EXEC.                                                    22160024
201200                                                                  22170024
201300     EVALUATE TRUE                                                22180024
201400         WHEN SQLCODE = ZERO                                      22190024
201500             CONTINUE                                             22200024
201600         WHEN SQLCODE = -305                                      22210024
201700             MOVE 0 TO RECEIV-REC-SEQ-NBR                         22220024
201800             MOVE 'NO RECEIVER FOUND FOR PO/DC' TO PV-ERROR-MSG   22230024
201900             PERFORM 8500-PRINT-ERROR-RPT                         22240024
202000             ADD 1 TO PA-ERR-RCVR-PODC                            22250024
202100         WHEN SQLCODE < ZERO                                      22260024
202200         WHEN SQLCODE > ZERO                                      22270024
202300         WHEN SQLWARN0 NOT = SPACES                               22280024
202400             DISPLAY 'PO NUMBER ==>   ' VL049-PO-NBR              22290024
202500             DISPLAY 'LOCATION  ==>   ' VL049-LOCATION            22300024
202600             MOVE '5000-GET-RECEIVER  ' TO PV-PARAGRAPH           22310024
202700             MOVE 'SELECT'              TO PV-DB2-FUNCTION        22320024
202800             MOVE 'TRECEIV'             TO PV-DB2-TABLE-1         22330024
202900             PERFORM 9200-SQL-ERROR                               22340024
203000     END-EVALUATE.                                                22350024
203100                                                                  22360024
203200******************************************************************22370024
203300* GET A RECEIVER FOR A SPECIFIC PURCHASE ORDER                    22380024
203400******************************************************************22390024
203500 5100-GET-RECEIVER.                                               22400024
203600     INITIALIZE DCLTRECEIV.                                       22410024
203700     EXEC SQL                                                     22420024
203800          SELECT MIN(REC_SEQ_NBR)                                 22430024
203900            INTO :RECEIV-REC-SEQ-NBR                              22440024
204000            FROM TRECEIV                                          22450024
204100           WHERE ORD_NBR = :PV-VL049-PO-NBR-COMP                  22460024
204200             AND FCLTY_ID    = 1                                  22470024
204300             AND STATUS_CDE  = 'VE'                               22480024
204400             AND VER_STATUS_CDE = 'A'                             22490024
204410             AND FS_POST_TMST  ^= '9999-09-09-09.09.09.999999'    22500024
204500     END-EXEC.                                                    22510024
204600                                                                  22520024
204700     EVALUATE TRUE                                                22530024
204800         WHEN SQLCODE = ZERO                                      22540024
204900             CONTINUE                                             22550024
205000         WHEN SQLCODE = -305                                      22560024
205100             MOVE 0 TO RECEIV-REC-SEQ-NBR                         22570024
205200             MOVE 'NO RECEIVER FOUND FOR PO' TO PV-ERROR-MSG      22580024
205300             PERFORM 8500-PRINT-ERROR-RPT                         22590024
205400             ADD 1 TO PA-ERR-RCVR-PO                              22600024
205500         WHEN SQLCODE < ZERO                                      22610024
205600         WHEN SQLCODE > ZERO                                      22620024
205700         WHEN SQLWARN0 NOT = SPACES                               22630024
205800             DISPLAY 'PO NUMBER ==>   ' VL049-PO-NBR              22640024
205900             MOVE '5100-GET-RECEIVER  ' TO PV-PARAGRAPH           22650024
206000             MOVE 'SELECT'              TO PV-DB2-FUNCTION        22660024
206100             MOVE 'TRECEIV'             TO PV-DB2-TABLE-1         22670024
206200             PERFORM 9200-SQL-ERROR                               22680024
206300     END-EVALUATE.                                                22690024
206400                                                                  22700024
206500******************************************************************22710024
206600* VALIDATE THAT THE LOCATION IS VALID                             22720024
206700******************************************************************22730024
206800 5200-CHECK-LOCN.                                                 22740024
206900                                                                  22750024
207000*    MOVE VL049-LOCATION               TO XLT00010-LOC-NBR        22760024
207100     MOVE PV-NBR-CHAR4                 TO XLT00010-LOC-NBR        22770024
207200                                                                  22780024
207300     EXEC SQL                                                     22790024
207400          SELECT LOC_TYP_CDE                                      22800024
207500          INTO  :XLT00010-LOC-TYP-CDE                             22810024
207600          FROM   XLT_LOC                                          22820024
207700          WHERE  LOC_NBR             = :XLT00010-LOC-NBR          22830024
207800     END-EXEC.                                                    22840024
207900                                                                  22850024
208000     EVALUATE TRUE                                                22860024
208100         WHEN SQLCODE = ZERO                                      22870024
208200             CONTINUE                                             22880024
208300         WHEN SQLCODE = +100                                      22890024
208400             MOVE 'INVALID LOCATION' TO PV-ERROR-MSG              22900024
208500             PERFORM 8500-PRINT-ERROR-RPT                         22910024
208600             ADD 1 TO PA-ERR-LOC-NBR                              22920024
208700             MOVE 'Y' TO PV-ERROR-FOUND                           22930024
208800         WHEN SQLCODE < ZERO                                      22940024
208900         WHEN SQLCODE > ZERO                                      22950024
209000         WHEN SQLWARN0 NOT = SPACES                               22960024
209100             DISPLAY 'PO NUMBER ==>   ' VL049-PO-NBR              22970024
209200             MOVE '5200-CHECK-LOCN    ' TO PV-PARAGRAPH           22980024
209300             MOVE 'SELECT'              TO PV-DB2-FUNCTION        22990024
209400             MOVE 'XLT_LOC'             TO PV-DB2-TABLE-1         23000024
209500             PERFORM 9200-SQL-ERROR                               23010024
209600     END-EVALUATE.                                                23020024
209700                                                                  23030024
209800******************************************************************23040024
209900* VALIDATE THAT THE LOCATION IS VALID AND IT IS A DC              23050024
210000******************************************************************23060024
210100 5300-CHECK-LOC-FR.                                               23070024
210200                                                                  23080024
210300     MOVE DP010I-NUMERIC-FIELD         TO XLT00010-LOC-NBR        23090024
210400                                                                  23100024
210500     EXEC SQL                                                     23110024
210600          SELECT LOC_NM                                           23120024
210700          INTO  :XLT00010-LOC-NM                                  23130024
210800          FROM   XLT_LOC                                          23140024
210900          WHERE  LOC_NBR             = :XLT00010-LOC-NBR          23150024
211000            AND  LOC_TYP_CDE         = 'DC'                       23160024
211100     END-EXEC.                                                    23170024
211200                                                                  23180024
211300     EVALUATE TRUE                                                23190024
211400         WHEN SQLCODE = ZERO                                      23200024
211500             CONTINUE                                             23210024
211600         WHEN SQLCODE = +100                                      23220024
211700             MOVE 'INVALID LOCATION/NOT DC' TO PV-ERROR-MSG       23230024
211800             PERFORM 8500-PRINT-ERROR-RPT                         23240024
211900             ADD 1 TO PA-ERR-LOC-NBR                              23250024
212000             MOVE 'Y' TO PV-ERROR-FOUND                           23260024
212100         WHEN SQLCODE < ZERO                                      23270024
212200         WHEN SQLCODE > ZERO                                      23280024
212300         WHEN SQLWARN0 NOT = SPACES                               23290024
212400             DISPLAY 'PO NUMBER ==>   ' VL049-PO-NBR              23300024
212500             DISPLAY 'LOCATION  ==>   ' PV-NBR-CHAR4              23310024
212600             MOVE '5300-CHECK-LOC-FR  ' TO PV-PARAGRAPH           23320024
212700             MOVE 'SELECT'              TO PV-DB2-FUNCTION        23330024
212800             MOVE 'XLT_LOC'             TO PV-DB2-TABLE-1         23340024
212900             PERFORM 9200-SQL-ERROR                               23350024
213000     END-EVALUATE.                                                23360024
213100                                                                  23370024
213200******************************************************************23380024
213300* SELECT THE NEXT BATCH PROCESSING DATE FROM THE TAPCNTL TABLE.   23390024
213400*    AP WILL GET THE FILE FOR PROCESSING THE NEXT DAY, NOT ON THE 23400024
213500*    SAME DAY THE FILE IS CREATED                                 23410024
213600******************************************************************23420024
213700 7000-SELECT-TAPCNTL.                                             23430024
213800***  GB 2/7/08 BEG                                                23440024
213900*    EXEC SQL                                                     23450024
214000*        SELECT CURRENT DATE                                      23460024
214100*        INTO :APCNTL-NEXT-BTCH-PRC-DTE                           23470024
214200*        FROM TAPCNTL                                             23480024
214300*    END-EXEC.                                                    23490024
214400***  TEMP CHANGE FOR TESTING -- PER M.BESKSE THE NEXT_BTCH_PRC_DTE23500024
214500***  CAN BE CHANGED IN TEST AND THIS WILL CAUSE THE FILE TO       23510024
214600***  ERROR OUT IN A/P                                             23520024
214700***  THE APCNTL-NEXT-BTCH-PRC-DTE WHICH IS MOVED TO               23530024
214800***  AP045-ENTR-DTE   MUST BE  GREATER THAN OR EQUAL TO           23540024
214900***  THE AP045-DOC-DTE                                            23550024
215000***  GB 2/7/08 END                                                23560024
215100                                                                  23570024
215200     INITIALIZE DCLTAPCNTL.                                       23580024
215300     EXEC SQL                                                     23590024
215400         SELECT NEXT_BTCH_PRC_DTE                                 23600024
215500         INTO :APCNTL-NEXT-BTCH-PRC-DTE                           23610024
215600         FROM TAPCNTL                                             23620024
215700     END-EXEC.                                                    23630024
215800                                                                  23640024
215900     EVALUATE TRUE                                                23650024
216000         WHEN SQLCODE = ZERO                                      23660024
216100             CONTINUE                                             23670024
216200         WHEN SQLCODE < ZERO                                      23680024
216300         WHEN SQLCODE > ZERO                                      23690024
216400         WHEN SQLWARN0 NOT = SPACES                               23700024
216500             MOVE '7000-SELECT-TAPCNTL' TO PV-PARAGRAPH           23710024
216600             MOVE 'SELECT'              TO PV-DB2-FUNCTION        23720024
216700             MOVE 'TAPCNTL'             TO PV-DB2-TABLE-1         23730024
216800             PERFORM 9200-SQL-ERROR                               23740024
216900     END-EVALUATE.                                                23750024
217000                                                                  23760024
217100******************************************************************23770024
217200* SELECT THE POSTING TYPE CODE, TRANSACTION TYPE CODE, THE GL ACCT23780024
217300*    NUMBER AND THE BATCH SOURCE CODE FROM TTRNCDE TABLE          23790024
217400******************************************************************23800024
217500 7050-SELECT-TTRNCDE.                                             23810024
217600     EXEC SQL                                                     23820024
217700         SELECT SUB_CL_REQR_IND                                   23830024
217800              , SKU_SEQ_REQR_IND                                  23840024
217900              , PSTG_TYP_CDE                                      23850024
218000              , TRN_TYP_CDE                                       23860024
218100              , BTCH_SRC_CDE                                      23870024
218200           INTO :TRNCDE-SUB-CL-REQR-IND                           23880024
218300              , :TRNCDE-SKU-SEQ-REQR-IND                          23890024
218400              , :TRNCDE-PSTG-TYP-CDE                              23900024
218500              , :TRNCDE-TRN-TYP-CDE                               23910024
218600              , :TRNCDE-BTCH-SRC-CDE                              23920024
218700           FROM TTRNCDE                                           23930024
218800          WHERE AP_TRN_CDE    = :TRNCDE-AP-TRN-CDE                23940024
218900            AND EFF_STRT_DTE <= :APCNTL-NEXT-BTCH-PRC-DTE         23950024
219000            AND EFF_END_DTE  >= :APCNTL-NEXT-BTCH-PRC-DTE         23960024
219100     END-EXEC.                                                    23970024
219200                                                                  23980024
219300     EVALUATE TRUE                                                23990024
219400         WHEN SQLCODE = ZERO                                      24000024
219500             MOVE TRNCDE-SUB-CL-REQR-IND                          24010024
219600                                   TO PV-SUB-CL-REQR-IND (PV-SUB) 24020024
219700             MOVE TRNCDE-SKU-SEQ-REQR-IND                         24030024
219800                                   TO PV-SKU-SEQ-REQR-IND (PV-SUB)24040024
219900             MOVE TRNCDE-PSTG-TYP-CDE TO PV-PSTG-TYP-CDE (PV-SUB) 24050024
220000             MOVE TRNCDE-TRN-TYP-CDE  TO PV-TRN-TYP-CDE (PV-SUB)  24060024
220100             MOVE TRNCDE-BTCH-SRC-CDE TO PV-BTCH-SRC-CDE (PV-SUB) 24070024
220200                                                                  24080024
220300         WHEN SQLCODE < ZERO                                      24090024
220400         WHEN SQLCODE > ZERO                                      24100024
220500         WHEN SQLWARN0 NOT = SPACES                               24110024
220600             MOVE '7050-SELECT-TTRNCDE' TO PV-PARAGRAPH           24120024
220700             MOVE 'SELECT'              TO PV-DB2-FUNCTION        24130024
220800             STRING 'AP TRAN CDE: ' DELIMITED BY SIZE             24140024
220900                    TRNCDE-AP-TRN-CDE DELIMITED BY SIZE           24150024
221000                INTO PV-DB2-TEXT                                  24160024
221100             MOVE 'TTRNCDE'             TO PV-DB2-TABLE-1         24170024
221200             PERFORM 9200-SQL-ERROR                               24180024
221300     END-EVALUATE.                                                24190024
221400                                                                  24200024
221500******************************************************************24210024
221600* READ THE EXTRACT FILE                                           24220024
221700******************************************************************24230024
221800 8000-READ-INPUT.                                                 24240024
221900     READ CMS-EXT-FILE                                            24250024
222000         INTO VL049-AP-INTERFACE-RECORD                           24260024
222100     AT END                                                       24270024
222200         SET PS-END-INPUT TO TRUE                                 24280024
222300     NOT AT END                                                   24290024
222400         ADD 1              TO PV-READ-COUNT                      24300024
222500                               PV-COMPARE-REC-CNT                 24310024
222600     END-READ.                                                    24320024
222700                                                                  24330024
222800******************************************************************24340024
222900* WRITE OUT THE AP TRANSACTION FILE                               24350024
223000******************************************************************24360024
223100 8100-WRITE-AP-TRANS-REC.                                         24370024
223200     IF VL049-CONTROL-RECORD                                      24380024
223300       WRITE AP-TRANSACTION-RECORD                                24390024
223400           FROM AP045-TRANSACTION-FILE                            24400024
223500       ADD 1                  TO PA-TOT-RECS-WRIT                 24410024
223600     ELSE                                                         24420024
223700       IF VL049-DETAIL-RECORD AND                                 24430024
223800          (AP045-FRGT-AMT NOT = 0 OR                              24440024
223900           AP045-GRO-COST-AMT NOT = 0 )                           24450024
224000          WRITE AP-TRANSACTION-RECORD                             24460024
224100              FROM AP045-TRANSACTION-FILE                         24470024
224200          ADD 1                  TO PA-TOT-RECS-WRIT              24480024
224300          ADD 1                  TO PA-RECS-WRIT-THIS-PO          24490024
224400       END-IF                                                     24500024
224500     END-IF.                                                      24510024
224600                                                                  24520024
224700     IF VL049-DETAIL-RECORD AND CC-DISP-PO-DETAILS = PC-Y         24530024
224800        PERFORM 8200-DISPLAY-STATS-AFTER-WRITE                    24540024
224900     END-IF.                                                      24550024
225000                                                                  24560024
225100******************************************************************24570024
225200* DISPLAY STATS AFTER WRITING OUTPUT REC  (FOR UNIT TESTING)      24580024
225210******************************************************************24590024
225220 8200-DISPLAY-STATS-AFTER-WRITE.                                  24600024
225230                                                                  24610024
225240     DISPLAY '#'                                                  24620024
225250     DISPLAY 'SEQ NBR...................:' PA-PRORATE-REC-COUNT   24630024
225260     DISPLAY 'PO NBR....................:' AJPRRT-PO-NBR          24640024
225270     DISPLAY 'DEPT NBR..................:' AJPRRT-DEPT-NBR        24650024
225280     DISPLAY 'CL NBR....................:' AJPRRT-CL-NBR          24660024
225290     DISPLAY 'SKU NBR...................:' AJPRRT-SKU-NBR         24670024
225300     DISPLAY 'PRORATE PCT...............:' AJPRRT-PRRT-PCT        24680024
225400     IF VL049-CHARGE-3H                                           24690024
225500        MOVE VL049-CHRG-AMT TO PV-VL049-TOT-FRGT-SIGNED           24700024
225600        COMPUTE PV-VL049-TOT-FRGT-SIGNED =                        24710024
225700                PV-VL049-TOT-FRGT-SIGNED * -1                     24720024
225800        MOVE PV-VL049-TOT-FRGT-SIGNED TO PV-DISP-DOLLAR           24730024
225900        DISPLAY 'TOT FRGT AMT SENT.........:' PV-DISP-DOLLAR      24740024
226000     END-IF                                                       24750024
226100     IF VL049-CREDIT-3I                                           24760024
226200        MOVE VL049-CHRG-AMT TO PV-DISP-DOLLAR                     24770024
226300        DISPLAY 'TOT FRGT AMT SENT.........:' PV-DISP-DOLLAR      24780024
226400     END-IF                                                       24790024
226500     IF VL049-PO-CHARGE-3U                                        24800024
226600        MOVE VL049-CHRG-AMT TO PV-VL049-TOT-FRGT-SIGNED           24810024
226700        COMPUTE PV-VL049-TOT-FRGT-SIGNED =                        24820024
226800                PV-VL049-TOT-FRGT-SIGNED * -1                     24830024
226900        MOVE PV-VL049-TOT-FRGT-SIGNED TO PV-DISP-DOLLAR           24840024
227000        DISPLAY 'TOT PO FILL AMT SENT......:' PV-DISP-DOLLAR      24850024
227100     END-IF                                                       24860024
227200     IF VL049-PO-CREDIT-3V                                        24870024
227300        MOVE VL049-CHRG-AMT TO PV-DISP-DOLLAR                     24880024
227400        DISPLAY 'TOT PO FILL AMT SENT......:' PV-DISP-DOLLAR      24890024
227500     END-IF                                                       24900024
227600     IF VL049-CHARGE-3H OR                                        24910024
227700        VL049-CREDIT-3I                                           24920024
227800         MOVE AP045-FRGT-AMT TO PV-DISP-DOLLAR                    24930024
227900     ELSE                                                         24940024
228000         MOVE AP045-GRO-COST-AMT TO PV-DISP-DOLLAR                24950024
228100     END-IF                                                       24960024
228200     DISPLAY 'CALC OUTPUT FRGT AMT......:' PV-DISP-DOLLAR         24970024
228300                                                                  24980024
228400     IF VL049-CHARGE-3H OR                                        24990024
228500        VL049-PO-CHARGE-3U                                        25000024
228600        MOVE 0 TO PV-SIGNED-FIELD                                 25010024
228700        MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-SIGNED-FIELD          25020024
228800        COMPUTE PV-SIGNED-FIELD =                                 25030024
228900                PV-SIGNED-FIELD * -1                              25040024
229000        MOVE PV-SIGNED-FIELD          TO PV-DISP-DOLLAR           25050024
229100        DISPLAY 'TOT CHARGE THIS PO........:' PV-DISP-DOLLAR      25060024
229200        MOVE 0 TO PV-SIGNED-FIELD                                 25070024
229300        MOVE PA-TOTAL-CHARGES TO PV-SIGNED-FIELD                  25080024
229400        COMPUTE PV-SIGNED-FIELD =                                 25090024
229500                PV-SIGNED-FIELD * -1                              25100024
229600        MOVE PV-SIGNED-FIELD  TO PV-DISP-DOLLAR                   25110024
229700        DISPLAY 'GRAND TOT CHARGES.........:' PV-DISP-DOLLAR      25120024
229800        IF PV-ADJUSTED-FIELD > 0                                  25130024
229900           COMPUTE PV-ADJUSTED-FIELD =                            25140024
230000                   PV-ADJUSTED-FIELD * -1                         25150024
230100           MOVE PV-ADJUSTED-FIELD  TO PV-DISP-ADJUSTED-FIELD      25160024
230200           DISPLAY 'ADJ CHARGE THIS PO........:'                  25170024
230300                                        PV-DISP-ADJUSTED-FIELD    25180024
230400           MOVE PV-ADJ-GRAND-CHARGE TO PV-SIGNED-FIELD            25190024
230500           COMPUTE PV-SIGNED-FIELD =                              25200024
230600                   PV-SIGNED-FIELD * -1                           25210024
230700           MOVE PV-SIGNED-FIELD TO PV-DISP-DOLLAR                 25220024
230800           DISPLAY 'GRAND TOT ADJ CHARGES.....:' PV-DISP-DOLLAR   25230024
230900        END-IF                                                    25240024
231000     ELSE                                                         25250024
231100        MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-DISP-DOLLAR           25260024
231200        DISPLAY 'TOT CREDIT THIS PO........:' PV-DISP-DOLLAR      25270024
231300        MOVE PA-TOTAL-CREDITS TO PV-DISP-DOLLAR                   25280024
231400        DISPLAY 'GRAND TOT CREDITS.........:' PV-DISP-DOLLAR      25290024
231500        IF PV-ADJUSTED-FIELD > 0                                  25300024
231600           MOVE PV-ADJUSTED-FIELD  TO PV-DISP-ADJUSTED-FIELD      25310024
231700           DISPLAY 'ADJ CREDIT THIS PO........:'                  25320024
231800                                     PV-DISP-ADJUSTED-FIELD       25330024
231900           MOVE PV-ADJ-GRAND-CREDIT TO PV-DISP-DOLLAR             25340024
232000           DISPLAY 'GRAND TOT ADJ CREDITS.....:' PV-DISP-DOLLAR   25350024
232100        END-IF                                                    25360024
232200     END-IF.                                                      25370024
232300                                                                  25380024
232400******************************************************************25390024
232500* DISPLAY SUMMARY STATS FOR A PO (EITHER END OF WRITING OR END    25400024
232600* OF CURSOR).                                                     25410024
232700******************************************************************25420024
232800 8300-DISPLAY-STATS-FOR-PO.                                       25430024
232900                                                                  25440024
233000     IF CC-DISP-PO-SUMMARY = PC-Y                                 25450024
233100        DISPLAY ' '                                               25460024
233200        DISPLAY '=========================='                      25470024
233300        DISPLAY '===   SUMMARY FOR PO   ==='                      25480024
233400        IF VL049-CHARGE-3H OR                                     25490024
233500           VL049-PO-CHARGE-3U                                     25500024
233600           DISPLAY '===     C H A R G E    ==='                   25510024
233700           DISPLAY '=========================='                   25520024
233800        ELSE                                                      25530024
233900           DISPLAY '===     C R E D I T    ==='                   25540024
234000           DISPLAY '=========================='                   25550024
234100        END-IF                                                    25560024
234200        DISPLAY 'SEQ NBR...................:' PA-PRORATE-REC-COUNT25570024
234300        DISPLAY 'PO NBR....................:' AJPRRT-PO-NBR       25580024
234400        DISPLAY 'RCVR SEQ..................:' AJPRRT-RCVR-SEQ-NBR 25590024
234500        DISPLAY 'PRORATE PCT...............:' AJPRRT-PRRT-PCT     25600024
234600        MOVE PA-TOT-TAJPRRT-RECS-FOR-PO TO PV-DISP-NUMBER         25610024
234700        DISPLAY 'TAJPRRT RECS FOR PO.......:' PV-DISP-NUMBER      25620024
234800        MOVE PA-RECS-WRIT-THIS-PO       TO PV-DISP-NUMBER         25630024
234900        DISPLAY 'RECS WRITTEN THIS PO......:' PV-DISP-NUMBER      25640024
235000                                                                  25650024
235100        IF VL049-CHARGE-3H OR                                     25660024
235200           VL049-PO-CHARGE-3U                                     25670024
235300           MOVE VL049-CHRG-AMT                                    25680024
235400             TO PV-VL049-TOT-FRGT-SIGNED                          25690024
235500           COMPUTE PV-VL049-TOT-FRGT-SIGNED =                     25700024
235600                   PV-VL049-TOT-FRGT-SIGNED * -1                  25710024
235700           MOVE PV-VL049-TOT-FRGT-SIGNED TO PV-DISP-DOLLAR        25720024
235800           DISPLAY 'TOT FRGT AMT SENT.........:' PV-DISP-DOLLAR   25730024
235900        ELSE                                                      25740024
236000           MOVE VL049-CHRG-AMT TO PV-DISP-DOLLAR                  25750024
236100           DISPLAY 'TOT FRGT AMT SENT.........:' PV-DISP-DOLLAR   25760024
236200        END-IF                                                    25770024
236300                                                                  25780024
236400        IF VL049-CHARGE-3H OR                                     25790024
236500           VL049-PO-CHARGE-3U                                     25800024
236600           MOVE PA-TOTAL-CHARGES-THIS-PO TO PV-SIGNED-FIELD       25810024
236700           COMPUTE PV-SIGNED-FIELD =                              25820024
236800                   PV-SIGNED-FIELD * -1                           25830024
236900           MOVE PV-SIGNED-FIELD          TO PV-DISP-DOLLAR        25840024
237000           DISPLAY 'CALC FRGT THIS PO.........:' PV-DISP-DOLLAR   25850024
237100           MOVE PV-ADJUSTED-TOT-FOR-PO TO PV-SIGNED-FIELD         25860024
237200           COMPUTE PV-SIGNED-FIELD =                              25870024
237300                   PV-SIGNED-FIELD * -1                           25880024
237400           MOVE PV-SIGNED-FIELD        TO PV-DISP-DOLLAR          25890024
237500           DISPLAY 'ADJ CHRG THIS PO..........:' PV-DISP-DOLLAR   25900024
237600                                                                  25910024
237700           MOVE PV-ADJ-GRAND-CHARGE TO PV-SIGNED-FIELD            25920024
237800           COMPUTE PV-SIGNED-FIELD =                              25930024
237900                   PV-SIGNED-FIELD * -1                           25940024
238000           MOVE PV-SIGNED-FIELD     TO PV-DISP-DOLLAR             25950024
238100           DISPLAY 'GRAND TOT ADJ CHRGS.......:' PV-DISP-DOLLAR   25960024
238200           DISPLAY '======================'                       25970024
238300           DISPLAY ' '                                            25980024
238400        ELSE                                                      25990024
238500           MOVE PA-TOTAL-CREDITS-THIS-PO TO PV-DISP-DOLLAR        26000024
238600           DISPLAY 'CALC FRGT THIS PO.........:' PV-DISP-DOLLAR   26010024
238700           MOVE PV-ADJUSTED-TOT-FOR-PO TO PV-DISP-DOLLAR          26020024
238800           DISPLAY 'ADJ CRED THIS PO..........:' PV-DISP-DOLLAR   26030024
238900           MOVE PV-ADJ-GRAND-CREDIT  TO PV-DISP-DOLLAR            26040024
239000           DISPLAY 'PV-ADJ-GRAND-CREDIT.......:' PV-DISP-DOLLAR   26050024
239100           DISPLAY '======================'                       26060024
239200           DISPLAY ' '                                            26070024
239300        END-IF                                                    26080024
239400     END-IF.                                                      26090024
239500                                                                  26100024
239600     MOVE 0 TO PA-PRORATE-REC-COUNT                               26110024
239700               PA-TOTAL-CHARGES-THIS-PO                           26120024
239800               PA-TOTAL-CREDITS-THIS-PO                           26130024
239900               PV-ADJUSTED-TOT-FOR-PO                             26140024
240000               PA-RECS-WRIT-THIS-PO.                              26150024
240100                                                                  26160024
240200******************************************************************26170024
240300* 8400-PRINT-HEADINGS.                                            26180024
240400******************************************************************26190024
240500 8400-PRINT-HEADINGS.                                             26200024
240600                                                                  26210024
240700     ADD +1                    TO PV-PAGE-CNT.                    26220024
240800     MOVE PV-PAGE-CNT          TO HL1-PG-NBR.                     26230024
240900     MOVE +0                   TO PV-LINE-CNT.                    26240024
241000                                                                  26250024
241100     WRITE AP-ERROR-RECORD FROM                                   26260024
241200           HL1-HEADING-LINE-1 AFTER ADVANCING PAGE.               26270024
241300                                                                  26280024
241400     WRITE AP-ERROR-RECORD FROM                                   26290024
241500           HL2-HEADING-LINE-2 AFTER 1 LINES.                      26300024
241600                                                                  26310024
241700     WRITE AP-ERROR-RECORD FROM                                   26320024
241800           DH1-DETAIL-HEADING-1 AFTER 2 LINES.                    26330024
241900                                                                  26340024
242000     WRITE AP-ERROR-RECORD FROM                                   26350024
242100           DH2-DETAIL-HEADING-2 AFTER 1 LINES.                    26360024
242200                                                                  26370024
242300     WRITE AP-ERROR-RECORD FROM                                   26380024
242400           DH3-DETAIL-HEADING-3 AFTER 1 LINES.                    26390024
242500                                                                  26400024
242600     WRITE AP-ERROR-RECORD FROM                                   26410024
242700           BLANK-LINE AFTER 1 LINES.                              26420024
242800                                                                  26430024
242900     MOVE 8 TO PV-LINE-CNT.                                       26440024
243000                                                                  26450024
243100******************************************************************26460024
243200* 8500-PRINT-ERROR-RPT.                                           26470024
243300******************************************************************26480024
243400 8500-PRINT-ERROR-RPT.                                            26490024
243500                                                                  26500024
243600     IF PV-LINE-CNT > 56                                          26510024
243700         PERFORM 8400-PRINT-HEADINGS                              26520024
243800     END-IF.                                                      26530024
243900     MOVE VL049-PO-NBR        TO DL-PO-NBR.                       26540024
244000     MOVE VL049-VND-NBR       TO DL-VENDOR-NBR.                   26550024
244100     MOVE VL049-ENT-NME-DESC  TO DL-VENDOR-NAME.                  26560024
      *CHG0211865                                                       26570024
244200     MOVE VL049-DOC-NBR       TO PV-TEMP-DOC-NBR.                 26580024
           MOVE VL049-DOC-YY        TO PV-DTE-YY                        26590024
           MOVE VL049-DOC-MM        TO PV-DTE-MM                        26600024
           MOVE VL049-DOC-DD        TO PV-DTE-DD                        26610024
           STRING PV-TEMP-DOC-NBR  DELIMITED BY SPACE                   26620024
                  '_'              DELIMITED BY SPACE                   26630024
                  PV-DOC-DTE       DELIMITED BY SPACE                   26640024
             INTO PV-DOC-NBR                                            26650024
           MOVE PV-DOC-NBR          TO DL-DOC-NBR.                      26660024
      *CHG0211865                                                       26670024
244300     MOVE VL049-REVERSAL-SEQ  TO DL-RVSL-SEQ-NBR.                 26680024
244400     MOVE VL049-AP-TRN-CDE    TO DL-TRN-CDE.                      26690024
244500     MOVE VL049-CHRG-SIGN     TO DL-CHG-SIGN.                     26700024
244600     MOVE VL049-CHRG-AMT      TO DL-CHG-AMT.                      26710024
244700     MOVE VL049-LOCATION      TO DL-DC-NBR.                       26720024
244800     MOVE PV-ERROR-MSG        TO DL-ERROR-MSG.                    26730024
244900                                                                  26740024
P47422     SET PS-WRITE-WRAP-YES    TO TRUE                             26750024
P47422     IF PS-INPUT-I01-NO                                           26760024
P47422        ADD 1                 TO VL049-ERROR-WRAP-QTY             26770024
P47422        IF VL049-ERROR-WRAP-QTY = PV-MAX-WRAP-DAYS                26780024
P47422           MOVE VL049-ERROR-WRAP-QTY TO PV-PRC-CNT                26790024
P47422           MOVE PV-PRC-CNT-DROPPED   TO DL-PRC-CNT                26800024
P47422           SET PS-WRITE-WRAP-NO      TO TRUE                      26810024
P47422        ELSE                                                      26820024
P47422           MOVE VL049-ERROR-WRAP-QTY TO DL-PRC-CNT                26830024
P47422        END-IF                                                    26840024
P47422     ELSE                                                         26850024
P47422        INITIALIZE VL049-ERROR-WRAP-QTY                           26860024
P47422     END-IF.                                                      26870024
245000     WRITE AP-ERROR-RECORD FROM                                   26880024
245100           DL-DETAIL-LINE AFTER 1 LINES.                          26890024
245200                                                                  26900024
245300     ADD 1 TO PV-LINE-CNT.                                        26910024
P47422     IF PS-WRITE-WRAP-YES                                         26920024
P47422        WRITE CMS-EXTRACT-WRAP-ERROR-RECORD FROM                  26930024
P47422              VL049-AP-INTERFACE-RECORD                           26940024
P47422        ADD 1                        TO PA-TOT-WRAP-RECS-WRIT     26950024
P47422     END-IF.                                                      26960024
245400                                                                  26970024
245500******************************************************************26980024
245600* 8600-PRINT-TOTALS.                                              26990024
245700******************************************************************27000024
245800 8600-PRINT-TOTALS.                                               27010024
245900                                                                  27020024
246000     PERFORM 8400-PRINT-HEADINGS.                                 27030024
246100                                                                  27040024
246200     COMPUTE PA-ERR-TOTAL = PA-ERR-INV-TRN + PA-ERR-RCVR-PODC +   27050024
246300                            PA-ERR-RCVR-PO + PA-ERR-LOC-NBR +     27060024
246400                            PA-ERR-REV-SEQ + PA-ERR-VND-NBR +     27070024
246500                            PA-ERR-DOC-NBR + PA-ERR-DOC-DTE +     27080024
246600                            PA-ERR-REC-TYP + PA-ERR-DPT-NBR +     27090024
246700                            PA-ERR-ENT-ID  + PA-ERR-ENT-NME +     27100024
246800                            PA-ERR-CHG-AMT.                       27110024
246900                                                                  27120024
247000     IF PA-ERR-TOTAL = 0                                          27130024
247100         WRITE AP-ERROR-RECORD FROM NO-OUTPUT-LINE                27140024
247200              AFTER ADVANCING 2 LINES                             27150024
247300     ELSE                                                         27160024
247400         WRITE AP-ERROR-RECORD FROM TT-TOTAL-TITLE                27170024
247500              AFTER ADVANCING 2 LINES                             27180024
247600     END-IF.                                                      27190024
247700                                                                  27200024
247800     WRITE AP-ERROR-RECORD FROM BLANK-LINE                        27210024
247900              AFTER ADVANCING 1 LINES.                            27220024
248000                                                                  27230024
248100     IF PA-ERR-INV-TRN > 0                                        27240024
248200         MOVE PA-ERR-INV-TRN           TO TL-ERROR-CNT            27250024
248300         MOVE 'INVALID TRAN CODE'      TO TL-ERROR-MESSAGE        27260024
248400         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27270024
248500                  AFTER ADVANCING 1 LINE                          27280024
248600     END-IF.                                                      27290024
248700                                                                  27300024
248800     IF PA-ERR-RCVR-PODC > 0                                      27310024
248900         MOVE PA-ERR-RCVR-PODC         TO TL-ERROR-CNT            27320024
249000         MOVE 'NO RECEIVER FOUND FOR PO/DC'                       27330024
249100                                       TO TL-ERROR-MESSAGE        27340024
249200         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27350024
249300                  AFTER ADVANCING 1 LINE                          27360024
249400     END-IF.                                                      27370024
249500                                                                  27380024
249600     IF PA-ERR-RCVR-PO > 0                                        27390024
249700         MOVE PA-ERR-RCVR-PO           TO TL-ERROR-CNT            27400024
249800         MOVE 'NO RECEIVER FOUND FOR PO'                          27410024
249900                                       TO TL-ERROR-MESSAGE        27420024
250000         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27430024
250100                  AFTER ADVANCING 1 LINE                          27440024
250200     END-IF.                                                      27450024
250300                                                                  27460024
250400     IF PA-ERR-LOC-NBR > 0                                        27470024
250500         MOVE PA-ERR-LOC-NBR           TO TL-ERROR-CNT            27480024
250600         MOVE 'INVALID LOCATION         '                         27490024
250700                                       TO TL-ERROR-MESSAGE        27500024
250800         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27510024
250900                  AFTER ADVANCING 1 LINE                          27520024
251000     END-IF.                                                      27530024
251100                                                                  27540024
251200     IF PA-ERR-REV-SEQ > 0                                        27550024
251300         MOVE PA-ERR-REV-SEQ           TO TL-ERROR-CNT            27560024
251400         MOVE 'INVALID REVERSAL SEQUENCE   '                      27570024
251500                                       TO TL-ERROR-MESSAGE        27580024
251600         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27590024
251700                  AFTER ADVANCING 1 LINE                          27600024
251800     END-IF.                                                      27610024
251900                                                                  27620024
252000     IF PA-ERR-VND-NBR > 0                                        27630024
252100         MOVE PA-ERR-VND-NBR           TO TL-ERROR-CNT            27640024
252200         MOVE 'INVALID VENDOR NUMBER       '                      27650024
252300                                       TO TL-ERROR-MESSAGE        27660024
252400         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27670024
252500                  AFTER ADVANCING 1 LINE                          27680024
252600     END-IF.                                                      27690024
252700                                                                  27700024
252800     IF PA-ERR-DOC-NBR > 0                                        27710024
252900         MOVE PA-ERR-DOC-NBR           TO TL-ERROR-CNT            27720024
253000         MOVE 'INVALID DOCUMENT NUMBER     '                      27730024
253100                                       TO TL-ERROR-MESSAGE        27740024
253200         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27750024
253300                  AFTER ADVANCING 1 LINE                          27760024
253400     END-IF.                                                      27770024
253500                                                                  27780024
253600     IF PA-ERR-DOC-DTE > 0                                        27790024
253700         MOVE PA-ERR-DOC-DTE           TO TL-ERROR-CNT            27800024
253800         MOVE 'INVALID DOCUMENT DATE       '                      27810024
253900                                       TO TL-ERROR-MESSAGE        27820024
254000         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27830024
254100                  AFTER ADVANCING 1 LINE                          27840024
254200     END-IF.                                                      27850024
254300                                                                  27860024
254400     IF PA-ERR-REC-TYP > 0                                        27870024
254500         MOVE PA-ERR-REC-TYP           TO TL-ERROR-CNT            27880024
254600         MOVE 'INVALID RECORD TYPE         '                      27890024
254700                                       TO TL-ERROR-MESSAGE        27900024
254800         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27910024
254900                  AFTER ADVANCING 1 LINE                          27920024
255000     END-IF.                                                      27930024
255100                                                                  27940024
255200     IF PA-ERR-DPT-NBR > 0                                        27950024
255300         MOVE PA-ERR-DPT-NBR           TO TL-ERROR-CNT            27960024
255400         MOVE 'INVALID DEPARTMENT NUMBER   '                      27970024
255500                                       TO TL-ERROR-MESSAGE        27980024
255600         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 27990024
255700                  AFTER ADVANCING 1 LINE                          28000024
255800     END-IF.                                                      28010024
255900                                                                  28020024
256000     IF PA-ERR-ENT-ID > 0                                         28030024
256100         MOVE PA-ERR-ENT-ID            TO TL-ERROR-CNT            28040024
256200         MOVE 'INVALID ENTITY ID           '                      28050024
256300                                       TO TL-ERROR-MESSAGE        28060024
256400         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 28070024
256500                  AFTER ADVANCING 1 LINE                          28080024
256600     END-IF.                                                      28090024
256700                                                                  28100024
256800     IF PA-ERR-ENT-NME > 0                                        28110024
256900         MOVE PA-ERR-ENT-NME           TO TL-ERROR-CNT            28120024
257000         MOVE 'INVALID VENDOR NAME         '                      28130024
257100                                       TO TL-ERROR-MESSAGE        28140024
257200         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 28150024
257300                  AFTER ADVANCING 1 LINE                          28160024
257400     END-IF.                                                      28170024
257500                                                                  28180024
257600     IF PA-ERR-CHG-AMT > 0                                        28190024
257700         MOVE PA-ERR-CHG-AMT           TO TL-ERROR-CNT            28200024
257800         MOVE 'INVALID CHARGE AMOUNT       '                      28210024
257900                                       TO TL-ERROR-MESSAGE        28220024
258000         WRITE AP-ERROR-RECORD FROM TL-TOTAL-LINE                 28230024
258100                  AFTER ADVANCING 1 LINE                          28240024
258200     END-IF.                                                      28250024
258300                                                                  28260024
258400     WRITE AP-ERROR-RECORD FROM END-OF-REPORT-LINE                28270024
258500                  AFTER ADVANCING 2 LINES.                        28280024
258600                                                                  28290024
258700                                                                  28300024
P47422******************************************************************28310024
P47422* READ THE REPROCESS RECORD                                       28320024
P47422******************************************************************28330024
P47422 8700-READ-INPUT-I02.                                             28340024
P47422     READ CMS-WRAP-RECORD-FILE                                    28350024
P47422     AT END                                                       28360024
P47422         SET PS-END-OF-WRAP-RECS      TO TRUE                     28370024
P47422     NOT AT END                                                   28380024
P47422         ADD 1                        TO PV-WRAP-READ-COUNT       28390024
P47422     END-READ.                                                    28400024
P47422                                                                  28410024
P47422***************************************************************** 28420024
P47422* TO GET THE MAXIMUM RECYCLE DAYS FOR THE WRAP RECORDS            28430024
P47422******************************************************************28440024
P47422 8800-GET-WRAP-ERROR-DAYS.                                        28450024
P47422                                                                  28460024
P47422     EXEC SQL                                                     28470024
P47422         SELECT  FUNC_QTY                                         28480024
P47422           INTO  :KRPRPM-FUNC-QTY                                 28490024
P47422           FROM  TKRPRPM                                          28500024
P47422          WHERE LOC_ID = 90                                       28510024
P47422            AND INTFC_SYS_CDE = 'KHL'                             28520024
P47422            AND SYS_PRC_FUNC_CDE = 'VLCNFC'                       28530024
P47422          WITH UR                                                 28540024
P47422     END-EXEC.                                                    28550024
P47422     EVALUATE TRUE                                                28560024
P47422       WHEN SQLCODE = +0                                          28570024
P47422           MOVE KRPRPM-FUNC-QTY TO PV-MAX-WRAP-DAYS               28580024
P47422       WHEN OTHER                                                 28590024
P47422           MOVE '8800-GET-WRAP-ERROR-DAYS' TO PV-PARAGRAPH        28600024
P47422           MOVE 'TKRPRPM' TO PV-DB2-TABLE-1                       28610024
P47422           PERFORM 9200-SQL-ERROR                                 28620024
P47422     END-EVALUATE.                                                28630024
P47422                                                                  28640024
258800******************************************************************28650024
258900* END OF JOB PROCESS                                              28660024
259000******************************************************************28670024
259100 9000-EOJ.                                                        28680024
259200     IF PS-DTLS-AND-CNTL                                          28690024
259300         WRITE AP-COMPLETE-RECORD                                 28700024
259400             FROM PV-COMPLETE-LINE                                28710024
259500         CLOSE CMS-EXT-FILE                                       28720024
259600               AP-TRANSACTION-FILE                                28730024
259700               AP-COMPLETE-FILE                                   28740024
259800         PERFORM 8600-PRINT-TOTALS                                28750024
259900         CLOSE AP-ERROR-FILE                                      28760024
260000     ELSE                                                         28770024
260100*        OPEN OUTPUT AP-COMPLETE-FILE                             28780024
260200         WRITE AP-COMPLETE-RECORD                                 28790024
260300             FROM PV-COMPLETE-LINE                                28800024
260400         CLOSE AP-COMPLETE-FILE                                   28810024
260500     END-IF.                                                      28820024
P47422     CLOSE CMS-WRAP-RECORD-FILE                                   28830024
P47422           CMS-WRAP-ERROR-FILE.                                   28840024
260600                                                                  28850024
260700     DISPLAY '*********************************************'      28860024
260800     DISPLAY '***     VLKUT047 SUMMARY STATISTICS       ***'      28870024
260900     DISPLAY '*********************************************'      28880024
261000     MOVE PV-CMS-CTL-REC-CNT         TO PV-DISP-NUMBER.           28890024
261100     DISPLAY '** CMS REC CNT............:' PV-DISP-NUMBER.        28900024
261200     MOVE PV-READ-COUNT              TO PV-DISP-NUMBER.           28910024
261300     DISPLAY '** RECS READ..............:' PV-DISP-NUMBER.        28920024
P47422     MOVE PV-WRAP-READ-COUNT         TO PV-DISP-NUMBER.           28930024
P47422     DISPLAY '** WRAPRECS READ..........:' PV-DISP-NUMBER.        28940024
261400     MOVE PA-TOT-RECS-WRIT           TO PV-DISP-NUMBER.           28950024
261500     DISPLAY '** OUTRECS WRITTEN........:' PV-DISP-NUMBER.        28960024
P47422     MOVE PA-TOT-WRAP-RECS-WRIT      TO PV-DISP-NUMBER.           28970024
P47422     DISPLAY '** WRAPRECS WRITTEN.......:' PV-DISP-NUMBER.        28980024
261600*-------------------------------------------------------------    28990024
261700     DISPLAY ' '                                                  29000024
261800     MOVE PV-CMS-CTL-CHARGE-AMT          TO PV-DISP-DOLLAR.       29010024
261900     DISPLAY '** CMS CHARGE AMT.........:'  PV-DISP-DOLLAR.       29020024
262000*-------------------------------------------------------------    29030024
262100     COMPUTE PV-ADJ-GRAND-CHARGE =                                29040024
262200             PV-ADJ-GRAND-CHARGE * -1                             29050024
262300     MOVE PV-ADJ-GRAND-CHARGE            TO PV-DISP-DOLLAR        29060024
262400     DISPLAY '** GRAND TOT ADJ CHARGES..:'  PV-DISP-DOLLAR.       29070024
262500*-------------------------------------------------------------    29080024
262600     MOVE PA-TOTAL-CHARGES               TO PV-SIGNED-FIELD.      29090024
262700     COMPUTE PV-SIGNED-FIELD =                                    29100024
262800             PV-SIGNED-FIELD * -1                                 29110024
262900     MOVE PV-SIGNED-FIELD                TO PV-DISP-DOLLAR.       29120024
263000     DISPLAY '** KOHLS CHARGE AMT.......:'  PV-DISP-DOLLAR.       29130024
263100*-------------------------------------------------------------    29140024
263200*    COMPUTE PA-TOTAL-CHARGES =                                   29150024
263300*            PA-TOTAL-CHARGES * -1                                29160024
263400*    MOVE PA-TOTAL-CHARGES               TO PV-DISP-DOLLAR        29170024
263500*    DISPLAY '** GRAND TOT KOHLS CHARGES:'  PV-DISP-DOLLAR.       29180024
263600*-------------------------------------------------------------    29190024
263700     DISPLAY ' '                                                  29200024
263800*-------------------------------------------------------------    29210024
263900     MOVE PV-CMS-CTL-CREDIT-AMT          TO PV-DISP-DOLLAR.       29220024
264000     DISPLAY '** CMS CREDIT AMT.........:' PV-DISP-DOLLAR.        29230024
264100*-------------------------------------------------------------    29240024
264200     MOVE PV-ADJ-GRAND-CREDIT           TO PV-DISP-DOLLAR         29250024
264300     DISPLAY '** GRAND TOT ADJ CREDITS..:' PV-DISP-DOLLAR.        29260024
264400*-------------------------------------------------------------    29270024
264500     MOVE PA-TOTAL-CREDITS               TO PV-DISP-DOLLAR.       29280024
264600     DISPLAY '** KOHLS CREDIT AMT.......:'  PV-DISP-DOLLAR.       29290024
264700*-------------------------------------------------------------    29300024
264800*    MOVE PA-TOTAL-CREDITS               TO PV-DISP-DOLLAR        29310024
264900*    DISPLAY '** GRAND TOT KOHLS CREDITS:'  PV-DISP-DOLLAR.       29320024
265000*-------------------------------------------------------------    29330024
265100                                                                  29340024
265200******************************************************************29350024
265300* 9100-ABEND-BAD-AMTS - THIS PARAGRAPH WILL BE PERFORMED IN THE   29360024
265400* EVENT THAT THE TOTALS ON THE CONTROL RECORD FROM CMS DO NOT     29370024
265500* MATCH THE TOTALS CALCULATED WITHIN THIS PROGRAM. IF THERE IS NO 29380024
265600* MATCH, THE DISCREPANCY MUST BE RESOLVED BEFORE SENDING TO AP    29390024
265700******************************************************************29400024
265800 9100-ABEND-BAD-AMTS.                                             29410024
265900     CLOSE CMS-EXT-FILE.                                          29420024
266000     MOVE +4014 TO ABEND-CODE.                                    29430024
266100     CALL 'ILBOABN0' USING ABEND-CODE.                            29440024
266200                                                                  29450024
266300******************************************************************29460024
266400* 9200-SQL-ERROR - THIS PARAGRAPH WILL BE PERFORMED WHEN THERE IS 29470024
266500*     AND SQL ERROR.                                              29480024
266600******************************************************************29490024
266700 9200-SQL-ERROR.                                                  29500024
266800     CLOSE CMS-EXT-FILE                                           29510024
266900           AP-TRANSACTION-FILE                                    29520024
P47422           CMS-WRAP-RECORD-FILE                                   29530024
P47422           CMS-WRAP-ERROR-FILE.                                   29540024
267000                                                                  29550024
267100     MOVE SQLCODE                     TO SQLCODE2.                29560024
267200     MOVE SQLERRD(3)                  TO SQLERRD3.                29570024
267300                                                                  29580024
267400     DISPLAY '** ABEND **         ** = SQLERROR'.                 29590024
267500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PGM-VLKUT047.        29600024
267600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   29610024
267700     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                29620024
267800     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-1.                 29630024
267900     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-2.                 29640024
268000     DISPLAY '**           ** = ' PV-DB2-TEXT.                    29650024
268100                                                                  29660024
268200     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                29670024
268300     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                29680024
268400     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 29690024
268500     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                29700024
268600                                                                  29710024
268700     COPY DPPD004.                                                29720024
268800                                                                  29730024
268900     MOVE +4013                       TO ABEND-CODE.              29740024
269000     CALL 'ILBOABN0' USING ABEND-CODE.                            29750024
269100                                                                  29760024
269200*---------------------------------------------------------------  29770024
269300*     ABEND ROUTINE USED WHEN PROBLEM WITH PRORATION ROUTINE      29780024
269400*---------------------------------------------------------------  29790024
269500 Z999-ABEND.                                                      29800024
269600                                                                  29810024
269700     DISPLAY AA-ABEND-LIT.                                        29820024
269800     DISPLAY AA-PROGRAM-LIT.                                      29830024
269900     DISPLAY AA-PARAGRAPH-LIT.                                    29840024
270000     DISPLAY AA-MESSAGE-LINE.                                     29850024
270100                                                                  29860024
270200     CALL 'ILBOABN0' USING ABEND-CODE.                            29870024
270300                                                                  29880024
270400                                                                  29890024
270500******************  END OF VLKUT047  *****************************29900024
