000100******************************************************************00010005
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030005
000400 PROGRAM-ID.      DPKUT034.                                       00040005
000500 AUTHOR.          COLLEEN KOBE (STRATAGEM).                       00050005
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060005
000700 DATE-WRITTEN.    APRIL 10, 1989.                                 00070005
000800 DATE-COMPILED.                                                   00080005
000900                                                                  00090005
001000******************************************************************00100005
001100*                                                                 00110005
001200* CHANGE: 10/09/91 - ADDED CHECK FOR IKJEFT1B - B.JOHNSON         00120005
001300*                                                                 00130005
001400* CHANGE: 03/09/92 - INCREASED THE CONTROL TABLE SIZE TO 1000.    00140005
001500*                    A.REILAND                                    00150005
001600******************************************************************00160005
001700                                                                  00170005
001800 ENVIRONMENT DIVISION.                                            00180005
001900 CONFIGURATION SECTION.                                           00190005
002000 SOURCE-COMPUTER. IBM-3090.                                       00200005
002100 OBJECT-COMPUTER. IBM-3090.                                       00210005
002200                                                                  00220005
002300 INPUT-OUTPUT SECTION.                                            00230005
002400 FILE-CONTROL.                                                    00240005
002500     SELECT CONTROL-FILE               ASSIGN TO INP01.           00250005
002600     SELECT PROC-XREF-FILE             ASSIGN TO INP02.           00260005
002700     SELECT FILE-TABLE-FILE            ASSIGN TO OUT01.           00270005
002800     SELECT ASSOCIATOR-TABLE-FILE      ASSIGN TO OUT02.           00280005
002900                                                                  00290005
003000     EJECT                                                        00300005
003100                                                                  00310005
003200******************************************************************00320005
003300 DATA DIVISION.                                                   00330005
003400******************************************************************00340005
003500 FILE SECTION.                                                    00350005
003600 FD  CONTROL-FILE                                                 00360005
003700     BLOCK CONTAINS 0 RECORDS                                     00370005
003800     RECORD CONTAINS 28 CHARACTERS                                00380005
003900     LABEL RECORDS ARE STANDARD                                   00390005
004000     RECORDING MODE F                                             00400005
004100     DATA RECORD IS CONTROL-RECORD.                               00410005
004200                                                                  00420005
004300 01  CONTROL-RECORD          PIC X(28).                           00430005
004400                                                                  00440005
004500 FD  PROC-XREF-FILE                                               00450005
004600     BLOCK CONTAINS 0 RECORDS                                     00460005
004700     RECORD CONTAINS 143 CHARACTERS                               00470005
004800     LABEL RECORDS ARE STANDARD                                   00480005
004900     RECORDING MODE F                                             00490005
005000     DATA RECORD IS PROC-XREF-RECORD.                             00500005
005100                                                                  00510005
005200 01  PROC-XREF-RECORD        PIC X(143).                          00520005
005300                                                                  00530005
005400 FD  FILE-TABLE-FILE                                              00540005
005500     BLOCK CONTAINS 0 RECORDS                                     00550005
005600     RECORD CONTAINS 83 CHARACTERS                                00560005
005700     LABEL RECORDS ARE STANDARD                                   00570005
005800     RECORDING MODE F                                             00580005
005900     DATA RECORD IS FILE-TABLE-RECORD.                            00590005
006000                                                                  00600005
006100 01  FILE-TABLE-RECORD       PIC X(83).                           00610005
006200                                                                  00620005
006300 FD  ASSOCIATOR-TABLE-FILE                                        00630005
006400     BLOCK CONTAINS 0 RECORDS                                     00640005
006500     RECORD CONTAINS 60 CHARACTERS                                00650005
006600     LABEL RECORDS ARE STANDARD                                   00660005
006700     RECORDING MODE F                                             00670005
006800     DATA RECORD IS ASSOCIATOR-TABLE-RECORD.                      00680005
006900                                                                  00690005
007000 01  ASSOCIATOR-TABLE-RECORD PIC X(60).                           00700005
007100                                                                  00710005
007200     EJECT                                                        00720005
007300                                                                  00730005
007400******************************************************************00740005
007500 WORKING-STORAGE SECTION.                                         00750005
007600******************************************************************00760005
007700                                                                  00770005
007800**   PROC-XREF-RECORD LAYOUT (INPUT)      **                      00780005
007900                                                                  00790005
008000     COPY DPRD005I.                                               00800005
008300                                                                  00830005
008400**   ASSOCIATOR-TABLE-FILE LAYOUT (OUTPUT)  **                    00840005
008500                                                                  00850005
008600     COPY DPRD006O.                                               00860005
008900                                                                  00890005
009000**   FILE-TABLE-FILE LAYOUT (OUTPUT)  **                          00900005
009100                                                                  00910005
009200     COPY DPRD007O.                                               00920005
009500                                                                  00950005
009600**   CONTROL-FILE LAYOUT (INPUT)          **                      00960005
009700                                                                  00970005
009800     COPY DPRD004I.                                               00980005
010100                                                                  01010005
010200                                                                  01020005
010300******************************************************************01030005
010400******************************************************************01040005
010500 01  PROGRAM-CONSTANTS.                                           01050005
010600     05  PC-FILE-NAME-CHAR-MAX    PIC 99        VALUE 44.         01060005
010700     05  PC-CONTROL-TABLE-MAX     PIC 9(4)      VALUE 5000.       01070007
010800                                                                  01080005
010900 01  PROGRAM-SWITCHES.                                            01090005
011000     05  PS-WRITE                 PIC X         VALUE 'N'.        01100005
011100         88  OKAY-TO-WRITE                      VALUE 'Y'.        01110005
011200         88  NOT-OKAY-TO-WRITE                  VALUE 'N'.        01120005
011300     05  PS-EOF-CONTROL-FILE-SW   PIC X         VALUE 'N'.        01130005
011400         88  EOF-CONTROL-FILE                   VALUE 'Y'.        01140005
011500     05  PS-EOF-XREF-FILE-SW      PIC X         VALUE 'N'.        01150005
011600         88  EOF-XREF-FILE                      VALUE 'Y'.        01160005
011700     05  PS-VALID-FILE-NAME-SW    PIC X         VALUE 'N'.        01170005
011800         88  VALID-FILE-NAME                    VALUE 'Y'.        01180005
011900         88  INVALID-FILE-NAME                  VALUE 'N'.        01190005
012000     05  PS-END-OF-TABLE-NAMES-SW PIC X         VALUE 'N'.        01200005
012100         88  END-OF-TABLE-NAMES                 VALUE 'Y'.        01210005
012200         88  MORE-TABLE-NAMES                   VALUE 'N'.        01220005
012210 01  PROGRAM-VARIABLES.                                           01221009
012220     05  PV-PROGRAM-NAME          PIC X(8)      VALUE SPACES.     01222009
012300                                                                  01230005
012400     EJECT                                                        01240005
012500                                                                  01250005
012600 01  ABEND-CODE                  PIC 9999     COMP   VALUE ZEROS. 01260005
012700                                                                  01270005
012800 01  WORK-AREA.                                                   01280005
012900     05  WS-FILE-NAME-TABLE      PIC X(44)      VALUE SPACES.     01290005
013000     05  WS-FILE-NAME-TBL  REDEFINES  WS-FILE-NAME-TABLE.         01300005
013100         10  WS-FILE-NAME-CHAR  OCCURS 44 TIMES INDEXED BY IX-FNT 01310005
013200                                 PIC X.                           01320005
013300     05  WS-FILE-NAME-BREAKDOWN.                                  01330005
013400         10  WS-FILE-NAME        PIC X(12).                       01340005
013500         10  FILLER              PIC X(01).                       01350005
013600         10  WS-CONTROL-NAME.                                     01360005
013700             15  WS-CONTROL-NAME-1-4                              01370005
013800                                 PIC X(04).                       01380005
013900             15  FILLER          PIC X(03).                       01390005
014000             15  WS-CONTROL-NAME-8                                01400005
014100                                 PIC X(01).                       01410005
014200         10  FILLER              PIC X(23).                       01420005
014300                                                                  01430005
014400     05  WS-VARIABLES.                                            01440005
014500         10  WS-AMPERSAND        PIC X          VALUE '&'.        01450005
014600         10  WS-COMMA            PIC X          VALUE ','.        01460005
014700         10  WS-TEMPORARY        PIC X(11)      VALUE             01470005
014800                                                '<TEMPORARY>'.    01480005
014900         10  WS-ASTERISK         PIC X          VALUE '*'.        01490005
015000                                                                  01500005
015100     EJECT                                                        01510005
015200                                                                  01520005
015300******************************************************************01530005
015400******************************************************************01540005
015500 01  TABLE-CONTROL-DATA.                                          01550005
015600     05  TABLE-CONTROL-ENTRY     OCCURS 5000 TIMES                01560007
015700                                 INDEXED BY TBL-INDX.             01570005
015800         10  TABLE-CONTROL-NAME  PIC X(8).                        01580005
015900         10  TABLE-PROGRAM-NAME  PIC X(8).                        01590005
016000         10  TABLE-TYPE          PIC X(4).                        01600005
016100         10  TABLE-PLAN-NAME     PIC X(8).                        01610005
016200                                                                  01620005
016300     EJECT                                                        01630005
016400******************************************************************01640005
016500*    DB2 COMMUNICATION AREAS                                     *01650005
016600******************************************************************01660005
016700                                                                  01670005
016800*  SYSTABLE AND SYSTABAUTH LAYOUTS                                01680005
016900                                                                  01690005
017000     EXEC SQL                                                     01700005
017100         INCLUDE SYSTABAU                                         01710005
017200     END-EXEC.                                                    01720005
017300                                                                  01730005
017400     EJECT                                                        01740005
017500                                                                  01750005
017600*  DB2 COMMUNICATION AREA                                         01760005
017700                                                                  01770005
017800     EXEC SQL                                                     01780005
017900         INCLUDE SQLCA                                            01790005
018000     END-EXEC.                                                    01800005
018100                                                                  01810005
018200     EJECT                                                        01820005
018300                                                                  01830005
018400*  DB2 COMMUNICATION AREA2                                        01840005
018500                                                                  01850005
018600                                                                  01860005
018700     COPY SQLCA2.                                                 01870005
018800                                                                  01880005
018900     EJECT                                                        01890005
019000                                                                  01900005
019100*  TABLE NAME GROUP DECLARE                                       01910005
019110*                                                                 01911009
019120*  THE GRANTEE HAS BEEN CHANGED FROM PLAN NAME TO PROGRAM NAME.   01912012
019130*  BECAUSE OF THE CHANGE TO PACKAGE BINDS, THE GRANTEE IS NOW     01913012
019140*  THE PACKAGE (WHICH IS EQUAL TO THE PROGRAM NAME).              01914012
019200                                                                  01920005
019300     EXEC SQL                                                     01930005
019400        DECLARE TABLEGP CURSOR FOR                                01940005
019500         SELECT DISTINCT TTNAME                                   01950005
019600         FROM SYSIBM.SYSTABAUTH                                   01960005
019700         WHERE GRANTEE = :PV-PROGRAM-NAME                         01970009
019800         ORDER BY TTNAME                                          01980005
019900     END-EXEC.                                                    01990005
020000                                                                  02000005
020100     EJECT                                                        02010005
020200                                                                  02020005
020300******************************************************************02030005
020400 PROCEDURE DIVISION.                                              02040005
020500******************************************************************02050005
020600                                                                  02060005
020700     MOVE SPACES TO TABLE-CONTROL-DATA.                           02070005
020800                                                                  02080005
020900     OPEN INPUT     PROC-XREF-FILE                                02090005
021000                    CONTROL-FILE                                  02100005
021100          OUTPUT    FILE-TABLE-FILE                               02110005
021200                    ASSOCIATOR-TABLE-FILE.                        02120005
021300                                                                  02130005
021400     SET TBL-INDX TO 1.                                           02140005
021500     PERFORM A100-READ-CONTROL-FILE                               02150005
021600             UNTIL EOF-CONTROL-FILE.                              02160005
021700                                                                  02170005
021800     PERFORM A200-READ-PROC-XREF-FILE                             02180005
021900             UNTIL VALID-FILE-NAME                                02190005
022000             OR    EOF-XREF-FILE.                                 02200005
022100                                                                  02210005
022200     IF VALID-FILE-NAME                                           02220005
022300         PERFORM A300-PROCESS-PROC-XREF-FILE                      02230005
022400                 UNTIL EOF-XREF-FILE                              02240005
022500     END-IF.                                                      02250005
022600                                                                  02260005
022700     CLOSE          PROC-XREF-FILE                                02270005
022800                    CONTROL-FILE                                  02280005
022900                    FILE-TABLE-FILE                               02290005
023000                    ASSOCIATOR-TABLE-FILE.                        02300005
023100                                                                  02310005
023200     STOP RUN.                                                    02320005
023300                                                                  02330005
023400     EJECT                                                        02340005
023500                                                                  02350005
023600***************************************************************** 02360005
023700* A100 READS THE CONTROL FILE WHICH CONTAINS THE PKMO.CONTROL   * 02370005
023800*      MEMBER NAME, THE PROGRAM NAME AND PROGRAM TYPE FOR ALL   * 02380005
023900*      DB2 AND IMS/DB2 PROCS.                                   * 02390005
024000***************************************************************** 02400005
024100 A100-READ-CONTROL-FILE.                                          02410005
024200                                                                  02420005
024300     READ CONTROL-FILE INTO DP004I-RECORD                         02430005
024400         AT END                                                   02440005
024500             SET EOF-CONTROL-FILE TO TRUE.                        02450005
024600                                                                  02460005
024700     IF NOT EOF-CONTROL-FILE                                      02470005
024800         EVALUATE TRUE                                            02480005
024900             WHEN DP004I-TYPE = 'DB2 '                            02490008
025000             MOVE DP004I-RECORD TO TABLE-CONTROL-ENTRY (TBL-INDX) 02500005
025100         SET TBL-INDX UP BY 1                                     02510005
025200         IF  TBL-INDX > PC-CONTROL-TABLE-MAX                      02520005
025300             DISPLAY '************************************'       02530005
025400             DISPLAY '**     ** ABEND ** - DPKUT034     **'       02540005
025500             DISPLAY '** CONTROL TABLE SIZE ERROR       **'       02550005
025600             DISPLAY '** INCREASE SIZE OF CONTROL TABLE **'       02560005
025700             DISPLAY '************************************'       02570005
025800             MOVE 4004 TO ABEND-CODE                              02580005
025900             CALL 'ILBOABN0' USING ABEND-CODE                     02590005
026000         END-IF                                                   02600005
026100                                                                  02610005
026200         END-EVALUATE                                             02620005
026300     END-IF.                                                      02630005
026400                                                                  02640005
026500 A100-END.                                                        02650005
026600     EXIT.                                                        02660005
026700                                                                  02670005
026800******************************************************************02680005
026900* A200 THIS PARAGRAPH READS THE INPUT FILE FROM "PROCXREF".  IT  *02690005
027000*      ALSO CHECKS FOR A VALID FILE NAME, AS "PROCXREF" CAN      *02700005
027100*      PASS AN INVALID FILE NAME.  IT ALSO REMOVES THE QUOTES    *02710005
027200*      AROUND THE DATASET NAME IF THEY ARE FOUND.                *02720005
027300******************************************************************02730005
027400 A200-READ-PROC-XREF-FILE.                                        02740005
027500                                                                  02750005
027600     READ PROC-XREF-FILE INTO DP005I-RECORD                       02760005
027700         AT END                                                   02770005
027800             SET EOF-XREF-FILE TO TRUE.                           02780005
027900                                                                  02790005
028000     IF NOT EOF-XREF-FILE                                         02800005
028100         SET VALID-FILE-NAME TO TRUE                              02810005
028200         IF DP005I-FILE-NAME    = (WS-TEMPORARY OR                02820005
028300                                   WS-ASTERISK)                   02830005
028400             SET INVALID-FILE-NAME TO TRUE                        02840005
028500         ELSE                                                     02850005
028600             MOVE DP005I-FILE-NAME                                02860005
028700                                  TO  WS-FILE-NAME-TABLE          02870005
028800             IF ( WS-FILE-NAME-CHAR (1)  =  WS-AMPERSAND )  OR    02880005
028900                ( WS-FILE-NAME-CHAR (2)  =  WS-COMMA )      OR    02890005
029000                ( WS-FILE-NAME-CHAR (2)  =  SPACE )         OR    02900005
029100                ( WS-FILE-NAME-CHAR (3)  =  WS-COMMA )            02910005
029200                 SET INVALID-FILE-NAME TO TRUE                    02920005
029300             ELSE                                                 02930005
029400                 IF WS-FILE-NAME-CHAR (1)  =  QUOTE               02940005
029500                     PERFORM B100-REMOVE-DSNAME-QUOTES            02950005
029600                         VARYING IX-FNT FROM 1 BY 1               02960005
029700                         UNTIL IX-FNT > PC-FILE-NAME-CHAR-MAX     02970005
029800                     MOVE WS-FILE-NAME-TABLE                      02980005
029900                                  TO DP005I-FILE-NAME             02990005
030000                 END-IF                                           03000005
030100             END-IF                                               03010005
030200         END-IF                                                   03020005
030300     END-IF.                                                      03030005
030400                                                                  03040005
030500 A200-END.                                                        03050005
030600     EXIT.                                                        03060005
030700                                                                  03070005
030800     EJECT                                                        03080005
030900                                                                  03090005
031000******************************************************************03100005
031100* A300 THIS PARAGRAPH PROCESSES ANY DB2 OR IMS/DB2 PROCS AND     *03110005
031200*      PERFORMS SECTIONS TO CREATE A FILE CROSS REFERENCE RECORD *03120005
031300*      (CONTAINING THE DB2 TABLES) AND AN ASSOCIATED CROSS       *03130005
031400*      REFERENCE RECORD.                                         *03140005
031500******************************************************************03150005
031600 A300-PROCESS-PROC-XREF-FILE.                                     03160005
031700                                                                  03170005
031800     IF DP005I-PROGRAM-NAME    = ('IKJEFT1A' OR                   03180005
031900                                  'IKJEFT1B' OR                   03190005
032000                                  'IKJEFT01')                     03200007
032200         MOVE DP005I-FILE-NAME TO WS-FILE-NAME-BREAKDOWN          03220005
032300         IF WS-FILE-NAME = 'PKMO.CONTROL'                         03230005
032400             IF WS-CONTROL-NAME-1-4  EQUAL TO  'VSAM'             03240005
032500                 CONTINUE                                         03250005
032600             ELSE                                                 03260005
032700                 PERFORM B200-SEARCH-TABLE                        03270005
032800                 IF OKAY-TO-WRITE                                 03280005
032900                     MOVE DP005I-PROGRAM-NAME TO                  03290005
033000                          PV-PROGRAM-NAME                         03300009
033100                     PERFORM B300-CREATE-OUTPUT-RECORDS           03310005
033200                 END-IF                                           03320005
033300             END-IF                                               03330005
033400         ELSE                                                     03340005
033500             CONTINUE                                             03350005
033600         END-IF                                                   03360005
033700     END-IF.                                                      03370005
033800                                                                  03380005
033900     SET INVALID-FILE-NAME TO TRUE.                               03390005
034000                                                                  03400005
034100     PERFORM A200-READ-PROC-XREF-FILE                             03410005
034200         UNTIL (VALID-FILE-NAME                                   03420005
034300         OR     EOF-XREF-FILE).                                   03430005
034400                                                                  03440005
034500 A300-END.                                                        03450005
034600     EXIT.                                                        03460005
034700                                                                  03470005
034800     EJECT                                                        03480005
034900                                                                  03490005
035000******************************************************************03500005
035100* B100 THIS PARAGRAPH REMOVES THE QUOTES AROUND THE DATASET NAME *03510005
035200*      IF THEY ARE FOUND.                                        *03520005
035300******************************************************************03530005
035400 B100-REMOVE-DSNAME-QUOTES.                                       03540005
035500                                                                  03550005
035600     IF ( IX-FNT  >  1 )  AND                                     03560005
035700        ( WS-FILE-NAME-CHAR (IX-FNT + 1)  =  QUOTE )              03570005
035800         MOVE SPACE               TO WS-FILE-NAME-CHAR (IX-FNT)   03580005
035900                                  WS-FILE-NAME-CHAR (IX-FNT + 1)  03590005
036000         SET IX-FNT               TO 44                           03600005
036100     ELSE                                                         03610005
036200         MOVE WS-FILE-NAME-CHAR (IX-FNT + 1)                      03620005
036300                                  TO WS-FILE-NAME-CHAR (IX-FNT)   03630005
036400     END-IF.                                                      03640005
036500                                                                  03650005
036600 B100-END.                                                        03660005
036700     EXIT.                                                        03670005
036800                                                                  03680005
036900     EJECT                                                        03690005
037000                                                                  03700005
037100******************************************************************03710005
037200* B200 FOR DB2 PROCS WE SEARCH THE TABLE TO OBTAIN THE PLAN      *03720005
037300*      NAME BY LOOKING UP THE CONTROL MEMBER.                    *03730005
037400******************************************************************03740005
037500 B200-SEARCH-TABLE.                                               03750005
037600                                                                  03760005
037700      IF WS-CONTROL-NAME-8  EQUAL TO ')'                          03770005
037800          MOVE SPACE TO WS-CONTROL-NAME-8                         03780005
037900      END-IF.                                                     03790005
038000                                                                  03800005
038100      SET TBL-INDX TO 1.                                          03810005
038200      SEARCH TABLE-CONTROL-ENTRY  VARYING TBL-INDX                03820005
038300         AT END                                                   03830005
038400             SET NOT-OKAY-TO-WRITE TO TRUE                        03840005
038500         WHEN                                                     03850005
038600             TABLE-CONTROL-NAME (TBL-INDX)  =  WS-CONTROL-NAME    03860005
038700                 MOVE TABLE-PROGRAM-NAME (TBL-INDX)               03870010
038800                          TO DP005I-PROGRAM-NAME                  03880005
038900                 SET OKAY-TO-WRITE TO TRUE                        03890005
039000      END-SEARCH.                                                 03900005
039100                                                                  03910005
039200 B200-END.                                                        03920005
039300     EXIT.                                                        03930005
039400                                                                  03940005
039500     EJECT                                                        03950005
039600                                                                  03960005
039700******************************************************************03970005
039800* B300 INITIALIZE BOTH OUTPUT RECORDS. THEN DO DB2 CALLS TO      *03980005
039900*      FIND ALL TABLES ASSOCIATED WITH THE PLAN AND WRITE ONE    *03990005
040000*      OF EACH FOR EACH TABLE FOUND.                             *04000011
040001*                                                                *04000111
040002*      NOTE:  IF SYSTEM UTILITY DSNTIAUL IS USED TO UNLOAD A     *04000211
040010*             TABLE IN A PROC STEP, THE TABLES THAT WILL APPEAR  *04001011
040020*             IN THE XREF ARE SYSCOLUMNS AND SYSDUMMY1, NOT THE  *04002011
040030*             TABLE BEING UNLOADED.                              *04003011
040100******************************************************************04010005
040200 B300-CREATE-OUTPUT-RECORDS.                                      04020005
040300                                                                  04030005
040400     INITIALIZE DP006O-RECORD.                                    04040005
040500     INITIALIZE DP007O-RECORD.                                    04050005
040600                                                                  04060005
040700     MOVE 'DB2 ' TO DP007O-TYPE-CODE.                             04070005
040800     MOVE 'D'    TO DP007O-MEDIA-CODE.                            04080005
040900                                                                  04090005
041000     SET MORE-TABLE-NAMES TO TRUE.                                04100005
041100     PERFORM C100-OPEN-TABLE.                                     04110005
041200                                                                  04120005
041300     PERFORM UNTIL END-OF-TABLE-NAMES                             04130005
041400         PERFORM C200-FETCH-TABLE-NAMES                           04140005
041500         IF MORE-TABLE-NAMES                                      04150005
041600             MOVE SYSTABAU-TTNAME-TEXT TO DP007O-FILE-NAME        04160005
041700                                          DP006O-FILE-NAME        04170005
041800             PERFORM C300-WRITE-TP1PROC-RECORD                    04180005
041900             PERFORM C400-WRITE-TP1FILE-RECORD                    04190005
042000         END-IF                                                   04200005
042100     END-PERFORM                                                  04210005
042200     PERFORM C500-CLOSE-TABLE.                                    04220005
042300                                                                  04230005
042400 B300-END.                                                        04240005
042500     EXIT.                                                        04250005
042600                                                                  04260005
042700     EJECT                                                        04270005
042800                                                                  04280005
042900***************************************************************** 04290005
043000* C100 THIS SECTION OPENS THE CURSOR FOR THE TABLES INCLUDED    * 04300005
043100*      IN THE RELATED PACKAGE.                                  * 04310009
043200***************************************************************** 04320005
043300 C100-OPEN-TABLE.                                                 04330005
043400                                                                  04340005
043500     EXEC SQL                                                     04350005
043600         OPEN TABLEGP                                             04360005
043700     END-EXEC.                                                    04370005
043800                                                                  04380005
043900     IF SQLCODE < 0                                               04390005
044000         DISPLAY '** ABEND ** OPEN   ERROR  ON SYSTABAUTH'        04400005
044100                 ' SYSTABLES'                                     04410005
044200         GO TO Z900-SQL-ERROR.                                    04420005
044300                                                                  04430005
044400     IF (SQLCODE > 0 AND SQLCODE NOT = 100) OR                    04440005
044500         SQLWARN0 = 'W'                                           04450005
044600         DISPLAY '** ABEND ** OPEN  WARNING ON SYSTABAUTH'        04460005
044700                 ' SYSTABLES'                                     04470005
044800         PERFORM Z900-SQL-WARNING.                                04480005
044900                                                                  04490005
045000 C100-END.                                                        04500005
045100     EXIT.                                                        04510005
045200                                                                  04520005
045300***************************************************************** 04530005
045400* C200 THIS SECTION FETCHES THE TABLE NAMES RETRIEVED BY THE    * 04540005
045500*      OPEN CURSOR.                                             * 04550005
045600***************************************************************** 04560005
045700  C200-FETCH-TABLE-NAMES.                                         04570005
045800                                                                  04580005
045900     MOVE SPACES TO SYSTABAU-TTNAME.                              04590005
046000                                                                  04600005
046100     EXEC SQL                                                     04610005
046200         FETCH TABLEGP                                            04620005
046300         INTO :SYSTABAU-TTNAME                                    04630005
046400     END-EXEC.                                                    04640005
046500                                                                  04650005
046600     IF SQLCODE < 0                                               04660005
046700         DISPLAY '** ABEND ** FETCH ERROR   ON SYSTABAUTH'        04670005
046800                 ' SYSTABLES'                                     04680005
046900         GO TO Z900-SQL-ERROR.                                    04690005
047000                                                                  04700005
047100     IF (SQLCODE > 0 AND SQLCODE NOT = 100) OR                    04710005
047200         SQLWARN0 = 'W'                                           04720005
047300         DISPLAY '** ABEND ** FETCH WARNING ON SYSTABAUTH'        04730005
047400                 ' SYSTABLES'                                     04740005
047500         PERFORM Z900-SQL-WARNING.                                04750005
047600                                                                  04760005
047700     IF SQLCODE = 100                                             04770005
047800         SET END-OF-TABLE-NAMES TO TRUE.                          04780005
047900                                                                  04790005
048000     EJECT                                                        04800005
048100                                                                  04810005
048200******************************************************************04820005
048300* C300 THIS PARAGRAPH PROCESSES THE PROC/STEP ASSOCIATOR TABLE   *04830005
048400*      DATA RECORD BY FILLING THE OUTPUT FIELDS WITH THE APPRO-  *04840005
048500*      PRIATE INPUT DATA AND THEN WRITING IT TO THE OUTPUT FILE. *04850005
048600******************************************************************04860005
048700 C300-WRITE-TP1PROC-RECORD.                                       04870005
048800                                                                  04880005
048900     MOVE DP005I-PROC-NAME        TO DP006O-PROCNAME.             04890005
049000     MOVE DP005I-STEP-NAME        TO DP006O-STEPNAME.             04900005
049100                                                                  04910005
049200     WRITE ASSOCIATOR-TABLE-RECORD FROM DP006O-RECORD.            04920005
049300                                                                  04930005
049400 C300-END.                                                        04940005
049500     EXIT.                                                        04950005
049600                                                                  04960005
049700     EJECT                                                        04970005
049800                                                                  04980005
049900******************************************************************04990005
050000* C400 THIS PARAGRAPH INITIALIZES THE FILE/TABLE CROSS-REFERENCE *05000005
050100*      RECORD. IT THEN DETERMINES IF IT IS IMS/DB2 OR STRAIGHT   *05010005
050200*      DB2 AND FILLS IN THE TYPE. FINALLY, IT CREATES A RECORD   *05020005
050300*      FOR EACH TABLE IT FINDS ON THE SYSIBM.SYSTABLES TABLE FOR *05030005
050400*      THE PLAN.                                                 *05040005
050500******************************************************************05050005
050600 C400-WRITE-TP1FILE-RECORD.                                       05060005
050700                                                                  05070005
050800     WRITE FILE-TABLE-RECORD FROM DP007O-RECORD.                  05080005
050900                                                                  05090005
051000 C400-END.                                                        05100005
051100     EXIT.                                                        05110005
051200                                                                  05120005
051300     EJECT                                                        05130005
051400                                                                  05140005
051500***************************************************************** 05150005
051600* C500 THIS SECTION CLOSES THE CURSOR FOR THE TABLES INCLUDED   * 05160005
051700*      IN THE RELATED PACKAGE AND READIES IT FOR THE NEXT       * 05170009
051800*      OPEN CURSOR USING A DIFFERENT PLAN                       * 05180009
051900***************************************************************** 05190005
052000 C500-CLOSE-TABLE.                                                05200005
052100                                                                  05210005
052200     EXEC SQL                                                     05220005
052300         COMMIT                                                   05230005
052400     END-EXEC.                                                    05240005
052500                                                                  05250005
052600     IF SQLCODE < 0                                               05260005
052700         DISPLAY '** ABEND ** COMMIT ERROR  ON SYSTABAUTH'        05270005
052800                 ' SYSTABLES'                                     05280005
052900         GO TO Z900-SQL-ERROR.                                    05290005
053000                                                                  05300005
053100     IF (SQLCODE > 0 AND SQLCODE NOT = 100) OR                    05310005
053200         SQLWARN0 = 'W'                                           05320005
053300         DISPLAY '** ABEND ** COMMIT WARNING ON SYSTABAUTH'       05330005
053400                 ' SYSTABLES'                                     05340005
053500         PERFORM Z900-SQL-WARNING.                                05350005
053600                                                                  05360005
053700 C500-END.                                                        05370005
053800     EXIT.                                                        05380005
053900                                                                  05390005
054000**********************************************************        05400005
054100*    SQL WARNING AND ERROR PROCESSING                    *        05410005
054200**********************************************************        05420005
054300                                                                  05430005
054400 Z900-SQL-WARNING.                                                05440005
054500                                                                  05450005
054600     MOVE SQLCODE    TO SQLCODE2.                                 05460005
054700     MOVE SQLERRD(3) TO SQLERRD3.                                 05470005
054800     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05480005
054900     DISPLAY '** PROGRAM        ** = DPKUT034'.                   05490005
055000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05500005
055100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05510005
055200     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05520005
055300     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  05530005
055400     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  05540005
055500     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  05550005
055600     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  05560005
055700     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  05570005
055800     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  05580005
055900     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  05590005
056000     EXEC SQL                                                     05600005
056100         COMMIT                                                   05610005
056200     END-EXEC.                                                    05620005
056300     MOVE 4013 TO ABEND-CODE.                                     05630005
056400     CALL 'ILBOABN0' USING ABEND-CODE.                            05640005
056500                                                                  05650005
056600 Z900-SQL-ERROR.                                                  05660005
056700                                                                  05670005
056800     MOVE SQLCODE    TO SQLCODE2.                                 05680005
056900     MOVE SQLERRD(3) TO SQLERRD3.                                 05690005
057000     DISPLAY '** ABEND **       ** = SQLERROR'.                   05700005
057100     DISPLAY '** PROGRAM        ** = DPKUT034'.                   05710005
057200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05720005
057300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05730005
057400     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05740005
057500     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05750005
057600     EXEC SQL                                                     05760005
057700         COMMIT                                                   05770005
057800     END-EXEC.                                                    05780005
057900     MOVE 4013 TO ABEND-CODE.                                     05790005
058000     CALL 'ILBOABN0' USING ABEND-CODE.                            05800005
058100                                                                  05810005
