000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             XIKUP002.                                00050006
000600 AUTHOR.                 VLADIMIR FILIPOVIC.                      00060006
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            07/14/2004.                              00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110007
001200*  THIS PROGRAM LOADS THE XIT_DC_ASGMT TABLE WITH STORE/DC        00120007
001300*       RELATIONSHIPS                                             00130007
001300* INPUT FILES: DC-LOCATION-FILE            DDNAME = INP01        *00140008
001400*                                                                *00150007
001500* OUTPUT FILES:  N/A                                             *00160007
002000***************************************************************** 00170001
002100*                                                                 00180001
002100*                                                                 00180001
002200*  THE PROGRAM READS PKMO.HO.RMS.DCLOCASG.DATA FILE WHICH IS      00190008
002200*  SORTED BY LOC-NBR AND EFF-BEG-DTE.  IT THEN INSERTS RECORDS    00200008
002300*  INTO THE XIT_DC_LOC_ASGMT TABLE.                               00210008
005900******************************************************************00240001
002900*---------------------------------------------------------------*         
      *    WR/PITS#     DATE        DESCRIPTION                       *         
      *    --------   ----------   ---------------------------------  *         
      *    WR26596    07/14/2004   INITIAL CREATION.                  *         
002900*---------------------------------------------------------------*         
007000                                                                  00250001
007100***************************************************************** 00260001
007200 ENVIRONMENT DIVISION.                                            00270001
007300***************************************************************** 00280001
007400                                                                  00290001
007500 CONFIGURATION SECTION.                                           00300001
007600                                                                  00310001
007700 SOURCE-COMPUTER.        IBM-3090.                                00320001
007800 OBJECT-COMPUTER.        IBM-3090.                                00330001
007900                                                                  00340001
008000 INPUT-OUTPUT SECTION.                                            00350001
008100                                                                  00360001
008200 FILE-CONTROL.                                                    00370001
008300                                                                  00380001
008400     SELECT DC-LOCATION-FILE                                      00390008
008500         ASSIGN TO INP01.                                         00400008
008600                                                                  00410001
009100******************************************************************00420001
009200 DATA DIVISION.                                                   00430001
009300******************************************************************00440001
009400                                                                  00450001
009500 FILE SECTION.                                                    00460001
009600                                                                  00470001
009700 FD  DC-LOCATION-FILE                                             00480008
009800     RECORDING MODE IS F                                          00490001
009900     BLOCK CONTAINS 0 RECORDS                                     00500001
010000     LABEL RECORDS ARE STANDARD.                                  00510001
010100                                                                  00520001
010200 01  DC-LOCATION-RECORD      PIC X(30).                           00530008
010300                                                                  00540001
011100******************************************************************00550001
011200 WORKING-STORAGE SECTION.                                         00560001
011300******************************************************************00570001
011600                                                                  00580001
011400 01  FILLER                           PIC X(50)  VALUE            00610001
011500     ' *** WORKING STORAGE STARTS HERE FOR XIKUP002 *** '.        00620006
003400                                                                  00630007
003600                                                                  00640007
003700 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00650007
003800                                              COMP SYNC.          00660007
004000                                                                  00680007
005400 01  PA-PROGRAM-ACCUMULATORS.                                             
                                                                                
007900     05  PA-RECORDS-READ          PIC 9(07) VALUE ZERO.                   
007900     05  PA-ROWS-INSERTED         PIC 9(07) VALUE ZERO.                   
                                                                                
004400 01  PC-PROGRAM-CONSTANTS.                                        00720007
004500     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'XMKUP016'.   00730007
004300                                                                  00740007
008100 01  PS-PROGRAM-SWITCHES.                                         00750007
008300     05  PS-END-OF-FILE-SW       PIC X(1)     VALUE 'N'.          00770007
008400         88  PS-NOT-END-OF-FILE               VALUE 'N'.          00780007
008500         88  PS-END-OF-FILE                   VALUE 'Y'.          00790007
004300                                                                  00800007
                                                                                
009000***************************************************************** 00810007
009100*  SQL AND COBOL DECLARATIONS FOR THE DOMAIN TABLE                00820007
009200*  (XIT_DC_LOC_ASGMT)                                             00830008
009300***************************************************************** 00840007
009400                                                                  00850007
009500     EXEC SQL                                                     00860007
009600         INCLUDE XIT00001                                         00870008
009700     END-EXEC.                                                    00880007
009800                                                                  00890007
009900******************************************************************00900007
010000*  FILE LAYOUT FOR LOCATION DOMAIN COPYBOOK                     * 00910007
010100******************************************************************00920007
010200     COPY HORD007.                                                00930007
010300                                                                  00940007
010400******************************************************************00950007
010500*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                00960007
010600******************************************************************00970007
010700                                                                  00980007
010800     EXEC SQL                                                     00990007
010900         INCLUDE SQLCA                                            01000007
011000     END-EXEC.                                                    01010007
011100                                                                  01020007
011700******************************************************************01030007
011800*  DB2 FORMATTED ERROR MESSAGE                                   *01040007
011900******************************************************************01050007
012000     COPY DPWS004.                                                01060007
012100                                                                  01070007
011700******************************************************************01080009
010300 PROCEDURE DIVISION.                                              01090009
011900******************************************************************01100009
                                                                        01110009
       0000-MAINLINE.                                                   01120010
                                                                        01130009
010500     OPEN INPUT  DC-LOCATION-FILE.                                01140009
010600                                                                  01150009
010700     PERFORM 2000-READ-DC-LOCATION-FILE.                          01160010
010800                                                                  01170009
010900     PERFORM 1000-PROCESS-DC-LOCATION-FILE                        01180009
011000         UNTIL PS-END-OF-FILE.                                    01190009
011100                                                                  01200009
009750     PERFORM 5000-COMMIT.                                                 
                                                                                
           DISPLAY 'INPUT RECORDS READ: ' PA-RECORDS-READ.                      
           DISPLAY 'ROWS INSERTED:      ' PA-ROWS-INSERTED.                     
                                                                                
011200     CLOSE       DC-LOCATION-FILE.                                01210009
011300                                                                  01220009
011400     GOBACK.                                                      01230009
011500                                                                  01240009
011700******************************************************************01350009
011600* 1000-PROCESS-DC-LOCATION-FILE                                   01360009
010300*  PERFORM MAIN FILE PROCESSING.                                  01370009
011900******************************************************************01380009
012200 1000-PROCESS-DC-LOCATION-FILE.                                   01390009
                                                                        01400009
           INITIALIZE DCLXIT00001.                                              
                                                                                
           MOVE HO007-DCLOC-LOC-NBR     TO XIT00001-LOC-NBR.                    
           MOVE HO007-DCLOC-EFF-BEG-DTE TO XIT00001-EFF-BEG-DTE.                
           MOVE HO007-DCLOC-DC-NBR      TO XIT00001-DC-NBR.                     
           MOVE HO007-DCLOC-PO-STRT-DTE TO XIT00001-PO-STRT-DTE.                
                                                                                
           PERFORM 2500-INSERT-TABLE                                            
                                                                                
           PERFORM 2000-READ-DC-LOCATION-FILE.                                  
                                                                                
011700******************************************************************01250009
011600* 2000-READ-DC-LOCATION-FILE.                                     01260010
010300*  READ DC-LOCATION-FILE.                                         01270009
011900******************************************************************01280009
011600 2000-READ-DC-LOCATION-FILE.                                      01290010
011700                                                                  01300009
011800     READ DC-LOCATION-FILE INTO HORD007-RECORD                    01310009
011900        AT END                                                    01320009
012000           SET PS-END-OF-FILE TO TRUE.                            01330009
                                                                                
           IF PS-END-OF-FILE                                                    
               CONTINUE                                                         
           ELSE                                                                 
               ADD 1 TO PA-RECORDS-READ                                         
           END-IF.                                                              
011700******************************************************************01250009
011600* 2500-INSERT-TABLE.                                              01260010
010300*  INSERT INTO XIT_DC_LOC_ASGMT TABLE                             01270009
011900******************************************************************01280009
011600 2500-INSERT-TABLE.                                               01290010
012800                                                                          
012900     EXEC SQL                                                             
013000         INSERT INTO XIT_DC_LOC_ASGMT                                     
013100             (LOC_NBR                                                     
013200            , EFF_BEG_DTE                                                 
013300            , DC_NBR                                                      
013200            , PO_STRT_DTE)                                                
013400         VALUES (: XIT00001-LOC-NBR                                       
013500               , : XIT00001-EFF-BEG-DTE                                   
013600               , : XIT00001-DC-NBR                                        
013500               , : XIT00001-PO-STRT-DTE)                                  
013700     END-EXEC                                                             
013800                                                                          
030900     EVALUATE SQLCODE                                                     
031000        WHEN ZERO                                                         
031100            ADD 1 TO PA-ROWS-INSERTED                                     
031400        WHEN OTHER                                                        
031600            DISPLAY '2500-INSERT-TABLE  '                                 
031600            DISPLAY 'ERROR ON INSERT TO XIT_DC_LOC_ASGMT'                 
031700            DISPLAY HO007-DCLOC-LOC-NBR ' '                               
031800                    HO007-DCLOC-EFF-BEG-DTE ' '                           
032200            PERFORM 9999-SQL-ABEND                                        
032300     END-EVALUATE.                                                        
037300******************************************************************        
037400*  5000-COMMIT.                                                           
037500*  COMMIT ALL UPDATES.                                           *        
037300******************************************************************        
009750 5000-COMMIT.                                                             
049200                                                                          
049300     EXEC SQL                                                             
049400         COMMIT                                                           
049500     END-EXEC.                                                            
049700                                                                          
049800     EVALUATE TRUE                                                        
049900       WHEN SQLCODE = ZERO                                                
050000          CONTINUE                                                        
050200       WHEN OTHER                                                         
050300         DISPLAY '5000-COMMIT '                                           
050300         DISPLAY 'ERROR ON COMMIT '                                       
051200         PERFORM 9999-SQL-ABEND                                           
051400     END-EVALUATE.                                                        
051500                                                                          
                                                                                
037300******************************************************************        
037400*  ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING    *        
037500*  CODE OCCURS.                                                  *        
037600******************************************************************        
037700 9999-SQL-ABEND.                                                          
037800                                                                          
037900     DISPLAY '** ABEND     **'.                                           
038000******************************************************************        
038100*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *        
038200*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE       *        
038300*  'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE   *        
038400*  FORMAT.                                                       *        
038500******************************************************************        
038600     COPY DPPD004.                                                        
038700                                                                          
038800     MOVE +4013 TO ABEND-CODE.                                            
038900     CALL 'ILBOABN0' USING ABEND-CODE.                                    
039000                                                                          
