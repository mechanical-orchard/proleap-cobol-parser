       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    SUKCS807.                                         00020000
       AUTHOR.        Cognizant.                                        00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  MAY 2016.                                         00050000
       DATE-COMPILED.                                                   00060000
      *---------------------------------------------------------------  00070000
      *    S807 - ProcessCartonScan WEBSERVICE TRANSACTION              00080000
      *---------------------------------------------------------------  00090000
                                                                        00100000
       ENVIRONMENT DIVISION.                                            00110000
                                                                        00120000
       DATA DIVISION.                                                   00130000
                                                                        00140000
       WORKING-STORAGE SECTION.                                         00150000
         01  DK-DB2-KEYS.                                               00160000
             15  DK-SHIPT-UNT-ID           PIC S9(18)V COMP-3.          00161000
             15  DK-STORE-NBR              PIC S9(04)  COMP SYNC.       00162000
             15  DK-OTBND-TRIP-ID          PIC S9(09) COMP VALUE ZERO.  00163000
         01  PS-PROGRAM-SWITCHES.                                       00164000
           05  PS-ALREADY-SCANNED-SW       PIC  X(01) VALUE 'N'.        00165000
               88 PS-ALREADY-SCANNED                  VALUE 'Y'.        00166000
               88 PS-NO-ALREADY-SCANNED               VALUE 'N'.        00167000
005000     05  PS-ERROR-SW                 PIC  X(01) VALUE 'N'.        00168000
005100         88  PS-ERROR-YES                       VALUE 'Y'.        00169000
005200         88  PS-ERROR-NO                        VALUE 'N'.        00170000
         01  PC-PROGRAM-CONSTANTS.                                      00171000
001100     05  PC-SUCCESS                  PIC  X(20) VALUE             00171100
001200                                       'SUCCESSFUL INSERT'.       00171200
001300     05  PC-FAILURE                  PIC  X(20) VALUE             00171300
001400                                       'INSERT FAILED'.           00171400
      ******************************************************************00171500
001900*   59.  UPDATE(S) SUCCESSFUL                                     00171600
002000*  334.  STORE NUMBER MUST BE NUMERIC                             00171700
      * 1570.  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK          00171800
      * 3782.  CARTON ID REQUIRED                                       00171900
      * 3784.  INVALID CARTON ID                                        00172000
      * 3786.  MULTIPLE CARTONS ASSIGNED - PLEASE SCAN BARCODE ON 4X4   00172100
      *        LABEL                                                    00172200
      * 3787.  FUNCTION IS CURRENTLY UNAVAILABLE                        00172300
      ******************************************************************00172400
           05  PC-TSYMSG-NUMBERS.                                       00172500
               10  PC-TSYMSG-00007         PIC  9(05) VALUE  00007.     00172600
               10  PC-TSYMSG-00059         PIC  9(05) VALUE  00059.     00172700
               10  PC-TSYMSG-00380         PIC  9(05) VALUE  00380.     00172800
               10  PC-TSYMSG-01266         PIC  9(05) VALUE  01266.     00172900
               10  PC-TSYMSG-01570         PIC  9(05) VALUE  01570.     00173000
               10  PC-TSYMSG-03053         PIC  9(05) VALUE  03053.     00173100
               10  PC-TSYMSG-03778         PIC  9(05) VALUE  03778.     00173200
               10  PC-TSYMSG-03782         PIC  9(05) VALUE  03782.     00173300
               10  PC-TSYMSG-03784         PIC  9(05) VALUE  03784.     00173400
               10  PC-TSYMSG-03786         PIC  9(05) VALUE  03786.     00173500
               10  PC-TSYMSG-03787         PIC  9(05) VALUE  03787.     00173600
               10  PC-TSYMSG-03794         PIC  9(05) VALUE  03794.     00173700
                                                                        00173800
         01  PV-PROGRAM-VARIABLES.                                      00173900
           05  PV-TSYMSG-NUMBER            PIC  9(05) VALUE  0.         00174000
           05  PV-CARTON-DISP              PIC  9(20) VALUE  0.         00175000
           05  PV-TRIP-DISP                PIC  9(09) VALUE  0.         00176000
           05  PV-SQLCODE                  PIC  9(09) VALUE  0.         00177000
           05  PV-CICS-MSG-AREA.                                        00178000
               10 PV-PROGRAM-NAME          PIC  X(10) VALUE             00179000
                                                     ' SUKCS807 '.      00180000
               10 PV-LOG-TIME              PIC  X(15) VALUE SPACES.     00190000
               10 PV-PARA-NAME             PIC  X(25) VALUE SPACES.     00191000
               10 PV-ERROR-MSG             PIC  X(78) VALUE SPACES.     00192000
           05  PV-COMMAREA-LENGTH          PIC S9(04)  VALUE +0         00193000
                                                           COMP SYNC.   00194000
           05  PV-CICS-RESPONSE            PIC S9(08)  VALUE ZEROS      00194100
                                                        COMP SYNC.      00194200
           05  PV-NULL-IND                 PIC S9(04)  VALUE ZEROS      00194300
                                                       COMP SYNC.       00194400
           05  PV-TRIP-NULL-IND            PIC S9(04)  VALUE ZEROS      00194500
                                                       COMP SYNC.       00194600
           05  PV-CURR-TIMESTAMP           PIC X(26).                   00194700
           05  PV-CURR-TMST-DATE-HHMM   REDEFINES                       00194800
               PV-CURR-TIMESTAMP.                                       00194900
               10  PV-CURR-YEAR            PIC X(04).                   00195000
               10  FILLER                  PIC X(01).                   00196000
               10  PV-CURR-MONTH           PIC X(02).                   00196100
               10  FILLER                  PIC X(01).                   00196200
               10  PV-CURR-DAY             PIC X(02).                   00196300
               10  FILLER                  PIC X(01).                   00196400
               10  PV-CURR-HOUR            PIC X(02).                   00196500
               10  FILLER                  PIC X(01).                   00196600
               10  PV-CURR-MIN             PIC X(02).                   00196700
               10  FILLER                  PIC X(01).                   00196800
               10  PV-CURR-SEC             PIC X(02).                   00196900
               10  FILLER                  PIC X(07).                   00197000
           05  PV-CSSL-TMST.                                            00197100
               10  PV-CSSL-MONTH           PIC X(02).                   00197200
               10  FILLER                  PIC X(01) VALUE '-'.         00197300
               10  PV-CSSL-DAY             PIC X(02).                   00197400
               10  FILLER                  PIC X(01) VALUE SPACE.       00197500
               10  PV-CSSL-HOUR            PIC X(02).                   00197600
               10  FILLER                  PIC X(01) VALUE ':'.         00197700
               10  PV-CSSL-MIN             PIC X(02).                   00197800
               10  FILLER                  PIC X(01) VALUE ':'.         00197900
               10  PV-CSSL-SEC             PIC X(02).                   00198000
               10  FILLER                  PIC X(01) VALUE SPACE.       00198100
                                                                        00198200
      *INPUT                                                            00198300
            COPY SURD137.                                               00198400
      *OUTPUT                                                           00198500
            COPY SURD138.                                               00198600
                                                                        00198700
019400*    ITEM COMMAREA FOR PCKUT713                                   00198800
019500     COPY PCWS046.                                                00198900
019600                                                                  00199000
            COPY DPRD507I.                                              00200000
                                                                        00210000
           EXEC SQL                                                     00220000
               INCLUDE SQLCA                                            00230000
           END-EXEC.                                                    00240000
                                                                        00250000
                                                                        00260000
           EXEC SQL                                                     00270000
                INCLUDE TKRPRPM                                         00280000
           END-EXEC.                                                    00290000
                                                                        00300000
           EXEC SQL                                                     00310000
                INCLUDE TSUOBTS                                         00320000
           END-EXEC.                                                    00330000
                                                                        00340000
           EXEC SQL                                                     00350000
                INCLUDE SUT00024                                        00360000
           END-EXEC.                                                    00370000
                                                                        00380000
           EXEC SQL                                                     00390000
                INCLUDE SUT00121                                        00400000
           END-EXEC.                                                    00410000
                                                                        00420000
      *----------------------------------------------------------------*00430000
       LINKAGE SECTION.                                                 00440000
                                                                        00450000
       01  DFHCOMMAREA.                                                 00460000
           05  FILLER                         OCCURS  1 TO 5072 TIMES   00470000
                                              DEPENDING ON EIBCALEN.    00480000
               10  FILLER                     PIC X.                    00490000
                                                                        00500000
       PROCEDURE DIVISION.                                              00510000
      ***************************************************************** 00520000
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 00530000
      ***************************************************************** 00540000
       0000-MAIN-MODULE.                                                00550000
                                                                        00560000
           PERFORM 1000-INITIALIZE.                                     00570000
           PERFORM 1100-CHECK-WEBSERV-AVAIL.                            00580000
           IF EIBCALEN > 0                                              00590000
                                                                        00600000
              MOVE DFHCOMMAREA(1:EIBCALEN) TO SU137-INP-PROCESS-CARTON  00610000
                                                                        00620000
              IF SU137-CARTON-ID GREATER THAN ZEROES                    00630000
                                                                        00640000
                 PERFORM 2000-CHECK-VALID-CARTON                        00650000
                 PERFORM 2200-VALIDATE-INPUT-FIELDS                     00660000
                 PERFORM 2300-FIND-SCAN-TYP-CDE                         00670000
                 PERFORM 2400-INSERT-CARTON-SCAN                        00680000
                                                                        00690000
                 IF SUT00121-SCN-TYP-CDE = 'SSSM' OR 'SSNM'             00700000
                    IF PV-NULL-IND = -1                                 00710000
                                                                        00720000
                       PERFORM 2500-UPDATE-TRIP-ID                      00730000
                                                                        00740000
                    END-IF                                              00750000
                 END-IF                                                 00760000
                                                                        00770000
              ELSE                                                      00780000
                                                                        00790000
                 MOVE PC-FAILURE            TO SU138-RESP-MSG           00800000
                 MOVE PC-TSYMSG-03782       TO PV-TSYMSG-NUMBER         00810000
                 MOVE 'CARTON ID REQUIRED'  TO PV-ERROR-MSG             00820000
                 MOVE '0000-MAIN-MODULE  '  TO PV-PARA-NAME             00830000
                 PERFORM 9995-CSSL-LOG-RETURN                           00840000
                                                                        00850000
              END-IF                                                    00860000
           END-IF.                                                      00870000
                                                                        00880000
           PERFORM 9000-RETURN-TRAN                                     00890000
              .                                                         00900000
      *----------------------------------------------------------------*00910000
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *00920000
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *00930000
      *----------------------------------------------------------------*00940000
                                                                        00950000
       1000-INITIALIZE.                                                 00960000
           INITIALIZE SU137-INP-PROCESS-CARTON                          00970000
                      SU138-OUT-PROCESS-CARTON.                         00980000
                                                                        00990000
            EXEC SQL                                                    01000000
              SELECT                                                    01010000
                    CURRENT TIMESTAMP                                   01020000
              INTO                                                      01030000
                   :PV-CURR-TIMESTAMP                                   01040000
              FROM SYSIBM.SYSDUMMY1                                     01050000
            END-EXEC.                                                   01060000
                                                                        01070000
           EVALUATE TRUE                                                01080000
                                                                        01090000
               WHEN SQLCODE = ZERO                                      01100000
                                                                        01110000
                  MOVE  PV-CURR-MONTH    TO PV-CSSL-MONTH               01120000
                  MOVE  PV-CURR-DAY      TO PV-CSSL-DAY                 01130000
                  MOVE  PV-CURR-HOUR     TO PV-CSSL-HOUR                01140000
                  MOVE  PV-CURR-MIN      TO PV-CSSL-MIN                 01150000
                  MOVE  PV-CURR-SEC      TO PV-CSSL-SEC                 01160000
                  MOVE  PV-CSSL-TMST     TO PV-LOG-TIME                 01170000
                                                                        01180000
               WHEN SQLCODE NOT = ZERO                                  01190000
                                                                        01200000
                    MOVE PC-FAILURE                 TO SU138-RESP-MSG   01210000
                    MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 01220000
                    MOVE SQLCODE                    TO PV-SQLCODE       01230000
                    MOVE '1000-INITIALIZE '         TO PV-PARA-NAME     01240000
                                                                        01250000
                    STRING 'DB2 IS NOT ACTIVE, SQLCODE:'                01260000
                    PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     01270000
                                                                        01280000
                    PERFORM 9995-CSSL-LOG-RETURN                        01290000
                                                                        01300000
           END-EVALUATE.                                                01310000
       1100-CHECK-WEBSERV-AVAIL.                                        01320000
                                                                        01330000
            EXEC SQL                                                    01340000
              SELECT FUNC_TXT                                           01350000
                INTO :KRPRPM-FUNC-TXT                                   01360000
                FROM TKRPRPM                                            01370000
              WHERE LOC_ID            = 90                              01380000
                AND INTFC_SYS_CDE     = 'KHL'                           01390000
                AND SYS_PRC_FUNC_CDE  = 'STWEB7'                        01400000
                AND FUNC_PRC_STAT_CDE = 'AC'                            01410000
                AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              01420000
                AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              01430000
                AND FUNC_TXT          = 'Y'                             01440000
              WITH UR                                                   01450000
            END-EXEC.                                                   01460000
                                                                        01470000
           EVALUATE TRUE                                                01480000
               WHEN SQLCODE = ZERO                                      01490000
                                                                        01500000
                        CONTINUE                                        01510000
                                                                        01520000
               WHEN SQLCODE = +100                                      01530000
                                                                        01540000
                    MOVE PC-FAILURE                TO SU138-RESP-MSG    01550000
                    MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER  01560000
                    MOVE 'WEB SERVICE ProcesscartonScan NOT AVAILABLE ' 01570000
                                                     TO PV-ERROR-MSG    01580000
                    MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    01590000
                    PERFORM 9995-CSSL-LOG-RETURN                        01600000
                                                                        01610000
               WHEN SQLCODE NOT = ZERO                                  01620000
                                                                        01630000
                    MOVE PC-FAILURE                TO SU138-RESP-MSG    01640000
                    MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 01650000
                    MOVE SQLCODE                    TO PV-SQLCODE       01660000
                    MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME     01670000
                    STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        01680000
                    PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     01690000
                    PERFORM 9995-CSSL-LOG-RETURN                        01700000
                                                                        01710000
           END-EVALUATE.                                                01720000
       2000-CHECK-VALID-CARTON.                                         01730000
                                                                        01740000
            MOVE SU137-CARTON-ID      TO DK-SHIPT-UNT-ID                01750000
                                         PV-CARTON-DISP.                01760000
                                                                        01770000
            EXEC SQL                                                    01780000
                SELECT  A.SHIPT_UNT_ID                                  01790000
                      , A.DEST_LOC_NBR                                  01800000
                      , A.OTBND_TRIP_ID                                 01810000
                  INTO  :SUT00024-SHIPT-UNT-ID                          01820000
                      , :SUT00024-DEST-LOC-NBR                          01830000
                      , :SUT00024-OTBND-TRIP-ID :PV-NULL-IND            01840000
                  FROM  SUT_OTBND_CART A                                01850000
                 WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              01860000
                   AND  A.MSTR_CART_IND = 'N'                           01870000
      ***          AND  A.ACTV_IND      = 'Y'                           01880000
                WITH UR                                                 01890000
            END-EXEC.                                                   01900000
                                                                        01910000
            EVALUATE TRUE                                               01920000
               WHEN SQLCODE = ZERO                                      01930000
                                                                        01940000
                  MOVE DK-SHIPT-UNT-ID TO SUT00121-SHIPT-UNT-ID         01950000
                                                                        01960000
               WHEN SQLCODE = 100                                       01970000
                                                                        01980000
                  PERFORM 2100-CHECK-VALID-CART-VEND                    01990000
                                                                        02000000
               WHEN SQLCODE NOT = ZERO                                  02010000
                                                                        02020000
                  MOVE SQLCODE                    TO PV-SQLCODE         02030000
                  MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   02040000
                  MOVE PC-FAILURE                 TO SU138-RESP-MSG     02050000
                  STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02060000
                         PV-SQLCODE ' SML#' PV-CARTON-DISP              02070000
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02080000
                                                                        02090000
                  MOVE ' 2000-CHECK-VALID-CARTON'  TO PV-PARA-NAME      02100000
                  PERFORM 9995-CSSL-LOG-RETURN                          02110000
                                                                        02120000
            END-EVALUATE                                                02130000
            .                                                           02140000
       2100-CHECK-VALID-CART-VEND.                                      02150000
                                                                        02160000
            EXEC SQL                                                    02170000
                SELECT                                                  02180000
                        A.SHIPT_UNT_ID                                  02190000
                      , A.DEST_LOC_NBR                                  02200000
                      , A.OTBND_TRIP_ID                                 02210000
                  INTO                                                  02220000
                        :SUT00024-SHIPT-UNT-ID                          02230000
                      , :SUT00024-DEST-LOC-NBR                          02240000
                      , :SUT00024-OTBND-TRIP-ID :PV-NULL-IND            02250000
                  FROM  SUT_OTBND_CART A                                02260000
                 WHERE  A.ORIG_CART_ID  = :DK-SHIPT-UNT-ID              02270000
                   AND  A.MSTR_CART_IND = 'N'                           02280000
      ****         AND  A.ACTV_IND      = 'Y'                           02290000
                WITH UR                                                 02300000
            END-EXEC.                                                   02310000
                                                                        02320000
            EVALUATE TRUE                                               02330000
               WHEN SQLCODE = ZERO                                      02340000
                                                                        02350000
                  MOVE SUT00024-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID         02360000
                                                SUT00121-SHIPT-UNT-ID   02370000
                                                                        02380000
               WHEN SQLCODE = -811                                      02390000
                                                                        02400000
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02410000
                  MOVE PC-TSYMSG-03786         TO PV-TSYMSG-NUMBER      02420000
                  STRING 'MULTIPLE CARTONS FOUND FOR VENDOR CARTON ID:' 02430000
                      PV-CARTON-DISP     DELIMITED BY SIZE INTO         02440000
                                                       PV-ERROR-MSG     02450000
                  MOVE '2100-CHECK-VALID-CART-VEND' TO PV-PARA-NAME     02460000
                  PERFORM 9995-CSSL-LOG-RETURN                          02470000
                                                                        02480000
               WHEN SQLCODE = 100                                       02490000
                                                                        02500000
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02510000
                  MOVE PC-TSYMSG-03784         TO PV-TSYMSG-NUMBER      02520000
                  STRING 'INVALID CARTON ID ENTERED, INPUT CARTON ID:'  02530000
                      PV-CARTON-DISP     DELIMITED BY SIZE INTO         02540000
                                                       PV-ERROR-MSG     02550000
                  MOVE '2100-CHECK-VALID-CART-VEND' TO PV-PARA-NAME     02560000
                  PERFORM 9995-CSSL-LOG-RETURN                          02570000
                                                                        02580000
               WHEN SQLCODE NOT = ZERO                                  02590000
                                                                        02600000
                  MOVE PC-FAILURE                 TO SU138-RESP-MSG     02610000
                  MOVE SQLCODE                    TO PV-SQLCODE         02620000
                  MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   02630000
                  STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02640000
                         PV-SQLCODE ' SML#' PV-CARTON-DISP              02650000
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02660000
                                                                        02670000
                  MOVE '2100-CHECK-VALID-CART-VEND' TO PV-PARA-NAME     02680000
                  PERFORM 9995-CSSL-LOG-RETURN                          02690000
                                                                        02700000
            END-EVALUATE                                                02710000
            .                                                           02720000
       2200-VALIDATE-INPUT-FIELDS.                                      02730000
                                                                        02740000
           IF SU137-OUTBOUND-TRIP-ID > 0                                02750000
                                                                        02760000
              MOVE SU137-OUTBOUND-TRIP-ID TO SUT00121-SCN-OTBND-TRIP-ID 02770000
                                                                        02780000
           ELSE                                                         02790000
                                                                        02800000
              MOVE PC-FAILURE       TO SU138-RESP-MSG                   02810000
              MOVE PC-TSYMSG-03778  TO PV-TSYMSG-NUMBER                 02820000
              MOVE 'OUTBOUND TRIP ID REQUIRED'  TO PV-ERROR-MSG         02820100
              MOVE '2200-VALIDATE-INPUT-FIELDS' TO PV-PARA-NAME         02820200
              PERFORM 9995-CSSL-LOG-RETURN                              02820300
                                                                        02820400
           END-IF.                                                      02820500
                                                                        02820600
           IF SU137-STORE-NBR > 0                                       02820700
                                                                        02820800
              MOVE SU137-STORE-NBR  TO SUT00121-SCN-LOC-NBR             02820900
                                                                        02821000
           ELSE                                                         02821100
                                                                        02821200
              MOVE PC-FAILURE                   TO SU138-RESP-MSG       02821300
              MOVE PC-TSYMSG-00380              TO PV-TSYMSG-NUMBER     02821400
              MOVE 'STORE NUMBER REQUIRED '     TO PV-ERROR-MSG         02821500
              MOVE '2200-VALIDATE-INPUT-FIELDS' TO PV-PARA-NAME         02821600
              PERFORM 9995-CSSL-LOG-RETURN                              02821700
                                                                        02821800
           END-IF.                                                      02821900
                                                                        02822000
                                                                        02823000
           IF SU137-USER-ID      > SPACES                               02824000
                                                                        02825000
              MOVE SU137-USER-ID   TO SUT00121-CRE-BY-USR-ID            02825100
                                                                        02825200
           ELSE                                                         02825300
                                                                        02825400
              MOVE PC-FAILURE                   TO SU138-RESP-MSG       02825500
              MOVE PC-TSYMSG-00007              TO PV-TSYMSG-NUMBER     02825600
              MOVE 'ASSOCIATE ID REQUIRED'      TO PV-ERROR-MSG         02825700
              MOVE '2200-VALIDATE-INPUT-FIELDS' TO PV-PARA-NAME         02825800
              PERFORM 9995-CSSL-LOG-RETURN                              02825900
                                                                        02826000
           END-IF.                                                      02826100
                                                                        02826200
           IF SU137-PARENT-SCAN-IND = 'Y'                               02826300
                                                                        02826400
              MOVE SU137-PARENT-SCAN-IND  TO SUT00121-SCN-FR-MSTR-IND   02826500
                                                                        02826600
           ELSE                                                         02826700
                                                                        02826800
              MOVE 'N'                    TO SUT00121-SCN-FR-MSTR-IND   02826900
                                                                        02827000
           END-IF.                                                      02828000
                                                                        02829000
       2300-FIND-SCAN-TYP-CDE.                                          02830000
                                                                        02831000
            PERFORM 2350-CHECK-ALREADY-SCANNED                          02832000
                                                                        02833000
            IF PS-ALREADY-SCANNED                                       02834000
                                                                        02834100
               MOVE 'SSMS'         TO SUT00121-SCN-TYP-CDE              02834200
                                                                        02834300
            ELSE                                                        02834400
                                                                        02834500
               PERFORM 2360-SELECT-TSUOBTS                              02834600
                                                                        02834700
               IF ((SUOBTS-TRIP-STAT-CDE = 'SU') AND                    02834800
               (SUOBTS-FINCL-POST-TMST NOT EQUAL                        02834900
                                        '9999-09-09-09.09.09.999999'))  02835000
                                                                        02835100
                  MOVE 'SSAU'      TO SUT00121-SCN-TYP-CDE              02835200
                                                                        02835300
               ELSE                                                     02835400
                                                                        02835500
                  IF SUT00024-DEST-LOC-NBR NOT EQUAL SU137-STORE-NBR    02835600
                                                                        02835700
                     MOVE 'SSSM'   TO SUT00121-SCN-TYP-CDE              02835800
                                                                        02835900
                  ELSE                                                  02836000
                                                                        02836100
                     IF PV-NULL-IND = 0                                 02836200
                                                                        02836300
                        IF SUT00024-OTBND-TRIP-ID =                     02836400
                                     SU137-OUTBOUND-TRIP-ID             02836500
                                                                        02836600
                           MOVE 'SSEC' TO SUT00121-SCN-TYP-CDE          02836700
                                                                        02836800
                        ELSE                                            02836900
                                                                        02837000
                           MOVE 'SSTM' TO SUT00121-SCN-TYP-CDE          02837100
                           MOVE SUT00024-OTBND-TRIP-ID TO               02837200
                                          SUT00121-ORIG-OTBND-TRIP-ID   02837300
                        END-IF                                          02837400
                                                                        02837500
                     ELSE                                               02837600
                                                                        02837700
                        MOVE DK-SHIPT-UNT-ID TO PC046-CARTON-ID         02837800
                                                                        02837900
                        PERFORM 8200-CALL-PCKUT713                      02838000
                                                                        02838100
                        IF PS-ERROR-YES                                 02838200
                                                                        02838300
                           MOVE 'SSNM'   TO SUT00121-SCN-TYP-CDE        02838400
                                                                        02838500
                        ELSE                                            02838600
                           IF PC046-OTBD-TRIP-ID > 0                    02838700
                                                                        02838800
                              IF PC046-TRIP-STATUS = 'DS' OR 'SO' OR    02838900
                                                     'SU'               02839000
                                                                        02839100
                                 IF PC046-OTBD-TRIP-ID =                02839200
                                     SU137-OUTBOUND-TRIP-ID             02839300
                                                                        02839400
                                    MOVE 'SSEC' TO SUT00121-SCN-TYP-CDE 02839500
                                                                        02839600
                                 ELSE                                   02839700
                                                                        02839800
                                    MOVE 'SSTM' TO SUT00121-SCN-TYP-CDE 02839900
                                    MOVE PC046-OTBD-TRIP-ID  TO         02840000
                                          SUT00121-ORIG-OTBND-TRIP-ID   02840100
                                                                        02840200
                                 END-IF                                 02840300
                              ELSE                                      02840400
                                                                        02840500
                                 MOVE 'SSNM' TO SUT00121-SCN-TYP-CDE    02840600
                                                                        02840700
                              END-IF                                    02840800
                           ELSE                                         02840900
                                                                        02841000
                              MOVE 'SSNM' TO SUT00121-SCN-TYP-CDE       02841100
                                                                        02841200
                           END-IF                                       02841300
                        END-IF                                          02841400
                     END-IF                                             02841500
                  END-IF                                                02841600
               END-IF                                                   02841700
            END-IF.                                                     02841800
       2350-CHECK-ALREADY-SCANNED.                                      02841900
                                                                        02842000
            MOVE 'N'               TO PS-ALREADY-SCANNED-SW             02842100
                                                                        02842200
            EXEC SQL                                                    02842300
                SELECT                                                  02842400
                        A.SHIPT_UNT_ID                                  02842500
                  INTO                                                  02842600
                        :SUT00121-SHIPT-UNT-ID                          02842700
                  FROM  SUT_OTBND_STR_SCN A                             02842800
                 WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              02842900
                   AND  A.ACTV_IND      = 'Y'                           02843000
                 FETCH FIRST 1 ROW ONLY                                 02843100
                WITH UR                                                 02843200
            END-EXEC.                                                   02843300
                                                                        02843400
            EVALUATE TRUE                                               02843500
               WHEN SQLCODE = ZERO                                      02843600
                                                                        02843700
                    MOVE 'Y'       TO  PS-ALREADY-SCANNED-SW            02843800
                                                                        02843900
               WHEN SQLCODE = 100                                       02844000
                                                                        02845000
                  CONTINUE                                              02845100
                                                                        02845200
               WHEN SQLCODE NOT = ZERO                                  02845300
                                                                        02845400
                  MOVE SQLCODE                 TO PV-SQLCODE            02845500
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02845600
                  MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02845700
                  STRING                                                02845800
                   'SELECT SUT_OTBND_STR_SCAN FAILED WITH SQLCODE:'     02845900
                         PV-SQLCODE ' SML#' PV-CARTON-DISP              02846000
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02846100
                                                                        02846200
                  MOVE '2350-CHECK-ALREADY-SCANNED' TO PV-PARA-NAME     02846300
                  PERFORM 9995-CSSL-LOG-RETURN                          02846400
                                                                        02846500
            END-EVALUATE                                                02846600
            .                                                           02846700
       2360-SELECT-TSUOBTS.                                             02846800
                                                                        02846900
            MOVE SU137-OUTBOUND-TRIP-ID TO DK-OTBND-TRIP-ID             02847000
                                           PV-TRIP-DISP.                02847100
            EXEC SQL                                                    02847200
                SELECT                                                  02847300
                        A.TRIP_STAT_CDE                                 02847400
                      , A.FINCL_POST_TMST                               02847500
                  INTO                                                  02847600
                        :SUOBTS-TRIP-STAT-CDE                           02847700
                      , :SUOBTS-FINCL-POST-TMST                         02847800
                  FROM  TSUOBTS A                                       02847900
                 WHERE  A.OTBND_TRIP_ID = :DK-OTBND-TRIP-ID             02848000
                   AND  A.OTBND_STAT_TMST IN                            02848100
                           (SELECT  MAX(B.OTBND_STAT_TMST)              02848200
                                      FROM  TSUOBTS B                   02848300
                     WHERE  B.OTBND_TRIP_ID = A.OTBND_TRIP_ID)          02848400
                WITH UR                                                 02848500
            END-EXEC.                                                   02848600
                                                                        02848700
            EVALUATE TRUE                                               02848800
               WHEN SQLCODE = ZERO                                      02848900
                                                                        02849000
                    CONTINUE                                            02849100
                                                                        02849200
               WHEN SQLCODE = 100                                       02849300
                                                                        02849400
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02849500
                  MOVE PC-TSYMSG-03053         TO PV-TSYMSG-NUMBER      02849600
                  STRING                                                02849700
                  'OUTBOUND TRIP ID NOT FOUND,INPUT TRIP:' PV-TRIP-DISP 02849800
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02849900
                                                                        02850000
                  MOVE '2360-SELECT-TSUOBTS' TO PV-PARA-NAME            02850100
                  PERFORM 9995-CSSL-LOG-RETURN                          02850200
                                                                        02850300
                                                                        02850400
               WHEN SQLCODE NOT = ZERO                                  02850500
                                                                        02850600
                  MOVE SQLCODE                 TO PV-SQLCODE            02850700
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02850800
                  MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02850900
                  STRING                                                02851000
                   'SELECT TSUOBTS FAILED WITH SQLCODE:'                02851100
                         PV-SQLCODE ' TRIP#' PV-TRIP-DISP               02851200
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02851300
                                                                        02851400
                  MOVE '2360-SELECT-TSUOBTS' TO PV-PARA-NAME            02851500
                  PERFORM 9995-CSSL-LOG-RETURN                          02851600
                                                                        02851700
            END-EVALUATE                                                02851800
            .                                                           02851900
       2400-INSERT-CARTON-SCAN.                                         02852000
                                                                        02852100
           MOVE 'Y'                TO SUT00121-ACTV-IND                 02852200
           MOVE 'N'                TO SUT00121-PRCD-IND                 02852300
                                                                        02852400
           IF SUT00121-ORIG-OTBND-TRIP-ID > 0                           02852500
                                                                        02852600
              CONTINUE                                                  02852700
                                                                        02852800
           ELSE                                                         02852900
                                                                        02853000
              MOVE -1                    TO PV-TRIP-NULL-IND            02853100
                                                                        02853200
           END-IF.                                                      02853300
                                                                        02853400
            EXEC SQL                                                    02853500
                INSERT INTO SUT_OTBND_STR_SCN                           02853600
                 ( SHIPT_UNT_ID                                         02853700
                  ,CRE_TMST                                             02853800
                  ,SCN_OTBND_TRIP_ID                                    02853900
                  ,SCN_LOC_NBR                                          02854000
                  ,SCN_TYP_CDE                                          02854100
                  ,CRE_BY_USR_ID                                        02854200
                  ,ACTV_IND                                             02854300
                  ,ORIG_OTBND_TRIP_ID                                   02854400
                  ,SCN_FR_MSTR_IND                                      02854500
                  ,PRCD_IND                                             02854600
                 )                                                      02854700
                VALUES                                                  02854800
                 ( :SUT00121-SHIPT-UNT-ID                               02854900
                 , CURRENT TIMESTAMP                                    02855000
                 , :SUT00121-SCN-OTBND-TRIP-ID                          02855100
                 , :SUT00121-SCN-LOC-NBR                                02855200
                 , :SUT00121-SCN-TYP-CDE                                02855300
                 , :SUT00121-CRE-BY-USR-ID                              02855400
                 , :SUT00121-ACTV-IND                                   02855500
                 , :SUT00121-ORIG-OTBND-TRIP-ID :PV-TRIP-NULL-IND       02855600
                 , :SUT00121-SCN-FR-MSTR-IND                            02855700
                 , :SUT00121-PRCD-IND                                   02855800
                 )                                                      02855900
            END-EXEC.                                                   02856000
                                                                        02856100
            EVALUATE TRUE                                               02856200
               WHEN SQLCODE = ZERO                                      02856300
                                                                        02856400
                  MOVE PC-SUCCESS              TO SU138-RESP-MSG        02856500
                  MOVE PC-TSYMSG-00059         TO PV-TSYMSG-NUMBER      02856600
                                                                        02856700
               WHEN SQLCODE NOT = ZERO                                  02856800
                                                                        02856900
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02857000
                  MOVE SQLCODE                 TO PV-SQLCODE            02857100
                  MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02857200
                  STRING                                                02857300
                   'INSERT SUT_OTBND_STR_SCAN FAILED WITH SQLCODE:'     02857400
                         PV-SQLCODE ' SML#' PV-CARTON-DISP              02857500
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02857600
                                                                        02857700
                  MOVE '2400-INSERT-CARTON-SCAN' TO PV-PARA-NAME        02857800
                  PERFORM 9995-CSSL-LOG-RETURN                          02857900
                                                                        02858000
            END-EVALUATE                                                02858100
            .                                                           02858200
       2500-UPDATE-TRIP-ID.                                             02858300
                                                                        02858400
           MOVE SUT00121-SCN-OTBND-TRIP-ID TO SUT00024-OTBND-TRIP-ID    02858500
            EXEC SQL                                                    02858600
                UPDATE SUT_OTBND_CART                                   02858700
                  SET  OTBND_TRIP_ID = :SUT00024-OTBND-TRIP-ID          02858800
                WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                 02858900
            END-EXEC.                                                   02859000
                                                                        02860000
            EVALUATE TRUE                                               02861000
               WHEN SQLCODE = ZERO                                      02862000
                                                                        02862100
                  CONTINUE                                              02862200
                                                                        02862300
               WHEN SQLCODE NOT = ZERO                                  02862400
                                                                        02862500
                  MOVE PC-FAILURE              TO SU138-RESP-MSG        02862600
                  MOVE SQLCODE                 TO PV-SQLCODE            02862700
                  MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02862800
                  STRING                                                02862900
                   'UPDATE SUT_OTBND_CART FAILED WITH SQLCODE:'         02863000
                         PV-SQLCODE ' SML#' PV-CARTON-DISP              02864000
                       DELIMITED BY SIZE INTO       PV-ERROR-MSG        02864100
                                                                        02864200
                  MOVE '2500-UPDATE-TRIP-ID' TO PV-PARA-NAME            02864300
                  PERFORM 9995-CSSL-LOG-RETURN                          02864400
                                                                        02864500
            END-EVALUATE                                                02864600
            .                                                           02864700
       8200-CALL-PCKUT713.                                              02864800
                                                                        02864900
           CALL PC046-CARTON-STATUS-MODULE                              02865000
                   USING DFHEIBLK                                       02865100
                   PC046-COMMAREA                                       02865200
                   PC046-COMMAREA-REC                                   02865300
           END-CALL.                                                    02865400
                                                                        02865500
           EVALUATE TRUE                                                02865600
           WHEN PC046-SUCCESSFUL                                        02865700
               CONTINUE                                                 02865800
           WHEN OTHER                                                   02865900
               SET PS-ERROR-YES             TO TRUE                     02866000
           END-EVALUATE.                                                02866100
                                                                        02866200
       9990-CSSL-LOG.                                                   02866300
                                                                        02866400
            MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     02866500
                                                                        02866600
            EXEC CICS                                                   02866700
                 WRITEQ TD                                              02866800
                  QUEUE   ('CSSL')                                      02866900
                   FROM   (PV-CICS-MSG-AREA)                            02867000
                   NOHANDLE                                             02867100
            END-EXEC.                                                   02867200
                                                                        02867300
           .                                                            02867400
       9995-CSSL-LOG-RETURN.                                            02867500
                                                                        02867600
           PERFORM 9990-CSSL-LOG.                                       02867700
                                                                        02867800
           PERFORM 9000-RETURN-TRAN.                                    02867900
                                                                        02868000
       9000-RETURN-TRAN.                                                02868100
                                                                        02868200
           MOVE PV-TSYMSG-NUMBER         TO DP507I-MSG-NUMBER           02868300
                                            SU138-MSG-ID.               02868400
                                                                        02868500
           PERFORM 9010-READ-SYSTEM-MESSAGE.                            02868600
           MOVE DP507I-MSG-TEXT          TO SU138-ERROR-TEXT            02868700
           MOVE SU138-OUT-PROCESS-CARTON TO DFHCOMMAREA.                02868800
                                                                        02868900
           EXEC CICS RETURN END-EXEC                                    02869000
           .                                                            02869100
       9010-READ-SYSTEM-MESSAGE.                                        02869200
           EXEC CICS READ                                               02869300
                     DATASET ('DPSYSMSG')                               02869400
                     RIDFLD  (DP507I-MSG-NUMBER)                        02869500
                     INTO    (DP507I-MESSAGES-INPUT-RECORD)             02869600
                     RESP    (PV-CICS-RESPONSE)                         02869700
           END-EXEC.                                                    02869800
      *                                                                 02869900
           IF  PV-CICS-RESPONSE NOT = 0                                 02870000
               MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 02880000
                                      TO DP507I-MSG-TEXT                02890000
           END-IF.                                                      02900000
                                                                        02910000
