000010******************************************************************00001009
000100 IDENTIFICATION DIVISION.                                         00010006
000110******************************************************************00011009
000200                                                                  00020006
000300 PROGRAM-ID.             PCKRF868.                                00030006
000400 AUTHOR.                 PATRICK BURKE.                           00040006
000500 INSTALLATION.           KOHLS.                                   00050006
000600 DATE-WRITTEN            FEBRUARY, 2000.                          00060006
000700 DATE-COMPILED.                                                   00070006
000800                                                                  00080006
000900******************************************************************00090006
001000* THIS PROGRAM DISPLAYS THE SHIPPING SUB-MENU ON THE              00100008
001100* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM    00110006
001200* WHICH PROCESSES THE SELECTED FUNCTION.                          00120006
001300******************************************************************00130006
001400                                                                  00140006
001500 ENVIRONMENT DIVISION.                                            00150006
001600 DATA DIVISION.                                                   00160006
001700                                                                  00170006
001800 WORKING-STORAGE SECTION.                                         00180006
001900* INBOUND COMMAREA FROM MPKCS027                                  00190006
002000*    COPY MPWS026.                                                00200024
002010 01  CA-COMMAREA.                                                 00201024
002020     05  CA-COMMON-DATA.                                          00202024
002030         10  CA-TRANSACTION-STATUS                                00203024
002040                                         PIC  X(01)  VALUE SPACE. 00204024
002050             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00205024
002060             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00206024
002070         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00207024
002080     05  CA-PROGRAM-DATA.                                         00208024
002090         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACE. 00209024
002091             88  CA-SELECTION-TEST                   VALUE 'T'.   00209124
002092         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00209224
002093                                         PIC  9(01).              00209324
002094             88  CA-VALID-SELECTION                  VALUE        00209424
002095                 1 2 3 4.                                         00209527
002096             88  CA-SELECTION-ONE                    VALUE 1.     00209624
002097             88  CA-SELECTION-TWO                    VALUE 2.     00209724
002098             88  CA-SELECTION-THREE                  VALUE 3.     00209824
002099             88  CA-SELECTION-FOUR                   VALUE 4.     00209924
002100             88  CA-SELECTION-FIVE                   VALUE 5.     00210024
002101             88  CA-SELECTION-SIX                    VALUE 6.     00210124
002110                                                                  00211006
002200* OUTBOUND COMMAREA                                               00220006
002210***  CA-COMMAREA.                                                 00221014
002300     COPY PCWS038.                                                00230012
002400                                                                  00240006
002500* HELP SCREEN COMMAREA                                            00250006
002600     COPY PCWS192.                                                00260006
002700* HELP SCREEN WORK AREA                                           00270006
002800     COPY PCWS188.                                                00280006
002900/                                                                 00290006
003000 01  PC-PROGRAM-CONSTANTS.                                        00300006
003100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00310006
003200         'PCKRF868'.                                              00320006
003300     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00330006
003400         'MPKCS027'.                                              00340006
003410     05  PC-CNKRF230                     PIC  X(08)  VALUE        00341015
003420         'CNKRF230'.                                              00342015
003500     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E868'.00350006
003600     05  PC-CARTON-STATUS-TRAN-E880      PIC  X(04)  VALUE 'E880'.00360006
003700     05  PC-MANAGE-TRLR-TRAN-E869        PIC  X(04)  VALUE 'E869'.00370006
003900     05  PC-TRAILER-AUDIT-TRAN-E891      PIC  X(04)  VALUE 'E891'.00390017
003910     05  PC-CRTN-DIVERT-TRAN-E887        PIC  X(04)  VALUE 'E887'.00391027
004000                                                                  00400006
004100     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00410006
004200         'END OF SESSION     '.                                   00420006
004300     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00430006
004400         'INVALID SELECTION  '.                                   00440006
004500     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00450006
004600         'UNRECOGNIZED PF KEY'.                                   00460006
004700     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00470006
004800         'USER NOT AUTHORIZED'.                                   00480006
004900     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00490006
005000         'NUMERIC VALUE REQ. '.                                   00500006
005100     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00510006
005200         'F3 =END            '.                                   00520006
005300     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00530006
005400         'TRANS NOT AVAILABLE'.                                   00540006
005500     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00550006
005600         'CICS ABEND -CALL DP'.                                   00560006
005700     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00570006
005800         'CICSAUTH BAD RETURN'.                                   00580006
005900     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00590006
006000         'SELECTION NOT AVAIL'.                                   00600006
006100                                                                  00610006
006200                                                                  00620006
006300 01  PN-PGM-NAME-DATA.                                            00630006
006400     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00640006
006500         'PCKRF880'.                                              00650006
006600     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00660006
006700         'PCKRF869'.                                              00670006
007000     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00700025
007100         'PCKRF891'.                                              00710017
007110     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00711029
007120         'PCKRF887'.                                              00712029
007200                                                                  00720006
007300 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00730006
007400     05  PN-PGM-NAME  OCCURS 4 TIMES                              00740029
007500                      INDEXED BY PN-INDX                          00750006
007600                                         PIC  X(08).              00760006
007700                                                                  00770006
007800 01  PS-PROGRAM-SWITCHES.                                         00780006
007900     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00790006
008000         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00800006
008100         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00810006
008200                                                                  00820006
008300                                                                  00830006
008400 01  PV-PROGRAM-VARIABLES.                                        00840006
008500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +300   00850006
008600                                                     COMP.        00860006
008700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00870006
008800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00880006
008900                                                     COMP SYNC.   00890006
009000     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00900006
009100                                                                  00910006
009200     COPY DPWS026.                                                00920006
009300                                                                  00930006
009400*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00940006
009500     COPY DPWS013.                                                00950006
009600                                                                  00960006
009700*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00970006
009800     COPY DPWS008.                                                00980006
009900                                                                  00990006
010000*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01000006
010100     COPY DPWS010I.                                               01010006
010200                                                                  01020006
010300*  MAPSET                                                         01030006
010400     COPY PCKM868.                                                01040006
010500                                                                  01050006
010600*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01060006
010700     COPY DPWS015.                                                01070006
010800                                                                  01080006
010900     COPY DFHAID.                                                 01090006
011000                                                                  01100006
011100 LINKAGE SECTION.                                                 01110006
011200 01  DFHCOMMAREA.                                                 01120006
011300     05  FILLER                       OCCURS 1 TO 4072 TIMES      01130006
011400                                      DEPENDING ON EIBCALEN.      01140006
011500         10  FILLER                   PIC X.                      01150006
011600/                                                                 01160006
011610******************************************************************01161010
011700 PROCEDURE DIVISION.                                              01170006
011710******************************************************************01171010
011800 0000-PROGRAM-MAINLINE.                                           01180006
011900     INITIALIZE                         CA-COMMAREA.              01190024
012000     MOVE DFHCOMMAREA                TO CA-COMMAREA.              01200024
012100     MOVE LOW-VALUES                 TO PC868AI.                  01210006
012200                                                                  01220006
012300     EVALUATE TRUE                                                01230006
012400         WHEN EIBCALEN = ZERO                                     01240006
012500         WHEN EIBTRNID = 'Z278'                                   01250006
012600         WHEN EIBAID = DFHCLEAR                                   01260006
012700         WHEN CA-INITIALIZE-SCREEN                                01270024
012800              INITIALIZE CA-COMMAREA                              01280024
012900*             MOVE PC-PROGRAM-FUNCTION-KEYS                       01290006
013000*                                    TO AMSGLNO                   01300006
013100              PERFORM 8000-SEND-MAP                               01310006
013200              PERFORM 8200-RETURN-TRANID                          01320006
013300         WHEN EIBAID = DFHENTER                                   01330006
013400              PERFORM 1000-RECEIVE-MAP                            01340006
013500              PERFORM 1100-EDIT-SELECTION                         01350006
013600         WHEN EIBAID = DFHPF3                                     01360006
013700              MOVE PC-DC-RF-APPL-PGM TO PV-TRANSFER-PROGRAM       01370006
013800              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01380006
013900         WHEN EIBAID = DFHPF1                                     01390006
014000              PERFORM 1200-HELP-SCREEN                            01400006
014100         WHEN OTHER                                               01410006
014200              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01420006
014300                                     TO AMSGLNO                   01430006
014400              PERFORM 8100-SEND-DATA-ONLY                         01440006
014500              PERFORM 8200-RETURN-TRANID                          01450006
014600     END-EVALUATE.                                                01460006
014700                                                                  01470006
014800     GOBACK.                                                      01480006
014900*                                                                 01490006
015000*                                                                 01500006
015100 1000-RECEIVE-MAP.                                                01510006
015200     EXEC CICS                                                    01520006
015300         RECEIVE MAP    ('PC868A')                                01530006
015400                 MAPSET ('PCKM868')                               01540006
015500                 RESP   (PV-CICS-RESPONSE)                        01550006
015600     END-EXEC.                                                    01560006
015700                                                                  01570006
015800     EVALUATE TRUE                                                01580006
015900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 01590006
016000              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  01600006
016100         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                01610006
016200              CONTINUE                                            01620006
016300         WHEN OTHER                                               01630006
016400              MOVE '1000-RECEIVE-MAP'                             01640006
016500                                     TO DP013-PARAGRAPH           01650006
016600              MOVE 'UNABLE TO RECEIVE MAP'                        01660006
016700                                     TO DP013-MESSAGE-TEXT (1)    01670006
016800              SET DP013-LOGIC-ABEND  TO TRUE                      01680006
016900              SET DP013-NO-ROLLBACK  TO TRUE                      01690006
017000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              01700006
017100     END-EVALUATE.                                                01710006
017200*                                                                 01720006
017300*                                                                 01730006
017400 1010-RECEIVE-SCREEN-FIELDS.                                      01740006
017500     IF  ASELECTL > ZERO                                          01750006
017600         MOVE ASELECTI               TO CA-SELECTION-X            01760024
017700     END-IF.                                                      01770006
017800*                                                                 01780006
017900*                                                                 01790006
018000 1100-EDIT-SELECTION.                                             01800006
018100                                                                  01810006
018110**    TEST MODE OR DIVERT PROCESSING   ***                        01811015
018200     IF  CA-SELECTION-TEST OR                                     01820024
018201         CA-SELECTION-X = 'D'                                     01820124
018300         CONTINUE                                                 01830006
018400     ELSE                                                         01840006
018500         MOVE CA-SELECTION-X         TO DP010I-UNEDITED-FIELD     01850024
018600         MOVE 1                      TO DP010I-MAXIMUM-DIGITS     01860006
018700         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   01870006
018800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  01880006
018900                                                                  01890006
019010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         01901030
019020                         USING DP010I-NUMERIC-EDIT-AREA           01902030
019100                                                                  01910006
019200         IF  DP010I-ERROR-DETECTED                                01920006
019300             MOVE PC-NON-NUMERIC-SELECTION-MSG TO AMSGLNO         01930006
019400             PERFORM 8100-SEND-DATA-ONLY                          01940006
019500             PERFORM 8200-RETURN-TRANID                           01950006
019600         ELSE                                                     01960006
019700             MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION          01970024
019800         END-IF                                                   01980006
019900     END-IF.                                                      01990006
020000                                                                  02000006
020100     EVALUATE TRUE                                                02010006
020300     WHEN CA-SELECTION-X = '1' OR '2' OR '3' OR '4' OR 'D'        02030028
020400         PERFORM 2000-PROCESS-SELECTION                           02040006
020500     WHEN OTHER                                                   02050006
020600         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02060006
020700         MOVE PC-INVALID-SELECTION-MSG                            02070006
020800                                     TO AMSGLNO                   02080006
020900         PERFORM 8100-SEND-DATA-ONLY                              02090006
021000         PERFORM 8200-RETURN-TRANID                               02100006
021100     END-EVALUATE.                                                02110006
021200                                                                  02120006
021300 1200-HELP-SCREEN.                                                02130006
021400     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02140006
021500     MOVE 'PCKRF868'                  TO PC192-PROGRAM-NAME       02150006
021600     COPY PCPD188.                                                02160006
021700     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02170006
021800     PERFORM 2200-XCTL-TO-HELP.                                   02180006
021900                                                                  02190006
022000*                                                                 02200006
022100 2000-PROCESS-SELECTION.                                          02210006
022200     SET PN-INDX                     TO CA-SELECTION.             02220024
022300     IF CA-SELECTION NUMERIC AND                                  02230024
022310        CA-SELECTION < 5                                          02231029
022400         PERFORM 9000-CHECK-RACF                                  02240023
022500     ELSE                                                         02250023
022600     IF  CA-SELECTION-TEST                                        02260024
022800         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02280023
022900     ELSE                                                         02290006
022910         IF CA-SELECTION-X = 'D'                                  02291024
023000             MOVE PC-CNKRF230            TO PV-TRANSFER-PROGRAM   02300015
023100             PERFORM 2150-XCTL-WITHOUT-COMMAREA                   02310016
023102         ELSE                                                     02310215
023110             MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM   02311015
023120             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02312015
023200         END-IF                                                   02320015
023300     END-IF.                                                      02330006
023400                                                                  02340006
023500     IF  PS-ACCESS-ALLOWED                                        02350006
023600         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02360006
023700         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02370006
023800     ELSE                                                         02380006
023900         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02390006
024000         PERFORM 8100-SEND-DATA-ONLY                              02400006
024100         PERFORM 8200-RETURN-TRANID                               02410006
024200     END-IF.                                                      02420006
024300*                                                                 02430006
024400*                                                                 02440006
024500 2100-XCTL-TO-SELECTED-PROGRAM.                                   02450006
024600                                                                  02460006
024700     INITIALIZE PC038-COMMON-DATA.                                02470012
024800     SET PC038-INITIALIZE-SCREEN     TO TRUE.                     02480012
024900     MOVE PC-CURRENT-PROGRAM-NAME    TO PC038-LAST-PROGRAM        02490019
024910                                        PC038-CALLED-PGM-NME.     02491020
025000     PERFORM DP026-0000-GET-LOGON-INFO.                           02500006
025100                                                                  02510012
025500     MOVE DP026-QUEUE-TERM            TO PC038-TERM-ID            02550012
025600                                                                  02560006
025700                                                                  02570006
025800     MOVE LENGTH OF PC038-COMMON-DATA TO PV-COMMAREA-LENGTH       02580012
025900                                                                  02590006
026000     EXEC CICS                                                    02600006
026100         XCTL                                                     02610006
026200             PROGRAM   (PV-TRANSFER-PROGRAM)                      02620006
026300             COMMAREA  (PC038-COMMON-DATA)                        02630012
026400             LENGTH    (PV-COMMAREA-LENGTH)                       02640006
026500             RESP      (PV-CICS-RESPONSE)                         02650006
026600     END-EXEC.                                                    02660006
026700                                                                  02670006
026800     EVALUATE TRUE                                                02680006
026900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02690006
027000              CONTINUE                                            02700006
027100         WHEN OTHER                                               02710006
027200              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                02720006
027300                                     TO DP013-PARAGRAPH           02730006
027400              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02740006
027500                                     TO DP013-MESSAGE-TEXT (1)    02750006
027600              MOVE PV-TRANSFER-PROGRAM                            02760006
027700                                     TO DP013-MESSAGE-TEXT (2)    02770006
027800              SET DP013-CICS-ABEND   TO TRUE                      02780006
027900              SET DP013-NO-ROLLBACK  TO TRUE                      02790006
028000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02800006
028100              MOVE PC-TRANS-UNAVAILABLE-MSG                       02810006
028200                                     TO AMSGLNO                   02820006
028300              SET CA-PROCESS-SCREEN TO TRUE                       02830024
028400              PERFORM 8100-SEND-DATA-ONLY                         02840006
028500              PERFORM 8200-RETURN-TRANID                          02850006
028600     END-EVALUATE.                                                02860006
028700                                                                  02870006
028710 2150-XCTL-WITHOUT-COMMAREA.                                      02871016
028720                                                                  02872016
028730     INITIALIZE PC038-COMMON-DATA.                                02873016
028793                                                                  02879316
028794     MOVE ZERO          TO PV-COMMAREA-LENGTH                     02879416
028795                                                                  02879516
028796     EXEC CICS                                                    02879616
028797         XCTL                                                     02879716
028798             PROGRAM   (PV-TRANSFER-PROGRAM)                      02879816
028799             COMMAREA  (PC038-COMMON-DATA)                        02879916
028800             LENGTH    (PV-COMMAREA-LENGTH)                       02880016
028805     END-EXEC.                                                    02880516
028806                                                                  02880616
028807     EVALUATE TRUE                                                02880716
028808         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02880816
028809              CONTINUE                                            02880916
028810         WHEN OTHER                                               02881016
028811              MOVE '2150-XCTL-WITHOUT-COMMAREA'                   02881116
028812                                     TO DP013-PARAGRAPH           02881216
028813              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02881316
028814                                     TO DP013-MESSAGE-TEXT (1)    02881416
028815              MOVE PV-TRANSFER-PROGRAM                            02881516
028816                                     TO DP013-MESSAGE-TEXT (2)    02881616
028817              SET DP013-CICS-ABEND   TO TRUE                      02881716
028818              SET DP013-NO-ROLLBACK  TO TRUE                      02881816
028819              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02881916
028820              MOVE PC-TRANS-UNAVAILABLE-MSG                       02882016
028821                                     TO AMSGLNO                   02882116
028822              SET CA-PROCESS-SCREEN TO TRUE                       02882224
028823              PERFORM 8100-SEND-DATA-ONLY                         02882316
028824              PERFORM 8200-RETURN-TRANID                          02882416
028825     END-EVALUATE.                                                02882516
028826                                                                  02882616
028830     COPY DPPD026.                                                02883016
028900*                                                                 02890006
029000 2200-XCTL-TO-HELP.                                               02900006
029100                                                                  02910006
029200     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       02920006
029300                                                                  02930006
029400     EXEC CICS                                                    02940006
029500         XCTL                                                     02950006
029600             PROGRAM   (PV-TRANSFER-PROGRAM)                      02960006
029700             COMMAREA  (PC192-COMMAREA)                           02970006
029800             LENGTH    (PV-COMMAREA-LENGTH)                       02980006
029900             RESP      (PV-CICS-RESPONSE)                         02990006
030000     END-EXEC.                                                    03000006
030100                                                                  03010006
030200     EVALUATE TRUE                                                03020006
030300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03030006
030400              CONTINUE                                            03040006
030500         WHEN OTHER                                               03050006
030600              MOVE '2200-XCTL-TO-HELP'                            03060006
030700                                     TO DP013-PARAGRAPH           03070006
030800              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03080006
030900                                     TO DP013-MESSAGE-TEXT (1)    03090006
031000              MOVE PV-TRANSFER-PROGRAM                            03100006
031100                                     TO DP013-MESSAGE-TEXT (2)    03110006
031200              SET DP013-CICS-ABEND   TO TRUE                      03120006
031300              SET DP013-NO-ROLLBACK  TO TRUE                      03130006
031400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03140006
031500              MOVE PC-TRANS-UNAVAILABLE-MSG                       03150006
031600                                     TO AMSGLNO                   03160006
031700              SET CA-PROCESS-SCREEN TO TRUE                       03170024
031800              PERFORM 8100-SEND-DATA-ONLY                         03180006
031900              PERFORM 8200-RETURN-TRANID                          03190006
032000     END-EVALUATE.                                                03200006
032100/                                                                 03210006
032200 8000-SEND-MAP.                                                   03220006
032300     EXEC CICS                                                    03230006
032400         SEND MAP       ('PC868A')                                03240006
032500              MAPSET    ('PCKM868')                               03250006
032600              ERASE                                               03260006
032700              RESP      (PV-CICS-RESPONSE)                        03270006
032800     END-EXEC.                                                    03280006
032900                                                                  03290006
033000     EVALUATE TRUE                                                03300006
033100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03310006
033200              CONTINUE                                            03320006
033300         WHEN OTHER                                               03330006
033400              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           03340006
033500              MOVE 'UNABLE TO SEND MAP'                           03350006
033600                                     TO DP013-MESSAGE-TEXT (1)    03360006
033700              SET DP013-CICS-ABEND   TO TRUE                      03370006
033800              SET DP013-NO-ROLLBACK  TO TRUE                      03380006
033900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03390006
034000     END-EVALUATE.                                                03400006
034100*                                                                 03410006
034200*                                                                 03420006
034300 8100-SEND-DATA-ONLY.                                             03430006
034400     MOVE -1 TO ASELECTL.                                         03440006
034500                                                                  03450006
034600     EXEC CICS                                                    03460006
034700         SEND MAP       ('PC868A')                                03470006
034800              MAPSET    ('PCKM868')                               03480006
034900              CURSOR                                              03490006
035000              DATAONLY                                            03500006
035100              RESP      (PV-CICS-RESPONSE)                        03510006
035200     END-EXEC.                                                    03520006
035300                                                                  03530006
035400     EVALUATE TRUE                                                03540006
035500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03550006
035600              CONTINUE                                            03560006
035700         WHEN OTHER                                               03570006
035800              MOVE '8100-SEND-DATA-ONLY'                          03580006
035900                                     TO DP013-PARAGRAPH           03590006
036000              MOVE 'UNABLE TO SEND DATA'                          03600006
036100                                     TO DP013-MESSAGE-TEXT (1)    03610006
036200              SET DP013-CICS-ABEND   TO TRUE                      03620006
036300              SET DP013-NO-ROLLBACK  TO TRUE                      03630006
036400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03640006
036500     END-EVALUATE.                                                03650006
036600*                                                                 03660006
036700*                                                                 03670006
036800 8200-RETURN-TRANID.                                              03680006
036900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       03690024
037000     EXEC CICS                                                    03700006
037100         RETURN TRANSID   (PC-MENU-TRANID)                        03710006
037200                COMMAREA  (CA-COMMAREA)                           03720024
037300                LENGTH    (PV-COMMAREA-LENGTH)                    03730006
037400                RESP      (PV-CICS-RESPONSE)                      03740006
037500     END-EXEC.                                                    03750006
037600                                                                  03760006
037700     EVALUATE TRUE                                                03770006
037800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03780006
037900              CONTINUE                                            03790006
038000         WHEN OTHER                                               03800006
038100              MOVE '8200-RETURN-TRANID'                           03810006
038200                                     TO DP013-PARAGRAPH           03820006
038300              MOVE 'UNABLE TO RETURN TO TRANID'                   03830006
038400                                     TO DP013-MESSAGE-TEXT (1)    03840006
038500              SET DP013-CICS-ABEND   TO TRUE                      03850006
038600              SET DP013-NO-ROLLBACK  TO TRUE                      03860006
038700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03870006
038800     END-EVALUATE.                                                03880006
038900*                                                                 03890006
039800*                                                                 03980006
039900 9000-CHECK-RACF.                                                 03990006
040000******************************************************************04000006
040100*  CHECK ACCESSS AUTHORITY OF USER                                04010006
040200******************************************************************04020006
040300     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04030006
040400     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04040006
040500                                                                  04050006
040600     EVALUATE TRUE                                                04060006
040700         WHEN CA-SELECTION-ONE                                    04070024
040800              MOVE PC-CARTON-STATUS-TRAN-E880                     04080006
040900                                      TO DP008-RESOURCE-NAME      04090006
041000         WHEN CA-SELECTION-TWO                                    04100024
041100              MOVE PC-MANAGE-TRLR-TRAN-E869                       04110006
041200                                      TO DP008-RESOURCE-NAME      04120006
041600         WHEN CA-SELECTION-THREE                                  04160025
041700              MOVE PC-TRAILER-AUDIT-TRAN-E891                     04170017
041800                                      TO DP008-RESOURCE-NAME      04180017
041810         WHEN CA-SELECTION-FOUR                                   04181027
041820              MOVE PC-CRTN-DIVERT-TRAN-E887                       04182027
041830                                      TO DP008-RESOURCE-NAME      04183027
041900     END-EVALUATE.                                                04190006
042000                                                                  04200006
042100     EXEC CICS                                                    04210006
042200          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04220006
042300               COMMAREA (DP008-SECURITY-COMMAREA)                 04230006
042400               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04240006
042500               RESP     (PV-CICS-RESPONSE)                        04250006
042600     END-EXEC.                                                    04260006
042700                                                                  04270006
042800     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04280006
042900         IF  DP008-CALL-SUCCESSFUL                                04290006
043000             IF  DP008-ACCESS-ALLOWED                             04300006
043100                 SET PS-ACCESS-ALLOWED                            04310006
043200                                     TO TRUE                      04320006
043300             ELSE                                                 04330006
043400                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04340006
043500                                     TO AMSGLNO                   04350006
043600             END-IF                                               04360006
043700         ELSE                                                     04370006
043800             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04380006
043900         END-IF                                                   04390006
044000     ELSE                                                         04400006
044100         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04410006
044200         MOVE 'BAD LINK TO RACF PROGRAM'                          04420006
044300                                     TO DP013-MESSAGE-TEXT (1)    04430006
044400         SET DP013-CICS-ABEND        TO TRUE                      04440006
044500         SET DP013-NO-ROLLBACK       TO TRUE                      04450006
044600         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04460006
044700     END-IF.                                                      04470006
044800*                                                                 04480006
044900*                                                                 04490006
045000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04500006
045100     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04510006
045200     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04520006
045300     INITIALIZE DP013-SRC-TASK-NUMBER                             04530006
045400                DP013-STACK.                                      04540006
045500     SET DP013-LINK-RETURN           TO TRUE.                     04550006
045600                                                                  04560006
045700     EXEC CICS                                                    04570006
045800         LINK                                                     04580006
045900             PROGRAM   (DP013-NAME)                               04590006
046000             COMMAREA  (DP013-PARAMETERS)                         04600006
046100             LENGTH    (DP013-LENGTH)                             04610006
046200     END-EXEC.                                                    04620006
