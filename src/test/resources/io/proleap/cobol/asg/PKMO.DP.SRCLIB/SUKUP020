000100 IDENTIFICATION DIVISION.                                                 
000200                                                                          
000300* UTILITY PROGRAM TO BE USED TO INACTIVATE SCAN ON RECORDS                
000400* WHEN THERE IS A LATER DIVERT                                            
000500* WILL BE PART OF SUK015 JOB                                              
000600*                                                                         
000700 PROGRAM-ID.             SUKUP020.                                        
000800 AUTHOR.                 DENNIS STEFFEN.                                  
000900 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
001000 DATE-WRITTEN            MARCH 2005.                                      
001100 DATE-COMPILED.                                                           
001200                                                                          
001300 ENVIRONMENT DIVISION.                                                    
001400 CONFIGURATION SECTION.                                                   
001500 SOURCE-COMPUTER.        IBM-3090.                                        
001600 OBJECT-COMPUTER.        IBM-3090.                                        
001700 INPUT-OUTPUT SECTION.                                                    
001800 FILE-CONTROL.                                                            
001900                                                                          
002000     SELECT UPDATE-EXTRACT-FILE                                           
002100         ASSIGN TO INP01.                                                 
002200                                                                          
002300 DATA DIVISION.                                                           
002400 FILE SECTION.                                                            
002500                                                                          
002600 FD  UPDATE-EXTRACT-FILE                                                  
002700     RECORDING MODE IS F                                                  
002800     LABEL RECORDS ARE STANDARD                                           
002900     RECORD CONTAINS 100 CHARACTERS                                       
003000     BLOCK CONTAINS 0  RECORDS.                                           
003100 01  UPDATE-EXTRACT-REC               PIC X(100).                         
003200                                                                          
003300 WORKING-STORAGE SECTION.                                                 
003400 01  PS-SWITCHES.                                                         
003500     05  PS-EOF-EXTRACT-SW            PIC X(01) VALUE 'N'.                
003600         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.                
003700                                                                          
003800 01  CRAPOLA.                                                             
003900     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.                      
004000     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO               
004100                                                 COMP SYNC.               
004200         88  ABEND-4013-DB2-ERROR                VALUE +4013.             
004300     05  PV-EXTRACT-COUNT             PIC S9(05) COMP-3                   
004400                                          VALUE ZERO.                     
004500     05  PV-INSERT-COUNT              PIC S9(05) COMP-3                   
004600                                          VALUE ZERO.                     
004700     05  PV-UPDATE-COUNT              PIC S9(05) COMP-3                   
004800                                          VALUE ZERO.                     
004900     05  PV-RETRY-COUNTER             PIC S9(03) COMP-3                   
005000                                        VALUE 3.                          
005100     05  PC-MAX-RETRIES               PIC S9(03) COMP-3                   
005200                                        VALUE 3.                          
005300     05  PV-ABEND-PARAGRAPH           PIC X(35) VALUE SPACES.             
005400                                                                          
005500 01  PV-DISP-KEY-MSG.                                                     
005600     05  FILLER                      PIC X(07) VALUE                      
005700         ' CTN= '.                                                        
005800     05  PV-KEY-SHIPT-UNT-ID         PIC 9(18) VALUE ZEROES.              
005900     05  FILLER                      PIC X(12) VALUE                      
006000         '; CRE-TMST= '.                                                  
006100     05  PV-KEY-CRE-TMST             PIC X(26) VALUE ZEROES.              
006200     05  FILLER                      PIC X(08) VALUE                      
006300         '; TRIP= '.                                                      
006400     05  PV-KEY-TRIP-ID              PIC 9(09) VALUE ZEROES.              
006500     05  FILLER                      PIC X(07) VALUE                      
006600         '; LOC= '.                                                       
006700     05  PV-KEY-LOC                  PIC 9(04) VALUE ZEROES.              
006800     05  FILLER                      PIC X(07) VALUE                      
006900         '; SCN= '.                                                       
007000     05  PV-KEY-SCAN-CDE             PIC X(04) VALUE ZEROES.              
007100     05  FILLER                      PIC X(07) VALUE                      
007200         '; ACTV='.                                                       
007300     05  PV-KEY-ACTV-CDE             PIC X(01) VALUE ZEROES.              
007400                                                                          
007500/                                                                         
007600     COPY SURD057.                                                        
007700/                                                                         
007800     EXEC SQL                                                             
007900         INCLUDE SUT00027                                                 
008000     END-EXEC.                                                            
008100                                                                          
008200     EXEC SQL                                                             
008300         INCLUDE SQLCA                                                    
008400     END-EXEC.                                                            
008500                                                                          
008600     COPY SQLCA2.                                                         
008700     COPY DPWS004.                                                        
008800 EJECT                                                                    
008900/                                                                         
009000 PROCEDURE DIVISION.                                                      
009100     PERFORM 1000-INITIALIZE.                                             
009200     PERFORM 2000-PROCESS                                                 
009300             UNTIL PS-EOF-EXTRACT-YES                                     
009400     PERFORM 9000-EOJ.                                                    
009500                                                                          
009600     GOBACK.                                                              
009700                                                                          
009800 1000-INITIALIZE.                                                         
009900                                                                          
010000     OPEN INPUT UPDATE-EXTRACT-FILE                                       
010100                                                                          
010200     PERFORM 8000-READ-EXTRACT-FILE                                       
010300     IF PS-EOF-EXTRACT-YES                                                
010400         DISPLAY ' SUKUP020 - INPUT FILE IS EMPTY '                       
010500     END-IF.                                                              
010600                                                                          
010700 2000-PROCESS.                                                            
010800                                                                          
010900     PERFORM 2100-INACT-SCAN-ON-ROW                                       
011000     IF SQLCODE = ZERO                                                    
011100         PERFORM 2200-INSERT-SHOF-ROW                                     
011200     END-IF                                                               
011300                                                                          
011400     PERFORM 8000-READ-EXTRACT-FILE.                                      
011500                                                                          
011600 2100-INACT-SCAN-ON-ROW.                                                  
011700     MOVE SU057-SHIPT-UNT-ID          TO SUT00027-SHIPT-UNT-ID            
011800                                         PV-KEY-SHIPT-UNT-ID              
011900     MOVE SU057-CRE-TMST              TO SUT00027-CRE-TMST                
012000                                         PV-KEY-CRE-TMST                  
012100     MOVE SU057-OTBND-TRIP-ID         TO SUT00027-OTBND-TRIP-ID           
012200                                         PV-KEY-TRIP-ID                   
012300     MOVE SU057-LOC-NBR               TO SUT00027-LOC-NBR                 
012400                                         PV-KEY-LOC                       
012500     MOVE SU057-SCAN-CDE              TO SUT00027-SCN-CDE                 
012600                                         PV-KEY-SCAN-CDE                  
012700     MOVE SU057-ACTIVE-CDE            TO SUT00027-ACTV-CDE                
012800                                         PV-KEY-ACTV-CDE                  
012900                                                                          
013000                                                                          
013100     PERFORM 7000-UPDATE-LOC.                                             
013200                                                                          
013300                                                                          
013400                                                                          
013500 2200-INSERT-SHOF-ROW.                                                    
013600     MOVE SU057-SHIPT-UNT-ID          TO SUT00027-SHIPT-UNT-ID            
013700                                         PV-KEY-SHIPT-UNT-ID              
013800     MOVE SU057-SCAN-OFF-TMST         TO SUT00027-CRE-TMST                
013900                                         PV-KEY-CRE-TMST                  
014000     MOVE SU057-OTBND-TRIP-ID         TO SUT00027-OTBND-TRIP-ID           
014100                                         PV-KEY-TRIP-ID                   
014200     MOVE SU057-LOC-NBR               TO SUT00027-LOC-NBR                 
014300                                         PV-KEY-LOC                       
014400     MOVE 'SHOF'                      TO SUT00027-SCN-CDE                 
014500                                         PV-KEY-SCAN-CDE                  
014600     MOVE 'I'                         TO SUT00027-ACTV-CDE                
014700                                         PV-KEY-ACTV-CDE                  
014800                                                                          
014900     PERFORM 7100-INSERT-SHOF.                                            
015000                                                                          
015100                                                                          
015200 7000-UPDATE-LOC.                                                         
015300                                                                          
015400     MOVE '7000-UPDATE-LOC'           TO PV-ABEND-PARAGRAPH               
015500     PERFORM                                                              
015600         WITH TEST AFTER                                                  
015700         VARYING PV-RETRY-COUNTER                                         
015800         FROM 1 BY 1                                                      
015900               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 
016000                  OR  (SQLCODE = +100)                                    
016100                  OR  (SQLCODE = +0))                                     
016101                                                                          
016250                                                                          
016300     EXEC SQL                                                             
016400         UPDATE SUT_OTBND_LOC                                             
016500             SET ACTV_CDE = 'I'                                           
016600         WHERE                                                            
016700             SHIPT_UNT_ID             = :SUT00027-SHIPT-UNT-ID            
016800         AND CRE_TMST                 = :SUT00027-CRE-TMST                
016900         AND OTBND_TRIP_ID            = :SUT00027-OTBND-TRIP-ID           
017000         AND LOC_NBR                  = :SUT00027-LOC-NBR                 
017100         AND SCN_CDE                  = :SUT00027-SCN-CDE                 
017200         AND ACTV_CDE                 = :SUT00027-ACTV-CDE                
017300     END-EXEC                                                             
017400                                                                          
017500     EVALUATE TRUE                                                        
017600         WHEN SQLCODE = ZERO                                              
017700             ADD 1                    TO PV-UPDATE-COUNT                  
017800         WHEN SQLCODE = +100                                              
017900             CONTINUE                                                     
018000         WHEN SQLCODE = -904                                              
018100         WHEN SQLCODE = -911                                              
018200         WHEN SQLCODE = -913                                              
018300             CONTINUE                                                     
018400                                                                          
018500         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                          
018600             DISPLAY '**************************************'             
018700             DISPLAY 'WARNING ISSUED '                                    
018800             DISPLAY 'UPDATE ACTV_CDE                       '             
018900             DISPLAY  PV-DISP-KEY-MSG                                     
019000             DISPLAY '**************************************'             
019100             PERFORM 9800-SQL-WARNING                                     
019200                                                                          
019300         WHEN SQLCODE < ZERO                                              
019400             DISPLAY '**************************************'             
019500             DISPLAY 'ERROR ISSUED ON                       '             
019600             DISPLAY 'UPDATE ACTV_CDE                       '             
019700             DISPLAY PV-DISP-KEY-MSG                                      
019800             DISPLAY '**************************************'             
019900             PERFORM 9900-SQL-ERROR                                       
020000         END-EVALUATE                                                     
020100     END-PERFORM.                                                         
020200                                                                          
020300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
020400         SQLCODE NOT = ZERO                                               
020500         DISPLAY '**************************************'                 
020600         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
020700         DISPLAY 'UPDATE SUT_OTBND_LOC'                                   
020800         DISPLAY PV-DISP-KEY-MSG                                          
020900         DISPLAY '**************************************'                 
021000         PERFORM 9900-SQL-ERROR                                           
021100     END-IF.                                                              
021200                                                                          
021300 7100-INSERT-SHOF.                                                        
021400     MOVE '7100-INSERT-SHOF'          TO PV-ABEND-PARAGRAPH               
021500     PERFORM                                                              
021600         WITH TEST AFTER                                                  
021700         VARYING PV-RETRY-COUNTER                                         
021800         FROM 1 BY 1                                                      
021900               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 
022000                  OR  (SQLCODE = -803)                                    
022100                  OR  (SQLCODE = +0))                                     
022200                                                                          
022296                                                                          
022300     EXEC SQL                                                             
022400         INSERT INTO SUT_OTBND_LOC                                        
022500         (                                                                
022600             SHIPT_UNT_ID                                                 
022700            ,CRE_TMST                                                     
022800            ,OTBND_TRIP_ID                                                
022900            ,LOC_NBR                                                      
023000            ,SCN_CDE                                                      
023100            ,CRE_USR_ID                                                   
023200            ,ACTV_CDE                                                     
023300            ,INBD_TRIP_ID                                                 
023400         )                                                                
023500             VALUES                                                       
023600         (                                                                
023700             :SUT00027-SHIPT-UNT-ID                                       
023800         ,   :SUT00027-CRE-TMST                                           
023900         ,   :SUT00027-OTBND-TRIP-ID                                      
024000         ,   :SUT00027-LOC-NBR                                            
024100         ,   'SHOF'                                                       
024200         ,   'DIVERT'                                                     
024300         ,   'I'                                                          
024400         ,   0                                                            
024500         )                                                                
024600     END-EXEC                                                             
024700                                                                          
024800     EVALUATE TRUE                                                        
024900         WHEN SQLCODE = ZERO                                              
025000             ADD 1                    TO PV-INSERT-COUNT                  
025100         WHEN SQLCODE = -803                                              
025200             CONTINUE                                                     
025300         WHEN SQLCODE = -904                                              
025400         WHEN SQLCODE = -911                                              
025500         WHEN SQLCODE = -913                                              
025600             CONTINUE                                                     
025700                                                                          
025800         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                          
025900             DISPLAY '**************************************'             
026000             DISPLAY 'WARNING ISSUED '                                    
026100             DISPLAY 'INSERT CARTON LOC                     '             
026200             DISPLAY  PV-DISP-KEY-MSG                                     
026300             DISPLAY '**************************************'             
026400             PERFORM 9800-SQL-WARNING                                     
026500                                                                          
026600         WHEN SQLCODE < ZERO                                              
026700             DISPLAY '**************************************'             
026800             DISPLAY 'ERROR ISSUED ON                       '             
026900             DISPLAY 'INSERT CARTON LOC'                                  
027000             DISPLAY PV-DISP-KEY-MSG                                      
027100             DISPLAY '**************************************'             
027200             PERFORM 9900-SQL-ERROR                                       
027300         END-EVALUATE                                                     
027400     END-PERFORM.                                                         
027500                                                                          
027600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
027700         SQLCODE NOT = ZERO                                               
027800         DISPLAY '**************************************'                 
027900         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
028000         DISPLAY 'INSERT CARTON LOC'                                      
028100         DISPLAY PV-DISP-KEY-MSG                                          
028200         DISPLAY '**************************************'                 
028300         PERFORM 9900-SQL-ERROR                                           
028400     END-IF.                                                              
028500                                                                          
028600 8000-READ-EXTRACT-FILE.                                                  
028700                                                                          
028800     READ UPDATE-EXTRACT-FILE                                             
028900         INTO SU057-EXTRACT-RECORD                                        
029000     AT END                                                               
029100         SET PS-EOF-EXTRACT-YES       TO TRUE                             
029200     NOT AT END                                                           
029300         ADD 1                        TO PV-EXTRACT-COUNT                 
029400     END-READ.                                                            
029500                                                                          
029600 9000-EOJ.                                                                
029700     CLOSE      UPDATE-EXTRACT-FILE                                       
029800                                                                          
029900     DISPLAY SPACES.                                                      
030000     DISPLAY ' SUKUP020'                                                  
030100     DISPLAY SPACES.                                                      
030200     MOVE PV-EXTRACT-COUNT            TO PV-DISP-NBR                      
030300     DISPLAY 'UPDATE EXTRACTS READ     = ' PV-DISP-NBR.                   
030400     MOVE PV-UPDATE-COUNT             TO PV-DISP-NBR                      
030500     DISPLAY 'ROWS UPDATED             = ' PV-DISP-NBR.                   
030600     MOVE PV-INSERT-COUNT             TO PV-DISP-NBR                      
030700     DISPLAY 'ROWS INSERTED            = ' PV-DISP-NBR.                   
030800                                                                          
030900 9800-SQL-WARNING.                                                        
031000                                                                          
031100     MOVE SQLCODE               TO SQLCODE2.                              
031200     MOVE SQLERRD(3)            TO SQLERRD3.                              
031300     DISPLAY '** ABEND **       ** = SQLWARNING'.                         
031400     DISPLAY '** PROGRAM        ** = SUKUP020'.                           
031500     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.                
031600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
031700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
031800                                                                          
031900     COPY DPPD004.                                                        
032000     SET ABEND-4013-DB2-ERROR   TO TRUE                                   
032100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
032200                                                                          
032300 9900-SQL-ERROR.                                                          
032400                                                                          
032500     MOVE SQLCODE               TO SQLCODE2.                              
032600     MOVE SQLERRD(3)            TO SQLERRD3.                              
032700     DISPLAY '** ABEND **       ** = SQLERROR'.                           
032800     DISPLAY '** PROGRAM        ** = SUKUP020'.                           
032900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.                
033000                                                                          
033100     COPY DPPD004.                                                        
033200     SET ABEND-4013-DB2-ERROR   TO TRUE                                   
033300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
