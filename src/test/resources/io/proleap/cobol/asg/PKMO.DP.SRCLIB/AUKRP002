000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300 PROGRAM-ID.             AUKRP002.                                00030001
000400 AUTHOR.                 BARB ERTL.                               00040001
000500 INSTALLATION.           KOHLS.                                   00050001
000600 DATE-WRITTEN            FEBRUARY 2008.                           00060001
000700 DATE-COMPILED.                                                   00070001
000800                                                                  00080001
000900******************************************************************00090001
001000*  BLACKHAWK RECONCILIATION REPORTING                            *00100001
001100******************************************************************00110001
001200 ENVIRONMENT DIVISION.                                            00120001
001300 CONFIGURATION SECTION.                                           00130001
001400                                                                  00140001
001500 SOURCE-COMPUTER.        IBM-3090.                                00150001
001600 OBJECT-COMPUTER.        IBM-3090.                                00160001
001700                                                                  00170001
001800 INPUT-OUTPUT SECTION.                                            00180001
001900                                                                  00190001
002000 FILE-CONTROL.                                                    00200001
002100     SELECT DATE-CARD-FILE                                        00210001
002200         ASSIGN TO INP01.                                         00220001
002300                                                                  00230001
002400     SELECT REPORT-FILE-IN                                        00240001
002500         ASSIGN TO INP02.                                         00250001
002600                                                                  00260001
002700     SELECT INVOICE-REPORT                                        00270002
002800         ASSIGN TO RPT01.                                         00280001
002900                                                                  00290001
003000******************************************************************00300001
003100 DATA DIVISION.                                                   00310001
003200 FILE SECTION.                                                    00320001
003300                                                                  00330001
003400 FD  DATE-CARD-FILE                                               00340001
003500     RECORDING MODE IS F                                          00350001
003600     BLOCK CONTAINS 0 RECORDS                                     00360001
003700     LABEL RECORDS ARE STANDARD.                                  00370001
003800                                                                  00380001
003900 01  DATE-CARD-RECORD                       PIC X(80).            00390001
004000                                                                  00400001
004100 FD  REPORT-FILE-IN                                               00410001
004200     RECORDING MODE IS F                                          00420001
004300     BLOCK CONTAINS 0 RECORDS                                     00430001
004400     LABEL RECORDS ARE STANDARD.                                  00440001
004500                                                                  00450001
004600 01  REPORT-RECORD                          PIC X(80).            00460004
004700                                                                  00470001
004800 FD  INVOICE-REPORT                                               00480002
004900     RECORDING MODE IS F                                          00490001
005000     BLOCK CONTAINS 0 RECORDS                                     00500001
005100     LABEL RECORDS ARE STANDARD.                                  00510001
005200                                                                  00520001
005300 01  INVOICE-RECORD                         PIC X(132).           00530002
005400                                                                  00540001
005500******************************************************************00550001
005600 WORKING-STORAGE SECTION.                                         00560001
005700******************************************************************00570001
005800                                                                  00580001
005900******************************************************************00590001
006000*  BLACKHAWK REPORT RECORD LAYOUT                                *00600001
006100******************************************************************00610001
006200     COPY AURD016.                                                00620001
006300                                                                  00630001
006400******************************************************************00640001
006500*  KOHL'S STANDARD REPORT HEADING                                *00650001
006600******************************************************************00660001
006700     COPY DPWS132.                                                00670001
006800                                                                  00680001
006900 01  RP1-HEADING-LINE-2.                                          00690001
007000     05  FILLER                       PIC  X(40)  VALUE SPACES.   00700001
007100     05  FILLER                       PIC  X(41)  VALUE           00710001
007200                   'BLACKHAWK INVOICE REPORT FOR WEEK ENDING '.   00720001
007300     05  RP1-DATE.                                                00730001
007400         10  RP1-DATE-MM              PIC  X(02).                 00740001
007500         10  FILLER                   PIC  X(01)  VALUE '/'.      00750001
007600         10  RP1-DATE-DD              PIC  X(02).                 00760001
007700         10  FILLER                   PIC  X(01)  VALUE '/'.      00770001
007800         10  RP1-DATE-CC              PIC  X(02).                 00780001
007900         10  RP1-DATE-YY              PIC  X(02).                 00790001
008000     05  FILLER                       PIC  X(41)  VALUE SPACES.   00800001
008100                                                                  00810001
008200 01  RP1-HEADING-LINE-3.                                          00820001
008300     05  FILLER                       PIC  X(07)  VALUE SPACES.   00830001
008400     05  FILLER                       PIC  X(03)  VALUE 'UPC'.    00840001
008500     05  FILLER                       PIC  X(08)  VALUE SPACES.   00850001
008600     05  FILLER                       PIC  X(11)  VALUE           00860001
008700                                               'DESCRIPTION'.     00870001
008800     05  FILLER                       PIC  X(20)  VALUE SPACES.   00880001
008900     05  FILLER                       PIC  X(08)  VALUE           00890001
009000                                               'QUANTITY'.        00900001
009100     05  FILLER                       PIC  X(03)  VALUE SPACES.   00910006
009200     05  FILLER                       PIC  X(05)  VALUE 'PRICE'.  00920001
009300     05  FILLER                       PIC  X(07)  VALUE SPACES.   00930001
009400     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 00940001
009500     05  FILLER                       PIC  X(03)  VALUE SPACES.   00950001
009600     05  FILLER                       PIC  X(10)  VALUE           00960001
009700                                          'COMMISSION'.           00970001
009800     05  FILLER                       PIC  X(03)  VALUE SPACES.   00980001
009900     05  FILLER                       PIC  X(10)  VALUE           00990001
010000                                          'NET AMOUNT'.           01000001
010100     05  FILLER                       PIC  X(29)  VALUE SPACES.   01010001
010200                                                                  01020001
010300 01  RP1-DETAIL-LINE.                                             01030001
010400     05  FILLER                       PIC  X(01)  VALUE SPACE.    01040001
010500     05  RP1-UPC                      PIC  Z(15)  VALUE ZERO.     01050001
010600     05  FILLER                       PIC  X(02)  VALUE SPACES.   01060001
010700     05  RP1-DESCRIPTION              PIC  X(30)  VALUE SPACES.   01070001
010800     05  FILLER                       PIC  X(02)  VALUE SPACES.   01080001
010900     05  RP1-QTY                      PIC  ZZZ,ZZ9 VALUE ZERO.    01090001
011000     05  FILLER                       PIC  X(02)  VALUE SPACES.   01100001
011100     05  RP1-PRICE                    PIC  Z99.99- VALUE ZERO.    01110001
011200     05  FILLER                       PIC  X(02)  VALUE SPACES.   01120001
011300     05  RP1-AMOUNT                   PIC  ZZZ,ZZZ.99- VALUE ZERO.01130001
011400     05  FILLER                       PIC  X(02)  VALUE SPACES.   01140001
011500     05  RP1-COMMISSION               PIC  ZZZ,ZZZ.99- VALUE ZERO.01150001
011600     05  FILLER                       PIC  X(02)  VALUE SPACES.   01160001
011700     05  RP1-NET-AMT                  PIC  ZZZ,ZZZ.99- VALUE ZERO.01170001
011800     05  FILLER                       PIC  X(28)  VALUE SPACES.   01180001
011900                                                                  01190001
012000 01  RPT-TOTAL-LINE-1.                                            01200001
012100     05  FILLER                       PIC  X(01)  VALUE SPACE.    01210001
012200     05  FILLER                       PIC  X(06)  VALUE 'TOTALS'. 01220001
012300     05  FILLER                       PIC  X(61)  VALUE SPACES.   01230001
012400     05  T1-TOTAL-AMT                 PIC  ZZZ,ZZZ.99- VALUE ZERO.01240001
012500     05  FILLER                       PIC  X(02)  VALUE SPACES.   01250001
012600     05  T1-TOTAL-COMMISSION          PIC  ZZZ,ZZZ.99- VALUE ZERO.01260001
012700     05  FILLER                       PIC  X(02)  VALUE SPACES.   01270001
012800     05  T1-TOTAL-NET                 PIC  ZZZ,ZZZ.99- VALUE ZERO.01280001
012900     05  FILLER                       PIC  X(28)  VALUE SPACES.   01290001
013000                                                                  01300001
013100 01  END-OF-REPORT-LINE.                                          01310001
013200     05  FILLER                       PIC  X(51)  VALUE SPACE.    01320001
013300     05  FILLER                       PIC  X(29)  VALUE           01330001
013400         '*****   END OF REPORT   *****'.                         01340001
013500     05  FILLER                       PIC  X(52)  VALUE SPACE.    01350001
013600                                                                  01360001
013700 01  PC-PROGRAM-CONSTANTS.                                        01370001
013800     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE           01380001
013900                                                    'AUKRP002'.   01390001
014000     05  PC-LINES-PER-PAGE            PIC S9(04)  VALUE +60       01400001
014100                                                     COMP SYNC.   01410001
014200                                                                  01420001
014300 01  PS-PROGRAM-SWITCHES.                                         01430001
014400     05  PS-END-OF-REPORT-FILE-SW     PIC X(01)   VALUE 'N'.      01440001
014500         88  PS-END-OF-REPORT-FILE                VALUE 'Y'.      01450001
014600     05  PS-END-OF-CARD-FILE-SW       PIC X(01)   VALUE 'N'.      01460001
014700         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01470001
014800                                                                  01480001
014900 01  PV-PROGRAM-VARIABLES.                                        01490001
015000     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACE.    01500001
015100     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACE.    01510001
015200     05  PV-DB2-OPERATION             PIC  X(30)  VALUE SPACE.    01520001
015300     05  PV-SUB                       PIC S9(04)  VALUE +0 COMP.  01530001
015400     05  PV-PAGE-COUNT                PIC S9(04)  VALUE +0 COMP.  01540001
015500     05  PV-LINE-COUNT                PIC S9(04)  VALUE +0 COMP.  01550001
015600     05  PV-SAVE-UPC                  PIC S9(15) COMP-3 VALUE 0.  01560001
015700     05  PV-SAVE-AMOUNT               PIC S9(07)V99 COMP-3        01570001
015800                                                        VALUE 0.  01580001
015900     05  PV-SAVE-COMMISSION           PIC S9(07)V99 COMP-3        01590001
016000                                                        VALUE 0.  01600001
016100                                                                  01610001
016200 01  PA-PROGRAM-ACCUMULATORS.                                     01620001
016300     05  PA-QUANTITY                 PIC S9(06)     COMP-3        01630002
016400                                                        VALUE 0.  01640001
016500     05  PA-AMOUNT                   PIC S9(07)V99  COMP-3        01650002
016600                                                        VALUE 0.  01660002
016700     05  PA-COMMISSION               PIC S9(07)V99  COMP-3        01670001
016800                                                        VALUE 0.  01680001
016900     05  PA-NET-AMOUNT               PIC S9(07)V99  COMP-3        01690001
017000                                                        VALUE 0.  01700001
017100     05  PA-TOTAL-AMOUNT             PIC S9(07)V99  COMP-3        01710001
017200                                                        VALUE 0.  01720001
017300     05  PA-TOTAL-COMMISSION         PIC S9(07)V99  COMP-3        01730001
017400                                                        VALUE 0.  01740001
017500     05  PA-TOTAL-NET-AMOUNT         PIC S9(07)V99  COMP-3        01750001
017600                                                        VALUE 0.  01760001
017700                                                                  01770001
017800******************************************************************01780001
017900* RECORD LAYOUT FOR INPUT DATE CARD                               01790001
018000******************************************************************01800001
018100 01  CC-CONTROL-CARD.                                             01810001
018200     05  CC-DATE-CCYY-MM-DD.                                      01820001
018300         10  CC-CONTROL-DATE-CC       PIC  X(02)   VALUE SPACES.  01830001
018400         10  CC-CONTROL-DATE-YY       PIC  X(02)   VALUE SPACES.  01840001
018500         10  FILLER                   PIC  X(01)   VALUE SPACES.  01850001
018600         10  CC-CONTROL-DATE-MM       PIC  X(02)   VALUE SPACES.  01860001
018700         10  FILLER                   PIC  X(01)   VALUE SPACES.  01870001
018800         10  CC-CONTROL-DATE-DD       PIC  X(02)   VALUE SPACES.  01880001
018900      05  FILLER                      PIC  X(70)   VALUE SPACES.  01890001
019000                                                                  01900001
019100 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01910001
019200                                                 COMP SYNC.       01920001
019300     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01930001
019400     88  AC-DB2-ERROR                            VALUE +4013.     01940002
019500     88  AC-DATE-ERROR                           VALUE +4019.     01950001
019600                                                                  01960001
019700 01  SD-SYSTEM-DATE.                                              01970001
019800     05  SD-SYSTEM-YEAR               PIC  9(02)  VALUE ZEROS.    01980001
019900     05  SD-SYSTEM-MONTH              PIC  9(02)  VALUE ZEROS.    01990001
020000     05  SD-SYSTEM-DAY                PIC  9(02)  VALUE ZEROS.    02000001
020100                                                                  02010001
020200 01  ST-SYSTEM-TIME.                                              02020001
020300     05  ST-SYSTEM-HOUR               PIC  9(02)  VALUE ZEROS.    02030001
020400     05  ST-SYSTEM-MINUTE             PIC  9(02)  VALUE ZEROS.    02040001
020500     05  FILLER                       PIC  9(04)  VALUE ZEROS.    02050001
020600                                                                  02060001
020700******************************************************************02070001
020800* DATE ROUTINE COPY MEMBERS                                       02080001
020900******************************************************************02090001
021000     COPY DPWS500.                                                02100001
021100                                                                  02110001
021200******************************************************************02120002
021300*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *02130002
021400******************************************************************02140002
021500     COPY DPWS004.                                                02150002
021600                                                                  02160002
021700******************************************************************02170002
021800*    XS UPC TABLE                                                *02180002
021900******************************************************************02190002
022000     EXEC SQL                                                     02200002
022100         INCLUDE XST00012                                         02210002
022200     END-EXEC.                                                    02220002
022300                                                                  02230002
022400******************************************************************02240002
022500*    XS SKU TABLE                                                *02250002
022600******************************************************************02260002
022700     EXEC SQL                                                     02270002
022800         INCLUDE XST00010                                         02280002
022900     END-EXEC.                                                    02290002
023000                                                                  02300002
023100******************************************************************02310002
023200*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *02320002
023300******************************************************************02330002
023400     EXEC SQL                                                     02340002
023500         INCLUDE SQLCA                                            02350002
023600     END-EXEC.                                                    02360002
023700                                                                  02370002
023800     COPY SQLCA2.                                                 02380002
023900                                                                  02390002
024000******************************************************************02400007
024100*    CURSOR DECLARATION FOR POS DESC LOOKUP                      *02410007
024200******************************************************************02420007
024300     EXEC SQL                                                     02430007
024400         DECLARE  POS-DESC-CSR CURSOR FOR                         02440007
024500         SELECT SKU_DESC                                          02450007
024600           FROM XST_UPC A                                         02460007
024700               ,XST_SKU B                                         02470007
024800          WHERE A.INTR_UPC_ID = B.INTR_UPC_ID                     02480007
024900            AND UPC_NBR = :PV-SAVE-UPC                            02490007
025000           WITH UR                                                02500007
025100     END-EXEC.                                                    02510007
025200                                                                  02520007
025300******************************************************************02530001
025400 PROCEDURE DIVISION.                                              02540001
025500******************************************************************02550001
025600 0000-PROGRAM-MAINLINE.                                           02560001
025700                                                                  02570001
025800     PERFORM 1000-INITIALIZE.                                     02580001
025900                                                                  02590001
026000     PERFORM 2000-PROCESS-REPORT-FILE                             02600001
026100       UNTIL PS-END-OF-REPORT-FILE.                               02610001
026200                                                                  02620001
026300     PERFORM 3000-EOJ-ROUTINE.                                    02630002
026400                                                                  02640001
026500     STOP RUN.                                                    02650001
026600                                                                  02660001
026700******************************************************************02670001
026800*  1000-INITIALIZE                                                02680001
026900******************************************************************02690001
027000 1000-INITIALIZE.                                                 02700001
027100                                                                  02710001
027200     OPEN INPUT  DATE-CARD-FILE                                   02720001
027300                 REPORT-FILE-IN                                   02730001
027400          OUTPUT INVOICE-REPORT.                                  02740002
027500                                                                  02750001
027600     ACCEPT SD-SYSTEM-DATE  FROM DATE.                            02760001
027700     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            02770001
027800                                                                  02780001
027900     MOVE SD-SYSTEM-MONTH          TO  DP132-RUN-MONTH.           02790001
028000     MOVE SD-SYSTEM-DAY            TO  DP132-RUN-DAY.             02800001
028100     MOVE SD-SYSTEM-YEAR           TO  DP132-RUN-YEAR.            02810001
028200     MOVE ST-SYSTEM-HOUR           TO  DP132-RUN-HOUR.            02820001
028300     MOVE ST-SYSTEM-MINUTE         TO  DP132-RUN-MINUTE.          02830001
028400                                                                  02840001
028500     MOVE PC-PROGRAM-NAME  TO  DP132-PROGRAM-NAME.                02850001
028600                                                                  02860001
028700     PERFORM 1400-PROCESS-CONTROL-CARD.                           02870001
028800                                                                  02880001
028900     PERFORM 5000-INVOICE-REPORT-HEADER.                          02890002
029000                                                                  02900001
029100     PERFORM 7000-READ-REPORT-FILE.                               02910001
029200                                                                  02920001
029300     IF PS-END-OF-REPORT-FILE                                     02930001
029400         DISPLAY 'NO RECORDS TO PROCESS'                          02940001
029500     ELSE                                                         02950002
029600         MOVE AU016-UPC-NBR         TO PV-SAVE-UPC                02960002
029700         MOVE AU016-TRANSACTION-AMT TO PV-SAVE-AMOUNT             02970002
029800         MOVE AU016-COMMISSION-AMT  TO PV-SAVE-COMMISSION         02980002
029900     END-IF.                                                      02990001
030000                                                                  03000001
030100***************************************************************** 03010001
030200* 1400-PROCESS-CONTROL-CARD                                       03020001
030300* READ DATE CONTROL CARD FOR END-OF-WEEK DATE.                    03030002
030400* CALL DATE ROUTINE TO VALIDATE DATE.                             03040002
030500***************************************************************** 03050001
030600 1400-PROCESS-CONTROL-CARD.                                       03060001
030700                                                                  03070001
030800     PERFORM 1410-READ-DATE-CARD-FILE.                            03080001
030900                                                                  03090001
031000     IF PS-END-OF-CARD-FILE                                       03100001
031100         MOVE '1400-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   03110001
031200         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  03120001
031300         SET AC-CONTROL-CARD-ERROR TO TRUE                        03130001
031400         PERFORM 9999-ABEND                                       03140001
031500     END-IF.                                                      03150001
031600                                                                  03160001
031700     PERFORM 1420-DATE-ROUTINE.                                   03170002
031800                                                                  03180001
031900     MOVE CC-CONTROL-DATE-CC       TO RP1-DATE-CC.                03190001
032000     MOVE CC-CONTROL-DATE-YY       TO RP1-DATE-YY.                03200001
032100     MOVE CC-CONTROL-DATE-MM       TO RP1-DATE-MM.                03210001
032200     MOVE CC-CONTROL-DATE-DD       TO RP1-DATE-DD.                03220001
032300                                                                  03230001
032400     DISPLAY 'AUKRP002 CONTROL CARD DATE: '                       03240001
032500                          CC-CONTROL-CARD.                        03250001
032600                                                                  03260001
032700******************************************************************03270001
032800* 1410-READ-DATE-CARD-FILE                                        03280001
032900******************************************************************03290001
033000 1410-READ-DATE-CARD-FILE.                                        03300001
033100                                                                  03310001
033200     READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     03320001
033300       AT END                                                     03330001
033400           SET PS-END-OF-CARD-FILE TO TRUE.                       03340001
033500                                                                  03350001
033600******************************************************************03360002
033700*     1420-DATE-ROUTINE.                                         *03370002
033800* ==> PROCESSES:                                                 *03380002
033900*     -VALIDATES THE DATE INPUT ON THE CONTROL FILE              *03390002
034000* ==> PERFORMED FROM: B100-INITIALIZE                            *03400002
034100******************************************************************03410002
034200 1420-DATE-ROUTINE.                                               03420002
034300                                                                  03430002
034400     INITIALIZE DPG51 DPG52 DPG53                                 03440002
034500                DPG54 DPG55 DPG56.                                03450002
034600                                                                  03460002
034700     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     03470002
034800                                                                  03480002
034900     MOVE CC-DATE-CCYY-MM-DD        TO DPG52-LK-DATE-INPUT.       03490002
035000     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      03500002
035100                                                                  03510002
035200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03520002
035300       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 03530002
035400                                                                  03540002
035500     EVALUATE TRUE                                                03550002
035600         WHEN DPG54-SEVERE-ERROR                                  03560002
035700         WHEN DPG54-DATE-INVALID                                  03570002
035800             SET AC-DATE-ERROR TO TRUE                            03580002
035900             PERFORM 9999-ABEND                                   03590002
036000     END-EVALUATE.                                                03600002
036100                                                                  03610002
036200******************************************************************03620001
036300* 2000-PROCESS-REPORT-FILE                                       *03630001
036400******************************************************************03640001
036500 2000-PROCESS-REPORT-FILE.                                        03650001
036600                                                                  03660001
036700     IF AU016-UPC-NBR = PV-SAVE-UPC                               03670002
036800         ADD +1 TO PA-QUANTITY                                    03680002
036900     ELSE                                                         03690001
037000         PERFORM 4000-PRINT-UPC                                   03700002
037100         MOVE +1                    TO PA-QUANTITY                03710002
037200         MOVE 0                     TO PA-AMOUNT                  03720002
037300                                       PA-COMMISSION              03730002
037400                                       PA-NET-AMOUNT              03740002
037500         MOVE AU016-UPC-NBR         TO PV-SAVE-UPC                03750002
037600         MOVE AU016-TRANSACTION-AMT TO PV-SAVE-AMOUNT             03760002
037700         MOVE AU016-COMMISSION-AMT  TO PV-SAVE-COMMISSION         03770002
037800     END-IF.                                                      03780001
037900                                                                  03790001
038000     PERFORM 7000-READ-REPORT-FILE.                               03800001
038100                                                                  03810001
038200******************************************************************03820002
038300* 3000-EOJ-ROUTINE.                                              *03830002
038400******************************************************************03840002
038500 3000-EOJ-ROUTINE.                                                03850002
038600                                                                  03860002
038700     IF PV-SAVE-UPC > 0                                           03870005
038800         PERFORM 4000-PRINT-UPC                                   03880005
038900         PERFORM 4100-WRITE-TOTAL-LINE                            03890005
039000     END-IF.                                                      03900005
039100                                                                  03910002
039200     CLOSE DATE-CARD-FILE                                         03920002
039300           REPORT-FILE-IN                                         03930002
039400           INVOICE-REPORT.                                        03940003
039500                                                                  03950002
039600******************************************************************03960002
039700* 4000-PRINT-UPC                                                 *03970002
039800******************************************************************03980002
039900 4000-PRINT-UPC.                                                  03990002
040000                                                                  04000002
040100     COMPUTE PA-AMOUNT     = PA-QUANTITY * PV-SAVE-AMOUNT.        04010002
040200     COMPUTE PA-COMMISSION = PA-QUANTITY * PV-SAVE-COMMISSION.    04020002
040300     COMPUTE PA-NET-AMOUNT = PA-AMOUNT - PA-COMMISSION.           04030002
040400                                                                  04040002
040500     PERFORM 7100-GET-SKU-DESCRIPTION.                            04050002
040600                                                                  04060002
040700     ADD PA-AMOUNT              TO PA-TOTAL-AMOUNT.               04070002
040800     ADD PA-COMMISSION          TO PA-TOTAL-COMMISSION.           04080002
040900     ADD PA-NET-AMOUNT          TO PA-TOTAL-NET-AMOUNT.           04090002
041000                                                                  04100002
041100     MOVE PV-SAVE-UPC           TO RP1-UPC.                       04110002
041200     MOVE XST00010-SKU-DESC     TO RP1-DESCRIPTION.               04120002
041300     MOVE PA-QUANTITY           TO RP1-QTY.                       04130002
041400     MOVE PV-SAVE-AMOUNT        TO RP1-PRICE.                     04140002
041500     MOVE PA-AMOUNT             TO RP1-AMOUNT.                    04150002
041600     MOVE PA-COMMISSION         TO RP1-COMMISSION.                04160002
041700     MOVE PA-NET-AMOUNT         TO RP1-NET-AMT.                   04170002
041800                                                                  04180002
041900     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         04190002
042000         PERFORM 5000-INVOICE-REPORT-HEADER                       04200002
042100     END-IF.                                                      04210002
042200                                                                  04220002
042300     WRITE INVOICE-RECORD FROM RP1-DETAIL-LINE AFTER              04230002
042400            ADVANCING 1 LINE                                      04240002
042500     ADD +1 TO PV-LINE-COUNT.                                     04250002
042600                                                                  04260002
042700******************************************************************04270002
042800* 4100-WRITE-TOTAL-LINE                                          *04280002
042900******************************************************************04290002
043000 4100-WRITE-TOTAL-LINE.                                           04300002
043100                                                                  04310002
043200     MOVE PA-TOTAL-AMOUNT      TO T1-TOTAL-AMT.                   04320002
043300     MOVE PA-TOTAL-COMMISSION  TO T1-TOTAL-COMMISSION.            04330003
043400     MOVE PA-TOTAL-NET-AMOUNT  TO T1-TOTAL-NET.                   04340003
043500                                                                  04350002
043600     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         04360002
043700         PERFORM 5000-INVOICE-REPORT-HEADER                       04370002
043800     END-IF.                                                      04380002
043900                                                                  04390002
044000     WRITE INVOICE-RECORD FROM RPT-TOTAL-LINE-1                   04400002
044100           AFTER ADVANCING 2 LINES.                               04410002
044200                                                                  04420002
044300     WRITE INVOICE-RECORD FROM END-OF-REPORT-LINE                 04430002
044400           AFTER ADVANCING 2 LINES.                               04440002
044500                                                                  04450002
044600******************************************************************04460001
044700* 5000-INVOICE-REPORT-HEADER                                     *04470002
044800******************************************************************04480001
044900 5000-INVOICE-REPORT-HEADER.                                      04490002
045000                                                                  04500001
045100     MOVE 4             TO PV-LINE-COUNT.                         04510001
045200     ADD  1             TO PV-PAGE-COUNT.                         04520001
045300     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     04530001
045400     MOVE 1             TO DP132-REPORT-NUMBER.                   04540001
045500                                                                  04550001
045600     WRITE INVOICE-RECORD                                         04560002
045700       FROM DP132-STANDRD-HEADER-132-COLS                         04570001
045800         AFTER ADVANCING PAGE.                                    04580001
045900                                                                  04590001
046000     WRITE INVOICE-RECORD                                         04600002
046100         FROM RP1-HEADING-LINE-2                                  04610001
046200         AFTER ADVANCING 1 LINE.                                  04620001
046300                                                                  04630001
046400     WRITE INVOICE-RECORD                                         04640002
046500         FROM RP1-HEADING-LINE-3                                  04650001
046600         AFTER ADVANCING 2 LINES.                                 04660001
046700                                                                  04670001
046800******************************************************************04680001
046900* 7000-READ-REPORT-FILE                                          *04690001
047000*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *04700001
047100*    THERE IS NO MORE RECORDS TO READ.                           *04710001
047200******************************************************************04720001
047300 7000-READ-REPORT-FILE.                                           04730001
047400                                                                  04740001
047500     READ REPORT-FILE-IN INTO AU016-DETAIL-TRANS                  04750001
047600         AT END                                                   04760001
047700             SET PS-END-OF-REPORT-FILE TO TRUE.                   04770001
047800                                                                  04780001
047900******************************************************************04790002
048000*     7100-GET-SKU-DESCRIPTION.                                  *04800002
048100*      SELECTS THE COMMISSION AMOUNT FOR THE UPC                 *04810002
048200******************************************************************04820002
048300 7100-GET-SKU-DESCRIPTION.                                        04830002
048400                                                                  04840002
048500     EXEC SQL                                                     04850007
048600         OPEN POS-DESC-CSR                                        04860007
048700     END-EXEC.                                                    04870007
048800                                                                  04880007
048900     EVALUATE TRUE                                                04890007
049000         WHEN SQLCODE = +0                                        04900007
049100             CONTINUE                                             04910007
049200         WHEN OTHER                                               04920007
049300             MOVE '7100-GET-SKU-DESCRIPTION        '              04930007
049400                               TO PV-PARAGRAPH-NAME               04940007
049500             MOVE 'OPEN POS-DESC-CSR         '                    04950007
049600                               TO PV-OPERATION-MSG-1              04960007
049700             PERFORM 9999-SQL-ABEND                               04970007
049800     END-EVALUATE.                                                04980007
049900                                                                  04990007
050000     EXEC SQL                                                     05000002
050100         FETCH POS-DESC-CSR                                       05010007
050200           INTO :XST00010-SKU-DESC                                05020002
050300     END-EXEC.                                                    05030002
050400                                                                  05040002
050500     EVALUATE TRUE                                                05050002
050600         WHEN SQLCODE = 0                                         05060002
050700             CONTINUE                                             05070002
050800         WHEN SQLCODE = +100                                      05080002
050900             DISPLAY 'NO DESCRIPTION FOR UPC ' PV-SAVE-UPC        05090002
051000             MOVE '7100-GET-SKU-DESCRIPTION' TO PV-PARAGRAPH-NAME 05100002
051100             MOVE 'SELECT FROM XS TABLES' TO PV-OPERATION-MSG-1   05110002
051200             PERFORM 9999-SQL-ABEND                               05120002
051300         WHEN SQLWARN0 NOT EQUAL SPACE                            05130002
051400         WHEN SQLCODE NOT EQUAL ZERO                              05140002
051500             MOVE '7100-GET-SKU-DESCRIPTION' TO PV-PARAGRAPH-NAME 05150002
051600             MOVE 'SELECT FROM XS TABLES' TO PV-OPERATION-MSG-1   05160002
051700             PERFORM 9999-SQL-ABEND                               05170002
051800     END-EVALUATE.                                                05180002
051900                                                                  05190002
052000     EXEC SQL                                                     05200007
052100         CLOSE POS-DESC-CSR                                       05210007
052200     END-EXEC.                                                    05220007
052300                                                                  05230007
052400     EVALUATE TRUE                                                05240007
052500         WHEN SQLCODE = +0                                        05250007
052600             CONTINUE                                             05260007
052700         WHEN OTHER                                               05270007
052800             MOVE '7100-GET-SKU-DESCRIPTION' TO PV-PARAGRAPH-NAME 05280007
052900             MOVE 'CLOSE POS-DESC-CSR        '                    05290007
053000                               TO PV-OPERATION-MSG-1              05300007
053100             PERFORM 9999-SQL-ABEND                               05310007
053200     END-EVALUATE.                                                05320007
053300                                                                  05330007
053400******************************************************************05340001
053500* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           05350001
053600******************************************************************05360001
053700 9999-ABEND.                                                      05370001
053800     DISPLAY '** ABEND           **'.                             05380001
053900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05390001
054000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05400001
054100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05410001
054200     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05420001
054300******************************************************************05430002
054400*     9999-SQL-ABEND                                             *05440002
054500*      PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *05450002
054600******************************************************************05460002
054700 9999-SQL-ABEND.                                                  05470002
054800                                                                  05480002
054900     DISPLAY '9999-SQL-ABEND'.                                    05490002
055000     DISPLAY '**  ABEND     **'.                                  05500002
055100     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               05510002
055200     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             05520002
055300     DISPLAY '**  OPERATION ** = ' PV-OPERATION-MSG-1.            05530002
055400                                                                  05540002
055500******************************************************************05550002
055600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05560002
055700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05570002
055800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05580002
055900* FORMAT.                                                        *05590002
056000******************************************************************05600002
056100     COPY DPPD004.                                                05610002
056200                                                                  05620002
056300     SET AC-DB2-ERROR TO TRUE.                                    05630002
056400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05640003
