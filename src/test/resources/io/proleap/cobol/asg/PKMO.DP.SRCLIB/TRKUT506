000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000600******************************************************************00030000
000700 PROGRAM-ID.    TRKUT506.                                         00040000
000800 AUTHOR.        TKMA471.                                          00050000
000900 INSTALLATION.  KOHLS.                                            00060000
001000 DATE-WRITTEN   JUNE, 2013.                                       00070000
001100 DATE-COMPILED.                                                   00080000
001200******************************************************************00090000
001310*  THIS PROGRAM PROCESSES A CURSOR THROUGH WST_ATTR_ELEM AND BASED00110000
001400*  ON DATA IN FUNCT_TXT PROCESS ANOTHER CURSOR THROUGH            00120000
001410*  TRT_VND_TRANS_RT FOR ROWS TO BE WRITTEN TO A FILE. THIS FILE   00130000
001500*  WILL THEN BE INPUT TO TRKUP502 FOR DELETION OF ROWS FROM THE   00140000
001700*  TABLE                                                          00150000
006600******************************************************************00160000
007000 ENVIRONMENT DIVISION.                                            00170000
007100******************************************************************00180000
007200 CONFIGURATION SECTION.                                           00190000
007300*                                                                 00200000
007400 SOURCE-COMPUTER.        IBM-3090.                                00210000
007500 OBJECT-COMPUTER.        IBM-3090.                                00220000
007600*                                                                 00230000
007700 INPUT-OUTPUT SECTION.                                            00240000
007800*                                                                 00250000
007900 FILE-CONTROL.                                                    00260000
008000*                                                                 00270000
008400     SELECT WS-TRANS-RATE-FILE-OUT                                00280000
008500         ASSIGN TO OUT01.                                         00290000
008700*                                                                 00300000
008800******************************************************************00310000
008900 DATA DIVISION.                                                   00320000
009000******************************************************************00330000
009100 FILE SECTION.                                                    00340000
009200*                                                                 00350000
010000*                                                                 00360000
010100 FD  WS-TRANS-RATE-FILE-OUT                                       00370000
010200     RECORDING MODE IS F                                          00380000
010300     BLOCK CONTAINS 0 RECORDS                                     00390000
010400     LABEL RECORDS ARE STANDARD.                                  00400000
010500*                                                                 00410000
010600 01  WS-TRANS-RATE-RECORD-OUT      PIC  X(184).                   00420000
010800*                                                                 00430000
010900 WORKING-STORAGE SECTION.                                         00440000
010910 01  WS-WST00010.                                                 00450000
010920     10 WS-INTGRTN-TYP-CDE         PIC X(10).                     00460000
010930     10 WS-ATTR-DEFN-SEQ-NBR       PIC S9(4) COMP.                00470000
010940     10 WS-ATTR-ELEM-SEQ-NBR       PIC S9(9) COMP.                00480000
010951     10 WS-ATTR-ELEM-TXT.                                         00481001
010952         49 WS-ATTR-ELEM-TXT-LEN   PIC S9(4) COMP.                00482001
010953         49 WS-ATTR-ELEM-TXT-TEXT  PIC X(50).                     00483001
011000*                                                                 00580000
011100 01  PC-PROGRAM-CONSTANTS.                                        00590000
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            00600000
011300         'TRKUT506'.                                              00610000
011400                                                                  00620000
011500 01  DK-DB2-KEYS.                                                 00630000
011600     05  DK-ATTR-DEFN-SEQ-NBR       PIC S9(09)  VALUE 1           00640000
011700                                                   COMP.          00650000
011800     05  DK-INTGRTN-TYP-CDE         PIC  X(10)  VALUE             00660000
012600                                                'TRRMRATDEL'.     00670000
014600*                                                                 00820000
014700 01  PS-PROGRAM-SWITCHES.                                         00830000
015201     05  PS-END-OF-ATTR-CSR-SW       PIC  X(01)    VALUE 'N'.     00870000
015210         88 PS-END-OF-ATTR-CSR-NO                  VALUE 'N'.     00880000
015220         88 PS-END-OF-ATTR-CSR-YES                 VALUE 'Y'.     00890000
015230     05  PS-END-OF-RATE-CSR-SW       PIC  X(01)    VALUE 'N'.     00900000
015240         88 PS-END-OF-RATE-CSR-NO                  VALUE 'N'.     00910000
015250         88 PS-END-OF-RATE-CSR-YES                 VALUE 'Y'.     00920000
015400*                                                                 00930000
015500 01  PV-PROGRAM-VARIABLES.                                        00940000
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00950000
015700                                                   COMP.          00960000
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00970000
015822     05  PV-FUNC-TXT                 PIC X(50).                   00990013
015823     05  FILLER REDEFINES PV-FUNC-TXT.                            01000000
015824         10  PV-VND-NBR              PIC X(10).                   01010011
015825*        10  FILLER                  PIC X.                       01020016
015860         10  PV-WS-RATE-TYP          PIC X(04).                   01030011
015870         10  FILLER                  PIC X(35).                   01060013
016100     05  PV-RATE-CNT                 PIC S9(07)    VALUE ZERO     01160007
016200                                                   COMP-3.        01170000
016300     05  PV-OUTPUT-CNT               PIC S9(07)    VALUE ZERO     01200000
016400                                                   COMP-3.        01210000
016410     05  PV-DISPLAY-CNT              PIC ZZZZZZ9.                 01220000
016420     05  PV-DISPLAY-ATTR-DEFN        PIC ZZZ9.                    01230000
016430     05  PV-DISPLAY-ATTR-ELEM        PIC ZZZZZZZZ9.               01240000
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01250000
005550     05  PV-NULL-EFF-RT-END-DTE       PIC S9(4)   VALUE ZERO      01251000
005560                                                  COMP SYNC.      01252000
005550     05  PV-NULL-DCONSLR-SCAC-ID      PIC S9(4)   VALUE ZERO      01253000
005560                                                  COMP SYNC.      01254000
005550     05  PV-NULL-POE-STD-EDI-CDE      PIC S9(4)   VALUE ZERO      01255000
005560                                                  COMP SYNC.      01256000
005550     05  PV-NULL-FOB-STD-EDI-CDE      PIC S9(4)   VALUE ZERO      01257000
005560                                                  COMP SYNC.      01258000
005550     05  PV-NULL-EDI-CONTNR-SZ-TYP-CDE PIC S9(4)   VALUE ZERO     01259000
005560                                                  COMP SYNC.      01259100
005550     05  PV-NULL-CMDTY-TYP-GRP-CDE    PIC S9(4)   VALUE ZERO      01259200
005560                                                  COMP SYNC.      01259300
005550     05  PV-NULL-RT-WT-TYP-CDE        PIC S9(4)   VALUE ZERO      01259400
005560                                                 COMP SYNC.       01259500
005550     05  PV-NULL-UOM-CDE              PIC S9(4)   VALUE ZERO      01259600
005560                                                  COMP SYNC.      01259700
005550     05  PV-NULL-LAST-UPD-TMST        PIC S9(4)   VALUE ZERO      01259800
005560                                                  COMP SYNC.      01259900
005550     05  PV-NULL-LAST-UPD-USRID       PIC S9(4)   VALUE ZERO      01260000
005560                                                  COMP SYNC.      01260104
005550     05  PV-ATTR-ELEM-TXT-NULL        PIC S9(4)   VALUE ZERO      01260204
005560                                                  COMP SYNC.      01260304
017300*                                                                 01270000
017400 01  PE-PROGRAM-ERROR-MESSAGES.                                   01280000
017500     05  PE-MSG-01                   PIC  X(30)    VALUE          01290000
017600         'OPEN OF ATTR_CSR              '.                        01300000
017700     05  PE-MSG-02                   PIC  X(30)    VALUE          01310000
017800         'FETCH OF ATTR_CSR             '.                        01320000
020100     05  PE-MSG-03                   PIC  X(30)    VALUE          01330000
020200         'CLOSE OF ATTR_CSR             '.                        01340000
020300*                                                                 01350000
021300******************************************************************01360000
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01370000
021500******************************************************************01380000
021600     COPY DPWS004.                                                01390000
021700*                                                                 01400000
021900******************************************************************01420000
022000*  COMMUNICATIONS AREA FOR DB2                                    01430000
022100******************************************************************01440000
022200     EXEC SQL                                                     01450000
022300          INCLUDE SQLCA                                           01460000
022400     END-EXEC.                                                    01470000
022500*                                                                 01480000
022501*----------------------------------------------------------------*01490000
022502*    WST_ATTR_ELEM: WAREHOUSE SYSTEMS - ATTRIBUTE ELEMENTS        01500000
022503*----------------------------------------------------------------*01510000
022504     EXEC SQL                                                     01520000
022505          INCLUDE WST00010                                        01530000
022506     END-EXEC.                                                    01540000
022500*                                                                 01541000
007529******************************************************************01550000
007530*    TRT_VND_TRANS_AMT (TRT00050)                                 01560000
007531******************************************************************01570000
007532     EXEC SQL                                                     01580000
007533          INCLUDE TRT00050                                        01590000
007534     END-EXEC.                                                    01600000
007535                                                                  01601000
024900*                                                                 01610000
025100******************************************************************01620000
025200**  CURSOR USED TO RETRIEVE RATE ROWS                             01630000
025400******************************************************************01640000
007539                                                                  01641000
007540     EXEC SQL                                                     01642000
007550        DECLARE RT_CSR CURSOR FOR                                 01643003
007560         SELECT                                                   01644000
                     VND_TRANS_RT_ID                                    01650006
                    ,VND_NBR                                            01660006
                    ,TRANS_RT_TYP_CDE                                   01670006
                    ,EFF_RT_BEG_DTE                                     01680006
                    ,EFF_RT_END_DTE                                     01690006
                    ,DCONSLR_SCAC_ID                                    01700006
                    ,POE_STD_EDI_CDE                                    01710006
                    ,FOB_STD_EDI_CDE                                    01720006
                    ,EDI_CONTNR_SZ_TYP_CDE                              01730006
                    ,CMDTY_TYP_GRP_CDE                                  01740006
                    ,TRANS_RT_AMT                                       01750006
                    ,RT_WT_TYP_CDE                                      01760006
                    ,UOM_CDE                                            01770006
                    ,RT_BSS_MAX_QTY                                     01780006
007900              ,RT_BSS_MIN_QTY                                     01781006
008000              ,CRE_TMST                                           01782006
                    ,CRE_USRID                                          01783006
                    ,LAST_UPD_TMST                                      01784006
                    ,LAST_UPD_USRID                                     01785006
               FROM TRT_VND_TRANS_RT                                    01786006
                WHERE VND_NBR = '000638734'                             01786117
031100            AND TRANS_RT_TYP_CDE IN ('BAF','FAH','BASE')          01786219
               WITH UR                                                  01787000
008502     END-EXEC.                                                    01788000
027100******************************************************************01790000
025200**  CURSOR USED TO RETRIEVE ATTR ELEM ROWS                        01791000
027300******************************************************************01810000
029500*                                                                 01960000
029510     EXEC SQL                                                     01970000
029520          DECLARE ATTR_CSR CURSOR FOR                             01980001
029600          SELECT INTGRTN_TYP_CDE                                  01990000
029700               , ATTR_DEFN_SEQ_NBR                                02000000
029800               , ATTR_ELEM_SEQ_NBR                                02010000
029900               , ATTR_ELEM_TXT                                    02020000
030200          FROM  WST_ATTR_ELEM                                     02050000
031100          WHERE INTGRTN_TYP_CDE    = :DK-INTGRTN-TYP-CDE          02060000
031200            AND ATTR_DEFN_SEQ_NBR  = :DK-ATTR-DEFN-SEQ-NBR        02070000
031400          WITH UR                                                 02090000
031500     END-EXEC                                                     02100000
046000*                                                                 02110000
046100******************************************************************02120000
046200 PROCEDURE DIVISION.                                              02130000
046300******************************************************************02140000
046400                                                                  02150000
046500******************************************************************02160000
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   02170000
046700******************************************************************02180000
046800 0000-PROGRAM-MAINLINE.                                           02190000
046900     PERFORM 1000-INITIALIZE.                                     02200000
047027     PERFORM 6000-OPEN-ATTR-CSR.                                  02240001
047028     PERFORM 6010-FETCH-ATTR-CSR                                  02250001
047035         UNTIL PS-END-OF-ATTR-CSR-YES                             02251001
047040     PERFORM 6020-CLOSE-ATTR-CSR.                                 02330001
047092*                                                                 02350000
047540     PERFORM 9000-DISPLAY-COUNTS.                                 02360008
047544     DISPLAY '***              END OF JOB              ***'.      02400000
047550     CLOSE WS-TRANS-RATE-FILE-OUT.                                02410001
047600     STOP RUN.                                                    02420000
047700*                                                                 02430000
048400******************************************************************02440000
048500 1000-INITIALIZE.                                                 02450000
048600     DISPLAY '**'.                                                02460000
048601     DISPLAY '** PROGRAM:  TRKUT506'.                             02470000
048602     DISPLAY '**'.                                                02480000
048700     OPEN OUTPUT WS-TRANS-RATE-FILE-OUT.                          02760001
048800*                                                                 02770000
049600******************************************************************02780000
112000******************************************************************03080000
112100*  OPEN THE ATTR CURSOR                                           03090001
112200******************************************************************03100000
112300 6000-OPEN-ATTR-CSR.                                              03110001
142100     EXEC SQL                                                     03120007
112603         OPEN ATTR_CSR                                            03180007
112604             END-EXEC.                                            03190007
112700*                                                                 03210000
112800     EVALUATE TRUE                                                03220000
112900         WHEN SQLCODE = ZERO                                      03230000
113000              CONTINUE                                            03240000
  3100         WHEN OTHER                                               03250003
113200              MOVE '6000-OPEN-ATTR-CSR'                           03260001
113300                                 TO PV-ABEND-PARAGRAPH            03270000
113400              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    03280000
113500              PERFORM 9200-SQL-ABEND                              03290000
113600     END-EVALUATE.                                                03300000
113700*                                                                 03310000
113900******************************************************************03330000
114000*  FETCH THE NEXT ATTR ROW                                        03340001
114100******************************************************************03350000
114200 6010-FETCH-ATTR-CSR.                                             03360001
029300     INITIALIZE                                                   03360104
005550         PV-ATTR-ELEM-TXT-NULL.                                   03360204
144662     EXEC SQL                                                     03361002
144663          FETCH ATTR_CSR                                          03362002
144665          INTO  :WST00010-INTGRTN-TYP-CDE                         03370002
144666               ,:WST00010-ATTR-DEFN-SEQ-NBR                       03380002
144667               ,:WST00010-ATTR-ELEM-SEQ-NBR                       03390002
144668               ,:WST00010-ATTR-ELEM-TXT :PV-ATTR-ELEM-TXT-NULL    03400004
114217     END-EXEC.                                                    03420001
                                                                        03430001
114226     EVALUATE TRUE                                                03510000
114227         WHEN SQLCODE = ZERO                                      03520000
114249              SET PS-END-OF-RATE-CSR-NO                           03521003
114250                                TO TRUE                           03522003
                    MOVE WST00010-ATTR-ELEM-TXT TO WS-ATTR-ELEM-TXT     03523015
                    MOVE WS-ATTR-ELEM-TXT-TEXT TO PV-FUNC-TXT           03523115
114253              DISPLAY '*** VND = ' PV-VND-NBR                     03524013
114253              DISPLAY '*** TYP = ' PV-WS-RATE-TYP                 03524113
114253              DISPLAY '*** LAST GOOD FETCH: '                     03524213
114255                            PV-FUNC-TXT                           03525012
114228              PERFORM 7000-OPEN-RATE-CSR                          03530002
114248         WHEN SQLCODE = +100                                      03730000
114249              SET PS-END-OF-ATTR-CSR-YES                          03740001
114250                                TO TRUE                           03750000
114251         WHEN OTHER                                               03760000
114252              PERFORM 9000-DISPLAY-COUNTS                         03770000
114253              DISPLAY '*** LAST GOOD FETCH: '                     03780000
114255                            PV-FUNC-TXT                           03800000
114256              MOVE '6010-FETCH-ATTR-CSR'                          03810001
114257                                 TO PV-ABEND-PARAGRAPH            03820000
114258              MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    03830000
114259              PERFORM 9200-SQL-ABEND                              03840000
114260     END-EVALUATE.                                                03850000
114270*                                                                 03850101
047034     PERFORM 7010-FETCH-RATE-CSR                                  03852002
047035             UNTIL PS-END-OF-RATE-CSR-YES.                        03853007
114270*                                                                 03860000
141700******************************************************************03880000
141800*  CLOSE THE ATTR CURSOR                                          03890001
141900******************************************************************03900000
142000 6020-CLOSE-ATTR-CSR.                                             03910001
142100     EXEC SQL                                                     03930001
142200          CLOSE ATTR_CSR                                          03940001
142300     END-EXEC.                                                    03950001
142400*                                                                 04010000
142500     EVALUATE TRUE                                                04020000
142600         WHEN SQLCODE = ZERO                                      04030000
142700              CONTINUE                                            04040000
142800         WHEN OTHER                                               04050000
142900              MOVE '6020-CLOSE-ATTR-CSR'                          04060001
143000                                 TO PV-ABEND-PARAGRAPH            04070000
143100              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    04080000
143200              PERFORM 9200-SQL-ABEND                              04090000
143300     END-EVALUATE.                                                04100000
143400*                                                                 04110000
143500******************************************************************04120000
143600*  OPEN THE RATE CURSOR                                           04130001
143700******************************************************************04140000
143800 7000-OPEN-RATE-CSR.                                              04150001
143900     EXEC SQL                                                     04160000
144000          OPEN RT_CSR                                             04170003
144100     END-EXEC.                                                    04180000
144200*                                                                 04190000
144300     EVALUATE TRUE                                                04200000
144400         WHEN SQLCODE = ZERO                                      04210000
144500              CONTINUE                                            04220000
144600         WHEN OTHER                                               04230000
144610              MOVE '7000-OPEN-RATE-CSR'                           04240001
144620                                 TO PV-ABEND-PARAGRAPH            04250000
144630              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    04260000
144640              PERFORM 9200-SQL-ABEND                              04270000
144650     END-EVALUATE.                                                04280000
144660*                                                                 04290000
143500******************************************************************04291002
143600*  FETCH RATE ROWS                                                04292002
143700******************************************************************04293002
144661 7010-FETCH-RATE-CSR.                                             04300001
029200                                                                  04310003
045414     INITIALIZE DCLTRT00050.                                      04320003
029300     INITIALIZE                                                   04330003
005550         PV-NULL-EFF-RT-END-DTE                                   04340003
005550         PV-NULL-DCONSLR-SCAC-ID                                  04350003
005550         PV-NULL-POE-STD-EDI-CDE                                  04360003
005550         PV-NULL-FOB-STD-EDI-CDE                                  04370003
005550         PV-NULL-EDI-CONTNR-SZ-TYP-CDE                            04380003
005550         PV-NULL-CMDTY-TYP-GRP-CDE                                04390003
005550         PV-NULL-RT-WT-TYP-CDE                                    04400003
005550         PV-NULL-UOM-CDE                                          04410003
005550         PV-NULL-LAST-UPD-TMST                                    04420003
005550         PV-NULL-LAST-UPD-USRID.                                  04430003
045440                                                                  04457003
045450         EXEC SQL                                                 04458003
045460             FETCH RT_CSR INTO                                    04459006
                     :TRT00050-VND-TRANS-RT-ID                          04459103
                    ,:TRT00050-VND-NBR                                  04459203
                    ,:TRT00050-TRANS-RT-TYP-CDE                         04459303
                    ,:TRT00050-EFF-RT-BEG-DTE                           04459403
                    ,:TRT00050-EFF-RT-END-DTE  :PV-NULL-EFF-RT-END-DTE  04459503
                    ,:TRT00050-DCONSLR-SCAC-ID :PV-NULL-DCONSLR-SCAC-ID 04459603
                    ,:TRT00050-POE-STD-EDI-CDE :PV-NULL-POE-STD-EDI-CDE 04459703
                    ,:TRT00050-FOB-STD-EDI-CDE :PV-NULL-FOB-STD-EDI-CDE 04459803
                    ,:TRT00050-EDI-CONTNR-SZ-TYP-CDE                    04459903
                                     :PV-NULL-EDI-CONTNR-SZ-TYP-CDE     04460003
                    ,:TRT00050-CMDTY-TYP-GRP-CDE                        04460103
                                     :PV-NULL-CMDTY-TYP-GRP-CDE         04460203
                    ,:TRT00050-TRANS-RT-AMT                             04460303
                    ,:TRT00050-RT-WT-TYP-CDE   :PV-NULL-RT-WT-TYP-CDE   04460403
                    ,:TRT00050-UOM-CDE         :PV-NULL-UOM-CDE         04460503
                    ,:TRT00050-RT-BSS-MAX-QTY                           04460603
                    ,:TRT00050-RT-BSS-MIN-QTY                           04460703
                    ,:TRT00050-CRE-TMST                                 04460803
                    ,:TRT00050-CRE-USRID                                04460903
                    ,:TRT00050-LAST-UPD-TMST   :PV-NULL-LAST-UPD-TMST   04461003
                    ,:TRT00050-LAST-UPD-USRID  :PV-NULL-LAST-UPD-USRID  04461103
046200         END-EXEC.                                                04461303
046100                                                                  04461403
144678     EVALUATE TRUE                                                04462000
144679         WHEN SQLCODE = ZERO                                      04470000
                    DISPLAY 'VENDOR NUMBER IS ' TRT00050-VND-NBR        04471018
                    DISPLAY 'VENDOR TYPE CDE IS '                       04472018
                                             TRT00050-TRANS-RT-TYP-CDE  04473018
144680              ADD +1 TO PV-RATE-CNT                               04480002
                    PERFORM 8000-WRITE-RATE-FILE                        04481010
144681         WHEN SQLCODE = +100                                      04490000
                    PERFORM 7020-CLOSE-RATE-CSR                         04491007
144682              SET PS-END-OF-RATE-CSR-YES                          04500002
144683                                  TO TRUE                         04510000
144688         WHEN OTHER                                               04560000
144689              PERFORM 9000-DISPLAY-COUNTS                         04570000
144690              MOVE WS-ATTR-DEFN-SEQ-NBR                           04580000
144691                                 TO PV-DISPLAY-ATTR-DEFN          04590000
144692              MOVE WS-ATTR-ELEM-SEQ-NBR                           04600000
144693                                 TO PV-DISPLAY-ATTR-ELEM          04610000
144694              DISPLAY '*** LAST GOOD FETCH: '                     04620000
144695                            WS-INTGRTN-TYP-CDE ' '                04630000
144696                            PV-DISPLAY-ATTR-DEFN ' '              04640000
144697                            PV-DISPLAY-ATTR-ELEM                  04650000
144698              MOVE '7010-FETCH-EXTRACT-CSR'                       04660000
144699                                 TO PV-ABEND-PARAGRAPH            04670000
144700              MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    04680000
144701              PERFORM 9200-SQL-ABEND                              04690000
144702     END-EVALUATE.                                                04700000
144703*                                                                 04710000
144704******************************************************************04720000
144705*  CLOSE THE RATE_CSR                                             04730001
144706******************************************************************04740000
144707 7020-CLOSE-RATE-CSR.                                             04750001
144708     EXEC SQL                                                     04760000
144709          CLOSE RT_CSR                                            04770004
144710     END-EXEC.                                                    04780000
144711*                                                                 04790000
144712     EVALUATE TRUE                                                04800000
144713         WHEN SQLCODE = ZERO                                      04810000
144714              CONTINUE                                            04820000
144715         WHEN OTHER                                               04830000
144716              MOVE '7020-CLOSE-RATE-CSR'                          04840001
144717                                 TO PV-ABEND-PARAGRAPH            04850000
144718              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    04860000
144719              PERFORM 9200-SQL-ABEND                              04870000
144720     END-EVALUATE.                                                04880000
144721*                                                                 04890000
050903******************************************************************04901009
050904* WRITES THE APPROPRIATE OUTPUT RECORDS                          *04902009
050905******************************************************************04903009
050906 8000-WRITE-RATE-FILE.                                            04904009
050908     MOVE '8000-WRITE-RATE-FILE'  TO PV-ABEND-PARAGRAPH.          04905009
050910                                                                  04906009
050912     WRITE WS-TRANS-RATE-RECORD-OUT                               04907009
050913             FROM DCLTRT00050                                     04908009
050919     ADD  1  TO  PV-OUTPUT-CNT.                                   04909009
144730******************************************************************04909109
144800 9000-DISPLAY-COUNTS.                                             04910000
145100                                                                  04920000
145200     DISPLAY '********************************************'       04930000
145201     DISPLAY '**                                        **'       04940000
145310     MOVE PV-RATE-CNT TO PV-DISPLAY-CNT                           05000009
145400     DISPLAY 'TRT RATES FETCHED-: ' PV-DISPLAY-CNT.               05010001
145410     MOVE PV-OUTPUT-CNT      TO PV-DISPLAY-CNT                    05020000
145501     DISPLAY 'OUTPUT RECORDS WRITTEN: ' PV-DISPLAY-CNT.           05030000
145502     DISPLAY '**                                        **'       05040000
145510     DISPLAY '********************************************'.      05050000
146700*                                                                 05070000
146800******************************************************************05080000
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05090000
147000*  ERROR OR WARNING CODE OCCURS.                                  05100000
147100******************************************************************05110000
147200 9200-SQL-ABEND.                                                  05120000
147300     DISPLAY '9200-SQL-ABEND'.                                    05130000
147400     DISPLAY '** ABEND     **'.                                   05140000
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05150000
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05160000
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05170000
147900*                                                                 05190000
148000******************************************************************05200000
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05210000
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05220000
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05230000
148400* FORMAT.                                                         05240000
148500******************************************************************05250000
148600     COPY DPPD004.                                                05260000
148700                                                                  05270000
148800     IF  SQLCODE NOT = -911                                       05280000
148900         EXEC SQL                                                 05290000
149000              COMMIT                                              05300000
149100         END-EXEC                                                 05310000
149200     END-IF.                                                      05320000
149300                                                                  05330000
149400     MOVE +4013                  TO PV-ABEND-CODE.                05340000
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05350000
