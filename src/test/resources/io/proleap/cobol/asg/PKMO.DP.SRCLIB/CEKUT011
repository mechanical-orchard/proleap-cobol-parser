000100***************************************************************** 00010010
000200 IDENTIFICATION DIVISION.                                         00020010
000300***************************************************************** 00030010
000400 PROGRAM-ID.    CEKUT011.                                         00040010
000500 AUTHOR.        VISWA KARUTURI.                                   00050010
000600 INSTALLATION.  KOHLS.                                            00060010
000700 DATE-WRITTEN   AUGUST 2004.                                      00070010
000800 DATE-COMPILED.                                                   00080010
000900***************************************************************** 00090010
001000*   THIS PROGRAM WILL TAKE IN A FILE OF COMPLETED CENTRAL STOCK * 00100011
001100*   PULLS, CHECK THE STORE THAT HAS HAD DISTRIBUTED UNITS TO IT * 00110011
001200*   AND DETERMINE IF THE CENTRAL STOCK PULL UNITS FOR THE STORE * 00120011
001300*   SHOULD SENT TO THE IN-TRANSIT DATABASE TO UPDATE STORE      * 00130011
001400*   EXPECTED.                                                   * 00140011
001500***************************************************************** 00150010
001501* GERMAN BANDA 2/1/2016                                           00150175
001502* PARA 2200-CHECK-RECV-LOC-NBR SQL CHANGED TO ALLOW EFC STORES    00150272
001503* TO BE FOUND AND UPDATED TO STORE EXPECTED. CARTONS PULLED FROM  00150372
001504* EFC LOCATIONS WILL HAVE MANIFESTED CARTONS CREATED THAT CAN BE  00150472
001505* PUT INTO, AND RELIEVED FROM INTRANSIT AND STORE EXPECTED.       00150572
001510***************************************************************** 00151072
001600*    PROGRAM CREATES ONE OUTPUT FILE.                           * 00160053
001700*                                                               * 00170057
001800*    INP01 - INPUT FILE  - LAYOUT IS CERD004 COPYBOOK           * 00180058
001900*                                                               * 00190058
002000*    OUT01 - OUTPUT FILE - LAYOUT IS PCRD010 COPYBOOK           * 00200058
002100*                                                               * 00210058
002200***************************************************************** 00220058
002300 ENVIRONMENT DIVISION.                                            00230058
002400***************************************************************** 00240058
002500 INPUT-OUTPUT SECTION.                                            00250058
002600*                                                                 00260058
002700 FILE-CONTROL.                                                    00270058
002800                                                                  00280058
002900     SELECT CNSTK-FILE      ASSIGN TO INP01.                      00290058
003000                                                                  00300058
003100     SELECT STR-EXPECT-FILE ASSIGN TO OUT01.                      00310058
003200                                                                  00320058
003300***************************************************************** 00330058
003400 DATA DIVISION.                                                   00340058
003500***************************************************************** 00350058
003600 FILE SECTION.                                                    00360058
003700                                                                  00370058
003800 FD  CNSTK-FILE                                                   00380058
003900     RECORDING MODE IS F                                          00390058
004000     LABEL RECORDS ARE STANDARD                                   00400058
004100     BLOCK CONTAINS 0 RECORDS.                                    00410058
004200 01  CNSTK-RECORD                PIC X(080).                      00420058
004300                                                                  00430058
004400 FD  STR-EXPECT-FILE                                              00440058
004500     RECORDING MODE IS F                                          00450058
004600     LABEL RECORDS ARE STANDARD                                   00460058
004700     BLOCK CONTAINS 0 RECORDS.                                    00470058
004800 01  STR-EXPECT-RECORD           PIC X(100).                      00480058
004900                                                                  00490058
005000***************************************************************** 00500058
005100 WORKING-STORAGE SECTION.                                         00510058
005200***************************************************************** 00520058
005300                                                                  00530058
005400 01  PS-PROGRAM-SWITCHES.                                         00540058
005500     05  PS-SHOW-PARAGRAPH-SW         PIC X(01)  VALUE 'N'.       00550058
005600         88  PS-SHOW-PARAGRAPH                   VALUE 'Y'.       00560058
005700         88  PS-DONT-SHOW-PARAGRAPH              VALUE 'N'.       00570058
005800     05  PS-RECV-LOC-UPDATE-SE-SW     PIC X(01)  VALUE 'N'.       00580058
005900         88  PS-RECV-LOC-UPDATE-SE               VALUE 'Y'.       00590058
006000         88  PS-DONT-RECV-LOC-UPDATE-SE          VALUE 'N'.       00600058
006100     05  PS-EOF-CNSTK-SW              PIC X(01)  VALUE 'N'.       00610058
006200         88  PS-EOF-CNSTK-FILE                   VALUE 'Y'.       00620058
006300         88  PS-NOT-EOF-CNSTK-FILE               VALUE 'N'.       00630058
006400                                                                  00640058
006500 01  PV-PROGRAM-VARIABLES.                                        00650058
006600     05  PV-INPUT-PULL-NBR.                                       00660058
006700         10  PV-INPUT-PULL-NBR-5      PIC  9(05).                 00670058
006800         10  PV-INPUT-PULL-NBR-3      PIC  9(03).                 00680058
006900     05  PV-PREV-PULL-NBR             PIC S9(04) COMP   VALUE 0.  00690058
007000     05  PV-PREV-LOC-NBR              PIC S9(04) COMP   VALUE 0.  00700058
007100     05  PV-INPUT-BYPASSED            PIC S9(07) COMP-3 VALUE 0.  00710058
007200     05  PV-INPUT-BYPASSED-ZERO       PIC S9(07) COMP-3 VALUE 0.  00720061
007300     05  PV-PCRD010-OUT               PIC S9(07) COMP-3 VALUE 0.  00730058
007400     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00740058
007500     05  PV-RECORDS-READ-QTY          PIC S9(09) COMP-3 VALUE 0.  00750058
007600     05  PV-SQL-CHECK-BYPASSED        PIC S9(07) COMP-3 VALUE 0.  00760058
007700     05  PV-SQL-CHECK-DONE            PIC S9(07) COMP-3 VALUE 0.  00770058
007800     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00780058
007900                                                                  00790058
008000 01 DK-DATABASE-KEYS.                                             00800058
008100     05  DK-CNSTK-REQ-PL-NBR          PIC S9(09) COMP   VALUE 0.  00810058
008200     05  DK-CNSTK-LOC-NBR             PIC S9(04) COMP   VALUE 0.  00820058
008300     05  DK-RECV-LOC-NBR              PIC S9(04) COMP   VALUE 0.  00830058
008400                                                                  00840058
008500 01  PV-DB2-TMST.                                                 00850058
008600     05  PV-DB2-TMST-CC              PIC X(02).                   00860058
008700     05  PV-DB2-TMST-YY              PIC X(02).                   00870058
008800     05  FILLER                      PIC X(01) VALUE '-'.         00880058
008900     05  PV-DB2-TMST-MM              PIC X(02).                   00890058
009000     05  FILLER                      PIC X(01) VALUE '-'.         00900058
009100     05  PV-DB2-TMST-DD              PIC X(02).                   00910058
009200     05  FILLER                      PIC X(01) VALUE '-'.         00920058
009300     05  PV-DB2-TMST-HH              PIC X(02).                   00930058
009400     05  FILLER                      PIC X(01) VALUE '.'.         00940058
009500     05  PV-DB2-TMST-MN              PIC X(02).                   00950058
009600     05  FILLER                      PIC X(01) VALUE '.'.         00960058
009700     05  PV-DB2-TMST-SS              PIC X(02).                   00970058
009800     05  FILLER                      PIC X(01) VALUE '.'.         00980058
009900     05  PV-DB2-TMST-TS              PIC X(06).                   00990058
010000                                                                  01000058
010100 01 PC-PROGRAM-CONSTANTS.                                         01010058
010200     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'CEKUT011'. 01020058
010300     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.01030058
010400     05  PC-YES                      PIC X(01) VALUE 'Y'.         01040058
010500     05  PC-NO                       PIC X(01) VALUE 'N'.         01050058
010600     05  PC-DC                       PIC X(02) VALUE 'DC'.        01060058
010700     05  PC-DS                       PIC X(02) VALUE 'DS'.        01070058
010800     05  PC-KHL                      PIC X(03) VALUE 'KHL'.       01080058
010900     05  PC-INTRANSIT                PIC X(06) VALUE 'INTRND'.    01090058
011000     05  PC-ACTIVE                   PIC X(02) VALUE 'AC'.        01100058
011100     05  PC-N                        PIC X(01) VALUE 'N'.         01110058
011200     05  PV-RECORD-STATUS            PIC X(16) VALUE SPACES.      01120058
011300     05  PC-RECORD-FOUND             PIC X(16) VALUE              01130058
011400                                               'RECORD FOUND    '.01140058
011500     05  PC-RECORD-NOT-FOUND         PIC X(16) VALUE              01150058
011600                                               'RECORD NOT FOUND'.01160058
011700                                                                  01170058
011800 01  PV-ABEND-FIELDS.                                             01180058
011900     05  PV-ABEND-CODE               PIC S9(04) VALUE +0 COMP.    01190058
012000     05  PV-ABEND-PROGRAM            PIC  X(08) VALUE 'CEKUT011'. 01200058
012100     05  PV-ABEND-PARAGRAPH          PIC  X(50) VALUE SPACES.     01210058
012200     05  PV-ABEND-OPERATION          PIC  X(51) VALUE SPACES.     01220058
012300******************************************************************01230058
012400*  USED FOR DB2 ERROR MESSAGE BUILDING                            01240058
012500******************************************************************01250058
012600     COPY DPWS004.                                                01260058
012700                                                                  01270058
012800******************************************************************01280058
012900*   DB2 SQL COMMUNICATION AREA                                    01290058
013000******************************************************************01300058
013100     EXEC SQL                                                     01310058
013200          INCLUDE SQLCA                                           01320058
013300     END-EXEC.                                                    01330058
013400                                                                  01340058
013500******************************************************************01350058
013600*    TCEPLRQ - CENTRAL STOCK PULL REQUEST TABLE.                  01360058
013700******************************************************************01370058
013800     EXEC SQL                                                     01380058
013900          INCLUDE TCEPLRQ                                         01390058
014000     END-EXEC.                                                    01400058
014100                                                                  01410058
014200******************************************************************01420058
014300*    TCEPLST - CENTRAL STOCK PULL REQUEST STATUS TABLE.           01430058
014400******************************************************************01440058
014500     EXEC SQL                                                     01450058
014600          INCLUDE TCEPLST                                         01460058
014700     END-EXEC.                                                    01470058
014800                                                                  01480058
014900******************************************************************01490058
015000*    XLT_LOC - LOGISTICS DOMAIN LOCATION MASTER TABLE.            01500058
015100******************************************************************01510058
015200     EXEC SQL                                                     01520058
015300          INCLUDE XLT00010                                        01530058
015400     END-EXEC.                                                    01540058
015500                                                                  01550058
015600******************************************************************01560058
015700*    XLT_DC_LOC_ASGMT - LOGISTICS DOMAIN STORE TO DC ASSOCIATION  01570058
015800*                       TABLE.                                    01580058
015900******************************************************************01590058
016000     EXEC SQL                                                     01600058
016100          INCLUDE XLT00014                                        01610058
016200     END-EXEC.                                                    01620058
016300                                                                  01630058
016400******************************************************************01640058
016500*    TKRPRPM - KOHLS TO RETEK PROCESSING PARAMETERS.              01650058
016600******************************************************************01660058
016700     EXEC SQL                                                     01670058
016800          INCLUDE TKRPRPM                                         01680058
016900     END-EXEC.                                                    01690058
017000                                                                  01700058
017100***********************************************************       01710058
017200*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       01720058
017300***********************************************************       01730058
017400     COPY CERD004.                                                01740058
017500                                                                  01750058
017600     COPY PCRD010.                                                01760058
017700                                                                  01770058
017800     COPY XLWS071.                                                01780058
017900                                                                  01790058
018000     COPY XLWS001.                                                01800058
018100                                                                  01810058
018200***********************************************************       01820058
018300 PROCEDURE DIVISION.                                              01830058
018400***********************************************************       01840058
018500     PERFORM 1000-INITIALIZATION.                                 01850058
018600                                                                  01860058
018700     PERFORM 2000-PROCESS-EXTRACTS                                01870058
018800         UNTIL PS-EOF-CNSTK-FILE.                                 01880058
018900                                                                  01890058
019000     PERFORM 9900-EOJ-ROUTINE.                                    01900058
019100                                                                  01910058
019200     GOBACK.                                                      01920058
019300                                                                  01930058
019400****************************************************************  01940058
019500*    FIRST TIME PROGRAM INITIALIZATION TASKS.                  *  01950058
019600****************************************************************  01960058
019700 1000-INITIALIZATION.                                             01970058
019800                                                                  01980058
019900     OPEN  INPUT CNSTK-FILE                                       01990058
020000          OUTPUT STR-EXPECT-FILE.                                 02000058
020100                                                                  02010058
020200     DISPLAY '**************************************'.            02020058
020300     DISPLAY '*        PROGRAM - CEKUT011          *'.            02030058
020400     DISPLAY '**************************************'.            02040058
020500     DISPLAY '                                      '.            02050058
020600                                                                  02060058
020700     SET PS-DONT-SHOW-PARAGRAPH  TO TRUE.                         02070058
020800                                                                  02080058
020900     SET PS-NOT-EOF-CNSTK-FILE   TO TRUE.                         02090058
021000                                                                  02100058
021100     PERFORM 9100-READ-INPUT-FILE.                                02110058
021200                                                                  02120058
021300****************************************************************  02130058
021400*  DETERMINE IF CENTRAL STOCK PULL WAS CREATED AFTER           *  02140058
021500*  DC ASSOCIATED TO THE RECEIVER HAS BEEN TURNED ON TO         *  02150058
021600*  UPDATE STORE EXPECTED PRIOR TO THE CENTRAL STOCK PULL       *  02160058
021700*  WAS CREATED.                                                *  02170058
021800****************************************************************  02180058
021900 2000-PROCESS-EXTRACTS.                                           02190058
022000                                                                  02200058
022100     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       02210058
022200     IF PS-SHOW-PARAGRAPH                                         02220058
022300        DISPLAY '2000-PROCESS-EXTRACTS'                           02230058
022400     END-IF.                                                      02240058
022500                                                                  02250058
022600     MOVE CE004-REQ-NMBR           TO PV-INPUT-PULL-NBR.          02260058
022700     MOVE PV-INPUT-PULL-NBR-5      TO DK-CNSTK-REQ-PL-NBR.        02270058
022800     MOVE CE004-RECV-STORE-NMBR    TO DK-RECV-LOC-NBR.            02280058
022900                                                                  02290058
023000     IF  CE004-RECV-STORE-QTY = 0                                 02300061
023100         ADD +1 TO PV-INPUT-BYPASSED-ZERO                         02310061
023200     ELSE                                                         02320061
023300         IF  DK-CNSTK-REQ-PL-NBR = PV-PREV-PULL-NBR               02330061
023400         AND DK-RECV-LOC-NBR     = PV-PREV-LOC-NBR                02340061
023500             ADD +1 TO PV-SQL-CHECK-BYPASSED                      02350061
023600             IF  PS-RECV-LOC-UPDATE-SE                            02360061
023700                 PERFORM 9600-WRITE-PCRD010-RECORD                02370061
023800             ELSE                                                 02380061
023900                 ADD +1 TO PV-INPUT-BYPASSED                      02390061
024000             END-IF                                               02400061
024100         ELSE                                                     02410061
024200             ADD +1 TO PV-SQL-CHECK-DONE                          02420061
024300             MOVE DK-CNSTK-REQ-PL-NBR TO PV-PREV-PULL-NBR         02430061
024400             MOVE DK-RECV-LOC-NBR     TO PV-PREV-LOC-NBR          02440061
024500             SET PS-RECV-LOC-UPDATE-SE TO TRUE                    02450061
024600             PERFORM 2200-CHECK-RECV-LOC-NBR                      02460061
024700             IF  PS-RECV-LOC-UPDATE-SE                            02470061
024710                 PERFORM 2300-CHECK-INTR-START-DTE                02471073
024720                 IF  PS-RECV-LOC-UPDATE-SE                        02472073
024800                     PERFORM 9600-WRITE-PCRD010-RECORD            02480073
024810                 END-IF                                           02481073
024900             ELSE                                                 02490061
025000                 ADD +1 TO PV-INPUT-BYPASSED                      02500061
025100             END-IF                                               02510061
025200         END-IF                                                   02520061
025300     END-IF.                                                      02530058
025400                                                                  02540058
025500     PERFORM 9100-READ-INPUT-FILE.                                02550058
025600                                                                  02560058
025700***************************************************************** 02570058
025800* CHECK TO SEE IF THE DC ASSOCIATED TO THE RECEIVING STORE        02580058
025900* IS SET FOR UPDATE OF STORE EXPECTED.                            02590058
026000*                                                                 02600058
026100* THE FOLLOWING SQL IS TAKING THE CENTRAL STOCK PULL NUMBER AND   02610058
026200* CHECKING THE TCEPLST TABLE TO DETERMINE WHEN THE PULL WAS       02620058
026300* CREATED AND BUMPING THAT TO THE TKRPRPM TABLE TO SEE IF IT      02630058
026400* WAS CREATED AFTER STORE EXPECTED WAS TURNED ON FOR THE          02640058
026500* DC THAT SUPPORTS THE STORE GETTING THE CENTRAL STOCK            02650058
026600* MERCHANDISE.  THE SQL ALSO BUMPS AGAINST THE TKRPRPM TABLE      02660058
026700* USING THE CENTRAL STOCK LOCATION TO SEE IF THE CENTRAL STOCK    02670058
026800* LOCATION IS USING RDM (IN THIS CASE THE OUTBOUND CARTONS        02680058
026900* WOULD BE MANIFESTED - OTHERWISE THERE WOULD NOT BE MANIFESTED   02690058
027000* CARTONS).  AND LAST, THE SQL IS BUMPING THE RECEIVING STORE     02700058
027100* NUMBER AGAINST THE LOCATION MASTER TO SEE IF IT IS A            02710058
027200* VALID BUSINESS LOCATION AND MAKE SURE THAT THE RECEIVING STORE  02720058
027300* IS EITHER A DEPARTMENT STORE, OR A DC.                          02730058
027600***************************************************************** 02760058
027700 2200-CHECK-RECV-LOC-NBR.                                         02770058
027800                                                                  02780058
027900     IF PS-SHOW-PARAGRAPH                                         02790058
028000        DISPLAY '2200-CHECK-RECV-LOC-NBR'                         02800058
028100     END-IF.                                                      02810058
028200                                                                  02820058
028300     EXEC SQL                                                     02830058
028400         SELECT A.CNSTK_REQ_PL_NBR                                02840058
028500           INTO :CEPLRQ-CNSTK-REQ-PL-NBR                          02850058
028600         FROM TCEPLRQ   A                                         02860058
028700            , TCEPLST   B                                         02870058
028800            , XLT_DC_LOC_ASGMT   C                                02880058
028900            , TKRPRPM   D                                         02890058
029000            , TKRPRPM   E                                         02900058
029100            , XLT_LOC   F                                         02910058
029300         WHERE A.CNSTK_REQ_PL_NBR = :DK-CNSTK-REQ-PL-NBR          02930065
029310                                                                  02931072
029320           AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR            02932072
029330           AND B.STAT_CDE         = 'NW'                          02933072
029340           AND B.PL_LNE_NBR       = 0                             02934072
029350                                                                  02935072
029360           AND C.LOC_NBR          = :DK-RECV-LOC-NBR              02936072
029370           AND C.EFF_BEG_DTE      =                               02937072
029380                (SELECT MAX(EFF_BEG_DTE)                          02938072
029390                   FROM XLT_DC_LOC_ASGMT Z                        02939072
029400                  WHERE Z.LOC_NBR = C.LOC_NBR                     02940072
029500                    AND EFF_BEG_DTE <= CURRENT DATE)              02950072
029600                                                                  02960072
029700           AND D.LOC_ID           = C.DC_NBR                      02970072
029800           AND D.INTFC_SYS_CDE    = 'KHL'                         02980072
029900           AND D.SYS_PRC_FUNC_CDE = 'STREXP'                      02990072
030000                                                                  03000072
030100           AND B.CRE_TMST         >= D.FUNC_BEG_TMST              03010072
030200                                                                  03020072
030300           AND E.LOC_ID           = A.CNSTK_LOC_ID                03030072
030400           AND E.INTFC_SYS_CDE    = 'RDM'                         03040072
030500           AND E.SYS_PRC_FUNC_CDE = 'RDMCSL'                      03050072
030600           AND E.FUNC_PRC_STAT_CDE = 'AC'                         03060072
030700                                                                  03070072
030800           AND B.CRE_TMST         >= E.FUNC_BEG_TMST              03080072
030900           AND F.LOC_NBR           = C.LOC_NBR                    03090072
031000           AND F.LOC_TYP_CDE       = 'DS'                         03100072
031100                                                                  03110072
031700       END-EXEC.                                                  03170072
031800                                                                  03180072
031900     EVALUATE TRUE                                                03190072
032000         WHEN SQLCODE = ZERO                                      03200072
032100         WHEN SQLCODE = -811                                      03210072
032200              CONTINUE                                            03220072
032300         WHEN SQLCODE = +100                                      03230072
032400              SET PS-DONT-RECV-LOC-UPDATE-SE TO TRUE              03240072
032500         WHEN SQLCODE = -904                                      03250072
032600         WHEN SQLCODE = -911                                      03260072
032700         WHEN SQLCODE = -913                                      03270072
032800              MOVE SQLCODE TO PV-SQLCODE                          03280072
032900              MOVE '2200-CHECK-RECV-LOC-NBR'                      03290072
033000                                TO PV-ABEND-PARAGRAPH             03300072
033100              MOVE 'CONTENTION PROBLEM'                           03310072
033200                            TO PV-ABEND-OPERATION                 03320072
033300              PERFORM Z999-SQL-ABEND                              03330072
033400         WHEN SQLWARN0 NOT = SPACES                               03340072
033500         WHEN SQLCODE < +0                                        03350072
033600         WHEN SQLCODE > +0                                        03360072
033700              MOVE SQLCODE TO PV-SQLCODE                          03370072
033800              MOVE '2200-CHECK-RECV-LOC-NBR'                      03380072
033900                                TO PV-ABEND-PARAGRAPH             03390072
034000              MOVE 'SQL ERROR PROBLEM'                            03400072
034100                            TO PV-ABEND-OPERATION                 03410072
034200              PERFORM Z999-SQL-ABEND                              03420072
034300      END-EVALUATE.                                               03430072
034400                                                                  03440072
034500                                                                  03450072
034510 2300-CHECK-INTR-START-DTE.                                       03451073
034520                                                                  03452073
034530     IF PS-SHOW-PARAGRAPH                                         03453073
034540        DISPLAY '2300-CHECK-INTR-START-DTE'                       03454073
034550     END-IF.                                                      03455073
034560                                                                  03456073
034570     EXEC SQL                                                     03457073
034580         SELECT A.CNSTK_REQ_PL_NBR                                03458073
034590           INTO :CEPLRQ-CNSTK-REQ-PL-NBR                          03459073
034591         FROM TCEPLRQ   A                                         03459173
034592            , TCEPLST   B                                         03459273
034594            , TKRPRPM   C                                         03459474
034598         WHERE A.CNSTK_REQ_PL_NBR = :DK-CNSTK-REQ-PL-NBR          03459873
034600           AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR            03460073
034602           AND A.CNSTK_LOC_ID     = C.LOC_ID                      03460274
034603           AND B.STAT_CDE         = 'NW'                          03460373
034604           AND B.PL_LNE_NBR       = 0                             03460473
034612           AND C.INTFC_SYS_CDE    = 'KHL'                         03461274
034613           AND C.SYS_PRC_FUNC_CDE = 'CSITDT'                      03461374
034615           AND B.CRE_TMST         >= C.FUNC_BEG_TMST              03461574
034620           AND C.FUNC_PRC_STAT_CDE = 'AC'                         03462074
034631       END-EXEC.                                                  03463173
034632                                                                  03463273
034633     EVALUATE TRUE                                                03463373
034634         WHEN SQLCODE = ZERO                                      03463473
034635         WHEN SQLCODE = -811                                      03463573
034636              CONTINUE                                            03463673
034637         WHEN SQLCODE = +100                                      03463773
034638              SET PS-DONT-RECV-LOC-UPDATE-SE TO TRUE              03463873
034639         WHEN SQLCODE = -904                                      03463973
034640         WHEN SQLCODE = -911                                      03464073
034641         WHEN SQLCODE = -913                                      03464173
034642              MOVE SQLCODE TO PV-SQLCODE                          03464273
034643              MOVE '2300-CHECK-INTR-START-DTE'                    03464374
034644                                TO PV-ABEND-PARAGRAPH             03464473
034645              MOVE 'CONTENTION PROBLEM'                           03464573
034646                            TO PV-ABEND-OPERATION                 03464673
034647              PERFORM Z999-SQL-ABEND                              03464773
034648         WHEN SQLWARN0 NOT = SPACES                               03464873
034649         WHEN SQLCODE < +0                                        03464973
034650         WHEN SQLCODE > +0                                        03465073
034651              MOVE SQLCODE TO PV-SQLCODE                          03465173
034652              MOVE '2300-CHECK-INTR-START-DTE'                    03465274
034653                                TO PV-ABEND-PARAGRAPH             03465373
034654              MOVE 'SQL ERROR PROBLEM'                            03465473
034655                            TO PV-ABEND-OPERATION                 03465573
034656              PERFORM Z999-SQL-ABEND                              03465673
034657      END-EVALUATE.                                               03465773
034658                                                                  03465873
034659                                                                  03465973
034660***************************************************************** 03466073
034700*  FORMAT THE DATA FOR UPDATE OF THE STORE EXPECTED FOR THE       03470072
034800*  RECEIVING STORE FROM THE CERD004 DATA.                         03480072
034900***************************************************************** 03490072
035000 6000-BUILD-PCRD010-OUTPUT.                                       03500072
035100                                                                  03510072
035200     INITIALIZE PC010-PCT-INTRANSIT-REC.                          03520072
035300                                                                  03530072
035400     PERFORM 6100-CALL-XLKUT-DOMAIN-PGM.                          03540072
035500                                                                  03550072
035600     MOVE CE004-RECV-STORE-NMBR    TO PC010-STR-NBR.              03560072
035700     MOVE 'CS'                     TO PC010-TRN-TYP-CDE.          03570072
035800     MOVE CE004-RECV-STORE-QTY     TO PC010-IN-TRNST-QTY.         03580072
035900     MOVE PC-PROGRAM-NAME          TO PC010-UPD-USR-ID.           03590072
036000     MOVE CE004-REQ-NMBR           TO PV-INPUT-PULL-NBR.          03600072
036100     MOVE PV-INPUT-PULL-NBR-5      TO PC010-PO-NBR.               03610072
036200     MOVE ZEROS                    TO PC010-RCVR-SEQ-NBR          03620072
036300                                      PC010-TRIP-ID               03630072
036400                                      PC010-STAT-CDE-DS           03640072
036500                                      PC010-STAT-CDE-SU.          03650072
036600     MOVE 'SE'                     TO PC010-TRN-CLSN-CDE.         03660072
036700     MOVE ZEROS                    TO PC010-UPC-NBR.              03670072
036800                                                                  03680072
036900     MOVE 20                       TO PV-DB2-TMST-CC.             03690072
037000     MOVE CE004-FILLED-DATE-MMDDYY-YY                             03700072
037100                                   TO PV-DB2-TMST-YY.             03710072
037200     MOVE CE004-FILLED-DATE-MMDDYY-MM                             03720072
037300                                   TO PV-DB2-TMST-MM.             03730072
037400     MOVE CE004-FILLED-DATE-MMDDYY-DD                             03740072
037500                                   TO PV-DB2-TMST-DD.             03750072
037600     MOVE ZEROES                   TO PV-DB2-TMST-HH              03760072
037700                                      PV-DB2-TMST-MN              03770072
037800                                      PV-DB2-TMST-SS              03780072
037900                                      PV-DB2-TMST-TS.             03790072
038000                                                                  03800072
038100     MOVE PV-DB2-TMST              TO PC010-EVENT-TMST.           03810072
038200                                                                  03820072
038300                                                                  03830072
038400***************************************************************** 03840072
038500* XLKUT DOMAIN PGM IS CALLED                                      03850072
038600***************************************************************** 03860072
038700 6100-CALL-XLKUT-DOMAIN-PGM.                                      03870072
038800                                                                  03880072
038900     IF PS-SHOW-PARAGRAPH                                         03890072
039000        DISPLAY '6100-CALL-XLKUT-DOMAIN-PGM'                      03900072
039100     END-IF.                                                      03910072
039200                                                                  03920072
039300     INITIALIZE XL001-ITEM-COMMAREA.                              03930072
039400                                                                  03940072
039500     MOVE CE004-SKU  TO XL001-KEY-SKU.                            03950072
039600                                                                  03960072
039700     SET  XL001-BY-NUMERIC-SKU                                    03970072
039800          XL001-SELECT-SKU     TO TRUE.                           03980072
039900                                                                  03990072
040000     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                04000072
040100                                                                  04010072
040200     MOVE XL001-SKU-SQLCODE    TO SQLCODE.                        04020072
040300                                                                  04030072
040400     EVALUATE TRUE                                                04040072
040500       WHEN XL001-SKU-SQLCODE = +0                                04050072
040600            MOVE XL001-INTR-UPC-ID    TO PC010-INTR-UPC-ID        04060072
040700       WHEN XL001-SKU-SQLCODE = +100                              04070072
040800            DISPLAY 'SKU NOT FOUND --> ' XL001-KEY-SKU            04080072
040900            MOVE ZEROS                TO PC010-INTR-UPC-ID        04090072
041000       WHEN OTHER                                                 04100072
041100              DISPLAY 'XL001-SKU-SQLCODE ----> '                  04110072
041200                       XL001-SKU-SQLCODE                          04120072
041300                      ' - '                                       04130072
041400                       XL001-KEY-SKU                              04140072
041500              MOVE XL001-SKU-SQLCODE      TO PV-SQLCODE           04150072
041600              MOVE '6100-CALL-XLKUT-DOMAIN-PGM'                   04160072
041700                                TO PV-ABEND-PARAGRAPH             04170072
041800              MOVE 'BAD RETURN FROM XLKUT001'                     04180072
041900                            TO PV-ABEND-OPERATION                 04190072
042000              PERFORM Z999-SQL-ABEND                              04200072
042100     END-EVALUATE.                                                04210072
042200                                                                  04220072
042300***************************************************************** 04230072
042400 9100-READ-INPUT-FILE.                                            04240072
042500***************************************************************** 04250072
042600                                                                  04260072
042700     READ CNSTK-FILE INTO CE004-CENTRAL-STK-XFER-RECORD           04270072
042800        AT END                                                    04280072
042900           SET PS-EOF-CNSTK-FILE     TO TRUE                      04290072
043000        NOT AT END                                                04300072
043100            ADD  +1                    TO PV-RECORDS-READ-QTY     04310072
043200     END-READ.                                                    04320072
043300                                                                  04330072
043400***************************************************************** 04340072
043500 9600-WRITE-PCRD010-RECORD.                                       04350072
043600                                                                  04360072
043700     MOVE '9600-WRITE-PCRD010-RECORD' TO PV-ABEND-PARAGRAPH.      04370072
043800                                                                  04380072
043900     PERFORM 6000-BUILD-PCRD010-OUTPUT.                           04390072
044000     WRITE STR-EXPECT-RECORD FROM PC010-PCT-INTRANSIT-REC.        04400072
044100     ADD 1 TO PV-PCRD010-OUT.                                     04410072
044200                                                                  04420072
044300***************************************************************** 04430072
044400 9900-EOJ-ROUTINE.                                                04440072
044500***************************************************************** 04450072
044600                                                                  04460072
044700     CLOSE  CNSTK-FILE                                            04470072
044800           STR-EXPECT-FILE.                                       04480072
044900                                                                  04490072
045000     DISPLAY ' '.                                                 04500072
045100     MOVE PV-RECORDS-READ-QTY TO PV-DISPLAY-COUNT.                04510072
045200     DISPLAY 'NUMBER CERD004 FILE IN -------> '                   04520072
045300              PV-DISPLAY-COUNT                                    04530072
045400             ' - INP01'.                                          04540072
045500     DISPLAY ' '.                                                 04550072
045600     MOVE PV-SQL-CHECK-DONE   TO PV-DISPLAY-COUNT.                04560072
045700     DISPLAY 'NUMBER RECORDS SQL DONE-------> '                   04570072
045800              PV-DISPLAY-COUNT                                    04580072
045900             ' - INP01'.                                          04590072
046000     DISPLAY ' '.                                                 04600072
046100     MOVE PV-SQL-CHECK-BYPASSED TO PV-DISPLAY-COUNT.              04610072
046200     DISPLAY 'NUMBER RECORDS SQL BYPASSED --> '                   04620072
046300              PV-DISPLAY-COUNT                                    04630072
046400             ' - INP01'.                                          04640072
046500     DISPLAY ' '.                                                 04650072
046600     MOVE PV-PCRD010-OUT        TO PV-DISPLAY-COUNT.              04660072
046700     DISPLAY 'NUMBER PCRD010 FILE OUT ------> '                   04670072
046800              PV-DISPLAY-COUNT                                    04680072
046900             ' - OUT01 DD'.                                       04690072
047000     MOVE PV-INPUT-BYPASSED     TO PV-DISPLAY-COUNT.              04700072
047100     DISPLAY 'NUMBER CERD004 INPUT BYPASSED > '                   04710072
047200              PV-DISPLAY-COUNT.                                   04720072
047300     DISPLAY ' '.                                                 04730072
047400     MOVE PV-INPUT-BYPASSED-ZERO TO PV-DISPLAY-COUNT.             04740072
047500     DISPLAY 'NUMBER CERD004 INPUT BYPASS 0 > '                   04750072
047600              PV-DISPLAY-COUNT.                                   04760072
047700     DISPLAY ' '.                                                 04770072
047800     DISPLAY ' '.                                                 04780072
047900                                                                  04790072
048000     DISPLAY '******************'.                                04800072
048100     DISPLAY '*  END CEKUT011  *'.                                04810072
048200     DISPLAY '******************'.                                04820072
048300                                                                  04830072
048400***************************************************************** 04840072
048500 Z999-SQL-ABEND.                                                  04850072
048600***************************************************************** 04860072
048700                                                                  04870072
048800     DISPLAY '*** DB2 ERROR '.                                    04880072
048900     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       04890072
049000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04900072
049100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04910072
049200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04920072
049300                                                                  04930072
049400     COPY DPPD004.                                                04940072
049500                                                                  04950072
049600                                                                  04960072
049700     MOVE +4013                  TO PV-ABEND-CODE.                04970072
049800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04980072
049900***************************************************************** 04990072
