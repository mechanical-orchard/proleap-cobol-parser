000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300* NON-TERMINALLY ATTACHED PROGRAM                                 00030000
000310* THIS PROGRAM IS STARTED BY WEBSERVICE SUKCS801                  00031022
000320* THIS IS CALLED WHEN A STORE IS TRYING TO OPEN A TRAILER TO      00032000
000330* RECEIVE THE CARTONS, BUT THE TRAILER IS IN A DO OR DC STATUS.   00033000
000340* THIS PROGRAM WILL START JOB SUK950 TO SEND AN EMAIL TO DC LP,   00034000
000350* GATE HOUSE AND LOGISTICS SUPPORT TEAM TO INDICATE THAT THE      00035000
000360* TRIP SHOULD BE LOOKED AT.  IF THE TRAILER IS AT THE STORE       00036000
000370* THEN IT SHOULD BE UPDATED TO A DS STATUS.  IF THE STORE MISKEYED00037000
000380* THE SEAL THE NOTHING NEEDS TO BE DONE.                          00038000
000400******************************************************************00040000
000500 PROGRAM-ID.             SUKCS541.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            JANUARY, 2020.                           00080002
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600******************************************************************00160000
001700 01  CA-COMMAREA.                                                 00170000
001710     05  CA-TRLR-SEAL-ID                 PIC   X(20).             00171011
001720                                                                  00172011
001730* OUTPUT LAYOUT                                                   00173011
001800     COPY SURD167.                                                00180000
001810                                                                  00181025
001900* TUPLDER PKT_TXT LAYOUT FOR LOGGING                              00190025
002000     COPY SUWS107.                                                00200025
002800                                                                  00280000
002810 01  DK-DB2-KEYS.                                                 00281008
002820     05  DK-TRLR-SEAL-ID                 PIC  X(20).              00282008
002821     05  DK-OTBND-TRIP-ID                PIC S9(9) COMP.          00282109
002830                                                                  00283008
002900 01  PC-PROGRAM-CONSTANTS.                                        00290000
002910     05  PC-TRLR-STATUS-EMAIL-PROC       PIC  X(07)               00291000
002920                                              VALUE 'SUK9501'.    00292000
002930     05  PC-TRLR-STATUS-EMAIL-JOB        PIC  X(07)               00293000
002940                                              VALUE 'SUK950'.     00294000
002950                                                                  00295000
003200     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00320008
003300         'SUKCS541'.                                              00330008
004570*                                                                 00457000
004580     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E892'.00458000
004590     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'E893'.00459000
004600*                                                                 00460000
006646     05  PC-TEST                         PIC X(01)   VALUE 'T'.   00664609
006647     05  PC-QA                           PIC X(01)   VALUE 'Q'.   00664709
006648*                                                                 00664800
006660                                                                  00666000
006670 01  PS-PROGRAM-SWITCHES.                                         00667010
006800     05  PS-ABEND-IND                    PIC  X(01)  VALUE 'N'.   00680009
006900         88  PS-NO-ABEND                             VALUE 'N'.   00690018
007000         88  PS-ABEND                                VALUE 'Y'.   00700018
007100     05  PS-INTERNAL-READER-ENQ-DEQ-IND  PIC  X(01)  VALUE 'D'.   00710009
007200         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   00720009
007300         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   00730009
007310     05  PS-EMAIL-PREV-SENT-SW           PIC  X(01)  VALUE 'N'.   00731026
007320         88  PS-EMAIL-PREV-SENT-NO                   VALUE 'N'.   00732026
007330         88  PS-EMAIL-PREV-SENT-YES                  VALUE 'Y'.   00733026
007340     05  PS-SHIPPING-TRLR-SW             PIC  X(01)  VALUE 'N'.   00734032
007350         88  PS-SHIPPING-TRLR-NO                     VALUE 'N'.   00735032
007360         88  PS-SHIPPING-TRLR-YES                    VALUE 'Y'.   00736032
007400                                                                  00740009
007500                                                                  00750000
007600 01  PV-PROGRAM-VARIABLES.                                        00760000
007601     05  PV-SYSTEM-ID.                                            00760100
007602         10  FILLER                      PIC  X(04)  VALUE SPACE. 00760200
007603         10  PV-REGION-IND               PIC  X(01).              00760300
007604             88  PV-TEST-CICS                        VALUE 'T'.   00760400
007605             88  PV-QA-CICS                          VALUE 'Q'.   00760500
007606             88  PV-PROD-CICS                        VALUE 'P'.   00760600
007607             88  PV-LEARN-CICS                       VALUE 'L'.   00760700
007608         10  FILLER                      PIC  X(03)  VALUE SPACES.00760800
007609     05  PV-TASK-X.                                               00760909
007610         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  00761009
007611     05  PV-CICS-MSG-AREA                PIC  X(120) VALUE SPACE. 00761109
007612                                                                  00761200
007613     05  PV-USER-ID                      PIC  X(07)  VALUE SPACE. 00761305
007620     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   00762009
007630                                                     COMP.        00763009
007670     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00767009
007680                                                     COMP SYNC.   00768009
007690     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00769017
007700                                                COMP SYNC.        00770017
007800*                                                                 00780000
007900     05  PC-LEAVE-SYSTEM-LENGTH          PIC S9(04)  VALUE +160   00790010
008000                                                     COMP SYNC.   00800010
008100     05  PV-LEAVE-SYSTEM-MESSAGE         PIC X(160)  VALUE SPACES.00810010
008193     05  PV-JOB-PROC                     PIC  X(07)  VALUE SPACES.00819309
008194     05  PV-JOB-NAME                     PIC  X(07)  VALUE SPACES.00819409
008196     05  PV-DISP-TRIP-ID                 PIC  Z(09)  VALUE ZEROES.00819609
008197     05  PV-WRITE-LENGTH                 PIC S9(04)  VALUE ZEROES 00819710
008198                                                     COMP.        00819810
008199     05  PV-EMAIL-CNT                    PIC S9(09)  COMP.        00819926
008200                                                                  00820010
008201 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  00820110
008202     05  TS-INFO-QUEUE-NAME.                                      00820210
008203         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 00820310
008210         10  FILLER                      PIC  X(04)  VALUE 'INFO'.00821009
008300                                                                  00830000
008310*----------------------------------------------------------------*00831000
008320*  JCL LINES FOR REQUESTING THE COMPLETION/EXCEPTION REPORTS      00832000
008330*----------------------------------------------------------------*00833000
008332* PROD/LEARN JCL SETUP                                            00833203
008333*     //SUK950   JOB KOHLS,'TRLR ST EMAIL',MSGCLASS=P,CLASS=U     00833303
008334*     /*JOBPARM K=O                                               00833403
008336*     //JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR                     00833603
008337*     //PS020    EXEC SUK9501                                     00833703
008338*     //S010.SYSUT1 DD *                                          00833803
008339*     XXXXXXXXX(SUCC096 IN SURD167 FORMAT)                        00833903
008343*     /*EOF                                                       00834303
008344*-----------------------------------------------------------------00834403
008345* TEST JCL SETUP                                                  00834503
008346*     //XXXXXXXQ JOB KOHLS,'TRLR ST EMAIL',MSGCLASS=X,CLASS=E     00834603
008348*     //JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR                     00834803
008349*     //PS020    EXEC SUK9501T                                    00834903
008350*     //S010.SYSUT1 DD *                                          00835003
008351*     XXXXXXXXX(SUCC096 IN SURD167 FORMAT)                        00835103
008355*     /*EOF                                                       00835503
008356*----------------------------------------------------------------*00835603
008357 01  JL-JCL-LINE-AREA.                                            00835700
008358     05  JL-JCL-LINE-1           PIC X(80).                       00835800
008360     05  JL-JOB-LINE-PROD.                                        00836000
008370         10  FILLER              PIC X(02)    VALUE               00837000
008380             '//'.                                                00838000
008390         10  JL-PROD-JOB-NAME    PIC X(07)    VALUE SPACE.        00839000
008391         10  FILLER              PIC X(12)    VALUE               00839100
008392             '  JOB KOHLS,'.                                      00839200
008393         10  FILLER              PIC X(1)     VALUE QUOTE.        00839300
008394         10  JL-PROD-JOB-DESC    PIC X(16)    VALUE               00839405
008395             'STR TRIP E-MAIL '.                                  00839505
008396         10  FILLER              PIC X(1)     VALUE QUOTE.        00839605
008397         10  FILLER              PIC X(19)    VALUE               00839705
008398             ',MSGCLASS=P,CLASS=U'.                               00839805
008399         10  FILLER              PIC X(13)    VALUE SPACES.       00839905
008400     05  JL-JOB-LINE-TEST.                                        00840005
008401         10  FILLER              PIC X(02)    VALUE               00840105
008402             '//'.                                                00840205
008403         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       00840305
008404         10  FILLER              PIC X(01)    VALUE               00840405
008405             'Q'.                                                 00840505
008406         10  FILLER              PIC X(11)    VALUE               00840605
008407             ' JOB KOHLS,'.                                       00840705
008408         10  FILLER              PIC X(1)     VALUE QUOTE.        00840805
008409         10  JL-TEST-JOB-DESC    PIC X(16)    VALUE               00840905
008410             'STR TRIP E-MAIL '.                                  00841005
008411         10  FILLER              PIC X(1)     VALUE QUOTE.        00841105
008412         10  FILLER              PIC X(19)    VALUE               00841205
008413             ',MSGCLASS=X,CLASS=E'.                               00841305
008414         10  FILLER              PIC X(15)    VALUE SPACES.       00841405
008415     05  JL-JCL-LINE-3.                                           00841505
008416         10  FILLER              PIC X(13)    VALUE               00841605
008417             '/*JOBPARM K=0'.                                     00841705
008418         10  FILLER              PIC X(67)    VALUE SPACES.       00841805
008419     05  JL-JCL-LINE-4-PROD.                                      00841905
008420         10  FILLER              PIC X(39)    VALUE               00842005
008421             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           00842105
008422         10  FILLER              PIC X(41)    VALUE SPACES.       00842205
008423     05  JL-JCL-LINE-4-TEST.                                      00842305
008424         10  FILLER              PIC X(39)    VALUE               00842405
008425             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           00842505
008426         10  FILLER              PIC X(41)    VALUE SPACES.       00842605
008427     05  JL-JCL-LINE-4-QA.                                        00842705
008428         10  FILLER              PIC X(39)    VALUE               00842805
008429             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           00842905
008430         10  FILLER              PIC X(41)    VALUE SPACES.       00843005
008431     05  JL-JCL-LINE-12.                                          00843105
008432         10  FILLER              PIC X(16)    VALUE               00843205
008440             '//PS020    EXEC '.                                  00844000
008441         10  JL-LINE-12-PROC     PIC X(07)    VALUE SPACES.       00844100
008442         10  JL-LINE-12-PROC-T   PIC X(01)    VALUE SPACES.       00844200
008443         10  FILLER              PIC X(55)    VALUE SPACES.       00844300
008453*BUILD TRIP CONTROL CARD-SUCC096                                  00845303
008454     05  JL-JCL-LINE-14.                                          00845400
008455         10  FILLER              PIC X(18)    VALUE               00845500
008456             '//S010.SYSUT1 DD *'.                                00845600
008457         10  FILLER              PIC X(62)    VALUE SPACES.       00845700
008458     05  JL-JCL-LINE-15.                                          00845800
008459         10  JL-LINE-15-TRLR-SEAL-ID  PIC X(20).                  00845903
008460         10  FILLER                   PIC X(01) VALUE SPACE.      00846003
008461         10  JL-LINE-15-OTBND-TRIP-ID PIC 9(10).                  00846103
008462         10  FILLER                   PIC X(01) VALUE SPACE.      00846203
008463         10  JL-LINE-15-DC-OPER       PIC 9(04).                  00846303
008464         10  FILLER                   PIC X(01) VALUE SPACE.      00846403
008465         10  JL-LINE-15-STR-OPER      PIC 9(04).                  00846503
008466         10  FILLER                   PIC X(01) VALUE SPACE.      00846603
008467         10  JL-LINE-15-TRLR-SRL      PIC 9(10).                  00846703
008468         10  FILLER                   PIC X(01) VALUE SPACE.      00846803
008469         10  JL-LINE-15-TRIP-STAT-CDE PIC X(02).                  00846903
008470         10  FILLER                   PIC X(01) VALUE SPACE.      00847003
008471         10  JL-LINE-15-SCAC-CDE      PIC X(04).                  00847103
008472         10  FILLER                   PIC X(01) VALUE SPACE.      00847203
008473         10  JL-LINE-15-TRLR-ID       PIC X(12).                  00847303
008474         10  FILLER                   PIC X(07) VALUE SPACE.      00847403
008479     05  JL-JCL-LINE-EOF.                                         00847903
008480         10  FILLER              PIC X(5)     VALUE '/*EOF'.      00848003
008481         10  FILLER              PIC X(75)    VALUE SPACES.       00848103
008482                                                                  00848203
008483 01  TD-TRANSIENT-DATA-AREA.                                      00848303
008484     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       00848403
008485     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            00848503
008486                                 COMP SYNC.                       00848603
008487     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       00848703
008488     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           00848803
008489                                 COMP SYNC.                       00848903
008490                                                                  00849003
008491*                                                                 00849103
008492 01  SE-SYSTEM-ERROR-MESSAGE.                                     00849209
008493     05  FILLER                  PIC X(43)    VALUE               00849309
008494         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           00849409
008495     05  FILLER                  PIC X(33)    VALUE               00849509
008496         'PROGRAM SUKCS541       EIBRESP = '.                     00849609
008497     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         00849709
008498     05  FILLER                  PIC X(5)     VALUE SPACES.       00849809
008499     05  FILLER                  PIC X(14)    VALUE               00849909
008500         'ATTEMPTING TO '.                                        00850009
008501     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       00850109
008502                                                                  00850209
008508                                                                  00850809
008850******************************************************************00885000
008860*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00886000
008870******************************************************************00887000
008880     COPY DPWS013.                                                00888008
008890                                                                  00889008
012200******************************************************************01220000
012300*  OUTBOUND TRIP                                                  01230003
012500******************************************************************01250000
012600     EXEC SQL                                                     01260003
012601         INCLUDE TSUOBTR                                          01260103
012602     END-EXEC.                                                    01260203
012603                                                                  01260303
012604******************************************************************01260403
012605*  OUTBOUND TRIP STATUS                                           01260503
012606******************************************************************01260603
012607     EXEC SQL                                                     01260703
012608         INCLUDE TSUOBTS                                          01260803
012609     END-EXEC.                                                    01260903
012610                                                                  01261003
012611******************************************************************01261103
012612*  OUTBOUND TRAILER                                               01261203
012613******************************************************************01261303
012614     EXEC SQL                                                     01261403
012615         INCLUDE TCNTRID                                          01261503
012616     END-EXEC.                                                    01261603
012617                                                                  01261703
012618******************************************************************01261808
012619*  TKRPRPM - PARM TABLE                                           01261908
012620******************************************************************01262008
012621     EXEC SQL                                                     01262108
012622         INCLUDE TKRPRPM                                          01262208
012623     END-EXEC.                                                    01262308
012624                                                                  01262408
012625******************************************************************01262523
012626*  TUPLDER - UPLOAD ERROR TABLE                                   01262623
012627******************************************************************01262723
012628     EXEC SQL                                                     01262823
012629         INCLUDE TUPLDER                                          01262923
012630     END-EXEC.                                                    01263023
012640                                                                  01264023
012675******************************************************************01267500
012676*  COMMUNICATIONS AREA FOR DB2                                    01267600
012677******************************************************************01267700
012678     EXEC SQL                                                     01267806
012679         INCLUDE SQLCA                                            01267906
012680     END-EXEC.                                                    01268006
012681                                                                  01268106
012682******************************************************************01268200
012683 LINKAGE SECTION.                                                 01268308
012684******************************************************************01268400
012685 01  DFHCOMMAREA.                                                 01268503
012686     05  FILLER                         OCCURS  1 TO 4072 TIMES   01268603
012687                                      DEPENDING ON EIBCALEN.      01268703
012688         10  FILLER                   PIC X.                      01268803
012689                                                                  01268903
012690******************************************************************01269000
012691 PROCEDURE DIVISION.                                              01269107
012700******************************************************************01270000
012800 0000-PROGRAM-MAINLINE.                                           01280001
012810                                                                  01281001
012820** FROM SUKCS801 - BEGIN                                          01282018
012830                                                                  01283018
012902     MOVE LENGTH CA-COMMAREA  TO PV-COMMAREA-LENGTH.              01290217
012903                                                                  01290317
012904     EXEC CICS                                                    01290417
012905         RETRIEVE                                                 01290517
012906         INTO(CA-COMMAREA)                                        01290617
012907         LENGTH(PV-COMMAREA-LENGTH)                               01290717
012908         RESP(PV-CICS-RESPONSE)                                   01290817
012909     END-EXEC.                                                    01290917
012910                                                                  01291017
012921     MOVE EIBTASKN               TO PV-TASK.                      01292101
012930                                                                  01293001
012960     STRING ' SUKCS541 STARTED - TASK = ' PV-TASK-X               01296001
012961            '  TRLR SEAL: '  CA-TRLR-SEAL-ID                      01296118
012970     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                     01297001
012980     PERFORM 9990-WRITE-CICS.                                     01298001
012990                                                                  01299003
012991     PERFORM 1300-FIND-LOGON-INFO.                                01299104
012992                                                                  01299204
012993     IF  PS-NO-ABEND                                              01299318
012994         PERFORM 1000-GET-TRIP-INFO                               01299418
012995     END-IF.                                                      01299518
012996                                                                  01299604
012997     IF  PS-NO-ABEND                                              01299718
012998         PERFORM 1100-GET-CURRENT-STATUS                          01299818
012999     END-IF.                                                      01299918
013030                                                                  01303003
013031     IF SUOBTR-DOOR-TYP-CDE  = 'SH'                               01303132
013032        SET  PS-SHIPPING-TRLR-YES  TO  TRUE                       01303232
013033     ELSE                                                         01303332
013034        SET  PS-SHIPPING-TRLR-NO   TO  TRUE                       01303432
013035     END-IF.                                                      01303532
013036                                                                  01303632
013038     IF  PS-NO-ABEND                                              01303832
013039         IF  PS-SHIPPING-TRLR-YES                                 01303932
013040             PERFORM 4100-CHECK-PREV-EMAIL                        01304032
013041             IF  PS-EMAIL-PREV-SENT-NO                            01304132
013042                 PERFORM 9000-SUBMIT-REQUEST                      01304232
013043                 PERFORM 4000-LOG-REQUEST                         01304332
013044             ELSE                                                 01304432
013045                 MOVE SPACES  TO  PV-CICS-MSG-AREA                01304532
013046                 STRING ' SUKCS541 ENDED - TASK = '               01304632
013047                          PV-TASK-X                               01304732
013048                        '  TRLR SEAL: '  CA-TRLR-SEAL-ID          01304832
013049                        '  EMAIL PREVIOUSLY SENT - NO EMAIL'      01304932
013050                                             DELIMITED BY SIZE    01305032
013051                   INTO PV-CICS-MSG-AREA                          01305132
013052                PERFORM 9990-WRITE-CICS                           01305232
013053              END-IF                                              01305332
013054         ELSE                                                     01305432
013055              PERFORM 4000-LOG-REQUEST                            01305532
013056              MOVE SPACES  TO  PV-CICS-MSG-AREA                   01305632
013057              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID          01305732
013058              STRING ' SUKCS541 ENDED - TASK = '                  01305832
013059                       PV-TASK-X                                  01305932
013060                     '  SEAL:'        CA-TRLR-SEAL-ID             01306032
013061                     '  SCAC/TRLR:'   CNTRID-SCAC-CDE             01306132
013062                     '/'              CNTRID-TRLR-ID              01306232
013063                     '  TRIP:'        PV-DISP-TRIP-ID             01306332
013064                     ' '              SUOBTR-DOOR-TYP-CDE         01306432
013065                     '  NO EMAIL SENT-NOT A SH TRLR'              01306532
013066                                          DELIMITED BY SIZE       01306632
013067                INTO PV-CICS-MSG-AREA                             01306732
013068             PERFORM 9990-WRITE-CICS                              01306832
013069          END-IF                                                  01306932
013070     END-IF.                                                      01307032
013071                                                                  01307132
013072     STRING ' SUKCS541 ENDED - TASK = '                           01307232
013073            PV-TASK-X                                             01307332
013074            '  TRLR SEAL: '  CA-TRLR-SEAL-ID                      01307432
013075            '  PS-ABEND-IND:' PS-ABEND-IND                        01307532
013076                                         DELIMITED BY SIZE        01307632
013077       INTO PV-CICS-MSG-AREA.                                     01307732
013078     PERFORM 9990-WRITE-CICS.                                     01307832
013080                                                                  01308003
015900     GOBACK.                                                      01590003
016000                                                                  01600003
016100                                                                  01610003
016101*---------------------------------------------------------------  01610103
016102* GET TRIP INFORMATION FROM SEAL PROVIDED                      -  01610203
016103*---------------------------------------------------------------  01610303
016104 1000-GET-TRIP-INFO.                                              01610403
016105                                                                  01610503
016106     MOVE  CA-TRLR-SEAL-ID     TO  DK-TRLR-SEAL-ID.               01610611
016107                                                                  01610703
016108     EXEC SQL                                                     01610803
016109            SELECT DISTINCT OTBND_TRIP_ID                         01610903
016110              INTO :SUOBTS-OTBND-TRIP-ID                          01611003
016112              FROM TSUOBTS                                        01611203
016114             WHERE TRLR_SEAL_ID  = :DK-TRLR-SEAL-ID               01611403
016116              WITH UR                                             01611603
016117     END-EXEC.                                                    01611703
016118                                                                  01611803
016121     EVALUATE TRUE                                                01612120
016122        WHEN  SQLCODE = ZERO                                      01612220
016123              MOVE SUOBTS-OTBND-TRIP-ID  TO  DK-OTBND-TRIP-ID     01612320
016124                                                                  01612420
016125        WHEN SQLWARN0 NOT = SPACES                                01612520
016126        WHEN SQLCODE < ZERO                                       01612620
016127        WHEN SQLCODE > ZERO                                       01612720
016128            MOVE '1000-GET-TRIP-INFO'                             01612820
016129                                  TO DP013-PARAGRAPH              01612920
016130            MOVE 'SELECT OF TSUOBTS TABLE'                        01613020
016131                                  TO DP013-MESSAGE-TEXT(1)        01613120
016132            STRING 'SEAL:'  DK-TRLR-SEAL-ID                       01613220
016133                                     DELIMITED BY SIZE            01613320
016134                                INTO DP013-MESSAGE-TEXT(2)        01613420
016135            MOVE SQLCA            TO DP013-SQLCA                  01613520
016136            MOVE 'TSUOBTS'        TO DP013-DB2-TABLE-NAME (1)     01613620
016137            SET DP013-DB2-ABEND   TO TRUE                         01613720
016138            SET DP013-NO-ROLLBACK TO TRUE                         01613820
016139            SET PS-ABEND          TO TRUE                         01613920
016140            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                01614020
016142     END-EVALUATE.                                                01614203
016144                                                                  01614403
016145                                                                  01614503
016146*---------------------------------------------------------------  01614603
016147* GET CURRENT STATUS FOR THE TRIP                              -  01614704
016148*---------------------------------------------------------------  01614803
016149 1100-GET-CURRENT-STATUS.                                         01614904
016150                                                                  01615003
016151     EXEC SQL                                                     01615103
016152          SELECT A.OTBND_TRIP_ID                                  01615204
016153               , B.DEST_OPER_UNT_ID                               01615304
016154               , B.TRLR_SRL_NBR                                   01615404
016155               , A.TRIP_STAT_CDE                                  01615504
016156               , A.OTBND_STAT_TMST                                01615604
016157               , A.TRLR_SEAL_ID                                   01615704
016158               , C.SCAC_CDE                                       01615804
016159               , C.TRLR_ID                                        01615904
016160               , B.ORGN_OPER_UNT_ID                               01616004
016161               , B.DOOR_TYP_CDE                                   01616131
016162            INTO :SUOBTS-OTBND-TRIP-ID                            01616231
016163               , :SUOBTR-DEST-OPER-UNT-ID                         01616331
016164               , :SUOBTR-TRLR-SRL-NBR                             01616431
016165               , :SUOBTS-TRIP-STAT-CDE                            01616531
016166               , :SUOBTS-OTBND-STAT-TMST                          01616631
016167               , :SUOBTS-TRLR-SEAL-ID                             01616731
016168               , :CNTRID-SCAC-CDE                                 01616831
016169               , :CNTRID-TRLR-ID                                  01616931
016170               , :SUOBTR-ORGN-OPER-UNT-ID                         01617031
016171               , :SUOBTR-DOOR-TYP-CDE                             01617131
016172            FROM TSUOBTS A                                        01617231
016173               , TSUOBTR B                                        01617331
016174               , TCNTRID C                                        01617431
016175           WHERE A.OTBND_TRIP_ID = :DK-OTBND-TRIP-ID              01617531
016176             AND A.OTBND_TRIP_ID =  B.OTBND_TRIP_ID               01617631
016177             AND B.TRLR_SRL_NBR  =  C.TRLR_SRL_NBR                01617731
016178             AND A.OTBND_STAT_TMST IN                             01617831
016179                 (SELECT MAX(D.OTBND_STAT_TMST)                   01617931
016180                    FROM TSUOBTS D                                01618031
016181                   WHERE A.OTBND_TRIP_ID  =  D.OTBND_TRIP_ID)     01618131
016182              WITH UR                                             01618231
016183     END-EXEC.                                                    01618331
016184                                                                  01618431
016185     EVALUATE TRUE                                                01618531
016186        WHEN  SQLCODE = ZERO                                      01618631
016187              CONTINUE                                            01618731
016188                                                                  01618831
016189        WHEN SQLWARN0 NOT = SPACES                                01618931
016190        WHEN SQLCODE < ZERO                                       01619031
016191        WHEN SQLCODE > ZERO                                       01619131
016192            MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID            01619231
016193            MOVE '1100-GET-CURRENT-STATUS  '                      01619331
016194                                  TO DP013-PARAGRAPH              01619431
016195            MOVE DK-TRLR-SEAL-ID                                  01619531
016196                                  TO DP013-MESSAGE-TEXT(1)        01619631
016197            MOVE PV-DISP-TRIP-ID                                  01619731
016198                                  TO DP013-MESSAGE-TEXT(2)        01619831
016199            MOVE SQLCA            TO DP013-SQLCA                  01619931
016200            MOVE 'TSUOBTS'        TO DP013-DB2-TABLE-NAME (1)     01620031
016201            MOVE 'TSUOBTR'        TO DP013-DB2-TABLE-NAME (2)     01620131
016202            MOVE 'TCNTRID'        TO DP013-DB2-TABLE-NAME (3)     01620231
016203            SET DP013-DB2-ABEND   TO TRUE                         01620331
016204            SET DP013-NO-ROLLBACK TO TRUE                         01620431
016205            SET PS-ABEND          TO TRUE                         01620531
016206            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                01620631
016207     END-EVALUATE.                                                01620731
016208                                                                  01620831
016209                                                                  01620931
022240******************************************************************02224000
022250*  DETERMINE WHICH CICS REGION THE TRANSACTION IS RUNNING IN.     02225004
022260*  IF WE ARE RUNNING IN CICST1 (TEST) OR CICSQT (QA) THEN         02226004
022270*  WE WILL HAVE TO SELECT THE TK# FOR THE JOB TO BE SUBMITTED     02227004
022280*  UNDER USING PARM (TKRPRPM-SUOBTK).  IF RUNNING IN PROD THE JOB 02228004
022290*  WILL BE SUK950.                                                02229004
022294******************************************************************02229400
022295 1300-FIND-LOGON-INFO.                                            02229504
022296                                                                  02229604
022303     EXEC CICS ASSIGN                                             02230304
022304               APPLID(PV-SYSTEM-ID)                               02230404
022309     END-EXEC.                                                    02230904
022310                                                                  02231004
022311     IF  PV-TEST-CICS  OR                                         02231104
022312         PV-QA-CICS                                               02231209
022313         PERFORM 1400-GET-USER-ID                                 02231304
022314     END-IF.                                                      02231404
022315                                                                  02231504
022316                                                                  02231604
022317******************************************************************02231704
022318*                                                                *02231804
022319******************************************************************02231904
022320 1400-GET-USER-ID.                                                02232004
022321                                                                  02232104
022322     EXEC SQL                                                     02232204
022323          SELECT FUNC_TXT                                         02232304
022324            INTO :KRPRPM-FUNC-TXT                                 02232404
022325            FROM TKRPRPM                                          02232504
022326           WHERE LOC_ID             =  90                         02232604
022327             AND INTFC_SYS_CDE      = 'KHL'                       02232704
022328             AND SYS_PRC_FUNC_CDE   = 'SUOBTK'                    02232804
022329             AND FUNC_PRC_STAT_CDE  = 'AC'                        02232904
022330             AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP           02233004
022331             AND FUNC_END_TMST     >= CURRENT TIMESTAMP           02233104
022340            WITH UR                                               02234004
022350     END-EXEC.                                                    02235004
022351                                                                  02235104
022352     EVALUATE TRUE                                                02235204
022353        WHEN  SQLCODE = ZERO                                      02235304
022354              MOVE KRPRPM-FUNC-TXT  TO  PV-USER-ID                02235404
022355                                                                  02235504
022356        WHEN SQLWARN0 NOT = SPACES                                02235604
022357        WHEN SQLCODE < ZERO                                       02235704
022358        WHEN SQLCODE > ZERO                                       02235804
022360            MOVE '1400-GET-USER-ID         '                      02236004
022361                                  TO DP013-PARAGRAPH              02236109
022362            MOVE 'TKRPRPM:  SUOBTK'                               02236204
022363                                  TO DP013-MESSAGE-TEXT(1)        02236304
022364            MOVE 'GET TK FOR TEST/QA EXECUTION OF SUK950'         02236404
022365                                  TO DP013-MESSAGE-TEXT(2)        02236504
022366            MOVE SQLCA            TO DP013-SQLCA                  02236604
022367            MOVE 'TKRPRPM'        TO DP013-DB2-TABLE-NAME (1)     02236704
022369            SET DP013-DB2-ABEND   TO TRUE                         02236904
022370            SET DP013-NO-ROLLBACK TO TRUE                         02237004
022371            SET PS-ABEND          TO TRUE                         02237118
022372            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02237204
022373     END-EVALUATE.                                                02237304
022374                                                                  02237404
022375                                                                  02237524
022376*----------------------------------------------------------------*02237624
022377* LOG EMAIL REQUESTED IN TUPLDER                                 *02237724
022378*----------------------------------------------------------------*02237824
022379 4000-LOG-REQUEST.                                                02237924
022388                                                                  02238824
022389     MOVE SPACES                   TO SU107-RECORD-LAYOUT.        02238925
022390     MOVE SUOBTS-TRLR-SEAL-ID      TO SU107-SEAL-ID.              02239025
022391     MOVE SUOBTS-OTBND-TRIP-ID     TO SU107-TRIP-ID.              02239125
022392     MOVE SUOBTR-ORGN-OPER-UNT-ID  TO SU107-DC-NBR.               02239225
022393     MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU107-STORE-NBR.            02239325
022394     MOVE SUOBTR-TRLR-SRL-NBR      TO SU107-TRLR-SRL.             02239425
022395     MOVE SUOBTS-TRIP-STAT-CDE     TO SU107-TRIP-STATUS.          02239525
022396     MOVE CNTRID-SCAC-CDE          TO SU107-SCAC.                 02239625
022397     MOVE CNTRID-TRLR-ID           TO SU107-TRLR-ID.              02239725
022398                                                                  02239824
022399     MOVE SUOBTR-ORGN-OPER-UNT-ID  TO UPLDER-OPER-UNT-ID.         02239925
022400     MOVE 'E'                      TO UPLDER-UPLD-TRN-CDE.        02240025
022401                                                                  02240131
022402     IF  PS-SHIPPING-TRLR-YES                                     02240231
022403         MOVE '101'                TO UPLDER-ERR-CDE              02240331
022404     ELSE                                                         02240431
022405         MOVE '102'                TO UPLDER-ERR-CDE              02240531
022406     END-IF.                                                      02240631
022407                                                                  02240731
022408     MOVE 0                        TO UPLDER-UPLD-SEQ-NBR.        02240825
022409     MOVE SU107-RECORD-LAYOUT      TO UPLDER-PKT-TXT.             02240925
022410                                                                  02241024
022430     EXEC SQL                                                     02243025
022440          INSERT                                                  02244025
022450            INTO TUPLDER                                          02245025
022460              ( OPER_UNT_ID                                       02246025
022470              , UPLD_TRN_CDE                                      02247025
022480              , ERR_CDE                                           02248025
022490              , PRC_TMST                                          02249025
022491              , UPLD_SEQ_NBR                                      02249125
022492              , PKT_TXT                                           02249225
022493              )                                                   02249325
022494              VALUES                                              02249425
022495              ( :UPLDER-OPER-UNT-ID                               02249525
022496              , :UPLDER-UPLD-TRN-CDE                              02249625
022497              , :UPLDER-ERR-CDE                                   02249725
022498              ,  CURRENT TIMESTAMP                                02249825
022499              , :UPLDER-UPLD-SEQ-NBR                              02249925
022500              , :UPLDER-PKT-TXT                                   02250025
022510              )                                                   02251025
022595     END-EXEC.                                                    02259525
022596                                                                  02259625
022597     EVALUATE TRUE                                                02259725
022598        WHEN  SQLCODE = ZERO                                      02259825
022599              CONTINUE                                            02259925
022600                                                                  02260025
022610        WHEN SQLWARN0 NOT = SPACES                                02261025
022620        WHEN SQLCODE < ZERO                                       02262025
022630        WHEN SQLCODE > ZERO                                       02263025
022640            MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID            02264025
022650            MOVE '4000-LOG-REQUEST         '                      02265025
022660                                  TO DP013-PARAGRAPH              02266025
022670            MOVE UPLDER-PKT-TXT                                   02267025
022680                                  TO DP013-MESSAGE-TEXT(1)        02268025
022692            MOVE SQLCA            TO DP013-SQLCA                  02269225
022693            MOVE 'TUPLDER'        TO DP013-DB2-TABLE-NAME (1)     02269325
022696            SET DP013-DB2-ABEND   TO TRUE                         02269625
022697            SET DP013-NO-ROLLBACK TO TRUE                         02269725
022698            SET PS-ABEND          TO TRUE                         02269825
022699            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02269925
022700     END-EVALUATE.                                                02270025
022800                                                                  02280024
022900                                                                  02290025
022910*----------------------------------------------------------------*02291026
022920*                                                                *02292026
022930*----------------------------------------------------------------*02293026
023000 4100-CHECK-PREV-EMAIL.                                           02300026
023001                                                                  02300126
023010     SET  PS-EMAIL-PREV-SENT-NO    TO TRUE.                       02301026
023100                                                                  02310026
023200     MOVE SPACES                   TO SU107-RECORD-LAYOUT.        02320026
023300     MOVE SUOBTS-TRLR-SEAL-ID      TO SU107-SEAL-ID.              02330026
023400     MOVE SUOBTS-OTBND-TRIP-ID     TO SU107-TRIP-ID.              02340026
023500     MOVE SUOBTR-ORGN-OPER-UNT-ID  TO SU107-DC-NBR.               02350026
023600     MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU107-STORE-NBR.            02360026
023700     MOVE SUOBTR-TRLR-SRL-NBR      TO SU107-TRLR-SRL.             02370026
023800     MOVE SUOBTS-TRIP-STAT-CDE     TO SU107-TRIP-STATUS.          02380026
023900     MOVE CNTRID-SCAC-CDE          TO SU107-SCAC.                 02390026
024000     MOVE CNTRID-TRLR-ID           TO SU107-TRLR-ID.              02400026
024010     MOVE SU107-RECORD-LAYOUT      TO UPLDER-PKT-TXT              02401028
024100                                                                  02410026
024800     EXEC SQL                                                     02480026
024900         SELECT COUNT(*)                                          02490026
025400           INTO :PV-EMAIL-CNT                                     02540030
025500           FROM TUPLDER A                                         02550026
025501              , TKRPRPM B                                         02550126
025511          WHERE A.UPLD_TRN_CDE      = 'E'                         02551126
025600            AND A.ERR_CDE           = '101'                       02560026
025610            AND A.PKT_TXT           = :UPLDER-PKT-TXT             02561027
025700            AND B.LOC_ID            = 90                          02570026
025710            AND B.INTFC_SYS_CDE     = 'KHL'                       02571026
025720            AND B.SYS_PRC_FUNC_CDE  = 'TRIPDS'                    02572026
025730            AND B.FUNC_PRC_STAT_CDE = 'AC'                        02573026
025740            AND B.FUNC_BEG_TMST    <= CURRENT TIMESTAMP           02574026
025750            AND B.FUNC_END_TMST    >= CURRENT TIMESTAMP           02575026
025760            AND A.PRC_TMST         >= CURRENT TIMESTAMP           02576026
025770                                      - B.FUNC_QTY MINUTES        02577026
026600     END-EXEC.                                                    02660026
026700                                                                  02670026
026800     EVALUATE TRUE                                                02680026
026900        WHEN  SQLCODE = ZERO                                      02690026
026910              IF  PV-EMAIL-CNT  > 0                               02691026
027000                  SET  PS-EMAIL-PREV-SENT-YES TO  TRUE            02700026
027010              END-IF                                              02701029
027100                                                                  02710026
027110        WHEN  SQLCODE = +100                                      02711026
027120             CONTINUE                                             02712026
027130                                                                  02713026
027200        WHEN SQLWARN0 NOT = SPACES                                02720026
027300        WHEN SQLCODE < ZERO                                       02730026
027400        WHEN SQLCODE > ZERO                                       02740026
027600            MOVE '4100-CHECK-PREV-EMAIL    '                      02760026
027700                                  TO DP013-PARAGRAPH              02770026
027800            MOVE SU107-RECORD-LAYOUT                              02780026
027900                                  TO DP013-MESSAGE-TEXT(1)        02790026
028000            MOVE SQLCA            TO DP013-SQLCA                  02800026
028100            MOVE 'TUPLDER'        TO DP013-DB2-TABLE-NAME (1)     02810026
028110            MOVE 'TKRPRPM'        TO DP013-DB2-TABLE-NAME (2)     02811026
028200            SET DP013-DB2-ABEND   TO TRUE                         02820026
028300            SET DP013-NO-ROLLBACK TO TRUE                         02830026
028400            SET PS-ABEND          TO TRUE                         02840026
028500            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02850026
028600     END-EVALUATE.                                                02860026
028700                                                                  02870026
028800                                                                  02880026
033300*----------------------------------------------------------------*03330000
033400*                                                                *03340000
033500*----------------------------------------------------------------*03350000
033600 9000-SUBMIT-REQUEST.                                             03360003
033710                                                                  03371003
033904     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        03390403
033905                                                                  03390503
033908     MOVE PC-TRLR-STATUS-EMAIL-PROC  TO  PV-JOB-PROC.             03390809
033910     MOVE PC-TRLR-STATUS-EMAIL-JOB   TO  PV-JOB-NAME.             03391009
033911                                                                  03391105
033912*-----------------------------------------------------------------03391200
033913* PROD/LEARN JCL SETUP                                            03391303
033914*     //SUK950   JOB KOHLS,'TRLR ST EMAIL',MSGCLASS=P,CLASS=U     03391403
033915*     /*JOBPARM K=O                                               03391503
033916*     //JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR                     03391603
033917*     //PS020    EXEC SUK9501                                     03391703
033918*     //S010.SYSUT1 DD *                                          03391803
033919*     XXXXXXXXX(SUCC096 IN SURD167 FORMAT)                        03391903
033920*     /*EOF                                                       03392003
033921*-----------------------------------------------------------------03392103
033922* TEST JCL SETUP                                                  03392203
033923*     //XXXXXXXQ JOB KOHLS,'TRLR ST EMAIL',MSGCLASS=X,CLASS=E     03392303
033924*     //JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR                     03392403
033925*     //PS020    EXEC SUK9501T                                    03392503
033926*     //S010.SYSUT1 DD *                                          03392603
033927*     XXXXXXXXX(SUCC096 IN SURD167 FORMAT)                        03392703
033928*     /*EOF                                                       03392803
033948*-----------------------------------------------------------------03394800
033949*                                                                 03394903
033950     IF PV-PROD-CICS  OR                                          03395003
033951        PV-LEARN-CICS                                             03395103
033952          MOVE PV-JOB-NAME            TO  JL-PROD-JOB-NAME        03395203
033954          MOVE JL-JOB-LINE-PROD       TO  JL-JCL-LINE-1           03395405
033955          MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE             03395505
033956          PERFORM 9100-WRITE-TD-LINE                              03395605
033957          MOVE JL-JCL-LINE-3          TO  TD-JCL-LINE             03395705
033958          PERFORM 9100-WRITE-TD-LINE                              03395805
033963          MOVE JL-JCL-LINE-4-PROD     TO  TD-JCL-LINE             03396305
033964          PERFORM 9100-WRITE-TD-LINE                              03396405
033967          MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC         03396705
033968          MOVE ' '                    TO  JL-LINE-12-PROC-T       03396805
033969          MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE             03396905
033970          PERFORM 9100-WRITE-TD-LINE                              03397005
033971     ELSE                                                         03397105
033972        IF PV-TEST-CICS                                           03397205
033973           MOVE PV-USER-ID             TO  JL-TEST-JOB-NAME       03397305
033975           MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1          03397505
033976           MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE            03397605
033977           PERFORM 9100-WRITE-TD-LINE                             03397705
033983           MOVE JL-JCL-LINE-4-TEST     TO  TD-JCL-LINE            03398305
033984           PERFORM 9100-WRITE-TD-LINE                             03398405
033985           MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC        03398505
033986           MOVE PC-TEST                TO  JL-LINE-12-PROC-T      03398605
033987           MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE            03398705
033988           PERFORM 9100-WRITE-TD-LINE                             03398805
033989        ELSE                                                      03398905
033990           IF PV-QA-CICS                                          03399005
033991              MOVE PV-USER-ID             TO  JL-TEST-JOB-NAME    03399105
033993              MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1       03399305
033994              MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE         03399405
033995              PERFORM 9100-WRITE-TD-LINE                          03399505
034001              MOVE JL-JCL-LINE-4-QA       TO  TD-JCL-LINE         03400105
034002              PERFORM 9100-WRITE-TD-LINE                          03400205
034003              MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC     03400305
034004              MOVE PC-QA                  TO  JL-LINE-12-PROC-T   03400405
034005              MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE         03400505
034006              PERFORM 9100-WRITE-TD-LINE                          03400605
034007           END-IF                                                 03400705
034008        END-IF                                                    03400805
034009     END-IF.                                                      03400905
034010                                                                  03401005
034011     MOVE JL-JCL-LINE-14              TO  TD-JCL-LINE.            03401105
034012     PERFORM 9100-WRITE-TD-LINE.                                  03401205
034013                                                                  03401305
034014     MOVE SUOBTS-TRLR-SEAL-ID      TO  JL-LINE-15-TRLR-SEAL-ID.   03401405
034016     MOVE SUOBTS-OTBND-TRIP-ID     TO  JL-LINE-15-OTBND-TRIP-ID.  03401605
034018     MOVE SUOBTR-ORGN-OPER-UNT-ID  TO  JL-LINE-15-DC-OPER.        03401805
034020     MOVE SUOBTR-DEST-OPER-UNT-ID  TO  JL-LINE-15-STR-OPER.       03402005
034022     MOVE SUOBTR-TRLR-SRL-NBR      TO  JL-LINE-15-TRLR-SRL.       03402205
034024     MOVE SUOBTS-TRIP-STAT-CDE     TO  JL-LINE-15-TRIP-STAT-CDE.  03402405
034026     MOVE CNTRID-SCAC-CDE          TO  JL-LINE-15-SCAC-CDE.       03402605
034028     MOVE CNTRID-TRLR-ID           TO  JL-LINE-15-TRLR-ID.        03402805
034040     MOVE JL-JCL-LINE-15           TO  TD-JCL-LINE.               03404005
034041     PERFORM 9100-WRITE-TD-LINE.                                  03404105
034042                                                                  03404205
034043                                                                  03404305
034044     MOVE JL-JCL-LINE-EOF             TO  TD-JCL-LINE.            03404405
034045     PERFORM 9100-WRITE-TD-LINE.                                  03404505
034050                                                                  03405005
034060     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        03406005
034070                                                                  03407005
034079                                                                  03407905
034080*----------------------------------------------------------------*03408000
034081*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *03408100
034082*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *03408200
034083*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *03408300
034084*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *03408400
034085*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *03408500
034086*  CICS.                                                         *03408600
034087*----------------------------------------------------------------*03408700
034088 9100-WRITE-TD-LINE.                                              03408804
034089                                                                  03408905
034090     EXEC CICS                                                    03409004
034091         WRITEQ TD                                                03409104
034092             QUEUE(TD-QUEUE-NAME)                                 03409204
034093             FROM(TD-JCL-LINE)                                    03409304
034094             LENGTH(TD-JCL-LINE-LENGTH)                           03409404
034095             RESP(PV-CICS-RESPONSE)                               03409504
034096     END-EXEC.                                                    03409604
034097                                                                  03409704
034098     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03409804
034099         SET PS-ABEND  TO TRUE                                    03409919
034100         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  03410004
034101                                                DELIMITED BY SIZE 03410104
034102                TD-QUEUE-NAME                   DELIMITED BY SIZE 03410204
034103                ' (INTERNAL READER)'            DELIMITED BY SIZE 03410304
034104             INTO SE-ATTEMPTED-ACTION                             03410404
034105         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                03410504
034106         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  03410604
034107         PERFORM 9600-DEQUEUE-INTERNAL-READER                     03410704
034108         PERFORM 9900-LEAVE-SYSTEM                                03410804
034109     END-IF.                                                      03410904
034110                                                                  03411004
034111                                                                  03411104
034112*----------------------------------------------------------------*03411200
034113*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *03411300
034114*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *03411400
034115*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *03411500
034116*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *03411600
034117*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *03411700
034118*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *03411800
034119*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *03411900
034120*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *03412000
034121*----------------------------------------------------------------*03412100
034122 9500-ENQUEUE-INTERNAL-READER.                                    03412204
034123                                                                  03412305
034124     EXEC CICS                                                    03412404
034125         ENQ                                                      03412504
034126             RESOURCE(TD-QUEUE-NAME)                              03412604
034127             LENGTH(TD-QUEUE-NAME-LENGTH)                         03412704
034128             RESP(PV-CICS-RESPONSE)                               03412804
034129     END-EXEC.                                                    03412904
034130                                                                  03413004
034131     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03413104
034132         SET PS-ABEND  TO TRUE                                    03413219
034133         STRING 'ENQUEUE '            DELIMITED BY SIZE           03413304
034134                TD-QUEUE-NAME         DELIMITED BY SIZE           03413404
034135                ' (INTERNAL READER)'  DELIMITED BY SIZE           03413504
034136             INTO SE-ATTEMPTED-ACTION                             03413604
034137         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                03413704
034138         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  03413804
034139         PERFORM 9900-LEAVE-SYSTEM                                03413904
034140     END-IF.                                                      03414004
034141                                                                  03414104
034142     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     03414204
034143                                                                  03414304
034144                                                                  03414404
034145*----------------------------------------------------------------*03414500
034146*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *03414600
034147*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *03414700
034148*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *03414800
034149*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *03414900
034150*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *03415000
034151*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *03415100
034152*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *03415200
034153*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *03415300
034154*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *03415400
034155*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *03415500
034156*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *03415600
034157*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *03415700
034158*  CICS.                                                         *03415800
034159*----------------------------------------------------------------*03415900
034160 9600-DEQUEUE-INTERNAL-READER.                                    03416004
034161                                                                  03416105
034162     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     03416204
034163                                                                  03416304
034164     EXEC CICS                                                    03416404
034165         DEQ                                                      03416504
034166             RESOURCE(TD-QUEUE-NAME)                              03416604
034167             LENGTH(TD-QUEUE-NAME-LENGTH)                         03416704
034168             RESP(PV-CICS-RESPONSE)                               03416804
034169     END-EXEC.                                                    03416904
034170                                                                  03417004
034171     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    03417104
034172         IF PS-NO-ABEND                                           03417219
034173             SET PS-ABEND  TO TRUE                                03417319
034174             STRING 'DEQUEUE '            DELIMITED BY SIZE       03417404
034175                    TD-QUEUE-NAME         DELIMITED BY SIZE       03417504
034176                    ' (INTERNAL READER)'  DELIMITED BY SIZE       03417604
034177                 INTO SE-ATTEMPTED-ACTION                         03417704
034178             MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE            03417804
034179             MOVE SE-SYSTEM-ERROR-MESSAGE TO                      03417904
034180                       PV-LEAVE-SYSTEM-MESSAGE                    03418004
034181             PERFORM 9900-LEAVE-SYSTEM                            03418104
034182         END-IF                                                   03418204
034183     END-IF.                                                      03418304
034184                                                                  03418404
034185*----------------------------------------------------------------*03418500
034186*  EXIT JOB REQUEST, DISPLAYING A REASON FOR THE PROGRAM ABEND   *03418605
034188*----------------------------------------------------------------*03418800
034189 9900-LEAVE-SYSTEM.                                               03418904
034190                                                                  03419005
034191     EXEC CICS                                                    03419104
034192         SEND                                                     03419204
034193             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        03419304
034194             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       03419404
034195             ERASE                                                03419504
034196     END-EXEC.                                                    03419604
034197                                                                  03419704
034198     EXEC CICS                                                    03419804
034199         RETURN                                                   03419904
034200     END-EXEC.                                                    03420004
034201                                                                  03420104
034202                                                                  03420204
034203******************************************************************03420309
034204*    WRITE A MESSAGE TO THE CICS LOG.                            *03420409
034205******************************************************************03420509
034206 9990-WRITE-CICS.                                                 03420609
034207     MOVE 120 TO PV-WRITE-LENGTH.                                 03420709
034208                                                                  03420809
034209     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     03420909
034210          LENGTH(PV-WRITE-LENGTH) NOHANDLE                        03421009
034211     END-EXEC.                                                    03421109
034212                                                                  03421209
034213     MOVE SPACES TO PV-CICS-MSG-AREA.                             03421309
034214                                                                  03421409
034216                                                                  03421609
034217******************************************************************03421709
034218*                                                                *03421809
034219******************************************************************03421909
034220 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  03422009
034221                                                                  03422109
034230     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            03423004
034300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           03430004
034400     INITIALIZE DP013-SRC-TASK-NUMBER                             03440004
034500                DP013-STACK.                                      03450004
034600     SET DP013-LINK-RETURN           TO TRUE.                     03460004
034700                                                                  03470004
034800     EXEC CICS                                                    03480004
034900         LINK                                                     03490004
035000             PROGRAM   (DP013-NAME)                               03500004
035100             COMMAREA  (DP013-PARAMETERS)                         03510004
035200             LENGTH    (DP013-LENGTH)                             03520004
035300     END-EXEC.                                                    03530004
035310                                                                  03531004
