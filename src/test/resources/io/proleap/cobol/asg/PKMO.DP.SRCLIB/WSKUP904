000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.   WSKUP904.                                          00040099
000500 AUTHOR.       JIM ARENDT.                                        00050000
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. JUNE 2015.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*          E-COMMERCE - UPDATE TWEBITM                            00100067
001100*                                                                 00110000
001200* THIS BATCH PROGRAM WILL READ AN INPUT FILE, VALIDATE THE FIELDS,00120099
001300* THEN UPDATE THE WEB ITEM ATTRIBUTES ON THE TWEBITM TABLE.       00130099
001000* NOTE:  THE INPUT FILE IS IN THE .CSV COMMA(,) DELIMITED FORMAT. 00140092
007900****************************************************************  00141099
      *  3/31/2016 PAM GRZYBOWSKI-TURNED OFF ABILITY TO UPDT GIFT WRAP  00142099
      *  AVAILABLE INDICATOR TO "Y".  THIS PROGRAM WILL ALWAYS SET IT   00143099
      *  TO "N".  SINCE THIS CHANGE MAY NOT BE PERMANENT THE RELEVANT   00144099
      *  LINES WERE JUST COMMENTED OUT.  TO MAKE GIFT WRAP UPDATABLE    00145099
      *  TO "Y" AGAIN, UNCOMMENT OUT THE LINES PREFIXED WITH "GFTWRP".  00146099
001400******************************************************************00150000
263627*---------------------------------------------------------------* 00151099
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00152099
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00153099
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00154099
263627*---------------------------------------------------------------* 00155099
001500 ENVIRONMENT DIVISION.                                            00160000
001600 CONFIGURATION SECTION.                                           00170000
001700 SOURCE-COMPUTER.        IBM-3090.                                00180000
001800 OBJECT-COMPUTER.        IBM-3090.                                00190000
002200                                                                  00200067
001900******************************************************************00210000
002000 INPUT-OUTPUT SECTION.                                            00220000
002100 FILE-CONTROL.                                                    00230000
002200     SELECT INPUT-FILE  ASSIGN TO INP01.                          00240069
002200                                                                  00250000
002200     SELECT OUTPUT-FILE ASSIGN TO OUT01.                          00260069
002200                                                                  00270069
002300******************************************************************00280000
002400 DATA DIVISION.                                                   00290000
002500******************************************************************00300000
002600 FILE SECTION.                                                    00310000
002700 FD  INPUT-FILE                                                   00320000
002800     LABEL RECORDS ARE STANDARD                                   00330000
002900     RECORD CONTAINS 120 CHARACTERS                               00340099
003000     RECORDING MODE IS F                                          00350000
003100     DATA RECORD IS INPUT-RECORD.                                 00360000
003200 01  INPUT-RECORD                  PIC  X(120).                   00370099
002200                                                                  00380000
002700 FD  OUTPUT-FILE                                                  00390069
002800     LABEL RECORDS ARE STANDARD                                   00400069
002900     RECORD CONTAINS 80 CHARACTERS                                00410069
003000     RECORDING MODE IS F                                          00420069
003100     DATA RECORD IS OUTPUT-RECORD.                                00430069
003200 01  OUTPUT-RECORD                 PIC  X(80).                    00440069
002200                                                                  00450069
003300******************************************************************00460000
003400 WORKING-STORAGE SECTION.                                         00470000
003500******************************************************************00480000
003600 01  PC-PROGRAM-CONSTANTS.                                        00490000
003700     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'WSKUP904'.  00500060
003800     05  PC-MAX-RETRIES            PIC S9(04)  VALUE +3 COMP.     00510060
003800     05  PC-SPACES                 PIC  X(40)  VALUE SPACES.      00520076
003800     05  PC-ASTERISKS-LINE         PIC  X(37)  VALUE              00530099
025200         '*************************************'.                 00540099
003800     05  PC-ASTERISKS-TWO          PIC  X(37)  VALUE              00550099
027000         '*                                   *'.                 00560099
003800     05  PC-ASTERISKS-ONE          PIC  X(37)  VALUE              00570099
027000         '*                                    '.                 00580099
003900                                                                  00590000
003500******************************************************************00600014
004000 01  PS-PROGRAM-SWITCHES.                                         00610000
004100     05  PS-FIRST-TIME-SW          PIC  X(01)  VALUE 'Y'.         00620099
004200         88  PS-FIRST-TIME-YES                 VALUE 'Y'.         00630099
004300         88  PS-FIRST-TIME-NO                  VALUE 'N'.         00640099
004100     05  PS-END-OF-INPUT-SW        PIC  X(01)  VALUE 'N'.         00650099
004200         88  PS-END-OF-INPUT-YES               VALUE 'Y'.         00660099
004300         88  PS-END-OF-INPUT-NO                VALUE 'N'.         00670099
004400     05  PS-HAVE-SKU-SW            PIC  X(01)  VALUE 'N'.         00680060
004500         88  PS-HAVE-SKU-YES                   VALUE 'Y'.         00690060
004600         88  PS-HAVE-SKU-NO                    VALUE 'N'.         00700060
004700     05  PS-HAVE-TWEBITM-SW        PIC  X(01)  VALUE 'N'.         00710060
004800         88  PS-HAVE-TWEBITM-YES               VALUE 'Y'.         00720060
004900         88  PS-HAVE-TWEBITM-NO                VALUE 'N'.         00730060
004700     05  PS-HAVE-IMT00024-SW       PIC  X(01)  VALUE 'N'.         00740099
004800         88  PS-HAVE-IMT00024-YES              VALUE 'Y'.         00750099
004900         88  PS-HAVE-IMT00024-NO               VALUE 'N'.         00760099
002000     05  PS-WEBITM-SW              PIC  X(01)  VALUE 'N'.         00770060
002100         88  PS-WEBITM-ERROR                   VALUE 'Y'.         00780060
002200         88  PS-NO-WEBITM-ERROR                VALUE 'N'.         00790060
002000     05  PS-UPDATE-NEEDED-SW       PIC  X(01)  VALUE 'N'.         00800060
002100         88  PS-UPDATE-NEEDED                  VALUE 'Y'.         00810060
002200         88  PS-UPDATE-NEEDED-NO               VALUE 'N'.         00820060
005300                                                                  00830000
003500******************************************************************00840014
005400 01  PV-PROGRAM-VARIABLES.                                        00850000
005500     05  PV-RETRY-COUNTER          PIC S9(04)  VALUE +0 COMP SYNC.00860060
005600     05  PV-COMMIT-COUNT           PIC  9(07)  VALUE ZEROES.      00870060
005700     05  PV-NULL-IND-1             PIC S9(04)  VALUE +0 COMP.     00880060
006100     05  PV-SQLCODE                PIC S9(09).                    00890060
006200     05  PV-DISPLAY-SQLCODE        PIC -------999.                00900068
006200     05  PV-LONG-COMP-UPC-ID       PIC S9(10)  COMP VALUE +0.     00910068
006200     05  PV-DISPLAY-UPC-ID         PIC  9(11)  VALUE ZEROES.      00920068
006200     05  PV-INPUT-RECORD           PIC  X(120) VALUE SPACES.      00930099
006300     05  PV-CURRENT-TMST           PIC  X(26).                    00940060
010200     05  FILLER REDEFINES PV-CURRENT-TMST.                        00950040
010300         10  PV-CURRENT-DATE       PIC  X(10).                    00960060
010400         10  PV-CURRENT-TIME       PIC  X(16).                    00970060
006400     05  PV-DEPT                   PIC S9(10)V9(5) COMP-3.        00980000
006400     05  PV-ENT-ID                 PIC  9(07)  VALUE ZEROES.      00990099
006600     05  PV-DISPLAY-PA             PIC  ZZ,ZZZ,ZZ9-.              01000099
006700     05  PV-DISPLAY-LINE           PIC  X(80)  VALUE SPACES.      01010060
024500     05  PV-SHIP-SERVICE-CDE       PIC  9(04).                    01020060
011300     05  PV-SHIP-RESTRICT          PIC  9(04).                    01030060
011400     05  PV-SHIP-GROUP-CDE         PIC  9(04).                    01040060
021800     05  PV-DESC6                  PIC  X(20).                    01050060
006800                                                                  01060099
006900 01  PV-OUTPUT-TOTAL-LINE.                                        01070099
011400     05  FILLER                    PIC  X(02)  VALUE '* '.        01080099
021800     05  PV-OTL-VALUE              PIC  X(19).                    01090099
011400     05  FILLER                    PIC  X(03)  VALUE ' = '.       01100099
006600     05  PV-OTL-COUNT              PIC  ZZ,ZZZ,ZZ9-.              01110099
011400     05  FILLER                    PIC  X(45)  VALUE SPACES.      01120099
006800                                                                  01130099
006900 01  DK-DATABASE-KEYS.                                            01140099
007000     05  DK-SKU                    PIC S9(08)V COMP-3.            01150060
007100     05  DK-INTR-UPC-ID            PIC S9(09)  COMP.              01160060
007200     05  DK-VS-ID                  PIC S9(09)  COMP.              01170060
007300     05  DK-ENT-ID                 PIC S9(09)  COMP.              01180060
007400     05  DK-VS-NBR                 PIC  X(20).                    01190060
007500                                                                  01200000
007600 01  PV-ABEND-CODE                 PIC S9(04)  VALUE +0 COMP SYNC.01210060
007700 01  PV-ABEND-FIELDS.                                             01220000
007800     05  PV-ABEND-PROGRAM          PIC  X(08)  VALUE 'WSKUP904'.  01230060
007900     05  PV-ABEND-PARAGRAPH        PIC  X(25)  VALUE SPACES.      01240060
008000     05  PV-ABEND-OPERATION        PIC  X(20)  VALUE SPACES.      01250060
008100     05  PV-ABEND-STRUCTURE-1      PIC  X(08)  VALUE SPACES.      01260060
008200     05  PV-ABEND-STRUCTURE-2      PIC  X(08)  VALUE SPACES.      01270060
008400     05  PV-DB2-OPERATION-MESSAGE1 PIC  X(79)  VALUE SPACES.      01280060
008500     05  PV-DB2-OPERATION-MESSAGE2 PIC  X(79)  VALUE SPACES.      01290060
008600                                                                  01300000
008700 01  PA-PROGRAM-ACCUMULATORS.                                     01310000
008800     05  PA-RECORDS-READ           PIC S9(09)  VALUE ZEROES.      01320060
008900     05  PA-SKU-ERRORS             PIC S9(09)  VALUE ZEROES.      01330099
008900     05  PA-FILES-READ             PIC S9(09)  VALUE ZEROES.      01340099
008900     05  PA-ERRORS-FOUND           PIC S9(09)  VALUE ZEROES.      01350099
009200     05  PA-UPDATE-TWEBITM         PIC S9(09)  VALUE ZEROES.      01360060
009300     05  PA-INSERT-TWEBITM         PIC S9(09)  VALUE ZEROES.      01370060
009300     05  PA-INSERT-IMT00024        PIC S9(09)  VALUE ZEROES.      01380099
009300     05  PA-INSERT-TVSRSVN         PIC S9(09)  VALUE ZEROES.      01390086
009300     05  PA-DELETE-TVSRSVN         PIC S9(09)  VALUE ZEROES.      01400086
009300     05  PA-WRITE-COUNTER          PIC S9(09)  VALUE ZEROES.      01410070
009600     05  PA-COMMITS                PIC S9(09)  VALUE ZEROES.      01420060
009700                                                                  01430000
009800 01  PV-IN-RECORD.                                                01440000
009900     05  PIR-SKU                   PIC  9(08).                    01450060
013500     05  PIR-SHIP-SURCHARGE        PIC  X(08).                    01460099
013500     05  PIR-SHIP-SERVICE-CDE      PIC  X(04).                    01470060
012900     05  PIR-SHIP-RESTRICT         PIC  X(04).                    01480060
013500     05  PIR-SHIP-GROUP-CDE        PIC  X(04).                    01490060
013300     05  PIR-GIFTWRAP-IND          PIC  X(01).                    01500060
013300     05  PIR-USER-ID               PIC  X(07).                    01510099
013300     05  FILLER                    PIC  X(84).                    01520099
013700                                                                  01530000
013800 01  PV-OUT-RECORD.                                               01540000
013900     05  POR-SKU-O                 PIC  9(08).                    01550099
014000     05  FILLER                    PIC  X(01)  VALUE SPACES.      01560073
014300     05  POR-MESSAGE-O             PIC  X(50).                    01570099
014000     05  FILLER                    PIC  X(01)  VALUE SPACES.      01580099
014300     05  POR-USER-ID-O             PIC  X(07).                    01590099
014000     05  FILLER                    PIC  X(13)  VALUE SPACES.      01600099
014500                                                                  01610000
013800 01  PV-OUT-RECORD2.                                              01620099
013900     05  POR2-SKU-O                PIC  9(08).                    01630099
014000     05  FILLER                    PIC  X(72)  VALUE SPACES.      01640099
014500                                                                  01650099
014600******************************************************************01660000
014700*  DB2 WORK AREA                                                  01670000
014800******************************************************************01680000
014900*DB2 AREA FOR SHIP SURCHARGE DEPT VIEW                            01690000
014800******************************************************************01700000
015000     EXEC SQL                                                     01710000
015100          INCLUDE WSV00007                                        01720000
015200     END-EXEC.                                                    01730000
015300                                                                  01740000
014800******************************************************************01750000
015400*DB2 AREA FOR SKU CROSS-REFERENCE.                                01760000
014800******************************************************************01770000
015500     EXEC SQL                                                     01780000
015600          INCLUDE TSKXREF                                         01790000
015700     END-EXEC.                                                    01800000
015800                                                                  01810000
014800******************************************************************01820099
015400*DB2 AREA FOR IMT_ITM_DC_ASSN.                                    01830099
014800******************************************************************01840099
015500     EXEC SQL                                                     01850099
015600          INCLUDE IMT00024                                        01860099
015700     END-EXEC.                                                    01870099
015800                                                                  01880099
014800******************************************************************01890000
015900*DB2 AREA FOR LOGISTICS VIEW OF SKU.                              01900000
014800******************************************************************01910000
016000     EXEC SQL                                                     01920000
016100          INCLUDE XLT00003                                        01930000
016200     END-EXEC.                                                    01940000
016300                                                                  01950000
014800******************************************************************01960000
016400*DB2 AREA FOR LOGISTICS VIEW OF VENDOR STYLE.                     01970000
014800******************************************************************01980000
016500     EXEC SQL                                                     01990000
016600          INCLUDE XLT00004                                        02000000
016700     END-EXEC.                                                    02010000
016800                                                                  02020000
014800******************************************************************02030000
016900*DB2 AREA FOR SKU WEB ATTRIBUTES.                                 02040000
014800******************************************************************02050000
017000     EXEC SQL                                                     02060000
017100          INCLUDE TWEBITM                                         02070000
017200     END-EXEC.                                                    02080000
017300                                                                  02090000
014800******************************************************************02100000
029100*DB2 AREA FOR VENDOR CAPABILITIES.                                02110040
014800******************************************************************02120000
017500     EXEC SQL                                                     02130000
017600          INCLUDE VNT00001                                        02140040
017700     END-EXEC.                                                    02150000
017800                                                                  02160000
014800******************************************************************02170029
029600*DB2 AREA FOR VSM CHARACTER VALUES.                               02180029
014800******************************************************************02190029
018000     EXEC SQL                                                     02200029
018100          INCLUDE TVSCHVL                                         02210029
018200     END-EXEC.                                                    02220029
018300                                                                  02230029
014800******************************************************************02240080
030100*DB2 AREA FOR VSM RESERVATIONS.                                   02250080
014800******************************************************************02260080
030200     EXEC SQL                                                     02270080
030300          INCLUDE TVSRSVN                                         02280080
030400     END-EXEC.                                                    02290080
030500                                                                  02300080
014800******************************************************************02310000
018400*DB2 AREA FOR COMMUNICATIONS                                      02320000
014800******************************************************************02330000
018500     EXEC SQL                                                     02340000
018600          INCLUDE SQLCA                                           02350000
018700     END-EXEC.                                                    02360000
018800                                                                  02370000
014800******************************************************************02380000
018900*WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                        02390000
014800******************************************************************02400000
019000     COPY DPWS004.                                                02410000
019100                                                                  02420000
014800******************************************************************02430030
013100*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    02440030
013200*    SUB-ROUTINE (DPKUT100).                                      02450030
014800******************************************************************02460030
013400     COPY DPWS010I.                                               02470030
013500                                                                  02480030
019200******************************************************************02490014
019300 PROCEDURE DIVISION.                                              02500000
019400******************************************************************02510000
019500 0000-PROGRAM-MAINLINE.                                           02520000
019700                                                                  02530036
019600     DISPLAY ' '.                                                 02540036
019600     DISPLAY '**** START OF WSKUP904 ****'.                       02550036
019600     DISPLAY ' '.                                                 02560036
019700                                                                  02570000
019900     OPEN INPUT  INPUT-FILE                                       02580069
019900          OUTPUT OUTPUT-FILE.                                     02590069
020000                                                                  02600000
020100**  READ/PROCESS INPUT FILE.                                      02610014
020200     SET PS-END-OF-INPUT-NO TO TRUE.                              02620000
020200     SET PS-FIRST-TIME-YES  TO TRUE.                              02630099
020300     PERFORM 1000-READ-UNSTRING-RTN.                              02640097
020400     IF PS-END-OF-INPUT-YES                                       02650000
020500         DISPLAY ' '                                              02660000
020600         DISPLAY '*************************************'          02670000
020700         DISPLAY '**         INPUT FILE EMPTY        **'          02680000
020800         DISPLAY '**  NO WEB ITEM UPDATES PERFORMED  **'          02690000
020900         DISPLAY '*************************************'          02700000
021000         DISPLAY ' '                                              02710000
021100     END-IF.                                                      02720000
021200                                                                  02730000
021300*GET CURRENT DATE/TIME.                                           02740000
021400     EXEC SQL                                                     02750000
021500         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02760000
021600     END-EXEC.                                                    02770000
021700                                                                  02780000
021800     PERFORM                                                      02790000
021900       UNTIL PS-END-OF-INPUT-YES                                  02800000
013800         INITIALIZE PV-OUT-RECORD                                 02810099
013900                    PV-OUT-RECORD2                                02820099
022000*PROCESS INPUT RECORD                                             02830099
022100         PERFORM 1100-GET-SKU-INFO                                02840000
022200         IF PS-HAVE-SKU-YES                                       02850000
022300            PERFORM 2000-GET-TWEBITM                              02860000
022400            IF PS-HAVE-TWEBITM-YES                                02870000
022700                PERFORM 4100-VALIDATE-TWEBITM                     02880033
022700                IF  PS-NO-WEBITM-ERROR                            02890049
022700                AND PS-UPDATE-NEEDED                              02900049
051200                   PERFORM 6100-INSERT-TVSRSVN                    02910099
022600                   PERFORM 4000-UPDATE-TWEBITM                    02920099
022700                   PERFORM 5000-INSERT-TWEBITM                    02930099
051500                   PERFORM 6200-DELETE-TVSRSVN                    02940099
022700                END-IF                                            02950033
023000                ADD +1                   TO PV-COMMIT-COUNT       02960022
023100            END-IF                                                02970000
122200                                                                  02980099
023700*COMMIT THE DATA.                                                 02990000
023800            IF PV-COMMIT-COUNT > 500                              03000099
023900                PERFORM 1500-COMMIT                               03010099
024000                MOVE ZEROES TO PV-COMMIT-COUNT                    03020099
024100            END-IF                                                03030099
024200         END-IF                                                   03040099
024200                                                                  03050099
022700         IF PS-WEBITM-ERROR                                       03060099
035800            DISPLAY PV-INPUT-RECORD                               03070099
035800            WRITE OUTPUT-RECORD FROM PV-INPUT-RECORD              03080099
008900            ADD 1         TO PA-SKU-ERRORS                        03090099
035800            MOVE SPACES TO OUTPUT-RECORD                          03100099
035800            WRITE OUTPUT-RECORD                                   03110099
022700         END-IF                                                   03120099
024200                                                                  03130099
024300*READ NEXT INPUT RECORD.                                          03140000
024400         PERFORM 1000-READ-UNSTRING-RTN                           03150097
024500     END-PERFORM.                                                 03160000
024600                                                                  03170000
024900     PERFORM 9000-DISPLAY-TOTALS.                                 03180099
024900                                                                  03190099
024800     CLOSE INPUT-FILE                                             03200069
024800           OUTPUT-FILE.                                           03210069
024900                                                                  03220000
027600     DISPLAY ' '.                                                 03230099
027600     DISPLAY '****  END OF WSKUP904  ****'.                       03240099
027600     DISPLAY ' '.                                                 03250099
027700     STOP RUN.                                                    03260000
027800                                                                  03270000
027900******************************************************************03280000
028000*    READ AND UNSTRING THE COMMA DELIMITED INPUT RECORD           03290099
028100******************************************************************03300000
028200 1000-READ-UNSTRING-RTN.                                          03310097
028300                                                                  03320097
028200     PERFORM 1020-READ-INPUT.                                     03330097
028300                                                                  03340099
023300     IF PS-END-OF-INPUT-NO                                        03350097
029200*     CHECK THE RECORD FOR HEADINGS. IF FOUND, BYPASS IT          03360099
155000        IF PV-INPUT-RECORD (1:1) = 'S'                            03370099
155000        OR PV-INPUT-RECORD (1:1) = 's'                            03380099
028800           ADD 1        TO PA-FILES-READ                          03390099
028800           SUBTRACT 1 FROM PA-RECORDS-READ                        03400099
028200           PERFORM 1020-READ-INPUT                                03410099
028300        END-IF                                                    03420099
023300        IF PS-END-OF-INPUT-NO                                     03430099
023400           UNSTRING PV-INPUT-RECORD                               03440099
023500              DELIMITED BY ','                                    03450099
009900                   INTO PIR-SKU                                   03460099
013500                        PIR-SHIP-SURCHARGE                        03470099
013500                        PIR-SHIP-SERVICE-CDE                      03480099
012900                        PIR-SHIP-RESTRICT                         03490099
013500                        PIR-SHIP-GROUP-CDE                        03500099
013300                        PIR-GIFTWRAP-IND                          03510099
013300                        PIR-USER-ID                               03520099
025100           END-UNSTRING                                           03530099
023300        END-IF                                                    03540099
023300     END-IF.                                                      03550099
025100                                                                  03560097
028100******************************************************************03570097
028200 1020-READ-INPUT.                                                 03580097
028200                                                                  03590097
009800     MOVE SPACES TO PV-IN-RECORD                                  03600099
028400                    PV-INPUT-RECORD.                              03610099
028200                                                                  03620099
028400     READ INPUT-FILE INTO PV-INPUT-RECORD                         03630099
028500       AT END                                                     03640000
028600         SET PS-END-OF-INPUT-YES TO TRUE                          03650000
028700       NOT AT END                                                 03660000
028800         ADD +1       TO PA-RECORDS-READ.                         03670099
029100                                                                  03680000
028300                                                                  03690099
029200******************************************************************03700000
029300 1100-GET-SKU-INFO.                                               03710000
029400                                                                  03720000
029500     INITIALIZE DK-DATABASE-KEYS                                  03730000
029600                PV-DEPT.                                          03740000
029700                                                                  03750000
029800     MOVE PIR-SKU TO DK-SKU.                                      03760099
029900                                                                  03770000
030000     EXEC SQL                                                     03780099
030100           SELECT A.DEPT_NBR                                      03790099
030200                , A.CL_NBR                                        03800099
030300                , A.SKU_SEQ_NBR                                   03810099
030400                , A.SKU_STAT_CDE                                  03820099
030500                , A.ITM_NBR                                       03830099
030600                , A.INTR_UPC_ID                                   03840099
030700                , A.DEPT                                          03850099
030800                , A.CLASS                                         03860099
030900                , A.SUBCLASS                                      03870099
031000                , A.SKU                                           03880099
031100                , B.STYL_ID                                       03890099
031200                , C.VS_ID                                         03900099
031300                , C.VS_NBR                                        03910099
031400                , C.ENT_ID                                        03920099
031500             INTO :SKXREF-DEPT-NBR                                03930099
031600                , :SKXREF-CL-NBR                                  03940099
031700                , :SKXREF-SKU-SEQ-NBR                             03950099
031800                , :SKXREF-SKU-STAT-CDE                            03960099
031900                , :SKXREF-ITM-NBR                                 03970099
032000                , :SKXREF-INTR-UPC-ID                             03980099
032100                , :SKXREF-DEPT                                    03990099
032200                , :SKXREF-CLASS                                   04000099
032300                , :SKXREF-SUBCLASS                                04010099
032400                , :SKXREF-SKU                                     04020099
032500                , :XLT00003-STYL-ID                               04030099
032600                , :XLT00004-VS-ID                                 04040099
032700                , :XLT00004-VS-NBR                                04050099
032800                , :XLT00004-ENT-ID                                04060099
032900             FROM TSKXREF A                                       04070099
033000                , XLT_SKU B                                       04080099
033100                , XLT_VND_STYL C                                  04090099
033200            WHERE A.SKU         = :DK-SKU                         04100099
033300              AND B.INTR_UPC_ID = A.INTR_UPC_ID                   04110099
033400              AND C.STYL_ID     = B.STYL_ID                       04120099
033500     END-EXEC.                                                    04130099
033600                                                                  04140000
033700     EVALUATE TRUE                                                04150099
033800          WHEN SQLCODE = ZERO                                     04160099
033900              SET PS-HAVE-SKU-YES      TO TRUE                    04170099
034000              MOVE SKXREF-DEPT         TO PV-DEPT                 04180099
034100              MOVE SKXREF-INTR-UPC-ID  TO DK-INTR-UPC-ID          04190099
040469                                          PV-LONG-COMP-UPC-ID     04200099
006200              MOVE PV-LONG-COMP-UPC-ID TO PV-DISPLAY-UPC-ID       04210099
034200              MOVE XLT00004-VS-ID      TO DK-VS-ID                04220099
034300              MOVE XLT00004-VS-NBR     TO DK-VS-NBR               04230099
034400              MOVE XLT00004-ENT-ID     TO DK-ENT-ID               04240099
034500                                                                  04250000
034600          WHEN SQLCODE = +100                                     04260099
034800********    IF SKU NOT FOUND, DISPLAY MESSAGE AND CONTINUE        04270099
002200              SET PS-WEBITM-ERROR      TO TRUE                    04280099
035000              SET PS-HAVE-SKU-NO       TO TRUE                    04290099
035300              ADD 1                    TO PA-ERRORS-FOUND         04300099
035400              DISPLAY '  *ERROR* SKU=' PIR-SKU                    04310099
035400                      '  SKU NOT FOUND, READING NEXT REC'         04320099
035400                      '   '   PIR-USER-ID                         04330099
035400              MOVE    '  SKU NOT FOUND, READING NEXT REC'         04340099
035700                                       TO POR-MESSAGE-O           04350099
035800              PERFORM 8000-WRITE-OUTPUT                           04360099
002200                                                                  04370000
036100          WHEN OTHER                                              04380099
034800********    DB2 ERROR, DISPLAY MESSAGE AND CONTINUE               04390099
002200              SET PS-WEBITM-ERROR      TO TRUE                    04400099
035000              SET PS-HAVE-SKU-NO       TO TRUE                    04410099
035300              ADD 1                    TO PA-ERRORS-FOUND         04420099
035400              DISPLAY '  *ERROR* SKU=' PIR-SKU                    04430099
035400                      '  SKU NO FOUND2, READING NEXT REC'         04440099
035400                      '   '   PIR-USER-ID                         04450099
035400              MOVE    '  SKU NO FOUND2, READING NEXT REC'         04460099
035700                                       TO POR-MESSAGE-O           04470099
035800              PERFORM 8000-WRITE-OUTPUT                           04480099
002200                                                                  04490099
036500     END-EVALUATE.                                                04500099
060800                                                                  04510099
036700******************************************************************04520000
036800 1500-COMMIT.                                                     04530000
036900                                                                  04540000
037000     EXEC SQL                                                     04550000
037100         COMMIT                                                   04560000
037200     END-EXEC.                                                    04570000
037300                                                                  04580000
037400     EVALUATE TRUE                                                04590000
037500       WHEN SQLCODE = ZERO                                        04600000
037600           ADD +1             TO PA-COMMITS                       04610023
037700                                                                  04620000
037800       WHEN OTHER                                                 04630000
037900           MOVE '1500-COMMIT' TO PV-ABEND-PARAGRAPH               04640000
038000           MOVE 'COMMIT DATA' TO PV-ABEND-OPERATION               04650000
038100           PERFORM 9900-DB2-ABEND                                 04660000
038200     END-EVALUATE.                                                04670000
038300                                                                  04680000
038400******************************************************************04690000
038500*              G E T   T W E B I T M   R O W                      04700000
038600******************************************************************04710000
038700 2000-GET-TWEBITM.                                                04720000
038800                                                                  04730000
038900     EXEC SQL                                                     04740099
039000           SELECT INTR_UPC_ID                                     04750099
039100                , EFF_BEG_TMST                                    04760099
039200                , EFF_END_TMST                                    04770099
039300                , ASRT_BEG_DTE                                    04780099
039400                , ASRT_END_DTE                                    04790099
039500                , STRG_AREA_SEQ_NBR                               04800099
039600                , SHIP_WD_QTY                                     04810099
039700                , SHIP_DPTH_QTY                                   04820099
039800                , SHIP_HT_QTY                                     04830099
039900                , SHIP_WT_QTY                                     04840099
040000                , SHIP_DIM_SRC_CDE                                04850099
040100                , PKG_SEQ_NBR                                     04860099
040200                , SHIP_RSTRC_SEQ_NBR                              04870099
040300                , GFT_WRAP_AVL_IND                                04880099
040400                , PRD_GP_NBR                                      04890099
040500                , PRD_GP_IND                                      04900099
040600                , SHIP_SRCHG_FEE_AMT                              04910099
040700                , SHIP_SRVC_SEQ_NBR                               04920099
040800                , SHIP_GP_SEQ_NBR                                 04930099
040900                , CRE_BY_USR_ID                                   04940099
041000                , WEB_ITM_DLTD_IND                                04950099
041100                , HAZDS_IND                                       04960099
041200                , BRKBL_IND                                       04970099
041300                , GC_IND                                          04980099
041400                , SHIP_ALN_IND                                    04990099
041500                , WEB_EXCLV_IND                                   05000099
041600             INTO :WEBITM-INTR-UPC-ID                             05010099
041700                , :WEBITM-EFF-BEG-TMST                            05020099
041800                , :WEBITM-EFF-END-TMST :PV-NULL-IND-1             05030099
041900                , :WEBITM-ASRT-BEG-DTE                            05040099
042000                , :WEBITM-ASRT-END-DTE                            05050099
042100                , :WEBITM-STRG-AREA-SEQ-NBR                       05060099
042200                , :WEBITM-SHIP-WD-QTY                             05070099
042300                , :WEBITM-SHIP-DPTH-QTY                           05080099
042400                , :WEBITM-SHIP-HT-QTY                             05090099
042500                , :WEBITM-SHIP-WT-QTY                             05100099
042600                , :WEBITM-SHIP-DIM-SRC-CDE                        05110099
042700                , :WEBITM-PKG-SEQ-NBR                             05120099
042800                , :WEBITM-SHIP-RSTRC-SEQ-NBR                      05130099
042900                , :WEBITM-GFT-WRAP-AVL-IND                        05140099
043000                , :WEBITM-PRD-GP-NBR                              05150099
043100                , :WEBITM-PRD-GP-IND                              05160099
043200                , :WEBITM-SHIP-SRCHG-FEE-AMT                      05170099
043300                , :WEBITM-SHIP-SRVC-SEQ-NBR                       05180099
043400                , :WEBITM-SHIP-GP-SEQ-NBR                         05190099
043500                , :WEBITM-CRE-BY-USR-ID                           05200099
043600                , :WEBITM-WEB-ITM-DLTD-IND                        05210099
043700                , :WEBITM-HAZDS-IND                               05220099
043800                , :WEBITM-BRKBL-IND                               05230099
043900                , :WEBITM-GC-IND                                  05240099
044000                , :WEBITM-SHIP-ALN-IND                            05250099
044100                , :WEBITM-WEB-EXCLV-IND                           05260099
044200             FROM TWEBITM                                         05270099
044300            WHERE INTR_UPC_ID  = :DK-INTR-UPC-ID                  05280099
044400              AND EFF_END_TMST IS NULL                            05290099
044500     END-EXEC.                                                    05300099
044600                                                                  05310000
044700     EVALUATE TRUE                                                05320099
044800          WHEN SQLCODE = ZERO                                     05330099
044900              SET PS-HAVE-TWEBITM-YES TO TRUE                     05340099
045000                                                                  05350000
045100          WHEN SQLCODE = +100                                     05360099
002200              SET PS-WEBITM-ERROR TO TRUE                         05370099
008900              ADD 1                   TO PA-ERRORS-FOUND          05380099
069200              DISPLAY ' *ERROR* SKU=' PIR-SKU                     05390099
069200                      '  NO ROW FOUND ON TWEBITM FOR SKU '        05400099
045800              SET PS-HAVE-TWEBITM-NO  TO TRUE                     05410099
069200              MOVE '  NO ROW FOUND ON TWEBITM FOR SKU '           05420099
069200                                   TO POR-MESSAGE-O               05430070
035800              PERFORM 8000-WRITE-OUTPUT                           05440099
232800                                                                  05450099
046000          WHEN OTHER                                              05460099
002200              SET PS-WEBITM-ERROR TO TRUE                         05470099
008900              ADD 1                   TO PA-ERRORS-FOUND          05480099
069200              DISPLAY ' *ERROR* SKU=' PIR-SKU                     05490099
069200                      '  NO ROW FOUND - TWEBITM2 FOR SKU '        05500099
045800              SET PS-HAVE-TWEBITM-NO  TO TRUE                     05510099
069200              MOVE '  NO ROW FOUND - TWEBITM2 FOR SKU '           05520099
069200                                   TO POR-MESSAGE-O               05530099
035800              PERFORM 8000-WRITE-OUTPUT                           05540099
045900                                                                  05550099
046400     END-EVALUATE.                                                05560099
036600                                                                  05570099
057100******************************************************************05580000
057200*         U P D A T E   T W E B I T M   T A B L E                 05590099
057300******************************************************************05600000
057400 4000-UPDATE-TWEBITM.                                             05610000
057500                                                                  05620000
057500                                                                  05630099
057600     PERFORM WITH TEST AFTER                                      05640000
057700       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       05650000
057800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05660000
057900           OR (SQLCODE = ZERO))                                   05670000
058000                                                                  05680000
058100         EXEC SQL                                                 05690000
058200             UPDATE TWEBITM                                       05700000
058300                SET EFF_END_TMST  = CURRENT TIMESTAMP             05710069
058400              WHERE INTR_UPC_ID   = :DK-INTR-UPC-ID               05720069
058500                AND EFF_END_TMST IS NULL                          05730069
058600         END-EXEC                                                 05740000
058700                                                                  05750000
058800         EVALUATE TRUE                                            05760000
058900           WHEN SQLCODE = ZERO                                    05770000
059000               ADD +1 TO PA-UPDATE-TWEBITM                        05780000
059200                                                                  05790000
059300           WHEN SQLCODE = -803                                    05800000
059400               CONTINUE                                           05810000
059500                                                                  05820000
232500           WHEN SQLCODE = -904                                    05830099
232600           WHEN SQLCODE = -913                                    05840099
232700               CONTINUE                                           05850099
232800                                                                  05860099
059600           WHEN OTHER                                             05870000
059700               MOVE '4000-UPDATE-TWEBITM' TO PV-ABEND-PARAGRAPH   05880000
059800               MOVE 'UPDATE TWEBITM'      TO PV-ABEND-OPERATION   05890000
035200               MOVE SPACES                TO PV-DISPLAY-LINE      05900021
035400               STRING ' SKU => ' PIR-SKU                          05910099
035600                      ' SEVERE ERROR OCCURRED'                    05920021
035700                       DELIMITED BY SIZE                          05930021
035800                         INTO PV-DISPLAY-LINE                     05940021
035900               END-STRING                                         05950021
036000               DISPLAY PV-DISPLAY-LINE                            05960021
059900               PERFORM 9900-DB2-ABEND                             05970000
060000         END-EVALUATE                                             05980000
060100     END-PERFORM.                                                 05990000
060200                                                                  06000000
060300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06010000
060400         MOVE '4000-UPDATE-TWEBITM' TO PV-ABEND-PARAGRAPH         06020000
060500         MOVE 'MAX RETRIES'         TO PV-ABEND-OPERATION         06030000
035200         MOVE SPACES                TO PV-DISPLAY-LINE            06040021
035400         STRING ' SKU => ' PIR-SKU                                06050099
035600                ' SEVERE ERROR OCCURRED'                          06060021
035700                  DELIMITED BY SIZE                               06070021
035800                    INTO PV-DISPLAY-LINE                          06080021
035900         END-STRING                                               06090021
036000         DISPLAY PV-DISPLAY-LINE                                  06100021
060600         PERFORM 9900-DB2-ABEND                                   06110000
060700     END-IF.                                                      06120000
060800                                                                  06130000
069700******************************************************************06140033
061200 4100-VALIDATE-TWEBITM.                                           06150033
069900                                                                  06160033
002200     SET PS-NO-WEBITM-ERROR  TO TRUE.                             06170050
002200     SET PS-UPDATE-NEEDED-NO TO TRUE.                             06180051
071200                                                                  06190099
085500     IF PIR-SHIP-SURCHARGE > SPACES                               06200099
085400*      EDIT SURCHARGE                                             06210099
071100        PERFORM 4200-EDIT-SHIP-SURCHARGE                          06220099
071100     END-IF.                                                      06230099
069900                                                                  06240045
013500     IF PIR-SHIP-SERVICE-CDE > SPACES                             06250052
073300*      EDIT SHIPPING SERVICE CODE                                 06260039
071100        PERFORM 4300-EDIT-SHIP-SERVICE                            06270099
071100     END-IF.                                                      06280033
071200                                                                  06290033
073400     IF PIR-SHIP-RESTRICT > SPACES                                06300066
073300*      EDIT SHIPPING RESTRICTIONS                                 06310066
071100        PERFORM 4400-EDIT-SHIP-RESTRICT                           06320099
071100     END-IF.                                                      06330044
071200                                                                  06340039
078600     IF PIR-SHIP-GROUP-CDE > SPACES                               06350066
078500*      EDIT SHIPPING GROUP                                        06360099
071100        PERFORM 4500-EDIT-SHIP-GRP-CDE                            06370099
071100     END-IF.                                                      06380048
071100                                                                  06390039
gftwrp** default gift wrap ind to N                                     06391099
gftwrp     MOVE 'N'               TO WEBITM-GFT-WRAP-AVL-IND.           06392099
gftwrp     SET PS-UPDATE-NEEDED   TO TRUE.                              06393099
gftwrp*    IF PIR-GIFTWRAP-IND = 'Y'                                    06400099
gftwrp*    OR PIR-GIFTWRAP-IND = 'N'                                    06410099
gftwrp*       MOVE PIR-GIFTWRAP-IND                                     06420099
gftwrp*                           TO WEBITM-GFT-WRAP-AVL-IND            06430099
gftwrp*       SET PS-UPDATE-NEEDED                                      06440099
gftwrp*                           TO TRUE                               06450099
gftwrp*    ELSE                                                         06460099
gftwrp*       IF PIR-GIFTWRAP-IND = 'y'                                 06470099
gftwrp*          MOVE 'Y'         TO WEBITM-GFT-WRAP-AVL-IND            06480099
gftwrp*          SET PS-UPDATE-NEEDED                                   06490099
gftwrp*                           TO TRUE                               06500099
gftwrp*       ELSE                                                      06510099
gftwrp*          IF PIR-GIFTWRAP-IND = 'n'                              06520099
gftwrp*             MOVE 'N'      TO WEBITM-GFT-WRAP-AVL-IND            06530099
gftwrp*             SET PS-UPDATE-NEEDED                                06540099
gftwrp*                           TO TRUE                               06550099
gftwrp*          ELSE                                                   06560099
gftwrp*             IF PIR-GIFTWRAP-IND = SPACES                        06570099
gftwrp*                CONTINUE                                         06580099
gftwrp*             ELSE                                                06590099
085400*               INVALID GIFT WRAP INDICATOR                       06600066
gftwrp*                SET PS-WEBITM-ERROR TO TRUE                      06610099
gftwrp*                ADD 1               TO PA-ERRORS-FOUND           06620099
gftwrp*                DISPLAY ' *ERROR* SKU=' PIR-SKU                  06630099
gftwrp*                        '  GIFT WRAP INDICATOR NOT VALID - '     06640099
gftwrp*                                   PIR-GIFTWRAP-IND              06650099
gftwrp*                STRING  '  GIFT WRAP INDICATOR NOT VALID - '     06660099
gftwrp*                                   PIR-GIFTWRAP-IND              06670099
gftwrp*                           PC-SPACES                             06680099
gftwrp*                           DELIMITED BY SIZE                     06690099
gftwrp*                           INTO POR-MESSAGE-O                    06700099
gftwrp*                END-STRING                                       06710099
gftwrp*                PERFORM 8000-WRITE-OUTPUT                        06720099
gftwrp*             END-IF                                              06730099
gftwrp*          END-IF                                                 06740099
gftwrp*       END-IF                                                    06750099
gftwrp*    END-IF.                                                      06760099
071100                                                                  06770054
060900******************************************************************06780099
071100 4200-EDIT-SHIP-SURCHARGE.                                        06790099
071100                                                                  06800099
085500     IF PIR-SHIP-SURCHARGE (1:1) = '$'                            06810099
085500        MOVE SPACES                  TO PIR-SHIP-SURCHARGE (1:1)  06820099
085500     END-IF.                                                      06830099
085500     MOVE PIR-SHIP-SURCHARGE         TO DP010I-UNEDITED-FIELD.    06840099
085600     MOVE 3                          TO DP010I-MAXIMUM-DIGITS.    06850099
085700     MOVE 2                          TO DP010I-MAXIMUM-DECIMALS.  06860099
085800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     06870099
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             06881099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         06882099
086000     IF DP010I-ERROR-DETECTED                                     06890099
155800        SET PS-WEBITM-ERROR          TO TRUE                      06900099
008900        ADD 1                        TO PA-ERRORS-FOUND           06910099
146600        DISPLAY ' *ERROR* SKU=' PIR-SKU                           06920099
146600                '  SHIP SURCHARGE MUST BE NUMERIC 999.99 - '      06930099
146600                        PIR-SHIP-SURCHARGE                        06940099
146600        STRING  '  SHIP SURCHARGE MUST BE NUMERIC 999.99 - '      06950099
146600                        PIR-SHIP-SURCHARGE                        06960099
035700                        PC-SPACES                                 06970099
035700                        DELIMITED BY SIZE                         06980099
014300                        INTO POR-MESSAGE-O                        06990099
014300        END-STRING                                                07000099
035800        PERFORM 8000-WRITE-OUTPUT                                 07010099
087000     ELSE                                                         07020099
122700        SET PS-UPDATE-NEEDED TO TRUE                              07030099
070200        MOVE DP010I-NUMERIC-FIELD    TO WEBITM-SHIP-SRCHG-FEE-AMT 07040099
087000     END-IF.                                                      07050099
087600                                                                  07060099
075300******************************************************************07070000
068500*EDIT SHIPPING SERVICE CODE                                       07080052
075300******************************************************************07090027
071100 4300-EDIT-SHIP-SERVICE.                                          07100099
071100                                                                  07110027
013500     MOVE PIR-SHIP-SERVICE-CDE                                    07120053
013500                             TO DP010I-UNEDITED-FIELD.            07130099
068700     MOVE 4                  TO DP010I-MAXIMUM-DIGITS.            07140099
068800     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          07150099
068900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07160027
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07171099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         07172099
069100     IF DP010I-ERROR-DETECTED                                     07180027
002200         SET PS-WEBITM-ERROR TO TRUE                              07190099
008900         ADD 1               TO PA-ERRORS-FOUND                   07200099
069200         DISPLAY ' *ERROR* SKU=' PIR-SKU                          07210084
069200                 '  SHIP SERVICE CODE NOT NUMERIC - '             07220075
069300                         PIR-SHIP-SERVICE-CDE                     07230052
069200         STRING  '  SHIP SERVICE CODE NOT NUMERIC - '             07240075
069300                         PIR-SHIP-SERVICE-CDE                     07250070
035700                             PC-SPACES                            07260072
035700                             DELIMITED BY SIZE                    07270072
014300                             INTO POR-MESSAGE-O                   07280070
014300         END-STRING                                               07290070
035800         PERFORM 8000-WRITE-OUTPUT                                07300071
070100     ELSE                                                         07310027
070200         MOVE DP010I-NUMERIC-FIELD                                07320032
070200                             TO PV-SHIP-SERVICE-CDE               07330099
070900         PERFORM 4320-CHECK-SHIP-SERV-CDE                         07340099
073100     END-IF.                                                      07350027
073200                                                                  07360027
075300******************************************************************07370027
070900 4320-CHECK-SHIP-SERV-CDE.                                        07380099
139500                                                                  07390027
139700     MOVE PV-SHIP-SERVICE-CDE TO VSCHVL-CHARTC-SEQ-NBR.           07400052
139800                                                                  07410027
139900     EXEC SQL                                                     07420099
140000            SELECT CHARTC_VAL_DESC                                07430027
140100              INTO :VSCHVL-CHARTC-VAL-DESC                        07440027
140200              FROM TVSCHVL                                        07450027
140300             WHERE CHARTC_SEQ_NBR = :VSCHVL-CHARTC-SEQ-NBR        07460027
140400               AND STAT_CDE       = 'A'                           07470027
140500               AND CHARTC_CDE     = 13                            07480027
140600     END-EXEC.                                                    07490099
140700                                                                  07500027
140800     EVALUATE TRUE                                                07510099
140900             WHEN SQLCODE = ZERO                                  07520027
022700                  SET PS-UPDATE-NEEDED TO TRUE                    07530049
139700                  MOVE PV-SHIP-SERVICE-CDE                        07540053
139700                                       TO WEBITM-SHIP-SRVC-SEQ-NBR07550099
232800                                                                  07560049
141000             WHEN SQLCODE = +100                                  07570031
002200                  SET PS-WEBITM-ERROR TO TRUE                     07580035
008900                  ADD 1               TO PA-ERRORS-FOUND          07590099
069200                  DISPLAY ' *ERROR* SKU=' PIR-SKU                 07600084
069200                          '  SHIP SERVICE CODE NOT VALID - '      07610075
069300                                  PIR-SHIP-SERVICE-CDE            07620052
069200                  STRING  '  SHIP SERVICE CODE NOT VALID - '      07630075
069300                             PIR-SHIP-SERVICE-CDE                 07640070
035700                             PC-SPACES                            07650072
035700                             DELIMITED BY SIZE                    07660071
014300                             INTO POR-MESSAGE-O                   07670070
014300                  END-STRING                                      07680070
035800                  PERFORM 8000-WRITE-OUTPUT                       07690071
035800                                                                  07700070
036100             WHEN OTHER                                           07710099
002200                  SET PS-WEBITM-ERROR TO TRUE                     07720099
008900                  ADD 1               TO PA-ERRORS-FOUND          07730099
069200                  DISPLAY ' *ERROR* SKU=' PIR-SKU                 07740099
069200                          '  SHIP SERVICE COD2 NOT VALID - '      07750099
069300                                  PIR-SHIP-SERVICE-CDE            07760099
069200                  STRING  '  SHIP SERVICE COD2 NOT VALID - '      07770099
069300                             PIR-SHIP-SERVICE-CDE                 07780099
035700                             PC-SPACES                            07790099
035700                             DELIMITED BY SIZE                    07800099
014300                             INTO POR-MESSAGE-O                   07810099
014300                  END-STRING                                      07820099
035800                  PERFORM 8000-WRITE-OUTPUT                       07830099
035800                                                                  07840099
142600     END-EVALUATE.                                                07850099
080900                                                                  07860039
069700******************************************************************07870039
071100 4400-EDIT-SHIP-RESTRICT.                                         07880099
071200                                                                  07890039
073400     MOVE PIR-SHIP-RESTRICT          TO DP010I-UNEDITED-FIELD.    07900039
073500     MOVE 4                          TO DP010I-MAXIMUM-DIGITS.    07910039
073600     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  07920039
073700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07930039
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07941099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         07942099
073900     IF DP010I-ERROR-DETECTED                                     07950039
002200         SET PS-WEBITM-ERROR    TO TRUE                           07960039
008900         ADD 1                  TO PA-ERRORS-FOUND                07970099
069200         DISPLAY ' *ERROR* SKU=' PIR-SKU                          07980084
069200                 '  SHIP RESTRICT CODE NOT NUMERIC - '            07990075
069300                         PIR-SHIP-RESTRICT                        08000039
069200         STRING  '  SHIP RESTRICT CODE NOT NUMERIC - '            08010075
069300                         PIR-SHIP-RESTRICT                        08020070
035700                         PC-SPACES                                08030072
035700                         DELIMITED BY SIZE                        08040072
014300                         INTO POR-MESSAGE-O                       08050072
014300         END-STRING                                               08060070
035800         PERFORM 8000-WRITE-OUTPUT                                08070071
070100     ELSE                                                         08080039
070200         MOVE DP010I-NUMERIC-FIELD                                08090039
070200                            TO PV-SHIP-RESTRICT                   08100039
070900         PERFORM 4420-CHECK-SHIP-RESTRICT                         08110099
073100     END-IF.                                                      08120039
075300                                                                  08130039
069700******************************************************************08140039
070900 4420-CHECK-SHIP-RESTRICT.                                        08150099
075300                                                                  08160039
144100     MOVE PV-SHIP-RESTRICT TO VSCHVL-CHARTC-SEQ-NBR.              08170052
075300                                                                  08180039
144800     EXEC SQL                                                     08190099
144900            SELECT CHARTC_VAL_DESC                                08200039
145000              INTO :VSCHVL-CHARTC-VAL-DESC                        08210039
145100              FROM TVSCHVL                                        08220039
145200             WHERE CHARTC_SEQ_NBR = :VSCHVL-CHARTC-SEQ-NBR        08230039
145300               AND STAT_CDE       = 'A'                           08240039
145400               AND CHARTC_CDE     = 17                            08250039
145500     END-EXEC.                                                    08260099
145600                                                                  08270039
145700     EVALUATE TRUE                                                08280099
145800           WHEN SQLCODE = ZERO                                    08290039
022700               SET PS-UPDATE-NEEDED TO TRUE                       08300049
144100               MOVE PV-SHIP-RESTRICT                              08310053
139700                                    TO WEBITM-SHIP-RSTRC-SEQ-NBR  08320053
022700                                                                  08330049
145900           WHEN SQLCODE = +100                                    08340039
146600               SET PS-WEBITM-ERROR TO TRUE                        08350039
008900               ADD 1               TO PA-ERRORS-FOUND             08360099
146600               DISPLAY ' *ERROR* SKU=' PIR-SKU                    08370084
146600                       '  SHIP RESTRICT CODE NOT VALID - '        08380099
146600                               PIR-SHIP-RESTRICT                  08390039
146600               STRING  '  SHIP RESTRICT CODE NOT VALID - '        08400070
146600                               PIR-SHIP-RESTRICT                  08410070
035700                               PC-SPACES                          08420072
035700                               DELIMITED BY SIZE                  08430072
014300                               INTO POR-MESSAGE-O                 08440072
014300               END-STRING                                         08450070
035800               PERFORM 8000-WRITE-OUTPUT                          08460071
145600                                                                  08470039
036100           WHEN OTHER                                             08480099
146600               SET PS-WEBITM-ERROR TO TRUE                        08490099
008900               ADD 1               TO PA-ERRORS-FOUND             08500099
146600               DISPLAY ' *ERROR* SKU=' PIR-SKU                    08510099
146600                       '  SHIP RESTRICT COD2 NOT VALID - '        08520099
146600                               PIR-SHIP-RESTRICT                  08530099
146600               STRING  '  SHIP RESTRICT COD2 NOT VALID - '        08540099
146600                               PIR-SHIP-RESTRICT                  08550099
035700                               PC-SPACES                          08560099
035700                               DELIMITED BY SIZE                  08570099
014300                               INTO POR-MESSAGE-O                 08580099
014300               END-STRING                                         08590099
035800               PERFORM 8000-WRITE-OUTPUT                          08600099
145600                                                                  08610099
147500     END-EVALUATE.                                                08620099
150200                                                                  08630039
069700******************************************************************08640039
071100 4500-EDIT-SHIP-GRP-CDE.                                          08650099
071200                                                                  08660039
078600     MOVE PIR-SHIP-GROUP-CDE         TO DP010I-UNEDITED-FIELD.    08670052
078700     MOVE 4                          TO DP010I-MAXIMUM-DIGITS.    08680039
078800     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  08690039
078900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     08700039
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             08711099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         08712099
079100     IF DP010I-ERROR-DETECTED                                     08720039
002200         SET PS-WEBITM-ERROR    TO TRUE                           08730039
008900         ADD 1                  TO PA-ERRORS-FOUND                08740099
069200         DISPLAY ' *ERROR* SKU=' PIR-SKU                          08750084
069200                 '  SHIP GROUP CODE NOT NUMERIC - '               08760039
069300                         PIR-SHIP-GROUP-CDE                       08770052
069200         STRING  '  SHIP GROUP CODE NOT NUMERIC - '               08780070
069300                         PIR-SHIP-GROUP-CDE                       08790070
035700                         PC-SPACES                                08800072
035700                         DELIMITED BY SIZE                        08810072
014300                         INTO POR-MESSAGE-O                       08820072
014300         END-STRING                                               08830070
035800         PERFORM 8000-WRITE-OUTPUT                                08840071
080100     ELSE                                                         08850039
080200         MOVE DP010I-NUMERIC-FIELD   TO PV-SHIP-GROUP-CDE         08860052
080900         PERFORM 4520-CHECK-SHIP-GRP-CDE                          08870099
080100     END-IF.                                                      08880039
083400                                                                  08890039
060900******************************************************************08900036
080900 4520-CHECK-SHIP-GRP-CDE.                                         08910099
083400                                                                  08920039
150900     MOVE PV-SHIP-GROUP-CDE TO VSCHVL-CHARTC-SEQ-NBR.             08930052
151000                                                                  08940039
151700     EXEC SQL                                                     08950099
151800            SELECT CHARTC_VAL_DESC                                08960039
151900              INTO :VSCHVL-CHARTC-VAL-DESC                        08970039
152000              FROM TVSCHVL                                        08980039
152100             WHERE CHARTC_SEQ_NBR = :VSCHVL-CHARTC-SEQ-NBR        08990039
152200               AND STAT_CDE       = 'A'                           09000039
152300               AND CHARTC_CDE     = 18                            09010039
152400     END-EXEC.                                                    09020099
152500                                                                  09030039
152600     EVALUATE TRUE                                                09040099
152700           WHEN SQLCODE = ZERO                                    09050039
154900              MOVE VSCHVL-CHARTC-VAL-DESC TO PV-DESC6             09060079
155000               IF PV-DESC6(1:2) = 'DS'                            09070079
155100                  PERFORM 4540-VALIDATE-VENDOR                    09080099
155000               ELSE                                               09090079
022700                  SET PS-UPDATE-NEEDED TO TRUE                    09100079
150900                  MOVE PV-SHIP-GROUP-CDE                          09110079
150900                            TO WEBITM-SHIP-GP-SEQ-NBR             09120079
155200               END-IF                                             09130079
155200                                                                  09140079
152800           WHEN SQLCODE = +100                                    09150039
146600               SET PS-WEBITM-ERROR TO TRUE                        09160039
008900               ADD 1               TO PA-ERRORS-FOUND             09170099
146600               DISPLAY ' *ERROR* SKU=' PIR-SKU                    09180084
146600                       '  SHIP GROUP CODE NOT VALID - '           09190039
146600                               PIR-SHIP-GROUP-CDE                 09200052
146600               STRING  '  SHIP GROUP CODE NOT VALID - '           09210070
146600                               PIR-SHIP-GROUP-CDE                 09220070
035700                               PC-SPACES                          09230072
035700                               DELIMITED BY SIZE                  09240072
014300                               INTO POR-MESSAGE-O                 09250072
014300               END-STRING                                         09260070
035800               PERFORM 8000-WRITE-OUTPUT                          09270071
154500                                                                  09280039
036100           WHEN OTHER                                             09290099
146600               SET PS-WEBITM-ERROR TO TRUE                        09300099
008900               ADD 1               TO PA-ERRORS-FOUND             09310099
146600               DISPLAY ' *ERROR* SKU=' PIR-SKU                    09320099
146600                       '  SHIP GROUP COD2 NOT VALID - '           09330099
146600                               PIR-SHIP-GROUP-CDE                 09340099
146600               STRING  '  SHIP GROUP COD2 NOT VALID - '           09350099
146600                               PIR-SHIP-GROUP-CDE                 09360099
035700                               PC-SPACES                          09370099
035700                               DELIMITED BY SIZE                  09380099
014300                               INTO POR-MESSAGE-O                 09390099
014300               END-STRING                                         09400099
035800               PERFORM 8000-WRITE-OUTPUT                          09410099
154500                                                                  09420099
154500     END-EVALUATE.                                                09430099
157400                                                                  09440039
060900******************************************************************09450039
157900*   THE GROUP CODE IS DS(DIRECT SHIP), CHECK IF THE VENDOR IS     09460099
157900*   CDS(CONSUMER DIRECT SHIP) ELIGIBLE.                           09470099
157900*   GET ENT-ID FOR SKU.                                           09480099
060900******************************************************************09490049
155100 4540-VALIDATE-VENDOR.                                            09500099
155100                                                                  09510039
157800     MOVE PIR-SKU TO DK-SKU.                                      09520039
157900                                                                  09530049
158000     EXEC SQL                                                     09540039
158100         SELECT ENT_ID                                            09550039
158200           INTO :XLT00004-ENT-ID                                  09560039
158300           FROM XLT_SKU A                                         09570039
158400              , XLT_VND_STYL B                                    09580039
158500          WHERE A.SKU_NBR    = :DK-SKU                            09590039
158600            AND B.STYL_ID    = A.STYL_ID                          09600039
158700     END-EXEC.                                                    09610039
158800                                                                  09620039
158900     EVALUATE TRUE                                                09630039
159000       WHEN SQLCODE = ZERO                                        09640039
150900           CONTINUE                                               09650053
159200                                                                  09660039
159300       WHEN OTHER                                                 09670099
159400           MOVE 999999 TO XLT00004-ENT-ID                         09680039
159500                                                                  09690039
160600     END-EVALUATE.                                                09700039
160700                                                                  09710039
160800     EXEC SQL                                                     09720039
160900         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 09730039
161000     END-EXEC.                                                    09740039
161100                                                                  09750039
161200*CHECK IF ENT-ID IS 'CONSUMER DIRECT SHIP ELIGIBLE' (CDS).        09760039
161300     EXEC SQL                                                     09770039
161400         SELECT ENT_ID                                            09780039
161500           INTO :VNT00001-ENT-ID                                  09790039
161600           FROM VNT_VND_CPBL                                      09800039
161700          WHERE ENT_ID       = :XLT00004-ENT-ID                   09810039
161800            AND VND_CPBL_CDE = 'CDS'                              09820039
161900            AND EFF_BEG_DTE <= :PV-CURRENT-DATE                   09830039
162000            AND EFF_END_DTE >= :PV-CURRENT-DATE                   09840039
162100     END-EXEC.                                                    09850039
162200                                                                  09860039
162300     EVALUATE TRUE                                                09870039
162400       WHEN SQLCODE = ZERO                                        09880039
122700           SET PS-UPDATE-NEEDED TO TRUE                           09890049
150900           MOVE PV-SHIP-GROUP-CDE                                 09900053
150900                              TO WEBITM-SHIP-GP-SEQ-NBR           09910099
162600                                                                  09920039
162700       WHEN SQLCODE = +100                                        09930039
163000*       UNABLE TO ASSIGN 'DS' TO SKU. SKU'S VENDOR NOT A DIREC MSG09940039
155800           SET PS-WEBITM-ERROR TO TRUE                            09950099
008900           ADD 1               TO PA-ERRORS-FOUND                 09960099
161700           MOVE XLT00004-ENT-ID TO PV-ENT-ID                      09970099
146600           DISPLAY ' *ERROR* SKU=' PIR-SKU                        09980099
146600                   '  INVALID VENDOR- '                           09990099
161700                           PV-ENT-ID                              10000099
146600                   ' FOR SHIP GROUP CODE- '                       10010099
146600                           PIR-SHIP-GROUP-CDE                     10020099
146600           STRING  '  INVALID VENDOR- '                           10030099
161700                           PV-ENT-ID                              10040099
146600                   ' FOR SHIP GROUP CODE- '                       10050099
146600                           PIR-SHIP-GROUP-CDE                     10060099
035700                           PC-SPACES                              10070072
035700                           DELIMITED BY SIZE                      10080072
014300                           INTO POR-MESSAGE-O                     10090072
014300           END-STRING                                             10100070
035800           PERFORM 8000-WRITE-OUTPUT                              10110071
163700                                                                  10120039
163800       WHEN OTHER                                                 10130039
163000*       UNABLE TO ASSIGN 'DS' TO SKU. SKU'S VENDOR NOT A DIREC MSG10140099
155800           SET PS-WEBITM-ERROR TO TRUE                            10150099
008900           ADD 1               TO PA-ERRORS-FOUND                 10160099
161700           MOVE XLT00004-ENT-ID TO PV-ENT-ID                      10170099
146600           DISPLAY ' *ERROR* SKU=' PIR-SKU                        10180099
146600                   '  INVALID VENDR2- '                           10190099
161700                           PV-ENT-ID                              10200099
146600                   ' FOR SHIP GROUP CODE- '                       10210099
146600                           PIR-SHIP-GROUP-CDE                     10220099
146600           STRING  '  INVALID VENDR2- '                           10230099
161700                           PV-ENT-ID                              10240099
146600                   ' FOR SHIP GROUP CODE- '                       10250099
146600                           PIR-SHIP-GROUP-CDE                     10260099
035700                           PC-SPACES                              10270099
035700                           DELIMITED BY SIZE                      10280099
014300                           INTO POR-MESSAGE-O                     10290099
014300           END-STRING                                             10300099
035800           PERFORM 8000-WRITE-OUTPUT                              10310099
163700                                                                  10320099
164900     END-EVALUATE.                                                10330039
165000                                                                  10340039
060900******************************************************************10350039
061000 5000-INSERT-TWEBITM.                                             10360039
061100                                                                  10370059
061400     PERFORM WITH TEST AFTER                                      10380036
061500       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       10390036
061600         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                10400036
061700           OR (SQLCODE = ZERO)                                    10410036
061800                                                                  10420036
061900         EXEC SQL                                                 10430036
062000             INSERT INTO TWEBITM                                  10440036
062100                   (INTR_UPC_ID                                   10450036
062200                  , EFF_BEG_TMST                                  10460036
062300                  , EFF_END_TMST                                  10470036
062400                  , ASRT_BEG_DTE                                  10480036
062500                  , ASRT_END_DTE                                  10490036
062600                  , STRG_AREA_SEQ_NBR                             10500036
062700                  , SHIP_WD_QTY                                   10510036
062800                  , SHIP_DPTH_QTY                                 10520036
062900                  , SHIP_HT_QTY                                   10530036
063000                  , SHIP_WT_QTY                                   10540036
063100                  , SHIP_DIM_SRC_CDE                              10550036
063200                  , PKG_SEQ_NBR                                   10560036
063300                  , SHIP_RSTRC_SEQ_NBR                            10570036
063400                  , GFT_WRAP_AVL_IND                              10580036
063500                  , PRD_GP_NBR                                    10590036
063600                  , PRD_GP_IND                                    10600036
063700                  , SHIP_SRCHG_FEE_AMT                            10610036
063800                  , SHIP_SRVC_SEQ_NBR                             10620036
063900                  , SHIP_GP_SEQ_NBR                               10630036
064000                  , CRE_BY_USR_ID                                 10640036
064100                  , WEB_ITM_DLTD_IND                              10650036
064200                  , HAZDS_IND                                     10660036
064300                  , BRKBL_IND                                     10670036
064400                  , GC_IND                                        10680036
064500                  , SHIP_ALN_IND                                  10690036
064600                  , WEB_EXCLV_IND)                                10700036
064700             VALUES                                               10710036
064800                   (:WEBITM-INTR-UPC-ID                           10720036
064900                  , CURRENT TIMESTAMP                             10730036
065000                  , NULL                                          10740036
065100                  , :WEBITM-ASRT-BEG-DTE                          10750036
065200                  , :WEBITM-ASRT-END-DTE                          10760036
065300                  , :WEBITM-STRG-AREA-SEQ-NBR                     10770036
065400                  , :WEBITM-SHIP-WD-QTY                           10780036
065500                  , :WEBITM-SHIP-DPTH-QTY                         10790036
065600                  , :WEBITM-SHIP-HT-QTY                           10800036
065700                  , :WEBITM-SHIP-WT-QTY                           10810036
065800                  , :WEBITM-SHIP-DIM-SRC-CDE                      10820036
065900                  , :WEBITM-PKG-SEQ-NBR                           10830036
066000                  , :WEBITM-SHIP-RSTRC-SEQ-NBR                    10840036
066100                  , :WEBITM-GFT-WRAP-AVL-IND                      10850036
066200                  , :WEBITM-PRD-GP-NBR                            10860036
066300                  , :WEBITM-PRD-GP-IND                            10870036
066400                  , :WEBITM-SHIP-SRCHG-FEE-AMT                    10880036
066500                  , :WEBITM-SHIP-SRVC-SEQ-NBR                     10890036
066600                  , :WEBITM-SHIP-GP-SEQ-NBR                       10900036
066700                  , :PC-CURRENT-PROGRAM-NAME                      10910036
066800                  , :WEBITM-WEB-ITM-DLTD-IND                      10920036
066900                  , :WEBITM-HAZDS-IND                             10930036
067000                  , :WEBITM-BRKBL-IND                             10940036
067100                  , :WEBITM-GC-IND                                10950036
067200                  , :WEBITM-SHIP-ALN-IND                          10960036
067300                  , :WEBITM-WEB-EXCLV-IND)                        10970036
067400         END-EXEC                                                 10980036
067500                                                                  10990036
067600         EVALUATE TRUE                                            11000036
067700           WHEN SQLCODE = ZERO                                    11010036
067800               ADD +1 TO PA-INSERT-TWEBITM                        11020036
205200               PERFORM 7000-IMT00024-ROUTINE                      11030099
067800** - COMMENT OUT THE FOLLOWING DISPLAYS                           11040099
067900*              DISPLAY '  INSERT TWEBITM  SKU=' PIR-SKU           11050099
032000*                      ' INT-UPC='     PV-DISPLAY-UPC-ID          11060099
032000*                      ' SURCHRGE='    WEBITM-SHIP-SRCHG-FEE-AMT  11070099
032000*                      ' SRV-CDE='     WEBITM-SHIP-SRVC-SEQ-NBR   11080099
032000*                      ' RSTRCT-CDE='  WEBITM-SHIP-RSTRC-SEQ-NBR  11090099
032000*                      ' GP-CDE='      WEBITM-SHIP-GP-SEQ-NBR     11100099
032000*                      ' GIFT-IND='    WEBITM-GFT-WRAP-AVL-IND    11110099
032000                                                                  11120082
068100           WHEN SQLCODE = -803                                    11130036
068200               CONTINUE                                           11140036
068300                                                                  11150036
068400           WHEN OTHER                                             11160036
068500               MOVE '5000-INSERT-TWEBITM' TO PV-ABEND-PARAGRAPH   11170039
068600               MOVE 'INSERT TWEBITM'      TO PV-ABEND-OPERATION   11180036
035200               MOVE SPACES                TO PV-DISPLAY-LINE      11190036
035400               STRING ' SKU => ' PIR-SKU                          11200099
035600                      ' SEVERE ERROR OCCURRED'                    11210036
035700                        DELIMITED BY SIZE                         11220036
035800                          INTO PV-DISPLAY-LINE                    11230036
035900               END-STRING                                         11240036
036000               DISPLAY PV-DISPLAY-LINE                            11250036
068700               PERFORM 9900-DB2-ABEND                             11260036
068800         END-EVALUATE                                             11270036
068900     END-PERFORM.                                                 11280036
069000                                                                  11290036
069100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11300036
069200         MOVE '5000-INSERT-TWEBITM' TO PV-ABEND-PARAGRAPH         11310039
069300         MOVE 'MAX RETRIES'         TO PV-ABEND-OPERATION         11320036
035200         MOVE SPACES                TO PV-DISPLAY-LINE            11330036
035400         STRING ' SKU => ' PIR-SKU                                11340099
035600                ' SEVERE ERROR OCCURRED'                          11350036
035700                  DELIMITED BY SIZE                               11360036
035800                    INTO PV-DISPLAY-LINE                          11370036
035900         END-STRING                                               11380036
036000         DISPLAY PV-DISPLAY-LINE                                  11390036
069400         PERFORM 9900-DB2-ABEND                                   11400036
069500     END-IF.                                                      11410036
069600                                                                  11420036
176600******************************************************************11430080
176700* 6100-INSERT-TVSRSVN.                                            11440080
176800*  ==> PROCESSES:                                                 11450080
176900*    - INSERTS A ROW INTO TVSRSVN TO RESERVE THE CURRENT SKU      11460080
177000*      WHILE TWEBITM IS BEING UPDATED BY THIS PROGRAM.            11470088
177100*    - THIS SHOULD PROHIBIT THE USERS FROM UPDATING THE SAME      11480080
177200*      SKU WITH ANOTHER ON-LINE PROCESS AT THE SAME TIME.         11490088
177300******************************************************************11500080
177400 6100-INSERT-TVSRSVN.                                             11510080
177500                                                                  11520080
177600     INITIALIZE PV-RETRY-COUNTER.                                 11530080
177700                                                                  11540080
177800     MOVE DK-ENT-ID     TO VSRSVN-ENT-ID.                         11550088
177900     MOVE DK-VS-NBR     TO VSRSVN-VS-NBR.                         11560088
178900     MOVE DK-VS-ID      TO VSRSVN-VS-ID.                          11570088
178100                                                                  11580080
178200     PERFORM  WITH TEST AFTER                                     11590080
178300       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     11600080
178400         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     11610080
178500                                                                  11620080
178600         EXEC SQL                                                 11630080
178700             INSERT INTO TVSRSVN                                  11640080
178800                     (ENT_ID                                      11650080
178900                     ,VS_NBR                                      11660080
179000                     ,VS_ID                                       11670080
179100                     ,RSRV_TYP_CDE                                11680080
179200                     ,SKU_STRGY_CDE                               11690080
179300                     ,DEPT_MDSEAR_ID                              11700080
179400                     ,MAJ_CL_MDSEAR_ID                            11710080
179500                     ,SUB_CL_MDSEAR_ID                            11720080
179600                     ,RSRV_BY_USR_ID                              11730080
179700                     ,RSRV_TMST)                                  11740080
179800             VALUES (:VSRSVN-ENT-ID,                              11750080
179900                     :VSRSVN-VS-NBR,                              11760080
180000                     :VSRSVN-VS-ID,                               11770080
180100                      'M',                                        11780080
180200                      ' ',                                        11790080
180300                      0.0,                                        11800080
180400                      0.0,                                        11810080
180500                      0.0,                                        11820080
180600                     :PC-CURRENT-PROGRAM-NAME,                    11830080
180700                      CURRENT TIMESTAMP)                          11840080
180800         END-EXEC                                                 11850080
180900                                                                  11860080
181000         EVALUATE TRUE                                            11870080
181100           WHEN SQLCODE = ZERO                                    11880080
181200           WHEN SQLCODE = +100                                    11890080
009300               ADD 1 TO PA-INSERT-TVSRSVN                         11900087
181300                                                                  11910080
181400           WHEN SQLCODE = -911                                    11920080
181500           WHEN SQLCODE = -913                                    11930080
181600               ADD 1 TO PV-RETRY-COUNTER                          11940080
181300                                                                  11950080
181700           WHEN SQLCODE = -803                                    11960089
068500               MOVE '6100-INSERT-TVSRSVN' TO PV-ABEND-PARAGRAPH   11970080
068600               MOVE 'INSERT TVSRSVN'      TO PV-ABEND-OPERATION   11980080
035600               DISPLAY ' ENT-ID='            DK-ENT-ID            11990089
035600                       ' VSN-NBR='           DK-VS-NBR            12000089
035600                       ' VS-ID='             DK-VS-ID             12010089
035200               MOVE SPACES                TO PV-DISPLAY-LINE      12020080
035400               STRING ' SKU => ' PIR-SKU                          12030099
035600                      ' DUPLICATE INSERT ERROR OCCURRED'          12040088
035700                        DELIMITED BY SIZE                         12050080
035800                        INTO PV-DISPLAY-LINE                      12060088
035900               END-STRING                                         12070080
036000               DISPLAY PV-DISPLAY-LINE                            12080080
068700               PERFORM 9900-DB2-ABEND                             12090080
182800                                                                  12100080
182900           WHEN OTHER                                             12110080
068500               MOVE '6100-INSERT-TVSRSVN' TO PV-ABEND-PARAGRAPH   12120080
068600               MOVE 'INSERT TVSRSVN'      TO PV-ABEND-OPERATION   12130080
035600               DISPLAY ' ENT-ID='            DK-ENT-ID            12140089
035600                       ' VSN-NBR='           DK-VS-NBR            12150089
035600                       ' VS-ID='             DK-VS-ID             12160089
035200               MOVE SPACES                TO PV-DISPLAY-LINE      12170080
035400               STRING ' SKU => ' PIR-SKU                          12180099
035600                      ' SEVERE ERROR OCCURRED'                    12190080
035700                        DELIMITED BY SIZE                         12200080
035800                        INTO PV-DISPLAY-LINE                      12210088
035900               END-STRING                                         12220080
036000               DISPLAY PV-DISPLAY-LINE                            12230080
068700               PERFORM 9900-DB2-ABEND                             12240080
184100         END-EVALUATE                                             12250080
184200     END-PERFORM.                                                 12260080
184300                                                                  12270080
184400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12280080
068500        MOVE '6100-INSERT-TVSRSVN' TO PV-ABEND-PARAGRAPH          12290080
069300        MOVE 'MAX RETRIES'         TO PV-ABEND-OPERATION          12300099
035600        DISPLAY ' ENT-ID='            DK-ENT-ID                   12310089
035600                ' VSN-NBR='           DK-VS-NBR                   12320089
035600                ' VS-ID='             DK-VS-ID                    12330089
035200        MOVE SPACES                TO PV-DISPLAY-LINE             12340080
035400        STRING ' SKU => ' PIR-SKU                                 12350099
035600                        ' CONTENTION ERROR OCCURRED'              12360080
035700                          DELIMITED BY SIZE                       12370080
035800                          INTO PV-DISPLAY-LINE                    12380080
035900        END-STRING                                                12390080
036000        DISPLAY PV-DISPLAY-LINE                                   12400080
068700        PERFORM 9900-DB2-ABEND                                    12410080
185600     END-IF.                                                      12420080
185700                                                                  12430080
185800******************************************************************12440080
185900* 6200-DELETE-TVSRSVN.                                            12450080
186000*  ==> PROCESSES:                                                 12460080
186100*    - DELETE THE CURRENT SKU RESERVATION FROM TVSRSVN TO RELEASE 12470080
186200*    - THE SKU AND MAKE IT AVAILABLE FOR ANY UPDATING THAT MAY    12480080
186300*    - BE NECESSARY BY USERS USING OTHER ON-LINE PROCESSES.       12490080
186400******************************************************************12500080
186500 6200-DELETE-TVSRSVN.                                             12510080
186600                                                                  12520080
186700     INITIALIZE PV-RETRY-COUNTER.                                 12530080
186800                                                                  12540080
186900     PERFORM  WITH TEST AFTER                                     12550080
187000       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     12560080
187100         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     12570080
187200                                                                  12580080
187300         EXEC SQL                                                 12590080
187400             DELETE FROM TVSRSVN                                  12600080
187500             WHERE (VS_ID  = :VSRSVN-VS-ID)                       12610080
187600               AND (VS_NBR = :VSRSVN-VS-NBR)                      12620080
187700               AND (ENT_ID = :VSRSVN-ENT-ID)                      12630080
187800         END-EXEC                                                 12640080
187900                                                                  12650080
188000         EVALUATE TRUE                                            12660080
188100           WHEN SQLCODE = ZERO                                    12670080
009300               ADD 1 TO PA-DELETE-TVSRSVN                         12680086
009300                                                                  12690086
188200           WHEN SQLCODE = +100                                    12700080
188300               CONTINUE                                           12710080
187900                                                                  12720080
188400           WHEN SQLCODE = -911                                    12730080
188500           WHEN SQLCODE = -913                                    12740080
188600               ADD +1 TO PV-RETRY-COUNTER                         12750080
187900                                                                  12760080
188700           WHEN OTHER                                             12770080
068500               MOVE '6200-DELETE-TVSRSVN' TO PV-ABEND-PARAGRAPH   12780080
069300               MOVE 'TVSRSVN DELETE'      TO PV-ABEND-OPERATION   12790099
035600               DISPLAY ' ENT-ID='            DK-ENT-ID            12800089
035600                       ' VSN-NBR='           DK-VS-NBR            12810089
035600                       ' VS-ID='             DK-VS-ID             12820089
035200               MOVE SPACES                TO PV-DISPLAY-LINE      12830080
035400               STRING ' SKU => ' PIR-SKU                          12840099
035600                      ' SEVERE ERROR OCCURRED'                    12850080
035700                        DELIMITED BY SIZE                         12860080
035800                        INTO PV-DISPLAY-LINE                      12870088
035900               END-STRING                                         12880080
036000               DISPLAY PV-DISPLAY-LINE                            12890080
068700               PERFORM 9900-DB2-ABEND                             12900080
189900         END-EVALUATE                                             12910080
190000     END-PERFORM.                                                 12920080
190100                                                                  12930080
190200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12940080
068500        MOVE '6200-DELETE-TVSRSVN' TO PV-ABEND-PARAGRAPH          12950080
069300        MOVE 'MAX RETRIES'         TO PV-ABEND-OPERATION          12960099
035600        DISPLAY ' ENT-ID='            DK-ENT-ID                   12970089
035600                ' VSN-NBR='           DK-VS-NBR                   12980089
035600                ' VS-ID='             DK-VS-ID                    12990089
035200        MOVE SPACES                TO PV-DISPLAY-LINE             13000080
035400        STRING ' SKU => ' PIR-SKU                                 13010099
035600                        ' CONTENTION ERROR OCCURRED'              13020080
035700                          DELIMITED BY SIZE                       13030080
035800                          INTO PV-DISPLAY-LINE                    13040080
035900        END-STRING                                                13050080
036000        DISPLAY PV-DISPLAY-LINE                                   13060080
068700        PERFORM 9900-DB2-ABEND                                    13070080
191400     END-IF.                                                      13080080
191500                                                                  13090080
228910******************************************************************13100099
228911*        P R O C E S S   I M T 0 0 0 2 4   T A B L E              13110099
228912******************************************************************13120099
228913* CHECK FOR EXISTANCE ON IMT00024 TABLE.  IF NOT FOUND, INSERT    13130099
246800* INTO IMT_ITM_DC_ASSN TO PREVENT THE CICS SCREEN WSWEBITM FROM   13140099
246800* DISPLAYING THE ERROR "03551-I-WEB SKU DC ATTRIBUTES NOT FOUND"  13150099
176600******************************************************************13160099
205200 7000-IMT00024-ROUTINE.                                           13170099
121440                                                                  13180099
121450     PERFORM 7200-GET-IMT00024.                                   13190099
121460     IF PS-HAVE-IMT00024-YES                                      13200099
121470        CONTINUE                                                  13210099
121480     ELSE                                                         13220099
121800        PERFORM 7400-INSERT-IMT00024                              13230099
121900     END-IF.                                                      13240099
121900                                                                  13250099
176600******************************************************************13260099
228915 7200-GET-IMT00024.                                               13270099
061100                                                                  13280099
061400     PERFORM WITH TEST AFTER                                      13290099
061500       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       13300099
061600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13310099
061700            OR (SQLCODE = ZERO)                                   13320099
061700            OR (SQLCODE = +100))                                  13330099
061800                                                                  13340099
228940         EXEC SQL                                                 13350099
228950            SELECT AUTO_SORT_CDE                                  13360099
229500              INTO :IMT00024-AUTO-SORT-CDE                        13370099
230500              FROM IMT_ITM_DC_ASSN                                13380099
230600             WHERE INTR_UPC_ID  = :DK-INTR-UPC-ID                 13390099
230700               AND EFF_END_TMST IS NULL                           13400099
230800         END-EXEC                                                 13410099
230900                                                                  13420099
231000         EVALUATE TRUE                                            13430099
231100           WHEN SQLCODE = ZERO                                    13440099
121460                SET PS-HAVE-IMT00024-YES   TO TRUE                13450099
231300                                                                  13460099
231400           WHEN SQLCODE = +100                                    13470099
004900                SET PS-HAVE-IMT00024-NO    TO TRUE                13480099
231900                                                                  13490099
232500           WHEN SQLCODE = -904                                    13500099
232600           WHEN SQLCODE = -913                                    13510099
232700                CONTINUE                                          13520099
232800                                                                  13530099
232000           WHEN OTHER                                             13540099
228915                MOVE '7200-GET-IMT00024'                          13550099
228915                                        TO PV-ABEND-PARAGRAPH     13560099
069300                MOVE 'IMT00024 SELECT'  TO PV-ABEND-OPERATION     13570099
035200                MOVE SPACES             TO PV-DISPLAY-LINE        13580099
035400                STRING ' SKU => ' PIR-SKU                         13590099
035600                       ' SEVERE ERROR OCCURRED'                   13600099
035700                         DELIMITED BY SIZE                        13610099
035800                         INTO PV-DISPLAY-LINE                     13620099
035900                END-STRING                                        13630099
036000                DISPLAY PV-DISPLAY-LINE                           13640099
068700                PERFORM 9900-DB2-ABEND                            13650099
233400                                                                  13660099
233500         END-EVALUATE                                             13670099
233500     END-PERFORM.                                                 13680099
233500                                                                  13690099
069100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         13700099
228915        MOVE '7200-GET-IMT00024'   TO PV-ABEND-PARAGRAPH          13710099
069300        MOVE 'IMT00024 SELECT'     TO PV-ABEND-OPERATION          13720099
035200        MOVE SPACES                TO PV-DISPLAY-LINE             13730099
035400        STRING ' SKU => ' PIR-SKU                                 13740099
035600               ' MAXIMUM RETRIES EXCEEDED'                        13750099
035700                 DELIMITED BY SIZE                                13760099
035800                 INTO PV-DISPLAY-LINE                             13770099
035900        END-STRING                                                13780099
036000        DISPLAY PV-DISPLAY-LINE                                   13790099
068700        PERFORM 9900-DB2-ABEND                                    13800099
069100     END-IF.                                                      13810099
233600                                                                  13820099
240200******************************************************************13830099
240300* INSERT A ROW TO THE IMT00024 DATABASE.                          13840099
240400******************************************************************13850099
240500 7400-INSERT-IMT00024.                                            13860099
233600                                                                  13870099
241200     PERFORM 7600-LOAD-IMT00024.                                  13880099
241300                                                                  13890099
241400     EXEC SQL                                                     13900099
241500         INSERT INTO IMT_ITM_DC_ASSN                              13910099
241600               (INTR_UPC_ID                                       13920099
241700              , DC_NBR                                            13930099
241800              , EFF_BEG_TMST                                      13940099
241900              , EFF_END_TMST                                      13950099
242000              , AUTO_SORT_CDE                                     13960099
242100              , SORT_BOX_SZ_DESC                                  13970099
242200              , PICK_LOC_TYP_CDE                                  13980099
242300              , CNVYB_IND                                         13990099
242400              , BAGBL_IND                                         14000099
242500              , SHIP_COST_AMT)                                    14010099
242600         VALUES                                                   14020099
242700               (:IMT00024-INTR-UPC-ID                             14030099
242800              , :IMT00024-DC-NBR                                  14040099
242900              , CURRENT TIMESTAMP                                 14050099
243000              , NULL                                              14060099
243100              , :IMT00024-AUTO-SORT-CDE                           14070099
243200              , :IMT00024-SORT-BOX-SZ-DESC                        14080099
243300              , :IMT00024-PICK-LOC-TYP-CDE                        14090099
243400              , :IMT00024-CNVYB-IND                               14100099
243500              , :IMT00024-BAGBL-IND                               14110099
243600              , :IMT00024-SHIP-COST-AMT)                          14120099
243700     END-EXEC.                                                    14130099
243800                                                                  14140099
243900     EVALUATE TRUE                                                14150099
244000         WHEN SQLCODE = ZERO                                      14160099
244100              ADD +1 TO PA-INSERT-IMT00024                        14170099
244300                                                                  14180099
244400         WHEN SQLCODE = -803                                      14190099
244500              CONTINUE                                            14200099
244600                                                                  14210099
244700         WHEN OTHER                                               14220099
228915              MOVE '7400-INSERT-IMT00024'                         14230099
228915                                      TO PV-ABEND-PARAGRAPH       14240099
069300              MOVE 'IMT00024 INSERT'  TO PV-ABEND-OPERATION       14250099
035200              MOVE SPACES             TO PV-DISPLAY-LINE          14260099
035400              STRING ' SKU => ' PIR-SKU                           14270099
035600                     ' SEVERE ERROR OCCURRED'                     14280099
035700                       DELIMITED BY SIZE                          14290099
035800                       INTO PV-DISPLAY-LINE                       14300099
035900              END-STRING                                          14310099
036000              DISPLAY PV-DISPLAY-LINE                             14320099
068700              PERFORM 9900-DB2-ABEND                              14330099
246500     END-EVALUATE.                                                14340099
246600                                                                  14350099
247100******************************************************************14360099
247200 7600-LOAD-IMT00024.                                              14370099
247800                                                                  14380099
247800     INITIALIZE DCLIMT00024.                                      14390099
247900     MOVE DK-INTR-UPC-ID    TO IMT00024-INTR-UPC-ID.              14400099
248000     MOVE '870'             TO IMT00024-DC-NBR.                   14410099
248100     MOVE 'N'               TO IMT00024-AUTO-SORT-CDE             14420099
248700                               IMT00024-CNVYB-IND                 14430099
248800                               IMT00024-BAGBL-IND.                14440099
249000                                                                  14450099
095000******************************************************************14460080
035800 8000-WRITE-OUTPUT.                                               14470071
069600                                                                  14480099
009900     MOVE PIR-SKU      TO POR-SKU-O.                              14490099
013300     MOVE PIR-USER-ID  TO POR-USER-ID-O.                          14500099
035800     WRITE OUTPUT-RECORD FROM PV-OUT-RECORD.                      14510071
035800     ADD 1 TO PA-WRITE-COUNTER.                                   14520099
069600                                                                  14530099
009900     MOVE PIR-SKU      TO POR2-SKU-O.                             14540099
035800     WRITE OUTPUT-RECORD FROM PV-OUT-RECORD2.                     14550099
069600                                                                  14560070
095000******************************************************************14570015
025000*     DISPLAY PROGRAM EXECUTION TOTALS IN HELD OUTPUT             14580099
095000******************************************************************14590014
024900 9000-DISPLAY-TOTALS.                                             14600014
094900                                                                  14610014
025100     DISPLAY ' '.                                                 14620014
025200     DISPLAY PC-ASTERISKS-LINE.                                   14630099
008900     MOVE PA-FILES-READ              TO PV-DISPLAY-PA.            14640099
025400     DISPLAY '* INPUT FILES READ    = ' PV-DISPLAY-PA ' *'        14650099
025200                                                                  14660099
025300     MOVE PA-RECORDS-READ            TO PV-DISPLAY-PA.            14670014
025400     DISPLAY '* INPUT RECORDS READ  = ' PV-DISPLAY-PA ' *'        14680014
025200     DISPLAY PC-ASTERISKS-TWO.                                    14690099
025200                                                                  14700099
025600     MOVE PA-SKU-ERRORS              TO PV-DISPLAY-PA.            14710099
025700     DISPLAY '* SKUS IN ERROR       = ' PV-DISPLAY-PA ' *'        14720099
025200                                                                  14730099
026400     MOVE PA-WRITE-COUNTER           TO PV-DISPLAY-PA.            14740099
026500     DISPLAY '* ERROR RECORDS WROTE = ' PV-DISPLAY-PA ' *'        14750099
025200     DISPLAY PC-ASTERISKS-TWO.                                    14760099
025200                                                                  14770099
026200     MOVE PA-UPDATE-TWEBITM          TO PV-DISPLAY-PA.            14780014
026300     DISPLAY '* WEBITEM SKU UPDATES = ' PV-DISPLAY-PA ' *'        14790014
026400     MOVE PA-INSERT-TWEBITM          TO PV-DISPLAY-PA.            14800014
026500     DISPLAY '* WEBITEM SKU INSERTS = ' PV-DISPLAY-PA ' *'        14810014
026400     MOVE PA-INSERT-IMT00024         TO PV-DISPLAY-PA.            14820099
026500     DISPLAY '* ITEM/DC ASSN INSERTS= ' PV-DISPLAY-PA ' *'        14830099
025200     DISPLAY PC-ASTERISKS-TWO.                                    14840099
026200     MOVE PA-INSERT-TVSRSVN          TO PV-DISPLAY-PA.            14850086
026300     DISPLAY '* TVSRSVN ROW INSERTS = ' PV-DISPLAY-PA ' *'        14860086
026400     MOVE PA-DELETE-TVSRSVN          TO PV-DISPLAY-PA.            14870086
026500     DISPLAY '* TVSRSVN ROW DELETES = ' PV-DISPLAY-PA ' *'        14880086
025200     DISPLAY PC-ASTERISKS-TWO.                                    14890099
027100     MOVE PA-COMMITS                 TO PV-DISPLAY-PA.            14900022
027200     DISPLAY '* TOTAL COMMITS TAKEN = ' PV-DISPLAY-PA ' *'        14910014
025200     DISPLAY PC-ASTERISKS-LINE.                                   14920099
027400     DISPLAY ' '.                                                 14930014
027500                                                                  14940014
024900     PERFORM 9200-DISPLAY-TOTALS-S.                               14950099
027500                                                                  14960099
095000******************************************************************14970099
025000*     DISPLAY PROGRAM EXECUTION TOTALS THAT WILL BE MFT'D TO      14980099
025000*     "S:/share/corp/DSV/DSV_Twebitem_Error" directory            14990099
095000******************************************************************15000099
024900 9200-DISPLAY-TOTALS-S.                                           15010099
094900                                                                  15020099
035800     MOVE SPACES TO OUTPUT-RECORD.                                15030099
035800     WRITE OUTPUT-RECORD.                                         15040099
025400                                                                  15050099
035800     WRITE OUTPUT-RECORD FROM PC-ASTERISKS-LINE.                  15060099
025400                                                                  15070099
008900     MOVE PA-FILES-READ              TO PV-OTL-COUNT.             15080099
008900     MOVE 'INPUT FILES READ   '      TO PV-OTL-VALUE.             15090099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15100099
025400                                                                  15110099
025300     MOVE PA-RECORDS-READ            TO PV-OTL-COUNT.             15120099
025400     MOVE 'INPUT RECORDS READ '      TO PV-OTL-VALUE.             15130099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15140099
025400                                                                  15150099
035800     WRITE OUTPUT-RECORD FROM PC-ASTERISKS-ONE.                   15160099
025400                                                                  15170099
025600     MOVE PA-SKU-ERRORS              TO PV-OTL-COUNT.             15180099
025700     MOVE 'SKUS IN ERROR      '      TO PV-OTL-VALUE.             15190099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15200099
035800                                                                  15210099
026400     MOVE PA-WRITE-COUNTER           TO PV-OTL-COUNT.             15220099
026500     MOVE 'ERROR RECORDS WROTE'      TO PV-OTL-VALUE.             15230099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15240099
035800                                                                  15250099
035800     WRITE OUTPUT-RECORD FROM PC-ASTERISKS-ONE.                   15260099
025400                                                                  15270099
026200     MOVE PA-UPDATE-TWEBITM          TO PV-OTL-COUNT.             15280099
026300     MOVE 'WEBITEM SKU UPDATES'      TO PV-OTL-VALUE.             15290099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15300099
025400                                                                  15310099
026200     MOVE PA-INSERT-IMT00024         TO PV-OTL-COUNT.             15320099
026300     MOVE 'ITEM/DC ASSN INSERT'      TO PV-OTL-VALUE.             15330099
035800     WRITE OUTPUT-RECORD FROM PV-OUTPUT-TOTAL-LINE.               15340099
035800                                                                  15350099
035800     WRITE OUTPUT-RECORD FROM PC-ASTERISKS-LINE.                  15360099
027400                                                                  15370099
095000******************************************************************15380000
095100* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      15390000
095200* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 15400000
095300******************************************************************15410000
095400 9900-DB2-ABEND.                                                  15420000
095500                                                                  15430000
095600     MOVE SQLCODE    TO PV-SQLCODE.                               15440000
095700     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       15450000
095800     DISPLAY '*** DB2 ERROR ***'.                                 15460000
095900     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               15470000
096000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 15480000
096100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               15490000
096200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               15500000
096300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE1.        15510000
096400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE2.        15520000
096500     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             15530000
096600     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.             15540000
096700                                                                  15550000
096800******************************************************************15560000
096900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    15570000
097000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         15580000
097100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     15590000
097200* FORMAT.                                                         15600000
097300******************************************************************15610000
097400     COPY DPPD004.                                                15620000
097500                                                                  15630000
097600     IF SQLCODE NOT = -911                                        15640000
097700         EXEC SQL                                                 15650000
097800             ROLLBACK                                             15660000
097900         END-EXEC                                                 15670000
098000     END-IF.                                                      15680000
098100                                                                  15690000
098200     MOVE +4013         TO PV-ABEND-CODE.                         15700000
098300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         15710000
098400*                                                                 15720099
