000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      ICKUP160.                                       00020003
000300 AUTHOR.          MARGARET MORRISON.                              00030000
000400 DATE-WRITTEN.    FEBRUARY 2008.                                  00040003
000500                                                                  00050000
000600*--------------------------------------------------------------*  00060000
000700*                                                              *  00070000
000800* DESCRIPTION:                                                 *  00080000
000900*      THIS PROGRAM IDENTIFIES AND AUTO APPROVES COMPLETED USA *  00090003
001000*      INVENTORY COUNTS.                                       *  00100003
001100*                                                              *  00180000
001200* INPUTS:                                                      *  00190003
001300*      NONE                                                    *  00200003
001400*                                                              *  00230000
001500* OUTPUTS:                                                     *  00240000
001600*      NONE                                                    *  00250000
001700*                                                              *  00260000
001800*--------------------------------------------------------------*  00270000
001900*--------------------------------------------------------------*  00280000
002000* HISTORY LOG:                                                    00290000
002100*--------------------------------------------------------------*  00300000
002200* DATE:        02/2008                                            00310003
002300* WR/IR#:      WR30388(USA INVENTORY COUNTS)                      00320003
002400* PROGRAMMER:  MARGARET MORRISON                                  00330000
002500* DESCRIPTION: INITIAL PROGRAM WRITE.                             00340003
002600*--------------------------------------------------------------*  00370000
836362* DATE:        06/2009                                            00468000
836362* WR/IR#:      WR36883 / INC 836362                               00469000
836362* PROGRAMMER:  COGNIZANT                                          00470000
836362* DESCRIPTION: EXCLUDING CLEARANCE ITEMS WHEN CALCULATING         00471000
836362*              ON-HANDS AND SCANNED QUANTITY FOR AUTO APPROVAL.   00471199
002600*--------------------------------------------------------------*  00471200
PK4588* DATE:        07/2010                                            00471399
PK4588* WR/IR#:      PKE#4588                                           00471499
PK4588* PROGRAMMER:  COGNIZANT                                          00471599
PK4588* DESCRIPTION: MODIFIED TO SKIP THE COUNTS THAT WENT BACK TO      00471699
PK4588*              COMPLETED STATUS AFTER GETTING APPROVED AND        00471799
PK4588*              PROCESSED. THIS IS DONE TO AVOID COUNTS            00471899
PK4588*              PROCESSED TWICE WHEN AUTO APPROVED.                00471999
CL3132*--------------------------------------------------------------*  00472099
CL3132* DATE:        08/2010                                            00472199
CL3132* WR/IR#:      CLARITY PROJECT ID: 3132C.                         00473099
CL3132* PROGRAMMER:  COGNIZANT                                          00474099
CL3132* DESCRIPTION: MODIFY THE CURSOR CMPLTD-CNTS-CSR TO CHECK BOTH    00475099
CL3132*              COMPLETED AND UPDATED STATUS FOR AUTO APPROVAL     00476099
CL3132*              ALSO MODIFIED 4210-CALC-TOTAL-ONHAND TO FETCH      00477099
CL3132*              CORRECT ON-HANDS AND MODIFIED 4220-CALC-TOTAL      00478099
CL3132*              -SCANNED TO FETCH CORRECT SCANNED QUANTITIES.      00479099
003100*--------------------------------------------------------------*  00479199
012435*--------------------------------------------------------------*  00479299
012435* DATE:        03/08/2011                                         00479399
012435* WR/IR#:      PBI000000012435                                    00479499
012435* PROGRAMMER:  COGNIZANT                                          00479599
012435* DESCRIPTION: MODIFIED THE PV-THRESHOLD ,PV-THRESHOLD1,          00479699
012435*              AND PV-THRESHOLD2  VARIABLES TO S9(5)V9(2) COMP-3  00479799
012435*              FROM S9(3)V9(2) COMP-3 IN ORDER TO SKIP THE        00479899
012435*              AUTO APRROVAL FOR COUNTS IN CASE OF VALUES         00479999
012435*              GREATER THAN 1000.                                 00480099
012435*              CHECK IF THE COUNTS ARE VOID AFTER COMPLETION AND          
012435*              BYPASS THOSE COUNTS BEFORE AUTO APPROVAL.                  
168057*--------------------------------------------------------------*  00479299
168057* DATE:        04/27/2011                                         00479399
168057* WR/IR#:      INC000001680578                                    00479499
168057* PROGRAMMER:  COGNIZANT                                          00479599
168057* DESCRIPTION: FIX TO AVOID DUPLICATE ERROR IN SELECT             00479699
168057*              STATEMENT IN 2900-CHECK-VOID-STATUS BY HANDLING    00479799
168057*              MUTIPLE FETCH SQLCODE (SQL CODE = -811)                    
168057*--------------------------------------------------------------*  00481099
008534* DATE:        07/26/2011                                         00479399
008534* WR/IR#:      PKE000000008534                                    00479499
008534* PROGRAMMER:  COGNIZANT                                          00479599
008534* DESCRIPTION: FIX TO AVOID COUNTS THAT ARE AUTO APPROVED WHEN    00479699
008534*              THE COUNT IS VOID ON THE SAME DATE OF JOB          00479799
008534*              EXECUTION.                                                 
008534*--------------------------------------------------------------*  00481099
C88463* DATE:        03/21/2014                                         00479399
C88463* WR/IR#:      CHG0088463                                         00479499
C88463* PROGRAMMER:  JIM HUNTER                                         00479599
C88463* DESCRIPTION: SKIP THE THRESHOLD EDITS FOR NON-USA COUNTS        00479699
C88463*              (CNT_TYP_CDE = 'ICC').                             00479799
C88463*--------------------------------------------------------------*  00481099
223110* DATE:        05/01/2019                                         00479399
223110* WR/IR#:      CHG0223110                                         00479499
223110* PROGRAMMER:  JIM ARENDT                                         00479599
223110* DESCRIPTION: FOR THE DELOITTE REFACTOR PROJECT, BROKE THE       00479699
223110*              CMPLTD-CNTS-CSR CURSOR INTO A CURSOR AND A SELECT. 00479699
223110*--------------------------------------------------------------*  00481099
003200 ENVIRONMENT DIVISION.                                            00490000
003300*--------------------------------------------------------------*  00500000
003400 CONFIGURATION SECTION.                                           00510000
003500 SOURCE-COMPUTER.        IBM-3090.                                00520000
003600 OBJECT-COMPUTER.        IBM-3090.                                00530000
003700                                                                  00540000
003800 INPUT-OUTPUT SECTION.                                            00550000
003900                                                                  00560000
004000 FILE-CONTROL.                                                    00570000
004100                                                                  00580099
004200 DATA DIVISION.                                                   00680000
004300 FILE SECTION.                                                    00690000
004400                                                                  00840000
004500 WORKING-STORAGE SECTION.                                         00920000
004600*--------------------------------------------------------------*  00930000
004700* PS - PROGRAM SWITCHES                                           00940000
004800*--------------------------------------------------------------*  00950000
004900 01  PS-PROGRAM-SWITCHES.                                         00960000
005000     05  PS-CMPLTD-CNTS-CSR-SW       PIC  X(001).                 01120003
005100         88  MORE-CMPLTD-CNTS                     VALUE 'Y'.      01130003
005200         88  NO-MORE-CMPLTD-CNTS                  VALUE 'N'.      01140003
005300                                                                  01150000
005400     05  PS-THRS-HIER-CDE-SW         PIC  X(001).                 01150521
005500         88  VALID-THRS-HIER-CDE                  VALUE 'Y'.      01150621
005600         88  INVALID-THRS-HIER-CDE                VALUE 'N'.      01150721
005700                                                                  01150821
005800     05  PS-AUTO-APPROVAL-SW         PIC  X(001).                 01150999
005900         88  PS-AUTO-APPROVAL-YES                 VALUE 'Y'.      01151021
006000         88  PS-AUTO-APPROVAL-NO                  VALUE 'N'.      01151121
006100                                                                  01151221
012435     05  PS-VOID-STAT-SW             PIC  X(001).                 01150999
012435         88  PS-VOID-STAT-YES                     VALUE 'Y'.      01151021
012435         88  PS-VOID-STAT-NO                      VALUE 'N'.      01151121
006100                                                                  01151221
223110     05  PS-COMP-COUNTS-SW           PIC  X(001).                 01150999
223110         88  PS-COMP-COUNTS-YES                   VALUE 'Y'.      01151021
223110         88  PS-COMP-COUNTS-NO                    VALUE 'N'.      01151121
006200*--------------------------------------------------------------*  01160000
006300* PROGRAM CONSTANTS                                               01170000
006400*--------------------------------------------------------------*  01180000
006500 01  PC-PROGRAM-CONSTANTS.                                        01190000
006600     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'ICKUP160'.     01200003
006700     05  PC-MAX-RETRIES           PIC 9(9)  VALUE 5.              01210000
006800     05  PC-COMMIT-MAX            PIC 9(9)  VALUE 9999.           01230000
006900     05  PC-7                     PIC 9(9)  VALUE 7.              01231003
007000     05  PC-COM                   PIC X(03) VALUE 'COM'.          01232006
012435     05  PC-VOI                   PIC X(03) VALUE 'VOI'.                  
007100     05  PC-AUT                   PIC X(03) VALUE 'AUT'.          01233015
007200     05  PC-A                     PIC X(01) VALUE 'A'.            01234015
007300     05  PC-SYSTEM                PIC X(06) VALUE 'SYSTEM'.       01235020
007400     05  PC-TER                   PIC X(03) VALUE 'TER'.          01236099
007500     05  PC-REG                   PIC X(03) VALUE 'REG'.          01237099
007600     05  PC-DIS                   PIC X(03) VALUE 'DIS'.          01238099
007700     05  PC-STR                   PIC X(03) VALUE 'STR'.          01239099
007800     05  PC-DEP                   PIC X(03) VALUE 'DEP'.          01240099
007900     05  PC-THRS-HIER-VAL-DEF     PIC S9(04) VALUE +0 COMP.       01240199
008000                                                                  01240200
008100*--------------------------------------------------------------*  01250000
008200* PV- PROGRAM VARIABLES                                           01260000
008300*--------------------------------------------------------------*  01270000
008400 01  PV-PROGRAM-VARAIBLES.                                        01280000
008500     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       01290000
008600     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       01300000
008700                                                                  01310000
008800     05  PV-SQL-SUB               PIC S9(09)  VALUE 0  COMP.      01320000
008900     05  PV-RETRY                 PIC 9999    VALUE 0  COMP.      01330000
009000     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      01340000
009100     05  PV-CALC-DB2-DATE         PIC  X(10)  VALUE SPACES.       01350000
009200     05  PV-CALC-NBR-DAYS         PIC  9(05)  VALUE 0.            01360000
009300     05  PV-SUM-ONHAND            PIC S9(09)  VALUE +0 COMP.      01370099
009400     05  PV-SUM-SCANNED           PIC S9(09)  VALUE +0 COMP.      01380099
012435     05  PV-THRESHOLD             PIC S9(5)V9(2)                  01390099
012435                                              VALUE +0 COMP-3.            
012435     05  PV-THRESHOLD1            PIC S9(5)V9(2)                  01400099
012435                                              VALUE +0 COMP-3.            
012435     05  PV-THRESHOLD2            PIC S9(5)V9(2)                  01400199
012435                                              VALUE +0 COMP-3.            
009700                                                                  01400200
009800     05  PV-CURRENT-TMST          PIC X(26)   VALUE SPACES.       01401003
009900     05  PV-CURRENT-DATE          PIC X(10)   VALUE SPACES.       01402099
010000                                                                  01500000
010100     05  PV-TIMEZONE-TMST         PIC X(26)   VALUE SPACES.       01510020
010200                                                                  01520020
010300     05  PV-THRS-HIER-CDE         PIC X(03)   VALUE SPACES.       01530099
010400     05  PV-THRS-HIER-VAL         PIC S9(04)  VALUE +0 COMP.      01540099
223110     05  PV-DUMMY                 PIC  X(01)  VALUE SPACES.               
010500                                                                  01550099
010600*--------------------------------------------------------------*  01560000
010700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01570000
010800*--------------------------------------------------------------*  01580000
010900     COPY DPWS004.                                                01590000
011000                                                                  01600000
011100*--------------------------------------------------------------*  01610000
011200* DATE ROUTINE COPY MEMBERS                                       01620000
011300*--------------------------------------------------------------*  01630000
011400     COPY DPWS500.                                                01640000
011500                                                                  01650000
011600*--------------------------------------------------------------*  01660000
011700* DB2 ABEND COPYBOOK                                              01670000
011800*--------------------------------------------------------------*  01680000
011900     COPY DPWS900.                                                01690000
012000                                                                  01700000
012100*--------------------------------------------------------------*  01710000
012200* DB2 MESSAGE AREA                                                01720000
012300*--------------------------------------------------------------*  01730000
012400     COPY SQLCA2.                                                 01740000
012500                                                                  01750000
012600*--------------------------------------------------------------*  01760000
012700* PROGRAM COUNTERS                                                01770000
012800*--------------------------------------------------------------*  01780000
012900 01  PV-PROGRAM-COUNTERS         COMP-3.                          01790000
013000     05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               01800000
013100     05  PV-TOTAL-FETCH-CNT       PIC 9(9) VALUE 0.               01810000
013200     05  PV-INSERT-CNT            PIC 9(9) VALUE 0.               01930012
013300     05  PV-BYPASS-CNT            PIC 9(9) VALUE 0.               01940099
013400     05  PV-CNT-SINCE-COMMIT      PIC 9(9) VALUE 0.               02020000
013500                                                                  02030000
013600*--------------------------------------------------------------*  02040000
013700* ERROR HANDLING                                                  02050000
013800*--------------------------------------------------------------*  02060000
013900 01  PV-MISC-ABEND-FIELDS.                                        02070000
014000     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          02080000
014100     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          02090000
014200     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          02100000
014300                                                                  02110000
014400 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    02120000
014500     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02130000
014600     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02140000
014700     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02150000
014800     88  ABEND-4020-MQ-ERROR               VALUE +4020.           02160000
014900     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02170000
015000     88  ABEND-4008                        VALUE +4008.           02180000
015100     88  ABEND-4005                        VALUE +4005.           02190000
015200                                                                  02200000
015300************************************************************      02210099
015400*    TIMEZONE CONVERSION ROUTINE COPYBOOK                         02220099
015500************************************************************      02230099
015600     COPY ICWS010.                                                02240099
015700                                                                  02240199
015800*--------------------------------------------------------------*  02240200
015900* DB2 COMMUNICATIONS AREA                                         02240300
016000*--------------------------------------------------------------*  02240400
016100     EXEC SQL                                                     02240500
016200       INCLUDE SQLCA                                              02250000
016300     END-EXEC.                                                    02260000
016400                                                                  02270000
016500***************************************************************** 02280099
016600*  XST_LOC TABLE                                                  02290099
016700***************************************************************** 02300099
016800     EXEC SQL                                                     02310099
016900          INCLUDE XST00001                                        02320099
017000     END-EXEC.                                                    02330099
017100                                                                  02340099
017200***************************************************************** 02350099
017300*  XST_DIST_REGN TABLE                                            02360099
017400***************************************************************** 02370099
017500     EXEC SQL                                                     02380099
017600          INCLUDE XST00004                                        02390099
017700     END-EXEC.                                                    02400099
017800                                                                  02410099
017900***************************************************************** 02420099
018000*  XST_REGN_TERR TABLE                                            02430099
018100***************************************************************** 02440099
018200     EXEC SQL                                                     02450099
018300          INCLUDE XST00006                                        02460099
018400     END-EXEC.                                                    02470099
018500                                                                  02480099
018600***************************************************************** 02490099
018700*  XST_LOC_DIST TABLE                                             02500099
018800***************************************************************** 02510099
018900     EXEC SQL                                                     02520099
019000          INCLUDE XST00002                                        02530099
019100     END-EXEC.                                                    02540099
019200                                                                  02550099
019300***************************************************************** 02560099
019400*  XST_SKU                                                        02570099
019500***************************************************************** 02580099
019600     EXEC SQL                                                     02590099
019700          INCLUDE XST00010                                        02600099
019800     END-EXEC.                                                    02610099
019900                                                                  02620099
020000***************************************************************** 02630099
020100*  XST_VND_STYL                                                   02640099
020200***************************************************************** 02650099
020300     EXEC SQL                                                     02660099
020400          INCLUDE XST00013                                        02670099
020500     END-EXEC.                                                    02680099
020600                                                                  02680199
020700*--------------------------------------------------------------*  02680200
020800* DB2 TABLE ICT00020 (ICT_LOC_CNT_STAT)                           02680303
020900*           IC - LOCATION COUNT STATUS TABLE                   *  02680418
021000*--------------------------------------------------------------*  02680503
021100     EXEC SQL                                                     02680603
021200       INCLUDE ICT00020                                           02680703
021300     END-EXEC.                                                    02680803
021400                                                                  02680903
021500*--------------------------------------------------------------*  02681003
021600* DB2 TABLE ICT00010 (ICT_CNT_STUP)                               02681103
021700*           IC - COUNT SETUP TABLE                                02681218
021800*--------------------------------------------------------------*  02681303
021900     EXEC SQL                                                     02681403
022000       INCLUDE ICT00010                                           02681503
022100     END-EXEC.                                                    02681603
022200                                                                  02681703
022300*--------------------------------------------------------------*  02681803
022400* DB2 TABLE ICT00011 (ICT_SKU_LOC_CNT)                            02681920
022500*           IC - SKU LOCATION COUNT TABLE                         02682020
022600*--------------------------------------------------------------*  02682103
022700     EXEC SQL                                                     02682203
022800       INCLUDE ICT00011                                           02682320
022900     END-EXEC.                                                    02682403
023000                                                                  02682503
023100*--------------------------------------------------------------*  02682620
023200* DB2 TABLE ICT00009 (ICT_CNT_THRS_PCT)                           02682720
023300*           IC - COUNT THRESHOLD PERCENT TABLE                    02682820
023400*--------------------------------------------------------------*  02682920
023500     EXEC SQL                                                     02683020
023600       INCLUDE ICT00009                                           02683120
023700     END-EXEC.                                                    02683220
023800                                                                  02683320
023900******************************************************************03430003
024000* CMPLTD-CNTS-CSR CURSOR FINDS ALL ROWS THAT ARE COMPLETED        03431004
024100* COUNTS AND READY TO BE AUTO APPROVED.                           03440003
024200******************************************************************03470003
024300                                                                  03471003
024400     EXEC SQL                                                     03472003
024500       DECLARE CMPLTD-CNTS-CSR CURSOR WITH HOLD FOR               03473004
024600              SELECT DISTINCT                                     03474005
024700                     A.CNT_STAT_CDE                               03474199
024800                   , A.LOC_NBR                                    03475005
024900                   , A.CNT_STUP_ID                                03476005
025000                   , A.CNT_SEQ_NBR                                03476199
025100                   , B.THRS_HIER_CDE                              03477014
C88463                   , B.CNT_TYP_CDE                                03477014
025300                FROM ICT_LOC_CNT_STAT A                           03479103
025400                   , ICT_CNT_STUP     B                           03479204
025600                                                                  03479604
025700               WHERE A.CNT_STAT_CDE = :PC-COM                     03479707
025800                 AND B.FS_UPD_IND = 'Y'                           03479899
025900                 AND A.CNT_STUP_ID = B.CNT_STUP_ID                03479906
026000                 AND B.LAST_ACTN_CDE = :PC-A                      03480099
026400                                                                  03490099
026500                 AND DATE(A.LAST_UPD_TMST) =                      03500099
026600                      DATE(CURRENT DATE) - 1 DAYS                 03510099
026700                                                                  03520099
026800                 AND A.LAST_UPD_TMST  =                           03530099
026900                     (SELECT MAX(G.LAST_UPD_TMST)                 03540099
027000                        FROM ICT_LOC_CNT_STAT  G                  03550099
027100                       WHERE G.LOC_NBR = A.LOC_NBR                03560099
027200                         AND G.CNT_STUP_ID = A.CNT_STUP_ID        03570099
027300                         AND G.CNT_SEQ_NBR = A.CNT_SEQ_NBR        03580099
CL3132                         AND G.CNT_STAT_CDE = 'COM')              03581099
028300                 AND B.LAST_UPD_TMST  =                           03600099
028400                     (SELECT MAX(H.LAST_UPD_TMST)                 03610099
028500                        FROM ICT_CNT_STUP      H                  03620099
028600                       WHERE H.CNT_STUP_ID = B.CNT_STUP_ID)       03630099
028700                                                                  03640099
PK4588                 AND NOT EXISTS                                   03650099
PK4588                     (SELECT 1                                    03660099
PK4588                        FROM ICT_LOC_CNT_STAT  I                  03670099
PK4588                       WHERE I.CNT_STUP_ID = A.CNT_STUP_ID        03680099
PK4588                         AND I.CNT_SEQ_NBR = A.CNT_SEQ_NBR        03690099
PK4588                         AND I.LOC_NBR     = A.LOC_NBR            03700099
PK4588                         AND I.CNT_STAT_CDE                       03710099
PK4588                                      IN ('APP','AUT','PRC'))     03720099
028700                                                                  03730099
028800                ORDER BY A.CNT_STAT_CDE                           03740099
028900                       , A.LOC_NBR                                03750099
029000                       , A.CNT_STUP_ID                            03760099
029100                       , A.CNT_SEQ_NBR                            03770099
029200                                                                  03780099
029300     END-EXEC.                                                    03790099
029400                                                                  03800099
029500 LINKAGE SECTION.                                                 03810099
029600                                                                  03820099
029700*--------------------------------------------------------------*  03830099
029800 PROCEDURE DIVISION.                                              03970003
029900*--------------------------------------------------------------*  03980003
030000 0000-MAINLINE.                                                   03990003
030100                                                                  04000003
030200     PERFORM 1000-INITIALIZATION.                                 04010003
030300                                                                  04050003
030400     PERFORM 2000-PROCESS-AUTO-APPROVALS.                         04060010
030500     PERFORM 9000-COMMIT.                                         04070003
030600                                                                  04080003
030700     PERFORM 9999-WRAPUP.                                         04110003
030800                                                                  04120003
030900     GOBACK.                                                      04130003
031000                                                                  04140003
031100*0000-EXIT.                                                       04150003
031200                                                                  04160003
031300*--------------------------------------------------------------*  04170003
031400* 1000-INITIALIZATION.                                            04180003
031500*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04190003
031600*     FILES, READS CONTROL CARDS, AND PROCESSES ANY INPUT FILE    04200003
031700*     PARAMETERS IT MAY NEED.                                     04210003
031800*--------------------------------------------------------------*  04220003
031900 1000-INITIALIZATION.                                             04230003
032000     DISPLAY ' '.                                                 04240003
032100     DISPLAY '*********************************************'.     04250003
032200     DISPLAY '   START OF PROGRAM NAME: ' PC-PROGRAM-NAME.        04260003
032300     DISPLAY '*********************************************'.     04270003
032400     DISPLAY ' '.                                                 04280003
032500                                                                  04310003
032600                                                                  04320099
032700     INITIALIZE PV-SUM-ONHAND                                     04330099
032800                PV-SUM-SCANNED                                    04340099
032900                PV-THRESHOLD1                                     04350099
032910                PV-THRESHOLD2                                     04360099
033000                PV-THRESHOLD.                                     04370099
033100                                                                  04370199
033200     EXEC SQL                                                     04370215
033300         SET :PV-CURRENT-DATE = CURRENT DATE                      04370315
033400     END-EXEC.                                                    04370415
033500                                                                  04370515
033600     EXEC SQL                                                     04370615
033700         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 04370715
033800     END-EXEC.                                                    04370815
033900                                                                  04370915
034000                                                                  04371099
034100     PERFORM 9000-TIMEZONE-CONVERSION-SETUP.                      04371119
034200                                                                  04371218
034300                                                                  04580003
034400*1000-EXIT.                                                       04630003
034500                                                                  04640003
034600*--------------------------------------------------------------*  09014003
034700* 2000-PROCESS-AUTO-APPROVALS.                                 *  09020010
034800*  PROCESS COMPLETED COUNTS                                    *  09030005
034900*--------------------------------------------------------------*  09050003
035000 2000-PROCESS-AUTO-APPROVALS.                                     09060005
035100                                                                  09070003
035200     SET MORE-CMPLTD-CNTS TO TRUE.                                09080005
035300     PERFORM 3800-OPEN-CMPLTD-CNTS-CSR.                           09090005
035400     PERFORM 3850-FETCH-CMPLTD-CNTS-CSR.                          09100005
035500                                                                  09110003
035600     IF NO-MORE-CMPLTD-CNTS                                       09120005
035700        DISPLAY '* NO COMPLETED COUNTS TO PROCESS *'              09130005
035800     ELSE                                                         09140003
035900        PERFORM 2800-PROCESS-CMPLTD-CNTS                          09150005
036000          UNTIL NO-MORE-CMPLTD-CNTS                               09160005
036100        DISPLAY '* COMPLETED COUNTS PROCESSED*'                   09170005
036200     END-IF.                                                      09180003
036300                                                                  09190003
036400     PERFORM 3890-CLOSE-CMPLTD-CNTS-CSR.                          09200005
036500                                                                  09210003
036600     IF PV-CNT-SINCE-COMMIT > 0                                   09220003
036700         PERFORM 9000-COMMIT                                      09230003
036800     END-IF.                                                      09240003
036900                                                                  09250003
037000*--------------------------------------------------------------*  09280003
037100* 2800-PROCESS-CMPLTD-CNTS                                        09290005
037200*--------------------------------------------------------------*  09300003
037300 2800-PROCESS-CMPLTD-CNTS.                                        09310005
037400                                                                  09320003
223110     PERFORM 2850-COMP-COUNTS-CONT.                                       
012435     PERFORM 2900-CHECK-VOID-STATUS.                                      
012435     IF  PS-VOID-STAT-NO                                                  
223110     AND PS-COMP-COUNTS-YES                                               
C88463       IF ICT00010-CNT-TYP-CDE = 'ICC'                                    
C88463***       BYPASS THE THRESHOLD CHECKS FOR RFID COUNTS             09335321
C88463          PERFORM 4500-DETERMINE-TIMEZONE                         09335321
C88463          PERFORM 5100-INSERT-AUTO-APPROVAL                       09335410
C88463       ELSE                                                               
037500          PERFORM 4000-EVALUATE-THRS-HIER-CDE                     09330013
037600          IF INVALID-THRS-HIER-CDE                                09331009
037700             DISPLAY '* INVALID THRESHOLD HIER CODE *'            09332009
037800          ELSE                                                    09333009
037900             PERFORM 4200-CHECK-COUNT-THRESHOLD                   09334021
038000             IF PS-AUTO-APPROVAL-YES                              09335009
038100                PERFORM 4500-DETERMINE-TIMEZONE                   09335321
038200                PERFORM 5100-INSERT-AUTO-APPROVAL                 09335410
038300             ELSE                                                 09335599
038400                PERFORM 4300-AUTO-APPROVAL-BYPASS                 09335699
038500             END-IF                                               09336109
038500          END-IF                                                  09336109
C88463       END-IF                                                             
012435     ELSE                                                                 
012435       CONTINUE                                                           
038600     END-IF.                                                      09337009
038800                                                                  09340003
038900     IF PV-CNT-SINCE-COMMIT > PC-COMMIT-MAX                       09350003
039000         PERFORM 9000-COMMIT                                      09360003
039100     END-IF.                                                      09370003
039200                                                                  09380003
039300     PERFORM 3850-FETCH-CMPLTD-CNTS-CSR.                          09390009
039400                                                                  09400003
223110*--------------------------------------------------------------*  20520421
223110 2850-COMP-COUNTS-CONT.                                                   
223110                                                                          
012435     EXEC SQL                                                             
223110          SELECT 1                                                        
223110            INTO :PV-DUMMY                                                
223110            FROM SYSIBM.SYSDUMMY1                                         
223110           WHERE EXISTS                                                   
CL3132           ( ( SELECT '1'                                         03583099
CL3132                 FROM ICT_CNT_RPET_PARM R,                        03585099
CL3132              (SELECT MAX(DATE(J.LAST_UPD_TMST)) AS MAX_UPD_DTE   03586099
CL3132                 FROM ICT_LOC_CNT_STAT J                          03587099
CL3132                WHERE J.CNT_STUP_ID  = :ICT00020-CNT-STUP-ID      03588099
CL3132                  AND J.CNT_SEQ_NBR  = :ICT00020-CNT-SEQ-NBR      03589099
CL3132                  AND J.LOC_NBR      = :ICT00020-LOC-NBR          03589199
CL3132                  AND J.CNT_STAT_CDE = 'UPD'                      03589299
CL3132              )T                                                  03589399
CL3132                WHERE R.RPET_WND_STRT_DTE <= T.MAX_UPD_DTE        03589499
CL3132                  AND R.RPET_WND_END_DTE  >= T.MAX_UPD_DTE        03589599
CL3132              )  UNION                                            03589699
CL3132              ( SELECT '1'                                        03589799
CL3132                  FROM ICT_CNT_STUP S,                            03589899
CL3132               (SELECT MAX(DATE(K.LAST_UPD_TMST)) AS MAX_UPD_DTE  03589999
CL3132                  FROM ICT_LOC_CNT_STAT K                         03590099
CL3132                 WHERE K.CNT_STUP_ID  = :ICT00020-CNT-STUP-ID     03590199
CL3132                   AND K.CNT_SEQ_NBR  = :ICT00020-CNT-SEQ-NBR     03590299
CL3132                   AND K.LOC_NBR      = :ICT00020-LOC-NBR         03590399
CL3132                   AND K.CNT_STAT_CDE = 'UPD'                     03590499
CL3132                )X                                                03590599
CL3132              WHERE S.EXEC_WND_STRT_DTE <= X.MAX_UPD_DTE          03590699
CL3132                AND S.EXEC_WND_END_DTE  >= X.MAX_UPD_DTE          03590799
CL3132                AND S.EXEC_WND_STRT_DTE IS NOT NULL               03590899
CL3132                AND S.EXEC_WND_END_DTE  IS NOT NULL               03590999
CL3132              )                                                   03591099
CL3132           )                                                      03591199
012435     END-EXEC.                                                            
012435                                                                          
012435     EVALUATE TRUE                                                        
012435             WHEN SQLCODE = ZERO                                          
168057             WHEN SQLCODE = -811                                          
012435                 SET PS-COMP-COUNTS-YES   TO TRUE                         
012435                                                                          
012435             WHEN SQLCODE = +100                                          
012435                 SET PS-COMP-COUNTS-NO    TO TRUE                         
012435                                                                          
012435             WHEN SQLWARN0 NOT EQUAL SPACE                                
012435             WHEN SQLCODE NOT EQUAL ZERO                                  
012435                 DISPLAY '**************************************'         
012435                 DISPLAY '** ABEND                            **'         
012435                 DISPLAY '** 2850-COMP-COUNTS-CONT            **'         
012435                 DISPLAY '*COUNT SETUP ID         = '                     
012435                                             ICT00020-CNT-STUP-ID         
012435                 DISPLAY '*COUNT SEQUENCE NUMBER  = '                     
012435                                             ICT00020-CNT-SEQ-NBR         
012435                 DISPLAY '*COUNT LOCATION NUMBER  = '                     
012435                                             ICT00020-LOC-NBR             
012435                 DISPLAY '**************************************'         
012435                 MOVE 'ERROR ON SELECT OF COMP COUNTS' TO                 
012435                      PV-DB2-OPERATION                                    
012435                 PERFORM 9900-SQL-ABEND                                   
012435                                                                          
012435         END-EVALUATE.                                                    
103300*--------------------------------------------------------------*  20520421
012435* 2900-CHECK-VOID-STATUS                                          20520521
012435* CHECK IF THE STATUS OF COUNT IS VOID AFTER COMPLETION.          20520621
012435*--------------------------------------------------------------*  20520721
012435 2900-CHECK-VOID-STATUS.                                          20520821
012435                                                                          
012435     EXEC SQL                                                             
012435           SELECT R.CNT_STAT_CDE                                          
012435               INTO :ICT00020-CNT-STAT-CDE                                
012435             FROM  ICT_LOC_CNT_STAT    R                                  
012435        WHERE R.CNT_STUP_ID    = :ICT00020-CNT-STUP-ID                    
012435          AND R.LOC_NBR        = :ICT00020-LOC-NBR                        
012435          AND R.CNT_SEQ_NBR    = :ICT00020-CNT-SEQ-NBR                    
012435          AND R.CNT_STAT_CDE   = :PC-VOI                                  
008534          AND DATE(R.LAST_UPD_TMST) >=                                    
012435                      DATE(CURRENT DATE) - 1 DAYS                         
012435            AND R.LAST_UPD_TMST >                                         
012435                  (SELECT MAX(S.LAST_UPD_TMST)                            
012435                      FROM   ICT_LOC_CNT_STAT  S                          
012435               WHERE S.CNT_STUP_ID   =  R.CNT_STUP_ID                     
012435                 AND S.LOC_NBR       =  R.LOC_NBR                         
012435                 AND S.CNT_SEQ_NBR   =  R.CNT_SEQ_NBR                     
012435                 AND S.CNT_STAT_CDE  = 'COM')                             
012435               END-EXEC.                                                  
012435                                                                          
012435         EVALUATE TRUE                                                    
012435             WHEN SQLCODE = ZERO                                          
168057             WHEN SQLCODE = -811                                          
012435                 SET PS-VOID-STAT-YES     TO TRUE                         
012435                                                                          
012435             WHEN SQLCODE = +100                                          
012435                 SET PS-VOID-STAT-NO      TO TRUE                         
012435                                                                          
012435             WHEN SQLWARN0 NOT EQUAL SPACE                                
012435             WHEN SQLCODE NOT EQUAL ZERO                                  
012435                 DISPLAY '**************************************'         
012435                 DISPLAY '** ABEND                            **'         
012435                 DISPLAY '** 2900-CHECK-VOID-STATUS           **'         
012435                 DISPLAY '*COUNT SETUP ID   = '                           
012435                              ICT00020-CNT-STUP-ID                        
012435                 DISPLAY '*LOCATION NUMBER  = '                           
012435                              ICT00020-LOC-NBR                            
012435                 DISPLAY '*LAST UPDATED COUNT STATUS  = '                 
012435                              ICT00020-CNT-STAT-CDE                       
012435                 DISPLAY '**************************************'         
012435                 MOVE 'ERROR ON SELECT OF CNT STATUS' TO                  
012435                      PV-DB2-OPERATION                                    
012435                 PERFORM 9900-SQL-ABEND                                   
012435                                                                          
012435         END-EVALUATE.                                                    
039500******************************************************************15860003
039600* 3800-OPEN-CMPLTD-CNTS-CSR.                                      15870010
039700******************************************************************15880003
039800 3800-OPEN-CMPLTD-CNTS-CSR.                                       15890010
039900                                                                  15900003
040000     DISPLAY 'OPENING CMPLTD-CNTS-CSR'.                           15910010
040100                                                                  15920003
040200     EXEC SQL                                                     15930003
040300          OPEN CMPLTD-CNTS-CSR                                    15940010
040400     END-EXEC.                                                    15950003
040500                                                                  15960003
040600     EVALUATE TRUE                                                15970003
040700         WHEN SQLCODE = ZERO                                      15980003
040800             CONTINUE                                             15990003
040900         WHEN OTHER                                               16000003
041000             MOVE '3800-OPEN-CMPLTD-CNTS-CSR'                     16010010
041100                  TO PV-PARAGRAPH-NAME                            16020003
041200             MOVE 'ERROR ON OPEN OF CMPLTD-CNTS-CSR'              16030010
041300                  TO PV-DB2-OPERATION                             16040003
041400             PERFORM 9900-SQL-ABEND                               16050003
041500     END-EVALUATE.                                                16060003
041600                                                                  16070003
041700******************************************************************16080003
041800* 3850-FETCH-CMPLTD-CNTS-CSR.                                     16090010
041900******************************************************************16100003
042000 3850-FETCH-CMPLTD-CNTS-CSR.                                      16110010
042100                                                                  16120003
042200     PERFORM                                                      16130003
042300        WITH TEST AFTER                                           16140003
042400        VARYING PV-RETRY  FROM 1 BY 1                             16150003
042500          UNTIL (PV-RETRY > PC-MAX-RETRIES                        16160003
042600             OR (SQLCODE = +100 OR +0))                           16170003
042700     EXEC SQL                                                     16180003
042800          FETCH CMPLTD-CNTS-CSR                                   16190010
042900           INTO :ICT00020-CNT-STAT-CDE                            16200014
043000               ,:ICT00020-LOC-NBR                                 16201014
043100               ,:ICT00020-CNT-STUP-ID                             16202014
043200               ,:ICT00020-CNT-SEQ-NBR                             16203099
043300               ,:ICT00010-THRS-HIER-CDE                           16204014
C88463               ,:ICT00010-CNT-TYP-CDE                             16204014
043400     END-EXEC                                                     16210003
043500                                                                  16220003
043600       MOVE SQLCODE TO PV-SQL-SUB                                 16230003
043700     EVALUATE TRUE                                                16240003
043800         WHEN SQLCODE = ZERO                                      16250003
043900             ADD +1 TO PV-TOTAL-FETCH-CNT                         16260003
044000         WHEN SQLCODE = -904                                      16280003
044100         WHEN SQLCODE = -911                                      16290003
044200         WHEN SQLCODE = -913                                      16300003
044300             CONTINUE                                             16310003
044400         WHEN SQLCODE = +100                                      16320003
044500             SET NO-MORE-CMPLTD-CNTS TO TRUE                      16330014
044600         WHEN OTHER                                               16340003
044700              DISPLAY '*3850 BLOWING UP ON BAD SQL-'              16350003
044800                 '* FETCH KEY-',                                  16360003
044900                  ICT00020-CNT-STUP-ID,                           16370014
045000                 ' SQL CODE -', PV-SQL-SUB, '**'                  16380003
045100              MOVE '3850-FETCH-CMPLTD-CNTS-CSR'                   16390014
045200                  TO PV-PARAGRAPH-NAME                            16400003
045300             MOVE 'ERROR ON FETCH OF CMPLTD-CNTS CSR'             16410014
045400                  TO PV-DB2-OPERATION                             16420003
045500             PERFORM 9900-SQL-ABEND                               16430003
045600         END-EVALUATE                                             16440003
045700     END-PERFORM.                                                 16450003
045800                                                                  16460003
045900     IF PV-RETRY GREATER PC-MAX-RETRIES                           16470003
046000       DISPLAY '*3850 BLOWING UP ON RETRIES ON FETCH-'            16480014
046100        PV-RETRY '**'                                             16490003
046200               '* FETCH KEY-',                                    16500003
046300                ICT00020-CNT-STUP-ID                              16510014
046400               ' SQL CODE -', PV-SQL-SUB, '**'                    16520003
046500        MOVE '3850-FETCH-CMPLTD-CNTS-CSR'                         16530014
046600                 TO PV-PARAGRAPH-NAME                             16540003
046700        MOVE 'ERROR ON FETCH OF CMPLTD-CNTS CSR'                  16550014
046800                 TO PV-DB2-OPERATION                              16560003
046900        PERFORM 9900-SQL-ABEND                                    16570003
047000     END-IF.                                                      16580003
047100                                                                  16590003
047200******************************************************************16600003
047300* 3890-CLOSE-CMPLTD-CNTS-CSR.                                     16610010
047400******************************************************************16620003
047500 3890-CLOSE-CMPLTD-CNTS-CSR.                                      16630010
047600                                                                  16640003
047700     EXEC SQL                                                     16650003
047800          CLOSE CMPLTD-CNTS-CSR                                   16660010
047900     END-EXEC.                                                    16670003
048000                                                                  16680003
048100     EVALUATE TRUE                                                16690003
048200         WHEN SQLCODE = ZERO                                      16700003
048300             CONTINUE                                             16710003
048400         WHEN OTHER                                               16720003
048500             MOVE '3890-CLOSE-CMPLTD-CNTS-CSR'                    16730010
048600                  TO PV-PARAGRAPH-NAME                            16740003
048700             MOVE 'ERROR ON CLOSE OF CMPLTD-CNTS-CSR'             16750010
048800                  TO PV-DB2-OPERATION                             16760003
048900             PERFORM 9900-SQL-ABEND                               16770003
049000     END-EVALUATE.                                                16780003
049100                                                                  16790003
049200******************************************************************16791099
049300* 4000-EVALUATE-THRS-HIER-CDE                                  *  16792010
049400*   EVALUATE THE THRESHOLD HIERARCHY CODE                      *  16793010
049500******************************************************************16794099
049600 4000-EVALUATE-THRS-HIER-CDE.                                     16800010
049700                                                                  16810010
049800     EVALUATE ICT00010-THRS-HIER-CDE                              16820099
049900         WHEN PC-TER                                              16830099
050000             PERFORM 4010-VALID-STR-TER                           16840099
050100         WHEN PC-REG                                              16850099
050200             PERFORM 4020-VALID-STR-REG                           16860099
050300         WHEN PC-DIS                                              16870099
050400             PERFORM 4030-VALID-STR-DIS                           16880099
050500         WHEN PC-STR                                              16890099
050600             PERFORM 4040-VALID-STR-STR                           16900099
050700         WHEN PC-DEP                                              16910099
050800             PERFORM 4045-SELECT-SKU                              16920099
050900             PERFORM 4050-VALID-STR-DEP                           16930099
051000         WHEN OTHER                                               16940099
051100             SET INVALID-THRS-HIER-CDE TO TRUE                    16950099
051200     END-EVALUATE.                                                16960099
051300                                                                  16960199
051400******************************************************************16960203
051500* 4010-VALID-STR-TER                                           *  16960310
051600*   VALIDATE TERRITORY NUMBER FOR THE STORE                    *  16960499
051700******************************************************************16960503
051800 4010-VALID-STR-TER.                                              16960610
051900                                                                  16960710
052000         EXEC SQL                                                 16960899
052100             SELECT G.CPL_THRS_PCT                                16960999
052200               INTO :ICT00009-CPL-THRS-PCT                        16961099
052300             FROM   XST_LOC         A                             16962099
052400                   ,XST_LOC_DIST    B                             16963099
052500                   ,XST_DIST_REGN   C                             16964099
052600                   ,XST_REGN_TERR   D                             16965099
052700                   ,ICT_CNT_THRS_PCT  G                           16966099
052800                                                                  16967099
052900         WHERE A.LOC_NBR          = :ICT00020-LOC-NBR             16968099
053000           AND A.LOC_NBR          = B.LOC_NBR                     16969099
053100           AND A.OPN_DTE       <= CURRENT DATE                    16970099
053200           AND (A.CLO_DTE      >= CURRENT DATE                    16980099
053300           OR  A.CLO_DTE  IS NULL)                                16990099
053400                                                                  17000099
053500           AND B.DIST_NBR       = C.DIST_NBR                      17010099
053600           AND B.BEG_DTE       <= CURRENT DATE                    17020099
053700           AND (B.END_DTE      >= CURRENT DATE                    17030099
053800           OR  B.END_DTE  IS NULL)                                17040099
053900                                                                  17050099
054000           AND C.REGN_NBR         = D.REGN_NBR                    17060099
054100           AND C.BEG_DTE       <= CURRENT DATE                    17070099
054200           AND (C.END_DTE      >= CURRENT DATE                    17080099
054300            OR  C.END_DTE  IS NULL)                               17090099
054400                                                                  17100099
054500           AND D.BEG_DTE       <= CURRENT DATE                    17110099
054600           AND (D.END_DTE      >= CURRENT DATE                    17120099
054700            OR  D.END_DTE  IS NULL)                               17130099
054800                                                                  17140099
054900           AND G.THRS_HIER_CDE = :ICT00010-THRS-HIER-CDE          17150099
055000           AND G.LAST_UPD_TMST  =                                 17160099
055100               (SELECT MAX(H.LAST_UPD_TMST)                       17170099
055200                  FROM ICT_CNT_THRS_PCT  H                        17180099
055300                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          17190099
055400                   AND H.LAST_ACTN_CDE = :PC-A                    17200099
055500                   AND H.THRS_HIER_VAL_NBR = D.TERR_NBR)          17210099
055600                                                                  17220099
055700         END-EXEC                                                 17230099
055800                                                                  17240099
055900         EVALUATE TRUE                                            17250099
056000             WHEN SQLCODE = ZERO                                  17260099
056100                 SET VALID-THRS-HIER-CDE TO TRUE                  17270099
056200                                                                  17280099
056300             WHEN SQLCODE = +100                                  17290099
056400                 MOVE PC-TER TO PV-THRS-HIER-CDE                  17300099
056500                 MOVE PC-THRS-HIER-VAL-DEF TO PV-THRS-HIER-VAL    17310099
056600                 PERFORM 4060-SELECT-THRS-PCT-DFLT                17320099
056700                                                                  17330099
056800             WHEN SQLWARN0 NOT EQUAL SPACE                        17340099
056900             WHEN SQLCODE NOT EQUAL ZERO                          17350099
057000                 DISPLAY '**************************************' 17360099
057100                 DISPLAY '** ABEND                            **' 17370099
057200                 DISPLAY '** 4010 SELECT THRESHOLD PROBLEM    **' 17380099
057300                 DISPLAY '*COUNT SETUP ID   = '                   17390099
057400                              ICT00020-CNT-STUP-ID                17400099
057500                 DISPLAY '*LOCATION NUMBER  = '                   17410099
057600                              ICT00020-LOC-NBR                    17420099
057700                 DISPLAY '*THRS HIER CODE   = '                   17430099
057800                              ICT00010-THRS-HIER-CDE              17440099
057900                 DISPLAY '**************************************' 17450099
058000                 MOVE 'ERROR ON SELECT OF THRS ' TO               17460099
058100                      PV-DB2-OPERATION                            17470099
058200                 PERFORM 9900-SQL-ABEND                           17480099
058300                                                                  17490099
058400         END-EVALUATE.                                            17500099
058500                                                                  17500199
058600******************************************************************17500203
058700* 4020-VALID-STR-REG                                           *  17500310
058800*   VALIDATE REGION NUMBER FOR THE STORE                       *  17500499
058900******************************************************************17500503
059000 4020-VALID-STR-REG.                                              17500610
059100                                                                  17500710
059200         EXEC SQL                                                 17500899
059300             SELECT G.CPL_THRS_PCT                                17500999
059400               INTO :ICT00009-CPL-THRS-PCT                        17501099
059500             FROM   XST_LOC         A                             17502099
059600                   ,XST_LOC_DIST    B                             17503099
059700                   ,XST_DIST_REGN   C                             17504099
059800                   ,ICT_CNT_THRS_PCT  G                           17505099
059900                                                                  17506099
060000         WHERE A.LOC_NBR          = :ICT00020-LOC-NBR             17507099
060100           AND A.LOC_NBR          = B.LOC_NBR                     17508099
060200           AND A.OPN_DTE       <= CURRENT DATE                    17509099
060300           AND (A.CLO_DTE      >= CURRENT DATE                    17510099
060400           OR  A.CLO_DTE  IS NULL)                                17520099
060500                                                                  17530099
060600           AND B.DIST_NBR       = C.DIST_NBR                      17540099
060700           AND B.BEG_DTE       <= CURRENT DATE                    17550099
060800           AND (B.END_DTE      >= CURRENT DATE                    17560099
060900           OR  B.END_DTE  IS NULL)                                17570099
061000                                                                  17580099
061100           AND C.BEG_DTE       <= CURRENT DATE                    17590099
061200           AND (C.END_DTE      >= CURRENT DATE                    17600099
061300            OR  C.END_DTE  IS NULL)                               17610099
061400                                                                  17620099
061500           AND G.THRS_HIER_CDE = :ICT00010-THRS-HIER-CDE          17630099
061600           AND G.LAST_UPD_TMST  =                                 17640099
061700               (SELECT MAX(H.LAST_UPD_TMST)                       17650099
061800                  FROM ICT_CNT_THRS_PCT  H                        17660099
061900                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          17670099
062000                   AND H.LAST_ACTN_CDE = :PC-A                    17680099
062100                   AND H.THRS_HIER_VAL_NBR = C.REGN_NBR)          17690099
062200                                                                  17700099
062300         END-EXEC                                                 17710099
062400                                                                  17720099
062500         EVALUATE TRUE                                            17730099
062600             WHEN SQLCODE = ZERO                                  17740099
062700                 SET VALID-THRS-HIER-CDE TO TRUE                  17750099
062800                                                                  17760099
062900             WHEN SQLCODE = +100                                  17770099
063000                 MOVE PC-REG TO PV-THRS-HIER-CDE                  17780099
063100                 MOVE PC-THRS-HIER-VAL-DEF TO PV-THRS-HIER-VAL    17790099
063200                 PERFORM 4060-SELECT-THRS-PCT-DFLT                17800099
063300                                                                  17810099
063400             WHEN SQLWARN0 NOT EQUAL SPACE                        17820099
063500             WHEN SQLCODE NOT EQUAL ZERO                          17830099
063600                 DISPLAY '**************************************' 17840099
063700                 DISPLAY '** ABEND                            **' 17850099
063800                 DISPLAY '** 4020 SELECT THRESHOLD PROBLEM    **' 17860099
063900                 DISPLAY '*COUNT SETUP ID   = '                   17870099
064000                              ICT00020-CNT-STUP-ID                17880099
064100                 DISPLAY '*LOCATION NUMBER  = '                   17890099
064200                              ICT00020-LOC-NBR                    17900099
064300                 DISPLAY '*THRS HIER CODE   = '                   17910099
064400                              ICT00010-THRS-HIER-CDE              17920099
064500                 DISPLAY '**************************************' 17930099
064600                 MOVE 'ERROR ON SELECT OF THRS ' TO               17940099
064700                      PV-DB2-OPERATION                            17950099
064800                 PERFORM 9900-SQL-ABEND                           17960099
064900                                                                  17970099
065000         END-EVALUATE.                                            17980099
065100                                                                  17980199
065200******************************************************************17980203
065300* 4030-VALID-STR-DIS                                           *  17980310
065400*   VALIDATE DISTRICT NUMBER FOR THE STORE                     *  17980499
065500******************************************************************17980503
065600 4030-VALID-STR-DIS.                                              17980610
065700                                                                  17980799
065800         EXEC SQL                                                 17980899
065900             SELECT G.CPL_THRS_PCT                                17980999
066000               INTO :ICT00009-CPL-THRS-PCT                        17981099
066100             FROM   XST_LOC         A                             17982099
066200                   ,XST_LOC_DIST    B                             17983099
066300                   ,ICT_CNT_THRS_PCT  G                           17984099
066400                                                                  17985099
066500         WHERE A.LOC_NBR          = :ICT00020-LOC-NBR             17986099
066600           AND A.LOC_NBR          = B.LOC_NBR                     17987099
066700           AND A.OPN_DTE       <= CURRENT DATE                    17988099
066800           AND (A.CLO_DTE      >= CURRENT DATE                    17989099
066900           OR  A.CLO_DTE  IS NULL)                                17990099
067000                                                                  18000099
067100           AND B.BEG_DTE       <= CURRENT DATE                    18010099
067200           AND (B.END_DTE      >= CURRENT DATE                    18020099
067300           OR  B.END_DTE  IS NULL)                                18030099
067400                                                                  18040099
067500           AND G.THRS_HIER_CDE = :ICT00010-THRS-HIER-CDE          18050099
067600           AND G.LAST_UPD_TMST  =                                 18060099
067700               (SELECT MAX(H.LAST_UPD_TMST)                       18070099
067800                  FROM ICT_CNT_THRS_PCT  H                        18080099
067900                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          18090099
068000                   AND H.LAST_ACTN_CDE = :PC-A                    18100099
068100                   AND H.THRS_HIER_VAL_NBR = B.DIST_NBR)          18110099
068200                                                                  18120099
068300         END-EXEC                                                 18130099
068400                                                                  18140099
068500         EVALUATE TRUE                                            18150099
068600             WHEN SQLCODE = ZERO                                  18160099
068700                 SET VALID-THRS-HIER-CDE TO TRUE                  18170099
068800                                                                  18180099
068900             WHEN SQLCODE = +100                                  18190099
069000                 MOVE PC-DIS TO PV-THRS-HIER-CDE                  18200099
069100                 MOVE PC-THRS-HIER-VAL-DEF TO PV-THRS-HIER-VAL    18210099
069200                 PERFORM 4060-SELECT-THRS-PCT-DFLT                18220099
069300                                                                  18230099
069400             WHEN SQLWARN0 NOT EQUAL SPACE                        18240099
069500             WHEN SQLCODE NOT EQUAL ZERO                          18250099
069600                 DISPLAY '**************************************' 18260099
069700                 DISPLAY '** ABEND                            **' 18270099
069800                 DISPLAY '** 4030 SELECT THRESHOLD PROBLEM    **' 18280099
069900                 DISPLAY '*COUNT SETUP ID   = '                   18290099
070000                              ICT00020-CNT-STUP-ID                18300099
070100                 DISPLAY '*LOCATION NUMBER  = '                   18310099
070200                              ICT00020-LOC-NBR                    18320099
070300                 DISPLAY '*THRS HIER CODE   = '                   18330099
070400                              ICT00010-THRS-HIER-CDE              18340099
070500                 DISPLAY '**************************************' 18350099
070600                 MOVE 'ERROR ON SELECT OF THRS ' TO               18360099
070700                      PV-DB2-OPERATION                            18370099
070800                 PERFORM 9900-SQL-ABEND                           18380099
070900                                                                  18390099
071000         END-EVALUATE.                                            18400099
071100                                                                  18400199
071200******************************************************************18400203
071300* 4040-VALID-STR-STR                                             *18400310
071400*   VALIDATE STORE NUMBER                                        *18400499
071500******************************************************************18400503
071600 4040-VALID-STR-STR.                                              18400610
071700                                                                  18400710
071800         EXEC SQL                                                 18400899
071900             SELECT G.CPL_THRS_PCT                                18400999
072000               INTO :ICT00009-CPL-THRS-PCT                        18401099
072100             FROM   XST_LOC         A                             18402099
072200                   ,ICT_CNT_THRS_PCT  G                           18403099
072300                                                                  18404099
072400         WHERE A.LOC_NBR          = :ICT00020-LOC-NBR             18405099
072500           AND A.OPN_DTE       <= CURRENT DATE                    18406099
072600           AND (A.CLO_DTE      >= CURRENT DATE                    18407099
072700           OR  A.CLO_DTE  IS NULL)                                18408099
072800                                                                  18409099
072900           AND G.THRS_HIER_CDE = :ICT00010-THRS-HIER-CDE          18410099
073000           AND G.LAST_UPD_TMST  =                                 18420099
073100               (SELECT MAX(H.LAST_UPD_TMST)                       18430099
073200                  FROM ICT_CNT_THRS_PCT  H                        18440099
073300                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          18450099
073400                   AND H.LAST_ACTN_CDE = :PC-A                    18460099
073500                   AND H.THRS_HIER_VAL_NBR = A.LOC_NBR)           18470099
073600                                                                  18480099
073700         END-EXEC                                                 18490099
073800                                                                  18500099
073900         EVALUATE TRUE                                            18510099
074000             WHEN SQLCODE = ZERO                                  18520099
074100                 SET VALID-THRS-HIER-CDE TO TRUE                  18530099
074200                                                                  18540099
074300             WHEN SQLCODE = +100                                  18550099
074400                 MOVE PC-STR TO PV-THRS-HIER-CDE                  18560099
074500                 MOVE PC-THRS-HIER-VAL-DEF TO PV-THRS-HIER-VAL    18570099
074600                 PERFORM 4060-SELECT-THRS-PCT-DFLT                18580099
074700                                                                  18590099
074800             WHEN SQLWARN0 NOT EQUAL SPACE                        18600099
074900             WHEN SQLCODE NOT EQUAL ZERO                          18610099
075000                 DISPLAY '**************************************' 18620099
075100                 DISPLAY '** ABEND                            **' 18630099
075200                 DISPLAY '** 4040 SELECT THRESHOLD PROBLEM    **' 18640099
075300                 DISPLAY '*COUNT SETUP ID   = '                   18650099
075400                              ICT00020-CNT-STUP-ID                18660099
075500                 DISPLAY '*LOCATION NUMBER  = '                   18670099
075600                              ICT00020-LOC-NBR                    18680099
075700                 DISPLAY '*THRS HIER CODE   = '                   18690099
075800                              ICT00010-THRS-HIER-CDE              18700099
075900                 DISPLAY '**************************************' 18710099
076000                 MOVE 'ERROR ON SELECT OF THRS ' TO               18720099
076100                      PV-DB2-OPERATION                            18730099
076200                 PERFORM 9900-SQL-ABEND                           18740099
076300                                                                  18750099
076400         END-EVALUATE.                                            18760099
076500                                                                  18760199
076600******************************************************************18760203
076700* 4045-SELECT-SKU                                                 18760310
076800*   VALIDATE DEPARTMENT NUMBER FOR THE STORE BY USING A SKU       18760499
076900******************************************************************18760503
077000 4045-SELECT-SKU.                                                 18760610
077100                                                                  18760710
077200         EXEC SQL                                                 18760899
077300             SELECT C.SKU_NBR                                     18760999
077400               INTO :ICT00011-SKU-NBR                             18761099
077500               FROM ICT_LOC_CNT_STAT A                            18762099
077600                  , ICT_SKU_LOC_CNT  C                            18763099
077700                                                                  18764099
077800               WHERE A.LOC_NBR = :ICT00020-LOC-NBR                18765099
077900                 AND A.LOC_NBR = C.LOC_NBR                        18766099
077910                 AND C.MDSE_EXPRN_DTE IS NULL                     18767099
078000                 AND A.CNT_STUP_ID = :ICT00020-CNT-STUP-ID        18768099
078100                 AND A.CNT_STUP_ID = C.CNT_STUP_ID                18769099
078200                 AND A.CNT_SEQ_NBR = C.CNT_SEQ_NBR                18770099
078300                                                                  18780099
078400                 AND C.LAST_UPD_TMST  =                           18790099
078500                     (SELECT MAX(F.LAST_UPD_TMST)                 18800099
078600                        FROM ICT_SKU_LOC_CNT   F                  18810099
078700                       WHERE F.CNT_STUP_ID = C.CNT_STUP_ID        18820099
078800                         AND F.CNT_SEQ_NBR = C.CNT_SEQ_NBR        18830099
078900                         AND F.SKU_NBR = C.SKU_NBR                18840099
079000                         AND F.LOC_NBR = C.LOC_NBR)               18850099
079100                                                                  18860099
079101             FETCH FIRST 1 ROW ONLY                               18870099
079102                                                                  18880099
079200         END-EXEC                                                 18890099
079300                                                                  18900099
079400         EVALUATE TRUE                                            18910099
079500             WHEN SQLCODE = ZERO                                  18920099
079600                 CONTINUE                                         18930099
079700                                                                  18940099
079800             WHEN SQLCODE = +100                                  18950099
079900                 CONTINUE                                         18960099
080000                                                                  18970099
080100             WHEN SQLWARN0 NOT EQUAL SPACE                        18980099
080200             WHEN SQLCODE NOT EQUAL ZERO                          18990099
080300                 DISPLAY '**************************************' 19000099
080400                 DISPLAY '** ABEND                            **' 19010099
080500                 DISPLAY '** 4045 SELECT SKU PROBLEM          **' 19020099
080600                 DISPLAY '*COUNT SETUP ID   = '                   19030099
080700                              ICT00020-CNT-STUP-ID                19040099
080800                 DISPLAY '*LOCATION NUMBER  = '                   19050099
080900                              ICT00020-LOC-NBR                    19060099
081000                 DISPLAY '*THRS HIER CODE   = '                   19070099
081100                              ICT00010-THRS-HIER-CDE              19080099
081200                 DISPLAY '**************************************' 19090099
081300                 MOVE 'ERROR ON SELECT OF THRS ' TO               19100099
081400                      PV-DB2-OPERATION                            19110099
081500                 PERFORM 9900-SQL-ABEND                           19120099
081600                                                                  19130099
081700         END-EVALUATE.                                            19140099
081800                                                                  19140199
081900******************************************************************19140203
082000* 4050-VALID-STR-DEP                                              19140310
082100*   VALIDATE DEPARTMENT NUMBER FOR THE STORE BY USING A SKU       19140499
082200******************************************************************19140503
082300 4050-VALID-STR-DEP.                                              19140610
082400                                                                  19140710
082500         EXEC SQL                                                 19140899
082600             SELECT G.CPL_THRS_PCT                                19140999
082700               INTO :ICT00009-CPL-THRS-PCT                        19141099
082800             FROM   XST_SKU         A                             19142099
082900                   ,XST_VND_STYL    B                             19143099
083000                   ,ICT_CNT_THRS_PCT  G                           19144099
083100                                                                  19145099
083200         WHERE A.SKU_NBR          = :ICT00011-SKU-NBR             19146099
083300           AND A.STYL_ID          = B.STYL_ID                     19147099
083400                                                                  19148099
083500           AND G.THRS_HIER_CDE = :ICT00010-THRS-HIER-CDE          19149099
083600           AND G.LAST_UPD_TMST  =                                 19150099
083700               (SELECT MAX(H.LAST_UPD_TMST)                       19160099
083800                  FROM ICT_CNT_THRS_PCT  H                        19170099
083900                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          19180099
084000                   AND H.LAST_ACTN_CDE = :PC-A                    19190099
084100                   AND H.THRS_HIER_VAL_NBR = B.DEPT_NBR)          19200099
084200                                                                  19210099
084300         END-EXEC                                                 19220099
084400                                                                  19230099
084500         EVALUATE TRUE                                            19240099
084600             WHEN SQLCODE = ZERO                                  19250099
084700                 SET VALID-THRS-HIER-CDE TO TRUE                  19260099
084800                                                                  19270099
084900             WHEN SQLCODE = +100                                  19280099
085000                 MOVE PC-DEP TO PV-THRS-HIER-CDE                  19290099
085100                 MOVE PC-THRS-HIER-VAL-DEF TO PV-THRS-HIER-VAL    19300099
085200                 PERFORM 4060-SELECT-THRS-PCT-DFLT                19310099
085300                                                                  19320099
085400             WHEN SQLWARN0 NOT EQUAL SPACE                        19330099
085500             WHEN SQLCODE NOT EQUAL ZERO                          19340099
085600                 DISPLAY '**************************************' 19350099
085700                 DISPLAY '** ABEND                            **' 19360099
085800                 DISPLAY '** 4050 SELECT THRESHOLD PROBLEM    **' 19370099
085900                 DISPLAY '*COUNT SETUP ID   = '                   19380099
086000                              ICT00020-CNT-STUP-ID                19390099
086100                 DISPLAY '*LOCATION NUMBER  = '                   19400099
086200                              ICT00020-LOC-NBR                    19410099
086300                 DISPLAY '*THRS HIER CODE   = '                   19420099
086400                              ICT00010-THRS-HIER-CDE              19430099
086500                 DISPLAY '**************************************' 19440099
086600                 MOVE 'ERROR ON SELECT OF THRS ' TO               19450099
086700                      PV-DB2-OPERATION                            19460099
086800                 PERFORM 9900-SQL-ABEND                           19470099
086900                                                                  19480099
087000         END-EVALUATE.                                            19490099
087100                                                                  19490199
087200*--------------------------------------------------------------*  19490221
087300* 4060-GET-THRS-PCT-DFLT                                       *  19490321
087400*   SELECT THRESHOLD PERCENT DEFAULT                           *  19490421
087500*--------------------------------------------------------------*  19490521
087600 4060-SELECT-THRS-PCT-DFLT.                                       19490621
087700                                                                  19490799
087800         EXEC SQL                                                 19490899
087900             SELECT G.CPL_THRS_PCT                                19490999
088000               INTO :ICT00009-CPL-THRS-PCT                        19491099
088100             FROM   ICT_CNT_THRS_PCT  G                           19492099
088200                                                                  19493099
088300           WHERE G.THRS_HIER_CDE = :PV-THRS-HIER-CDE              19494099
088400             AND G.LAST_UPD_TMST  =                               19495099
088500               (SELECT MAX(H.LAST_UPD_TMST)                       19496099
088600                  FROM ICT_CNT_THRS_PCT  H                        19497099
088700                 WHERE H.THRS_HIER_CDE = G.THRS_HIER_CDE          19498099
088800                   AND H.THRS_HIER_VAL_NBR =                      19499099
088900                           :PV-THRS-HIER-VAL)                     19500099
089000                                                                  19510099
089100         END-EXEC                                                 19520099
089200                                                                  19530099
089300         EVALUATE TRUE                                            19540099
089400             WHEN SQLCODE = ZERO                                  19550099
089500                 SET VALID-THRS-HIER-CDE TO TRUE                  19560099
089600                                                                  19570099
089700             WHEN SQLCODE = +100                                  19580099
089800                 SET INVALID-THRS-HIER-CDE TO TRUE                19590099
089900                                                                  19600099
090000             WHEN SQLWARN0 NOT EQUAL SPACE                        19610099
090100             WHEN SQLCODE NOT EQUAL ZERO                          19620099
090200                 DISPLAY '**************************************' 19630099
090300                 DISPLAY '** ABEND                            **' 19640099
090400                 DISPLAY '** 4060 SELECT THRESHOLD PROBLEM    **' 19650099
090500                 DISPLAY '*THRS HIER CODE   = '                   19660099
090600                              PV-THRS-HIER-CDE                    19670099
090700                 DISPLAY '*THRS HIER DEF VAL= '                   19680099
090800                              PV-THRS-HIER-VAL                    19690099
090900                 DISPLAY '**************************************' 19700099
091000                 MOVE 'ERROR ON SELECT OF THRS ' TO               19710099
091100                      PV-DB2-OPERATION                            19720099
091200                 PERFORM 9900-SQL-ABEND                           19730099
091300                                                                  19740099
091400         END-EVALUATE.                                            19750099
091500                                                                  19750199
091600*--------------------------------------------------------------*  19750221
091700* 4200-CHECK-COUNT-THRESHOLD                                   *  19750321
091800*   CHECK COUNT THRESHOLD                                      *  19750421
091900*--------------------------------------------------------------*  19750521
092000 4200-CHECK-COUNT-THRESHOLD.                                      19750621
092100                                                                  19750721
092200     INITIALIZE PV-SUM-ONHAND                                     19750899
092300                PV-SUM-SCANNED                                    19750999
092400                PV-THRESHOLD1                                     19751099
092410                PV-THRESHOLD2                                     19752099
092500                PV-THRESHOLD.                                     19753099
092600                                                                  19754099
092700     PERFORM 4210-CALC-TOTAL-ONHAND.                              19755099
092800     PERFORM 4220-CALC-TOTAL-SCANNED.                             19756099
092900     PERFORM 4230-CALC-CHECK-THRESHOLD.                           19756199
093100*--------------------------------------------------------------*  19756321
093200* 4210-CALC-TOTAL-ONHAND                                       *  19756421
093300*   CALCULATE THE TOTAL ONHAND.                                *  19756521
093400*--------------------------------------------------------------*  19756621
093500 4210-CALC-TOTAL-ONHAND.                                          19756721
093600                                                                  19756821
093700     EXEC SQL                                                     19756999
093800           SELECT                                                 19757099
093900                 SUM (A.LOC_EXPTED_UNT_QTY)                       19758099
094000             INTO                                                 19759099
094100                :PV-SUM-ONHAND                                    19760099
094200             FROM                                                 19770099
094300                  ICT_SKU_LOC_CNT  A                              19780099
094400             WHERE A.CNT_STUP_ID    = :ICT00020-CNT-STUP-ID       19790099
094500               AND A.LOC_NBR        = :ICT00020-LOC-NBR           19800099
094600               AND A.CNT_SEQ_NBR    = :ICT00020-CNT-SEQ-NBR       19810099
094700               AND A.LAST_UPD_TMST  =                             19820099
094800                    (SELECT MAX(F.LAST_UPD_TMST)                  19830099
094900                       FROM ICT_SKU_LOC_CNT   F                   19840099
095000                      WHERE F.CNT_STUP_ID = A.CNT_STUP_ID         19850099
095100                        AND F.CNT_SEQ_NBR = A.CNT_SEQ_NBR         19860099
095110                        AND F.SKU_NBR = A.SKU_NBR                 19870099
095200                        AND F.LOC_NBR = A.LOC_NBR                 19880099
CL3132                        AND F.LAST_UPD_USR_ID = 'SYSTEM'          19881099
836362                        AND (F.MDSE_EXPRN_DTE IS NULL             19890099
836362                  OR  F.MDSE_EXPRN_DTE > CURRENT DATE + 1 DAY))   19900099
095300     END-EXEC.                                                    19910099
095400                                                                  19920099
095500                                                                  19930099
095600     EVALUATE TRUE                                                19940099
095700         WHEN SQLCODE = ZERO                                      19950099
095800             CONTINUE                                             19960099
095900                                                                  19970099
096000         WHEN SQLCODE = +100                                      19980099
096100         WHEN SQLCODE = -305                                      19990099
096200               MOVE ZERO     TO PV-SUM-ONHAND                     20000099
096300                                                                  20010099
096400         WHEN SQLWARN0 NOT EQUAL SPACE                            20020099
096500         WHEN SQLCODE NOT EQUAL ZERO                              20030099
096600                 DISPLAY '**************************************' 20040099
096700                 DISPLAY '** ABEND                            **' 20050099
096800                 DISPLAY '** 4210 SELECT TOTAL ONHAND ERROR   **' 20060099
096900                 DISPLAY '*COUNT SETUP ID   = '                   20070099
097000                              ICT00020-CNT-STUP-ID                20080099
097100                 DISPLAY '*LOCATION NUMBER  = '                   20090099
097200                              ICT00020-LOC-NBR                    20100099
097300                 DISPLAY '*SKU NUMBER       = '                   20110099
097400                              ICT00011-SKU-NBR                    20120099
097500                 DISPLAY '**************************************' 20130099
097600                 MOVE 'ERROR ON SELECT OF ONHANDS ' TO            20140099
097700                      PV-DB2-OPERATION                            20150099
097800                 PERFORM 9900-SQL-ABEND                           20160099
097900     END-EVALUATE.                                                20170099
098000 EJECT                                                            20170199
098100                                                                  20170221
098200*--------------------------------------------------------------*  20170321
098300* 4220-CALC-TOTAL-SCANNED                                      *  20170421
098400*   CALCULATE THE TOTAL SCANNED.                               *  20170521
098500*--------------------------------------------------------------*  20170621
098600 4220-CALC-TOTAL-SCANNED.                                         20170721
098700                                                                  20170821
098800     EXEC SQL                                                     20170999
098900           SELECT                                                 20171099
099000                 COALESCE(SUM(A.SCND_UNT_QTY),0)                  20172099
099100             INTO                                                 20173099
099200                :PV-SUM-SCANNED                                   20174099
099300             FROM                                                 20175099
099400                  ICT_SKU_LOC_CNT  A                              20176099
099500             WHERE A.CNT_STUP_ID    = :ICT00020-CNT-STUP-ID       20177099
099600               AND A.LOC_NBR        = :ICT00020-LOC-NBR           20178099
099700               AND A.CNT_SEQ_NBR    = :ICT00020-CNT-SEQ-NBR       20179099
099800               AND A.LAST_UPD_TMST  =                             20180099
099900                    (SELECT MAX(F.LAST_UPD_TMST)                  20190099
100000                       FROM ICT_SKU_LOC_CNT   F                   20200099
100100                      WHERE F.CNT_STUP_ID = A.CNT_STUP_ID         20210099
100200                        AND F.CNT_SEQ_NBR = A.CNT_SEQ_NBR         20220099
100210                        AND F.SKU_NBR = A.SKU_NBR                 20230099
100300                        AND F.LOC_NBR = A.LOC_NBR                 20240099
CL3132                        AND F.LAST_UPD_USR_ID <> 'SYSTEM'         20241099
836362                        AND (F.MDSE_EXPRN_DTE IS NULL             20250099
836362              OR  F.MDSE_EXPRN_DTE > CURRENT DATE + 1 DAY ))      20260099
100400     END-EXEC.                                                    20270099
100500                                                                  20280099
100600     EVALUATE TRUE                                                20290099
100700         WHEN SQLCODE = ZERO                                      20300099
100800             CONTINUE                                             20310099
100900                                                                  20320099
101000         WHEN SQLCODE = +100                                      20330099
101100         WHEN SQLCODE = -305                                      20340099
101200               MOVE ZERO     TO PV-SUM-SCANNED                    20350099
101300                                                                  20360099
101400         WHEN SQLWARN0 NOT EQUAL SPACE                            20370099
101500         WHEN SQLCODE NOT EQUAL ZERO                              20380099
101600                 DISPLAY '**************************************' 20390099
101700                 DISPLAY '** ABEND                            **' 20400099
101800                 DISPLAY '** 4220 SELECT TOTAL SCANNED ERROR  **' 20410099
101900                 DISPLAY '*COUNT SETUP ID   = '                   20420099
102000                              ICT00020-CNT-STUP-ID                20430099
102100                 DISPLAY '*LOCATION NUMBER  = '                   20440099
102200                              ICT00020-LOC-NBR                    20450099
102300                 DISPLAY '*SKU NUMBER       = '                   20460099
102400                              ICT00011-SKU-NBR                    20470099
102500                 DISPLAY '**************************************' 20480099
102600                 MOVE 'ERROR ON SELECT OF ONHANDS ' TO            20490099
102700                      PV-DB2-OPERATION                            20500099
102800                 PERFORM 9900-SQL-ABEND                           20510099
102900     END-EVALUATE.                                                20520099
103000 EJECT                                                            20520199
103100                                                                  20520221
103200                                                                  20520321
103300*--------------------------------------------------------------*  20520421
103400* 4230-CALC-CHECK-THRESHOLD                                    *  20520521
103500*   CALCULATE THRESHOLD AND CHECK AGAINST APPROVAL THRESHOLD   *  20520621
103600*--------------------------------------------------------------*  20520721
103700 4230-CALC-CHECK-THRESHOLD.                                       20520821
103800                                                                  20520921
103900     IF  PV-SUM-ONHAND  > 0                                       20521099
104000       IF PV-SUM-ONHAND = PV-SUM-SCANNED                          20522099
104100           SET PS-AUTO-APPROVAL-YES TO TRUE                       20523099
104200       ELSE                                                       20524099
104300          COMPUTE PV-THRESHOLD1 =                                 20525099
104400          ((PV-SUM-ONHAND - PV-SUM-SCANNED) / PV-SUM-ONHAND)      20525199
104500                                                                  20525221
104600          COMPUTE PV-THRESHOLD = (PV-THRESHOLD1 * 100)            20525399
104610                                                                  20525499
104620**IF PV-THRESHOLD IS NEGATIVE -- MAKE IT POSITIVE (REMOVE THE SIGN20525599
104630** THEN PROCEED WITH CODE BELOW.                                  20525699
104640         IF PV-THRESHOLD < 0                                      20525799
104650             COMPUTE PV-THRESHOLD2 = (PV-THRESHOLD * -1)          20525899
104651             MOVE PV-THRESHOLD2 TO PV-THRESHOLD                   20525999
104660         END-IF                                                   20526099
104700                                                                  20527099
104800         IF PV-THRESHOLD < ICT00009-CPL-THRS-PCT                  20528099
104900             SET PS-AUTO-APPROVAL-YES TO TRUE                     20529099
105000         ELSE                                                     20530099
105100             SET PS-AUTO-APPROVAL-NO TO TRUE                      20540099
105200         END-IF                                                   20550099
105300       END-IF                                                     20560099
105400     ELSE                                                         20570099
105500         SET PS-AUTO-APPROVAL-NO TO TRUE                          20580099
105600     END-IF.                                                      20580199
105700                                                                  20580221
107080*--------------------------------------------------------------*  20580399
107190* 4300-AUTO-APPROVAL-BYPASS                                    *  20580499
107100*   DISPLAY VALUES WHEN THERE IS AN AUTO APPROVAL IS BYPASSED. *  20580599
107200*--------------------------------------------------------------*  20580699
107300 4300-AUTO-APPROVAL-BYPASS.                                       20580799
107400                                                                  20580899
107500     ADD +1 TO PV-BYPASS-CNT.                                     20580999
107600                                                                  20581099
107700     DISPLAY '****************************************'.          20582099
107800     DISPLAY '** 4300-AUTO-APPROVAL-BYPASS    ---   **'.          20583099
107900     DISPLAY '*COUNT SETUP ID   = '  ICT00020-CNT-STUP-ID.        20584099
108000     DISPLAY '*LOCATION NUMBER  = '  ICT00020-LOC-NBR.            20585099
108100     DISPLAY '*PV-SUM-ONHAND    = '  PV-SUM-ONHAND.               20586099
108200     DISPLAY '*PV-SUM-SCANNED   = '  PV-SUM-SCANNED.              20587099
108300     DISPLAY '*PV-THRESHOLD     = '  PV-THRESHOLD.                20588099
108400     DISPLAY '*ICT00009-CPL-THRS-PCT = '                          20589099
108500     DISPLAY                    ICT00009-CPL-THRS-PCT.            20590099
108600     DISPLAY '****************************************'.          20600099
108700                                                                  20610099
108800*--------------------------------------------------------------*  20610199
108900* 4500-DETERMINE-TIMEZONE                                      *  20610221
109000*   DETERMINE THE TIMEZONE FOR THE STORE                       *  20610310
109100*--------------------------------------------------------------*  20610410
109200 4500-DETERMINE-TIMEZONE.                                         20610521
109300                                                                  20610610
109400     PERFORM 8500-SELECT-XST-LOC.                                 20610799
109500     MOVE XST00001-STD-TM-ZN-CDE TO                               20610899
109510          ICWS010-TZC-TZ-IN-TM-ZN-CDE.                            20610999
109600     MOVE XST00001-DST-IND       TO ICWS010-TZC-TZ-IND-ST-IND.    20611099
109700     PERFORM 9000-TIMEZONE-CONVERSION.                            20612099
109800     MOVE ICWS010-TZC-LOCATION-TMST TO ICT00020-LAST-UPD-TMST.    20613099
109900*MAM MOVE ICWS010-TZC-LOCATION-TMST TO ICT00011-LAST-UPD-TMST.    20613199
110000                                                                  20613210
110100                                                                  20613312
110200                                                                  20613412
110300*--------------------------------------------------------------*  20613503
110400* 5100-INSERT-AUTO-APPROVAL                                    *  20613610
110500*   INSERT ROW FOR AUTO APPROVAL                               *  20613710
110600*--------------------------------------------------------------*  20613803
110700 5100-INSERT-AUTO-APPROVAL.                                       20613910
110800                                                                  20614003
110900     MOVE '5100-INSERT-AUTO-APPROVAL' TO PV-PARAGRAPH-NAME.       20614110
111000                                                                  20614203
112000     PERFORM                                                      20614303
112100         WITH TEST AFTER                                          20614403
112200         VARYING PV-NUMBER-OF-RETRIES                             20614503
112300         FROM 1 BY 1                                              20614603
112400         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       20614703
112500                OR SQLCODE = 0)                                   20614803
112600                                                                  20614903
112700         EXEC SQL                                                 20615011
112800             INSERT INTO ICT_LOC_CNT_STAT                         20615112
112900                   (CNT_STAT_CDE,                                 20615212
113000                    LOC_NBR,                                      20615312
113100                    CNT_STUP_ID,                                  20615412
113200                    CNT_SEQ_NBR,                                  20615599
113300                    LAST_UPD_TMST,                                20615612
113400                    LAST_UPD_USR_ID,                              20615712
113500                    LAST_ACTN_CDE)                                20615812
113600                                                                  20615912
113700             VALUES                                               20616012
113800                  (:PC-AUT,                                       20616115
113900                   :ICT00020-LOC-NBR,                             20616215
114000                   :ICT00020-CNT-STUP-ID,                         20616315
114100                   :ICT00020-CNT-SEQ-NBR,                         20616499
114200                   :ICT00020-LAST-UPD-TMST,                       20616599
114300                   :PC-SYSTEM,                                    20616615
114400                   :PC-A)                                         20616715
114500         END-EXEC                                                 20616811
114600                                                                  20616911
114700                                                                  20617011
114800         EVALUATE TRUE                                            20617111
114900             WHEN SQLCODE = 0                                     20617212
115000                 ADD +1 TO PV-INSERT-CNT                          20617312
115100                 ADD +1 TO PV-CNT-SINCE-COMMIT                    20617412
115200                                                                  20617511
115300             WHEN SQLCODE = -803                                  20617611
115400                 DISPLAY '**************************************' 20617712
115500                 DISPLAY '** ABEND                            **' 20617812
115600                 DISPLAY '** 5100 INSERT PROBLEM ON TABLE --  **' 20617912
115700                 DISPLAY '** ICT_LOC_CNT_STAT                 **' 20618012
115800                 DISPLAY '** DUPLICATE INSERT ATTEMPTED       **' 20618112
115900                 DISPLAY '*COUNT SETUP ID   = '                   20618212
116000                              ICT00020-CNT-STUP-ID                20618312
116100                 DISPLAY '*LOCATION NUMBER  = '                   20618412
116200                              ICT00020-LOC-NBR                    20618512
116300                 DISPLAY '**************************************' 20618612
116400                 MOVE 'ERROR ON INSERT OF COUNT ' TO              20618712
116500                      PV-DB2-OPERATION                            20618812
116600                 PERFORM 9900-SQL-ABEND                           20618912
116700                                                                  20619012
116800             WHEN SQLWARN0 NOT EQUAL SPACE                        20619112
116900             WHEN SQLCODE NOT EQUAL ZERO                          20619212
117000                 DISPLAY '**************************************' 20619312
117100                 DISPLAY '** ABEND                            **' 20619412
117200                 DISPLAY '** 5100 INSERT PROBLEM              **' 20619512
117300                 DISPLAY '*COUNT SETUP ID   = '                   20619612
117400                              ICT00020-CNT-STUP-ID                20619712
117500                 DISPLAY '*LOCATION NUMBER  = '                   20619812
117600                              ICT00020-LOC-NBR                    20619912
117700                 DISPLAY '**************************************' 20620012
117800                 MOVE 'ERROR ON INSERT OF COUNT ' TO              20620112
117900                      PV-DB2-OPERATION                            20620212
118000                 PERFORM 9900-SQL-ABEND                           20620312
118100                                                                  20620412
118200         END-EVALUATE                                             20620512
118300     END-PERFORM.                                                 20620612
118400                                                                  20620712
118500     IF  PV-NUMBER-OF-RETRIES > PC-MAX-RETRIES AND                20620812
118600         (SQLCODE NOT = ZERO)                                     20620912
118700         DISPLAY '****************************************'       20621012
118800         DISPLAY '** ABEND                              **'       20621112
118900         DISPLAY '** 5100 INSERT PROBLEM ON TABLE ---   **'       20621212
119000         DISPLAY 'ICT_LOC_CNT_STAT                      **'       20621312
119100         DISPLAY '*COUNT SETUP ID   = '                           20621412
119200                      ICT00020-CNT-STUP-ID                        20621512
119300         DISPLAY '*LOCATION NUMBER  = '                           20621612
119400                      ICT00020-LOC-NBR                            20621712
119500         DISPLAY '****************************************'       20621812
119600         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       20621912
119700         PERFORM 9900-SQL-ABEND                                   20622012
119800     END-IF.                                                      20622112
119900                                                                  20622212
120000*----------------------------------------------------------       20622318
120100*  SELECT FROM XST_LOC TO GET A STORE TIMEZONE.                   20622418
120200*----------------------------------------------------------       20622518
120300 8500-SELECT-XST-LOC.                                             20622618
120400     MOVE '8400-XST-LOC' TO  PV-PARAGRAPH-NAME.                   20622718
120500                                                                  20622818
120600     EXEC SQL                                                     20622918
120700       SELECT                                                     20623018
120800            STD_TM_ZN_CDE                                         20623118
120900           ,DST_IND                                               20623218
121000         INTO                                                     20623318
121100            :XST00001-STD-TM-ZN-CDE                               20623418
121200           ,:XST00001-DST-IND                                     20623518
121300         FROM  XST_LOC                                            20623618
121400        WHERE  LOC_NBR   = :ICT00020-LOC-NBR                      20623718
121500**MAM   WHERE  LOC_NBR   = :XST00001-LOC-NBR                      20623818
121600     END-EXEC.                                                    20623918
121700                                                                  20624018
121800     EVALUATE TRUE                                                20624118
121900        WHEN SQLCODE = 0                                          20624218
122000            CONTINUE                                              20624318
122100        WHEN OTHER                                                20624418
122200         DISPLAY '** ICKUP160 SELECT XST_LOC'                     20624518
122300                 ' HAD SQLCODE OF ' SQLCODE                       20624618
122400         PERFORM 9900-SQL-ABEND                                   20624718
122500     END-EVALUATE.                                                20624818
122600                                                                  20624918
122700******************************************************************20625016
122800     COPY ICPD010.                                                20625119
122900******************************************************************20625216
123000                                                                  20625399
123100*--------------------------------------------------------------*  20625403
123200* 9000-COMMIT.                                                    20625503
123300*--------------------------------------------------------------*  20625603
123400 9000-COMMIT.                                                     20625703
123500                                                                  20625803
123600     MOVE '9000-COMMIT' TO PV-PARAGRAPH-NAME.                     20625903
123700                                                                  20626003
123800     PERFORM                                                      20626103
123900         WITH TEST AFTER                                          20626203
124000         VARYING PV-NUMBER-OF-RETRIES                             20626303
124100         FROM 1 BY 1                                              20626403
124200         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       20626503
124300                OR SQLCODE = 0)                                   20626603
124400                                                                  20626703
124500         EXEC SQL                                                 20626803
124600             COMMIT                                               20626903
124700         END-EXEC                                                 20627003
124800                                                                  20627103
124900         EVALUATE TRUE                                            20627203
125000           WHEN SQLCODE = -904                                    20627303
125100           WHEN SQLCODE = -911                                    20627403
125200           WHEN SQLCODE = -913                                    20627503
125300             CONTINUE                                             20627603
125400           WHEN SQLCODE = 0                                       20627703
125500             MOVE ZERO TO PV-CNT-SINCE-COMMIT                     20627803
125600           WHEN OTHER                                             20627903
125700             MOVE 'ERROR ON COMMMIT' TO                           20628003
125800                  PV-DB2-OPERATION                                20628103
125900             PERFORM 9900-SQL-ABEND                               20628203
126000         END-EVALUATE                                             20628303
126100     END-PERFORM.                                                 20628403
126200                                                                  20628503
126300     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               20628603
126400         MOVE 'COMMIT RETRIES EXCEEDED' TO PV-DB2-OPERATION       20628703
126500         PERFORM 9900-SQL-ABEND                                   20628803
126600     END-IF.                                                      20628903
126700                                                                  20629003
126800*--------------------------------------------------------------*  20629103
126900* 9900-SQL-ABEND.                                                 20629203
127000*     SQL ABEND ROUTINE.                                          20629303
127100*--------------------------------------------------------------*  20629403
127200 9900-SQL-ABEND.                                                  20629503
127300                                                                  20630003
127400     DISPLAY '** ABEND     **'.                                   20640003
127500     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                20650003
127600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              20660003
127700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               20670003
127800                                                                  20680003
127900     COPY DPPD004.                                                20690003
128000     SET ABEND-4013-DB2-ERROR TO TRUE.                            20700003
128100     CALL 'ILBOABN0' USING ABEND-CODE.                            20710003
128200                                                                  20720003
128300*9900-EXIT.                                                       20730003
128400                                                                  20740003
128500*--------------------------------------------------------------*  20750003
128600* 9999-WRAPUP.                                                    20760003
128700*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      20770003
128800*     DATA COUNTS FROM THE PROGRAM.                               20780003
128900*--------------------------------------------------------------*  20790003
129000 9999-WRAPUP.                                                     20800003
129100                                                                  20810003
129200     DISPLAY '********************************************'.      20810199
129300     DISPLAY '**** SUMMARY OF PROGRAM ICKUP160         ***'.      20810215
129400     DISPLAY '********************************************'.      20810315
129500     DISPLAY 'TOTAL AUTO APPROVALS PROCESSED :' PV-INSERT-CNT.    20810499
129600     DISPLAY 'TOTAL COMPLETED APPROVALS BYPASSED :' PV-BYPASS-CNT.20810599
129700     DISPLAY 'TOTAL ROWS FETCHED          :' PV-TOTAL-FETCH-CNT.  20810699
129800     DISPLAY '********************************************'.      20810715
129900     DISPLAY '*********************************************'.     21200003
130000     DISPLAY '       END OF PROGRAM: ' PC-PROGRAM-NAME.           21210003
130100     DISPLAY '*********************************************'.     21220003
130200     DISPLAY ' '.                                                 21230003
130300                                                                  21240003
130400*9999-EXIT.                                                       21250003
130500                                                                  21260099
