000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XLKUP046.                                         00020000
000300 AUTHOR.        JEAN KURKOWSKI.                                   00030000
000400                                                                  00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  JULY 2007.                                        00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400****************************************************************  00140000
001500*                                                              *  00150000
001600*  THIS IS A COPY OF XLKUP033 FOR BATCH USE.  ANY CHANGES      *  00160000
001700*  SHOULD BE MADE IN BOTH PLACES.                              *  00170000
001800*                                                              *  00180000
001900*  MODULE IS USED TO WRITE DATA TO THE EAI EXPORT TABLES       *  00190000
002000*  WITHIN THE LOGISTICS DOMAIN. CALLING PROGRAMS USE COPYBOOK  *  00200000
002100*  XLWS091 TO PASS DATA TO THIS MODULE.                        *  00210000
002200*      THIS PROGRAM THEN INSERTS ROWS INTO PCT_BUS_EVNT_EXPRT  *  00220000
002300*  (PCT00011) OR SUT_BUS_EVNT_EXPRT (SUT00037).  THEN IF THERE *  00230000
002400*  IS DETAIL TO INSERT, IT INSERTS INTO PCT_BUS_EVNT_DTL       *  00240000
002500*  (PCT00012) OR SUT_BUS_EVNT_DTL (SUT00038) DEPENDING ON THE  *  00250000
002600*  COPYBOOK NAME PASSED. THE TWO COPYBOOKS THAT ARE CURRENTLY  *  00260000
002700*  PASSED ARE PCWS242 AND SUWS050.                             *  00270000
002800*                                                              *  00280000
002900*  DB2 ACCESS:                                                 *  00290000
003000*     NOTE: THERE ARE TWO SETS OF IDENTICAL TABLES THAT        *  00300000
003100*           ARE ACCESSED IN THIS PROGRAM AND THEY ARE          *  00310000
003200*           LISTED BELOW.  THE XL091-APP-ID-EXPORT-CDE         *  00320000
003300*           DETERMINES WHAT SET TO ACCESS.                     *  00330000
003400*                                                              *  00340000
003500*     PCT_BUS_EVNT (PCT00008) TABLE                            *  00350000
003600*     SUT_BUS_EVNT (SUT00034) TABLE                            *  00360000
003700*                SELECTS                                       *  00370000
003800*                                                              *  00380000
003900*     PCT_BUS_EVNT_MPNG (PCT00010) TABLE                       *  00390000
004000*     SUT_BUS_EVNT_MPNG (SUT00036) TABLE                       *  00400000
004100*                FETCHES                                       *  00410000
004200*                                                              *  00420000
004300*     PCT_BUS_EVNT_EXPRT (PCT00011) TABLE                      *  00430000
004400*     SUT_BUS_EVNT_EXPRT (SUT00037) TABLE                      *  00440000
004500*                INSERTS                                       *  00450000
004600*                                                              *  00460000
004700*     PCT_BUS_EVNT_DTL (PCT00012) TABLE                        *  00470000
004800*     SUT_BUS_EVNT_DTL (SUT00038) TABLE                        *  00480000
004900*                INSERTS                                       *  00490000
005000*                                                              *  00500000
005100****************************************************************  00510000
005200*                                                              *  00520000
005300*     USED BY BATCH PROGRAMS.                                  *  00530000
005400*                                                              *  00540000
005500*  COPYBOOK: XLWS091   FOR CALLING THIS PROGRAM                *  00550001
005600*            SUWS050                                           *  00560000
005700*            PCWS242                                           *  00570000
005800*                                                              *  00580000
005900****************************************************************  00590000
006000                                                                  00600000
006100 DATA DIVISION.                                                   00610000
006200 WORKING-STORAGE SECTION.                                         00620000
006300                                                                  00630000
006400 01  PV-CHARACTER-FIELDS.                                         00640000
006500     05  PV-CURRENT-DATE          PIC X(10)  VALUE SPACES.        00650000
006600     05  PV-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.        00660000
006700     05  PV-CURRENT-TIME          PIC X(08)  VALUE SPACES.        00670000
006800     05  PV-EVNT-OBJ-TXT          PIC X(40)  VALUE SPACES.        00680000
006900     05  PV-EVNT-OBJ-ACTN-TXT     PIC X(40)  VALUE SPACES.        00690000
007000     05  PV-EVNT-KEY-TXT          PIC X(40)  VALUE SPACES.        00700000
007100     05  PV-TEXT.                                                 00710000
007200         10  PV-TEXT-BYTE OCCURS 4000 TIMES                       00720000
007300                                  PIC X(01).                      00730000
007400                                                                  00740000
007500 01  PV-COMP-FIELDS.                                              00750000
007600     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00760000
007700     05  PV-ASSOCIATE-COUNT       PIC S9(09) VALUE 0 COMP.        00770000
007800     05  PV-SET-SEQ-NBR           PIC S9(09) VALUE 0 COMP.        00780000
007900     05  PV-NULL                  PIC S9(04) VALUE -1 COMP.       00790000
008000     05  PV-REF-ID-NULL           PIC S9(04) VALUE  0 COMP.       00800000
008100     05  PV-EVNT-KY-1-NBR-NULL    PIC S9(04) VALUE  0 COMP.       00810000
008200     05  PV-EVNT-KY-2-NBR-NULL    PIC S9(04) VALUE  0 COMP.       00820000
008300     05  PV-EVNT-KY-3-NBR-NULL    PIC S9(04) VALUE  0 COMP.       00830000
008400     05  PV-EVNT-KY-4-NBR-NULL    PIC S9(04) VALUE  0 COMP.       00840000
008500     05  PV-EVNT-KY-5-NBR-NULL    PIC S9(04) VALUE  0 COMP.       00850000
008600     05  PV-EVNT-KY-1-TXT-NULL    PIC S9(04) VALUE  0 COMP.       00860000
008700     05  PV-EVNT-KY-2-TXT-NULL    PIC S9(04) VALUE  0 COMP.       00870000
008800     05  PV-EVNT-KY-3-TXT-NULL    PIC S9(04) VALUE  0 COMP.       00880000
008900     05  PV-EVNT-KY-4-TXT-NULL    PIC S9(04) VALUE  0 COMP.       00890000
009000     05  PV-EVNT-KY-5-TXT-NULL    PIC S9(04) VALUE  0 COMP.       00900000
009100     05  PV-EVNT-KY-1-TMST-NULL   PIC S9(04) VALUE  0 COMP.       00910000
009200     05  PV-EVNT-KY-2-TMST-NULL   PIC S9(04) VALUE  0 COMP.       00920000
009300     05  PV-EVNT-KY-3-TMST-NULL   PIC S9(04) VALUE  0 COMP.       00930000
009400     05  PV-EVNT-KY-4-TMST-NULL   PIC S9(04) VALUE  0 COMP.       00940000
009500     05  PV-EVNT-KY-5-TMST-NULL   PIC S9(04) VALUE  0 COMP.       00950000
009600     05  PV-TEXT-SUB              PIC S9(08) VALUE  0 COMP.       00960000
009700                                                                  00970000
009800 01  PS-SWITCHES.                                                 00980000
009900     05  PS-ERROR-TYPE-SW             PIC X(01)  VALUE 'N'.       00990000
010000         88  PS-REQUIRED-ERROR                   VALUE 'Y'.       01000000
010100         88  PS-EXTRA-INPUT                      VALUE 'N'.       01010000
010200     05  PS-ASSIGNMENT-SW             PIC X(01)  VALUE 'N'.       01020000
010300         88  PS-ASSIGNMENT-FOUND                 VALUE 'Y'.       01030000
010400         88  PS-ASSIGNMENT-NOT-FOUND             VALUE 'N'.       01040000
010500     05  PS-KEYS-MATCH-SW             PIC X(01)  VALUE 'N'.       01050000
010600         88  PS-KEYS-MATCH                       VALUE 'Y'.       01060000
010700         88  PS-KEYS-DONT-MATCH                  VALUE 'N'.       01070000
010800     05  PS-ASSOCIATE-UPDATE-SW       PIC X(01)  VALUE 'N'.       01080000
010900         88  PS-ASSOCIATE-UPDATED                VALUE 'Y'.       01090000
011000         88  PS-ASSOCIATE-NOT-UPDATED            VALUE 'N'.       01100000
011100     05  PS-ASSIGNMENT-UPDATE-SW      PIC X(01)  VALUE 'N'.       01110000
011200         88  PS-ASSIGNMENT-UPDATED               VALUE 'Y'.       01120000
011300         88  PS-ASSIGNMENT-NOT-UPDATED           VALUE 'N'.       01130000
011400     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       01140000
011500         88  PS-END-OF-CURSOR                    VALUE 'Y'.       01150000
011600         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.       01160000
011700                                                                  01170000
011800 01  PC-CONSTANTS.                                                01180000
011900     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       01190000
012000     05  PC-C                        PIC X      VALUE 'C'.        01200000
012100     05  PC-X                        PIC X      VALUE 'X'.        01210000
012200     05  PC-N                        PIC X      VALUE 'N'.        01220000
012300     05  PC-ASTERISK-LINE            PIC X(40)  VALUE ALL '*'.    01230000
012400     05  PC-FIVE-BLANKS              PIC X(05)  VALUE '     '.    01240000
012500     05  PC-TEN-BLANKS               PIC X(10)  VALUE SPACES.     01250000
012600                                                                  01260000
012700     05  PC-KY-1-NBR                 PIC X(40)  VALUE             01270000
012800         'EVNT_KY_1_NBR                           '.              01280000
012900     05  PC-KY-2-NBR                 PIC X(40)  VALUE             01290000
013000         'EVNT_KY_2_NBR                           '.              01300000
013100     05  PC-KY-3-NBR                 PIC X(40)  VALUE             01310000
013200         'EVNT_KY_3_NBR                           '.              01320000
013300     05  PC-KY-4-NBR                 PIC X(40)  VALUE             01330000
013400         'EVNT_KY_4_NBR                           '.              01340000
013500     05  PC-KY-5-NBR                 PIC X(40)  VALUE             01350000
013600         'EVNT_KY_5_NBR                           '.              01360000
013700                                                                  01370000
013800     05  PC-KY-1-TMST                PIC X(40)  VALUE             01380000
013900         'EVNT_KY_1_TMST                          '.              01390000
014000     05  PC-KY-2-TMST                PIC X(40)  VALUE             01400000
014100         'EVNT_KY_2_TMST                          '.              01410000
014200     05  PC-KY-3-TMST                PIC X(40)  VALUE             01420000
014300         'EVNT_KY_3_TMST                          '.              01430000
014400     05  PC-KY-4-TMST                PIC X(40)  VALUE             01440000
014500         'EVNT_KY_4_TMST                          '.              01450000
014600     05  PC-KY-5-TMST                PIC X(40)  VALUE             01460000
014700         'EVNT_KY_5_TMST                          '.              01470000
014800                                                                  01480000
014900     05  PC-KY-1-TXT                 PIC X(40)  VALUE             01490000
015000         'EVNT_KY_1_TXT                           '.              01500000
015100     05  PC-KY-2-TXT                 PIC X(40)  VALUE             01510000
015200         'EVNT_KY_2_TXT                           '.              01520000
015300     05  PC-KY-3-TXT                 PIC X(40)  VALUE             01530000
015400         'EVNT_KY_3_TXT                           '.              01540000
015500     05  PC-KY-4-TXT                 PIC X(40)  VALUE             01550000
015600         'EVNT_KY_4_TXT                           '.              01560000
015700     05  PC-KY-5-TXT                 PIC X(40)  VALUE             01570000
015800         'EVNT_KY_5_TXT                           '.              01580000
015900                                                                  01590000
016000****************************************************************  01600000
016100*    PCT00008 - PCT_BUS_EVNT                                   *  01610000
016200*    PCT00010 - PCT_BUS_EVNT_MPNG                              *  01620000
016300*    PCT00011 - PCT_BUS_EVNT_EXPRT                             *  01630000
016400*    PCT00012 - PCT_BUS_EVNT_DTL                               *  01640000
016500*                                                              *  01650000
016600*    SUT00034 - SUT_BUS_EVNT                                   *  01660000
016700*    SUT00036 - SUT_BUS_EVNT_MPNG                              *  01670000
016800*    SUT00037 - SUT_BUS_EVNT_EXPRT                             *  01680000
016900*    SUT00038 - SUT_BUS_EVNT_DTL                               *  01690000
017000*                                                              *  01700000
017100****************************************************************  01710000
017200                                                                  01720000
017300     EXEC SQL                                                     01730000
017400         INCLUDE PCT00008                                         01740000
017500     END-EXEC.                                                    01750000
017600                                                                  01760000
017700     EXEC SQL                                                     01770000
017800         INCLUDE PCT00010                                         01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100     EXEC SQL                                                     01810000
018200         INCLUDE PCT00011                                         01820000
018300     END-EXEC.                                                    01830000
018400                                                                  01840000
018500                                                                  01850000
018600     EXEC SQL                                                     01860000
018700         INCLUDE PCT00012                                         01870000
018800     END-EXEC.                                                    01880000
018900                                                                  01890000
019000     EXEC SQL                                                     01900000
019100         INCLUDE SUT00034                                         01910000
019200     END-EXEC.                                                    01920000
019300                                                                  01930000
019400     EXEC SQL                                                     01940000
019500         INCLUDE SUT00036                                         01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800     EXEC SQL                                                     01980000
019900         INCLUDE SUT00037                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200     EXEC SQL                                                     02020000
020300         INCLUDE SUT00038                                         02030000
020400     END-EXEC.                                                    02040000
020500                                                                  02050000
020600     EXEC SQL                                                     02060000
020700          INCLUDE SQLCA                                           02070000
020800     END-EXEC.                                                    02080000
020900                                                                  02090000
021000 01  PV-TABLE-KEYS.                                               02100000
021100     05  PV-TABLE-SUB             PIC S9(4)  VALUE 0 COMP.        02110000
021200     05  PV-TABLE-SUB-COMMAREA    PIC S9(4)  VALUE 0 COMP.        02120000
021300     05  PV-TABLE-MAX             PIC S9(4)  VALUE 0 COMP.        02130000
021400     05  PV-TABLE-KEY-VALUE OCCURS 50 TIMES                       02140000
021500                                  PIC X(40).                      02150000
021600     05  PV-KEY-VALUES OCCURS 50 TIMES.                           02160000
021700         10  PV-TABLE-KEY-NAME    PIC X(40).                      02170000
021800         10  PV-EXISTS-COMMAREA   PIC X(01).                      02180000
021900             88  PV-PRESENT-IN-COMMAREA       VALUE 'Y'.          02190000
022000             88  PV-NOT-PRESENT-IN-COMMAREA   VALUE 'N'.          02200000
022100         10  PV-EXISTS-DB2-TABLE  PIC X(01).                      02210000
022200             88  PV-PRESENT-IN-DB2-TABLE      VALUE 'Y'.          02220000
022300             88  PV-NOT-PRESENT-IN-DB2-TABLE  VALUE 'N'.          02230000
022400                                                                  02240000
022500     EXEC SQL                                                     02250000
022600        DECLARE PCT-MAPPING-CSR CURSOR FOR                        02260000
022700         SELECT                                                   02270000
022800                MPNG.EVNT_OBJ_TXT                                 02280000
022900               ,MPNG.EVNT_OBJ_ACTN_TXT                            02290000
023000               ,MPNG.EVNT_KY_TXT                                  02300000
023100               ,MPNG.ATTR_DESC                                    02310000
023200               ,MPNG.CRE_TMST                                     02320000
023300               ,MPNG.CRE_BY_USR_ID                                02330000
023400                                                                  02340000
023500          FROM  PCT_BUS_EVNT_MPNG  MPNG                           02350000
023600                                                                  02360000
023700         WHERE  MPNG.EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT         02370000
023800           AND  MPNG.EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT    02380000
023900      ORDER BY  MPNG.EVNT_OBJ_TXT                                 02390000
024000               ,MPNG.EVNT_OBJ_ACTN_TXT                            02400000
024100               ,MPNG.EVNT_KY_TXT                                  02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400     EXEC SQL                                                     02440000
024500        DECLARE SUT-MAPPING-CSR CURSOR FOR                        02450000
024600         SELECT                                                   02460000
024700                MPNG.EVNT_OBJ_TXT                                 02470000
024800               ,MPNG.EVNT_OBJ_ACTN_TXT                            02480000
024900               ,MPNG.EVNT_KY_TXT                                  02490000
025000               ,MPNG.ATTR_DESC                                    02500000
025100               ,MPNG.CRE_TMST                                     02510000
025200               ,MPNG.CRE_BY_USR_ID                                02520000
025300                                                                  02530000
025400          FROM  SUT_BUS_EVNT_MPNG  MPNG                           02540000
025500                                                                  02550000
025600         WHERE  MPNG.EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT         02560000
025700           AND  MPNG.EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT    02570000
025800      ORDER BY  MPNG.EVNT_OBJ_TXT                                 02580000
025900               ,MPNG.EVNT_OBJ_ACTN_TXT                            02590000
026000               ,MPNG.EVNT_KY_TXT                                  02600000
026100     END-EXEC.                                                    02610000
026200                                                                  02620000
026300 LINKAGE SECTION.                                                 02630000
026400     COPY XLWS091.                                                02640000
026500                                                                  02650000
026600*    COPY PCWS242.                                                02660000
026700                                                                  02670000
026800*    COPY SUWS050.                                                02680000
026900                                                                  02690000
027000                                                                  02700000
027100 PROCEDURE DIVISION USING XL091-EAI-EXPORT-COMMAREA.              02710000
027200                                                                  02720000
027300     SET XL091-SUCCESSFUL  TO TRUE.                               02730000
027400                                                                  02740000
027500     EVALUATE TRUE                                                02750000
027600         WHEN XL091-VALID-APP-ID                                  02760000
027700              PERFORM 1000-VALIDATE-INPUT-FIELDS                  02770000
027800                                                                  02780000
027900         WHEN OTHER                                               02790000
028000              SET XL091-APP-ID-CODE-MISSING TO TRUE               02800000
028100                                                                  02810000
028200     END-EVALUATE.                                                02820000
028300                                                                  02830000
028400     GOBACK.                                                      02840000
028500                                                                  02850000
028600                                                                  02860000
028700****************************************************************  02870000
028800*    VALIDATE THAT ALL INPUT FIELDS ARE PRESENT.               *  02880000
028900*        THIS VARIES DEPENDING ON THE TYPE OF PROCESSING CODE  *  02890000
029000*        THAT IS BEING REQUESTED.                              *  02900000
029100*                                                              *  02910000
029200*        STOP PROCESSING AND RETURN IF THERE ARE ANY ERRORS.   *  02920000
029300*                                                              *  02930000
029400****************************************************************  02940000
029500                                                                  02950000
029600 1000-VALIDATE-INPUT-FIELDS.                                      02960000
029700                                                                  02970000
029800     EVALUATE TRUE                                                02980000
029900         WHEN XL091-VALID-COPYBOOK                                02990000
030000              EVALUATE TRUE                                       03000000
030100                  WHEN XL091-CRE-BY-USR-ID = SPACES               03010000
030200                       SET XL091-CRE-BY-FIELDS-MISSING TO TRUE    03020000
030300                                                                  03030000
030400                  WHEN XL091-CRE-PGM-NM = SPACES                  03040000
030500                       SET XL091-CRE-BY-FIELDS-MISSING TO TRUE    03050000
030600                                                                  03060000
030700                  WHEN OTHER                                      03070000
030800                       CONTINUE                                   03080000
030900                                                                  03090000
031000              END-EVALUATE                                        03100000
031100                                                                  03110000
031200         WHEN OTHER                                               03120000
031300              SET XL091-COPYBOOK-NM-MISSING TO TRUE               03130000
031400                                                                  03140000
031500     END-EVALUATE.                                                03150000
031600                                                                  03160000
031700     IF XL091-SUCCESSFUL                                          03170000
031800        IF XL091-COMMIT-UPDATE OR                                 03180000
031900           XL091-DO-NOT-COMMIT-UPDATE                             03190000
032000           PERFORM 8400-GET-TIMESTAMP                             03200000
032100           PERFORM 2000-VALIDATE-INPUT-VALUES                     03210000
032200        ELSE                                                      03220000
032300           SET XL091-COMMIT-CODE-INVALID TO TRUE                  03230000
032400        END-IF                                                    03240000
032500                                                                  03250000
032600     END-IF.                                                      03260000
032700                                                                  03270000
032800****************************************************************  03280000
032900*    CURRENTLY TWO APPLICATION CODES ARE VALID:                *  03290000
033000*        PC - PCWS242 COPYBOOK                                 *  03300000
033100*        SU - SUWS050 COPYBOOK                                 *  03310000
033200*        THESE COPYBOOKS REDEFINE XL091-DTL-TXT IN THE XLWS072 *  03320000
033300*            COPYBOOK.                                         *  03330000
033400*                                                              *  03340000
033500****************************************************************  03350000
033600                                                                  03360000
033700 2000-VALIDATE-INPUT-VALUES.                                      03370000
033800                                                                  03380000
033900     EVALUATE TRUE                                                03390000
034000         WHEN XL091-PC-APP-ID                                     03400000
034100*             **************************************************  03410000
034200*             *                                                *  03420000
034300*             *                                                *  03430000
034400*             **************************************************  03440000
034500              MOVE XL091-EVNT-OBJ-TXT      TO PV-EVNT-OBJ-TXT     03450000
034600              MOVE XL091-EVNT-OBJ-ACTN-TXT TO PV-EVNT-OBJ-ACTN-TXT03460000
034700                                                                  03470000
034800         WHEN XL091-SU-APP-ID                                     03480000
034900*             **************************************************  03490000
035000*             *                                                *  03500000
035100*             *                                                *  03510000
035200*             **************************************************  03520000
035300              MOVE XL091-EVNT-OBJ-TXT      TO PV-EVNT-OBJ-TXT     03530000
035400              MOVE XL091-EVNT-OBJ-ACTN-TXT TO PV-EVNT-OBJ-ACTN-TXT03540000
035500                                                                  03550000
035600                                                                  03560000
035700     END-EVALUATE.                                                03570000
035800                                                                  03580000
035900     PERFORM 3000-SELECT-BUSINESS-EVENT.                          03590000
036000                                                                  03600000
036100     IF XL091-SUCCESSFUL                                          03610000
036200        PERFORM 4000-PROCESS-MAPPING                              03620000
036300     END-IF.                                                      03630000
036400                                                                  03640000
036500     IF XL091-SUCCESSFUL                                          03650000
036600        IF XL091-COMMIT-UPDATE                                    03660000
036700           PERFORM 8000-COMMIT                                    03670000
036800        END-IF                                                    03680000
036900     END-IF.                                                      03690000
037000                                                                  03700000
037100                                                                  03710000
037200****************************************************************  03720000
037300*    DEPENDING ON THE APPLICATION CODE, THE APPROPRIATE SET    *  03730000
037400*        OF TABLES ARE READ (PCT OR SUT).                      *  03740000
037500*                                                              *  03750000
037600****************************************************************  03760000
037700                                                                  03770000
037800 3000-SELECT-BUSINESS-EVENT.                                      03780000
037900                                                                  03790000
038000     PERFORM                                                      03800000
038100         WITH TEST AFTER                                          03810000
038200         VARYING PV-RETRY-COUNTER                                 03820000
038300         FROM 1 BY 1                                              03830000
038400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  03840000
038500            OR SQLCODE = ZERO                                     03850000
038600            OR SQLCODE = +100                                     03860000
038700                                                                  03870000
038800         IF XL091-PC-APP-ID                                       03880000
038900            EXEC SQL                                              03890000
039000                SELECT                                            03900000
039100                       EVNT_TYP_CDE                               03910000
039200                      ,CNFRMN_REQD_CDE                            03920000
039300                      ,CRE_TMST                                   03930000
039400                      ,CRE_BY_USR_ID                              03940000
039500                      ,NOTES_TXT                                  03950000
039600                 INTO                                             03960000
039700                       :PCT00008-EVNT-TYP-CDE                     03970000
039800                      ,:PCT00008-CNFRMN-REQD-CDE                  03980000
039900                      ,:PCT00008-CRE-TMST                         03990000
040000                      ,:PCT00008-CRE-BY-USR-ID                    04000000
040100                      ,:PCT00008-NOTES-TXT                        04010000
040200                                                                  04020000
040300                 FROM  PCT_BUS_EVNT                               04030000
040400                WHERE  EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT       04040000
040500                  AND  EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT  04050000
040600            END-EXEC                                              04060000
040700         ELSE                                                     04070000
040800            EXEC SQL                                              04080000
040900                SELECT                                            04090000
041000                       EVNT_TYP_CDE                               04100000
041100                      ,CNFRMN_REQD_CDE                            04110000
041200                      ,CRE_TMST                                   04120000
041300                      ,CRE_BY_USR_ID                              04130000
041400                      ,NOTES_TXT                                  04140000
041500                 INTO                                             04150000
041600                       :SUT00034-EVNT-TYP-CDE                     04160000
041700                      ,:SUT00034-CNFRMN-REQD-CDE                  04170000
041800                      ,:SUT00034-CRE-TMST                         04180000
041900                      ,:SUT00034-CRE-BY-USR-ID                    04190000
042000                      ,:SUT00034-NOTES-TXT                        04200000
042100                                                                  04210000
042200                 FROM  SUT_BUS_EVNT                               04220000
042300                WHERE  EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT       04230000
042400                  AND  EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT  04240000
042500            END-EXEC                                              04250000
042600         END-IF                                                   04260000
042700                                                                  04270000
042800         EVALUATE TRUE                                            04280000
042900             WHEN SQLCODE = ZERO                                  04290000
043000                  SET PS-ASSIGNMENT-FOUND TO TRUE                 04300000
043100                                                                  04310000
043200             WHEN SQLCODE = +100                                  04320000
043300                  SET PS-ASSIGNMENT-NOT-FOUND TO TRUE             04330000
043400                  SET XL091-INVALID-BUS-EVNT  TO TRUE             04340000
043500                                                                  04350000
043600             WHEN SQLCODE = -904                                  04360000
043700             WHEN SQLCODE = -913                                  04370000
043800             WHEN SQLCODE = -911                                  04380000
043900                  CONTINUE                                        04390000
044000                                                                  04400000
044100             WHEN SQLWARN0 NOT = SPACES                           04410000
044200             WHEN SQLCODE NOT = ZERO                              04420000
044300                  MOVE +4             TO PV-RETRY-COUNTER         04430000
044400         END-EVALUATE                                             04440000
044500     END-PERFORM.                                                 04450000
044600                                                                  04460000
044700     IF SQLCODE = ZERO OR                                         04470000
044800        SQLCODE = +100                                            04480000
044900        CONTINUE                                                  04490000
045000     ELSE                                                         04500000
045100        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      04510000
045200           SET XL091-SQL-ERROR TO TRUE                            04520000
045300           MOVE SQLCODE        TO XL091-EAI-DB-SQLCODE            04530000
045400           MOVE '3000-'        TO XL091-SQL-ERROR-PARA            04540000
045500           MOVE SQLCA          TO XL091-SQLCA                     04550000
045600        END-IF                                                    04560000
045700     END-IF.                                                      04570000
045800                                                                  04580000
045900                                                                  04590000
046000****************************************************************  04600000
046100*    THE MAPPING TABLES ARE USED TO VALIDATE WHETHER THE RIGHT *  04610000
046200*        FIELDS HAVE BEEN PASSED IN THE COMMAREA.  THERE ARE   *  04620000
046300*        TWO SETS OF ERRORS                                    *  04630000
046400*                                                              *  04640000
046500*                                                              *  04650000
046600*    FIRST, ALL OF THE KEY FIELDS THAT AREN'T ZERO OR SPACES   *  04660000
046700*           IN THE COMMAREA ARE LOADED INTO A TABLE IN         *  04670000
046800*           SEQUENCE IN WHICH THEY WILL BE FETCHED FROM THE    *  04680000
046900*           MAPPING TABLE.                                     *  04690000
047000*                                                              *  04700000
047100*    SECOND, THE APPROPRIATE MAPPING TABLE IS READ.  FOR EACH  *  04710000
047200*            ROW READ, THE EVNT_KY_TXT FIELD IS COMPARED       *  04720000
047300*            AGAINST THE TABLE LOADED FROM THE COMMAREA TO     *  04730000
047400*            SEE IF THAT ROW WAS PASSED.                       *  04740000
047500*                                                              *  04750000
047600****************************************************************  04760000
047700                                                                  04770000
047800 4000-PROCESS-MAPPING.                                            04780000
047900                                                                  04790000
048000     PERFORM 4100-TABLE-COMMAREA-KEY-FIELDS.                      04800000
048100                                                                  04810000
048200     MOVE 0   TO PV-TABLE-SUB.                                    04820000
048300     SET PS-NOT-END-OF-CURSOR TO TRUE.                            04830000
048400                                                                  04840000
048500     PERFORM 4200-OPEN-MAPPING-CURSOR.                            04850000
048600     PERFORM 4400-FETCH-MAPPING-DATA.                             04860000
048700                                                                  04870000
048800     PERFORM UNTIL (PS-END-OF-CURSOR)                             04880000
048900                                                                  04890000
049000         PERFORM 4400-FETCH-MAPPING-DATA                          04900000
049100                                                                  04910000
049200     END-PERFORM.                                                 04920000
049300                                                                  04930000
049400     PERFORM 4600-CLOSE-MAPPING-CURSOR.                           04940000
049500                                                                  04950000
049600     IF XL091-SUCCESSFUL                                          04960000
049700        PERFORM 5100-FORMAT-EVNT-EXPRT                            04970000
049800        PERFORM 5200-INSERT-EXPORT-TABLE                          04980000
049900                                                                  04990000
050000        IF XL091-SUCCESSFUL                                       05000000
050100           IF XL091-COPYBOOK-NOT-USED                             05010000
050200              CONTINUE                                            05020000
050300           ELSE                                                   05030000
050400              PERFORM 5300-FORMAT-EVNT-DTL                        05040000
050500              PERFORM 5400-INSERT-DETAIL-TEXT                     05050000
050600           END-IF                                                 05060000
050700        END-IF                                                    05070000
050800     END-IF.                                                      05080000
050900                                                                  05090000
051000                                                                  05100000
051100****************************************************************  05110000
051200*    LOAD ALL OF THE KEY VALUES FROM THE COMMAREA INTO A       *  05120000
051300*    TABLE IN THE SAME SEQUENCE IN WHICH THEY WILL BE FETCHED. *  05130000
051400*                                                              *  05140000
051500*                                                              *  05150000
051600*    AS YOU FETCH EACH ROW FROM THE MAPPING TABLE, COMPARE     *  05160000
051700*    TO THE NEXT ENTRY IN THE TABLE.  IF IT DOESN'T MATCH,     *  05170000
051800*    THERE IS AN ERROR.                                        *  05180000
051900*                                                              *  05190000
052000****************************************************************  05200000
052100                                                                  05210000
052200 4100-TABLE-COMMAREA-KEY-FIELDS.                                  05220000
052300                                                                  05230000
052400     INITIALIZE PV-TABLE-KEYS.                                    05240000
052500                                                                  05250000
052600     MOVE 0   TO PV-TABLE-SUB.                                    05260000
052700     MOVE 50  TO PV-TABLE-MAX.                                    05270000
052800                                                                  05280000
052900     IF XL091-EVNT-KY-1-NBR = 0                                   05290000
053000        MOVE PV-NULL TO PV-EVNT-KY-1-NBR-NULL                     05300000
053100     ELSE                                                         05310000
053200        ADD 1 TO PV-TABLE-SUB                                     05320000
053300        MOVE 0 TO PV-EVNT-KY-1-NBR-NULL                           05330000
053400        MOVE PC-KY-1-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05340000
053500                                                                  05350000
053600     IF XL091-EVNT-KY-1-TMST = SPACES                             05360000
053700        MOVE PV-NULL TO PV-EVNT-KY-1-TMST-NULL                    05370000
053800     ELSE                                                         05380000
053900        ADD 1 TO PV-TABLE-SUB                                     05390000
054000        MOVE 0 TO PV-EVNT-KY-1-TMST-NULL                          05400000
054100        MOVE PC-KY-1-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).   05410000
054200                                                                  05420000
054300     IF XL091-EVNT-KY-1-TXT = SPACES                              05430000
054400        MOVE PV-NULL TO PV-EVNT-KY-1-TXT-NULL                     05440000
054500     ELSE                                                         05450000
054600        ADD 1 TO PV-TABLE-SUB                                     05460000
054700        MOVE 0 TO PV-EVNT-KY-1-TXT-NULL                           05470000
054800        MOVE PC-KY-1-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05480000
054900                                                                  05490000
055000     IF XL091-EVNT-KY-2-NBR = 0                                   05500000
055100        MOVE PV-NULL TO PV-EVNT-KY-2-NBR-NULL                     05510000
055200     ELSE                                                         05520000
055300        ADD 1 TO PV-TABLE-SUB                                     05530000
055400        MOVE 0 TO PV-EVNT-KY-2-NBR-NULL                           05540000
055500        MOVE PC-KY-2-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05550000
055600                                                                  05560000
055700     IF XL091-EVNT-KY-2-TMST = SPACES                             05570000
055800        MOVE PV-NULL TO PV-EVNT-KY-2-TMST-NULL                    05580000
055900     ELSE                                                         05590000
056000        ADD 1 TO PV-TABLE-SUB                                     05600000
056100        MOVE 0 TO PV-EVNT-KY-2-TMST-NULL                          05610000
056200        MOVE PC-KY-2-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).   05620000
056300                                                                  05630000
056400     IF XL091-EVNT-KY-2-TXT = SPACES                              05640000
056500        MOVE PV-NULL TO PV-EVNT-KY-2-TXT-NULL                     05650000
056600     ELSE                                                         05660000
056700        ADD 1 TO PV-TABLE-SUB                                     05670000
056800        MOVE 0 TO PV-EVNT-KY-2-TXT-NULL                           05680000
056900        MOVE PC-KY-2-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05690000
057000                                                                  05700000
057100     IF XL091-EVNT-KY-3-NBR = 0                                   05710000
057200        MOVE PV-NULL TO PV-EVNT-KY-3-NBR-NULL                     05720000
057300     ELSE                                                         05730000
057400        ADD 1 TO PV-TABLE-SUB                                     05740000
057500        MOVE 0 TO PV-EVNT-KY-3-NBR-NULL                           05750000
057600        MOVE PC-KY-3-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05760000
057700                                                                  05770000
057800     IF XL091-EVNT-KY-3-TMST = SPACES                             05780000
057900        MOVE PV-NULL TO PV-EVNT-KY-3-TMST-NULL                    05790000
058000     ELSE                                                         05800000
058100        ADD 1 TO PV-TABLE-SUB                                     05810000
058200        MOVE 0 TO PV-EVNT-KY-3-TMST-NULL                          05820000
058300        MOVE PC-KY-3-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).   05830000
058400                                                                  05840000
058500     IF XL091-EVNT-KY-3-TXT = SPACES                              05850000
058600        MOVE PV-NULL TO PV-EVNT-KY-3-TXT-NULL                     05860000
058700     ELSE                                                         05870000
058800        ADD 1 TO PV-TABLE-SUB                                     05880000
058900        MOVE 0 TO PV-EVNT-KY-3-TXT-NULL                           05890000
059000        MOVE PC-KY-3-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05900000
059100                                                                  05910000
059200     IF XL091-EVNT-KY-4-NBR = 0                                   05920000
059300        MOVE PV-NULL TO PV-EVNT-KY-4-NBR-NULL                     05930000
059400     ELSE                                                         05940000
059500        ADD 1 TO PV-TABLE-SUB                                     05950000
059600        MOVE 0 TO PV-EVNT-KY-4-NBR-NULL                           05960000
059700        MOVE PC-KY-4-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    05970000
059800                                                                  05980000
059900     IF XL091-EVNT-KY-4-TMST = SPACES                             05990000
060000        MOVE PV-NULL TO PV-EVNT-KY-4-TMST-NULL                    06000000
060100     ELSE                                                         06010000
060200        ADD 1 TO PV-TABLE-SUB                                     06020000
060300        MOVE 0 TO PV-EVNT-KY-4-TMST-NULL                          06030000
060400        MOVE PC-KY-4-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).   06040000
060500                                                                  06050000
060600     IF XL091-EVNT-KY-4-TXT = SPACES                              06060000
060700        MOVE PV-NULL TO PV-EVNT-KY-4-TXT-NULL                     06070000
060800     ELSE                                                         06080000
060900        ADD 1 TO PV-TABLE-SUB                                     06090000
061000        MOVE 0 TO PV-EVNT-KY-4-TXT-NULL                           06100000
061100        MOVE PC-KY-4-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    06110000
061200                                                                  06120000
061300     IF XL091-EVNT-KY-5-NBR = 0                                   06130000
061400        MOVE PV-NULL TO PV-EVNT-KY-5-NBR-NULL                     06140000
061500     ELSE                                                         06150000
061600        ADD 1 TO PV-TABLE-SUB                                     06160000
061700        MOVE 0 TO PV-EVNT-KY-5-NBR-NULL                           06170000
061800        MOVE PC-KY-5-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    06180000
061900                                                                  06190000
062000     IF XL091-EVNT-KY-5-TMST = SPACES                             06200000
062100        MOVE PV-NULL TO PV-EVNT-KY-5-TMST-NULL                    06210000
062200     ELSE                                                         06220000
062300        ADD 1 TO PV-TABLE-SUB                                     06230000
062400        MOVE 0 TO PV-EVNT-KY-5-TMST-NULL                          06240000
062500        MOVE PC-KY-5-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).   06250000
062600                                                                  06260000
062700     IF XL091-EVNT-KY-5-TXT = SPACES                              06270000
062800        MOVE PV-NULL TO PV-EVNT-KY-5-TXT-NULL                     06280000
062900     ELSE                                                         06290000
063000        ADD 1 TO PV-TABLE-SUB                                     06300000
063100        MOVE 0 TO PV-EVNT-KY-5-TXT-NULL                           06310000
063200        MOVE PC-KY-5-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).    06320000
063300                                                                  06330000
063400                                                                  06340000
063500****************************************************************  06350000
063600*                                                              *  06360000
063700*                                                              *  06370000
063800****************************************************************  06380000
063900                                                                  06390000
064000 4200-OPEN-MAPPING-CURSOR.                                        06400000
064100                                                                  06410000
064200     PERFORM                                                      06420000
064300         WITH TEST AFTER                                          06430000
064400         VARYING PV-RETRY-COUNTER                                 06440000
064500         FROM 1 BY 1                                              06450000
064600         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  06460000
064700            OR SQLCODE = ZERO                                     06470000
064800            OR SQLCODE = +100                                     06480000
064900                                                                  06490000
065000         EVALUATE TRUE                                            06500000
065100             WHEN XL091-PC-APP-ID                                 06510000
065200                  EXEC SQL                                        06520000
065300                       OPEN  PCT-MAPPING-CSR                      06530000
065400                  END-EXEC                                        06540000
065500                                                                  06550000
065600             WHEN XL091-SU-APP-ID                                 06560000
065700                  EXEC SQL                                        06570000
065800                       OPEN  SUT-MAPPING-CSR                      06580000
065900                  END-EXEC                                        06590000
066000                                                                  06600000
066100         END-EVALUATE                                             06610000
066200                                                                  06620000
066300         EVALUATE TRUE                                            06630000
066400             WHEN SQLCODE = ZERO                                  06640000
066500                  CONTINUE                                        06650000
066600                                                                  06660000
066700             WHEN SQLCODE = -904                                  06670000
066800             WHEN SQLCODE = -913                                  06680000
066900             WHEN SQLCODE = -911                                  06690000
067000                                                                  06700000
067100             WHEN SQLCODE = +100                                  06710000
067200                  MOVE 0 TO PV-ASSOCIATE-COUNT                    06720000
067300                                                                  06730000
067400             WHEN SQLWARN0 NOT = SPACES                           06740000
067500             WHEN SQLCODE NOT = ZERO                              06750000
067600                  MOVE +4             TO PV-RETRY-COUNTER         06760000
067700         END-EVALUATE                                             06770000
067800     END-PERFORM.                                                 06780000
067900                                                                  06790000
068000     IF SQLCODE = ZERO OR                                         06800000
068100        SQLCODE = +100                                            06810000
068200        CONTINUE                                                  06820000
068300     ELSE                                                         06830000
068400        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      06840000
068500           SET XL091-SQL-ERROR TO TRUE                            06850000
068600           MOVE SQLCODE        TO XL091-EAI-DB-SQLCODE            06860000
068700           MOVE '4200-'        TO XL091-SQL-ERROR-PARA            06870000
068800           MOVE SQLCA          TO XL091-SQLCA                     06880000
068900        END-IF                                                    06890000
069000     END-IF.                                                      06900000
069100                                                                  06910000
069200****************************************************************  06920000
069300*                                                              *  06930000
069400*                                                              *  06940000
069500****************************************************************  06950000
069600                                                                  06960000
069700 4400-FETCH-MAPPING-DATA.                                         06970000
069800                                                                  06980000
069900     PERFORM                                                      06990000
070000         WITH TEST AFTER                                          07000000
070100         VARYING PV-RETRY-COUNTER                                 07010000
070200         FROM 1 BY 1                                              07020000
070300         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07030000
070400            OR SQLCODE = ZERO                                     07040000
070500            OR SQLCODE = +100                                     07050000
070600                                                                  07060000
070700         EVALUATE TRUE                                            07070000
070800             WHEN XL091-PC-APP-ID                                 07080000
070900                  EXEC SQL                                        07090000
071000                      FETCH  PCT-MAPPING-CSR                      07100000
071100                                                                  07110000
071200                       INTO  :PCT00010-EVNT-OBJ-TXT               07120000
071300                            ,:PCT00010-EVNT-OBJ-ACTN-TXT          07130000
071400                            ,:PCT00010-EVNT-KY-TXT                07140000
071500                            ,:PCT00010-ATTR-DESC                  07150000
071600                            ,:PCT00010-CRE-TMST                   07160000
071700                            ,:PCT00010-CRE-BY-USR-ID              07170000
071800                                                                  07180000
071900                  END-EXEC                                        07190000
072000                                                                  07200000
072100             WHEN XL091-SU-APP-ID                                 07210000
072200                  EXEC SQL                                        07220000
072300                      FETCH  SUT-MAPPING-CSR                      07230000
072400                                                                  07240000
072500                       INTO  :SUT00036-EVNT-OBJ-TXT               07250000
072600                            ,:SUT00036-EVNT-OBJ-ACTN-TXT          07260000
072700                            ,:SUT00036-EVNT-KY-TXT                07270000
072800                            ,:SUT00036-ATTR-DESC                  07280000
072900                            ,:SUT00036-CRE-TMST                   07290000
073000                            ,:SUT00036-CRE-BY-USR-ID              07300000
073100                                                                  07310000
073200                  END-EXEC                                        07320000
073300                                                                  07330000
073400         END-EVALUATE                                             07340000
073500                                                                  07350000
073600         EVALUATE TRUE                                            07360000
073700             WHEN SQLCODE = ZERO                                  07370000
073800**??              PERFORM 4800-INTERPRET-MAPPING                  07380000
073900                                                                  07390000
074000                                                                  07400000
074100             WHEN SQLCODE = -904                                  07410000
074200             WHEN SQLCODE = -911                                  07420000
074300             WHEN SQLCODE = -913                                  07430000
074400                  CONTINUE                                        07440000
074500                                                                  07450000
074600             WHEN SQLCODE = +100                                  07460000
074700                  SET PS-END-OF-CURSOR TO TRUE                    07470000
074800**??              PERFORM 4800-INTERPRET-MAPPING                  07480000
074900                                                                  07490000
075000             WHEN SQLWARN0 NOT = SPACES                           07500000
075100             WHEN SQLCODE NOT = ZERO                              07510000
075200                  MOVE +4             TO PV-RETRY-COUNTER         07520000
075300         END-EVALUATE                                             07530000
075400     END-PERFORM.                                                 07540000
075500                                                                  07550000
075600     IF SQLCODE = ZERO OR                                         07560000
075700        SQLCODE = +100                                            07570000
075800        CONTINUE                                                  07580000
075900     ELSE                                                         07590000
076000        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      07600000
076100           MOVE SQLCODE TO XL091-EAI-DB-SQLCODE                   07610000
076200           SET XL091-SQL-ERROR      TO TRUE                       07620000
076300           MOVE '4400-'        TO XL091-SQL-ERROR-PARA            07630000
076400           MOVE SQLCA          TO XL091-SQLCA                     07640000
076500        END-IF                                                    07650000
076600     END-IF.                                                      07660000
076700                                                                  07670000
076800****************************************************************  07680000
076900*                                                              *  07690000
077000*                                                              *  07700000
077100****************************************************************  07710000
077200                                                                  07720000
077300 4600-CLOSE-MAPPING-CURSOR.                                       07730000
077400                                                                  07740000
077500     PERFORM                                                      07750000
077600         WITH TEST AFTER                                          07760000
077700         VARYING PV-RETRY-COUNTER                                 07770000
077800         FROM 1 BY 1                                              07780000
077900         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07790000
078000            OR SQLCODE = ZERO                                     07800000
078100            OR SQLCODE = +100                                     07810000
078200                                                                  07820000
078300         EVALUATE TRUE                                            07830000
078400             WHEN XL091-PC-APP-ID                                 07840000
078500                  EXEC SQL                                        07850000
078600                       CLOSE PCT-MAPPING-CSR                      07860000
078700                  END-EXEC                                        07870000
078800                                                                  07880000
078900             WHEN XL091-SU-APP-ID                                 07890000
079000                  EXEC SQL                                        07900000
079100                       CLOSE SUT-MAPPING-CSR                      07910000
079200                  END-EXEC                                        07920000
079300                                                                  07930000
079400         END-EVALUATE                                             07940000
079500                                                                  07950000
079600         EVALUATE TRUE                                            07960000
079700             WHEN SQLCODE = ZERO                                  07970000
079800                  CONTINUE                                        07980000
079900                                                                  07990000
080000             WHEN SQLCODE = -904                                  08000000
080100             WHEN SQLCODE = -913                                  08010000
080200             WHEN SQLCODE = -911                                  08020000
080300                                                                  08030000
080400             WHEN SQLCODE = +100                                  08040000
080500                  MOVE 0 TO PV-ASSOCIATE-COUNT                    08050000
080600                                                                  08060000
080700             WHEN SQLWARN0 NOT = SPACES                           08070000
080800             WHEN SQLCODE NOT = ZERO                              08080000
080900                  MOVE +4             TO PV-RETRY-COUNTER         08090000
081000         END-EVALUATE                                             08100000
081100     END-PERFORM.                                                 08110000
081200                                                                  08120000
081300     IF SQLCODE = ZERO OR                                         08130000
081400        SQLCODE = +100                                            08140000
081500        CONTINUE                                                  08150000
081600     ELSE                                                         08160000
081700        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      08170000
081800           SET XL091-SQL-ERROR TO TRUE                            08180000
081900           MOVE SQLCODE        TO XL091-EAI-DB-SQLCODE            08190000
082000           MOVE '4600-'        TO XL091-SQL-ERROR-PARA            08200000
082100           MOVE SQLCA          TO XL091-SQLCA                     08210000
082200        END-IF                                                    08220000
082300     END-IF.                                                      08230000
082400                                                                  08240000
082500****************************************************************  08250000
082600*    ROUTINE COMPARES THE MAPPING KEY TXT VALUE FROM THE       *  08260000
082700*    PCT00010 OR SUT00037 TABLE TO WHETHER A VALUE WAS PASSED  *  08270000
082800*    IN THE COMMAREA FROM THE CALLING PROGRAM.                 *  08280000
082900*                                                              *  08290000
083000*    FOR EXAMPLE, IF THE CALLING PROGRAM FILLS IN A VALUE FOR  *  08300000
083100*        XL091-EVNT-KY-1-NBR                                   *  08310000
083200*        XL091-EVNT-KY-1-TMST                                  *  08320000
083300*        XL091-EVNT-KY-2-NBR    AND                            *  08330000
083400*        THE PCT00010 TABLE HAS ROWS CONTAINING THE FOLLOWING  *  08340000
083500*            VALUES IN THE EVNT_KY_TXT COLUMN.                 *  08350000
083600*              EVNT-KY-1-NBR                                   *  08360000
083700*              EVNT-KY-1-TXT                                   *  08370000
083800*              EVNT-KY-2-NBR                                   *  08380000
083900*            THERE IS AN ERROR ON THE INPUT BECAUSE THE        *  08390000
084000*                  XL091-EVNT-KY-1-TXT  WASN'T FILLED IN AND   *  08400000
084100*                  IS REQUIRED.                                *  08410000
084200*            THERE ALSO IS AN ERROR BECAUSE THE                *  08420000
084300*                  XL091-EVNT-KY-1-TMST WAS FILLED IN AND      *  08430000
084400*                  SHOULD NOT HAVE BEEN.                       *  08440000
084500*                                                              *  08450000
084600****************************************************************  08460000
084700                                                                  08470000
084800 4800-INTERPRET-MAPPING.                                          08480000
084900                                                                  08490000
085000     IF PV-TABLE-KEY-VALUE (PV-TABLE-SUB) = ALL '9'               08500000
085100        CONTINUE                                                  08510000
085200     ELSE                                                         08520000
085300        ADD 1 TO PV-TABLE-SUB                                     08530000
085400        IF PV-TABLE-KEY-VALUE (PV-TABLE-SUB) = SPACES             08540000
085500           MOVE ALL '9' TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB)      08550000
085600        END-IF                                                    08560000
085700     END-IF.                                                      08570000
085800                                                                  08580000
085900     IF XL091-PC-APP-ID                                           08590000
086000        IF PS-END-OF-CURSOR                                       08600000
086100           MOVE ALL '9' TO  PCT00010-EVNT-KY-TXT                  08610000
086200        END-IF                                                    08620000
086300        EVALUATE TRUE                                             08630000
086400            WHEN PCT00010-EVNT-KY-TXT = PV-TABLE-KEY-VALUE        08640000
086500                                              (PV-TABLE-SUB)      08650000
086600                                                                  08660000
086700                 SET PS-KEYS-MATCH TO TRUE                        08670000
086800                                                                  08680000
086900            WHEN PCT00010-EVNT-KY-TXT > PV-TABLE-KEY-VALUE        08690000
087000                                              (PV-TABLE-SUB)      08700000
087100                 SET PS-KEYS-DONT-MATCH TO TRUE                   08710000
087200                 SET PS-EXTRA-INPUT     TO TRUE                   08720000
087300                 MOVE PV-TABLE-KEY-VALUE (PV-TABLE-SUB) TO        08730000
087400                                               PV-EVNT-KEY-TXT    08740000
087500                                                                  08750000
087600            WHEN PCT00010-EVNT-KY-TXT < PV-TABLE-KEY-VALUE        08760000
087700                                              (PV-TABLE-SUB)      08770000
087800                 SET PS-KEYS-DONT-MATCH TO TRUE                   08780000
087900                 SET PS-REQUIRED-ERROR  TO TRUE                   08790000
088000                 MOVE PCT00010-EVNT-KY-TXT TO PV-EVNT-KEY-TXT     08800000
088100                                                                  08810000
088200        END-EVALUATE                                              08820000
088300                                                                  08830000
088400     ELSE                                                         08840000
088500        IF PS-END-OF-CURSOR                                       08850000
088600           MOVE ALL '9' TO  SUT00036-EVNT-KY-TXT                  08860000
088700        END-IF                                                    08870000
088800        EVALUATE TRUE                                             08880000
088900            WHEN SUT00036-EVNT-KY-TXT = PV-TABLE-KEY-VALUE        08890000
089000                                              (PV-TABLE-SUB)      08900000
089100                 SET PS-KEYS-MATCH TO TRUE                        08910000
089200                                                                  08920000
089300            WHEN SUT00036-EVNT-KY-TXT > PV-TABLE-KEY-VALUE        08930000
089400                                              (PV-TABLE-SUB)      08940000
089500                 SET PS-KEYS-DONT-MATCH TO TRUE                   08950000
089600                 SET PS-EXTRA-INPUT     TO TRUE                   08960000
089700                 MOVE PV-TABLE-KEY-VALUE (PV-TABLE-SUB) TO        08970000
089800                                               PV-EVNT-KEY-TXT    08980000
089900                                                                  08990000
090000            WHEN SUT00036-EVNT-KY-TXT < PV-TABLE-KEY-VALUE        09000000
090100                                              (PV-TABLE-SUB)      09010000
090200**??             SET PS-KEYS-DONT-MATCH TO TRUE                   09020000
090300**??             SET PS-REQUIRED-ERROR  TO TRUE                   09030000
090400                 MOVE SUT00036-EVNT-KY-TXT TO PV-EVNT-KEY-TXT     09040000
090500                                                                  09050000
090600        END-EVALUATE                                              09060000
090700                                                                  09070000
090800     END-IF.                                                      09080000
090900                                                                  09090000
091000****************************************************************  09100000
091100*    IF A FIELD IN THE COMMAREA IS ENTERED AND NOT REQUIRED    *  09110000
091200*       OR A FIELD IN THE COMMARA ISN'T ENTERED AND IS         *  09120000
091300*       REQUIRED, THE PS-KEYS-DONT-MATCH SWITCH IS SET.        *  09130000
091400*                                                              *  09140000
091500*       THE PV-EVNT-KEY-TXT FIELD CONTAINS THE FIELD THAT IS   *  09150000
091600*       ERROR (EVNT_KY_1_NBR, EVNT_KY_1_TXT, OR EVNT_KY_1_TMST *  09160000
091700*       THIS FIELD IS THEN INTERPRETED TO SET THE APPROPRIATE  *  09170000
091800*       ERROR CODE.                                            *  09180000
091900*                                                              *  09190000
092000****************************************************************  09200000
092100                                                                  09210000
092200     IF PS-KEYS-DONT-MATCH                                        09220000
092300        EVALUATE TRUE                                             09230000
092400            WHEN PV-EVNT-KEY-TXT (11:4) = 'NBR '                  09240000
092500                 EVALUATE TRUE                                    09250000
092600                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'             09260000
092700                          IF PS-REQUIRED-ERROR                    09270000
092800                             SET XL091-KY1-NBR-REQD  TO TRUE      09280000
092900                          ELSE                                    09290000
093000                             SET XL091-KY1-NBR-INVALID TO TRUE    09300000
093100                          END-IF                                  09310000
093200                                                                  09320000
093300                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'             09330000
093400                          IF PS-REQUIRED-ERROR                    09340000
093500                             SET XL091-KY2-NBR-REQD  TO TRUE      09350000
093600                          ELSE                                    09360000
093700                             SET XL091-KY2-NBR-INVALID TO TRUE    09370000
093800                          END-IF                                  09380000
093900                                                                  09390000
094000                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'             09400000
094100                          IF PS-REQUIRED-ERROR                    09410000
094200                             SET XL091-KY3-NBR-REQD  TO TRUE      09420000
094300                          ELSE                                    09430000
094400                             SET XL091-KY3-NBR-INVALID TO TRUE    09440000
094500                          END-IF                                  09450000
094600                                                                  09460000
094700                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'             09470000
094800                          IF PS-REQUIRED-ERROR                    09480000
094900                             SET XL091-KY4-NBR-REQD  TO TRUE      09490000
095000                          ELSE                                    09500000
095100                             SET XL091-KY4-NBR-INVALID TO TRUE    09510000
095200                          END-IF                                  09520000
095300                                                                  09530000
095400                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'             09540000
095500                          IF PS-REQUIRED-ERROR                    09550000
095600                             SET XL091-KY5-NBR-REQD  TO TRUE      09560000
095700                          ELSE                                    09570000
095800                             SET XL091-KY5-NBR-INVALID TO TRUE    09580000
095900                          END-IF                                  09590000
096000                                                                  09600000
096100                     WHEN OTHER                                   09610000
096200                          SET XL091-INVALID-KEY-VALUE TO TRUE     09620000
096300                                                                  09630000
096400                 END-EVALUATE                                     09640000
096500                                                                  09650000
096600            WHEN PV-EVNT-KEY-TXT (11:4) = 'TMST'                  09660000
096700                 EVALUATE TRUE                                    09670000
096800                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'             09680000
096900                          IF PS-REQUIRED-ERROR                    09690000
097000                             SET XL091-KY1-TMST-REQD TO TRUE      09700000
097100                          ELSE                                    09710000
097200                             SET XL091-KY1-TMST-INVALID TO TRUE   09720000
097300                          END-IF                                  09730000
097400                                                                  09740000
097500                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'             09750000
097600                          IF PS-REQUIRED-ERROR                    09760000
097700                             SET XL091-KY2-TMST-REQD TO TRUE      09770000
097800                          ELSE                                    09780000
097900                             SET XL091-KY2-TMST-INVALID TO TRUE   09790000
098000                          END-IF                                  09800000
098100                                                                  09810000
098200                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'             09820000
098300                          IF PS-REQUIRED-ERROR                    09830000
098400                             SET XL091-KY3-TMST-REQD TO TRUE      09840000
098500                          ELSE                                    09850000
098600                             SET XL091-KY3-TMST-INVALID TO TRUE   09860000
098700                          END-IF                                  09870000
098800                                                                  09880000
098900                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'             09890000
099000                          IF PS-REQUIRED-ERROR                    09900000
099100                             SET XL091-KY4-TMST-REQD TO TRUE      09910000
099200                          ELSE                                    09920000
099300                             SET XL091-KY4-TMST-INVALID TO TRUE   09930000
099400                          END-IF                                  09940000
099500                                                                  09950000
099600                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'             09960000
099700                          IF PS-REQUIRED-ERROR                    09970000
099800                             SET XL091-KY5-TMST-REQD TO TRUE      09980000
099900                          ELSE                                    09990000
100000                             SET XL091-KY5-TMST-INVALID TO TRUE   10000000
100100                          END-IF                                  10010000
100200                                                                  10020000
100300                     WHEN OTHER                                   10030000
100400                          SET XL091-INVALID-KEY-VALUE TO TRUE     10040000
100500                                                                  10050000
100600                 END-EVALUATE                                     10060000
100700                                                                  10070000
100800            WHEN PV-EVNT-KEY-TXT (11:4) = 'TXT '                  10080000
100900                 EVALUATE TRUE                                    10090000
101000                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'             10100000
101100                          IF PS-REQUIRED-ERROR                    10110000
101200                             SET XL091-KY1-TXT-REQD TO TRUE       10120000
101300                          ELSE                                    10130000
101400                             SET XL091-KY1-TXT-INVALID TO TRUE    10140000
101500                          END-IF                                  10150000
101600                                                                  10160000
101700                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'             10170000
101800                          IF PS-REQUIRED-ERROR                    10180000
101900                             SET XL091-KY2-TXT-REQD TO TRUE       10190000
102000                          ELSE                                    10200000
102100                             SET XL091-KY2-TXT-INVALID TO TRUE    10210000
102200                          END-IF                                  10220000
102300                                                                  10230000
102400                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'             10240000
102500                          IF PS-REQUIRED-ERROR                    10250000
102600                             SET XL091-KY3-TXT-REQD TO TRUE       10260000
102700                          ELSE                                    10270000
102800                             SET XL091-KY3-TXT-INVALID TO TRUE    10280000
102900                          END-IF                                  10290000
103000                                                                  10300000
103100                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'             10310000
103200                          IF PS-REQUIRED-ERROR                    10320000
103300                             SET XL091-KY4-TXT-REQD TO TRUE       10330000
103400                          ELSE                                    10340000
103500                             SET XL091-KY4-TXT-INVALID TO TRUE    10350000
103600                          END-IF                                  10360000
103700                                                                  10370000
103800                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'             10380000
103900                          IF PS-REQUIRED-ERROR                    10390000
104000                             SET XL091-KY5-TXT-REQD TO TRUE       10400000
104100                          ELSE                                    10410000
104200                             SET XL091-KY5-TXT-INVALID TO TRUE    10420000
104300                          END-IF                                  10430000
104400                                                                  10440000
104500                     WHEN OTHER                                   10450000
104600                          SET XL091-INVALID-KEY-VALUE TO TRUE     10460000
104700                                                                  10470000
104800                 END-EVALUATE                                     10480000
104900                                                                  10490000
105000            WHEN OTHER                                            10500000
105100                 SET XL091-INVALID-KEY-VALUE TO TRUE              10510000
105200     END-EVALUATE.                                                10520000
105300                                                                  10530000
105400     IF XL091-SUCCESSFUL                                          10540000
105500        CONTINUE                                                  10550000
105600     ELSE                                                         10560000
105700        SET PS-END-OF-CURSOR TO TRUE                              10570000
105800     END-IF.                                                      10580000
105900                                                                  10590000
106000****************************************************************  10600000
106100*                                                              *  10610000
106200*                                                              *  10620000
106300****************************************************************  10630000
106400                                                                  10640000
106500 5100-FORMAT-EVNT-EXPRT.                                          10650000
106600                                                                  10660000
106700     EVALUATE TRUE                                                10670000
106800         WHEN XL091-PC-APP-ID                                     10680000
106900              INITIALIZE DCLPCT00011                              10690000
107000              MOVE PV-EVNT-OBJ-TXT      TO PCT00011-EVNT-OBJ-TXT  10700000
107100              MOVE PV-EVNT-OBJ-ACTN-TXT TO                        10710000
107200                               PCT00011-EVNT-OBJ-ACTN-TXT         10720000
107300              MOVE PV-CURRENT-TIMESTAMP TO PCT00011-CRE-TMST      10730000
107400                                                                  10740000
107500              MOVE XL091-CRE-BY-USR-ID  TO PCT00011-CRE-BY-USR-ID 10750000
107600              MOVE XL091-CRE-PGM-NM     TO PCT00011-CRE-BY-PGM-NM 10760000
107700                                                                  10770000
107800              PERFORM 5150-FORMAT-NULL-COLUMNS                    10780000
107900              IF PCT00011-EVNT-OBJ-TXT = 'SHIPPING'               10790000
108010               IF (PCT00011-EVNT-OBJ-ACTN-TXT =                   10801002
108020                        'DOOR SUMMARY'                OR          10802002
108030                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10803002
108040                        'ADD MASTER'                  OR          10804002
108050                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10805002
108060                        'ADD CHILD TO MASTER'         OR          10806002
108070                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10807002
108080                        'ADD MASTER TO MASTER'        OR          10808002
108090                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10809002
108091                        'REMOVE CHILD FROM MASTER'    OR          10809102
108092                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10809202
108093                        'REMOVE MASTER FROM MASTER'   OR          10809302
108094                  PCT00011-EVNT-OBJ-ACTN-TXT =                    10809402
108095                        'REASSIGN TO MASTER')                     10809502
108100                    MOVE PC-C TO PCT00011-EXPRT-STAT-CDE          10810000
108200                 ELSE                                             10820000
108300                    MOVE PC-X TO PCT00011-EXPRT-STAT-CDE          10830000
108400               END-IF                                             10840002
108500              ELSE                                                10850000
108600                 MOVE PC-C TO PCT00011-EXPRT-STAT-CDE             10860000
108700              END-IF                                              10870000
108800              MOVE PV-CURRENT-TIMESTAMP TO PCT00011-LAST-UPD-TMST 10880000
108900                                                                  10890000
109000         WHEN XL091-SU-APP-ID                                     10900000
109100              INITIALIZE DCLSUT00037                              10910000
109200                                                                  10920000
109300              MOVE PV-EVNT-OBJ-TXT TO SUT00037-EVNT-OBJ-TXT       10930000
109400              MOVE PV-EVNT-OBJ-ACTN-TXT TO                        10940000
109500                               SUT00037-EVNT-OBJ-ACTN-TXT         10950000
109600              MOVE PV-CURRENT-TIMESTAMP TO SUT00037-CRE-TMST      10960000
109700                                                                  10970000
109800              MOVE XL091-CRE-BY-USR-ID  TO SUT00037-CRE-BY-USR-ID 10980000
109900              MOVE XL091-CRE-PGM-NM     TO SUT00037-CRE-BY-PGM-NM 10990000
110000                                                                  11000000
110100              PERFORM 5150-FORMAT-NULL-COLUMNS                    11010000
110200                                                                  11020000
110300              MOVE PC-C          TO SUT00037-EXPRT-STAT-CDE       11030000
110400              MOVE PV-CURRENT-TIMESTAMP TO SUT00037-LAST-UPD-TMST 11040000
110500                                                                  11050000
110600     END-EVALUATE.                                                11060000
110700                                                                  11070000
110800                                                                  11080000
110900 5150-FORMAT-NULL-COLUMNS.                                        11090000
111000                                                                  11100000
111100     IF XL091-REF-ID = SPACES                                     11110000
111200        MOVE PV-NULL TO PV-REF-ID-NULL                            11120000
111300     ELSE                                                         11130000
111400        MOVE 0 TO PV-REF-ID-NULL                                  11140000
111500        MOVE XL091-REF-ID TO PCT00011-REF-ID                      11150000
111600        MOVE XL091-REF-ID TO SUT00037-REF-ID.                     11160000
111700                                                                  11170000
111800     IF XL091-EVNT-KY-1-NBR = 0                                   11180000
111900        MOVE PV-NULL TO PV-EVNT-KY-1-NBR-NULL                     11190000
112000     ELSE                                                         11200000
112100        MOVE 0 TO PV-EVNT-KY-1-NBR-NULL                           11210000
112200        MOVE XL091-EVNT-KY-1-NBR TO PCT00011-EVNT-KY-1-NBR        11220000
112300        MOVE XL091-EVNT-KY-1-NBR TO SUT00037-EVNT-KY-1-NBR.       11230000
112400                                                                  11240000
112500     IF XL091-EVNT-KY-2-NBR = 0                                   11250000
112600        MOVE PV-NULL TO PV-EVNT-KY-2-NBR-NULL                     11260000
112700     ELSE                                                         11270000
112800        MOVE 0 TO PV-EVNT-KY-2-NBR-NULL                           11280000
112900        MOVE XL091-EVNT-KY-2-NBR TO PCT00011-EVNT-KY-2-NBR        11290000
113000        MOVE XL091-EVNT-KY-2-NBR TO SUT00037-EVNT-KY-2-NBR.       11300000
113100                                                                  11310000
113200     IF XL091-EVNT-KY-3-NBR = 0                                   11320000
113300        MOVE PV-NULL TO PV-EVNT-KY-3-NBR-NULL                     11330000
113400     ELSE                                                         11340000
113500        MOVE 0 TO PV-EVNT-KY-3-NBR-NULL                           11350000
113600        MOVE XL091-EVNT-KY-3-NBR TO PCT00011-EVNT-KY-3-NBR        11360000
113700        MOVE XL091-EVNT-KY-3-NBR TO SUT00037-EVNT-KY-3-NBR.       11370000
113800                                                                  11380000
113900     IF XL091-EVNT-KY-4-NBR = 0                                   11390000
114000        MOVE PV-NULL TO PV-EVNT-KY-4-NBR-NULL                     11400000
114100     ELSE                                                         11410000
114200        MOVE 0 TO PV-EVNT-KY-4-NBR-NULL                           11420000
114300        MOVE XL091-EVNT-KY-4-NBR TO PCT00011-EVNT-KY-4-NBR        11430000
114400        MOVE XL091-EVNT-KY-4-NBR TO SUT00037-EVNT-KY-4-NBR.       11440000
114500                                                                  11450000
114600     IF XL091-EVNT-KY-5-NBR = 0                                   11460000
114700        MOVE PV-NULL TO PV-EVNT-KY-5-NBR-NULL                     11470000
114800     ELSE                                                         11480000
114900        MOVE 0 TO PV-EVNT-KY-5-NBR-NULL                           11490000
115000        MOVE XL091-EVNT-KY-5-NBR TO PCT00011-EVNT-KY-5-NBR        11500000
115100        MOVE XL091-EVNT-KY-5-NBR TO SUT00037-EVNT-KY-5-NBR.       11510000
115200                                                                  11520000
115300     IF XL091-EVNT-KY-1-TXT = SPACES                              11530000
115400        MOVE PV-NULL TO PV-EVNT-KY-1-TXT-NULL                     11540000
115500     ELSE                                                         11550000
115600        MOVE 0 TO PV-EVNT-KY-1-TXT-NULL                           11560000
115700        MOVE XL091-EVNT-KY-1-TXT TO PCT00011-EVNT-KY-1-TXT        11570000
115800        MOVE XL091-EVNT-KY-1-TXT TO SUT00037-EVNT-KY-1-TXT.       11580000
115900                                                                  11590000
116000     IF XL091-EVNT-KY-2-TXT = SPACES                              11600000
116100        MOVE PV-NULL TO PV-EVNT-KY-2-TXT-NULL                     11610000
116200     ELSE                                                         11620000
116300        MOVE 0 TO PV-EVNT-KY-2-TXT-NULL                           11630000
116400        MOVE XL091-EVNT-KY-2-TXT TO PCT00011-EVNT-KY-2-TXT        11640000
116500        MOVE XL091-EVNT-KY-2-TXT TO SUT00037-EVNT-KY-2-TXT.       11650000
116600                                                                  11660000
116700     IF XL091-EVNT-KY-3-TXT = SPACES                              11670000
116800        MOVE PV-NULL TO PV-EVNT-KY-3-TXT-NULL                     11680000
116900     ELSE                                                         11690000
117000        MOVE 0 TO PV-EVNT-KY-3-TXT-NULL                           11700000
117100        MOVE XL091-EVNT-KY-3-TXT TO PCT00011-EVNT-KY-3-TXT        11710000
117200        MOVE XL091-EVNT-KY-3-TXT TO SUT00037-EVNT-KY-3-TXT.       11720000
117300                                                                  11730000
117400     IF XL091-EVNT-KY-4-TXT = SPACES                              11740000
117500        MOVE PV-NULL TO PV-EVNT-KY-4-TXT-NULL                     11750000
117600     ELSE                                                         11760000
117700        MOVE 0 TO PV-EVNT-KY-4-TXT-NULL                           11770000
117800        MOVE XL091-EVNT-KY-4-TXT TO PCT00011-EVNT-KY-4-TXT        11780000
117900        MOVE XL091-EVNT-KY-4-TXT TO SUT00037-EVNT-KY-4-TXT.       11790000
118000                                                                  11800000
118100     IF XL091-EVNT-KY-5-TXT = SPACES                              11810000
118200        MOVE PV-NULL TO PV-EVNT-KY-5-TXT-NULL                     11820000
118300     ELSE                                                         11830000
118400        MOVE 0 TO PV-EVNT-KY-5-TXT-NULL                           11840000
118500        MOVE XL091-EVNT-KY-5-TXT TO PCT00011-EVNT-KY-5-TXT        11850000
118600        MOVE XL091-EVNT-KY-5-TXT TO SUT00037-EVNT-KY-5-TXT.       11860000
118700                                                                  11870000
118800     IF XL091-EVNT-KY-1-TMST = SPACES                             11880000
118900        MOVE PV-NULL TO PV-EVNT-KY-1-TMST-NULL                    11890000
119000     ELSE                                                         11900000
119100        MOVE 0 TO PV-EVNT-KY-1-TMST-NULL                          11910000
119200        MOVE XL091-EVNT-KY-1-TMST TO PCT00011-EVNT-KY-1-TMST      11920000
119300        MOVE XL091-EVNT-KY-1-TMST TO SUT00037-EVNT-KY-1-TMST.     11930000
119400                                                                  11940000
119500     IF XL091-EVNT-KY-2-TMST = SPACES                             11950000
119600        MOVE PV-NULL TO PV-EVNT-KY-2-TMST-NULL                    11960000
119700     ELSE                                                         11970000
119800        MOVE 0 TO PV-EVNT-KY-2-TMST-NULL                          11980000
119900        MOVE XL091-EVNT-KY-2-TMST TO PCT00011-EVNT-KY-2-TMST      11990000
120000        MOVE XL091-EVNT-KY-2-TMST TO SUT00037-EVNT-KY-2-TMST.     12000000
120100                                                                  12010000
120200     IF XL091-EVNT-KY-3-TMST = SPACES                             12020000
120300        MOVE PV-NULL TO PV-EVNT-KY-3-TMST-NULL                    12030000
120400     ELSE                                                         12040000
120500        MOVE 0 TO PV-EVNT-KY-3-TMST-NULL                          12050000
120600        MOVE XL091-EVNT-KY-3-TMST TO PCT00011-EVNT-KY-3-TMST      12060000
120700        MOVE XL091-EVNT-KY-3-TMST TO SUT00037-EVNT-KY-3-TMST.     12070000
120800                                                                  12080000
120900     IF XL091-EVNT-KY-4-TMST = SPACES                             12090000
121000        MOVE PV-NULL TO PV-EVNT-KY-4-TMST-NULL                    12100000
121100     ELSE                                                         12110000
121200        MOVE 0 TO PV-EVNT-KY-4-TMST-NULL                          12120000
121300        MOVE XL091-EVNT-KY-4-TMST TO PCT00011-EVNT-KY-4-TMST      12130000
121400        MOVE XL091-EVNT-KY-4-TMST TO SUT00037-EVNT-KY-4-TMST.     12140000
121500                                                                  12150000
121600     IF XL091-EVNT-KY-5-TMST = SPACES                             12160000
121700        MOVE PV-NULL TO PV-EVNT-KY-5-TMST-NULL                    12170000
121800     ELSE                                                         12180000
121900        MOVE 0 TO PV-EVNT-KY-5-TMST-NULL                          12190000
122000        MOVE XL091-EVNT-KY-5-TMST TO PCT00011-EVNT-KY-5-TMST      12200000
122100        MOVE XL091-EVNT-KY-5-TMST TO SUT00037-EVNT-KY-5-TMST.     12210000
122200                                                                  12220000
122300                                                                  12230000
122400 5200-INSERT-EXPORT-TABLE.                                        12240000
122500                                                                  12250000
122600     PERFORM                                                      12260000
122700         WITH TEST AFTER                                          12270000
122800         VARYING PV-RETRY-COUNTER                                 12280000
122900         FROM 1 BY 1                                              12290000
123000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  12300000
123100            OR SQLCODE = ZERO                                     12310000
123200                                                                  12320000
123300         EVALUATE TRUE                                            12330000
123400             WHEN XL091-PC-APP-ID                                 12340000
123500                  EXEC SQL                                        12350000
123600                     INSERT INTO PCT_BUS_EVNT_EXPRT               12360000
123700                           (EVNT_OBJ_TXT                          12370000
123800                           ,EVNT_OBJ_ACTN_TXT                     12380000
123900                           ,CRE_TMST                              12390000
124000                           ,CRE_BY_USR_ID                         12400000
124100                           ,CRE_BY_PGM_NM                         12410000
124200                           ,REF_ID                                12420000
124300                           ,EVNT_KY_1_NBR                         12430000
124400                           ,EVNT_KY_2_NBR                         12440000
124500                           ,EVNT_KY_3_NBR                         12450000
124600                           ,EVNT_KY_4_NBR                         12460000
124700                           ,EVNT_KY_5_NBR                         12470000
124800                           ,EVNT_KY_1_TXT                         12480000
124900                           ,EVNT_KY_2_TXT                         12490000
125000                           ,EVNT_KY_3_TXT                         12500000
125100                           ,EVNT_KY_4_TXT                         12510000
125200                           ,EVNT_KY_5_TXT                         12520000
125300                           ,EVNT_KY_1_TMST                        12530000
125400                           ,EVNT_KY_2_TMST                        12540000
125500                           ,EVNT_KY_3_TMST                        12550000
125600                           ,EVNT_KY_4_TMST                        12560000
125700                           ,EVNT_KY_5_TMST                        12570000
125800                           ,EXPRT_STAT_CDE                        12580000
125900                           ,LAST_UPD_TMST                         12590000
126000                           ,EVNT_PRTY_NBR)                        12600000
126100                                                                  12610000
126200                    VALUES (:PCT00011-EVNT-OBJ-TXT                12620000
126300                           ,:PCT00011-EVNT-OBJ-ACTN-TXT           12630000
126400                           ,:PCT00011-CRE-TMST                    12640000
126500                           ,:PCT00011-CRE-BY-USR-ID               12650000
126600                           ,:PCT00011-CRE-BY-PGM-NM               12660000
126700                           ,:PCT00011-REF-ID                      12670000
126800                                     :PV-REF-ID-NULL              12680000
126900                           ,:PCT00011-EVNT-KY-1-NBR               12690000
127000                                     :PV-EVNT-KY-1-NBR-NULL       12700000
127100                           ,:PCT00011-EVNT-KY-2-NBR               12710000
127200                                     :PV-EVNT-KY-2-NBR-NULL       12720000
127300                           ,:PCT00011-EVNT-KY-3-NBR               12730000
127400                                     :PV-EVNT-KY-3-NBR-NULL       12740000
127500                           ,:PCT00011-EVNT-KY-4-NBR               12750000
127600                                     :PV-EVNT-KY-4-NBR-NULL       12760000
127700                           ,:PCT00011-EVNT-KY-5-NBR               12770000
127800                                     :PV-EVNT-KY-5-NBR-NULL       12780000
127900                           ,:PCT00011-EVNT-KY-1-TXT               12790000
128000                                     :PV-EVNT-KY-1-TXT-NULL       12800000
128100                           ,:PCT00011-EVNT-KY-2-TXT               12810000
128200                                     :PV-EVNT-KY-2-TXT-NULL       12820000
128300                           ,:PCT00011-EVNT-KY-3-TXT               12830000
128400                                     :PV-EVNT-KY-3-TXT-NULL       12840000
128500                           ,:PCT00011-EVNT-KY-4-TXT               12850000
128600                                     :PV-EVNT-KY-4-TXT-NULL       12860000
128700                           ,:PCT00011-EVNT-KY-5-TXT               12870000
128800                                     :PV-EVNT-KY-5-TXT-NULL       12880000
128900                           ,:PCT00011-EVNT-KY-1-TMST              12890000
129000                                     :PV-EVNT-KY-1-TMST-NULL      12900000
129100                           ,:PCT00011-EVNT-KY-2-TMST              12910000
129200                                     :PV-EVNT-KY-2-TMST-NULL      12920000
129300                           ,:PCT00011-EVNT-KY-3-TMST              12930000
129400                                     :PV-EVNT-KY-3-TMST-NULL      12940000
129500                           ,:PCT00011-EVNT-KY-4-TMST              12950000
129600                                     :PV-EVNT-KY-4-TMST-NULL      12960000
129700                           ,:PCT00011-EVNT-KY-5-TMST              12970000
129800                                     :PV-EVNT-KY-5-TMST-NULL      12980000
129900                           ,:PCT00011-EXPRT-STAT-CDE              12990000
130000                           ,:PCT00011-LAST-UPD-TMST               13000000
130100                           ,:PCT00011-EVNT-PRTY-NBR)              13010000
130200                  END-EXEC                                        13020000
130300                                                                  13030000
130400             WHEN XL091-SU-APP-ID                                 13040000
130500                  EXEC SQL                                        13050000
130600                     INSERT INTO SUT_BUS_EVNT_EXPRT               13060000
130700                           (EVNT_OBJ_TXT                          13070000
130800                           ,EVNT_OBJ_ACTN_TXT                     13080000
130900                           ,CRE_TMST                              13090000
131000                           ,CRE_BY_USR_ID                         13100000
131100                           ,CRE_BY_PGM_NM                         13110000
131200                           ,REF_ID                                13120000
131300                           ,EVNT_KY_1_NBR                         13130000
131400                           ,EVNT_KY_2_NBR                         13140000
131500                           ,EVNT_KY_3_NBR                         13150000
131600                           ,EVNT_KY_4_NBR                         13160000
131700                           ,EVNT_KY_5_NBR                         13170000
131800                           ,EVNT_KY_1_TXT                         13180000
131900                           ,EVNT_KY_2_TXT                         13190000
132000                           ,EVNT_KY_3_TXT                         13200000
132100                           ,EVNT_KY_4_TXT                         13210000
132200                           ,EVNT_KY_5_TXT                         13220000
132300                           ,EVNT_KY_1_TMST                        13230000
132400                           ,EVNT_KY_2_TMST                        13240000
132500                           ,EVNT_KY_3_TMST                        13250000
132600                           ,EVNT_KY_4_TMST                        13260000
132700                           ,EVNT_KY_5_TMST                        13270000
132800                           ,EXPRT_STAT_CDE                        13280000
132900                           ,LAST_UPD_TMST                         13290000
133000                           ,EVNT_PRTY_NBR)                        13300000
133100                                                                  13310000
133200                    VALUES (:SUT00037-EVNT-OBJ-TXT                13320000
133300                           ,:SUT00037-EVNT-OBJ-ACTN-TXT           13330000
133400                           ,:SUT00037-CRE-TMST                    13340000
133500                           ,:SUT00037-CRE-BY-USR-ID               13350000
133600                           ,:SUT00037-CRE-BY-PGM-NM               13360000
133700                           ,:SUT00037-REF-ID                      13370000
133800                                     :PV-REF-ID-NULL              13380000
133900                           ,:SUT00037-EVNT-KY-1-NBR               13390000
134000                                     :PV-EVNT-KY-1-NBR-NULL       13400000
134100                           ,:SUT00037-EVNT-KY-2-NBR               13410000
134200                                     :PV-EVNT-KY-2-NBR-NULL       13420000
134300                           ,:SUT00037-EVNT-KY-3-NBR               13430000
134400                                     :PV-EVNT-KY-3-NBR-NULL       13440000
134500                           ,:SUT00037-EVNT-KY-4-NBR               13450000
134600                                     :PV-EVNT-KY-4-NBR-NULL       13460000
134700                           ,:SUT00037-EVNT-KY-5-NBR               13470000
134800                                     :PV-EVNT-KY-5-NBR-NULL       13480000
134900                           ,:SUT00037-EVNT-KY-1-TXT               13490000
135000                                     :PV-EVNT-KY-1-TXT-NULL       13500000
135100                           ,:SUT00037-EVNT-KY-2-TXT               13510000
135200                                     :PV-EVNT-KY-2-TXT-NULL       13520000
135300                           ,:SUT00037-EVNT-KY-3-TXT               13530000
135400                                     :PV-EVNT-KY-3-TXT-NULL       13540000
135500                           ,:SUT00037-EVNT-KY-4-TXT               13550000
135600                                     :PV-EVNT-KY-4-TXT-NULL       13560000
135700                           ,:SUT00037-EVNT-KY-5-TXT               13570000
135800                                     :PV-EVNT-KY-5-TXT-NULL       13580000
135900                           ,:SUT00037-EVNT-KY-1-TMST              13590000
136000                                     :PV-EVNT-KY-1-TMST-NULL      13600000
136100                           ,:SUT00037-EVNT-KY-2-TMST              13610000
136200                                     :PV-EVNT-KY-2-TMST-NULL      13620000
136300                           ,:SUT00037-EVNT-KY-3-TMST              13630000
136400                                     :PV-EVNT-KY-3-TMST-NULL      13640000
136500                           ,:SUT00037-EVNT-KY-4-TMST              13650000
136600                                     :PV-EVNT-KY-4-TMST-NULL      13660000
136700                           ,:SUT00037-EVNT-KY-5-TMST              13670000
136800                                     :PV-EVNT-KY-5-TMST-NULL      13680000
136900                           ,:SUT00037-EXPRT-STAT-CDE              13690000
137000                           ,:SUT00037-LAST-UPD-TMST               13700000
137100                           ,:SUT00037-EVNT-PRTY-NBR)              13710000
137200                                                                  13720000
137300                  END-EXEC                                        13730000
137400                                                                  13740000
137500         END-EVALUATE                                             13750000
137600                                                                  13760000
137700         EVALUATE TRUE                                            13770000
137800             WHEN SQLCODE = ZERO                                  13780000
137900                  EXEC SQL SET :PV-SET-SEQ-NBR =                  13790000
138000                                IDENTITY_VAL_LOCAL ()             13800000
138100                  END-EXEC                                        13810000
138200                                                                  13820000
138300                  IF SQLCODE = 0                                  13830000
138400                     CONTINUE                                     13840000
138500                  ELSE                                            13850000
138600                     SET XL091-SQL-ERROR      TO TRUE             13860000
138700                     MOVE SQLCODE TO XL091-EAI-DB-SQLCODE         13870000
138800                     MOVE '5200-'        TO XL091-SQL-ERROR-PARA  13880000
138900                     MOVE SQLCA          TO XL091-SQLCA           13890000
139000                  END-IF                                          13900000
139100                                                                  13910000
139200             WHEN SQLCODE = -904                                  13920000
139300             WHEN SQLCODE = -913                                  13930000
139400             WHEN SQLCODE = -911                                  13940000
139500                 CONTINUE                                         13950000
139600             WHEN SQLWARN0 NOT = SPACES                           13960000
139700             WHEN SQLCODE NOT = ZERO                              13970000
139800                  MOVE +4             TO PV-RETRY-COUNTER         13980000
139900                                                                  13990000
140000         END-EVALUATE                                             14000000
140100     END-PERFORM.                                                 14010000
140200                                                                  14020000
140300     IF SQLCODE = 0                                               14030000
140400        CONTINUE                                                  14040000
140500     ELSE                                                         14050000
140600        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      14060000
140700           SET XL091-SQL-ERROR      TO TRUE                       14070000
140800           MOVE SQLCODE TO XL091-EAI-DB-SQLCODE                   14080000
140900           MOVE '5200-'        TO XL091-SQL-ERROR-PARA            14090000
141000           MOVE SQLCA          TO XL091-SQLCA                     14100000
141100        END-IF                                                    14110000
141200     END-IF.                                                      14120000
141300                                                                  14130000
141400****************************************************************  14140000
141500*                                                              *  14150000
141600*                                                              *  14160000
141700*                                                              *  14170000
141800****************************************************************  14180000
141900                                                                  14190000
142000 5300-FORMAT-EVNT-DTL.                                            14200000
142100                                                                  14210000
142200     EVALUATE TRUE                                                14220000
142300         WHEN XL091-PC-APP-ID                                     14230000
142400              INITIALIZE DCLPCT00012                              14240000
142500              MOVE PV-SET-SEQ-NBR TO PCT00012-EVNT-EXPRT-ID       14250000
142600              MOVE 1 TO PCT00012-EVNT-DTL-SEQ-NBR                 14260000
142700*             MOVE 1000          TO PCT00012-DTL-TXT-LEN          14270000
142800              MOVE XL091-DTL-TXT (3:1000) TO                      14280000
142900                                         PCT00012-DTL-TXT-TEXT    14290000
143000*             FIND THE TRUE LENGTH OF THE STRING                  14300000
143100              INITIALIZE PV-TEXT                                  14310000
143200              MOVE PCT00012-DTL-TXT-TEXT  TO PV-TEXT              14320000
143300              PERFORM VARYING PV-TEXT-SUB FROM 4000 BY -1         14330000
143400                     UNTIL PV-TEXT-BYTE (PV-TEXT-SUB)             14340000
143500                           NOT = SPACE                            14350000
143600                 MOVE PV-TEXT-SUB         TO                      14360000
143700                                    PCT00012-DTL-TXT-LEN          14370000
143800              END-PERFORM                                         14380000
143900                                                                  14390000
144000         WHEN XL091-SU-APP-ID                                     14400000
144100              INITIALIZE DCLSUT00038                              14410000
144200              MOVE PV-SET-SEQ-NBR TO SUT00038-EVNT-EXPRT-ID       14420000
144300              MOVE 1 TO SUT00038-EVNT-DTL-SEQ-NBR                 14430000
144400*             MOVE 1000          TO SUT00038-DTL-TXT-LEN          14440000
144500              MOVE XL091-DTL-TXT (3:1000) TO                      14450000
144600                                    SUT00038-DTL-TXT-TEXT         14460000
144700*             FIND THE TRUE LENGTH OF THE STRING                  14470000
144800              INITIALIZE PV-TEXT                                  14480000
144900              MOVE SUT00038-DTL-TXT-TEXT  TO PV-TEXT              14490000
145000                                                                  14500000
145100              PERFORM VARYING PV-TEXT-SUB FROM 4000 BY -1         14510000
145200                     UNTIL PV-TEXT-BYTE (PV-TEXT-SUB)             14520000
145300                           NOT = SPACE                            14530000
145400                 MOVE PV-TEXT-SUB         TO                      14540000
145500                                    SUT00038-DTL-TXT-LEN          14550000
145600              END-PERFORM                                         14560000
145700                                                                  14570000
145800     END-EVALUATE.                                                14580000
145900                                                                  14590000
146000****************************************************************  14600000
146100*                                                              *  14610000
146200*                                                              *  14620000
146300*                                                              *  14630000
146400****************************************************************  14640000
146500                                                                  14650000
146600 5400-INSERT-DETAIL-TEXT.                                         14660000
146700                                                                  14670000
146800     PERFORM                                                      14680000
146900         WITH TEST AFTER                                          14690000
147000         VARYING PV-RETRY-COUNTER                                 14700000
147100         FROM 1 BY 1                                              14710000
147200         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  14720000
147300            OR SQLCODE = ZERO                                     14730000
147400                                                                  14740000
147500         EVALUATE TRUE                                            14750000
147600             WHEN XL091-PC-APP-ID                                 14760000
147700                  EXEC SQL                                        14770000
147800                     INSERT INTO PCT_BUS_EVNT_DTL                 14780000
147900                           (EVNT_EXPRT_ID                         14790000
148000                           ,DTL_TXT)                              14800000
148100                                                                  14810000
148200                    VALUES (:PCT00012-EVNT-EXPRT-ID               14820000
148300                           ,:PCT00012-DTL-TXT)                    14830000
148400                  END-EXEC                                        14840000
148500                                                                  14850000
148600             WHEN XL091-SU-APP-ID                                 14860000
148700                  EXEC SQL                                        14870000
148800                     INSERT INTO SUT_BUS_EVNT_DTL                 14880000
148900                           (EVNT_EXPRT_ID                         14890000
149000                           ,DTL_TXT)                              14900000
149100                                                                  14910000
149200                    VALUES (:SUT00038-EVNT-EXPRT-ID               14920000
149300                           ,:SUT00038-DTL-TXT)                    14930000
149400                  END-EXEC                                        14940000
149500                                                                  14950000
149600         END-EVALUATE                                             14960000
149700                                                                  14970000
149800         EVALUATE TRUE                                            14980000
149900             WHEN SQLCODE = ZERO                                  14990000
150000             WHEN SQLCODE = -904                                  15000000
150100             WHEN SQLCODE = -913                                  15010000
150200             WHEN SQLCODE = -911                                  15020000
150300                 CONTINUE                                         15030000
150400             WHEN SQLWARN0 NOT = SPACES                           15040000
150500             WHEN SQLCODE NOT = ZERO                              15050000
150600                  MOVE +4             TO PV-RETRY-COUNTER         15060000
150700         END-EVALUATE                                             15070000
150800     END-PERFORM.                                                 15080000
150900                                                                  15090000
151000     IF SQLCODE = 0                                               15100000
151100        CONTINUE                                                  15110000
151200     ELSE                                                         15120000
151300        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      15130000
151400           SET XL091-SQL-ERROR      TO TRUE                       15140000
151500           MOVE SQLCODE TO XL091-EAI-DB-SQLCODE                   15150000
151600           MOVE '5400-'        TO XL091-SQL-ERROR-PARA            15160000
151700           MOVE SQLCA          TO XL091-SQLCA                     15170000
151800        END-IF                                                    15180000
151900     END-IF.                                                      15190000
152000                                                                  15200000
152100                                                                  15210000
152200******************************************************************15220000
152300*                                                                *15230000
152400******************************************************************15240000
152500 8000-COMMIT.                                                     15250000
152600                                                                  15260000
152700     EXEC SQL                                                     15270000
152800          COMMIT                                                  15280000
152900     END-EXEC.                                                    15290000
153000                                                                  15300000
153100     EVALUATE TRUE                                                15310000
153200         WHEN SQLCODE = ZERO                                      15320000
153300         WHEN SQLCODE = +100                                      15330000
153400             CONTINUE                                             15340000
153500         WHEN OTHER                                               15350000
153600              DISPLAY 'XLKUP046 - ERROR ON COMMIT'                15360000
153700     END-EVALUATE.                                                15370000
153800                                                                  15380000
153900                                                                  15390000
154000****************************************************************  15400000
154100*                                                              *  15410000
154200*                                                              *  15420000
154300****************************************************************  15430000
154400                                                                  15440000
154500 8400-GET-TIMESTAMP.                                              15450000
154600                                                                  15460000
154700     EXEC SQL                                                     15470000
154800          SET   :PV-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP        15480000
154900                                                                  15490000
155000     END-EXEC.                                                    15500000
155100                                                                  15510000
155200     EVALUATE TRUE                                                15520000
155300         WHEN SQLCODE = ZERO                                      15530000
155400              CONTINUE                                            15540000
155500                                                                  15550000
155600         WHEN OTHER                                               15560000
155700              SET XL091-SQL-ERROR TO TRUE                         15570000
155800              MOVE SQLCODE        TO XL091-EAI-DB-SQLCODE         15580000
155900              MOVE '8400-'        TO XL091-SQL-ERROR-PARA         15590000
156000              MOVE SQLCA          TO XL091-SQLCA                  15600000
156100                                                                  15610000
156200      END-EVALUATE.                                               15620000
156300                                                                  15630000
156400                                                                  15640000
