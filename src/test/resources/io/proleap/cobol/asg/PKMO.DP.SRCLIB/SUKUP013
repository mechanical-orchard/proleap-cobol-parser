000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020004
000300******************************************************************00030004
000400 PROGRAM-ID.    SUKUP013.                                         00040004
000500 AUTHOR.        DEANNA BRANTNER.                                  00050004
000600 INSTALLATION.  KOHLS.                                            00060004
000700 DATE-WRITTEN   AUGUST, 2002.                                     00070004
000800 DATE-COMPILED.                                                   00080004
001500******************************************************************00150004
001600*  THIS PROGRAM UPDATES ROWS ON THE OUTBOUND CARTON TABLE         00160006
001700*  SUT_OTBND_CART USING INPUT CREATED FROM PROGRAM SUKUT013.      00170005
001800******************************************************************00180004
002000******************************************************************00200004
002100 ENVIRONMENT DIVISION.                                            00210004
002200 CONFIGURATION SECTION.                                           00220004
002300 SOURCE-COMPUTER.        IBM-3090.                                00230004
002400 OBJECT-COMPUTER.        IBM-3090.                                00240004
002500******************************************************************00250004
002600 INPUT-OUTPUT SECTION.                                            00260004
002700 FILE-CONTROL.                                                    00270004
002800                                                                  00280004
002900     SELECT CARTON-TRIP-FILE                                      00290006
003000         ASSIGN TO INP01.                                         00300004
003100******************************************************************00310004
003200 DATA DIVISION.                                                   00320004
003300 FILE SECTION.                                                    00330004
003400******************************************************************00340004
003500                                                                  00350004
003600 FD  CARTON-TRIP-FILE                                             00360006
003700     RECORDING MODE IS F                                          00370004
003800     LABEL RECORDS ARE STANDARD                                   00380004
003900     BLOCK CONTAINS 0 RECORDS.                                    00390004
004000                                                                  00400004
004100 01  CARTON-TRIP-RECORD      PIC X(50).                           00410008
004200                                                                  00420004
004300******************************************************************00430004
004400 WORKING-STORAGE SECTION.                                         00440004
004500******************************************************************00450004
004600*                                                                 00460004
005400************************************                              00540004
005500*  DB2 FORMATTED MESSAGE AREA                                     00550004
005600************************************                              00560004
005700     COPY DPWS004.                                                00570008
005800                                                                  00580004
005810***********************************************************       00581008
005820*  RECORD LAYOUT FOR THE CARTON TRIP EXTRACT FILE                 00582009
005830***********************************************************       00583009
005840     COPY SURD043.                                                00584009
005850                                                                  00585009
005900************************************                              00590004
006000*  COMMUNICATIONS AREA FOR DB2                                    00600004
006100************************************                              00610004
006200     EXEC SQL                                                     00620004
006300          INCLUDE SQLCA                                           00630004
006400     END-EXEC.                                                    00640004
006500                                                                  00650004
006600******************************************************************00660004
006700*  SUT_OTBND_CART CARTON TRIPERENCE TABLE                         00670006
006800******************************************************************00680004
006900     EXEC SQL                                                     00690004
007000          INCLUDE SUT00024                                        00700005
007100     END-EXEC.                                                    00710004
007200******************************************************************00720004
007300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00730004
007400                                                   COMP SYNC.     00740004
007500                                                                  00750004
007600 01  PS-PROGRAM-SWITCHES.                                         00760004
007700     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00770004
007800         88  PS-END-OF-FILE                        VALUE 'Y'.     00780004
007900         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00790004
008000                                                                  00800004
008100 01  PC-PROGRAM-CONSTANTS.                                        00810004
008200     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00820004
008300                                                   COMP SYNC.     00830004
008400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00840004
008500         'SUKUP013'.                                              00850004
008600     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 005.     00860004
008700                                                                  00870004
008800 01  PV-PROGRAM-VARIABLES.                                        00880004
008900     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00890004
009000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00900004
009100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00910004
009200     05  PV-READ-COUNTER             PIC S9(04)    VALUE ZERO     00920009
009300                                                   COMP SYNC.     00930004
009301     05  PV-READ-COUNTER2            PIC S9(04)    VALUE ZERO     00930109
009302                                                   COMP SYNC.     00930209
009310     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00931009
009320                                                   COMP SYNC.     00932009
009400     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     00940004
009500                                                   COMP SYNC.     00950004
009600     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     00960004
009700                                                   COMP SYNC.     00970004
009800     05  PV-UPDATE-COUNT             PIC S9(09)    VALUE ZERO     00980004
009900                                                   COMP SYNC.     00990004
010000     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     01000004
010100                                                   COMP SYNC.     01010004
010200     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01020004
010300     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       01030004
010400                                                   COMP SYNC.     01040004
010500     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    01050004
010600                                                                  01060004
010700     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01070004
010800                                                   COMP-3.        01080004
010900                                                                  01090004
011000******************************************************************01100004
011100 PROCEDURE DIVISION.                                              01110004
011200     DISPLAY '**** START OF SUKUP013 ****'.                       01120004
011300******************************************************************01130004
011400                                                                  01140004
011500******************************************************************01150004
011600 0000-PROGRAM-MAINLINE.                                           01160004
011700******************************************************************01170004
011800     PERFORM 1000-INITIALIZE.                                     01180004
011900     IF PS-NOT-END-OF-FILE                                        01190004
012000         PERFORM 2000-PROCESS-CARTON-TRIP-RECS                    01200006
012100            UNTIL PS-END-OF-FILE                                  01210004
012200     END-IF.                                                      01220004
012300     PERFORM 9000-EOJ-ROUTINE.                                    01230004
012400                                                                  01240004
012500     STOP RUN.                                                    01250004
012600                                                                  01260004
012700******************************************************************01270004
012800 1000-INITIALIZE.                                                 01280004
012900******************************************************************01290004
013000     OPEN INPUT  CARTON-TRIP-FILE.                                01300006
013100     PERFORM 3000-READ-CARTON-TRIP-FILE.                          01310006
013200                                                                  01320004
013300******************************************************************01330004
013400 2000-PROCESS-CARTON-TRIP-RECS.                                   01340006
013500******************************************************************01350004
013600     PERFORM 4000-UPDATE-CARTON-TRIP-RECS.                        01360006
013700     ADD +1 TO PV-COMMIT-COUNTER.                                 01370004
013800                                                                  01380004
013900     IF PV-COMMIT-COUNTER > PC-COMMIT-HOLD                        01390004
014000         EXEC SQL                                                 01400004
014100            COMMIT                                                01410004
014200         END-EXEC                                                 01420004
014300                                                                  01430004
014400         IF SQLCODE NOT = +0                                      01440004
014500             DISPLAY '### COMMIT FAILED ! ###'                    01450004
014600             PERFORM 9999-SQL-ABEND                               01460004
014700         END-IF                                                   01470004
014800                                                                  01480004
014900         ADD +1                          TO PV-COMMIT-COUNT       01490004
015000         MOVE +0 TO PV-COMMIT-COUNTER                             01500004
015100     END-IF.                                                      01510004
015200                                                                  01520004
015300     PERFORM 3000-READ-CARTON-TRIP-FILE.                          01530006
015400                                                                  01540004
015500******************************************************************01550004
015600 3000-READ-CARTON-TRIP-FILE.                                      01560006
015700******************************************************************01570004
015800      READ CARTON-TRIP-FILE INTO SU043-RECORD                     01580007
015900          AT END SET PS-END-OF-FILE TO TRUE.                      01590004
015910                                                                  01591009
015920      IF  PS-END-OF-FILE                                          01592009
015930          CONTINUE                                                01593009
015940      ELSE                                                        01594009
015950          ADD +1  TO  PV-READ-COUNTER                             01595009
015960                      PV-READ-COUNTER2                            01596009
015970          IF  PV-READ-COUNTER2  >  200000                         01597009
015980              MOVE PV-READ-COUNTER  TO PV-DISPLAY-COUNT           01598009
015990              DISPLAY 'PROCESSED RECORDS..: '   PV-DISPLAY-COUNT  01599009
015991              MOVE ZEROES  TO  PV-READ-COUNTER2                   01599109
015992          END-IF                                                  01599209
015993      END-IF.                                                     01599309
016000                                                                  01600004
016100******************************************************************01610004
016200 4000-UPDATE-CARTON-TRIP-RECS.                                    01620006
016300******************************************************************01630004
016400     EXEC SQL                                                     01640004
016500         UPDATE SUT_OTBND_CART                                    01650005
016600           SET OTBND_TRIP_ID    = :SU043-OTBND-TRIP-ID            01660006
016700             WHERE SHIPT_UNT_ID = :SU043-SHIPT-UNT-ID             01670006
016800     END-EXEC.                                                    01680004
016900                                                                  01690004
017000     EVALUATE TRUE                                                01700004
017100         WHEN SQLCODE = 0                                         01710004
017200             ADD +1           TO PV-UPDATE-COUNT                  01720004
017300         WHEN SQLCODE = +100                                      01730004
017400             DISPLAY 'SHIPT UNT ID = ' SU043-SHIPT-UNT-ID         01740006
017500             ADD +1           TO PV-NOT-FOUND-COUNT               01750005
017600         WHEN SQLCODE < 0                                         01760004
017700         WHEN SQLCODE > 0                                         01770004
017800         WHEN SQLWARN0 = 'W'                                      01780004
017900             MOVE '4000-UPDATE-CARTON-TRIP-RECS'                  01790006
018000                         TO PV-PARAGRAPH-NAME                     01800004
018100             MOVE 'UPDATE OF SUT_OTBND_CART'                      01810005
018200                         TO PV-DB2-OPERATION-ATTEMPTED            01820004
018300             PERFORM 9999-SQL-ABEND                               01830004
018400     END-EVALUATE.                                                01840004
018500                                                                  01850004
018600******************************************************************01860004
018700 9000-EOJ-ROUTINE.                                                01870004
018800******************************************************************01880004
018900     CLOSE CARTON-TRIP-FILE.                                      01890006
019000                                                                  01900004
019100     EXEC SQL                                                     01910004
019200         COMMIT                                                   01920004
019300     END-EXEC.                                                    01930004
019400                                                                  01940004
019500     IF SQLCODE NOT = +0                                          01950004
019600         DISPLAY '### COMMIT FAILED ! ###'                        01960004
019700         PERFORM 9999-SQL-ABEND                                   01970004
019800     END-IF.                                                      01980004
019900                                                                  01990004
020000     ADD +1                TO PV-COMMIT-COUNT.                    02000004
020100     MOVE PV-UPDATE-COUNT  TO PV-DISPLAY-COUNT.                   02010004
020200     DISPLAY 'TOTAL CARTON TRIP RECS UPDATED '   PV-DISPLAY-COUNT.02020006
020300     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 02030004
020400     DISPLAY 'TOTAL CARTON TRIP RECS NOT FOUND ' PV-DISPLAY-COUNT.02040006
020500     MOVE PV-COMMIT-COUNT  TO PV-DISPLAY-COUNT.                   02050004
020600     DISPLAY 'TOTAL COMMITS TAKEN              ' PV-DISPLAY-COUNT.02060004
020700                                                                  02070004
020800******************************************************************02080004
020900 9999-SQL-ABEND.                                                  02090004
021000******************************************************************02100004
021100     DISPLAY '9999-SQL-ABEND'.                                    02110004
021200     DISPLAY '** ABEND     **'.                                   02120004
021300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02130004
021400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02140004
021500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02150004
021600                                                                  02160004
021700******************************************************************02170004
021800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02180004
021900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02190004
022000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02200004
022100* FORMAT.                                                         02210004
022200******************************************************************02220004
022300     COPY DPPD004.                                                02230004
022400                                                                  02240004
022500     MOVE +4013                  TO ABEND-CODE.                   02250004
022600     CALL 'ILBOABN0' USING ABEND-CODE.                            02260004
