000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKUT099.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MARCH, 2003.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL PROCESS THE EXTRACT FILE CONTAINING CARTONS  *00120000
001300* THAT ARE NOT ATTACHED TO AN OUTBOUND TRAILER.                  *00130000
001400* IT WILL ONLY SELECT CARTONS FOR THE REQUESTED TIMEZONE, AND    *00140000
001500* FOR DC'S THAT ARE CURRENTLY MANIFESTING OUTBOUND TRAILERS.     *00150000
001600*----------------------------------------------------------------*00160000
001700******************************************************************00170000
001800* 03/04/2010 MICHAEL J. WATTS                                     00180000
001900*            ADDED CHECK OF E_BUS_IND TO XLT_LOC IN 2050-         00190000
002000*            FOR EFC2 PROJECT (WR38216)                           00200000
002100*                                                                 00210000
002200*                                                                 00220000
002300*                                                                 00230000
002400******************************************************************00240000
002500***************************************************************** 00250000
002600 ENVIRONMENT DIVISION.                                            00260000
002700***************************************************************** 00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT INPUT-FILE ASSIGN TO INP01.                           00320000
003300                                                                  00330000
003400     SELECT EXTRACT-FILE ASSIGN TO OUT01.                         00340000
003500                                                                  00350000
003600***************************************************************** 00360000
003700 DATA DIVISION.                                                   00370000
003800***************************************************************** 00380000
003900 FILE SECTION.                                                    00390000
004000*                                                                 00400000
004100*                                                                 00410000
004200 FD  INPUT-FILE                                                   00420000
004300     RECORDING MODE IS F                                          00430000
004400     LABEL RECORDS ARE STANDARD                                   00440000
004500     BLOCK CONTAINS 0 RECORDS.                                    00450000
004600 01  INPUT-RECORD                PIC X(60).                       00460000
004700                                                                  00470000
004800 FD  EXTRACT-FILE                                                 00480000
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS.                                    00510000
005200 01  EXTRACT-RECORD              PIC X(400).                      00520000
005300*                                                                 00530000
005400*                                                                 00540000
005500***************************************************************** 00550000
005600 WORKING-STORAGE SECTION.                                         00560000
005700                                                                  00570000
005800 01  PS-PROGRAM-SWITCHES.                                         00580000
005900     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00590000
006000         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00600000
006100         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00610000
006200     05  PS-DESIRED-DC-SW             PIC X(01)  VALUE 'N'.       00620000
006300         88  PS-DESIRED-DC-YES                   VALUE 'Y'.       00630000
006400         88  PS-DESIRED-DC-NO                    VALUE 'N'.       00640000
006500     05  PS-MANIFESTING-DC-SW         PIC X(01)  VALUE 'N'.       00650000
006600         88  PS-MANIFESTING-DC-YES               VALUE 'Y'.       00660000
006700         88  PS-MANIFESTING-DC-NO                VALUE 'N'.       00670000
006800     05  PS-CORRECT-TIMEZONE-SW       PIC X(01)  VALUE 'N'.       00680000
006900         88  PS-CORRECT-TIMEZONE-YES             VALUE 'Y'.       00690000
007000         88  PS-CORRECT-TIMEZONE-NO              VALUE 'N'.       00700000
007100     05  PS-SCANNED-ON-TRLR-SW        PIC X(01)  VALUE 'N'.       00710000
007200         88  PS-SCANNED-ON-TRLR                  VALUE 'Y'.       00720000
007300         88  PS-NOT-SCANNED-ON-TRLR              VALUE 'N'.       00730000
007400     05  PS-ACTIVE-DIVERT-SW          PIC X(01)  VALUE 'N'.       00740000
007500         88  PS-ACTIVE-DIVERT                    VALUE 'Y'.       00750000
007600         88  PS-NO-ACTIVE-DIVERT                 VALUE 'N'.       00760000
007700     05  PS-TOO-SOON-TO-REPORT-SW     PIC X(01)  VALUE 'N'.       00770000
007800         88  PS-TOO-SOON-TO-REPORT               VALUE 'Y'.       00780000
007900         88  PS-TOO-SOON-TO-REPORT-NO            VALUE 'N'.       00790000
008000     05  PS-TOO-LATE-TO-REPORT-SW     PIC X(01)  VALUE 'N'.       00800000
008100         88  PS-TOO-LATE-TO-REPORT               VALUE 'Y'.       00810000
008200         88  PS-TOO-LATE-TO-REPORT-NO            VALUE 'N'.       00820000
008300     05  PS-REPORT-JWL-STORE-SW       PIC X(01)  VALUE 'N'.       00830000
008400         88  PS-REPORT-JWL-STORE-YES             VALUE 'Y'.       00840000
008500         88  PS-REPORT-JWL-STORE-NO              VALUE 'N'.       00850000
008600     05  PS-EOF-TRIP-CSR-SW           PIC X(01)  VALUE 'N'.       00860000
008700         88  PS-EOF-TRIP-CSR                     VALUE 'Y'.       00870000
008800         88  PS-NOT-EOF-TRIP-CSR                 VALUE 'N'.       00880000
008900     05  PS-CARTON-RANGE-SW           PIC X(01)  VALUE 'N'.       00890000
009000         88  PS-CARTON-RANGE-FOUND               VALUE 'Y'.       00900000
009100         88  PS-CARTON-RANGE-NOT-FOUND           VALUE 'N'.       00910000
009200     05  PS-LOADED-ONTO-TRLR-SW       PIC X(01)  VALUE 'N'.       00920000
009300         88  PS-LOADED-ONTO-TRLR                 VALUE 'Y'.       00930000
009400         88  PS-NOT-LOADED-ONTO-TRLR             VALUE 'N'.       00940000
009500     05  PS-DC-RTV-CS-ALLOC-SW        PIC X(01)  VALUE 'N'.       00950000
009600         88  PS-DC-RTV-CS-ALLOC                  VALUE 'Y'.       00960000
009700         88  PS-DC-RTV-CS-ALLOC-NO               VALUE 'N'.       00970000
009800                                                                  00980000
009900 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00990000
010000                                                 COMP SYNC.       01000000
010100     88  ABEND-DB2-ERROR                       VALUE +4013.       01010000
010200                                                                  01020000
010300 01  DK-DB2KEYS.                                                  01030000
010400     05  DK-LOC-ID                    PIC  S9(4) COMP.            01040000
010500     05  DK-SHIPT-UNT-ID              PIC  S9(18)V COMP-3.        01050000
010600                                                                  01060000
010700 01  PV-PROGRAM-VARIABLES.                                        01070000
010800     05  PV-WORK-TMST.                                            01080000
010900         10  PV-WORK-DATE             PIC X(10) VALUE SPACE.      01090000
011000         10  PV-WORK-DASH             PIC X(01) VALUE SPACE.      01100000
011100         10  PV-WORK-TIME             PIC X(08) VALUE SPACE.      01110000
011200         10  PV-WORK-DOT              PIC X(01) VALUE SPACE.      01120000
011300         10  PV-WORK-MICRO            PIC 9(06) VALUE ZEROES.     01130000
011400     05  PV-NEW-STR-IND               PIC X(01) VALUE SPACE.      01140000
011500     05  PV-P2L-BEG-TMST              PIC X(26) VALUE SPACE.      01150000
011600     05  PV-P2L-END-TMST              PIC X(26) VALUE SPACE.      01160000
011700     05  PV-CRE-DATE                  PIC X(10) VALUE SPACE.      01170000
011800     05  PV-CRE-TIME                  PIC X(08) VALUE SPACE.      01180000
011900     05  PV-OTHER-BEG-TMST            PIC X(26) VALUE SPACE.      01190000
012000     05  PV-OTHER-END-TMST            PIC X(26) VALUE SPACE.      01200000
012100     05  PV-JWL-BEG-TMST              PIC X(26) VALUE SPACE.      01210000
012200     05  PV-JWL-END-TMST              PIC X(26) VALUE SPACE.      01220000
012300     05  PV-FLAT-BEG-TMST             PIC X(26) VALUE SPACE.      01230000
012400     05  PV-FLAT-END-TMST             PIC X(26) VALUE SPACE.      01240000
012500     05  PV-OPEN-DATE                 PIC X(10) VALUE SPACE.      01250000
012600     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACE.      01260000
012700     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       01270000
012800                                                  COMP SYNC.      01280000
012900     05  PV-READ-COUNT-1              PIC S9(09) VALUE ZERO       01290000
013000                                                  COMP SYNC.      01300000
013100     05  PV-WRITE-EXTR-COUNT          PIC S9(09) VALUE ZERO       01310000
013200                                                  COMP SYNC.      01320000
013300     05  PV-SCAN-ON-COUNT             PIC S9(09) VALUE ZERO       01330000
013400                                                  COMP SYNC.      01340000
013500     05  PV-NO-DIVERT-COUNT           PIC S9(09) VALUE ZERO       01350000
013600                                                  COMP SYNC.      01360000
013700     05  PV-CALL-MODULE-COUNT         PIC S9(09) VALUE ZERO       01370000
013800                                                  COMP SYNC.      01380000
013900     05  PV-TOO-SOON-COUNT            PIC S9(09) VALUE ZERO       01390000
014000                                                  COMP SYNC.      01400000
014100     05  PV-JWL-TOO-SOON-COUNT        PIC S9(09) VALUE ZERO       01410000
014200                                                  COMP SYNC.      01420000
014300     05  PV-TOO-LATE-COUNT            PIC S9(09) VALUE ZERO       01430000
014400                                                  COMP SYNC.      01440000
014500     05  PV-WRONG-TMZN-COUNT          PIC S9(09) VALUE ZERO       01450000
014600                                                  COMP SYNC.      01460000
014700     05  PV-DC-RTV-CS-COUNT           PIC S9(09) VALUE ZERO       01470000
014800                                                  COMP SYNC.      01480000
014900                                                                  01490000
015000     05  PV-DISPLAY-FETCH-CNT         PIC ZZZ,ZZZ,ZZ9.            01500000
015100     05  PV-DISPLAY-WRITE-CNT         PIC ZZZ,ZZZ,ZZ9.            01510000
015200     05  PV-DISPLAY-SHON-CNT          PIC ZZZ,ZZZ,ZZ9.            01520000
015300     05  PV-DISPLAY-NO-DIVRT          PIC ZZZ,ZZZ,ZZ9.            01530000
015400     05  PV-DISPLAY-MODULE            PIC ZZZ,ZZZ,ZZ9.            01540000
015500     05  PV-DISPLAY-TOO-SOON          PIC ZZZ,ZZZ,ZZ9.            01550000
015600     05  PV-DISPLAY-JWL-TOO-SOON      PIC ZZZ,ZZZ,ZZ9.            01560000
015700     05  PV-DISPLAY-TOO-LATE          PIC ZZZ,ZZZ,ZZ9.            01570000
015800     05  PV-DISPLAY-WRONG-TMZN        PIC ZZZ,ZZZ,ZZ9.            01580000
015900     05  PV-DISPLAY-DC-RTV-CS         PIC ZZZ,ZZZ,ZZ9.            01590000
016000                                                                  01600000
016100     05  PV-DISPLAY-SHIPT-UNT-ID      PIC 999999999999999999-.    01610000
016200     05  PV-DISPLAY-PRNT-CART-ID      PIC 999999999999999999-.    01620000
016300     05  PV-DISPLAY-ORGN-LOC-NBR      PIC 999999999-.             01630000
016400     05  PV-DISPLAY-CART-SRC-CDE      PIC XXX.                    01640000
016500     05  PV-DISPLAY-CRE-DTE           PIC X(10).                  01650000
016600     05  PV-DISPLAY-CRE-TM            PIC X(10).                  01660000
016700     05  PV-DISPLAY-CART-TYP-CDE      PIC XXX.                    01670000
016800                                                                  01680000
016900     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     01690000
017000     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACE.     01700000
017100     05  PV-DB2-TABLE-NAME1           PIC X(20)  VALUE SPACE.     01710000
017200     05  PV-DB2-TABLE-NAME2           PIC X(20)  VALUE SPACE.     01720000
017300                                                                  01730000
017400     05  PV-PREV-OPER-UNIT            PIC S9(4) COMP VALUE ZERO.  01740000
017500     05  PV-PREV-STORE-NBR            PIC S9(4) COMP VALUE ZERO.  01750000
017600                                                                  01760000
017700                                                                  01770000
017800 01 PC-PROGRAM-CONSTANTS.                                         01780000
017900     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT099'. 01790000
018000     05 PC-DEFAULT-TMST              PIC X(26)                    01800000
018100             VALUE '9999-09-09-09.09.09.999999'.                  01810000
018200                                                                  01820000
018300 01  PV-ABEND-FIELDS.                                             01830000
018400     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01840000
018500                                                 COMP SYNC.       01850000
018600     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT099'.01860000
018700     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01870000
018800     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01880000
018900     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01890000
019000     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01900000
019100     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01910000
019200     05  PV-SQL-RETURN-CD             PIC  999-.                  01920000
019300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01930000
019400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01940000
019500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01950000
019600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01960000
019700                                                                  01970000
019800 01  CC-CONTROL-CARD.                                             01980000
019900     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 01990000
020000     05  FILLER                      PIC  X(01)      VALUE SPACE. 02000000
020100     05  CC-TIME-ZONE                PIC  X(25)      VALUE SPACE. 02010000
020200     05  FILLER                      PIC  X(44)      VALUE SPACE. 02020000
020300                                                                  02030000
020400******************************************************************02040000
020500*  USED FOR DB2 ERROR MESSAGE BUILDING                            02050000
020600******************************************************************02060000
020700     COPY DPWS004.                                                02070000
020800                                                                  02080000
020900*----------------------------------------------------------------*02090000
021000*    ABEND PROCESSING COPYBOOK.                                  *02100000
021100*----------------------------------------------------------------*02110000
021200     COPY DPWS013.                                                02120000
021300                                                                  02130000
021400******************************************************************02140000
021500*   DB2 SQL COMMUNICATION AREA                                    02150000
021600******************************************************************02160000
021700     EXEC SQL                                                     02170000
021800          INCLUDE SQLCA                                           02180000
021900     END-EXEC.                                                    02190000
022000                                                                  02200000
022100*DB2 AREA FOR COMMUNICATIONS AREA2                                02210000
022200     COPY SQLCA2.                                                 02220000
022300                                                                  02230000
022400******************************************************************02240000
022500*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02250000
022600*   RC - KOHLS TO RETEK PROCESSING PARAMETERS TABLE               02260000
022700******************************************************************02270000
022800     EXEC SQL                                                     02280000
022900          INCLUDE TKRPRPM                                         02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200                                                                  02320000
023300******************************************************************02330000
023400*   OUTBOUND LOCATION DATABASE - SUT_OTBND_LOC                    02340000
023500******************************************************************02350000
023600     EXEC SQL                                                     02360000
023700          INCLUDE SUT00027                                        02370000
023800     END-EXEC.                                                    02380000
023900                                                                  02390000
024000                                                                  02400000
024100******************************************************************02410000
024200*   CARTON DIVERT TABLE - TSUCRDV                                 02420000
024300******************************************************************02430000
024400     EXEC SQL                                                     02440000
024500          INCLUDE TSUCRDV                                         02450000
024600     END-EXEC.                                                    02460000
024700                                                                  02470000
024800                                                                  02480000
024900******************************************************************02490000
025000*   OUTBOUND TRIP STATUS DIVERT BEGIN-END - TSUCDOT               02500000
025100******************************************************************02510000
025200     EXEC SQL                                                     02520000
025300          INCLUDE TSUCDOT                                         02530000
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600                                                                  02560000
025700******************************************************************02570000
025800*   XLT_LOC DATABASE                                              02580000
025900******************************************************************02590000
026000     EXEC SQL                                                     02600000
026100          INCLUDE XLT00010                                        02610000
026200     END-EXEC.                                                    02620000
026300                                                                  02630000
026400                                                                  02640000
026500***********************************************************       02650000
026600*  INPUT RECORD LAYOUT OF SML EXTRACT FILE FOR CARTONS            02660000
026700*  CREATED AND NOT MANIFESTED TO A TRAILER.                       02670000
026800***********************************************************       02680000
026900     COPY SURD051.                                                02690000
027000                                                                  02700000
027100***********************************************************       02710000
027200*  OUTPUT RECORD LAYOUT OF SML EXTRACT FILE FOR CARTONS           02720000
027300*  CREATED AND NOT MANIFESTED TO A TRAILER.                       02730000
027400***********************************************************       02740000
027500     COPY SURD044.                                                02750000
027600                                                                  02760000
027700*COPYBOOK FOR CARTON STATUS MODULE - PCKUT713                     02770000
027800***  COPY PCWS046.                                                02780000
027900                                                                  02790000
028000***********************************************************       02800000
028100 PROCEDURE DIVISION.                                              02810000
028200***********************************************************       02820000
028300     DISPLAY '***BEGINNING SUKUT099***'.                          02830000
028400                                                                  02840000
028500     PERFORM 1000-INITIALIZE.                                     02850000
028600                                                                  02860000
028700     PERFORM 2000-PROCESS-EXTRACTS                                02870000
028800         UNTIL PS-END-OF-INPUT-FILE.                              02880000
028900                                                                  02890000
029000     PERFORM 9000-CLOSE-FILES.                                    02900000
029100                                                                  02910000
029200                                                                  02920000
029300     GOBACK.                                                      02930000
029400                                                                  02940000
029500                                                                  02950000
029600******************************************************************02960000
029700*  FIRST TIME PROGRAM INITIALIZE TASKS.                           02970000
029800 1000-INITIALIZE.                                                 02980000
029900******************************************************************02990000
030000     OPEN INPUT  INPUT-FILE                                       03000000
030100          OUTPUT EXTRACT-FILE.                                    03010000
030200                                                                  03020000
030300     ACCEPT CC-CONTROL-CARD FROM SYSIN                            03030000
030400         DISPLAY '** TIMEZONE = ' CC-TIME-ZONE                    03040000
030500                                                                  03050000
030600     PERFORM 7000-READ-INPUT-FILE.                                03060000
030700                                                                  03070000
030800***************************************************************** 03080000
030900 2000-PROCESS-EXTRACTS.                                           03090000
031000***************************************************************** 03100000
031100     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       03110000
031200                                                                  03120000
031300     IF  SU051-ORGN-LOC-NBR  =  PV-PREV-OPER-UNIT                 03130000
031400         CONTINUE                                                 03140000
031500     ELSE                                                         03150000
031600         PERFORM 2010-CHECK-IF-DESIRED-OPER                       03160000
031700         MOVE  SU051-ORGN-LOC-NBR  TO  PV-PREV-OPER-UNIT          03170000
031800     END-IF.                                                      03180000
031900                                                                  03190000
032000     IF  PS-DESIRED-DC-YES                                        03200000
032100         CONTINUE                                                 03210000
032200     ELSE                                                         03220000
032300         ADD  1  TO  PV-WRONG-TMZN-COUNT                          03230000
032400     END-IF.                                                      03240000
032500                                                                  03250000
032600     IF  PS-DESIRED-DC-YES  AND                                   03260000
032700         (SU051-CART-SRC-CDE = 'JWL' OR 'P2L')                    03270000
032800         PERFORM 2150-GET-P2L-UPLOAD-DATE                         03280000
032900         IF SU051-CART-SRC-CDE = 'JWL'                            03290000
033000             IF SU051-DEST-LOC-NBR = PV-PREV-STORE-NBR            03300000
033100                 CONTINUE                                         03310000
033200             ELSE                                                 03320000
033300                 PERFORM 3300-NEW-STORE-CHECK                     03330000
033400                 MOVE SU051-DEST-LOC-NBR TO PV-PREV-STORE-NBR     03340000
033500             END-IF                                               03350000
033600         END-IF                                                   03360000
033700     END-IF.                                                      03370000
033800                                                                  03380000
033900     SET  PS-TOO-SOON-TO-REPORT-NO                                03390000
034000          PS-TOO-LATE-TO-REPORT-NO  TO  TRUE                      03400000
034100     IF  (SU051-CART-SRC-CDE  = 'JWL' OR  'P2L')                  03410000
034200         MOVE PV-CRE-DATE   TO  PV-WORK-DATE                      03420000
034300         MOVE PV-CRE-TIME   TO  PV-WORK-TIME                      03430000
034400         MOVE '-'           TO  PV-WORK-DASH                      03440000
034500         MOVE '.'           TO  PV-WORK-DOT                       03450000
034600         MOVE ZEROES        TO  PV-WORK-MICRO                     03460000
034700     ELSE                                                         03470000
034800         MOVE SU051-CRE-DATE TO  PV-WORK-DATE                     03480000
034900         MOVE SU051-CRE-TIME TO  PV-WORK-TIME                     03490000
035000         MOVE '-'            TO  PV-WORK-DASH                     03500000
035100         MOVE '.'            TO  PV-WORK-DOT                      03510000
035200         MOVE ZEROES         TO  PV-WORK-MICRO                    03520000
035300     END-IF                                                       03530000
035400                                                                  03540000
035500*** DMB 7/05/05 CHANGED THE DATE PARM TO USE FLAT FOR BEGIN DATE  03550000
035600*** AND OTHER FOR END DATE SO THAT MORE CARTONS WILL COME THRU.   03560000
035700*** THE FLAT AND OTHER CARTONS WILL BE CHECKED IN PROGRAM         03570000
035800*** SUKUT090 AFTER RETRIEVING PROCESS AREA GROUP FROM PCT_PRC_    03580000
035900*** AREA_ASSN TABLE.                                              03590000
036000                                                                  03600000
036100     IF  PS-DESIRED-DC-YES                                        03610000
036200         IF  SU051-CART-SRC-CDE  = 'P2L'                          03620000
036300             IF  PV-WORK-TMST  <  PV-P2L-BEG-TMST                 03630000
036400                 SET  PS-TOO-SOON-TO-REPORT  TO  TRUE             03640000
036500                 ADD  1  TO  PV-TOO-SOON-COUNT                    03650000
036600             END-IF                                               03660000
036700         ELSE                                                     03670000
036800         IF  SU051-CART-SRC-CDE  = 'JWL'                          03680000
036900             IF  PV-WORK-TMST  <  PV-JWL-BEG-TMST                 03690000
037000                 SET  PS-TOO-SOON-TO-REPORT  TO  TRUE             03700000
037100                 ADD  1  TO  PV-TOO-SOON-COUNT                    03710000
037200             ELSE                                                 03720000
037300                 IF PS-REPORT-JWL-STORE-NO                        03730000
037400                     SET  PS-TOO-SOON-TO-REPORT  TO  TRUE         03740000
037500                     ADD  1  TO  PV-JWL-TOO-SOON-COUNT            03750000
037600                 END-IF                                           03760000
037700             END-IF                                               03770000
037800         ELSE                                                     03780000
037900             IF  PV-WORK-TMST  <  PV-FLAT-BEG-TMST                03790000
038000                 SET  PS-TOO-SOON-TO-REPORT  TO  TRUE             03800000
038100                 ADD  1  TO  PV-TOO-SOON-COUNT                    03810000
038200             END-IF                                               03820000
038300         END-IF                                                   03830000
038400         END-IF                                                   03840000
038500     END-IF.                                                      03850000
038600                                                                  03860000
038700     IF  PS-DESIRED-DC-YES                                        03870000
038800         IF  SU051-CART-SRC-CDE  = 'P2L'                          03880000
038900             IF  PV-WORK-TMST  >  PV-P2L-END-TMST                 03890000
039000                 SET  PS-TOO-LATE-TO-REPORT  TO  TRUE             03900000
039100                 ADD  1  TO  PV-TOO-LATE-COUNT                    03910000
039200             END-IF                                               03920000
039300         ELSE                                                     03930000
039400         IF  SU051-CART-SRC-CDE  = 'JWL'                          03940000
039500             IF  PV-WORK-TMST  >  PV-JWL-END-TMST                 03950000
039600                 SET  PS-TOO-LATE-TO-REPORT  TO  TRUE             03960000
039700                 ADD  1  TO  PV-TOO-LATE-COUNT                    03970000
039800             END-IF                                               03980000
039900         ELSE                                                     03990000
040000             IF  PV-WORK-TMST  >  PV-OTHER-END-TMST               04000000
040100                 SET  PS-TOO-LATE-TO-REPORT  TO  TRUE             04010000
040200                 ADD  1  TO  PV-TOO-LATE-COUNT                    04020000
040300             END-IF                                               04030000
040400         END-IF                                                   04040000
040500         END-IF                                                   04050000
040600     END-IF.                                                      04060000
040700                                                                  04070000
040800                                                                  04080000
040900     IF  SU051-DEST-LOC-NBR  =  PV-PREV-STORE-NBR                 04090000
041000         CONTINUE                                                 04100000
041100     ELSE                                                         04110000
041200         PERFORM 2050-CHECK-DC-RTV-CS-ALLOC                       04120000
041300         PERFORM 2075-CHECK-IF-NEW-STORE                          04130000
041400         MOVE  SU051-DEST-LOC-NBR  TO  PV-PREV-STORE-NBR          04140000
041500     END-IF.                                                      04150000
041600                                                                  04160000
041700     IF  PS-TOO-SOON-TO-REPORT  OR                                04170000
041800         PS-TOO-LATE-TO-REPORT  OR                                04180000
041900         PS-DC-RTV-CS-ALLOC                                       04190000
042000         CONTINUE                                                 04200000
042100     ELSE                                                         04210000
042200         IF  PS-DESIRED-DC-YES                                    04220000
042300             PERFORM 2300-CHECK-4-CHILDREN                        04230000
042400             PERFORM 2100-GET-CARTON-STATUS                       04240000
042500         END-IF                                                   04250000
042600     END-IF.                                                      04260000
042700                                                                  04270000
042800     PERFORM 7000-READ-INPUT-FILE.                                04280000
042900                                                                  04290000
043000                                                                  04300000
043100***************************************************************** 04310000
043200* CHECK TO SEE IF ORGN-LOC-NUMBER IS FOR DC IN THE TIMEZONE     * 04320000
043300* REQUESTED AND THE DC IS A MANIFESTING DC.                     * 04330000
043400***************************************************************** 04340000
043500 2010-CHECK-IF-DESIRED-OPER.                                      04350000
043600                                                                  04360000
043700     SET  PS-DESIRED-DC-NO                                        04370000
043800          PS-MANIFESTING-DC-NO                                    04380000
043900          PS-CORRECT-TIMEZONE-NO  TO  TRUE.                       04390000
044000                                                                  04400000
044100     PERFORM 2020-CHECK-TIMEZONE.                                 04410000
044200                                                                  04420000
044300     IF  PS-CORRECT-TIMEZONE-YES                                  04430000
044400         PERFORM 2030-CHECK-MANIFESTING                           04440000
044500     END-IF.                                                      04450000
044600                                                                  04460000
044700     IF  PS-CORRECT-TIMEZONE-YES  AND                             04470000
044800         PS-MANIFESTING-DC-YES                                    04480000
044900         SET  PS-DESIRED-DC-YES   TO  TRUE                        04490000
045000         PERFORM 2040-GET-DATE-RANGE                              04500000
045100     END-IF.                                                      04510000
045200                                                                  04520000
045300                                                                  04530000
045400******************************************************************04540000
045500* - CARTON MUST BE CREATED AT A DC IN THE TIME ZONE BEING        *04550000
045600*   PROCESSED.                                                   *04560000
045700*   WHERE B.SYS_PRC_FUNC_CDE  =   'STATZN'                       *04570000
045800******************************************************************04580000
045900 2020-CHECK-TIMEZONE.                                             04590000
046000                                                                  04600000
046100     MOVE SU051-ORGN-LOC-NBR  TO  KRPRPM-LOC-ID.                  04610000
046200                                                                  04620000
046300     EXEC SQL                                                     04630000
046400                                                                  04640000
046500          SELECT  FUNC_TXT                                        04650000
046600            INTO :KRPRPM-FUNC-TXT                                 04660000
046700            FROM  TKRPRPM                                         04670000
046800           WHERE  LOC_ID            =   :KRPRPM-LOC-ID            04680000
046900             AND  SYS_PRC_FUNC_CDE  =   'STATZN'                  04690000
047000             AND  FUNC_TXT          =   :CC-TIME-ZONE             04700000
047010            WITH UR                                               04701001
047100                                                                  04710000
047200     END-EXEC.                                                    04720000
047300                                                                  04730000
047400     EVALUATE TRUE                                                04740000
047500         WHEN SQLCODE = ZERO                                      04750000
047600              SET  PS-CORRECT-TIMEZONE-YES  TO  TRUE              04760000
047700         WHEN SQLCODE = +100                                      04770000
047800              SET  PS-CORRECT-TIMEZONE-NO   TO  TRUE              04780000
047900         WHEN OTHER                                               04790000
048000             MOVE '2020-CHECK-TIMEZONE'                           04800000
048100                                 TO PV-ABEND-PARAGRAPH            04810000
048200             MOVE 'CHECK TIMEZONE'                                04820000
048300                                 TO PV-ABEND-OPERATION            04830000
048400             MOVE 'TKRPRPM        '                               04840000
048500                                 TO PV-DB2-TABLE-NAME1            04850000
048600             PERFORM Z999-SQL-ABEND                               04860000
048700     END-EVALUATE.                                                04870000
048800                                                                  04880000
048900                                                                  04890000
049000******************************************************************04900000
049100* - CARTON MUST BE FOR A MANIFESTING DC.                         *04910000
049200*   WHERE C.SYS_PRC_FUNC_CDE  =   'DCMFST'                       *04920000
049300******************************************************************04930000
049400 2030-CHECK-MANIFESTING.                                          04940000
049500                                                                  04950000
049600     MOVE SU051-ORGN-LOC-NBR  TO  KRPRPM-LOC-ID.                  04960000
049700                                                                  04970000
049800     EXEC SQL                                                     04980000
049900                                                                  04990000
050000          SELECT  FUNC_TXT                                        05000000
050100            INTO :KRPRPM-FUNC-TXT                                 05010000
050200            FROM  TKRPRPM                                         05020000
050300           WHERE  LOC_ID            =   :KRPRPM-LOC-ID            05030000
050400             AND  SYS_PRC_FUNC_CDE  =   'DCMFST'                  05040000
050500             AND  FUNC_TXT          =   'Y'                       05050000
050510            WITH UR                                               05051001
050600                                                                  05060000
050700     END-EXEC.                                                    05070000
050800                                                                  05080000
050900     EVALUATE TRUE                                                05090000
051000         WHEN SQLCODE = ZERO                                      05100000
051100              SET  PS-MANIFESTING-DC-YES  TO  TRUE                05110000
051200         WHEN SQLCODE = +100                                      05120000
051300              SET  PS-MANIFESTING-DC-NO   TO  TRUE                05130000
051400         WHEN OTHER                                               05140000
051500             MOVE '2030-CHECK-MANIFESTING'                        05150000
051600                                 TO PV-ABEND-PARAGRAPH            05160000
051700             MOVE 'CHECK TIMEZONE'                                05170000
051800                                 TO PV-ABEND-OPERATION            05180000
051900             MOVE 'TKRPRPM        '                               05190000
052000                                 TO PV-DB2-TABLE-NAME1            05200000
052100             PERFORM Z999-SQL-ABEND                               05210000
052200     END-EVALUATE.                                                05220000
052300                                                                  05230000
052400                                                                  05240000
052500******************************************************************05250000
052600* - SELECT START TMST WHEN A CARTON CREATED IN P2L SHOULD BE     *05260000
052700*   ATTACHED TO A TRAILER.                                       *05270000
052800*   (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - D.FUNC_QTY HOURS)     *05280000
052900*                                                                *05290000
053000* - SELECT END TMST WHEN A CARTON CREATED IN P2L SHOULD          *05300000
053100*   APPEAR ON THE REPORT.                                        *05310000
053200*   (CURRENT TIMESTAMP - D.FUNC_QTY HOURS)                       *05320000
053300*                                                                *05330000
053400* - SELECT START TMST WHEN A CARTON OTHER THAN P2L SHOULD BE     *05340000
053500*   ATTACHED TO A TRAILER.                                       *05350000
053600*   (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - F.FUNC_QTY HOURS)     *05360000
053700*                                                                *05370000
053800* - SELECT END TMST WHEN A CARTON OTHER THAN P2L SHOULD          *05380000
053900*   APPEAR ON THE REPORT.                                        *05390000
054000*   (CURRENT TIMESTAMP - F.FUNC_QTY HOURS)                       *05400000
054100*                                                                *05410000
054200******************************************************************05420000
054300 2040-GET-DATE-RANGE.                                             05430000
054400                                                                  05440000
054500     MOVE SU051-ORGN-LOC-NBR  TO  DK-LOC-ID.                      05450000
054600                                                                  05460000
054700     EXEC SQL                                                     05470000
054800         SELECT                                                   05480000
054900          (CURRENT TIMESTAMP - D.FUNC_QTY HOURS)                  05490000
055000        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - D.FUNC_QTY HOURS)05500000
055100        , (CURRENT TIMESTAMP - F.FUNC_QTY HOURS)                  05510000
055200        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - F.FUNC_QTY HOURS)05520000
055300        , (CURRENT TIMESTAMP - G.FUNC_QTY HOURS)                  05530000
055400        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - G.FUNC_QTY HOURS)05540000
055500        , (CURRENT TIMESTAMP - H.FUNC_QTY HOURS)                  05550000
055600        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - H.FUNC_QTY HOURS)05560000
055700                                                                  05570000
055800           INTO                                                   05580000
055900                 :PV-P2L-END-TMST                                 05590000
056000               , :PV-P2L-BEG-TMST                                 05600000
056100               , :PV-OTHER-END-TMST                               05610000
056200               , :PV-OTHER-BEG-TMST                               05620000
056300               , :PV-JWL-END-TMST                                 05630000
056400               , :PV-JWL-BEG-TMST                                 05640000
056500               , :PV-FLAT-END-TMST                                05650000
056600               , :PV-FLAT-BEG-TMST                                05660000
056700           FROM                                                   05670000
056800               TKRPRPM D                                          05680000
056900            ,  TKRPRPM E                                          05690000
057000            ,  TKRPRPM F                                          05700000
057100            ,  TKRPRPM G                                          05710000
057200            ,  TKRPRPM H                                          05720000
057300                                                                  05730000
057400          WHERE                                                   05740000
057500               D.LOC_ID            =  :DK-LOC-ID                  05750000
057600           AND D.SYS_PRC_FUNC_CDE  =   'CTNP2L'                   05760000
057700           AND E.LOC_ID            =  :DK-LOC-ID                  05770000
057800           AND E.SYS_PRC_FUNC_CDE  =   'MFSTDY'                   05780000
057900           AND F.LOC_ID            =  :DK-LOC-ID                  05790000
058000           AND F.SYS_PRC_FUNC_CDE  =   'CTNOTH'                   05800000
058100           AND G.LOC_ID            =  :DK-LOC-ID                  05810000
058200           AND G.SYS_PRC_FUNC_CDE  =   'CTNJWL'                   05820000
058300           AND H.LOC_ID            =  :DK-LOC-ID                  05830000
058400           AND H.SYS_PRC_FUNC_CDE  =   'CTNFLT'                   05840000
058410          WITH UR                                                 05841001
058500     END-EXEC.                                                    05850000
058600                                                                  05860000
058700     EVALUATE TRUE                                                05870000
058800         WHEN SQLCODE = ZERO                                      05880000
058900            MOVE SU051-ORGN-LOC-NBR    TO  PV-DISPLAY-ORGN-LOC-NBR05890000
059000            DISPLAY '** ORGN LOC ID ** = ' PV-DISPLAY-ORGN-LOC-NBR05900000
059100             DISPLAY '** P2L END TMST ** = ' PV-P2L-BEG-TMST      05910000
059200             DISPLAY '** P2L BEG TMST ** = ' PV-P2L-END-TMST      05920000
059300             DISPLAY '** JWL END TMST ** = ' PV-JWL-BEG-TMST      05930000
059400             DISPLAY '** JWL BEG TMST ** = ' PV-JWL-END-TMST      05940000
059500             DISPLAY '** FLT END TMST ** = ' PV-FLAT-BEG-TMST     05950000
059600             DISPLAY '** FLT BEG TMST ** = ' PV-FLAT-END-TMST     05960000
059700             DISPLAY '** OTH END TMST ** = ' PV-OTHER-BEG-TMST    05970000
059800             DISPLAY '** OTH BEG TMST ** = ' PV-OTHER-END-TMST    05980000
059900         WHEN OTHER                                               05990000
060000             MOVE '2040-GET-DATE-RANGE' TO PV-ABEND-PARAGRAPH     06000000
060100             MOVE 'GET DATE RANGE'      TO PV-ABEND-OPERATION     06010000
060200             MOVE 'TKRPRPM     '        TO PV-DB2-TABLE-NAME1     06020000
060300             PERFORM Z999-SQL-ABEND                               06030000
060400     END-EVALUATE.                                                06040000
060500                                                                  06050000
060600***************************************************************** 06060000
060700* ELIMINATE CARTONS WITH DC-RTV-CS ALLOCATIONS                  * 06070000
060800***************************************************************** 06080000
060900 2050-CHECK-DC-RTV-CS-ALLOC.                                      06090000
060920** ADDED OR E_BUS_IND  = 'Y' (WR38216)                            06092000
061000                                                                  06100000
061400     MOVE SU051-DEST-LOC-NBR  TO  DK-LOC-ID.                      06140000
061500                                                                  06150000
061600     EXEC SQL                                                     06160000
061700         SELECT  LOC_TYP_CDE                                      06170000
061800           INTO :XLT00010-LOC-TYP-CDE                             06180000
061900           FROM  XLT_LOC                                          06190000
062000                                                                  06200000
062100          WHERE  LOC_NBR       =  :DK-LOC-ID                      06210000
062200            AND  (LOC_TYP_CDE  IN ('DC','RV','CS')                06220000
062300                  OR  E_BUS_IND     = 'Y')                        06230000
062310           WITH UR                                                06231001
062400     END-EXEC.                                                    06240000
062500                                                                  06250000
062600     EVALUATE TRUE                                                06260000
062700         WHEN SQLCODE = ZERO                                      06270000
062800              SET  PS-DC-RTV-CS-ALLOC     TO  TRUE                06280000
062900              ADD  +1  TO  PV-DC-RTV-CS-COUNT                     06290000
063000         WHEN SQLCODE = +100                                      06300000
063100             SET  PS-DC-RTV-CS-ALLOC-NO  TO  TRUE                 06310000
063200         WHEN OTHER                                               06320000
063300             MOVE '2050-CHECK-DC-RTV-CS-ALLOC'                    06330000
063400                                 TO PV-ABEND-PARAGRAPH            06340000
063500             MOVE 'CHECK IF DC-RTV-CS ALLOCATION'                 06350000
063600                                 TO PV-ABEND-OPERATION            06360000
063700             MOVE 'XLT_LOC        '                               06370000
063800                                 TO PV-DB2-TABLE-NAME1            06380000
063900             PERFORM Z999-SQL-ABEND                               06390000
064000     END-EVALUATE.                                                06400000
064100                                                                  06410000
064200                                                                  06420000
064400***************************************************************** 06440000
064500* CHECK IF STORE IS NOT OPEN YET.                               * 06450000
064600***************************************************************** 06460000
064700 2075-CHECK-IF-NEW-STORE.                                         06470000
064800                                                                  06480000
064900     MOVE SU051-DEST-LOC-NBR  TO  DK-LOC-ID.                      06490000
065000                                                                  06500000
065100     EXEC SQL                                                     06510000
065200         SELECT  OPN_DTE                                          06520000
065300           INTO :XLT00010-OPN-DTE                                 06530000
065400           FROM  XLT_LOC                                          06540000
065500          WHERE  LOC_NBR       =  :DK-LOC-ID                      06550000
065600            AND  OPN_DTE       >  CURRENT DATE                    06560000
065610           WITH UR                                                06561001
065700     END-EXEC.                                                    06570000
065800                                                                  06580000
065900     EVALUATE TRUE                                                06590000
066000         WHEN SQLCODE = ZERO                                      06600000
066100              MOVE 'Y' TO PV-NEW-STR-IND                          06610000
066200         WHEN SQLCODE = +100                                      06620000
066300              MOVE ' ' TO PV-NEW-STR-IND                          06630000
066400         WHEN OTHER                                               06640000
066500             MOVE '2075-CHECK-IF-NEW-STORE   '                    06650000
066600                                 TO PV-ABEND-PARAGRAPH            06660000
066700             MOVE 'CHECK IF STORE IS NEW '                        06670000
066800                                 TO PV-ABEND-OPERATION            06680000
066900             MOVE 'XLT_LOC        '                               06690000
067000                                 TO PV-DB2-TABLE-NAME1            06700000
067100             PERFORM Z999-SQL-ABEND                               06710000
067200     END-EVALUATE.                                                06720000
067300                                                                  06730000
067400***************************************************************** 06740000
067500 2100-GET-CARTON-STATUS.                                          06750000
067600                                                                  06760000
067700        SET  PS-NOT-SCANNED-ON-TRLR                               06770000
067800             PS-NO-ACTIVE-DIVERT      TO  TRUE.                   06780000
067900                                                                  06790000
068000        PERFORM 6010-CHECK-SCANNED-ON.                            06800000
068100                                                                  06810000
068200       IF  PS-NOT-SCANNED-ON-TRLR                                 06820000
068300           PERFORM 6020-CHECK-ACTIVE-DIVERT                       06830000
068400       END-IF.                                                    06840000
068500                                                                  06850000
068600       IF  PS-NOT-SCANNED-ON-TRLR                                 06860000
068700           IF   PS-NO-ACTIVE-DIVERT                               06870000
068800               PERFORM 2200-LOAD-EXTRACT-RECORD                   06880000
068900               ADD +1 TO PV-WRITE-EXTR-COUNT                      06890000
069000               PERFORM 8000-WRITE-EXTRACT                         06900000
069100           ELSE                                                   06910000
069200               ADD  1  TO PV-CALL-MODULE-COUNT                    06920000
069300               PERFORM 3000-CHECK-CRTN-STATUS                     06930000
069400               IF  PS-NOT-LOADED-ONTO-TRLR                        06940000
069500                   PERFORM 2200-LOAD-EXTRACT-RECORD               06950000
069600                   ADD +1 TO PV-WRITE-EXTR-COUNT                  06960000
069700                   PERFORM 8000-WRITE-EXTRACT                     06970000
069800               END-IF                                             06980000
069900          END-IF                                                  06990000
070000      END-IF.                                                     07000000
070100                                                                  07010000
070200                                                                  07020000
070300***************************************************************** 07030000
070400* GET THE DATE/TIME THAT CARTON WAS UPLOADED FROM P2L             07040000
070500***************************************************************** 07050000
070600 2150-GET-P2L-UPLOAD-DATE.                                        07060000
070700                                                                  07070000
070800     MOVE SU051-SHIPT-UNT-ID  TO  SUT00027-SHIPT-UNT-ID           07080000
070900                                                                  07090000
071000     EXEC SQL                                                     07100000
071100                                                                  07110000
071200          SELECT  DATE(A.CRE_TMST)                                07120000
071300                , TIME(A.CRE_TMST)                                07130000
071400            INTO :PV-CRE-DATE                                     07140000
071500                ,:PV-CRE-TIME                                     07150000
071600            FROM  SUT_OTBND_LOC A                                 07160000
071700           WHERE  A.SHIPT_UNT_ID  =  :SUT00027-SHIPT-UNT-ID       07170000
071800             AND  A.CRE_TMST  IN                                  07180000
071900                   (SELECT  MIN(B.CRE_TMST)                       07190000
072000                      FROM  SUT_OTBND_LOC B                       07200000
072100                     WHERE  B.SHIPT_UNT_ID =                      07210000
072200                            :SUT00027-SHIPT-UNT-ID)               07220000
072210            WITH UR                                               07221001
072300     END-EXEC.                                                    07230000
072400                                                                  07240000
072500     EVALUATE TRUE                                                07250000
072600         WHEN SQLCODE = ZERO                                      07260000
072700              MOVE  PV-CRE-DATE  TO  SU051-CRE-DATE               07270000
072800              MOVE  PV-CRE-TIME  TO  SU051-CRE-TIME               07280000
072900                                                                  07290000
073000         WHEN SQLCODE = +100                                      07300000
073100              CONTINUE                                            07310000
073200                                                                  07320000
073300         WHEN OTHER                                               07330000
073400             MOVE '2150-GET-P2L-UPLOAD-DATE'                      07340000
073500                                 TO PV-ABEND-PARAGRAPH            07350000
073600             MOVE 'DETERMINE WHEN SENT FROM P2L'                  07360000
073700                                 TO PV-ABEND-OPERATION            07370000
073800             MOVE 'SUT_OTBND_LOC  '                               07380000
073900                                 TO PV-DB2-TABLE-NAME1            07390000
074000             PERFORM Z999-SQL-ABEND                               07400000
074100     END-EVALUATE.                                                07410000
074200                                                                  07420000
074300                                                                  07430000
074400***************************************************************** 07440000
074500 2200-LOAD-EXTRACT-RECORD.                                        07450000
074600***************************************************************** 07460000
074700     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       07470000
074800                                                                  07480000
074900     INITIALIZE SU044-EXTRACT-RECORD.                             07490000
075000                                                                  07500000
075100     MOVE SU051-ORGN-LOC-NBR       TO SU044-ORGN-LOC-NBR.         07510000
075200     MOVE SU051-DEST-LOC-NBR       TO SU044-DEST-LOC-NBR.         07520000
075300     MOVE SU051-SHIPT-UNT-ID       TO SU044-SHIPT-UNT-ID.         07530000
075400     MOVE SU051-CART-SRC-CDE       TO SU044-CART-SRC-CDE.         07540000
075500     MOVE SU051-CRE-DATE           TO SU044-CRE-DATE.             07550000
075600     MOVE SU051-CRE-TIME           TO SU044-CRE-TIME.             07560000
075700     MOVE PV-NEW-STR-IND           TO SU044-NEW-STR-IND.          07570000
075800     MOVE PV-P2L-BEG-TMST          TO SU044-P2L-BEG-TMST.         07580000
075900     MOVE PV-P2L-END-TMST          TO SU044-P2L-END-TMST.         07590000
076000     MOVE PV-OTHER-BEG-TMST        TO SU044-OTHER-BEG-TMST.       07600000
076100     MOVE PV-OTHER-END-TMST        TO SU044-OTHER-END-TMST.       07610000
076200     MOVE PV-JWL-BEG-TMST          TO SU044-JWL-BEG-TMST.         07620000
076300     MOVE PV-JWL-END-TMST          TO SU044-JWL-END-TMST.         07630000
076400     MOVE PV-FLAT-BEG-TMST         TO SU044-FLAT-BEG-TMST.        07640000
076500     MOVE PV-FLAT-END-TMST         TO SU044-FLAT-END-TMST.        07650000
076600                                                                  07660000
076700*-----------------------------------------------------------------07670000
076800* IF SHIPT-UNT-ID NOT EQUAL TO PRNT-CART-ID - THAT MEANS THAT THIS07680000
076900* CARTON IS A CHILD OF A MASTER CARTON.  THIS PROGRAM NEEDS TO    07690000
077000* CHECK THE MASTER CARTON TO SEE IF IT HAS BEEN LOADED ONTO A     07700000
077100* TRAILER.  IF THE MASTER HAS BEEN LOADED, THE CHILDREN SHOULD NOT07710000
077200* BE WRITTEN TO THE OUTPUT FILE.                                  07720000
077300*-----------------------------------------------------------------07730000
077400 2300-CHECK-4-CHILDREN.                                           07740000
077500                                                                  07750000
077600     IF SU051-SHIPT-UNT-ID  = SU051-PRNT-CART-ID                  07760000
077700         MOVE SU051-SHIPT-UNT-ID    TO DK-SHIPT-UNT-ID            07770000
077800     ELSE                                                         07780000
077900         MOVE SU051-PRNT-CART-ID    TO DK-SHIPT-UNT-ID            07790000
078000     END-IF.                                                      07800000
078100                                                                  07810000
078200***************************************************************** 07820000
078300* THIS PARAGRAPH REPLACES THE CALL TO THE CARTON STATUS MODULE  * 07830000
078400* THIS WAS DONE TO TRY AND SPEED UP THE PROGRAM - ELIMINATING   * 07840000
078500* SOME OF THE SQL IN THE STATUS MODULE                          * 07850000
078600***************************************************************** 07860000
078700* SELECT OUTBOUND TRIP BEGINNING AND ENDING                       07870000
078800*-----------------------------------------------------------------07880000
078900 3000-CHECK-CRTN-STATUS.                                          07890000
079000                                                                  07900000
079100     EXEC SQL                                                     07910000
079200          SELECT  STRT_DIVERT_TMST                                07920000
079300                , END_DIVERT_TMST                                 07930000
079400                , STRT_SCN_TMST                                   07940000
079500                , STRT_SCN_USR_ID                                 07950000
079600                , END_SCN_TMST                                    07960000
079700                , END_SCN_USR_ID                                  07970000
079800            INTO  :SUCDOT-STRT-DIVERT-TMST                        07980000
079900                , :SUCDOT-END-DIVERT-TMST                         07990000
080000                , :SUCDOT-STRT-SCN-TMST                           08000000
080100                , :SUCDOT-STRT-SCN-USR-ID                         08010000
080200                , :SUCDOT-END-SCN-TMST                            08020000
080300                , :SUCDOT-END-SCN-USR-ID                          08030000
080400            FROM  TSUCDOT                                         08040000
080500           WHERE  OPER_UNT_ID       = :SUCRDV-OPER-UNT-ID         08050000
080600             AND  DOOR_ID           = :SUCRDV-DOOR-ID             08060000
080700             AND  STRT_DIVERT_TMST <= :SUCRDV-DIVERT-TMST         08070000
080800             AND (END_DIVERT_TMST  >= :SUCRDV-DIVERT-TMST  OR     08080000
080900                  END_DIVERT_TMST    = :PC-DEFAULT-TMST)          08090000
080910            WITH UR                                               08091001
081000     END-EXEC.                                                    08100000
081100                                                                  08110000
081200     EVALUATE TRUE                                                08120000
081300         WHEN SQLCODE = ZERO                                      08130000
081400         WHEN SQLCODE = -811                                      08140000
081500              SET PS-LOADED-ONTO-TRLR     TO TRUE                 08150000
081600         WHEN SQLCODE = +100                                      08160000
081700              CONTINUE                                            08170000
081800         WHEN OTHER                                               08180000
081900             MOVE '3000-CHECK-CRTN-STATUS '                       08190000
082000                                 TO PV-ABEND-PARAGRAPH            08200000
082100             MOVE 'GET TRIP DIVERT CUTOFFS   '                    08210000
082200                                 TO PV-ABEND-OPERATION            08220000
082300             MOVE 'TSUCDOT   '   TO PV-DB2-TABLE-NAME1            08230000
082400             PERFORM Z999-SQL-ABEND                               08240000
082500     END-EVALUATE.                                                08250000
082600                                                                  08260000
082700                                                                  08270000
082800***************************************************************** 08280000
082900* CHECK IF FOR A NEW STORE, DETERMINE IF THE CURRENT DATE IS    * 08290000
083000* WITHIN 14 DAYS OF THE STORE OPENING.                          * 08300000
083100***************************************************************** 08310000
083200 3300-NEW-STORE-CHECK.                                            08320000
083300     EXEC SQL                                                     08330000
083400          SELECT  (A.OPN_DTE - B.FUNC_QTY DAYS)                   08340000
083500                , CURRENT_DATE                                    08350000
083600            INTO  :PV-OPEN-DATE                                   08360000
083700                , :PV-CURRENT-DATE                                08370000
083800            FROM  XLT_LOC A                                       08380000
083900               ,  TKRPRPM B                                       08390000
084000           WHERE  A.LOC_NBR          = :SU051-DEST-LOC-NBR        08400000
084100             AND  B.LOC_ID           = 90                         08410000
084200             AND  B.INTFC_SYS_CDE    = 'KHL'                      08420000
084300             AND  B.SYS_PRC_FUNC_CDE = 'JWLNEW'                   08430000
084310            WITH UR                                               08431001
084400     END-EXEC.                                                    08440000
084500                                                                  08450000
084600     EVALUATE TRUE                                                08460000
084700         WHEN SQLCODE = ZERO                                      08470000
084800         WHEN SQLCODE = -811                                      08480000
084900              IF PV-CURRENT-DATE > PV-OPEN-DATE                   08490000
085000                  SET PS-REPORT-JWL-STORE-YES TO TRUE             08500000
085100              ELSE                                                08510000
085200                  SET PS-REPORT-JWL-STORE-NO  TO TRUE             08520000
085300              END-IF                                              08530000
085400                                                                  08540000
085500         WHEN SQLCODE = +100                                      08550000
085600              CONTINUE                                            08560000
085700         WHEN OTHER                                               08570000
085800             MOVE '3300-NEW-STORE-CHECK'   TO PV-ABEND-PARAGRAPH  08580000
085900             MOVE 'CHECK IF STORE IS NEW'  TO PV-ABEND-OPERATION  08590000
086000             MOVE 'XLT_LOC    '            TO PV-DB2-TABLE-NAME1  08600000
086100             PERFORM Z999-SQL-ABEND                               08610000
086200                                                                  08620000
086300     END-EVALUATE.                                                08630000
086400                                                                  08640000
086500***************************************************************** 08650000
086600* CHECK IF CARTON WAS SCANNED ONTO A TRAILER                    * 08660000
086700***************************************************************** 08670000
086800 6010-CHECK-SCANNED-ON.                                           08680000
086900                                                                  08690000
087000     MOVE DK-SHIPT-UNT-ID  TO  SUT00027-SHIPT-UNT-ID              08700000
087100                                                                  08710000
087200     EXEC SQL                                                     08720000
087300                                                                  08730000
087400          SELECT  SCN_CDE                                         08740000
087500            INTO :SUT00027-SCN-CDE                                08750000
087600            FROM  SUT_OTBND_LOC                                   08760000
087700           WHERE  SHIPT_UNT_ID  =  :SUT00027-SHIPT-UNT-ID         08770000
087800             AND  SCN_CDE       = 'SHON'                          08780000
087900             AND  ACTV_CDE      = 'A'                             08790000
087910            WITH UR                                               08791001
088000     END-EXEC.                                                    08800000
088100                                                                  08810000
088200     EVALUATE TRUE                                                08820000
088300         WHEN SQLCODE = ZERO                                      08830000
088400         WHEN SQLCODE = -811                                      08840000
088500              SET  PS-SCANNED-ON-TRLR  TO  TRUE                   08850000
088600              ADD  1  TO  PV-SCAN-ON-COUNT                        08860000
088700                                                                  08870000
088800         WHEN SQLCODE = +100                                      08880000
088900              CONTINUE                                            08890000
089000                                                                  08900000
089100         WHEN OTHER                                               08910000
089200             MOVE '6010-CHECK-SCANNED-ON'                         08920000
089300                                 TO PV-ABEND-PARAGRAPH            08930000
089400             MOVE 'DETERMINE IF SCANNED ONTO TRAILER'             08940000
089500                                 TO PV-ABEND-OPERATION            08950000
089600             MOVE 'SUT_OTBND_LOC  '                               08960000
089700                                 TO PV-DB2-TABLE-NAME1            08970000
089800             PERFORM Z999-SQL-ABEND                               08980000
089900     END-EVALUATE.                                                08990000
090000                                                                  09000000
090100                                                                  09010000
090200***************************************************************** 09020000
090300* CHECK IF CARTON HAS AN ACTIVE DIVERT                          * 09030000
090400***************************************************************** 09040000
090500 6020-CHECK-ACTIVE-DIVERT.                                        09050000
090600                                                                  09060000
090700     MOVE DK-SHIPT-UNT-ID  TO  SUCRDV-SHIPT-UNT-ID                09070000
090800                                                                  09080000
090900     EXEC SQL                                                     09090000
091000          SELECT A.OPER_UNT_ID                                    09100000
091100               , A.DIVERT_NBR                                     09110000
091200               , A.DIVERT_LOC_ID                                  09120000
091300               , A.DIVERT_TMST                                    09130000
091400               , A.SHIPT_UNT_ID                                   09140000
091500               , A.DOOR_ID                                        09150000
091600               , A.DEST_OPER_UNT_ID                               09160000
091700            INTO :SUCRDV-OPER-UNT-ID                              09170000
091800               , :SUCRDV-DIVERT-NBR                               09180000
091900               , :SUCRDV-DIVERT-LOC-ID                            09190000
092000               , :SUCRDV-DIVERT-TMST                              09200000
092100               , :SUCRDV-SHIPT-UNT-ID                             09210000
092200               , :SUCRDV-DOOR-ID                                  09220000
092300               , :SUCRDV-DEST-OPER-UNT-ID                         09230000
092400            FROM  TSUCRDV A                                       09240000
092500           WHERE  SHIPT_UNT_ID  =  :SUCRDV-SHIPT-UNT-ID           09250000
092600             AND  A.ACTV_CDE      = 'A'                           09260000
092700             AND  A.DIVERT_TMST IN                                09270000
092800                  (SELECT MAX(B.DIVERT_TMST)                      09280000
092900                     FROM TSUCRDV B                               09290000
093000                    WHERE A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID)       09300000
093010            WITH UR                                               09301001
093100     END-EXEC.                                                    09310000
093200                                                                  09320000
093300     EVALUATE TRUE                                                09330000
093400         WHEN SQLCODE = ZERO                                      09340000
093500              SET  PS-ACTIVE-DIVERT  TO  TRUE                     09350000
093600                                                                  09360000
093700         WHEN SQLCODE = +100                                      09370000
093800              ADD  1  TO  PV-NO-DIVERT-COUNT                      09380000
093900                                                                  09390000
094000         WHEN OTHER                                               09400000
094100             MOVE '6020-CHECK-ACTIVE-DIVERT'                      09410000
094200                                 TO PV-ABEND-PARAGRAPH            09420000
094300             MOVE 'DETERMINE IF CARTON HAS AN ACTIVE DIVERT'      09430000
094400                                 TO PV-ABEND-OPERATION            09440000
094500             MOVE 'TSUCRDV        '                               09450000
094600                                 TO PV-DB2-TABLE-NAME1            09460000
094700             PERFORM Z999-SQL-ABEND                               09470000
094800     END-EVALUATE.                                                09480000
094900                                                                  09490000
095000                                                                  09500000
095100                                                                  09510000
095200                                                                  09520000
095300***************************************************************** 09530000
095400 7000-READ-INPUT-FILE.                                            09540000
095500***************************************************************** 09550000
095600                                                                  09560000
095700      READ INPUT-FILE INTO SU051-EXTRACT-RECORD                   09570000
095800        AT END                                                    09580000
095900           SET PS-END-OF-INPUT-FILE TO TRUE                       09590000
096000        NOT AT END                                                09600000
096100           ADD +1 TO PV-READ-COUNT                                09610000
096200           ADD +1 TO PV-READ-COUNT-1                              09620000
096300           IF  PV-READ-COUNT-1  > 49999                           09630000
096400               MOVE PV-READ-COUNT       TO PV-DISPLAY-FETCH-CNT   09640000
096500               MOVE PV-WRONG-TMZN-COUNT TO PV-DISPLAY-WRONG-TMZN  09650000
096600               MOVE PV-WRITE-EXTR-COUNT TO PV-DISPLAY-WRITE-CNT   09660000
096700               DISPLAY 'READ:'          PV-DISPLAY-FETCH-CNT      09670000
096800                       '   TMZN:'       PV-DISPLAY-WRONG-TMZN     09680000
096900                       '   WRITE:'      PV-DISPLAY-WRITE-CNT      09690000
097000               MOVE  ZERO  TO  PV-READ-COUNT-1                    09700000
097100           END-IF                                                 09710000
097200      END-READ.                                                   09720000
097300                                                                  09730000
097400                                                                  09740000
097500***************************************************************** 09750000
097600 8000-WRITE-EXTRACT.                                              09760000
097700***************************************************************** 09770000
097800     WRITE EXTRACT-RECORD                                         09780000
097900       FROM SU044-EXTRACT-RECORD.                                 09790000
098000                                                                  09800000
098100                                                                  09810000
098200***************************************************************** 09820000
098300 9000-CLOSE-FILES.                                                09830000
098400                                                                  09840000
098500     MOVE PV-READ-COUNT         TO PV-DISPLAY-FETCH-CNT           09850000
098600     MOVE PV-WRONG-TMZN-COUNT   TO PV-DISPLAY-WRONG-TMZN          09860000
098700     MOVE PV-TOO-SOON-COUNT     TO PV-DISPLAY-TOO-SOON            09870000
098800     MOVE PV-JWL-TOO-SOON-COUNT TO PV-DISPLAY-JWL-TOO-SOON        09880000
098900     MOVE PV-TOO-LATE-COUNT     TO PV-DISPLAY-TOO-LATE            09890000
099000     MOVE PV-WRITE-EXTR-COUNT   TO PV-DISPLAY-WRITE-CNT           09900000
099100     MOVE PV-SCAN-ON-COUNT      TO PV-DISPLAY-SHON-CNT            09910000
099200     MOVE PV-NO-DIVERT-COUNT    TO PV-DISPLAY-NO-DIVRT            09920000
099300     MOVE PV-CALL-MODULE-COUNT  TO PV-DISPLAY-MODULE              09930000
099400     MOVE PV-DC-RTV-CS-COUNT    TO PV-DISPLAY-DC-RTV-CS           09940000
099500                                                                  09950000
099600     DISPLAY ' RECORDS READ...: '  PV-DISPLAY-FETCH-CNT           09960000
099700     DISPLAY ' WRONG TIMEZONE.: '  PV-DISPLAY-WRONG-TMZN          09970000
099800     DISPLAY ' TO SOON TO RPT.: '  PV-DISPLAY-TOO-SOON            09980000
099900     DISPLAY 'JWL 2 SOON TO RPT '  PV-DISPLAY-JWL-TOO-SOON        09990000
100000     DISPLAY ' TO LATE TO RPT.: '  PV-DISPLAY-TOO-LATE            10000000
100100     DISPLAY ' DC-RTV-CS ALLOC: '  PV-DISPLAY-DC-RTV-CS           10010000
100200     DISPLAY ' SCANNED ON TRLR: '  PV-DISPLAY-SHON-CNT            10020000
100300     DISPLAY ' NO DIVERTS.....: '  PV-DISPLAY-NO-DIVRT            10030000
100400     DISPLAY ' CRTN STATUS ...: '  PV-DISPLAY-MODULE              10040000
100500     DISPLAY ' RECORDS WRITTEN: '  PV-DISPLAY-WRITE-CNT           10050000
100600                                                                  10060000
100700     CLOSE EXTRACT-FILE.                                          10070000
100800                                                                  10080000
100900                                                                  10090000
101000***************************************************************** 10100000
101100 Z999-SQL-ABEND.                                                  10110000
101200***************************************************************** 10120000
101300     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      10130000
101400                                                                  10140000
101500     MOVE SU051-SHIPT-UNT-ID  TO  PV-DISPLAY-SHIPT-UNT-ID.        10150000
101600     MOVE SU051-ORGN-LOC-NBR  TO  PV-DISPLAY-ORGN-LOC-NBR.        10160000
101700     MOVE SU051-CART-SRC-CDE  TO  PV-DISPLAY-CART-SRC-CDE.        10170000
101800     MOVE SU051-CRE-DATE      TO  PV-DISPLAY-CRE-DTE.             10180000
101900     MOVE SU051-CRE-TIME      TO  PV-DISPLAY-CRE-TM.              10190000
102000     MOVE SU051-SHIPT-UNT-ID  TO  PV-DISPLAY-CART-TYP-CDE.        10200000
102100                                                                  10210000
102200     DISPLAY '** ABEND **         ** = SQLERROR'.                 10220000
102300     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                10230000
102400     DISPLAY '** SHIPT UNT ID ** = ' PV-DISPLAY-SHIPT-UNT-ID.     10240000
102500     DISPLAY '** ORGN LOC NBR ** = ' PV-DISPLAY-ORGN-LOC-NBR.     10250000
102600     DISPLAY '** CART SRC CDE ** = ' PV-DISPLAY-CART-SRC-CDE.     10260000
102700     DISPLAY '** CREATE DATE  ** = ' PV-DISPLAY-CRE-DTE.          10270000
102800     DISPLAY '** CREATE TIME  ** = ' PV-DISPLAY-CRE-TM.           10280000
102900     DISPLAY '** P2L END TMST ** = ' PV-P2L-BEG-TMST.             10290000
103000     DISPLAY '** P2L BEG TMST ** = ' PV-P2L-END-TMST.             10300000
103100     DISPLAY '** JWL END TMST ** = ' PV-JWL-BEG-TMST.             10310000
103200     DISPLAY '** JWL BEG TMST ** = ' PV-JWL-END-TMST.             10320000
103300     DISPLAY '** FLT END TMST ** = ' PV-FLAT-BEG-TMST.            10330000
103400     DISPLAY '** FLT BEG TMST ** = ' PV-FLAT-END-TMST.            10340000
103500     DISPLAY '** OTH END TMST ** = ' PV-OTHER-BEG-TMST.           10350000
103600     DISPLAY '** OTH BEG TMST ** = ' PV-OTHER-END-TMST.           10360000
103700                                                                  10370000
103800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             10380000
103900     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                10390000
104000     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             10400000
104100     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             10410000
104200     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             10420000
104300                                                                  10430000
104400     MOVE +4013                  TO PV-ABEND-CODE.                10440000
104500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         10450000
