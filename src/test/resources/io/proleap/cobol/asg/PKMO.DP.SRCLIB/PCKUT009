000100 IDENTIFICATION DIVISION.                                         00010040
000200******************************************************************00020025
000300*  EXTRACT PROGRAM OF THE TDISTHD AND TDISTST TABLES.             00030025
000400******************************************************************00040025
000500                                                                  00050025
000600 PROGRAM-ID.        PCKUT009.                                     00060025
000700 AUTHOR.            DENNIS STEFFEN.                               00070025
000800 INSTALLATION.      KOHLS.                                        00080025
000900 DATE-WRITTEN       APRIL 1998.                                   00090025
001000 DATE-COMPILED.                                                   00100025
001100                                                                  00110025
001200 ENVIRONMENT DIVISION.                                            00120025
001300 CONFIGURATION SECTION.                                           00130025
001400 SOURCE-COMPUTER.   IBM-3090.                                     00140025
001500 OBJECT-COMPUTER.   IBM-3090.                                     00150025
001600 INPUT-OUTPUT SECTION.                                            00160025
001700                                                                  00170025
001800 FILE-CONTROL.                                                    00180025
001900     SELECT P2L-EXTRACT-FILE                                      00190025
002000         ASSIGN TO OUT01.                                         00200025
002100                                                                  00210025
002200 DATA DIVISION.                                                   00220025
002300 FILE SECTION.                                                    00230025
002400 FD  P2L-EXTRACT-FILE                                             00240025
002410     RECORDING MODE IS F                                          00241045
002500     DATA RECORD IS P2L-EXTRACT-RECORD.                           00250025
002600                                                                  00260025
002700 01  P2L-EXTRACT-RECORD               PIC X(150).                 00270025
002800                                                                  00280025
002900 WORKING-STORAGE SECTION.                                         00290025
003000                                                                  00300025
003100 01  CC-CONTROL-CARD.                                             00310025
003200     05  CC-USER-ID                   PIC X(07).                  00320025
003300     05  FILLER                       PIC X(01).                  00330025
003400     05  CC-DC-NUMBER                 PIC 9(04).                  00340025
003500     05  FILLER                       PIC X(01).                  00350025
003600     05  CC-REPORT-REQUEST-1          PIC X(01).                  00360025
003700     05  CC-REPORT-REQUEST-2          PIC X(01).                  00370025
003800     05  CC-TO-INFOPAC-OR-PRINTER     PIC X(01).                  00380025
003900     05  CC-PRINTER-ID                PIC X(08).                  00390025
004000     05  FILLER                       PIC X(56).                  00400025
004100                                                                  00410025
004200 01  ABEND-CODE                       PIC S9(04)  COMP SYNC       00420025
004300                                                    VALUE ZERO.   00430025
004400 01  DK-DB2-KEYS.                                                 00440025
004500     05  DK-OPER-UNT-ID               PIC S9(04) COMP SYNC        00450025
004600                                                    VALUE ZERO.   00460025
004700     05  DN-VEH-NBR                   PIC S9(04) COMP SYNC        00470025
004800                                                    VALUE ZERO.   00480025
004900 01  PS-PROGRAM-SWITCHES.                                         00490025
005000     05  PS-EOF-TDIST-HD-SW           PIC X(01) VALUE 'N'.        00500025
005100         88  PS-EOF-TDISTHD                         VALUE 'Y'.    00510025
005200     05  PS-CURSOR-OPENED-SW          PIC X(01) VALUE 'N'.        00520027
005300         88  PS-CURSOR-OPENED-YES                   VALUE 'Y'.    00530027
005400         88  PS-CURSOR-OPENED-NO                    VALUE 'Y'.    00540027
005500     05  PS-TABLE-CONTENTION-SW       PIC X(01) VALUE 'N'.        00550025
005600         88  PS-NOT-TABLE-CONTENTION            VALUE 'N'.        00560025
005700         88  PS-TABLE-CONTENTION                VALUE 'Y'.        00570025
005800                                                                  00580025
005900 01  PC-PROGRAM-CONSTANTS.                                        00590025
006000     05  PC-DEFAULT-DATE              PIC  X(10)  VALUE           00600025
006100         '9999-09-09'.                                            00610025
006200     05  PC-DEFAULT-TM                PIC  X(08)  VALUE           00620025
006300         '00.00.00'.                                              00630025
006400     05  PC-1                         PIC S9(3) COMP-3            00640025
006500                                                     VALUE +1.    00650025
006600                                                                  00660025
006700 01  PV-PROGRAM-VARIABLES.                                        00670025
006800     05  PV-PREV-ORD-NBR              PIC S9(09) COMP VALUE ZERO. 00680025
006900     05  PV-PREV-RCVR-SEQ-NBR         PIC S9(09) COMP VALUE ZERO. 00690025
007000     05  PV-DUMMY-TMST                PIC X(26)  VALUE            00700000
007100         '9998-09-09-09.09.09.999999'.                            00710000
007200     05  PV-DISP-NUM                  PIC ZZZ,ZZ9.                00720025
007300                                                                  00730025
007400 01  PV-COUNTERS.                                                 00740025
007500     05  PV-TDISTHD-FETCHED           PIC S9(7) COMP-3            00750025
007600                                                VALUE ZERO.       00760025
007700     05  PV-EXTRACTS-COUNTER          PIC S9(7) COMP-3            00770025
007800                                                VALUE ZERO.       00780025
007900/                                                                 00790025
008000* P2L EXTRACT-RECORD                                              00800025
008100     COPY PCRD004.                                                00810025
008200/                                                                 00820025
008300*  DISTRIBUTION HEADER TABLE.                                     00830025
008400     EXEC SQL                                                     00840025
008500         INCLUDE TDISTHD                                          00850025
008600     END-EXEC.                                                    00860025
008700/                                                                 00870025
008800     EXEC SQL                                                     00880025
008900         INCLUDE TDISTDT                                          00890025
009000     END-EXEC.                                                    00900025
009100/                                                                 00910025
009200     EXEC SQL                                                     00920025
009300         INCLUDE TWKORIN                                          00930025
009400     END-EXEC.                                                    00940025
009500/                                                                 00950025
009600     EXEC SQL                                                     00960025
009700         INCLUDE TPURCHS                                          00970025
009800     END-EXEC.                                                    00980025
009900/                                                                 00990025
010000     EXEC SQL                                                     01000025
010100         INCLUDE TENTNME                                          01010025
010200     END-EXEC.                                                    01020025
010300/                                                                 01030025
010400     EXEC SQL                                                     01040025
010500         INCLUDE TRECEIV                                          01050025
010600     END-EXEC.                                                    01060025
010700/                                                                 01070025
010800     EXEC SQL                                                     01080025
010900         INCLUDE TSHIPMT                                          01090025
011000     END-EXEC.                                                    01100025
011100/                                                                 01110025
011200     EXEC SQL                                                     01120025
011300         INCLUDE TSHPTPO                                          01130025
011400     END-EXEC.                                                    01140025
011500/                                                                 01150025
011600     EXEC SQL                                                     01160025
011700         INCLUDE TVHTRIP                                          01170025
011800     END-EXEC.                                                    01180025
011900/                                                                 01190025
012000     EXEC SQL                                                     01200025
012100         INCLUDE TMDSEAR                                          01210025
012200     END-EXEC.                                                    01220025
012300/                                                                 01230025
012400     EXEC SQL                                                     01240025
012500         INCLUDE TMDSEDP                                          01250025
012600     END-EXEC.                                                    01260025
012700/                                                                 01270025
012800     EXEC SQL                                                     01280025
012900     DECLARE DISTHD-CSR CURSOR FOR                                01290025
013000         SELECT A.ORD_NBR                                         01300025
013100             ,  A.RCVR_SEQ_NBR                                    01310025
013200             ,  A.ORD_LNE_NBR                                     01320025
013300             ,  A.PRCG_STAT_CDE                                   01330025
013400             ,  A.PRC_AREA_MODU_ID                                01340025
013500             ,  A.P2L_CART_CNT                                    01350025
013600             ,  B.REC_TMST                                        01360025
013700             ,  C.DEPT_NBR                                        01370025
013800             ,  C.ENT_ID                                          01380025
013900         FROM                                                     01390025
014000             TDISTHD A                                            01400025
014100         ,   TRECEIV B                                            01410025
014200         ,   TPURCHS C                                            01420025
014300                                                                  01430025
014400         WHERE                                                    01440025
014500                                                                  01450025
014600             A.ORD_NBR        = B.ORD_NBR                         01460025
014700         AND A.ORD_NBR        = C.PO_NBR                          01470025
014800         AND A.RCVR_SEQ_NBR   = B.REC_SEQ_NBR                     01480025
014900         AND B.VER_STATUS_CDE = 'A'                               01490025
015000         AND B.PO_VER_NBR     = C.VER_NBR                         01500025
015100                                                                  01510025
015200         AND A.OPER_UNT_ID    = :DK-OPER-UNT-ID                   01520025
015300         AND A.RSLTS_RCVD_TMST > :PV-DUMMY-TMST                   01530026
015400         AND NOT A.PRC_AREA_MODU_ID = '   '                       01540025
015500         AND A.TOT_CART_CNT   > 0                                 01550025
015600         AND A.P2L_CART_CNT   > 0                                 01560025
015700         AND B.STATUS_CDE     NOT IN ('VE', 'DE')                 01570025
015800         ORDER BY                                                 01580025
015900                A.ORD_NBR                                         01590025
016000             ,  A.RCVR_SEQ_NBR                                    01600025
016100                                                                  01610025
016200     END-EXEC.                                                    01620025
016300/                                                                 01630025
016400     EXEC SQL                                                     01640025
016500         INCLUDE SQLCA                                            01650025
016600     END-EXEC.                                                    01660025
016700                                                                  01670025
016800     COPY SQLCA2.                                                 01680025
016900                                                                  01690025
017000 PROCEDURE DIVISION.                                              01700025
017100                                                                  01710025
017200                                                                  01720025
017300 0000-PROGRAM-MAINLINE.                                           01730025
017400                                                                  01740025
017500     PERFORM 1000-INITIALIZE.                                     01750025
017600                                                                  01760025
017700     PERFORM 2000-PROCESS-VSAM-HEADERS                            01770025
017800         UNTIL PS-EOF-TDISTHD                                     01780025
017900            OR PS-TABLE-CONTENTION.                               01790025
018000                                                                  01800025
018100     PERFORM 9000-EOJ-ROUTINE.                                    01810025
018200                                                                  01820025
018300     GOBACK.                                                      01830025
018400/                                                                 01840025
018500 1000-INITIALIZE.                                                 01850025
018600                                                                  01860025
018700     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01870025
018800     DISPLAY 'CONTROL CARD '                                      01880025
018900     DISPLAY CC-CONTROL-CARD                                      01890025
019000                                                                  01900025
019100     IF CC-DC-NUMBER NUMERIC                                      01910025
019200         MOVE CC-DC-NUMBER            TO DK-OPER-UNT-ID           01920025
019300     ELSE                                                         01930025
019400         DISPLAY '** PARA 1000-INITIALIZE **'                     01940025
019500         DISPLAY '** INVALID CONTROL CARD **'                     01950025
019600         DISPLAY '** DC NOT NUMERIC       **'                     01960025
019700         MOVE +4001                   TO ABEND-CODE               01970025
019800         CALL 'ILBOABN0' USING ABEND-CODE                         01980025
019900     END-IF.                                                      01990025
020000                                                                  02000025
020100     OPEN OUTPUT P2L-EXTRACT-FILE.                                02010025
020200                                                                  02020025
020300     PERFORM 7000-OPEN-DISTHD-CSR.                                02030025
020400     IF SQLCODE = ZERO                                            02040025
020500         PERFORM 7010-FETCH-DISTHD-CSR                            02050025
020600     END-IF.                                                      02060025
020700                                                                  02070025
020800 2000-PROCESS-VSAM-HEADERS.                                       02080025
020900                                                                  02090025
021000     IF DISTHD-ORD-NBR = PV-PREV-ORD-NBR  AND                     02100025
021100         DISTHD-RCVR-SEQ-NBR = PV-PREV-RCVR-SEQ-NBR               02110025
021200*LMM     NEXT SENTENCE                                            02120044
021300         IF  PS-NOT-TABLE-CONTENTION                              02130044
021400             PERFORM 7100-SUM-DISTDT                              02140044
021500         END-IF                                                   02150044
021600     ELSE                                                         02160025
021700         MOVE DISTHD-ORD-NBR          TO PV-PREV-ORD-NBR          02170025
021800         MOVE DISTHD-RCVR-SEQ-NBR     TO PV-PREV-RCVR-SEQ-NBR     02180025
021900                                                                  02190035
022000         IF  PS-NOT-TABLE-CONTENTION                              02200035
022100             PERFORM 7100-SUM-DISTDT                              02210035
022200         END-IF                                                   02220035
022300         IF  PS-NOT-TABLE-CONTENTION                              02230025
022400             PERFORM 7200-ENTNME-INFO                             02240025
022500         END-IF                                                   02250025
022600         IF  PS-NOT-TABLE-CONTENTION                              02260025
022700             PERFORM 7300-SHIPMENT-INFO                           02270025
022800         END-IF                                                   02280025
022900         IF  PS-NOT-TABLE-CONTENTION                              02290025
023000             PERFORM 7400-ZONE-INFO                               02300025
023100         END-IF                                                   02310025
023200         IF  PS-NOT-TABLE-CONTENTION                              02320025
023300             PERFORM 7500-LOC-CDE                                 02330025
023400         END-IF                                                   02340025
023500     END-IF.                                                      02350025
023600                                                                  02360025
023700     IF  PS-NOT-TABLE-CONTENTION                                  02370025
023800         PERFORM 3000-PROCESS-EXTRACT                             02380025
023900         PERFORM 7010-FETCH-DISTHD-CSR                            02390025
024000     END-IF.                                                      02400025
024100                                                                  02410025
024200/                                                                 02420025
024300 3000-PROCESS-EXTRACT.                                            02430025
024400                                                                  02440025
024500     MOVE DISTHD-ORD-NBR              TO PC004-ORD-NBR            02450025
024600     MOVE DISTHD-RCVR-SEQ-NBR         TO PC004-REC-SEQ-NBR        02460025
024700     MOVE DISTHD-ORD-LNE-NBR          TO PC004-ORD-LNE-NBR        02470025
024800     MOVE RECEIV-REC-TMST (6:2)       TO PC004-REC-DATE-MM        02480025
024900     MOVE RECEIV-REC-TMST (9:2)       TO PC004-REC-DATE-DD        02490025
025000     MOVE RECEIV-REC-TMST (1:2)       TO PC004-REC-DATE-CC        02500025
025100     MOVE RECEIV-REC-TMST (3:2)       TO PC004-REC-DATE-YY        02510025
025200     MOVE DISTHD-P2L-CART-CNT         TO PC004-P2L-CART-CNT       02520025
025300     MOVE DISTDT-P2L-SPLT-UNT-QTY     TO PC004-P2L-UNIT-QTY       02530025
025400     MOVE ENTNME-ENT-NAME-DESC        TO PC004-VNDR-NME           02540025
025500     MOVE PURCHS-DEPT-NBR             TO PC004-DEPT-NBR           02550025
025600     MOVE DISTHD-PRCG-STAT-CDE        TO PC004-PRCG-STAT-CDE      02560025
025700     MOVE DK-OPER-UNT-ID              TO PC004-CURRENT-OPER       02570025
025800     MOVE PC-1                        TO PC004-CURRENT-FCLTY      02580025
025900     MOVE DISTHD-PRC-AREA-MODU-ID     TO PC004-PRC-AREA-MODU-ID   02590025
026000     MOVE MDSEDP-STR-ZN-ID            TO PC004-STR-ZONE-ID        02600025
026100     MOVE VHTRIP-OWNER-SCAC-ID        TO PC004-SCAC-ID            02610025
026200     MOVE VHTRIP-VEH-NBR              TO PC004-VEH-NBR            02620025
026300     MOVE WKORIN-LNE-LOC-CDE          TO PC004-LNE-LOC-CDE        02630025
026400     MOVE 'D'                         TO PC004-LNE-STATUS-CDE     02640025
026500     SET  PC004-REPORT-RECORD         TO TRUE                     02650025
026600                                                                  02660025
026700     WRITE P2L-EXTRACT-RECORD FROM PC004-P2L-EXT-RECORD.          02670025
026800     ADD PC-1                         TO PV-EXTRACTS-COUNTER.     02680025
026900                                                                  02690029
027000 7000-OPEN-DISTHD-CSR.                                            02700025
027100     EXEC SQL                                                     02710025
027200         OPEN DISTHD-CSR                                          02720025
027300     END-EXEC.                                                    02730025
027400                                                                  02740025
027500     EVALUATE TRUE                                                02750025
027600         WHEN SQLCODE = ZERO                                      02760025
027700             SET  PS-CURSOR-OPENED-YES  TO  TRUE                  02770027
027800         WHEN SQLCODE = -904                                      02780025
027900         WHEN SQLCODE = -911                                      02790025
028000         WHEN SQLCODE = -913                                      02800025
028100             DISPLAY '** SQL CONTENTION ERROR **'                 02810027
028200             DISPLAY '** 7000-OPEN-DISTHD-CSR'                    02820027
028300              PERFORM 8000-CREATE-ERROR-RECORD                    02830025
028400         WHEN SQLCODE < ZERO                                      02840025
028500             DISPLAY '** ABEND - PCKUT009 **'                     02850025
028600             DISPLAY '** 7000-OPEN-DISTHD-CSR'                    02860025
028700             PERFORM 9200-SQL-ERROR                               02870025
028800         WHEN SQLCODE > ZERO                                      02880025
028900         WHEN SQLWARN0 NOT = SPACES                               02890025
029000             DISPLAY '** ABEND - PCKUT009 **'                     02900025
029100             DISPLAY '** 7000-OPEN-DISTHD-CSR'                    02910025
029200             PERFORM 9300-SQL-WARNING                             02920025
029300     END-EVALUATE.                                                02930025
029400/                                                                 02940025
029500                                                                  02950025
029600 7010-FETCH-DISTHD-CSR.                                           02960025
029700     EXEC SQL                                                     02970025
029800         FETCH DISTHD-CSR                                         02980025
029900         INTO                                                     02990025
030000                 :DISTHD-ORD-NBR                                  03000025
030100             ,   :DISTHD-RCVR-SEQ-NBR                             03010025
030200             ,   :DISTHD-ORD-LNE-NBR                              03020025
030300             ,   :DISTHD-PRCG-STAT-CDE                            03030025
030400             ,   :DISTHD-PRC-AREA-MODU-ID                         03040025
030500             ,   :DISTHD-P2L-CART-CNT                             03050025
030600             ,   :RECEIV-REC-TMST                                 03060025
030700             ,   :PURCHS-DEPT-NBR                                 03070025
030800             ,   :PURCHS-ENT-ID                                   03080025
030900     END-EXEC.                                                    03090025
031000                                                                  03100025
031100                                                                  03110025
031200     EVALUATE TRUE                                                03120025
031300         WHEN SQLCODE = ZERO                                      03130025
031400             ADD PC-1                 TO PV-TDISTHD-FETCHED       03140025
031500         WHEN SQLCODE = +100                                      03150025
031600             SET PS-EOF-TDISTHD       TO TRUE                     03160025
031700         WHEN SQLCODE = -904                                      03170025
031800         WHEN SQLCODE = -911                                      03180025
031900         WHEN SQLCODE = -913                                      03190025
032000              PERFORM 8000-CREATE-ERROR-RECORD                    03200025
032100         WHEN SQLCODE < ZERO                                      03210025
032200             DISPLAY '** ABEND - PCKUT009 **'                     03220025
032300             DISPLAY '** 7010-FETCH-TDISTHD'                      03230025
032400             PERFORM 9200-SQL-ERROR                               03240025
032500         WHEN SQLCODE > ZERO                                      03250025
032600         WHEN SQLWARN0 NOT = SPACES                               03260025
032700             DISPLAY '** ABEND - PCKUT009 **'                     03270025
032800             DISPLAY '** 7010-FETCH-TDISTHD'                      03280025
032900             PERFORM 9300-SQL-WARNING                             03290025
033000     END-EVALUATE.                                                03300025
033100/                                                                 03310025
033200 7020-CLOSE-DISTHD-CSR.                                           03320025
033300     EXEC SQL                                                     03330025
033400         CLOSE DISTHD-CSR                                         03340025
033500     END-EXEC.                                                    03350025
033600                                                                  03360025
033700     EVALUATE TRUE                                                03370025
033800         WHEN SQLCODE = ZERO                                      03380033
033900             CONTINUE                                             03390025
034000         WHEN SQLCODE = -904                                      03400025
034100         WHEN SQLCODE = -911                                      03410025
034200         WHEN SQLCODE = -913                                      03420025
034300              PERFORM 8000-CREATE-ERROR-RECORD                    03430025
034400         WHEN SQLCODE < ZERO                                      03440025
034500             DISPLAY '** ABEND - PCKUT009 **'                     03450025
034600             DISPLAY '** 7020-CLOSE-DISTHD-CSR'                   03460025
034700             PERFORM 9200-SQL-ERROR                               03470025
034800         WHEN SQLCODE > ZERO                                      03480025
034900         WHEN SQLWARN0 NOT = SPACES                               03490025
035000             DISPLAY '** ABEND - PCKUT009 **'                     03500025
035100             DISPLAY '** 7020-CLOSE-DISTHD-CSR'                   03510025
035200             PERFORM 9300-SQL-WARNING                             03520025
035300     END-EVALUATE.                                                03530025
035400/                                                                 03540025
035500 7100-SUM-DISTDT.                                                 03550025
035600                                                                  03560025
035700     EXEC SQL                                                     03570025
035800         SELECT SUM(P2L_SPLT_UNT_QTY)                             03580025
035900         INTO :DISTDT-P2L-SPLT-UNT-QTY                            03590025
036000         FROM TDISTDT                                             03600025
036100         WHERE ORD_NBR      = :DISTHD-ORD-NBR                     03610025
036200         AND   RCVR_SEQ_NBR = :DISTHD-RCVR-SEQ-NBR                03620025
036300         AND   ORD_LNE_NBR  = :DISTHD-ORD-LNE-NBR                 03630025
036400     END-EXEC.                                                    03640025
036500                                                                  03650025
036600     EVALUATE TRUE                                                03660025
036700         WHEN SQLCODE = ZERO                                      03670025
036800             CONTINUE                                             03680025
036900         WHEN SQLCODE = -305                                      03690025
037000             MOVE ZERO                TO DISTDT-P2L-SPLT-UNT-QTY  03700025
037100         WHEN SQLCODE = -904                                      03710025
037200         WHEN SQLCODE = -911                                      03720025
037300         WHEN SQLCODE = -913                                      03730025
037400              PERFORM 8000-CREATE-ERROR-RECORD                    03740025
037500         WHEN SQLCODE < ZERO                                      03750025
037600             DISPLAY '** ABEND - PCKUT009 **'                     03760025
037700             DISPLAY '** 7100-SUM-DISTDT'                         03770025
037800             PERFORM 9200-SQL-ERROR                               03780025
037900         WHEN SQLCODE > ZERO                                      03790025
038000         WHEN SQLWARN0 NOT = SPACES                               03800025
038100             DISPLAY '** ABEND - PCKUT009 **'                     03810025
038200             DISPLAY '** 7100-SUM-DISTDT'                         03820025
038300             PERFORM 9300-SQL-WARNING                             03830025
038400     END-EVALUATE.                                                03840025
038500/                                                                 03850025
038600 7200-ENTNME-INFO.                                                03860025
038700                                                                  03870025
038800     EXEC SQL                                                     03880025
038900         SELECT                                                   03890025
039000             A.ENT_NAME_DESC                                      03900025
039100         INTO                                                     03910025
039200             :ENTNME-ENT-NAME-DESC                                03920025
039300         FROM  TENTNME A                                          03930025
039400         WHERE                                                    03940025
039500               A.ENT_ID       = :PURCHS-ENT-ID                    03950025
039600         AND   A.TYPE_CDE      = '01'                             03960025
039700     END-EXEC.                                                    03970025
039800                                                                  03980025
039900     EVALUATE TRUE                                                03990025
040000         WHEN SQLCODE = ZERO                                      04000025
040100             CONTINUE                                             04010025
040200         WHEN SQLCODE = +100                                      04020025
040300             MOVE SPACES              TO ENTNME-ENT-NAME-DESC     04030025
040400         WHEN SQLCODE = -904                                      04040025
040500         WHEN SQLCODE = -911                                      04050025
040600         WHEN SQLCODE = -913                                      04060025
040700              PERFORM 8000-CREATE-ERROR-RECORD                    04070025
040800         WHEN SQLCODE < ZERO                                      04080025
040900             DISPLAY '** ABEND - PCKUT009 **'                     04090025
041000             DISPLAY '** 7200-ENTNME-INFO   '                     04100025
041100             PERFORM 9200-SQL-ERROR                               04110025
041200         WHEN SQLCODE > ZERO                                      04120025
041300         WHEN SQLWARN0 NOT = SPACES                               04130025
041400             DISPLAY '** ABEND - PCKUT009 **'                     04140025
041500             DISPLAY '** 7200-ENTNME-INFO   '                     04150025
041600             PERFORM 9300-SQL-WARNING                             04160025
041700     END-EVALUATE.                                                04170025
041800/                                                                 04180025
041900 7300-SHIPMENT-INFO.                                              04190025
042000                                                                  04200025
042100     EXEC SQL                                                     04210025
042200         SELECT  DISTINCT                                         04220025
042300             C.OWNER_SCAC_ID                                      04230025
042400         ,   C.VEH_NBR                                            04240025
042500         INTO                                                     04250025
042600             :VHTRIP-OWNER-SCAC-ID                                04260025
042700         ,   :VHTRIP-VEH-NBR :DN-VEH-NBR                          04270025
042800         FROM                                                     04280025
042900             TSHPTPO A                                            04290025
043000         ,   TSHIPMT B                                            04300025
043100         ,   TVHTRIP C                                            04310025
043200         WHERE                                                    04320025
043300               A.PO_NBR          = :DISTHD-ORD-NBR                04330025
043400           AND A.REC_SEQ_NBR     = :DISTHD-RCVR-SEQ-NBR           04340025
043500           AND A.SHIPT_ID        = B.SHIPT_ID                     04350025
043600           AND B.TRIP_ID         = C.TRIP_ID                      04360025
043700     END-EXEC.                                                    04370025
043800                                                                  04380025
043900     EVALUATE TRUE                                                04390025
044000         WHEN SQLCODE = ZERO                                      04400025
044100         WHEN SQLCODE = -811                                      04410025
044200             CONTINUE                                             04420025
044300         WHEN SQLCODE = -904                                      04430025
044400         WHEN SQLCODE = -911                                      04440025
044500         WHEN SQLCODE = -913                                      04450025
044600              PERFORM 8000-CREATE-ERROR-RECORD                    04460025
044700         WHEN SQLCODE = +100                                      04470025
044800             MOVE SPACES              TO VHTRIP-OWNER-SCAC-ID     04480025
044900                                         VHTRIP-VEH-NBR           04490025
045000         WHEN SQLCODE < ZERO                                      04500025
045100             DISPLAY '** ABEND - PCKUT009 **'                     04510025
045200             DISPLAY '** 7300-SHIPMENT-INFO '                     04520025
045300             PERFORM 9200-SQL-ERROR                               04530025
045400         WHEN SQLCODE > ZERO                                      04540025
045500         WHEN SQLWARN0 NOT = SPACES                               04550025
045600             DISPLAY '** ABEND - PCKUT009 **'                     04560025
045700             DISPLAY '** 7300-SHIPMENT-INFO '                     04570025
045800             PERFORM 9300-SQL-WARNING                             04580025
045900     END-EVALUATE.                                                04590025
046000     IF DN-VEH-NBR = -1                                           04600025
046100             MOVE SPACES              TO VHTRIP-OWNER-SCAC-ID     04610025
046200                                         VHTRIP-VEH-NBR           04620025
046300     END-IF.                                                      04630025
046400/                                                                 04640025
046500 7400-ZONE-INFO.                                                  04650025
046600     EXEC SQL                                                     04660025
046700         SELECT C.STR_ZN_ID                                       04670025
046800         INTO :MDSEDP-STR-ZN-ID                                   04680025
046900         FROM TPURCHS A,                                          04690025
047000              TMDSEAR B,                                          04700025
047100              TMDSEDP C                                           04710025
047200         WHERE A.PO_NBR            = :DISTHD-ORD-NBR              04720025
047300         AND   A.VER_STATUS_CDE    = 'A'                          04730025
047400         AND   A.DEPT_NBR          = B.DEPT_NBR                   04740025
047500         AND   B.MDSELV_CDE        = 'DPT'                        04750025
047600         AND   B.OPERCO_NBR        = '03'                         04760025
047700         AND  (B.STRT_DTE         <= CURRENT DATE AND             04770025
047800              B.END_DTE            > CURRENT DATE)                04780025
047900         AND  B.MDSEAR_DKEY        = C.MDSEAR_DKEY                04790025
048000     END-EXEC.                                                    04800025
048100                                                                  04810025
048200     EVALUATE TRUE                                                04820025
048300         WHEN SQLCODE = ZERO                                      04830025
048400             CONTINUE                                             04840025
048500         WHEN SQLCODE = -904                                      04850025
048600         WHEN SQLCODE = -911                                      04860025
048700         WHEN SQLCODE = -913                                      04870025
048800              PERFORM 8000-CREATE-ERROR-RECORD                    04880025
048900         WHEN SQLCODE = +100                                      04890025
049000             MOVE SPACES              TO MDSEDP-STR-ZN-ID         04900025
049100         WHEN SQLCODE < ZERO                                      04910025
049200             DISPLAY '** ABEND - PCKUT009 **'                     04920025
049300             DISPLAY '** 7400-ZONE-INFO '                         04930025
049400             PERFORM 9200-SQL-ERROR                               04940025
049500         WHEN SQLCODE > ZERO                                      04950025
049600         WHEN SQLWARN0 NOT = SPACES                               04960025
049700             DISPLAY '** ABEND - PCKUT009 **'                     04970025
049800             DISPLAY '** 7400-ZONE-INFO '                         04980025
049900             PERFORM 9300-SQL-WARNING                             04990025
050000     END-EVALUATE.                                                05000025
050100                                                                  05010025
050200/                                                                 05020025
050300 7500-LOC-CDE.                                                    05030025
050400     EXEC SQL                                                     05040000
050500         SELECT                                                   05050000
050600             LNE_LOC_CDE                                          05060000
050700         INTO :WKORIN-LNE-LOC-CDE                                 05070025
050800         FROM                                                     05080000
050900               TWKORIN                                            05090000
051000         WHERE                                                    05100000
051100               ORD_NBR          = :DISTHD-ORD-NBR                 05110000
051200          AND  RCVR_SEQ_NBR     = :DISTHD-RCVR-SEQ-NBR            05120025
051300          AND  ORD_LNE_NBR      = 0                               05130000
051400          AND  OPER_UNT_ID      = :DK-OPER-UNT-ID                 05140025
051500          AND  FCLTY_ID         = 1                               05150000
051600          AND  VER_STATUS_CDE   = 'A'                             05160000
051700          AND  STOP_TMST        > :PV-DUMMY-TMST                  05170000
051800      END-EXEC.                                                   05180000
051900                                                                  05190025
052000     EVALUATE TRUE                                                05200025
052100         WHEN SQLCODE = ZERO                                      05210025
052200         WHEN SQLCODE = -811                                      05220025
052300             CONTINUE                                             05230025
052400         WHEN SQLCODE = -904                                      05240025
052500         WHEN SQLCODE = -911                                      05250025
052600         WHEN SQLCODE = -913                                      05260025
052700              PERFORM 8000-CREATE-ERROR-RECORD                    05270025
052800         WHEN SQLCODE = +100                                      05280025
052900             MOVE SPACES              TO WKORIN-LNE-LOC-CDE       05290025
053000         WHEN SQLCODE < ZERO                                      05300025
053100             DISPLAY '** ABEND - PCKUT009 **'                     05310025
053200             DISPLAY '** 7500-LOC-CODE  '                         05320025
053300             PERFORM 9200-SQL-ERROR                               05330025
053400         WHEN SQLCODE > ZERO                                      05340025
053500         WHEN SQLWARN0 NOT = SPACES                               05350025
053600             DISPLAY '** ABEND - PCKUT009 **'                     05360025
053700             DISPLAY '** 7500-LOC-CODE  '                         05370025
053800             PERFORM 9300-SQL-WARNING                             05380025
053900     END-EVALUATE.                                                05390025
054000                                                                  05400025
054100                                                                  05410025
054200 8000-CREATE-ERROR-RECORD.                                        05420025
054300                                                                  05430025
054400     SET  PC004-ERROR-RECORD          TO TRUE.                    05440025
054500                                                                  05450025
054600     WRITE P2L-EXTRACT-RECORD FROM PC004-P2L-EXT-RECORD.          05460025
054700                                                                  05470025
054800     SET PS-TABLE-CONTENTION          TO TRUE.                    05480025
054900                                                                  05490025
055000                                                                  05500025
055100 9000-EOJ-ROUTINE.                                                05510025
055200                                                                  05520025
055300     IF  PS-CURSOR-OPENED-YES                                     05530027
055400         PERFORM 7020-CLOSE-DISTHD-CSR                            05540027
055500     END-IF.                                                      05550027
055600                                                                  05560027
055700     CLOSE P2L-EXTRACT-FILE.                                      05570025
055800                                                                  05580025
055900     DISPLAY SPACES.                                              05590025
056000     DISPLAY SPACES.                                              05600025
056100     DISPLAY SPACES.                                              05610025
056200                                                                  05620025
056300     MOVE PV-TDISTHD-FETCHED          TO PV-DISP-NUM              05630025
056400     DISPLAY 'TDISTHD FETCHED        = '  PV-DISP-NUM             05640025
056500                                                                  05650025
056600     MOVE PV-EXTRACTS-COUNTER         TO PV-DISP-NUM              05660025
056700     DISPLAY 'EXTRACTS WRITTEN       = '  PV-DISP-NUM.            05670025
056800                                                                  05680025
056900 9200-SQL-ERROR.                                                  05690025
057000                                                                  05700025
057100     CLOSE P2L-EXTRACT-FILE.                                      05710025
057200                                                                  05720025
057300     MOVE SQLCODE                     TO SQLCODE2.                05730025
057400     MOVE SQLERRD(3)                  TO SQLERRD3.                05740025
057500                                                                  05750025
057600     DISPLAY '** ABEND **         ** = SQLERROR'.                 05760025
057700     DISPLAY '** PROGRAM          ** = PCKUT009'.                 05770025
057800     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                05780025
057900     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                05790025
058000     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 05800025
058100     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                05810025
058200                                                                  05820025
058300                                                                  05830025
058400     MOVE +4013                       TO ABEND-CODE.              05840025
058500     CALL 'ILBOABN0' USING ABEND-CODE.                            05850025
058600                                                                  05860025
058700 9300-SQL-WARNING.                                                05870025
058800                                                                  05880025
058900     CLOSE P2L-EXTRACT-FILE.                                      05890025
059000                                                                  05900025
059100     DISPLAY '9300-SQL-WARNING'.                                  05910025
059200     MOVE SQLCODE                     TO SQLCODE2.                05920025
059300     MOVE SQLERRD(3)                  TO SQLERRD3.                05930025
059400     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05940025
059500     DISPLAY '** PROGRAM        ** = PCKUT009'.                   05950025
059600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05960025
059700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05970025
059800     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05980025
059900     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  05990025
060000     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06000025
060100     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06010025
060200     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06020025
060300     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06030025
060400     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06040025
060500     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06050025
060600                                                                  06060025
060700     MOVE +4013                       TO ABEND-CODE.              06070025
060800     CALL 'ILBOABN0' USING ABEND-CODE.                            06080025
