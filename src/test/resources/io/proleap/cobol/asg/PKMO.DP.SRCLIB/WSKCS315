000100 TITLE 'W315 - TRIP/WMS SHIPMENT CROSS REFERENCE'.                00010049
000200 IDENTIFICATION DIVISION.                                         00020032
000300 PROGRAM-ID.    WSKCS315.                                         00030049
000400 AUTHOR.        JEAN KURKOWSKI.                                   00040049
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050049
000600 DATE-WRITTEN.  JUNE, 2007.                                       00060049
000700 DATE-COMPILED.                                                   00070049
263627*---------------------------------------------------------------* 00071099
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00072099
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00073099
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00074099
263627*---------------------------------------------------------------* 00075099
CICS  *  CHANGED 11/04/2022    BY BARB SCHULTZ    WR: CHG0278176      * 00076099
CICS  *                                                               * 00077099
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00078099
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00079099
CICS  *---------------------------------------------------------------* 00079399
000800 ENVIRONMENT DIVISION.                                            00080049
000900 DATA DIVISION.                                                   00090049
001000                                                                  00100049
001100 WORKING-STORAGE SECTION.                                         00110049
001200 01  DK-DB2-KEYS.                                                 00120049
001300     05  DK-TRIP-ID                     PIC S9(09)  VALUE ZERO    00130099
001400                                                 COMP.            00140099
001500* JAK 07/2007 - ADD NEW KEY                      COMP.            00150099
001600     05  DK-EXT-SHP-ID                  PIC  X(20).               00160099
001700 01  PC-PROGRAM-CONSTANTS.                                        00170099
001800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'WS315A  '.  00180099
001900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'WSKM315'.   00190099
002000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'WSKCS315'.  00200099
002100     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00210099
002200     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00220099
002300     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +11          00230099
002400                                               COMP SYNC.         00240099
002500     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00250099
002600                                               COMP SYNC.         00260099
002700     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00270099
002800                                               COMP-3.            00280099
002900     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00290099
003000                                               COMP SYNC.         00300099
003100     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00310099
003200                                               COMP-3.            00320099
003300     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00330099
003400     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00340099
003500     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00350099
003600     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00360099
003700     05  PC-NEW                    PIC  X(02)  VALUE 'NW'.        00370099
003800     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00380099
003900     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00390099
004000                                               COMP.              00400099
004100     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             00410099
004200                              '9999-09-09-09.09.09.999999'.       00420099
004300*                                                                 00430099
004400*----------------------------------------------------------------*00440099
004500*  SYSTEM MESSAGES                                               *00450099
004600*----------------------------------------------------------------*00460099
004700*   00005 = INVALID VALUE                                        *00470099
004800*   99901 = INVALID COMMAND WAS ENTERED                          *00480099
004900*----------------------------------------------------------------*00490099
005000     05  PC-TSYMSG-NUMBERS.                                       00500099
005100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00510099
005200         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00520099
005300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00530099
005400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00540099
005500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00550099
005600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00560099
005700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00570099
005800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00580099
005900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00590099
006000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00600099
006100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00610099
006200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00620099
006300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00630099
006400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00640099
006500         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  00650099
006600*                                                                 00660099
006700 01  PS-PROGRAM-SWITCHES.                                         00670099
006800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00680099
006900         88  PS-NO-ERROR                            VALUE 'Y'.    00690099
007000         88  PS-ERROR                               VALUE 'N'.    00700099
007100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00710099
007200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00720099
007300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00730099
007400     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   00740099
007500         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   00750099
007600         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   00760099
007700     05  PS-EOF-WMS-CSR-IND          PIC X(01)  VALUE 'N'.        00770099
007800         88 PS-EOF-WMS-CSR-NO                   VALUE 'N'.        00780099
007900         88 PS-EOF-WMS-CSR-YES                  VALUE 'Y'.        00790099
008000     05  PS-CICS-SWITCH-IND          PIC X(01)  VALUE 'N'.        00800099
008100         88 PS-CICS-SWITCH-NO                   VALUE 'N'.        00810099
008200         88 PS-CICS-SWITCH-YES                  VALUE 'Y'.        00820099
008300* JAK 07/2007 - ADD NEW SWITCH                                    00830099
008400     05  PS-EOF-SKU-CSR-IND          PIC X(01)  VALUE 'N'.        00840099
008500         88 PS-EOF-SKU-CSR-NO                   VALUE 'N'.        00850099
008600         88 PS-EOF-SKU-CSR-YES                  VALUE 'Y'.        00860099
008700*                                                                 00870099
008800*AMIT 07/2007 - ADD NEW SWITCH                                    00880099
008900     05  PS-EOF-CNT-CSR-IND          PIC X(01)  VALUE 'N'.        00890099
009000         88 PS-EOF-CNT-CSR-NO                   VALUE 'N'.        00900099
009100         88 PS-EOF-CNT-CSR-YES                  VALUE 'Y'.        00910099
009101                                                                  00910199
009110     05  PS-ASN-DWNLD-SW             PIC X(01)  VALUE 'N'.        00911099
009120         88 PS-ASN-DWNLD-YES                    VALUE 'Y'.        00912099
009130         88 PS-ASN-DWNLD-NO                     VALUE 'N'.        00913099
009200*                                                                 00920099
009300*                                                                 00930099
009400 01  PV-PROGRAM-VARIABLES.                                        00940099
009500     05  PV-SHIP-TRLR-CRTN-CNT          PIC  S9(9) COMP.          00950099
009510     05  PV-SHIP-TRLR-UNIT-QTY          PIC  S9(9) COMP.          00951099
009511                                                                  00951199
009520     05  PV-ITEMS-HOLD                  PIC S9(03)  COMP-3.       00952099
009600     05  PV-ITEMS-DIFF                  PIC S9(03)  COMP-3.       00960099
009700     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 00970099
009800     05  PV-SRC-TASK-NUMBER             PIC  9(07)  VALUE ZEROES. 00980099
009900     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  00990099
010000                                                    COMP SYNC.    01000099
010100     05  PV-UNION-TYPE                  PIC  X(01).               01010099
010200     05  PV-SUB                         PIC S9(04)  VALUE +0      01020099
010300                                                    COMP SYNC.    01030099
010400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01040099
010500                                                    COMP SYNC.    01050099
010600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01060099
010700                                                    COMP-3.       01070099
010800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01080099
010900                                                    COMP-3.       01090099
011000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01100099
011100                                                    COMP-3.       01110099
011200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01120099
011300                                                    COMP-3.       01130099
011400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01140099
011500                                                    COMP-3.       01150099
011600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01160099
011700                                                    COMP-3.       01170099
011800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01180099
011900                                                    COMP-3.       01190099
012000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01200099
012100                                                    COMP SYNC.    01210099
012200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01220099
012300                                                    COMP SYNC.    01230099
012400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01240099
012500                                                    COMP SYNC.    01250099
012600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01260099
012700                                                    COMP SYNC.    01270099
012800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01280099
012900                                                    COMP SYNC.    01290099
013000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01300099
013100                                                    COMP SYNC.    01310099
013200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01320099
013300                                                    COMP SYNC.    01330099
013400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01340099
013500                                                    COMP SYNC.    01350099
013600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01360099
013700                                                    COMP SYNC.    01370099
013800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380099
013900                                                    COMP SYNC.    01390099
014000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01400099
014100                                                    COMP SYNC.    01410099
014200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01420099
014300                                                    COMP SYNC.    01430099
014400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01440099
014500                                                    COMP SYNC.    01450099
014600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01460099
014700                                                    COMP SYNC.    01470099
014800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01480099
014900                                                     COMP SYNC.   01490099
015000     05  PV-SQL-RETURN-CD                PIC S9(04) VALUE +0.     01500099
015100     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 01510099
015200     05  PV-DISPLAY-1                    PIC -Z(08)9.             01520099
015300     05  PV-DISPLAY                      PIC -Z(03)9.             01530099
015400* JAK 07/2007 - ADD NEW VARIABLES                                 01540099
015500     05  PV-DISPLAY-2                    PIC -Z(08)9.             01550099
015600     05  PV-DISPLAY-3                    PIC -Z(08)9.             01560099
015700     05  PV-DISPLAY-4                    PIC -Z(17)9.             01570099
015710     05  PV-DISPLAY-5                    PIC -9(04)9.             01571099
015720     05  PV-DISPLAY-6                    PIC 999999999.           01572099
015800     05  PV-TOT-UNIT-QTY                 PIC S9(09)  VALUE +0     01580099
015900                                                     COMP.        01590099
016000     05  PV-TOT-CRTN-QTY                 PIC S9(09)  VALUE +0     01600099
016100                                                     COMP.        01610099
016200     05  PV-TOT-EXP-SCAN                 PIC S9(09)  VALUE +0     01620099
016300                                                     COMP.        01630099
016400     05  PV-DB2-COUNT-EXP-SCN           PIC S9(05)  VALUE +0      01640099
016500                                                    COMP.         01650099
016600     05  PV-FINAL-COUNT                 PIC S9(05)  VALUE +0      01660099
016700                                                    COMP.         01670099
016800     05  PV-SHIPT-UNT-ID                PIC  S9(18)V COMP-3.      01680099
016900     05  PV-HOLD-PO-NBR                  PIC S9(09)  VALUE +0     01690099
017000                                                     COMP.        01700099
017100     05  PV-HOLD-RCVR-SEQ-NBR            PIC S9(09)  VALUE +0     01710099
017200                                                     COMP.        01720099
017300                                                                  01730099
017400******************************************************************01740099
017500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01750099
017600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01760099
017700**  APPLICATION-SPECIFIC COMMAREA.                              **01770099
017800******************************************************************01780099
017900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01790099
018000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01800099
018100     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01810099
018200                                        INDEXED BY LQW-IDX.       01820099
018300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01830099
018400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01840099
018500         10  LQW-SELECTED-SW            PIC  X(01).               01850099
018600             88  LQW-SELECT                         VALUE 'S'.    01860099
018700             88  LQW-DESELECT                       VALUE ' '.    01870099
018800         10  LQW-WMS-SHIPMENT           PIC  X(15).               01880099
018900         10  LQW-DWNLD-IND              PIC  X(04).               01890099
019000         10  LQW-DWNLD-DATE             PIC  X(05).               01900099
019100         10  LQW-DWNLD-TIME             PIC  X(05).               01910099
019200         10  LQW-RCPT-DATE              PIC  X(05).               01920099
019300         10  LQW-RCPT-TIME              PIC  X(05).               01930099
019400* JAK 07/2007 - ADD TOTAL UNIT QTY & TOTAL CARTON QTY             01940099
019500         10  LQW-TOT-UNIT-QTY           PIC  9(07).               01950099
019600         10  LQW-TOT-CRTN-QTY           PIC  9(07).               01960099
019700         10  LQW-TOT-EXP-QTY            PIC  9(07).               01970099
019800         10  LQW-CREATE-BY              PIC  X(08).               01980099
019900*---------------------------------------------------------------* 01990099
020000* SELECTION QUEUE LAYOUT                                        * 02000099
020100*---------------------------------------------------------------* 02010099
020200     COPY WSWS011.                                                02020099
020300     COPY SUWS010.                                                02030099
020400                                                                  02040099
020500*---------------------------------------------------------------* 02050099
020600*    MAP LAYOUT                                                 * 02060099
020700*---------------------------------------------------------------* 02070099
020800     COPY WSKM315.                                                02080099
020900*                                                                 02090099
021000 01  MR-OCCURS-LAYOUT                   REDEFINES  WS315AO.       02100099
021100     05  FILLER                         PIC X(121).               02110099
021200     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02120099
021300         10  MR-SELECTL                 PIC S9(04) COMP.          02130099
021400         10  MR-SELECTA                 PIC  X(01).               02140099
021500         10  MR-SELECTC                 PIC  X(01).               02150099
021600         10  MR-SELECTH                 PIC  X(01).               02160099
021700         10  MR-SELECTI                 PIC  X(01).               02170099
021800                                                                  02180099
021900         10  MR-SHIPL                   PIC S9(04) COMP.          02190099
022000         10  MR-SHIPA                   PIC  X(01).               02200099
022100         10  MR-SHIPC                   PIC  X(01).               02210099
022200         10  MR-SHIPH                   PIC  X(01).               02220099
022300         10  MR-SHIP                    PIC  X(15).               02230099
022400                                                                  02240099
022500         10  MR-DNLD-INDL               PIC S9(04) COMP.          02250099
022600         10  MR-DNLD-INDA               PIC  X(01).               02260099
022700         10  MR-DNLD-INDC               PIC  X(01).               02270099
022800         10  MR-DNLD-INDH               PIC  X(01).               02280099
022900         10  MR-DNLD-IND                PIC  X(04).               02290099
023000                                                                  02300099
023100         10  MR-DNLD-DTEL               PIC S9(04) COMP.          02310099
023200         10  MR-DNLD-DTEA               PIC  X(01).               02320099
023300         10  MR-DNLD-DTEC               PIC  X(01).               02330099
023400         10  MR-DNLD-DTEH               PIC  X(01).               02340099
023500         10  MR-DNLD-DTE                PIC  X(05).               02350099
023600                                                                  02360099
023700         10  MR-DNLD-TMEL               PIC S9(04) COMP.          02370099
023800         10  MR-DNLD-TMEA               PIC  X(01).               02380099
023900         10  MR-DNLD-TMEC               PIC  X(01).               02390099
024000         10  MR-DNLD-TMEH               PIC  X(01).               02400099
024100         10  MR-DNLD-TME                PIC  X(05).               02410099
024200                                                                  02420099
024300         10  MR-RCPT-DTEL               PIC S9(04) COMP.          02430099
024400         10  MR-RCPT-DTEA               PIC  X(01).               02440099
024500         10  MR-RCPT-DTEC               PIC  X(01).               02450099
024600         10  MR-RCPT-DTEH               PIC  X(01).               02460099
024700         10  MR-RCPT-DTE                PIC  X(05).               02470099
024800                                                                  02480099
024900         10  MR-RCPT-TMEL               PIC S9(04) COMP.          02490099
025000         10  MR-RCPT-TMEA               PIC  X(01).               02500099
025100         10  MR-RCPT-TMEC               PIC  X(01).               02510099
025200         10  MR-RCPT-TMEH               PIC  X(01).               02520099
025300         10  MR-RCPT-TME                PIC  X(05).               02530099
025400                                                                  02540099
025500* JAK 07/2007 - ADD TOTAL UNIT QTY & TOTAL CARTON QTY             02550099
025600         10  MR-UNIT-QTYL               PIC S9(04) COMP.          02560099
025700         10  MR-UNIT-QTYA               PIC  X(01).               02570099
025800         10  MR-UNIT-QTYC               PIC  X(01).               02580099
025900         10  MR-UNIT-QTYH               PIC  X(01).               02590099
026000         10  MR-UNIT-QTY                PIC  X(07).               02600099
026100                                                                  02610099
026200         10  MR-CRTN-QTYL               PIC S9(04) COMP.          02620099
026300         10  MR-CRTN-QTYA               PIC  X(01).               02630099
026400         10  MR-CRTN-QTYC               PIC  X(01).               02640099
026500         10  MR-CRTN-QTYH               PIC  X(01).               02650099
026600         10  MR-CRTN-QTY                PIC  X(07).               02660099
026700                                                                  02670099
026800         10  MR-EXPD-QTYL               PIC S9(04) COMP.          02680099
026900         10  MR-EXPD-QTYA               PIC  X(01).               02690099
027000         10  MR-EXPD-QTYC               PIC  X(01).               02700099
027100         10  MR-EXPD-QTYH               PIC  X(01).               02710099
027200         10  MR-EXPD-QTY .                                        02720099
027300             15  MR-EXPD-QTY-N              PIC  ZZZZZZ9.         02730099
027400                                                                  02740099
027500         10  MR-CRE-BYL                 PIC S9(04) COMP.          02750099
027600         10  MR-CRE-BYA                 PIC  X(01).               02760099
027700         10  MR-CRE-BYC                 PIC  X(01).               02770099
027800         10  MR-CRE-BYH                 PIC  X(01).               02780099
027900         10  MR-CRE-BY                  PIC  X(08).               02790099
028000                                                                  02800099
028100*---------------------------------------------------------------* 02810099
028200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02820099
028300*---------------------------------------------------------------* 02830099
028400     COPY DPWS015.                                                02840099
028500                                                                  02850099
028600*---------------------------------------------------------------* 02860099
028700*    FUNCTION KEYS COPYBOOK.                                    * 02870099
028800*---------------------------------------------------------------* 02880099
028900     COPY DPWS016.                                                02890099
029000                                                                  02900099
029100*---------------------------------------------------------------* 02910099
029200*    NUMERIC EDIT LAYOUT.                                       * 02920099
029300*---------------------------------------------------------------* 02930099
029400     COPY DPWS010I.                                               02940099
029500                                                                  02950099
029600*----------------------------------------------------------------*02960099
029700**  SECURITY SUBROUTINE PARAMETERS                                02970099
029800*----------------------------------------------------------------*02980099
029900     COPY DPWS008.                                                02990099
030000                                                                  03000099
030100*---------------------------------------------------------------* 03010099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03020099
030300*---------------------------------------------------------------* 03030099
030400     COPY DPWS030.                                                03040099
CICS       COPY DPWS930.                                                03041099
030500                                                                  03050099
030600*---------------------------------------------------------------* 03060099
030700*    STANDARD COMMAREA.                                         * 03070099
030800*---------------------------------------------------------------* 03080099
030900     COPY DPWS020.                                                03090099
031000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03100099
031100                                                                  03110099
031200*---------------------------------------------------------------* 03120099
031300* INTER-APPLICATION COMMAREA.                                   * 03130099
031400*   RCWS012 - IS THE INPUT LAYOUT WHEN COMING FROM THE TRAILER  * 03140099
031500*             CRITERIA SPEC SCREEN                              * 03150099
031600*   SUWS009 - IS THE INPUT LAYOUT WHEN COMING FROM THE SHIPPING * 03160099
031700*             OUTBOUND TRAILER LIST                             * 03170099
031800*   WSWS010 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03180099
031900*             THIS MODULE TO OTHER WS MODULES.                  * 03190099
032000*---------------------------------------------------------------* 03200099
032100                                                                  03210099
032200         10  INTER-APPL-COMM-AREA       PIC X(200).               03220099
032300*        10  INTER-APPL-COMM-AREA       PIC X(207).               03230099
032400     COPY RCWS012.                                                03240099
032500     COPY SUWS009.                                                03250099
032600     COPY WSWS010.                                                03260099
032700*---------------------------------------------------------------* 03270099
032800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03280099
032900*---------------------------------------------------------------* 03290099
033000         10  ASC-SPECIFIC-COMMAREA.                               03300099
033100*  KEYS PASSED FROM CRIT SPEC OR OTHER SCREENS                    03310099
033200             15  ASC-KEY-TRIP-ID             PIC  9(09).          03320099
033300             15  ASC-KEY-VEH-NBR             PIC  9(09).          03330099
033400             15  ASC-OPER-UNT-ID             PIC  X(04).          03340099
033500             15  ASC-OPER-UNT-ID-N REDEFINES                      03350099
033600                     ASC-OPER-UNT-ID         PIC  9(04).          03360099
033700             15  ASC-CARRIER                 PIC  X(04).          03370099
033800             15  ASC-TRAILER                 PIC  X(12).          03380099
033900             15  ASC-TRIP-ID                 PIC  X(09).          03390099
033910             15  ASC-TRIP-TYPE               PIC  X(01).          03391099
033920                 88  ASC-INBD-RCVG                VALUE 'R'.      03392099
033930                 88  ASC-OTBD-SHIP                VALUE 'S'.      03393099
034000             15  ASC-ARRIVAL-DATE            PIC  X(10).          03400099
034100             15  ASC-STATUS-DATE             PIC  X(10).          03410099
034200             15  ASC-USER-ID                 PIC  X(08).          03420099
034300*-----------------------------------------------------------------03430099
034400             15  ASC-BLK-SUB                  PIC S9(04) COMP     03440099
034500                                                         SYNC.    03450099
034600             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03460099
034700                                                         SYNC.    03470099
034800             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03480099
034900             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03490099
035000             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03500099
035100             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03510099
035200             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03520099
035300             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03530099
035400                                                         SYNC.    03540099
035500             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03550099
035600             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03560099
035700             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03570099
035800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03580099
035900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03590099
036000             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03600099
036100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03610099
036200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03620099
036300             15  ASC-LIST-QUEUE-NAME.                             03630099
036400                 20  ASC-LIST-TERM-ID         PIC  X(04).         03640099
036500                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03650099
036600                                                                  03660099
036700             15  ASC-START-ITEM-REQUEST.                          03670099
036800                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03680099
036900                                                                  03690099
037000             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03700099
037100             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03710099
037200             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03720099
037300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03730099
037400             15  ASC-SEL-QUEUE-NAME.                              03740099
037500                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         03750099
037600                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  03760099
037700                 20  ASC-SEL-SEQ              PIC  9(01).         03770099
037800             15  ASC-SEL-QUEUE-NAME-IN.                           03780099
037900                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         03790099
038000                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  03800099
038100                 20  ASC-SEL-SEQ              PIC  9(01).         03810099
038200             15  ASC-SEL-QUEUE-NAME-OUT.                          03820099
038300                 20  ASC-SEL-TERM-ID-OUT      PIC  X(04).         03830099
038400                 20  ASC-SEL-TASK-NUMBER-OUT  PIC S9(05) COMP-3.  03840099
038500                 20  ASC-SEL-SEQ              PIC  9(01).         03850099
038600             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03860099
038700             15  ASC-TOTAL-UNT-CNT            PIC S9(09) COMP-3.  03870099
038800             15  ASC-TOTAL-CRT-CNT            PIC S9(09) COMP-3.  03880099
038900             15  ASC-TOTAL-SSCC-CNT           PIC S9(09) COMP-3.  03890099
039000                                                                  03900099
039100*-----------------------------------------------------------------03910099
039200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03920099
039300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03930099
039400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03940099
039500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03950099
039600                                                                  03960099
039700                 20  ASC-ITEM-ARRAY.                              03970099
039800                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03980099
039900                         30  ASC-LIST-ITEM-NUMBER                 03990099
040000                                                     PIC S9(09)   04000099
040100                                                     COMP-3.      04010099
040200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04020099
040300                             88  ASC-VALID-SELECT    VALUE ' '    04030099
040400                                                           'S'    04040099
040500                                                           'B'    04050099
040600                                                           'E'.   04060099
040700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04070099
040800                             88  ASC-TEMP-SELECT     VALUE 'S'.   04080099
040900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04090099
041000                             88  ASC-TEMP-END        VALUE 'E'.   04100099
041100                         30  ASC-SELECTED-SW         PIC  X(01).  04110099
041200                             88  ASC-NO-SELECT       VALUE ' '.   04120099
041300                             88  ASC-SELECT          VALUE 'S'.   04130099
041400                             88  ASC-BEGIN           VALUE 'B'.   04140099
041500                             88  ASC-END             VALUE 'E'.   04150099
041600                         30  ASC-SCREEN-SHIP         PIC  X(15).  04160099
041700                         30  ASC-SCREEN-DNLD-IND     PIC  X(04).  04170099
041800                         30  ASC-SCREEN-DNLD-DTE     PIC  X(05).  04180099
041900                         30  ASC-SCREEN-DNLD-TME     PIC  X(05).  04190099
042000                         30  ASC-SCREEN-RCPT-DTE     PIC  X(05).  04200099
042100                         30  ASC-SCREEN-RCPT-TME     PIC  X(05).  04210099
042200* JAK 07/2007 - ADD TOTAL UNIT QTY & TOTAL CARTON QTY             04220099
042300                         30  ASC-SCREEN-UNIT-QTY     PIC ZZZZZZ9. 04230099
042400                         30  ASC-SCREEN-CRTN-QTY     PIC ZZZZZZ9. 04240099
042500                         30  ASC-SCREEN-EXP-QTY      PIC ZZZZZZ9. 04250099
042600                         30  ASC-SCREEN-CRE-BY       PIC  X(08).  04260099
042700*                        30  ASC-SCREEN-COUNT        PIC  X(01).  04270099
042800                                                                  04280099
042900*---------------------------------------------------------------* 04290099
043000*    ABEND PROCESSING COPYBOOK.                                 * 04300099
043100*---------------------------------------------------------------* 04310099
043200     COPY DPWS013.                                                04320099
043300                                                                  04330099
043400*---------------------------------------------------------------* 04340099
043500*    WMS SHIPMENT CROSS REFERENCE HEADER - WST_SHPMT_XREF_HDR     04350099
043600*---------------------------------------------------------------* 04360099
043700     EXEC SQL                                                     04370099
043800          INCLUDE WST00001                                        04380099
043900     END-EXEC.                                                    04390099
044000                                                                  04400099
044100* JAK 07/2007 - ADD NEW TABLES                                    04410099
044200*---------------------------------------------------------------* 04420099
044300*    WMS SHIPMENT CROSS REFERENCE DETAIL - WST_SHPMT_XREF_DTL     04430099
044400*---------------------------------------------------------------* 04440099
044500     EXEC SQL                                                     04450099
044600          INCLUDE WST00002                                        04460099
044700     END-EXEC.                                                    04470099
044800                                                                  04480099
044900*---------------------------------------------------------------* 04490099
045000*    RECEIVER ITEM TABLE - TRECITM                                04500099
045100*---------------------------------------------------------------* 04510099
045200     EXEC SQL                                                     04520099
045300          INCLUDE TRECITM                                         04530099
045400     END-EXEC.                                                    04540099
045500                                                                  04550099
045600*---------------------------------------------------------------* 04560099
045700*    RECEIVER TABLE - TRECEIV                                     04570099
045800*---------------------------------------------------------------* 04580099
045900     EXEC SQL                                                     04590099
046000          INCLUDE TRECEIV                                         04600099
046100     END-EXEC.                                                    04610099
046200* JAK 07/2007 - END NEW TABLES                                    04620099
046300                                                                  04630099
046400*---------------------------------------------------------------* 04640099
046500*    WST_ATTR_ELEM                                                04650099
046600*---------------------------------------------------------------* 04660099
046700     EXEC SQL                                                     04670099
046800          INCLUDE WST00010                                        04680099
046900     END-EXEC.                                                    04690099
047000                                                                  04700099
047100*---------------------------------------------------------------* 04710099
047200*    WST_ATTR_DEFN                                                04720099
047300*---------------------------------------------------------------* 04730099
047400     EXEC SQL                                                     04740099
047500          INCLUDE WST00009                                        04750099
047600     END-EXEC.                                                    04760099
047700                                                                  04770099
047800*---------------------------------------------------------------* 04780099
047900*    WST_INTGRTN_TYP                                              04790099
048000*---------------------------------------------------------------* 04800099
048100     EXEC SQL                                                     04810099
048200          INCLUDE WST00008                                        04820099
048300     END-EXEC.                                                    04830099
048400**AMIT                                                            04840099
048500*---------------------------------------------------------------* 04850099
048600*    AMIT INCLUDED TABLES                                         04860099
048700*---------------------------------------------------------------* 04870099
048800     EXEC SQL                                                     04880099
048900          INCLUDE TSHIPMT                                         04890099
049000     END-EXEC.                                                    04900099
049100     EXEC SQL                                                     04910099
049200          INCLUDE TSHPTPO                                         04920099
049300     END-EXEC.                                                    04930099
049400     EXEC SQL                                                     04940099
049500          INCLUDE TPKSLIP                                         04950099
049600     END-EXEC.                                                    04960099
049700     EXEC SQL                                                     04970099
049800          INCLUDE TINPKSU                                         04980099
049900     END-EXEC.                                                    04990099
050000     EXEC SQL                                                     05000099
050100          INCLUDE TSHPUNT                                         05010099
050200     END-EXEC.                                                    05020099
050300     EXEC SQL                                                     05030099
050400          INCLUDE TSHUUPC                                         05040099
050500     END-EXEC.                                                    05050099
050600**AMIT                                                            05060099
050610*---------------------------------------------------------------* 05061099
050620*    WST_ASN_DWNLD                                                05062099
050630*---------------------------------------------------------------* 05063099
050640     EXEC SQL                                                     05064099
050650          INCLUDE WST00011                                        05065099
050660     END-EXEC.                                                    05066099
050670                                                                  05067099
050680*---------------------------------------------------------------* 05068099
050690*    SUT_TRIP_SUM                                                 05069099
050691*---------------------------------------------------------------* 05069199
050692     EXEC SQL                                                     05069299
050693          INCLUDE SUT00007                                        05069399
050694     END-EXEC.                                                    05069499
050695                                                                  05069599
050700*---------------------------------------------------------------* 05070099
050800*    DB2 AREA FOR COMMUNICATIONS                                * 05080099
050900*---------------------------------------------------------------* 05090099
051000     EXEC SQL                                                     05100099
051100          INCLUDE SQLCA                                           05110099
051200     END-EXEC.                                                    05120099
051300                                                                  05130099
051400*---------------------------------------------------------------* 05140099
051500*    WMS SHIPMENT CURSOR                                          05150099
051600*---------------------------------------------------------------* 05160099
051700     EXEC SQL                                                     05170099
051800          DECLARE WMS-SHIP-CSR CURSOR FOR                         05180099
051900              SELECT  EXT_SHP_ID                                  05190099
052000                     ,DWNLD_CDE                                   05200099
052100                     ,DWNLD_TMST                                  05210099
052200                     ,RCPT_TMST                                   05220099
052300                     ,CRE_USR_ID                                  05230099
052400                FROM  WST_SHPMT_XREF_HDR                          05240099
052500               WHERE  INTR_TRIP_ID        =  :DK-TRIP-ID          05250099
052600            ORDER BY  EXT_SHP_ID                                  05260099
052700     END-EXEC.                                                    05270099
052800                                                                  05280099
052900                                                                  05290099
053000* JAK 07/2007 - ADD CURSOR                                        05300099
053100*---------------------------------------------------------------* 05310099
053200*    SKU DETAIL CURSOR                                            05320099
053300*---------------------------------------------------------------* 05330099
053400     EXEC SQL                                                     05340099
053500          DECLARE SKU-DTL-CSR CURSOR FOR                          05350099
053600              SELECT  PO_NBR                                      05360099
053700                     ,PO_LNE_NBR                                  05370099
053800                     ,RCVR_SEQ_NBR                                05380099
053900                     ,ASN_LVL_CDE                                 05390099
054000                     ,PREPK_ID                                    05400099
054100                FROM  WST_SHPMT_XREF_DTL                          05410099
054200               WHERE  EXT_SHP_ID       = :DK-EXT-SHP-ID           05420099
054300*                AND  DWNLD_CDE       <> 'T'                      05430099
054400                 AND  ACTV_CDE         = 'A'                      05440099
054500            ORDER BY  PO_NBR, RCVR_SEQ_NBR, PO_LNE_NBR            05450099
054600     END-EXEC.                                                    05460099
054700                                                                  05470099
054800* JAK 07/2007 - END CURSOR                                        05480099
054900                                                                  05490099
055000*AMIT 07/2007 - ADD CURSOR                                        05500099
055100*---------------------------------------------------------------* 05510099
055200*    TOTAL COUNT CURSOR                                           05520099
055300*---------------------------------------------------------------* 05530099
055400     EXEC SQL                                                     05540099
055500          DECLARE TOT-CNT-CSR CURSOR FOR                          05550099
055600             SELECT  DISTINCT(E.SHIPT_UNT_ID)                     05560099
055700             FROM   TSHIPMT A                                     05570099
055800                   ,TSHPTPO B                                     05580099
055900                   ,TPKSLIP C                                     05590099
056000                   ,TINPKSU D                                     05600099
056100                   ,TSHPUNT E                                     05610099
056200             WHERE A.TRIP_ID = :DK-TRIP-ID                        05620099
056300             AND B.PO_NBR   = :WST00002-PO-NBR                    05630099
056400             AND B.REC_SEQ_NBR = :WST00002-RCVR-SEQ-NBR           05640099
056500             AND B.PO_NBR   = C.PO_NBR                            05650099
056600             AND B.REC_SEQ_NBR = C.REC_SEQ_NBR                    05660099
056700             AND B.PRIM_SHIPT_IND= 'Y'                            05670099
056800             AND C.VER_STAT_CDE = 'A'                             05680099
056900             AND B.PO_NBR   = D.PO_NBR                            05690099
057000             AND D.SEQ_NBR   = C.SEQ_NBR                          05700099
057100             AND A.SHIPT_ID = B.SHIPT_ID                          05710099
057200             AND D.SHIPT_UNT_ID = E.SHIPT_UNT_ID                  05720099
057300             AND E.ACTV_IND = 'A'                                 05730099
057400     END-EXEC.                                                    05740099
057500                                                                  05750099
057600*AMIT 07/2007 - END CURSOR                                        05760099
057700                                                                  05770099
057800                                                                  05780099
057900*-----------------------------------------------------------------05790099
058000 LINKAGE SECTION.                                                 05800099
058100                                                                  05810099
058200 01  DFHCOMMAREA.                                                 05820099
058300     05  FILLER                         OCCURS  1 TO 4072 TIMES   05830099
058400                                        DEPENDING ON EIBCALEN.    05840099
058500         10  FILLER                     PIC X.                    05850099
058600                                                                  05860099
058700                                                                  05870099
058800 PROCEDURE DIVISION.                                              05880099
058900                                                                  05890099
059000 0000-MAIN-MODULE.                                                05900099
059100     MOVE DP020-SRC-TASK-NUMBER     TO PV-SRC-TASK-NUMBER.        05910099
059200     PERFORM 0520-CICS-LOGGING.                                   05920099
059300     IF PS-CICS-SWITCH-YES                                        05930099
059400         INITIALIZE PV-CICS-MSG-AREA                              05940099
059500         STRING ' ' PV-SRC-TASK-NUMBER                            05950099
059600                ' WSKCS315-0000: STARTED PROGRAM'                 05960099
059700                DELIMITED BY SIZE                                 05970099
059800                          INTO PV-CICS-MSG-AREA                   05980099
059900         PERFORM 7000-WRITE-TO-CICS-LOG                           05990099
060000     END-IF.                                                      06000099
060100*                                                                 06010099
060200     INITIALIZE DP030-CICS-API-FIELDS.                            06020099
060300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06030099
060400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06040099
060500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06050099
060600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06060099
060700     MOVE LENGTH OF WS315AI        TO DP030-MAP-LENGTH (1).       06070099
060800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06080099
060900     IF PS-CICS-SWITCH-YES                                        06090099
061000         INITIALIZE PV-CICS-MSG-AREA                              06100099
061100         STRING ' ' PV-SRC-TASK-NUMBER                            06110099
061200                ' WSKCS315-0000: PROGRAM ENTRY CALL'              06120099
061300                ' MAPSET=' PC-CURRENT-MAPSET-NAME                 06130099
061400                ' MAP=' PC-CURRENT-MAP-NAME                       06140099
061500                DELIMITED BY SIZE                                 06150099
061600                          INTO PV-CICS-MSG-AREA                   06160099
061700         PERFORM 7000-WRITE-TO-CICS-LOG                           06170099
061800     END-IF.                                                      06180099
061900*                                                                 06190099
062000     PERFORM 0001-CALL-CICS-ARCH-API.                             06200099
062100*                                                                 06210099
062200     PERFORM 1000-CONTROL-PROCESSING                              06220099
062300*                                                                 06230099
062400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06240099
062500     IF PS-CICS-SWITCH-YES                                        06250099
062600         INITIALIZE PV-CICS-MSG-AREA                              06260099
062700         STRING ' ' PV-SRC-TASK-NUMBER                            06270099
062800                ' WSKCS315-0000: PROGRAM EXIT CALL'               06280099
062900                DELIMITED BY SIZE                                 06290099
063000                          INTO PV-CICS-MSG-AREA                   06300099
063100         PERFORM 7000-WRITE-TO-CICS-LOG                           06310099
063200     END-IF.                                                      06320099
063300*                                                                 06330099
063400     PERFORM 0001-CALL-CICS-ARCH-API.                             06340099
063500                                                                  06350099
063600******************************************************************06360099
063700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06370099
063800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06380099
063900******************************************************************06390099
064000 0001-CALL-CICS-ARCH-API.                                         06400099
064100     IF PS-CICS-SWITCH-YES                                        06410099
064200         INITIALIZE PV-CICS-MSG-AREA                              06420099
064300         STRING ' ' PV-SRC-TASK-NUMBER                            06430099
064400                ' WSKCS315-0001'                                  06440099
064500                DELIMITED BY SIZE                                 06450099
064600                          INTO PV-CICS-MSG-AREA                   06460099
064700         PERFORM 7000-WRITE-TO-CICS-LOG                           06470099
064800     END-IF.                                                      06480099
064900*                                                                 06490099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06500099
065100                                    DFHCOMMAREA                   06510099
065200                                    DP030-CICS-API-FIELDS         06520099
065300                                    DP020-STANDARD-COMMAREA       06530099
065400                                    WS315AI.                      06540099
065500*                                                                 06550099
065600     IF DP030-RC-CALL-SUCCESSFUL                                  06560099
065700         CONTINUE                                                 06570099
065800     ELSE                                                         06580099
065900         SET DP013-NO-ROLLBACK                                    06590099
066000             DP013-XCTL-DISPLAY-RESTART                           06600099
066100             DP013-CICS-ABEND      TO TRUE                        06610099
066200         MOVE '0001-CALL-CICS-ARCH-API'                           06620099
066300                                   TO DP013-PARAGRAPH             06630099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06640099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06650099
066600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06660099
066700         PERFORM DP013-0000-PROCESS-ABEND                         06670099
066800     END-IF.                                                      06680099
066900                                                                  06690099
067000     MOVE DP020-SRC-TASK-NUMBER     TO PV-SRC-TASK-NUMBER.        06700099
067100                                                                  06710099
067200 0520-CICS-LOGGING.                                               06720099
067300                                                                  06730099
067400* READ PARM TO DETERMINE CICS LOGGING                             06740099
067500     EXEC SQL                                                     06750099
067600         SELECT  D.ATTR_ELEM_TXT                                  06760099
067700         INTO  :PS-CICS-SWITCH-IND                                06770099
067800         FROM   WST_INTGRTN_TYP A                                 06780099
067900              , WST_ATTR_DEFN   B                                 06790099
068000              , WST_ATTR_ELEM   C                                 06800099
068100              , WST_ATTR_ELEM   D                                 06810099
068200         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   06820099
068300           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           06830099
068400           AND  B.ATTR_DEFN_SEQ_NBR = 1                           06840099
068500           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           06850099
068600           AND  C.ATTR_DEFN_SEQ_NBR = 1                           06860099
068700           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           06870099
068800           AND  D.ATTR_DEFN_SEQ_NBR = 2                           06880099
068900           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         06890099
069000           AND  C.ATTR_ELEM_TXT     = 'WSKCS315'                  06900099
069100     END-EXEC.                                                    06910099
069200                                                                  06920099
069300     EVALUATE TRUE                                                06930099
069400         WHEN SQLCODE = ZERO                                      06940099
069500             IF PS-CICS-SWITCH-YES                                06950099
069600                 INITIALIZE PV-CICS-MSG-AREA                      06960099
069700                 STRING   ' ' PV-SRC-TASK-NUMBER                  06970099
069800                          ' WSKCS315-0520:'                       06980099
069900                          ' CICS LOGGING: '                       06990099
070000                          PS-CICS-SWITCH-IND                      07000099
070100                          DELIMITED BY SIZE                       07010099
070200                          INTO PV-CICS-MSG-AREA                   07020099
070300                 PERFORM 7000-WRITE-TO-CICS-LOG                   07030099
070400             END-IF                                               07040099
070500         WHEN SQLCODE = -904                                      07050099
070600         WHEN SQLCODE = -913                                      07060099
070700         WHEN SQLCODE = -911                                      07070099
070800         WHEN SQLCODE = -803                                      07080099
070900             CONTINUE                                             07090099
071000         WHEN SQLWARN0 NOT = SPACES                               07100099
071100         WHEN SQLCODE NOT = ZERO                                  07110099
071200             INITIALIZE PV-CICS-MSG-AREA                          07120099
071300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       07130099
071400             STRING   ' ' PV-SRC-TASK-NUMBER                      07140099
071500                      ' WSKCS315-0520 ERROR:'                     07150099
071600                      ' SQL='                                     07160099
071700                      PV-SQL-RETURN-CD                            07170099
071800                      DELIMITED BY SIZE                           07180099
071900                                      INTO PV-CICS-MSG-AREA       07190099
072000             PERFORM 7000-WRITE-TO-CICS-LOG                       07200099
072100                                                                  07210099
072200             STRING 'SQL='                                        07220099
072300                  PV-SQL-RETURN-CD                                07230099
072400                  DELIMITED BY SIZE                               07240099
072500                                      INTO DP013-MESSAGE-TEXT(1)  07250099
072600             MOVE SQLCA                 TO DP013-SQLCA            07260099
072700             MOVE '0520-CICS-LOGGING'   TO DP013-PARAGRAPH        07270099
072800             MOVE 'WST_INTGRTN_TYP'     TO                        07280099
072900                                       DP013-DB2-TABLE-NAME (1)   07290099
073000             MOVE 'WST_ATTR_DEFN'       TO                        07300099
073100                                       DP013-DB2-TABLE-NAME (2)   07310099
073200             MOVE 'WST_ATTR_ELEM'       TO                        07320099
073300                                       DP013-DB2-TABLE-NAME (3)   07330099
073400             SET DP013-DB2-ABEND        TO TRUE                   07340099
073500             PERFORM DP013-0000-PROCESS-ABEND                     07350099
073600                                                                  07360099
073700     END-EVALUATE.                                                07370099
073800                                                                  07380099
073900*----------------------------------------------------------------*07390099
074000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07400099
074100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07410099
074200*                                                                *07420099
074300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07430099
074400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07440099
074500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07450099
074600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07460099
074700*----------------------------------------------------------------*07470099
074800                                                                  07480099
074900 1000-CONTROL-PROCESSING.                                         07490099
075000                                                                  07500099
075100     IF PS-CICS-SWITCH-YES                                        07510099
075200         INITIALIZE PV-CICS-MSG-AREA                              07520099
075300         STRING ' ' PV-SRC-TASK-NUMBER                            07530099
075400                ' WSKCS315-1000'                                  07540099
075500                DELIMITED BY SIZE                                 07550099
075600                          INTO PV-CICS-MSG-AREA                   07560099
075700         PERFORM 7000-WRITE-TO-CICS-LOG                           07570099
075800     END-IF.                                                      07580099
075900*                                                                 07590099
076000     EVALUATE TRUE                                                07600099
076100         WHEN DP020-NEXT-ACT-INITIAL                              07610099
076200             INITIALIZE ASC-SPECIFIC-COMMAREA                     07620099
076300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07630099
076400                                      ASC-SEL-TERM-ID-OUT         07640099
076500             MOVE DP020-SRC-TASK-NUMBER                           07650099
076600                                   TO ASC-LIST-TASK-NUMBER        07660099
076700                                      ASC-SEL-TASK-NUMBER-OUT     07670099
076800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07680099
076900             IF PS-COMMAREA-NOT-VALID                             07690099
077000                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            07700099
077100             ELSE                                                 07710099
077200                 PERFORM 4000-BUILD-INITIAL-PANEL                 07720099
077300             END-IF                                               07730099
077400                                                                  07740099
077500         WHEN DP020-NEXT-ACT-READ-MAP                             07750099
077600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07760099
077700             PERFORM 2000-PROCESS-PANEL                           07770099
077800                                                                  07780099
077900         WHEN DP020-NEXT-ACT-RETURN                               07790099
078000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07800099
078100                                   TO PV-TOP-ITEM                 07810099
078200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07820099
078300                                                                  07830099
078400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07840099
078500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07850099
078600*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07860099
078700                                                                  07870099
078800         WHEN OTHER                                               07880099
078900             SET DP013-LOGIC-ABEND TO TRUE                        07890099
079000             SET DP013-NO-ROLLBACK TO TRUE                        07900099
079100             MOVE '1000-CONTROL-PROCESSING'                       07910099
079200                                   TO DP013-PARAGRAPH             07920099
079300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07930099
079400                                   TO DP013-MESSAGE-TEXT(1)       07940099
079500             PERFORM DP013-0000-PROCESS-ABEND                     07950099
079600     END-EVALUATE.                                                07960099
079700                                                                  07970099
079800 EJECT                                                            07980099
079900*----------------------------------------------------------------*07990099
080000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *08000099
080100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *08010099
080200*----------------------------------------------------------------*08020099
080300                                                                  08030099
080400 1100-PROCESS-INTER-APPL-COMM.                                    08040099
080500                                                                  08050099
080600     IF PS-CICS-SWITCH-YES                                        08060099
080700         INITIALIZE PV-CICS-MSG-AREA                              08070099
080800         STRING ' ' PV-SRC-TASK-NUMBER                            08080099
080900                ' WSKCS315-1100'                                  08090099
081000                DELIMITED BY SIZE                                 08100099
081100                          INTO PV-CICS-MSG-AREA                   08110099
081200         PERFORM 7000-WRITE-TO-CICS-LOG                           08120099
081300     END-IF.                                                      08130099
081400*                                                                 08140099
081500     SET PS-COMMAREA-VALID        TO TRUE.                        08150099
081600     MOVE SPACE                   TO ASC-START-ITEM-REQUEST.      08160099
081700                                                                  08170099
081800     IF DP020-INT-APPL-FORMAT-IND = 3                             08180099
081900*                          FROM RCKCS224                          08190099
082000         MOVE RC012-SEL-QUEUE-NAME    TO ASC-SEL-QUEUE-NAME-IN    08200099
082100         MOVE RC012-TRIP-ID           TO ASC-KEY-TRIP-ID          08210099
082200                                         DK-TRIP-ID               08220099
082300                                         ASC-TRIP-ID              08230099
082400         MOVE RC012-OWNER-SCAC-ID     TO ASC-CARRIER              08240099
082500         MOVE RC012-VEH-NBR           TO ASC-TRAILER              08250099
082600         MOVE RC012-ARRIVAL-DTE       TO ASC-ARRIVAL-DATE         08260099
082610         SET  ASC-INBD-RCVG           TO TRUE                     08261099
082700     ELSE                                                         08270099
082800*                          FROM SUKCS559                          08280099
082900         MOVE SU009-SEL-QUEUE-NAME    TO ASC-SEL-QUEUE-NAME       08290099
083000         MOVE SU009-TRIP-ID           TO ASC-KEY-TRIP-ID          08300099
083100                                         DK-TRIP-ID               08310099
083200                                         ASC-TRIP-ID              08320099
083300         MOVE SU009-SCAC-CDE          TO ASC-CARRIER              08330099
083400         MOVE SU009-TRLR-ID           TO ASC-TRAILER              08340099
083500         MOVE SU009-STATUS-DATE       TO ASC-ARRIVAL-DATE         08350099
083510         SET  ASC-OTBD-SHIP           TO TRUE                     08351099
083600         MOVE SU009-NUMBER-OF-SELECTED-ITEMS TO                   08360099
083700                                      ASC-NUMBER-OF-SELECTED-ITEMS08370099
083800         MOVE SU009-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  08380099
083900         MOVE SPACES                   TO ASC-SEL-QUEUE-NAME-OUT  08390099
084000         PERFORM 1120-PREPARE-LIST-ENTRY                          08400099
084100     END-IF.                                                      08410099
084200/                                                                 08420099
084300*-----------------------------------------------------------------08430099
084400 1120-PREPARE-LIST-ENTRY.                                         08440099
084500                                                                  08450099
084600     IF PS-CICS-SWITCH-YES                                        08460099
084700         INITIALIZE PV-CICS-MSG-AREA                              08470099
084800         STRING ' ' PV-SRC-TASK-NUMBER                            08480099
084900                ' WSKCS315-1120'                                  08490099
085000                DELIMITED BY SIZE                                 08500099
085100                          INTO PV-CICS-MSG-AREA                   08510099
085200         PERFORM 7000-WRITE-TO-CICS-LOG                           08520099
085300     END-IF.                                                      08530099
085400                                                                  08540099
085500     MOVE SU010-MAX-ITEMS          TO ASC-SEL-SUB.                08550099
085600     MOVE ZERO                     TO ASC-SEL-ITEM.               08560099
085700     PERFORM 1130-GET-NEXT-RECORD.                                08570099
085800                                                                  08580099
085900*-----------------------------------------------------------------08590099
086000                                                                  08600099
086100*-----------------------------------------------------------------08610099
086200*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*08620099
086300*-----------------------------------------------------------------08630099
086400 1130-GET-NEXT-RECORD.                                            08640099
086500                                                                  08650099
086600     IF PS-CICS-SWITCH-YES                                        08660099
086700         INITIALIZE PV-CICS-MSG-AREA                              08670099
086800         STRING ' ' PV-SRC-TASK-NUMBER                            08680099
086900                ' WSKCS315-1130'                                  08690099
087000                DELIMITED BY SIZE                                 08700099
087100                          INTO PV-CICS-MSG-AREA                   08710099
087200         PERFORM 7000-WRITE-TO-CICS-LOG                           08720099
087300     END-IF.                                                      08730099
087400                                                                  08740099
087500     ADD +1                       TO ASC-SEL-SUB.                 08750099
087600                                                                  08760099
087700     IF  ASC-SEL-SUB > SU010-MAX-ITEMS                            08770099
087800         ADD +1                   TO ASC-SEL-ITEM                 08780099
087900         MOVE +1                  TO ASC-SEL-SUB                  08790099
088000     END-IF.                                                      08800099
088100                                                                  08810099
088200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                08820099
088300         PERFORM 9100-READ-SEL-QUEUE                              08830099
088400         IF SU010-ITEM (ASC-SEL-SUB) > ZERO                       08840099
088500             SET SU010-INQ (ASC-SEL-SUB) TO TRUE                  08850099
088600             PERFORM 9200-REWRITE-SEL-QUEUE                       08860099
088700         ELSE                                                     08870099
088800             SUBTRACT +1 FROM ASC-SEL-SUB                         08880099
088900             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             08890099
089000             SET DP020-MSG-INFORMATIONAL TO TRUE                  08900099
089100         END-IF                                                   08910099
089200     ELSE                                                         08920099
089300         SUBTRACT +1 FROM ASC-SEL-ITEM                            08930099
089400         MOVE SU010-MAX-ITEMS     TO ASC-SEL-SUB                  08940099
089500         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             08950099
089600         SET DP020-MSG-INFORMATIONAL TO TRUE                      08960099
089700     END-IF.                                                      08970099
089800                                                                  08980099
089900                                                                  08990099
090000*----------------------------------------------------------------*09000099
090100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *09010099
090200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *09020099
090300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *09030099
090400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *09040099
090500* FUNCTION KEYS CAN GET THIS FAR.                                *09050099
090600*----------------------------------------------------------------*09060099
090700 2000-PROCESS-PANEL.                                              09070099
090800                                                                  09080099
090900     IF PS-CICS-SWITCH-YES                                        09090099
091000         INITIALIZE PV-CICS-MSG-AREA                              09100099
091100         STRING ' ' PV-SRC-TASK-NUMBER                            09110099
091200                ' WSKCS315-2000'                                  09120099
091300                DELIMITED BY SIZE                                 09130099
091400                          INTO PV-CICS-MSG-AREA                   09140099
091500         PERFORM 7000-WRITE-TO-CICS-LOG                           09150099
091600     END-IF.                                                      09160099
091700*                                                                 09170099
091800     EVALUATE TRUE                                                09180099
091900         WHEN DP020-SRC-AID = DP016-CLEAR                         09190099
092000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09200099
092100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09210099
092200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09220099
092300                                                                  09230099
092400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09240099
092500             PERFORM 2050-DELETE-LIST-QUEUE                       09250099
092600             PERFORM 4000-BUILD-INITIAL-PANEL                     09260099
092700                                                                  09270099
092800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    09280099
092900             PERFORM 2140-DESELECT-ALL-ITEMS                      09290099
093000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09300099
093100*F21                                                              09310099
093200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  09320099
093300             PERFORM 2150-SELECT-ALL-ITEMS                        09330099
093400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09340099
093500                                                                  09350099
093600         WHEN OTHER                                               09360099
093700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09370099
093800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09380099
093900             IF PS-NO-ERROR                                       09390099
094000                 SET DP030-CONTINUE-GO                            09400099
094100                                 TO TRUE                          09410099
094200                 PERFORM 2100-CHECK-FUNCTION-KEY                  09420099
094300             ELSE                                                 09430099
094400                 SET DP030-OVERRIDE-GO                            09440099
094500                                 TO TRUE                          09450099
094600             END-IF                                               09460099
094700     END-EVALUATE.                                                09470099
094800 EJECT                                                            09480099
094900*----------------------------------------------------------------*09490099
095000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09500099
095100*----------------------------------------------------------------*09510099
095200 2050-DELETE-LIST-QUEUE.                                          09520099
095300                                                                  09530099
095400     IF PS-CICS-SWITCH-YES                                        09540099
095500         INITIALIZE PV-CICS-MSG-AREA                              09550099
095600         STRING ' ' PV-SRC-TASK-NUMBER                            09560099
095700                ' WSKCS315-2050'                                  09570099
095800                ' DELETE QUEUE=' ASC-LIST-QUEUE-NAME              09580099
095900                DELIMITED BY SIZE                                 09590099
096000                          INTO PV-CICS-MSG-AREA                   09600099
096100         PERFORM 7000-WRITE-TO-CICS-LOG                           09610099
096200     END-IF.                                                      09620099
096300*                                                                 09630099
096400     EXEC CICS                                                    09640099
096500         DELETEQ TS                                               09650099
096600             QUEUE (ASC-LIST-QUEUE-NAME)                          09660099
096700             RESP  (PV-CICS-RESP)                                 09670099
096800     END-EXEC.                                                    09680099
096900                                                                  09690099
097000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09700099
097100        (PV-CICS-RESP = DFHRESP(QIDERR))                          09710099
097200         CONTINUE                                                 09720099
097300     ELSE                                                         09730099
097400         SET DP013-CICS-ABEND      TO TRUE                        09740099
097500         SET DP013-NO-ROLLBACK     TO TRUE                        09750099
097600                                                                  09760099
097700         MOVE '2050-DELETE-LIST-QUEUE'                            09770099
097800                                   TO DP013-PARAGRAPH             09780099
097900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09790099
098000                                   TO DP013-MESSAGE-TEXT (1)      09800099
098100         PERFORM DP013-0000-PROCESS-ABEND                         09810099
098200     END-IF.                                                      09820099
098300                                                                  09830099
098400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09840099
098500/                                                                 09850099
098600*----------------------------------------------------------------*09860099
098700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09870099
098800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09880099
098900* CICS ARCHITECTURE API.                                         *09890099
099000*----------------------------------------------------------------*09900099
099100 2100-CHECK-FUNCTION-KEY.                                         09910099
099200                                                                  09920099
099300     IF PS-CICS-SWITCH-YES                                        09930099
099400         INITIALIZE PV-CICS-MSG-AREA                              09940099
099500         STRING ' ' PV-SRC-TASK-NUMBER                            09950099
099600                ' WSKCS315-2100'                                  09960099
099700                DELIMITED BY SIZE                                 09970099
099800                          INTO PV-CICS-MSG-AREA                   09980099
099900         PERFORM 7000-WRITE-TO-CICS-LOG                           09990099
100000     END-IF.                                                      10000099
100100*                                                                 10010099
100200     EVALUATE TRUE                                                10020099
100300*                                                                 10030099
100400* F23 - DETAILS - GO TO WSKCS316 TO SHOW DETAILS                  10040099
100500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              10050099
100600             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               10060099
100700                 SET ASC-USE-SELECTION-QUEUE TO TRUE              10070099
100800                 INITIALIZE WS010-INTER-APPL-COMMAREA             10080099
100900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                10090099
101000                                TO WS010-NUMBER-OF-SELECTED-ITEMS 10100099
101100                 MOVE ASC-NUMBER-OF-TS-ITEMS                      10110099
101200                                     TO WS010-NUMBER-OF-TS-ITEMS  10120099
101300                 MOVE ASC-SEL-QUEUE-NAME-OUT  TO                  10130099
101400                                             WS010-SEL-QUEUE-NAME 10140099
101500                 MOVE PV-SRC-TASK-NUMBER                          10150099
101600                                        TO WS010-SRC-TASK-NUMBER  10160099
101700                 MOVE ASC-CARRIER   TO WS010-SCAC                 10170099
101800                 MOVE ASC-TRAILER   TO WS010-TRLR-ID              10180099
101900                 MOVE ASC-TRIP-ID   TO WS010-TRIP-ID              10190099
102000                 PERFORM 5000-PREPARE-SEL-QUEUE                   10200099
102100             ELSE                                                 10210099
102200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10220099
102300                 SET DP030-OVERRIDE-GO TO TRUE                    10230099
102400                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         10240099
102500                 SET DP020-MSG-WARNING TO TRUE                    10250099
102600             END-IF                                               10260099
102700*                                                                 10270099
102800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10280099
102900             MOVE +1               TO PV-TOP-ITEM                 10290099
103000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10300099
103100                                                                  10310099
103200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10320099
103300             PERFORM 2110-BROWSE-BACKWARD                         10330099
103400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10340099
103500                                                                  10350099
103600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10360099
103700             PERFORM 2120-BROWSE-FORWARD                          10370099
103800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10380099
103900                                                                  10390099
104000         WHEN DP020-SRC-AID = DP016-ENTER                         10400099
104100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10410099
104200             IF PS-ERROR                                          10420099
104300                 CONTINUE                                         10430099
104400             ELSE                                                 10440099
104500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10450099
104600             END-IF                                               10460099
104700                                                                  10470099
104800         WHEN OTHER                                               10480099
104900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10490099
105000             IF PS-ERROR                                          10500099
105100                 CONTINUE                                         10510099
105200             ELSE                                                 10520099
105300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10530099
105400             END-IF                                               10540099
105500                                                                  10550099
105600     END-EVALUATE.                                                10560099
105700*                                                                 10570099
105800*----------------------------------------------------------------*10580099
105900* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     10590099
106000*----------------------------------------------------------------*10600099
106100 2105-RACF-ACCESS.                                                10610099
106200                                                                  10620099
106300     IF PS-CICS-SWITCH-YES                                        10630099
106400         INITIALIZE PV-CICS-MSG-AREA                              10640099
106500         STRING ' ' PV-SRC-TASK-NUMBER                            10650099
106600                ' WSKCS315-2105'                                  10660099
106700                DELIMITED BY SIZE                                 10670099
106800                          INTO PV-CICS-MSG-AREA                   10680099
106900         PERFORM 7000-WRITE-TO-CICS-LOG                           10690099
107000     END-IF.                                                      10700099
107100*                                                                 10710099
107200      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  10720099
107300      SET DP008-ACCESS-TYPE-USE          TO TRUE                  10730099
107400                                                                  10740099
107500      EXEC CICS                                                   10750099
107600         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 10760099
107700              COMMAREA (DP008-SECURITY-COMMAREA)                  10770099
107800              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             10780099
107900      END-EXEC                                                    10790099
108000                                                                  10800099
108100      IF DP008-CALL-SUCCESSFUL                                    10810099
108200         IF DP008-ACCESS-ALLOWED                                  10820099
108300             SET PS-ACCESS-ALLOWED TO TRUE                        10830099
108400         ELSE                                                     10840099
108500             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    10850099
108600             MOVE DP008-ERROR-CODE TO PV-RACF-ERROR-CODE          10860099
108700             INITIALIZE PV-CICS-MSG-AREA                          10870099
108800             STRING ' ' PV-SRC-TASK-NUMBER                        10880099
108900                    ' WSKCS315- RACF -'                           10890099
109000                    ' DP008-ACCESS-SW- '                          10900099
109100                      DP008-ACCESS-SW                             10910099
109200                    ' RACF ERROR CODE-'                           10920099
109300                      PV-RACF-ERROR-CODE                          10930099
109400                      DELIMITED BY SIZE                           10940099
109500                                    INTO PV-CICS-MSG-AREA         10950099
109600             PERFORM 7000-WRITE-TO-CICS-LOG                       10960099
109700         END-IF                                                   10970099
109800     ELSE                                                         10980099
109900         MOVE ' 2105-RACF-ACCESS' TO DP013-PARAGRAPH              10990099
110000          MOVE 'UNABLE TO ACCESS CICS'                            11000099
110100                               TO DP013-MESSAGE-TEXT (1)          11010099
110200          MOVE SQLCA           TO DP013-SQLCA                     11020099
110300          SET DP013-DB2-ABEND                                     11030099
110400              DP013-XCTL-DISPLAY-RESTART TO TRUE                  11040099
110500          PERFORM DP013-0000-PROCESS-ABEND                        11050099
110600      END-IF.                                                     11060099
110700                                                                  11070099
110800*                                                                 11080099
110900*----------------------------------------------------------------*11090099
111000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11100099
111100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11110099
111200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11120099
111300*    MESSAGE.                                                    *11130099
111400*----------------------------------------------------------------*11140099
111500                                                                  11150099
111600 2110-BROWSE-BACKWARD.                                            11160099
111700                                                                  11170099
111800     IF PS-CICS-SWITCH-YES                                        11180099
111900         INITIALIZE PV-CICS-MSG-AREA                              11190099
112000         STRING ' ' PV-SRC-TASK-NUMBER                            11200099
112100                ' WSKCS315-2110'                                  11210099
112200                DELIMITED BY SIZE                                 11220099
112300                          INTO PV-CICS-MSG-AREA                   11230099
112400         PERFORM 7000-WRITE-TO-CICS-LOG                           11240099
112500     END-IF.                                                      11250099
112600*                                                                 11260099
112700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11270099
112800         GIVING PV-TOP-ITEM.                                      11280099
112900*                                                                 11290099
113000     IF ((PV-TOP-ITEM < +1)                                       11300099
113100       OR (PV-TOP-ITEM = +1))                                     11310099
113200         MOVE +1                   TO PV-TOP-ITEM                 11320099
113300*        -- TOP OF LIST --                                        11330099
113400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11340099
113500         SET DP020-MSG-INFORMATIONAL TO TRUE                      11350099
113600     END-IF.                                                      11360099
113700                                                                  11370099
113800 EJECT                                                            11380099
113900*----------------------------------------------------------------*11390099
114000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11400099
114100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11410099
114200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11420099
114300*----------------------------------------------------------------*11430099
114400                                                                  11440099
114500 2120-BROWSE-FORWARD.                                             11450099
114600                                                                  11460099
114700     IF PS-CICS-SWITCH-YES                                        11470099
114800         INITIALIZE PV-CICS-MSG-AREA                              11480099
114900         STRING ' ' PV-SRC-TASK-NUMBER                            11490099
115000                ' WSKCS315-2120'                                  11500099
115100                DELIMITED BY SIZE                                 11510099
115200                          INTO PV-CICS-MSG-AREA                   11520099
115300         PERFORM 7000-WRITE-TO-CICS-LOG                           11530099
115400     END-IF.                                                      11540099
115500*                                                                 11550099
115600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11560099
115700         GIVING PV-TOP-ITEM.                                      11570099
115800     IF PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                    11580099
115900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11590099
116000                                   TO PV-TOP-ITEM                 11600099
116100*        -- BOTTOM OF LIST --                                     11610099
116200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11620099
116300         SET DP020-MSG-INFORMATIONAL                              11630099
116400                                   TO TRUE                        11640099
116500     ELSE                                                         11650099
116600         COMPUTE PV-BOTTOM-ITEM =                                 11660099
116700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11670099
116800         IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ             11680099
116900*            -- BOTTOM OF LIST --                                 11690099
117000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11700099
117100             SET DP020-MSG-INFORMATIONAL                          11710099
117200                                   TO TRUE                        11720099
117300         END-IF                                                   11730099
117400     END-IF.                                                      11740099
117500 EJECT                                                            11750099
117600*----------------------------------------------------------------*11760099
117700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11770099
117800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11780099
117900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11790099
118000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11800099
118100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11810099
118200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11820099
118300*----------------------------------------------------------------*11830099
118400                                                                  11840099
118500 2130-CHECK-FOR-JUMP-BROWSE.                                      11850099
118600                                                                  11860099
118700     IF PS-CICS-SWITCH-YES                                        11870099
118800         INITIALIZE PV-CICS-MSG-AREA                              11880099
118900         STRING ' ' PV-SRC-TASK-NUMBER                            11890099
119000                ' WSKCS315-2130'                                  11900099
119100                DELIMITED BY SIZE                                 11910099
119200                          INTO PV-CICS-MSG-AREA                   11920099
119300         PERFORM 7000-WRITE-TO-CICS-LOG                           11930099
119400     END-IF.                                                      11940099
119500*                                                                 11950099
119600     SET PS-NO-ERROR               TO TRUE.                       11960099
119700     IF (ASC-START-ITEM-REQUEST = SPACE)                          11970099
119800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11980099
119900                                   TO PV-TOP-ITEM                 11990099
120000     ELSE                                                         12000099
120100         MOVE ASC-START-ITEM-REQUEST                              12010099
120200                                   TO DP010I-UNEDITED-FIELD       12020099
120300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12030099
120400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12040099
120500         SET DP010I-NEGATIVE-NOT-ALLOWED                          12050099
120600                                   TO TRUE                        12060099
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12071099
263627              USING DP010I-NUMERIC-EDIT-AREA                      12072099
120800                                                                  12080099
120900         IF NOT DP010I-ERROR-DETECTED                             12090099
121000             MOVE DP010I-NUMERIC-FIELD                            12100099
121100                                   TO  ASC-START-ITEM-REQUEST-N   12110099
121200             IF ASC-START-ITEM-REQUEST-N > ZERO                   12120099
121300                 IF ASC-START-ITEM-REQUEST-N >                    12130099
121400                                          ASC-NUMBER-OF-ITEMS-READ12140099
121500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12150099
121600                     COMPUTE PV-TOP-ITEM =                        12160099
121700                             ASC-NUMBER-OF-ITEMS-READ             12170099
121800                             - PC-ITEMS-PER-PANEL + 1             12180099
121900                     IF PV-TOP-ITEM < +1                          12190099
122000                         MOVE +1   TO PV-TOP-ITEM                 12200099
122100                         MOVE PC-TSYMSG-00070                     12210099
122200                                   TO DP020-MSG-NUMBER            12220099
122300                         SET DP020-MSG-INFORMATIONAL              12230099
122400                                   TO TRUE                        12240099
122500                     END-IF                                       12250099
122600                 ELSE                                             12260099
122700                     MOVE ASC-START-ITEM-REQUEST-N                12270099
122800                                   TO PV-TOP-ITEM                 12280099
122900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12290099
123000                     COMPUTE PV-BOTTOM-ITEM =                     12300099
123100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12310099
123200                     IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ 12320099
123300*                        -- BOTTOM OF LIST --                     12330099
123400                         MOVE PC-TSYMSG-00070                     12340099
123500                                   TO DP020-MSG-NUMBER            12350099
123600                         SET DP020-MSG-INFORMATIONAL              12360099
123700                                   TO TRUE                        12370099
123800                     END-IF                                       12380099
123900                 END-IF                                           12390099
124000             ELSE                                                 12400099
124100*                --- VALUE OUT OF RANGE ----                      12410099
124200                 MOVE PC-TSYMSG-00101                             12420099
124300                                   TO DP020-MSG-NUMBER            12430099
124400                 MOVE -1           TO ASTRITL                     12440099
124500                 SET DP030-SET-CURSOR-APPL-1                      12450099
124600                                   TO TRUE                        12460099
124700                 MOVE DP015-REVERSE                               12470099
124800                                   TO ASTRITH                     12480099
124900                 MOVE DP015-RED    TO ASTRITC                     12490099
125000                 MOVE DP015-UNP-NUM-BRT-MDT                       12500099
125100                                   TO ASTRITA                     12510099
125200                 SET DP020-MSG-FATAL                              12520099
125300                                   TO TRUE                        12530099
125400                 SET PS-ERROR      TO TRUE                        12540099
125500             END-IF                                               12550099
125600                                                                  12560099
125700         ELSE                                                     12570099
125800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12580099
125900             MOVE -1               TO ASTRITL                     12590099
126000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12600099
126100             MOVE DP015-REVERSE    TO ASTRITH                     12610099
126200             MOVE DP015-RED        TO ASTRITC                     12620099
126300             MOVE DP015-UNP-NUM-BRT-MDT                           12630099
126400                                   TO ASTRITA                     12640099
126500             SET DP020-MSG-FATAL   TO TRUE                        12650099
126600             SET PS-ERROR          TO TRUE                        12660099
126700         END-IF                                                   12670099
126800     END-IF.                                                      12680099
126900 EJECT                                                            12690099
127000*----------------------------------------------------------------*12700099
127100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *12710099
127200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *12720099
127300*----------------------------------------------------------------*12730099
127400 2140-DESELECT-ALL-ITEMS.                                         12740099
127500                                                                  12750099
127600     IF PS-CICS-SWITCH-YES                                        12760099
127700         INITIALIZE PV-CICS-MSG-AREA                              12770099
127800         STRING ' ' PV-SRC-TASK-NUMBER                            12780099
127900                ' WSKCS315-2140'                                  12790099
128000                DELIMITED BY SIZE                                 12800099
128100                          INTO PV-CICS-MSG-AREA                   12810099
128200         PERFORM 7000-WRITE-TO-CICS-LOG                           12820099
128300     END-IF.                                                      12830099
128400*                                                                 12840099
128500     MOVE +1                       TO ASC-BLK-SUB.                12850099
128600                                                                  12860099
128700     PERFORM 2141-CLEAR-SELECTED-INDS                             12870099
128800         VARYING ASC-ITEM-SUB                                     12880099
128900         FROM 1 BY 1                                              12890099
129000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12900099
129100                                                                  12910099
129200     ADD +1                        TO ASC-BLK-SUB.                12920099
129300                                                                  12930099
129400     PERFORM 2141-CLEAR-SELECTED-INDS                             12940099
129500         VARYING ASC-ITEM-SUB                                     12950099
129600         FROM 1 BY 1                                              12960099
129700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12970099
129800                                                                  12980099
129900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12990099
130000                                   TO PV-LIST-ITEM-NUMBER.        13000099
130100                                                                  13010099
130200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13020099
130300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13030099
130400                                                                  13040099
130500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13050099
130600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13060099
130700         MOVE +1                   TO ASC-BLK-SUB                 13070099
130800                                                                  13080099
130900         PERFORM 5100-WRITE-TEMP-STORAGE                          13090099
131000                                                                  13100099
131100         MOVE +1                   TO PV-BLOCK-NUMBER             13110099
131200                                                                  13120099
131300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13130099
131400             PV-FIRST-BLOCK-IN-ARRAY - 1                          13140099
131500                                                                  13150099
131600         PERFORM                                                  13160099
131700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13170099
131800                                                                  13180099
131900             PERFORM 4410-READ-TEMP-STORAGE                       13190099
132000                                                                  13200099
132100             PERFORM 2141-CLEAR-SELECTED-INDS                     13210099
132200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13220099
132300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13230099
132400                                                                  13240099
132500             PERFORM 5100-WRITE-TEMP-STORAGE                      13250099
132600                                                                  13260099
132700             ADD +1                TO PV-BLOCK-NUMBER             13270099
132800                                                                  13280099
132900         END-PERFORM                                              13290099
133000                                                                  13300099
133100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13310099
133200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13320099
133300                                                                  13330099
133400         PERFORM                                                  13340099
133500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13350099
133600                   ASC-HIGHEST-BLOCK-WRITTEN                      13360099
133700                                                                  13370099
133800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13380099
133900                                   TO PV-BLOCK-NUMBER             13390099
134000                                                                  13400099
134100             PERFORM 4410-READ-TEMP-STORAGE                       13410099
134200                                                                  13420099
134300             PERFORM 2141-CLEAR-SELECTED-INDS                     13430099
134400                 VARYING ASC-ITEM-SUB                             13440099
134500                 FROM 1 BY 1                                      13450099
134600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13460099
134700                                                                  13470099
134800             PERFORM 5100-WRITE-TEMP-STORAGE                      13480099
134900                                                                  13490099
135000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13500099
135100                                                                  13510099
135200         END-PERFORM                                              13520099
135300                                                                  13530099
135400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13540099
135500                                   TO PV-BLOCK-NUMBER             13550099
135600                                                                  13560099
135700         PERFORM 4410-READ-TEMP-STORAGE                           13570099
135800     END-IF.                                                      13580099
135900                                                                  13590099
136000                                                                  13600099
136100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 13610099
136200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.13620099
136300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  13630099
136400                                                                  13640099
136500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13650099
136600                                                                  13660099
136700 EJECT                                                            13670099
136800*----------------------------------------------------------------*13680099
136900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *13690099
137000*----------------------------------------------------------------*13700099
137100 2141-CLEAR-SELECTED-INDS.                                        13710099
137200                                                                  13720099
137300     IF PS-CICS-SWITCH-YES                                        13730099
137400         INITIALIZE PV-CICS-MSG-AREA                              13740099
137500         STRING ' ' PV-SRC-TASK-NUMBER                            13750099
137600                ' WSKCS315-2141'                                  13760099
137700                DELIMITED BY SIZE                                 13770099
137800                          INTO PV-CICS-MSG-AREA                   13780099
137900         PERFORM 7000-WRITE-TO-CICS-LOG                           13790099
138000     END-IF.                                                      13800099
138100*                                                                 13810099
138200     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            13820099
138300             NOT EQUAL ZERO                                       13830099
138400         IF NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)           13840099
138500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13850099
138600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    13860099
138700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13870099
138800                                   TO TRUE                        13880099
138900         END-IF                                                   13890099
139000     END-IF.                                                      13900099
139100                                                                  13910099
139200 EJECT                                                            13920099
139300*----------------------------------------------------------------*13930099
139400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13940099
139500*  FOR ALL ITEMS.                                                *13950099
139600*----------------------------------------------------------------*13960099
139700 2150-SELECT-ALL-ITEMS.                                           13970099
139800                                                                  13980099
139900     IF PS-CICS-SWITCH-YES                                        13990099
140000         INITIALIZE PV-CICS-MSG-AREA                              14000099
140100         STRING ' ' PV-SRC-TASK-NUMBER                            14010099
140200                ' WSKCS315-2150'                                  14020099
140300                DELIMITED BY SIZE                                 14030099
140400                          INTO PV-CICS-MSG-AREA                   14040099
140500         PERFORM 7000-WRITE-TO-CICS-LOG                           14050099
140600     END-IF.                                                      14060099
140700*                                                                 14070099
140800     MOVE +1                       TO ASC-BLK-SUB.                14080099
140900                                                                  14090099
141000     PERFORM 2151-SET-SELECTED-INDS                               14100099
141100         VARYING ASC-ITEM-SUB                                     14110099
141200         FROM 1 BY 1                                              14120099
141300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14130099
141400                                                                  14140099
141500     ADD +1                        TO ASC-BLK-SUB.                14150099
141600                                                                  14160099
141700     PERFORM 2151-SET-SELECTED-INDS                               14170099
141800         VARYING ASC-ITEM-SUB                                     14180099
141900         FROM 1 BY 1                                              14190099
142000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14200099
142100                                                                  14210099
142200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14220099
142300                                   TO PV-LIST-ITEM-NUMBER.        14230099
142400                                                                  14240099
142500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14250099
142600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14260099
142700                                                                  14270099
142800     IF PV-FIRST-BLOCK-IN-ARRAY = +1                              14280099
142900         MOVE +1                   TO ASC-BLK-SUB                 14290099
143000         PERFORM 5100-WRITE-TEMP-STORAGE                          14300099
143100         MOVE +2                   TO ASC-BLK-SUB                 14310099
143200         PERFORM 5100-WRITE-TEMP-STORAGE                          14320099
143300         MOVE +1                   TO ASC-BLK-SUB                 14330099
143400         MOVE +1                   TO PV-BLOCK-NUMBER             14340099
143500     END-IF.                                                      14350099
143600                                                                  14360099
143700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14370099
143800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14380099
143900         MOVE +1                   TO ASC-BLK-SUB                 14390099
144000         PERFORM 5100-WRITE-TEMP-STORAGE                          14400099
144100                                                                  14410099
144200         IF (ASC-BLK-SUB               <   PC-MAX-BLOCKS-IN-ARRAY)14420099
144300             ADD  +1                   TO ASC-BLK-SUB             14430099
144400             PERFORM 5100-WRITE-TEMP-STORAGE                      14440099
144500         END-IF                                                   14450099
144600                                                                  14460099
144700         MOVE +1                   TO PV-BLOCK-NUMBER             14470099
144800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14480099
144900             PV-FIRST-BLOCK-IN-ARRAY - 1                          14490099
145000                                                                  14500099
145100         PERFORM                                                  14510099
145200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14520099
145300                                                                  14530099
145400             PERFORM 4410-READ-TEMP-STORAGE                       14540099
145500             PERFORM 2151-SET-SELECTED-INDS                       14550099
145600                 VARYING ASC-ITEM-SUB                             14560099
145700                 FROM 1 BY 1                                      14570099
145800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14580099
145900                                                                  14590099
146000             PERFORM 5100-WRITE-TEMP-STORAGE                      14600099
146100             ADD +1                TO PV-BLOCK-NUMBER             14610099
146200                                                                  14620099
146300         END-PERFORM                                              14630099
146400                                                                  14640099
146500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14650099
146600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14660099
146700                                                                  14670099
146800         PERFORM                                                  14680099
146900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14690099
147000                   ASC-HIGHEST-BLOCK-WRITTEN                      14700099
147100                                                                  14710099
147200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14720099
147300                                   TO PV-BLOCK-NUMBER             14730099
147400             PERFORM 4410-READ-TEMP-STORAGE                       14740099
147500             PERFORM 2151-SET-SELECTED-INDS                       14750099
147600                 VARYING ASC-ITEM-SUB                             14760099
147700                 FROM 1 BY 1                                      14770099
147800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14780099
147900                                                                  14790099
148000             PERFORM 5100-WRITE-TEMP-STORAGE                      14800099
148100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14810099
148200         END-PERFORM                                              14820099
148300                                                                  14830099
148400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14840099
148500                                   TO PV-BLOCK-NUMBER             14850099
148600         PERFORM 4410-READ-TEMP-STORAGE                           14860099
148700     END-IF.                                                      14870099
148800                                                                  14880099
148900                                                                  14890099
149000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             14900099
149100                       ASC-NUMBER-OF-SELECTED-ITEMS.              14910099
149200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14920099
149300                                                                  14930099
149400 EJECT                                                            14940099
149500*----------------------------------------------------------------*14950099
149600*    MARK EACH ITEM AS BEING SELECTED.                           *14960099
149700*----------------------------------------------------------------*14970099
149800 2151-SET-SELECTED-INDS.                                          14980099
149900                                                                  14990099
150000     IF PS-CICS-SWITCH-YES                                        15000099
150100         INITIALIZE PV-CICS-MSG-AREA                              15010099
150200         STRING ' ' PV-SRC-TASK-NUMBER                            15020099
150300                ' WSKCS315-2151'                                  15030099
150400                DELIMITED BY SIZE                                 15040099
150500                          INTO PV-CICS-MSG-AREA                   15050099
150600         PERFORM 7000-WRITE-TO-CICS-LOG                           15060099
150700     END-IF.                                                      15070099
150800*                                                                 15080099
150900     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            15090099
151000             NOT EQUAL ZERO                                       15100099
151100         IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              15110099
151200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15120099
151300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        15130099
151400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15140099
151500                               TO  TRUE                           15150099
151600         END-IF                                                   15160099
151700     END-IF.                                                      15170099
151800******************************************************************15180099
151900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **15190099
152000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **15200099
152100******************************************************************15210099
152200 2200-MOVE-SCREEN-TO-COMMAREA.                                    15220099
152300                                                                  15230099
152400     IF PS-CICS-SWITCH-YES                                        15240099
152500         INITIALIZE PV-CICS-MSG-AREA                              15250099
152600         STRING ' ' PV-SRC-TASK-NUMBER                            15260099
152700                ' WSKCS315-2200'                                  15270099
152800                DELIMITED BY SIZE                                 15280099
152900                          INTO PV-CICS-MSG-AREA                   15290099
153000         PERFORM 7000-WRITE-TO-CICS-LOG                           15300099
153100     END-IF.                                                      15310099
153200*                                                                 15320099
153300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15330099
153400     MOVE +1                       TO PV-SUB.                     15340099
153500*                                                                 15350099
153600     PERFORM 3100-SET-SUBSCRIPTS.                                 15360099
153700     IF ASTRITL > ZERO                                            15370099
153800         MOVE ASTRITI         TO ASC-START-ITEM-REQUEST           15380099
153900     ELSE                                                         15390099
154000         IF ASTRITF = DP015-ERASE-EOF                             15400099
154100             INITIALIZE ASC-START-ITEM-REQUEST                    15410099
154200         END-IF                                                   15420099
154300     END-IF.                                                      15430099
154400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          15440099
154500         VARYING PV-SUB                                           15450099
154600         FROM 1 BY 1                                              15460099
154700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      15470099
154800                                                                  15480099
154900******************************************************************15490099
155000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**15500099
155100******************************************************************15510099
155200 2210-MOVE-LINES-TO-COMMAREA.                                     15520099
155300                                                                  15530099
155400     IF PS-CICS-SWITCH-YES                                        15540099
155500         INITIALIZE PV-CICS-MSG-AREA                              15550099
155600         STRING ' ' PV-SRC-TASK-NUMBER                            15560099
155700                ' WSKCS315-2210'                                  15570099
155800                DELIMITED BY SIZE                                 15580099
155900                          INTO PV-CICS-MSG-AREA                   15590099
156000         PERFORM 7000-WRITE-TO-CICS-LOG                           15600099
156100     END-IF.                                                      15610099
156200*                                                                 15620099
156300     IF MR-SELECTL (PV-SUB) > ZERO                                15630099
156400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15640099
156500         MOVE MR-SELECTI (PV-SUB)                                 15650099
156600                                   TO ASC-TEMP-SELECTED-SW        15660099
156700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15670099
156800     ELSE                                                         15680099
156900         IF MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                 15690099
157000             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         15700099
157100             MOVE SPACE        TO ASC-TEMP-SELECTED-SW            15710099
157200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15720099
157300         END-IF                                                   15730099
157400     END-IF.                                                      15740099
157500     ADD +1                        TO ASC-ITEM-SUB.               15750099
157600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15760099
157700         ADD +1                    TO ASC-BLK-SUB                 15770099
157800         MOVE +1                   TO ASC-ITEM-SUB                15780099
157900     END-IF.                                                      15790099
158000******************************************************************15800099
158100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **15810099
158200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **15820099
158300******************************************************************15830099
158400 3000-EDIT-DATA-IN-COMMAREA.                                      15840099
158500*                                                                 15850099
158600     IF PS-CICS-SWITCH-YES                                        15860099
158700         INITIALIZE PV-CICS-MSG-AREA                              15870099
158800         STRING ' ' PV-SRC-TASK-NUMBER                            15880099
158900                ' WSKCS315-3000'                                  15890099
159000                DELIMITED BY SIZE                                 15900099
159100                          INTO PV-CICS-MSG-AREA                   15910099
159200         PERFORM 7000-WRITE-TO-CICS-LOG                           15920099
159300     END-IF.                                                      15930099
159400*                                                                 15940099
159500     SET PS-NO-ERROR               TO TRUE.                       15950099
159600     PERFORM 3200-RESET-ATTRIBUTES.                               15960099
159700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     15970099
159800**                                                                15980099
159900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              15990099
160000* EDITTING IS DONE FROM THE BOTTOM UP.                            16000099
160100**                                                                16010099
160200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       16020099
160300         ASC-ITEMS-DISPLAYED - 1.                                 16030099
160400     PERFORM 3100-SET-SUBSCRIPTS.                                 16040099
160500     PERFORM 3300-EDIT-SELECTIONS                                 16050099
160600         VARYING PV-SUB                                           16060099
160700         FROM PV-SUB BY -1                                        16070099
160800         UNTIL PV-SUB < +1                                        16080099
160900*                                                                 16090099
161000     IF PS-NO-ERROR                                               16100099
161100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        16110099
161200     END-IF.                                                      16120099
161300*                                                                 16130099
161400     IF ((PS-NO-ERROR)                                            16140099
161500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   16150099
161600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    16160099
161700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  16170099
161800     END-IF.                                                      16180099
161900/                                                                 16190099
162000*----------------------------------------------------------------*16200099
162100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16210099
162200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16220099
162300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16230099
162400*                                                                *16240099
162500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16250099
162600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16260099
162700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16270099
162800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16280099
162900*----------------------------------------------------------------*16290099
163000                                                                  16300099
163100 3100-SET-SUBSCRIPTS.                                             16310099
163200                                                                  16320099
163300     IF PS-CICS-SWITCH-YES                                        16330099
163400         INITIALIZE PV-CICS-MSG-AREA                              16340099
163500         STRING ' ' PV-SRC-TASK-NUMBER                            16350099
163600                ' WSKCS315-3100'                                  16360099
163700                DELIMITED BY SIZE                                 16370099
163800                          INTO PV-CICS-MSG-AREA                   16380099
163900         PERFORM 7000-WRITE-TO-CICS-LOG                           16390099
164000     END-IF.                                                      16400099
164100*                                                                 16410099
164200     COMPUTE ASC-ITEM-SUB =                                       16420099
164300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16430099
164400                                                                  16440099
164500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16450099
164600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16460099
164700                                                                  16470099
164800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               16480099
164900     ELSE                                                         16490099
165000         MOVE +1                     TO ASC-BLK-SUB               16500099
165100     END-IF.                                                      16510099
165200******************************************************************16520099
165300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16530099
165400******************************************************************16540099
165500 3200-RESET-ATTRIBUTES.                                           16550099
165600                                                                  16560099
165700     IF PS-CICS-SWITCH-YES                                        16570099
165800         INITIALIZE PV-CICS-MSG-AREA                              16580099
165900         STRING ' ' PV-SRC-TASK-NUMBER                            16590099
166000                ' WSKCS315-3200'                                  16600099
166100                DELIMITED BY SIZE                                 16610099
166200                          INTO PV-CICS-MSG-AREA                   16620099
166300         PERFORM 7000-WRITE-TO-CICS-LOG                           16630099
166400     END-IF.                                                      16640099
166500*                                                                 16650099
166600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRITA.                    16660099
166700     MOVE DP015-GREEN              TO ASTRITC.                    16670099
166800     MOVE DP015-UNDERLINE          TO ASTRITH.                    16680099
166900*                                                                 16690099
167000     PERFORM                                                      16700099
167100         VARYING PV-SUB                                           16710099
167200         FROM 1 BY 1                                              16720099
167300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16730099
167400         MOVE DP015-UNP-ALP-NOR-OFF                               16740099
167500                                   TO MR-SELECTA (PV-SUB)         16750099
167600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         16760099
167700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         16770099
167800     END-PERFORM.                                                 16780099
167900******************************************************************16790099
168000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16800099
168100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16810099
168200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16820099
168300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16830099
168400******************************************************************16840099
168500 3300-EDIT-SELECTIONS.                                            16850099
168600*                                                                 16860099
168700     IF PS-CICS-SWITCH-YES                                        16870099
168800         INITIALIZE PV-CICS-MSG-AREA                              16880099
168900         STRING ' ' PV-SRC-TASK-NUMBER                            16890099
169000                ' WSKCS315-3300'                                  16900099
169100                DELIMITED BY SIZE                                 16910099
169200                          INTO PV-CICS-MSG-AREA                   16920099
169300         PERFORM 7000-WRITE-TO-CICS-LOG                           16930099
169400     END-IF.                                                      16940099
169500*                                                                 16950099
169600     EVALUATE TRUE                                                16960099
169700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16970099
169800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16980099
169900                 CONTINUE                                         16990099
170000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17000099
170100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17010099
170200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   17020099
170300                 MOVE ASC-TEMP-SELECTED-SW                        17030099
170400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17040099
170500                                TO ASC-SELECTED-SW                17050099
170600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17060099
170700             END-IF                                               17070099
170800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17080099
170900                 = SPACE                                          17090099
171000             EVALUATE TRUE                                        17100099
171100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17110099
171200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17120099
171300                     MOVE SPACE TO ASC-SELECTED-SW                17130099
171400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17140099
171500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        17150099
171600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    17160099
171700                     MOVE SPACE TO ASC-SELECTED-SW                17170099
171800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17180099
171900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          17190099
172000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      17200099
172100                     MOVE SPACE TO ASC-SELECTED-SW                17210099
172200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17220099
172300             END-EVALUATE                                         17230099
172400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           17240099
172500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17250099
172600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17260099
172700             END-IF                                               17270099
172800             PERFORM 3310-EDIT-RANGE                              17280099
172900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17290099
173000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17300099
173100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17310099
173200             END-IF                                               17320099
173300             PERFORM 3310-EDIT-RANGE                              17330099
173400         WHEN OTHER                                               17340099
173500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17350099
173600             SET DP020-MSG-FATAL    TO TRUE                       17360099
173700             MOVE -1                TO MR-SELECTL (PV-SUB)        17370099
173800             SET DP030-SET-CURSOR-APPL-1                          17380099
173900                                    TO TRUE                       17390099
174000             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        17400099
174100             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        17410099
174200             SET PS-ERROR TO TRUE                                 17420099
174300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17430099
174400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17440099
174500                 MOVE SPACE         TO ASC-SELECTED-SW            17450099
174600                                        (ASC-BLK-SUB ASC-ITEM-SUB)17460099
174700             END-IF                                               17470099
174800     END-EVALUATE.                                                17480099
174900                                                                  17490099
175000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 17500099
175100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17510099
175200     IF ASC-ITEM-SUB < 1                                          17520099
175300         SUBTRACT +1 FROM ASC-BLK-SUB                             17530099
175400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17540099
175500     END-IF.                                                      17550099
175600*                                                                 17560099
175700******************************************************************17570099
175800** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **17580099
175900** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **17590099
176000** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**17600099
176100** THE ENDING.                                                  **17610099
176200******************************************************************17620099
176300 3310-EDIT-RANGE.                                                 17630099
176400*                                                                 17640099
176500     IF PS-CICS-SWITCH-YES                                        17650099
176600         INITIALIZE PV-CICS-MSG-AREA                              17660099
176700         STRING ' ' PV-SRC-TASK-NUMBER                            17670099
176800                ' WSKCS315-3310'                                  17680099
176900                DELIMITED BY SIZE                                 17690099
177000                          INTO PV-CICS-MSG-AREA                   17700099
177100         PERFORM 7000-WRITE-TO-CICS-LOG                           17710099
177200     END-IF.                                                      17720099
177300*                                                                 17730099
177400     IF ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                 17740099
177500         IF ASC-START-OF-SELECTED-RANGE = ZERO                    17750099
177600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17760099
177700                                   TO ASC-SELECTED-SW             17770099
177800                                        (ASC-BLK-SUB ASC-ITEM-SUB)17780099
177900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17790099
178000         ELSE                                                     17800099
178100             IF ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE      17810099
178200                 CONTINUE                                         17820099
178300             ELSE                                                 17830099
178400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17840099
178500                 MOVE PC-TSYMSG-00054                             17850099
178600                                   TO DP020-MSG-NUMBER            17860099
178700                 SET DP020-MSG-FATAL                              17870099
178800                                   TO TRUE                        17880099
178900                 MOVE -1           TO MR-SELECTL (PV-SUB)         17890099
179000                 SET DP030-SET-CURSOR-APPL-1                      17900099
179100                                   TO TRUE                        17910099
179200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         17920099
179300                 MOVE DP015-UNDERLINE                             17930099
179400                                   TO MR-SELECTH (PV-SUB)         17940099
179500                 SET PS-ERROR      TO TRUE                        17950099
179600             END-IF                                               17960099
179700         END-IF                                                   17970099
179800     ELSE                                                         17980099
179900         IF ASC-END-OF-SELECTED-RANGE = ZERO                      17990099
180000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18000099
180100                                   TO ASC-SELECTED-SW             18010099
180200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18020099
180300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18030099
180400         ELSE                                                     18040099
180500             IF ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE        18050099
180600                 CONTINUE                                         18060099
180700             ELSE                                                 18070099
180800*                -- ONLY ONE END-OF-RANGE ALLOWED --              18080099
180900                 MOVE PC-TSYMSG-00055                             18090099
181000                                   TO DP020-MSG-NUMBER            18100099
181100                 SET DP020-MSG-FATAL                              18110099
181200                                   TO TRUE                        18120099
181300                 MOVE -1           TO MR-SELECTL (PV-SUB)         18130099
181400                 SET DP030-SET-CURSOR-APPL-1                      18140099
181500                                   TO TRUE                        18150099
181600                 SET PS-ERROR      TO TRUE                        18160099
181700             END-IF                                               18170099
181800         END-IF                                                   18180099
181900     END-IF.                                                      18190099
182000*                                                                 18200099
182100******************************************************************18210099
182200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **18220099
182300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **18230099
182400******************************************************************18240099
182500 3400-CHECK-RANGE-SEQUENCE.                                       18250099
182600*                                                                 18260099
182700     IF PS-CICS-SWITCH-YES                                        18270099
182800         INITIALIZE PV-CICS-MSG-AREA                              18280099
182900         STRING ' ' PV-SRC-TASK-NUMBER                            18290099
183000                ' WSKCS315-3400'                                  18300099
183100                DELIMITED BY SIZE                                 18310099
183200                          INTO PV-CICS-MSG-AREA                   18320099
183300         PERFORM 7000-WRITE-TO-CICS-LOG                           18330099
183400     END-IF.                                                      18340099
183500*                                                                 18350099
183600     IF ASC-START-OF-SELECTED-RANGE > ZERO                        18360099
183700       AND ASC-END-OF-SELECTED-RANGE > ZERO                       18370099
183800       AND ASC-START-OF-SELECTED-RANGE >                          18380099
183900                                         ASC-END-OF-SELECTED-RANGE18390099
184000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                18400099
184100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 18410099
184200         SET DP020-MSG-FATAL TO TRUE                              18420099
184300         SET PS-ERROR TO TRUE                                     18430099
184400         PERFORM 3410-POSITION-AT-ERROR                           18440099
184500     END-IF.                                                      18450099
184600******************************************************************18460099
184700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **18470099
184800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **18480099
184900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **18490099
185000******************************************************************18500099
185100 3410-POSITION-AT-ERROR.                                          18510099
185200*                                                                 18520099
185300     IF PS-CICS-SWITCH-YES                                        18530099
185400         INITIALIZE PV-CICS-MSG-AREA                              18540099
185500         STRING ' ' PV-SRC-TASK-NUMBER                            18550099
185600                ' WSKCS315-3410'                                  18560099
185700                DELIMITED BY SIZE                                 18570099
185800                          INTO PV-CICS-MSG-AREA                   18580099
185900         PERFORM 7000-WRITE-TO-CICS-LOG                           18590099
186000     END-IF.                                                      18600099
186100*                                                                 18610099
186200     SET DP030-SET-CURSOR-APPL-1                                  18620099
186300                                   TO TRUE.                       18630099
186400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18640099
186500                    - PV-TOP-ITEM + 1.                            18650099
186600     IF PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                       18660099
186700         CONTINUE                                                 18670099
186800     ELSE                                                         18680099
186900         MOVE -1                   TO MR-SELECTL (PV-SUB)         18690099
187000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18700099
187100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18710099
187200     END-IF.                                                      18720099
187300*                                                                 18730099
187400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18740099
187500                    - PV-TOP-ITEM + 1.                            18750099
187600     IF PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                       18760099
187700         CONTINUE                                                 18770099
187800     ELSE                                                         18780099
187900         MOVE -1                   TO MR-SELECTL (PV-SUB)         18790099
188000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18800099
188100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18810099
188200     END-IF.                                                      18820099
188300 EJECT                                                            18830099
188400*----------------------------------------------------------------*18840099
188500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18850099
188600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18860099
188700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18870099
188800*----------------------------------------------------------------*18880099
188900 3500-MARK-RANGE-AS-SELECTED.                                     18890099
189000                                                                  18900099
189100     IF PS-CICS-SWITCH-YES                                        18910099
189200         INITIALIZE PV-CICS-MSG-AREA                              18920099
189300         STRING ' ' PV-SRC-TASK-NUMBER                            18930099
189400                ' WSKCS315-3500'                                  18940099
189500                DELIMITED BY SIZE                                 18950099
189600                          INTO PV-CICS-MSG-AREA                   18960099
189700         PERFORM 7000-WRITE-TO-CICS-LOG                           18970099
189800     END-IF.                                                      18980099
189900*                                                                 18990099
190000     MOVE +1                       TO  ASC-BLK-SUB.               19000099
190100     PERFORM 3510-MARK-SELECTED-INDS                              19010099
190200         VARYING ASC-ITEM-SUB                                     19020099
190300         FROM 1 BY 1                                              19030099
190400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19040099
190500                                                                  19050099
190600     ADD +1                        TO ASC-BLK-SUB.                19060099
190700     PERFORM 3510-MARK-SELECTED-INDS                              19070099
190800         VARYING ASC-ITEM-SUB                                     19080099
190900         FROM 1 BY 1                                              19090099
191000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19100099
191100                                                                  19110099
191200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19120099
191300                                   TO  PV-LIST-ITEM-NUMBER.       19130099
191400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19140099
191500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19150099
191600               PC-ITEMS-PER-PANEL).                               19160099
191700                                                                  19170099
191800     MOVE ASC-START-OF-SELECTED-RANGE                             19180099
191900                                   TO PV-START-OF-SELECTED-RANGE. 19190099
192000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19200099
192100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19210099
192200               PC-ITEMS-PER-PANEL).                               19220099
192300                                                                  19230099
192400     MOVE ASC-END-OF-SELECTED-RANGE                               19240099
192500                                   TO  PV-END-OF-SELECTED-RANGE.  19250099
192600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19260099
192700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19270099
192800               PC-ITEMS-PER-PANEL).                               19280099
192900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19290099
193000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19300099
193100                                                                  19310099
193200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19320099
193300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19330099
193400         MOVE +1                   TO ASC-BLK-SUB                 19340099
193500         PERFORM 5100-WRITE-TEMP-STORAGE                          19350099
193600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19360099
193700             PV-FIRST-BLOCK-IN-ARRAY - 1                          19370099
193800                                                                  19380099
193900         PERFORM                                                  19390099
194000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19400099
194100                   PV-PREV-BLOCK-IN-ARRAY                         19410099
194200             MOVE PV-FIRST-BLOCK-IN-RANGE                         19420099
194300                                   TO PV-BLOCK-NUMBER             19430099
194400             PERFORM 4410-READ-TEMP-STORAGE                       19440099
194500             PERFORM 3510-MARK-SELECTED-INDS                      19450099
194600                 VARYING ASC-ITEM-SUB                             19460099
194700                 FROM 1 BY 1                                      19470099
194800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19480099
194900             PERFORM 5100-WRITE-TEMP-STORAGE                      19490099
195000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19500099
195100         END-PERFORM                                              19510099
195200                                                                  19520099
195300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19530099
195400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19540099
195500         PERFORM                                                  19550099
195600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19560099
195700                   PV-LAST-BLOCK-IN-RANGE                         19570099
195800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19580099
195900                                   TO PV-BLOCK-NUMBER             19590099
196000             PERFORM 4410-READ-TEMP-STORAGE                       19600099
196100             PERFORM 3510-MARK-SELECTED-INDS                      19610099
196200                 VARYING ASC-ITEM-SUB                             19620099
196300                 FROM 1 BY 1                                      19630099
196400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19640099
196500             PERFORM 5100-WRITE-TEMP-STORAGE                      19650099
196600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19660099
196700         END-PERFORM                                              19670099
196800                                                                  19680099
196900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19690099
197000                                   TO PV-BLOCK-NUMBER             19700099
197100         PERFORM 4410-READ-TEMP-STORAGE                           19710099
197200     END-IF.                                                      19720099
197300                                                                  19730099
197400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19740099
197500                                      ASC-END-OF-SELECTED-RANGE.  19750099
197600                                                                  19760099
197700 EJECT                                                            19770099
197800*----------------------------------------------------------------*19780099
197900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19790099
198000*----------------------------------------------------------------*19800099
198100 3510-MARK-SELECTED-INDS.                                         19810099
198200                                                                  19820099
198300     IF PS-CICS-SWITCH-YES                                        19830099
198400         INITIALIZE PV-CICS-MSG-AREA                              19840099
198500         STRING ' ' PV-SRC-TASK-NUMBER                            19850099
198600                ' WSKCS315-3510'                                  19860099
198700                DELIMITED BY SIZE                                 19870099
198800                          INTO PV-CICS-MSG-AREA                   19880099
198900         PERFORM 7000-WRITE-TO-CICS-LOG                           19890099
199000     END-IF.                                                      19900099
199100*                                                                 19910099
199200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19920099
199300                                ASC-ITEM-SUB) >                   19930099
199400         ASC-START-OF-SELECTED-RANGE)                             19940099
199500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19950099
199600                                ASC-ITEM-SUB) =                   19960099
199700         ASC-START-OF-SELECTED-RANGE)                             19970099
199800                                                                  19980099
199900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19990099
200000                                    ASC-ITEM-SUB) <               20000099
200100             ASC-END-OF-SELECTED-RANGE)                           20010099
200200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20020099
200300                                    ASC-ITEM-SUB) =               20030099
200400             ASC-END-OF-SELECTED-RANGE)                           20040099
200500                                                                  20050099
200600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20060099
200700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20070099
200800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20080099
200900                               TO TRUE                            20090099
201000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20100099
201100                               TO TRUE                            20110099
201200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20120099
201300             END-IF                                               20130099
201400         END-IF                                                   20140099
201500     END-IF.                                                      20150099
201600                                                                  20160099
201700 EJECT                                                            20170099
201800*----------------------------------------------------------------*20180099
201900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20190099
202000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20200099
202100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20210099
202200*    DISPLAY THE PANEL TO USER.                                  *20220099
202300*----------------------------------------------------------------*20230099
202400 4000-BUILD-INITIAL-PANEL.                                        20240099
202500                                                                  20250099
202600     IF PS-CICS-SWITCH-YES                                        20260099
202700         INITIALIZE PV-CICS-MSG-AREA                              20270099
202800         STRING ' ' PV-SRC-TASK-NUMBER                            20280099
202900                ' WSKCS315-4000'                                  20290099
203000                DELIMITED BY SIZE                                 20300099
203100                          INTO PV-CICS-MSG-AREA                   20310099
203200         PERFORM 7000-WRITE-TO-CICS-LOG                           20320099
203300     END-IF.                                                      20330099
203400*                                                                 20340099
203500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            20350099
203600                                 ASC-BLOCK-ENTRIES (2)            20360099
203700                                 ASC-TOTAL-UNT-CNT                20370099
203800                                 ASC-TOTAL-CRT-CNT                20380099
203900                                 ASC-TOTAL-SSCC-CNT.              20390099
204000                                                                  20400099
204100     MOVE +1                 TO ASC-BLK-SUB.                      20410032
204200     SET ASC-ITEMS-LEFT-ON-DB                                     20420032
204300                             TO TRUE.                             20430032
204400                                                                  20440032
204500     MOVE +0                 TO ASC-ITEM-SUB                      20450032
204600                                ASC-NUMBER-OF-ITEMS-READ          20460032
204700                                ASC-NUMBER-OF-SELECTED-ITEMS      20470032
204800                                ASC-HIGHEST-BLOCK-WRITTEN         20480032
204900                                ASC-START-OF-SELECTED-RANGE       20490032
205000                                ASC-END-OF-SELECTED-RANGE         20500032
205100                                ASC-ITEM-AT-TOP-OF-PANEL.         20510032
205200                                                                  20520032
205300     MOVE ASC-KEY-TRIP-ID      TO DK-TRIP-ID.                     20530032
205400                                                                  20540032
205500     PERFORM 4010-OPEN-CURSOR.                                    20550032
205600     PERFORM 4300-READ-ITEMS-FROM-DB.                             20560032
205700     PERFORM 4020-CLOSE-CURSOR.                                   20570032
205800                                                                  20580032
205900     MOVE +1                   TO  PV-TOP-ITEM.                   20590032
206000     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           20600032
206100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    20610032
206200         SET DP020-MSG-FATAL   TO  TRUE                           20620032
206300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20630032
206400     ELSE                                                         20640032
206500         MOVE -1               TO MR-SELECTL (1)                  20650032
206600         SET DP030-SET-CURSOR-APPL-1                              20660032
206700                               TO TRUE                            20670032
206800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20680032
206900     END-IF.                                                      20690032
207000/                                                                 20700032
207100                                                                  20710032
207200 4010-OPEN-CURSOR.                                                20720032
207300                                                                  20730032
207400     IF PS-CICS-SWITCH-YES                                        20740099
207500         INITIALIZE PV-CICS-MSG-AREA                              20750099
207600         MOVE DK-TRIP-ID TO PV-DISPLAY-1                          20760099
207700         STRING ' ' PV-SRC-TASK-NUMBER                            20770099
207800                ' WSKCS315-4010 OPEN CURSOR'                      20780099
207900                ' TRIP=' PV-DISPLAY-1                             20790099
208000                DELIMITED BY SIZE                                 20800099
208100                          INTO PV-CICS-MSG-AREA                   20810099
208200         PERFORM 7000-WRITE-TO-CICS-LOG                           20820099
208300     END-IF.                                                      20830099
208400*                                                                 20840032
208500     EXEC SQL                                                     20850032
208600         OPEN  WMS-SHIP-CSR                                       20860032
208700     END-EXEC.                                                    20870032
208800                                                                  20880032
208900     EVALUATE TRUE                                                20890032
209000         WHEN SQLCODE = ZERO                                      20900032
209100             SET PS-EOF-WMS-CSR-NO TO TRUE                        20910099
209200         WHEN SQLCODE = -904                                      20920032
209300         WHEN SQLCODE = -913                                      20930032
209400             CONTINUE                                             20940032
209500         WHEN SQLWARN0 NOT = SPACES                               20950032
209600         WHEN SQLCODE < ZERO                                      20960032
209700         WHEN SQLCODE > ZERO                                      20970032
209800             INITIALIZE PV-CICS-MSG-AREA                          20980099
209900             MOVE SQLCODE TO PV-DISPLAY                           20990099
210000             STRING ' ' PV-SRC-TASK-NUMBER                        21000099
210100                    ' WSKCS315-4010'                              21010099
210200                    ' SQL=' PV-DISPLAY                            21020099
210300                    DELIMITED BY SIZE                             21030099
210400                          INTO PV-CICS-MSG-AREA                   21040099
210500             PERFORM 7000-WRITE-TO-CICS-LOG                       21050099
210600*                                                                 21060032
210700             MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH           21070099
210800             MOVE 'OPEN CURSOR PROBLEM    - '                     21080032
210900                                   TO DP013-MESSAGE-TEXT (1)      21090032
211000             MOVE SQLCA        TO DP013-SQLCA                     21100032
211100             MOVE 'WST_SHPMT_XREF_HDR'                            21110032
211200                               TO DP013-DB2-TABLE-NAME (1)        21120032
211300             SET DP013-DB2-ABEND                                  21130032
211400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21140032
211500             PERFORM DP013-0000-PROCESS-ABEND                     21150032
211600     END-EVALUATE.                                                21160032
211700*                                                                 21170032
211800                                                                  21180032
211900 4020-CLOSE-CURSOR.                                               21190032
212000                                                                  21200032
212100     IF PS-CICS-SWITCH-YES                                        21210099
212200         INITIALIZE PV-CICS-MSG-AREA                              21220099
212300         STRING ' ' PV-SRC-TASK-NUMBER                            21230099
212400                ' WSKCS315-4020 CLOSE CURSOR'                     21240099
212500                DELIMITED BY SIZE                                 21250099
212600                          INTO PV-CICS-MSG-AREA                   21260099
212700         PERFORM 7000-WRITE-TO-CICS-LOG                           21270099
212800     END-IF.                                                      21280099
212900*                                                                 21290032
213000     EXEC SQL                                                     21300032
213100         CLOSE  WMS-SHIP-CSR                                      21310032
213200     END-EXEC.                                                    21320032
213300                                                                  21330032
213400     EVALUATE TRUE                                                21340032
213500         WHEN SQLCODE = ZERO                                      21350032
213600         WHEN SQLCODE = +100                                      21360032
213700             CONTINUE                                             21370032
213800         WHEN SQLWARN0 NOT = SPACES                               21380032
213900         WHEN SQLCODE < ZERO                                      21390032
214000         WHEN SQLCODE > ZERO                                      21400032
214100             INITIALIZE PV-CICS-MSG-AREA                          21410099
214200             MOVE SQLCODE TO PV-DISPLAY                           21420099
214300             STRING ' ' PV-SRC-TASK-NUMBER                        21430099
214400                    ' WSKCS315-4020'                              21440099
214500                    ' SQL=' PV-DISPLAY                            21450099
214600                    DELIMITED BY SIZE                             21460099
214700                          INTO PV-CICS-MSG-AREA                   21470099
214800             PERFORM 7000-WRITE-TO-CICS-LOG                       21480099
214900*                                                                 21490032
215000             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          21500032
215100             MOVE 'CLOSE CURSOR PROBLEM   '                       21510032
215200                               TO DP013-MESSAGE-TEXT (1)          21520032
215300             MOVE SQLCA        TO DP013-SQLCA                     21530032
215400             MOVE 'WST_SHPMT_XREF_HDR'                            21540032
215500                               TO DP013-DB2-TABLE-NAME (1)        21550032
215600             SET DP013-DB2-ABEND                                  21560032
215700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21570032
215800             PERFORM DP013-0000-PROCESS-ABEND                     21580032
215900     END-EVALUATE.                                                21590032
216000                                                                  21600032
216100*----------------------------------------------------------------*21610032
216200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *21620032
216300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *21630032
216400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *21640032
216500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21650032
216600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21660032
216700*                                                                *21670032
216800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21680032
216900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21690032
217000*    UPON INITIALIZATION.                                        *21700032
217100*----------------------------------------------------------------*21710032
217200                                                                  21720032
217300 4300-READ-ITEMS-FROM-DB.                                         21730032
217400                                                                  21740032
217500     IF PS-CICS-SWITCH-YES                                        21750099
217600         INITIALIZE PV-CICS-MSG-AREA                              21760099
217700         STRING ' ' PV-SRC-TASK-NUMBER                            21770099
217800                ' WSKCS315-4300'                                  21780099
217900                DELIMITED BY SIZE                                 21790099
218000                          INTO PV-CICS-MSG-AREA                   21800099
218100         PERFORM 7000-WRITE-TO-CICS-LOG                           21810099
218200     END-IF.                                                      21820099
218300*                                                                 21830032
218400     PERFORM 4310-PROCESS-DATA                                    21840032
218500         UNTIL PS-EOF-WMS-CSR-YES.                                21850032
218600                                                                  21860032
218700     MOVE ASC-TOTAL-UNT-CNT        TO AUNTTOTO.                   21870099
218800     MOVE ASC-TOTAL-CRT-CNT        TO ACRTTOTO.                   21880099
218900     MOVE ASC-TOTAL-SSCC-CNT       TO ASSCTOTO.                   21890099
219000                                                                  21900099
219100     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           21910032
219200         MOVE +1               TO ASC-BLK-SUB                     21920032
219300         PERFORM 5100-WRITE-TEMP-STORAGE                          21930032
219400         ADD +1                TO ASC-BLK-SUB                     21940032
219500         PERFORM 5100-WRITE-TEMP-STORAGE                          21950032
219600                                                                  21960032
219700         MOVE 1                TO ASC-BLK-SUB                     21970032
219800                                  PV-BLOCK-NUMBER                 21980032
219900         PERFORM 4410-READ-TEMP-STORAGE                           21990032
220000         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              22000032
220100             MOVE 2            TO ASC-BLK-SUB                     22010032
220200                                  PV-BLOCK-NUMBER                 22020032
220300             PERFORM 4410-READ-TEMP-STORAGE                       22030032
220400         END-IF                                                   22040032
220500     END-IF.                                                      22050032
220600 EJECT                                                            22060032
220700                                                                  22070032
220800*----------------------------------------------------------------*22080099
220900*    FETCH DATA FROM THE CURSOR                                   22090032
221000*----------------------------------------------------------------*22100032
221100 4310-PROCESS-DATA.                                               22110032
221200                                                                  22120032
221300     EXEC SQL                                                     22130099
221400          FETCH   WMS-SHIP-CSR                                    22140032
221500           INTO  :WST00001-EXT-SHP-ID                             22150032
221600              ,  :WST00001-DWNLD-CDE                              22160032
221700              ,  :WST00001-DWNLD-TMST                             22170032
221800              ,  :WST00001-RCPT-TMST                              22180032
221900              ,  :WST00001-CRE-USR-ID                             22190032
222000     END-EXEC.                                                    22200032
222100                                                                  22210032
222200     EVALUATE TRUE                                                22220032
222300         WHEN SQLCODE = ZERO                                      22230032
222400              IF PS-CICS-SWITCH-YES                               22240099
222500                  INITIALIZE PV-CICS-MSG-AREA                     22250099
222600                  STRING ' ' PV-SRC-TASK-NUMBER                   22260099
222700                         ' WSKCS315-4310'                         22270099
222800                         ' SHPMT=' WST00001-EXT-SHP-ID            22280099
222900                       DELIMITED BY SIZE                          22290099
223000                                INTO PV-CICS-MSG-AREA             22300099
223100                  PERFORM 7000-WRITE-TO-CICS-LOG                  22310099
223200              END-IF                                              22320099
223300              PERFORM 4320-PROCESS-DATA                           22330032
223400         WHEN SQLCODE = +100                                      22340032
223500              SET PS-EOF-WMS-CSR-YES TO TRUE                      22350032
223600         WHEN SQLWARN0 NOT = SPACE                                22360032
223700         WHEN SQLCODE NOT = ZERO                                  22370032
223800             INITIALIZE PV-CICS-MSG-AREA                          22380099
223900             MOVE SQLCODE TO PV-DISPLAY                           22390099
224000             STRING ' ' PV-SRC-TASK-NUMBER                        22400099
224100                    ' WSKCS315-4310'                              22410099
224200                    ' SQL=' PV-DISPLAY                            22420099
224300                    DELIMITED BY SIZE                             22430099
224400                          INTO PV-CICS-MSG-AREA                   22440099
224500             PERFORM 7000-WRITE-TO-CICS-LOG                       22450099
224600*                                                                 22460032
224700              MOVE '4310-PROCESS-DATA'                            22470032
224800                               TO DP013-PARAGRAPH                 22480032
224900              MOVE 'FETCH MESSAGE CURSOR'                         22490032
225000                               TO DP013-MESSAGE-TEXT (1)          22500032
225100              MOVE SQLCA       TO DP013-SQLCA                     22510032
225200              SET DP013-DB2-ABEND                                 22520032
225300                               TO TRUE                            22530032
225400              PERFORM DP013-0000-PROCESS-ABEND                    22540032
225500     END-EVALUATE.                                                22550032
225600                                                                  22560032
225700                                                                  22570032
225800*----------------------------------------------------------------*22580099
225900*    PROCESS THE CURSOR DATA                                      22590032
226000*----------------------------------------------------------------*22600032
226100 4320-PROCESS-DATA.                                               22610032
226200                                                                  22620032
226300* JAK 07/2007 - ADD CALL TO 4330-                                 22630032
226400     PERFORM 4330-GET-DETAIL-INFO.                                22640032
226500                                                                  22650032
226600     IF ASC-ITEMS-LEFT-ON-DB                                      22660032
226700         IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                     22670032
226800             ADD +1            TO ASC-ITEM-SUB                    22680032
226900         ELSE                                                     22690032
227000             ADD +1            TO ASC-BLK-SUB                     22700032
227100             MOVE +1           TO ASC-ITEM-SUB                    22710032
227200                                                                  22720032
227300             IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY              22730032
227400                 MOVE +1       TO ASC-BLK-SUB                     22740032
227500                 SET ASC-BLOCK-MODIFIED (1)                       22750032
227600                                   TO TRUE                        22760032
227700                 PERFORM 5100-WRITE-TEMP-STORAGE                  22770032
227800                 MOVE ASC-BLOCK-ENTRIES                           22780032
227900                               (PC-MAX-BLOCKS-IN-ARRAY)           22790032
228000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22800032
228100                 ADD +1        TO ASC-BLK-SUB                     22810032
228200                 INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       22820032
228300                 SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          22830032
228400                                   TO TRUE                        22840032
228500             END-IF                                               22850032
228600         END-IF                                                   22860032
228700                                                                  22870032
228800         ADD +1                TO ASC-NUMBER-OF-ITEMS-READ        22880032
228900         MOVE ASC-NUMBER-OF-ITEMS-READ                            22890032
229000                                   TO ASC-LIST-ITEM-NUMBER        22900032
229100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22910032
229200         MOVE WST00001-EXT-SHP-ID TO ASC-SCREEN-SHIP              22920032
229300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     22930032
229400         EVALUATE WST00001-DWNLD-CDE                              22940032
229500             WHEN 'D'                                             22950032
229600                 MOVE 'DWLD' TO ASC-SCREEN-DNLD-IND               22960032
229700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     22970032
229800             WHEN 'C'                                             22980032
229900                 MOVE 'CMPL' TO ASC-SCREEN-DNLD-IND               22990032
230000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23000032
230100             WHEN 'P'                                             23010032
230200                 MOVE 'TRBL' TO ASC-SCREEN-DNLD-IND               23020032
230300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23030032
230400             WHEN 'X'                                             23040032
230500                 MOVE 'DEL ' TO ASC-SCREEN-DNLD-IND               23050032
230600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23060032
230700             WHEN 'N'                                             23070032
230800                 MOVE 'NDWD' TO ASC-SCREEN-DNLD-IND               23080032
230900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23090032
231000             WHEN OTHER                                           23100032
231100                 MOVE '    ' TO ASC-SCREEN-DNLD-IND               23110032
231200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23120032
231300         END-EVALUATE                                             23130032
231400         IF WST00001-DWNLD-TMST = PC-DEFAULT-NINES                23140032
231500             MOVE SPACES            TO ASC-SCREEN-DNLD-DTE        23150032
231600                                    (ASC-BLK-SUB ASC-ITEM-SUB)    23160032
231700             MOVE SPACES            TO ASC-SCREEN-DNLD-TME        23170032
231800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    23180032
231900         ELSE                                                     23190032
232000             STRING WST00001-DWNLD-TMST(6:2)                      23200032
232100                    '/'                                           23210032
232200                    WST00001-DWNLD-TMST(9:2)                      23220032
232300                    '/'                                           23230032
232400                    WST00001-DWNLD-TMST(1:4)                      23240032
232500                    DELIMITED BY SIZE                             23250032
232600                                  INTO ASC-SCREEN-DNLD-DTE        23260032
232700                                    (ASC-BLK-SUB ASC-ITEM-SUB)    23270032
232800             STRING WST00001-DWNLD-TMST(12:2)                     23280032
232900                    ':'                                           23290032
233000                    WST00001-DWNLD-TMST(15:2)                     23300032
233100                    DELIMITED BY SIZE                             23310032
233200                                  INTO ASC-SCREEN-DNLD-TME        23320032
233300                                    (ASC-BLK-SUB ASC-ITEM-SUB)    23330032
233400         END-IF                                                   23340032
233500         IF WST00001-RCPT-TMST = PC-DEFAULT-NINES                 23350032
233600             MOVE SPACES           TO ASC-SCREEN-RCPT-DTE         23360032
233700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23370032
233800             MOVE SPACES           TO ASC-SCREEN-RCPT-TME         23380032
233900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23390032
234000         ELSE                                                     23400032
234100             STRING WST00001-RCPT-TMST(6:2)                       23410032
234200                    '/'                                           23420032
234300                    WST00001-RCPT-TMST(9:2)                       23430032
234400                    '/'                                           23440032
234500                    WST00001-RCPT-TMST(1:4)                       23450032
234600                    DELIMITED BY SIZE                             23460099
234700                                 INTO ASC-SCREEN-RCPT-DTE         23470032
234800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23480032
234900             STRING WST00001-RCPT-TMST(12:2)                      23490032
235000                    ':'                                           23500032
235100                    WST00001-RCPT-TMST(15:2)                      23510032
235200                    DELIMITED BY SIZE                             23520032
235300                                  INTO ASC-SCREEN-RCPT-TME        23530032
235400                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23540032
235500         END-IF                                                   23550032
235600* JAK 07/2007 - ADD TOTAL UNIT QTY & TOTAL CARTON QTY             23560032
235700         MOVE PV-TOT-UNIT-QTY      TO ASC-SCREEN-UNIT-QTY         23570032
235800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23580032
235900         MOVE PV-TOT-CRTN-QTY      TO ASC-SCREEN-CRTN-QTY         23590032
236000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23600032
236100         MOVE WST00001-CRE-USR-ID  TO ASC-SCREEN-CRE-BY           23610032
236200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23620032
236300         MOVE PV-TOT-EXP-SCAN      TO ASC-SCREEN-EXP-QTY          23630032
236400                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23640032
236500         IF PS-CICS-SWITCH-YES                                    23650099
236600             INITIALIZE PV-CICS-MSG-AREA                          23660099
236700             STRING ' ' PV-SRC-TASK-NUMBER                        23670099
236800                    ' WSKCS315-4320'                              23680099
236900                    ' SHIP=' ASC-SCREEN-SHIP                      23690032
237000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23700032
237100                    ' DNLD=' ASC-SCREEN-DNLD-IND                  23710032
237200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23720032
237300                    ' DNLD DTE=' ASC-SCREEN-DNLD-DTE              23730032
237400                                  (ASC-BLK-SUB ASC-ITEM-SUB)      23740032
237500                    ' DNLD TME=' ASC-SCREEN-DNLD-TME              23750032
237600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23760032
237700                    DELIMITED BY SIZE                             23770099
237800                              INTO PV-CICS-MSG-AREA               23780099
237900             PERFORM 7000-WRITE-TO-CICS-LOG                       23790099
238000             INITIALIZE PV-CICS-MSG-AREA                          23800099
238100             STRING ' ' PV-SRC-TASK-NUMBER                        23810099
238200                    ' WSKCS315-4320'                              23820099
238300                    ' RCPT DTE=' ASC-SCREEN-RCPT-DTE              23830032
238400                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23840032
238500                    ' RCPT TME=' ASC-SCREEN-RCPT-TME              23850032
238600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23860032
238700                    ' CRE=' ASC-SCREEN-CRE-BY                     23870032
238800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     23880032
238900                    DELIMITED BY SIZE                             23890099
239000                              INTO PV-CICS-MSG-AREA               23900099
239100             PERFORM 7000-WRITE-TO-CICS-LOG                       23910099
239200         END-IF                                                   23920099
239300*        SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      23930032
239400     END-IF.                                                      23940032
239500                                                                  23950032
239600* JAK 07/2007 - ADD NEW PARAGRAPHS                                23960099
239700*----------------------------------------------------------------*23970032
239800* GET INFORMATION FROM THE XREF DETAIL TABLE                     *23980032
239900*----------------------------------------------------------------*23990032
240000 4330-GET-DETAIL-INFO.                                            24000032
240100                                                                  24010099
240200                                                                  24020032
240300     MOVE WST00001-EXT-SHP-ID         TO DK-EXT-SHP-ID.           24030032
240400     MOVE 0                           TO PV-TOT-UNIT-QTY.         24040032
240500     MOVE 0                           TO PV-TOT-CRTN-QTY.         24050032
240600     MOVE 0                           TO PV-TOT-EXP-SCAN.         24060032
240610                                                                  24061099
240620     IF  ASC-OTBD-SHIP                                            24062099
240630         PERFORM 4500-GET-SHIP-TRIP-INFO                          24063099
240640     ELSE                                                         24064099
240700         PERFORM 4340-OPEN-SKU-CSR                                24070099
240800         PERFORM 4350-FETCH-SKU-CSR                               24080099
240900           UNTIL PS-EOF-SKU-CSR-YES                               24090099
241000         PERFORM 4360-CLOSE-SKU-CSR                               24100099
241100     END-IF.                                                      24110099
241200                                                                  24120032
241300 4340-OPEN-SKU-CSR.                                               24130032
241400                                                                  24140032
241500     IF PS-CICS-SWITCH-YES                                        24150099
241600         INITIALIZE PV-CICS-MSG-AREA                              24160099
241700         STRING ' ' PV-SRC-TASK-NUMBER                            24170099
241800                ' WSKCS315-4340 OPEN SKU CSR'                     24180099
241900                ' SHPMT=' DK-EXT-SHP-ID                           24190099
242000                DELIMITED BY SIZE                                 24200099
242100                          INTO PV-CICS-MSG-AREA                   24210099
242200         PERFORM 7000-WRITE-TO-CICS-LOG                           24220099
242300     END-IF.                                                      24230099
242400*                                                                 24240032
242500     EXEC SQL                                                     24250032
242600         OPEN  SKU-DTL-CSR                                        24260032
242700     END-EXEC.                                                    24270032
242800                                                                  24280032
242900     EVALUATE TRUE                                                24290032
243000         WHEN SQLCODE = ZERO                                      24300032
243100             SET PS-EOF-SKU-CSR-NO TO TRUE                        24310032
243200         WHEN SQLCODE = -904                                      24320032
243300         WHEN SQLCODE = -913                                      24330032
243400             CONTINUE                                             24340032
243500         WHEN SQLWARN0 NOT = SPACES                               24350032
243600         WHEN SQLCODE < ZERO                                      24360032
243700         WHEN SQLCODE > ZERO                                      24370032
243800             INITIALIZE PV-CICS-MSG-AREA                          24380099
243900             MOVE SQLCODE TO PV-DISPLAY                           24390099
244000             STRING ' ' PV-SRC-TASK-NUMBER                        24400099
244100                    ' WSKCS315-4340'                              24410099
244200                    ' SQL=' PV-DISPLAY                            24420099
244300                    DELIMITED BY SIZE                             24430099
244400                          INTO PV-CICS-MSG-AREA                   24440099
244500             PERFORM 7000-WRITE-TO-CICS-LOG                       24450099
244600*                                                                 24460032
244700             MOVE '4340-OPEN-SKU-CSR' TO DP013-PARAGRAPH          24470032
244800             MOVE 'OPEN SKU CSR PROBLEM   - '                     24480032
244900                                   TO DP013-MESSAGE-TEXT (1)      24490032
245000             MOVE SQLCA        TO DP013-SQLCA                     24500032
245100             MOVE 'WST_SHPMT_XREF_DTL'                            24510032
245200                               TO DP013-DB2-TABLE-NAME (1)        24520032
245300             SET DP013-DB2-ABEND                                  24530032
245400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24540032
245500             PERFORM DP013-0000-PROCESS-ABEND                     24550032
245600     END-EVALUATE.                                                24560032
245700*                                                                 24570032
245800                                                                  24580032
245900 4350-FETCH-SKU-CSR.                                              24590032
246000                                                                  24600032
246100     EXEC SQL                                                     24610032
246200          FETCH   SKU-DTL-CSR                                     24620032
246300           INTO  :WST00002-PO-NBR                                 24630032
246400              ,  :WST00002-PO-LNE-NBR                             24640032
246500              ,  :WST00002-RCVR-SEQ-NBR                           24650032
246600              ,  :WST00002-ASN-LVL-CDE                            24660032
246700              ,  :WST00002-PREPK-ID                               24670032
246800     END-EXEC.                                                    24680032
246900                                                                  24690032
247000     EVALUATE TRUE                                                24700032
247100         WHEN SQLCODE = ZERO                                      24710032
247200              IF PS-CICS-SWITCH-YES                               24720099
247300                  MOVE WST00002-PO-NBR       TO PV-DISPLAY-1      24730099
247400                  MOVE WST00002-PO-LNE-NBR   TO PV-DISPLAY-2      24740099
247500                  MOVE WST00002-RCVR-SEQ-NBR TO PV-DISPLAY-3      24750099
247600                  INITIALIZE PV-CICS-MSG-AREA                     24760099
247700                  STRING ' ' PV-SRC-TASK-NUMBER                   24770099
247800                         ' WSKCS315-4350'                         24780099
247900                         ' PO=' PV-DISPLAY-1                      24790099
248000                         '-' PV-DISPLAY-3                         24800099
248100                         ' LINE=' PV-DISPLAY-2                    24810099
248200                       DELIMITED BY SIZE                          24820099
248300                                INTO PV-CICS-MSG-AREA             24830099
248400                  PERFORM 7000-WRITE-TO-CICS-LOG                  24840099
248500              END-IF                                              24850099
248600              PERFORM 4370-ACCUM-TOT-AMTS                         24860032
248700              IF WST00002-PO-NBR NOT = PV-HOLD-PO-NBR             24870032
248800              OR WST00002-RCVR-SEQ-NBR NOT = PV-HOLD-RCVR-SEQ-NBR 24880032
248900                  PERFORM 4380-GET-CRTN-CNT                       24890032
249000                  PERFORM 4333-OPEN-COUNT-CSR                     24900099
249100                  PERFORM 4334-FETCH-COUNT-CSR                    24910099
249200                    UNTIL PS-EOF-CNT-CSR-YES                      24920099
249300                  PERFORM 4335-CLOSE-COUNT-CSR                    24930099
249400                   ADD PV-DB2-COUNT-EXP-SCN TO PV-TOT-EXP-SCAN    24940099
249500                                               ASC-TOTAL-SSCC-CNT 24950099
249600                  MOVE WST00002-PO-NBR  TO PV-HOLD-PO-NBR         24960099
249700                  MOVE WST00002-RCVR-SEQ-NBR                      24970099
249800                                        TO PV-HOLD-RCVR-SEQ-NBR   24980099
249900              END-IF                                              24990099
250000         WHEN SQLCODE = +100                                      25000099
250100              SET PS-EOF-SKU-CSR-YES TO TRUE                      25010099
250200         WHEN SQLWARN0 NOT = SPACE                                25020099
250300         WHEN SQLCODE NOT = ZERO                                  25030099
250400             INITIALIZE PV-CICS-MSG-AREA                          25040099
250500             MOVE SQLCODE TO PV-DISPLAY                           25050099
250600             STRING ' ' PV-SRC-TASK-NUMBER                        25060099
250700                    ' WSKCS315-4350'                              25070099
250800                    ' SQL=' PV-DISPLAY                            25080099
250900                    DELIMITED BY SIZE                             25090099
251000                          INTO PV-CICS-MSG-AREA                   25100099
251100             PERFORM 7000-WRITE-TO-CICS-LOG                       25110099
251200*                                                                 25120032
251300             MOVE '4350-FETCH-SKU-CSR'                            25130032
251400                                  TO DP013-PARAGRAPH              25140032
251500             MOVE 'FETCH SKU CURSOR'                              25150032
251600                                  TO DP013-MESSAGE-TEXT (1)       25160032
251700             MOVE SQLCA           TO DP013-SQLCA                  25170032
251800             MOVE 'WST_SHPMT_XREF_DTL'                            25180032
251900                                  TO DP013-DB2-TABLE-NAME (1)     25190032
252000             SET DP013-DB2-ABEND  TO TRUE                         25200032
252100             PERFORM DP013-0000-PROCESS-ABEND                     25210032
252200     END-EVALUATE.                                                25220032
252300******************************************************************25230099
252400******************************************************************25240099
252500                                                                  25250099
252600 4333-OPEN-COUNT-CSR.                                             25260099
252700     INITIALIZE        PV-DB2-COUNT-EXP-SCN.                      25270099
252800                                                                  25280099
252900                                                                  25290099
253000     IF PS-CICS-SWITCH-YES                                        25300099
253100         INITIALIZE PV-CICS-MSG-AREA                              25310099
253200         STRING ' ' PV-SRC-TASK-NUMBER                            25320099
253300                ' WSKCS315-4333 OPEN COUNT CSR'                   25330099
253400                ' SHPMT=' DK-EXT-SHP-ID                           25340099
253500                DELIMITED BY SIZE                                 25350099
253600                          INTO PV-CICS-MSG-AREA                   25360099
253700         PERFORM 7000-WRITE-TO-CICS-LOG                           25370099
253800     END-IF.                                                      25380099
253900*                                                                 25390099
254000     EXEC SQL                                                     25400099
254100         OPEN  TOT-CNT-CSR                                        25410099
254200     END-EXEC.                                                    25420099
254300                                                                  25430099
254400     EVALUATE TRUE                                                25440099
254500         WHEN SQLCODE = ZERO                                      25450099
254600             SET PS-EOF-CNT-CSR-NO TO TRUE                        25460099
254700         WHEN SQLCODE = -904                                      25470099
254800         WHEN SQLCODE = -913                                      25480099
254900             CONTINUE                                             25490099
255000         WHEN SQLWARN0 NOT = SPACES                               25500099
255100         WHEN SQLCODE < ZERO                                      25510099
255200         WHEN SQLCODE > ZERO                                      25520099
255300             INITIALIZE PV-CICS-MSG-AREA                          25530099
255400             MOVE SQLCODE TO PV-DISPLAY                           25540099
255500             STRING ' ' PV-SRC-TASK-NUMBER                        25550099
255600                    ' WSKCS315-4333'                              25560099
255700                    ' SQL=' PV-DISPLAY                            25570099
255800                    DELIMITED BY SIZE                             25580099
255900                          INTO PV-CICS-MSG-AREA                   25590099
256000             PERFORM 7000-WRITE-TO-CICS-LOG                       25600099
256100*                                                                 25610099
256200             MOVE '4333-OPEN-COUNT-CSR' TO DP013-PARAGRAPH        25620099
256300             MOVE 'OPEN CNT CSR PROBLEM   - '                     25630099
256400                                   TO DP013-MESSAGE-TEXT (1)      25640099
256500             MOVE SQLCA        TO DP013-SQLCA                     25650099
256600             MOVE 'TSHIPMT'                                       25660099
256700                               TO DP013-DB2-TABLE-NAME (1)        25670099
256800             MOVE 'TSHPTPO'                                       25680099
256900                               TO DP013-DB2-TABLE-NAME (2)        25690099
257000             MOVE 'TPKSLIP'                                       25700099
257100                               TO DP013-DB2-TABLE-NAME (3)        25710099
257200             MOVE 'TINPKSU'                                       25720099
257300                               TO DP013-DB2-TABLE-NAME (4)        25730099
257400             MOVE 'TSHPUNT'                                       25740099
257500                               TO DP013-DB2-TABLE-NAME (5)        25750099
257600             SET DP013-DB2-ABEND                                  25760099
257700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25770099
257800             PERFORM DP013-0000-PROCESS-ABEND                     25780099
257900     END-EVALUATE.                                                25790099
258000                                                                  25800099
258100 4334-FETCH-COUNT-CSR.                                            25810099
258200                                                                  25820099
258300     EXEC SQL                                                     25830099
258400          FETCH   TOT-CNT-CSR                                     25840099
258500           INTO  :PV-SHIPT-UNT-ID                                 25850099
258600     END-EXEC.                                                    25860099
258700                                                                  25870099
258800     EVALUATE TRUE                                                25880099
258900         WHEN SQLCODE = ZERO                                      25890099
259000              IF PS-CICS-SWITCH-YES                               25900099
259100                  MOVE PV-SHIPT-UNT-ID       TO PV-DISPLAY-1      25910099
259200                  INITIALIZE PV-CICS-MSG-AREA                     25920099
259300                  STRING ' ' PV-SRC-TASK-NUMBER                   25930099
259400                         ' WSKCS315-4334'                         25940099
259500                         ' SHIPT=' PV-DISPLAY-1                   25950099
259600                       DELIMITED BY SIZE                          25960099
259700                                INTO PV-CICS-MSG-AREA             25970099
259800                  PERFORM 7000-WRITE-TO-CICS-LOG                  25980099
259900              END-IF                                              25990099
260000                 ADD +1 TO  PV-DB2-COUNT-EXP-SCN                  26000099
260100         WHEN SQLCODE = +100                                      26010099
260200              SET PS-EOF-CNT-CSR-YES TO TRUE                      26020099
260300         WHEN SQLWARN0 NOT = SPACE                                26030099
260400         WHEN SQLCODE NOT = ZERO                                  26040099
260500             INITIALIZE PV-CICS-MSG-AREA                          26050099
260600             MOVE SQLCODE TO PV-DISPLAY                           26060099
260700             STRING ' ' PV-SRC-TASK-NUMBER                        26070099
260800                    ' WSKCS315-4334'                              26080099
260900                    ' SQL=' PV-DISPLAY                            26090099
261000                    DELIMITED BY SIZE                             26100099
261100                          INTO PV-CICS-MSG-AREA                   26110099
261200             PERFORM 7000-WRITE-TO-CICS-LOG                       26120099
261300*                                                                 26130099
261400             MOVE '4334-FETCH-CNT-CSR'                            26140099
261500                                  TO DP013-PARAGRAPH              26150099
261600             MOVE 'FETCH CNT CURSOR'                              26160099
261700                                  TO DP013-MESSAGE-TEXT (1)       26170099
261800             MOVE SQLCA           TO DP013-SQLCA                  26180099
261900             SET DP013-DB2-ABEND  TO TRUE                         26190099
262000             PERFORM DP013-0000-PROCESS-ABEND                     26200099
262100     END-EVALUATE.                                                26210099
262200                                                                  26220099
262300******************************************************************26230099
262400******************************************************************26240032
262500                                                                  26250032
262600 4360-CLOSE-SKU-CSR.                                              26260032
262700                                                                  26270032
262800     IF PS-CICS-SWITCH-YES                                        26280099
262900         INITIALIZE PV-CICS-MSG-AREA                              26290099
263000         STRING ' ' PV-SRC-TASK-NUMBER                            26300099
263100                ' WSKCS315-4360 CLOSE SKU CSR'                    26310099
263200                DELIMITED BY SIZE                                 26320099
263300                          INTO PV-CICS-MSG-AREA                   26330099
263400         PERFORM 7000-WRITE-TO-CICS-LOG                           26340099
263500     END-IF.                                                      26350099
263600*                                                                 26360032
263700     EXEC SQL                                                     26370032
263800         CLOSE  SKU-DTL-CSR                                       26380032
263900     END-EXEC.                                                    26390032
264000                                                                  26400032
264100     EVALUATE TRUE                                                26410032
264200         WHEN SQLCODE = ZERO                                      26420032
264300         WHEN SQLCODE = +100                                      26430032
264400             CONTINUE                                             26440032
264500         WHEN SQLWARN0 NOT = SPACES                               26450032
264600         WHEN SQLCODE < ZERO                                      26460032
264700         WHEN SQLCODE > ZERO                                      26470032
264800             INITIALIZE PV-CICS-MSG-AREA                          26480099
264900             MOVE SQLCODE TO PV-DISPLAY                           26490099
265000             STRING ' ' PV-SRC-TASK-NUMBER                        26500099
265100                    ' WSKCS315-4360'                              26510099
265200                    ' SQL=' PV-DISPLAY                            26520099
265300                    DELIMITED BY SIZE                             26530099
265400                          INTO PV-CICS-MSG-AREA                   26540099
265500             PERFORM 7000-WRITE-TO-CICS-LOG                       26550099
265600*                                                                 26560032
265700             MOVE '4360-CLOSE-SKU-CSR' TO DP013-PARAGRAPH         26570032
265800             MOVE 'CLOSE SKU CSR PROBLEM'                         26580032
265900                               TO DP013-MESSAGE-TEXT (1)          26590032
266000             MOVE SQLCA        TO DP013-SQLCA                     26600032
266100             MOVE 'WST_SHPMT_XREF_DTL'                            26610032
266200                               TO DP013-DB2-TABLE-NAME (1)        26620032
266300             SET DP013-DB2-ABEND                                  26630032
266400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26640032
266500             PERFORM DP013-0000-PROCESS-ABEND                     26650032
266600     END-EVALUATE.                                                26660032
266700                                                                  26670032
266800*AMIT*INITIAL*****************************************************26680099
266900******************************************************************26690099
267000                                                                  26700099
267100 4335-CLOSE-COUNT-CSR.                                            26710099
267200                                                                  26720099
267300     IF PS-CICS-SWITCH-YES                                        26730099
267400         INITIALIZE PV-CICS-MSG-AREA                              26740099
267500         STRING ' ' PV-SRC-TASK-NUMBER                            26750099
267600                ' WSKCS315-4335 CLOSE CNT CSR'                    26760099
267700                DELIMITED BY SIZE                                 26770099
267800                          INTO PV-CICS-MSG-AREA                   26780099
267900         PERFORM 7000-WRITE-TO-CICS-LOG                           26790099
268000     END-IF.                                                      26800099
268100*                                                                 26810099
268200     EXEC SQL                                                     26820099
268300         CLOSE  TOT-CNT-CSR                                       26830099
268400     END-EXEC.                                                    26840099
268500                                                                  26850099
268600     EVALUATE TRUE                                                26860099
268700         WHEN SQLCODE = ZERO                                      26870099
268800         WHEN SQLCODE = +100                                      26880099
268900             CONTINUE                                             26890099
269000         WHEN SQLWARN0 NOT = SPACES                               26900099
269100         WHEN SQLCODE < ZERO                                      26910099
269200         WHEN SQLCODE > ZERO                                      26920099
269300             INITIALIZE PV-CICS-MSG-AREA                          26930099
269400             MOVE SQLCODE TO PV-DISPLAY                           26940099
269500             STRING ' ' PV-SRC-TASK-NUMBER                        26950099
269600                    ' WSKCS315-4335'                              26960099
269700                    ' SQL=' PV-DISPLAY                            26970099
269800                    DELIMITED BY SIZE                             26980099
269900                          INTO PV-CICS-MSG-AREA                   26990099
270000             PERFORM 7000-WRITE-TO-CICS-LOG                       27000099
270100*                                                                 27010099
270200             MOVE '4335-CLOSE-COUNT-CSR' TO DP013-PARAGRAPH       27020099
270300             MOVE 'CLOSE CNT CSR PROBLEM'                         27030099
270400                               TO DP013-MESSAGE-TEXT (1)          27040099
270500             MOVE SQLCA        TO DP013-SQLCA                     27050099
270600             SET DP013-DB2-ABEND                                  27060099
270700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27070099
270800             PERFORM DP013-0000-PROCESS-ABEND                     27080099
270900     END-EVALUATE.                                                27090099
271000                                                                  27100099
271100*AMIT*FINAL*******************************************************27110099
271200                                                                  27120099
271300                                                                  27130099
271400 4370-ACCUM-TOT-AMTS.                                             27140099
271500                                                                  27150099
271600     EXEC SQL                                                     27160099
271700         SELECT  PKSL_ITM_QTY                                     27170099
271800               , DTL_CK_ITM_QTY                                   27180099
271900           INTO  :RECITM-PKSL-ITM-QTY                             27190099
272000               , :RECITM-DTL-CK-ITM-QTY                           27200099
272100           FROM  TRECITM                                          27210099
272200          WHERE  ORD_NBR     = :WST00002-PO-NBR                   27220099
272300            AND  ORD_LNE_NBR = :WST00002-PO-LNE-NBR               27230099
272400            AND  REC_SEQ_NBR = :WST00002-RCVR-SEQ-NBR             27240099
272500     END-EXEC.                                                    27250099
272600                                                                  27260099
272700     EVALUATE TRUE                                                27270099
272800         WHEN SQLCODE = ZERO                                      27280099
272900             IF PS-CICS-SWITCH-YES                                27290099
273000                 INITIALIZE PV-CICS-MSG-AREA                      27300099
273100                 STRING   ' ' PV-SRC-TASK-NUMBER                  27310099
273200                          ' WSKCS315-4370:'                       27320099
273300                          DELIMITED BY SIZE                       27330099
273400                          INTO PV-CICS-MSG-AREA                   27340099
273500                 PERFORM 7000-WRITE-TO-CICS-LOG                   27350099
273600             END-IF                                               27360099
273700             IF RECITM-DTL-CK-ITM-QTY > 0                         27370032
273800                 ADD RECITM-DTL-CK-ITM-QTY    TO PV-TOT-UNIT-QTY  27380032
273900                                                 ASC-TOTAL-UNT-CNT27390099
274000             ELSE                                                 27400032
274100                 ADD RECITM-PKSL-ITM-QTY      TO PV-TOT-UNIT-QTY  27410032
274200                                                 ASC-TOTAL-UNT-CNT27420099
274300             END-IF                                               27430032
274400         WHEN SQLCODE = +100                                      27440099
274500         WHEN SQLCODE = -904                                      27450099
274600         WHEN SQLCODE = -913                                      27460099
274700         WHEN SQLCODE = -911                                      27470099
274800         WHEN SQLCODE = -803                                      27480099
274900             CONTINUE                                             27490099
275000         WHEN SQLWARN0 NOT = SPACES                               27500099
275100         WHEN SQLCODE NOT = ZERO                                  27510099
275200             INITIALIZE PV-CICS-MSG-AREA                          27520099
275300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       27530099
275400             STRING   ' ' PV-SRC-TASK-NUMBER                      27540099
275500                      ' WSKCS315-4370 ERROR:'                     27550099
275600                      ' SQL='                                     27560099
275700                      PV-SQL-RETURN-CD                            27570099
275800                      DELIMITED BY SIZE                           27580099
275900                                      INTO PV-CICS-MSG-AREA       27590099
276000             PERFORM 7000-WRITE-TO-CICS-LOG                       27600099
276100                                                                  27610099
276200             STRING 'SQL='                                        27620099
276300                  PV-SQL-RETURN-CD                                27630099
276400                  DELIMITED BY SIZE                               27640099
276500                                      INTO DP013-MESSAGE-TEXT(1)  27650099
276600             MOVE SQLCA                 TO DP013-SQLCA            27660099
276700             MOVE '4370-ACCUM-TOT-AMTS' TO DP013-PARAGRAPH        27670099
276800             MOVE 'TRECITM'             TO                        27680099
276900                                       DP013-DB2-TABLE-NAME (1)   27690099
277000             SET DP013-DB2-ABEND        TO TRUE                   27700099
277100             PERFORM DP013-0000-PROCESS-ABEND                     27710032
277200                                                                  27720032
277300     END-EVALUATE.                                                27730099
277400                                                                  27740032
277500                                                                  27750032
277600 4380-GET-CRTN-CNT.                                               27760032
277700                                                                  27770099
277800     EXEC SQL                                                     27780032
277900         SELECT  EXPTED_CART_CNT                                  27790032
278000               , PKGNG_CDE                                        27800099
278100               , PACK_BY_ST_IND                                   27810099
278200           INTO  :RECEIV-EXPTED-CART-CNT                          27820099
278300               , :RECEIV-PKGNG-CDE                                27830099
278400               , :RECEIV-PACK-BY-ST-IND                           27840099
278500           FROM  TRECEIV                                          27850099
278600          WHERE  ORD_NBR     = :WST00002-PO-NBR                   27860099
278700            AND  REC_SEQ_NBR = :WST00002-RCVR-SEQ-NBR             27870099
278800     END-EXEC.                                                    27880099
278900                                                                  27890099
279000     EVALUATE TRUE                                                27900099
279100         WHEN SQLCODE = ZERO                                      27910099
279200             IF PS-CICS-SWITCH-YES                                27920099
279300                 INITIALIZE PV-CICS-MSG-AREA                      27930099
279400                 STRING   ' ' PV-SRC-TASK-NUMBER                  27940099
279500                          ' WSKCS315-4380:'                       27950099
279600                          DELIMITED BY SIZE                       27960099
279700                          INTO PV-CICS-MSG-AREA                   27970099
279800                 PERFORM 7000-WRITE-TO-CICS-LOG                   27980099
279900             END-IF                                               27990099
280000             ADD RECEIV-EXPTED-CART-CNT   TO PV-TOT-CRTN-QTY      28000032
280100                                             ASC-TOTAL-CRT-CNT    28010099
280200         WHEN SQLCODE = +100                                      28020099
280300         WHEN SQLCODE = -904                                      28030099
280400         WHEN SQLCODE = -913                                      28040099
280500         WHEN SQLCODE = -911                                      28050099
280600         WHEN SQLCODE = -803                                      28060099
280700             CONTINUE                                             28070099
280800         WHEN SQLWARN0 NOT = SPACES                               28080099
280900         WHEN SQLCODE NOT = ZERO                                  28090099
281000             INITIALIZE PV-CICS-MSG-AREA                          28100099
281100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       28110099
281200             STRING   ' ' PV-SRC-TASK-NUMBER                      28120099
281300                      ' WSKCS315-4380 ERROR:'                     28130099
281400                      ' SQL='                                     28140099
281500                      PV-SQL-RETURN-CD                            28150099
281600                      DELIMITED BY SIZE                           28160099
281700                                      INTO PV-CICS-MSG-AREA       28170099
281800             PERFORM 7000-WRITE-TO-CICS-LOG                       28180099
281900                                                                  28190099
282000             STRING 'SQL='                                        28200099
282100                  PV-SQL-RETURN-CD                                28210099
282200                  DELIMITED BY SIZE                               28220099
282300                                      INTO DP013-MESSAGE-TEXT(1)  28230099
282400             MOVE SQLCA                 TO DP013-SQLCA            28240099
282500             MOVE '4380-GET-CRTN-CNT'   TO DP013-PARAGRAPH        28250099
282600             MOVE 'TRECEIV'             TO                        28260099
282700                                       DP013-DB2-TABLE-NAME (1)   28270099
282800             SET DP013-DB2-ABEND        TO TRUE                   28280099
282900             PERFORM DP013-0000-PROCESS-ABEND                     28290032
283000                                                                  28300032
283100     END-EVALUATE.                                                28310099
283200                                                                  28320032
283300* JAK 07/2007 - END NEW PARAGRAPHS                                28330032
283400                                                                  28340032
283500*----------------------------------------------------------------*28350032
283600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *28360032
283700*----------------------------------------------------------------*28370032
283800 4400-MOVE-COMMAREA-TO-SCREEN.                                    28380032
283900                                                                  28390032
284000     IF PS-CICS-SWITCH-YES                                        28400099
284100         INITIALIZE PV-CICS-MSG-AREA                              28410099
284200         STRING ' ' PV-SRC-TASK-NUMBER                            28420099
284300                ' WSKCS315-4400'                                  28430099
284400                DELIMITED BY SIZE                                 28440099
284500                          INTO PV-CICS-MSG-AREA                   28450099
284600         PERFORM 7000-WRITE-TO-CICS-LOG                           28460099
284700     END-IF.                                                      28470099
284800*                                                                 28480032
284900     IF (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))              28490032
285000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          28500032
285100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          28510032
285200             MOVE +1    TO ASC-BLK-SUB                            28520032
285300             PERFORM 5100-WRITE-TEMP-STORAGE                      28530032
285400             ADD +1     TO ASC-BLK-SUB                            28540032
285500             PERFORM 5100-WRITE-TEMP-STORAGE                      28550032
285600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             28560032
285700                 GIVING PV-BLOCK-NUMBER                           28570032
285800                 REMAINDER PV-REMAINDER                           28580032
285900             IF PV-REMAINDER > ZERO                               28590032
286000                 ADD +1 TO PV-BLOCK-NUMBER                        28600032
286100             END-IF                                               28610032
286200             MOVE +1    TO ASC-BLK-SUB                            28620032
286300             PERFORM 4410-READ-TEMP-STORAGE                       28630032
286400             ADD +1     TO ASC-BLK-SUB                            28640032
286500                           PV-BLOCK-NUMBER                        28650032
286600             PERFORM 4410-READ-TEMP-STORAGE                       28660032
286700     END-IF.                                                      28670032
286800     MOVE +1            TO ASC-BLK-SUB.                           28680032
286900     COMPUTE ASC-ITEM-SUB =                                       28690032
287000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28700032
287100         + PC-ITEMS-PER-PANEL).                                   28710032
287200*                                                                 28720032
287300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         28730032
287400         ADD +1         TO ASC-BLK-SUB                            28740032
287500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28750032
287600     END-IF.                                                      28760032
287700*                                                                 28770032
287800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28780032
287900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28790032
288000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28800032
288100     PERFORM 4420-FORMAT-LIST-LINES                               28810032
288200         VARYING PV-SUB                                           28820032
288300         FROM PC-ITEMS-PER-PANEL BY -1                            28830032
288400         UNTIL PV-SUB < +1.                                       28840032
288500*                                                                 28850032
288600     COMPUTE ASC-ITEMS-DISPLAYED =                                28860032
288700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28870032
288800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28880032
288900                                      ASTRITO.                    28890032
289000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28900032
289100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28910032
289200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28920032
289300                                   TO ASELITO.                    28930032
289400                                                                  28940032
289500     MOVE ASC-CARRIER                TO ACARRO.                   28950032
289600     MOVE ASC-TRAILER                TO ATRLRO.                   28960032
289700     MOVE ASC-TRIP-ID                TO ATRIPO.                   28970032
289701                                                                  28970199
289702     IF  ASC-INBD-RCVG                                            28970299
289703         MOVE 'RC-INBD VENDOR TRLR' TO ATRTYPO                    28970399
289704         ELSE                                                     28970499
289730         IF  ASC-OTBD-SHIP                                        28973099
289740             MOVE 'SH-DC SHIPPING TRLR'  TO ATRTYPO               28974099
289750         END-IF                                                   28975099
289760     END-IF.                                                      28976099
289770                                                                  28977099
289800     MOVE ASC-ARRIVAL-DATE           TO AARRVO.                   28980032
289900                                                                  28990099
290000     MOVE ASC-TOTAL-UNT-CNT        TO AUNTTOTO.                   29000099
290100     MOVE ASC-TOTAL-CRT-CNT        TO ACRTTOTO.                   29010099
290200     MOVE ASC-TOTAL-SSCC-CNT       TO ASSCTOTO.                   29020099
290300*                                                                 29030032
290400     IF DP020-MSG-NUMBER-X = SPACE                                29040032
290500         IF ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ   29050032
290600*            --- MORE ITEMS TO DISPLAY ----                       29060032
290700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            29070032
290800             SET DP020-MSG-INFORMATIONAL TO TRUE                  29080032
290900         END-IF                                                   29090032
291000     END-IF.                                                      29100032
291100*----------------------------------------------------------------*29110032
291200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *29120032
291300*----------------------------------------------------------------*29130032
291400                                                                  29140032
291500 4410-READ-TEMP-STORAGE.                                          29150032
291600                                                                  29160032
291700     IF PS-CICS-SWITCH-YES                                        29170099
291800         INITIALIZE PV-CICS-MSG-AREA                              29180099
291900         STRING ' ' PV-SRC-TASK-NUMBER                            29190099
292000                ' WSKCS315-4410'                                  29200099
292100                ' READ QUEUE=' ASC-LIST-QUEUE-NAME                29210099
292200                DELIMITED BY SIZE                                 29220099
292300                          INTO PV-CICS-MSG-AREA                   29230099
292400         PERFORM 7000-WRITE-TO-CICS-LOG                           29240099
292500     END-IF.                                                      29250099
292600*                                                                 29260032
292700     EXEC CICS                                                    29270032
292800         READQ TS                                                 29280032
292900             QUEUE (ASC-LIST-QUEUE-NAME)                          29290032
293000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29300032
293100             ITEM  (PV-BLOCK-NUMBER)                              29310032
293200             RESP  (PV-CICS-RESP)                                 29320032
293300     END-EXEC.                                                    29330032
293400                                                                  29340032
293500     IF ((PV-CICS-RESP = DFHRESP (NORMAL))                        29350032
293600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     29360032
293700         CONTINUE                                                 29370032
293800     ELSE                                                         29380032
293900         SET DP013-CICS-ABEND     TO TRUE                         29390032
294000         SET DP013-NO-ROLLBACK    TO TRUE                         29400032
294100         MOVE '4410-READ-TEMP-STORAGE'                            29410032
294200                                  TO DP013-PARAGRAPH              29420032
294300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      29430032
294400                                  TO DP013-MESSAGE-TEXT(1)        29440032
294500         PERFORM DP013-0000-PROCESS-ABEND                         29450032
294600     END-IF.                                                      29460032
294700                                                                  29470032
294800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29480032
294900*                                                                 29490032
295000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         29500032
295100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               29510032
295200     END-IF.                                                      29520032
295300 EJECT                                                            29530032
295400*----------------------------------------------------------------*29540032
295500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *29550032
295600*----------------------------------------------------------------*29560032
295700 4420-FORMAT-LIST-LINES.                                          29570032
295800                                                                  29580099
295900     IF PS-CICS-SWITCH-YES                                        29590099
296000         INITIALIZE PV-CICS-MSG-AREA                              29600099
296100         STRING ' ' PV-SRC-TASK-NUMBER                            29610099
296200                ' WSKCS315-4420'                                  29620099
296300                DELIMITED BY SIZE                                 29630099
296400                          INTO PV-CICS-MSG-AREA                   29640099
296500         PERFORM 7000-WRITE-TO-CICS-LOG                           29650099
296600     END-IF.                                                      29660099
296700*                                                                 29670032
296800     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       29680032
296900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                29690032
297000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA  (PV-SUB)          29700032
297100         MOVE DP015-HL-OFF       TO MR-SELECTH  (PV-SUB)          29710032
297200         MOVE SPACE              TO MR-SELECTI  (PV-SUB)          29720032
297300                                    MR-SHIP     (PV-SUB)          29730032
297400                                    MR-DNLD-IND (PV-SUB)          29740032
297500                                    MR-DNLD-DTE (PV-SUB)          29750032
297600                                    MR-DNLD-TME (PV-SUB)          29760032
297700                                    MR-RCPT-DTE (PV-SUB)          29770032
297800                                    MR-RCPT-TME (PV-SUB)          29780032
297900                                    MR-CRE-BY   (PV-SUB)          29790032
298000                                    MR-UNIT-QTY (PV-SUB)          29800099
298100                                    MR-CRTN-QTY (PV-SUB)          29810032
298200                                    MR-EXPD-QTY (PV-SUB)          29820032
298300     ELSE                                                         29830032
298400         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       29840032
298500                                                   > SPACE        29850032
298600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29860032
298700                                 TO MR-SELECTI (PV-SUB)           29870032
298800         ELSE                                                     29880032
298900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29890032
299000                                 TO MR-SELECTI (PV-SUB)           29900032
299100         END-IF                                                   29910032
299200*                                                                 29920032
299300         IF DP030-SET-CURSOR-TRAILER                              29930032
299400             IF ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29940032
299500                 > SPACE)                                         29950032
299600               OR (PV-SUB = 1))                                   29960032
299700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29970032
299800                MOVE -1          TO MR-SELECTL (PV-SUB)           29980032
299900             END-IF                                               29990032
300000         END-IF                                                   30000032
300100*                                                                 30010032
300200         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            30020032
300300             MOVE ASC-SCREEN-SHIP (ASC-BLK-SUB ASC-ITEM-SUB)      30030099
300400                                         TO MR-SHIP (PV-SUB)      30040099
300500             MOVE ASC-SCREEN-DNLD-IND (ASC-BLK-SUB ASC-ITEM-SUB)  30050099
300600                                         TO MR-DNLD-IND (PV-SUB)  30060099
300700             MOVE ASC-SCREEN-DNLD-TME (ASC-BLK-SUB ASC-ITEM-SUB)  30070099
300800                                         TO MR-DNLD-TME (PV-SUB)  30080099
300900             MOVE ASC-SCREEN-DNLD-DTE (ASC-BLK-SUB ASC-ITEM-SUB)  30090099
301000                                         TO MR-DNLD-DTE (PV-SUB)  30100099
301100             MOVE ASC-SCREEN-RCPT-DTE (ASC-BLK-SUB ASC-ITEM-SUB)  30110099
301200                                         TO MR-RCPT-DTE (PV-SUB)  30120099
301300             MOVE ASC-SCREEN-RCPT-TME (ASC-BLK-SUB ASC-ITEM-SUB)  30130099
301400                                         TO MR-RCPT-TME (PV-SUB)  30140099
301500* JAK 07/2007 - ADD TOTAL UNIT QTY & TOTAL CARTON QTY             30150032
301600             MOVE ASC-SCREEN-UNIT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)  30160099
301700                                         TO MR-UNIT-QTY (PV-SUB)  30170099
301800             MOVE ASC-SCREEN-CRTN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)  30180099
301900                                         TO MR-CRTN-QTY (PV-SUB)  30190099
302000             MOVE ASC-SCREEN-EXP-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  30200099
302100                                         TO MR-EXPD-QTY (PV-SUB)  30210099
302200             MOVE ASC-SCREEN-CRE-BY (ASC-BLK-SUB ASC-ITEM-SUB)    30220099
302300                                         TO MR-CRE-BY (PV-SUB)    30230099
302400         END-IF                                                   30240032
302500     END-IF.                                                      30250032
302600     SUBTRACT +1 FROM ASC-ITEM-SUB                                30260032
302700     IF  ASC-ITEM-SUB < + 1                                       30270032
302800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  30280032
302900         MOVE +1                 TO ASC-BLK-SUB                   30290032
303000     END-IF.                                                      30300032
303100******************************************************************30310032
303200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **30320032
303300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **30330032
303400** ISSUE A WARNING.                                             **30340032
303500******************************************************************30350032
303600 4430-CHECK-FOR-BEGIN-AND-END.                                    30360032
303700*                                                                 30370099
303800     IF PS-CICS-SWITCH-YES                                        30380099
303900         INITIALIZE PV-CICS-MSG-AREA                              30390099
304000         STRING ' ' PV-SRC-TASK-NUMBER                            30400099
304100                ' WSKCS315-4430'                                  30410099
304200                DELIMITED BY SIZE                                 30420099
304300                          INTO PV-CICS-MSG-AREA                   30430099
304400         PERFORM 7000-WRITE-TO-CICS-LOG                           30440099
304500     END-IF.                                                      30450099
304600*                                                                 30460032
304700     IF ASC-START-OF-SELECTED-RANGE > ZERO                        30470032
304800         IF ASC-END-OF-SELECTED-RANGE = ZERO                      30480032
304900*            -- NO END-OF-RANGE SPECFIED ---                      30490032
305000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            30500032
305100             SET DP020-MSG-WARNING TO TRUE                        30510032
305200             PERFORM 4431-POSITION-AT-WARNING                     30520032
305300         END-IF                                                   30530032
305400     ELSE                                                         30540032
305500         IF ASC-END-OF-SELECTED-RANGE > ZERO                      30550032
305600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                30560032
305700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30570032
305800             SET DP020-MSG-WARNING TO TRUE                        30580032
305900             PERFORM 4431-POSITION-AT-WARNING                     30590032
306000         END-IF                                                   30600032
306100     END-IF.                                                      30610032
306200******************************************************************30620032
306300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **30630032
306400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **30640032
306500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **30650032
306600** POSITION THE CURSOR THERE.                                   **30660032
306700******************************************************************30670032
306800 4431-POSITION-AT-WARNING.                                        30680032
306900*                                                                 30690099
307000     IF PS-CICS-SWITCH-YES                                        30700099
307100         INITIALIZE PV-CICS-MSG-AREA                              30710099
307200         STRING ' ' PV-SRC-TASK-NUMBER                            30720099
307300                ' WSKCS315-4431'                                  30730099
307400                DELIMITED BY SIZE                                 30740099
307500                          INTO PV-CICS-MSG-AREA                   30750099
307600         PERFORM 7000-WRITE-TO-CICS-LOG                           30760099
307700     END-IF.                                                      30770099
307800*                                                                 30780032
307900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30790032
308000                    - PV-TOP-ITEM + 1.                            30800032
308100     IF PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                       30810032
308200         CONTINUE                                                 30820032
308300     ELSE                                                         30830032
308400         SET DP030-SET-CURSOR-APPL-1                              30840032
308500                                   TO TRUE                        30850032
308600         MOVE -1                   TO MR-SELECTL (PV-SUB)         30860032
308700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30870032
308800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30880032
308900     END-IF.                                                      30890032
309000*                                                                 30900032
309100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30910032
309200                    - PV-TOP-ITEM + 1.                            30920032
309300     IF PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                       30930032
309400         CONTINUE                                                 30940032
309500     ELSE                                                         30950032
309600         SET DP030-SET-CURSOR-APPL-1                              30960032
309700                                   TO TRUE                        30970032
309800         MOVE -1                   TO MR-SELECTL (PV-SUB)         30980032
309900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30990032
310000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         31000032
310100     END-IF.                                                      31010032
310200 EJECT                                                            31020032
310201                                                                  31020199
310202                                                                  31020299
310203*----------------------------------------------------------------*31020399
310204* NAVIGATION IS FROM DC SHIPPING SCREEN.  THIS IS PROCESSED      *31020499
310205* PROCESSED FREIGHT.  THIS PROCESS WILL GET THE UNIT/CARTON      *31020599
310206* COUNTS FOR PROCESSED FREIGHT TRAILERS FROM DC TO EFC           *31020699
310207* DMH - 6/24/2020                                                *31020799
310208*----------------------------------------------------------------*31020899
310210 4500-GET-SHIP-TRIP-INFO.                                         31021099
310220                                                                  31022099
310221     SET  PS-ASN-DWNLD-NO  TO  TRUE.                              31022199
310222     MOVE ZEROES  TO PV-SHIP-TRLR-CRTN-CNT                        31022299
310223                     PV-SHIP-TRLR-UNIT-QTY.                       31022399
310224                                                                  31022499
310225     PERFORM 4510-CHECK-ASN-DWNLD.                                31022599
310226                                                                  31022699
310227     IF  PS-ASN-DWNLD-YES                                         31022799
310228         PERFORM 4515-COUNT-ASN-CRTNS                             31022899
310229         PERFORM 4520-COUNT-ASN-UNITS                             31022999
310230     ELSE                                                         31023099
310231         PERFORM 4530-GET-TRIP-SUM                                31023199
310232     END-IF.                                                      31023299
310233                                                                  31023399
310234     MOVE PV-SHIP-TRLR-CRTN-CNT  TO  PV-TOT-CRTN-QTY              31023499
310235                                     ASC-TOTAL-CRT-CNT.           31023599
310236     MOVE PV-SHIP-TRLR-UNIT-QTY  TO  PV-TOT-UNIT-QTY              31023699
310237                                     ASC-TOTAL-UNT-CNT.           31023799
310239                                                                  31023999
310240                                                                  31024099
310241*----------------------------------------------------------------*31024199
310242* CHECK IF TRIP IN WST_ASN_DWNLD TABLE - RETRIEVE MAX DOWNLOAD   *31024299
310243* TIMESTAMP                                                      *31024399
310244*----------------------------------------------------------------*31024499
310245 4510-CHECK-ASN-DWNLD.                                            31024599
310246     MOVE WST00001-EXT-SHP-ID      TO  WST00011-EXT-SHP-ID.       31024699
310247                                                                  31024799
310248     EXEC SQL                                                     31024899
310249         SELECT  MAX(CRE_TMST)                                    31024999
310250           INTO  :WST00011-CRE-TMST                               31025099
310251           FROM  WST_ASN_DWNLD                                    31025199
310252          WHERE  EXT_SHP_ID  = :WST00001-EXT-SHP-ID               31025299
310253            AND  REC_TYP_CDE = 'AH'                               31025399
310254           WITH UR                                                31025499
310255     END-EXEC.                                                    31025599
310256                                                                  31025699
310257     EVALUATE TRUE                                                31025799
310258         WHEN SQLCODE = ZERO                                      31025899
310259             IF PS-CICS-SWITCH-YES                                31025999
310260                 INITIALIZE PV-CICS-MSG-AREA                      31026099
310261                 STRING   ' ' PV-SRC-TASK-NUMBER                  31026199
310262                          ' WSKCS315-4510:'                       31026299
310263                          DELIMITED BY SIZE                       31026399
310264                          INTO PV-CICS-MSG-AREA                   31026499
310265                 PERFORM 7000-WRITE-TO-CICS-LOG                   31026599
310266             END-IF                                               31026699
310267              SET  PS-ASN-DWNLD-YES  TO  TRUE                     31026799
310268                                                                  31026899
310269         WHEN SQLCODE = +100                                      31026999
310270         WHEN SQLCODE = -305                                      31027099
310271              SET  PS-ASN-DWNLD-NO   TO  TRUE                     31027199
310272                                                                  31027299
310273         WHEN SQLCODE = -904                                      31027399
310274         WHEN SQLCODE = -913                                      31027499
310275         WHEN SQLCODE = -911                                      31027599
310276         WHEN SQLCODE = -803                                      31027699
310277             CONTINUE                                             31027799
310278         WHEN SQLWARN0 NOT = SPACES                               31027899
310279         WHEN SQLCODE NOT = ZERO                                  31027999
310280             INITIALIZE PV-CICS-MSG-AREA                          31028099
310281             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31028199
310282                                           PV-DISPLAY-5           31028299
310283             STRING   ' ' PV-SRC-TASK-NUMBER                      31028399
310284                      ' WSKCS315-4510 ERROR:'                     31028499
310285                      ' SQL='                                     31028599
310286                      PV-DISPLAY-5                                31028699
310287                      ' FOR SHIPMENT '                            31028799
310288                      WST00001-EXT-SHP-ID                         31028899
310289                      DELIMITED BY SIZE                           31028999
310290                                      INTO PV-CICS-MSG-AREA       31029099
310291             PERFORM 7000-WRITE-TO-CICS-LOG                       31029199
310292                                                                  31029299
310293             STRING 'SQL='                                        31029399
310294                  PV-SQL-RETURN-CD                                31029499
310295                  DELIMITED BY SIZE                               31029599
310296                                      INTO DP013-MESSAGE-TEXT(1)  31029699
310297             MOVE SQLCA                 TO DP013-SQLCA            31029799
310298             MOVE '4510-CHECK-DWNLD '   TO DP013-PARAGRAPH        31029899
310299             MOVE 'WST_ASN_DWNLD'       TO                        31029999
310300                                       DP013-DB2-TABLE-NAME (1)   31030099
310301             SET DP013-DB2-ABEND        TO TRUE                   31030199
310302             PERFORM DP013-0000-PROCESS-ABEND                     31030299
310303                                                                  31030399
310304     END-EVALUATE.                                                31030499
310305                                                                  31030599
310306                                                                  31030699
310307*----------------------------------------------------------------*31030799
310308* COUNT THE NUMBER OF CARTON HEADERS FOR ASN/DWNLD TMST          *31030899
310309* CH - CARTON HEADER                                             *31030999
310310*----------------------------------------------------------------*31031099
310311 4515-COUNT-ASN-CRTNS.                                            31031199
310312                                                                  31031299
310313     EXEC SQL                                                     31031399
310314         SELECT  COUNT(*)                                         31031499
310315           INTO  :PV-SHIP-TRLR-CRTN-CNT                           31031599
310316           FROM  WST_ASN_DWNLD                                    31031699
310317          WHERE  EXT_SHP_ID  = :WST00001-EXT-SHP-ID               31031799
310318            AND  CRE_TMST    = :WST00011-CRE-TMST                 31031899
310319            AND  REC_TYP_CDE = 'CH'                               31031999
310320           WITH UR                                                31032099
310321     END-EXEC.                                                    31032199
310322                                                                  31032299
310323     EVALUATE TRUE                                                31032399
310324         WHEN SQLCODE = ZERO                                      31032499
310325             IF PS-CICS-SWITCH-YES                                31032599
310326                 INITIALIZE PV-CICS-MSG-AREA                      31032699
310327                 STRING   ' ' PV-SRC-TASK-NUMBER                  31032799
310328                          ' WSKCS315-4515:'                       31032899
310329                          DELIMITED BY SIZE                       31032999
310330                          INTO PV-CICS-MSG-AREA                   31033099
310331                 PERFORM 7000-WRITE-TO-CICS-LOG                   31033199
310332             END-IF                                               31033299
310333              CONTINUE                                            31033399
310334                                                                  31033499
310335         WHEN SQLCODE = +100                                      31033599
310336         WHEN SQLCODE = -305                                      31033699
310337              MOVE ZEROES  TO  PV-SHIP-TRLR-CRTN-CNT              31033799
310338                                                                  31033899
310339         WHEN SQLCODE = -904                                      31033999
310340         WHEN SQLCODE = -913                                      31034099
310341         WHEN SQLCODE = -911                                      31034199
310342         WHEN SQLCODE = -803                                      31034299
310343             CONTINUE                                             31034399
310344         WHEN SQLWARN0 NOT = SPACES                               31034499
310345         WHEN SQLCODE NOT = ZERO                                  31034599
310346             INITIALIZE PV-CICS-MSG-AREA                          31034699
310347             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31034799
310348                                           PV-DISPLAY-5           31034899
310349             STRING   ' ' PV-SRC-TASK-NUMBER                      31034999
310350                      ' WSKCS315-4515 ERROR:'                     31035099
310351                      ' SQL='                                     31035199
310353                      PV-DISPLAY-5                                31035399
310354                      ' FOR SHIPMENT '                            31035499
310355                      WST00001-EXT-SHP-ID                         31035599
310356                      DELIMITED BY SIZE                           31035699
310357                                      INTO PV-CICS-MSG-AREA       31035799
310358             PERFORM 7000-WRITE-TO-CICS-LOG                       31035899
310359                                                                  31035999
310360             STRING 'SQL='                                        31036099
310361                  PV-SQL-RETURN-CD                                31036199
310362                  DELIMITED BY SIZE                               31036299
310363                                      INTO DP013-MESSAGE-TEXT(1)  31036399
310364             MOVE SQLCA                 TO DP013-SQLCA            31036499
310365             MOVE '4515-COUNT-ASN-CRTN' TO DP013-PARAGRAPH        31036599
310366             MOVE 'WST_ASN_DWNLD'       TO                        31036699
310367                                       DP013-DB2-TABLE-NAME (1)   31036799
310368             SET DP013-DB2-ABEND        TO TRUE                   31036899
310369             PERFORM DP013-0000-PROCESS-ABEND                     31036999
310370                                                                  31037099
310371     END-EVALUATE.                                                31037199
310372                                                                  31037299
310373                                                                  31037399
310374*----------------------------------------------------------------*31037499
310375* COUNT THE NUMBER OF UNITS FROM CARTON DETAILS ASN/DWNLD TMST   *31037599
310376*----------------------------------------------------------------*31037699
310377 4520-COUNT-ASN-UNITS.                                            31037799
310378                                                                  31037899
310379     EXEC SQL                                                     31037999
310380         SELECT  SUM(INTEGER(SUBSTR(REC_TYP_DESC,78,4)))          31038099
310381           INTO  :PV-SHIP-TRLR-UNIT-QTY                           31038199
310382           FROM  WST_ASN_DWNLD                                    31038299
310383          WHERE  EXT_SHP_ID  = :WST00001-EXT-SHP-ID               31038399
310384            AND  CRE_TMST    = :WST00011-CRE-TMST                 31038499
310385            AND  REC_TYP_CDE = 'CD'                               31038599
310386           WITH UR                                                31038699
310387     END-EXEC.                                                    31038799
310388                                                                  31038899
310389     EVALUATE TRUE                                                31038999
310390         WHEN SQLCODE = ZERO                                      31039099
310391             IF PS-CICS-SWITCH-YES                                31039199
310392                 INITIALIZE PV-CICS-MSG-AREA                      31039299
310393                 STRING   ' ' PV-SRC-TASK-NUMBER                  31039399
310394                          ' WSKCS315-4520:'                       31039499
310395                          DELIMITED BY SIZE                       31039599
310396                          INTO PV-CICS-MSG-AREA                   31039699
310397                 PERFORM 7000-WRITE-TO-CICS-LOG                   31039799
310398             END-IF                                               31039899
310399              CONTINUE                                            31039999
310400                                                                  31040099
310401         WHEN SQLCODE = +100                                      31040199
310402         WHEN SQLCODE = -305                                      31040299
310403              MOVE ZEROES  TO  PV-SHIP-TRLR-UNIT-QTY              31040399
310404                                                                  31040499
310405         WHEN SQLCODE = -904                                      31040599
310406         WHEN SQLCODE = -913                                      31040699
310407         WHEN SQLCODE = -911                                      31040799
310408         WHEN SQLCODE = -803                                      31040899
310409             CONTINUE                                             31040999
310410         WHEN SQLWARN0 NOT = SPACES                               31041099
310411         WHEN SQLCODE NOT = ZERO                                  31041199
310412             INITIALIZE PV-CICS-MSG-AREA                          31041299
310413             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31041399
310414                                           PV-DISPLAY-5           31041499
310415             STRING   ' ' PV-SRC-TASK-NUMBER                      31041599
310416                      ' WSKCS315-4520 ERROR:'                     31041699
310417                      ' SQL='                                     31041799
310418                      PV-DISPLAY-5                                31041899
310419                      ' FOR SHIPMENT '                            31041999
310420                      WST00001-EXT-SHP-ID                         31042099
310421                      DELIMITED BY SIZE                           31042199
310422                                      INTO PV-CICS-MSG-AREA       31042299
310423             PERFORM 7000-WRITE-TO-CICS-LOG                       31042399
310424                                                                  31042499
310425             STRING 'SQL='                                        31042599
310426                  PV-SQL-RETURN-CD                                31042699
310427                  DELIMITED BY SIZE                               31042799
310428                                      INTO DP013-MESSAGE-TEXT(1)  31042899
310429             MOVE SQLCA                 TO DP013-SQLCA            31042999
310430             MOVE '4520-COUNT-ASN-UNIT' TO DP013-PARAGRAPH        31043099
310431             MOVE 'WST_ASN_DWNLD'       TO                        31043199
310432                                       DP013-DB2-TABLE-NAME (1)   31043299
310433             SET DP013-DB2-ABEND        TO TRUE                   31043399
310434             PERFORM DP013-0000-PROCESS-ABEND                     31043499
310435                                                                  31043599
310436     END-EVALUATE.                                                31043699
310437                                                                  31043799
310438                                                                  31043899
310439*----------------------------------------------------------------*31043999
310440* IF NO ASN DOWNLOAD - GET CARTON COUNT FROM SUT_TRIP_SUM        *31044099
310441*----------------------------------------------------------------*31044199
310442 4530-GET-TRIP-SUM.                                               31044299
310443                                                                  31044399
310444     EXEC SQL                                                     31044499
310445         SELECT  A.CART_QTY                                       31044599
310446              ,  A.UNT_QTY                                        31044699
310447           INTO  :PV-SHIP-TRLR-CRTN-CNT                           31044799
310448              ,  :PV-SHIP-TRLR-UNIT-QTY                           31044899
310449           FROM  SUT_TRIP_SUM A                                   31044999
310450          WHERE  A.OTBND_TRIP_ID = :DK-TRIP-ID                    31045099
310451            AND  A.CRE_TMST IN                                    31045199
310452                 (SELECT MAX(B.CRE_TMST)                          31045299
310453                    FROM SUT_TRIP_SUM B                           31045399
310454                   WHERE A.OTBND_TRIP_ID  = B.OTBND_TRIP_ID)      31045499
310455           WITH UR                                                31045599
310456     END-EXEC.                                                    31045699
310457                                                                  31045799
310458     EVALUATE TRUE                                                31045899
310459         WHEN SQLCODE = ZERO                                      31045999
310460             IF PS-CICS-SWITCH-YES                                31046099
310461                 INITIALIZE PV-CICS-MSG-AREA                      31046199
310462                 STRING   ' ' PV-SRC-TASK-NUMBER                  31046299
310463                          ' WSKCS315-4530:'                       31046399
310464                          DELIMITED BY SIZE                       31046499
310465                          INTO PV-CICS-MSG-AREA                   31046599
310466                 PERFORM 7000-WRITE-TO-CICS-LOG                   31046699
310467             END-IF                                               31046799
310468              CONTINUE                                            31046899
310469                                                                  31046999
310470         WHEN SQLCODE = +100                                      31047099
310471         WHEN SQLCODE = -305                                      31047199
310472              MOVE ZEROES  TO  PV-SHIP-TRLR-CRTN-CNT              31047299
310473                               PV-SHIP-TRLR-UNIT-QTY              31047399
310474                                                                  31047499
310475         WHEN SQLCODE = -904                                      31047599
310476         WHEN SQLCODE = -913                                      31047699
310477         WHEN SQLCODE = -911                                      31047799
310478         WHEN SQLCODE = -803                                      31047899
310479             CONTINUE                                             31047999
310480         WHEN SQLWARN0 NOT = SPACES                               31048099
310481         WHEN SQLCODE NOT = ZERO                                  31048199
310482             INITIALIZE PV-CICS-MSG-AREA                          31048299
310483             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31048399
310484                                           PV-DISPLAY-5           31048499
310485             MOVE DK-TRIP-ID            TO PV-DISPLAY-6           31048599
310486             STRING   ' ' PV-SRC-TASK-NUMBER                      31048699
310487                      ' WSKCS315-4530 ERROR:'                     31048799
310488                      ' SQL='                                     31048899
310489                      PV-DISPLAY-5                                31048999
310490                      ' FOR TRIP ID '                             31049099
310491                      PV-DISPLAY-6                                31049199
310492                      DELIMITED BY SIZE                           31049299
310493                                      INTO PV-CICS-MSG-AREA       31049399
310494             PERFORM 7000-WRITE-TO-CICS-LOG                       31049499
310495                                                                  31049599
310496             STRING 'SQL='                                        31049699
310497                  PV-SQL-RETURN-CD                                31049799
310498                  DELIMITED BY SIZE                               31049899
310499                                      INTO DP013-MESSAGE-TEXT(1)  31049999
310500             MOVE SQLCA                 TO DP013-SQLCA            31050099
310501             MOVE '4530-GET-TRIP-SUM  ' TO DP013-PARAGRAPH        31050199
310502             MOVE 'WST_ASN_DWNLD'       TO                        31050299
310503                                       DP013-DB2-TABLE-NAME (1)   31050399
310504             SET DP013-DB2-ABEND        TO TRUE                   31050499
310505             PERFORM DP013-0000-PROCESS-ABEND                     31050599
310506                                                                  31050699
310507     END-EVALUATE.                                                31050799
310508                                                                  31050899
310509                                                                  31050999
310510*----------------------------------------------------------------*31051099
310511* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *31051199
310520* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *31052032
310600* FOR THE SELECTED ITEMS QUEUE.                                  *31060032
310700*                                                                *31070032
310800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *31080032
310900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *31090032
311000* THE ARRAY IS FULL.                                             *31100032
311100*----------------------------------------------------------------*31110032
311200 5000-PREPARE-SEL-QUEUE.                                          31120032
311300                                                                  31130099
311400     IF PS-CICS-SWITCH-YES                                        31140099
311500         INITIALIZE PV-CICS-MSG-AREA                              31150099
311600         STRING ' ' PV-SRC-TASK-NUMBER                            31160099
311700                ' WSKCS315-5000'                                  31170099
311800                DELIMITED BY SIZE                                 31180099
311900                          INTO PV-CICS-MSG-AREA                   31190099
312000         PERFORM 7000-WRITE-TO-CICS-LOG                           31200099
312100     END-IF.                                                      31210099
312200*                                                                 31220032
312300     MOVE +1                   TO  ASC-BLK-SUB.                   31230032
312400     PERFORM 5100-WRITE-TEMP-STORAGE.                             31240032
312500     ADD +1                    TO  ASC-BLK-SUB.                   31250032
312600     PERFORM 5100-WRITE-TEMP-STORAGE.                             31260032
312700                                                                  31270032
312800     MOVE ASC-SEL-QUEUE-NAME-OUT   TO  WS010-SEL-QUEUE-NAME.      31280032
312900     PERFORM 6010-DELETE-SEL-QUEUE.                               31290032
313000                                                                  31300032
313100     SET ASC-UPDATE-TSQ        TO  TRUE.                          31310032
313200                                                                  31320032
313300     SET WS011-IDX             TO  1.                             31330032
313400     MOVE ZERO                 TO WS010-NUMBER-OF-TS-ITEMS.       31340032
313500     INITIALIZE WS011-SELECTED-ITEM-ARRAY.                        31350032
313600                                                                  31360032
313700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           31370032
313800             VARYING PV-ITEM                                      31380032
313900             FROM 1 BY 1                                          31390032
314000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     31400032
314100                                                                  31410032
314200     IF WS011-IDX > 1                                             31420032
314300         PERFORM 5205-WRITE-SEL-QUEUE                             31430032
314400         ADD +1                TO WS010-NUMBER-OF-TS-ITEMS        31440032
314500     END-IF.                                                      31450032
314600/                                                                 31460032
314700*----------------------------------------------------------------*31470032
314800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31480032
314900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31490032
315000*----------------------------------------------------------------*31500032
315100 5100-WRITE-TEMP-STORAGE.                                         31510032
315200                                                                  31520099
315300     IF PS-CICS-SWITCH-YES                                        31530099
315400         INITIALIZE PV-CICS-MSG-AREA                              31540099
315500         STRING ' ' PV-SRC-TASK-NUMBER                            31550099
315600                ' WSKCS315-5100'                                  31560099
315700                DELIMITED BY SIZE                                 31570099
315800                          INTO PV-CICS-MSG-AREA                   31580099
315900         PERFORM 7000-WRITE-TO-CICS-LOG                           31590099
316000     END-IF.                                                      31600099
316100*                                                                 31610032
316200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31620032
316300                                   TO PV-LIST-ITEM-NUMBER.        31630032
316400     COMPUTE PV-BLOCK-NUMBER =                                    31640032
316500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31650032
316600                                                                  31660032
316700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31670032
316800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             31680032
316900         IF ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                       31690032
317000             PERFORM 5105-REWRITE-ASC-LISTQ                       31700032
317100         END-IF                                                   31710032
317200     ELSE                                                         31720032
317300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       31730032
317400                                   ASC-HIGHEST-BLOCK-WRITTEN + 1  31740032
317500         PERFORM 5110-WRITE-ASC-LISTQ                             31750032
317600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   31760032
317700     END-IF.                                                      31770032
317800                                                                  31780032
317900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             31790032
318000******************************************************************31800032
318100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **31810032
318200** SPECIFIC COMMAREA.                                           **31820032
318300******************************************************************31830032
318400 5105-REWRITE-ASC-LISTQ.                                          31840032
318500*                                                                 31850099
318600     IF PS-CICS-SWITCH-YES                                        31860099
318700         INITIALIZE PV-CICS-MSG-AREA                              31870099
318800         STRING ' ' PV-SRC-TASK-NUMBER                            31880099
318900                ' WSKCS315-5105'                                  31890099
319000                ' WRITE QUEUE=' ASC-LIST-QUEUE-NAME               31900099
319100                DELIMITED BY SIZE                                 31910099
319200                          INTO PV-CICS-MSG-AREA                   31920099
319300         PERFORM 7000-WRITE-TO-CICS-LOG                           31930099
319400     END-IF.                                                      31940099
319500*                                                                 31950032
319600     EXEC CICS                                                    31960032
319700         WRITEQ TS                                                31970032
319800             QUEUE (ASC-LIST-QUEUE-NAME)                          31980032
319900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31990032
320000             ITEM  (PV-BLOCK-NUMBER)                              32000032
320100             REWRITE                                              32010032
320200             RESP  (PV-CICS-RESP)                                 32020032
320300     END-EXEC.                                                    32030032
320400                                                                  32040032
320500     IF PV-CICS-RESP = DFHRESP(NORMAL)                            32050032
320600         CONTINUE                                                 32060032
320700     ELSE                                                         32070032
320800         SET DP013-CICS-ABEND            TO TRUE                  32080032
320900         SET DP013-NO-ROLLBACK           TO TRUE                  32090032
321000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       32100032
321100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     32110032
321200                                         TO DP013-MESSAGE-TEXT(1) 32120032
321300         PERFORM DP013-0000-PROCESS-ABEND                         32130032
321400     END-IF.                                                      32140032
321500                                                                  32150032
321600******************************************************************32160032
321700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **32170032
321800** SPECIFIC COMMAREA.                                           **32180032
321900******************************************************************32190032
322000 5110-WRITE-ASC-LISTQ.                                            32200032
322100                                                                  32210099
322200     IF PS-CICS-SWITCH-YES                                        32220099
322300         INITIALIZE PV-CICS-MSG-AREA                              32230099
322400         STRING ' ' PV-SRC-TASK-NUMBER                            32240099
322500                ' WSKCS315-5110'                                  32250099
322600                ' WRITE QUEUE=' ASC-LIST-QUEUE-NAME               32260099
322700                DELIMITED BY SIZE                                 32270099
322800                          INTO PV-CICS-MSG-AREA                   32280099
322900         PERFORM 7000-WRITE-TO-CICS-LOG                           32290099
323000     END-IF.                                                      32300099
323100*                                                                 32310032
323200     EXEC CICS                                                    32320032
323300         WRITEQ TS                                                32330032
323400             QUEUE (ASC-LIST-QUEUE-NAME)                          32340032
323500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32350032
323600             ITEM  (PV-BLOCK-NUMBER)                              32360032
323700             RESP  (PV-CICS-RESP)                                 32370032
323800     END-EXEC.                                                    32380032
323900     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       32390032
324000         SET DP013-CICS-ABEND      TO TRUE                        32400032
324100         SET DP013-NO-ROLLBACK     TO TRUE                        32410032
324200         MOVE '5110-WRITE-ASC-LISTQ'                              32420032
324300                                   TO DP013-PARAGRAPH             32430032
324400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           32440032
324500                                   TO DP013-MESSAGE-TEXT(1)       32450032
324600         PERFORM DP013-0000-PROCESS-ABEND                         32460032
324700     END-IF.                                                      32470032
324800 EJECT                                                            32480032
324900*----------------------------------------------------------------*32490032
325000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32500032
325100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32510032
325200*----------------------------------------------------------------*32520032
325300                                                                  32530032
325400 5200-FILL-SEL-QUEUE-RECORD.                                      32540032
325500                                                                  32550032
325600     IF PS-CICS-SWITCH-YES                                        32560099
325700         INITIALIZE PV-CICS-MSG-AREA                              32570099
325800         STRING ' ' PV-SRC-TASK-NUMBER                            32580099
325900                ' WSKCS315-5200'                                  32590099
326000                DELIMITED BY SIZE                                 32600099
326100                          INTO PV-CICS-MSG-AREA                   32610099
326200         PERFORM 7000-WRITE-TO-CICS-LOG                           32620099
326300     END-IF.                                                      32630099
326400*                                                                 32640032
326500     PERFORM 6112-READ-LIST-QUEUE.                                32650032
326600                                                                  32660032
326700     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        32670032
326800         PERFORM 6010-DELETE-SEL-QUEUE                            32680032
326900                                                                  32690032
327000         PERFORM                                                  32700032
327100         VARYING LQW-IDX                                          32710032
327200         FROM 1 BY 1                                              32720032
327300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32730032
327400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32740032
327500                                                                  32750032
327600             IF LQW-SELECT (LQW-IDX)                              32760032
327700                 IF LQW-IDX = 1                                   32770099
327800                     MOVE LQW-WMS-SHIPMENT (LQW-IDX)              32780032
327900                                   TO WS010-EXT-SHP-ID            32790032
328000                     MOVE LQW-DWNLD-DATE (LQW-IDX)                32800099
328100                                   TO WS010-DWNLD-DATE            32810032
328200                     MOVE LQW-DWNLD-TIME (LQW-IDX)                32820032
328300                                   TO WS010-DWNLD-TIME            32830032
328400                 END-IF                                           32840099
328500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32850099
328600                                 TO WS011-ITEM (WS011-IDX)        32860099
328700                 MOVE 'I'        TO WS011-ACTION-SW (WS011-IDX)   32870099
328800                 MOVE LQW-WMS-SHIPMENT (LQW-IDX)                  32880099
328900                                 TO WS011-EXT-SHP-ID (WS011-IDX)  32890099
329000                 MOVE LQW-DWNLD-DATE (LQW-IDX)                    32900099
329100                                 TO WS011-DWNLD-DATE (WS011-IDX)  32910099
329200                 MOVE LQW-DWNLD-TIME (LQW-IDX)                    32920099
329300                                 TO WS011-DWNLD-TIME (WS011-IDX)  32930099
329400                                                                  32940032
329500                 SET WS011-IDX UP BY 1                            32950032
329600                 IF WS011-IDX > WS011-MAX-ITEMS                   32960032
329700                     PERFORM 5205-WRITE-SEL-QUEUE                 32970032
329800                     ADD +1        TO WS010-NUMBER-OF-TS-ITEMS    32980032
329900                     INITIALIZE WS011-SELECTED-ITEM-ARRAY         32990032
330000                     SET WS011-IDX TO 1                           33000032
330100                 END-IF                                           33010032
330200             END-IF                                               33020032
330300         END-PERFORM                                              33030032
330400     END-IF.                                                      33040032
330500                                                                  33050032
330600*----------------------------------------------------------------*33060032
330700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *33070032
330800*----------------------------------------------------------------*33080032
330900 5205-WRITE-SEL-QUEUE.                                            33090032
331000                                                                  33100032
331100     IF PS-CICS-SWITCH-YES                                        33110099
331200         INITIALIZE PV-CICS-MSG-AREA                              33120099
331300         STRING ' ' PV-SRC-TASK-NUMBER                            33130099
331400                ' WSKCS315-5205'                                  33140099
331500                ' WRITE QUEUE=' ASC-SEL-QUEUE-NAME-OUT            33150099
331600                DELIMITED BY SIZE                                 33160099
331700                          INTO PV-CICS-MSG-AREA                   33170099
331800         PERFORM 7000-WRITE-TO-CICS-LOG                           33180099
331900     END-IF.                                                      33190099
332000*                                                                 33200032
332100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33210032
332200                                   TO WS011-SELECTED-ITEMS.       33220032
332300     MOVE 1 TO PV-SEL-QUEUE-ITEM.                                 33230032
332400                                                                  33240032
332500     EXEC CICS                                                    33250032
332600          WRITEQ TS                                               33260032
332700              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      33270032
332800              FROM  (WS011-SELECT-RECORD)                         33280032
332900              ITEM  (PV-SEL-QUEUE-ITEM)                           33290032
333000              RESP  (PV-CICS-RESP)                                33300032
333100     END-EXEC.                                                    33310032
333200                                                                  33320032
333300     IF PV-CICS-RESP = DFHRESP (NORMAL)                           33330032
333400         MOVE ASC-SEL-QUEUE-NAME-OUT  TO WS010-SEL-QUEUE-NAME     33340099
333500         CONTINUE                                                 33350032
333600     ELSE                                                         33360032
333700         SET DP013-CICS-ABEND      TO TRUE                        33370032
333800         SET DP013-NO-ROLLBACK     TO TRUE                        33380032
333900         MOVE '5205-WRITE-SEL-QUEUE'                              33390032
334000                                   TO DP013-PARAGRAPH             33400032
334100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          33410032
334200                                   TO DP013-MESSAGE-TEXT(1)       33420032
334300         PERFORM DP013-0000-PROCESS-ABEND                         33430032
334400     END-IF.                                                      33440032
334500 EJECT                                                            33450032
334600******************************************************************33460032
334700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **33470032
334800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **33480032
334900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **33490032
335000** THE USER.                                                    **33500032
335100******************************************************************33510032
335200 6000-REFRESH-PANEL-FROM-TEMP.                                    33520032
335300*                                                                 33530099
335400     IF PS-CICS-SWITCH-YES                                        33540099
335500         INITIALIZE PV-CICS-MSG-AREA                              33550099
335600         STRING ' ' PV-SRC-TASK-NUMBER                            33560099
335700                ' WSKCS315-6000'                                  33570099
335800                DELIMITED BY SIZE                                 33580099
335900                          INTO PV-CICS-MSG-AREA                   33590099
336000         PERFORM 7000-WRITE-TO-CICS-LOG                           33600099
336100     END-IF.                                                      33610099
336200*                                                                 33620032
336300     IF ASC-UPDATE-TSQ                                            33630032
336400         SET ASC-NO-TSQ-UPDATE TO TRUE                            33640032
336500         MOVE ZERO                 TO PV-SAVE-ITEM                33650032
336600                                      PV-SEL-QUEUE-ITEM           33660032
336700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        33670032
336800                                   TO PV-HOLD-SELECTED-ITEMS      33680032
336900         MOVE +1                   TO PV-ITEMS-PROCESSED          33690032
337000         PERFORM 6100-UPDATE-TSQ                                  33700032
337100             UNTIL PV-ITEMS-PROCESSED >                           33710032
337200                                     PV-HOLD-SELECTED-ITEMS       33720032
337300         PERFORM 6010-DELETE-SEL-QUEUE                            33730032
337400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         33740032
337500                    ASC-BLOCK-ENTRIES (2)                         33750032
337600     END-IF.                                                      33760032
337700                                                                  33770032
337800*----------------------------------------------------------------*33780032
337900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *33790032
338000*----------------------------------------------------------------*33800032
338100 6010-DELETE-SEL-QUEUE.                                           33810032
338200                                                                  33820032
338300     IF PS-CICS-SWITCH-YES                                        33830099
338400         INITIALIZE PV-CICS-MSG-AREA                              33840099
338500         STRING ' ' PV-SRC-TASK-NUMBER                            33850099
338600                ' WSKCS315-6010'                                  33860099
338700                DELIMITED BY SIZE                                 33870099
338800                          INTO PV-CICS-MSG-AREA                   33880099
338900         PERFORM 7000-WRITE-TO-CICS-LOG                           33890099
339000     END-IF.                                                      33900099
339100*                                                                 33910032
339200     EXEC CICS                                                    33920032
339300         DELETEQ TS                                               33930032
339400             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       33940032
339500             RESP  (PV-CICS-RESP)                                 33950032
339600     END-EXEC.                                                    33960032
339700*                                                                 33970032
339800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      33980032
339900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         33990032
340000         CONTINUE                                                 34000032
340100     ELSE                                                         34010032
340200         SET DP013-CICS-ABEND TO TRUE                             34020032
340300         SET DP013-NO-ROLLBACK TO TRUE                            34030032
340400         MOVE '6010-DELETE-SEL-QUEUE'                             34040032
340500                        TO DP013-PARAGRAPH                        34050032
340600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         34060032
340700                        TO DP013-MESSAGE-TEXT (1)                 34070032
340800         PERFORM DP013-0000-PROCESS-ABEND                         34080032
340900     END-IF.                                                      34090032
341000                                                                  34100032
341100*----------------------------------------------------------------*34110032
341200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *34120032
341300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *34130032
341400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *34140032
341500*    THE TEMP QUEUE.                                             *34150032
341600*----------------------------------------------------------------*34160032
341700                                                                  34170032
341800 6100-UPDATE-TSQ.                                                 34180032
341900                                                                  34190032
342000     IF PS-CICS-SWITCH-YES                                        34200099
342100         INITIALIZE PV-CICS-MSG-AREA                              34210099
342200         STRING ' ' PV-SRC-TASK-NUMBER                            34220099
342300                ' WSKCS315-6100'                                  34230099
342400                DELIMITED BY SIZE                                 34240099
342500                          INTO PV-CICS-MSG-AREA                   34250099
342600         PERFORM 7000-WRITE-TO-CICS-LOG                           34260099
342700     END-IF.                                                      34270099
342800*                                                                 34280032
342900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             34290032
343000     PERFORM 6105-READ-SEL-QUEUE.                                 34300032
343100     PERFORM                                                      34310032
343200         VARYING WS011-IDX                                        34320032
343300         FROM 1 BY 1                                              34330032
343400         UNTIL ((PV-ITEMS-PROCESSED >                             34340032
343500                              PV-HOLD-SELECTED-ITEMS)             34350032
343600         OR (WS011-IDX GREATER THAN WS011-MAX-ITEMS))             34360032
343700             PERFORM 6110-PROCESS-ITEMS                           34370032
343800         ADD +1                TO PV-ITEMS-PROCESSED              34380032
343900     END-PERFORM.                                                 34390032
344000     PERFORM 6111-WRITE-LIST-QUEUE.                               34400032
344100                                                                  34410032
344200*----------------------------------------------------------------*34420099
344300*    READ THE LIST QUEUE RECORD.                                 *34430032
344400*----------------------------------------------------------------*34440032
344500                                                                  34450032
344600 6105-READ-SEL-QUEUE.                                             34460032
344700                                                                  34470032
344800     IF PS-CICS-SWITCH-YES                                        34480099
344900         INITIALIZE PV-CICS-MSG-AREA                              34490099
345000         STRING ' ' PV-SRC-TASK-NUMBER                            34500099
345100                ' WSKCS315-6105'                                  34510099
345200                ' READ QUEUE=' ASC-SEL-QUEUE-NAME-OUT             34520099
345300                DELIMITED BY SIZE                                 34530099
345400                          INTO PV-CICS-MSG-AREA                   34540099
345500         PERFORM 7000-WRITE-TO-CICS-LOG                           34550099
345600     END-IF.                                                      34560099
345700*                                                                 34570032
345800     EXEC CICS                                                    34580032
345900          READQ TS                                                34590032
346000              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      34600032
346100              INTO  (WS011-SELECT-RECORD)                         34610032
346200              ITEM  (PV-SEL-QUEUE-ITEM)                           34620032
346300              RESP  (PV-CICS-RESP)                                34630032
346400     END-EXEC.                                                    34640032
346500*                                                                 34650032
346600     IF PV-CICS-RESP = DFHRESP (NORMAL)                           34660032
346700         CONTINUE                                                 34670032
346800     ELSE                                                         34680032
346900         SET DP013-CICS-ABEND      TO  TRUE                       34690032
347000         SET DP013-NO-ROLLBACK     TO  TRUE                       34700032
347100         MOVE '6105-READ-SEL-QUEUE'                               34710032
347200                                   TO  DP013-PARAGRAPH            34720032
347300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           34730032
347400                                   TO  DP013-MESSAGE-TEXT(1)      34740032
347500         PERFORM DP013-0000-PROCESS-ABEND                         34750032
347600     END-IF.                                                      34760032
347700/                                                                 34770032
347800*----------------------------------------------------------------*34780032
347900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*34790032
348000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*34800032
348100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *34810032
348200*----------------------------------------------------------------*34820032
348300                                                                  34830032
348400 6110-PROCESS-ITEMS.                                              34840032
348500                                                                  34850032
348600     IF PS-CICS-SWITCH-YES                                        34860099
348700         INITIALIZE PV-CICS-MSG-AREA                              34870099
348800         STRING ' ' PV-SRC-TASK-NUMBER                            34880099
348900                ' WSKCS315-6110'                                  34890099
349000                DELIMITED BY SIZE                                 34900099
349100                          INTO PV-CICS-MSG-AREA                   34910099
349200         PERFORM 7000-WRITE-TO-CICS-LOG                           34920099
349300     END-IF.                                                      34930099
349400*                                                                 34940032
349500     COMPUTE PV-ITEM = 1 + ((WS011-ITEM (WS011-IDX) - 1)          34950032
349600                     / PC-ITEMS-PER-PANEL).                       34960032
349700                                                                  34970032
349800     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            34980032
349900         IF PV-SAVE-ITEM NOT EQUAL ZERO                           34990032
350000             PERFORM 6111-WRITE-LIST-QUEUE                        35000032
350100         END-IF                                                   35010032
350200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    35020032
350300                                                                  35030032
350400         PERFORM 6112-READ-LIST-QUEUE                             35040032
350500         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                35050032
350600             CONTINUE                                             35060032
350700         END-IF                                                   35070032
350800     END-IF.                                                      35080032
350900                                                                  35090032
351000     COMPUTE PV-SUB = (WS011-ITEM (WS011-IDX)                     35100032
351100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              35110032
351200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         35120032
351300     MOVE LQW-SELECTED-SW (PV-SUB)                                35130032
351400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  35140032
351500                                                                  35150032
351600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                35160032
351700                                                                  35170032
351800*----------------------------------------------------------------*35180032
351900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN 6100.             *35190032
352000*----------------------------------------------------------------*35200032
352100                                                                  35210032
352200 6111-WRITE-LIST-QUEUE.                                           35220032
352300                                                                  35230032
352400     IF PS-CICS-SWITCH-YES                                        35240099
352500         INITIALIZE PV-CICS-MSG-AREA                              35250099
352600         STRING ' ' PV-SRC-TASK-NUMBER                            35260099
352700                ' WSKCS315-6111'                                  35270099
352800                ' WRITE QUEUE=' ASC-LIST-QUEUE-NAME               35280099
352900                DELIMITED BY SIZE                                 35290099
353000                          INTO PV-CICS-MSG-AREA                   35300099
353100         PERFORM 7000-WRITE-TO-CICS-LOG                           35310099
353200     END-IF.                                                      35320099
353300*                                                                 35330032
353400     EXEC CICS                                                    35340032
353500         WRITEQ TS                                                35350032
353600             QUEUE (ASC-LIST-QUEUE-NAME)                          35360032
353700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     35370032
353800             ITEM  (PV-SAVE-ITEM)                                 35380032
353900             REWRITE                                              35390032
354000             RESP  (PV-CICS-RESP)                                 35400032
354100     END-EXEC.                                                    35410032
354200*                                                                 35420032
354300     IF PV-CICS-RESP = DFHRESP (NORMAL)                           35430032
354400         CONTINUE                                                 35440032
354500     ELSE                                                         35450032
354600         SET DP013-CICS-ABEND  TO  TRUE                           35460032
354700         SET DP013-NO-ROLLBACK TO  TRUE                           35470032
354800         MOVE '6111-WRITE-LIST-QUEUE'                             35480032
354900                               TO  DP013-PARAGRAPH                35490032
355000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  35500032
355100                               TO  DP013-MESSAGE-TEXT(1)          35510032
355200         PERFORM DP013-0000-PROCESS-ABEND                         35520032
355300     END-IF.                                                      35530032
355400                                                                  35540032
355500/                                                                 35550032
355600*----------------------------------------------------------------*35560032
355700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*35570032
355800*----------------------------------------------------------------*35580032
355900                                                                  35590032
356000 6112-READ-LIST-QUEUE.                                            35600032
356100                                                                  35610032
356200     IF PS-CICS-SWITCH-YES                                        35620099
356300         INITIALIZE PV-CICS-MSG-AREA                              35630099
356400         STRING ' ' PV-SRC-TASK-NUMBER                            35640099
356500                ' WSKCS315-6112'                                  35650099
356600                ' READ QUEUE='  ASC-LIST-QUEUE-NAME               35660099
356700                DELIMITED BY SIZE                                 35670099
356800                          INTO PV-CICS-MSG-AREA                   35680099
356900         PERFORM 7000-WRITE-TO-CICS-LOG                           35690099
357000     END-IF.                                                      35700099
357100*                                                                 35710032
357200     EXEC CICS                                                    35720032
357300         READQ TS                                                 35730032
357400             QUEUE (ASC-LIST-QUEUE-NAME)                          35740032
357500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     35750032
357600             ITEM  (PV-ITEM)                                      35760032
357700             RESP  (PV-CICS-RESP)                                 35770032
357800     END-EXEC.                                                    35780032
357900*                                                                 35790032
358000     IF PV-CICS-RESP = DFHRESP (NORMAL)                           35800032
358100         CONTINUE                                                 35810032
358200     ELSE                                                         35820032
358300         SET DP013-CICS-ABEND        TO TRUE                      35830032
358400         SET DP013-NO-ROLLBACK       TO TRUE                      35840032
358500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           35850032
358600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    35860032
358700                                     TO DP013-MESSAGE-TEXT(1)     35870032
358800         PERFORM DP013-0000-PROCESS-ABEND                         35880032
358900     END-IF.                                                      35890032
359000                                                                  35900032
359100 7000-WRITE-TO-CICS-LOG.                                          35910099
359200                                                                  35920099
359300     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       35930099
359400                                                                  35940099
359500     EXEC CICS                                                    35950099
359600          WRITEQ TD                                               35960099
359700          QUEUE  ('CSSL')                                         35970099
359800          FROM  (PV-CICS-MSG-AREA)                                35980099
359900          LENGTH  (PV-COMMAREA-LENGTH)                            35990099
360000          RESP  (PV-CICS-RESP)                                    36000099
360100     END-EXEC.                                                    36010099
360200                                                                  36020099
360300     MOVE SPACES TO PV-CICS-MSG-AREA.                             36030099
360400                                                                  36040099
360500                                                                  36050099
360600*-----------------------------------------------------------------36060099
360700*  READ THE LIST QUEUE RECORD                                     36070099
360800*-----------------------------------------------------------------36080099
360900 9100-READ-SEL-QUEUE.                                             36090099
361000                                                                  36100099
361100     IF PS-CICS-SWITCH-YES                                        36110099
361200         INITIALIZE PV-CICS-MSG-AREA                              36120099
361300         STRING ' ' PV-SRC-TASK-NUMBER                            36130099
361400                ' WSKCS315-9100'                                  36140099
361500                ' WRITE QUEUE='  ASC-SEL-QUEUE-NAME               36150099
361600                DELIMITED BY SIZE                                 36160099
361700                          INTO PV-CICS-MSG-AREA                   36170099
361800         PERFORM 7000-WRITE-TO-CICS-LOG                           36180099
361900     END-IF.                                                      36190099
362000                                                                  36200099
362100     EXEC CICS                                                    36210099
362200         READQ TS                                                 36220099
362300             QUEUE (ASC-SEL-QUEUE-NAME)                           36230099
362400             INTO  (SU010-SELECT-RECORD)                          36240099
362500             ITEM  (ASC-SEL-ITEM)                                 36250099
362600             RESP  (PV-CICS-RESP)                                 36260099
362700     END-EXEC.                                                    36270099
362800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        36280099
362900         CONTINUE                                                 36290099
363000     ELSE                                                         36300099
363100         SET DP013-LOGIC-ABEND                                    36310099
363200             DP013-NO-ROLLBACK   TO   TRUE                        36320099
363300         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          36330099
363400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   36340099
363500                                 TO   DP013-MESSAGE-TEXT (1)      36350099
363600         PERFORM DP013-0000-PROCESS-ABEND                         36360099
363700     END-IF.                                                      36370099
363800                                                                  36380099
363900*-----------------------------------------------------------------36390099
364000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *36400099
364100*-----------------------------------------------------------------36410099
364200 9200-REWRITE-SEL-QUEUE.                                          36420099
364300                                                                  36430099
364400     IF PS-CICS-SWITCH-YES                                        36440099
364500         INITIALIZE PV-CICS-MSG-AREA                              36450099
364600         STRING ' ' PV-SRC-TASK-NUMBER                            36460099
364700                ' WSKCS315-9200'                                  36470099
364800                ' WRITE QUEUE='  ASC-SEL-QUEUE-NAME               36480099
364900                DELIMITED BY SIZE                                 36490099
365000                          INTO PV-CICS-MSG-AREA                   36500099
365100         PERFORM 7000-WRITE-TO-CICS-LOG                           36510099
365200     END-IF.                                                      36520099
365300                                                                  36530099
365400     EXEC CICS                                                    36540099
365500          WRITEQ TS                                               36550099
365600              QUEUE  (ASC-SEL-QUEUE-NAME)                         36560099
365700              FROM   (SU010-SELECT-RECORD)                        36570099
365800              ITEM   (ASC-SEL-ITEM)                               36580099
365900              RESP   (PV-CICS-RESP)                               36590099
366000              REWRITE                                             36600099
366100     END-EXEC.                                                    36610099
366200                                                                  36620099
366300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   36630099
366400         SET DP013-CICS-ABEND                                     36640099
366500             DP013-NO-ROLLBACK     TO TRUE                        36650099
366600         MOVE '9200-REWRITE-SEL-QUEUE'                            36660099
366700                                   TO DP013-PARAGRAPH             36670099
366800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   36680099
366900                                   TO DP013-MESSAGE-TEXT (1)      36690099
367000         PERFORM DP013-0000-PROCESS-ABEND                         36700099
367100     END-IF.                                                      36710099
367200                                                                  36720099
367300                                                                  36730049
367400*----------------------------------------------------------------*36740032
367500*    ABEND PROCESSOR MODULE                                      *36750032
367600*----------------------------------------------------------------*36760032
367700                                                                  36770032
367800     COPY DPPD013.                                                36780032
