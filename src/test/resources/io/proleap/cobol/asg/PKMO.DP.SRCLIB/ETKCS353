000100*-----------------------*                                         00010072
000200 IDENTIFICATION DIVISION.                                         00020072
000300*-----------------------*                                         00030072
000400 PROGRAM-ID.    ETKCS353.                                         00040072
000500 AUTHOR.        DAN GRUBER.                                       00050072
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060072
000700 DATE-WRITTEN.  09-24-96.                                         00070072
000800 DATE-COMPILED.                                                   00080072
000900                                                                  00090072
001000*---------------------------------------------------------------* 00100072
001100*    E353 - KOHLS SIZE LIST PROGRAM.                            * 00110072
001200*                                                               * 00120072
001300*    THIS PROGRAM GENERATES A LIST OF SIZES WITHIN A PARTICULAR * 00130072
001400*    SIZE GROUP.  THE NRF CODE, KOHLS, DESCRIPTION, PRIMARY     * 00140072
001500*    DESCRIPTION, AND SECONDARY DESCRIPTION ARE ALSO DISPLAYED. * 00150072
001600*    THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR       * 00160072
001700*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00170072
001800*                                                               * 00180072
001900*---------------------------------------------------------------* 00190072
002000*   08/17/2007  JILL LIN      WR32250 - ECOMM NEW ATTRIBUTES    * 00200072
002100*   ADD EXTENDED SIZE CODE AND DESCRIPTION TO THE SCREEN.       * 00210072
002200*---------------------------------------------------------------* 00220072
002210* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00221074
002220*            - CHANGE CALL OF DPKUT100 TO                       * 00222074
002230*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00223074
002240*              MAKING THE CALL DYNAMIC VS STATIC                * 00224074
002250*                                                               * 00225074
002260*---------------------------------------------------------------* 00226074
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00227075
CICS  *                                                               * 00228075
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00229075
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00229175
CICS  *---------------------------------------------------------------* 00229375
002300 EJECT                                                            00230072
002400                                                                  00240072
002500 ENVIRONMENT DIVISION.                                            00250072
002600                                                                  00260072
002700 DATA DIVISION.                                                   00270072
002800                                                                  00280072
002900 WORKING-STORAGE SECTION.                                         00290072
003000                                                                  00300072
003100 01  DK-DB2-KEYS.                                                 00310072
003200     15  DK-SIZE-GP-CODE                PIC S9(04)  VALUE ZERO    00320072
003300                                                    COMP.         00330072
003400     15  DK-SIZE-GP-DESC                PIC  X(30)  VALUE SPACE.  00340072
003500     15  DK-NRF-SIZE-CODE               PIC  X(05)  VALUE SPACE.  00350072
003600     15  DK-KOHLS-DESC                  PIC  X(10)  VALUE SPACE.  00360072
003700     15  DK-KOHLS-DESC-BYTE             REDEFINES DK-KOHLS-DESC   00370072
003800                                        OCCURS 10 TIMES           00380072
003900                                        PIC  X(01).               00390072
004000     15  DK-EXP-SIZE-IND                PIC  X(01)  VALUE SPACE.  00400072
004100                                                                  00410072
004200 01  PC-PROGRAM-CONSTANTS.                                        00420072
004300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00430072
004400                                                    'ET353A  '.   00440072
004500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00450072
004600                                                    'ETKM353 '.   00460072
004700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00470072
004800                                                    'ETKCS353'.   00480072
004900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00490072
005000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00500072
005100     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00510072
005200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00520072
005300                                                    COMP SYNC.    00530072
005400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00540072
005500                                                    COMP SYNC.    00550072
005600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00560072
005700                                                    +1000000      00570072
005800                                                    COMP-3.       00580072
005900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00590072
006000                                                    COMP SYNC.    00600072
006100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00610072
006200                                                    COMP-3.       00620072
006300     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00630072
006400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00640072
006500     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00650072
006600     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00660072
006700     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00670072
006800     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00680072
006900                                                                  00690072
007000     05  PC-TSYMSG-NUMBERS.                                       00700072
007100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00710072
007200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00720072
007300         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00730072
007400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00740072
007500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00750072
007600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00760072
007700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00770072
007800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00780072
007900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00790072
008000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00800072
008100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00810072
008200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00820072
008300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00830072
008400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00840072
008500                                                                  00850072
008600 01  PS-PROGRAM-SWITCHES.                                         00860072
008700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00870072
008800         88  PS-NO-ERROR                            VALUE 'Y'.    00880072
008900         88  PS-ERROR                               VALUE 'N'.    00890072
009000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00900072
009100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00910072
009200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00920072
009300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00930072
009400         88  PS-DONE                                VALUE 'Y'.    00940072
009500         88  PS-NOT-DONE                            VALUE 'N'.    00950072
009600     05  PS-SIZE-EXPIRED-SW             PIC  X(01)  VALUE 'N'.    00960072
009700         88  PS-SIZE-EXPIRED                        VALUE 'Y'.    00970072
009800         88  PS-SIZE-NOT-EXPIRED                    VALUE 'N'.    00980072
009900                                                                  00990072
010000 01  PV-PROGRAM-VARIABLES.                                        01000072
010100     05  PV-SUB                         PIC S9(04)  VALUE +0      01010072
010200                                                    COMP SYNC.    01020072
010300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01030072
010400                                                    COMP SYNC.    01040072
010500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01050072
010600                                                    COMP-3.       01060072
010700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01070072
010800                                                    COMP-3.       01080072
010900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01090072
011000                                                    COMP-3.       01100072
011100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01110072
011200                                                    COMP-3.       01120072
011300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01130072
011400                                                    COMP-3.       01140072
011500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01150072
011600                                                    COMP-3.       01160072
011700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01170072
011800                                                    COMP-3.       01180072
011900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01190072
012000                                                    COMP SYNC.    01200072
012100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01210072
012200                                                    COMP SYNC.    01220072
012300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01230072
012400                                                    COMP SYNC.    01240072
012500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01250072
012600                                                    COMP SYNC.    01260072
012700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01270072
012800                                                    COMP SYNC.    01280072
012900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01290072
013000                                                    COMP SYNC.    01300072
013100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01310072
013200                                                    COMP SYNC.    01320072
013300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01330072
013400                                                    COMP SYNC.    01340072
013500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01350072
013600                                                    COMP SYNC.    01360072
013700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01370072
013800                                                    COMP SYNC.    01380072
013900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01390072
014000                                                    COMP SYNC.    01400072
014100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01410072
014200                                                    COMP SYNC.    01420072
014300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01430072
014400                                                    COMP SYNC.    01440072
014500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01450072
014600                                                    COMP SYNC.    01460072
014700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01470072
014800                                                    COMP SYNC.    01480072
014900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01490072
015000                                                    COMP SYNC.    01500072
015100     05  PV-SIZE-GP-CODE-N              PIC  9(02)  VALUE ZEROES. 01510072
015200     05  PV-SIZE-GP-CODE-X              PIC  X(02)  VALUE SPACES. 01520072
015300     05  PV-END-DATE-NULL-IND           PIC S9(04)  VALUE +0      01530072
015400                                                    COMP.         01540072
015500     05  PV-EXTD-SZ-CDE-NULL-IND        PIC S9(04)  VALUE +0      01550072
015600                                                    COMP.         01560072
015700******************************************************************01570072
015800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01580072
015900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01590072
016000**  APPLICATION-SPECIFIC COMMAREA.                              **01600072
016100******************************************************************01610072
016200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01620072
016300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01630072
016400     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01640072
016500                                        INDEXED BY LQW-IDX.       01650072
016600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01660072
016700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01670072
016800         10  LQW-SELECTED-SW            PIC  X(01).               01680072
016900             88  LQW-SELECT                         VALUE 'S'.    01690072
017000             88  LQW-DESELECT                       VALUE ' '.    01700072
017100         10  LQW-ACTION                 PIC  X(03).               01710072
017200         10  LQW-KOHLS-SIZE-CODE        PIC S9(09)  COMP.         01720072
017300         10  LQW-EFF-END-DATE           PIC  X(10).               01730072
017400         10  LQW-NRF-SIZE-CODE          PIC  X(05).               01740072
017500         10  LQW-KOHLS-DESC             PIC  X(10).               01750072
017600         10  LQW-PRI-DESC               PIC  X(25).               01760072
017700         10  LQW-SEC-DESC               PIC  X(23).               01770072
017800         10  LQW-EXT-SIZE-CODE          PIC  X(01).               01780072
017900                                                                  01790072
018000     EJECT                                                        01800072
018100*---------------------------------------------------------------* 01810072
018200*  RECORD LAYOUT FOR THE SIZE SELECTION TEMP STORAGE QUEUE.     * 01820072
018300*---------------------------------------------------------------* 01830072
018400                                                                  01840072
018500     COPY ETWS353.                                                01850072
018600                                                                  01860072
018700     EJECT                                                        01870072
018800*---------------------------------------------------------------* 01880072
018900*    MAP LAYOUT                                                 * 01890072
019000*---------------------------------------------------------------* 01900072
019100                                                                  01910072
019200     COPY ETKM353.                                                01920072
019300*                                                                 01930072
019400 01  MR-OCCURS-LAYOUT                   REDEFINES  ET353AO.       01940072
019500     05  FILLER                         PIC X(84).                01950072
019600     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01960072
019700         10  MR-SELECTL                 PIC S9(04) COMP.          01970072
019800         10  MR-SELECTA                 PIC  X(01).               01980072
019900         10  MR-SELECTC                 PIC  X(01).               01990072
020000         10  MR-SELECTH                 PIC  X(01).               02000072
020100         10  MR-SELECT                  PIC  X(01).               02010072
020200                                                                  02020072
020300         10  MR-ACTIONL                 PIC S9(04) COMP.          02030072
020400         10  MR-ACTIONA                 PIC  X(01).               02040072
020500         10  MR-ACTIONC                 PIC  X(01).               02050072
020600         10  MR-ACTIONH                 PIC  X(01).               02060072
020700         10  MR-ACTION                  PIC  X(03).               02070072
020800                                                                  02080072
020900         10  MR-NRF-SIZE-CODEL          PIC S9(04) COMP.          02090072
021000         10  MR-NRF-SIZE-CODEA          PIC  X(01).               02100072
021100         10  MR-NRF-SIZE-CODEC          PIC  X(01).               02110072
021200         10  MR-NRF-SIZE-CODEH          PIC  X(01).               02120072
021300         10  MR-NRF-SIZE-CODE           PIC  X(05).               02130072
021400                                                                  02140072
021500         10  MR-KOHLS-DESCL             PIC S9(04) COMP.          02150072
021600         10  MR-KOHLS-DESCA             PIC  X(01).               02160072
021700         10  MR-KOHLS-DESCC             PIC  X(01).               02170072
021800         10  MR-KOHLS-DESCH             PIC  X(01).               02180072
021900         10  MR-KOHLS-DESC              PIC  X(10).               02190072
022000                                                                  02200072
022100         10  MR-PRI-DESCL               PIC S9(04) COMP.          02210072
022200         10  MR-PRI-DESCA               PIC  X(01).               02220072
022300         10  MR-PRI-DESCC               PIC  X(01).               02230072
022400         10  MR-PRI-DESCH               PIC  X(01).               02240072
022500         10  MR-PRI-DESC                PIC  X(25).               02250072
022600                                                                  02260072
022700         10  MR-SEC-DESCL               PIC S9(04) COMP.          02270072
022800         10  MR-SEC-DESCA               PIC  X(01).               02280072
022900         10  MR-SEC-DESCC               PIC  X(01).               02290072
023000         10  MR-SEC-DESCH               PIC  X(01).               02300072
023100         10  MR-SEC-DESC                PIC  X(23).               02310072
023200                                                                  02320072
023300         10  MR-EXT-CODEL               PIC S9(04) COMP.          02330072
023400         10  MR-EXT-CODEA               PIC  X(01).               02340072
023500         10  MR-EXT-CODEC               PIC  X(01).               02350072
023600         10  MR-EXT-CODEH               PIC  X(01).               02360072
023700         10  MR-EXT-CODE                PIC  X(01).               02370072
023800                                                                  02380072
023900     EJECT                                                        02390072
024000*---------------------------------------------------------------* 02400072
024100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02410072
024200*---------------------------------------------------------------* 02420072
024300                                                                  02430072
024400     COPY DPWS015.                                                02440072
024500                                                                  02450072
024600*---------------------------------------------------------------* 02460072
024700*    FUNCTION KEYS COPYBOOK.                                    * 02470072
024800*---------------------------------------------------------------* 02480072
024900                                                                  02490072
025000     COPY DPWS016.                                                02500072
025100                                                                  02510072
025200*---------------------------------------------------------------* 02520072
025300*    NUMERIC EDIT LAYOUT.                                       * 02530072
025400*---------------------------------------------------------------* 02540072
025500                                                                  02550072
025600     COPY DPWS010I.                                               02560072
025700 EJECT                                                            02570072
025800*---------------------------------------------------------------* 02580072
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02590075
026000*---------------------------------------------------------------* 02600072
026100                                                                  02610072
026200     COPY DPWS030.                                                02620072
CICS       COPY DPWS930.                                                02621075
026300 EJECT                                                            02630072
026400*---------------------------------------------------------------* 02640072
026500*    STANDARD COMMAREA.                                         * 02650072
026600*---------------------------------------------------------------* 02660072
026700                                                                  02670072
026800     COPY DPWS020.                                                02680072
026900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02690072
027000                                                                  02700072
027100*---------------------------------------------------------------* 02710072
027200* INTER-APPLICATION COMMAREA.                                   * 02720072
027300*   ETWS351 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02730072
027400*             SPEC SCREEN.                                      * 02740072
027500*   ETWS352 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02750072
027600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02760072
027700*---------------------------------------------------------------* 02770072
027800                                                                  02780072
027900         10  INTER-APPL-COMM-AREA       PIC X(200).               02790072
028000     COPY ETWS351.                                                02800072
028100     COPY ETWS352.                                                02810072
028200                                                                  02820072
028300*---------------------------------------------------------------* 02830072
028400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02840072
028500*---------------------------------------------------------------* 02850072
028600         10  ASC-SPECIFIC-COMMAREA.                               02860072
028700             15  ASC-LIST-KEYS.                                   02870072
028800                 20  ASC-KEY-SIZE-GP-CODE            PIC S9(04)   02880072
028900                                                          COMP.   02890072
029000                 20  ASC-KEY-SIZE-GP-DESC            PIC  X(30).  02900072
029100                 20  ASC-KEY-NRF-SIZE-CODE           PIC  X(05).  02910072
029200                 20  ASC-KEY-KOHLS-DESC              PIC  X(10).  02920072
029300                 20  ASC-KEY-EXP-SIZE-IND            PIC  X(01).  02930072
029400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02940072
029500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02950072
029600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02960072
029700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02970072
029800                                                                  02980072
029900                 20  ASC-ITEM-ARRAY.                              02990072
030000                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03000072
030100                         30  ASC-LIST-ITEM-NUMBER                 03010072
030200                                                     PIC S9(09)   03020072
030300                                                     COMP-3.      03030072
030400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03040072
030500                             88  ASC-VALID-SELECT    VALUE ' '    03050072
030600                                                           'S'    03060072
030700                                                           'B'    03070072
030800                                                           'E'.   03080072
030900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03090072
031000                             88  ASC-TEMP-SELECT     VALUE 'S'.   03100072
031100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03110072
031200                             88  ASC-TEMP-END        VALUE 'E'.   03120072
031300                         30  ASC-SELECTED-SW         PIC  X(01).  03130072
031400                             88  ASC-NO-SELECT       VALUE ' '.   03140072
031500                             88  ASC-SELECT          VALUE 'S'.   03150072
031600                             88  ASC-BEGIN           VALUE 'B'.   03160072
031700                             88  ASC-END             VALUE 'E'.   03170072
031800                         30  ASC-ACTION              PIC  X(03).  03180072
031900                         30  ASC-KOHLS-SIZE-CODE     PIC S9(09)   03190072
032000                                                          COMP.   03200072
032100                         30  ASC-EFF-END-DATE        PIC  X(10).  03210072
032200                         30  ASC-NRF-SIZE-CODE       PIC  X(05).  03220072
032300                         30  ASC-KOHLS-DESC          PIC  X(10).  03230072
032400                         30  ASC-PRI-DESC            PIC  X(25).  03240072
032500                         30  ASC-SEC-DESC            PIC  X(23).  03250072
032600                         30  ASC-EXT-CODE            PIC  X(01).  03260072
032700                                                                  03270072
032800             15  ASC-BLK-SUB                         PIC S9(04)   03280072
032900                                                          COMP    03290072
033000                                                          SYNC.   03300072
033100             15  ASC-ITEM-SUB                        PIC S9(04)   03310072
033200                                                          COMP    03320072
033300                                                          SYNC.   03330072
033400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03340072
033500                                                          COMP-3. 03350072
033600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03360072
033700                                                          COMP-3. 03370072
033800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03380072
033900                                                          COMP-3. 03390072
034000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03400072
034100                                                          COMP-3. 03410072
034200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03420072
034300                                                          COMP-3. 03430072
034400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03440072
034500                                                          COMP    03450072
034600                                                          SYNC.   03460072
034700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03470072
034800                                                          COMP-3. 03480072
034900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03490072
035000                                                          COMP-3. 03500072
035100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03510072
035200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03520072
035300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03530072
035400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03540072
035500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03550072
035600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03560072
035700             15  ASC-LIST-QUEUE-NAME.                             03570072
035800                 20  ASC-LIST-TERM-ID                PIC  X(04).  03580072
035900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03590072
036000                                                          COMP-3. 03600072
036100                 20  ASC-LIST-SEQ                    PIC  9(01).  03610072
036200             15  ASC-SEL-QUEUE-NAME.                              03620072
036300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03630072
036400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03640072
036500                                                          COMP-3. 03650072
036600                 20  ASC-SEL-SEQ                     PIC  9(01).  03660072
036700                                                                  03670072
036800             15  ASC-CURSOR-SW                       PIC  X(01).  03680072
036900                 88  ASC-SGC-ALL-CSR                 VALUE 'A'.   03690072
037000                 88  ASC-SGC-NOEXP-CSR               VALUE 'B'.   03700072
037100                 88  ASC-SGC-NRF-ALL-CSR             VALUE 'C'.   03710072
037200                 88  ASC-SGC-NRF-NOEXP-CSR           VALUE 'D'.   03720072
037300                 88  ASC-SGC-KDSC-ALL-CSR            VALUE 'E'.   03730072
037400                 88  ASC-SGC-KDSC-NOEXP-CSR          VALUE 'F'.   03740072
037500                 88  ASC-ALL-FLDS-ALL-CSR            VALUE 'G'.   03750072
037600                 88  ASC-ALL-FLDS-NOEXP-CSR          VALUE 'H'.   03760072
037700             15  ASC-SETUP-LIKE-FIELD-SW             PIC  X(01).  03770072
037800                 88  ASC-SETUP-LIKE-FIELD            VALUE 'Y'.   03780072
037900                 88  ASC-DONT-SETUP-LIKE-FIELD       VALUE 'N'.   03790072
038000             15  ASC-START-ITEM-REQUEST.                          03800072
038100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03810072
038200                                                                  03820072
038300     EJECT                                                        03830072
038400*---------------------------------------------------------------* 03840072
038500*    ABEND PROCESSING COPYBOOK.                                 * 03850072
038600*---------------------------------------------------------------* 03860072
038700                                                                  03870072
038800     COPY DPWS013.                                                03880072
038900                                                                  03890072
039000 EJECT                                                            03900072
039100*---------------------------------------------------------------* 03910072
039200*    DB2 AREA FOR SIZE TABLE                                    * 03920072
039300*---------------------------------------------------------------* 03930072
039400     EXEC SQL                                                     03940072
039500          INCLUDE TSIZE                                           03950072
039600     END-EXEC.                                                    03960072
039700*---------------------------------------------------------------* 03970072
039800*    DB2 AREA FOR IMT_EXTD_SZ TABLE                             * 03980072
039900*---------------------------------------------------------------* 03990072
040000     EXEC SQL                                                     04000072
040100          INCLUDE IMT00025                                        04010072
040200     END-EXEC.                                                    04020072
040300*---------------------------------------------------------------* 04030072
040400*    DB2 AREA FOR COMMUNICATIONS                                * 04040072
040500*---------------------------------------------------------------* 04050072
040600     EXEC SQL                                                     04060072
040700          INCLUDE SQLCA                                           04070072
040800     END-EXEC.                                                    04080072
040900                                                                  04090072
041000*---------------------------------------------------------------* 04100072
041100*    DECLARE CURSOR FOR WHEN ONLY SIZE GROUP CODE IS SELECTED   * 04110072
041200*    AND INCLUDE EXPIRED SIZES IS SET TO A 'Y'.                 * 04120072
041300*---------------------------------------------------------------* 04130072
041400                                                                  04140072
041500     EXEC SQL                                                     04150072
041600          DECLARE SGC-ALL-CSR CURSOR                              04160072
041700          FOR SELECT                                              04170072
041800                KOHLS_SIZE_CDE                                    04180072
041900              , EFF_END_DTE                                       04190072
042000              , SIZE_GP_CDE                                       04200072
042100              , NRF_SIZE_CDE                                      04210072
042200              , PRIM_DESC                                         04220072
042300              , SEC_DESC                                          04230072
042400              , KOHLS_DESC                                        04240072
042500              , EXTD_SZ_CDE                                       04250072
042600          FROM                                                    04260072
042700                TSIZE                                             04270072
042800          WHERE                                                   04280072
042900                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 04290072
043000          ORDER BY                                                04300072
043100                NRF_SIZE_CDE                                      04310072
043200     END-EXEC.                                                    04320072
043300                                                                  04330072
043400                                                                  04340072
043500*---------------------------------------------------------------* 04350072
043600*    DECLARE CURSOR FOR WHEN ONLY SIZE GROUP CODE IS SELECTED   * 04360072
043700*    AND INCLUDE EXPIRED SIZES IS SET TO A 'N'.                 * 04370072
043800*---------------------------------------------------------------* 04380072
043900                                                                  04390072
044000     EXEC SQL                                                     04400072
044100          DECLARE SGC-NOEXP-CSR CURSOR                            04410072
044200          FOR SELECT                                              04420072
044300                KOHLS_SIZE_CDE                                    04430072
044400              , EFF_END_DTE                                       04440072
044500              , SIZE_GP_CDE                                       04450072
044600              , NRF_SIZE_CDE                                      04460072
044700              , PRIM_DESC                                         04470072
044800              , SEC_DESC                                          04480072
044900              , KOHLS_DESC                                        04490072
045000              , EXTD_SZ_CDE                                       04500072
045100          FROM                                                    04510072
045200                TSIZE                                             04520072
045300          WHERE                                                   04530072
045400                SIZE_GP_CDE  = :DK-SIZE-GP-CODE                   04540072
045500            AND EFF_END_DTE  IS NULL                              04550072
045600          ORDER BY                                                04560072
045700                NRF_SIZE_CDE                                      04570072
045800     END-EXEC.                                                    04580072
045900                                                                  04590072
046000*---------------------------------------------------------------* 04600072
046100*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE AND NRF SIZE CODE  * 04610072
046200*    ARE SELECTED AND INCLUDE EXPIRED SIZES IS SET TO A 'Y'.    * 04620072
046300*---------------------------------------------------------------* 04630072
046400                                                                  04640072
046500     EXEC SQL                                                     04650072
046600          DECLARE SGC-NRF-ALL-CSR CURSOR                          04660072
046700          FOR SELECT                                              04670072
046800                KOHLS_SIZE_CDE                                    04680072
046900              , EFF_END_DTE                                       04690072
047000              , SIZE_GP_CDE                                       04700072
047100              , NRF_SIZE_CDE                                      04710072
047200              , PRIM_DESC                                         04720072
047300              , SEC_DESC                                          04730072
047400              , KOHLS_DESC                                        04740072
047500              , EXTD_SZ_CDE                                       04750072
047600          FROM                                                    04760072
047700                TSIZE                                             04770072
047800          WHERE                                                   04780072
047900                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 04790072
048000            AND NRF_SIZE_CDE  >= :DK-NRF-SIZE-CODE                04800072
048100          ORDER BY                                                04810072
048200                NRF_SIZE_CDE                                      04820072
048300     END-EXEC.                                                    04830072
048400                                                                  04840072
048500*---------------------------------------------------------------* 04850072
048600*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE AND NRF SIZE CODE  * 04860072
048700*    ARE SELECTED AND INCLUDE EXPIRED SIZES IS SET TO A 'N'.    * 04870072
048800*---------------------------------------------------------------* 04880072
048900                                                                  04890072
049000     EXEC SQL                                                     04900072
049100          DECLARE SGC-NRF-NOEXP-CSR CURSOR                        04910072
049200          FOR SELECT                                              04920072
049300                KOHLS_SIZE_CDE                                    04930072
049400              , EFF_END_DTE                                       04940072
049500              , SIZE_GP_CDE                                       04950072
049600              , NRF_SIZE_CDE                                      04960072
049700              , PRIM_DESC                                         04970072
049800              , SEC_DESC                                          04980072
049900              , KOHLS_DESC                                        04990072
050000              , EXTD_SZ_CDE                                       05000072
050100          FROM                                                    05010072
050200                TSIZE                                             05020072
050300          WHERE                                                   05030072
050400                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 05040072
050500            AND NRF_SIZE_CDE  >= :DK-NRF-SIZE-CODE                05050072
050600            AND EFF_END_DTE    IS NULL                            05060072
050700          ORDER BY                                                05070072
050800                NRF_SIZE_CDE                                      05080072
050900     END-EXEC.                                                    05090072
051000                                                                  05100072
051100*---------------------------------------------------------------* 05110072
051200*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE AND KOHLS DESC     * 05120072
051300*    ARE SELECTED AND INCLUDE EXPIRED SIZES IS SET TO A 'Y'.    * 05130072
051400*---------------------------------------------------------------* 05140072
051500                                                                  05150072
051600     EXEC SQL                                                     05160072
051700          DECLARE SGC-KDSC-ALL-CSR CURSOR                         05170072
051800          FOR SELECT                                              05180072
051900                KOHLS_SIZE_CDE                                    05190072
052000              , EFF_END_DTE                                       05200072
052100              , SIZE_GP_CDE                                       05210072
052200              , NRF_SIZE_CDE                                      05220072
052300              , PRIM_DESC                                         05230072
052400              , SEC_DESC                                          05240072
052500              , KOHLS_DESC                                        05250072
052600              , EXTD_SZ_CDE                                       05260072
052700          FROM                                                    05270072
052800                TSIZE                                             05280072
052900          WHERE                                                   05290072
053000                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 05300072
053100            AND KOHLS_DESC  LIKE :DK-KOHLS-DESC                   05310072
053200          ORDER BY                                                05320072
053300                NRF_SIZE_CDE                                      05330072
053400     END-EXEC.                                                    05340072
053500                                                                  05350072
053600*---------------------------------------------------------------* 05360072
053700*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE AND KOHLS DESC     * 05370072
053800*    ARE SELECTED AND INCLUDE EXPIRED SIZES IS SET TO A 'N'.    * 05380072
053900*---------------------------------------------------------------* 05390072
054000                                                                  05400072
054100     EXEC SQL                                                     05410072
054200          DECLARE SGC-KDSC-NOEXP-CSR CURSOR                       05420072
054300          FOR SELECT                                              05430072
054400                KOHLS_SIZE_CDE                                    05440072
054500              , EFF_END_DTE                                       05450072
054600              , SIZE_GP_CDE                                       05460072
054700              , NRF_SIZE_CDE                                      05470072
054800              , PRIM_DESC                                         05480072
054900              , SEC_DESC                                          05490072
055000              , KOHLS_DESC                                        05500072
055100              , EXTD_SZ_CDE                                       05510072
055200          FROM                                                    05520072
055300                TSIZE                                             05530072
055400          WHERE                                                   05540072
055500                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 05550072
055600            AND KOHLS_DESC  LIKE :DK-KOHLS-DESC                   05560072
055700            AND EFF_END_DTE   IS  NULL                            05570072
055800          ORDER BY                                                05580072
055900                NRF_SIZE_CDE                                      05590072
056000     END-EXEC.                                                    05600072
056100                                                                  05610072
056200*---------------------------------------------------------------* 05620072
056300*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE, NRF SIZE CODE,    * 05630072
056400*    AND KOHLS DESCRIPTION ARE ALL ENTERED AND THE INCLUDE      * 05640072
056500*    EXPIRED SIZES IS SET TO A 'Y'.                             * 05650072
056600*---------------------------------------------------------------* 05660072
056700                                                                  05670072
056800     EXEC SQL                                                     05680072
056900          DECLARE ALL-FLDS-ALL-CSR CURSOR                         05690072
057000          FOR SELECT                                              05700072
057100                KOHLS_SIZE_CDE                                    05710072
057200              , EFF_END_DTE                                       05720072
057300              , SIZE_GP_CDE                                       05730072
057400              , NRF_SIZE_CDE                                      05740072
057500              , PRIM_DESC                                         05750072
057600              , SEC_DESC                                          05760072
057700              , KOHLS_DESC                                        05770072
057800              , EXTD_SZ_CDE                                       05780072
057900          FROM                                                    05790072
058000                TSIZE                                             05800072
058100          WHERE                                                   05810072
058200                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 05820072
058300            AND NRF_SIZE_CDE  >= :DK-NRF-SIZE-CODE                05830072
058400            AND KOHLS_DESC  LIKE :DK-KOHLS-DESC                   05840072
058500          ORDER BY                                                05850072
058600                NRF_SIZE_CDE                                      05860072
058700     END-EXEC.                                                    05870072
058800                                                                  05880072
058900*---------------------------------------------------------------* 05890072
059000*    DECLARE CURSOR FOR WHEN SIZE GROUP CODE, NRF SIZE CODE,    * 05900072
059100*    AND KOHLS DESCRIPTION ARE ALL ENTERED AND THE INCLUDE      * 05910072
059200*    EXPIRED SIZES IS SET TO A 'N'.                             * 05920072
059300*---------------------------------------------------------------* 05930072
059400                                                                  05940072
059500     EXEC SQL                                                     05950072
059600          DECLARE ALL-FLDS-NOEXP-CSR CURSOR                       05960072
059700          FOR SELECT                                              05970072
059800                KOHLS_SIZE_CDE                                    05980072
059900              , EFF_END_DTE                                       05990072
060000              , SIZE_GP_CDE                                       06000072
060100              , NRF_SIZE_CDE                                      06010072
060200              , PRIM_DESC                                         06020072
060300              , SEC_DESC                                          06030072
060400              , KOHLS_DESC                                        06040072
060500              , EXTD_SZ_CDE                                       06050072
060600          FROM                                                    06060072
060700                TSIZE                                             06070072
060800          WHERE                                                   06080072
060900                SIZE_GP_CDE    = :DK-SIZE-GP-CODE                 06090072
061000            AND NRF_SIZE_CDE  >= :DK-NRF-SIZE-CODE                06100072
061100            AND KOHLS_DESC  LIKE :DK-KOHLS-DESC                   06110072
061200            AND EFF_END_DTE   IS  NULL                            06120072
061300          ORDER BY                                                06130072
061400                NRF_SIZE_CDE                                      06140072
061500     END-EXEC.                                                    06150072
061600                                                                  06160072
061700 EJECT                                                            06170072
061800 LINKAGE SECTION.                                                 06180072
061900                                                                  06190072
062000 01  DFHCOMMAREA.                                                 06200072
062100     05  FILLER                         OCCURS  1 TO 4072 TIMES   06210072
062200                                        DEPENDING ON EIBCALEN.    06220072
062300         10  FILLER                     PIC X.                    06230072
062400                                                                  06240072
062500 EJECT                                                            06250072
062600                                                                  06260072
062700 PROCEDURE DIVISION.                                              06270072
062800                                                                  06280072
062900******************************************************************06290072
063000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06300072
063100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06310072
063200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06320072
063300******************************************************************06330072
063400 0000-MAIN-MODULE.                                                06340072
063500                                                                  06350072
063600     INITIALIZE DP030-CICS-API-FIELDS.                            06360072
063700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06370072
063800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06380072
063900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06390072
064000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06400072
064100     MOVE LENGTH OF ET353AI        TO DP030-MAP-LENGTH (1).       06410072
064200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06420072
064300                                                                  06430072
064400*    -- THE FOLLOWING IS TO HANDLE LOWER LEVEL PROGRAM'S          06440072
064500*    -- NEXT-APPL-ERROR WHEN THEY'RE NOT IN NEXT-ACT-INIT STATE   06450072
064600     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       06460072
064700                                                                  06470072
064800     PERFORM 0001-CALL-CICS-ARCH-API.                             06480072
064900*                                                                 06490072
065000     PERFORM 1000-CONTROL-PROCESSING                              06500072
065100*                                                                 06510072
065200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06520072
065300     PERFORM 0001-CALL-CICS-ARCH-API.                             06530072
065400                                                                  06540072
065500******************************************************************06550072
065600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06560072
065700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06570072
065800******************************************************************06580072
065900 0001-CALL-CICS-ARCH-API.                                         06590072
066000                                                                  06600072
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06610075
066200                                    DFHCOMMAREA                   06620075
066300                                    DP030-CICS-API-FIELDS         06630075
066400                                    DP020-STANDARD-COMMAREA       06640075
066500                                    ET353AI.                      06650075
066600*                                                                 06660072
066700     IF  DP030-RC-CALL-SUCCESSFUL OR                              06670072
066800*        -- FOR LOW LEVEL ERRORS --                               06680072
066900         DP030-RC-APPL-ERROR                                      06690072
067000         CONTINUE                                                 06700072
067100     ELSE                                                         06710072
067200         SET DP013-NO-ROLLBACK                                    06720072
067300             DP013-XCTL-DISPLAY-RESTART                           06730072
067400             DP013-CICS-ABEND      TO TRUE                        06740072
067500         MOVE '0001-CALL-CICS-ARCH-API'                           06750072
067600                                   TO DP013-PARAGRAPH             06760072
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06770075
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06780075
067900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06790072
068000         PERFORM DP013-0000-PROCESS-ABEND                         06800072
068100     END-IF.                                                      06810072
068200                                                                  06820072
068300*----------------------------------------------------------------*06830072
068400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06840072
068500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06850072
068600*                                                                *06860072
068700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06870072
068800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06880072
068900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06890072
069000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06900072
069100*----------------------------------------------------------------*06910072
069200 1000-CONTROL-PROCESSING.                                         06920072
069300                                                                  06930072
069400     EVALUATE TRUE                                                06940072
069500         WHEN DP020-NEXT-ACT-INITIAL                              06950072
069600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06960072
069700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06970072
069800                                      ASC-SEL-TERM-ID             06980072
069900             MOVE DP020-SRC-TASK-NUMBER                           06990072
070000                                   TO ASC-LIST-TASK-NUMBER        07000072
070100                                      ASC-SEL-TASK-NUMBER         07010072
070200             MOVE PC-LIST-QUEUE-SEQ                               07020072
070300                                   TO ASC-LIST-SEQ                07030072
070400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07040072
070500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07050072
070600***-----$TEMPLATE NOTE$-------------------------------------------07060072
070700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07070072
070800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07080072
070900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07090072
071000***---------------------------------------------------------------07100072
071100             IF  PS-COMMAREA-NOT-VALID                            07110072
071200***              MOVE PC-TSYMSG-99901                             07120072
071300***                                TO DP020-MSG-NUMBER            07130072
071400***              SET DP020-MSG-FATAL                              07140072
071500***                                TO TRUE                        07150072
071600                 SET DP020-NEXT-ACT-APPL-ERROR                    07160072
071700                                   TO TRUE                        07170072
071800             ELSE                                                 07180072
071900                 PERFORM 4000-BUILD-INITIAL-PANEL                 07190072
072000             END-IF                                               07200072
072100                                                                  07210072
072200         WHEN DP020-NEXT-ACT-READ-MAP                             07220072
072300             EVALUATE TRUE                                        07230072
072400                 WHEN DP030-RC-APPL-ERROR                         07240072
072500*                    -- HANDLES A DP020-NEXT-ACT-APPL-ERROR       07250072
072600*                    -- IN LOWER LEVEL PROGRAMS WHEN THEY ARE     07260072
072700*                    -- >>NOT<< IN NEXT-ACT-INITIAL LOGIC...      07270072
072800                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                07280072
072900                                   TO PV-TOP-ITEM                 07290072
073000                     MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL    07300072
073100                     PERFORM 6000-REFRESH-PANEL-FROM-TEMP         07310072
073200                     PERFORM 3200-RESET-ATTRIBUTES                07320072
073300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07330072
073400                     PERFORM 3000-EDIT-DATA-IN-COMMAREA           07340072
073500                 WHEN OTHER                                       07350072
073600                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                07360072
073700                                           TO PV-TOP-ITEM         07370072
073800                     PERFORM 2000-PROCESS-PANEL                   07380072
073900             END-EVALUATE                                         07390072
074000                                                                  07400072
074100         WHEN DP020-NEXT-ACT-RETURN                               07410072
074200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07420072
074300                                   TO PV-TOP-ITEM                 07430072
074400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07440072
074500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07450072
074600             PERFORM 3200-RESET-ATTRIBUTES                        07460072
074700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07470072
074800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07480072
074900                                                                  07490072
075000         WHEN OTHER                                               07500072
075100             SET DP013-LOGIC-ABEND TO TRUE                        07510072
075200             SET DP013-NO-ROLLBACK TO TRUE                        07520072
075300             MOVE '1000-CONTROL-PROCESSING'                       07530072
075400                                   TO DP013-PARAGRAPH             07540072
075500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07550072
075600                                   TO DP013-MESSAGE-TEXT(1)       07560072
075700             PERFORM DP013-0000-PROCESS-ABEND                     07570072
075800     END-EVALUATE.                                                07580072
075900                                                                  07590072
076000 EJECT                                                            07600072
076100*----------------------------------------------------------------*07610072
076200* MOVE THE INTER-APPLICATION COMMAREA TO THE APPLICATION         *07620072
076300* SPECIFIC COMMAREA FIELDS.                                      *07630072
076400*----------------------------------------------------------------*07640072
076500 1100-PROCESS-INTER-APPL-COMM.                                    07650072
076600                                                                  07660072
076700     SET PS-COMMAREA-VALID         TO TRUE.                       07670072
076800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07680072
076900                                                                  07690072
077000     MOVE ET351-SIZE-GP-CODE       TO PV-SIZE-GP-CODE-N.          07700072
077100     MOVE PV-SIZE-GP-CODE-N        TO ASC-KEY-SIZE-GP-CODE        07710072
077200                                      DK-SIZE-GP-CODE.            07720072
077300     MOVE ET351-SIZE-GP-DESC       TO ASC-KEY-SIZE-GP-DESC        07730072
077400                                      DK-SIZE-GP-DESC.            07740072
077500     MOVE ET351-NRF-SIZE-CODE      TO ASC-KEY-NRF-SIZE-CODE       07750072
077600                                      DK-NRF-SIZE-CODE.           07760072
077700     MOVE ET351-KOHLS-DESC         TO ASC-KEY-KOHLS-DESC          07770072
077800                                      DK-KOHLS-DESC.              07780072
077900     MOVE ET351-EXP-SIZE-IND       TO ASC-KEY-EXP-SIZE-IND        07790072
078000                                      DK-EXP-SIZE-IND.            07800072
078100                                                                  07810072
078200 EJECT                                                            07820072
078300*----------------------------------------------------------------*07830072
078400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07840072
078500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07850072
078600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07860072
078700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07870072
078800* FUNCTION KEYS CAN GET THIS FAR.                                *07880072
078900*----------------------------------------------------------------*07890072
079000 2000-PROCESS-PANEL.                                              07900072
079100                                                                  07910072
079200     EVALUATE TRUE                                                07920072
079300         WHEN DP020-SRC-AID = DP016-CLEAR                         07930072
079400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07940072
079500             PERFORM 3200-RESET-ATTRIBUTES                        07950072
079600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07960072
079700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07970072
079800                                                                  07980072
079900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07990072
080000             MOVE ASC-KEY-SIZE-GP-CODE                            08000072
080100                                   TO DK-SIZE-GP-CODE             08010072
080200             MOVE ASC-KEY-SIZE-GP-DESC                            08020072
080300                                   TO DK-SIZE-GP-DESC             08030072
080400             MOVE ASC-KEY-NRF-SIZE-CODE                           08040072
080500                                   TO DK-NRF-SIZE-CODE            08050072
080600             MOVE ASC-KEY-KOHLS-DESC                              08060072
080700                                   TO DK-KOHLS-DESC               08070072
080800             MOVE ASC-KEY-EXP-SIZE-IND                            08080072
080900                                   TO DK-EXP-SIZE-IND             08090072
081000             PERFORM 2050-DELETE-LIST-QUEUE                       08100072
081100             PERFORM 4000-BUILD-INITIAL-PANEL                     08110072
081200                                                                  08120072
081300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08130072
081400             PERFORM 2140-DESELECT-ALL-ITEMS                      08140072
081500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08150072
081600                                                                  08160072
081700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08170072
081800             PERFORM 2150-SELECT-ALL-ITEMS                        08180072
081900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08190072
082000                                                                  08200072
082100         WHEN OTHER                                               08210072
082200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08220072
082300             PERFORM 3200-RESET-ATTRIBUTES                        08230072
082400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08240072
082500             IF  PS-NO-ERROR                                      08250072
082600                 SET DP030-CONTINUE-GO                            08260072
082700                                 TO TRUE                          08270072
082800                 PERFORM 2100-CHECK-FUNCTION-KEY                  08280072
082900             ELSE                                                 08290072
083000                 SET DP030-OVERRIDE-GO                            08300072
083100                                 TO TRUE                          08310072
083200             END-IF                                               08320072
083300     END-EVALUATE.                                                08330072
083400                                                                  08340072
083500 EJECT                                                            08350072
083600*----------------------------------------------------------------*08360072
083700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08370072
083800*----------------------------------------------------------------*08380072
083900 2050-DELETE-LIST-QUEUE.                                          08390072
084000                                                                  08400072
084100     EXEC CICS                                                    08410072
084200         DELETEQ TS                                               08420072
084300             QUEUE (ASC-LIST-QUEUE-NAME)                          08430072
084400             RESP  (PV-CICS-RESP)                                 08440072
084500     END-EXEC.                                                    08450072
084600                                                                  08460072
084700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08470072
084800        (PV-CICS-RESP = DFHRESP(QIDERR))                          08480072
084900         CONTINUE                                                 08490072
085000     ELSE                                                         08500072
085100         SET DP013-CICS-ABEND      TO TRUE                        08510072
085200         SET DP013-NO-ROLLBACK     TO TRUE                        08520072
085300                                                                  08530072
085400         MOVE '2050-DELETE-LIST-QUEUE'                            08540072
085500                                   TO DP013-PARAGRAPH             08550072
085600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08560072
085700                                   TO DP013-MESSAGE-TEXT (1)      08570072
085800         PERFORM DP013-0000-PROCESS-ABEND                         08580072
085900     END-IF.                                                      08590072
086000                                                                  08600072
086100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08610072
086200                                                                  08620072
086300 EJECT                                                            08630072
086400*----------------------------------------------------------------*08640072
086500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08650072
086600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08660072
086700* CICS ARCHITECTURE API.                                         *08670072
086800*----------------------------------------------------------------*08680072
086900 2100-CHECK-FUNCTION-KEY.                                         08690072
087000                                                                  08700072
087100     EVALUATE TRUE                                                08710072
087200         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   08720072
087300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08730072
087400                 INITIALIZE ET352-INTER-APPL-COMMAREA             08740072
087500                 MOVE ASC-KEY-SIZE-GP-CODE                        08750072
087600                                TO ET352-SIZE-GP-CODE             08760072
087700                 MOVE ASC-KEY-SIZE-GP-DESC                        08770072
087800                                TO ET352-SIZE-GP-DESC             08780072
087900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08790072
088000                                TO ET352-NUMBER-OF-SELECTED-ITEMS 08800072
088100                 PERFORM 5000-PREPARE-SEL-QUEUE                   08810072
088200             ELSE                                                 08820072
088300                 SET DP030-OVERRIDE-GO                            08830072
088400                                   TO TRUE                        08840072
088500                 MOVE PC-TSYMSG-00057                             08850072
088600                                   TO DP020-MSG-NUMBER            08860072
088700                 SET DP020-MSG-WARNING                            08870072
088800                                   TO TRUE                        08880072
088900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08890072
089000             END-IF                                               08900072
089100                                                                  08910072
089200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08920072
089300             MOVE +1               TO PV-TOP-ITEM                 08930072
089400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08940072
089500                                                                  08950072
089600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08960072
089700             PERFORM 2110-BROWSE-BACKWARD                         08970072
089800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08980072
089900                                                                  08990072
090000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09000072
090100             PERFORM 2120-BROWSE-FORWARD                          09010072
090200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09020072
090300                                                                  09030072
090400         WHEN DP020-SRC-AID = DP016-ENTER                         09040072
090500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09050072
090600             IF  PS-ERROR                                         09060072
090700                 CONTINUE                                         09070072
090800             ELSE                                                 09080072
090900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09090072
091000             END-IF                                               09100072
091100                                                                  09110072
091200         WHEN OTHER                                               09120072
091300             SET DP013-NO-ROLLBACK                                09130072
091400                 DP013-XCTL-DISPLAY-RESTART                       09140072
091500                 DP013-CICS-ABEND  TO TRUE                        09150072
091600             MOVE '2100-CHECK-FUNCTION-KEY'                       09160072
091700                                   TO DP013-PARAGRAPH             09170072
091800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09180072
091900                                   TO DP013-MESSAGE-TEXT (1)      09190072
092000             PERFORM DP013-0000-PROCESS-ABEND                     09200072
092100     END-EVALUATE.                                                09210072
092200*                                                                 09220072
092300*----------------------------------------------------------------*09230072
092400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09240072
092500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09250072
092600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09260072
092700*    MESSAGE.                                                    *09270072
092800*----------------------------------------------------------------*09280072
092900 2110-BROWSE-BACKWARD.                                            09290072
093000                                                                  09300072
093100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09310072
093200         GIVING PV-TOP-ITEM.                                      09320072
093300*                                                                 09330072
093400     IF  ((PV-TOP-ITEM < +1)                                      09340072
093500       OR (PV-TOP-ITEM = +1))                                     09350072
093600         MOVE +1                   TO PV-TOP-ITEM                 09360072
093700*        -- TOP OF LIST --                                        09370072
093800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09380072
093900         SET DP020-MSG-INFORMATIONAL TO TRUE                      09390072
094000     END-IF.                                                      09400072
094100                                                                  09410072
094200 EJECT                                                            09420072
094300*----------------------------------------------------------------*09430072
094400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09440072
094500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09450072
094600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09460072
094700*----------------------------------------------------------------*09470072
094800 2120-BROWSE-FORWARD.                                             09480072
094900                                                                  09490072
095000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09500072
095100         GIVING PV-TOP-ITEM.                                      09510072
095200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09520072
095300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09530072
095400                                   TO PV-TOP-ITEM                 09540072
095500*        -- BOTTOM OF LIST --                                     09550072
095600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09560072
095700         SET DP020-MSG-INFORMATIONAL                              09570072
095800                                   TO TRUE                        09580072
095900     ELSE                                                         09590072
096000         COMPUTE PV-BOTTOM-ITEM =                                 09600072
096100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09610072
096200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09620072
096300*            -- BOTTOM OF LIST --                                 09630072
096400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09640072
096500             SET DP020-MSG-INFORMATIONAL                          09650072
096600                                   TO TRUE                        09660072
096700         END-IF                                                   09670072
096800     END-IF.                                                      09680072
096900                                                                  09690072
097000 EJECT                                                            09700072
097100*----------------------------------------------------------------*09710072
097200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09720072
097300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09730072
097400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09740072
097500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09750072
097600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09760072
097700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09770072
097800*----------------------------------------------------------------*09780072
097900 2130-CHECK-FOR-JUMP-BROWSE.                                      09790072
098000                                                                  09800072
098100     SET PS-NO-ERROR               TO TRUE.                       09810072
098200     IF (ASC-START-ITEM-REQUEST = SPACE)                          09820072
098300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09830072
098400                                   TO PV-TOP-ITEM                 09840072
098500     ELSE                                                         09850072
098600         MOVE ASC-START-ITEM-REQUEST                              09860072
098700                                   TO DP010I-UNEDITED-FIELD       09870072
098800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09880072
098900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09890072
099000         SET DP010I-NEGATIVE-NOT-ALLOWED                          09900072
099100                                   TO TRUE                        09910072
099210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09921073
099220                         USING DP010I-NUMERIC-EDIT-AREA           09922073
099300                                                                  09930072
099400         IF  NOT DP010I-ERROR-DETECTED                            09940072
099500             MOVE DP010I-NUMERIC-FIELD                            09950072
099600                                   TO  ASC-START-ITEM-REQUEST-N   09960072
099700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09970072
099800                 IF  ASC-START-ITEM-REQUEST-N >                   09980072
099900                                          ASC-NUMBER-OF-ITEMS-READ09990072
100000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10000072
100100                     COMPUTE PV-TOP-ITEM =                        10010072
100200                             ASC-NUMBER-OF-ITEMS-READ             10020072
100300                             - PC-ITEMS-PER-PANEL + 1             10030072
100400                     IF  PV-TOP-ITEM < +1                         10040072
100500                         MOVE +1   TO PV-TOP-ITEM                 10050072
100600                         MOVE PC-TSYMSG-00070                     10060072
100700                                   TO DP020-MSG-NUMBER            10070072
100800                         SET DP020-MSG-INFORMATIONAL              10080072
100900                                   TO TRUE                        10090072
101000                     END-IF                                       10100072
101100                 ELSE                                             10110072
101200                     MOVE ASC-START-ITEM-REQUEST-N                10120072
101300                                   TO PV-TOP-ITEM                 10130072
101400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10140072
101500                     COMPUTE PV-BOTTOM-ITEM =                     10150072
101600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10160072
101700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10170072
101800*                        -- BOTTOM OF LIST --                     10180072
101900                         MOVE PC-TSYMSG-00070                     10190072
102000                                   TO DP020-MSG-NUMBER            10200072
102100                         SET DP020-MSG-INFORMATIONAL              10210072
102200                                   TO TRUE                        10220072
102300                     END-IF                                       10230072
102400                 END-IF                                           10240072
102500             ELSE                                                 10250072
102600*                --- VALUE OUT OF RANGE ----                      10260072
102700                 MOVE PC-TSYMSG-00101                             10270072
102800                                   TO DP020-MSG-NUMBER            10280072
102900                 MOVE -1           TO ASTRTITL                    10290072
103000                 SET DP030-SET-CURSOR-APPL-1                      10300072
103100                                   TO TRUE                        10310072
103200                 MOVE DP015-REVERSE                               10320072
103300                                   TO ASTRTITH                    10330072
103400                 MOVE DP015-RED    TO ASTRTITC                    10340072
103500                 MOVE DP015-UNP-NUM-BRT-MDT                       10350072
103600                                   TO ASTRTITA                    10360072
103700                 SET DP020-MSG-FATAL                              10370072
103800                                   TO TRUE                        10380072
103900                 SET PS-ERROR      TO TRUE                        10390072
104000             END-IF                                               10400072
104100                                                                  10410072
104200         ELSE                                                     10420072
104300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10430072
104400             MOVE -1               TO ASTRTITL                    10440072
104500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10450072
104600             MOVE DP015-REVERSE    TO ASTRTITH                    10460072
104700             MOVE DP015-RED        TO ASTRTITC                    10470072
104800             MOVE DP015-UNP-NUM-BRT-MDT                           10480072
104900                                   TO ASTRTITA                    10490072
105000             SET DP020-MSG-FATAL   TO TRUE                        10500072
105100             SET PS-ERROR          TO TRUE                        10510072
105200         END-IF                                                   10520072
105300     END-IF.                                                      10530072
105400                                                                  10540072
105500 EJECT                                                            10550072
105600*----------------------------------------------------------------*10560072
105700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10570072
105800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10580072
105900*----------------------------------------------------------------*10590072
106000 2140-DESELECT-ALL-ITEMS.                                         10600072
106100                                                                  10610072
106200     MOVE +1                       TO ASC-BLK-SUB.                10620072
106300                                                                  10630072
106400     PERFORM 2141-CLEAR-SELECTED-INDS                             10640072
106500         VARYING ASC-ITEM-SUB                                     10650072
106600         FROM 1 BY 1                                              10660072
106700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10670072
106800                                                                  10680072
106900     ADD +1                        TO ASC-BLK-SUB.                10690072
107000                                                                  10700072
107100     PERFORM 2141-CLEAR-SELECTED-INDS                             10710072
107200         VARYING ASC-ITEM-SUB                                     10720072
107300         FROM 1 BY 1                                              10730072
107400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10740072
107500                                                                  10750072
107600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10760072
107700                                   TO PV-LIST-ITEM-NUMBER.        10770072
107800                                                                  10780072
107900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10790072
108000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10800072
108100                                                                  10810072
108200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10820072
108300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10830072
108400         MOVE +1                   TO ASC-BLK-SUB                 10840072
108500                                                                  10850072
108600         PERFORM 5100-WRITE-TEMP-STORAGE                          10860072
108700                                                                  10870072
108800         MOVE +1                   TO PV-BLOCK-NUMBER             10880072
108900                                                                  10890072
109000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10900072
109100             PV-FIRST-BLOCK-IN-ARRAY - 1                          10910072
109200                                                                  10920072
109300         PERFORM                                                  10930072
109400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10940072
109500                                                                  10950072
109600             PERFORM 4410-READ-TEMP-STORAGE                       10960072
109700                                                                  10970072
109800             PERFORM 2141-CLEAR-SELECTED-INDS                     10980072
109900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10990072
110000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11000072
110100                                                                  11010072
110200             PERFORM 5100-WRITE-TEMP-STORAGE                      11020072
110300                                                                  11030072
110400             ADD +1                TO PV-BLOCK-NUMBER             11040072
110500                                                                  11050072
110600         END-PERFORM                                              11060072
110700                                                                  11070072
110800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11080072
110900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11090072
111000                                                                  11100072
111100         PERFORM                                                  11110072
111200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11120072
111300                   ASC-HIGHEST-BLOCK-WRITTEN                      11130072
111400                                                                  11140072
111500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11150072
111600                                   TO PV-BLOCK-NUMBER             11160072
111700                                                                  11170072
111800             PERFORM 4410-READ-TEMP-STORAGE                       11180072
111900                                                                  11190072
112000             PERFORM 2141-CLEAR-SELECTED-INDS                     11200072
112100                 VARYING ASC-ITEM-SUB                             11210072
112200                 FROM 1 BY 1                                      11220072
112300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11230072
112400                                                                  11240072
112500             PERFORM 5100-WRITE-TEMP-STORAGE                      11250072
112600                                                                  11260072
112700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11270072
112800                                                                  11280072
112900         END-PERFORM                                              11290072
113000                                                                  11300072
113100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11310072
113200                                   TO PV-BLOCK-NUMBER             11320072
113300                                                                  11330072
113400         PERFORM 4410-READ-TEMP-STORAGE                           11340072
113500     END-IF.                                                      11350072
113600                                                                  11360072
113700                                                                  11370072
113800     MOVE +0      TO ASC-NUMBER-OF-SELECTED-ITEMS.                11380072
113900     MOVE +0      TO ASC-START-OF-SELECTED-RANGE.                 11390072
114000     MOVE +0      TO ASC-END-OF-SELECTED-RANGE.                   11400072
114100                                                                  11410072
114200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11420072
114300                                                                  11430072
114400 EJECT                                                            11440072
114500*----------------------------------------------------------------*11450072
114600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11460072
114700*----------------------------------------------------------------*11470072
114800 2141-CLEAR-SELECTED-INDS.                                        11480072
114900                                                                  11490072
115000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11500072
115100             NOT EQUAL ZERO                                       11510072
115200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11520072
115300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11530072
115400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11540072
115500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11550072
115600                                   TO TRUE                        11560072
115700         END-IF                                                   11570072
115800     END-IF.                                                      11580072
115900                                                                  11590072
116000 EJECT                                                            11600072
116100*----------------------------------------------------------------*11610072
116200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11620072
116300*  FOR ALL ITEMS.                                                *11630072
116400*----------------------------------------------------------------*11640072
116500 2150-SELECT-ALL-ITEMS.                                           11650072
116600                                                                  11660072
116700     MOVE +1                       TO ASC-BLK-SUB.                11670072
116800                                                                  11680072
116900     PERFORM 2151-SET-SELECTED-INDS                               11690072
117000         VARYING ASC-ITEM-SUB                                     11700072
117100         FROM 1 BY 1                                              11710072
117200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11720072
117300                                                                  11730072
117400     ADD +1                        TO ASC-BLK-SUB.                11740072
117500                                                                  11750072
117600     PERFORM 2151-SET-SELECTED-INDS                               11760072
117700         VARYING ASC-ITEM-SUB                                     11770072
117800         FROM 1 BY 1                                              11780072
117900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11790072
118000                                                                  11800072
118100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11810072
118200                                   TO PV-LIST-ITEM-NUMBER.        11820072
118300                                                                  11830072
118400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11840072
118500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11850072
118600                                                                  11860072
118700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11870072
118800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11880072
118900         MOVE +1                   TO ASC-BLK-SUB                 11890072
119000                                                                  11900072
119100         PERFORM 5100-WRITE-TEMP-STORAGE                          11910072
119200                                                                  11920072
119300         MOVE +1                   TO PV-BLOCK-NUMBER             11930072
119400                                                                  11940072
119500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11950072
119600             PV-FIRST-BLOCK-IN-ARRAY - 1                          11960072
119700                                                                  11970072
119800         PERFORM                                                  11980072
119900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11990072
120000                                                                  12000072
120100             PERFORM 4410-READ-TEMP-STORAGE                       12010072
120200                                                                  12020072
120300             PERFORM 2151-SET-SELECTED-INDS                       12030072
120400                 VARYING ASC-ITEM-SUB                             12040072
120500                 FROM 1 BY 1                                      12050072
120600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12060072
120700                                                                  12070072
120800             PERFORM 5100-WRITE-TEMP-STORAGE                      12080072
120900                                                                  12090072
121000             ADD +1                TO PV-BLOCK-NUMBER             12100072
121100                                                                  12110072
121200         END-PERFORM                                              12120072
121300                                                                  12130072
121400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12140072
121500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12150072
121600                                                                  12160072
121700         PERFORM                                                  12170072
121800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12180072
121900                   ASC-HIGHEST-BLOCK-WRITTEN                      12190072
122000                                                                  12200072
122100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12210072
122200                                   TO PV-BLOCK-NUMBER             12220072
122300                                                                  12230072
122400             PERFORM 4410-READ-TEMP-STORAGE                       12240072
122500                                                                  12250072
122600             PERFORM 2151-SET-SELECTED-INDS                       12260072
122700                 VARYING ASC-ITEM-SUB                             12270072
122800                 FROM 1 BY 1                                      12280072
122900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12290072
123000                                                                  12300072
123100             PERFORM 5100-WRITE-TEMP-STORAGE                      12310072
123200                                                                  12320072
123300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12330072
123400                                                                  12340072
123500         END-PERFORM                                              12350072
123600                                                                  12360072
123700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12370072
123800                                   TO PV-BLOCK-NUMBER             12380072
123900                                                                  12390072
124000         PERFORM 4410-READ-TEMP-STORAGE                           12400072
124100     END-IF.                                                      12410072
124200                                                                  12420072
124300                                                                  12430072
124400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12440072
124500                       ASC-NUMBER-OF-SELECTED-ITEMS.              12450072
124600                                                                  12460072
124700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12470072
124800                                                                  12480072
124900 EJECT                                                            12490072
125000*----------------------------------------------------------------*12500072
125100*    MARK EACH ITEM AS BEING SELECTED.                           *12510072
125200*----------------------------------------------------------------*12520072
125300 2151-SET-SELECTED-INDS.                                          12530072
125400                                                                  12540072
125500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12550072
125600             NOT EQUAL ZERO                                       12560072
125700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12570072
125800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12580072
125900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12590072
126000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12600072
126100                               TO  TRUE                           12610072
126200         END-IF                                                   12620072
126300     END-IF.                                                      12630072
126400                                                                  12640072
126500******************************************************************12650072
126600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12660072
126700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12670072
126800******************************************************************12680072
126900 2200-MOVE-SCREEN-TO-COMMAREA.                                    12690072
127000                                                                  12700072
127100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12710072
127200     MOVE +1                       TO PV-SUB.                     12720072
127300*                                                                 12730072
127400     PERFORM 3100-SET-SUBSCRIPTS.                                 12740072
127500     IF  ASTRTITL > ZERO                                          12750072
127600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12760072
127700     ELSE                                                         12770072
127800         IF  ASTRTITF = DP015-ERASE-EOF                           12780072
127900             INITIALIZE ASC-START-ITEM-REQUEST                    12790072
128000         END-IF                                                   12800072
128100     END-IF.                                                      12810072
128200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12820072
128300         VARYING PV-SUB                                           12830072
128400         FROM 1 BY 1                                              12840072
128500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12850072
128600                                                                  12860072
128700******************************************************************12870072
128800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12880072
128900******************************************************************12890072
129000 2210-MOVE-LINES-TO-COMMAREA.                                     12900072
129100                                                                  12910072
129200     IF  MR-SELECTL (PV-SUB) > ZERO                               12920072
129300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12930072
129400         MOVE MR-SELECT (PV-SUB)                                  12940072
129500                                   TO ASC-TEMP-SELECTED-SW        12950072
129600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12960072
129700     ELSE                                                         12970072
129800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12980072
129900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12990072
130000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13000072
130100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13010072
130200         END-IF                                                   13020072
130300     END-IF.                                                      13030072
130400     ADD +1                        TO ASC-ITEM-SUB.               13040072
130500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13050072
130600         ADD +1                    TO ASC-BLK-SUB                 13060072
130700         MOVE +1                   TO ASC-ITEM-SUB                13070072
130800     END-IF.                                                      13080072
130900                                                                  13090072
131000******************************************************************13100072
131100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13110072
131200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13120072
131300******************************************************************13130072
131400 3000-EDIT-DATA-IN-COMMAREA.                                      13140072
131500                                                                  13150072
131600     SET PS-NO-ERROR               TO TRUE.                       13160072
131700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13170072
131800**                                                                13180072
131900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13190072
132000* EDITTING IS DONE FROM THE BOTTOM UP.                            13200072
132100**                                                                13210072
132200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13220072
132300         ASC-ITEMS-DISPLAYED - 1.                                 13230072
132400     PERFORM 3100-SET-SUBSCRIPTS.                                 13240072
132500     PERFORM 3300-EDIT-SELECTIONS                                 13250072
132600         VARYING PV-SUB                                           13260072
132700         FROM PV-SUB BY -1                                        13270072
132800         UNTIL PV-SUB < +1                                        13280072
132900*                                                                 13290072
133000     IF  PS-NO-ERROR                                              13300072
133100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13310072
133200     END-IF.                                                      13320072
133300*                                                                 13330072
133400     IF  ((PS-NO-ERROR)                                           13340072
133500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13350072
133600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13360072
133700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13370072
133800     END-IF.                                                      13380072
133900                                                                  13390072
134000 EJECT                                                            13400072
134100*----------------------------------------------------------------*13410072
134200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13420072
134300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13430072
134400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13440072
134500*                                                                *13450072
134600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13460072
134700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13470072
134800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13480072
134900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13490072
135000*----------------------------------------------------------------*13500072
135100 3100-SET-SUBSCRIPTS.                                             13510072
135200                                                                  13520072
135300     COMPUTE ASC-ITEM-SUB =                                       13530072
135400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13540072
135500                                                                  13550072
135600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13560072
135700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13570072
135800                                                                  13580072
135900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13590072
136000     ELSE                                                         13600072
136100         MOVE +1                     TO ASC-BLK-SUB               13610072
136200     END-IF.                                                      13620072
136300                                                                  13630072
136400******************************************************************13640072
136500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13650072
136600******************************************************************13660072
136700 3200-RESET-ATTRIBUTES.                                           13670072
136800                                                                  13680072
136900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13690072
137000     MOVE DP015-GREEN              TO ASTRTITC.                   13700072
137100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13710072
137200*                                                                 13720072
137300     PERFORM                                                      13730072
137400         VARYING PV-SUB                                           13740072
137500         FROM 1 BY 1                                              13750072
137600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13760072
137700         MOVE DP015-UNP-ALP-NOR-OFF                               13770072
137800                                   TO MR-SELECTA (PV-SUB)         13780072
137900         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13790072
138000         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13800072
138100     END-PERFORM.                                                 13810072
138200                                                                  13820072
138300******************************************************************13830072
138400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13840072
138500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13850072
138600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13860072
138700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13870072
138800******************************************************************13880072
138900 3300-EDIT-SELECTIONS.                                            13890072
139000                                                                  13900072
139100     EVALUATE TRUE                                                13910072
139200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13920072
139300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13930072
139400                 CONTINUE                                         13940072
139500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13950072
139600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13960072
139700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13970072
139800                 MOVE ASC-TEMP-SELECTED-SW                        13980072
139900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13990072
140000                                TO ASC-SELECTED-SW                14000072
140100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14010072
140200             END-IF                                               14020072
140300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14030072
140400                 = SPACE                                          14040072
140500             EVALUATE TRUE                                        14050072
140600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14060072
140700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14070072
140800                     MOVE SPACE TO ASC-SELECTED-SW                14080072
140900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14090072
141000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14100072
141100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14110072
141200                     MOVE SPACE TO ASC-SELECTED-SW                14120072
141300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14130072
141400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14140072
141500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14150072
141600                     MOVE SPACE TO ASC-SELECTED-SW                14160072
141700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14170072
141800             END-EVALUATE                                         14180072
141900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14190072
142000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14200072
142100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14210072
142200             END-IF                                               14220072
142300             PERFORM 3310-EDIT-RANGE                              14230072
142400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14240072
142500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14250072
142600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14260072
142700             END-IF                                               14270072
142800             PERFORM 3310-EDIT-RANGE                              14280072
142900         WHEN OTHER                                               14290072
143000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14300072
143100             SET DP020-MSG-FATAL    TO TRUE                       14310072
143200             MOVE -1                TO MR-SELECTL (PV-SUB)        14320072
143300             SET DP030-SET-CURSOR-APPL-1                          14330072
143400                                    TO TRUE                       14340072
143500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14350072
143600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14360072
143700             SET PS-ERROR TO TRUE                                 14370072
143800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14380072
143900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14390072
144000                 MOVE SPACE         TO ASC-SELECTED-SW            14400072
144100                                        (ASC-BLK-SUB ASC-ITEM-SUB)14410072
144200             END-IF                                               14420072
144300     END-EVALUATE.                                                14430072
144400                                                                  14440072
144500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14450072
144600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14460072
144700     IF  ASC-ITEM-SUB < 1                                         14470072
144800         SUBTRACT +1 FROM ASC-BLK-SUB                             14480072
144900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14490072
145000     END-IF.                                                      14500072
145100******************************************************************14510072
145200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14520072
145300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14530072
145400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14540072
145500** THE ENDING.                                                  **14550072
145600******************************************************************14560072
145700 3310-EDIT-RANGE.                                                 14570072
145800                                                                  14580072
145900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14590072
146000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14600072
146100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14610072
146200                                   TO ASC-SELECTED-SW             14620072
146300                                        (ASC-BLK-SUB ASC-ITEM-SUB)14630072
146400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14640072
146500         ELSE                                                     14650072
146600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14660072
146700                 CONTINUE                                         14670072
146800             ELSE                                                 14680072
146900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14690072
147000                 MOVE PC-TSYMSG-00054                             14700072
147100                                   TO DP020-MSG-NUMBER            14710072
147200                 SET DP020-MSG-FATAL                              14720072
147300                                   TO TRUE                        14730072
147400                 MOVE -1           TO MR-SELECTL (PV-SUB)         14740072
147500                 SET DP030-SET-CURSOR-APPL-1                      14750072
147600                                   TO TRUE                        14760072
147700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14770072
147800                 MOVE DP015-UNDERLINE                             14780072
147900                                   TO MR-SELECTH (PV-SUB)         14790072
148000                 SET PS-ERROR      TO TRUE                        14800072
148100             END-IF                                               14810072
148200         END-IF                                                   14820072
148300     ELSE                                                         14830072
148400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14840072
148500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14850072
148600                                   TO ASC-SELECTED-SW             14860072
148700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14870072
148800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14880072
148900         ELSE                                                     14890072
149000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14900072
149100                 CONTINUE                                         14910072
149200             ELSE                                                 14920072
149300*                -- ONLY ONE END-OF-RANGE ALLOWED --              14930072
149400                 MOVE PC-TSYMSG-00055                             14940072
149500                                   TO DP020-MSG-NUMBER            14950072
149600                 SET DP020-MSG-FATAL                              14960072
149700                                   TO TRUE                        14970072
149800                 MOVE -1           TO MR-SELECTL (PV-SUB)         14980072
149900                 SET DP030-SET-CURSOR-APPL-1                      14990072
150000                                   TO TRUE                        15000072
150100                 SET PS-ERROR      TO TRUE                        15010072
150200             END-IF                                               15020072
150300         END-IF                                                   15030072
150400     END-IF.                                                      15040072
150500                                                                  15050072
150600******************************************************************15060072
150700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15070072
150800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15080072
150900******************************************************************15090072
151000 3400-CHECK-RANGE-SEQUENCE.                                       15100072
151100                                                                  15110072
151200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15120072
151300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15130072
151400       AND  ASC-START-OF-SELECTED-RANGE >                         15140072
151500                                         ASC-END-OF-SELECTED-RANGE15150072
151600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15160072
151700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15170072
151800         SET DP020-MSG-FATAL TO TRUE                              15180072
151900         SET PS-ERROR TO TRUE                                     15190072
152000         PERFORM 3410-POSITION-AT-ERROR                           15200072
152100     END-IF.                                                      15210072
152200                                                                  15220072
152300******************************************************************15230072
152400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15240072
152500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15250072
152600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15260072
152700******************************************************************15270072
152800 3410-POSITION-AT-ERROR.                                          15280072
152900                                                                  15290072
153000     SET DP030-SET-CURSOR-APPL-1                                  15300072
153100                                   TO TRUE.                       15310072
153200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15320072
153300                    - PV-TOP-ITEM + 1.                            15330072
153400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15340072
153500         CONTINUE                                                 15350072
153600     ELSE                                                         15360072
153700         MOVE -1                   TO MR-SELECTL (PV-SUB)         15370072
153800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15380072
153900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15390072
154000     END-IF.                                                      15400072
154100*                                                                 15410072
154200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15420072
154300                    - PV-TOP-ITEM + 1.                            15430072
154400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15440072
154500         CONTINUE                                                 15450072
154600     ELSE                                                         15460072
154700         MOVE -1                   TO MR-SELECTL (PV-SUB)         15470072
154800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15480072
154900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15490072
155000     END-IF.                                                      15500072
155100                                                                  15510072
155200 EJECT                                                            15520072
155300*----------------------------------------------------------------*15530072
155400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15540072
155500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15550072
155600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15560072
155700*----------------------------------------------------------------*15570072
155800 3500-MARK-RANGE-AS-SELECTED.                                     15580072
155900                                                                  15590072
156000     MOVE +1                       TO  ASC-BLK-SUB.               15600072
156100     PERFORM 3510-MARK-SELECTED-INDS                              15610072
156200         VARYING ASC-ITEM-SUB                                     15620072
156300         FROM 1 BY 1                                              15630072
156400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15640072
156500                                                                  15650072
156600     ADD +1                        TO ASC-BLK-SUB.                15660072
156700     PERFORM 3510-MARK-SELECTED-INDS                              15670072
156800         VARYING ASC-ITEM-SUB                                     15680072
156900         FROM 1 BY 1                                              15690072
157000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15700072
157100                                                                  15710072
157200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15720072
157300                                   TO  PV-LIST-ITEM-NUMBER.       15730072
157400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15740072
157500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15750072
157600               PC-ITEMS-PER-PANEL).                               15760072
157700                                                                  15770072
157800     MOVE ASC-START-OF-SELECTED-RANGE                             15780072
157900                                   TO PV-START-OF-SELECTED-RANGE. 15790072
158000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15800072
158100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15810072
158200               PC-ITEMS-PER-PANEL).                               15820072
158300                                                                  15830072
158400     MOVE ASC-END-OF-SELECTED-RANGE                               15840072
158500                                   TO  PV-END-OF-SELECTED-RANGE.  15850072
158600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15860072
158700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15870072
158800               PC-ITEMS-PER-PANEL).                               15880072
158900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15890072
159000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15900072
159100                                                                  15910072
159200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15920072
159300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15930072
159400         MOVE +1                   TO ASC-BLK-SUB                 15940072
159500         PERFORM 5100-WRITE-TEMP-STORAGE                          15950072
159600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15960072
159700             PV-FIRST-BLOCK-IN-ARRAY - 1                          15970072
159800                                                                  15980072
159900         PERFORM                                                  15990072
160000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16000072
160100                   PV-PREV-BLOCK-IN-ARRAY                         16010072
160200             MOVE PV-FIRST-BLOCK-IN-RANGE                         16020072
160300                                   TO PV-BLOCK-NUMBER             16030072
160400             PERFORM 4410-READ-TEMP-STORAGE                       16040072
160500             PERFORM 3510-MARK-SELECTED-INDS                      16050072
160600                 VARYING ASC-ITEM-SUB                             16060072
160700                 FROM 1 BY 1                                      16070072
160800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16080072
160900             PERFORM 5100-WRITE-TEMP-STORAGE                      16090072
161000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16100072
161100         END-PERFORM                                              16110072
161200                                                                  16120072
161300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16130072
161400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16140072
161500         PERFORM                                                  16150072
161600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16160072
161700                   PV-LAST-BLOCK-IN-RANGE                         16170072
161800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16180072
161900                                   TO PV-BLOCK-NUMBER             16190072
162000             PERFORM 4410-READ-TEMP-STORAGE                       16200072
162100             PERFORM 3510-MARK-SELECTED-INDS                      16210072
162200                 VARYING ASC-ITEM-SUB                             16220072
162300                 FROM 1 BY 1                                      16230072
162400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16240072
162500             PERFORM 5100-WRITE-TEMP-STORAGE                      16250072
162600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16260072
162700         END-PERFORM                                              16270072
162800                                                                  16280072
162900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16290072
163000                                   TO PV-BLOCK-NUMBER             16300072
163100         PERFORM 4410-READ-TEMP-STORAGE                           16310072
163200     END-IF.                                                      16320072
163300                                                                  16330072
163400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16340072
163500                                      ASC-END-OF-SELECTED-RANGE.  16350072
163600                                                                  16360072
163700 EJECT                                                            16370072
163800*----------------------------------------------------------------*16380072
163900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16390072
164000*----------------------------------------------------------------*16400072
164100 3510-MARK-SELECTED-INDS.                                         16410072
164200                                                                  16420072
164300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16430072
164400                                ASC-ITEM-SUB) >                   16440072
164500         ASC-START-OF-SELECTED-RANGE)                             16450072
164600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16460072
164700                                ASC-ITEM-SUB) =                   16470072
164800         ASC-START-OF-SELECTED-RANGE)                             16480072
164900                                                                  16490072
165000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16500072
165100                                    ASC-ITEM-SUB) <               16510072
165200             ASC-END-OF-SELECTED-RANGE)                           16520072
165300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16530072
165400                                    ASC-ITEM-SUB) =               16540072
165500             ASC-END-OF-SELECTED-RANGE)                           16550072
165600                                                                  16560072
165700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16570072
165800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16580072
165900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16590072
166000                               TO TRUE                            16600072
166100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16610072
166200                               TO TRUE                            16620072
166300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16630072
166400             END-IF                                               16640072
166500         END-IF                                                   16650072
166600     END-IF.                                                      16660072
166700                                                                  16670072
166800 EJECT                                                            16680072
166900*----------------------------------------------------------------*16690072
167000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16700072
167100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16710072
167200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16720072
167300*    DISPLAY THE PANEL TO USER.                                  *16730072
167400*----------------------------------------------------------------*16740072
167500 4000-BUILD-INITIAL-PANEL.                                        16750072
167600                                                                  16760072
167700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16770072
167800                                 ASC-BLOCK-ENTRIES (2).           16780072
167900                                                                  16790072
168000     MOVE +1                  TO ASC-BLK-SUB.                     16800072
168100     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            16810072
168200                                                                  16820072
168300     MOVE +0                  TO ASC-ITEM-SUB                     16830072
168400                                 ASC-NUMBER-OF-ITEMS-READ         16840072
168500                                 ASC-NUMBER-OF-SELECTED-ITEMS     16850072
168600                                 ASC-HIGHEST-BLOCK-WRITTEN        16860072
168700                                 ASC-START-OF-SELECTED-RANGE      16870072
168800                                 ASC-END-OF-SELECTED-RANGE        16880072
168900                                 ASC-ITEM-AT-TOP-OF-PANEL.        16890072
169000                                                                  16900072
169100     PERFORM 4100-PREPARE-CURSOR                                  16910072
169200                                                                  16920072
169300     PERFORM 4010-OPEN-CURSOR.                                    16930072
169400                                                                  16940072
169500     PERFORM 4300-READ-ITEMS-FROM-DB.                             16950072
169600                                                                  16960072
169700     PERFORM 4020-CLOSE-CURSOR.                                   16970072
169800                                                                  16980072
169900     MOVE +1                   TO  PV-TOP-ITEM.                   16990072
170000                                                                  17000072
170100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17010072
170200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17020072
170300         SET DP020-MSG-FATAL   TO  TRUE                           17030072
170400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17040072
170500     ELSE                                                         17050072
170600         MOVE -1               TO MR-SELECTL (1)                  17060072
170700         SET DP030-SET-CURSOR-APPL-1                              17070072
170800                               TO TRUE                            17080072
170900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17090072
171000     END-IF.                                                      17100072
171100                                                                  17110072
171200 EJECT                                                            17120072
171300*----------------------------------------------------------------*17130072
171400*   OPEN THE APPROPRIATE SIZE CURSOR.                            *17140072
171500*   IN THIS PARTICULAR APPLICATION ONE OF 8 DIFFERENT CURSORS    *17150072
171600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17160072
171700*   USER.                                                        *17170072
171800*----------------------------------------------------------------*17180072
171900 4010-OPEN-CURSOR.                                                17190072
172000                                                                  17200072
172100     PERFORM                                                      17210072
172200         WITH TEST AFTER                                          17220072
172300         VARYING PV-RETRY-COUNTER                                 17230072
172400         FROM 1 BY 1                                              17240072
172500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17250072
172600                   OR (SQLCODE = ZERO))                           17260072
172700         EVALUATE TRUE                                            17270072
172800             WHEN ASC-SGC-ALL-CSR                                 17280072
172900                 MOVE 'CURSOR:  SGC-ALL-CSR'                      17290072
173000                                   TO DP013-MESSAGE-TEXT (2)      17300072
173100                 EXEC SQL                                         17310072
173200                      OPEN SGC-ALL-CSR                            17320072
173300                 END-EXEC                                         17330072
173400                                                                  17340072
173500             WHEN ASC-SGC-NOEXP-CSR                               17350072
173600                 MOVE 'CURSOR:  SGC-NOEXP-CSR'                    17360072
173700                                   TO DP013-MESSAGE-TEXT (2)      17370072
173800                 EXEC SQL                                         17380072
173900                      OPEN SGC-NOEXP-CSR                          17390072
174000                 END-EXEC                                         17400072
174100                                                                  17410072
174200             WHEN ASC-SGC-NRF-ALL-CSR                             17420072
174300                 MOVE 'CURSOR:  SGC-NRF-ALL-CSR'                  17430072
174400                                   TO DP013-MESSAGE-TEXT (2)      17440072
174500                 EXEC SQL                                         17450072
174600                      OPEN SGC-NRF-ALL-CSR                        17460072
174700                 END-EXEC                                         17470072
174800                                                                  17480072
174900             WHEN ASC-SGC-NRF-NOEXP-CSR                           17490072
175000                 MOVE 'CURSOR:  SGC-NRF-NOEXP-CSR'                17500072
175100                                   TO DP013-MESSAGE-TEXT (2)      17510072
175200                 EXEC SQL                                         17520072
175300                      OPEN SGC-NRF-NOEXP-CSR                      17530072
175400                 END-EXEC                                         17540072
175500                                                                  17550072
175600             WHEN ASC-SGC-KDSC-ALL-CSR                            17560072
175700                 MOVE 'CURSOR:  SGC-KDSC-ALL-CSR'                 17570072
175800                                   TO DP013-MESSAGE-TEXT (2)      17580072
175900                 EXEC SQL                                         17590072
176000                      OPEN SGC-KDSC-ALL-CSR                       17600072
176100                 END-EXEC                                         17610072
176200                                                                  17620072
176300             WHEN ASC-SGC-KDSC-NOEXP-CSR                          17630072
176400                 MOVE 'CURSOR:  SGC-KDSC-NOEXP-CSR'               17640072
176500                                   TO DP013-MESSAGE-TEXT (2)      17650072
176600                 EXEC SQL                                         17660072
176700                      OPEN SGC-KDSC-NOEXP-CSR                     17670072
176800                 END-EXEC                                         17680072
176900                                                                  17690072
177000             WHEN ASC-ALL-FLDS-ALL-CSR                            17700072
177100                 MOVE 'CURSOR:  ALL-FLDS-ALL-CSR'                 17710072
177200                                   TO DP013-MESSAGE-TEXT (2)      17720072
177300                 EXEC SQL                                         17730072
177400                      OPEN ALL-FLDS-ALL-CSR                       17740072
177500                 END-EXEC                                         17750072
177600                                                                  17760072
177700             WHEN ASC-ALL-FLDS-NOEXP-CSR                          17770072
177800                 MOVE 'CURSOR:  ALL-FLDS-NOEXP-CSR'               17780072
177900                                   TO DP013-MESSAGE-TEXT (2)      17790072
178000                 EXEC SQL                                         17800072
178100                      OPEN ALL-FLDS-NOEXP-CSR                     17810072
178200                 END-EXEC                                         17820072
178300         END-EVALUATE                                             17830072
178400                                                                  17840072
178500         EVALUATE TRUE                                            17850072
178600             WHEN SQLCODE = ZERO                                  17860072
178700             WHEN SQLCODE = -904                                  17870072
178800             WHEN SQLCODE = -913                                  17880072
178900                 CONTINUE                                         17890072
179000             WHEN SQLWARN0 NOT = SPACES                           17900072
179100             WHEN SQLCODE < ZERO                                  17910072
179200             WHEN SQLCODE > ZERO                                  17920072
179300                 MOVE '4010-OPEN-CURSOR'                          17930072
179400                                   TO DP013-PARAGRAPH             17940072
179500                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             17950072
179600                                   TO DP013-MESSAGE-TEXT (1)      17960072
179700                 MOVE SQLCA        TO DP013-SQLCA                 17970072
179800                 MOVE 'TSIZE   '   TO DP013-DB2-TABLE-NAME (1)    17980072
179900                 SET DP013-DB2-ABEND                              17990072
180000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18000072
180100                 PERFORM DP013-0000-PROCESS-ABEND                 18010072
180200         END-EVALUATE                                             18020072
180300     END-PERFORM.                                                 18030072
180400*                                                                 18040072
180500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18050072
180600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18060072
180700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18070072
180800                                   TO DP013-MESSAGE-TEXT (1)      18080072
180900         MOVE SQLCA                TO DP013-SQLCA                 18090072
181000         MOVE 'TSIZE   '           TO DP013-DB2-TABLE-NAME (1)    18100072
181100         SET DP013-DB2-ABEND                                      18110072
181200             DP013-XCTL-DISPLAY-RESTART                           18120072
181300                                   TO TRUE                        18130072
181400         PERFORM DP013-0000-PROCESS-ABEND                         18140072
181500     END-IF.                                                      18150072
181600                                                                  18160072
181700 EJECT                                                            18170072
181800*----------------------------------------------------------------*18180072
181900*   CLOSE THE APPROPRIATE SIZE CURSOR.                           *18190072
182000*   IN THIS PARTICULAR APPLICATION ONE OF 8 DIFFERENT CURSORS    *18200072
182100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18210072
182200*   USER.                                                        *18220072
182300*----------------------------------------------------------------*18230072
182400 4020-CLOSE-CURSOR.                                               18240072
182500                                                                  18250072
182600     EVALUATE TRUE                                                18260072
182700         WHEN ASC-SGC-ALL-CSR                                     18270072
182800             EXEC SQL                                             18280072
182900                 CLOSE SGC-ALL-CSR                                18290072
183000             END-EXEC                                             18300072
183100                                                                  18310072
183200         WHEN ASC-SGC-NOEXP-CSR                                   18320072
183300             EXEC SQL                                             18330072
183400                 CLOSE SGC-NOEXP-CSR                              18340072
183500             END-EXEC                                             18350072
183600                                                                  18360072
183700         WHEN ASC-SGC-NRF-ALL-CSR                                 18370072
183800             EXEC SQL                                             18380072
183900                 CLOSE SGC-NRF-ALL-CSR                            18390072
184000             END-EXEC                                             18400072
184100                                                                  18410072
184200         WHEN ASC-SGC-NRF-NOEXP-CSR                               18420072
184300             EXEC SQL                                             18430072
184400                 CLOSE SGC-NRF-NOEXP-CSR                          18440072
184500             END-EXEC                                             18450072
184600                                                                  18460072
184700         WHEN ASC-SGC-KDSC-ALL-CSR                                18470072
184800             EXEC SQL                                             18480072
184900                 CLOSE SGC-KDSC-ALL-CSR                           18490072
185000             END-EXEC                                             18500072
185100                                                                  18510072
185200         WHEN ASC-SGC-KDSC-NOEXP-CSR                              18520072
185300             EXEC SQL                                             18530072
185400                 CLOSE SGC-KDSC-NOEXP-CSR                         18540072
185500             END-EXEC                                             18550072
185600                                                                  18560072
185700         WHEN ASC-ALL-FLDS-ALL-CSR                                18570072
185800             EXEC SQL                                             18580072
185900                 CLOSE ALL-FLDS-ALL-CSR                           18590072
186000             END-EXEC                                             18600072
186100                                                                  18610072
186200         WHEN ASC-ALL-FLDS-NOEXP-CSR                              18620072
186300             EXEC SQL                                             18630072
186400                 CLOSE ALL-FLDS-NOEXP-CSR                         18640072
186500             END-EXEC                                             18650072
186600                                                                  18660072
186700     END-EVALUATE.                                                18670072
186800*                                                                 18680072
186900     EVALUATE TRUE                                                18690072
187000         WHEN SQLCODE = ZERO                                      18700072
187100             CONTINUE                                             18710072
187200         WHEN SQLWARN0 NOT = SPACES                               18720072
187300         WHEN SQLCODE < ZERO                                      18730072
187400         WHEN SQLCODE > ZERO                                      18740072
187500             MOVE '4020-CLOSE-CURSOR'                             18750072
187600                               TO DP013-PARAGRAPH                 18760072
187700             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  18770072
187800                               TO DP013-MESSAGE-TEXT (1)          18780072
187900             MOVE SQLCA        TO DP013-SQLCA                     18790072
188000             MOVE 'TSIZE   '   TO DP013-DB2-TABLE-NAME (1)        18800072
188100             SET DP013-DB2-ABEND                                  18810072
188200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18820072
188300             PERFORM DP013-0000-PROCESS-ABEND                     18830072
188400     END-EVALUATE.                                                18840072
188500                                                                  18850072
188600 EJECT                                                            18860072
188700*----------------------------------------------------------------*18870072
188800*    SET UP THE HOST VARIABLES.                                  *18880072
188900*----------------------------------------------------------------*18890072
189000 4100-PREPARE-CURSOR.                                             18900072
189100                                                                  18910072
189200     SET ASC-DONT-SETUP-LIKE-FIELD TO TRUE.                       18920072
189300                                                                  18930072
189400     IF DK-EXP-SIZE-IND EQUAL 'Y'                                 18940072
189500         SET ASC-SGC-ALL-CSR       TO TRUE                        18950072
189600     ELSE                                                         18960072
189700         SET ASC-SGC-NOEXP-CSR     TO TRUE                        18970072
189800     END-IF.                                                      18980072
189900                                                                  18990072
190000     IF  DK-NRF-SIZE-CODE GREATER THAN SPACES                     19000072
190100         IF  DK-KOHLS-DESC GREATER THAN SPACES                    19010072
190200             SET ASC-SETUP-LIKE-FIELD         TO TRUE             19020072
190300             IF DK-EXP-SIZE-IND EQUAL 'Y'                         19030072
190400                 SET ASC-ALL-FLDS-ALL-CSR     TO TRUE             19040072
190500             ELSE                                                 19050072
190600                 SET ASC-ALL-FLDS-NOEXP-CSR TO TRUE               19060072
190700             END-IF                                               19070072
190800         ELSE                                                     19080072
190900             IF DK-EXP-SIZE-IND EQUAL 'Y'                         19090072
191000                 SET ASC-SGC-NRF-ALL-CSR      TO TRUE             19100072
191100             ELSE                                                 19110072
191200                 SET ASC-SGC-NRF-NOEXP-CSR    TO TRUE             19120072
191300             END-IF                                               19130072
191400         END-IF                                                   19140072
191500     END-IF.                                                      19150072
191600                                                                  19160072
191700     IF  DK-KOHLS-DESC GREATER THAN SPACES                        19170072
191800         SET ASC-SETUP-LIKE-FIELD             TO TRUE             19180072
191900         IF  DK-NRF-SIZE-CODE GREATER THAN SPACES                 19190072
192000             IF DK-EXP-SIZE-IND EQUAL 'Y'                         19200072
192100                 SET ASC-ALL-FLDS-ALL-CSR     TO TRUE             19210072
192200             ELSE                                                 19220072
192300                 SET ASC-ALL-FLDS-NOEXP-CSR TO TRUE               19230072
192400             END-IF                                               19240072
192500         ELSE                                                     19250072
192600             IF DK-EXP-SIZE-IND EQUAL 'Y'                         19260072
192700                 SET ASC-SGC-KDSC-ALL-CSR     TO TRUE             19270072
192800             ELSE                                                 19280072
192900                 SET ASC-SGC-KDSC-NOEXP-CSR   TO TRUE             19290072
193000             END-IF                                               19300072
193100         END-IF                                                   19310072
193200     END-IF.                                                      19320072
193300                                                                  19330072
193400     IF  ASC-SETUP-LIKE-FIELD                                     19340072
193500         PERFORM 4150-SETUP-KDESC-LIKE                            19350072
193600     END-IF.                                                      19360072
193700                                                                  19370072
193800 EJECT                                                            19380072
193900*----------------------------------------------------------------*19390072
194000* SETUP THE KOHLS DESCRIPTION FIELD REPLACING '*' BY '%' SO IT   *19400072
194100*   CAN BE USED IN THE DB2 LIKE CLAUSE OF THE FETCH.             *19410072
194200*----------------------------------------------------------------*19420072
194300 4150-SETUP-KDESC-LIKE.                                           19430072
194400                                                                  19440072
194500     IF  DK-KOHLS-DESC-BYTE (1) EQUAL '*'                         19450072
194600         MOVE PC-PERCENT                                          19460072
194700                       TO DK-KOHLS-DESC-BYTE (1)                  19470072
194800         INSPECT DK-KOHLS-DESC                                    19480072
194900             REPLACING FIRST '*' BY PC-PERCENT                    19490072
195000     END-IF.                                                      19500072
195100                                                                  19510072
195200     SET PS-NOT-DONE   TO TRUE.                                   19520072
195300                                                                  19530072
195400     PERFORM VARYING PV-SUB                                       19540072
195500         FROM LENGTH OF DK-KOHLS-DESC BY -1                       19550072
195600         UNTIL PV-SUB EQUAL 1                                     19560072
195700           OR  PS-DONE                                            19570072
195800                                                                  19580072
195900             IF  DK-KOHLS-DESC-BYTE (PV-SUB) = '*'                19590072
196000                 MOVE PC-PERCENT                                  19600072
196100                       TO DK-KOHLS-DESC-BYTE (PV-SUB)             19610072
196200                 SET PS-DONE                                      19620072
196300                       TO TRUE                                    19630072
196400             END-IF                                               19640072
196500                                                                  19650072
196600             IF  DK-KOHLS-DESC-BYTE (PV-SUB) > SPACES             19660072
196700                 SET PS-DONE                                      19670072
196800                       TO TRUE                                    19680072
196900             ELSE                                                 19690072
197000                 MOVE PC-PERCENT                                  19700072
197100                       TO DK-KOHLS-DESC-BYTE (PV-SUB)             19710072
197200             END-IF                                               19720072
197300                                                                  19730072
197400     END-PERFORM.                                                 19740072
197500                                                                  19750072
197600 EJECT                                                            19760072
197700*----------------------------------------------------------------*19770072
197800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19780072
197900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19790072
198000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19800072
198100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19810072
198200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19820072
198300*                                                                *19830072
198400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19840072
198500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19850072
198600*    UPON INITIALIZATION.                                        *19860072
198700*----------------------------------------------------------------*19870072
198800 4300-READ-ITEMS-FROM-DB.                                         19880072
198900                                                                  19890072
199000     PERFORM                                                      19900072
199100         VARYING PV-READ-COUNT                                    19910072
199200         FROM 1 BY 1                                              19920072
199300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19930072
199400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19940072
199500                                                                  19950072
199600         PERFORM 4310-FETCH                                       19960072
199700                                                                  19970072
199800         IF  ASC-ITEMS-LEFT-ON-DB                                 19980072
199900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19990072
200000                 ADD +1            TO ASC-ITEM-SUB                20000072
200100             ELSE                                                 20010072
200200                 ADD +1            TO ASC-BLK-SUB                 20020072
200300                 MOVE +1           TO ASC-ITEM-SUB                20030072
200400                                                                  20040072
200500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20050072
200600                     MOVE +1       TO ASC-BLK-SUB                 20060072
200700                     SET ASC-BLOCK-MODIFIED (1)                   20070072
200800                                   TO TRUE                        20080072
200900                     PERFORM 5100-WRITE-TEMP-STORAGE              20090072
201000                     MOVE ASC-BLOCK-ENTRIES                       20100072
201100                               (PC-MAX-BLOCKS-IN-ARRAY)           20110072
201200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20120072
201300                     ADD +1        TO ASC-BLK-SUB                 20130072
201400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20140072
201500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20150072
201600                                   TO TRUE                        20160072
201700                 END-IF                                           20170072
201800             END-IF                                               20180072
201900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    20190072
202000             MOVE ASC-NUMBER-OF-ITEMS-READ                        20200072
202100                               TO ASC-LIST-ITEM-NUMBER            20210072
202200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20220072
202300             MOVE SIZE-KOHLS-SIZE-CDE                             20230072
202400                               TO ASC-KOHLS-SIZE-CODE             20240072
202500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20250072
202600             MOVE SIZE-EFF-END-DTE                                20260072
202700                               TO ASC-EFF-END-DATE                20270072
202800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20280072
202900             MOVE SIZE-NRF-SIZE-CDE                               20290072
203000                               TO ASC-NRF-SIZE-CODE               20300072
203100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20310072
203200             MOVE SIZE-KOHLS-DESC                                 20320072
203300                               TO ASC-KOHLS-DESC                  20330072
203400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20340072
203500             MOVE SIZE-PRIM-DESC                                  20350072
203600                               TO ASC-PRI-DESC                    20360072
203700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20370072
203800             MOVE SIZE-SEC-DESC                                   20380072
203900                               TO ASC-SEC-DESC                    20390072
204000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20400072
204100             IF SIZE-EXTD-SZ-CDE = SPACES                         20410072
204200                 MOVE 'N'      TO ASC-EXT-CODE                    20420072
204300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20430072
204400             ELSE                                                 20440072
204500                 MOVE 'Y'      TO ASC-EXT-CODE                    20450072
204600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20460072
204700             END-IF                                               20470072
204800         END-IF                                                   20480072
204900     END-PERFORM.                                                 20490072
205000                                                                  20500072
205100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20510072
205200         MOVE +1               TO ASC-BLK-SUB                     20520072
205300         PERFORM 5100-WRITE-TEMP-STORAGE                          20530072
205400         ADD +1                TO ASC-BLK-SUB                     20540072
205500         PERFORM 5100-WRITE-TEMP-STORAGE                          20550072
205600                                                                  20560072
205700         MOVE 1                TO ASC-BLK-SUB                     20570072
205800                                  PV-BLOCK-NUMBER                 20580072
205900         PERFORM 4410-READ-TEMP-STORAGE                           20590072
206000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20600072
206100             MOVE 2            TO ASC-BLK-SUB                     20610072
206200                                  PV-BLOCK-NUMBER                 20620072
206300             PERFORM 4410-READ-TEMP-STORAGE                       20630072
206400         END-IF                                                   20640072
206500     END-IF.                                                      20650072
206600                                                                  20660072
206700 EJECT                                                            20670072
206800*----------------------------------------------------------------*20680072
206900*    FETCH THE APPROPRIATE SIZE CURSOR.                          *20690072
207000*----------------------------------------------------------------*20700072
207100 4310-FETCH.                                                      20710072
207200                                                                  20720072
207300     SET PS-SIZE-NOT-EXPIRED TO TRUE.                             20730072
207400     MOVE ZEROES TO PV-END-DATE-NULL-IND                          20740072
207500                    PV-EXTD-SZ-CDE-NULL-IND.                      20750072
207600     EVALUATE TRUE                                                20760072
207700         WHEN ASC-SGC-ALL-CSR                                     20770072
207800              EXEC SQL                                            20780072
207900                   FETCH SGC-ALL-CSR                              20790072
208000                   INTO  :SIZE-KOHLS-SIZE-CDE                     20800072
208100                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  20810072
208200                       , :SIZE-SIZE-GP-CDE                        20820072
208300                       , :SIZE-NRF-SIZE-CDE                       20830072
208400                       , :SIZE-PRIM-DESC                          20840072
208500                       , :SIZE-SEC-DESC                           20850072
208600                       , :SIZE-KOHLS-DESC                         20860072
208700                       , :SIZE-EXTD-SZ-CDE                        20870072
208800                              :PV-EXTD-SZ-CDE-NULL-IND            20880072
208900              END-EXEC                                            20890072
209000                                                                  20900072
209100         WHEN ASC-SGC-NOEXP-CSR                                   20910072
209200              EXEC SQL                                            20920072
209300                   FETCH SGC-NOEXP-CSR                            20930072
209400                   INTO  :SIZE-KOHLS-SIZE-CDE                     20940072
209500                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  20950072
209600                       , :SIZE-SIZE-GP-CDE                        20960072
209700                       , :SIZE-NRF-SIZE-CDE                       20970072
209800                       , :SIZE-PRIM-DESC                          20980072
209900                       , :SIZE-SEC-DESC                           20990072
210000                       , :SIZE-KOHLS-DESC                         21000072
210100                       , :SIZE-EXTD-SZ-CDE                        21010072
210200                              :PV-EXTD-SZ-CDE-NULL-IND            21020072
210300              END-EXEC                                            21030072
210400                                                                  21040072
210500         WHEN ASC-SGC-NRF-ALL-CSR                                 21050072
210600              EXEC SQL                                            21060072
210700                   FETCH SGC-NRF-ALL-CSR                          21070072
210800                   INTO  :SIZE-KOHLS-SIZE-CDE                     21080072
210900                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21090072
211000                       , :SIZE-SIZE-GP-CDE                        21100072
211100                       , :SIZE-NRF-SIZE-CDE                       21110072
211200                       , :SIZE-PRIM-DESC                          21120072
211300                       , :SIZE-SEC-DESC                           21130072
211400                       , :SIZE-KOHLS-DESC                         21140072
211500                       , :SIZE-EXTD-SZ-CDE                        21150072
211600                              :PV-EXTD-SZ-CDE-NULL-IND            21160072
211700              END-EXEC                                            21170072
211800                                                                  21180072
211900         WHEN ASC-SGC-NRF-NOEXP-CSR                               21190072
212000              EXEC SQL                                            21200072
212100                   FETCH SGC-NRF-NOEXP-CSR                        21210072
212200                   INTO  :SIZE-KOHLS-SIZE-CDE                     21220072
212300                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21230072
212400                       , :SIZE-SIZE-GP-CDE                        21240072
212500                       , :SIZE-NRF-SIZE-CDE                       21250072
212600                       , :SIZE-PRIM-DESC                          21260072
212700                       , :SIZE-SEC-DESC                           21270072
212800                       , :SIZE-KOHLS-DESC                         21280072
212900                       , :SIZE-EXTD-SZ-CDE                        21290072
213000                              :PV-EXTD-SZ-CDE-NULL-IND            21300072
213100              END-EXEC                                            21310072
213200                                                                  21320072
213300         WHEN ASC-SGC-KDSC-ALL-CSR                                21330072
213400              EXEC SQL                                            21340072
213500                   FETCH SGC-KDSC-ALL-CSR                         21350072
213600                   INTO  :SIZE-KOHLS-SIZE-CDE                     21360072
213700                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21370072
213800                       , :SIZE-SIZE-GP-CDE                        21380072
213900                       , :SIZE-NRF-SIZE-CDE                       21390072
214000                       , :SIZE-PRIM-DESC                          21400072
214100                       , :SIZE-SEC-DESC                           21410072
214200                       , :SIZE-KOHLS-DESC                         21420072
214300                       , :SIZE-EXTD-SZ-CDE                        21430072
214400                              :PV-EXTD-SZ-CDE-NULL-IND            21440072
214500              END-EXEC                                            21450072
214600                                                                  21460072
214700         WHEN ASC-SGC-KDSC-NOEXP-CSR                              21470072
214800              EXEC SQL                                            21480072
214900                   FETCH SGC-KDSC-NOEXP-CSR                       21490072
215000                   INTO  :SIZE-KOHLS-SIZE-CDE                     21500072
215100                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21510072
215200                       , :SIZE-SIZE-GP-CDE                        21520072
215300                       , :SIZE-NRF-SIZE-CDE                       21530072
215400                       , :SIZE-PRIM-DESC                          21540072
215500                       , :SIZE-SEC-DESC                           21550072
215600                       , :SIZE-KOHLS-DESC                         21560072
215700                       , :SIZE-EXTD-SZ-CDE                        21570072
215800                              :PV-EXTD-SZ-CDE-NULL-IND            21580072
215900              END-EXEC                                            21590072
216000                                                                  21600072
216100         WHEN ASC-ALL-FLDS-ALL-CSR                                21610072
216200              EXEC SQL                                            21620072
216300                   FETCH ALL-FLDS-ALL-CSR                         21630072
216400                   INTO  :SIZE-KOHLS-SIZE-CDE                     21640072
216500                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21650072
216600                       , :SIZE-SIZE-GP-CDE                        21660072
216700                       , :SIZE-NRF-SIZE-CDE                       21670072
216800                       , :SIZE-PRIM-DESC                          21680072
216900                       , :SIZE-SEC-DESC                           21690072
217000                       , :SIZE-KOHLS-DESC                         21700072
217100                       , :SIZE-EXTD-SZ-CDE                        21710072
217200                             :PV-EXTD-SZ-CDE-NULL-IND             21720072
217300              END-EXEC                                            21730072
217400                                                                  21740072
217500         WHEN ASC-ALL-FLDS-NOEXP-CSR                              21750072
217600              EXEC SQL                                            21760072
217700                   FETCH ALL-FLDS-NOEXP-CSR                       21770072
217800                   INTO  :SIZE-KOHLS-SIZE-CDE                     21780072
217900                       , :SIZE-EFF-END-DTE :PV-END-DATE-NULL-IND  21790072
218000                       , :SIZE-SIZE-GP-CDE                        21800072
218100                       , :SIZE-NRF-SIZE-CDE                       21810072
218200                       , :SIZE-PRIM-DESC                          21820072
218300                       , :SIZE-SEC-DESC                           21830072
218400                       , :SIZE-KOHLS-DESC                         21840072
218500                       , :SIZE-EXTD-SZ-CDE                        21850072
218600                             :PV-EXTD-SZ-CDE-NULL-IND             21860072
218700              END-EXEC                                            21870072
218800                                                                  21880072
218900     END-EVALUATE.                                                21890072
219000                                                                  21900072
219100     EVALUATE TRUE                                                21910072
219200         WHEN SQLCODE = ZERO                                      21920072
219300              IF PV-END-DATE-NULL-IND < 0                         21930072
219400                  SET PS-SIZE-NOT-EXPIRED TO TRUE                 21940072
219500                  MOVE SPACES             TO SIZE-EFF-END-DTE     21950072
219600              ELSE                                                21960072
219700                  SET PS-SIZE-EXPIRED     TO TRUE                 21970072
219800              END-IF                                              21980072
219900              IF PV-EXTD-SZ-CDE-NULL-IND < 0                      21990072
220000                  MOVE SPACES             TO SIZE-EXTD-SZ-CDE     22000072
220100              END-IF                                              22010072
220200         WHEN SQLCODE = +100                                      22020072
220300              CONTINUE                                            22030072
220400         WHEN SQLWARN0 NOT = SPACE                                22040072
220500         WHEN SQLCODE NOT = ZERO                                  22050072
220600              MOVE '4310-FETCH-CURSOR'                            22060072
220700                               TO DP013-PARAGRAPH                 22070072
220800              MOVE 'FETCH MESSAGE CURSOR'                         22080072
220900                               TO DP013-MESSAGE-TEXT (1)          22090072
221000              MOVE SQLCA       TO DP013-SQLCA                     22100072
221100              SET DP013-DB2-ABEND                                 22110072
221200                               TO TRUE                            22120072
221300              PERFORM DP013-0000-PROCESS-ABEND                    22130072
221400     END-EVALUATE.                                                22140072
221500                                                                  22150072
221600     IF  SQLCODE EQUAL +100                                       22160072
221700         SET ASC-NO-ITEMS-LEFT-ON-DB                              22170072
221800                                   TO TRUE                        22180072
221900     END-IF.                                                      22190072
222000                                                                  22200072
222100 EJECT                                                            22210072
222200*----------------------------------------------------------------*22220072
222300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22230072
222400*----------------------------------------------------------------*22240072
222500 4400-MOVE-COMMAREA-TO-SCREEN.                                    22250072
222600                                                                  22260072
222700     MOVE ASC-KEY-SIZE-GP-CODE  TO PV-SIZE-GP-CODE-N.             22270072
222800     MOVE PV-SIZE-GP-CODE-N     TO PV-SIZE-GP-CODE-X.             22280072
222900     MOVE PV-SIZE-GP-CODE-X     TO ASZGPCDO.                      22290072
223000                                                                  22300072
223100     MOVE ASC-KEY-SIZE-GP-DESC  TO ASZGPDSO.                      22310072
223200                                                                  22320072
223300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22330072
223400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22340072
223500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22350072
223600             MOVE +1    TO ASC-BLK-SUB                            22360072
223700             PERFORM 5100-WRITE-TEMP-STORAGE                      22370072
223800             ADD +1     TO ASC-BLK-SUB                            22380072
223900             PERFORM 5100-WRITE-TEMP-STORAGE                      22390072
224000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22400072
224100                 GIVING PV-BLOCK-NUMBER                           22410072
224200                 REMAINDER PV-REMAINDER                           22420072
224300             IF  PV-REMAINDER > ZERO                              22430072
224400                 ADD +1 TO PV-BLOCK-NUMBER                        22440072
224500             END-IF                                               22450072
224600             MOVE +1    TO ASC-BLK-SUB                            22460072
224700             PERFORM 4410-READ-TEMP-STORAGE                       22470072
224800             ADD +1     TO ASC-BLK-SUB                            22480072
224900                           PV-BLOCK-NUMBER                        22490072
225000             PERFORM 4410-READ-TEMP-STORAGE                       22500072
225100     END-IF.                                                      22510072
225200     MOVE +1            TO ASC-BLK-SUB.                           22520072
225300     COMPUTE ASC-ITEM-SUB =                                       22530072
225400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22540072
225500         + PC-ITEMS-PER-PANEL).                                   22550072
225600                                                                  22560072
225700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22570072
225800         ADD +1         TO ASC-BLK-SUB                            22580072
225900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22590072
226000     END-IF.                                                      22600072
226100                                                                  22610072
226200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22620072
226300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22630072
226400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22640072
226500     PERFORM 4420-FORMAT-LIST-LINES                               22650072
226600         VARYING PV-SUB                                           22660072
226700         FROM PC-ITEMS-PER-PANEL BY -1                            22670072
226800         UNTIL PV-SUB < +1.                                       22680072
226900                                                                  22690072
227000     COMPUTE ASC-ITEMS-DISPLAYED =                                22700072
227100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22710072
227200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22720072
227300                                      ASTRTITO.                   22730072
227400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22740072
227500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22750072
227600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22760072
227700                                   TO ASELITO.                    22770072
227800                                                                  22780072
227900     IF  DP020-MSG-NUMBER-X = SPACE                               22790072
228000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22800072
228100*            --- MORE ITEMS TO DISPLAY ----                       22810072
228200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22820072
228300             SET DP020-MSG-INFORMATIONAL TO TRUE                  22830072
228400         END-IF                                                   22840072
228500     END-IF.                                                      22850072
228600                                                                  22860072
228700*----------------------------------------------------------------*22870072
228800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22880072
228900*----------------------------------------------------------------*22890072
229000 4410-READ-TEMP-STORAGE.                                          22900072
229100                                                                  22910072
229200     EXEC CICS                                                    22920072
229300         READQ TS                                                 22930072
229400             QUEUE (ASC-LIST-QUEUE-NAME)                          22940072
229500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22950072
229600             ITEM  (PV-BLOCK-NUMBER)                              22960072
229700             RESP  (PV-CICS-RESP)                                 22970072
229800     END-EXEC.                                                    22980072
229900                                                                  22990072
230000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23000072
230100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23010072
230200         CONTINUE                                                 23020072
230300     ELSE                                                         23030072
230400         SET DP013-CICS-ABEND     TO TRUE                         23040072
230500         SET DP013-NO-ROLLBACK    TO TRUE                         23050072
230600         MOVE '4410-READ-TEMP-STORAGE'                            23060072
230700                                  TO DP013-PARAGRAPH              23070072
230800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23080072
230900                                  TO DP013-MESSAGE-TEXT(1)        23090072
231000         PERFORM DP013-0000-PROCESS-ABEND                         23100072
231100     END-IF.                                                      23110072
231200                                                                  23120072
231300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23130072
231400                                                                  23140072
231500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23150072
231600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23160072
231700     END-IF.                                                      23170072
231800                                                                  23180072
231900 EJECT                                                            23190072
232000*----------------------------------------------------------------*23200072
232100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23210072
232200*----------------------------------------------------------------*23220072
232300 4420-FORMAT-LIST-LINES.                                          23230072
232400                                                                  23240072
232500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23250072
232600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23260072
232700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           23270072
232800         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           23280072
232900         MOVE SPACE              TO MR-SELECT (PV-SUB)            23290072
233000                                    MR-ACTION (PV-SUB)            23300072
233100                                    MR-NRF-SIZE-CODE (PV-SUB)     23310072
233200                                    MR-KOHLS-DESC (PV-SUB)        23320072
233300                                    MR-PRI-DESC (PV-SUB)          23330072
233400                                    MR-SEC-DESC (PV-SUB)          23340072
233500                                    MR-EXT-CODE (PV-SUB)          23350072
233600     ELSE                                                         23360072
233700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23370072
233800                                                   > SPACE        23380072
233900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23390072
234000                                 TO MR-SELECT (PV-SUB)            23400072
234100         ELSE                                                     23410072
234200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23420072
234300                                 TO MR-SELECT (PV-SUB)            23430072
234400         END-IF                                                   23440072
234500                                                                  23450072
234600         IF  DP030-SET-CURSOR-TRAILER                             23460072
234700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23470072
234800                 > SPACE)                                         23480072
234900               OR (PV-SUB = 1))                                   23490072
235000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23500072
235100                MOVE -1          TO MR-SELECTL (PV-SUB)           23510072
235200             END-IF                                               23520072
235300         END-IF                                                   23530072
235400                                                                  23540072
235500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23550072
235600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           23560072
235700                                 TO MR-ACTION (PV-SUB)            23570072
235800             MOVE ASC-NRF-SIZE-CODE (ASC-BLK-SUB ASC-ITEM-SUB)    23580072
235900                                 TO MR-NRF-SIZE-CODE (PV-SUB)     23590072
236000             MOVE ASC-KOHLS-DESC (ASC-BLK-SUB ASC-ITEM-SUB)       23600072
236100                                 TO MR-KOHLS-DESC (PV-SUB)        23610072
236200             MOVE ASC-PRI-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         23620072
236300                                 TO MR-PRI-DESC (PV-SUB)          23630072
236400             MOVE ASC-SEC-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         23640072
236500                                 TO MR-SEC-DESC (PV-SUB)          23650072
236600             MOVE ASC-EXT-CODE (ASC-BLK-SUB ASC-ITEM-SUB)         23660072
236700                                 TO MR-EXT-CODE (PV-SUB)          23670072
236800                                                                  23680072
236900*            --- IF THE ACTION IS 'ERR' AND THE FIELD IS ---      23690072
237000*            --- STILL IS SELECTED STATUS, HIGHLIGHT THE ---      23700072
237100*            --- FIELD AS BEING IN ERROR.                ---      23710072
237200             IF (( ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)          23720072
237300               EQUAL PC-ERR ) AND ( MR-SELECT (PV-SUB) > SPACE )) 23730072
237400                 MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB)        23740072
237500                 MOVE DP015-RED     TO MR-SELECTC (PV-SUB)        23750072
237600                 MOVE -1            TO MR-SELECTL (PV-SUB)        23760072
237700                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             23770072
237800             END-IF                                               23780072
237900                                                                  23790072
238000*            --- DISPLAY EXPIRED SIZES IN YELLOW, NOT BLUE ---    23800072
238100             IF ASC-EFF-END-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       23810072
238200               NOT EQUAL SPACES                                   23820072
238300                 MOVE DP015-YELLOW TO MR-NRF-SIZE-CODEC (PV-SUB)  23830072
238400                                      MR-KOHLS-DESCC (PV-SUB)     23840072
238500                                      MR-PRI-DESCC (PV-SUB)       23850072
238600                                      MR-SEC-DESCC (PV-SUB)       23860072
238700                                      MR-EXT-CODEC (PV-SUB)       23870072
238800             ELSE                                                 23880072
238900                 MOVE DP015-BLUE   TO MR-NRF-SIZE-CODEC (PV-SUB)  23890072
239000                                      MR-KOHLS-DESCC (PV-SUB)     23900072
239100                                      MR-PRI-DESCC (PV-SUB)       23910072
239200                                      MR-SEC-DESCC (PV-SUB)       23920072
239300                                      MR-EXT-CODEC (PV-SUB)       23930072
239400             END-IF                                               23940072
239500         END-IF                                                   23950072
239600     END-IF.                                                      23960072
239700                                                                  23970072
239800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23980072
239900                                                                  23990072
240000     IF  ASC-ITEM-SUB < + 1                                       24000072
240100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24010072
240200         MOVE +1                 TO ASC-BLK-SUB                   24020072
240300     END-IF.                                                      24030072
240400                                                                  24040072
240500******************************************************************24050072
240600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24060072
240700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24070072
240800** ISSUE A WARNING.                                             **24080072
240900******************************************************************24090072
241000 4430-CHECK-FOR-BEGIN-AND-END.                                    24100072
241100                                                                  24110072
241200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24120072
241300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24130072
241400*            -- NO END-OF-RANGE SPECFIED ---                      24140072
241500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24150072
241600             SET DP020-MSG-WARNING TO TRUE                        24160072
241700             PERFORM 4431-POSITION-AT-WARNING                     24170072
241800         END-IF                                                   24180072
241900     ELSE                                                         24190072
242000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24200072
242100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24210072
242200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24220072
242300             SET DP020-MSG-WARNING TO TRUE                        24230072
242400             PERFORM 4431-POSITION-AT-WARNING                     24240072
242500         END-IF                                                   24250072
242600     END-IF.                                                      24260072
242700                                                                  24270072
242800******************************************************************24280072
242900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24290072
243000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24300072
243100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24310072
243200** POSITION THE CURSOR THERE.                                   **24320072
243300******************************************************************24330072
243400 4431-POSITION-AT-WARNING.                                        24340072
243500                                                                  24350072
243600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24360072
243700                    - PV-TOP-ITEM + 1.                            24370072
243800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24380072
243900         CONTINUE                                                 24390072
244000     ELSE                                                         24400072
244100         SET DP030-SET-CURSOR-APPL-1                              24410072
244200                                   TO TRUE                        24420072
244300         MOVE -1                   TO MR-SELECTL (PV-SUB)         24430072
244400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24440072
244500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24450072
244600     END-IF.                                                      24460072
244700                                                                  24470072
244800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24480072
244900                    - PV-TOP-ITEM + 1.                            24490072
245000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24500072
245100         CONTINUE                                                 24510072
245200     ELSE                                                         24520072
245300         SET DP030-SET-CURSOR-APPL-1                              24530072
245400                                   TO TRUE                        24540072
245500         MOVE -1                   TO MR-SELECTL (PV-SUB)         24550072
245600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24560072
245700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24570072
245800     END-IF.                                                      24580072
245900                                                                  24590072
246000 EJECT                                                            24600072
246100*----------------------------------------------------------------*24610072
246200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24620072
246300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24630072
246400* FOR THE SELECTED ITEMS QUEUE.                                  *24640072
246500*                                                                *24650072
246600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24660072
246700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24670072
246800* THE ARRAY IS FULL.                                             *24680072
246900*----------------------------------------------------------------*24690072
247000 5000-PREPARE-SEL-QUEUE.                                          24700072
247100                                                                  24710072
247200     MOVE +1                   TO  ASC-BLK-SUB.                   24720072
247300     PERFORM 5100-WRITE-TEMP-STORAGE.                             24730072
247400     ADD +1                    TO  ASC-BLK-SUB.                   24740072
247500     PERFORM 5100-WRITE-TEMP-STORAGE.                             24750072
247600                                                                  24760072
247700     MOVE ASC-SEL-QUEUE-NAME   TO  ET352-SEL-QUEUE-NAME.          24770072
247800     PERFORM 6010-DELETE-SEL-QUEUE.                               24780072
247900                                                                  24790072
248000     SET ASC-UPDATE-TSQ        TO  TRUE.                          24800072
248100                                                                  24810072
248200     SET ET353-IDX             TO  1.                             24820072
248300     MOVE ZERO                 TO ET352-NUMBER-OF-TS-ITEMS.       24830072
248400     INITIALIZE ET353-SELECTED-ITEM-ARRAY.                        24840072
248500                                                                  24850072
248600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24860072
248700             VARYING PV-ITEM                                      24870072
248800             FROM 1 BY 1                                          24880072
248900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24890072
249000                                                                  24900072
249100     IF  ET353-IDX > 1                                            24910072
249200         PERFORM 5205-WRITE-SEL-QUEUE                             24920072
249300         ADD +1                TO ET352-NUMBER-OF-TS-ITEMS        24930072
249400     END-IF.                                                      24940072
249500                                                                  24950072
249600 EJECT                                                            24960072
249700*----------------------------------------------------------------*24970072
249800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24980072
249900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24990072
250000*----------------------------------------------------------------*25000072
250100 5100-WRITE-TEMP-STORAGE.                                         25010072
250200                                                                  25020072
250300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25030072
250400                                   TO PV-LIST-ITEM-NUMBER.        25040072
250500     COMPUTE PV-BLOCK-NUMBER =                                    25050072
250600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25060072
250700                                                                  25070072
250800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25080072
250900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25090072
251000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25100072
251100             PERFORM 5105-REWRITE-ASC-LISTQ                       25110072
251200         END-IF                                                   25120072
251300     ELSE                                                         25130072
251400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25140072
251500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25150072
251600         PERFORM 5110-WRITE-ASC-LISTQ                             25160072
251700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25170072
251800     END-IF.                                                      25180072
251900                                                                  25190072
252000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25200072
252100******************************************************************25210072
252200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25220072
252300** SPECIFIC COMMAREA.                                           **25230072
252400******************************************************************25240072
252500 5105-REWRITE-ASC-LISTQ.                                          25250072
252600                                                                  25260072
252700     EXEC CICS                                                    25270072
252800         WRITEQ TS                                                25280072
252900             QUEUE (ASC-LIST-QUEUE-NAME)                          25290072
253000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25300072
253100             ITEM  (PV-BLOCK-NUMBER)                              25310072
253200             REWRITE                                              25320072
253300             RESP  (PV-CICS-RESP)                                 25330072
253400     END-EXEC.                                                    25340072
253500                                                                  25350072
253600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25360072
253700         CONTINUE                                                 25370072
253800     ELSE                                                         25380072
253900         SET DP013-CICS-ABEND            TO TRUE                  25390072
254000         SET DP013-NO-ROLLBACK           TO TRUE                  25400072
254100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25410072
254200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25420072
254300                                         TO DP013-MESSAGE-TEXT(1) 25430072
254400         PERFORM DP013-0000-PROCESS-ABEND                         25440072
254500     END-IF.                                                      25450072
254600                                                                  25460072
254700******************************************************************25470072
254800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25480072
254900** SPECIFIC COMMAREA.                                           **25490072
255000******************************************************************25500072
255100 5110-WRITE-ASC-LISTQ.                                            25510072
255200                                                                  25520072
255300     EXEC CICS                                                    25530072
255400         WRITEQ TS                                                25540072
255500             QUEUE (ASC-LIST-QUEUE-NAME)                          25550072
255600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25560072
255700             ITEM  (PV-BLOCK-NUMBER)                              25570072
255800             RESP  (PV-CICS-RESP)                                 25580072
255900     END-EXEC.                                                    25590072
256000                                                                  25600072
256100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25610072
256200         SET DP013-CICS-ABEND      TO TRUE                        25620072
256300         SET DP013-NO-ROLLBACK     TO TRUE                        25630072
256400         MOVE '5110-WRITE-ASC-LISTQ'                              25640072
256500                                   TO DP013-PARAGRAPH             25650072
256600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25660072
256700                                   TO DP013-MESSAGE-TEXT(1)       25670072
256800         PERFORM DP013-0000-PROCESS-ABEND                         25680072
256900     END-IF.                                                      25690072
257000                                                                  25700072
257100 EJECT                                                            25710072
257200*----------------------------------------------------------------*25720072
257300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25730072
257400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25740072
257500*----------------------------------------------------------------*25750072
257600 5200-FILL-SEL-QUEUE-RECORD.                                      25760072
257700                                                                  25770072
257800     PERFORM 6112-READ-LIST-QUEUE.                                25780072
257900                                                                  25790072
258000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25800072
258100         PERFORM                                                  25810072
258200         VARYING LQW-IDX                                          25820072
258300         FROM 1 BY 1                                              25830072
258400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25840072
258500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25850072
258600                                                                  25860072
258700             IF  LQW-SELECT (LQW-IDX)                             25870072
258800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25880072
258900                                   TO ET353-ITEM (ET353-IDX)      25890072
259000                 MOVE LQW-KOHLS-SIZE-CODE (LQW-IDX)               25900072
259100                                   TO ET353-KOHLS-SIZE-CODE       25910072
259200                                        (ET353-IDX)               25920072
259300                 MOVE SPACE        TO ET353-ACTION-SW (ET353-IDX) 25930072
259400                 SET ET353-IDX UP BY 1                            25940072
259500                 IF  ET353-IDX > ET353-MAX-ITEMS                  25950072
259600                     PERFORM 5205-WRITE-SEL-QUEUE                 25960072
259700                     ADD +1        TO ET352-NUMBER-OF-TS-ITEMS    25970072
259800                     INITIALIZE ET353-SELECTED-ITEM-ARRAY         25980072
259900                     SET ET353-IDX TO  1                          25990072
260000                 END-IF                                           26000072
260100             END-IF                                               26010072
260200         END-PERFORM                                              26020072
260300     END-IF.                                                      26030072
260400                                                                  26040072
260500*----------------------------------------------------------------*26050072
260600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26060072
260700*----------------------------------------------------------------*26070072
260800 5205-WRITE-SEL-QUEUE.                                            26080072
260900                                                                  26090072
261000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26100072
261100                                   TO ET353-SELECTED-ITEMS.       26110072
261200                                                                  26120072
261300     EXEC CICS                                                    26130072
261400          WRITEQ TS                                               26140072
261500              QUEUE (ASC-SEL-QUEUE-NAME)                          26150072
261600              FROM  (ET353-SIZE-SEL-REC)                          26160072
261700              ITEM  (PV-SEL-QUEUE-ITEM)                           26170072
261800              RESP  (PV-CICS-RESP)                                26180072
261900     END-EXEC.                                                    26190072
262000                                                                  26200072
262100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26210072
262200         CONTINUE                                                 26220072
262300     ELSE                                                         26230072
262400         SET DP013-CICS-ABEND      TO TRUE                        26240072
262500         SET DP013-NO-ROLLBACK     TO TRUE                        26250072
262600         MOVE '5205-WRITE-SEL-QUEUE'                              26260072
262700                                   TO DP013-PARAGRAPH             26270072
262800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26280072
262900                                   TO DP013-MESSAGE-TEXT(1)       26290072
263000         PERFORM DP013-0000-PROCESS-ABEND                         26300072
263100     END-IF.                                                      26310072
263200                                                                  26320072
263300 EJECT                                                            26330072
263400******************************************************************26340072
263500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **26350072
263600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **26360072
263700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **26370072
263800** THE USER.                                                    **26380072
263900******************************************************************26390072
264000 6000-REFRESH-PANEL-FROM-TEMP.                                    26400072
264100                                                                  26410072
264200     IF  ASC-UPDATE-TSQ                                           26420072
264300         SET ASC-NO-TSQ-UPDATE TO TRUE                            26430072
264400         MOVE ZERO                 TO PV-SAVE-ITEM                26440072
264500                                      PV-SEL-QUEUE-ITEM           26450072
264600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26460072
264700                                   TO PV-HOLD-SELECTED-ITEMS      26470072
264800         MOVE +1                   TO PV-ITEMS-PROCESSED          26480072
264900         PERFORM 6100-UPDATE-TSQ                                  26490072
265000             UNTIL PV-ITEMS-PROCESSED >                           26500072
265100                                     PV-HOLD-SELECTED-ITEMS       26510072
265200         PERFORM 6010-DELETE-SEL-QUEUE                            26520072
265300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26530072
265400                    ASC-BLOCK-ENTRIES (2)                         26540072
265500     END-IF.                                                      26550072
265600                                                                  26560072
265700*----------------------------------------------------------------*26570072
265800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26580072
265900*----------------------------------------------------------------*26590072
266000 6010-DELETE-SEL-QUEUE.                                           26600072
266100                                                                  26610072
266200     EXEC CICS                                                    26620072
266300         DELETEQ TS                                               26630072
266400             QUEUE (ASC-SEL-QUEUE-NAME)                           26640072
266500             RESP  (PV-CICS-RESP)                                 26650072
266600     END-EXEC.                                                    26660072
266700                                                                  26670072
266800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26680072
266900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26690072
267000         CONTINUE                                                 26700072
267100     ELSE                                                         26710072
267200         SET DP013-CICS-ABEND TO TRUE                             26720072
267300         SET DP013-NO-ROLLBACK TO TRUE                            26730072
267400         MOVE '6010-DELETE-SEL-QUEUE'                             26740072
267500                        TO DP013-PARAGRAPH                        26750072
267600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26760072
267700                        TO DP013-MESSAGE-TEXT (1)                 26770072
267800         PERFORM DP013-0000-PROCESS-ABEND                         26780072
267900     END-IF.                                                      26790072
268000                                                                  26800072
268100*----------------------------------------------------------------*26810072
268200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26820072
268300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26830072
268400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26840072
268500*    THE TEMP QUEUE.                                             *26850072
268600*----------------------------------------------------------------*26860072
268700 6100-UPDATE-TSQ.                                                 26870072
268800                                                                  26880072
268900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26890072
269000     PERFORM 6105-READ-SEL-QUEUE.                                 26900072
269100     PERFORM                                                      26910072
269200         VARYING ET353-IDX                                        26920072
269300         FROM 1 BY 1                                              26930072
269400         UNTIL ((PV-ITEMS-PROCESSED >                             26940072
269500                              PV-HOLD-SELECTED-ITEMS)             26950072
269600         OR (ET353-IDX GREATER THAN ET353-MAX-ITEMS))             26960072
269700         IF  ET353-ACTION-SW (ET353-IDX) > SPACE                  26970072
269800             PERFORM 6110-PROCESS-ITEMS                           26980072
269900         END-IF                                                   26990072
270000         ADD +1                TO PV-ITEMS-PROCESSED              27000072
270100     END-PERFORM.                                                 27010072
270200     PERFORM 6111-WRITE-LIST-QUEUE.                               27020072
270300                                                                  27030072
270400*----------------------------------------------------------------*27040072
270500*    READ THE LIST QUEUE RECORD.                                 *27050072
270600*----------------------------------------------------------------*27060072
270700 6105-READ-SEL-QUEUE.                                             27070072
270800                                                                  27080072
270900     EXEC CICS                                                    27090072
271000          READQ TS                                                27100072
271100              QUEUE (ASC-SEL-QUEUE-NAME)                          27110072
271200              INTO  (ET353-SIZE-SEL-REC)                          27120072
271300              ITEM  (PV-SEL-QUEUE-ITEM)                           27130072
271400              RESP  (PV-CICS-RESP)                                27140072
271500     END-EXEC.                                                    27150072
271600                                                                  27160072
271700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27170072
271800         CONTINUE                                                 27180072
271900     ELSE                                                         27190072
272000         SET DP013-CICS-ABEND      TO  TRUE                       27200072
272100         SET DP013-NO-ROLLBACK     TO  TRUE                       27210072
272200         MOVE '6105-READ-SEL-QUEUE'                               27220072
272300                                   TO  DP013-PARAGRAPH            27230072
272400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27240072
272500                                   TO  DP013-MESSAGE-TEXT(1)      27250072
272600         PERFORM DP013-0000-PROCESS-ABEND                         27260072
272700     END-IF.                                                      27270072
272800                                                                  27280072
272900 EJECT                                                            27290072
273000*----------------------------------------------------------------*27300072
273100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27310072
273200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27320072
273300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27330072
273400*----------------------------------------------------------------*27340072
273500                                                                  27350072
273600 6110-PROCESS-ITEMS.                                              27360072
273700                                                                  27370072
273800     COMPUTE PV-ITEM = 1 + ((ET353-ITEM (ET353-IDX) - 1)          27380072
273900                     / PC-ITEMS-PER-PANEL).                       27390072
274000                                                                  27400072
274100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27410072
274200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27420072
274300             PERFORM 6111-WRITE-LIST-QUEUE                        27430072
274400         END-IF                                                   27440072
274500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27450072
274600                                                                  27460072
274700         PERFORM 6112-READ-LIST-QUEUE                             27470072
274800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27480072
274900             CONTINUE                                             27490072
275000         END-IF                                                   27500072
275100     END-IF.                                                      27510072
275200                                                                  27520072
275300     COMPUTE PV-SUB = (ET353-ITEM (ET353-IDX)                     27530072
275400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27540072
275500                                                                  27550072
275600     EVALUATE TRUE                                                27560072
275700         WHEN ET353-INQ (ET353-IDX)                               27570072
275800              SET LQW-DESELECT (PV-SUB) TO    TRUE                27580072
275900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             27590072
276000              SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        27600072
276100                                                                  27610072
276200         WHEN ET353-ADD (ET353-IDX)                               27620072
276300              SET LQW-DESELECT (PV-SUB) TO    TRUE                27630072
276400              MOVE PC-ADD      TO LQW-ACTION (PV-SUB)             27640072
276500              SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        27650072
276600                                                                  27660072
276700         WHEN ET353-UPD (ET353-IDX)                               27670072
276800              SET LQW-DESELECT (PV-SUB) TO    TRUE                27680072
276900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             27690072
277000              SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        27700072
277100                                                                  27710072
277200         WHEN ET353-DEL (ET353-IDX)                               27720072
277300              SET LQW-DESELECT (PV-SUB) TO    TRUE                27730072
277400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             27740072
277500              SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        27750072
277600                                                                  27760072
277700         WHEN ET353-ERR (ET353-IDX)                               27770072
277800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             27780072
277900     END-EVALUATE.                                                27790072
278000                                                                  27800072
278100     MOVE LQW-SELECTED-SW (PV-SUB)                                27810072
278200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  27820072
278300                                                                  27830072
278400*----------------------------------------------------------------*27840072
278500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27850072
278600*----------------------------------------------------------------*27860072
278700 6111-WRITE-LIST-QUEUE.                                           27870072
278800                                                                  27880072
278900     EXEC CICS                                                    27890072
279000         WRITEQ TS                                                27900072
279100             QUEUE (ASC-LIST-QUEUE-NAME)                          27910072
279200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27920072
279300             ITEM  (PV-SAVE-ITEM)                                 27930072
279400             REWRITE                                              27940072
279500             RESP  (PV-CICS-RESP)                                 27950072
279600     END-EXEC.                                                    27960072
279700                                                                  27970072
279800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27980072
279900         CONTINUE                                                 27990072
280000     ELSE                                                         28000072
280100         SET DP013-CICS-ABEND  TO  TRUE                           28010072
280200         SET DP013-NO-ROLLBACK TO  TRUE                           28020072
280300         MOVE '6111-WRITE-LIST-QUEUE'                             28030072
280400                               TO  DP013-PARAGRAPH                28040072
280500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28050072
280600                               TO  DP013-MESSAGE-TEXT(1)          28060072
280700         PERFORM DP013-0000-PROCESS-ABEND                         28070072
280800     END-IF.                                                      28080072
280900                                                                  28090072
281000 EJECT                                                            28100072
281100*----------------------------------------------------------------*28110072
281200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28120072
281300*----------------------------------------------------------------*28130072
281400 6112-READ-LIST-QUEUE.                                            28140072
281500                                                                  28150072
281600     EXEC CICS                                                    28160072
281700         READQ TS                                                 28170072
281800             QUEUE (ASC-LIST-QUEUE-NAME)                          28180072
281900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28190072
282000             ITEM  (PV-ITEM)                                      28200072
282100             RESP  (PV-CICS-RESP)                                 28210072
282200     END-EXEC.                                                    28220072
282300                                                                  28230072
282400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28240072
282500         CONTINUE                                                 28250072
282600     ELSE                                                         28260072
282700         SET DP013-CICS-ABEND        TO TRUE                      28270072
282800         SET DP013-NO-ROLLBACK       TO TRUE                      28280072
282900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28290072
283000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28300072
283100                                     TO DP013-MESSAGE-TEXT(1)     28310072
283200         PERFORM DP013-0000-PROCESS-ABEND                         28320072
283300     END-IF.                                                      28330072
283400                                                                  28340072
283500 EJECT                                                            28350072
283600*----------------------------------------------------------------*28360072
283700*    ABEND PROCESSOR MODULE                                      *28370072
283800*----------------------------------------------------------------*28380072
283900                                                                  28390072
284000     COPY DPPD013.                                                28400072
