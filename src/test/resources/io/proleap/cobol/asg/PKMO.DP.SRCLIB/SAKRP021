000100***************************************************************** 00010015
000200 IDENTIFICATION DIVISION.                                         00020015
000300***************************************************************** 00030015
000400                                                                  00040015
000500 PROGRAM-ID.             SAKRP021.                                00050015
000600 AUTHOR.                 BARB SCHULTZ.                            00060015
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070015
000800 DATE-WRITTEN            MARCH 2023.                              00080015
000900 DATE-COMPILED.                                                   00090015
001000                                                                  00100015
001100***************************************************************** 00110015
001200* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00120015
001300***************************************************************** 00130015
001400*                                                                 00140015
001500*  THIS PROGRAM WILL CREATE A DAILY KOHLS COBRAND CHARGE AUDIT    00150015
001600*  REPORT.  COPIED SAKRP019.                                      00160015
001700*                                                                 00170015
001800*   INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE        00180015
001900*                  PROCESS DATE TO CREATE THE REPORT.             00190015
002000*  OUTPUT: RPT01 - REPORT SHOWING COBRAND CHARGE CORRECTIONS      00200015
002100*                  BY SALES DATE.                                 00210015
002200*                                                                 00220015
002300***************************************************************** 00230015
002400*                                                                 00240015
002500*  THIS PROGRAM USES THE TEPDKEY TABLE TO JOIN THE TEPTRN,        00250015
002600*  TEPTND, AND TEPCRD TABLES.  THE TEPDKEY TABLE CONTAINS ALL     00260015
002700*  KEY INFORMATION FOR TRANSACTIONS THAT HAVE BEEN PROCESSED FOR  00270015
002800*  A PROCESSING DAY THAT DO NOT HAVE SALES DATES FOR THAT         00280015
002900*  PROCESSING DAY.  THE MOST COMMON EXAMPLE OF THIS IS A SALES    00290015
003000*  CORRECTION.                                                    00300015
003100*                                                                 00310015
003200*  THIS PROGRAM ALSO JOINS THE TEPDKEY TABLE WITH THE TEPPAY AND  00320015
003300*  TEPTRN TABLES TO OBTAIN THE KOHLS CREDIT PAYMENT CORRECTIONS.  00330015
003400*                                                                 00340015
003500*  THE REPORT USES DATA FROM THE TEPTND, TEPCRD, TEPPAY, AND      00350015
003600*  TEPTRN TABLES.  A DETAIL LINE IS WRITTEN FOR EACH ROW FETCHED. 00360015
003700*  THE REPORT BREAKS ON STORE NUMBER AND ALSO SALES DATE.         00370015
003800*  WHEN A NEW SALES DATE IS ENCOUNTERED, THE DATE IS PASSED TO THE00380015
003900*  CALENDAR ROUTINE TO BE CHANGED INTO GREGORIAN FORMAT.          00390015
004000*                                                                 00400015
004100*  WHEN THE FETCH IS COMPLETE, A TOTAL LINE IS PRINTED AT THE     00410015
004200*  END OF THE REPORT.                                             00420015
004300*                                                                 00430015
004400***************************************************************** 00440015
004500***************************************************************** 00450015
004600*                                                                 00460015
004700*  CHANGED    :  03/20/23 BY BARB SCHULTZ                         00470015
004800*  CHG#       :  CHG0285913                                       00480015
004900*  CHANGE MADE:  NEW IMPLEMENTATION                               00490015
005000*                                                                 00500015
005100***************************************************************** 00510015
005200***************************************************************** 00520015
005300 ENVIRONMENT DIVISION.                                            00530015
005400***************************************************************** 00540015
005500                                                                  00550015
005600 CONFIGURATION SECTION.                                           00560015
005700                                                                  00570015
005800 SOURCE-COMPUTER.        IBM-3090.                                00580015
005900                                                                  00590015
006000 OBJECT-COMPUTER.        IBM-3090.                                00600015
006100                                                                  00610015
006200 INPUT-OUTPUT SECTION.                                            00620015
006300                                                                  00630015
006400 FILE-CONTROL.                                                    00640015
006500                                                                  00650015
006600     SELECT POS-DATE-CARD-FILE                                    00660015
006700         ASSIGN TO INP01.                                         00670015
006800                                                                  00680015
006900     SELECT KOHLS-REPORT-FILE                                     00690015
007000         ASSIGN TO RPT01.                                         00700015
007100                                                                  00710015
007200 EJECT                                                            00720015
007300******************************************************************00730015
007400 DATA DIVISION.                                                   00740015
007500******************************************************************00750015
007600                                                                  00760015
007700 FILE SECTION.                                                    00770015
007800                                                                  00780015
007900 FD  POS-DATE-CARD-FILE                                           00790015
008000     RECORDING MODE IS F                                          00800015
008100     BLOCK CONTAINS 0 RECORDS                                     00810015
008200     LABEL RECORDS ARE STANDARD.                                  00820015
008300                                                                  00830015
008400 01  POS-DATE-CARD-RECORD            PIC X(80).                   00840015
008500                                                                  00850015
008600 FD  KOHLS-REPORT-FILE                                            00860015
008700     RECORDING MODE IS F                                          00870015
008800     BLOCK CONTAINS 0  RECORDS.                                   00880015
008900                                                                  00890015
009000 01  KOHLS-REPORT-RECORD             PIC  X(132).                 00900015
009100                                                                  00910015
009200 EJECT                                                            00920015
009300******************************************************************00930015
009400 WORKING-STORAGE SECTION.                                         00940015
009500******************************************************************00950015
009600 01  FILLER                            PIC X(50)  VALUE           00960015
009700     ' *** WORKING STORAGE STARTS HERE FOR SAKRP021 *** '.        00970015
009800                                                                  00980015
009900******************************************************************00990015
010000* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01000015
010100******************************************************************01010015
010200 01  CC-CONTROL-CARD.                                             01020015
010300     05  CC-CONTROL-CARD-DISPLAY.                                 01030015
010400         10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        01040015
010500             88  CC-VALID-CONTROL-NAME        VALUE               01050015
010600                 'P.O.S. DATE = '.                                01060015
010700         10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         01070015
010800     05  FILLER                  PIC X(60)    VALUE SPACE.        01080015
010900                                                                  01090015
011000******************************************************************01100015
011100*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01110015
011200******************************************************************01120015
011300     COPY DPWS500.                                                01130015
011400                                                                  01140015
011500 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01150015
011600                                                  COMP SYNC.      01160015
011700     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01170015
011800     88  AC-DB2-ERROR                             VALUE +4013.    01180015
011900     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01190015
012000                                                                  01200015
012100 01  ABEND-CODE                        PIC S9(04) VALUE ZERO      01210015
012200                                                  COMP SYNC.      01220015
012300                                                                  01230015
012400 EJECT                                                            01240015
012500 01  PS-PROGRAM-SWITCHES.                                         01250015
012600     05  PS-END-OF-CURSOR-SW           PIC X(01)  VALUE 'N'.      01260015
012700         88  PS-END-OF-CURSOR                     VALUE 'Y'.      01270015
012800     05  PS-END-OF-PYMT-CURSOR-SW      PIC X(01)  VALUE 'N'.      01280015
012900         88  PS-END-OF-PYMT-CURSOR                VALUE 'Y'.      01290015
013000     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01300015
013100         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01310015
013200     05  PS-USE-CURSOR-SW              PIC X(01)  VALUE SPACE.    01320015
013300         88  PS-USE-REGULAR-CURSOR                VALUE 'R'.      01330015
013400         88  PS-USE-PYMT-CURSOR                   VALUE 'P'.      01340015
013500     05  PS-TENDER-SW                  PIC X(01)  VALUE 'N'.      01350015
013600         88  PS-TENDER                            VALUE 'Y'.      01360015
013700         88  PS-ACCOUNT                           VALUE 'N'.      01370015
013800                                                                  01380015
013900 01  PC-CONSTANTS.                                                01390015
014000     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01400015
014100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01410015
014200                                                   COMP SYNC.     01420015
014300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01430015
014400                                                   'SAKRP021'.    01440015
014500     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01450015
014600     05  PC-SYSTEM-CORRECTION        PIC  X(01)    VALUE 'S'.     01460015
014700     05  PC-REVERSAL-CORRECTION      PIC  X(01)    VALUE 'R'.     01470015
014800     05  PC-NEGATIVE-ONE             PIC S9(01)    VALUE -1.      01480015
014900                                                                  01490015
015000 EJECT                                                            01500015
015100 01  PV-MISC-COUNT-FIELDS            COMP-3.                      01510015
015200     05  PV-PAGE-CNT                 PIC S9(05)    VALUE ZERO.    01520015
015300     05  PV-LINE-CNT                 PIC S9(03)    VALUE ZERO.    01530015
015400     05  PV-LINE-CNT-AHEAD           PIC S9(03)    VALUE ZERO.    01540015
015500     05  PV-CURSOR-CNT               PIC S9(07)    VALUE ZERO.    01550015
015600     05  PV-PYMT-CURSOR-CNT          PIC S9(07)    VALUE ZERO.    01560015
015700                                                                  01570015
015800 01  PV-DB2-VARIABLES.                                            01580015
015900     05  PV-DB2-PARTN-NBR            PIC S9(04)    COMP           01590015
016000                                                   VALUE ZERO.    01600015
016100     05  PV-DB2-STR-NBR              PIC S9(04)    COMP           01610015
016200                                                   VALUE ZERO.    01620015
016300     05  PV-DB2-RGST-ID              PIC S9(04)    COMP           01630015
016400                                                   VALUE ZERO.    01640015
016500     05  PV-DB2-TRN-NBR              PIC S9(04)    COMP           01650015
016600                                                   VALUE ZERO.    01660015
016700     05  PV-DB2-STRT-TM              PIC  X(08)    VALUE SPACE.   01670015
016800     05  PV-DB2-SLS-CORR-SEQ-NBR     PIC S9(04)    COMP           01680015
016900                                                   VALUE ZERO.    01690015
017000     05  PV-DB2-TRN-STAT-CDE         PIC  X(02)    VALUE SPACE.   01700015
017100     05  PV-DB2-SLS-DTE              PIC  X(10)    VALUE SPACE.   01710015
017200     05  PV-DB2-ASSOC-ID             PIC S9(09)    COMP           01720015
017300                                                   VALUE ZERO.    01730015
017400                                                                  01740015
017500******************************************************************01750015
017600*  ACCUMULATORS TO HOLD STORE AND COMPANY DOLLAR AMOUNTS.         01760015
017700******************************************************************01770015
017800 01  PA-PROGRAM-ACCUMULATORS.                                     01780015
017900     05  PA-STORE-SALES-AMOUNT       PIC S9(07)V99  VALUE ZERO    01790015
018000                                         COMP-3.                  01800015
018100     05  PA-STORE-RETURN-AMOUNT      PIC S9(07)V99  VALUE ZERO    01810015
018200                                         COMP-3.                  01820015
018300     05  PA-STORE-PYMT-AMOUNT        PIC S9(07)V99  VALUE ZERO    01830015
018400                                         COMP-3.                  01840015
018500     05  PA-COMPANY-SALES-AMOUNT     PIC S9(07)V99  VALUE ZERO    01850015
018600                                         COMP-3.                  01860015
018700     05  PA-COMPANY-RETURN-AMOUNT    PIC S9(07)V99  VALUE ZERO    01870015
018800                                         COMP-3.                  01880015
018900     05  PA-COMPANY-PYMT-AMOUNT      PIC S9(07)V99  VALUE ZERO    01890015
019000                                         COMP-3.                  01900015
019100                                                                  01910015
019200 01  PV-MISC-FIELDS.                                              01920015
019300     05  PV-PRINT-RECORD             PIC X(132)    VALUE SPACE.   01930015
019400     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01940015
019500                                                   COMP SYNC.     01950015
019600     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01960015
019700     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01970015
019800     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01980015
019900     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01990015
020000     05  PV-EDIT-MASK                PIC  Z,ZZZ,ZZ9.              02000015
020100     05  PV-HOLD-STORE               PIC  S9(04)  COMP VALUE ZERO.02010015
020200     05  PV-HOLD-SALES-DATE          PIC   X(10)  VALUE SPACE.    02020015
020300     05  PV-AMOUNT                   PIC  S9(07)V99 COMP-3        02030015
020400                                          VALUE ZERO.             02040015
020500     05  PV-AMOUNT-FORMATTED         PIC   ZZ,ZZ9.99-.            02050015
020600     05  PV-TNDR-ID                  PIC   X(33)  VALUE SPACE.    02060015
020700     05  PV-TNDR-SPACES              PIC   9(09)  VALUE ZERO.     02070015
020800     05  PV-TNDR-LEN                 PIC   9(09)  VALUE ZERO.     02080015
020900     05  PV-PARTN-NBR                PIC   9(04)  VALUE ZERO.     02090015
021000     05  PV-STRT-TM                  PIC   X(08)  VALUE SPACE.    02100015
021100     05  PV-CARD-NBR-16.                                          02110015
021200         10  PV-CARD-NBR-16-FIRST-4  PIC   X(04)  VALUE SPACE.    02120015
021300         10  FILLER                  PIC   X(01)  VALUE '-'.      02130015
021400         10  PV-CARD-NBR-16-SECOND-4 PIC   X(04)  VALUE SPACE.    02140015
021500         10  FILLER                  PIC   X(01)  VALUE '-'.      02150015
021600         10  PV-CARD-NBR-16-THIRD-4  PIC   X(04)  VALUE SPACE.    02160015
021700         10  FILLER                  PIC   X(01)  VALUE '-'.      02170015
021800         10  PV-CARD-NBR-16-LAST-4   PIC   X(04)  VALUE SPACE.    02180015
021900     05  PV-CARD-NBR-13.                                          02190015
022000         10  PV-CARD-NBR-13-FIRST-4  PIC   X(04)  VALUE SPACE.    02200015
022100         10  FILLER                  PIC   X(01)  VALUE '-'.      02210015
022200         10  PV-CARD-NBR-13-SECOND-3 PIC   X(03)  VALUE SPACE.    02220015
022300         10  FILLER                  PIC   X(01)  VALUE '-'.      02230015
022400         10  PV-CARD-NBR-13-THIRD-2  PIC   X(02)  VALUE SPACE.    02240015
022500         10  PV-CARD-NBR-13-THIRD-1  PIC   X(01)  VALUE SPACE.    02250015
022600         10  FILLER                  PIC   X(01)  VALUE '-'.      02260015
022700         10  PV-CARD-NBR-13-LAST-3   PIC   X(03)  VALUE SPACE.    02270015
022800         10  FILLER                  PIC   X(03)  VALUE SPACE.    02280015
022900     05  PV-CARD-NBR-12.                                          02290015
023000         10  PV-CARD-NBR-12-FIRST-4  PIC   X(04)  VALUE SPACE.    02300015
023100         10  FILLER                  PIC   X(01)  VALUE '-'.      02310015
023200         10  PV-CARD-NBR-12-SECOND-3 PIC   X(03)  VALUE SPACE.    02320015
023300         10  PV-CARD-NBR-12-THIRD-1  PIC   X(01)  VALUE SPACE.    02330015
023400         10  FILLER                  PIC   X(01)  VALUE '-'.      02340015
023500         10  PV-CARD-NBR-12-THIRD-2  PIC   X(02)  VALUE SPACE.    02350015
023600         10  FILLER                  PIC   X(01)  VALUE '-'.      02360015
023700         10  PV-CARD-NBR-12-LAST-2   PIC   X(02)  VALUE SPACE.    02370015
023800         10  FILLER                  PIC   X(04)  VALUE SPACE.    02380015
023900     05  PV-CARD-NBR-18.                                          02390015
024000         10  PV-CARD-NBR-18-FIRST-3  PIC   X(03)  VALUE SPACE.    02400015
024100         10  FILLER                  PIC   X(01)  VALUE '-'.      02410015
024200         10  PV-CARD-NBR-18-SECOND-4 PIC   X(04)  VALUE SPACE.    02420015
024300         10  FILLER                  PIC   X(01)  VALUE '-'.      02430015
024400         10  PV-CARD-NBR-18-THIRD-1  PIC   X(01)  VALUE SPACE.    02440015
024500         10  FILLER                  PIC   X(01)  VALUE '-'.      02450015
024600         10  PV-CARD-NBR-18-THIRD-2  PIC   X(02)  VALUE SPACE.    02460015
024700         10  PV-CARD-NBR-18-LAST-2   PIC   X(02)  VALUE SPACE.    02470015
024800         10  FILLER                  PIC   X(04)  VALUE SPACE.    02480015
024900 01  PV-DATE-AND-TIME-FIELDS.                                     02490015
025000     05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   02500015
025100     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      02510015
025200         10  PV-POS-CCYY             PIC X(04).                   02520015
025300         10  FILLER                  PIC X(01).                   02530015
025400         10  PV-POS-MM               PIC X(02).                   02540015
025500         10  FILLER                  PIC X(01).                   02550015
025600         10  PV-POS-DD               PIC X(02).                   02560015
025700     05  PV-CURR-DATE-CCYYMMDD.                                   02570015
025800         10  PV-CURR-DATE-CCYY       PIC  9(04).                  02580015
025900         10  PV-CURR-DATE-MM         PIC  9(02).                  02590015
026000         10  PV-CURR-DATE-DD         PIC  9(02).                  02600015
026100     05  PV-CURR-TIME.                                            02610015
026200         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    02620015
026300         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    02630015
026400         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    02640015
026500     05  PV-POS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   02650015
026600     05  PV-SLS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   02660015
026700 EJECT                                                            02670015
026800******************************************************************02680015
026900*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  02690015
027000******************************************************************02700015
027100     COPY DPWS132.                                                02710015
027200                                                                  02720015
027300******************************************************************02730015
027400*  HEADING LINES FOR THE KOHLS CORRECTIONS REPORT.                02740015
027500******************************************************************02750015
027600 01  HL2-HEADING-LINE-2.                                          02760015
027700     05  FILLER                      PIC  X(35)    VALUE SPACE.   02770015
027800     05  FILLER                      PIC  X(14)    VALUE          02780015
027900                                          'KOHLS COBRAND '.       02790015
028000     05  FILLER                      PIC  X(12)    VALUE          02800015
028100                                          'CORRECTIONS '.         02810015
028200     05  FILLER                      PIC  X(10)    VALUE          02820015
028300                                          'AUDIT FOR '.           02830015
028400     05  FILLER                      PIC  X(11)    VALUE          02840015
028500                                          'PROCESSING '.          02850015
028600     05  FILLER                      PIC  X(06)    VALUE          02860015
028700                                          'DATE: '.               02870015
028800     05  HL2-DATE                    PIC  X(10)    VALUE SPACE.   02880015
028900     05  FILLER                      PIC  X(35)    VALUE SPACE.   02890015
029000                                                                  02900015
029100 01  HL3-HEADING-LINE-3.                                          02910015
029200     05  FILLER                      PIC  X(59)    VALUE ALL '-'. 02920015
029300     05  FILLER                      PIC  X(09)    VALUE          02930015
029400                                          ' STORE # '.            02940015
029500     05  HL3-STORE                   PIC  Z999.                   02950015
029600     05  FILLER                      PIC  X(01)    VALUE SPACE.   02960015
029700     05  FILLER                      PIC  X(59)    VALUE ALL '-'. 02970015
029800                                                                  02980015
029900 01  HL4-HEADING-LINE-4.                                          02990015
030000     05  FILLER                      PIC  X(42)    VALUE SPACE.   03000015
030100     05  FILLER                      PIC  X(04)    VALUE 'AUTH'.  03010015
030200     05  FILLER                      PIC  X(86)    VALUE SPACE.   03020015
030300                                                                  03030015
030400 01  HL5-HEADING-LINE-5.                                          03040015
030500     05  FILLER                      PIC  X(10)    VALUE          03050015
030600                                                   'SALES DATE'.  03060015
030700     05  FILLER                      PIC  X(04)    VALUE SPACE.   03070015
030800     05  FILLER                      PIC  X(05)    VALUE 'REG #'. 03080015
030900     05  FILLER                      PIC  X(02)    VALUE SPACE.   03090015
031000     05  FILLER                      PIC  X(07)    VALUE          03100015
031100                                                   'TRANS #'.     03110015
031200     05  FILLER                      PIC  X(02)    VALUE SPACE.   03120015
031300     05  FILLER                      PIC  X(08)    VALUE          03130015
031400                                                   'ASSOC ID'.    03140015
031500     05  FILLER                      PIC  X(02)    VALUE SPACE.   03150015
031600     05  FILLER                      PIC  X(06)    VALUE          03160015
031700                                                   'NUMBER'.      03170015
031800     05  FILLER                      PIC  X(11)    VALUE SPACE.   03180015
031900     05  FILLER                      PIC  X(06)    VALUE          03190015
032000                                                   'ACCT #'.      03200015
032100     05  FILLER                      PIC  X(12)    VALUE SPACE.   03210015
032200     05  FILLER                      PIC  X(04)    VALUE          03220015
032300                                                   'CODE'.        03230015
032400     05  FILLER                      PIC  X(06)    VALUE SPACE.   03240015
032500     05  FILLER                      PIC  X(05)    VALUE          03250015
032600                                                   'SALES'.       03260015
032700     05  FILLER                      PIC  X(04)    VALUE SPACE.   03270015
032800     05  FILLER                      PIC  X(07)    VALUE          03280015
032900                                                   'RETURNS'.     03290015
033000     05  FILLER                      PIC  X(04)    VALUE SPACE.   03300015
033100     05  FILLER                      PIC  X(08)    VALUE          03310015
033200                                                   'PAYMENTS'.    03320015
033300     05  FILLER                      PIC  X(04)    VALUE SPACE.   03330015
033400     05  FILLER                      PIC  X(10)    VALUE          03340015
033500                                                   'NET AMOUNT'.  03350015
033600     05  FILLER                      PIC  X(05)    VALUE SPACE.   03360015
033700                                                                  03370015
033800 01  HL6-HEADING-LINE-6.                                          03380015
033900     05  FILLER                      PIC  X(04)    VALUE SPACE.   03390015
034000     05  FILLER                      PIC  X(08)    VALUE          03400015
034100                                          'STORE # '.             03410015
034200     05  HL6-STORE                   PIC  Z999.                   03420015
034300     05  FILLER                      PIC  X(11)    VALUE          03430015
034400                                          ' TOTAL FOR '.          03440015
034500     05  HL6-DATE                    PIC  X(10)    VALUE SPACE.   03450015
034600     05  FILLER                      PIC  X(44)    VALUE SPACE.   03460015
034700     05  HL6-SALES-TOTAL             PIC  X(10)    VALUE SPACE.   03470015
034800     05  FILLER                      PIC  X(01)    VALUE SPACE.   03480015
034900     05  HL6-RETURN-TOTAL            PIC  X(10)    VALUE SPACE.   03490015
035000     05  FILLER                      PIC  X(02)    VALUE SPACE.   03500015
035100     05  HL6-PYMT-AMOUNT             PIC  X(10)    VALUE SPACE.   03510015
035200     05  FILLER                      PIC  X(04)    VALUE SPACE.   03520015
035300     05  HL6-NET-AMOUNT              PIC  X(10)    VALUE SPACE.   03530015
035400     05  FILLER                      PIC  X(04)    VALUE SPACE.   03540015
035500                                                                  03550015
035600******************************************************************03560015
035700*  DETAIL LINE PRINTED ON THE REPORT.                             03570015
035800******************************************************************03580015
035900 01  DL1-DETAIL-LINE-1.                                           03590015
036000     05  DL1-SALES-DATE              PIC  X(10)    VALUE SPACE.   03600015
036100     05  FILLER                      PIC  X(04)    VALUE SPACE.   03610015
036200     05  DL1-REGISTER                PIC  9(04)    VALUE ZERO.    03620015
036300     05  FILLER                      PIC  X(04)    VALUE SPACE.   03630015
036400     05  DL1-TRANSACTION             PIC  9(04)    VALUE ZERO.    03640015
036500     05  FILLER                      PIC  X(04)    VALUE SPACE.   03650015
036600     05  DL1-ASSOC-ID                PIC  X(08)    VALUE SPACE.   03660015
036700     05  FILLER                      PIC  X(02)    VALUE SPACE.   03670015
036800     05  DL1-AUTH-NBR                PIC  X(06)    VALUE SPACE.   03680015
036900     05  FILLER                      PIC  X(02)    VALUE SPACE.   03690015
037000     05  DL1-BIN-NUMBER              PIC  X(06)    VALUE SPACE.   03700015
037100     05  DL1-CARD-NBR                PIC  X(19)    VALUE SPACE.   03710015
037200     05  FILLER                      PIC  X(03)    VALUE SPACE.   03720015
037300     05  DL1-CODE                    PIC  X(01)    VALUE SPACE.   03730015
037400     05  FILLER                      PIC  X(04)    VALUE SPACE.   03740015
037500     05  DL1-SALES-AMOUNT            PIC  X(10)    VALUE SPACE.   03750015
037600     05  FILLER                      PIC  X(01)    VALUE SPACE.   03760015
037700     05  DL1-RETURN-AMOUNT           PIC  X(10)    VALUE SPACE.   03770015
037800     05  FILLER                      PIC  X(02)    VALUE SPACE.   03780015
037900     05  DL1-PYMT-AMOUNT             PIC  X(10)    VALUE SPACE.   03790015
038000     05  FILLER                      PIC  X(12)    VALUE SPACE.   03800015
038100                                                                  03810015
038200 EJECT                                                            03820015
038300******************************************************************03830015
038400*  TOTAL LINE PRINTED AT THE END OF THE REPORT                    03840015
038500******************************************************************03850015
038600 01 TL1-TOTAL-LINE-1.                                             03860015
038700    05  FILLER                       PIC X(01) VALUE SPACE.       03870015
038800    05  FILLER                       PIC X(08) VALUE              03880015
038900                                         'COMPANY '.              03890015
039000    05  FILLER                       PIC X(10) VALUE              03900015
039100                                         'TOTAL FOR '.            03910015
039200    05  FILLER                       PIC X(04) VALUE              03920015
039300                                         'ALL '.                  03930015
039400    05  FILLER                       PIC X(12) VALUE              03940015
039500                                         'CORRECTIONS '.          03950015
039600    05  FILLER                       PIC X(11) VALUE              03960015
039700                                         'ENTERED ON '.           03970015
039800    05  TL1-DATE                     PIC X(10) VALUE SPACE.       03980015
039900    05  FILLER                       PIC X(24) VALUE SPACE.       03990015
040000    05  TL1-SALES-AMOUNT             PIC ZZZ,ZZ9.99-.             04000015
040100    05  TL1-RETURN-AMOUNT            PIC ZZZ,ZZ9.99-.             04010015
040200    05  FILLER                       PIC X(01) VALUE SPACE.       04020015
040300    05  TL1-PYMT-AMOUNT              PIC ZZZ,ZZ9.99-.             04030015
040400    05  FILLER                       PIC X(03) VALUE SPACE.       04040015
040500    05  TL1-NET-AMOUNT               PIC ZZZ,ZZ9.99-.             04050015
040600    05  FILLER                       PIC X(04) VALUE SPACE.       04060015
040700                                                                  04070015
040800******************************************************************04080015
040900*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            04090015
041000******************************************************************04100015
041100     COPY DPWS004.                                                04110015
041200 EJECT                                                            04120015
041300******************************************************************04130015
041400*  DB2 COMMUNICATION AREA.                                        04140015
041500******************************************************************04150015
041600     EXEC SQL                                                     04160015
041700          INCLUDE SQLCA                                           04170015
041800     END-EXEC.                                                    04180015
041900 EJECT                                                            04190015
042000******************************************************************04200015
042100*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           04210015
042200******************************************************************04220015
042300     EXEC SQL                                                     04230015
042400          INCLUDE TEPTRN                                          04240015
042500     END-EXEC.                                                    04250015
042600 EJECT                                                            04260015
042700******************************************************************04270015
042800*  DB2 TABLE TEPPART - PARTITION TABLE                            04280015
042900******************************************************************04290015
043000     EXEC SQL                                                     04300015
043100          INCLUDE TEPPART                                         04310015
043200     END-EXEC.                                                    04320015
043300 EJECT                                                            04330015
043400******************************************************************04340015
043500*  DB2 TABLE TEPTND - TENDER TABLE                                04350015
043600******************************************************************04360015
043700     EXEC SQL                                                     04370015
043800          INCLUDE TEPTND                                          04380015
043900     END-EXEC.                                                    04390015
044000 EJECT                                                            04400015
044100******************************************************************04410015
044200*  DB2 TABLE TEPCRD - CREDIT TENDER TABLE                         04420015
044300******************************************************************04430015
044400     EXEC SQL                                                     04440015
044500          INCLUDE TEPCRD                                          04450015
044600     END-EXEC.                                                    04460015
044700 EJECT                                                            04470015
044800******************************************************************04480015
044900*  DB2 TABLE TEPDKEY - CURRENT PROCESSING DAY KEYS                04490015
045000******************************************************************04500015
045100     EXEC SQL                                                     04510015
045200          INCLUDE TEPDKEY                                         04520015
045300     END-EXEC.                                                    04530015
045400 EJECT                                                            04540015
045500******************************************************************04550015
045600*  DB2 TABLE TEPSAT - SALES AUDIT USER ID TABLE                   04560015
045700******************************************************************04570015
045800     EXEC SQL                                                     04580015
045900          INCLUDE TEPSAT                                          04590015
046000     END-EXEC.                                                    04600015
046100 EJECT                                                            04610015
046200******************************************************************04620015
046300*  DB2 TABLE TEPPAY - KOHLS PAYMENT TABLE                         04630015
046400******************************************************************04640015
046500     EXEC SQL                                                     04650015
046600          INCLUDE TEPPAY                                          04660015
046700     END-EXEC.                                                    04670015
046800 EJECT                                                            04680015
046900******************************************************************04690015
047000*  CURSOR TO RETRIEVE KOHLS CORRECTION DATA                       04700015
047100******************************************************************04710015
047200     EXEC SQL                                                     04720015
047300       DECLARE COBRAND-CURSOR CURSOR FOR                          04730015
047400            SELECT  T.PARTN_NBR                                   04740015
047500                   ,T.STR_NBR                                     04750015
047600                   ,T.RGST_ID                                     04760015
047700                   ,T.TRN_NBR                                     04770015
047800                   ,T.STRT_TM                                     04780015
047900                   ,T.SLS_CORR_SEQ_NBR                            04790015
048000                   ,TRN_STAT_CDE                                  04800015
048100                   ,T.SLS_DTE                                     04810015
048200                   ,ASSOC_ID                                      04820015
048300                   ,TNDR_ID                                       04830015
048400                   ,TNDR_AMT                                      04840015
048500                   ,TNDR_ID_LEN_NBR                               04850015
048600                   ,AUTH_NBR                                      04860015
048700            FROM    TEPDKEY D                                     04870015
048800                   ,TEPTRN T                                      04880015
048900                   ,TEPTND N                                      04890015
049000                   ,TEPCRD C                                      04900015
049100                   ,TEPPART A                                     04910015
049200            WHERE   D.PRCG_DTE         = :EPDKEY-PRCG-DTE         04920015
049300              AND   D.SLS_DTE          = A.SLS_DTE                04930015
049400              AND   A.PARTN_NBR        = T.PARTN_NBR              04940015
049500              AND   D.STR_NBR          = T.STR_NBR                04950015
049600              AND   D.RGST_ID          = T.RGST_ID                04960015
049700              AND   D.TRN_NBR          = T.TRN_NBR                04970015
049800              AND   D.STRT_TM          = T.STRT_TM                04980015
049900              AND   D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR       04990015
050000              AND   T.PARTN_NBR        = N.PARTN_NBR              05000015
050100              AND   T.STR_NBR          = N.STR_NBR                05010015
050200              AND   T.RGST_ID          = N.RGST_ID                05020015
050300              AND   T.TRN_NBR          = N.TRN_NBR                05030015
050400              AND   T.STRT_TM          = N.STRT_TM                05040015
050500              AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR       05050015
050600              AND   N.PARTN_NBR        = C.PARTN_NBR              05060015
050700              AND   N.STR_NBR          = C.STR_NBR                05070015
050800              AND   N.RGST_ID          = C.RGST_ID                05080015
050900              AND   N.TRN_NBR          = C.TRN_NBR                05090015
051000              AND   N.STRT_TM          = C.STRT_TM                05100015
051100              AND   N.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR       05110015
051200              AND   N.TNDR_SEQ_NBR     = C.TNDR_SEQ_NBR           05120015
051300              AND   D.SLS_CORR_SEQ_NBR <> 0                       05130015
051400              AND   VOID_ABRT_CDE      = 'N'                      05140015
051500              AND   TRN_STAT_CDE       IN ('V', 'R', 'L', 'Z')    05150015
051600              AND   TNDR_TYP_CDE       = '24'                     05160015
051700              AND   TNDR_VOID_IND      = 'N'                      05170015
051800              AND   STTLMNT_PRCD_CDE   = 'P'                      05180015
051900           ORDER BY T.STR_NBR                                     05190015
052000                   ,T.SLS_DTE                                     05200015
052100                   ,T.RGST_ID                                     05210015
052200                   ,T.TRN_NBR                                     05220015
052300           WITH UR                                                05230015
052400     END-EXEC.                                                    05240015
052500                                                                  05250015
052600******************************************************************05260015
052700*  CURSOR TO RETRIEVE KOHLS PAYMENT CORRECTION DATA               05270015
052800******************************************************************05280015
052900                                                                  05290015
053000     EXEC SQL                                                     05300015
053100       DECLARE COBRAND-PYMT-CURSOR CURSOR FOR                     05310015
053200            SELECT  T.PARTN_NBR                                   05320015
053300                   ,T.STR_NBR                                     05330015
053400                   ,T.RGST_ID                                     05340015
053500                   ,T.TRN_NBR                                     05350015
053600                   ,T.STRT_TM                                     05360015
053700                   ,T.SLS_CORR_SEQ_NBR                            05370015
053800                   ,TRN_STAT_CDE                                  05380015
053900                   ,T.SLS_DTE                                     05390015
054000                   ,ASSOC_ID                                      05400015
054100                   ,KC_ACCT_NBR                                   05410015
054200                   ,PAYT_AMT                                      05420015
054300                   ,AUTH_NBR                                      05430015
054400            FROM    TEPDKEY D                                     05440015
054500                   ,TEPTRN T                                      05450015
054600                   ,TEPPAY P                                      05460015
054700                   ,TEPPART A                                     05470015
054800            WHERE   D.PRCG_DTE         = :EPDKEY-PRCG-DTE         05480015
054900              AND   D.SLS_DTE          = A.SLS_DTE                05490015
055000              AND   A.PARTN_NBR        = T.PARTN_NBR              05500015
055100              AND   D.STR_NBR          = T.STR_NBR                05510015
055200              AND   D.RGST_ID          = T.RGST_ID                05520015
055300              AND   D.TRN_NBR          = T.TRN_NBR                05530015
055400              AND   D.STRT_TM          = T.STRT_TM                05540015
055500              AND   D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR       05550015
055600              AND   T.PARTN_NBR        = P.PARTN_NBR              05560015
055700              AND   T.STR_NBR          = P.STR_NBR                05570015
055800              AND   T.RGST_ID          = P.RGST_ID                05580015
055900              AND   T.TRN_NBR          = P.TRN_NBR                05590015
056000              AND   T.STRT_TM          = P.STRT_TM                05600015
056100              AND   T.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR       05610015
056200              AND   D.SLS_CORR_SEQ_NBR <> 0                       05620015
056300              AND   VOID_ABRT_CDE      = 'N'                      05630015
056400              AND   TRN_STAT_CDE       IN ('V', 'R', 'L', 'Z')    05640015
056500              AND   COBRND_IND         = 'Y'                      05650015
056600              AND   STTLMNT_PRCD_CDE   = 'P'                      05660015
056700           ORDER BY T.STR_NBR                                     05670015
056800                   ,T.SLS_DTE                                     05680015
056900                   ,T.RGST_ID                                     05690015
057000                   ,T.TRN_NBR                                     05700015
057100           WITH UR                                                05710015
057200     END-EXEC.                                                    05720015
057300                                                                  05730015
057400******************************************************************05740015
057500* PROCEDURE DIVISION.                                             05750015
057600******************************************************************05760015
057700 PROCEDURE DIVISION.                                              05770015
057800                                                                  05780015
057900******************************************************************05790015
058000* 0000-MAINLINE-PARAGRAPH                                         05800015
058100*      PRODUCE KOHLS CORRECTIONS REPORT                           05810015
058200******************************************************************05820015
058300 0000-MAINLINE-PARAGRAPH.                                         05830015
058400                                                                  05840015
058500     PERFORM 1000-INITIALIZE-PROGRAM.                             05850015
058600                                                                  05860015
058700     PERFORM 2000-PRODUCE-REPORT-LINES                            05870015
058800         UNTIL (PS-END-OF-CURSOR AND PS-END-OF-PYMT-CURSOR).      05880015
058900                                                                  05890015
059000     IF (PV-CURSOR-CNT             GREATER THAN ZERO)             05900015
059100       OR (PV-PYMT-CURSOR-CNT      GREATER THAN ZERO)             05910015
059200         PERFORM 5400-PRINT-STORE-TOTAL-LINE                      05920015
059300     END-IF.                                                      05930015
059400                                                                  05940015
059500     PERFORM 4000-PRINT-REPORT-TOTALS.                            05950015
059600                                                                  05960015
059700     DISPLAY '****************************************'           05970015
059800     DISPLAY '*************** SAKRP021 ***************'           05980015
059900     DISPLAY '****************************************'           05990015
060000     MOVE PV-CURSOR-CNT          TO PV-EDIT-MASK                  06000015
060100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          06010015
060200     DISPLAY 'CORRECTION ROWS FETCHED........'                    06020015
060300         PV-EDIT-MASK.                                            06030015
060400     MOVE PV-PYMT-CURSOR-CNT       TO PV-EDIT-MASK.               06040015
060500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         06050015
060600     DISPLAY 'PAYMENT ROWS FETCHED...........'                    06060015
060700         PV-EDIT-MASK.                                            06070015
060800     DISPLAY '****************************************'           06080015
060900     DISPLAY '****************************************'           06090015
061000     DISPLAY '****************************************'           06100015
061100                                                                  06110015
061200     STOP RUN.                                                    06120015
061300                                                                  06130015
061400 EJECT                                                            06140015
061500                                                                  06150015
061600******************************************************************06160015
061700* 1000-INITIALIZE-PROGRAM                                         06170015
061800*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,   06180015
061900*     OPEN KOHLS-CUROSR, ATTEMPT FIRST FETCH OF CURSOR            06190015
062000******************************************************************06200015
062100 1000-INITIALIZE-PROGRAM.                                         06210015
062200                                                                  06220015
062300     OPEN INPUT  POS-DATE-CARD-FILE                               06230015
062400          OUTPUT KOHLS-REPORT-FILE.                               06240015
062500                                                                  06250015
062600     PERFORM 1100-PROCESS-CONTROL-CARD.                           06260015
062700                                                                  06270015
062800     PERFORM 1200-FORMAT-HEADINGS.                                06280015
062900                                                                  06290015
063000     PERFORM 1300-PREPARE-FOR-REPORT.                             06300015
063100                                                                  06310015
063200******************************************************************06320015
063300* 1100-PROCESS-CONTROL-CARD                                       06330015
063400*     READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL   06340015
063500*     DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.  06350015
063600******************************************************************06360015
063700 1100-PROCESS-CONTROL-CARD.                                       06370015
063800                                                                  06380015
063900     PERFORM 1110-READ-POS-DATE-CARD-FILE.                        06390015
064000     CLOSE POS-DATE-CARD-FILE.                                    06400015
064100     IF PS-END-OF-CARD-FILE                                       06410015
064200         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   06420015
064300         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  06430015
064400         SET AC-CONTROL-CARD-ERROR TO TRUE                        06440015
064500         PERFORM 9999-ABEND                                       06450015
064600     END-IF.                                                      06460015
064700     DISPLAY PC-CURRENT-PROGRAM-NAME                              06470015
064800             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  06480015
064900     PERFORM 1115-CONVERT-INPUT-DATE.                             06490015
065000 EJECT                                                            06500015
065100                                                                  06510015
065200******************************************************************06520015
065300* 1110-READ-POS-DATE-CARD-FILE                                    06530015
065400*     READ DATE CONTROL CARD.                                     06540015
065500******************************************************************06550015
065600 1110-READ-POS-DATE-CARD-FILE.                                    06560015
065700     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 06570015
065800        AT END                                                    06580015
065900           SET PS-END-OF-CARD-FILE TO TRUE.                       06590015
066000                                                                  06600015
066100******************************************************************06610015
066200* 1115-CONVERT-INPUT-DATE                                         06620015
066300*     CALL KOHLS CALENDAR ROUTINE:                                06630015
066400*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            06640015
066500*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 06650015
066600******************************************************************06660015
066700                                                                  06670015
066800 1115-CONVERT-INPUT-DATE.                                         06680015
066900                                                                  06690015
067000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06700015
067100                                                                  06710015
067200     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   06720015
067300     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   06730015
067400     SET  DPG52-LK-DTE-GREG            TO TRUE.                   06740015
067500     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    06750015
067600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06760015
067700                                             DPG54 DPG55 DPG56.   06770015
067800     EVALUATE TRUE                                                06780015
067900         WHEN DPG54-SEVERE-ERROR                                  06790015
068000         WHEN DPG54-DATE-INVALID                                  06800015
068100             MOVE '1115-CONVERT-INPUT-DATE'                       06810015
068200                                   TO PV-PARAGRAPH-NAME           06820015
068300             MOVE 'ERROR CONVERTING INPUT CARD DATE'              06830015
068400                                   TO PV-OPERATION-MSG-1          06840015
068500             SET AC-CALENDAR-ROUTINE-ERROR                        06850015
068600                                   TO TRUE                        06860015
068700             MOVE DPG54-ERROR-MESSAGE                             06870015
068800                                   TO PV-OPERATION-MSG-2          06880015
068900             PERFORM 9999-ABEND                                   06890015
069000     END-EVALUATE.                                                06900015
069100                                                                  06910015
069200     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-POS-CCYY-MM-DD           06920015
069300                                      EPDKEY-PRCG-DTE.            06930015
069400     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-POS-DATE-FORMATTED.      06940015
069500                                                                  06950015
069600******************************************************************06960015
069700* 1200-FORMAT-HEADINGS                                            06970015
069800*     GET CURRENT DATE AND TIME FROM SYSTEM.                      06980015
069900*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          06990015
070000*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              07000015
070100******************************************************************07010015
070200 1200-FORMAT-HEADINGS.                                            07020015
070300                                                                  07030015
070400     MOVE FUNCTION CURRENT-DATE (1:8)                             07040015
070500                                   TO PV-CURR-DATE-CCYYMMDD.      07050015
070600     ACCEPT PV-CURR-TIME FROM TIME.                               07060015
070700                                                                  07070015
070800     MOVE PV-CURR-DATE-MM          TO DP132-RUN-MONTH.            07080015
070900     MOVE PV-CURR-DATE-DD          TO DP132-RUN-DAY.              07090015
071000     MOVE PV-CURR-DATE-CCYY        TO DP132-RUN-YEAR.             07100015
071100                                                                  07110015
071200     MOVE PV-CURR-TIME-HH          TO DP132-RUN-HOUR.             07120015
071300     MOVE PV-CURR-TIME-MM          TO DP132-RUN-MINUTE.           07130015
071400     MOVE PC-CURRENT-PROGRAM-NAME  TO DP132-PROGRAM-NAME.         07140015
071500     MOVE PC-REPORT-NBR-1          TO DP132-REPORT-NUMBER.        07150015
071600                                                                  07160015
071700     MOVE PV-POS-DATE-FORMATTED    TO HL2-DATE.                   07170015
071800                                                                  07180015
071900******************************************************************07190015
072000* 1300-PREPARE FOR REPORT                                         07200015
072100*     - OPEN THE CURSOR                                           07210015
072200*     - FETCH FIRST RECORD                                        07220015
072300******************************************************************07230015
072400 1300-PREPARE-FOR-REPORT.                                         07240015
072500                                                                  07250015
072600     PERFORM 8000-PRINT-HEADINGS.                                 07260015
072700     PERFORM 2100-OPEN-COBRAND-CURSOR.                            07270015
072800     PERFORM 2150-OPEN-COBRAND-PYMT-CURSOR.                       07280015
072900     PERFORM 2200-FETCH-COBRAND-CURSOR.                           07290015
073000     PERFORM 2250-FETCH-COBRAND-PYMT-CURSOR.                      07300015
073100     IF PS-END-OF-CURSOR AND PS-END-OF-PYMT-CURSOR                07310015
073200         DISPLAY '*** NO DATA PRESENT FOR KOHLS CORR ***'         07320015
073300                 '*** ON SALES DATE '                             07330015
073400                 PV-POS-DATE-FORMATTED                            07340015
073500     ELSE                                                         07350015
073600         PERFORM 2500-PROCESS-FIRST-RECORD                        07360015
073700     END-IF.                                                      07370015
073800                                                                  07380015
073900******************************************************************07390015
074000* 2000-PRODUCE-REPORT-LINES                                       07400015
074100*  PRODUCE THE ACTUAL REPORT LINES                                07410015
074200******************************************************************07420015
074300 2000-PRODUCE-REPORT-LINES.                                       07430015
074400                                                                  07440015
074500     PERFORM 2050-EVALUATE-CURSOR.                                07450015
074600     IF PS-USE-REGULAR-CURSOR                                     07460015
074700         IF EPTRN-STR-NBR          = PV-HOLD-STORE                07470015
074800             CONTINUE                                             07480015
074900         ELSE                                                     07490015
075000             PERFORM 3000-STORE-BREAK                             07500015
075100         END-IF                                                   07510015
075200                                                                  07520015
075300         IF EPTRN-SLS-DTE          = PV-HOLD-SALES-DATE           07530015
075400             CONTINUE                                             07540015
075500         ELSE                                                     07550015
075600             PERFORM 3500-SALES-DATE-BREAK                        07560015
075700         END-IF                                                   07570015
075800     ELSE                                                         07580015
075900         IF PV-DB2-STR-NBR         = PV-HOLD-STORE                07590015
076000             CONTINUE                                             07600015
076100         ELSE                                                     07610015
076200             PERFORM 3000-STORE-BREAK                             07620015
076300         END-IF                                                   07630015
076400                                                                  07640015
076500         IF PV-DB2-SLS-DTE         = PV-HOLD-SALES-DATE           07650015
076600             CONTINUE                                             07660015
076700         ELSE                                                     07670015
076800             PERFORM 3500-SALES-DATE-BREAK                        07680015
076900         END-IF                                                   07690015
077000     END-IF.                                                      07700015
077100                                                                  07710015
077200     PERFORM 5000-PREPARE-DETAIL-LINE.                            07720015
077300                                                                  07730015
077400     IF PS-USE-REGULAR-CURSOR                                     07740015
077500         PERFORM 2200-FETCH-COBRAND-CURSOR                        07750015
077600     ELSE                                                         07760015
077700         PERFORM 2250-FETCH-COBRAND-PYMT-CURSOR                   07770015
077800     END-IF.                                                      07780015
077900                                                                  07790015
078000******************************************************************07800015
078100* 2050-EVALUATE-CURSOR.                                           07810015
078200* EVALUATE THE DATA RETRIEVED FROM THE CURSORS TO DETERMINE WHICH 07820015
078300* ONE TO USE SO THE REPORT REMAINS IN THE PROPER ORDER.           07830015
078400*                                                                 07840015
078500* FIRST, CHECK TO MAKE SURE ONE OF THE CURSORS IS NOT DONE.  THIS 07850015
078600* WILL INDICATE TO USE THE OTHER ONE.  IF BOTH CURSORS STILL HAVE 07860015
078700* DATA, CHECK TO SEE IF THE PAYMENT STORE NUMBER IS LESS THAN THE 07870015
078800* REGULAR STORE.  IF SO, USE THE LINE FROM THE PAYMENT CURSOR.    07880015
078900*                                                                 07890015
079000* IF THE PAYMENT CURSOR STORE IS EQUAL TO THE REGUALR CURSOR STORE07900015
079100* THE REGISTER NUMBER MUST BE CHECKED.  THIS WILL DETERMINE THE   07910015
079200* ORDER IN THIS SCENARIO.                                         07920015
079300*                                                                 07930015
079400* FINALLY, IF THE PAYMENT STORE IS GREATER THAN THE REGUALR STORE 07940015
079500* WE KNOW THE REGULAR DETAIL CURSOR INFORMATION SHOULD BE USED.   07950015
079600******************************************************************07960015
079700 2050-EVALUATE-CURSOR.                                            07970015
079800                                                                  07980015
079900     EVALUATE TRUE                                                07990015
080000         WHEN PS-END-OF-PYMT-CURSOR                               08000015
080100             SET PS-USE-REGULAR-CURSOR                            08010015
080200                                   TO TRUE                        08020015
080300                                                                  08030015
080400         WHEN PS-END-OF-CURSOR                                    08040015
080500             SET PS-USE-PYMT-CURSOR                               08050015
080600                                   TO TRUE                        08060015
080700                                                                  08070015
080800         WHEN OTHER                                               08080015
080900             EVALUATE TRUE                                        08090015
081000                 WHEN PV-DB2-STR-NBR                              08100015
081100                                   < EPTRN-STR-NBR                08110015
081200                     SET PS-USE-PYMT-CURSOR                       08120015
081300                                   TO TRUE                        08130015
081400                                                                  08140015
081500                 WHEN PV-DB2-STR-NBR                              08150015
081600                                   = EPTRN-STR-NBR                08160015
081700                     EVALUATE TRUE                                08170015
081800                         WHEN PV-DB2-RGST-ID                      08180015
081900                                   < EPTRN-RGST-ID                08190015
082000                             SET PS-USE-PYMT-CURSOR               08200015
082100                                   TO TRUE                        08210015
082200                                                                  08220015
082300                         WHEN PV-DB2-RGST-ID                      08230015
082400                                   = EPTRN-RGST-ID                08240015
082500                             IF PV-DB2-TRN-NBR                    08250015
082600                                   < EPTRN-TRN-NBR                08260015
082700                                 SET PS-USE-PYMT-CURSOR           08270015
082800                                   TO TRUE                        08280015
082900                             ELSE                                 08290015
083000                                 SET PS-USE-REGULAR-CURSOR        08300015
083100                                   TO TRUE                        08310015
083200                             END-IF                               08320015
083300                                                                  08330015
083400                         WHEN OTHER                               08340015
083500                             SET PS-USE-REGULAR-CURSOR            08350015
083600                                   TO TRUE                        08360015
083700                     END-EVALUATE                                 08370015
083800                                                                  08380015
083900                 WHEN OTHER                                       08390015
084000                     SET PS-USE-REGULAR-CURSOR                    08400015
084100                                   TO TRUE                        08410015
084200                                                                  08420015
084300             END-EVALUATE                                         08430015
084400     END-EVALUATE.                                                08440015
084500                                                                  08450015
084600******************************************************************08460015
084700* 2100-OPEN-COBRAND-CURSOR.                                       08470015
084800*     OPEN KOHLS CURSOR                                           08480015
084900******************************************************************08490015
085000 2100-OPEN-COBRAND-CURSOR.                                        08500015
085100                                                                  08510015
085200     EXEC SQL                                                     08520015
085300          OPEN COBRAND-CURSOR                                     08530015
085400     END-EXEC.                                                    08540015
085500                                                                  08550015
085600     EVALUATE TRUE                                                08560015
085700         WHEN SQLCODE = ZERO                                      08570015
085800              CONTINUE                                            08580015
085900         WHEN SQLWARN0 NOT EQUAL SPACE                            08590015
086000         WHEN SQLCODE NOT EQUAL ZERO                              08600015
086100             MOVE '2100-OPEN KOHLS CURSOR'                        08610015
086200                                   TO PV-PARAGRAPH-NAME           08620015
086300             MOVE 'ERROR ON OPEN OF COBRAND-CURSOR'               08630015
086400                                   TO PV-DB2-OPERATION            08640015
086500             PERFORM 9100-SQL-ABEND                               08650015
086600     END-EVALUATE.                                                08660015
086700                                                                  08670015
086800******************************************************************08680015
086900* 2150-OPEN-COBRAND-PYMT-CURSOR.                                  08690015
087000*     OPEN KOHLS PAYEMNT CURSOR                                   08700015
087100******************************************************************08710015
087200 2150-OPEN-COBRAND-PYMT-CURSOR.                                   08720015
087300                                                                  08730015
087400     EXEC SQL                                                     08740015
087500          OPEN COBRAND-PYMT-CURSOR                                08750015
087600     END-EXEC.                                                    08760015
087700                                                                  08770015
087800     EVALUATE TRUE                                                08780015
087900         WHEN SQLCODE = ZERO                                      08790015
088000              CONTINUE                                            08800015
088100         WHEN SQLWARN0 NOT EQUAL SPACE                            08810015
088200         WHEN SQLCODE NOT EQUAL ZERO                              08820015
088300             MOVE '2150-OPEN-COBRAND-PYMT-CURSOR'                 08830015
088400                                   TO PV-PARAGRAPH-NAME           08840015
088500             MOVE 'ERROR ON OPEN OF COBRAND-PYMT-CURSOR'          08850015
088600                                   TO PV-DB2-OPERATION            08860015
088700             PERFORM 9100-SQL-ABEND                               08870015
088800     END-EVALUATE.                                                08880015
088900                                                                  08890015
089000******************************************************************08900015
089100* 2200-FETCH-SUMMARY-CURSOR                                       08910015
089200*   -FETCH ROWS THAT QUALIFY FOR THE REPORT                       08920015
089300******************************************************************08930015
089400 2200-FETCH-COBRAND-CURSOR.                                       08940015
089500                                                                  08950015
089600     EXEC SQL                                                     08960015
089700          FETCH COBRAND-CURSOR                                    08970015
089800           INTO :EPTRN-PARTN-NBR                                  08980015
089900               ,:EPTRN-STR-NBR                                    08990015
090000               ,:EPTRN-RGST-ID                                    09000015
090100               ,:EPTRN-TRN-NBR                                    09010015
090200               ,:EPTRN-STRT-TM                                    09020015
090300               ,:EPTRN-SLS-CORR-SEQ-NBR                           09030015
090400               ,:EPTRN-TRN-STAT-CDE                               09040015
090500               ,:EPTRN-SLS-DTE                                    09050015
090600               ,:EPTRN-ASSOC-ID                                   09060015
090700               ,:EPTND-TNDR-ID                                    09070015
090800               ,:EPTND-TNDR-AMT                                   09080015
090900               ,:EPTND-TNDR-ID-LEN-NBR                            09090015
091000               ,:EPCRD-AUTH-NBR                                   09100015
091100     END-EXEC.                                                    09110015
091200                                                                  09120015
091300     EVALUATE TRUE                                                09130015
091400         WHEN SQLCODE = ZERO                                      09140015
091500             ADD 1                 TO PV-CURSOR-CNT               09150015
091600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09160015
091700             SET PS-END-OF-CURSOR  TO TRUE                        09170015
091800         WHEN SQLWARN0 NOT EQUAL SPACE                            09180015
091900         WHEN SQLCODE NOT EQUAL ZERO                              09190015
092000             MOVE '2200-FETCH-COBRAND-CURSOR'                     09200015
092100                                   TO PV-PARAGRAPH-NAME           09210015
092200             MOVE 'ERROR ON FETCH OF SETTLEMENT-CURSOR'           09220015
092300                                   TO PV-DB2-OPERATION            09230015
092400             PERFORM 9100-SQL-ABEND                               09240015
092500     END-EVALUATE.                                                09250015
092600                                                                  09260015
092700******************************************************************09270015
092800* 2250-FETCH-COBRAND-PYMT-CURSOR                                  09280015
092900*   -FETCH PAYMENT ROWS THAT QUALIFY FOR THE REPORT               09290015
093000******************************************************************09300015
093100 2250-FETCH-COBRAND-PYMT-CURSOR.                                  09310015
093200                                                                  09320015
093300     EXEC SQL                                                     09330015
093400          FETCH COBRAND-PYMT-CURSOR                               09340015
093500           INTO :PV-DB2-PARTN-NBR                                 09350015
093600               ,:PV-DB2-STR-NBR                                   09360015
093700               ,:PV-DB2-RGST-ID                                   09370015
093800               ,:PV-DB2-TRN-NBR                                   09380015
093900               ,:PV-DB2-STRT-TM                                   09390015
094000               ,:PV-DB2-SLS-CORR-SEQ-NBR                          09400015
094100               ,:PV-DB2-TRN-STAT-CDE                              09410015
094200               ,:PV-DB2-SLS-DTE                                   09420015
094300               ,:PV-DB2-ASSOC-ID                                  09430015
094400               ,:EPPAY-KC-ACCT-NBR                                09440015
094500               ,:EPPAY-PAYT-AMT                                   09450015
094600               ,:EPPAY-AUTH-NBR                                   09460015
094700     END-EXEC.                                                    09470015
094800                                                                  09480015
094900     EVALUATE TRUE                                                09490015
095000         WHEN SQLCODE = ZERO                                      09500015
095100             ADD 1                 TO PV-PYMT-CURSOR-CNT          09510015
095200         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09520015
095300             SET PS-END-OF-PYMT-CURSOR                            09530015
095400                                   TO TRUE                        09540015
095500         WHEN SQLWARN0 NOT EQUAL SPACE                            09550015
095600         WHEN SQLCODE NOT EQUAL ZERO                              09560015
095700             MOVE '2250-FETCH-COBRAND-PYMT-CURSOR'                09570015
095800                                   TO PV-PARAGRAPH-NAME           09580015
095900             MOVE 'ERROR ON FETCH OF COBRAND-PYMT-CURSOR'         09590015
096000                                   TO PV-DB2-OPERATION            09600015
096100             PERFORM 9100-SQL-ABEND                               09610015
096200     END-EVALUATE.                                                09620015
096300                                                                  09630015
096400******************************************************************09640015
096500* 2300-CLOSE-COBRAND-CURSOR                                       09650015
096600*   -CLOSE THE CURSOR                                             09660015
096700******************************************************************09670015
096800 2300-CLOSE-COBRAND-CURSOR.                                       09680015
096900                                                                  09690015
097000     EXEC SQL                                                     09700015
097100          CLOSE COBRAND-CURSOR                                    09710015
097200     END-EXEC.                                                    09720015
097300                                                                  09730015
097400     EVALUATE TRUE                                                09740015
097500         WHEN SQLCODE = ZERO                                      09750015
097600              CONTINUE                                            09760015
097700         WHEN SQLWARN0 NOT EQUAL SPACE                            09770015
097800         WHEN SQLCODE NOT EQUAL ZERO                              09780015
097900             MOVE '2300-CLOSE-COBRAND-CURSOR'                     09790015
098000                                   TO PV-PARAGRAPH-NAME           09800015
098100             MOVE 'ERROR ON CLOSE OF COBRAND-CURSOR'              09810015
098200                                   TO PV-DB2-OPERATION            09820015
098300             PERFORM 9100-SQL-ABEND                               09830015
098400     END-EVALUATE.                                                09840015
098500                                                                  09850015
098600******************************************************************09860015
098700* 2350-CLOSE-COBRAND-PYMT-CURSOR                                  09870015
098800*   -CLOSE THE PAYMENT CURSOR                                     09880015
098900******************************************************************09890015
099000 2350-CLOSE-COBRAND-PYMT-CURSOR.                                  09900015
099100                                                                  09910015
099200     EXEC SQL                                                     09920015
099300          CLOSE COBRAND-PYMT-CURSOR                               09930015
099400     END-EXEC.                                                    09940015
099500                                                                  09950015
099600     EVALUATE TRUE                                                09960015
099700         WHEN SQLCODE = ZERO                                      09970015
099800              CONTINUE                                            09980015
099900         WHEN SQLWARN0 NOT EQUAL SPACE                            09990015
100000         WHEN SQLCODE NOT EQUAL ZERO                              10000015
100100             MOVE '2350-CLOSE-COBRAND-PYMT-CURSOR'                10010015
100200                                   TO PV-PARAGRAPH-NAME           10020015
100300             MOVE 'ERROR ON CLOSE OF COBRAND-PYMT-CURSOR'         10030015
100400                                   TO PV-DB2-OPERATION            10040015
100500             PERFORM 9100-SQL-ABEND                               10050015
100600     END-EVALUATE.                                                10060015
100700                                                                  10070015
100800******************************************************************10080015
100900*  FIRST RECORD PROCESSING.  WRITE THE HEADER RECORDS AND MOVE    10090015
101000*  THE DATA INTO THE APPROPRIATE FIELDS.                          10100015
101100******************************************************************10110015
101200 2500-PROCESS-FIRST-RECORD.                                       10120015
101300                                                                  10130015
101400     PERFORM 2050-EVALUATE-CURSOR.                                10140015
101500                                                                  10150015
101600     IF PS-USE-REGULAR-CURSOR                                     10160015
101700         MOVE EPTRN-STR-NBR        TO PV-HOLD-STORE               10170015
101800         MOVE EPTRN-SLS-DTE        TO PV-HOLD-SALES-DATE          10180015
101900     ELSE                                                         10190015
102000         MOVE PV-DB2-STR-NBR       TO PV-HOLD-STORE               10200015
102100         MOVE PV-DB2-SLS-DTE       TO PV-HOLD-SALES-DATE          10210015
102200     END-IF.                                                      10220015
102300                                                                  10230015
102400     PERFORM 5300-PRINT-STORE-LINE.                               10240015
102500     PERFORM 3510-FORMAT-SALES-DATE.                              10250015
102600                                                                  10260015
102700******************************************************************10270015
102800*  PRINT THE STORE TOTAL WHEN A BREAK ON THE STORE NUMBER OCCURS  10280015
102900******************************************************************10290015
103000 3000-STORE-BREAK.                                                10300015
103100                                                                  10310015
103200     PERFORM 5400-PRINT-STORE-TOTAL-LINE.                         10320015
103300     PERFORM 5300-PRINT-STORE-LINE.                               10330015
103400                                                                  10340015
103500*** THE SALES DATE SHOULD ALWAYS BE PRINTED UNDER THE NEW STORE   10350015
103600*** INFORMATION.  THIS CHECKS TO SEE IF WE HAVE A DIFFERENT SALES 10360015
103700*** DATE WITH THE NEW STORE.                                      10370015
103800                                                                  10380015
103900     IF (EPTRN-SLS-DTE             = PV-HOLD-SALES-DATE)          10390015
104000       AND (PV-DB2-SLS-DTE         = PV-HOLD-SALES-DATE)          10400015
104100         CONTINUE                                                 10410015
104200     ELSE                                                         10420015
104300         IF PS-USE-REGULAR-CURSOR                                 10430015
104400             MOVE EPTRN-SLS-DTE    TO PV-HOLD-SALES-DATE          10440015
104500         ELSE                                                     10450015
104600             MOVE PV-DB2-SLS-DTE   TO PV-HOLD-SALES-DATE          10460015
104700         END-IF                                                   10470015
104800         PERFORM 3510-FORMAT-SALES-DATE                           10480015
104900     END-IF.                                                      10490015
105000                                                                  10500015
105100     MOVE ZERO TO                  PA-STORE-SALES-AMOUNT          10510015
105200                                   PA-STORE-RETURN-AMOUNT         10520015
105300                                   PA-STORE-PYMT-AMOUNT.          10530015
105400                                                                  10540015
105500     IF PS-USE-REGULAR-CURSOR                                     10550015
105600         MOVE EPTRN-STR-NBR        TO PV-HOLD-STORE               10560015
105700     ELSE                                                         10570015
105800         MOVE PV-DB2-STR-NBR       TO PV-HOLD-STORE               10580015
105900     END-IF.                                                      10590015
106000                                                                  10600015
106100***************************************************************** 10610015
106200*  PRINT THE REQUIRED DATA ON A BREAK IN SALES DATE               10620015
106300***************************************************************** 10630015
106400 3500-SALES-DATE-BREAK.                                           10640015
106500                                                                  10650015
106600     PERFORM 5400-PRINT-STORE-TOTAL-LINE.                         10660015
106700     MOVE ZERO                     TO PA-STORE-SALES-AMOUNT       10670015
106800                                      PA-STORE-RETURN-AMOUNT      10680015
106900                                      PA-STORE-PYMT-AMOUNT.       10690015
107000                                                                  10700015
107100     IF PS-USE-REGULAR-CURSOR                                     10710015
107200         MOVE EPTRN-SLS-DTE        TO PV-HOLD-SALES-DATE          10720015
107300     ELSE                                                         10730015
107400         MOVE PV-DB2-SLS-DTE       TO PV-HOLD-SALES-DATE          10740015
107500     END-IF.                                                      10750015
107600                                                                  10760015
107700     PERFORM 3510-FORMAT-SALES-DATE.                              10770015
107800                                                                  10780015
107900****************************************************************  10790015
108000*  CALL CALENDAR ROUTINE TO CONVERT THE SALES DATE FROM DB2       10800015
108100*  FORMAT INTO GREGORIAN FORMATTED FORMAT                         10810015
108200****************************************************************  10820015
108300 3510-FORMAT-SALES-DATE.                                          10830015
108400                                                                  10840015
108500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              10850015
108600                                                                  10860015
108700     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   10870015
108800     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   10880015
108900     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   10890015
109000                                                                  10900015
109100     IF PS-USE-REGULAR-CURSOR                                     10910015
109200         MOVE EPTRN-SLS-DTE            TO DPG52-LK-DATE-INPUT     10920015
109300     ELSE                                                         10930015
109400         MOVE PV-DB2-SLS-DTE           TO DPG52-LK-DATE-INPUT     10940015
109500     END-IF.                                                      10950015
109600                                                                  10960015
109700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    10970015
109800                                             DPG54 DPG55 DPG56.   10980015
109900     EVALUATE TRUE                                                10990015
110000         WHEN DPG54-SEVERE-ERROR                                  11000015
110100         WHEN DPG54-DATE-INVALID                                  11010015
110200             MOVE '3510-FORMAT-SALES-DATEE'                       11020015
110300                                   TO PV-PARAGRAPH-NAME           11030015
110400             MOVE 'ERROR CONVERTING SALES DATE'                   11040015
110500                                   TO PV-OPERATION-MSG-1          11050015
110600             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                11060015
110700             MOVE DPG54-ERROR-MESSAGE                             11070015
110800                                   TO PV-OPERATION-MSG-2          11080015
110900             PERFORM 9999-ABEND                                   11090015
111000     END-EVALUATE.                                                11100015
111100     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-SLS-DATE-FORMATTED.      11110015
111200                                                                  11120015
111300******************************************************************11130015
111400* 4000-PRINT-REPORT-TOTALS                                        11140015
111500*   - PRINT REPORT TOTALS                                         11150015
111600*   - CLOSE REPORT FILE.                                          11160015
111700******************************************************************11170015
111800 4000-PRINT-REPORT-TOTALS.                                        11180015
111900                                                                  11190015
112000     PERFORM 2300-CLOSE-COBRAND-CURSOR.                           11200015
112100     PERFORM 2350-CLOSE-COBRAND-PYMT-CURSOR.                      11210015
112200     MOVE PV-POS-DATE-FORMATTED    TO TL1-DATE.                   11220015
112300     MOVE PA-COMPANY-SALES-AMOUNT                                 11230015
112400                                   TO TL1-SALES-AMOUNT.           11240015
112500     MOVE PA-COMPANY-RETURN-AMOUNT                                11250015
112600                                   TO TL1-RETURN-AMOUNT.          11260015
112700     MOVE PA-COMPANY-PYMT-AMOUNT   TO TL1-PYMT-AMOUNT.            11270015
112800     COMPUTE PV-AMOUNT             = PA-COMPANY-RETURN-AMOUNT     11280015
112900                                   + PA-COMPANY-SALES-AMOUNT      11290015
113000                                   + PA-COMPANY-PYMT-AMOUNT.      11300015
113100     MOVE PV-AMOUNT                TO TL1-NET-AMOUNT.             11310015
113200     MOVE +4                       TO PV-LINE-SPACING.            11320015
113300     MOVE TL1-TOTAL-LINE-1         TO PV-PRINT-RECORD.            11330015
113400     PERFORM 8200-WRITE-REPORT-LINE.                              11340015
113500     CLOSE KOHLS-REPORT-FILE.                                     11350015
113600                                                                  11360015
113700******************************************************************11370015
113800* 5000-PREPARE-DETAIL-LINE                                        11380015
113900*  EVALUATE CURSOR SWITCH AND PREPARE LINES FOR PRINTING          11390015
114000******************************************************************11400015
114100 5000-PREPARE-DETAIL-LINE.                                        11410015
114200                                                                  11420015
114300     IF PV-LINE-CNT                > PC-LINE-LIMIT                11430015
114400         PERFORM 8000-PRINT-HEADINGS                              11440015
114500     END-IF.                                                      11450015
114600                                                                  11460015
114700     INITIALIZE                    DL1-SALES-AMOUNT               11470015
114800                                   DL1-RETURN-AMOUNT              11480015
114900                                   DL1-PYMT-AMOUNT                11490015
115000                                   DL1-CODE                       11500015
115100                                   DL1-ASSOC-ID                   11510015
115200                                   DL1-BIN-NUMBER                 11520015
115300                                   DL1-CARD-NBR.                  11530015
115400     MOVE PV-SLS-DATE-FORMATTED    TO DL1-SALES-DATE.             11540015
115500                                                                  11550015
115600     INITIALIZE                    PV-PARTN-NBR                   11560015
115700                                   PV-STRT-TM                     11570015
115800                                   PV-TNDR-ID                     11580015
115900                                   PV-TNDR-LEN                    11590015
116000                                   PV-TNDR-SPACES.                11600015
116100     IF PS-USE-REGULAR-CURSOR                                     11610015
116200         PERFORM 5100-PRINT-DETAIL-LINE                           11620015
116300     ELSE                                                         11630015
116400         PERFORM 5200-PRINT-DETAIL-PYMT-LINE                      11640015
116500     END-IF.                                                      11650015
116600                                                                  11660015
116700******************************************************************11670015
116800* 5100-PRINT-DETAIL-LINE                                          11680015
116900*     FORMAT AND PRINT REPORT DETAIL LINE.                        11690015
117000******************************************************************11700015
117100 5100-PRINT-DETAIL-LINE.                                          11710015
117200                                                                  11720015
117300     MOVE EPTRN-RGST-ID            TO DL1-REGISTER.               11730015
117400     MOVE EPTRN-TRN-NBR            TO DL1-TRANSACTION.            11740015
117500     MOVE EPCRD-AUTH-NBR           TO DL1-AUTH-NBR.               11750015
117600     MOVE EPTRN-PARTN-NBR          TO PV-PARTN-NBR.               11760015
117700     MOVE EPTRN-STRT-TM            TO PV-STRT-TM.                 11770015
117800     MOVE EPTND-TNDR-ID            TO PV-TNDR-ID                  11780015
117900     MOVE EPTND-TNDR-ID-LEN-NBR    TO PV-TNDR-LEN                 11790015
118000     EVALUATE EPTND-TNDR-ID-LEN-NBR                               11800015
118100       WHEN 13                                                    11810015
118200         MOVE SPACES               TO DL1-BIN-NUMBER              11820015
118300         MOVE ALL '*'              TO PV-CARD-NBR-13-FIRST-4      11830015
118400                                      PV-CARD-NBR-13-SECOND-3     11840015
118500                                      PV-CARD-NBR-13-THIRD-2      11850015
118600         MOVE EPTND-TNDR-ID (10:1) TO PV-CARD-NBR-13-THIRD-1      11860015
118700         MOVE EPTND-TNDR-ID (11:3) TO PV-CARD-NBR-13-LAST-3       11870015
118800         MOVE PV-CARD-NBR-13       TO DL1-CARD-NBR                11880015
118900       WHEN 16                                                    11890015
119000         MOVE SPACES               TO DL1-BIN-NUMBER              11900015
119100         MOVE ALL '*'              TO PV-CARD-NBR-16-FIRST-4      11910015
119200                                      PV-CARD-NBR-16-SECOND-4     11920015
119300                                      PV-CARD-NBR-16-THIRD-4      11930015
119400         MOVE EPTND-TNDR-ID (13:4) TO PV-CARD-NBR-16-LAST-4       11940015
119500         MOVE PV-CARD-NBR-16       TO DL1-CARD-NBR                11950015
119600       WHEN 12                                                    11960015
119700         MOVE SPACES               TO DL1-BIN-NUMBER              11970015
119800         MOVE ALL '*'              TO PV-CARD-NBR-12-FIRST-4      11980015
119900                                      PV-CARD-NBR-12-SECOND-3     11990015
120000                                      PV-CARD-NBR-12-THIRD-1      12000015
120100         MOVE EPTND-TNDR-ID (9:2)  TO PV-CARD-NBR-12-THIRD-2      12010015
120200         MOVE EPTND-TNDR-ID (11:2) TO PV-CARD-NBR-12-LAST-2       12020015
120300         MOVE PV-CARD-NBR-12       TO DL1-CARD-NBR                12030015
120400       WHEN 18                                                    12040015
120500         MOVE PV-TNDR-ID (1:6)     TO DL1-BIN-NUMBER              12050015
120600         MOVE ALL '*'              TO PV-CARD-NBR-18-FIRST-3      12060015
120700                                      PV-CARD-NBR-18-SECOND-4     12070015
120800                                      PV-CARD-NBR-18-THIRD-1      12080015
120900         MOVE EPTND-TNDR-ID (15:2) TO PV-CARD-NBR-18-THIRD-2      12090015
121000         MOVE EPTND-TNDR-ID (17:2) TO PV-CARD-NBR-18-LAST-2       12100015
121100         MOVE PV-CARD-NBR-18       TO DL1-CARD-NBR                12110015
121200     END-EVALUATE.                                                12120015
121300                                                                  12130015
121400     EVALUATE TRUE                                                12140015
121500         WHEN EPTND-TNDR-AMT       > ZERO                         12150015
121600             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         12160015
121700             MOVE PV-AMOUNT-FORMATTED                             12170015
121800                                   TO DL1-SALES-AMOUNT            12180015
121900             MOVE SPACE            TO DL1-RETURN-AMOUNT           12190015
122000             ADD EPTND-TNDR-AMT    TO PA-STORE-SALES-AMOUNT       12200015
122100                                                                  12210015
122200         WHEN EPTND-TNDR-AMT       < ZERO                         12220015
122300             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         12230015
122400             MOVE PV-AMOUNT-FORMATTED                             12240015
122500                                   TO DL1-RETURN-AMOUNT           12250015
122600             MOVE SPACE            TO DL1-SALES-AMOUNT            12260015
122700             ADD EPTND-TNDR-AMT    TO PA-STORE-RETURN-AMOUNT      12270015
122800                                                                  12280015
122900         WHEN OTHER                                               12290015
123000             MOVE ZERO             TO PV-AMOUNT-FORMATTED         12300015
123100             MOVE PV-AMOUNT-FORMATTED                             12310015
123200                                   TO DL1-RETURN-AMOUNT           12320015
123300                                      DL1-SALES-AMOUNT            12330015
123400     END-EVALUATE.                                                12340015
123500                                                                  12350015
123600**** A LATE TRANSACTION, INDICATED BY A -1 SEQUENCE NUMBER, WILL N12360015
123700**** HAVE A SALES AUDIT USER ID.  A REGULAR CORRECTION WILL HVAE A12370015
123800**** SALES AUDIT USER ID.                                         12380015
123900                                                                  12390015
124000     IF EPTRN-SLS-CORR-SEQ-NBR     < ZERO                         12400015
124100         MOVE PC-SYSTEM-CORRECTION TO DL1-CODE                    12410015
124200     ELSE                                                         12420015
124300         IF EPTRN-TRN-STAT-CDE     = PC-REVERSAL-CORRECTION       12430015
124400             MOVE PC-REVERSAL-CORRECTION                          12440015
124500                                   TO DL1-CODE                    12450015
124600         END-IF                                                   12460015
124700         PERFORM 7000-SELECT-SLS-AUD-USER-ID                      12470015
124800     END-IF.                                                      12480015
124900                                                                  12490015
125000     MOVE DL1-DETAIL-LINE-1        TO PV-PRINT-RECORD.            12500015
125100                                                                  12510015
125200**** FOLLOWING CODE CHECKS IF THE LAST LINE PRINTED WAS SINGLE    12520015
125300**** SPACED (LIKE A DETAIL LINE) OR GREATER THAN SINGLE SPACED    12530015
125400**** (LIKE A HEADING LINE).  IF LAST LINE WAS NOT SINGLE SPACED,  12540015
125500**** PRINT THE DETAIL LINE DOUBLE SPACED.                         12550015
125600                                                                  12560015
125700     IF PV-LINE-SPACING            > +1                           12570015
125800         MOVE +2                   TO  PV-LINE-SPACING            12580015
125900     ELSE                                                         12590015
126000         MOVE +1                   TO  PV-LINE-SPACING            12600015
126100     END-IF.                                                      12610015
126200     PERFORM 8200-WRITE-REPORT-LINE.                              12620015
126300     MOVE +1                       TO  PV-LINE-SPACING.           12630015
126400                                                                  12640015
126500******************************************************************12650015
126600* 5200-PRINT-DETAIL-LINE                                          12660015
126700*     FORMAT AND PRINT REPORT PAYMENT DETAIL LINE                 12670015
126800******************************************************************12680015
126900 5200-PRINT-DETAIL-PYMT-LINE.                                     12690015
127000                                                                  12700015
127100     MOVE PV-DB2-RGST-ID           TO DL1-REGISTER.               12710015
127200     MOVE PV-DB2-TRN-NBR           TO DL1-TRANSACTION.            12720015
127300     MOVE EPPAY-AUTH-NBR           TO DL1-AUTH-NBR.               12730015
127400     MOVE PV-DB2-PARTN-NBR         TO PV-PARTN-NBR.               12740015
127500     MOVE PV-DB2-STRT-TM           TO PV-STRT-TM.                 12750015
127600     IF EPPAY-KC-ACCT-NBR = SPACES                                12760015
127700        MOVE SPACES                TO PV-TNDR-ID                  12770015
127800     ELSE                                                         12780015
127900        INSPECT FUNCTION REVERSE(EPPAY-KC-ACCT-NBR)               12790015
128000                TALLYING PV-TNDR-SPACES FOR LEADING SPACES        12800015
128100        COMPUTE PV-TNDR-LEN = LENGTH OF EPPAY-KC-ACCT-NBR         12810015
128200                              - PV-TNDR-SPACES                    12820015
128300        MOVE EPPAY-KC-ACCT-NBR  TO PV-TNDR-ID                     12830015
128400     END-IF.                                                      12840015
128500     EVALUATE PV-TNDR-LEN                                         12850015
128600       WHEN 13                                                    12860015
128700         MOVE SPACES               TO DL1-BIN-NUMBER              12870015
128800         MOVE ALL '*'              TO PV-CARD-NBR-13-FIRST-4      12880015
128900                                      PV-CARD-NBR-13-SECOND-3     12890015
129000                                      PV-CARD-NBR-13-THIRD-2      12900015
129100         MOVE PV-TNDR-ID (10:1) TO PV-CARD-NBR-13-THIRD-1         12910015
129200         MOVE PV-TNDR-ID (11:3) TO PV-CARD-NBR-13-LAST-3          12920015
129300         MOVE PV-CARD-NBR-13       TO DL1-CARD-NBR                12930015
129400       WHEN 16                                                    12940015
129500         MOVE SPACES               TO DL1-BIN-NUMBER              12950015
129600         MOVE ALL '*'              TO PV-CARD-NBR-16-FIRST-4      12960015
129700                                      PV-CARD-NBR-16-SECOND-4     12970015
129800                                      PV-CARD-NBR-16-THIRD-4      12980015
129900         MOVE PV-TNDR-ID (13:4) TO PV-CARD-NBR-16-LAST-4          12990015
130000         MOVE PV-CARD-NBR-16       TO DL1-CARD-NBR                13000015
130100       WHEN 12                                                    13010015
130200         MOVE SPACES               TO DL1-BIN-NUMBER              13020015
130300         MOVE ALL '*'              TO PV-CARD-NBR-12-FIRST-4      13030015
130400                                      PV-CARD-NBR-12-SECOND-3     13040015
130500                                      PV-CARD-NBR-12-THIRD-1      13050015
130600         MOVE PV-TNDR-ID (9:2)     TO PV-CARD-NBR-12-THIRD-2      13060015
130700         MOVE PV-TNDR-ID (11:2)    TO PV-CARD-NBR-12-LAST-2       13070015
130800         MOVE PV-CARD-NBR-12       TO DL1-CARD-NBR                13080015
130900       WHEN 18                                                    13090015
131000         MOVE PV-TNDR-ID (1:6)     TO DL1-BIN-NUMBER              13100015
131100         MOVE ALL '*'              TO PV-CARD-NBR-18-FIRST-3      13110015
131200                                      PV-CARD-NBR-18-SECOND-4     13120015
131300                                      PV-CARD-NBR-18-THIRD-1      13130015
131400         MOVE PV-TNDR-ID (15:2) TO PV-CARD-NBR-18-THIRD-2         13140015
131500         MOVE PV-TNDR-ID (17:2) TO PV-CARD-NBR-18-LAST-2          13150015
131600         MOVE PV-CARD-NBR-18       TO DL1-CARD-NBR                13160015
131700     END-EVALUATE.                                                13170015
131800                                                                  13180015
131900     COMPUTE EPPAY-PAYT-AMT        = EPPAY-PAYT-AMT               13190015
132000                                   * PC-NEGATIVE-ONE.             13200015
132100     MOVE EPPAY-PAYT-AMT           TO PV-AMOUNT-FORMATTED.        13210015
132200     MOVE PV-AMOUNT-FORMATTED      TO DL1-PYMT-AMOUNT.            13220015
132300     ADD EPPAY-PAYT-AMT            TO PA-STORE-PYMT-AMOUNT.       13230015
132400                                                                  13240015
132500**** A LATE TRANSACTION, INDICATED BY A -1 SEQUENCE NUMBER, WILL N13250015
132600**** HAVE A SALES AUDIT USER ID.  A REGULAR CORRECTION WILL HVAE A13260015
132700**** SALES AUDIT USER ID.                                         13270015
132800                                                                  13280015
132900     IF PV-DB2-SLS-CORR-SEQ-NBR    < ZERO                         13290015
133000         MOVE PC-SYSTEM-CORRECTION TO DL1-CODE                    13300015
133100     ELSE                                                         13310015
133200         IF PV-DB2-TRN-STAT-CDE    = PC-REVERSAL-CORRECTION       13320015
133300             MOVE PC-REVERSAL-CORRECTION                          13330015
133400                                   TO DL1-CODE                    13340015
133500         END-IF                                                   13350015
133600         PERFORM 7000-SELECT-SLS-AUD-USER-ID                      13360015
133700     END-IF.                                                      13370015
133800                                                                  13380015
133900     MOVE DL1-DETAIL-LINE-1        TO PV-PRINT-RECORD.            13390015
134000                                                                  13400015
134100**** FOLLOWING CODE CHECKS IF THE LAST LINE PRINTED WAS SINGLE    13410015
134200**** SPACED (LIKE A DETAIL LINE) OR GREATER THAN SINGLE SPACED    13420015
134300**** (LIKE A HEADING LINE).  IF LAST LINE WAS NOT SINGLE SPACED,  13430015
134400**** PRINT THE DETAIL LINE DOUBLE SPACED.                         13440015
134500                                                                  13450015
134600     IF PV-LINE-SPACING            > +1                           13460015
134700         MOVE +2                   TO  PV-LINE-SPACING            13470015
134800     ELSE                                                         13480015
134900         MOVE +1                   TO  PV-LINE-SPACING            13490015
135000     END-IF.                                                      13500015
135100     PERFORM 8200-WRITE-REPORT-LINE.                              13510015
135200     MOVE +1                       TO  PV-LINE-SPACING.           13520015
135300                                                                  13530015
135400***************************************************************** 13540015
135500*  PRINT THE LINE CONTAINING THE STORE NUMBER                     13550015
135600***************************************************************** 13560015
135700 5300-PRINT-STORE-LINE.                                           13570015
135800                                                                  13580015
135900**** FOLLOWING CODE CHECKS FOR ENOUGH ROOM ON THE PAGE TO         13590015
136000**** PRINT THE STORE LINE, SALES DATE LINE,                       13600015
136100**** AND AT LEAST ONE DETAIL LINE.                                13610015
136200                                                                  13620015
136300     MOVE PV-LINE-CNT              TO  PV-LINE-CNT-AHEAD.         13630015
136400     ADD +8                        TO  PV-LINE-CNT-AHEAD.         13640015
136500     IF PV-LINE-CNT-AHEAD          > PC-LINE-LIMIT                13650015
136600         PERFORM 8000-PRINT-HEADINGS                              13660015
136700     END-IF.                                                      13670015
136800                                                                  13680015
136900     IF PS-USE-REGULAR-CURSOR                                     13690015
137000         MOVE EPTRN-STR-NBR        TO HL3-STORE                   13700015
137100     ELSE                                                         13710015
137200         MOVE PV-DB2-STR-NBR       TO HL3-STORE                   13720015
137300     END-IF.                                                      13730015
137400                                                                  13740015
137500     MOVE +4                       TO PV-LINE-SPACING.            13750015
137600     MOVE HL3-HEADING-LINE-3       TO PV-PRINT-RECORD.            13760015
137700     PERFORM 8200-WRITE-REPORT-LINE.                              13770015
137800                                                                  13780015
137900******************************************************************13790015
138000*  PRINT THE STORE TOTAL LINE INFORMATION                         13800015
138100******************************************************************13810015
138200 5400-PRINT-STORE-TOTAL-LINE.                                     13820015
138300                                                                  13830015
138400     IF PV-LINE-CNT                > PC-LINE-LIMIT                13840015
138500         PERFORM 8000-PRINT-HEADINGS                              13850015
138600     END-IF.                                                      13860015
138700                                                                  13870015
138800     MOVE PV-HOLD-STORE            TO HL6-STORE.                  13880015
138900     MOVE PV-SLS-DATE-FORMATTED    TO HL6-DATE.                   13890015
139000                                                                  13900015
139100     IF PA-STORE-SALES-AMOUNT      > ZERO                         13910015
139200         MOVE PA-STORE-SALES-AMOUNT                               13920015
139300                                   TO PV-AMOUNT-FORMATTED         13930015
139400         MOVE PV-AMOUNT-FORMATTED  TO HL6-SALES-TOTAL             13940015
139500     ELSE                                                         13950015
139600         MOVE SPACE                TO HL6-SALES-TOTAL             13960015
139700     END-IF.                                                      13970015
139800                                                                  13980015
139900     ADD  PA-STORE-SALES-AMOUNT    TO PA-COMPANY-SALES-AMOUNT.    13990015
140000                                                                  14000015
140100     IF PA-STORE-RETURN-AMOUNT     < ZERO                         14010015
140200         MOVE PA-STORE-RETURN-AMOUNT                              14020015
140300                                   TO PV-AMOUNT-FORMATTED         14030015
140400         MOVE PV-AMOUNT-FORMATTED  TO HL6-RETURN-TOTAL            14040015
140500     ELSE                                                         14050015
140600         MOVE SPACE                TO HL6-RETURN-TOTAL            14060015
140700     END-IF.                                                      14070015
140800                                                                  14080015
140900     ADD PA-STORE-RETURN-AMOUNT    TO PA-COMPANY-RETURN-AMOUNT.   14090015
141000                                                                  14100015
141100     IF PA-STORE-PYMT-AMOUNT       NOT EQUAL ZERO                 14110015
141200         MOVE PA-STORE-PYMT-AMOUNT TO PV-AMOUNT-FORMATTED         14120015
141300         MOVE PV-AMOUNT-FORMATTED  TO HL6-PYMT-AMOUNT             14130015
141400     ELSE                                                         14140015
141500         MOVE SPACE                TO HL6-PYMT-AMOUNT             14150015
141600     END-IF.                                                      14160015
141700                                                                  14170015
141800     ADD PA-STORE-PYMT-AMOUNT      TO PA-COMPANY-PYMT-AMOUNT.     14180015
141900     COMPUTE PV-AMOUNT             = PA-STORE-RETURN-AMOUNT       14190015
142000                                   + PA-STORE-SALES-AMOUNT        14200015
142100                                   + PA-STORE-PYMT-AMOUNT.        14210015
142200     MOVE PV-AMOUNT                TO PV-AMOUNT-FORMATTED.        14220015
142300     MOVE PV-AMOUNT-FORMATTED      TO HL6-NET-AMOUNT.             14230015
142400     MOVE +2                       TO PV-LINE-SPACING.            14240015
142500     MOVE HL6-HEADING-LINE-6       TO PV-PRINT-RECORD.            14250015
142600     PERFORM 8200-WRITE-REPORT-LINE.                              14260015
142700                                                                  14270015
142800***************************************************************** 14280015
142900* 7000-SELECT-SLS-AUD-USER-ID                                     14290015
143000*   - SELECT THE SALES AUDIT USER ID WHEN THE SALES CORRECTION    14300015
143100*     SEQUNCE NUMBER IS GREATER THAN ZERO                         14310015
143200***************************************************************** 14320015
143300 7000-SELECT-SLS-AUD-USER-ID.                                     14330015
143400                                                                  14340015
143500     IF PS-USE-REGULAR-CURSOR                                     14350015
143600         EXEC SQL                                                 14360015
143700             SELECT SLS_AUD_USR_ID                                14370015
143800               INTO :EPSAT-SLS-AUD-USR-ID                         14380015
143900               FROM TEPSAT                                        14390015
144000              WHERE PARTN_NBR          = :EPTRN-PARTN-NBR         14400015
144100                AND STR_NBR            = :EPTRN-STR-NBR           14410015
144200                AND RGST_ID            = :EPTRN-RGST-ID           14420015
144300                AND TRN_NBR            = :EPTRN-TRN-NBR           14430015
144400                AND STRT_TM            = :EPTRN-STRT-TM           14440015
144500                AND SLS_CORR_SEQ_NBR   = :EPTRN-SLS-CORR-SEQ-NBR  14450015
144600             WITH UR                                              14460015
144700         END-EXEC                                                 14470015
144800     ELSE                                                         14480015
144900         EXEC SQL                                                 14490015
145000             SELECT SLS_AUD_USR_ID                                14500015
145100               INTO :EPSAT-SLS-AUD-USR-ID                         14510015
145200               FROM TEPSAT                                        14520015
145300              WHERE PARTN_NBR          = :PV-DB2-PARTN-NBR        14530015
145400                AND STR_NBR            = :PV-DB2-STR-NBR          14540015
145500                AND RGST_ID            = :PV-DB2-RGST-ID          14550015
145600                AND TRN_NBR            = :PV-DB2-TRN-NBR          14560015
145700                AND STRT_TM            = :PV-DB2-STRT-TM          14570015
145800                AND SLS_CORR_SEQ_NBR   = :PV-DB2-SLS-CORR-SEQ-NBR 14580015
145900             WITH UR                                              14590015
146000         END-EXEC                                                 14600015
146100     END-IF.                                                      14610015
146200                                                                  14620015
146300     EVALUATE TRUE                                                14630015
146400         WHEN SQLCODE = ZERO                                      14640015
146500             MOVE EPSAT-SLS-AUD-USR-ID                            14650015
146600                                   TO DL1-ASSOC-ID                14660015
146700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          14670015
146800             MOVE 'UNKNOWN'        TO DL1-ASSOC-ID                14680015
146900         WHEN SQLWARN0 NOT EQUAL SPACE                            14690015
147000         WHEN SQLCODE NOT EQUAL ZERO                              14700015
147100             MOVE '7000-SELECT-SLS-AUD-USER-ID'                   14710015
147200                                   TO PV-PARAGRAPH-NAME           14720015
147300             MOVE 'ERROR ON SELECTING SLS AUD USER ID'            14730015
147400                                   TO PV-DB2-OPERATION            14740015
147500             PERFORM 9100-SQL-ABEND                               14750015
147600     END-EVALUATE.                                                14760015
147700                                                                  14770015
147800******************************************************************14780015
147900* 8000-PRINT-HEADINGS                                             14790015
148000*     PRINT THE HEADINGS FOR THE REPORT.                          14800015
148100******************************************************************14810015
148200 8000-PRINT-HEADINGS.                                             14820015
148300                                                                  14830015
148400     ADD +1                        TO PV-PAGE-CNT.                14840015
148500     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       14850015
148600     MOVE DP132-STANDRD-HEADER-132-COLS                           14860015
148700                                   TO PV-PRINT-RECORD.            14870015
148800     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          14880015
148900                                                                  14890015
149000     MOVE HL2-HEADING-LINE-2       TO PV-PRINT-RECORD.            14900015
149100     MOVE +1                       TO PV-LINE-SPACING.            14910015
149200     PERFORM 8200-WRITE-REPORT-LINE.                              14920015
149300                                                                  14930015
149400     MOVE +2                       TO PV-LINE-SPACING.            14940015
149500     MOVE HL4-HEADING-LINE-4       TO PV-PRINT-RECORD.            14950015
149600     PERFORM 8200-WRITE-REPORT-LINE.                              14960015
149700                                                                  14970015
149800     MOVE +1                       TO PV-LINE-SPACING.            14980015
149900     MOVE HL5-HEADING-LINE-5       TO PV-PRINT-RECORD.            14990015
150000     PERFORM 8200-WRITE-REPORT-LINE.                              15000015
150100     MOVE +2                       TO PV-LINE-SPACING.            15010015
150200                                                                  15020015
150300******************************************************************15030015
150400* 8100-WRITE-RPT-TOP-OF-PAGE                                      15040015
150500*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   15050015
150600******************************************************************15060015
150700 8100-WRITE-RPT-TOP-OF-PAGE.                                      15070015
150800                                                                  15080015
150900     WRITE KOHLS-REPORT-RECORD                                    15090015
151000       FROM PV-PRINT-RECORD                                       15100015
151100         AFTER ADVANCING PAGE.                                    15110015
151200     MOVE +1                       TO PV-LINE-CNT.                15120015
151300                                                                  15130015
151400******************************************************************15140015
151500* 8200-WRITE-REPORT-LINE                                          15150015
151600*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             15160015
151700******************************************************************15170015
151800 8200-WRITE-REPORT-LINE.                                          15180015
151900                                                                  15190015
152000     WRITE KOHLS-REPORT-RECORD                                    15200015
152100       FROM PV-PRINT-RECORD                                       15210015
152200         AFTER ADVANCING PV-LINE-SPACING.                         15220015
152300                                                                  15230015
152400     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          15240015
152500                                                                  15250015
152600******************************************************************15260015
152700* 9100-SQL-ABEND                                                  15270015
152800*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.15280015
152900******************************************************************15290015
153000 9100-SQL-ABEND.                                                  15300015
153100     DISPLAY '** ABEND     **'.                                   15310015
153200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        15320015
153300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              15330015
153400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               15340015
153500                                                                  15350015
153600******************************************************************15360015
153700* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     15370015
153800* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      15380015
153900******************************************************************15390015
154000     COPY DPPD004.                                                15400015
154100                                                                  15410015
154200     SET AC-DB2-ERROR TO TRUE.                                    15420015
154300     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         15430015
154400                                                                  15440015
154500******************************************************************15450015
154600* 9999-ABEND                                                      15460015
154700*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  15470015
154800******************************************************************15480015
154900 9999-ABEND.                                                      15490015
155000     DISPLAY '** ABEND           **'.                             15500015
155100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  15510015
155200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        15520015
155300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       15530015
155400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       15540015
155500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         15550015
155600                                                                  15560015
