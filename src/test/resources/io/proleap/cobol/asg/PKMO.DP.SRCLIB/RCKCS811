000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS811.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10-06-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*  TRANSACTION - E811                                             00080000
000900*                                                                 00090000
001000*  THIS CALLED ROUTINE WILL NOT REMOVE THE ALLOCATION IN RECDIS   00100000
001100*  BUT CONVERT THE ALLOCATION LINES IN A PACK TO KEEP RECITM      00110000
001200*  PACK AND RECDIS PACK IN SYNC BY LINE AND BY PACK ID.  THIS     00120000
001300*  PROGRAM WILL:                                                  00130000
001400*    1) CONVERT RECDIS WHENEVER A LINE IN TRECITM IS REMOVED      00140000
001500*       FROM THE PACK, ADDED TO A PACK OR HAS A RATIO CHANGE      00150000
001600*       IN A PACK.                                                00160000
001700*    2) DELETE A LINE OR AN ENTIRE PACKING RECDIS IN PREPARATION  00170000
001800*       OF PERFORMING 'TRANSCRIPTION' OR 'REDISTRO'.              00180000
001900*                                                                 00190000
002000******************************************************************00200000
002010******************************************************************00201000
002020* CHANGE HISTORY                                                 *00202000
002030*    CHANGES                                                     *00203000
002040*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00204000
002050*     DATE:    10/15/2014                                        *00205000
002060*                                                                *00206000
002070*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00207000
002080*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/15/2014     *00208000
002090******************************************************************00209000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 CONFIGURATION SECTION.                                           00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700******************************************************************00270000
002800 DATA DIVISION.                                                   00280000
002900                                                                  00290000
003000 WORKING-STORAGE SECTION.                                         00300000
003100                                                                  00310000
003200 01  PS-PROGRAM-SWITCHES.                                         00320000
003300     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00330000
003400         88  PS-NOT-DONE                        VALUE 'N'.        00340000
003500         88  PS-DONE                            VALUE 'Y'.        00350000
003600     05  PS-RECDIS-HOLD-CSR-SW        PIC  X    VALUE 'Y'.        00360000
003700         88  PS-RECDIS-HOLD-CSR-YES             VALUE 'Y'.        00370000
003800         88  PS-RECDIS-HOLD-CSR-EOF             VALUE 'N'.        00380000
003900     05  PS-RECDIS-CLONE-CSR-SW       PIC  X    VALUE 'Y'.        00390000
004000         88  PS-RECDIS-CLONE-CSR-YES            VALUE 'Y'.        00400000
004100         88  PS-RECDIS-CLONE-CSR-EOF            VALUE 'N'.        00410000
004200     05  PS-RECITM-CLONE-SW           PIC  X    VALUE 'N'.        00420000
004300         88  PS-RECITM-CLONE-NO                 VALUE 'N'.        00430000
004400         88  PS-RECITM-CLONE-YES                VALUE 'Y'.        00440000
004500     05  PS-RECITM-MODIFY-SW          PIC  X    VALUE 'N'.        00450000
004600         88  PS-RECITM-MODIFY-NO                VALUE 'N'.        00460000
004700         88  PS-RECITM-MODIFY-YES               VALUE 'Y'.        00470000
004800     05  PS-MORE-RECITM-SW            PIC  X    VALUE 'N'.        00480000
004900         88  PS-MORE-RECITM-NO                  VALUE 'N'.        00490000
005000         88  PS-MORE-RECITM-YES                 VALUE 'Y'.        00500000
005001                                                                  00500100
005010     05  PS-FIRST-PASS-SW             PIC  X    VALUE 'Y'.        00501000
005020         88  PS-FIRST-PASS                      VALUE 'Y'.        00502000
005030         88  PS-FIRST-PASS-NO                   VALUE 'N'.        00503000
005100                                                                  00510000
005200 01  PC-PROGRAM-CONSTANTS.                                        00520000
005300     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKCS811'. 00530000
005400     05  PC-CURR-PGM-NAME             PIC X(08) VALUE 'RCKCS811'. 00540000
005500     05  PC-RC811-UID                 PIC X(08) VALUE 'RCKCS811'. 00550000
005600     05  PC-DP277-UID                 PIC X(08) VALUE 'DPKCS277'. 00560000
005700     05  PC-DEFAULT-DATE              PIC X(10) VALUE             00570000
005710                                                '9999-09-09'.     00571000
005720     05  PC-A                         PIC X(01) VALUE 'A'.        00572000
005730     05  PC-ACTIVE                    PIC X(01) VALUE 'A'.        00573000
005740     05  PC-INACTIVE                  PIC X(01) VALUE 'I'.        00574000
005750     05  PC-F                         PIC X(01) VALUE 'F'.        00575000
005760     05  PC-N                         PIC X(01) VALUE 'N'.        00576000
005770     05  PC-Y                         PIC X(01) VALUE 'Y'.        00577000
005780     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00578000
005790                                                COMP SYNC.        00579000
005800     05  PC-NULL-TMST                 PIC X(26) VALUE             00580000
005900                                    '0001-01-01-00.00.00.000000'. 00590000
006000                                                                  00600000
006100 01  PV-PROGRAM-VARIABLES.                                        00610000
006200     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        00620000
006300                                                COMP SYNC.        00630000
006400     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0          00640000
006500                                                COMP-3.           00650000
006600     05  PV-CLONE-COUNT               PIC S9(9) VALUE +0          00660000
006700                                                COMP-3.           00670000
006800     05  PV-MODIFY-COUNT              PIC S9(9) VALUE +0          00680000
006900                                                COMP-3.           00690000
007000     05  PV-EXPTED-ITM-QTY            PIC S9(9) COMP.             00700000
007100     05  PV-VERIFY-ITM-QTY            PIC S9(9) COMP.             00710000
007200     05  PV-PLAN-ITM-QTY              PIC S9(4) COMP.             00720000
007300     05  PV-HOLD-COMPUTED-QTY1        PIC S9(9)V9(5) COMP.        00730000
007400     05  PV-HOLD-COMPUTED-QTY2        PIC S9(9)V9(5) COMP.        00740000
007500     05  PV-FACTOR                    PIC S9(9)V9(5) COMP SYNC.   00750000
007600     05  PV-NEW-EXPTED-COMPUTED-QTY   PIC S9(9) COMP.             00760000
007700     05  PV-NEW-VERIFY-COMPUTED-QTY   PIC S9(9) COMP.             00770000
007800     05  PV-NEW-PLAN-COMPUTED-QTY     PIC S9(4) COMP.             00780000
007900     05  PV-CLONE-RATIO-QTY           PIC S9(4) COMP.             00790000
008000     05  PV-MODIFY-RATIO-QTY          PIC S9(4) COMP.             00800000
008100     05  PV-CICS-RESP            PIC S9(04)  VALUE +0 COMP.       00810000
008200                                                                  00820000
008300*PS 10/15/2014 CHANGE STARTS                                      00830000
008400     05  PV-DISP-PO-NBR          PIC 9(8).                        00840000
008500*PS 10/15/2014 CHANGE ENDS                                        00850000
008600     05  PV-DISP-REC-SEQ-NBR     PIC 9(4).                        00860000
008700     05  PV-DISP-OPER-UNT-ID     PIC 9(4).                        00870000
008800     05  PV-DISP-FCLTY-ID        PIC 9(4).                        00880000
008900     05  PV-DISP-PREPK-ID        PIC 9(4).                        00890000
009000     05  PV-DISP-CLN-LINE        PIC 9(4).                        00900000
009100     05  PV-DISP-MOD-LINE        PIC 9(4).                        00910000
009200     05  PV-DISP-DLT-LINE        PIC 9(4).                        00920000
009300     05  PV-RETURN-MSG           PIC X(50).                       00930000
009400     05  PV-SQLCODE              PIC S9(9) COMP-4.                00940000
009500     05  PV-DISPLAY-SQLCODE      PIC -Z(8)9.                      00950000
009600     05  PV-DISPLAY-QTY          PIC Z(4)9.                       00960000
009700                                                                  00970000
009800     05  PV-DISP-PO              PIC 9(09).                       00980000
009900     05  PV-DISP-LINE            PIC 9999.                        00990000
010000     05  PV-DISP-LINE-CLONE      PIC 9999.                        01000000
010100     05  PV-DISP-LINE-MOD        PIC 9999.                        01010000
010200     05  PV-DISP-LINE-DEL        PIC 9999.                        01020000
010210     05  PV-DISP-OPER            PIC 9999.                        01021000
010220     05  PV-DISP-REC             PIC 9999.                        01022000
010230     05  PV-DISP-PLAN            PIC 999999.                      01023000
010240     05  PV-DISP-STR             PIC 9999.                        01024000
010250     05  PV-HOLD-STR             PIC 9999.                        01025000
010260                                                                  01026000
010270     05  PV-DISP-TABLE-IDX               PIC S9(04) COMP.         01027000
010280     05  PV-DISP-TABLE.                                           01028000
010281         10  PV-DISP-TBL-SEQ             PIC 9(4).                01028100
010282         10  FILLER                      PIC X.                   01028200
010283         10  PV-DISP-TBL-STORE-NBR       PIC 9(4).                01028300
010284         10  FILLER                      PIC X.                   01028400
010285         10  PV-DISP-TBL-ALLOC-SEQ-CDE   PIC X.                   01028500
010286         10  FILLER                      PIC X.                   01028600
010287         10  PV-DISP-TBL-RNK-SEQ-NBR     PIC 9(4).                01028700
010288         10  FILLER                      PIC X.                   01028800
010289         10  PV-DISP-TBL-STR-CNSTR-CDE   PIC X.                   01028900
010290         10  FILLER                      PIC X.                   01029000
010291         10  PV-DISP-TBL-STR-CNSTR-QTY   PIC 9(9).                01029100
010292         10  FILLER                      PIC X.                   01029200
010293         10  PV-DISP-TBL-STR-DISTRO-QTY  PIC 9(9).                01029300
010294         10  FILLER                      PIC X.                   01029400
010295         10  PV-DISP-TBL-STR-DISTRO-PK   PIC 9(9).                01029500
010296         10  FILLER                      PIC X.                   01029600
010297         10  PV-DISP-TBL-STR-OTR-QTY     PIC 9(9).                01029700
010298         10  FILLER                      PIC X.                   01029800
010299         10  PV-DISP-TBL-STR-OTR-PK      PIC 9(9).                01029900
010300         10  FILLER                      PIC X.                   01030000
010301         10  PV-DISP-TBL-STR-DISTRO-OTR  PIC 9(9).                01030100
010302         10  FILLER                      PIC X.                   01030200
010303                                                                  01030300
010304                                                                  01030400
010305 01  DK-DB2-KEYS.                                                 01030500
010306     05  DK-LINE-NBR-LOW              PIC S9(9) COMP VALUE +0.    01030600
010307     05  DK-LINE-NBR-HIGH             PIC S9(9) COMP VALUE +0.    01030700
010308     05  DK-CLONE-LINE-NBR            PIC S9(9) COMP VALUE +0.    01030800
010309     05  DK-MODIFY-LINE-NBR           PIC S9(9) COMP VALUE +0.    01030900
010310                                                                  01031000
010320 01  PM-PROGRAM-MESSAGES.                                         01032000
010330     05  PM-001                       PIC X(50) VALUE             01033000
010340         '001SUCCESSFUL UPDATE                              '.    01034000
010350     05  PM-002                       PIC X(50) VALUE             01035000
010360         '002ZERO VALUE IN OLD-DISTRO-RATIO OR NEW-RC-RATIO '.    01036000
010370     05  PM-003                       PIC X(50) VALUE             01037000
010380         '003NO RECDIS ROWS WERE FOUND                      '.    01038000
010390     05  PM-004                       PIC X(50) VALUE             01039000
010400         '004LINES IN A PACK ON RECDIS ALREADY VERIFIED     '.    01040000
010500     05  PM-005                       PIC X(50) VALUE             01050000
010600         '005DATABASE ERROR ON CONVERT-DISTRO-RATIO FUNCTION'.    01060000
010700     05  PM-006                       PIC X(50) VALUE             01070000
010800         '006SUCCESSFUL LINE DELETE                         '.    01080000
010900     05  PM-007                       PIC X(50) VALUE             01090000
011000         '007A ZERO VALUE IN THE DELETE LINE                '.    01100000
011100     05  PM-008                       PIC X(50) VALUE             01110000
011200         '008LINES IN A PACK ON RECDIS ALREADY VERIFIED     '.    01120000
011300     05  PM-009                       PIC X(50) VALUE             01130000
011400         '009RECDIS ROWS WITH THE LINE-NBR WERE NOT FOUND   '.    01140000
011500     05  PM-010                       PIC X(50) VALUE             01150000
011600         '010DATABASE ERROR ON DELETE-A-DISTRO-LINE FUNCTION'.    01160000
011700     05  PM-011                       PIC X(50) VALUE             01170000
011800         '011SUCCESSFUL LINE DELETE                         '.    01180000
011900     05  PM-012                       PIC X(50) VALUE             01190000
012000         '012                                               '.    01200000
012100     05  PM-013                       PIC X(50) VALUE             01210000
012200         '013RECDIS ROWS WITH THE PREPK-ID WERE NOT FOUND   '.    01220000
012300     05  PM-014                       PIC X(50) VALUE             01230000
012400         '014LINES IN A PACK ON RECDIS ALREADY VERIFIED     '.    01240000
012500     05  PM-015                       PIC X(50) VALUE             01250000
012600         '015DATABASE ERROR ON DELETE-A-DISTRO-PACK FUNCTION'.    01260000
012700     05  PM-016                       PIC X(50) VALUE             01270000
012800         '016SUCCESSFUL LINE COPY                           '.    01280000
012900     05  PM-017                       PIC X(50) VALUE             01290000
013000         '017THE RATIO FOR LINE BEING ADDED DOES NOT EXIST  '.    01300000
013100     05  PM-018                       PIC X(50) VALUE             01310000
013200         '018STORE ALLOCATION FOR LINE ADD ALREADY EXISTS   '.    01320000
013300     05  PM-019                       PIC X(50) VALUE             01330000
013400         '019STORE ALLOCATION FOR CLONE LINE DOES NOT EXIST '.    01340000
013500     05  PM-020                       PIC X(50) VALUE             01350000
013600         '020LINES IN A PACK ON RECDIS ALREADY VERIFIED     '.    01360000
013700     05  PM-021                       PIC X(50) VALUE             01370000
013800         '021DATABASE ERROR ON ADD-A-DISTRO-LINE FUNCTION   '.    01380000
013900     05  PM-022                       PIC X(50) VALUE             01390000
014000         '022FOR ADD, BOTH CLONE & MODIFY LINES ARE NEEDED  '.    01400000
014100     05  PM-023                       PIC X(50) VALUE             01410000
014200         '023FOR CONVERT, MODIFY LINE MUST BE PRESENT       '.    01420000
014300     05  PM-024                       PIC X(50) VALUE             01430000
014400         '024CANNOT ADD, RECDIS LINE ALREADY EXISTS         '.    01440000
014500     05  PM-025                       PIC X(50) VALUE             01450000
014600         '025BAD SQL RETURN WHEN COUNTING TRECITM           '.    01460000
014700     05  PM-026                       PIC X(50) VALUE             01470000
014800         '026NO LINE TO COPY IN RECDIS                      '.    01480000
014900     05  PM-027                       PIC X(50) VALUE             01490000
015000         '027BAD SQL RETURN WHEN COUNTING TDISTHD           '.    01500000
015100     05  PM-998                       PIC X(50) VALUE             01510000
015200         '998NOT ALL KEYS PASSED                            '.    01520000
015300     05  PM-999                       PIC X(50) VALUE             01530000
015400         '999INVALID FUNCTION                               '.    01540000
015500                                                                  01550000
015600******************************************************************01560000
015700*    COPYBOOK AREA                                                01570000
015800******************************************************************01580000
015900     COPY RCWS811.                                                01590000
016000                                                                  01600000
016100     COPY DPWS277.                                                01610000
016200                                                                  01620000
016300     COPY DPWS013.                                                01630000
016400                                                                  01640000
016500     COPY DPWS017.                                                01650000
016600                                                                  01660000
016700     COPY DPWS020.                                                01670000
016800                                                                  01680000
016900******************************************************************01690000
017000*    DB2 SQL COMMUNICATION AREA                                   01700000
017100******************************************************************01710000
017200     EXEC SQL                                                     01720000
017300          INCLUDE SQLCA                                           01730000
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017600******************************************************************01760000
017700*    DB2 DCLGEN FOR DISTRIBUTION HEADER TABLE                     01770000
017800******************************************************************01780000
017900     EXEC SQL                                                     01790000
018000          INCLUDE TDISTHD                                         01800000
018100     END-EXEC.                                                    01810000
018200                                                                  01820000
018300******************************************************************01830000
018400*    DB2 DCLGEN FOR PACK SLIP HEADER TABLE                        01840000
018500******************************************************************01850000
018600     EXEC SQL                                                     01860000
018700          INCLUDE TPKSLIP                                         01870000
018800     END-EXEC.                                                    01880000
018900                                                                  01890000
019000******************************************************************01900000
019100*    DB2 DCLGEN FOR PACK SLIP ITEM TABLE                          01910000
019200******************************************************************01920000
019300     EXEC SQL                                                     01930000
019400          INCLUDE TPKITEM                                         01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700******************************************************************01970000
019800*    DB2 DCLGEN FOR RECEIVE ITEM TABLE                            01980000
019900******************************************************************01990000
020000     EXEC SQL                                                     02000000
020100          INCLUDE TRECITM                                         02010000
020200     END-EXEC.                                                    02020000
020300                                                                  02030000
020400******************************************************************02040000
020500*    DB2 DCLGEN FOR ITEM DISPOSITION TABLE                        02050000
020600******************************************************************02060000
020700     EXEC SQL                                                     02070000
020800          INCLUDE TRECDIS                                         02080000
020900     END-EXEC.                                                    02090000
021000                                                                  02100000
021100******************************************************************02110000
021200*    DB2 DCLGEN FOR ODD UNIT TABLE                                02120000
021300******************************************************************02130000
021400     EXEC SQL                                                     02140000
021500          INCLUDE RCT00009                                        02150000
021600     END-EXEC.                                                    02160000
021700                                                                  02170000
021800******************************************************************02180000
021900*    RECITM CURSOR                                                02190000
022000******************************************************************02200000
022100     EXEC SQL                                                     02210000
022200          DECLARE SELECT-RECITM-CSR CURSOR FOR                    02220000
022300           SELECT ORD_LNE_NBR                                     02230000
022400             FROM TRECITM                                         02240000
022500            WHERE ORD_NBR        = :RC811-PO-NBR                  02250000
022600              AND REC_SEQ_NBR    = :RC811-REC-SEQ-NBR             02260000
022700              AND OPER_UNT_ID    = :RC811-OPER-UNIT-ID            02270000
022800              AND FCLTY_ID       = :RC811-FACILITY-ID             02280000
022900              AND PREPK_ID       = :RC811-PREPK-ID                02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200******************************************************************02320000
023300*    RECDIS HOLD CURSOR                                           02330000
023400******************************************************************02340000
023500     EXEC SQL                                                     02350000
023600       DECLARE RECDIS-HOLD-CSR CURSOR WITH HOLD FOR               02360000
023700        SELECT STR_NBR                                            02370000
023800             , EXPTED_ITM_QTY                                     02380000
023900             , VERIFY_ITM_QTY                                     02390000
024000             , PLAN_ITM_QTY                                       02400000
024100          FROM TRECDIS                                            02410000
024200         WHERE ORD_NBR      = :RC811-PO-NBR                       02420000
024300           AND ORD_LNE_NBR  = :RC811-MODIFY-LINE-NBR              02430000
024400           AND REC_SEQ_NBR  = :RC811-REC-SEQ-NBR                  02440000
024500           AND OPER_UNT_ID  = :RC811-OPER-UNIT-ID                 02450000
024600           AND FCLTY_ID     = :RC811-FACILITY-ID                  02460000
024700           FOR UPDATE OF EXPTED_ITM_QTY                           02470000
024800                       , VERIFY_ITM_QTY                           02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100******************************************************************02510000
025200*    RECDIS CLONE CURSOR                                          02520000
025300******************************************************************02530000
025400     EXEC SQL                                                     02540000
025500       DECLARE RECDIS-CLONE-CSR CURSOR WITH HOLD FOR              02550000
025600        SELECT STR_NBR                                            02560000
025700             , EXPTED_ITM_QTY                                     02570000
025800             , VERIFY_ITM_QTY                                     02580000
025900             , PLAN_ITM_QTY                                       02590000
026000          FROM TRECDIS                                            02600000
026100         WHERE ORD_NBR      = :RC811-PO-NBR                       02610000
026200           AND ORD_LNE_NBR  = :DK-CLONE-LINE-NBR                  02620000
026300           AND REC_SEQ_NBR  = :RC811-REC-SEQ-NBR                  02630000
026400           AND OPER_UNT_ID  = :RC811-OPER-UNIT-ID                 02640000
026500           AND FCLTY_ID     = :RC811-FACILITY-ID                  02650000
026600     END-EXEC.                                                    02660000
026700                                                                  02670000
026800******************************************************************02680000
026900******************************************************************02690000
027000 LINKAGE SECTION.                                                 02700000
027100                                                                  02710000
027200 01  DFHCOMMAREA.                                                 02720000
027300     05  FILLER                       OCCURS 1 TO 600  TIMES      02730000
027400                                      DEPENDING ON EIBCALEN.      02740000
027500         10  FILLER                   PIC X.                      02750000
027600                                                                  02760000
027700                                                                  02770000
027800 PROCEDURE DIVISION.                                              02780000
027900******************************************************************02790000
028000*  THIS PARAGRAPH DRIVES THE PROGRAM LOGIC.                       02800000
028100******************************************************************02810000
028200 0000-MAIN-MODULE.                                                02820000
028300                                                                  02830000
028400     PERFORM 0100-HOUSEKEEPING.                                   02840000
029910                                                                  02991000
029920*CHECK PASSED KEYS.                                               02992000
029930     SET PS-NOT-DONE TO TRUE.                                     02993000
029940                                                                  02994000
029950     IF RC811-PO-NBR         NOT > +0                             02995000
029960       OR RC811-REC-SEQ-NBR  NOT > +0                             02996000
029970       OR RC811-OPER-UNIT-ID NOT > +0                             02997000
029980       OR RC811-FACILITY-ID  NOT > +0                             02998000
029990       OR RC811-PREPK-ID     NOT > +0                             02999000
030000         SET PS-DONE TO TRUE                                      03000000
030100         MOVE 998 TO RC811-RETURN-CODE                            03010000
030200         MOVE 'F' TO RC811-SEVERITY-IND                           03020000
030300         PERFORM 9900-SOFT-ABORT                                  03030000
030400     END-IF.                                                      03040000
030500                                                                  03050000
030600     IF RC811-ADD-A-DISTRO-LINE                                   03060000
030700         IF RC811-CLONE-LINE-NBR NOT > +0                         03070000
030800           OR RC811-MODIFY-LINE-NBR NOT > +0                      03080000
030900             SET PS-DONE TO TRUE                                  03090000
031000             MOVE 022 TO RC811-RETURN-CODE                        03100000
031100             MOVE 'F' TO RC811-SEVERITY-IND                       03110000
031200             PERFORM 9900-SOFT-ABORT                              03120000
031300         END-IF                                                   03130000
031400     END-IF.                                                      03140000
031500                                                                  03150000
031600     IF RC811-CONVERT-DISTRO-RATIO                                03160000
031700         IF RC811-MODIFY-LINE-NBR NOT > +0                        03170000
031800             SET PS-DONE TO TRUE                                  03180000
031900             MOVE 023 TO RC811-RETURN-CODE                        03190000
032000             MOVE 'F' TO RC811-SEVERITY-IND                       03200000
032100             PERFORM 9900-SOFT-ABORT                              03210000
032200         END-IF                                                   03220000
032300     END-IF.                                                      03230000
032400                                                                  03240000
032500     IF RC811-CONVERT-DISTRO-RATIO                                03250000
032600         IF RC811-OLD-DISTRO-RATIO NOT > +0                       03260000
032700           OR RC811-NEW-RC-RATIO NOT > +0                         03270000
032800             SET PS-DONE TO TRUE                                  03280000
032900             MOVE 002 TO RC811-RETURN-CODE                        03290000
033000             MOVE 'F' TO RC811-SEVERITY-IND                       03300000
033100             PERFORM 9900-SOFT-ABORT                              03310000
033200         END-IF                                                   03320000
033300     END-IF.                                                      03330000
033400                                                                  03340000
033500     IF RC811-DELETE-A-DISTRO-LINE                                03350000
033600         IF RC811-DELETE-LINE-NBR NOT > +0                        03360000
033700             SET PS-DONE TO TRUE                                  03370000
033800             MOVE 007 TO RC811-RETURN-CODE                        03380000
033900             MOVE 'F' TO RC811-SEVERITY-IND                       03390000
034000             PERFORM 9900-SOFT-ABORT                              03400000
034100         END-IF                                                   03410000
034200     END-IF.                                                      03420000
034300                                                                  03430000
034400*CHECK FOR VERIFIED ITEMS                                         03440000
034500*IF VERIFIED ITEMS - ERROR                                        03450000
034600     IF PS-NOT-DONE                                               03460000
034700         PERFORM 5000-COUNT-RECITM                                03470000
034800         IF PV-DB2-COUNT > +0                                     03480000
034900             SET PS-DONE TO TRUE                                  03490000
035000             MOVE 020 TO RC811-RETURN-CODE                        03500000
035100             MOVE 'F' TO RC811-SEVERITY-IND                       03510000
035200             PERFORM 9900-SOFT-ABORT                              03520000
035300         END-IF                                                   03530000
035400     END-IF.                                                      03540000
035500                                                                  03550000
035600     IF PS-NOT-DONE                                               03560000
035700         PERFORM 5100-COUNT-DISTHD                                03570000
035800         IF PV-DB2-COUNT > +0                                     03580000
035900             SET PS-DONE TO TRUE                                  03590000
036000             MOVE 020 TO RC811-RETURN-CODE                        03600000
036100             MOVE 'F' TO RC811-SEVERITY-IND                       03610000
036200             PERFORM 9900-SOFT-ABORT                              03620000
036300         END-IF                                                   03630000
036400     END-IF.                                                      03640000
036500                                                                  03650000
036600*CHECK REQUESTED FUNCTION.                                        03660000
036700     IF PS-NOT-DONE                                               03670000
036800         EVALUATE TRUE                                            03680000
036900           WHEN RC811-ADD-A-DISTRO-LINE                           03690000
037000               PERFORM 1000-ADD-LINE                              03700000
037100                                                                  03710000
037200           WHEN RC811-CONVERT-DISTRO-RATIO                        03720000
037300               PERFORM 2000-CONVERT-RATIO                         03730000
037400                                                                  03740000
037500           WHEN RC811-DELETE-A-DISTRO-LINE                        03750000
037600               PERFORM 3000-DELETE-LINE                           03760000
037700                                                                  03770000
037800           WHEN RC811-DELETE-A-DISTRO-PACK                        03780000
037900               PERFORM 4000-DELETE-PACK                           03790000
038000                                                                  03800000
038100           WHEN OTHER                                             03810000
038200               STRING ' INVALID FUNCTION (' RC811-FUNCTION ')'    03820000
038300                      DELIMITED BY SIZE INTO PV-RETURN-MSG        03830000
038400               MOVE 999 TO RC811-RETURN-CODE                      03840000
038500               MOVE 'F' TO RC811-SEVERITY-IND                     03850000
038600               PERFORM 9900-SOFT-ABORT                            03860000
038700         END-EVALUATE                                             03870000
038800     END-IF.                                                      03880000
038900                                                                  03890000
039000     MOVE RC811-STORE-RECDIS-PROCESSING TO DFHCOMMAREA.           03900000
039100                                                                  03910000
040013     GOBACK.                                                      04001300
040014                                                                  04001400
040015******************************************************************04001500
040016*  THIS PARAGRAPH SETS INITIAL VALUES FOR THE PROGRAM.            04001600
040017******************************************************************04001700
040018 0100-HOUSEKEEPING.                                               04001800
040019                                                                  04001900
040020     MOVE DFHCOMMAREA TO RC811-STORE-RECDIS-PROCESSING.           04002000
040030                                                                  04003000
040040     INITIALIZE RC811-RETURN-DATA.                                04004000
040050                                                                  04005000
040051     SET  PS-FIRST-PASS  TO  TRUE.                                04005100
040052                                                                  04005200
040060******************************************************************04006000
040070*  THIS PARAGRAPH WILL CLONE ONE LINE                             04007000
040080*  FROM THE DRIVER OR ALTERNATE LINE                              04008000
040090******************************************************************04009000
040100 1000-ADD-LINE.                                                   04010000
040200                                                                  04020000
040300*CHECK RATIO QTY - 'CLONE' VS 'MODIFY'                            04030000
040400     IF PS-NOT-DONE                                               04040000
040500         MOVE RC811-CLONE-LINE-NBR  TO DK-CLONE-LINE-NBR          04050000
040600         MOVE RC811-MODIFY-LINE-NBR TO DK-MODIFY-LINE-NBR         04060000
040700                                                                  04070000
040800         INITIALIZE PV-CLONE-RATIO-QTY                            04080000
040900         PERFORM 1100-SELECT-RECITM-CLONE                         04090000
041000                                                                  04100000
041100         INITIALIZE PV-MODIFY-RATIO-QTY                           04110000
041200         PERFORM 1200-SELECT-RECITM-MODIFY                        04120000
041300                                                                  04130000
041400         IF PS-RECITM-MODIFY-NO                                   04140000
041500             SET PS-DONE TO TRUE                                  04150000
041600             MOVE 017 TO RC811-RETURN-CODE                        04160000
041700             MOVE 'F' TO RC811-SEVERITY-IND                       04170000
041800             PERFORM 9900-SOFT-ABORT                              04180000
041900         END-IF                                                   04190000
042000     END-IF.                                                      04200000
042100                                                                  04210000
042200*COUNT RECDIS - 'CLONE' VS 'MODIFY'                               04220000
042300     IF PS-RECITM-CLONE-YES                                       04230000
042400       AND PS-RECITM-MODIFY-YES                                   04240000
042500         PERFORM 1300-COUNT-RECDIS-CLONE                          04250000
042600         PERFORM 1400-COUNT-RECDIS-MODIFY                         04260000
042700         IF PV-MODIFY-COUNT > +0                                  04270000
042800             SET PS-DONE TO TRUE                                  04280000
042900             MOVE 024 TO RC811-RETURN-CODE                        04290000
043000             MOVE 'F' TO RC811-SEVERITY-IND                       04300000
043100             PERFORM 9900-SOFT-ABORT                              04310000
043200         END-IF                                                   04320000
043300     END-IF.                                                      04330000
043400                                                                  04340000
043500*CHECK FOR A LINE TO 'COPY'                                       04350000
043600     IF PS-NOT-DONE                                               04360000
043700         IF PV-CLONE-COUNT = +0                                   04370000
043800             PERFORM 1500-SELECT-RECITM-INACTIVE                  04380000
043900             IF PV-CLONE-COUNT = +0                               04390000
044000                 SET PS-DONE TO TRUE                              04400000
044100                 MOVE 003 TO RC811-RETURN-CODE                    04410000
044200                 MOVE 'F' TO RC811-SEVERITY-IND                   04420000
044300                 PERFORM 9900-SOFT-ABORT                          04430000
044400             END-IF                                               04440000
044500         END-IF                                                   04450000
044600     END-IF.                                                      04460000
044700                                                                  04470000
044800*CREATE CLONE                                                     04480000
044900     IF PS-NOT-DONE                                               04490000
045000         PERFORM 1600-OPEN-CLONE-CSR                              04500000
045100         PERFORM 1700-FETCH-CLONE-CSR                             04510000
045200         PERFORM 1800-PROCESS-CLONE                               04520000
045300           UNTIL PS-RECDIS-CLONE-CSR-EOF                          04530000
045400         PERFORM 1900-CLOSE-CLONE-CSR                             04540000
045500     END-IF.                                                      04550000
045600                                                                  04560000
045700******************************************************************04570000
045800 1100-SELECT-RECITM-CLONE.                                        04580000
045900                                                                  04590000
046000     EXEC SQL                                                     04600000
046100         SELECT DISTINCT                                          04610000
046200                PREPK_RATO_QTY                                    04620000
046300           INTO :PV-CLONE-RATIO-QTY                               04630000
046400           FROM TRECITM                                           04640000
046500          WHERE ORD_NBR        = :RC811-PO-NBR                    04650000
046600            AND ORD_LNE_NBR    = :DK-CLONE-LINE-NBR               04660000
046700            AND REC_SEQ_NBR    = :RC811-REC-SEQ-NBR               04670000
046800            AND OPER_UNT_ID    = :RC811-OPER-UNIT-ID              04680000
046900            AND FCLTY_ID       = :RC811-FACILITY-ID               04690000
047000            AND PREPK_ID       = :RC811-PREPK-ID                  04700000
047100            AND VER_STATUS_CDE = :PC-A                            04710000
047200     END-EXEC.                                                    04720000
047300                                                                  04730000
047400     EVALUATE TRUE                                                04740000
047500       WHEN SQLCODE = ZERO                                        04750000
047600           SET PS-RECITM-CLONE-YES TO TRUE                        04760000
047700                                                                  04770000
047800       WHEN SQLCODE = +100                                        04780000
047900           SET PS-RECITM-CLONE-NO TO TRUE                         04790000
048000                                                                  04800000
048100       WHEN OTHER                                                 04810000
048200           SET PS-RECITM-CLONE-NO TO TRUE                         04820000
048300           MOVE 021 TO RC811-RETURN-CODE                          04830000
048400           MOVE 'F' TO RC811-SEVERITY-IND                         04840000
048500           PERFORM 9900-SOFT-ABORT                                04850000
048600     END-EVALUATE.                                                04860000
048700                                                                  04870000
048800******************************************************************04880000
048900 1200-SELECT-RECITM-MODIFY.                                       04890000
049000                                                                  04900000
049100     EXEC SQL                                                     04910000
049200         SELECT DISTINCT                                          04920000
049300                PREPK_RATO_QTY                                    04930000
049400           INTO :PV-MODIFY-RATIO-QTY                              04940000
049500           FROM TRECITM                                           04950000
049600          WHERE ORD_NBR        = :RC811-PO-NBR                    04960000
049700            AND ORD_LNE_NBR    = :DK-MODIFY-LINE-NBR              04970000
049800            AND REC_SEQ_NBR    = :RC811-REC-SEQ-NBR               04980000
049900            AND OPER_UNT_ID    = :RC811-OPER-UNIT-ID              04990000
050000            AND FCLTY_ID       = :RC811-FACILITY-ID               05000000
050100            AND PREPK_ID       = :RC811-PREPK-ID                  05010000
050200            AND VER_STATUS_CDE = :PC-A                            05020000
050300     END-EXEC.                                                    05030000
050400                                                                  05040000
050500     EVALUATE TRUE                                                05050000
050600       WHEN SQLCODE = ZERO                                        05060000
050700           SET PS-RECITM-MODIFY-YES TO TRUE                       05070000
050800                                                                  05080000
050900       WHEN OTHER                                                 05090000
051000           SET PS-RECITM-MODIFY-NO TO TRUE                        05100000
051100     END-EVALUATE.                                                05110000
051200                                                                  05120000
051300******************************************************************05130000
051400 1300-COUNT-RECDIS-CLONE.                                         05140000
051500                                                                  05150000
051600     EXEC SQL                                                     05160000
051700         SELECT COUNT(*)                                          05170000
051800           INTO :PV-CLONE-COUNT                                   05180000
051900           FROM TRECDIS                                           05190000
052000          WHERE ORD_NBR     = :RC811-PO-NBR                       05200000
052100            AND ORD_LNE_NBR = :DK-CLONE-LINE-NBR                  05210000
052200            AND REC_SEQ_NBR = :RC811-REC-SEQ-NBR                  05220000
052300            AND OPER_UNT_ID = :RC811-OPER-UNIT-ID                 05230000
052400            AND FCLTY_ID    = :RC811-FACILITY-ID                  05240000
052500     END-EXEC.                                                    05250000
052600                                                                  05260000
052700     EVALUATE TRUE                                                05270000
052800       WHEN SQLCODE = +0                                          05280000
052900           CONTINUE                                               05290000
053000                                                                  05300000
053100       WHEN OTHER                                                 05310000
053200           MOVE 021 TO RC811-RETURN-CODE                          05320000
053300           MOVE 'F' TO RC811-SEVERITY-IND                         05330000
053400           PERFORM 9900-SOFT-ABORT                                05340000
053500     END-EVALUATE.                                                05350000
053600                                                                  05360000
053700******************************************************************05370000
053800 1400-COUNT-RECDIS-MODIFY.                                        05380000
053900                                                                  05390000
054000     EXEC SQL                                                     05400000
054100         SELECT COUNT(*)                                          05410000
054200           INTO :PV-MODIFY-COUNT                                  05420000
054300           FROM TRECDIS                                           05430000
054400          WHERE ORD_NBR     = :RC811-PO-NBR                       05440000
054500            AND ORD_LNE_NBR = :DK-MODIFY-LINE-NBR                 05450000
054600            AND REC_SEQ_NBR = :RC811-REC-SEQ-NBR                  05460000
054700            AND OPER_UNT_ID = :RC811-OPER-UNIT-ID                 05470000
054800            AND FCLTY_ID    = :RC811-FACILITY-ID                  05480000
054900     END-EXEC.                                                    05490000
055000                                                                  05500000
055100     EVALUATE TRUE                                                05510000
055200       WHEN SQLCODE = +0                                          05520000
055300           CONTINUE                                               05530000
055400                                                                  05540000
055500       WHEN OTHER                                                 05550000
055600           MOVE 021 TO RC811-RETURN-CODE                          05560000
055700           MOVE 'F' TO RC811-SEVERITY-IND                         05570000
055800           PERFORM 9900-SOFT-ABORT                                05580000
055900     END-EVALUATE.                                                05590000
056000                                                                  05600000
056100******************************************************************05610000
056200 1500-SELECT-RECITM-INACTIVE.                                     05620000
056300                                                                  05630000
056400     EXEC SQL                                                     05640000
056500         SELECT DISTINCT                                          05650000
056600                PREPK_RATO_QTY                                    05660000
056700              , ORD_LNE_NBR                                       05670000
056800           INTO :PV-CLONE-RATIO-QTY                               05680000
056900              , :DK-CLONE-LINE-NBR                                05690000
057000           FROM TRECITM                                           05700000
057100          WHERE ORD_NBR           = :RC811-PO-NBR                 05710000
057200            AND REC_SEQ_NBR       = :RC811-REC-SEQ-NBR            05720000
057300            AND OPER_UNT_ID       = :RC811-OPER-UNIT-ID           05730000
057400            AND FCLTY_ID          = :RC811-FACILITY-ID            05740000
057500            AND PREPK_ID          = :RC811-PREPK-ID               05750000
057600            AND PREPK_DRV_LNE_CDE = :PC-INACTIVE                  05760000
057700            AND VER_STATUS_CDE    = :PC-A                         05770000
057800     END-EXEC.                                                    05780000
057900                                                                  05790000
058000     EVALUATE TRUE                                                05800000
058100       WHEN SQLCODE = ZERO                                        05810000
058200       WHEN SQLCODE = -811                                        05820000
058300           CONTINUE                                               05830000
058400                                                                  05840000
058500       WHEN SQLCODE = +100                                        05850000
058600           SET PS-DONE TO TRUE                                    05860000
058700           MOVE 026 TO RC811-RETURN-CODE                          05870000
058800           MOVE 'W' TO RC811-SEVERITY-IND                         05880000
058900           PERFORM 9900-SOFT-ABORT                                05890000
059000                                                                  05900000
059100       WHEN OTHER                                                 05910000
059200           SET PS-DONE TO TRUE                                    05920000
059300           MOVE 021 TO RC811-RETURN-CODE                          05930000
059400           MOVE 'F' TO RC811-SEVERITY-IND                         05940000
059500           PERFORM 9900-SOFT-ABORT                                05950000
059600     END-EVALUATE.                                                05960000
059700                                                                  05970000
059800*CHECK FOR LINE TO COPY                                           05980000
059900     EXEC SQL                                                     05990000
060000         SELECT COUNT(*)                                          06000000
060100           INTO :PV-CLONE-COUNT                                   06010000
060200           FROM TRECDIS                                           06020000
060300          WHERE ORD_NBR     = :RC811-PO-NBR                       06030000
060400            AND ORD_LNE_NBR = :DK-CLONE-LINE-NBR                  06040000
060500            AND REC_SEQ_NBR = :RC811-REC-SEQ-NBR                  06050000
060600            AND OPER_UNT_ID = :RC811-OPER-UNIT-ID                 06060000
060700            AND FCLTY_ID    = :RC811-FACILITY-ID                  06070000
060800     END-EXEC.                                                    06080000
060900                                                                  06090000
061000     EVALUATE TRUE                                                06100000
061100       WHEN SQLCODE = +0                                          06110000
061200           CONTINUE                                               06120000
061300                                                                  06130000
061400       WHEN SQLCODE = +100                                        06140000
061500           SET PS-DONE TO TRUE                                    06150000
061600           MOVE 003 TO RC811-RETURN-CODE                          06160000
061700           MOVE 'F' TO RC811-SEVERITY-IND                         06170000
061800           PERFORM 9900-SOFT-ABORT                                06180000
061900                                                                  06190000
062000       WHEN OTHER                                                 06200000
062100           SET PS-DONE TO TRUE                                    06210000
062200           MOVE 021 TO RC811-RETURN-CODE                          06220000
062300           MOVE 'F' TO RC811-SEVERITY-IND                         06230000
062400           PERFORM 9900-SOFT-ABORT                                06240000
062500     END-EVALUATE.                                                06250000
062600                                                                  06260000
062700******************************************************************06270000
062800 1600-OPEN-CLONE-CSR.                                             06280000
062900                                                                  06290000
063000     EXEC SQL                                                     06300000
063100         OPEN RECDIS-CLONE-CSR                                    06310000
063200     END-EXEC.                                                    06320000
063300                                                                  06330000
063400     EVALUATE TRUE                                                06340000
063500       WHEN SQLCODE = ZERO                                        06350000
063600           SET PS-RECDIS-CLONE-CSR-YES TO TRUE                    06360000
063700                                                                  06370000
063800       WHEN OTHER                                                 06380000
063900           SET PS-RECDIS-CLONE-CSR-EOF TO TRUE                    06390000
064000           MOVE 021 TO RC811-RETURN-CODE                          06400000
064100           MOVE 'F' TO RC811-SEVERITY-IND                         06410000
064200           PERFORM 9900-SOFT-ABORT                                06420000
064300     END-EVALUATE.                                                06430000
064400                                                                  06440000
064500******************************************************************06450000
064600 1700-FETCH-CLONE-CSR.                                            06460000
064700                                                                  06470000
065200     EXEC SQL                                                     06520000
065300         FETCH RECDIS-CLONE-CSR                                   06530000
065400          INTO :RECDIS-STR-NBR                                    06540000
065500             , :PV-EXPTED-ITM-QTY                                 06550000
065600             , :PV-VERIFY-ITM-QTY                                 06560000
065700             , :RECDIS-PLAN-ITM-QTY                               06570000
065800     END-EXEC.                                                    06580000
065900                                                                  06590000
066000     EVALUATE TRUE                                                06600000
066100       WHEN SQLCODE = ZERO                                        06610000
066200           SET PS-RECDIS-CLONE-CSR-YES TO TRUE                    06620000
066300                                                                  06630000
067240       WHEN SQLCODE = +100                                        06724000
067250           SET PS-RECDIS-CLONE-CSR-EOF TO TRUE                    06725000
067260                                                                  06726000
067270       WHEN OTHER                                                 06727000
067280           SET PS-RECDIS-CLONE-CSR-EOF TO TRUE                    06728000
067290           MOVE 021 TO RC811-RETURN-CODE                          06729000
067300           MOVE 'F' TO RC811-SEVERITY-IND                         06730000
067400           PERFORM 9900-SOFT-ABORT                                06740000
067500     END-EVALUATE.                                                06750000
067600                                                                  06760000
067700******************************************************************06770000
067800 1800-PROCESS-CLONE.                                              06780000
067900                                                                  06790000
068400*CALL DPKCS277 FOR STORE 'OTR'/PLAN-QTY                           06840000
068500*10/11 - ONLY CALL DP277 IF PLAN-ITM-QTY > ZERO                   06850000
068510                                                                  06851000
068520     IF  PS-FIRST-PASS                                            06852000
068600         INITIALIZE DP277-COMMAREA                                06860000
068610     END-IF.                                                      06861000
068620                                                                  06862000
068700     IF RECDIS-PLAN-ITM-QTY > +0                                  06870000
068710         IF  PS-FIRST-PASS                                        06871000
068800             PERFORM 1810-CALL-OTR-SUBROUTINE                     06880000
068801             SET  PS-FIRST-PASS-NO  TO  TRUE                      06880100
068810         END-IF                                                   06881000
069150     END-IF.                                                      06915000
069160                                                                  06916000
069170*PREPARE RECDIS FOR INSERT                                        06917000
069180     PERFORM 1820-LOAD-RECDIS-VALUES.                             06918000
069190                                                                  06919000
069200*INSERT RECDIS (CLONE)                                            06920000
069300     PERFORM 1830-INSERT-RECDIS.                                  06930000
069400                                                                  06940000
069500*GET NEXT RECDIS ROW                                              06950000
069600     PERFORM 1700-FETCH-CLONE-CSR.                                06960000
069700                                                                  06970000
069800******************************************************************06980000
069900 1810-CALL-OTR-SUBROUTINE.                                        06990000
070000                                                                  07000000
070600     MOVE 'S'                   TO   DP277-OTR-TYPE.              07060000
070700     MOVE 'R'                   TO   DP277-OTR-SCOPE.             07070000
070800     MOVE 'M'                   TO   DP277-STORE-PLAN-SCOPE.      07080000
070900                                                                  07090000
071000     INITIALIZE                 DP277-KEYS.                       07100000
071100                                                                  07110000
071200     MOVE RC811-PO-NBR          TO   DP277-PO-NBR.                07120000
071300     MOVE RC811-MODIFY-LINE-NBR TO   DP277-PO-LNE-NBR.            07130000
071400     MOVE RC811-REC-SEQ-NBR     TO   DP277-REC-SEQ-NBR.           07140000
071500     MOVE RC811-OPER-UNIT-ID    TO   DP277-OPER-UNT-ID.           07150000
071600     MOVE RC811-PREPK-ID        TO   DP277-PO-PREPK-ID.           07160000
071700     MOVE RC811-FACILITY-ID     TO   DP277-FCLTY-ID.              07170000
071800                                                                  07180000
072015     COPY DPPD277.                                                07201500
072016                                                                  07201600
072017                                                                  07201700
072018******************************************************************07201800
072019 1820-LOAD-RECDIS-VALUES.                                         07201900
072020                                                                  07202000
072080     MOVE RC811-PO-NBR          TO RECDIS-ORD-NBR.                07208000
072090     MOVE RC811-MODIFY-LINE-NBR TO RECDIS-ORD-LNE-NBR.            07209000
072100     MOVE RC811-REC-SEQ-NBR     TO RECDIS-REC-SEQ-NBR.            07210000
072200     MOVE RC811-OPER-UNIT-ID    TO RECDIS-OPER-UNT-ID.            07220000
072300     MOVE 1                     TO RECDIS-FCLTY-ID.               07230000
072400                                                                  07240000
072500     MOVE PC-RC811-UID          TO RECDIS-CRE-UID.                07250000
072600     MOVE PC-ACTIVE             TO RECDIS-VER-STATUS-CDE.         07260000
072700                                                                  07270000
072800*CALCULATE RATIOS.                                                07280000
072900     COMPUTE PV-FACTOR = PV-MODIFY-RATIO-QTY                      07290000
073000                       / PV-CLONE-RATIO-QTY.                      07300000
073100     COMPUTE PV-NEW-EXPTED-COMPUTED-QTY ROUNDED =                 07310000
073200                         PV-EXPTED-ITM-QTY                        07320000
073300                       * PV-FACTOR.                               07330000
073400     COMPUTE PV-NEW-VERIFY-COMPUTED-QTY ROUNDED =                 07340000
073500                         PV-VERIFY-ITM-QTY                        07350000
073600                       * PV-FACTOR.                               07360000
073700     MOVE PV-NEW-EXPTED-COMPUTED-QTY TO RECDIS-EXPTED-ITM-QTY.    07370000
073800     MOVE PV-NEW-VERIFY-COMPUTED-QTY TO RECDIS-VERIFY-ITM-QTY.    07380000
073900                                                                  07390000
074000     MOVE 0                     TO RECDIS-AP-VERIFY-ITM-QTY.      07400000
074100                                                                  07410000
074200     IF RECDIS-PLAN-ITM-QTY > +0                                  07420000
074300       MOVE RECDIS-STR-NBR        TO DP277-SEARCH-NBR             07430000
074900       PERFORM 4210-SEARCH-OTR                                    07490000
075110     ELSE                                                         07511000
075120         MOVE  ZEROES           TO DP277-OTR-OUT                  07512000
075200     END-IF.                                                      07520000
075500                                                                  07550000
075600     MOVE 1                     TO RECDIS-STR-FCLTY-ID.           07560000
075700     MOVE SPACES                TO RECDIS-AP-PRC-CDE.             07570000
075800                                                                  07580000
075900     COMPUTE PV-NEW-PLAN-COMPUTED-QTY ROUNDED =                   07590000
076010                                DP277-OTR-OUT.                    07601000
076100     MOVE PV-NEW-PLAN-COMPUTED-QTY TO RECDIS-PLAN-ITM-QTY.        07610000
076200                                                                  07620000
076300     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       07630000
076400*JPL MOVE DP017-EDITED-DATE-YYYYMMDD TO PC-DEFAULT-DATE.          07640000
076500     MOVE PC-DEFAULT-DATE            TO RECDIS-AP-PRC-DTE.        07650000
076600                                                                  07660000
076700******************************************************************07670000
076800 1830-INSERT-RECDIS.                                              07680000
076900                                                                  07690000
077000     EXEC SQL                                                     07700000
077100         INSERT                                                   07710000
077200           INTO TRECDIS                                           07720000
077300                (ORD_NBR                                          07730000
077400                ,ORD_LNE_NBR                                      07740000
077500                ,REC_SEQ_NBR                                      07750000
077600                ,OPER_UNT_ID                                      07760000
077700                ,FCLTY_ID                                         07770000
077800                ,CRE_TMST                                         07780000
077900                ,CRE_UID                                          07790000
078000                ,VER_STATUS_CDE                                   07800000
078100                ,EXPTED_ITM_QTY                                   07810000
078200                ,VERIFY_ITM_QTY                                   07820000
078300                ,AP_VERIFY_ITM_QTY                                07830000
078400                ,STR_NBR                                          07840000
078500                ,STR_FCLTY_ID                                     07850000
078600                ,PLAN_ITM_QTY                                     07860000
078700                ,AP_PRC_CDE                                       07870000
078800                ,AP_PRC_DTE                                       07880000
078900                  )                                               07890000
079000          VALUES                                                  07900000
079100                 (:RECDIS-ORD-NBR                                 07910000
079200                , :RECDIS-ORD-LNE-NBR                             07920000
079300                , :RECDIS-REC-SEQ-NBR                             07930000
079400                , :RECDIS-OPER-UNT-ID                             07940000
079500                , :RECDIS-FCLTY-ID                                07950000
079600                , CURRENT TIMESTAMP                               07960000
079700                , :RECDIS-CRE-UID                                 07970000
079800                , :RECDIS-VER-STATUS-CDE                          07980000
079900                , :RECDIS-EXPTED-ITM-QTY                          07990000
080000                , :RECDIS-VERIFY-ITM-QTY                          08000000
080100                , :RECDIS-AP-VERIFY-ITM-QTY                       08010000
080200                , :RECDIS-STR-NBR                                 08020000
080300                , :RECDIS-STR-FCLTY-ID                            08030000
080400                , :RECDIS-PLAN-ITM-QTY                            08040000
080500                , :RECDIS-AP-PRC-CDE                              08050000
080600                , :RECDIS-AP-PRC-DTE                              08060000
080700                  )                                               08070000
080800     END-EXEC.                                                    08080000
080900                                                                  08090000
081000     EVALUATE TRUE                                                08100000
081100       WHEN SQLCODE = ZERO                                        08110000
081200           CONTINUE                                               08120000
081300                                                                  08130000
081400       WHEN SQLCODE = -904                                        08140000
081500       WHEN SQLCODE = -911                                        08150000
081600       WHEN SQLCODE = -913                                        08160000
081700           SET PS-RECDIS-CLONE-CSR-EOF TO TRUE                    08170000
081800           MOVE 021 TO RC811-RETURN-CODE                          08180000
081900           MOVE 'F' TO RC811-SEVERITY-IND                         08190000
082000           PERFORM 9900-SOFT-ABORT                                08200000
082100                                                                  08210000
082200       WHEN OTHER                                                 08220000
082300           SET PS-RECDIS-CLONE-CSR-EOF TO TRUE                    08230000
082400           MOVE '1830-INSERT-RECDIS' TO DP013-PARAGRAPH           08240000
082500           MOVE 'INSERT NEW ROW IN TRECDIS TABLE'                 08250000
082600                                     TO DP013-MESSAGE-TEXT (1)    08260000
082700           MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (1)  08270000
082800           MOVE SQLCA                TO DP013-SQLCA               08280000
082900           SET DP013-DB2-ABEND       TO TRUE                      08290000
083000           PERFORM DP013-0000-PROCESS-ABEND                       08300000
083100     END-EVALUATE.                                                08310000
083200                                                                  08320000
083300******************************************************************08330000
083400 1900-CLOSE-CLONE-CSR.                                            08340000
083500                                                                  08350000
083600     EXEC SQL                                                     08360000
083700         CLOSE RECDIS-CLONE-CSR                                   08370000
083800     END-EXEC.                                                    08380000
083900                                                                  08390000
084000     EVALUATE TRUE                                                08400000
084100       WHEN SQLCODE = ZERO                                        08410000
084200           CONTINUE                                               08420000
084300                                                                  08430000
084400       WHEN OTHER                                                 08440000
084500           MOVE 021 TO RC811-RETURN-CODE                          08450000
084600           MOVE 'F' TO RC811-SEVERITY-IND                         08460000
084700           PERFORM 9900-SOFT-ABORT                                08470000
084800     END-EVALUATE.                                                08480000
084900                                                                  08490000
085000******************************************************************08500000
085100*  THIS PARAGRAPH WILL RECALIBRATE A PACK'S LINE QUANTITIES IN    08510000
085200*  RECDIS TO CORRESPOND TO THE RECEIPT RATIO UPDATED IN RECITM    08520000
085300******************************************************************08530000
085400 2000-CONVERT-RATIO.                                              08540000
085500                                                                  08550000
085600     PERFORM 2100-OPEN-RECDIS-HOLD-CSR.                           08560000
085700                                                                  08570000
085800*MODIFY PASSED LINE NBR                                           08580000
085900     PERFORM 2200-FETCH-RECDIS-HOLD-CSR.                          08590000
086000     IF PS-RECDIS-HOLD-CSR-EOF                                    08600000
086100         MOVE 003 TO RC811-RETURN-CODE                            08610000
086200         MOVE 'W' TO RC811-SEVERITY-IND                           08620000
086300     ELSE                                                         08630000
086400         PERFORM 2300-PROCESS-RECDIS                              08640000
086500           UNTIL PS-RECDIS-HOLD-CSR-EOF                           08650000
086600     END-IF.                                                      08660000
086700                                                                  08670000
086800     PERFORM 2400-CLOSE-RECDIS-HOLD-CSR.                          08680000
086900                                                                  08690000
087000******************************************************************08700000
087100 2100-OPEN-RECDIS-HOLD-CSR.                                       08710000
087200                                                                  08720000
087300     EXEC SQL                                                     08730000
087400         OPEN RECDIS-HOLD-CSR                                     08740000
087500     END-EXEC.                                                    08750000
087600                                                                  08760000
087700     EVALUATE TRUE                                                08770000
087800       WHEN SQLCODE = ZERO                                        08780000
087900           SET PS-RECDIS-HOLD-CSR-YES TO TRUE                     08790000
088000                                                                  08800000
088100       WHEN OTHER                                                 08810000
088200           SET PS-RECDIS-HOLD-CSR-EOF TO TRUE                     08820000
088300           MOVE 005 TO RC811-RETURN-CODE                          08830000
088400           MOVE 'F' TO RC811-SEVERITY-IND                         08840000
088500           PERFORM 9900-SOFT-ABORT                                08850000
088600     END-EVALUATE.                                                08860000
088700                                                                  08870000
088800******************************************************************08880000
088900 2200-FETCH-RECDIS-HOLD-CSR.                                      08890000
089000                                                                  08900000
089150     EXEC SQL                                                     08915000
089160         FETCH RECDIS-HOLD-CSR                                    08916000
089170          INTO :RECDIS-STR-NBR                                    08917000
089180             , :PV-EXPTED-ITM-QTY                                 08918000
089190             , :PV-VERIFY-ITM-QTY                                 08919000
089200             , :PV-PLAN-ITM-QTY                                   08920000
089300     END-EXEC.                                                    08930000
089400                                                                  08940000
089500     EVALUATE TRUE                                                08950000
089600       WHEN SQLCODE = ZERO                                        08960000
089700           SET PS-RECDIS-HOLD-CSR-YES TO TRUE                     08970000
089800                                                                  08980000
089900       WHEN SQLCODE = +100                                        08990000
090000           SET PS-RECDIS-HOLD-CSR-EOF TO TRUE                     09000000
090100                                                                  09010000
090200       WHEN OTHER                                                 09020000
090300           MOVE 005 TO RC811-RETURN-CODE                          09030000
090400           MOVE 'F' TO RC811-SEVERITY-IND                         09040000
090500           PERFORM 9900-SOFT-ABORT                                09050000
090600     END-EVALUATE.                                                09060000
090700                                                                  09070000
090800******************************************************************09080000
090900 2300-PROCESS-RECDIS.                                             09090000
091000                                                                  09100000
091100*CALCULATE NEW RATIOS.                                            09110000
091200     COMPUTE PV-FACTOR = RC811-NEW-RC-RATIO                       09120000
091300                       / RC811-OLD-DISTRO-RATIO.                  09130000
091400     COMPUTE PV-NEW-EXPTED-COMPUTED-QTY ROUNDED =                 09140000
091500                         PV-EXPTED-ITM-QTY                        09150000
091600                       * PV-FACTOR.                               09160000
091700     COMPUTE PV-NEW-VERIFY-COMPUTED-QTY ROUNDED =                 09170000
091800                         PV-VERIFY-ITM-QTY                        09180000
091900                       * PV-FACTOR.                               09190000
092000                                                                  09200000
092100*MODIFY RECDIS                                                    09210000
092200     EXEC SQL                                                     09220000
092300         UPDATE TRECDIS                                           09230000
092400            SET EXPTED_ITM_QTY = :PV-NEW-EXPTED-COMPUTED-QTY      09240000
092500              , VERIFY_ITM_QTY = :PV-NEW-VERIFY-COMPUTED-QTY      09250000
092600          WHERE CURRENT OF RECDIS-HOLD-CSR                        09260000
092700     END-EXEC.                                                    09270000
092800                                                                  09280000
092900     EVALUATE TRUE                                                09290000
093000       WHEN SQLCODE = ZERO                                        09300000
093100           MOVE 001 TO RC811-RETURN-CODE                          09310000
093200           MOVE 'N' TO RC811-SEVERITY-IND                         09320000
093300                                                                  09330000
093400       WHEN OTHER                                                 09340000
093500           SET PS-RECDIS-HOLD-CSR-EOF TO TRUE                     09350000
093600           MOVE 005 TO RC811-RETURN-CODE                          09360000
093700           MOVE 'F' TO RC811-SEVERITY-IND                         09370000
093800           PERFORM 9900-SOFT-ABORT                                09380000
093900     END-EVALUATE.                                                09390000
094000                                                                  09400000
094100*GET NEXT RECDIS ROW                                              09410000
094200     IF PS-RECDIS-HOLD-CSR-YES                                    09420000
094300         PERFORM 2600-UPDATE-ODD-UNIT                             09430000
094400         PERFORM 2200-FETCH-RECDIS-HOLD-CSR                       09440000
094500     END-IF.                                                      09450000
094600                                                                  09460000
094700******************************************************************09470000
094800 2400-CLOSE-RECDIS-HOLD-CSR.                                      09480000
094900                                                                  09490000
095000     EXEC SQL                                                     09500000
095100         CLOSE RECDIS-HOLD-CSR                                    09510000
095200     END-EXEC.                                                    09520000
095300                                                                  09530000
095400     EVALUATE TRUE                                                09540000
095500       WHEN SQLCODE = ZERO                                        09550000
095600           CONTINUE                                               09560000
095700                                                                  09570000
095800       WHEN OTHER                                                 09580000
095900           MOVE 005 TO RC811-RETURN-CODE                          09590000
096000           MOVE 'F' TO RC811-SEVERITY-IND                         09600000
096100           PERFORM 9900-SOFT-ABORT                                09610000
096200     END-EVALUATE.                                                09620000
096300                                                                  09630000
096400 2600-UPDATE-ODD-UNIT.                                            09640000
096500                                                                  09650000
096600     EXEC SQL                                                     09660000
096700          UPDATE RCT_VRFD_ODD_UNT                                 09670000
096800            SET  DC_VRFY_ODU_QTY = :PV-NEW-EXPTED-COMPUTED-QTY    09680000
096900                ,AP_VRFY_ODU_QTY = :PV-NEW-VERIFY-COMPUTED-QTY    09690000
097000                                                                  09700000
097100            WHERE PO_NBR         = :RC811-PO-NBR                  09710000
097200              AND PO_LNE_NBR     = :RC811-MODIFY-LINE-NBR         09720000
097300              AND RCVR_SEQ_NBR   = :RC811-REC-SEQ-NBR             09730000
097400     END-EXEC.                                                    09740000
097500                                                                  09750000
097600     EVALUATE TRUE                                                09760000
097700         WHEN SQLCODE = ZERO                                      09770000
097800         WHEN SQLCODE = +100                                      09780000
097900              CONTINUE                                            09790000
098000                                                                  09800000
098100         WHEN SQLWARN0 NOT = SPACES                               09810000
098200         WHEN SQLCODE  NOT = ZERO                                 09820000
098300              MOVE 005 TO RC811-RETURN-CODE                       09830000
098400              MOVE 'F' TO RC811-SEVERITY-IND                      09840000
098500              PERFORM 9900-SOFT-ABORT                             09850000
098600                                                                  09860000
098700     END-EVALUATE.                                                09870000
098800                                                                  09880000
098900                                                                  09890000
099000******************************************************************09900000
099100*  THIS PARAGRAPH WILL DELETE ONE LINE                            09910000
099200*  FOR ALL STORE ALLOCATIONS IN RECDIS                            09920000
099300******************************************************************09930000
099400 3000-DELETE-LINE.                                                09940000
099500                                                                  09950000
099600*DELETE PASSED LINE NBR                                           09960000
099700     MOVE RC811-DELETE-LINE-NBR TO DK-LINE-NBR-LOW                09970000
099800                                   DK-LINE-NBR-HIGH.              09980000
099900     PERFORM 3100-DELETE-RECDIS.                                  09990000
100000     PERFORM 3200-DELETE-ODD-UNIT.                                10000000
100100                                                                  10010000
100200******************************************************************10020000
100300 3100-DELETE-RECDIS.                                              10030000
100400                                                                  10040000
100500     PERFORM WITH TEST AFTER                                      10050000
100600       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       10060000
100700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 10070000
100800          OR SQLCODE = 0 OR SQLCODE = +100)                       10080000
100900                                                                  10090000
101000         EXEC SQL                                                 10100000
101100             DELETE FROM TRECDIS                                  10110000
101200              WHERE ORD_NBR      = :RC811-PO-NBR                  10120000
101300                AND REC_SEQ_NBR  = :RC811-REC-SEQ-NBR             10130000
101400                AND OPER_UNT_ID  = :RC811-OPER-UNIT-ID            10140000
101500                AND FCLTY_ID     = :RC811-FACILITY-ID             10150000
101600                AND (ORD_LNE_NBR > :DK-LINE-NBR-LOW               10160000
101700                 OR  ORD_LNE_NBR = :DK-LINE-NBR-LOW)              10170000
101800                AND (ORD_LNE_NBR < :DK-LINE-NBR-HIGH              10180000
101900                 OR  ORD_LNE_NBR = :DK-LINE-NBR-HIGH)             10190000
102000         END-EXEC                                                 10200000
102100                                                                  10210000
102200         EVALUATE TRUE                                            10220000
102300           WHEN SQLCODE = 0                                       10230000
102400               MOVE 006 TO RC811-RETURN-CODE                      10240000
102500               MOVE 'N' TO RC811-SEVERITY-IND                     10250000
102600                                                                  10260000
102700           WHEN SQLCODE = +100                                    10270000
102800               MOVE 009 TO RC811-RETURN-CODE                      10280000
102900               MOVE 'W' TO RC811-SEVERITY-IND                     10290000
103000                                                                  10300000
103100           WHEN OTHER                                             10310000
103200               MOVE 010 TO RC811-RETURN-CODE                      10320000
103300               MOVE 'F' TO RC811-SEVERITY-IND                     10330000
103400               PERFORM 9900-SOFT-ABORT                            10340000
103500         END-EVALUATE                                             10350000
103600     END-PERFORM.                                                 10360000
103700                                                                  10370000
103800 3200-DELETE-ODD-UNIT.                                            10380000
103900                                                                  10390000
104000     EXEC SQL                                                     10400000
104100          DELETE                                                  10410000
104200            FROM RCT_VRFD_ODD_UNT                                 10420000
104300            WHERE PO_NBR       = :RC811-PO-NBR                    10430000
104400              AND RCVR_SEQ_NBR = :RC811-REC-SEQ-NBR               10440000
104500              AND (PO_LNE_NBR  > :DK-LINE-NBR-LOW                 10450000
104600               OR  PO_LNE_NBR  = :DK-LINE-NBR-LOW)                10460000
104700              AND (PO_LNE_NBR  < :DK-LINE-NBR-HIGH                10470000
104800               OR  PO_LNE_NBR  = :DK-LINE-NBR-HIGH)               10480000
104900     END-EXEC.                                                    10490000
105000                                                                  10500000
105100     EVALUATE TRUE                                                10510000
105200         WHEN SQLCODE = ZERO                                      10520000
105300         WHEN SQLCODE = +100                                      10530000
105400              CONTINUE                                            10540000
105500                                                                  10550000
105600         WHEN SQLWARN0 NOT = SPACES                               10560000
105700         WHEN SQLCODE  NOT = ZERO                                 10570000
105800              MOVE 010 TO RC811-RETURN-CODE                       10580000
105900              MOVE 'F' TO RC811-SEVERITY-IND                      10590000
106000              PERFORM 9900-SOFT-ABORT                             10600000
106100                                                                  10610000
106200     END-EVALUATE.                                                10620000
106300                                                                  10630000
106400                                                                  10640000
106500******************************************************************10650000
106600*  THIS PARAGRAPH WILL DELETE THE ENTIRE PACK                     10660000
106700*  FOR ALL STORE ALLOCATIONS IN RECDIS                            10670000
106800******************************************************************10680000
106900 4000-DELETE-PACK.                                                10690000
107000                                                                  10700000
107100     SET PS-MORE-RECITM-YES TO TRUE.                              10710000
107200                                                                  10720000
107300     PERFORM 4100-OPEN-SELECT-RECITM-CSR.                         10730000
107400                                                                  10740000
107500*PROCESS ALL RECITM/RECDIS WITH PREPK-ID.                         10750000
107600     PERFORM 4200-PROCESS-SELECT-RECITM                           10760000
107700       UNTIL PS-MORE-RECITM-NO.                                   10770000
107800                                                                  10780000
107900     PERFORM 4300-CLOSE-SELECT-RECITM-CSR.                        10790000
108000                                                                  10800000
108100******************************************************************10810000
108200 4100-OPEN-SELECT-RECITM-CSR.                                     10820000
108300                                                                  10830000
108400     EXEC SQL                                                     10840000
108500         OPEN SELECT-RECITM-CSR                                   10850000
108600     END-EXEC.                                                    10860000
108700                                                                  10870000
108800     EVALUATE TRUE                                                10880000
108900       WHEN SQLCODE = ZERO                                        10890000
109000           CONTINUE                                               10900000
109100                                                                  10910000
109200       WHEN OTHER                                                 10920000
109300           SET PS-MORE-RECITM-NO TO TRUE                          10930000
109400           MOVE 015 TO RC811-RETURN-CODE                          10940000
109500           MOVE 'F' TO RC811-SEVERITY-IND                         10950000
109600           PERFORM 9900-SOFT-ABORT                                10960000
109700                                                                  10970000
109800     END-EVALUATE.                                                10980000
109900                                                                  10990000
110000******************************************************************11000000
110100 4200-PROCESS-SELECT-RECITM.                                      11010000
110200                                                                  11020000
110300     PERFORM 4210-FETCH-SELECT-RECITM.                            11030000
110400                                                                  11040000
110500*DELETE PACK LINES                                                11050000
110600     IF PS-MORE-RECITM-YES                                        11060000
110700         MOVE RECITM-ORD-LNE-NBR TO DK-LINE-NBR-LOW               11070000
110800         PERFORM 4220-DELETE-RECDIS                               11080000
110900         PERFORM 4230-DELETE-ODD-UNIT                             11090000
111000     END-IF.                                                      11100000
111100                                                                  11110000
111200******************************************************************11120000
111300 4210-FETCH-SELECT-RECITM.                                        11130000
111900                                                                  11190000
112000     EXEC SQL                                                     11200000
112100         FETCH  SELECT-RECITM-CSR                                 11210000
112200          INTO :RECITM-ORD-LNE-NBR                                11220000
112300     END-EXEC.                                                    11230000
112400                                                                  11240000
112500     EVALUATE TRUE                                                11250000
112600       WHEN SQLCODE = ZERO                                        11260000
112700           CONTINUE                                               11270000
112800                                                                  11280000
112900       WHEN SQLCODE = +100                                        11290000
113000           SET PS-MORE-RECITM-NO TO TRUE                          11300000
113100                                                                  11310000
113200       WHEN OTHER                                                 11320000
113300           SET PS-MORE-RECITM-NO TO TRUE                          11330000
113400           MOVE 015 TO RC811-RETURN-CODE                          11340000
113500           MOVE 'F' TO RC811-SEVERITY-IND                         11350000
113600           PERFORM 9900-SOFT-ABORT                                11360000
113700                                                                  11370000
113800     END-EVALUATE.                                                11380000
113900                                                                  11390000
114000******************************************************************11400000
114100 4220-DELETE-RECDIS.                                              11410000
114200                                                                  11420000
114300     PERFORM WITH TEST AFTER                                      11430000
114400       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       11440000
114500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 11450000
114600          OR SQLCODE = 0 OR SQLCODE = +100)                       11460000
114700                                                                  11470000
114800         EXEC SQL                                                 11480000
114900             DELETE FROM TRECDIS                                  11490000
115000              WHERE ORD_NBR      = :RC811-PO-NBR                  11500000
115100                AND REC_SEQ_NBR  = :RC811-REC-SEQ-NBR             11510000
115200                AND OPER_UNT_ID  = :RC811-OPER-UNIT-ID            11520000
115300                AND FCLTY_ID     = :RC811-FACILITY-ID             11530000
115400                AND ORD_LNE_NBR  = :DK-LINE-NBR-LOW               11540000
115500         END-EXEC                                                 11550000
115600                                                                  11560000
115700         EVALUATE TRUE                                            11570000
115800           WHEN SQLCODE = 0                                       11580000
115900               MOVE 016 TO RC811-RETURN-CODE                      11590000
116000               MOVE 'N' TO RC811-SEVERITY-IND                     11600000
116100                                                                  11610000
116200           WHEN SQLCODE = +100                                    11620000
116300               MOVE 013 TO RC811-RETURN-CODE                      11630000
116400               MOVE 'W' TO RC811-SEVERITY-IND                     11640000
116500                                                                  11650000
116600           WHEN OTHER                                             11660000
116700               SET PS-MORE-RECITM-NO TO TRUE                      11670000
116800               MOVE 015 TO RC811-RETURN-CODE                      11680000
116900               MOVE 'F' TO RC811-SEVERITY-IND                     11690000
117000               PERFORM 9900-SOFT-ABORT                            11700000
117100         END-EVALUATE                                             11710000
117200     END-PERFORM.                                                 11720000
117300                                                                  11730000
117400******************************************************************11740000
117500 4230-DELETE-ODD-UNIT.                                            11750000
117600                                                                  11760000
117700     EXEC SQL                                                     11770000
117800          DELETE                                                  11780000
117900            FROM RCT_VRFD_ODD_UNT                                 11790000
118000            WHERE PO_NBR       = :RC811-PO-NBR                    11800000
118100              AND RCVR_SEQ_NBR = :RC811-REC-SEQ-NBR               11810000
118200              AND PO_LNE_NBR   = :DK-LINE-NBR-LOW                 11820000
118300     END-EXEC.                                                    11830000
118400                                                                  11840000
118500     EVALUATE TRUE                                                11850000
118600         WHEN SQLCODE = ZERO                                      11860000
118700         WHEN SQLCODE = +100                                      11870000
118800              CONTINUE                                            11880000
118900                                                                  11890000
119000         WHEN SQLWARN0 NOT = SPACES                               11900000
119100         WHEN SQLCODE  NOT = ZERO                                 11910000
119200              MOVE 010 TO RC811-RETURN-CODE                       11920000
119300              MOVE 'F' TO RC811-SEVERITY-IND                      11930000
119400              PERFORM 9900-SOFT-ABORT                             11940000
119500                                                                  11950000
119600     END-EVALUATE.                                                11960000
119700                                                                  11970000
119800                                                                  11980000
119900******************************************************************11990000
120000 4300-CLOSE-SELECT-RECITM-CSR.                                    12000000
120100                                                                  12010000
120200     EXEC SQL                                                     12020000
120300         CLOSE SELECT-RECITM-CSR                                  12030000
120400     END-EXEC.                                                    12040000
120500                                                                  12050000
120600     EVALUATE TRUE                                                12060000
120700       WHEN SQLCODE = ZERO                                        12070000
120800           CONTINUE                                               12080000
120900                                                                  12090000
121000       WHEN OTHER                                                 12100000
121100           MOVE 015 TO RC811-RETURN-CODE                          12110000
121200           MOVE 'F' TO RC811-SEVERITY-IND                         12120000
121300           PERFORM 9900-SOFT-ABORT                                12130000
121400                                                                  12140000
121500     END-EVALUATE.                                                12150000
121600                                                                  12160000
121700******************************************************************12170000
121800*  THIS PARAGRAPH CHECKS FOR VERIFIED LINES IN A PACK             12180000
121900******************************************************************12190000
122000 5000-COUNT-RECITM.                                               12200000
122100                                                                  12210000
122200     MOVE ZEROES TO PV-DB2-COUNT.                                 12220000
122300                                                                  12230000
122400     EXEC SQL                                                     12240000
122500         SELECT COUNT(*)                                          12250000
122600           INTO :PV-DB2-COUNT                                     12260000
122700           FROM TRECITM                                           12270000
122800          WHERE ORD_NBR         = :RC811-PO-NBR                   12280000
122900            AND REC_SEQ_NBR     = :RC811-REC-SEQ-NBR              12290000
123000            AND OPER_UNT_ID     = :RC811-OPER-UNIT-ID             12300000
123100            AND FCLTY_ID        = :RC811-FACILITY-ID              12310000
123200            AND PREPK_ID        = :RC811-PREPK-ID                 12320000
123300            AND STATUS_CDE     IN ('VE')                          12330000
123400            AND VER_STATUS_CDE  = :PC-A                           12340000
123500     END-EXEC.                                                    12350000
123600                                                                  12360000
123700     EVALUATE TRUE                                                12370000
123800       WHEN SQLCODE = +0                                          12380000
123900       WHEN SQLCODE = +100                                        12390000
124000           CONTINUE                                               12400000
124100                                                                  12410000
124200*      WHEN SQLCODE = -904                                        12420000
124300*      WHEN SQLCODE = -911                                        12430000
124400*      WHEN SQLCODE = -913                                        12440000
124500       WHEN OTHER                                                 12450000
124600           SET PS-DONE TO TRUE                                    12460000
124700           MOVE 025 TO RC811-RETURN-CODE                          12470000
124800           MOVE 'F' TO RC811-SEVERITY-IND                         12480000
124900           PERFORM 9900-SOFT-ABORT                                12490000
125000                                                                  12500000
125100*      WHEN OTHER                                                 12510000
125200*          MOVE '5000-COUNT-RECITM' TO DP013-PARAGRAPH            12520000
125300*          MOVE 'UNSUCCESSFUL COUNT OF CASEPACK'                  12530000
125400*                                   TO DP013-MESSAGE-TEXT (1)     12540000
125500*          MOVE SQLCA               TO DP013-SQLCA                12550000
125600*          MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)   12560000
125700*          SET DP013-DB2-ABEND                                    12570000
125800*              DP013-XCTL-DISPLAY-RESTART                         12580000
125900*                                   TO TRUE                       12590000
126000*          PERFORM DP013-0000-PROCESS-ABEND                       12600000
126100     END-EVALUATE.                                                12610000
126200                                                                  12620000
126300******************************************************************12630000
126400 5100-COUNT-DISTHD.                                               12640000
126500                                                                  12650000
126600     MOVE ZEROES TO PV-DB2-COUNT.                                 12660000
126700                                                                  12670000
126800*    EXEC SQL                                                     12680000
126900*        SELECT COUNT(*)                                          12690000
127000*          INTO :PV-DB2-COUNT                                     12700000
127100*          FROM TPKSLIP A,                                        12710000
127200*               TPKITEM B,                                        12720000
127300*               TDISTHD C                                         12730000
127400*         WHERE  A.PO_NBR         =  :RC811-PO-NBR                12740000
127500*           AND  A.REC_SEQ_NBR    =  :RC811-REC-SEQ-NBR           12750000
127600*           AND  A.VER_STAT_CDE   =  :PC-ACTIVE                   12760000
127700*           AND  A.PO_NBR         =  B.PO_NBR                     12770000
127800*           AND  A.SEQ_NBR        =  B.SEQ_NBR                    12780000
127900*           AND  A.PO_NBR         =  C.ORD_NBR                    12790000
128000*           AND  A.REC_SEQ_NBR    =  C.RCVR_SEQ_NBR               12800000
128100*           AND  B.PKSL_LNE_NBR   =  C.ORD_LNE_NBR                12810000
128200*           AND  C.TOT_CART_CNT   >  0                            12820000
128300*    END-EXEC.                                                    12830000
128400                                                                  12840000
128500     EXEC SQL                                                     12850000
128600         SELECT COUNT(*)                                          12860000
128700           INTO :PV-DB2-COUNT                                     12870000
128800           FROM TRECITM A,                                        12880000
128900                TDISTHD B                                         12890000
129000          WHERE  A.ORD_NBR        = :RC811-PO-NBR                 12900000
129100            AND  A.REC_SEQ_NBR    = :RC811-REC-SEQ-NBR            12910000
129200            AND  A.PREPK_ID       = :RC811-PREPK-ID               12920000
129300                                                                  12930000
129400            AND  B.ORD_NBR        =  A.ORD_NBR                    12940000
129500            AND  B.RCVR_SEQ_NBR   =  A.REC_SEQ_NBR                12950000
129600            AND  B.ORD_LNE_NBR    =  A.ORD_LNE_NBR                12960000
129700            AND  CRE_USR_ID NOT IN ('TRLRUNLD','HOTCMPLT')        12970000
129800            AND  B.TOT_CART_CNT   >  0                            12980000
129900     END-EXEC.                                                    12990000
130000                                                                  13000000
130100     EVALUATE TRUE                                                13010000
130200       WHEN SQLCODE = ZERO                                        13020000
130300       WHEN SQLCODE = +100                                        13030000
130400           CONTINUE                                               13040000
130500                                                                  13050000
130600*      WHEN SQLCODE = -904                                        13060000
130700*      WHEN SQLCODE = -911                                        13070000
130800*      WHEN SQLCODE = -913                                        13080000
130900       WHEN OTHER                                                 13090000
131000           SET PS-DONE TO TRUE                                    13100000
131100           MOVE 027 TO RC811-RETURN-CODE                          13110000
131200           MOVE 'F' TO RC811-SEVERITY-IND                         13120000
131300           PERFORM 9900-SOFT-ABORT                                13130000
131400                                                                  13140000
131500*      WHEN OTHER                                                 13150000
131600*          MOVE '5100-COUNT-DISTHD' TO DP013-PARAGRAPH            13160000
131700*          MOVE 'UNSUCCESSFUL COUNT OF CASEPACK'                  13170000
131800*                                   TO DP013-MESSAGE-TEXT (1)     13180000
131900*          MOVE SQLCA               TO DP013-SQLCA                13190000
132000*          MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)   13200000
132100*          SET DP013-DB2-ABEND                                    13210000
132200*              DP013-XCTL-DISPLAY-RESTART                         13220000
132300*                                   TO TRUE                       13230000
132400*          PERFORM DP013-0000-PROCESS-ABEND                       13240000
132500         END-EVALUATE.                                            13250000
132600                                                                  13260000
132700******************************************************************13270000
132800* COPY DP017-0000-GET-CURR-DATE-TIME                             *13280000
132900******************************************************************13290000
133000     COPY DPPD017.                                                13300000
133100                                                                  13310000
133200******************************************************************13320000
133300*                                                                *13330000
133400*                  A B E N D   R O U T I N E S                   *13340000
133500*                                                                *13350000
133600******************************************************************13360000
133700 9900-SOFT-ABORT.                                                 13370000
133800                                                                  13380000
133900     SET RC811-FATAL-ERROR TO TRUE.                               13390000
134000                                                                  13400000
134100     PERFORM 9950-FORMAT-ERROR-MSG.                               13410000
134200                                                                  13420000
134300     SET DP013-LINK-RETURN                                        13430000
134400         DP013-NO-ROLLBACK TO TRUE.                               13440000
134500                                                                  13450000
134600     PERFORM DP013-0000-PROCESS-ABEND.                            13460000
134700                                                                  13470000
134800******************************************************************13480000
134900 9950-FORMAT-ERROR-MSG.                                           13490000
135000                                                                  13500000
135100     MOVE SQLCODE                TO PV-SQLCODE                    13510000
135200                                    PV-DISPLAY-SQLCODE.           13520000
135300                                                                  13530000
135400     MOVE RC811-PO-NBR           TO PV-DISP-PO-NBR.               13540000
135500     MOVE RC811-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR.          13550000
135600     MOVE RC811-OPER-UNIT-ID     TO PV-DISP-OPER-UNT-ID.          13560000
135700     MOVE RC811-FACILITY-ID      TO PV-DISP-FCLTY-ID.             13570000
135800     MOVE RC811-PREPK-ID         TO PV-DISP-PREPK-ID.             13580000
135900                                                                  13590000
136000     MOVE RC811-CLONE-LINE-NBR   TO PV-DISP-CLN-LINE.             13600000
136100     MOVE RC811-MODIFY-LINE-NBR  TO PV-DISP-MOD-LINE.             13610000
136200     MOVE RC811-DELETE-LINE-NBR  TO PV-DISP-DLT-LINE.             13620000
136300                                                                  13630000
136400     STRING '** RCKCS811 ** ERROR; ' PV-RETURN-MSG                13640000
136500         DELIMITED BY SIZE                                        13650000
136600         INTO DP013-MESSAGE-TEXT (1).                             13660000
136700                                                                  13670000
136800     STRING  ' RC811-RC = ' RC811-RETURN-CODE                     13680000
136900                            '; SQLCODE = ' PV-DISPLAY-SQLCODE     13690000
137000         DELIMITED BY SIZE                                        13700000
137100         INTO DP013-MESSAGE-TEXT (2).                             13710000
137200                                                                  13720000
137300     MOVE '  PO    REC  OPER FCLTY PPK   CLONE MDFY DLET'         13730000
137400         TO DP013-MESSAGE-TEXT (3).                               13740000
137500                                                                  13750000
137600     STRING PV-DISP-PO-NBR '-' PV-DISP-REC-SEQ-NBR '-'            13760000
137700            PV-DISP-OPER-UNT-ID '-' PV-DISP-FCLTY-ID '-'          13770000
137800            PV-DISP-PREPK-ID '*** ' PV-DISP-CLN-LINE '-'          13780000
137900            PV-DISP-MOD-LINE '-' PV-DISP-DLT-LINE                 13790000
138000         DELIMITED BY SIZE                                        13800000
138100         INTO DP013-MESSAGE-TEXT (4).                             13810000
138200                                                                  13820000
138300******************************************************************13830000
138400*    ABEND PROCESSOR MODULE                                      *13840000
138500******************************************************************13850000
138600                                                                  13860000
138700     COPY DPPD013.                                                13870000
