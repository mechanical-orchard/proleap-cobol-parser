      *-----------------------*                                         00010000
       IDENTIFICATION DIVISION.                                         00020000
      *-----------------------*                                         00030000
       PROGRAM-ID.    TFKCS437.                                         00040000
       AUTHOR.        JACK KRAMER.                                      00050000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
       DATE-WRITTEN.  NOVEMBER 1996.                                    00070000
       DATE-COMPILED.                                                   00080000
                                                                        00090000
      *---------------------------------------------------------------* 00100000
      *    P437 - TRANSFER LINE REVERSAL.                             * 00110000
      *                                                               * 00120000
      *    THIS PROGRAM ALLOWS THE USER TO MANUALLY CREATE BOOKING    * 00130000
      *    ADJUSTMENTS FOR THE SELECTED LINE.                         * 00140000
      *                                                               * 00150000
      *---------------------------------------------------------------* 00160000
080204**DATE:08/02/2004 CHANGED BY: RAY GRAF                            00161000
080204**     REMOVE TINVPAR ACCESS TO STORE_NBR.  USE LOC_NBR           00162000
      ***************************************************************** 00163000
100404**DATE:10/04/2004 CHANGED BY: RAY GRAF                            00164000
100404*      EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00165000
      ***************************************************************** 00166000
051705*  DATE 05/17/05 RAY GRAF                                         00167000
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00168000
051705******************************************************************00169000
SR3403*  DATE 02/24/12 TEJA KARWEER                                     00169100
SR3403*  AMOUNT FIELD EXPANSION FROM 4 TO 5 DIGITS                      00169200
SR3403******************************************************************00169300
      * DATE:        09/24/2021                                         00169401
      * WR/IR#:      CHG0261678                                         00169503
      * PROGRAMMER:  GERMAN BANDA                                       00169601
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00169701
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00169801
      *              MAKING THE CALL DYNAMIC VS STATIC                  00169901
      *----------------------------------------------------------------*00170001
CICS  * CHANGED 11/17/2022    BY JIM HUNTER      WR: CHG0278345         00170105
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00170205
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00170305
CICS  *-----------------------------------------------------------------00170405
       EJECT                                                            00170500
       ENVIRONMENT DIVISION.                                            00170600
                                                                        00170700
       DATA DIVISION.                                                   00170800
                                                                        00170900
       WORKING-STORAGE SECTION.                                         00171000
                                                                        00172000
       01  DK-DB2-KEYS.                                                 00180000
           05  DK-STORE-NBR                   PIC S9(04)  COMP.         00190000
080204     05  DK-STORE-NBR-9                 PIC S9(04)  VALUE ZEROS   00200000
                                                          COMP.         00210000
           05  DK-XFER-DKEY-ID                PIC S9(09)  COMP.         00220000
           05  DK-XFER-LNE-NBR                PIC S9(04)  COMP.         00230000
           05  DK-PSTG-SEQ-NBR                PIC S9(04)  COMP.         00240000
                                                                        00250000
       01  PC-PROGRAM-CONSTANTS.                                        00260000
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00270000
                                                          'TF437A  '.   00280000
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00290000
                                                          'TFKM437 '.   00300000
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00310000
                                                          'TFKCS437'.   00320000
           05  PC-SEL-QUEUE-OUT-SEQ           PIC  9(01)  VALUE 4.      00330000
           05  PC-HAND-CARRY                  PIC  X(02)  VALUE '05'.   00340000
           05  PC-MANUAL-REVERSAL             PIC  X(02)  VALUE 'MR'.   00350000
           05  PC-AUTO-REVERSAL               PIC  X(02)  VALUE 'AR'.   00360000
           05  PC-ADJUSTMENT                  PIC  X(02)  VALUE 'AD'.   00370000
           05  PC-PRICE-ONLY                  PIC  X(02)  VALUE 'ML'.   00380000
           05  PC-PRICE-AND-UNIT              PIC  X(02)  VALUE 'FS'.   00390000
           05  PC-PRICE-ONLY-LITERAL          PIC  X(11)  VALUE         00400000
               '-PRICE ONLY'.                                           00410000
           05  PC-UNIT-AND-PRICE-LITERAL      PIC  X(13)  VALUE         00420000
               '-UNIT & PRICE'.                                         00430000
           05  PC-POSITIVE-RECEIPT            PIC  X(02)  VALUE 'PR'.   00440000
           05  PC-ABSTIME                     PIC S9(18)   VALUE ZERO   00450000
                                              COMP SYNC.                00460000
           05  PC-SYSTEM-DATE                 PIC  X(06).               00470000
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     00480000
                                                          COMP SYNC.    00490000
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00500000
                                                           COMP-3.      00510000
           05  PC-YES                         PIC  X(01)  VALUE 'Y'.    00520000
051705*    05  PC-MAX-DATE                 PIC X(10) VALUE '9999-09-09'.00530000
051705*    05  PC-MIN-DATE                 PIC X(10) VALUE '0001-01-01'.00540000
                                                                        00550000
       01  PC-TSYMSG-NUMBERS.                                           00560000
           05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  00570000
           05  PC-TSYMSG-00007                PIC 9(5)    VALUE 00007.  00580000
           05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00590000
           05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  00600000
           05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00610000
           05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  00620000
           05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00630000
           05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00640000
           05  PC-TSYMSG-00098                PIC 9(5)    VALUE 00098.  00650000
           05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00660000
           05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00670000
           05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00680000
           05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  00690000
           05  PC-TSYMSG-00342                PIC 9(5)    VALUE 00342.  00700000
           05  PC-TSYMSG-00973                PIC 9(5)    VALUE 00973.  00710000
           05  PC-TSYMSG-01403                PIC 9(5)    VALUE 01403.  00720000
           05  PC-TSYMSG-01475                PIC 9(5)    VALUE 01475.  00730000
           05  PC-TSYMSG-01476                PIC 9(5)    VALUE 01476.  00740000
           05  PC-TSYMSG-01477                PIC 9(5)    VALUE 01477.  00750000
           05  PC-TSYMSG-01615                PIC 9(5)    VALUE 01615.  00760000
           05  PC-TSYMSG-01659                PIC 9(5)    VALUE 01659.  00770000
                                                                        00780000
       01  PS-PROGRAM-SWITCHES.                                         00790000
           05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00800000
               88  PS-NO-ERROR                             VALUE 'Y'.   00810000
               88  PS-ERROR                                VALUE 'N'.   00820000
           05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00830000
               88  PS-LIST-END                             VALUE 'Y'.   00840000
               88  PS-NO-LIST-END                          VALUE 'N'.   00850000
           05  PS-INPUT-DATA-SW               PIC X(01)    VALUE 'N'.   00860000
               88  PS-INPUT-DATA                           VALUE 'Y'.   00870000
               88  PS-NO-INPUT-DATA                        VALUE 'N'.   00880000
           05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00890000
               88  PS-COMMAREA-VALID                       VALUE 'Y'.   00900000
               88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00910000
           05  PS-TRANSFER-FOUND-SW     PIC X.                          00920000
               88  PS-TRANSFER-FOUND             VALUE 'Y'.             00930000
               88  PS-TRANSFER-NOT-FOUND         VALUE 'N'.             00940000
           05  PS-TRANSFER-POST-FOUND-SW PIC X.                         00950000
               88  PS-TRANSFER-POST-FOUND        VALUE 'Y'.             00960000
               88  PS-TRANSFER-POST-NOT-FOUND    VALUE 'N'.             00970000
051705*    05  PS-INVENTORY-ERROR-SW     PIC X.                         00980000
051705*        88  PS-INVENTORY-ERROR            VALUE 'Y'.             00990000
051705*        88  PS-NO-INVENTORY-ERROR         VALUE 'N'.             01000000
           EJECT                                                        01010000
       01  PV-PROGRAM-VARIABLES.                                        01020000
           05  PV-SUB                         PIC S9(04)  VALUE +0      01030000
                                                          COMP SYNC.    01040000
           05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01050000
                                                           COMP SYNC.   01060000
           05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01070000
                                                           COMP-3.      01080000
           05  PV-ITEM                        PIC S9(04)  VALUE +0      01090000
                                                          COMP SYNC.    01100000
           05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01110000
                                                          COMP SYNC.    01120000
           05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01130000
                                                           COMP SYNC.   01140000
           05  PV-RETRY-COUNT                 PIC S9(4)    COMP.        01150000
           05  PV-XFER-NBR.                                             01160000
100404*        10  PV-XFER-FROM-STORE         PIC X(03).                01170000
100404         10  PV-XFER-FROM-STORE         PIC X(04).                01180000
               10                             PIC X   VALUE '-'.        01190000
               10  PV-XFER-SEQ-NBR            PIC X(06).                01200000
           05  PV-DATE.                                                 01210000
               10  PV-YEAR                    PIC X(04).                01220000
               10                             PIC X(01)  VALUE '/'.     01230000
               10  PV-MONTH                   PIC X(02).                01240000
               10                             PIC X(01)  VALUE '/'.     01250000
               10  PV-DAY                     PIC X(02).                01260000
           05  PV-QUANTITY                    PIC ZZZ.                  01270000
           05  PV-EDIT-PRICE                  PIC S9(08)V9(2)           01280000
                                                    VALUE ZEROS         01290000
                                                    COMP-3.             01300000
           05  PV-EDIT-PRICE-4-DEC REDEFINES PV-EDIT-PRICE              01310000
                                              PIC S9(06)V9(4)           01320000
                                                    COMP-3.             01330000
           05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  01340000
                                                           COMP SYNC.   01350000
           05  PV-EXT                         PIC 9(07)V99.             01360000
           05  PV-DKEY-IND                    PIC S9(04) COMP VALUE +0. 01370000
           05  PV-LINE-IND                    PIC S9(04) COMP VALUE +0. 01380000
           05  PV-PSTG-IND                    PIC S9(04) COMP VALUE +0. 01390000
           05  PV-PSTG-MAX-IND                PIC S9(04) COMP VALUE +0. 01400000
051705*    05  PV-MAX-FINCL-BK-DTE            PIC  X(10)  VALUE SPACE.  01410000
051705*    05  PV-FR-STR-INV-DTE              PIC  X(10)  VALUE SPACE.  01420000
051705*    05  PV-TO-STR-INV-DTE              PIC  X(10)  VALUE SPACE.  01430000
051705*    05  PV-XFER-INV-CTOFF-DTE          PIC  X(10)  VALUE SPACE.  01440000
051705*    05  PV-LY-INV-CTOFF-DTE            PIC  X(10)  VALUE SPACE.  01450000
051705*    05  PV-MAX-PLND-INV-DTE            PIC  X(10)  VALUE SPACE.  01460000
051705*    05  PV-PHY-INV-PERD-IND            PIC  X(10)  VALUE SPACE.  01470000
051705*    05  PV-CMPLT-DATE                  PIC X(10).                01480000
051705*    05  PV-COMPARE-DATE                PIC X(10).                01490000
051705*    05  PV-HOLD-INVENTORY-IND           PIC X(01)   VALUE 'N'.   01500000
051705*        88  PV-HOLD-PHYSICAL-COUNT                  VALUE 'Y'.   01510000
051705*        88  PV-HOLD-FAKE-INVENTORY                  VALUE 'F'.   01520000
051705*        88  PV-HOLD-NO-INVENTORY                    VALUE 'N'.   01530000
051705*    05  PV-FR-INVENTORY-IND             PIC X(01)   VALUE 'N'.   01540000
051705*        88  PV-FR-PHYSICAL-COUNT                    VALUE 'Y'.   01550000
051705*        88  PV-FR-FAKE-INVENTORY                    VALUE 'F'.   01560000
051705*        88  PV-FR-NO-INVENTORY                      VALUE 'N'.   01570000
051705*    05  PV-TO-INVENTORY-IND             PIC X(01)   VALUE 'N'.   01580000
051705*        88  PV-TO-PHYSICAL-COUNT                    VALUE 'Y'.   01590000
051705*        88  PV-TO-FAKE-INVENTORY                    VALUE 'F'.   01600000
051705*        88  PV-TO-NO-INVENTORY                      VALUE 'N'.   01610000
           05  PV-CURRENT-DATE-ISO.                                     01620000
               10  PV-ISO-YEAR                PIC X(04).                01630000
               10                             PIC X(01).                01640000
               10  PV-ISO-MONTH               PIC X(02).                01650000
               10                             PIC X(01).                01660000
               10  PV-ISO-DAY                 PIC X(02).                01670000
           05  PV-CURRENT-DATE REDEFINES                                01680000
               PV-CURRENT-DATE-ISO            PIC X(10).                01690000
       EJECT                                                            01700000
      *---------------------------------------------------------------* 01710000
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01720005
      *---------------------------------------------------------------* 01730000
                                                                        01740000
           COPY DPWS030.                                                01750000
CICS       COPY DPWS930.                                                01751005
       EJECT                                                            01760000
      *----------------------------------------------------------------*01770000
      *  DATE VALIDATION CALLING PARAMETER LIST                        *01780000
      *----------------------------------------------------------------*01790000
           COPY DPWS500.                                                01800000
       EJECT                                                            01810000
      *---------------------------------------------------------------* 01820000
      *    STANDARD COMMAREA.                                         * 01830000
      *---------------------------------------------------------------* 01840000
                                                                        01850000
           COPY DPWS020.                                                01860000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01870000
                                                                        01880000
      *---------------------------------------------------------------* 01890000
      *    INTER-APPLICATION COMMAREA.                                * 01900000
      *---------------------------------------------------------------* 01910000
                                                                        01920000
               10  INTER-APPL-COMM-AREA       PIC X(200).               01930000
           COPY TFWS003.                                                01940000
      *---------------------------------------------------------------* 01950000
      *    SPECIFIC COMMMAREA FOR DPKCS040.                           * 01960000
      *---------------------------------------------------------------* 01970000
               10  ASC-SPECIFIC-COMMAREA.                               01980000
                   15  ASC-LIST-KEYS.                                   01990000
                       20  ASC-KEY-XFER-DKEY-ID            PIC S9(09)   02000000
                                                           COMP.        02010000
                       20  ASC-KEY-XFER-LNE-NBR            PIC S9(04)   02020000
                                                           COMP.        02030000
                       20  ASC-KEY-PSTG-SEQ-NBR            PIC S9(04)   02040000
                                                           COMP.        02050000
                   15  ASC-MAX-POSTING-SEQ-NBR             PIC S9(04)   02060000
                                                           COMP.        02070000
                   15  ASC-XFER-SEQ-NBR                    PIC 9(06).   02080000
                   15  ASC-CONTNR-TYP-CDE                  PIC X(02).   02090000
                   15  ASC-DATE.                                        02100000
                       20  ASC-DTE-MONTH                   PIC X(02).   02110000
                       20  ASC-DTE-SLASH-1                 PIC X(01).   02120000
                       20  ASC-DTE-DAY                     PIC X(02).   02130000
                       20  ASC-DTE-SLASH-2                 PIC X(01).   02140000
                       20  ASC-DTE-YEAR                    PIC X(04).   02150000
100404*            15  ASC-FROM-STORE-NBR                  PIC 9(03).   02160000
100404             15  ASC-FROM-STORE-NBR                  PIC 9(04).   02170000
                   15  ASC-FROM-STORE-NAM                  PIC X(10).   02180000
100404*            15  ASC-TO-STORE-NBR                    PIC 9(03).   02190000
100404             15  ASC-TO-STORE-NBR                    PIC 9(04).   02200000
                   15  ASC-TO-STORE-NAM                    PIC X(10).   02210000
100404*            15  ASC-RECV-STORE-NBR                  PIC 9(03).   02220000
100404             15  ASC-RECV-STORE-NBR                  PIC 9(04).   02230000
                   15  ASC-RECV-STORE-NAM                  PIC X(10).   02240000
100404*            15  ASC-HDR-TO-NBR                      PIC 9(03).   02250000
100404             15  ASC-HDR-TO-NBR                      PIC 9(04).   02260000
                   15  ASC-HDR-TO-NAM                      PIC X(05).   02270000
100404*            15  ASC-HDR-FR-NBR                      PIC 9(03).   02280000
100404             15  ASC-HDR-FR-NBR                      PIC 9(04).   02290000
                   15  ASC-HDR-FR-NAM                      PIC X(05).   02300000
                   15  ASC-HDR-QTY                         PIC S9(05)   02310000
                                                           COMP-3.      02320000
                   15  ASC-HDR-PRC                         PIC S9(05)V9902330000
                                                           COMP-3.      02340000
                   15  ASC-HDR-EXT                         PIC S9(07)V9902350000
                                                           COMP-3.      02360000
100404*            15  ASC-REASON                          PIC X(23).   02370000
SR3403             15  ASC-REASON                          PIC X(18).   02371000
                   15  ASC-REASON-CODE                     PIC X(02).   02372000
                   15  ASC-PRICE-CODE                      PIC X(02).   02373000
                   15  ASC-CURRENT-DATE.                                02374000
                       20  ASC-CURRENT-MONTH               PIC X(02).   02375000
                       20  ASC-CURRENT-DATE-SLASH-1        PIC X(01).   02376000
                       20  ASC-CURRENT-DAY                 PIC X(02).   02377000
                       20  ASC-CURRENT-DATE-SLASH-2        PIC X(01).   02378000
                       20  ASC-CURRENT-YEAR                PIC X(04).   02379000
                   15  ASC-ITEM-ARRAY.                                  02380000
                       20  ASC-ITEM-ENTRIES OCCURS 8 TIMES.             02390000
100404*                    25  ASC-DTL-FR-NBR              PIC X(03).   02400000
100404                     25  ASC-DTL-FR-NBR              PIC X(04).   02410000
                           25  ASC-DTL-FR-NBR-9                         02420000
100404*                        REDEFINES ASC-DTL-FR-NBR    PIC 9(03).   02430000
100404                         REDEFINES ASC-DTL-FR-NBR    PIC 9(04).   02440000
100404*                    25  ASC-DTL-TO-NBR              PIC X(03).   02450000
100404                     25  ASC-DTL-TO-NBR              PIC X(04).   02460000
                           25  ASC-DTL-TO-NBR-9                         02470000
100404*                        REDEFINES ASC-DTL-TO-NBR    PIC 9(03).   02480000
100404                         REDEFINES ASC-DTL-TO-NBR    PIC 9(04).   02490000
                           25  ASC-DTL-QTY                 PIC X(03).   02500000
                           25  ASC-DTL-QTY-9 REDEFINES ASC-DTL-QTY      02510000
                                                           PIC 9(03).   02520000
                           25  ASC-DTL-PRC                 PIC X(07).   02530000
                           25  ASC-DTL-PRC-9 REDEFINES ASC-DTL-PRC      02540000
                                                           PIC 9(05)V99.02550000
                           25  ASC-DTL-EXT                 PIC X(09).   02560000
                           25  ASC-DTL-EXT-9 REDEFINES ASC-DTL-EXT      02570000
                                                           PIC 9(07)V99.02580000
      *>                   25  ASC-DOLLAR                  PIC  X(01).  02590000
      *>                       88  ASC-DOLLARS-ONLY        VALUE 'X'.   02600000
                                                                        02610000
                   15  ASC-INSERTED-ENTRY  OCCURS 8 TIMES.              02620000
                       20  ASC-INSERTED-PSTG-SEQ-NBR       PIC S9(04)   02630000
                                                           COMP.        02640000
                   15  ASC-SEL-QUEUE-IN-NAME.                           02650000
                       20  ASC-SEL-IN-TERM-ID              PIC  X(04).  02660000
                       20  ASC-SEL-IN-TASK-NUMBER          PIC S9(05)   02670000
                                                                COMP-3. 02680000
                       20  ASC-SEL-IN-SEQ                  PIC  9(01).  02690000
                   15  ASC-ITEM-SUB                        PIC S9(04)   02700000
                                                               COMP     02710000
                                                               SYNC.    02720000
                   15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02730000
                       88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02740000
                   15  ASC-UPDATE-SW                       PIC  X(01).  02750000
                       88  ASC-NO-UPDATE-REQUEST             VALUE 'N'. 02760000
                       88  ASC-UPDATE-REQUEST                VALUE 'R'. 02770000
                       88  ASC-UPDATE-DONE                   VALUE 'D'. 02780000
                   15  ASC-SEL-SUB                         PIC S9(04)   02790000
                                                               COMP.    02800000
                   15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02810000
                                                               COMP-3.  02820000
                   15  ASC-SEL-ITEM                        PIC S9(04)   02830000
                                                               COMP.    02840000
           EJECT                                                        02850000
      *---------------------------------------------------------------* 02860000
      *  RECORD LAYOUT FOR THE TRANSFER SELECTION TEMP STORAGE QUEUE. * 02870000
      *---------------------------------------------------------------* 02880000
      *   TFWS004 - IS THE INPUT TEMP STORAGE LAYOUT WHEN COMING FROM * 02890000
      *             THE TRANSFER DISCREPANCY PROGRAM AND THE OUTPUT   * 02900000
      *             TEMP STORAGE LAYOUT WHEN GOING TO THE LINE        * 02910000
      *             REVERSAL COMMENT PROGRAM.                         * 02920000
      *---------------------------------------------------------------* 02930000
                                                                        02940000
           COPY TFWS004.                                                02950000
      *                                                                 02960000
      *---------------------------------------------------------------* 02970000
      *    ABEND PROCESSING COPYBOOK.                                 * 02980000
      *---------------------------------------------------------------* 02990000
                                                                        03000000
           COPY DPWS013.                                                03010000
                                                                        03020000
           EJECT                                                        03030000
      *---------------------------------------------------------------* 03040000
      *    ATTRIBUTE SETTINGS COPYBOOK.                               * 03050000
      *---------------------------------------------------------------* 03060000
                                                                        03070000
           COPY DPWS015.                                                03080000
                                                                        03090000
      *---------------------------------------------------------------* 03100000
      *    FUNCTION KEYS COPYBOOK.                                    * 03110000
      *---------------------------------------------------------------* 03120000
                                                                        03130000
           COPY DPWS016.                                                03140000
                                                                        03150000
      *---------------------------------------------------------------* 03160000
      *    NUMERIC EDIT LAYOUT.                                       * 03170000
      *---------------------------------------------------------------* 03180000
                                                                        03190000
           COPY DPWS010I.                                               03200000
                                                                        03210000
      *---------------------------------------------------------------* 03220000
      *    MAP LAYOUT                                                 * 03230000
      *---------------------------------------------------------------* 03240000
                                                                        03250000
           COPY TFKM437.                                                03260000
                                                                        03270000
       01  MR-MAP-REDEFINITION       REDEFINES  TF437AO.                03280000
           05  FILLER                PIC X(12).                         03290000
      *                                                                 03300000
           05  MR-XFER-NBR-L         PIC S9(04) COMP.                   03310000
           05  MR-XFER-NBR-A         PIC  X(01).                        03320000
           05  MR-XFER-NBR-C         PIC  X(01).                        03330000
           05  MR-XFER-NBR-H         PIC  X(01).                        03340000
100404*    05  MR-XFER-NBR           PIC  X(10).                        03350000
100404     05  MR-XFER-NBR           PIC  X(11).                        03360000
      *                                                                 03370000
           05  MR-FR-STR-NBR-L       PIC S9(04) COMP.                   03380000
           05  MR-FR-STR-NBR-A       PIC  X(01).                        03390000
           05  MR-FR-STR-NBR-C       PIC  X(01).                        03400000
           05  MR-FR-STR-NBR-H       PIC  X(01).                        03410000
100404*    05  MR-FR-STR-NBR         PIC  X(03).                        03420000
100404     05  MR-FR-STR-NBR         PIC  X(04).                        03430000
      *                                                                 03440000
           05  MR-FR-STR-NAM-L       PIC S9(04) COMP.                   03450000
           05  MR-FR-STR-NAM-A       PIC  X(01).                        03460000
           05  MR-FR-STR-NAM-C       PIC  X(01).                        03470000
           05  MR-FR-STR-NAM-H       PIC  X(01).                        03480000
           05  MR-FR-STR-NAM         PIC  X(10).                        03490000
      *                                                                 03500000
           05  MR-TO-STR-NBR-L       PIC S9(04) COMP.                   03510000
           05  MR-TO-STR-NBR-A       PIC  X(01).                        03520000
           05  MR-TO-STR-NBR-C       PIC  X(01).                        03530000
           05  MR-TO-STR-NBR-H       PIC  X(01).                        03540000
100404*    05  MR-TO-STR-NBR         PIC  X(03).                        03550000
100404     05  MR-TO-STR-NBR         PIC  X(04).                        03560000
      *                                                                 03570000
           05  MR-TO-STR-NAM-L       PIC S9(04) COMP.                   03580000
           05  MR-TO-STR-NAM-A       PIC  X(01).                        03590000
           05  MR-TO-STR-NAM-C       PIC  X(01).                        03600000
           05  MR-TO-STR-NAM-H       PIC  X(01).                        03610000
           05  MR-TO-STR-NAM         PIC  X(10).                        03620000
      *                                                                 03630000
           05  MR-RC-STR-NBR-L       PIC S9(04) COMP.                   03640000
           05  MR-RC-STR-NBR-A       PIC  X(01).                        03650000
           05  MR-RC-STR-NBR-C       PIC  X(01).                        03660000
           05  MR-RC-STR-NBR-H       PIC  X(01).                        03670000
100404*    05  MR-RC-STR-NBR         PIC  X(03).                        03680000
100404     05  MR-RC-STR-NBR         PIC  X(04).                        03690000
      *                                                                 03700000
           05  MR-RC-STR-NAM-L       PIC S9(04) COMP.                   03710000
           05  MR-RC-STR-NAM-A       PIC  X(01).                        03720000
           05  MR-RC-STR-NAM-C       PIC  X(01).                        03730000
           05  MR-RC-STR-NAM-H       PIC  X(01).                        03740000
           05  MR-RC-STR-NAM         PIC  X(10).                        03750000
      *                                                                 03760000
           05  MR-HDR-DATE-L         PIC S9(04) COMP.                   03770000
           05  MR-HDR-DATE-A         PIC  X(01).                        03780000
           05  MR-HDR-DATE-C         PIC  X(01).                        03790000
           05  MR-HDR-DATE-H         PIC  X(01).                        03800000
           05  MR-HDR-DATE           PIC  X(10).                        03810000
      *                                                                 03820000
           05  MR-HDR-FR-NBR-L       PIC S9(04) COMP.                   03830000
           05  MR-HDR-FR-NBR-A       PIC  X(01).                        03840000
           05  MR-HDR-FR-NBR-C       PIC  X(01).                        03850000
           05  MR-HDR-FR-NBR-H       PIC  X(01).                        03860000
100404*    05  MR-HDR-FR-NBR         PIC  X(03).                        03870000
100404     05  MR-HDR-FR-NBR         PIC  X(04).                        03880000
      *                                                                 03890000
           05  MR-HDR-FR-NAM-L       PIC S9(04) COMP.                   03900000
           05  MR-HDR-FR-NAM-A       PIC  X(01).                        03910000
           05  MR-HDR-FR-NAM-C       PIC  X(01).                        03920000
           05  MR-HDR-FR-NAM-H       PIC  X(01).                        03930000
           05  MR-HDR-FR-NAM         PIC  X(05).                        03940000
      *                                                                 03950000
           05  MR-HDR-TO-NBR-L       PIC S9(04) COMP.                   03960000
           05  MR-HDR-TO-NBR-A       PIC  X(01).                        03970000
           05  MR-HDR-TO-NBR-C       PIC  X(01).                        03980000
           05  MR-HDR-TO-NBR-H       PIC  X(01).                        03990000
100404*    05  MR-HDR-TO-NBR         PIC  X(03).                        04000000
100404     05  MR-HDR-TO-NBR         PIC  X(04).                        04010000
      *                                                                 04020000
           05  MR-HDR-TO-NAM-L       PIC S9(04) COMP.                   04030000
           05  MR-HDR-TO-NAM-A       PIC  X(01).                        04040000
           05  MR-HDR-TO-NAM-C       PIC  X(01).                        04050000
           05  MR-HDR-TO-NAM-H       PIC  X(01).                        04060000
           05  MR-HDR-TO-NAM         PIC  X(05).                        04070000
      *                                                                 04080000
           05  MR-HDR-QTY-L          PIC S9(04) COMP.                   04090000
           05  MR-HDR-QTY-A          PIC  X(01).                        04100000
           05  MR-HDR-QTY-C          PIC  X(01).                        04110000
           05  MR-HDR-QTY-H          PIC  X(01).                        04120000
           05  MR-HDR-QTY.                                              04130000
               10  MR-HDR-QTY-N      PIC  ZZ9.                          04140000
      *                                                                 04150000
           05  MR-HDR-PRC-L          PIC S9(04) COMP.                   04160000
           05  MR-HDR-PRC-A          PIC  X(01).                        04170000
           05  MR-HDR-PRC-C          PIC  X(01).                        04180000
           05  MR-HDR-PRC-H          PIC  X(01).                        04190000
           05  MR-HDR-PRC.                                              04200000
SR3403         10  MR-HDR-PRC-N      PIC  ZZZZZ.99.                     04210000
      *                                                                 04220000
           05  MR-HDR-EXT-L          PIC S9(04) COMP.                   04230000
           05  MR-HDR-EXT-A          PIC  X(01).                        04240000
           05  MR-HDR-EXT-C          PIC  X(01).                        04250000
           05  MR-HDR-EXT-H          PIC  X(01).                        04260000
           05  MR-HDR-EXT.                                              04270000
               10  MR-HDR-EXT-N      PIC  ZZZZZZ.99.                    04280000
      *                                                                 04290000
           05  MR-REASON-L           PIC S9(04) COMP.                   04300000
           05  MR-REASON-A           PIC  X(01).                        04310000
           05  MR-REASON-C           PIC  X(01).                        04320000
           05  MR-REASON-H           PIC  X(01).                        04330000
100404*    05  MR-REASON             PIC  X(23).                        04340000
SR3403     05  MR-REASON             PIC  X(18).                        04350000
      *                                                                 04360000
           05  MR-SCROLL-AREA OCCURS 8 TIMES.                           04370000
      *                                                                 04380000
               10  MR-DATE-L         PIC S9(04) COMP.                   04390000
               10  MR-DATE-A         PIC  X(01).                        04400000
               10  MR-DATE-C         PIC  X(01).                        04410000
               10  MR-DATE-H         PIC  X(01).                        04420000
               10  MR-DATE           PIC  X(10).                        04430000
      *                                                                 04440000
               10  MR-DTL-FR-NBR-L   PIC S9(04) COMP.                   04450000
               10  MR-DTL-FR-NBR-A   PIC  X(01).                        04460000
               10  MR-DTL-FR-NBR-C   PIC  X(01).                        04470000
               10  MR-DTL-FR-NBR-H   PIC  X(01).                        04480000
               10  MR-DTL-FR-NBR.                                       04490000
100404*            15  MR-DTL-FR-NBR-N   PIC  9(03).                    04500000
100404             15  MR-DTL-FR-NBR-N   PIC  9(04).                    04510000
      *                                                                 04520000
               10  MR-DTL-TO-NBR-L   PIC S9(04) COMP.                   04530000
               10  MR-DTL-TO-NBR-A   PIC  X(01).                        04540000
               10  MR-DTL-TO-NBR-C   PIC  X(01).                        04550000
               10  MR-DTL-TO-NBR-H   PIC  X(01).                        04560000
               10  MR-DTL-TO-NBR.                                       04570000
100404*            15  MR-DTL-TO-NBR-N   PIC  9(03).                    04580000
100404             15  MR-DTL-TO-NBR-N   PIC  9(04).                    04590000
      *                                                                 04600000
               10  MR-DTL-QTY-L      PIC S9(04) COMP.                   04610000
               10  MR-DTL-QTY-A      PIC  X(01).                        04620000
               10  MR-DTL-QTY-C      PIC  X(01).                        04630000
               10  MR-DTL-QTY-H      PIC  X(01).                        04640000
               10  MR-DTL-QTY.                                          04650000
                   15  MR-DTL-QTY-N     PIC  ZZ9.                       04660000
      *                                                                 04670000
               10  MR-DTL-PRC-L      PIC S9(04) COMP.                   04680000
               10  MR-DTL-PRC-A      PIC  X(01).                        04690000
               10  MR-DTL-PRC-C      PIC  X(01).                        04700000
               10  MR-DTL-PRC-H      PIC  X(01).                        04710000
               10  MR-DTL-PRC.                                          04720000
SR3403             15  MR-DTL-PRC-N     PIC  ZZZZZ.99.                  04730000
      *                                                                 04740000
               10  MR-DTL-EXT-L      PIC S9(04) COMP.                   04750000
               10  MR-DTL-EXT-A      PIC  X(01).                        04760000
               10  MR-DTL-EXT-C      PIC  X(01).                        04770000
               10  MR-DTL-EXT-H      PIC  X(01).                        04780000
               10  MR-DTL-EXT.                                          04790000
                   15  MR-DTL-EXT-N      PIC  ZZZZZZ.99.                04800000
      *                                                                 04810000
       EJECT                                                            04820000
      *----------------------------------------------------------------*04830000
      *    DB2 AREA FOR TRANSFER TABLE                                * 04840000
      *---------------------------------------------------------------* 04850000
           EXEC SQL                                                     04860000
                INCLUDE TTFMSTR                                         04870000
           END-EXEC.                                                    04880000
      *---------------------------------------------------------------* 04890000
      *    DB2 AREA FOR TTFRCPT (TRANSFER RECEIPT TABLE)                04900000
      *---------------------------------------------------------------* 04910000
           EXEC SQL                                                     04920000
                INCLUDE TTFRCPT                                         04930000
           END-EXEC.                                                    04940000
      *---------------------------------------------------------------* 04950000
      *    DB2 AREA FOR TTFSTAT (TRANSFER STATUS TABLE)                 04960000
      *---------------------------------------------------------------* 04970000
           EXEC SQL                                                     04980000
                INCLUDE TTFSTAT                                         04990000
           END-EXEC.                                                    05000000
      *---------------------------------------------------------------* 05010000
      *    DB2 AREA FOR TTFAJRS (ADJUSTMENT REASON TABLE)               05020000
      *---------------------------------------------------------------* 05030000
           EXEC SQL                                                     05040000
                INCLUDE TTFAJRS                                         05050000
           END-EXEC.                                                    05060000
      *---------------------------------------------------------------* 05070000
      *    DB2 AREA FOR TTFITPS (TRANSFER ITEM POSTING TABLE)         * 05080000
      *---------------------------------------------------------------* 05090000
           EXEC SQL                                                     05100000
                INCLUDE TTFITPS                                         05110000
           END-EXEC.                                                    05120000
      *---------------------------------------------------------------* 05130000
      *    DB2 AREA FOR XST_LOC TABLE                                 * 05140000
      *---------------------------------------------------------------* 05150000
           EXEC SQL                                                     05160000
                INCLUDE XST00001                                        05170000
           END-EXEC.                                                    05180000
051705*---------------------------------------------------------------* 05190000
051705*    DB2 AREA FOR TRANSFER CONTROL TABLE                        * 05200000
051705*---------------------------------------------------------------* 05210000
051705*    EXEC SQL                                                     05220000
051705*         INCLUDE TTFCNTL                                         05230000
051705*    END-EXEC.                                                    05240000
051705*---------------------------------------------------------------* 05250000
051705*    DB2 AREA FOR INVENTORY PARAMETERS TABLE                    * 05260000
051705*---------------------------------------------------------------* 05270000
051705*    EXEC SQL                                                     05280000
051705*         INCLUDE TINVPAR                                         05290000
051705*    END-EXEC.                                                    05300000
      *---------------------------------------------------------------* 05310000
      *    DB2 AREA FOR COMMUNICATIONS                                * 05320000
      *---------------------------------------------------------------* 05330000
           EXEC SQL                                                     05340000
                INCLUDE SQLCA                                           05350000
           END-EXEC.                                                    05360000
                                                                        05370000
       EJECT                                                            05380000
       LINKAGE SECTION.                                                 05390000
                                                                        05400000
       01  DFHCOMMAREA.                                                 05410000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   05420000
                                              DEPENDING ON EIBCALEN.    05430000
               10  FILLER                     PIC X.                    05440000
                                                                        05450000
       EJECT                                                            05460000
       PROCEDURE DIVISION.                                              05470000
                                                                        05480000
       0000-MAIN-MODULE.                                                05490000
                                                                        05500000
           INITIALIZE DP030-CICS-API-FIELDS.                            05510000
           MOVE +1                      TO DP030-NUMBER-OF-MAPS.        05520000
           MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           05530000
           MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          05540000
           SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        05550000
           MOVE LENGTH OF TF437AI       TO DP030-MAP-LENGTH (1).        05560000
           MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      05570000
           PERFORM 0001-CALL-CICS-ARCH-API.                             05580000
                                                                        05590000
           PERFORM 1000-CONTROL-PROCESSING.                             05600000
                                                                        05610000
           MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      05620000
           PERFORM 0001-CALL-CICS-ARCH-API.                             05630000
                                                                        05640000
      *----------------------------------------------------------------*05650000
      *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *05660000
      *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *05670000
      *----------------------------------------------------------------*05680000
                                                                        05690000
       0001-CALL-CICS-ARCH-API.                                         05700000
                                                                        05710000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05720005
                                          DFHCOMMAREA                   05730005
                                          DP030-CICS-API-FIELDS         05740005
                                          DP020-STANDARD-COMMAREA       05750005
                                          TF437AI.                      05760005
                                                                        05770000
           IF  DP030-RC-CALL-SUCCESSFUL                                 05780000
               CONTINUE                                                 05790000
           ELSE                                                         05800000
               SET DP013-NO-ROLLBACK TO TRUE                            05810000
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   05820000
               SET DP013-CICS-ABEND TO TRUE                             05830000
               MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        05840000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05841005
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05842005
               MOVE DP030-RETURN-CODE                                   05870000
                                     TO DP013-MESSAGE-TEXT (3)          05880000
               PERFORM DP013-0000-PROCESS-ABEND                         05890000
           END-IF.                                                      05900000
                                                                        05910000
      *----------------------------------------------------------------*05920000
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05930000
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05940000
      *                                                                *05950000
      * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05960000
      *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05970000
      *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05980000
      *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05990000
      *----------------------------------------------------------------*06000000
                                                                        06010000
       1000-CONTROL-PROCESSING.                                         06020000
                                                                        06030000
           EXEC CICS                                                    06040000
               ASKTIME                                                  06050000
                   ABSTIME(PC-ABSTIME)                                  06060000
           END-EXEC.                                                    06070000
                                                                        06080000
           EXEC CICS                                                    06090000
               FORMATTIME                                               06100000
                   ABSTIME(PC-ABSTIME)                                  06110000
                   MMDDYY(PC-SYSTEM-DATE)                               06120000
           END-EXEC.                                                    06130000
                                                                        06140000
           EVALUATE TRUE                                                06150000
               WHEN DP020-NEXT-ACT-INITIAL                              06160000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     06170000
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 06180000
      ***-----$TEMPLATE NOTE$-------------------------------------------06190000
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06200000
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06210000
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06220000
      ***---------------------------------------------------------------06230000
                   IF  PS-COMMAREA-NOT-VALID                            06240000
                       SET DP020-NEXT-ACT-APPL-ERROR                    06250000
                                     TO  TRUE                           06260000
                   ELSE                                                 06270000
                       SET PS-TRANSFER-NOT-FOUND  TO TRUE               06280000
                       PERFORM 4100-GET-TRANSFER                        06290000
                       IF PS-TRANSFER-FOUND                             06300000
                           SET PS-TRANSFER-POST-NOT-FOUND  TO TRUE      06310000
                           PERFORM 4200-GET-ITEM-POSTING                06320000
                           IF PS-TRANSFER-POST-FOUND                    06330000
051705*                        SET PS-NO-INVENTORY-ERROR  TO TRUE       06340000
051705*                        PERFORM 4300-CHECK-INVENTORY-CUTOFF      06350000
051705*                        IF PS-NO-INVENTORY-ERROR                 06360000
                                   PERFORM 4000-BUILD-INITIAL-PANEL     06370000
051705*                        END-IF                                   06380000
                           ELSE                                         06390000
                               MOVE PC-TSYMSG-00148                     06400000
                                     TO DP020-MSG-NUMBER                06410000
                               SET DP020-MSG-FATAL                      06420000
                               DP020-NEXT-ACT-APPL-ERROR  TO TRUE       06430000
                           END-IF                                       06440000
                       ELSE                                             06450000
                           MOVE PC-TSYMSG-00148                         06460000
                                     TO DP020-MSG-NUMBER                06470000
                           SET DP020-MSG-FATAL                          06480000
                           DP020-NEXT-ACT-APPL-ERROR  TO TRUE           06490000
                       END-IF                                           06500000
                   END-IF                                               06510000
                                                                        06520000
               WHEN DP020-NEXT-ACT-READ-MAP                             06530000
                   PERFORM 2000-PROCESS-PANEL                           06540000
                                                                        06550000
               WHEN DP020-NEXT-ACT-RETURN                               06560000
                 IF NOT ASC-UPDATE-DONE                                 06570000
                   PERFORM 3200-RESET-ATTRIBUTES                        06580000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06590000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06600000
                 ELSE                                                   06610000
                   PERFORM 3250-RESET-ATTRIBUTES                        06620000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06630000
                 END-IF                                                 06640000
                                                                        06650000
               WHEN OTHER                                               06660000
                   SET DP013-LOGIC-ABEND TO TRUE                        06670000
                   SET DP013-NO-ROLLBACK TO TRUE                        06680000
                   MOVE '1000-CONTROL-PROCESSING'                       06690000
                                     TO  DP013-PARAGRAPH                06700000
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06710000
                                     TO  DP013-MESSAGE-TEXT(1)          06720000
                   PERFORM DP013-0000-PROCESS-ABEND                     06730000
           END-EVALUATE.                                                06740000
                                                                        06750000
       EJECT                                                            06760000
      *----------------------------------------------------------------*06770000
      * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA.      *06780000
      *----------------------------------------------------------------*06790000
                                                                        06800000
       1100-PROCESS-INTER-APPL-COMM.                                    06810000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06820000
           MOVE PC-SYSTEM-DATE TO DPG52-GREG-DATE-N.                    06830000
           SET DPG51-ACTUAL-CALENDAR-ONLY                               06840000
               DPG51-DO-NOT-INCR-DECR-DATE                              06850000
               DPG52-LK-DTE-GREG        TO TRUE.                        06860000
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      06870000
                                          DPG51 DPG52                   06880000
                                          DPG53 DPG54                   06890000
                                          DPG55 DPG56.                  06900000
           MOVE DPG55-DB2-ISO-DATE-FMT TO PV-CURRENT-DATE-ISO.          06910000
           MOVE PV-ISO-YEAR            TO ASC-CURRENT-YEAR.             06920000
           MOVE PV-ISO-MONTH           TO ASC-CURRENT-MONTH.            06930000
           MOVE PV-ISO-DAY             TO ASC-CURRENT-DAY.              06940000
           MOVE '/'                    TO ASC-CURRENT-DATE-SLASH-1      06950000
                                          ASC-CURRENT-DATE-SLASH-2.     06960000
           SET PS-COMMAREA-VALID     TO TRUE.                           06970000
           SET ASC-USE-SELECTION-QUEUE TO TRUE                          06980000
           MOVE TF003-NUMBER-OF-TS-ITEMS                                06990000
                                     TO ASC-NUMBER-OF-TS-ITEMS          07000000
           MOVE TF003-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-IN-NAME           07010000
           MOVE TF003-XFER-DKEY-ID   TO ASC-KEY-XFER-DKEY-ID            07020000
                                        DK-XFER-DKEY-ID                 07030000
           PERFORM 1120-PREPARE-LIST-ENTRY.                             07040000
                                                                        07050000
      *----------------------------------------------------------------*07060000
      *    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *07070000
      *----------------------------------------------------------------*07080000
                                                                        07090000
       1120-PREPARE-LIST-ENTRY.                                         07100000
                                                                        07110000
           MOVE TF004-MAX-ITEMS TO ASC-SEL-SUB.                         07120000
           MOVE ZERO            TO ASC-SEL-ITEM.                        07130000
           PERFORM 2140-GET-NEXT-LINE.                                  07140000
       EJECT                                                            07150000
      *----------------------------------------------------------------*07160000
      *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *07170000
      *    ON WHAT FUNCTION KEY WAS SELECTED.                          *07180000
      *----------------------------------------------------------------*07190000
                                                                        07200000
       2000-PROCESS-PANEL.                                              07210000
                                                                        07220000
           IF NOT ASC-UPDATE-DONE                                       07230000
             EVALUATE TRUE                                              07240000
                                                                        07250000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07260000
                   SET ASC-NO-UPDATE-REQUEST  TO TRUE                   07270000
                   MOVE ASC-KEY-XFER-DKEY-ID                            07280000
                                     TO  DK-XFER-DKEY-ID                07290000
                   MOVE ASC-KEY-XFER-LNE-NBR                            07300000
                                     TO  DK-XFER-LNE-NBR                07310000
                   MOVE ASC-KEY-PSTG-SEQ-NBR                            07320000
                                     TO  DK-PSTG-SEQ-NBR                07330000
                   SET PS-TRANSFER-NOT-FOUND  TO TRUE                   07340000
                   PERFORM 4100-GET-TRANSFER                            07350000
                   IF PS-TRANSFER-FOUND                                 07360000
                       SET PS-TRANSFER-POST-NOT-FOUND  TO TRUE          07370000
                       PERFORM 4200-GET-ITEM-POSTING                    07380000
                       IF PS-TRANSFER-POST-FOUND                        07390000
                           PERFORM 4000-BUILD-INITIAL-PANEL             07400000
                       ELSE                                             07410000
                           MOVE PC-TSYMSG-00148                         07420000
                                 TO DP020-MSG-NUMBER                    07430000
                           SET DP020-MSG-FATAL                          07440000
                           DP020-NEXT-ACT-APPL-ERROR  TO TRUE           07450000
                       END-IF                                           07460000
                   ELSE                                                 07470000
                       MOVE PC-TSYMSG-00148                             07480000
                                    TO DP020-MSG-NUMBER                 07490000
                       SET DP020-MSG-FATAL                              07500000
                       DP020-NEXT-ACT-APPL-ERROR  TO TRUE               07510000
                   END-IF                                               07520000
                                                                        07530000
               WHEN OTHER                                               07540000
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07550000
                   PERFORM 3200-RESET-ATTRIBUTES                        07560000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07570000
                   IF  PS-NO-ERROR                                      07580000
                       SET DP030-CONTINUE-GO                            07590000
                                       TO TRUE                          07600000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  07610000
                   ELSE                                                 07620000
                       SET DP030-OVERRIDE-GO                            07630000
                                       TO TRUE                          07640000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07650000
                   END-IF                                               07660000
                                                                        07670000
             END-EVALUATE                                               07680000
           ELSE                                                         07690000
             EVALUATE TRUE                                              07700000
               WHEN DP020-SRC-AID = DP016-ENTER                         07710000
               WHEN DP020-SRC-AID = DP016-CLEAR                         07720000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07730000
               PERFORM 3250-RESET-ATTRIBUTES                            07740000
               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     07750000
                                                                        07760000
               WHEN OTHER                                               07770000
                   MOVE PC-TSYMSG-00045       TO DP020-MSG-NUMBER       07780000
                   SET DP020-MSG-FATAL        TO TRUE                   07790000
                   SET DP030-SET-CURSOR-TRAILER  TO TRUE                07800000
                   SET DP030-OVERRIDE-GO      TO TRUE                   07810000
                   PERFORM 3250-RESET-ATTRIBUTES                        07820000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07830000
                                                                        07840000
             END-EVALUATE                                               07850000
           END-IF.                                                      07860000
       EJECT                                                            07870000
      *----------------------------------------------------------------*07880000
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07890000
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07900000
      * CICS ARCHITECTURE API.                                         *07910000
      *----------------------------------------------------------------*07920000
       2100-CHECK-FUNCTION-KEY.                                         07930000
           EVALUATE TRUE                                                07940000
                                                                        07950000
      *----- UPDATE ---------------------------------------------------*07960000
               WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               07970000
                   IF ASC-UPDATE-REQUEST                                07980000
                       PERFORM 7000-UPDATE                              07990000
                       SET ASC-UPDATE-DONE       TO TRUE                08000000
                   ELSE                                                 08010000
                       SET ASC-UPDATE-REQUEST TO TRUE                   08020000
                       MOVE PC-TSYMSG-01403   TO DP020-MSG-NUMBER       08030000
                       MOVE 'F15-UPDATE'      TO DP020-MSG-TEXT         08040000
                       SET DP020-MSG-INFORMATIONAL TO TRUE              08050000
                       SET DP030-SET-CURSOR-APPL-1   TO TRUE            08060000
                       SET DP030-OVERRIDE-GO  TO TRUE                   08070000
                       MOVE -1                TO MR-DTL-FR-NBR-L (1)    08080000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08090000
                   END-IF                                               08100000
                                                                        08110000
               WHEN DP020-SRC-AID = DP016-ENTER                         08120000
                   SET ASC-NO-UPDATE-REQUEST  TO TRUE                   08130000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08140000
                                                                        08150000
               WHEN OTHER                                               08160000
                   SET DP013-NO-ROLLBACK                                08170000
                       DP013-XCTL-DISPLAY-RESTART                       08180000
                       DP013-CICS-ABEND  TO TRUE                        08190000
                   MOVE '2100-CHECK-FUNCTION-KEY'                       08200000
                                         TO DP013-PARAGRAPH             08210000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08220000
                                         TO DP013-MESSAGE-TEXT (1)      08230000
                   PERFORM DP013-0000-PROCESS-ABEND                     08240000
           END-EVALUATE.                                                08250000
       EJECT                                                            08260000
      *----------------------------------------------------------------*08270000
      *    GET THE NEXT LINE NBR IF A LIST OF LINE NBRS IS BEING      * 08280000
      *    PROCESSED.                                                  *08290000
      *----------------------------------------------------------------*08300000
                                                                        08310000
       2140-GET-NEXT-LINE.                                              08320000
                                                                        08330000
           ADD +1                       TO ASC-SEL-SUB.                 08340000
           IF  ASC-SEL-SUB > TF004-MAX-ITEMS                            08350000
               ADD +1                   TO ASC-SEL-ITEM                 08360000
               MOVE +1                  TO ASC-SEL-SUB                  08370000
           END-IF.                                                      08380000
           IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                08390000
               PERFORM 9100-READ-SEL-QUEUE-IN                           08400000
               IF  TF004-ITEM (ASC-SEL-SUB) > ZERO                      08410000
                   MOVE TF004-XFER-LINE-NBR                             08420000
                                        TO ASC-KEY-XFER-LNE-NBR         08430000
                                           DK-XFER-LNE-NBR              08440000
                   MOVE TF004-POSTING-SEQ-NBR (ASC-SEL-SUB)             08450000
                                        TO ASC-KEY-PSTG-SEQ-NBR         08460000
                                           DK-PSTG-SEQ-NBR              08470000
                   SET TF004-INQ (ASC-SEL-SUB) TO TRUE                  08480000
                   PERFORM 9200-REWRITE-SEL-QUEUE-IN                    08490000
               ELSE                                                     08500000
                   SUBTRACT +1 FROM ASC-SEL-SUB                         08510000
                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             08520000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  08530000
                   SET PS-LIST-END             TO TRUE                  08540000
               END-IF                                                   08550000
           ELSE                                                         08560000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            08570000
               MOVE TF004-MAX-ITEMS     TO ASC-SEL-SUB                  08580000
               MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             08590000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      08600000
               SET PS-LIST-END             TO TRUE                      08610000
           END-IF.                                                      08620000
                                                                        08630000
      ******************************************************************08640000
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **08650000
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **08660000
      ******************************************************************08670000
       2200-MOVE-SCREEN-TO-COMMAREA.                                    08680000
                                                                        08690000
           PERFORM 2210-MOVE-LINES-TO-COMMAREA                          08700000
               VARYING PV-SUB                                           08710000
               FROM 1 BY 1                                              08720000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                       08730000
      ******************************************************************08740000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**08750000
      ******************************************************************08760000
       2210-MOVE-LINES-TO-COMMAREA.                                     08770000
           IF  MR-DTL-FR-NBR-L (PV-SUB) > ZERO                          08780000
               MOVE MR-DTL-FR-NBR (PV-SUB)                              08790000
                                         TO ASC-DTL-FR-NBR (PV-SUB)     08800000
           ELSE                                                         08810000
               IF  MR-DTL-FR-NBR-A (PV-SUB) = DP015-ERASE-EOF           08820000
                       MOVE SPACE        TO ASC-DTL-FR-NBR (PV-SUB)     08830000
               END-IF                                                   08840000
           END-IF.                                                      08850000
           IF  MR-DTL-TO-NBR-L (PV-SUB) > ZERO                          08860000
               MOVE MR-DTL-TO-NBR (PV-SUB)                              08870000
                                         TO ASC-DTL-TO-NBR (PV-SUB)     08880000
           ELSE                                                         08890000
               IF  MR-DTL-TO-NBR-A (PV-SUB) = DP015-ERASE-EOF           08900000
                       MOVE SPACE        TO ASC-DTL-TO-NBR (PV-SUB)     08910000
               END-IF                                                   08920000
           END-IF.                                                      08930000
           IF  MR-DTL-QTY-L (PV-SUB) > ZERO                             08940000
               MOVE MR-DTL-QTY (PV-SUB)                                 08950000
                                         TO ASC-DTL-QTY (PV-SUB)        08960000
           ELSE                                                         08970000
               IF  MR-DTL-QTY-A (PV-SUB) = DP015-ERASE-EOF              08980000
                       MOVE SPACE        TO ASC-DTL-QTY (PV-SUB)        08990000
               END-IF                                                   09000000
           END-IF.                                                      09010000
           IF  MR-DTL-PRC-L (PV-SUB) > ZERO                             09020000
               MOVE MR-DTL-PRC (PV-SUB)                                 09030000
                                         TO ASC-DTL-PRC (PV-SUB)        09040000
           ELSE                                                         09050000
               IF  MR-DTL-PRC-A (PV-SUB) = DP015-ERASE-EOF              09060000
                       MOVE SPACE        TO ASC-DTL-PRC (PV-SUB)        09070000
               END-IF                                                   09080000
           END-IF.                                                      09090000
      ******************************************************************09100000
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09110000
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09120000
      ******************************************************************09130000
       3000-EDIT-DATA-IN-COMMAREA.                                      09140000
           SET PS-NO-ERROR                                              09150000
               PS-NO-INPUT-DATA          TO TRUE.                       09160000
           PERFORM 3300-CHECK-IF-ENTERED                                09170000
               VARYING PV-SUB                                           09180000
               FROM 1 BY 1                                              09190000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                       09200000
           IF PS-NO-ERROR                                               09210000
               IF PS-NO-INPUT-DATA                                      09220000
                   MOVE DP015-RED         TO MR-DTL-FR-NBR-C (1)        09230000
                                             MR-DTL-TO-NBR-C (1)        09240000
                                             MR-DTL-QTY-C (1)           09250000
                                             MR-DTL-PRC-C (1)           09260000
                                             MR-DTL-EXT-C (1)           09270000
                   MOVE DP015-REVERSE     TO MR-DTL-FR-NBR-H (1)        09280000
                                             MR-DTL-TO-NBR-H (1)        09290000
                                             MR-DTL-QTY-H (1)           09300000
                                             MR-DTL-PRC-H (1)           09310000
                                             MR-DTL-EXT-H (1)           09320000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           09330000
                   MOVE -1                TO MR-DTL-TO-NBR-L (1)        09340000
                   SET DP030-SET-CURSOR-APPL-1                          09350000
                       PS-ERROR           TO TRUE                       09360000
               END-IF                                                   09370000
           END-IF.                                                      09380000
       EJECT                                                            09390000
      *----------------------------------------------------------------*09400000
      *    RESET ATTRIBUTES.                                           *09410000
      *----------------------------------------------------------------*09420000
                                                                        09430000
       3200-RESET-ATTRIBUTES.                                           09440000
                                                                        09450000
           PERFORM                                                      09460000
               VARYING PV-SUB                                           09470000
               FROM 1 BY 1                                              09480000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        09490000
               MOVE DP015-UNP-NUM-NOR-OFF                               09500000
                                         TO MR-DTL-FR-NBR-A (PV-SUB)    09510000
                                            MR-DTL-TO-NBR-A (PV-SUB)    09520000
                                            MR-DTL-QTY-A    (PV-SUB)    09530000
                                            MR-DTL-PRC-A    (PV-SUB)    09540000
               MOVE DP015-GREEN          TO MR-DTL-FR-NBR-C (PV-SUB)    09550000
                                            MR-DTL-TO-NBR-C (PV-SUB)    09560000
                                            MR-DTL-QTY-C    (PV-SUB)    09570000
                                            MR-DTL-PRC-C    (PV-SUB)    09580000
               MOVE DP015-UNDERLINE      TO MR-DTL-FR-NBR-H (PV-SUB)    09590000
                                            MR-DTL-TO-NBR-H (PV-SUB)    09600000
                                            MR-DTL-QTY-H    (PV-SUB)    09610000
                                            MR-DTL-PRC-H    (PV-SUB)    09620000
           END-PERFORM.                                                 09630000
      *----------------------------------------------------------------*09640000
      *    RESET ATTRIBUTES AFTER UPDATE HAS BEEN DONE.                *09650000
      *----------------------------------------------------------------*09660000
                                                                        09670000
       3250-RESET-ATTRIBUTES.                                           09680000
                                                                        09690000
           PERFORM                                                      09700000
               VARYING PV-SUB                                           09710000
               FROM 1 BY 1                                              09720000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        09730000
               MOVE DP015-PRO-NOR-OFF                                   09740000
                                         TO MR-DTL-FR-NBR-A (PV-SUB)    09750000
                                            MR-DTL-TO-NBR-A (PV-SUB)    09760000
                                            MR-DTL-QTY-A    (PV-SUB)    09770000
                                            MR-DTL-PRC-A    (PV-SUB)    09780000
               MOVE DP015-BLUE           TO MR-DTL-FR-NBR-C (PV-SUB)    09790000
                                            MR-DTL-TO-NBR-C (PV-SUB)    09800000
                                            MR-DTL-QTY-C    (PV-SUB)    09810000
                                            MR-DTL-PRC-C    (PV-SUB)    09820000
               MOVE DP015-HL-OFF         TO MR-DTL-FR-NBR-H (PV-SUB)    09830000
                                            MR-DTL-TO-NBR-H (PV-SUB)    09840000
                                            MR-DTL-QTY-H    (PV-SUB)    09850000
                                            MR-DTL-PRC-H    (PV-SUB)    09860000
           END-PERFORM.                                                 09870000
                                                                        09880000
      ******************************************************************09890000
      ** CHECK IF DATA WAS ENTERED IN ANY OF THE INPUT FIELDS.        **09900000
      ******************************************************************09910000
       3300-CHECK-IF-ENTERED.                                           09920000
           IF ASC-DTL-FR-NBR (PV-SUB) > SPACES         OR               09930000
              ASC-DTL-TO-NBR (PV-SUB) > SPACES         OR               09940000
              ASC-DTL-QTY    (PV-SUB) > SPACES         OR               09950000
              ASC-DTL-PRC    (PV-SUB) > SPACES                          09960000
               SET PS-INPUT-DATA          TO TRUE                       09970000
               PERFORM 3400-EDIT-ENTRIES                                09980000
           END-IF.                                                      09990000
       3400-EDIT-ENTRIES.                                               10000000
           IF ASC-DTL-FR-NBR (PV-SUB) > SPACES                          10010000
               IF ASC-DTL-FR-NBR-9 (PV-SUB) NOT = ASC-HDR-FR-NBR   AND  10020000
                  ASC-DTL-FR-NBR-9 (PV-SUB) NOT = ASC-HDR-TO-NBR        10030000
                   MOVE DP015-RED         TO MR-DTL-FR-NBR-C (PV-SUB)   10040000
                   MOVE DP015-REVERSE     TO MR-DTL-FR-NBR-H (PV-SUB)   10050000
                   IF PS-NO-ERROR                                       10060000
                       MOVE PC-TSYMSG-01475                             10070000
                                          TO DP020-MSG-NUMBER           10080000
                       MOVE -1            TO MR-DTL-FR-NBR-L (PV-SUB)   10090000
                       SET DP030-SET-CURSOR-APPL-1                      10100000
                           PS-ERROR       TO TRUE                       10110000
                   END-IF                                               10120000
               END-IF                                                   10130000
           ELSE                                                         10140000
               MOVE DP015-RED             TO MR-DTL-FR-NBR-C (PV-SUB)   10150000
               MOVE DP015-REVERSE         TO MR-DTL-FR-NBR-H (PV-SUB)   10160000
               IF PS-NO-ERROR                                           10170000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           10180000
                   MOVE -1                TO MR-DTL-FR-NBR-L (PV-SUB)   10190000
                   SET DP030-SET-CURSOR-APPL-1                          10200000
                           PS-ERROR       TO TRUE                       10210000
               END-IF                                                   10220000
           END-IF.                                                      10230000
           IF ASC-DTL-TO-NBR (PV-SUB) > SPACES                          10240000
               IF ASC-DTL-TO-NBR-9 (PV-SUB) NOT = ASC-HDR-FR-NBR   AND  10250000
                  ASC-DTL-TO-NBR-9 (PV-SUB) NOT = ASC-HDR-TO-NBR        10260000
                   MOVE DP015-RED         TO MR-DTL-TO-NBR-C (PV-SUB)   10270000
                   MOVE DP015-REVERSE     TO MR-DTL-TO-NBR-H (PV-SUB)   10280000
                   IF PS-NO-ERROR                                       10290000
                       MOVE PC-TSYMSG-01475                             10300000
                                          TO DP020-MSG-NUMBER           10310000
                       MOVE -1            TO MR-DTL-TO-NBR-L (PV-SUB)   10320000
                       SET DP030-SET-CURSOR-APPL-1                      10330000
                           PS-ERROR       TO TRUE                       10340000
                   END-IF                                               10350000
               ELSE                                                     10360000
                   IF ASC-DTL-TO-NBR-9 (PV-SUB) =                       10370000
                      ASC-DTL-FR-NBR-9 (PV-SUB)                         10380000
                       MOVE DP015-RED     TO MR-DTL-TO-NBR-C (PV-SUB)   10390000
                       MOVE DP015-REVERSE TO MR-DTL-TO-NBR-H (PV-SUB)   10400000
                       IF PS-NO-ERROR                                   10410000
                           MOVE PC-TSYMSG-01476                         10420000
                                          TO DP020-MSG-NUMBER           10430000
                           MOVE -1        TO MR-DTL-TO-NBR-L (PV-SUB)   10440000
                           SET DP030-SET-CURSOR-APPL-1                  10450000
                               PS-ERROR   TO TRUE                       10460000
                       END-IF                                           10470000
                   END-IF                                               10480000
               END-IF                                                   10490000
           ELSE                                                         10500000
               MOVE DP015-RED             TO MR-DTL-TO-NBR-C (PV-SUB)   10510000
               MOVE DP015-REVERSE         TO MR-DTL-TO-NBR-H (PV-SUB)   10520000
               IF PS-NO-ERROR                                           10530000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           10540000
                   MOVE -1                TO MR-DTL-TO-NBR-L (PV-SUB)   10550000
                   SET DP030-SET-CURSOR-APPL-1                          10560000
                           PS-ERROR       TO TRUE                       10570000
               END-IF                                                   10580000
           END-IF.                                                      10590000
           IF ASC-DTL-QTY (PV-SUB) > SPACES                             10600000
               MOVE ASC-DTL-QTY (PV-SUB)                                10610000
                                          TO DP010I-UNEDITED-FIELD      10620000
               MOVE +3                    TO DP010I-MAXIMUM-DIGITS      10630000
               MOVE +0                    TO DP010I-MAXIMUM-DECIMALS    10640000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         10650000
                                          TO TRUE                       10660000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         10671002
                         USING DP010I-NUMERIC-EDIT-AREA                 10672002
               IF DP010I-ERROR-DETECTED OR DP010I-DECIMAL-POINT-FOUND   10680000
      *        -- MUST BE NUMERIC --                                    10690000
                   SET DP020-MSG-FATAL    TO TRUE                       10700000
                   MOVE DP015-RED             TO MR-DTL-QTY-C           10710000
                                        (PV-SUB)                        10720000
                   MOVE DP015-REVERSE         TO MR-DTL-QTY-H           10730000
                                        (PV-SUB)                        10740000
                   IF PS-NO-ERROR                                       10750000
                       MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       10760000
                       SET DP020-MSG-FATAL    TO TRUE                   10770000
                       MOVE -1                TO MR-DTL-QTY-L           10780000
                                        (PV-SUB)                        10790000
                       SET DP030-SET-CURSOR-APPL-1                      10800000
                           PS-ERROR           TO TRUE                   10810000
                   END-IF                                               10820000
               ELSE                                                     10830000
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            10840000
                   MOVE PV-QUANTITY           TO                        10850000
                              ASC-DTL-QTY (PV-SUB)                      10860000
                   IF DP010I-NUMERIC-FIELD = 0                          10870000
                       SET DP020-MSG-FATAL    TO TRUE                   10880000
      *            -- MUST BE GREATER THAN ZERO --                      10890000
                       MOVE DP015-RED             TO MR-DTL-QTY-C       10900000
                                        (PV-SUB)                        10910000
                       MOVE DP015-REVERSE         TO MR-DTL-QTY-H       10920000
                                        (PV-SUB)                        10930000
                       IF PS-NO-ERROR                                   10940000
                           MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER   10950000
                           SET DP020-MSG-FATAL    TO TRUE               10960000
                           MOVE -1                TO MR-DTL-QTY-L       10970000
                                        (PV-SUB)                        10980000
                           SET DP030-SET-CURSOR-APPL-1                  10990000
                               PS-ERROR           TO TRUE               11000000
                       END-IF                                           11010000
                   END-IF                                               11020000
               END-IF                                                   11030000
           ELSE                                                         11040000
               SET DP020-MSG-FATAL    TO TRUE                           11050000
               MOVE DP015-RED             TO MR-DTL-QTY-C               11060000
                                        (PV-SUB)                        11070000
               MOVE DP015-REVERSE         TO MR-DTL-QTY-H               11080000
                                        (PV-SUB)                        11090000
      *            -- REQUIRED FIELD --                                 11100000
               IF PS-NO-ERROR                                           11110000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           11120000
                   SET DP020-MSG-FATAL    TO TRUE                       11130000
                   MOVE -1                TO MR-DTL-QTY-L               11140000
                                        (PV-SUB)                        11150000
                   SET DP030-SET-CURSOR-APPL-1                          11160000
                       PS-ERROR           TO TRUE                       11170000
               END-IF                                                   11180000
           END-IF.                                                      11190000
           IF ASC-DTL-PRC (PV-SUB) > SPACES                             11200000
               MOVE ASC-DTL-PRC (PV-SUB)                                11210000
                                          TO DP010I-UNEDITED-FIELD      11220000
               MOVE +7                    TO DP010I-MAXIMUM-DIGITS      11230000
               MOVE +2                    TO DP010I-MAXIMUM-DECIMALS    11240000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         11250000
                                          TO TRUE                       11260000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         11271004
                         USING DP010I-NUMERIC-EDIT-AREA                 11272004
               IF DP010I-ERROR-DETECTED                                 11280000
                   MOVE DP015-RED             TO MR-DTL-PRC-C           11290000
                                        (PV-SUB)                        11300000
                   MOVE DP015-REVERSE         TO MR-DTL-PRC-H           11310000
                                        (PV-SUB)                        11320000
                   IF PS-NO-ERROR                                       11330000
                       MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER       11340000
                       SET DP020-MSG-FATAL    TO TRUE                   11350000
                       MOVE -1                TO MR-DTL-PRC-L           11360000
                                        (PV-SUB)                        11370000
                       SET DP030-SET-CURSOR-APPL-1                      11380000
                           PS-ERROR           TO TRUE                   11390000
                   END-IF                                               11400000
               ELSE                                                     11410000
      *- USER MAY ENTER THE PRICE WITH OR WITHOUT A DECIMAL POINT       11420000
      *- IF ENTERED WITHOUT A DECIMAL POINT, 2 DECIMAL POSITIONS ARE    11430000
      *- ASSUMED.                                                       11440000
                   MOVE DP010I-NUMERIC-FIELD      TO PV-EDIT-PRICE      11450000
                   IF DP010I-DECIMAL-POINT-FOUND                        11460000
                       MOVE PV-EDIT-PRICE         TO ASC-DTL-PRC-9      11470000
                                         (PV-SUB)                       11480000
                   ELSE                                                 11490000
                       MOVE PV-EDIT-PRICE-4-DEC   TO ASC-DTL-PRC-9      11500000
                                         (PV-SUB)                       11510000
                   END-IF                                               11520000
               END-IF                                                   11530000
           ELSE                                                         11540000
               SET DP020-MSG-FATAL    TO TRUE                           11550000
               MOVE DP015-RED             TO MR-DTL-PRC-C               11560000
                                        (PV-SUB)                        11570000
               MOVE DP015-REVERSE         TO MR-DTL-PRC-H               11580000
                                        (PV-SUB)                        11590000
      *            -- REQUIRED FIELD --                                 11600000
               IF PS-NO-ERROR                                           11610000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           11620000
                   SET DP020-MSG-FATAL    TO TRUE                       11630000
                   MOVE -1                TO MR-DTL-PRC-L               11640000
                                        (PV-SUB)                        11650000
                   SET DP030-SET-CURSOR-APPL-1                          11660000
                           PS-ERROR           TO TRUE                   11670000
               END-IF                                                   11680000
           END-IF.                                                      11690000
           IF ASC-DTL-QTY (PV-SUB) > SPACES         AND                 11700000
              ASC-DTL-PRC (PV-SUB) > SPACES                             11710000
              COMPUTE ASC-DTL-EXT-9 (PV-SUB) = ASC-DTL-QTY-9 (PV-SUB) * 11720000
                                 ASC-DTL-PRC-9 (PV-SUB)                 11730000
           END-IF.                                                      11740000
       EJECT                                                            11750000
                                                                        11760000
      *----------------------------------------------------------------*11770000
      *    DISPLAY THE PANEL TO USER.                                  *11780000
      *----------------------------------------------------------------*11790000
                                                                        11800000
       4000-BUILD-INITIAL-PANEL.                                        11810000
                                                                        11820000
           MOVE -1                 TO MR-DTL-FR-NBR-L (1)               11830000
           SET DP030-SET-CURSOR-APPL-1 TO TRUE                          11840000
           PERFORM 3200-RESET-ATTRIBUTES                                11850000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11860000
       EJECT                                                            11870000
      *----------------------------------------------------------------*11880000
      * SELECT DATA FROM THE TRANSFER TABLES                            11890000
      *----------------------------------------------------------------*11900000
       4100-GET-TRANSFER.                                               11910000
           PERFORM                                                      11920000
               WITH TEST AFTER                                          11930000
               VARYING PV-RETRY-COUNT                                   11940000
               FROM 1 BY 1                                              11950000
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 11960000
                         OR (SQLCODE = ZERO)                            11970000
                         OR (SQLCODE = +100))                           11980000
      *                                                                 11990000
               EXEC SQL                                                 12000000
                   SELECT FR_STR_NBR                                    12010000
                         ,XFER_SEQ_NBR                                  12020000
                         ,CONTNR_TYP_CDE                                12030000
                         ,TO_STR_NBR                                    12040000
                         ,CMPT_XFER_END_TMST                            12050000
                   INTO   :TFMSTR-FR-STR-NBR                            12060000
                         ,:TFMSTR-XFER-SEQ-NBR                          12070000
                         ,:TFMSTR-CONTNR-TYP-CDE                        12080000
                         ,:TFMSTR-TO-STR-NBR                            12090000
                         ,:TFMSTR-CMPT-XFER-END-TMST                    12100000
                   FROM   TTFMSTR                                       12110000
                   WHERE  XFER_DKEY_ID     = :DK-XFER-DKEY-ID           12120000
               END-EXEC                                                 12130000
                                                                        12140000
               EVALUATE TRUE                                            12150000
                   WHEN SQLCODE = ZERO                                  12160000
                      SET PS-TRANSFER-FOUND     TO TRUE                 12170000
                      MOVE TFMSTR-FR-STR-NBR    TO ASC-FROM-STORE-NBR   12180000
                      MOVE TFMSTR-XFER-SEQ-NBR  TO ASC-XFER-SEQ-NBR     12190000
                      MOVE TFMSTR-TO-STR-NBR    TO ASC-TO-STORE-NBR     12200000
                      MOVE TFMSTR-CONTNR-TYP-CDE                        12210000
                                                TO ASC-CONTNR-TYP-CDE   12220000
051705*               MOVE TFMSTR-CMPT-XFER-END-TMST                    12230000
051705*                                          TO PV-CMPLT-DATE       12240000
                      PERFORM 5500-GET-STORE-NAMES                      12250000
                      PERFORM 6200-READ-TRANSFER-RECEIPT                12260000
                   WHEN SQLCODE = +100                                  12270000
                   WHEN SQLCODE = -904                                  12280000
                   WHEN SQLCODE = -913                                  12290000
                       CONTINUE                                         12300000
                   WHEN OTHER                                           12310000
                       MOVE '4100-GET-TRANSFER'                         12320000
                                         TO DP013-PARAGRAPH             12330000
                       MOVE 'SELECT TRANSFER DATA'                      12340000
                                         TO DP013-MESSAGE-TEXT (1)      12350000
                       MOVE SQLCA        TO DP013-SQLCA                 12360000
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    12370000
                       SET DP013-DB2-ABEND                              12380000
                           DP013-XCTL-DISPLAY-RESTART                   12390000
                                         TO TRUE                        12400000
                       PERFORM DP013-0000-PROCESS-ABEND                 12410000
               END-EVALUATE                                             12420000
           END-PERFORM.                                                 12430000
      *                                                                 12440000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          12450000
               MOVE '4100-GET-TRANSFER'                                 12460000
                                         TO DP013-PARAGRAPH             12470000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12480000
                                         TO DP013-MESSAGE-TEXT (1)      12490000
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      12500000
               MOVE SQLCA                TO DP013-SQLCA                 12510000
               MOVE 'TTFMSTR'            TO DP013-DB2-TABLE-NAME (1)    12520000
               SET DP013-DB2-ABEND                                      12530000
                   DP013-XCTL-DISPLAY-RESTART                           12540000
                                         TO TRUE                        12550000
               PERFORM DP013-0000-PROCESS-ABEND                         12560000
           END-IF.                                                      12570000
       EJECT                                                            12580000
      *----------------------------------------------------------------*12590000
      * SELECT DATA FROM THE TRANSFER ITEM TABLE.                       12600000
      *----------------------------------------------------------------*12610000
       4200-GET-ITEM-POSTING.                                           12620000
           PERFORM                                                      12630000
               WITH TEST AFTER                                          12640000
               VARYING PV-RETRY-COUNT                                   12650000
               FROM 1 BY 1                                              12660000
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 12670000
                         OR (SQLCODE = ZERO)                            12680000
                         OR (SQLCODE = +100))                           12690000
               EXEC SQL                                                 12700000
                   SELECT                                               12710000
                      P.ADJ_RSN_CDE                                     12720000
                    , ITM_PSTG_PRPD_TMST                                12730000
                    , FRM_PSTG_STR_NBR                                  12740000
                    , TO_PSTG_STR_NBR                                   12750000
                    , ITM_RTL_PRCE_AMT                                  12760000
                    , ITM_QTY                                           12770000
                    , EXTL_SYS_PRCG_CDE                                 12780000
                    , ADJ_RSN_DESC                                      12790000
                    INTO                                                12800000
                      :TFITPS-ADJ-RSN-CDE                               12810000
                    , :TFITPS-ITM-PSTG-PRPD-TMST                        12820000
                    , :TFITPS-FRM-PSTG-STR-NBR                          12830000
                    , :TFITPS-TO-PSTG-STR-NBR                           12840000
                    , :TFITPS-ITM-RTL-PRCE-AMT                          12850000
                    , :TFITPS-ITM-QTY                                   12860000
                    , :TFITPS-EXTL-SYS-PRCG-CDE                         12870000
                    , :TFAJRS-ADJ-RSN-DESC                              12880000
                FROM                                                    12890000
                      TTFITPS P                                         12900000
                     ,TTFAJRS A                                         12910000
                WHERE                                                   12920000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         12930000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR     AND         12940000
                      PSTG_SEQ_NBR   = :DK-PSTG-SEQ-NBR     AND         12950000
                      A.ADJ_RSN_CDE  = P.ADJ_RSN_CDE                    12960000
               END-EXEC                                                 12970000
                                                                        12980000
               EVALUATE TRUE                                            12990000
                   WHEN SQLCODE = ZERO                                  13000000
                   WHEN SQLCODE = +100                                  13010000
                   WHEN SQLCODE = -904                                  13020000
                   WHEN SQLCODE = -913                                  13030000
                       CONTINUE                                         13040000
                   WHEN OTHER                                           13050000
                       MOVE '4200-GET-ITEM-POSTING'                     13060000
                                         TO DP013-PARAGRAPH             13070000
                       MOVE 'SELECT TRANSFER POSTING DATA'              13080000
                                         TO DP013-MESSAGE-TEXT (1)      13090000
                       MOVE SQLCA        TO DP013-SQLCA                 13100000
                       MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)    13110000
                       SET DP013-DB2-ABEND                              13120000
                           DP013-XCTL-DISPLAY-RESTART                   13130000
                                         TO TRUE                        13140000
                       PERFORM DP013-0000-PROCESS-ABEND                 13150000
               END-EVALUATE                                             13160000
           END-PERFORM.                                                 13170000
      *                                                                 13180000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          13190000
               MOVE '4200-GET-ITEM-POSTING'                             13200000
                                         TO DP013-PARAGRAPH             13210000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13220000
                                         TO DP013-MESSAGE-TEXT (1)      13230000
               MOVE 'TRANSFER POSTING DATA'                             13240000
                                         TO DP013-MESSAGE-TEXT (2)      13250000
               MOVE SQLCA                TO DP013-SQLCA                 13260000
               MOVE 'TTFITPS'            TO DP013-DB2-TABLE-NAME (1)    13270000
               SET DP013-DB2-ABEND                                      13280000
                   DP013-XCTL-DISPLAY-RESTART                           13290000
                                         TO TRUE                        13300000
               PERFORM DP013-0000-PROCESS-ABEND                         13310000
           END-IF.                                                      13320000
           IF SQLCODE = ZERO                                            13330000
               SET PS-TRANSFER-POST-FOUND  TO TRUE                      13340000
               MOVE TFITPS-ADJ-RSN-CDE        TO ASC-REASON-CODE        13350000
               MOVE TFITPS-ITM-PSTG-PRPD-TMST TO PV-DATE                13360000
               MOVE PV-YEAR                   TO ASC-DTE-YEAR           13370000
               MOVE PV-MONTH                  TO ASC-DTE-MONTH          13380000
               MOVE PV-DAY                    TO ASC-DTE-DAY            13390000
               MOVE '/'                       TO ASC-DTE-SLASH-1        13400000
                                                 ASC-DTE-SLASH-2        13410000
               MOVE TFITPS-FRM-PSTG-STR-NBR   TO ASC-HDR-FR-NBR         13420000
               MOVE TFITPS-TO-PSTG-STR-NBR    TO ASC-HDR-TO-NBR         13430000
               MOVE TFITPS-ITM-RTL-PRCE-AMT   TO ASC-HDR-PRC            13440000
               MOVE TFITPS-ITM-QTY            TO ASC-HDR-QTY            13450000
               MOVE TFITPS-EXTL-SYS-PRCG-CDE  TO ASC-PRICE-CODE         13460000
               COMPUTE ASC-HDR-EXT = ASC-HDR-QTY * ASC-HDR-PRC          13470000
               MOVE TFAJRS-ADJ-RSN-DESC                                 13480000
                                     TO  ASC-REASON                     13490000
               MOVE TFITPS-FRM-PSTG-STR-NBR   TO DK-STORE-NBR           13500000
               PERFORM 5550-READ-XST-LOC                                13510000
               MOVE XST00001-LOC-5-ABBR-NM    TO ASC-HDR-FR-NAM         13520000
               MOVE TFITPS-TO-PSTG-STR-NBR    TO DK-STORE-NBR           13530000
               PERFORM 5550-READ-XST-LOC                                13540000
               MOVE XST00001-LOC-5-ABBR-NM    TO ASC-HDR-TO-NAM         13550000
           END-IF.                                                      13560000
051705*----------------------------------------------------------------*13570000
051705*  CHECK IF PHYSICAL INVENTORY IS ACTIVE.                         13580000
051705*----------------------------------------------------------------*13590000
051705*4300-CHECK-INVENTORY-CUTOFF.                                     13600000
051705*    PERFORM 7300-READ-CONTROL-TABLE.                             13610000
051705*    MOVE ASC-FROM-STORE-NBR TO DK-STORE-NBR-9.                   13620000
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       13630000
051705*    MOVE INVPAR-XFER-INV-CTOFF-DTE TO PV-LY-INV-CTOFF-DTE.       13640000
051705*    MOVE ASC-TO-STORE-NBR          TO DK-STORE-NBR-9.            13650000
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       13660000
051705*    IF INVPAR-XFER-INV-CTOFF-DTE > PV-LY-INV-CTOFF-DTE           13670000
051705*        MOVE INVPAR-XFER-INV-CTOFF-DTE                           13680000
051705*                                   TO PV-LY-INV-CTOFF-DTE        13690000
051705*    END-IF.                                                      13700000
051705*    IF PV-CMPLT-DATE <= PV-LY-INV-CTOFF-DTE                      13710000
051705*        SET DP020-MSG-FATAL                                      13720000
051705*            PS-INVENTORY-ERROR                                   13730000
051705*            DP020-NEXT-ACT-APPL-ERROR  TO TRUE                   13740000
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  13750000
051705*        MOVE PC-TSYMSG-01615   TO DP020-MSG-NUMBER               13760000
051705*    ELSE                                                         13770000
051705*        IF PV-PHY-INV-PERD-IND = PC-YES                          13780000
051705*            MOVE ASC-HDR-FR-NBR        TO DK-STORE-NBR-9         13790000
051705*            PERFORM 7400-GET-STR-PLND-INV-DTE                    13800000
051705*            MOVE INVPAR-PLND-INV-DTE   TO PV-FR-STR-INV-DTE      13810000
051705*            MOVE PV-HOLD-INVENTORY-IND TO PV-FR-INVENTORY-IND    13820000
051705*            MOVE ASC-HDR-TO-NBR        TO DK-STORE-NBR-9         13830000
051705*            PERFORM 7400-GET-STR-PLND-INV-DTE                    13840000
051705*            MOVE INVPAR-PLND-INV-DTE   TO PV-TO-STR-INV-DTE      13850000
051705*            MOVE PV-HOLD-INVENTORY-IND TO PV-TO-INVENTORY-IND    13860000
051705*            IF PV-FR-NO-INVENTORY  AND                           13870000
051705*               PV-TO-NO-INVENTORY                                13880000
051705*                CONTINUE                                         13890000
051705*            ELSE                                                 13900000
051705*                IF PV-FR-NO-INVENTORY                            13910000
051705*                    MOVE PV-TO-STR-INV-DTE                       13920000
051705*                                     TO PV-FR-STR-INV-DTE        13930000
051705*                ELSE                                             13940000
051705*                    IF PV-TO-NO-INVENTORY                        13950000
051705*                        MOVE PV-FR-STR-INV-DTE                   13960000
051705*                                     TO PV-TO-STR-INV-DTE        13970000
051705*                    END-IF                                       13980000
051705*                END-IF                                           13990000
051705*                IF ASC-CONTNR-TYP-CDE = PC-HAND-CARRY            14000000
051705*                   MOVE PV-FR-STR-INV-DTE     TO PV-COMPARE-DATE 14010000
051705*                ELSE                                             14020000
051705*                   MOVE PV-XFER-INV-CTOFF-DTE TO PV-COMPARE-DATE 14030000
051705*                END-IF                                           14040000
051705*                IF PV-CMPLT-DATE <= PV-COMPARE-DATE              14050000
051705*                    IF PV-CURRENT-DATE > PV-MAX-FINCL-BK-DTE     14060000
051705*                        SET DP020-MSG-FATAL                      14070000
051705*                            PS-INVENTORY-ERROR                   14080000
051705*                            DP020-NEXT-ACT-APPL-ERROR  TO TRUE   14090000
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  14100000
051705*                        MOVE PC-TSYMSG-01615 TO DP020-MSG-NUMBER 14110000
051705*                    END-IF                                       14120000
051705*                ELSE                                             14130000
051705*                    EVALUATE TRUE                                14140000
051705*                      WHEN PV-CURRENT-DATE > PV-MAX-PLND-INV-DTE 14150000
051705*                      WHEN PV-FR-STR-INV-DTE <  PV-CURRENT-DATE  14160000
051705*                                 AND                             14170000
051705*                           PV-TO-STR-INV-DTE <  PV-CURRENT-DATE  14180000
051705*                          CONTINUE                               14190000
051705*                      WHEN OTHER                                 14200000
051705*                          SET DP020-MSG-FATAL                    14210000
051705*                              PS-INVENTORY-ERROR                 14220000
051705*                              DP020-NEXT-ACT-APPL-ERROR  TO TRUE 14230000
051705* -- WAIT 'TIL BOTH STORES FINISH PHYSICAL INVENTORY              14240000
051705*                          MOVE PC-TSYMSG-01659                   14250000
051705*                                            TO DP020-MSG-NUMBER  14260000
051705*                    END-EVALUATE                                 14270000
051705*                END-IF                                           14280000
051705*            END-IF                                               14290000
051705*        END-IF                                                   14300000
051705*    END-IF.                                                      14310000
051705*EJECT                                                            14320000
      *----------------------------------------------------------------*14330000
      *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *14340000
      *----------------------------------------------------------------*14350000
                                                                        14360000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    14370000
                                                                        14380000
           MOVE ASC-FROM-STORE-NBR     TO PV-XFER-FROM-STORE            14390000
                                          MR-FR-STR-NBR.                14400000
           MOVE ASC-XFER-SEQ-NBR       TO PV-XFER-SEQ-NBR.              14410000
           MOVE PV-XFER-NBR            TO MR-XFER-NBR.                  14420000
           MOVE ASC-FROM-STORE-NAM     TO MR-FR-STR-NAM.                14430000
           MOVE ASC-TO-STORE-NBR       TO MR-TO-STR-NBR.                14440000
           MOVE ASC-TO-STORE-NAM       TO MR-TO-STR-NAM.                14450000
           MOVE ASC-RECV-STORE-NBR     TO MR-RC-STR-NBR.                14460000
           MOVE ASC-RECV-STORE-NAM     TO MR-RC-STR-NAM.                14470000
           MOVE ASC-DATE               TO MR-HDR-DATE.                  14480000
           MOVE ASC-HDR-FR-NBR         TO MR-HDR-FR-NBR.                14490000
           MOVE ASC-HDR-FR-NAM         TO MR-HDR-FR-NAM.                14500000
           MOVE ASC-HDR-TO-NBR         TO MR-HDR-TO-NBR.                14510000
           MOVE ASC-HDR-TO-NAM         TO MR-HDR-TO-NAM.                14520000
           MOVE ASC-HDR-PRC            TO MR-HDR-PRC-N.                 14530000
           MOVE ASC-HDR-QTY            TO MR-HDR-QTY-N.                 14540000
           MOVE ASC-HDR-EXT            TO MR-HDR-EXT-N.                 14550000
           MOVE ASC-REASON             TO MR-REASON.                    14560000
           PERFORM 4420-FORMAT-LIST-LINES                               14570000
               VARYING PV-SUB                                           14580000
               FROM 1 BY 1                                              14590000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                       14600000
                                                                        14610000
       EJECT                                                            14620000
       4420-FORMAT-LIST-LINES.                                          14630000
           MOVE ASC-CURRENT-DATE         TO MR-DATE (PV-SUB).           14640000
           IF ASC-DTL-FR-NBR (PV-SUB) > SPACES         OR               14650000
              ASC-DTL-TO-NBR (PV-SUB) > SPACES         OR               14660000
              ASC-DTL-QTY    (PV-SUB) > SPACES         OR               14670000
              ASC-DTL-PRC    (PV-SUB) > SPACES                          14680000
               MOVE ASC-DTL-FR-NBR (PV-SUB)                             14690000
                                         TO MR-DTL-FR-NBR (PV-SUB)      14700000
               MOVE ASC-DTL-TO-NBR (PV-SUB)                             14710000
                                         TO MR-DTL-TO-NBR (PV-SUB)      14720000
               MOVE ASC-DTL-QTY    (PV-SUB)                             14730000
                                         TO MR-DTL-QTY    (PV-SUB)      14740000
               IF ASC-DTL-PRC (PV-SUB) > SPACES                         14750000
                   INSPECT ASC-DTL-PRC (PV-SUB)                         14760000
                     REPLACING LEADING ' ' BY '0'                       14770000
                   MOVE ASC-DTL-PRC-9 (PV-SUB)                          14780000
                                         TO MR-DTL-PRC-N (PV-SUB)       14790000
               END-IF                                                   14800000
               MOVE ASC-DTL-EXT-9 (PV-SUB)                              14810000
                                         TO MR-DTL-EXT-N (PV-SUB)       14820000
           END-IF.                                                      14830000
      *----------------------------------------------------------------*14840000
      *  GET THE FROM AND TO STORE NAMES FOR DISPLAY.                  *14850000
      *----------------------------------------------------------------*14860000
       5500-GET-STORE-NAMES.                                            14870000
           MOVE ASC-FROM-STORE-NBR       TO DK-STORE-NBR.               14880000
           PERFORM 5550-READ-XST-LOC.                                   14890000
           MOVE XST00001-LOC-5-ABBR-NM   TO ASC-FROM-STORE-NAM.         14900000
           MOVE ASC-TO-STORE-NBR         TO DK-STORE-NBR.               14910000
           PERFORM 5550-READ-XST-LOC.                                   14920000
           MOVE XST00001-LOC-5-ABBR-NM   TO ASC-TO-STORE-NAM.           14930000
       EJECT                                                            14940000
      *----------------------------------------------------------------*14950000
      *  GET THE 10 CHARACTER ABBREVIATED STORE NAME.                  *14960000
      *----------------------------------------------------------------*14970000
       5550-READ-XST-LOC.                                               14980000
           PERFORM WITH TEST AFTER                                      14990000
               VARYING PV-RETRY-COUNT                                   15000000
               FROM 1 BY 1                                              15010000
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  15020000
                    OR SQLCODE = ZERO                                   15030000
                    OR SQLCODE = +100                                   15040000
               EXEC SQL                                                 15050000
                   SELECT LOC_10_ABBR_NM                                15060000
                         ,LOC_5_ABBR_NM                                 15070000
                       INTO :XST00001-LOC-10-ABBR-NM                    15080000
                         ,  :XST00001-LOC-5-ABBR-NM                     15090000
                       FROM XST_LOC                                     15100000
                       WHERE (LOC_NBR  = :DK-STORE-NBR)                 15110000
               END-EXEC                                                 15120000
               EVALUATE TRUE                                            15130000
                   WHEN SQLCODE = ZERO                                  15140000
                       CONTINUE                                         15150000
                   WHEN SQLCODE = -904                                  15160000
                   WHEN SQLCODE = -913                                  15170000
                   WHEN SQLCODE = +100                                  15180000
                       MOVE 'INVALID'     TO XST00001-LOC-10-ABBR-NM    15190000
                       MOVE '?????'       TO XST00001-LOC-5-ABBR-NM     15200000
                   WHEN OTHER                                           15210000
                       MOVE '5550-READ-XST-LOC'                         15220000
                                         TO DP013-PARAGRAPH             15230000
                       MOVE 'SELECT A ROW FROM XST_LOC'                 15240000
                                         TO DP013-MESSAGE-TEXT (1)      15250000
                       MOVE SQLCA        TO DP013-SQLCA                 15260000
                       MOVE 'XST_LOC'    TO DP013-DB2-TABLE-NAME (1)    15270000
                       SET DP013-DB2-ABEND                              15280000
                           DP013-XCTL-DISPLAY-RESTART                   15290000
                                         TO TRUE                        15300000
                       PERFORM DP013-0000-PROCESS-ABEND                 15310000
               END-EVALUATE                                             15320000
           END-PERFORM.                                                 15330000
                                                                        15340000
      *                                                                 15350000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15360000
               MOVE '5550-READ-XST-LOC'                                 15370000
                                         TO DP013-PARAGRAPH             15380000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     15390000
                                         TO DP013-MESSAGE-TEXT (1)      15400000
               MOVE 'A ROW FROM XST_LOC' TO DP013-MESSAGE-TEXT (2)      15410000
               MOVE SQLCA                TO DP013-SQLCA                 15420000
               MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (1)    15430000
               SET DP013-DB2-ABEND                                      15440000
                   DP013-XCTL-DISPLAY-RESTART                           15450000
                                         TO TRUE                        15460000
               PERFORM DP013-0000-PROCESS-ABEND                         15470000
           END-IF.                                                      15480000
       EJECT                                                            15490000
      *----------------------------------------------------------------*15500000
      *  READ THE TRANSFER RECEIPT TABLE FOR THE RECEIVED STORE NUMBER.*15510000
      *----------------------------------------------------------------*15520000
       6200-READ-TRANSFER-RECEIPT.                                      15530000
           PERFORM WITH TEST AFTER                                      15540000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       15550000
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  15560000
                    OR SQLCODE = ZERO                                   15570000
                    OR SQLCODE = +100                                   15580000
               EXEC SQL                                                 15590000
                   SELECT R.STR_NBR                                     15600000
                       , S.LOC_10_ABBR_NM                               15610000
                      INTO :TFRCPT-STR-NBR                              15620000
                         , :XST00001-LOC-10-ABBR-NM                     15630000
                      FROM TTFRCPT R                                    15640000
                         , XST_LOC S                                    15650000
                         , TTFSTAT ST                                   15660000
                      WHERE ST.XFER_STAT_CDE = :PC-POSITIVE-RECEIPT AND 15670000
                            ST.XFER_STAT_TMST = R.RCV_XFER_BEG_TMST AND 15680000
                            R.XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND 15690000
                            ST.XFER_DKEY_ID  = :DK-XFER-DKEY-ID     AND 15700000
                            S.LOC_NBR        = R.STR_NBR                15710000
               END-EXEC                                                 15720000
               EVALUATE TRUE                                            15730000
                   WHEN SQLCODE = ZERO                                  15740000
                       MOVE TFRCPT-STR-NBR                              15750000
                                          TO ASC-RECV-STORE-NBR         15760000
                       MOVE XST00001-LOC-10-ABBR-NM                     15770000
                                          TO ASC-RECV-STORE-NAM         15780000
                   WHEN SQLCODE = -904                                  15790000
                   WHEN SQLCODE = -913                                  15800000
                   WHEN SQLCODE = +100                                  15810000
                       CONTINUE                                         15820000
                   WHEN OTHER                                           15830000
                       MOVE '6200-READ-TRANSFER-RECEIPT'                15840000
                                         TO DP013-PARAGRAPH             15850000
                       MOVE 'SELECT DATA FROM TTFRCPT'                  15860000
                                         TO DP013-MESSAGE-TEXT (1)      15870000
                       MOVE SQLCA        TO DP013-SQLCA                 15880000
                       MOVE 'TTFRCPT'    TO DP013-DB2-TABLE-NAME (1)    15890000
                       MOVE 'XST_LOC'    TO DP013-DB2-TABLE-NAME (2)    15900000
                       MOVE 'TTFSTAT'    TO DP013-DB2-TABLE-NAME (3)    15910000
                       SET DP013-DB2-ABEND                              15920000
                           DP013-XCTL-DISPLAY-RESTART                   15930000
                                         TO TRUE                        15940000
                       PERFORM DP013-0000-PROCESS-ABEND                 15950000
               END-EVALUATE                                             15960000
           END-PERFORM.                                                 15970000
      *                                                                 15980000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15990000
               MOVE '6200-READ-TRANSFER-RECEIPT'                        16000000
                                         TO DP013-PARAGRAPH             16010000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16020000
                                         TO DP013-MESSAGE-TEXT (1)      16030000
               MOVE 'DATA FROM TTFRCPT'  TO DP013-MESSAGE-TEXT (2)      16040000
               MOVE SQLCA                TO DP013-SQLCA                 16050000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    16060000
               MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (2)    16070000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (3)    16080000
               SET DP013-DB2-ABEND                                      16090000
                   DP013-XCTL-DISPLAY-RESTART                           16100000
                                         TO TRUE                        16110000
               PERFORM DP013-0000-PROCESS-ABEND                         16120000
           END-IF.                                                      16130000
       EJECT                                                            16140000
      *----------------------------------------------------------------*16150000
      *  ADD THE MANUAL POSTINGS                                       *16160000
      *----------------------------------------------------------------*16170000
       7000-UPDATE.                                                     16180000
           PERFORM 7100-GET-MAX-SEQUENCE.                               16190000
           MOVE ZERO                       TO PV-SEL-QUEUE-ITEM.        16200000
           PERFORM                                                      16210000
             VARYING PV-SUB                                             16220000
               FROM 1 BY 1                                              16230000
                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                      16240000
               IF ASC-DTL-FR-NBR (PV-SUB) > SPACES                      16250000
                   PERFORM 7200-INSERT-POSTINGS                         16260000
               END-IF                                                   16270000
           END-PERFORM.                                                 16280000
           INITIALIZE TF003-INTER-APPL-COMMAREA                         16290000
           MOVE ASC-KEY-XFER-DKEY-ID  TO TF003-XFER-DKEY-ID.            16300000
           MOVE ASC-KEY-XFER-LNE-NBR  TO TF003-XFER-LNE-NBR.            16310000
           MOVE ASC-XFER-SEQ-NBR      TO TF003-XFER-SEQ-NBR.            16320000
           MOVE ASC-FROM-STORE-NBR    TO TF003-FR-STR-NBR.              16330000
           MOVE ASC-FROM-STORE-NAM    TO TF003-FR-STR-NAM.              16340000
           MOVE ASC-TO-STORE-NBR      TO TF003-TO-STR-NBR.              16350000
           MOVE ASC-TO-STORE-NAM      TO TF003-TO-STR-NAM.              16360000
           MOVE ASC-RECV-STORE-NBR    TO TF003-RC-STR-NBR.              16370000
           MOVE ASC-RECV-STORE-NAM    TO TF003-RC-STR-NAM.              16380000
           MOVE PV-SEL-QUEUE-ITEM     TO TF003-NBR-OF-POSTING-LINES.    16390000
           PERFORM                                                      16400000
             VARYING PV-ITEM                                            16410000
               FROM 1 BY 1                                              16420000
               UNTIL PV-ITEM > PV-SEL-QUEUE-ITEM                        16430000
               MOVE ASC-INSERTED-PSTG-SEQ-NBR (PV-ITEM)                 16440000
                                      TO TF003-PSTG-SEQ-NBR (PV-ITEM)   16450000
           END-PERFORM.                                                 16460000
       EJECT                                                            16470000
      *----------------------------------------------------------------*16480000
      *   FIND THE HIGHEST POSTING SEQUENC NUMBER FOR THIS LINE        *16490000
      *----------------------------------------------------------------*16500000
                                                                        16510000
       7100-GET-MAX-SEQUENCE.                                           16520000
                                                                        16530000
           MOVE ASC-KEY-XFER-DKEY-ID TO DK-XFER-DKEY-ID.                16540000
           MOVE ASC-KEY-XFER-LNE-NBR TO DK-XFER-LNE-NBR.                16550000
           PERFORM                                                      16560000
               WITH TEST AFTER                                          16570000
               VARYING PV-RETRY-COUNT                                   16580000
               FROM 1 BY 1                                              16590000
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         16600000
                  OR SQLCODE = 0                                        16610000
                                                                        16620000
               EXEC SQL                                                 16630000
                  SELECT                                                16640000
                      MAX(PSTG_SEQ_NBR)                                 16650000
                  INTO                                                  16660000
                      :TFITPS-PSTG-SEQ-NBR                              16670000
                      :PV-PSTG-MAX-IND                                  16680000
                  FROM                                                  16690000
                      TTFITPS                                           16700000
                  WHERE                                                 16710000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         16720000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR                 16730000
               END-EXEC                                                 16740000
                                                                        16750000
               EVALUATE TRUE                                            16760000
                   WHEN SQLCODE = ZERO                                  16770000
                       MOVE TFITPS-PSTG-SEQ-NBR                         16780000
                                     TO  ASC-MAX-POSTING-SEQ-NBR        16790000
                   WHEN SQLCODE = -904                                  16800000
                   WHEN SQLCODE = -913                                  16810000
                        CONTINUE                                        16820000
                   WHEN OTHER                                           16830000
                        MOVE '7100-GET-MAX-SEQUENCE'                    16840000
                                     TO  DP013-PARAGRAPH                16850000
                        MOVE 'GET MAX SEQ AND TIMESTAMP FROM TTFITPS'   16860000
                                     TO  DP013-MESSAGE-TEXT (1)         16870000
                        MOVE 'TTFITPS'  TO DP013-DB2-TABLE-NAME (1)     16880000
                        MOVE SQLCA   TO  DP013-SQLCA                    16890000
                        SET DP013-DB2-ABEND                             16900000
                                     TO  TRUE                           16910000
                        PERFORM DP013-0000-PROCESS-ABEND                16920000
               END-EVALUATE                                             16930000
           END-PERFORM.                                                 16940000
                                                                        16950000
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               16960000
               MOVE '7100-GET-MAX-SEQUENCE'                             16970000
                                     TO  DP013-PARAGRAPH                16980000
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             16990000
                                     TO  DP013-MESSAGE-TEXT (1)         17000000
               MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)        17010000
               MOVE SQLCA            TO  DP013-SQLCA                    17020000
               SET DP013-DB2-ABEND   TO  TRUE                           17030000
               PERFORM DP013-0000-PROCESS-ABEND                         17040000
           END-IF.                                                      17050000
                                                                        17060000
       EJECT                                                            17070000
      *----------------------------------------------------------------*17080000
      * INSERT MANUAL POSTINGS.                                        *17090000
      *----------------------------------------------------------------*17100000
       7200-INSERT-POSTINGS.                                            17110000
           INITIALIZE DCLTTFITPS.                                       17120000
           MOVE ASC-KEY-XFER-DKEY-ID       TO TFITPS-XFER-DKEY-ID.      17130000
           MOVE ASC-KEY-XFER-LNE-NBR       TO TFITPS-XFER-LNE-NBR.      17140000
           ADD +1                          TO ASC-MAX-POSTING-SEQ-NBR   17150000
                                              PV-SEL-QUEUE-ITEM.        17160000
           MOVE ASC-MAX-POSTING-SEQ-NBR    TO TFITPS-PSTG-SEQ-NBR       17170000
                                              ASC-INSERTED-PSTG-SEQ-NBR 17180000
                                              (PV-SEL-QUEUE-ITEM).      17190000
           MOVE PC-MANUAL-REVERSAL         TO TFITPS-ADJ-RSN-CDE.       17200000
           MOVE ASC-DTL-FR-NBR-9 (PV-SUB)  TO TFITPS-FRM-PSTG-STR-NBR.  17210000
           MOVE ASC-DTL-TO-NBR-9 (PV-SUB)  TO TFITPS-TO-PSTG-STR-NBR.   17220000
           MOVE ASC-DTL-PRC-9    (PV-SUB)  TO TFITPS-ITM-RTL-PRCE-AMT.  17230000
           MOVE ASC-DTL-QTY-9    (PV-SUB)  TO TFITPS-ITM-QTY.           17240000
           MOVE PC-PRICE-AND-UNIT          TO TFITPS-EXTL-SYS-PRCG-CDE. 17250000
           MOVE DP020-USERID               TO TFITPS-ADJ-BY-USR-ID.     17260000
           PERFORM WITH TEST AFTER                                      17270000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       17280000
               UNTIL SQLCODE = 0 OR                                     17290000
                     PV-RETRY-COUNT > PC-MAX-RETRIES                    17300000
                                                                        17310000
               EXEC SQL                                                 17320000
                    INSERT                                              17330000
                      INTO TTFITPS                                      17340000
                          (XFER_DKEY_ID                                 17350000
                         , XFER_LNE_NBR                                 17360000
                         , PSTG_SEQ_NBR                                 17370000
                         , ADJ_RSN_CDE                                  17380000
                         , ITM_PSTG_PRPD_TMST                           17390000
                         , FRM_PSTG_STR_NBR                             17400000
                         , TO_PSTG_STR_NBR                              17410000
                         , ITM_RTL_PRCE_AMT                             17420000
                         , ITM_QTY                                      17430000
                         , EXTL_SYS_PRCG_CDE                            17440000
                         , ADJ_BY_USR_ID)                               17450000
                    VALUES                                              17460000
                          (:TFITPS-XFER-DKEY-ID                         17470000
                           :PV-DKEY-IND                                 17480000
                         , :TFITPS-XFER-LNE-NBR                         17490000
                           :PV-LINE-IND                                 17500000
                         , :TFITPS-PSTG-SEQ-NBR                         17510000
                           :PV-PSTG-IND                                 17520000
                         , :TFITPS-ADJ-RSN-CDE                          17530000
                         ,  CURRENT TIMESTAMP                           17540000
                         , :TFITPS-FRM-PSTG-STR-NBR                     17550000
                         , :TFITPS-TO-PSTG-STR-NBR                      17560000
                         , :TFITPS-ITM-RTL-PRCE-AMT                     17570000
                         , :TFITPS-ITM-QTY                              17580000
                         , :TFITPS-EXTL-SYS-PRCG-CDE                    17590000
                         , :TFITPS-ADJ-BY-USR-ID)                       17600000
               END-EXEC                                                 17610000
                                                                        17620000
               EVALUATE TRUE                                            17630000
                   WHEN SQLCODE = 0                                     17640000
                   WHEN SQLCODE = -904                                  17650000
                   WHEN SQLCODE = -913                                  17660000
                        CONTINUE                                        17670000
                   WHEN OTHER                                           17680000
                        MOVE '7200-INSERT-REVERSE-ENTRY'                17690000
                                          TO DP013-PARAGRAPH            17700000
                        MOVE 'INSERT A ROW INTO THE TTFITPS TABLE'      17710000
                                          TO DP013-MESSAGE-TEXT(1)      17720000
                        MOVE SQLCA        TO DP013-SQLCA                17730000
                        MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)   17740000
                        SET DP013-DB2-ABEND                             17750000
                            DP013-XCTL-DISPLAY-RESTART TO TRUE          17760000
                        PERFORM DP013-0000-PROCESS-ABEND                17770000
               END-EVALUATE                                             17780000
           END-PERFORM.                                                 17790000
                                                                        17800000
           IF PV-RETRY-COUNT > PC-MAX-RETRIES AND                       17810000
              SQLCODE NOT = 0                                           17820000
               MOVE '7200-INSERT-REVERSE-ENTRY' TO DP013-PARAGRAPH      17830000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT'     17840000
                                          TO DP013-MESSAGE-TEXT (1)     17850000
               MOVE 'A TRANSFER POSTING'  TO DP013-MESSAGE-TEXT (2)     17860000
               MOVE SQLCA                 TO DP013-SQLCA                17870000
               MOVE 'TTFITPS'             TO DP013-DB2-TABLE-NAME (1)   17880000
               SET DP013-DB2-ABEND                                      17890000
                   DP013-XCTL-DISPLAY-RESTART                           17900000
                                          TO TRUE                       17910000
               PERFORM DP013-0000-PROCESS-ABEND                         17920000
           END-IF.                                                      17930000
       EJECT                                                            17940000
051705*----------------------------------------------------------------*17950000
051705*    GET THE PHYSICAL INVENTORY PERIOD INDICATOR FROM TTFCNTL    *17960000
051705*----------------------------------------------------------------*17970000
051705*7300-READ-CONTROL-TABLE.                                         17980000
051705*    PERFORM                                                      17990000
051705*        WITH TEST AFTER                                          18000000
051705*        VARYING PV-RETRY-COUNT                                   18010000
051705*        FROM 1 BY 1                                              18020000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 18030000
051705*            OR (SQLCODE = +0))                                   18040000
051705*        EXEC SQL                                                 18050000
051705*            SELECT PHY_INV_PERD_IND                              18060000
051705*                  ,XFER_INV_CTOFF_DTE                            18070000
051705*                  ,MAX_PLND_INV_DTE                              18080000
051705*                  ,MAX_FINCL_BK_DTE                              18090000
051705*             INTO :TFCNTL-PHY-INV-PERD-IND                       18100000
051705*                 ,:TFCNTL-XFER-INV-CTOFF-DTE                     18110000
051705*                 ,:TFCNTL-MAX-PLND-INV-DTE                       18120000
051705*                 ,:TFCNTL-MAX-FINCL-BK-DTE                       18130000
051705*             FROM TTFCNTL                                        18140000
051705*        END-EXEC                                                 18150000
051705*        EVALUATE TRUE                                            18160000
051705*            WHEN SQLCODE = ZERO                                  18170000
051705*                  MOVE TFCNTL-PHY-INV-PERD-IND                   18180000
051705*                                    TO PV-PHY-INV-PERD-IND       18190000
051705*                  MOVE TFCNTL-XFER-INV-CTOFF-DTE                 18200000
051705*                                    TO PV-XFER-INV-CTOFF-DTE     18210000
051705*                  MOVE TFCNTL-MAX-PLND-INV-DTE                   18220000
051705*                                    TO PV-MAX-PLND-INV-DTE       18230000
051705*                  MOVE TFCNTL-MAX-FINCL-BK-DTE                   18240000
051705*                                    TO PV-MAX-FINCL-BK-DTE       18250000
051705*            WHEN SQLCODE = -904                                  18260000
051705*            WHEN SQLCODE = -913                                  18270000
051705*                CONTINUE                                         18280000
051705*            WHEN OTHER                                           18290000
051705*                MOVE '7300-READ-CONTROL-TABLE'                   18300000
051705*                                  TO DP013-PARAGRAPH             18310000
051705*                MOVE 'GET THE PHYSICAL INV. PERIOD INDICATOR'    18320000
051705*                                      TO DP013-MESSAGE-TEXT (1)  18330000
051705*                MOVE SQLCA            TO DP013-SQLCA             18340000
051705*                MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)18350000
051705*                SET DP013-DB2-ABEND                              18360000
051705*                DP013-XCTL-DISPLAY-RESTART                       18370000
051705*                                     TO TRUE                     18380000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 18390000
051705*        END-EVALUATE                                             18400000
051705*    END-PERFORM.                                                 18410000
051705*                                                                 18420000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          18430000
051705*                MOVE '7300-READ-CONTROL-TABLE'                   18440000
051705*                                  TO DP013-PARAGRAPH             18450000
051705*                MOVE 'MAX RETRIES EXCEEDED READING '             18460000
051705*                                      TO DP013-MESSAGE-TEXT (1)  18470000
051705*                MOVE SQLCA            TO DP013-SQLCA             18480000
051705*                MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)18490000
051705*                SET DP013-DB2-ABEND                              18500000
051705*                DP013-XCTL-DISPLAY-RESTART                       18510000
051705*                                     TO TRUE                     18520000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 18530000
051705*    END-IF.                                                      18540000
051705*EJECT                                                            18550000
051705*----------------------------------------------------------------*18560000
051705*    GET THE MAX PLANNED INVENTORY DATE FOR THIS STORE           *18570000
051705*----------------------------------------------------------------*18580000
051705*7400-GET-STR-PLND-INV-DTE.                                       18590000
051705*    PERFORM                                                      18600000
051705*        WITH TEST AFTER                                          18610000
051705*        VARYING PV-RETRY-COUNT                                   18620000
051705*        FROM 1 BY 1                                              18630000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 18640000
051705*            OR (SQLCODE = +0)                                    18650000
051705*            OR (SQLCODE = +100))                                 18660000
051705*        EXEC SQL                                                 18670000
051705*            SELECT A.PLND_INV_DTE                                18680000
051705*                  ,A.ACTL_FIN_BK_DTE                             18690000
051705*                  ,A.SCHD_PHY_CNT_IND                            18700000
051705*             INTO :INVPAR-PLND-INV-DTE                           18710000
051705*                 ,:INVPAR-ACTL-FIN-BK-DTE                        18720000
051705*                 ,:INVPAR-SCHD-PHY-CNT-IND                       18730000
051705*             FROM TINVPAR A                                      18740000
051705*            WHERE  A.LOC_NBR    = :DK-STORE-NBR-9        AND     18750000
051705*                   A.PLND_INV_DTE < :PC-MAX-DATE                 18760000
051705*              AND  A.PLND_INV_DTE =                              18770000
051705*                   (SELECT MAX(PLND_INV_DTE)                     18780000
051705*                     FROM TINVPAR B                              18790000
051705*                    WHERE  B.LOC_NBR    = :DK-STORE-NBR-9    AND 18800000
051705*                           B.ACTL_FIN_BK_DTE = :PC-MAX-DATE  AND 18810000
051705*                           PLND_INV_DTE < :PC-MAX-DATE)          18820000
051705*        END-EXEC                                                 18830000
051705*        EVALUATE TRUE                                            18840000
051705*            WHEN SQLCODE = ZERO                                  18850000
051705*                IF INVPAR-SCHD-PHY-CNT-IND = PC-YES              18860000
051705*                    SET PV-HOLD-PHYSICAL-COUNT TO TRUE           18870000
051705*                ELSE                                             18880000
051705*                    IF INVPAR-ACTL-FIN-BK-DTE = PC-MAX-DATE      18890000
051705*                        SET PV-HOLD-FAKE-INVENTORY   TO TRUE     18900000
051705*                    ELSE                                         18910000
051705*                        SET PV-HOLD-NO-INVENTORY   TO TRUE       18920000
051705*                    END-IF                                       18930000
051705*                END-IF                                           18940000
051705*            WHEN SQLCODE = +100                                  18950000
051705*                MOVE PV-CURRENT-DATE TO INVPAR-PLND-INV-DTE      18960000
051705*                SET PV-HOLD-NO-INVENTORY   TO TRUE               18970000
051705*            WHEN SQLCODE = -904                                  18980000
051705*            WHEN SQLCODE = -913                                  18990000
051705*                CONTINUE                                         19000000
051705*            WHEN OTHER                                           19010000
051705*                MOVE '7400-GET-STR-PLND-INV-DTE'                 19020000
051705*                                  TO DP013-PARAGRAPH             19030000
051705*                MOVE 'GET THE PLANNED INVENTORY DATE FOR STORE:' 19040000
051705*                                      TO DP013-MESSAGE-TEXT (1)  19050000
051705*                MOVE DK-STORE-NBR-9                              19060000
051705*                                      TO DP013-MESSAGE-TEXT (2)  19070000
051705*                MOVE SQLCA            TO DP013-SQLCA             19080000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)19090000
051705*                SET DP013-DB2-ABEND                              19100000
051705*                DP013-XCTL-DISPLAY-RESTART                       19110000
051705*                                     TO TRUE                     19120000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 19130000
051705*        END-EVALUATE                                             19140000
051705*    END-PERFORM.                                                 19150000
051705*                                                                 19160000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          19170000
051705*                MOVE '7400-GET-STR-PLND-INV-DTE'                 19180000
051705*                                  TO DP013-PARAGRAPH             19190000
051705*                MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'   19200000
051705*                                      TO DP013-MESSAGE-TEXT (1)  19210000
051705*                MOVE DK-STORE-NBR-9                              19220000
051705*                                      TO DP013-MESSAGE-TEXT (2)  19230000
051705*                MOVE SQLCA            TO DP013-SQLCA             19240000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)19250000
051705*                SET DP013-DB2-ABEND                              19260000
051705*                DP013-XCTL-DISPLAY-RESTART                       19270000
051705*                                     TO TRUE                     19280000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 19290000
051705*    END-IF.                                                      19300000
051705*----------------------------------------------------------------*19310000
051705*    GET THE MAX XFER INVENTORY CUTOFF DATE FOR THIS STORE       *19320000
051705*----------------------------------------------------------------*19330000
051705*7800-GET-STORE-XFER-CTOFF-DTE.                                   19340000
051705*    PERFORM                                                      19350000
051705*        WITH TEST AFTER                                          19360000
051705*        VARYING PV-RETRY-COUNT                                   19370000
051705*        FROM 1 BY 1                                              19380000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 19390000
051705*            OR (SQLCODE = +0)                                    19400000
051705*            OR (SQLCODE = +100))                                 19410000
051705*        EXEC SQL                                                 19420000
051705*            SELECT MAX(XFER_INV_CTOFF_DTE)                       19430000
051705*                INTO :INVPAR-XFER-INV-CTOFF-DTE                  19440000
051705*                     :PV-NULL-IND                                19450000
051705*                FROM TINVPAR                                     19460000
051705*                WHERE  LOC_NBR    = :DK-STORE-NBR-9              19470000
051705*        END-EXEC                                                 19480000
051705*        EVALUATE TRUE                                            19490000
051705*            WHEN SQLCODE = ZERO                                  19500000
051705*            WHEN SQLCODE = -904                                  19510000
051705*            WHEN SQLCODE = -913                                  19520000
051705*                CONTINUE                                         19530000
051705*            WHEN SQLCODE = +100                                  19540000
051705*                MOVE PC-MIN-DATE   TO INVPAR-XFER-INV-CTOFF-DTE  19550000
051705*            WHEN OTHER                                           19560000
051705*                MOVE '7800-GET-STORE-XFER-CTOFF-DTE'             19570000
051705*                                  TO DP013-PARAGRAPH             19580000
051705*                MOVE 'GET THE TRANSFER CUTOFF DATE FOR STORE:'   19590000
051705*                                      TO DP013-MESSAGE-TEXT (1)  19600000
051705*                MOVE DK-STORE-NBR-9                              19610000
051705*                                      TO DP013-MESSAGE-TEXT (2)  19620000
051705*                MOVE SQLCA            TO DP013-SQLCA             19630000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)19640000
051705*                SET DP013-DB2-ABEND                              19650000
051705*                DP013-XCTL-DISPLAY-RESTART                       19660000
051705*                                     TO TRUE                     19670000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 19680000
051705*        END-EVALUATE                                             19690000
051705*    END-PERFORM.                                                 19700000
051705*                                                                 19710000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          19720000
051705*                MOVE '7800-GET-STORE-XFER-CTOFF-DTE'             19730000
051705*                                  TO DP013-PARAGRAPH             19740000
051705*                MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'   19750000
051705*                                      TO DP013-MESSAGE-TEXT (1)  19760000
051705*                MOVE DK-STORE-NBR-9                              19770000
051705*                                      TO DP013-MESSAGE-TEXT (2)  19780000
051705*                MOVE SQLCA            TO DP013-SQLCA             19790000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)19800000
051705*                SET DP013-DB2-ABEND                              19810000
051705*                DP013-XCTL-DISPLAY-RESTART                       19820000
051705*                                     TO TRUE                     19830000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 19840000
051705*    END-IF.                                                      19850000
051705*    IF PV-NULL-IND < 0                                           19860000
051705*        MOVE PC-MIN-DATE             TO INVPAR-XFER-INV-CTOFF-DTE19870000
051705*    END-IF.                                                      19880000
      *----------------------------------------------------------------*19890000
      * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *19900000
      *----------------------------------------------------------------*19910000
                                                                        19920000
       9100-READ-SEL-QUEUE-IN.                                          19930000
           EXEC CICS                                                    19940000
               READQ TS                                                 19950000
                   QUEUE (ASC-SEL-QUEUE-IN-NAME)                        19960000
                   INTO  (TF004-TRANSFER-SEL-REC)                       19970000
                   ITEM  (ASC-SEL-ITEM)                                 19980000
                   RESP  (PV-CICS-RESP)                                 19990000
           END-EXEC.                                                    20000000
                                                                        20010000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20020000
               CONTINUE                                                 20030000
           ELSE                                                         20040000
               SET DP013-LOGIC-ABEND                                    20050000
                   DP013-NO-ROLLBACK     TO TRUE                        20060000
               MOVE '9100-READ-SEL-QUEUE-IN'                            20070000
                                         TO DP013-PARAGRAPH             20080000
               MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   20090000
                                         TO DP013-MESSAGE-TEXT (1)      20100000
               PERFORM DP013-0000-PROCESS-ABEND                         20110000
           END-IF.                                                      20120000
      *----------------------------------------------------------------*20130000
      * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *20140000
      *----------------------------------------------------------------*20150000
       9200-REWRITE-SEL-QUEUE-IN.                                       20160000
           EXEC CICS                                                    20170000
                WRITEQ TS                                               20180000
                    QUEUE  (ASC-SEL-QUEUE-IN-NAME)                      20190000
                    FROM   (TF004-TRANSFER-SEL-REC)                     20200000
                    ITEM   (ASC-SEL-ITEM)                               20210000
                    RESP   (PV-CICS-RESP)                               20220000
                    REWRITE                                             20230000
           END-EXEC.                                                    20240000
                                                                        20250000
           IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   20260000
               SET DP013-CICS-ABEND                                     20270000
                   DP013-NO-ROLLBACK     TO TRUE                        20280000
               MOVE '9200-REWRITE-SEL-QUEUE-IN'                         20290000
                                         TO DP013-PARAGRAPH             20300000
               MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20310000
                                         TO DP013-MESSAGE-TEXT (1)      20320000
               PERFORM DP013-0000-PROCESS-ABEND                         20330000
           END-IF.                                                      20340000
                                                                        20350000
       EJECT                                                            20360000
      *----------------------------------------------------------------*20370000
      *    ABEND PROCESSOR MODULE                                      *20380000
      *----------------------------------------------------------------*20390000
                                                                        20400000
           COPY DPPD013.                                                20410000
