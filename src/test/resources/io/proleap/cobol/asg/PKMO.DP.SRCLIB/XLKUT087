000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.    XLKUT087.                                         00040001
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  03-2005.                                          00070001
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000*        UPC VALIDATION MODULE                                   *00100001
001100*    THIS PROGRAM CAN BE CALLED IN BATCH AND IN CICS AND NEEDS   *00110001
001200*    TO BE COMPILED EACH WAY AND TWO MOVES MADE TO PRODUCTION    *00120001
001300*    (ONE BATCH & ONE ON-LINE).  THE PROGRAM EXPECTS A UPC       *00130001
001400*    NUMBER AS INPUT & RETURNS SEVERAL RELATED FIELDS BACK.      *00140001
001500******************************************************************00150001
001500* CHANGE LOG:                                                    *00150151
001500* 02/14/2023   JEAN KURK           CHG0281369                    *00150251
001500*              CHANGE CALL TO UPC CHECK DIGIT ROUTINE TO BE      *00150352
001500*              DYNAMIC INSTEAD OF STATIC                         *00150452
001500*                                                                *00150552
001500******************************************************************00151051
001600 ENVIRONMENT DIVISION.                                            00160001
001700******************************************************************00170001
001800 DATA DIVISION.                                                   00180001
001900 WORKING-STORAGE SECTION.                                         00190001
002000 01  WS-WORKING-STOAGE-VALUE     PIC X(35) VALUE                  00200001
002100         '*** WORKING STORAGE STARTS HERE ***'.                   00210001
002200                                                                  00220001
002300 01  DK-FIELDS.                                                   00230002
002400     05  DK-UPC                          PIC  S9(15)V COMP-3.     00240002
002500                                                                  00250002
002600 01  PV-PROGRAM-VARIABLES.                                        00260002
002700     05  PV-CICS-MSG-AREA                PIC  X(128) VALUE SPACE. 00270046
002800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00280046
002900                                                     COMP SYNC.   00290046
003000     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00300046
003100                                                     COMP SYNC.   00310046
003200     05  PV-LEADING-0-COUNT              PIC S9(04)  VALUE ZERO   00320002
003300                                                     COMP.        00330001
003400     05  PV-UPC-LENGTH                   PIC S9(04)  VALUE ZERO   00340001
003500                                                     COMP.        00350001
003600     05  PV-UPC-X.                                                00360040
003700         10  PV-UPC-NUM                  PIC  9(18).              00370040
003800     05  PV-UPC-LENGTH-DISP              PIC  9(04).              00380015
003900     05  PV-UPC-E                        PIC  9(06)  VALUE ZERO.  00390001
004000     05  PV-EXPANDED-UPC-A-12.                                    00400043
004100         10  PV-EXPANDED-UPC-A           PIC  9(12).              00410043
004200     05  PV-SAVE-CHECK-DIGIT             PIC  X(01).              00420032
004300     05  PV-UPC-18.                                               00430013
004400         10  PV-UPC-1                    PIC  X(01).              00440013
004500         10  PV-UPC-17                   PIC  X(17).              00450013
004600     05  FILLER REDEFINES PV-UPC-18.                              00460013
004700         10  PV-UPC-FIRST-17             PIC  X(17).              00470013
004800         10  FILLER                      PIC  X(01).              00480013
004900                                                                  00490001
005000 01  PS-PROGRAM-SWITCHES.                                         00500001
005100     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00510001
005200         88  PS-ERROR-NO                             VALUE 'N'.   00520002
005300         88  PS-ERROR-YES                            VALUE 'Y'.   00530002
005400     05  PS-UPC-ON-DATABASE-SW           PIC  X(01)  VALUE 'N'.   00540001
005500         88  PS-UPC-ON-DATABASE-NO                   VALUE 'N'.   00550001
005600         88  PS-UPC-ON-DATABASE-YES                  VALUE 'Y'.   00560001
005700*  WORKING STORAGE NEEDED TO CONVERT A COMPACTED UPC (UPC-E) TO   00570001
005800*  A "NORMAL" UPC (UPC-A) INCLUDING THE EXPANSION MASKS           00580001
005900 01  UW-UPC-WORK-AREA.                                            00590001
006000     05  UW-UPC-E-DATA-DIGITS    PIC X(6)     VALUE SPACES.       00600001
006100     05  UW-UPC-E-DATA-DIGIT     REDEFINES UW-UPC-E-DATA-DIGITS   00610001
006200                                 OCCURS 6 TIMES                   00620001
006300                                 INDEXED BY UW-UPC-E-INDEX        00630001
006400                                 PIC X(1).                        00640001
006500     05  FILLER                  REDEFINES UW-UPC-E-DATA-DIGITS.  00650001
006600         10  FILLER              PIC X(5).                        00660001
006700         10  UW-UPC-E-COMPRESSION-FORMAT                          00670001
006800                                 PIC X(1).                        00680001
006900             88  UW-UPC-E-COMPRESSION-FORMAT-1                    00690001
007000                                              VALUE '0', '1', '2'.00700001
007100             88  UW-UPC-E-COMPRESSION-FORMAT-2                    00710001
007200                                              VALUE '3'.          00720001
007300             88  UW-UPC-E-COMPRESSION-FORMAT-3                    00730001
007400                                              VALUE '4'.          00740001
007500             88  UW-UPC-E-COMPRESSION-FORMAT-4                    00750001
007600                                              VALUE '5', '6', '7',00760001
007700                                                    '8', '9'.     00770001
007800     05  UW-UPC-A                PIC X(12)    VALUE SPACES.       00780001
007900     05  UW-UPC-A-DIGIT          REDEFINES UW-UPC-A               00790001
008000                                 OCCURS 12 TIMES                  00800001
008100                                 INDEXED BY UW-UPC-A-INDEX        00810001
008200                                 PIC X(1).                        00820001
008300                                                                  00830001
008400*    EXPANSION MASKS:  THESE MASKS HAVE 6 NUMBERS REPRESENTING THE00840001
008500*    DIGITS OF A UPC-E NUMBER.  EACH NUMBER IN THE MASK REPRESENTS00850001
008600*    POSITION OF THE UPC-A IT IS SUPPOSED TO TAKE.  IE...THE FIRST00860001
008700*    '02 03 09 10 11 04 ' TELLS THE EXPANSION ROUTINE THE FOLLOING00870001
008800*                                                                 00880001
008900*     POS 1 OF UPC-E    GOES TO    POS 02 OF UPC-A                00890001
009000*     POS 2 OF UPC-E    GOES TO    POS 03 OF UPC-A                00900001
009100*     POS 3 OF UPC-E    GOES TO    POS 09 OF UPC-A                00910001
009200*     POS 4 OF UPC-E    GOES TO    POS 10 OF UPC-A                00920001
009300*     POS 5 OF UPC-E    GOES TO    POS 11 OF UPC-A                00930001
009400*     POS 6 OF UPC-E    GOES TO    POS 04 OF UPC-A                00940001
009500 01  UE-UPC-E-TO-UPC-A-MASK-AREA.                                 00950001
009600     05  UE-UPC-E-TO-UPC-A-MASK-DATA.                             00960001
009700         10  FILLER              PIC X(18)    VALUE               00970001
009800             '02 03 09 10 11 04 '.                                00980001
009900         10  FILLER              PIC X(18)    VALUE               00990001
010000             '02 03 04 10 11 00 '.                                01000001
010100         10  FILLER              PIC X(18)    VALUE               01010001
010200             '02 03 04 05 11 00 '.                                01020001
010300         10  FILLER              PIC X(18)    VALUE               01030001
010400             '02 03 04 05 06 11 '.                                01040001
010500     05  UE-UPC-E-TO-UPC-A-MASK-TABLE                             01050001
010600                                 REDEFINES                        01060001
010700                                     UE-UPC-E-TO-UPC-A-MASK-DATA. 01070001
010800         10  UE-UPC-E-TO-UPC-A-MASK-ENTRY                         01080001
010900                                 OCCURS 4 TIMES                   01090001
011000                                 INDEXED BY UE-MASK-INDEX.        01100001
011100             15  UE-UPC-E-DIGIT-LOCATION-ENTRY                    01110001
011200                                 OCCURS 6 TIMES                   01120001
011300                                 INDEXED BY UE-LOCATION-INDEX.    01130001
011400                 20  UE-UPC-E-DIGIT-LOC-IN-UPC-A                  01140001
011500                                 PIC 9(2).                        01150001
011600                     88  UE-UPC-E-DIGIT-NOT-IN-UPC-A              01160001
011700                                              VALUE 00.           01170001
011800                 20  FILLER      PIC X(1).                        01180001
011900                                                                  01190001
012000 01  PC-PROGRAM-CONSTANTS.                                        01200001
012100     05  PC-CURRENT-PROGRAM-NAME PIC X(08) VALUE 'XLKUT087'.      01210001
012200     05  PC-MAXIMUM-UPC-FIELD-LENGTH     PIC S9(4)    VALUE +18.  01220001
012300     05  PC-MAXIMUM-UPC-E-DATA-DIGITS    PIC S9(4)    VALUE +6.   01230001
012400     05  PC-UPC-E-TO-UPC-A-MASK-1        PIC S9(4)    VALUE +1.   01240001
012500     05  PC-UPC-E-TO-UPC-A-MASK-2        PIC S9(4)    VALUE +2.   01250001
012600     05  PC-UPC-E-TO-UPC-A-MASK-3        PIC S9(4)    VALUE +3.   01260001
012700     05  PC-UPC-E-TO-UPC-A-MASK-4        PIC S9(4)    VALUE +4.   01270001
012800                                                                  01280001
012900 01  NI-NULL-INDICATORS.                                          01290001
013000     05  NI-REPLT-STR-NBR        PIC S9(4) VALUE +0 COMP.         01300001
013100     05  NI-DIST-NBR             PIC S9(4) VALUE +0 COMP.         01310001
013200     05  NI-STR-FMT-CDE          PIC S9(4) VALUE +0 COMP.         01320001
013300     05  NI-STD-TM-ZN-CDE        PIC S9(4) VALUE +0 COMP.         01330001
013400     05  NI-LOC-10-ABBR-NM       PIC S9(4) VALUE +0 COMP.         01340001
013500     05  NI-PHN-NBR              PIC S9(4) VALUE +0 COMP.         01350001
013600     05  NI-MGR-NM               PIC S9(4) VALUE +0 COMP.         01360001
013700     05  NI-FINCL-CLO-DTE        PIC S9(4) VALUE +0 COMP.         01370001
013800     05  NI-MN-SLS-INCL-DTE      PIC S9(4) VALUE +0 COMP.         01380001
013900     05  NI-YR-SLS-INCL-DTE      PIC S9(4) VALUE +0 COMP.         01390001
014000     05  NI-OCPNC-DTE            PIC S9(4) VALUE +0 COMP.         01400001
014100     05  NI-POS-RGST-BNK-QTY     PIC S9(4) VALUE +0 COMP.         01410001
014200     05  NI-DST-IND              PIC S9(4) VALUE +0 COMP.         01420001
014300     05  NI-E-BUS-IND            PIC S9(4) VALUE +0 COMP.         01430001
014400     05  NI-SLS-INCL-DTE-CDE     PIC S9(4) VALUE +0 COMP.         01440001
014500     05  NI-TOT-SLG-SQ-FTG-QTY   PIC S9(4) VALUE +0 COMP.         01450001
014600     05  NI-TOT-SQ-FTG-QTY       PIC S9(4) VALUE +0 COMP.         01460001
014700     05  NI-STP-ORD-DAYS-QTY     PIC S9(4) VALUE +0 COMP.         01470001
014800     05  NI-STRT-ORD-DAYS-QTY    PIC S9(4) VALUE +0 COMP.         01480001
014900     05  NI-ACQR-DTE             PIC S9(4) VALUE +0 COMP.         01490001
015000     05  NI-RMDL-DTE             PIC S9(4) VALUE +0 COMP.         01500001
015100     05  NI-MEDN-AGE-NBR         PIC S9(4) VALUE +0 COMP.         01510001
015200     05  NI-EST-HH-INCM-AMT      PIC S9(4) VALUE +0 COMP.         01520001
015300     05  NI-QTR-SLS-INCL-DTE     PIC S9(4) VALUE +0 COMP.         01530001
015400     05  NI-SEA-SLS-INCL-DTE     PIC S9(4) VALUE +0 COMP.         01540001
015500     05  NI-EXTD-MALL-NM         PIC S9(4) VALUE +0 COMP.         01550001
015600     05  NI-GRND-OPN-DTE         PIC S9(4) VALUE +0 COMP.         01560001
015700     05  NI-DIRNS-TXT            PIC S9(4) VALUE +0 COMP.         01570001
015800     05  NI-PRCHG-CRE-IND        PIC S9(4) VALUE +0 COMP.         01580001
015900     05  NI-IN-STR-PRCHG-IND     PIC S9(4) VALUE +0 COMP.         01590001
016000     05  NI-ASGMT-PO-DTE         PIC S9(4) VALUE +0 COMP.         01600001
016100                                                                  01610001
016200 01  PV-PROGRAM-VARIABLES.                                        01620001
016300     05  PV-LOC-NBR              PIC 9(04).                       01630001
016400     05  PV-SQLCODE              PIC S9(9).                       01640001
016500     05  PV-DISPLAY-SQLCODE      PIC -------999.                  01650001
016600     05  PV-INIT-DATE            PIC X(10) VALUE '9999-09-09'.    01660001
016700     05  PV-STOP-DATE            PIC X(10) VALUE '9999-99-09'.    01670001
016800                                                                  01680002
016900******************************************************************01690002
017000*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01700002
017100*****************************************************************.01710002
017200     COPY DPWS010I.                                               01720002
017300                                                                  01730002
017400******************************************************************01740002
017500*  SENDING/RECEIVING AREA FOR THE UPC CHECK DIGIT ROUTINE         01750002
017600******************************************************************01760002
017700     COPY DPWS040I.                                               01770002
017800                                                                  01780002
017900******************************************************************01790001
018000*  COMMUNICATIONS AREA FOR DB2                                    01800001
018100******************************************************************01810001
018200     EXEC SQL                                                     01820001
018300         INCLUDE SQLCA                                            01830001
018400     END-EXEC.                                                    01840001
018500                                                                  01850001
018600******************************************************************01860001
018700* DCLGENS OF ASSOCIATED UPC TABLES.                               01870001
018800******************************************************************01880001
018900*XLT_UPC                                                          01890048
019000     EXEC SQL                                                     01900001
019100         INCLUDE XLT00006                                         01910001
019200     END-EXEC.                                                    01920001
019300                                                                  01930001
019400******************************************************************01940001
019500 LINKAGE SECTION.                                                 01950001
019600     COPY XLWS087.                                                01960001
019700******************************************************************01970001
019800 PROCEDURE DIVISION USING XL087-RECORD.                           01980002
019900******************************************************************01990001
020000 0000-MAIN-MODULE.                                                02000001
020100                                                                  02010001
020200     INITIALIZE XL087-RETURN-CODE-DATA                            02020001
020300                XL087-RETURN-INFORMATION.                         02030001
020400     SET XL087-CALL-SUCCESSFUL   TO TRUE.                         02040014
020500     SET XL087-15-VALID-CK-DIGIT-NO                               02050049
020600         XL087-14-VALID-CK-DIGIT-NO                               02060049
020700         XL087-13-VALID-CK-DIGIT-NO                               02070022
020800         XL087-12-VALID-CK-DIGIT-NO                               02080022
020900         XL087-15-VALID-UPC-NO                                    02090049
021000         XL087-14-VALID-UPC-NO                                    02100049
021100         XL087-13-VALID-UPC-NO                                    02110022
021200         XL087-12-VALID-UPC-NO                                    02120022
021300         PS-ERROR-NO                  TO TRUE.                    02130022
021400                                                                  02140001
021500     PERFORM 1000-VALIDATE-NUMERIC.                               02150001
021600     IF PS-ERROR-NO                                               02160002
021700         PERFORM 1100-DETERMINE-LENGTH                            02170001
021800         IF PS-ERROR-NO                                           02180002
021900             PERFORM 1200-DETERMINE-UPC-TYPE                      02190001
022000             IF PS-ERROR-NO                                       02200002
022100                 PERFORM 1300-DETERMINE-FORMAT                    02210002
022200                 IF PS-ERROR-NO                                   02220002
022300                     PERFORM 1400-SET-RETURN-CODES                02230002
022400                 END-IF                                           02240002
022500             END-IF                                               02250002
022600         END-IF                                                   02260001
022700     END-IF.                                                      02270001
022800                                                                  02280001
022900     IF XL087-CALL-SUCCESSFUL                                     02290046
023000         IF (XL087-15-VALID-UPC-YES AND                           02300050
023100             XL087-14-VALID-UPC-YES)                              02310050
023200         OR (XL087-14-VALID-UPC-YES AND                           02320050
023300             XL087-13-VALID-UPC-YES)                              02330050
023400         OR (XL087-13-VALID-UPC-YES AND                           02340047
023500             XL087-12-VALID-UPC-YES)                              02350047
023600             MOVE SPACES    TO PV-CICS-MSG-AREA                   02360047
023700             STRING  ' XLKUT087 - MULTIPLE FOUND '                02370047
023800                     ' RETURNED UPC = ' XL087-RETURN-UPC          02380047
023900                     ' 15 UPC = ' XL087-15-UPC-SW                 02390050
024000                     ' 15 CKD = ' XL087-15-VALID-CK-DIGIT-SW      02400050
024100                     ' 14 UPC = ' XL087-14-UPC-SW                 02410050
024200                     ' 14 CKD = ' XL087-14-VALID-CK-DIGIT-SW      02420050
024300                                       DELIMITED BY SIZE          02430047
024400                                    INTO PV-CICS-MSG-AREA         02440047
024500             PERFORM 9990-WRITE-CSSL-MSG                          02450047
024600             MOVE SPACES    TO PV-CICS-MSG-AREA                   02460047
024700             STRING  ' XLKUT087 '                                 02470047
024800                     ' 13 UPC = ' XL087-13-UPC-SW                 02480047
024900                     ' 13 CKD = ' XL087-13-VALID-CK-DIGIT-SW      02490047
025000                     ' 12 UPC = ' XL087-12-UPC-SW                 02500047
025100                     ' 12 CKD = ' XL087-12-VALID-CK-DIGIT-SW      02510047
025200                     ' XL087-BARCODE-TYPE = ' XL087-BARCODE-TYPE  02520047
025300                                       DELIMITED BY SIZE          02530047
025400                                    INTO PV-CICS-MSG-AREA         02540047
025500             PERFORM 9990-WRITE-CSSL-MSG                          02550047
025600         END-IF                                                   02560047
025700     ELSE                                                         02570047
025800         EVALUATE TRUE                                            02580047
025900             WHEN XL087-NOT-FOUND                                 02590046
026000                 MOVE SPACES    TO PV-CICS-MSG-AREA               02600047
026100                 STRING ' XLKUT087 - NOT FOUND '                  02610046
026200                        XL087-UPC                                 02620046
026300                       ' RETURNED UPC =  ' XL087-RETURN-UPC       02630046
026400                                    DELIMITED BY SIZE             02640046
026500                                    INTO PV-CICS-MSG-AREA         02650046
026600                 PERFORM 9990-WRITE-CSSL-MSG                      02660046
026700             WHEN XL087-NOT-NUMERIC                               02670046
026800                 MOVE SPACES    TO PV-CICS-MSG-AREA               02680047
026900                 STRING ' XLKUT087 - NOT NUMERIC '                02690046
027000                        XL087-UPC                                 02700046
027100                       ' RETURNED UPC =  ' XL087-RETURN-UPC       02710046
027200                                    DELIMITED BY SIZE             02720046
027300                                    INTO PV-CICS-MSG-AREA         02730046
027400                 PERFORM 9990-WRITE-CSSL-MSG                      02740046
027500             WHEN XL087-BAD-CHECK-DIGIT                           02750046
027600                 MOVE SPACES    TO PV-CICS-MSG-AREA               02760047
027700                 STRING ' XLKUT087 - BAD CHECK DIGIT '            02770046
027800                        XL087-UPC                                 02780046
027900                       ' RETURNED UPC =  ' XL087-RETURN-UPC       02790046
028000                                    DELIMITED BY SIZE             02800046
028100                                    INTO PV-CICS-MSG-AREA         02810046
028200                 PERFORM 9990-WRITE-CSSL-MSG                      02820046
028300             WHEN XL087-INVALID-UPC-FORMAT                        02830046
028400                 MOVE SPACES    TO PV-CICS-MSG-AREA               02840047
028500                 STRING ' XLKUT087 - INVALID UPC FORMAT '         02850046
028600                        XL087-UPC                                 02860046
028700                       ' RETURNED UPC =  ' XL087-RETURN-UPC       02870046
028800                                    DELIMITED BY SIZE             02880046
028900                                    INTO PV-CICS-MSG-AREA         02890046
029000                 PERFORM 9990-WRITE-CSSL-MSG                      02900046
029100             WHEN XL087-DATABASE-CONTENTION                       02910046
029200                 MOVE SPACES    TO PV-CICS-MSG-AREA               02920047
029300                 STRING ' XLKUT087 - DATABASE CONTENTION '        02930046
029400                        XL087-UPC                                 02940046
029500                       ' RETURNED UPC =  ' XL087-RETURN-UPC       02950046
029600                                    DELIMITED BY SIZE             02960046
029700                                    INTO PV-CICS-MSG-AREA         02970046
029800                 PERFORM 9990-WRITE-CSSL-MSG                      02980046
029900             WHEN XL087-DB2-ERROR                                 02990046
030000                 MOVE SPACES    TO PV-CICS-MSG-AREA               03000047
030100                 STRING ' XLKUT087 - DB2 ERROR '                  03010046
030200                        XL087-UPC                                 03020046
030300                       ' RETURNED UPC =  ' XL087-RETURN-UPC       03030046
030400                                    DELIMITED BY SIZE             03040046
030500                                    INTO PV-CICS-MSG-AREA         03050046
030600                 PERFORM 9990-WRITE-CSSL-MSG                      03060046
030700         END-EVALUATE                                             03070046
030800     END-IF.                                                      03080046
030900                                                                  03090046
031000     GOBACK.                                                      03100001
031100                                                                  03110001
031200******************************************************************03120001
031300*  SELECT XLT_UPC ROW.                                           *03130001
031400******************************************************************03140001
031500 1000-VALIDATE-NUMERIC.                                           03150001
031600                                                                  03160001
031700     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         03170001
031800*    CHECK TO MAKE SURE THE UPC IS NUMERIC                        03180001
031900     MOVE XL087-UPC                  TO PV-UPC-18.                03190013
032000     IF PV-UPC-1 = '0'                                            03200013
032100         MOVE PV-UPC-17              TO DP010I-UNEDITED-FIELD     03210013
032200     ELSE                                                         03220013
032300         MOVE PV-UPC-FIRST-17        TO DP010I-UNEDITED-FIELD     03230013
032400     END-IF                                                       03240013
032500     MOVE 17                         TO DP010I-MAXIMUM-DIGITS.    03250012
032600     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03260001
032700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03270001
032800                                                                  03280001
032900     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03290001
033000                     USING DP010I-NUMERIC-EDIT-AREA.              03300001
033100                                                                  03310001
033200     IF  DP010I-ERROR-DETECTED                                    03320001
033300         SET XL087-NOT-NUMERIC                                    03330001
033400             PS-ERROR-YES         TO TRUE                         03340002
033500         MOVE '1000-VALIDATE-NUMERIC'  TO XL087-PARAGRAPH         03350005
033600         STRING 'ERROR-IND = '                                    03360006
033700              DP010I-ERROR-IND       DELIMITED BY SIZE            03370006
033800                                     INTO XL087-RETURN-MESSAGE    03380006
033900         STRING 'UPC = '                                          03390008
034000              XL087-UPC              DELIMITED BY SIZE            03400010
034100                                   INTO XL087-DATABASE            03410008
034200     ELSE                                                         03420001
034300         MOVE DP010I-NUM-FIELD-17-DIG-0-DEC                       03430040
034400                                     TO PV-UPC-NUM                03440040
034500         MOVE XL087-UPC              TO XL087-UPC-X               03450039
034600     END-IF.                                                      03460001
034700                                                                  03470001
034800                                                                  03480001
034900******************************************************************03490001
035000 1100-DETERMINE-LENGTH.                                           03500001
035100                                                                  03510001
035200     MOVE XL087-UPC                  TO XL087-UPC-CHECKER.        03520018
035300                                                                  03530001
035400*    DISPLAY ' XL087-UPC-X = ' XL087-UPC-X.                       03540037
035500     PERFORM VARYING XL087-SUB FROM 1 BY 1                        03550001
035600          UNTIL XL087-SUB > 18 OR                                 03560001
035700          PS-ERROR-YES                                            03570002
035800            EVALUATE TRUE                                         03580001
035900                WHEN XL087-UPC-CHAR (XL087-SUB) = ZERO            03590001
036000                WHEN XL087-UPC-CHAR (XL087-SUB) NUMERIC           03600001
036100                    MOVE '9'        TO XL087-UPC-CHAR (XL087-SUB) 03610001
036200                WHEN XL087-UPC-CHAR (XL087-SUB) = SPACES          03620001
036300                WHEN XL087-UPC-CHAR (XL087-SUB) = LOW-VALUES      03630001
036400                    MOVE 'B'        TO XL087-UPC-CHAR (XL087-SUB) 03640001
036500                WHEN OTHER                                        03650001
036600                    MOVE 'X'        TO XL087-UPC-CHAR (XL087-SUB) 03660001
036700                     SET XL087-NOT-NUMERIC                        03670001
036800                         PS-ERROR-YES         TO TRUE             03680002
036900                     MOVE '1100-DETERMINE-LENGTH'                 03690005
037000                                              TO XL087-PARAGRAPH  03700005
037100            END-EVALUATE                                          03710001
037200     END-PERFORM.                                                 03720001
037300                                                                  03730001
037400     IF XL087-VALID-UPC-FORMAT OR                                 03740001
037500        PS-ERROR-YES                                              03750002
037600*        DISPLAY ' XL087-UPC-CHECKER = ' XL087-UPC-CHECKER        03760037
037700         CONTINUE                                                 03770037
037800     ELSE                                                         03780001
037900         SET XL087-INVALID-UPC-FORMAT                             03790001
038000             PS-ERROR-YES         TO TRUE                         03800002
038100         MOVE '1100-DETERMINE-LENGTH'  TO XL087-PARAGRAPH         03810005
038200     END-IF.                                                      03820001
038300******************************************************************03830001
038400 1200-DETERMINE-UPC-TYPE.                                         03840001
038500     INITIALIZE PV-LEADING-0-COUNT.                               03850001
038600     INSPECT PV-UPC-X                                             03860040
038700         TALLYING PV-LEADING-0-COUNT                              03870001
038800           FOR LEADING '0'.                                       03880001
038900                                                                  03890001
039000     COMPUTE PV-UPC-LENGTH = (PC-MAXIMUM-UPC-FIELD-LENGTH -       03900001
039100                             PV-LEADING-0-COUNT).                 03910001
039200                                                                  03920001
039300     MOVE PV-UPC-LENGTH    TO PV-UPC-LENGTH-DISP.                 03930017
039400*    DISPLAY ' PV-UPC-LENGTH-DISP = ' PV-UPC-LENGTH-DISP.         03940037
039500     IF PV-UPC-LENGTH = 7                                         03950031
039600         MOVE PV-UPC-X ((PV-LEADING-0-COUNT + 1) : 6)             03960040
039700                           TO UW-UPC-E-DATA-DIGITS                03970026
039800         MOVE PV-UPC-X ((PV-LEADING-0-COUNT + 7) : 1)             03980040
039900                           TO PV-SAVE-CHECK-DIGIT                 03990032
040000         DISPLAY 'DATA DIGITS = ' UW-UPC-E-DATA-DIGITS            04000044
040100         DISPLAY 'CHECK DIGIT = ' PV-SAVE-CHECK-DIGIT             04010044
040200         PERFORM 1210-EXPAND-UPC-E-TO-UPC-A                       04020001
040300     END-IF.                                                      04030002
040400                                                                  04040001
040500 1210-EXPAND-UPC-E-TO-UPC-A.                                      04050001
040600*    DETERMINE WHICH EXPANSTION MASK TO USE.                      04060001
040700*    TYPE "F 'MASKS' FIRST" FOR MORE INFO                         04070001
040800     EVALUATE TRUE                                                04080001
040900         WHEN UW-UPC-E-COMPRESSION-FORMAT-1                       04090001
041000             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-1        04100001
041100         WHEN UW-UPC-E-COMPRESSION-FORMAT-2                       04110001
041200             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-2        04120001
041300         WHEN UW-UPC-E-COMPRESSION-FORMAT-3                       04130001
041400             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-3        04140001
041500         WHEN UW-UPC-E-COMPRESSION-FORMAT-4                       04150001
041600             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-4        04160001
041700     END-EVALUATE.                                                04170001
041800                                                                  04180001
041900     MOVE '000000000000'      TO UW-UPC-A.                        04190032
042000                                                                  04200001
042100*    MOVE EACH DIGIT OF UPC-E TO ITS CORRESPONDING POSITION IN    04210001
042200*    UPC-A (DEPENDING ON THE MASK)                                04220001
042300     PERFORM                                                      04230001
042400             VARYING UW-UPC-E-INDEX                               04240001
042500             FROM 1 BY 1                                          04250001
042600             UNTIL UW-UPC-E-INDEX > PC-MAXIMUM-UPC-E-DATA-DIGITS  04260001
042700         SET UE-LOCATION-INDEX TO UW-UPC-E-INDEX                  04270001
042800         IF (NOT UE-UPC-E-DIGIT-NOT-IN-UPC-A                      04280001
042900                               (UE-MASK-INDEX, UE-LOCATION-INDEX))04290001
043000             SET UW-UPC-A-INDEX TO                                04300001
043100                       UE-UPC-E-DIGIT-LOC-IN-UPC-A                04310001
043200                               (UE-MASK-INDEX, UE-LOCATION-INDEX) 04320001
043300             MOVE UW-UPC-E-DATA-DIGIT (UW-UPC-E-INDEX) TO         04330001
043400                       UW-UPC-A-DIGIT (UW-UPC-A-INDEX)            04340001
043500         END-IF                                                   04350001
043600     END-PERFORM.                                                 04360001
043700     MOVE PV-SAVE-CHECK-DIGIT   TO UW-UPC-A-DIGIT (12).           04370032
043800                                                                  04380001
043900     MOVE 0                TO PV-EXPANDED-UPC-A.                  04390032
044000     MOVE UW-UPC-A          TO XL087-EXPANDED-UPC-A               04400001
044100                               PV-EXPANDED-UPC-A-12.              04410043
044200     MOVE PV-EXPANDED-UPC-A TO XL087-UPC-12-DIGIT-NBR             04420043
044300                               XL087-UPC-12.                      04430040
044400     DISPLAY '1210- EXPANDED UPC = ' XL087-EXPANDED-UPC-A.        04440044
044500*    DISPLAY ' XL087-UPC-X = ' XL087-UPC-X.                       04450037
044600     SET XL087-UPC-E-6-TYPE  TO TRUE.                             04460021
044700     MOVE 12                 TO PV-UPC-LENGTH.                    04470001
044800     SET XL087-UPC-12-DIGIT  TO TRUE.                             04480001
044900                                                                  04490001
045000 1300-DETERMINE-FORMAT.                                           04500002
045100*    DISPLAY ' 1300- XL087-UPC-CHECKER = ' XL087-UPC-CHECKER.     04510037
045200     EVALUATE TRUE                                                04520001
045300         WHEN XL087-UPC-18-DIGIT                                  04530001
045400         WHEN XL087-UPC-17-DIGIT                                  04540001
045500         WHEN XL087-UPC-16-DIGIT                                  04550001
045600         WHEN XL087-UPC-15-DIGIT                                  04560001
045700*            DISPLAY ' UPC 18 - 15 '                              04570049
045800             INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS              04580049
045900             MOVE XL087-UPC-15-DIGIT-NBR   TO DP040I-UPC-CODE     04590049
046000             SET DP040I-COMP-CHECK-DIGIT-OPTION                   04600049
046100                                       TO TRUE                    04610049
046200             CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                  04620051
046200                             USING DP040I-UPC-CHECK-DIGIT-PARMS   04621051
046300             IF DP040I-NO-ERROR-DETECTED                          04630049
046400                 IF DP040I-UPC-CHECK-DIGIT =                      04640049
046500                                 DP040I-COMPUTED-UPC-CHK-DIGIT    04650049
046600                     MOVE DP040I-COMPUTED-UPC-CHK-DIGIT           04660049
046700                                   TO XL087-15-CHECK-DIGIT        04670049
046800                     SET XL087-15-VALID-CK-DIGIT-YES TO TRUE      04680049
046900                 ELSE                                             04690049
047000                     SET XL087-15-VALID-CK-DIGIT-NO  TO TRUE      04700049
047100                 END-IF                                           04710049
047200             ELSE                                                 04720049
047300                 SET XL087-15-VALID-CK-DIGIT-NO  TO TRUE          04730049
047400             END-IF                                               04740049
047500                                                                  04750049
047600             MOVE XL087-UPC-15-DIGIT-NBR   TO DK-UPC              04760049
047700             SET PS-UPC-ON-DATABASE-NO    TO TRUE                 04770049
047800             PERFORM 5000-CHECK-UPC-ON-TABLE                      04780049
047900             IF PS-UPC-ON-DATABASE-YES                            04790049
048000                 SET XL087-15-VALID-UPC-YES   TO TRUE             04800049
048100             ELSE                                                 04810049
048200                 SET XL087-15-VALID-UPC-NO    TO TRUE             04820049
048300             END-IF                                               04830049
048400                                                                  04840049
048500             IF PS-ERROR-NO                                       04850049
048600               INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS            04860049
048700               MOVE XL087-UPC-14-DIGIT-NBR   TO DP040I-UPC-CODE   04870049
048800               SET DP040I-COMP-CHECK-DIGIT-OPTION                 04880049
048900                                         TO TRUE                  04890049
049000               CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                04900051
049000                               USING DP040I-UPC-CHECK-DIGIT-PARMS 04901051
049100               IF DP040I-NO-ERROR-DETECTED                        04910049
049200                   IF DP040I-UPC-CHECK-DIGIT =                    04920049
049300                                   DP040I-COMPUTED-UPC-CHK-DIGIT  04930049
049400                       MOVE DP040I-COMPUTED-UPC-CHK-DIGIT         04940049
049500                                     TO XL087-14-CHECK-DIGIT      04950049
049600                       SET XL087-14-VALID-CK-DIGIT-YES TO TRUE    04960049
049700                   ELSE                                           04970049
049800                       SET XL087-14-VALID-CK-DIGIT-NO  TO TRUE    04980049
049900                   END-IF                                         04990049
050000               ELSE                                               05000049
050100                   SET XL087-14-VALID-CK-DIGIT-NO  TO TRUE        05010049
050200               END-IF                                             05020049
050300                                                                  05030049
050400               MOVE XL087-UPC-14-DIGIT-NBR   TO DK-UPC            05040049
050500               SET PS-UPC-ON-DATABASE-NO    TO TRUE               05050049
050600               PERFORM 5000-CHECK-UPC-ON-TABLE                    05060049
050700               IF PS-UPC-ON-DATABASE-YES                          05070049
050800                   SET XL087-14-VALID-UPC-YES   TO TRUE           05080049
050900               ELSE                                               05090049
051000                   SET XL087-14-VALID-UPC-NO    TO TRUE           05100049
051100               END-IF                                             05110049
051200                                                                  05120049
051300               IF PS-ERROR-NO                                     05130049
051400                 INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS          05140049
051500                 MOVE XL087-UPC-13-DIGIT-NBR   TO DP040I-UPC-CODE 05150049
051600                 SET DP040I-COMP-CHECK-DIGIT-OPTION               05160049
051700                                           TO TRUE                05170049
051800                 CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC              05180051
051900                             USING DP040I-UPC-CHECK-DIGIT-PARMS   05190051
052000                 IF DP040I-NO-ERROR-DETECTED                      05200049
052100                     IF DP040I-UPC-CHECK-DIGIT =                  05210049
052200                                 DP040I-COMPUTED-UPC-CHK-DIGIT    05220049
052300                         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT       05230049
052400                                       TO XL087-13-CHECK-DIGIT    05240049
052500                         SET XL087-13-VALID-CK-DIGIT-YES TO TRUE  05250049
052600                     ELSE                                         05260049
052700                         SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE  05270049
052800                     END-IF                                       05280049
052900                 ELSE                                             05290049
053000                     SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE      05300049
053100                 END-IF                                           05310049
053200                                                                  05320049
053300                 MOVE XL087-UPC-13-DIGIT-NBR  TO DK-UPC           05330049
053400                 SET PS-UPC-ON-DATABASE-NO    TO TRUE             05340049
053500                 PERFORM 5000-CHECK-UPC-ON-TABLE                  05350049
053600                 IF PS-UPC-ON-DATABASE-YES                        05360049
053700                     SET XL087-13-VALID-UPC-YES   TO TRUE         05370049
053800                 ELSE                                             05380049
053900                     SET XL087-13-VALID-UPC-NO    TO TRUE         05390049
054000                 END-IF                                           05400049
054100               END-IF                                             05410049
054200               IF PS-ERROR-NO                                     05420049
054300                   INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS        05430049
054400                   MOVE XL087-UPC-12-DIGIT-NBR TO DP040I-UPC-CODE 05440049
054500                   SET DP040I-COMP-CHECK-DIGIT-OPTION             05450049
054600                                                 TO TRUE          05460049
054700                   CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC            05470051
054800                              USING  DP040I-UPC-CHECK-DIGIT-PARMS 05480051
054900                   IF DP040I-NO-ERROR-DETECTED                    05490049
055000                       IF DP040I-UPC-CHECK-DIGIT =                05500049
055100                                   DP040I-COMPUTED-UPC-CHK-DIGIT  05510049
055200                           MOVE DP040I-COMPUTED-UPC-CHK-DIGIT     05520049
055300                                         TO XL087-12-CHECK-DIGIT  05530049
055400                           SET XL087-12-VALID-CK-DIGIT-YES TO TRUE05540049
055500                       ELSE                                       05550049
055600                           SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE05560049
055700                       END-IF                                     05570049
055800                   ELSE                                           05580049
055900                       SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE    05590049
056000                   END-IF                                         05600049
056100                                                                  05610049
056200                   MOVE XL087-UPC-12-DIGIT-NBR  TO DK-UPC         05620049
056300                   SET PS-UPC-ON-DATABASE-NO    TO TRUE           05630049
056400                   PERFORM 5000-CHECK-UPC-ON-TABLE                05640049
056500                   IF PS-UPC-ON-DATABASE-YES                      05650049
056600                       SET XL087-12-VALID-UPC-YES   TO TRUE       05660049
056700                   ELSE                                           05670049
056800                       SET XL087-12-VALID-UPC-NO    TO TRUE       05680049
056900                   END-IF                                         05690049
057000               END-IF                                             05700049
057100             END-IF                                               05710049
057200                                                                  05720049
057300         WHEN XL087-UPC-14-DIGIT                                  05730049
057400             INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS              05740001
057500             MOVE XL087-UPC-14-DIGIT-NBR   TO DP040I-UPC-CODE     05750003
057600             SET DP040I-COMP-CHECK-DIGIT-OPTION                   05760001
057700                                       TO TRUE                    05770001
057800             CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                  05780051
057800                             USING DP040I-UPC-CHECK-DIGIT-PARMS   05781051
057900             IF DP040I-NO-ERROR-DETECTED                          05790001
058000                 IF DP040I-UPC-CHECK-DIGIT =                      05800041
058100                                 DP040I-COMPUTED-UPC-CHK-DIGIT    05810041
058200                     MOVE DP040I-COMPUTED-UPC-CHK-DIGIT           05820041
058300                                   TO XL087-14-CHECK-DIGIT        05830001
058400                     SET XL087-14-VALID-CK-DIGIT-YES TO TRUE      05840041
058500                 ELSE                                             05850041
058600                     SET XL087-14-VALID-CK-DIGIT-NO  TO TRUE      05860041
058700                 END-IF                                           05870041
058800             ELSE                                                 05880041
058900                 SET XL087-14-VALID-CK-DIGIT-NO  TO TRUE          05890041
059000             END-IF                                               05900041
059100                                                                  05910001
059200             MOVE XL087-UPC-14-DIGIT-NBR   TO DK-UPC              05920003
059300             SET PS-UPC-ON-DATABASE-NO    TO TRUE                 05930001
059400             PERFORM 5000-CHECK-UPC-ON-TABLE                      05940001
059500             IF PS-UPC-ON-DATABASE-YES                            05950001
059600                 SET XL087-14-VALID-UPC-YES   TO TRUE             05960001
059700             ELSE                                                 05970001
059800                 SET XL087-14-VALID-UPC-NO    TO TRUE             05980024
059900             END-IF                                               05990001
060000                                                                  06000001
060100             IF PS-ERROR-NO                                       06010001
060200                 INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS          06020001
060300                 MOVE XL087-UPC-13-DIGIT-NBR   TO DP040I-UPC-CODE 06030003
060400                 SET DP040I-COMP-CHECK-DIGIT-OPTION               06040001
060500                                           TO TRUE                06050001
060600                 CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC              06060053
060700                            USING  DP040I-UPC-CHECK-DIGIT-PARMS   06070051
060800                 IF DP040I-NO-ERROR-DETECTED                      06080041
060900                     IF DP040I-UPC-CHECK-DIGIT =                  06090041
061000                                 DP040I-COMPUTED-UPC-CHK-DIGIT    06100041
061100                         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT       06110041
061200                                       TO XL087-13-CHECK-DIGIT    06120041
061300                         SET XL087-13-VALID-CK-DIGIT-YES TO TRUE  06130041
061400                     ELSE                                         06140041
061500                         SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE  06150041
061600                     END-IF                                       06160041
061700                 ELSE                                             06170041
061800                     SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE      06180041
061900                 END-IF                                           06190041
062000                                                                  06200001
062100                 MOVE XL087-UPC-13-DIGIT-NBR  TO DK-UPC           06210003
062200                 SET PS-UPC-ON-DATABASE-NO    TO TRUE             06220001
062300                 PERFORM 5000-CHECK-UPC-ON-TABLE                  06230001
062400                 IF PS-UPC-ON-DATABASE-YES                        06240001
062500                     SET XL087-13-VALID-UPC-YES   TO TRUE         06250001
062600                 ELSE                                             06260001
062700                     SET XL087-13-VALID-UPC-NO    TO TRUE         06270024
062800                 END-IF                                           06280001
062900             END-IF                                               06290001
063000             IF PS-ERROR-NO                                       06300001
063100                 INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS          06310001
063200                 MOVE XL087-UPC-12-DIGIT-NBR   TO DP040I-UPC-CODE 06320003
063300                 SET DP040I-COMP-CHECK-DIGIT-OPTION               06330001
063400                                               TO TRUE            06340003
063500                 CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC              06350051
063600                            USING  DP040I-UPC-CHECK-DIGIT-PARMS   06360051
063700                 IF DP040I-NO-ERROR-DETECTED                      06370041
063800                     IF DP040I-UPC-CHECK-DIGIT =                  06380041
063900                                 DP040I-COMPUTED-UPC-CHK-DIGIT    06390041
064000                         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT       06400041
064100                                       TO XL087-12-CHECK-DIGIT    06410041
064200                         SET XL087-12-VALID-CK-DIGIT-YES TO TRUE  06420041
064300                     ELSE                                         06430041
064400                         SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE  06440041
064500                     END-IF                                       06450041
064600                 ELSE                                             06460041
064700                     SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE      06470041
064800                 END-IF                                           06480041
064900                                                                  06490041
065000                 MOVE XL087-UPC-12-DIGIT-NBR  TO DK-UPC           06500003
065100                 SET PS-UPC-ON-DATABASE-NO    TO TRUE             06510001
065200                 PERFORM 5000-CHECK-UPC-ON-TABLE                  06520001
065300                 IF PS-UPC-ON-DATABASE-YES                        06530001
065400                     SET XL087-12-VALID-UPC-YES   TO TRUE         06540001
065500                 ELSE                                             06550001
065600                     SET XL087-12-VALID-UPC-NO    TO TRUE         06560024
065700                 END-IF                                           06570001
065800             END-IF                                               06580001
065900                                                                  06590001
066000         WHEN XL087-UPC-13-DIGIT                                  06600001
066100*            DISPLAY ' UPC 13'                                    06610037
066200             INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS              06620001
066300             MOVE XL087-UPC-13-DIGIT-NBR   TO DP040I-UPC-CODE     06630003
066400             SET DP040I-COMP-CHECK-DIGIT-OPTION                   06640001
066500                                           TO TRUE                06650003
066600             CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                  06660051
066700                       USING   DP040I-UPC-CHECK-DIGIT-PARMS       06670051
066800             IF DP040I-NO-ERROR-DETECTED                          06680041
066900                 IF DP040I-UPC-CHECK-DIGIT =                      06690041
067000                             DP040I-COMPUTED-UPC-CHK-DIGIT        06700041
067100                     MOVE DP040I-COMPUTED-UPC-CHK-DIGIT           06710041
067200                                   TO XL087-13-CHECK-DIGIT        06720041
067300                     SET XL087-13-VALID-CK-DIGIT-YES TO TRUE      06730041
067400                 ELSE                                             06740041
067500                     SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE      06750041
067600                 END-IF                                           06760041
067700             ELSE                                                 06770041
067800                 SET XL087-13-VALID-CK-DIGIT-NO  TO TRUE          06780041
067900             END-IF                                               06790041
068000                                                                  06800041
068100             MOVE XL087-UPC-13-DIGIT-NBR  TO DK-UPC               06810003
068200             SET PS-UPC-ON-DATABASE-NO    TO TRUE                 06820001
068300             PERFORM 5000-CHECK-UPC-ON-TABLE                      06830001
068400             IF PS-UPC-ON-DATABASE-YES                            06840001
068500                 SET XL087-13-VALID-UPC-YES   TO TRUE             06850001
068600             ELSE                                                 06860001
068700                 SET XL087-13-VALID-UPC-NO    TO TRUE             06870024
068800             END-IF                                               06880001
068900                                                                  06890001
069000             IF PS-ERROR-NO                                       06900001
069100                 INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS          06910001
069200                 MOVE XL087-UPC-12-DIGIT-NBR   TO DP040I-UPC-CODE 06920003
069300                 SET DP040I-COMP-CHECK-DIGIT-OPTION               06930001
069400                                               TO TRUE            06940003
069500                 CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC              06950051
069600                           USING   DP040I-UPC-CHECK-DIGIT-PARMS   06960051
069700                 IF DP040I-NO-ERROR-DETECTED                      06970041
069800                     IF DP040I-UPC-CHECK-DIGIT =                  06980041
069900                                 DP040I-COMPUTED-UPC-CHK-DIGIT    06990041
070000                         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT       07000041
070100                                       TO XL087-12-CHECK-DIGIT    07010041
070200                         SET XL087-12-VALID-CK-DIGIT-YES TO TRUE  07020041
070300                     ELSE                                         07030041
070400                         SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE  07040041
070500                     END-IF                                       07050041
070600                 ELSE                                             07060041
070700                     SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE      07070041
070800                 END-IF                                           07080041
070900                                                                  07090041
071000                 MOVE XL087-UPC-12-DIGIT-NBR   TO DK-UPC          07100003
071100                 SET PS-UPC-ON-DATABASE-NO     TO TRUE            07110003
071200                 PERFORM 5000-CHECK-UPC-ON-TABLE                  07120001
071300                 IF PS-UPC-ON-DATABASE-YES                        07130001
071400                     SET XL087-12-VALID-UPC-YES   TO TRUE         07140001
071500                 ELSE                                             07150001
071600                     SET XL087-12-VALID-UPC-NO    TO TRUE         07160024
071700                 END-IF                                           07170001
071800             END-IF                                               07180002
071900         WHEN OTHER                                               07190019
072000*            DISPLAY ' UPC OTHER'                                 07200037
072100*    DISPLAY ' XL087-UPC-X = ' XL087-UPC-X                        07210037
072200             INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS              07220019
072300             MOVE XL087-UPC-12-DIGIT-NBR   TO DP040I-UPC-CODE     07230019
072400             SET DP040I-COMP-CHECK-DIGIT-OPTION                   07240019
072500                                           TO TRUE                07250019
072600             CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                  07260053
072700                       USING   DP040I-UPC-CHECK-DIGIT-PARMS       07270051
072800             IF DP040I-NO-ERROR-DETECTED                          07280041
072900                 IF DP040I-UPC-CHECK-DIGIT =                      07290041
073000                             DP040I-COMPUTED-UPC-CHK-DIGIT        07300041
073100                     MOVE DP040I-COMPUTED-UPC-CHK-DIGIT           07310041
073200                                   TO XL087-12-CHECK-DIGIT        07320041
073300                     SET XL087-12-VALID-CK-DIGIT-YES TO TRUE      07330041
073400                 ELSE                                             07340041
073500                     SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE      07350041
073600                 END-IF                                           07360041
073700             ELSE                                                 07370041
073800                 SET XL087-12-VALID-CK-DIGIT-NO  TO TRUE          07380041
073900             END-IF                                               07390041
074000                                                                  07400019
074100             MOVE XL087-UPC-12-DIGIT-NBR   TO DK-UPC              07410019
074200             SET PS-UPC-ON-DATABASE-NO     TO TRUE                07420019
074300             PERFORM 5000-CHECK-UPC-ON-TABLE                      07430019
074400             IF PS-UPC-ON-DATABASE-YES                            07440019
074500                 SET XL087-12-VALID-UPC-YES   TO TRUE             07450019
074600             ELSE                                                 07460019
074700                 MOVE XL087-UPC-12-DIGIT-NBR  TO XL087-RETURN-UPC 07470022
074800                 SET XL087-12-VALID-UPC-NO    TO TRUE             07480024
074900             END-IF                                               07490019
075000     END-EVALUATE.                                                07500001
075100                                                                  07510001
075200******************************************************************07520001
075300 1400-SET-RETURN-CODES.                                           07530001
075400*    DISPLAY ' 1400-SET-RETURN-CODES'.                            07540037
075500     IF PS-ERROR-NO                                               07550001
075600         IF XL087-15-VALID-CK-DIGIT-NO AND                        07560049
075700            XL087-14-VALID-CK-DIGIT-NO AND                        07570049
075800            XL087-13-VALID-CK-DIGIT-NO AND                        07580001
075900            XL087-12-VALID-CK-DIGIT-NO                            07590001
076000             SET XL087-BAD-CHECK-DIGIT  TO TRUE                   07600001
076100         ELSE                                                     07610001
076200             IF XL087-15-VALID-UPC-NO  AND                        07620049
076300                XL087-14-VALID-UPC-NO  AND                        07630049
076400                XL087-13-VALID-UPC-NO  AND                        07640001
076500                XL087-12-VALID-UPC-NO                             07650001
076600                 SET XL087-NOT-FOUND    TO TRUE                   07660001
076700             ELSE                                                 07670001
076800                 SET XL087-CALL-SUCCESSFUL   TO TRUE              07680001
076900             END-IF                                               07690001
077000         END-IF                                                   07700001
077100     END-IF.                                                      07710001
077200                                                                  07720001
077300     IF PS-ERROR-NO                                               07730001
077400*        DISPLAY '1400-SET START ' XL087-UPC-X                    07740037
077500         IF XL087-15-VALID-UPC-YES                                07750050
077600*        DISPLAY '1400-SET 15   '                                 07760050
077700             MOVE XL087-UPC-15-DIGIT-NBR  TO XL087-RETURN-UPC     07770050
077800             SET XL087-GTIN-15-TYPE       TO TRUE                 07780050
077900         ELSE                                                     07790001
078000             IF XL087-14-VALID-UPC-YES                            07800050
078100*        DISPLAY '1400-SET 14   '                                 07810050
078200                 MOVE XL087-UPC-14-DIGIT-NBR  TO XL087-RETURN-UPC 07820050
078300                 SET XL087-GTIN-14-TYPE       TO TRUE             07830050
078400             ELSE                                                 07840050
078500                 IF XL087-13-VALID-UPC-YES                        07850050
078600*        DISPLAY '1400-SET 13   '                                 07860037
078700                     MOVE XL087-UPC-13-DIGIT-NBR                  07870050
078800                                              TO XL087-RETURN-UPC 07880050
078900                     SET XL087-EAN-13-TYPE        TO TRUE         07890050
079000                 ELSE                                             07900050
079100                     IF XL087-12-VALID-UPC-YES                    07910050
079200*        DISPLAY '1400-SET 12   '                                 07920037
079300                         MOVE XL087-UPC-12-DIGIT-NBR              07930050
079400                                              TO XL087-RETURN-UPC 07940003
079500                         IF XL087-UPC-E-6-TYPE                    07950050
079600                             CONTINUE                             07960050
079700                         ELSE                                     07970050
079800                             SET XL087-UPC-12-TYPE    TO TRUE     07980050
079900                         END-IF                                   07990050
080000                     END-IF                                       08000050
080100                 END-IF                                           08010050
080200             END-IF                                               08020050
080300         END-IF                                                   08030050
080400     END-IF.                                                      08040001
080500******************************************************************08050001
080600 5000-CHECK-UPC-ON-TABLE.                                         08060001
080700                                                                  08070001
080800     EXEC SQL                                                     08080001
080900         SELECT INTR_UPC_ID                                       08090004
081000           INTO :XLT00006-INTR-UPC-ID                             08100001
081100           FROM XLT_UPC                                           08110001
081200          WHERE UPC_NBR       = :DK-UPC                           08120001
081300     END-EXEC.                                                    08130001
081400                                                                  08140001
081500     EVALUATE TRUE                                                08150001
081600       WHEN SQLCODE = ZERO                                        08160001
081700           SET PS-UPC-ON-DATABASE-YES   TO TRUE                   08170001
081800                                                                  08180001
081900       WHEN SQLCODE = +100                                        08190001
082000           SET PS-UPC-ON-DATABASE-NO    TO TRUE                   08200001
082100                                                                  08210001
082200       WHEN SQLCODE = -904                                        08220001
082300       WHEN SQLCODE = -911                                        08230001
082400       WHEN SQLCODE = -913                                        08240001
082500           MOVE '5000-CHECK-UPC-ON-TABLE'  TO XL087-PARAGRAPH     08250001
082600           MOVE SQLCODE                    TO XL087-SQLCODE       08260001
082700           MOVE 'XLT_UPC'                  TO XL087-DATABASE      08270001
082800           SET XL087-DATABASE-CONTENTION                          08280001
082900               PS-ERROR-YES                TO TRUE                08290002
083000           MOVE SQLCA                      TO XL087-SQLCA         08300005
083100           MOVE 'CONTENTION ISSUE '        TO XL087-RETURN-MESSAGE08310001
083200                                                                  08320001
083300       WHEN OTHER                                                 08330001
083400           MOVE '5000-CHECK-UPC-ON-TABLE'  TO XL087-PARAGRAPH     08340001
083500           MOVE SQLCODE                    TO XL087-SQLCODE       08350001
083600           MOVE 'XLT_UPC'                  TO XL087-DATABASE      08360001
083700           SET XL087-DB2-ERROR                                    08370038
083800               PS-ERROR-YES                TO TRUE                08380002
083900           MOVE 'SQL ERROR        '        TO XL087-RETURN-MESSAGE08390001
084000                                                                  08400001
084100     END-EVALUATE.                                                08410001
084200                                                                  08420046
084300 9990-WRITE-CSSL-MSG.                                             08430046
084400     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       08440046
084500     EXEC CICS                                                    08450046
084600          WRITEQ TD                                               08460046
084700           QUEUE  ('CSSL')                                        08470046
084800            FROM  (PV-CICS-MSG-AREA)                              08480046
084900          LENGTH  (PV-COMMAREA-LENGTH)                            08490046
085000            RESP  (PV-CICS-RESPONSE)                              08500046
085100     END-EXEC.                                                    08510046
085200                                                                  08520046
