000100*************************                                         00010008
000200 IDENTIFICATION DIVISION.                                         00020008
000300*************************                                         00030008
000400 PROGRAM-ID.    MBKCS118.                                         00040008
000500 AUTHOR.        MIKE FURLICK.                                     00050008
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060008
000700 DATE-WRITTEN.  11-7-91.                                          00070008
000800 DATE-COMPILED.                                                   00080008
000900                                                                  00090008
001000***************************************************************** 00100008
001100*    R118 - APPLICATION SYSTEM AVAILABLE UPDATE                   00110008
001200*                                                                 00120008
001300*    THIS PROGRAM ALLOWS UPDATES TO THE APPLICATION SYSTEM START  00130008
001400*    AND END DATES.  SUBORDINATE MERCHANDISE AREAS WILL BE CON-   00140008
001500*    DITIONALLY UPDATED WHEN THE START DATE IS CHANGED TO A       00150008
001600*    LATER DATE OR THE END DATE WAS CHANGED TO AN EARLIER DATE.   00160008
001700*                                                                 00170008
001800***************************************************************** 00180008
001900*    06/17/98  DOUG DOUGLAS  STRATAGEM    WR#: 6041               00190008
002000*              - UPGRADE FOR Y2K                                  00200008
002100*              - REPLACE ++INCLUDE'S WITH COPY'S (STDS)           00210008
002200***************************************************************** 00220008
002300*                                                                 00230008
002400*                                                                 00240008
002500*                                                                 00250008
002600 ENVIRONMENT DIVISION.                                            00260008
002700*                                                                 00270008
002800*                                                                 00280008
002900*                                                                 00290008
003000 DATA DIVISION.                                                   00300008
003100*                                                                 00310008
003200*                                                                 00320008
003300 WORKING-STORAGE SECTION.                                         00330008
003400*                                                                 00340008
003500 01  PC-PROGRAM-CONSTANTS.                                        00350008
003600     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00360008
003700     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  00370008
003800                                                     COMP SYNC.   00380008
003900     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00390008
004000     'MB118A  '.                                                  00400008
004100     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00410008
004200     'MBKM118 '.                                                  00420008
004300     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00430008
004400     'MBKCS118'.                                                  00440008
004500     05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314  00450008
004600                                                     COMP SYNC.   00460008
004700     05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5     00470008
004800                                                     COMP SYNC.   00480008
004900     05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128   00490008
005000                                                     COMP SYNC.   00500008
005100     05  FILLER REDEFINES PC-ERASE-EOF-COMP.                      00510008
005200         10  FILLER                     PIC X(01).                00520008
005300         10  PC-ERASE-EOF               PIC X(01).                00530008
005400     05  PC-99                          PIC X(2)     VALUE '99'.  00540008
005500     05  PC-ZERO                        PIC X(3)     VALUE '000'. 00550008
005600     05  PC-NINES                       PIC 9(3)     VALUE 999.   00560008
005700     05  PC-GMA                         PIC X(3)     VALUE 'GMA'. 00570008
005800     05  PC-DMA                         PIC X(3)     VALUE 'DMA'. 00580008
005900     05  PC-DPT                         PIC X(3)     VALUE 'DPT'. 00590008
006000     05  PC-MCL                         PIC X(3)     VALUE 'MCL'. 00600008
006100     05  PC-SCL                         PIC X(3)     VALUE 'SCL'. 00610008
006200     05  PC-DEFAULT-DATE                PIC X(10)    VALUE        00620008
006300                                                     '9999-09-09'.00630008
006400     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00640008
006500                                                     COMP-3.      00650008
006600 01  PC-COMPANY                         PIC XX       VALUE '03'.  00660008
006700*                                                                 00670008
006800 01  PC-TSYMSG-NUMBERS.                                           00680008
006900     05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  00690008
007000     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00700008
007100     05  PC-TSYMSG-00009                PIC 9(5)    VALUE 00009.  00710008
007200     05  PC-TSYMSG-00025                PIC 9(5)    VALUE 00025.  00720008
007300     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  00730008
007400     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00740008
007500     05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.  00750008
007600     05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.  00760008
007700     05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.  00770008
007800     05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.  00780008
007900     05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.  00790008
008000     05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  00800008
008100     05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.  00810008
008200     05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.  00820008
008300     05  PC-TSYMSG-00062                PIC 9(5)    VALUE 00062.  00830008
008400     05  PC-TSYMSG-00067                PIC 9(5)    VALUE 00067.  00840008
008500     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00850008
008600     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00860008
008700     05  PC-TSYMSG-00143                PIC 9(5)    VALUE 00143.  00870008
008800     05  PC-TSYMSG-00144                PIC 9(5)    VALUE 00144.  00880008
008900     05  PC-TSYMSG-00145                PIC 9(5)    VALUE 00145.  00890008
009000     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00900008
009100     05  PC-TSYMSG-00176                PIC 9(5)    VALUE 00176.  00910008
009200     05  PC-TSYMSG-00213                PIC 9(5)    VALUE 00213.  00920008
009300     05  PC-TSYMSG-00214                PIC 9(5)    VALUE 00214.  00930008
009400     05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.  00940008
009500*                                                                 00950008
009600 01  PM-PROGRAM-MESSAGES.                                         00960008
009700     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE        00970008
009800     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                00980008
009900     05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE        00990008
010000     'LOGIC ERROR IN TRYING TO READ MD LIST QUEUE - RESP = '.     01000008
010100     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                  01010008
010200         10  FILLER                     PIC X(61).                01020008
010300         10  PM-RESP-22                 PIC 9999.                 01030008
010400         10  FILLER                     PIC X(12).                01040008
010500*                                                                 01050008
010600 01  PS-PROGRAM-SWITCHES.                                         01060008
010700     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   01070008
010800         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   01080008
010900         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   01090008
011000         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   01100008
011100         88  PS-SEND-DATA-ONLY                       VALUE '4'.   01110008
011200         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   01120008
011300         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   01130008
011400     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   01140008
011500         88  PS-ERROR                                VALUE 'Y'.   01150008
011600         88  PS-NO-ERROR                             VALUE 'N'.   01160008
011700     05  PS-DATE-SW                     PIC X(01)    VALUE 'N'.   01170008
011800         88  PS-VALID-DATE                           VALUE 'Y'.   01180008
011900         88  PS-INVALID-DATE                         VALUE 'N'.   01190008
012000     05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.   01200008
012100         88  PS-INTER-APPL-VALID                     VALUE 'Y'.   01210008
012200         88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.   01220008
012300     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.   01230008
012400         88  PS-CONTINUE                             VALUE 'Y'.   01240008
012500         88  PS-DONT-PROCESS                         VALUE 'N'.   01250008
012600     05  PS-DEFAULT-DATE-SW             PIC X(01)    VALUE 'N'.   01260008
012700         88  PS-DEFAULT-DATE                         VALUE 'Y'.   01270008
012800         88  PS-NO-DEFAULT-DATE                      VALUE 'N'.   01280008
012900     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   01290008
013000         88  PS-COMMAREA-VALID                       VALUE 'Y'.   01300008
013100         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   01310008
013200     EJECT                                                        01320008
013300 01  PV-PROGRAM-VARIABLES.                                        01330008
013400     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     01340008
013500                                                     COMP SYNC.   01350008
013600     05  PV-RESP                        PIC S9(04)   VALUE +0     01360008
013700                                                     COMP SYNC.   01370008
013800     05  PV-ITEM                        PIC S9(04)   VALUE +0     01380008
013900                                                     COMP SYNC.   01390008
014000     05  PV-MA-ITEM                     PIC S9(04)   VALUE +0     01400008
014100                                                     COMP SYNC.   01410008
014200     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.01420008
014300     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01430008
014400     05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.      01440008
014500     05  PV-DB2-COUNT                   PIC S9(9)    COMP-3.      01450008
014600*                                                                 01460008
014700     05  PV-WORK-SEQ-NBR                PIC S9(15).               01470008
014800     05  FILLER  REDEFINES  PV-WORK-SEQ-NBR.                      01480008
014900         10  PV-WS-OPERCO               PIC 99.                   01490008
015000         10  PV-WS-GMA                  PIC 99.                   01500008
015100         10  PV-WS-DMA                  PIC 99.                   01510008
015200         10  PV-WS-DEPT                 PIC 999.                  01520008
015300         10  PV-WS-MAJ-CL               PIC 99.                   01530008
015400         10  PV-WS-SUB-CL               PIC 999.                  01540008
015500         10  PV-WS-ZERO                 PIC 9.                    01550008
015600     05  PV-WORK-DATE.                                            01560008
015700         10  PV-WD-MM                   PIC XX.                   01570008
015800         10  FILLER                     PIC X        VALUE '/'.   01580008
015900         10  PV-WD-DD                   PIC XX.                   01590008
016000         10  FILLER                     PIC X        VALUE '/'.   01600008
016100         10  PV-WD-YY                   PIC XX.                   01610008
016200     05  PV-SCREEN-DATE.                                          01620008
016300         10  PV-SD-MM                   PIC 99.                   01630008
016400         10  FILLER                     PIC X        VALUE '/'.   01640008
016500         10  PV-SD-DD                   PIC 99.                   01650008
016600         10  FILLER                     PIC X        VALUE '/'.   01660008
016700         10  PV-SD-YY                   PIC 99.                   01670008
017200*                                                                 01720008
017300 01  PV-DB2-DATE-TO-BE-REDEFINED.                                 01730008
017400     05  PV-DD-CCYY.                                              01740008
017500         10  PV-DD-CC                   PIC XX.                   01750008
017600         10  PV-DD-YY                   PIC XX.                   01760008
017700     05  FILLER                         PIC X        VALUE '-'.   01770008
017800     05  PV-DD-MM                       PIC XX.                   01780008
017900     05  FILLER                         PIC X        VALUE '-'.   01790008
018000     05  PV-DD-DD                       PIC XX.                   01800008
018100 01  PV-DB2-DATE  REDEFINES  PV-DB2-DATE-TO-BE-REDEFINED          01810008
018200                                        PIC X(10).                01820008
018900 EJECT                                                            01890008
019000***************************************************************** 01900008
019100*    STANDARD COMMAREA.                                           01910008
019200***************************************************************** 01920008
019300                                                                  01930008
019400     COPY DPWS020.                                                01940008
019500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01950008
019600                                                                  01960008
019700***************************************************************** 01970008
019800*    INTER-APPLICATION COMMAREA.                                  01980008
019900***************************************************************** 01990008
020000                                                                  02000008
020100         10  INTER-APPL-COMM-AREA       PIC X(200).               02010008
020200     COPY MBWS005.                                                02020008
020300***************************************************************** 02030008
020400*    SPECIFIC COMMMAREA FOR MBKCS118.                             02040008
020500***************************************************************** 02050008
020600         10  MB118-SPECIFIC-COMMAREA.                             02060008
020700             15  MB118-APPL-CURSOR-POSITION          PIC S9(04)   02070008
020800                                                     COMP.        02080008
020900             15  MB118-MA-SUB                        PIC S9(4)    02090008
021000                                                         COMP.    02100008
021100             15  MB118-MA-ITEM                       PIC S9(4)    02110008
021200                                                         COMP.    02120008
021300             15  MB118-KEY-DATA.                                  02130008
021400                 20  MB118-GMA-NBR                   PIC X(02).   02140008
021500                 20  MB118-DMA-NBR                   PIC X(02).   02150008
021600                 20  MB118-DEPT-NBR                  PIC X(03).   02160008
021700                 20  MB118-MCLASS-NBR                PIC X(02).   02170008
021800                 20  MB118-SCLASS-NBR                PIC X(03).   02180008
021900                 20  MB118-MDSELV-CDE                PIC X(03).   02190008
022000                     88  MB118-MDS-IS-PARENT         VALUE 'GMA'. 02200008
022100                     88  MB118-GMA-IS-PARENT         VALUE 'DMA'. 02210008
022200                     88  MB118-DMA-IS-PARENT         VALUE 'DPT'. 02220008
022300                     88  MB118-DPT-IS-PARENT         VALUE 'MCL'. 02230008
022400                     88  MB118-MCL-IS-PARENT         VALUE 'SCL'. 02240008
022500                 20  MB118-APPL-SYS-CODE             PIC X(02).   02250008
022600             15  MB118-GMA-DESC                      PIC X(25).   02260008
022700             15  MB118-DMA-DESC                      PIC X(25).   02270008
022800             15  MB118-DEPT-DESC                     PIC X(25).   02280008
022900             15  MB118-MCLASS-DESC                   PIC X(25).   02290008
023000             15  MB118-SCLASS-DESC                   PIC X(25).   02300008
023100             15  MB118-APPL-SYS-DESC                 PIC X(25).   02310008
023200             15  MB118-ORIG-STRT-DATE.                            02320008
023300                 20  MB118-OSD-CC                    PIC 99.      02330008
023400                 20  MB118-OSD-YY                    PIC 99.      02340008
023500                 20  FILLER                          PIC X.       02350008
023600                 20  MB118-OSD-MM                    PIC 99.      02360008
023700                 20  FILLER                          PIC X.       02370008
023800                 20  MB118-OSD-DD                    PIC 99.      02380008
023900             15  MB118-ORIG-END-DATE.                             02390008
024000                 20  MB118-OED-CC                    PIC 99.      02400008
024100                 20  MB118-OED-YY                    PIC 99.      02410008
024200                 20  FILLER                          PIC X.       02420008
024300                 20  MB118-OED-MM                    PIC 99.      02430008
024400                 20  FILLER                          PIC X.       02440008
024500                 20  MB118-OED-DD                    PIC 99.      02450008
024600             15  MB118-MDSEAR-DKEY                   PIC S9(6)    02460008
024700                                                         COMP-3.  02470008
024800             15  MB118-LIST-SEQ-NBR                  PIC S9(15)   02480008
024900                                                         COMP-3.  02490008
025000             15  MB118-MAX-SEQ-NBR                   PIC S9(15)   02500008
025100                                                         COMP-3.  02510008
025200             15  MB118-MDSE-STRT-DATE                PIC X(10).   02520008
025300             15  MB118-MDSE-END-DATE                 PIC X(10).   02530008
025400             15  MB118-PARENT-STRT-DATE              PIC X(10).   02540008
025500             15  MB118-PARENT-END-DATE               PIC X(10).   02550008
025600             15  MB118-APLAVL-PARENT-STRT-DATE       PIC X(10).   02560008
025700             15  MB118-APLAVL-PARENT-END-DATE        PIC X(10).   02570008
025800             15  MB118-STRT-DATE.                                 02580008
025900                 20  MB118-SD-CC                     PIC XX.      02590011
026000                 20  MB118-SD-YY                     PIC XX.      02600011
026100                 20  MB118-SD-MM                     PIC XX.      02610008
026200                 20  MB118-SD-DD                     PIC XX.      02620008
026300             15  MB118-END-DATE.                                  02630008
026400                 20  MB118-ED-CC                     PIC XX.      02640011
026410                 20  MB118-END-DATE-YMD.                          02641012
026500                     25  MB118-ED-YY                 PIC XX.      02650012
026600                     25  MB118-ED-MM                 PIC XX.      02660012
026700                     25  MB118-ED-DD                 PIC XX.      02670012
026800             15  MB118-GEN-MDSE-TYPE-CDE             PIC X.       02680008
026900             15  MB118-BYR-NBR                       PIC X(3).    02690008
027000             15  MB118-DISPLAY-ATTRIBUTES.                        02700008
027100                 20  MB118-DMA-ATTR                  PIC X.       02710008
027200                 20  MB118-DEPT-ATTR                 PIC X.       02720008
027300                 20  MB118-MCLASS-ATTR               PIC X.       02730008
027400                 20  MB118-SCLASS-ATTR               PIC X.       02740008
027500             15  MB118-TEMP-QUEUE-NAME.                           02750008
027600                 20  MB118-TERM-ID                   PIC X(4).    02760008
027700                 20  MB118-TASK-NUMBER               PIC S9(7)    02770008
027800                                                         COMP-3.  02780008
027900             15  MB118-START-DATE-SWITCH             PIC X.       02790008
028000                 88  MB118-CAN-MODIFY-STRT-DATE      VALUE 'Y'.   02800008
028100                 88  MB118-CANT-MODIFY-STRT-DATE     VALUE 'N'.   02810008
028200             15  MB118-LIST-SWITCH                   PIC X.       02820008
028300                 88  MB118-IS-A-LIST                 VALUE 'Y'.   02830008
028400                 88  MB118-IS-NO-LIST                VALUE 'N'.   02840008
028500             15  MB118-DEPT-SW                       PIC X.       02850008
028600                 88  MB118-IS-A-DEPT                 VALUE 'Y'.   02860008
028700                 88  MB118-IS-NO-DEPT                VALUE 'N'.   02870008
028800             15  MB118-SUB-CLASS-SW                  PIC X.       02880008
028900                 88  MB118-IS-A-SUBCL                VALUE 'Y'.   02890008
029000                 88  MB118-IS-NO-SUBCL               VALUE 'N'.   02900008
029100             15  MB118-SAVE-INTER-APPL-COMMAREA      PIC X(200).  02910008
029200             15  MB118-SAVE-LIST-QUEUE               PIC X(2350). 02920008
029300*                                                                 02930008
029320     COPY DPWS006.                                                02932012
029330*                                                                 02933012
029400     EJECT                                                        02940008
029500***************************************************************** 02950008
029600*    MERCHANDISE AREA LIST RECORD LAYOUT.                         02960008
029700***************************************************************** 02970008
029800 01 MA-LIST-RECORD.                                               02980008
029900     COPY MBWS023.                                                02990008
030000                                                                  03000008
030100*                                                                 03010008
030200     EJECT                                                        03020008
030300***************************************************************** 03030008
030400*    DATE VALIDATION COPYBOOK.                                    03040008
030500***************************************************************** 03050008
030600                                                                  03060008
030700     COPY DPWS500.                                                03070008
031500*                                                                 03150008
031600     EJECT                                                        03160008
031700***************************************************************** 03170008
031800*    ABEND PROCESSING COPYBOOK.                                   03180008
031900***************************************************************** 03190008
032000                                                                  03200008
032100     COPY DPWS013.                                                03210008
032200                                                                  03220008
032300     EJECT                                                        03230008
032400***************************************************************** 03240008
032500*    ATTRIBUTE SETTINGS COPYBOOK.                                 03250008
032600***************************************************************** 03260008
032700                                                                  03270008
032800     COPY DPWS015.                                                03280008
032900                                                                  03290008
033000***************************************************************** 03300008
033100*    CURRENT DATE AND TIME COPYBOOK.                              03310008
033200***************************************************************** 03320008
033300                                                                  03330008
033400     COPY DPWS017.                                                03340008
033500                                                                  03350008
033600***************************************************************** 03360008
033700*    TOGGLE FUNCTION KEY LINES COPYBOOK.                          03370008
033800***************************************************************** 03380008
033900                                                                  03390008
034000     COPY DPWS009.                                                03400008
034100                                                                  03410008
034200***************************************************************** 03420008
034300*    FUNCTION KEYS COPYBOOK.                                      03430008
034400***************************************************************** 03440008
034500                                                                  03450008
034600     COPY DPWS016.                                                03460008
034700                                                                  03470008
034800***************************************************************** 03480008
034900*    DPKUT045 COPYBOOK.                                           03490008
035000***************************************************************** 03500008
035100                                                                  03510008
035200     COPY DPWS045.                                                03520008
035300                                                                  03530008
035400***************************************************************** 03540008
035500*    NUMERIC EDIT LAYOUT.                                         03550008
035600***************************************************************** 03560008
035700                                                                  03570008
035800     COPY DPWS010I.                                               03580008
035900                                                                  03590008
036000***************************************************************** 03600008
036100*    MESSAGE RECORD LAYOUT                                        03610008
036200***************************************************************** 03620008
036300                                                                  03630008
036400     COPY DPRD507I.                                               03640008
036500                                                                  03650008
036600***************************************************************** 03660008
036700*    STANDARD ATTENTION IDENTIFIER LIST                           03670008
036800***************************************************************** 03680008
036900                                                                  03690008
037000     COPY DFHAID.                                                 03700008
037100                                                                  03710008
037200***************************************************************** 03720008
037300*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST        03730008
037400***************************************************************** 03740008
037500                                                                  03750008
037600     COPY DFHBMSCA.                                               03760008
037700                                                                  03770008
037800***************************************************************** 03780008
037900*    MAP LAYOUT                                                   03790008
038000***************************************************************** 03800008
038100                                                                  03810008
038200     COPY MBKM118.                                                03820008
038300 01  MD-MAP-DATA-AREA  REDEFINES MB118AO PIC X(1200).             03830008
038400*                                                                 03840008
038500 EJECT                                                            03850008
038600*                                                                 03860008
038700*    DB2 AREA FOR TMDSEAR                                         03870008
038800*                                                                 03880008
038900     EXEC SQL                                                     03890008
039000          INCLUDE TMDSEAR                                         03900008
039100     END-EXEC.                                                    03910008
039200*                                                                 03920008
039300*    DB2 AREA FOR TAPLAVL                                         03930008
039400*                                                                 03940008
039500     EXEC SQL                                                     03950008
039600          INCLUDE TAPLAVL                                         03960008
039700     END-EXEC.                                                    03970008
039800*                                                                 03980008
039900*    DB2 AREA FOR TAPLSYS                                         03990008
040000*                                                                 04000008
040100     EXEC SQL                                                     04010008
040200          INCLUDE TAPLSYS                                         04020008
040300     END-EXEC.                                                    04030008
040400*                                                                 04040008
040500*    DB2 AREA FOR COMMUNICATIONS                                  04050008
040600*                                                                 04060008
040700     EXEC SQL                                                     04070008
040800          INCLUDE SQLCA                                           04080008
040900     END-EXEC.                                                    04090008
041000*                                                                 04100008
041100*    CURSOR FOR SUBORDINATE PROCESSING                            04110008
041200*                                                                 04120008
041300     EXEC SQL                                                     04130008
041400          DECLARE SUBORDINATE-CURSOR CURSOR                       04140008
041500          FOR SELECT                                              04150008
041600                A.MDSEAR_DKEY,                                    04160008
041700                B.MDSEAR_STRT_DTE,                                04170008
041800                B.MDSEAR_END_DTE                                  04180008
041900          FROM                                                    04190008
042000                TMDSEAR A,                                        04200008
042100                TAPLAVL B                                         04210008
042200          WHERE                                                   04220008
042300               (A.LIST_SEQ_NBR                                    04230008
042400                     BETWEEN          :MB118-LIST-SEQ-NBR         04240008
042500                       AND            :MB118-MAX-SEQ-NBR)         04250008
042600           AND  A.MDSEAR_DKEY      =  B.MDSEAR_DKEY               04260008
042700           AND  A.END_DTE          >  (CURRENT DATE)              04270008
042800                                                                  04280008
042900           AND (B.MDSEAR_STRT_DTE  <  :APLAVL-MDSEAR-STRT-DTE  OR 04290008
043000                B.MDSEAR_END_DTE   >  :APLAVL-MDSEAR-END-DTE)     04300008
043100                                                                  04310008
043200           AND  B.APLSYS_CDE       =  :MB118-APPL-SYS-CODE        04320008
043300     END-EXEC.                                                    04330008
043400*                                                                 04340008
043500 EJECT                                                            04350008
043600 LINKAGE SECTION.                                                 04360008
043700                                                                  04370008
043800 01  DFHCOMMAREA.                                                 04380008
043900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04390008
044000                                        DEPENDING ON EIBCALEN.    04400008
044100         10  FILLER                     PIC X.                    04410008
044200                                                                  04420008
044300*                                                                 04430008
044400*                                                                 04440008
044500*                                                                 04450008
044600 PROCEDURE DIVISION.                                              04460008
044700                                                                  04470008
044800                                                                  04480008
044900 0000-MAIN-MODULE.                                                04490008
045000                                                                  04500008
045100******************************************************************04510008
045200*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.           04520008
045300******************************************************************04530008
045400                                                                  04540008
045500     PERFORM DP015-0000-CHECK-COMMAREA.                           04550008
045600                                                                  04560008
045700     IF DP020-SRC-RETURN-W-TRAN-ID                                04570008
045800         PERFORM 1000-CONTROL-PROCESSING                          04580008
045900     END-IF.                                                      04590008
046000                                                                  04600008
046100     PERFORM DP003-0000-RETURN-TO-CICS.                           04610008
046200 EJECT                                                            04620008
046300******************************************************************04630008
046400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    04640008
046500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                    04650008
046600*                                                                 04660008
046700*    PERFORMED BY 0000-MAIN-MODULE.                               04670008
046800******************************************************************04680008
046900*                                                                 04690008
047000 1000-CONTROL-PROCESSING.                                         04700008
047100*                                                                 04710008
047200     SET PS-CONTINUE           TO  TRUE.                          04720008
047300*                                                                 04730008
047400     EVALUATE TRUE                                                04740008
047500         WHEN DP020-NEXT-ACT-INITIAL                              04750008
047600             PERFORM 4100-VALIDATE-COMMAREA                       04760008
047700             IF  PS-COMMAREA-NOT-VALID                            04770008
047800                 MOVE PC-TSYMSG-99901                             04780008
047900                               TO  DP020-MSG-NUMBER               04790008
048000                 SET DP020-MSG-FATAL                              04800008
048100                               TO  TRUE                           04810008
048200                 MOVE DP016-PF3                                   04820008
048300                               TO  DP020-SRC-AID                  04830008
048400                 PERFORM DP015-1000-START-NAVIGATOR               04840008
048500             ELSE                                                 04850008
048600                 INITIALIZE MB118-SPECIFIC-COMMAREA               04860008
048700                 MOVE LOW-VALUES                                  04870008
048800                               TO  MB118-END-DATE                 04880008
048900                 SET PS-SEND-MAP-N-DATA-FRSET                     04890008
049000                               TO  TRUE                           04900008
049100                 SET DP020-NEXT-ACT-READ-MAP                      04910008
049200                               TO  TRUE                           04920008
049300                 PERFORM 2000-BUILD-INITIAL-PANEL                 04930008
049400             END-IF                                               04940008
049500*                                                                 04950008
049600         WHEN DP020-NEXT-ACT-READ-MAP                             04960008
049700             PERFORM 3000-PROCESS-PANEL                           04970008
049800*                                                                 04980008
049900         WHEN DP020-NEXT-ACT-RETURN                               04990008
050000             SET PS-SEND-MAP-N-DATA-FRSET                         05000008
050100                               TO  TRUE                           05010008
050200             MOVE MB118-SAVE-INTER-APPL-COMMAREA                  05020008
050300                               TO  MB005-INTER-APPL-COMMAREA      05030008
050400             PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                 05040008
050500             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   05050008
050600             PERFORM 2200-DISPLAY-PANEL                           05060008
050700*                                                                 05070008
050800         WHEN DP020-NEXT-ACT-ERROR                                05080008
050900             MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                 05090008
051000             IF DP020-NAV-MNEMONIC = SPACES                       05100008
051100                 MOVE SPACES   TO  ANAVCMDO                       05110008
051200                 MOVE DP015-UNDERLINE                             05120008
051300                               TO  ANAVCMDH                       05130008
051400                 MOVE DP015-GREEN                                 05140008
051500                               TO  ANAVCMDC                       05150008
051600             ELSE                                                 05160008
051700                 MOVE DP015-REVERSE                               05170008
051800                               TO  ANAVCMDH                       05180008
051900                 MOVE DP015-RED                                   05190008
052000                               TO  ANAVCMDC                       05200008
052100             END-IF                                               05210008
052200             MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE              05220008
052300             SET DP020-MSG-FATAL                                  05230008
052400                               TO  TRUE                           05240008
052500             SET PS-SEND-DATA-ONLY-FRSET                          05250008
052600                               TO  TRUE                           05260008
052700             PERFORM 2200-DISPLAY-PANEL                           05270008
052800*                                                                 05280008
052900         WHEN OTHER                                               05290008
053000             SET DP013-LOGIC-ABEND TO TRUE                        05300008
053100             SET DP013-NO-ROLLBACK TO TRUE                        05310008
053200             MOVE 'B100-CONTROL-PROCESSING'                       05320008
053300                               TO  DP013-PARAGRAPH                05330008
053400             MOVE PM-PROGRAM-MESSAGE-12                           05340008
053500                               TO  DP013-MESSAGE-TEXT(1)          05350008
053600             PERFORM DP013-0000-PROCESS-ABEND                     05360008
053700     END-EVALUATE.                                                05370008
053800*                                                                 05380008
053900 EJECT                                                            05390008
054000******************************************************************05400008
054100*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      05410008
054200*    ENTRY.                                                       05420008
054300*                                                                 05430008
054400*    PERFORMED BY 1000-CONTROL-PROCESSING.                        05440008
054500******************************************************************05450008
054600*                                                                 05460008
054700 2000-BUILD-INITIAL-PANEL.                                        05470008
054800*                                                                 05480008
054900     MOVE 1                    TO  MB118-MA-ITEM                  05490008
055000                                   MB118-MA-SUB.                  05500008
055100     PERFORM 2170-READ-LIST-QUEUE.                                05510008
055200     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            05520008
055300         MOVE MB023-KEY-DATA (1)   TO  MB118-KEY-DATA             05530008
055400         MOVE MB023-APPL-SYS-CDE (1)                              05540008
055500                                   TO  MB118-APPL-SYS-CODE        05550008
055600         SET MB023-INQ (1)         TO  TRUE                       05560008
055700         MOVE MA-LIST-RECORD       TO  MB118-SAVE-LIST-QUEUE      05570008
055800         SET MB118-IS-A-LIST       TO  TRUE                       05580008
055900     ELSE                                                         05590008
056000         MOVE MB005-REQUEST-DATA   TO  MB118-KEY-DATA             05600008
056100         SET MB118-IS-NO-LIST      TO  TRUE                       05610008
056200*                                                                 05620008
056300*    ENSURE THE DATA WAS PASSED PROPERLY.                         05630008
056400*                                                                 05640008
056500         IF  MB118-GMA-NBR GREATER THAN ZERO                      05650008
056600             MOVE PC-GMA           TO  MB118-MDSELV-CDE           05660008
056700         ELSE                                                     05670008
056800             MOVE PC-ZERO          TO  MB118-GMA-NBR              05680008
056900         END-IF                                                   05690008
057000*                                                                 05700008
057100         IF  MB118-DMA-NBR GREATER THAN ZERO                      05710008
057200             MOVE PC-DMA           TO  MB118-MDSELV-CDE           05720008
057300         ELSE                                                     05730008
057400             MOVE PC-ZERO          TO  MB118-DMA-NBR              05740008
057500         END-IF                                                   05750008
057600*                                                                 05760008
057700         IF  MB118-DEPT-NBR GREATER THAN ZERO                     05770008
057800             MOVE PC-DPT           TO  MB118-MDSELV-CDE           05780008
057900         ELSE                                                     05790008
058000             MOVE PC-ZERO          TO  MB118-DEPT-NBR             05800008
058100         END-IF                                                   05810008
058200*                                                                 05820008
058300         IF  MB118-MCLASS-NBR GREATER THAN ZERO                   05830008
058400             MOVE PC-MCL           TO  MB118-MDSELV-CDE           05840008
058500         ELSE                                                     05850008
058600             MOVE PC-ZERO          TO  MB118-MCLASS-NBR           05860008
058700         END-IF                                                   05870008
058800*                                                                 05880008
058900         IF  MB118-SCLASS-NBR GREATER THAN ZERO                   05890008
059000             MOVE PC-SCL           TO  MB118-MDSELV-CDE           05900008
059100         ELSE                                                     05910008
059200             MOVE PC-ZERO          TO  MB118-SCLASS-NBR           05920008
059300         END-IF                                                   05930008
059400*                                                                 05940008
059500     END-IF.                                                      05950008
059600*                                                                 05960008
059700     PERFORM 2100-RETRIEVE-DATA-FOR-PANEL.                        05970008
059800*                                                                 05980008
059900     MOVE PC-COMPANY           TO  AOPERCOO.                      05990008
060000     PERFORM 2200-DISPLAY-PANEL.                                  06000008
060100*                                                                 06010008
060200 EJECT                                                            06020008
060300******************************************************************06030008
060400*    DETERMINE WHAT LEVEL OF DATA WAS PASSED AND PERFORM THE      06040008
060500*    READ FOR EACH LEVEL.                                         06050008
060600*                                                                 06060008
060700*    PERFORMED BY 2000, 2180, 3000                                06070008
060800******************************************************************06080008
060900*                                                                 06090008
061000 2100-RETRIEVE-DATA-FOR-PANEL.                                    06100008
061100*                                                                 06110008
061200*    FIRST, SET UP THE HOST VARIABLES.                            06120008
061300*                                                                 06130008
061400     MOVE MB118-GMA-NBR        TO  MDSEAR-GMA-NBR.                06140008
061500     MOVE MB118-DMA-NBR        TO  MDSEAR-DMA-NBR.                06150008
061600     MOVE MB118-DEPT-NBR       TO  MDSEAR-DEPT-NBR.               06160008
061700     MOVE MB118-MCLASS-NBR     TO  MDSEAR-MAJ-CL-NBR.             06170008
061800     MOVE MB118-SCLASS-NBR     TO  MDSEAR-SUB-CL-NBR.             06180008
061900     MOVE MB118-MDSELV-CDE     TO  MDSEAR-MDSELV-CDE.             06190008
062000*                                                                 06200008
062100*    NOW, OBTAIN APLAVL DATA.                                     06210008
062200*                                                                 06220008
062300     PERFORM 2120-READ-APLAVL.                                    06230008
062400*                                                                 06240008
062500     IF  SQLCODE EQUAL +100                                       06250008
062600         MOVE PC-TSYMSG-00148  TO  DP020-MSG-NUMBER               06260008
062700         SET DP020-MSG-FATAL   TO  TRUE                           06270008
062800         MOVE -1               TO  ANAVCMDL                       06280008
062900     ELSE                                                         06290008
063000         MOVE APLSYS-DESC      TO  MB118-APPL-SYS-DESC            06300008
063100         MOVE MDSEAR-DKEY      TO  MB118-MDSEAR-DKEY              06310008
063200         MOVE MDSEAR-LIST-SEQ-NBR                                 06320008
063300                               TO  MB118-LIST-SEQ-NBR             06330008
063400                                   PV-WORK-SEQ-NBR                06340008
063500*                                                                 06350008
063600         IF  PV-WS-GMA EQUAL ZERO                                 06360008
063700             MOVE PC-NINES     TO  PV-WS-GMA                      06370008
063800         END-IF                                                   06380008
063900         IF  PV-WS-DMA EQUAL ZERO                                 06390008
064000             MOVE PC-NINES     TO  PV-WS-DMA                      06400008
064100         END-IF                                                   06410008
064200         IF  PV-WS-DEPT EQUAL ZERO                                06420008
064300             MOVE PC-NINES     TO  PV-WS-DEPT                     06430008
064400         END-IF                                                   06440008
064500         IF  PV-WS-MAJ-CL EQUAL ZERO                              06450008
064600             MOVE PC-NINES     TO  PV-WS-MAJ-CL                   06460008
064700         END-IF                                                   06470008
064800         IF  PV-WS-SUB-CL EQUAL ZERO                              06480008
064900             MOVE PC-NINES     TO  PV-WS-SUB-CL                   06490008
065000         END-IF                                                   06500008
065100         MOVE PC-NINES         TO  PV-WS-ZERO                     06510008
065200         MOVE PV-WORK-SEQ-NBR  TO  MB118-MAX-SEQ-NBR              06520008
065300*                                                                 06530008
065400         MOVE APLAVL-MDSEAR-STRT-DTE                              06540008
065500                               TO  PV-DB2-DATE                    06550008
065600                                   MB118-ORIG-STRT-DATE           06560008
065700         MOVE PV-DD-CC         TO  MB118-SD-CC                    06570008
065800         MOVE PV-DD-YY         TO  MB118-SD-YY                    06580008
065900         MOVE PV-DD-MM         TO  MB118-SD-MM                    06590008
066000         MOVE PV-DD-DD         TO  MB118-SD-DD                    06600008
066100         MOVE APLAVL-MDSEAR-END-DTE                               06610008
066200                               TO  PV-DB2-DATE                    06620008
066300                                   MB118-ORIG-END-DATE            06630008
066400         IF  PV-DD-CC NOT EQUAL PC-99                             06640008
066500             MOVE PV-DD-CC     TO  MB118-ED-CC                    06650008
066600             MOVE PV-DD-MM     TO  MB118-ED-MM                    06660008
066700             MOVE PV-DD-DD     TO  MB118-ED-DD                    06670008
066800             MOVE PV-DD-YY     TO  MB118-ED-YY                    06680008
066900         END-IF                                                   06690008
067000*                                                                 06700008
067100         PERFORM DP017-0000-GET-CURR-DATE-TIME                    06710008
067200         MOVE DP017-CURRENT-YMD-YYYY                              06720008
067300                               TO  PV-DD-CCYY                     06730008
067400         MOVE DP017-CURRENT-YMD-MONTH                             06740008
067500                               TO  PV-DD-MM                       06750008
067600         MOVE DP017-CURRENT-YMD-DAY                               06760008
067700                               TO  PV-DD-DD                       06770008
067800         IF  MB118-ORIG-STRT-DATE GREATER PV-DB2-DATE             06780008
067900             SET MB118-CAN-MODIFY-STRT-DATE                       06790008
068000                               TO  TRUE                           06800008
068100         ELSE                                                     06810008
068200             SET MB118-CANT-MODIFY-STRT-DATE                      06820008
068300                               TO  TRUE                           06830008
068400         END-IF                                                   06840008
068500     END-IF.                                                      06850008
068600*                                                                 06860008
068700*    NEXT, READ THE ROW AND MOVE THE LOWEST LEVEL DETAIL INFO     06870008
068800*    TO THE COMM AREA.  (THE FIRST READ WILL ALWAYS RETURN THE    06880008
068900*    LOWEST LEVEL DETAIL BECAUSE OF THE KEY INFORMATION USED).    06890008
069000*                                                                 06900008
069100     PERFORM 2110-READ-MDSEAR.                                    06910008
069200     MOVE MDSEAR-STRT-DTE      TO  MB118-MDSE-STRT-DATE.          06920008
069300     MOVE MDSEAR-END-DTE       TO  MB118-MDSE-END-DATE.           06930008
069400*                                                                 06940008
069500*    DETERMINE THE NEXT LEVEL TO READ, BLANK SCREEN FOR DETAIL    06950008
069600*    FIELDS NOT REQUESTED.  SUB-CLASS CHECK FIRST.                06960008
069700*                                                                 06970008
069800     IF  MB118-SCLASS-NBR GREATER THAN ZERO                       06980008
069900         MOVE MDSEAR-DESC      TO  MB118-SCLASS-DESC              06990008
070000         MOVE PC-ZERO          TO  MDSEAR-SUB-CL-NBR              07000008
070100         MOVE PC-MCL           TO  MDSEAR-MDSELV-CDE              07010008
070200         SET MB118-IS-A-SUBCL  TO  TRUE                           07020008
070300         PERFORM 2110-READ-MDSEAR                                 07030008
070400         MOVE DP015-ASK-BRT-OFF                                   07040008
070500                               TO  MB118-SCLASS-ATTR              07050008
070600     ELSE                                                         07060008
070700         SET MB118-IS-NO-SUBCL TO  TRUE                           07070008
070800         MOVE DP015-ASK-DRK-OFF                                   07080008
070900                               TO  MB118-SCLASS-ATTR              07090008
071000     END-IF.                                                      07100008
071100*                                                                 07110008
071200*    MAJOR CLASS NEXT.                                            07120008
071300*                                                                 07130008
071400     IF  MB118-MCLASS-NBR GREATER THAN ZERO                       07140008
071500         MOVE MDSEAR-DESC      TO  MB118-MCLASS-DESC              07150008
071600         MOVE PC-ZERO          TO  MDSEAR-MAJ-CL-NBR              07160008
071700         MOVE PC-DPT           TO  MDSEAR-MDSELV-CDE              07170008
071800         PERFORM 2110-READ-MDSEAR                                 07180008
071900         MOVE DP015-ASK-BRT-OFF                                   07190008
072000                               TO  MB118-MCLASS-ATTR              07200008
072100     ELSE                                                         07210008
072200         MOVE DP015-ASK-DRK-OFF                                   07220008
072300                               TO  MB118-MCLASS-ATTR              07230008
072400     END-IF.                                                      07240008
072500*                                                                 07250008
072600*    DEPARTMENT NEXT.                                             07260008
072700*                                                                 07270008
072800     IF  MB118-DEPT-NBR GREATER THAN ZERO                         07280008
072900         MOVE MDSEAR-DESC      TO  MB118-DEPT-DESC                07290008
073000         MOVE PC-ZERO          TO  MDSEAR-DEPT-NBR                07300008
073100         MOVE PC-DMA           TO  MDSEAR-MDSELV-CDE              07310008
073200         SET MB118-IS-A-DEPT   TO  TRUE                           07320008
073300         PERFORM 2110-READ-MDSEAR                                 07330008
073400         MOVE DP015-ASK-BRT-OFF                                   07340008
073500                               TO  MB118-DEPT-ATTR                07350008
073600     ELSE                                                         07360008
073700         SET MB118-IS-NO-DEPT  TO  TRUE                           07370008
073800         MOVE DP015-ASK-DRK-OFF                                   07380008
073900                               TO  MB118-DEPT-ATTR                07390008
074000     END-IF.                                                      07400008
074100*                                                                 07410008
074200*    NOW THE DMA.                                                 07420008
074300*                                                                 07430008
074400     IF  MB118-DMA-NBR GREATER THAN ZERO                          07440008
074500         MOVE MDSEAR-DESC      TO  MB118-DMA-DESC                 07450008
074600         MOVE DP015-ASK-BRT-OFF                                   07460008
074700                               TO  MB118-DMA-ATTR                 07470008
074800     ELSE                                                         07480008
074900         MOVE DP015-ASK-DRK-OFF                                   07490008
075000                               TO  MB118-DMA-ATTR                 07500008
075100     END-IF.                                                      07510008
075200*                                                                 07520008
075300*    THE GMA IS ALWAYS REQUIRED, UNCONDITIONALLY PERFORM READ.    07530008
075400*                                                                 07540008
075500     MOVE PC-ZERO              TO  MDSEAR-DMA-NBR.                07550008
075600     MOVE PC-GMA               TO  MDSEAR-MDSELV-CDE.             07560008
075700     PERFORM 2110-READ-MDSEAR.                                    07570008
075800     MOVE MDSEAR-DESC          TO  MB118-GMA-DESC.                07580008
075900*                                                                 07590008
076000*    NOW, OBTAIN THE PARENT DATES.                                07600008
076100*                                                                 07610008
076200     MOVE MB118-GMA-NBR        TO  MDSEAR-GMA-NBR.                07620008
076300     MOVE MB118-DMA-NBR        TO  MDSEAR-DMA-NBR.                07630008
076400     MOVE MB118-DEPT-NBR       TO  MDSEAR-DEPT-NBR.               07640008
076500     MOVE MB118-MCLASS-NBR     TO  MDSEAR-MAJ-CL-NBR.             07650008
076600     MOVE MB118-SCLASS-NBR     TO  MDSEAR-SUB-CL-NBR.             07660008
076700*                                                                 07670008
076800     EVALUATE TRUE                                                07680008
076900*                                                                 07690008
077000     WHEN MB118-GMA-IS-PARENT                                     07700008
077100          MOVE PC-ZERO         TO  MDSEAR-DMA-NBR                 07710008
077200          MOVE PC-GMA          TO  MDSEAR-MDSELV-CDE              07720008
077300*                                                                 07730008
077400     WHEN MB118-DMA-IS-PARENT                                     07740008
077500          MOVE PC-ZERO         TO  MDSEAR-DEPT-NBR                07750008
077600          MOVE PC-DMA          TO  MDSEAR-MDSELV-CDE              07760008
077700*                                                                 07770008
077800     WHEN MB118-DPT-IS-PARENT                                     07780008
077900          MOVE PC-ZERO         TO  MDSEAR-MAJ-CL-NBR              07790008
078000          MOVE PC-DPT          TO  MDSEAR-MDSELV-CDE              07800008
078100*                                                                 07810008
078200     WHEN MB118-MCL-IS-PARENT                                     07820008
078300          MOVE PC-ZERO         TO  MDSEAR-SUB-CL-NBR              07830008
078400          MOVE PC-MCL          TO  MDSEAR-MDSELV-CDE              07840008
078500*                                                                 07850008
078600     END-EVALUATE.                                                07860008
078700*                                                                 07870008
078800     IF  MB118-MDS-IS-PARENT                                      07880008
078900         MOVE MDSEAR-STRT-DTE  TO  MB118-PARENT-STRT-DATE         07890008
079000         MOVE MDSEAR-END-DTE   TO  MB118-PARENT-END-DATE          07900008
079100     ELSE                                                         07910008
079200         PERFORM 2120-READ-APLAVL                                 07920008
079300         MOVE APLAVL-MDSEAR-STRT-DTE                              07930008
079400                               TO  MB118-PARENT-STRT-DATE         07940008
079500         MOVE APLAVL-MDSEAR-END-DTE                               07950008
079600                               TO  MB118-PARENT-END-DATE          07960008
079700     END-IF.                                                      07970008
079800*                                                                 07980008
079900     PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                        07990008
080000*                                                                 08000008
080100 EJECT                                                            08010008
080200******************************************************************08020008
080300*    READ THE TMDSEAR TABLE HERE.                                 08030008
080400*                                                                 08040008
080500*    PERFORMED BY 2100.                                           08050008
080600******************************************************************08060008
080700*                                                                 08070008
080800 2110-READ-MDSEAR.                                                08080008
080900*                                                                 08090008
081000     PERFORM                                                      08100008
081100         WITH TEST AFTER                                          08110008
081200         VARYING PV-SQL-SUB                                       08120008
081300         FROM 1 BY 1                                              08130008
081400         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             08140008
081500            OR SQLCODE = 0                                        08150008
081600            OR SQLCODE = +100                                     08160008
081700*                                                                 08170008
081800         EXEC SQL                                                 08180008
081900              SELECT                                              08190008
082000                     MDSEAR_DESC,                                 08200008
082100                     STRT_DTE,                                    08210008
082200                     END_DTE                                      08220008
082300              INTO                                                08230008
082400                     :MDSEAR-DESC,                                08240008
082500                     :MDSEAR-STRT-DTE,                            08250008
082600                     :MDSEAR-END-DTE                              08260008
082700              FROM                                                08270008
082800                     TMDSEAR                                      08280008
082900              WHERE                                               08290008
083000                     OPERCO_NBR     = :PC-COMPANY                 08300008
083100                AND  GMA_NBR        = :MDSEAR-GMA-NBR             08310008
083200                AND  DMA_NBR        = :MDSEAR-DMA-NBR             08320008
083300                AND  DEPT_NBR       = :MDSEAR-DEPT-NBR            08330008
083400                AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR          08340008
083500                AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR          08350008
083600                AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE          08360008
083700         END-EXEC                                                 08370008
083800*                                                                 08380008
083900         EVALUATE TRUE                                            08390008
084000             WHEN SQLCODE = -904                                  08400008
084100             WHEN SQLCODE = -913                                  08410008
084200             WHEN SQLCODE = +100                                  08420008
084300             WHEN SQLCODE = ZERO                                  08430008
084400                  CONTINUE                                        08440008
084500             WHEN SQLWARN0 NOT EQUAL SPACE                        08450008
084600             WHEN SQLCODE NOT EQUAL ZERO                          08460008
084700                  MOVE '2110-READ-MDSEAR'                         08470008
084800                               TO  DP013-PARAGRAPH                08480008
084900                  MOVE 'READ MDSEAR'                              08490008
085000                               TO  DP013-MESSAGE-TEXT (1)         08500008
085100                  MOVE SQLCA   TO  DP013-SQLCA                    08510008
085200                  SET DP013-DB2-ABEND                             08520008
085300                               TO  TRUE                           08530008
085400                  PERFORM DP013-0000-PROCESS-ABEND                08540008
085500         END-EVALUATE                                             08550008
085600     END-PERFORM.                                                 08560008
085700*                                                                 08570008
085800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08580008
085900         MOVE '2110-READ-MDSEAR'                                  08590008
086000                               TO  DP013-PARAGRAPH                08600008
086100         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'              08610008
086200                               TO  DP013-MESSAGE-TEXT (1)         08620008
086300         MOVE SQLCA            TO  DP013-SQLCA                    08630008
086400         SET DP013-DB2-ABEND   TO  TRUE                           08640008
086500         PERFORM DP013-0000-PROCESS-ABEND                         08650008
086600     END-IF.                                                      08660008
086700*                                                                 08670008
086800     IF  SQLCODE EQUAL +100                                       08680008
086900         MOVE 'NOT FOUND'      TO  MDSEAR-DESC                    08690008
087000     END-IF.                                                      08700008
087100*                                                                 08710008
087200 EJECT                                                            08720008
087300******************************************************************08730008
087400*    OBTAIN THE START AND END DATES FOR THE SYSTEM.               08740008
087500*                                                                 08750008
087600*    PERFORMED BY 2100                                            08760008
087700******************************************************************08770008
087800*                                                                 08780008
087900 2120-READ-APLAVL.                                                08790008
088000*                                                                 08800008
088100     PERFORM                                                      08810008
088200         WITH TEST AFTER                                          08820008
088300         VARYING PV-SQL-SUB                                       08830008
088400         FROM 1 BY 1                                              08840008
088500         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             08850008
088600            OR SQLCODE = 0                                        08860008
088700            OR SQLCODE = +100                                     08870008
088800*                                                                 08880008
088900         EXEC SQL                                                 08890008
089000              SELECT                                              08900008
089100                     C.APLSYS_DESC,                               08910008
089200                     B.MDSEAR_STRT_DTE,                           08920008
089300                     B.MDSEAR_END_DTE,                            08930008
089400                     A.MDSEAR_DESC,                               08940008
089500                     A.LIST_SEQ_NBR,                              08950008
089600                     A.MDSEAR_DKEY                                08960008
089700              INTO                                                08970008
089800                     :APLSYS-DESC,                                08980008
089900                     :APLAVL-MDSEAR-STRT-DTE,                     08990008
090000                     :APLAVL-MDSEAR-END-DTE,                      09000008
090100                     :MDSEAR-DESC,                                09010008
090200                     :MDSEAR-LIST-SEQ-NBR,                        09020008
090300                     :MDSEAR-DKEY                                 09030008
090400              FROM                                                09040008
090500                     TMDSEAR A,                                   09050008
090600                     TAPLAVL B,                                   09060008
090700                     TAPLSYS C                                    09070008
090800              WHERE                                               09080008
090900                     A.OPERCO_NBR     = :PC-COMPANY               09090008
091000                AND  B.OPERCO_NBR     = :PC-COMPANY               09100008
091100                AND  C.OPERCO_NBR     = :PC-COMPANY               09110008
091200                AND  A.GMA_NBR        = :MDSEAR-GMA-NBR           09120008
091300                AND  A.DMA_NBR        = :MDSEAR-DMA-NBR           09130008
091400                AND  A.DEPT_NBR       = :MDSEAR-DEPT-NBR          09140008
091500                AND  A.MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR        09150008
091600                AND  A.SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR        09160008
091700                AND  A.MDSELV_CDE     = :MDSEAR-MDSELV-CDE        09170008
091800                AND  A.MDSEAR_DKEY    = B.MDSEAR_DKEY             09180008
091900                AND  B.APLSYS_CDE     = :MB118-APPL-SYS-CODE      09190008
092000                AND  C.APLSYS_CDE     = :MB118-APPL-SYS-CODE      09200008
092100         END-EXEC                                                 09210008
092200*                                                                 09220008
092300         EVALUATE TRUE                                            09230008
092400             WHEN SQLCODE = -904                                  09240008
092500             WHEN SQLCODE = -913                                  09250008
092600             WHEN SQLCODE = +100                                  09260008
092700             WHEN SQLCODE = ZERO                                  09270008
092800                  CONTINUE                                        09280008
092900             WHEN SQLWARN0 NOT EQUAL SPACE                        09290008
093000             WHEN SQLCODE NOT EQUAL ZERO                          09300008
093100                  MOVE '2120-READ-APLAVL'                         09310008
093200                               TO  DP013-PARAGRAPH                09320008
093300                  MOVE 'READ MDSEAR'                              09330008
093400                               TO  DP013-MESSAGE-TEXT (1)         09340008
093500                  MOVE SQLCA   TO  DP013-SQLCA                    09350008
093600                  SET DP013-DB2-ABEND                             09360008
093700                               TO  TRUE                           09370008
093800                  PERFORM DP013-0000-PROCESS-ABEND                09380008
093900         END-EVALUATE                                             09390008
094000     END-PERFORM.                                                 09400008
094100*                                                                 09410008
094200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   09420008
094300         MOVE '2120-READ-APLAVL'                                  09430008
094400                               TO  DP013-PARAGRAPH                09440008
094500         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'              09450008
094600                               TO  DP013-MESSAGE-TEXT (1)         09460008
094700         MOVE SQLCA            TO  DP013-SQLCA                    09470008
094800         SET DP013-DB2-ABEND   TO  TRUE                           09480008
094900         PERFORM DP013-0000-PROCESS-ABEND                         09490008
095000     END-IF.                                                      09500008
095100                                                                  09510008
095200 EJECT                                                            09520008
095300******************************************************************09530008
095400*    SEE IF THE NEW END DATE IS BEFORE A SUBORDINATE START DATE.  09540008
095500*                                                                 09550008
095600*    PERFORMED BY 3300                                            09560008
095700******************************************************************09570008
095800                                                                  09580008
095900 2125-CHECK-START-DATE.                                           09590008
096000                                                                  09600008
096100     MOVE ZERO                 TO  PV-DB2-COUNT.                  09610008
096200     PERFORM                                                      09620008
096300         WITH TEST AFTER                                          09630008
096400         VARYING PV-SQL-SUB                                       09640008
096500         FROM 1 BY 1                                              09650008
096600         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             09660008
096700            OR SQLCODE = 0                                        09670008
096800            OR SQLCODE = +100                                     09680008
096900                                                                  09690008
097000         EXEC SQL                                                 09700008
097100              SELECT                                              09710008
097200                     COUNT(*)                                     09720008
097300              INTO                                                09730008
097400                     :PV-DB2-COUNT                                09740008
097500              FROM                                                09750008
097600                     TMDSEAR A,                                   09760008
097700                     TAPLAVL B                                    09770008
097800              WHERE                                               09780008
097900                    (A.OPERCO_NBR      = :PC-COMPANY              09790008
098000                AND  B.OPERCO_NBR      = :PC-COMPANY              09800008
098100                AND  A.MDSEAR_DKEY     = B.MDSEAR_DKEY            09810008
098200                AND (A.LIST_SEQ_NBR                               09820008
098300                     BETWEEN             :MB118-LIST-SEQ-NBR      09830008
098400                       AND               :MB118-MAX-SEQ-NBR)      09840008
098500                AND  B.MDSEAR_STRT_DTE > :PV-DB2-DATE)            09850008
098600         END-EXEC                                                 09860008
098700                                                                  09870008
098800         EVALUATE TRUE                                            09880008
098900             WHEN SQLCODE = -904                                  09890008
099000             WHEN SQLCODE = -913                                  09900008
099100             WHEN SQLCODE = ZERO                                  09910008
099200             WHEN SQLCODE = +100                                  09920008
099300                  CONTINUE                                        09930008
099400             WHEN SQLWARN0 NOT EQUAL SPACE                        09940008
099500             WHEN SQLCODE NOT EQUAL ZERO                          09950008
099600                  MOVE '2125-CHECK-START-DATE'                    09960008
099700                               TO  DP013-PARAGRAPH                09970008
099800                  MOVE '** COUNT FOR START DATE **'               09980008
099900                               TO  DP013-MESSAGE-TEXT (1)         09990008
100000                  MOVE SQLCA   TO  DP013-SQLCA                    10000008
100100                  SET DP013-DB2-ABEND                             10010008
100200                               TO  TRUE                           10020008
100300                  PERFORM DP013-0000-PROCESS-ABEND                10030008
100400         END-EVALUATE                                             10040008
100500     END-PERFORM.                                                 10050008
100600                                                                  10060008
100700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   10070008
100800         MOVE '2125-CHECK-START-DATE'                             10080008
100900                               TO  DP013-PARAGRAPH                10090008
101000         MOVE 'MAX RETRIES EXCEEDED FOR START DATE COUNT'         10100008
101100                               TO  DP013-MESSAGE-TEXT (1)         10110008
101200         MOVE SQLCA            TO  DP013-SQLCA                    10120008
101300         SET DP013-DB2-ABEND   TO  TRUE                           10130008
101400         PERFORM DP013-0000-PROCESS-ABEND                         10140008
101500     END-IF.                                                      10150008
101600                                                                  10160008
101700 EJECT                                                            10170008
101800******************************************************************10180008
101900*    SEE IF THE NEW START DATE IS AFTER A SUBORDINATE END DATE.   10190008
102000*                                                                 10200008
102100*    PERFORMED BY 3350                                            10210008
102200******************************************************************10220008
102300                                                                  10230008
102400 2126-CHECK-END-DATE.                                             10240008
102500                                                                  10250008
102600     MOVE ZERO                 TO  PV-DB2-COUNT.                  10260008
102700     PERFORM                                                      10270008
102800         WITH TEST AFTER                                          10280008
102900         VARYING PV-SQL-SUB                                       10290008
103000         FROM 1 BY 1                                              10300008
103100         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10310008
103200            OR SQLCODE = 0                                        10320008
103300            OR SQLCODE = +100                                     10330008
103400                                                                  10340008
103500         EXEC SQL                                                 10350008
103600              SELECT                                              10360008
103700                     COUNT(*)                                     10370008
103800              INTO                                                10380008
103900                     :PV-DB2-COUNT                                10390008
104000              FROM                                                10400008
104100                     TMDSEAR A,                                   10410008
104200                     TAPLAVL B                                    10420008
104300              WHERE                                               10430008
104400                    (A.OPERCO_NBR      = :PC-COMPANY              10440008
104500                AND  B.OPERCO_NBR      = :PC-COMPANY              10450008
104600                AND  A.MDSEAR_DKEY     = B.MDSEAR_DKEY            10460008
104700                AND (A.LIST_SEQ_NBR                               10470008
104800                     BETWEEN             :MB118-LIST-SEQ-NBR      10480008
104900                       AND               :MB118-MAX-SEQ-NBR)      10490008
105000                AND  B.MDSEAR_END_DTE  < :PV-DB2-DATE)            10500008
105100         END-EXEC                                                 10510008
105200                                                                  10520008
105300         EVALUATE TRUE                                            10530008
105400             WHEN SQLCODE = -904                                  10540008
105500             WHEN SQLCODE = -913                                  10550008
105600             WHEN SQLCODE = ZERO                                  10560008
105700             WHEN SQLCODE = +100                                  10570008
105800                  CONTINUE                                        10580008
105900             WHEN SQLWARN0 NOT EQUAL SPACE                        10590008
106000             WHEN SQLCODE NOT EQUAL ZERO                          10600008
106100                  MOVE '2126-CHECK-END-DATE'                      10610008
106200                               TO  DP013-PARAGRAPH                10620008
106300                  MOVE '** COUNT FOR END DATE   **'               10630008
106400                               TO  DP013-MESSAGE-TEXT (1)         10640008
106500                  MOVE SQLCA   TO  DP013-SQLCA                    10650008
106600                  SET DP013-DB2-ABEND                             10660008
106700                               TO  TRUE                           10670008
106800                  PERFORM DP013-0000-PROCESS-ABEND                10680008
106900         END-EVALUATE                                             10690008
107000     END-PERFORM.                                                 10700008
107100                                                                  10710008
107200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   10720008
107300         MOVE '2126-CHECK-END-DATE'                               10730008
107400                               TO  DP013-PARAGRAPH                10740008
107500         MOVE 'MAX RETRIES EXCEEDED FOR END DATE COUNT'           10750008
107600                               TO  DP013-MESSAGE-TEXT (1)         10760008
107700         MOVE SQLCA            TO  DP013-SQLCA                    10770008
107800         SET DP013-DB2-ABEND   TO  TRUE                           10780008
107900         PERFORM DP013-0000-PROCESS-ABEND                         10790008
108000     END-IF.                                                      10800008
108100                                                                  10810008
108200*                                                                 10820008
108300 EJECT                                                            10830008
108400******************************************************************10840008
108500*    DETERMINE WHETHER ONLY THE SPECIFIC APPLICATION SYSTEM DATES 10850008
108600*    ARE TO BE CHANGED OR ALL SUBORDINATE AREAS AS WELL.          10860008
108700*    FOR ALL AREAS OPEN THE CURSOR, NEXT FETCH THE DATA, FINALLY  10870008
108800*    UPDATE THE START AND/OR END DATES.                           10880008
108900*                                                                 10890008
109000*    PERFORMED BY 3100                                            10900008
109100******************************************************************10910008
109200*                                                                 10920008
109300 2130-UPDATE-APLAVL.                                              10930008
109400*                                                                 10940008
109500     IF (APLAVL-MDSEAR-STRT-DTE GREATER THAN MB118-ORIG-STRT-DATE 10950008
109600     OR  APLAVL-MDSEAR-END-DTE LESS THAN MB118-ORIG-END-DATE)     10960008
109700        PERFORM 2140-UPDATE-SUBORDINATES                          10970008
109800     ELSE                                                         10980008
109900        MOVE MB118-MDSEAR-DKEY TO  MDSEAR-DKEY                    10990008
110000        MOVE APLAVL-MDSEAR-STRT-DTE                               11000008
110100                               TO  MDSEAR-STRT-DTE                11010008
110200        MOVE APLAVL-MDSEAR-END-DTE                                11020008
110300                               TO  MDSEAR-END-DTE                 11030008
110400        PERFORM 2160-UPDATE-SPECIFIC                              11040008
110500     END-IF.                                                      11050008
110600*                                                                 11060008
110700     IF  PS-ERROR                                                 11070008
110800         MOVE PC-TSYMSG-00148  TO  DP020-MSG-NUMBER               11080008
110900         SET DP020-MSG-FATAL   TO  TRUE                           11090008
111000         MOVE -1               TO  ANAVCMDL                       11100008
111100     ELSE                                                         11110008
111200         MOVE PC-TSYMSG-00059  TO  DP020-MSG-NUMBER               11120008
111300         SET DP020-MSG-INFORMATIONAL                              11130008
111400                               TO  TRUE                           11140008
111500         MOVE MB118-SAVE-LIST-QUEUE                               11150008
111600                               TO  MA-LIST-RECORD                 11160008
111700         SET MB023-UPD (MB118-MA-SUB)                             11170008
111800                               TO  TRUE                           11180008
111900         MOVE MA-LIST-RECORD   TO  MB118-SAVE-LIST-QUEUE          11190008
112000     END-IF.                                                      11200008
112100*                                                                 11210008
112200 EJECT                                                            11220008
112300******************************************************************11230008
112400*    OPEN THE CURSOR FOR ALL AREAS, NEXT FETCH THE DATA, FINALLY  11240008
112500*    UPDATE THE START/END DATES.                                  11250008
112600*                                                                 11260008
112700*    PERFORMED BY 2130                                            11270008
112800******************************************************************11280008
112900*                                                                 11290008
113000 2140-UPDATE-SUBORDINATES.                                        11300008
113100*                                                                 11310008
113200     PERFORM 2145-OPEN-CURSOR.                                    11320008
113300     IF  PS-NO-ERROR                                              11330008
113400         PERFORM 2150-ACTUAL-SUBORDINATE-UPDATE                   11340008
113500                 UNTIL SQLCODE NOT EQUAL ZERO                     11350008
113600     END-IF.                                                      11360008
113700*                                                                 11370008
113800     PERFORM                                                      11380008
113900         WITH TEST AFTER                                          11390008
114000         VARYING PV-SQL-SUB                                       11400008
114100         FROM 1 BY 1                                              11410008
114200         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             11420008
114300            OR SQLCODE = 0                                        11430008
114400            OR SQLCODE = +100                                     11440008
114500*                                                                 11450008
114600         EXEC SQL                                                 11460008
114700              CLOSE  SUBORDINATE-CURSOR                           11470008
114800         END-EXEC                                                 11480008
114900*                                                                 11490008
115000         EVALUATE TRUE                                            11500008
115100             WHEN SQLCODE = -904                                  11510008
115200             WHEN SQLCODE = -913                                  11520008
115300             WHEN SQLCODE = +100                                  11530008
115400             WHEN SQLCODE = ZERO                                  11540008
115500                  CONTINUE                                        11550008
115600             WHEN SQLWARN0 NOT EQUAL SPACE                        11560008
115700             WHEN SQLCODE NOT EQUAL ZERO                          11570008
115800                  MOVE '2140-UPDATE-SUBORDINATE'                  11580008
115900                               TO  DP013-PARAGRAPH                11590008
116000                  MOVE 'CLOSE SUBORDINATE CURSOR'                 11600008
116100                               TO  DP013-MESSAGE-TEXT (1)         11610008
116200                  MOVE SQLCA   TO  DP013-SQLCA                    11620008
116300                  SET DP013-DB2-ABEND                             11630008
116400                               TO  TRUE                           11640008
116500                  PERFORM DP013-0000-PROCESS-ABEND                11650008
116600         END-EVALUATE                                             11660008
116700     END-PERFORM.                                                 11670008
116800*                                                                 11680008
116900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11690008
117000         MOVE '2140-UPDATE-SUBORDINATE'                           11700008
117100                               TO  DP013-PARAGRAPH                11710008
117200         MOVE 'MAX RETRIES EXCEEDED FOR CLOSE SUB CURSOR'         11720008
117300                               TO  DP013-MESSAGE-TEXT (1)         11730008
117400         MOVE SQLCA            TO  DP013-SQLCA                    11740008
117500         SET DP013-DB2-ABEND   TO  TRUE                           11750008
117600         PERFORM DP013-0000-PROCESS-ABEND                         11760008
117700     END-IF.                                                      11770008
117800*                                                                 11780008
117900 EJECT                                                            11790008
118000******************************************************************11800008
118100*    OPEN THE CURSOR FOR ALL AREAS.                               11810008
118200*                                                                 11820008
118300*    PERFORMED BY 2140                                            11830008
118400******************************************************************11840008
118500*                                                                 11850008
118600 2145-OPEN-CURSOR.                                                11860008
118700*                                                                 11870008
118800     PERFORM                                                      11880008
118900         WITH TEST AFTER                                          11890008
119000         VARYING PV-SQL-SUB                                       11900008
119100         FROM 1 BY 1                                              11910008
119200         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             11920008
119300            OR SQLCODE = 0                                        11930008
119400            OR SQLCODE = +100                                     11940008
119500*                                                                 11950008
119600         EXEC SQL                                                 11960008
119700              OPEN   SUBORDINATE-CURSOR                           11970008
119800         END-EXEC                                                 11980008
119900*                                                                 11990008
120000         EVALUATE TRUE                                            12000008
120100             WHEN SQLCODE = -904                                  12010008
120200             WHEN SQLCODE = -913                                  12020008
120300             WHEN SQLCODE = +100                                  12030008
120400             WHEN SQLCODE = ZERO                                  12040008
120500                  CONTINUE                                        12050008
120600             WHEN SQLWARN0 NOT EQUAL SPACE                        12060008
120700             WHEN SQLCODE NOT EQUAL ZERO                          12070008
120800                  MOVE '2145-OPEN-CURSOR'                         12080008
120900                               TO  DP013-PARAGRAPH                12090008
121000                  MOVE 'OPEN SUBORDINATE CURSOR'                  12100008
121100                               TO  DP013-MESSAGE-TEXT (1)         12110008
121200                  MOVE SQLCA   TO  DP013-SQLCA                    12120008
121300                  SET DP013-DB2-ABEND                             12130008
121400                               TO  TRUE                           12140008
121500                  PERFORM DP013-0000-PROCESS-ABEND                12150008
121600         END-EVALUATE                                             12160008
121700     END-PERFORM.                                                 12170008
121800*                                                                 12180008
121900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   12190008
122000         MOVE '2140-OPEN-CURSOR'                                  12200008
122100                               TO  DP013-PARAGRAPH                12210008
122200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SUB CURSOR'          12220008
122300                               TO  DP013-MESSAGE-TEXT (1)         12230008
122400         MOVE SQLCA            TO  DP013-SQLCA                    12240008
122500         SET DP013-DB2-ABEND   TO  TRUE                           12250008
122600         PERFORM DP013-0000-PROCESS-ABEND                         12260008
122700     END-IF.                                                      12270008
122800*                                                                 12280008
122900 EJECT                                                            12290008
123000******************************************************************12300008
123100*    FETCH THE NEXT ROW AND UPDATE THE START/END DATES.           12310008
123200*                                                                 12320008
123300*    PERFORMED BY 2160                                            12330008
123400******************************************************************12340008
123500*                                                                 12350008
123600 2150-ACTUAL-SUBORDINATE-UPDATE.                                  12360008
123700*                                                                 12370008
123800     PERFORM 2155-FETCH-CURSOR.                                   12380008
123900     IF  SQLCODE EQUAL ZERO                                       12390008
124000         PERFORM 2160-UPDATE-SPECIFIC                             12400008
124100     END-IF.                                                      12410008
124200*                                                                 12420008
124300 EJECT                                                            12430008
124400******************************************************************12440008
124500*    FETCH THE NEXT ROW AND UPDATE THE START/END DATES.           12450008
124600*                                                                 12460008
124700*    PERFORMED BY 2150                                            12470008
124800******************************************************************12480008
124900*                                                                 12490008
125000 2155-FETCH-CURSOR.                                               12500008
125100*                                                                 12510008
125200     PERFORM                                                      12520008
125300         WITH TEST AFTER                                          12530008
125400         VARYING PV-SQL-SUB                                       12540008
125500         FROM 1 BY 1                                              12550008
125600         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             12560008
125700            OR SQLCODE = 0                                        12570008
125800            OR SQLCODE = +100                                     12580008
125900*                                                                 12590008
126000         EXEC SQL                                                 12600008
126100              FETCH                                               12610008
126200                     SUBORDINATE-CURSOR                           12620008
126300              INTO                                                12630008
126400                     :MDSEAR-DKEY,                                12640008
126500                     :MDSEAR-STRT-DTE,                            12650008
126600                     :MDSEAR-END-DTE                              12660008
126700         END-EXEC                                                 12670008
126800*                                                                 12680008
126900         EVALUATE TRUE                                            12690008
127000             WHEN SQLCODE = -904                                  12700008
127100             WHEN SQLCODE = -913                                  12710008
127200             WHEN SQLCODE = +100                                  12720008
127300             WHEN SQLCODE = ZERO                                  12730008
127400                  CONTINUE                                        12740008
127500             WHEN SQLWARN0 NOT EQUAL SPACE                        12750008
127600             WHEN SQLCODE NOT EQUAL ZERO                          12760008
127700                  MOVE '2155-FETCH-CURSOR'                        12770008
127800                               TO  DP013-PARAGRAPH                12780008
127900                  MOVE 'FETCH SUBORDINATE CURSOR'                 12790008
128000                               TO  DP013-MESSAGE-TEXT (1)         12800008
128100                  MOVE SQLCA   TO  DP013-SQLCA                    12810008
128200                  SET DP013-DB2-ABEND                             12820008
128300                               TO  TRUE                           12830008
128400                  PERFORM DP013-0000-PROCESS-ABEND                12840008
128500         END-EVALUATE                                             12850008
128600     END-PERFORM.                                                 12860008
128700*                                                                 12870008
128800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   12880008
128900         MOVE '2155-FETCH-CURSOR'                                 12890008
129000                               TO  DP013-PARAGRAPH                12900008
129100         MOVE 'MAX RETRIES EXCEEDED FOR FETCH SUB CURSOR'         12910008
129200                               TO  DP013-MESSAGE-TEXT (1)         12920008
129300         MOVE SQLCA            TO  DP013-SQLCA                    12930008
129400         SET DP013-DB2-ABEND   TO  TRUE                           12940008
129500         PERFORM DP013-0000-PROCESS-ABEND                         12950008
129600     END-IF.                                                      12960008
129700*                                                                 12970008
129800 EJECT                                                            12980008
129900******************************************************************12990008
130000*    THIS PARAGRAPH UPDATES THE DATES FOR ONE ROW AT A TIME,      13000008
130100*    EITHER FOR THE SPECIFIC APPLICATION OR IT AND ALL SUB-       13010008
130200*    ORDINATE AREAS.                                              13020008
130300*    CHECK TO SEE WE DON'T UPDATE START OR END DATES THAT         13030008
130400*    SHOULDN'T BE UPDATED.                                        13040008
130500*    APLAVL- DATE FIELDS CONTAIN THE SCREEN DATES.                13050008
130600*    MDSEAR- DATE FIELDS CONTAIN WHAT WAS RETURNED FROM THE DB.   13060008
130700*                                                                 13070008
130800*    PERFORMED BY 2130, 2150                                      13080008
130900******************************************************************13090008
131000*                                                                 13100008
131100 2160-UPDATE-SPECIFIC.                                            13110008
131200*                                                                 13120008
131300     IF  MDSEAR-STRT-DTE LESS APLAVL-MDSEAR-STRT-DTE              13130008
131400         MOVE APLAVL-MDSEAR-STRT-DTE                              13140008
131500                               TO  MDSEAR-STRT-DTE                13150008
131600     END-IF.                                                      13160008
131700*                                                                 13170008
131800     IF  MDSEAR-END-DTE GREATER APLAVL-MDSEAR-END-DTE             13180008
131900         MOVE APLAVL-MDSEAR-END-DTE                               13190008
132000                               TO  MDSEAR-END-DTE                 13200008
132100     END-IF.                                                      13210008
132200*                                                                 13220008
132300     PERFORM                                                      13230008
132400         WITH TEST AFTER                                          13240008
132500         VARYING PV-SQL-SUB                                       13250008
132600         FROM 1 BY 1                                              13260008
132700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             13270008
132800            OR SQLCODE = 0                                        13280008
132900            OR SQLCODE = +100                                     13290008
133000*                                                                 13300008
133100         EXEC SQL                                                 13310008
133200              UPDATE                                              13320008
133300                     TAPLAVL                                      13330008
133400              SET                                                 13340008
133500                     MDSEAR_STRT_DTE  = :MDSEAR-STRT-DTE,         13350008
133600                     MDSEAR_END_DTE   = :MDSEAR-END-DTE           13360008
133700              WHERE                                               13370008
133800                     MDSEAR_DKEY      = :MDSEAR-DKEY              13380008
133900                AND  APLSYS_CDE       = :MB118-APPL-SYS-CODE      13390008
134000         END-EXEC                                                 13400008
134100*                                                                 13410008
134200         EVALUATE TRUE                                            13420008
134300             WHEN SQLCODE = -904                                  13430008
134400             WHEN SQLCODE = -913                                  13440008
134500             WHEN SQLCODE = +100                                  13450008
134600             WHEN SQLCODE = ZERO                                  13460008
134700                  CONTINUE                                        13470008
134800             WHEN SQLWARN0 NOT EQUAL SPACE                        13480008
134900             WHEN SQLCODE NOT EQUAL ZERO                          13490008
135000                  MOVE '2160-UPDATE-SPEFIC'                       13500008
135100                               TO  DP013-PARAGRAPH                13510008
135200                  MOVE 'READ MDSEAR'                              13520008
135300                               TO  DP013-MESSAGE-TEXT (1)         13530008
135400                  MOVE SQLCA   TO  DP013-SQLCA                    13540008
135500                  SET DP013-DB2-ABEND                             13550008
135600                               TO  TRUE                           13560008
135700                  PERFORM DP013-0000-PROCESS-ABEND                13570008
135800         END-EVALUATE                                             13580008
135900     END-PERFORM.                                                 13590008
136000*                                                                 13600008
136100     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   13610008
136200         MOVE '2160-UPDATE-SPECIFIC'                              13620008
136300                               TO  DP013-PARAGRAPH                13630008
136400         MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'              13640008
136500                               TO  DP013-MESSAGE-TEXT (1)         13650008
136600         MOVE SQLCA            TO  DP013-SQLCA                    13660008
136700         SET DP013-DB2-ABEND   TO  TRUE                           13670008
136800         PERFORM DP013-0000-PROCESS-ABEND                         13680008
136900     END-IF.                                                      13690008
137000*                                                                 13700008
137100     IF  SQLCODE EQUAL +100                                       13710008
137200         SET PS-ERROR          TO  TRUE                           13720008
137300     END-IF.                                                      13730008
137400*                                                                 13740008
137500 EJECT                                                            13750008
137600******************************************************************13760008
137700*    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED  13770008
137800*    MERCHANDISE DEPARTMENTS FROM MBKCS123 (MERCH DEPT DISCNT LST)13780008
137900*                                                                 13790008
138000*    PERFORMED BY 2000, 2180                                      13800008
138100******************************************************************13810008
138200*                                                                 13820008
138300 2170-READ-LIST-QUEUE.                                            13830008
138400*                                                                 13840008
138500     EXEC CICS                                                    13850008
138600         READQ TS                                                 13860008
138700         QUEUE(MB005-LIST-QUEUE-NAME)                             13870008
138800         INTO(MA-LIST-RECORD)                                     13880008
138900         LENGTH(MB005-LIST-QUEUE-LENGTH)                          13890008
139000         ITEM(MB118-MA-ITEM)                                      13900008
139100         RESP(PV-RESP)                                            13910008
139200     END-EXEC.                                                    13920008
139300*                                                                 13930008
139400     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            13940008
139500     OR  PV-RESP EQUAL DFHRESP(QIDERR)                            13950008
139600         CONTINUE                                                 13960008
139700     ELSE                                                         13970008
139800         MOVE PV-RESP          TO  PM-RESP-22                     13980008
139900         SET DP013-LOGIC-ABEND TO  TRUE                           13990008
140000         SET DP013-NO-ROLLBACK TO  TRUE                           14000008
140100         MOVE '2170-READ-LIST-QUEUE'                              14010008
140200                               TO  DP013-PARAGRAPH                14020008
140300         MOVE PM-PROGRAM-MESSAGE-22                               14030008
140400                               TO  DP013-MESSAGE-TEXT (1)         14040008
140500         PERFORM DP013-0000-PROCESS-ABEND                         14050008
140600     END-IF.                                                      14060008
140700*                                                                 14070008
140800 EJECT                                                            14080008
140900******************************************************************14090008
141000*    READ THE TEMP STORAGE QUEUE, GET THE NEXT BUSINESS GROUP.    14100008
141100*    IF AT END, RETURN TO CALLING PROGRAM, ELSE, CONTINUE.        14110008
141200*                                                                 14120008
141300*    PERFORMED BY 3000                                            14130008
141400******************************************************************14140008
141500*                                                                 14150008
141600 2180-GET-NEXT-MDSEAR.                                            14160008
141700*                                                                 14170008
141800     ADD 1                     TO  MB118-MA-SUB.                  14180008
141900     IF  MB118-MA-SUB GREATER THAN MB023-MAX-ITEMS                14190008
142000         PERFORM 2190-REWRITE-LIST-QUEUE                          14200008
142100         ADD 1                 TO  MB118-MA-ITEM                  14210008
142200         MOVE 1                TO  MB118-MA-SUB                   14220008
142300         PERFORM 2170-READ-LIST-QUEUE                             14230008
142400         MOVE MA-LIST-RECORD       TO  MB118-SAVE-LIST-QUEUE      14240008
142500     ELSE                                                         14250008
142600         MOVE MB118-SAVE-LIST-QUEUE                               14260008
142700                                   TO  MA-LIST-RECORD             14270008
142800     END-IF.                                                      14280008
142900*                                                                 14290008
143000     IF  MB023-KEY-DATA (MB118-MA-SUB) GREATER THAN SPACES        14300008
143100         MOVE MB023-KEY-DATA (MB118-MA-SUB)                       14310008
143200                               TO  MB118-KEY-DATA                 14320008
143300         MOVE MB023-APPL-SYS-CDE (MB118-MA-SUB)                   14330008
143400                               TO  MB118-APPL-SYS-CODE            14340008
143500         SET MB023-INQ (MB118-MA-SUB)                             14350008
143600                               TO  TRUE                           14360008
143700         MOVE MA-LIST-RECORD   TO  MB118-SAVE-LIST-QUEUE          14370008
143800         MOVE LOW-VALUES       TO  MB118-END-DATE                 14380008
143900         PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                     14390008
144000     ELSE                                                         14400008
144100         PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                     14410008
144200         SUBTRACT 1          FROM  MB118-MA-SUB                   14420008
144300         MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER               14430008
144400         SET DP020-MSG-INFORMATIONAL                              14440008
144500                               TO  TRUE                           14450008
144600     END-IF.                                                      14460008
144700     SET PS-SEND-MAP-N-DATA-FRSET                                 14470008
144800                               TO  TRUE.                          14480008
144900*                                                                 14490008
145000 EJECT                                                            14500008
145100******************************************************************14510008
145200*    UPDATE THE LIST QUEUE RECORD TO REFLECT "INQ" OR "UPD"       14520008
145300*    STATUS.                                                      14530008
145400*                                                                 14540008
145500*    PERFORMED BY 2180, 3100                                      14550008
145600******************************************************************14560008
145700*                                                                 14570008
145800 2190-REWRITE-LIST-QUEUE.                                         14580008
145900*                                                                 14590008
146000     EXEC CICS                                                    14600008
146100         WRITEQ TS                                                14610008
146200         QUEUE(MB005-LIST-QUEUE-NAME)                             14620008
146300         FROM(MB118-SAVE-LIST-QUEUE)                              14630008
146400         LENGTH(MB005-LIST-QUEUE-LENGTH)                          14640008
146500         ITEM(MB118-MA-ITEM)                                      14650008
146600         RESP(PV-RESP)                                            14660008
146700         REWRITE                                                  14670008
146800     END-EXEC.                                                    14680008
146900*                                                                 14690008
147000     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            14700008
147100         CONTINUE                                                 14710008
147200     ELSE                                                         14720008
147300         MOVE PV-RESP          TO  PM-RESP-22                     14730008
147400         SET DP013-LOGIC-ABEND TO  TRUE                           14740008
147500         SET DP013-NO-ROLLBACK TO  TRUE                           14750008
147600         MOVE '2190-REWRITE-LIST-QUEUE'                           14760008
147700                               TO  DP013-PARAGRAPH                14770008
147800         MOVE PM-PROGRAM-MESSAGE-22                               14780008
147900                               TO  DP013-MESSAGE-TEXT (1)         14790008
148000         PERFORM DP013-0000-PROCESS-ABEND                         14800008
148100     END-IF.                                                      14810008
148200*                                                                 14820008
148300 EJECT                                                            14830008
148400******************************************************************14840008
148500*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.       14850008
148600*                                                                 14860008
148700*    PERFORMED BY 1000-CONTROL-PROCESSING.                        14870008
148800*    PERFORMED BY 3000-PROCESS-PANEL.                             14880008
148900******************************************************************14890008
149000*                                                                 14900008
149100 2200-DISPLAY-PANEL.                                              14910008
149200*                                                                 14920008
149300     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       14930008
149400     MOVE DP017-EDITED-TIME-HMS                                   14940008
149500                               TO  ATIMEO.                        14950008
149600     IF  MB118-CANT-MODIFY-STRT-DATE                              14960008
149700         MOVE DP015-HL-OFF     TO  ASTRTMMH                       14970008
149800                                   ASTRTDDH                       14980008
149900                                   ASTRTYYH                       14990008
150000         MOVE DP015-ASK-NOR-OFF                                   15000008
150100                               TO  ASTRTMMA                       15010008
150200                                   ASTRTDDA                       15020008
150300                                   ASTRTYYA                       15030008
150400         MOVE DP015-BLUE       TO  ASTRTMMC                       15040008
150500                                   ASTRTDDC                       15050008
150600                                   ASTRTYYC                       15060008
150700         MOVE -1               TO  AENDMML                        15070008
150800     ELSE                                                         15080008
150900         IF  PS-NO-ERROR                                          15090008
151000             MOVE -1           TO  ASTRTMML                       15100008
151100         END-IF                                                   15110008
151200     END-IF.                                                      15120008
151300*                                                                 15130008
151400     IF  PS-SEND-MAP-N-DATA-FRSET                                 15140008
151500         PERFORM DP002-0000-FORMAT-TITLE-LINES                    15150008
151600         PERFORM DP009-0000-LOAD-FK-LINES                         15160008
151700     END-IF.                                                      15170008
151800*                                                                 15180008
151900     PERFORM DP005-0000-FORMAT-MSG-LINES.                         15190008
152000                                                                  15200008
152100     PERFORM DP008-0000-WRITE-PANEL.                              15210008
152200*                                                                 15220008
152300 EJECT                                                            15230008
152400******************************************************************15240008
152500*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED  15250008
152600*    ON WHAT FUNCTION KEY WAS SELECTED.                           15260008
152700*                                                                 15270008
152800*    PERFORMED BY 1000-CONTROL-PROCESSING.                        15280008
152900******************************************************************15290008
153000*                                                                 15300008
153100 3000-PROCESS-PANEL.                                              15310008
153200*                                                                 15320008
153300     PERFORM DP007-0000-GET-PANEL.                                15330008
153400     SET PS-SEND-DATA-ONLY-FRSET                                  15340008
153500                               TO TRUE.                           15350008
153600     PERFORM 3100-CHECK-LOCAL-FKEYS.                              15360008
153700*                                                                 15370008
153800 EJECT                                                            15380008
153900******************************************************************15390008
154000*   DETERMINE THE PROCESSING PATH HERE.                           15400008
154100*                                                                 15410008
154200*   PERFORMED BY 3000.                                            15420008
154300******************************************************************15430008
154400*                                                                 15440008
154500 3100-CHECK-LOCAL-FKEYS.                                          15450008
154600*                                                                 15460008
154700     EVALUATE TRUE                                                15470008
154800*                                                                 15480008
154900         WHEN DP020-SRC-AID = DP016-CLEAR                         15490008
155000             SET PS-SEND-MAP-N-DATA-FRSET                         15500008
155100                               TO  TRUE                           15510008
155200             PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                 15520008
155300             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   15530008
155400             PERFORM 2200-DISPLAY-PANEL                           15540008
155500*                                                                 15550008
155600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     15560008
155700             MOVE SPACES       TO  ANAVCMDO                       15570008
155800                                   ANAVKEYO                       15580008
155900                                   AENDMMO                        15590008
156000                                   AENDDDO                        15600008
156100                                   AENDYYO                        15610008
156200             MOVE LOW-VALUES   TO  MB118-END-DATE                 15620008
156300             SET PS-SEND-MAP-N-DATA-FRSET                         15630008
156400                               TO  TRUE                           15640008
156500             PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                 15650008
156600             PERFORM 2200-DISPLAY-PANEL                           15660008
156700*                                                                 15670008
156800*    "NEXT" PROCESSING - POSITION TO NEXT MERCH AREA CODE         15680008
156900*                                                                 15690008
157000         WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)              15700008
157100             IF  MB118-IS-A-LIST                                  15710008
157200                 SET PS-SEND-MAP-N-DATA-FRSET                     15720008
157300                               TO  TRUE                           15730008
157400                 PERFORM 2180-GET-NEXT-MDSEAR                     15740008
157500             ELSE                                                 15750008
157600                 MOVE PC-TSYMSG-00070                             15760008
157700                               TO  DP020-MSG-NUMBER               15770008
157800                 SET DP020-MSG-INFORMATIONAL                      15780008
157900                               TO  TRUE                           15790008
158000             END-IF                                               15800008
158100             PERFORM 2200-DISPLAY-PANEL                           15810008
158200*                                                                 15820008
158300         WHEN DP020-SRC-AID = DP016-PA2                           15830008
158400             PERFORM DP009-0000-LOAD-FK-LINES                     15840008
158500             PERFORM DP017-0000-GET-CURR-DATE-TIME                15850008
158600             SET PS-SEND-DATA-ONLY                                15860008
158700                               TO  TRUE                           15870008
158800             MOVE -1           TO  ANAVCMDL                       15880008
158900             PERFORM DP008-0000-WRITE-PANEL                       15890008
159000*                                                                 15900008
159100         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      15910008
159200              IF  MB118-IS-A-LIST                                 15920008
159300                  PERFORM 2190-REWRITE-LIST-QUEUE                 15930008
159400              END-IF                                              15940008
159500              PERFORM 4000-NAVIGATE                               15950008
159600*                                                                 15960008
159700         WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                  15970008
159800              PERFORM 4000-NAVIGATE                               15980008
159900*                                                                 15990008
160000         WHEN DP020-SRC-AID = DP016-ENTER                         16000008
160100             IF  DP020-NAV-MNEMONIC GREATER THAN SPACES           16010008
160200                 PERFORM 4000-NAVIGATE                            16020008
160300             ELSE                                                 16030008
160400                 PERFORM 3200-MOVE-SCREEN-TO-COMMAREA             16040008
160500                 PERFORM 3300-EDIT-DATA-IN-COMMAREA               16050008
160600                 PERFORM 2200-DISPLAY-PANEL                       16060008
160700             END-IF                                               16070008
160800*                                                                 16080008
160900*     UPDATE PROCESSING                                           16090008
161000*                                                                 16100008
161100         WHEN DP020-SRC-AID = DP016-PF15                          16110008
161200             PERFORM 3200-MOVE-SCREEN-TO-COMMAREA                 16120008
161300             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   16130008
161400             IF  PS-NO-ERROR                                      16140008
161500                 PERFORM 2130-UPDATE-APLAVL                       16150008
161600             END-IF                                               16160008
161700             PERFORM 2200-DISPLAY-PANEL                           16170008
161800*                                                                 16180008
161900         WHEN OTHER                                               16190008
162000             PERFORM 3200-MOVE-SCREEN-TO-COMMAREA                 16200008
162100             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   16210008
162200             MOVE PC-TSYMSG-00045                                 16220008
162300                               TO  DP020-MSG-NUMBER               16230008
162400             SET DP020-MSG-FATAL                                  16240008
162500                               TO  TRUE                           16250008
162600             MOVE -1           TO  ANAVCMDL                       16260008
162700             PERFORM 2200-DISPLAY-PANEL                           16270008
162800     END-EVALUATE.                                                16280008
162900*                                                                 16290008
163000 EJECT                                                            16300008
163100******************************************************************16310008
163200*    HERE WE SIMPLY MOVE DATA ENTERED ON THE SCREEN TO THE COMM   16320008
163300*    AREA.                                                        16330008
163400*                                                                 16340008
163500*    PERFORMED BY 3000                                            16350008
163600******************************************************************16360008
163700*                                                                 16370008
163800 3200-MOVE-SCREEN-TO-COMMAREA.                                    16380008
163900*                                                                 16390008
164000     IF (ASTRTMML GREATER THAN ZERO                               16400008
164100     OR  ASTRTMMA EQUAL PC-ERASE-EOF)                             16410008
164200         MOVE ASTRTMMI         TO  MB118-SD-MM                    16420008
164300     END-IF.                                                      16430008
164400*                                                                 16440008
164500     IF (ASTRTDDL GREATER THAN ZERO                               16450008
164600     OR  ASTRTDDA EQUAL PC-ERASE-EOF)                             16460008
164700         MOVE ASTRTDDI         TO  MB118-SD-DD                    16470008
164800     END-IF.                                                      16480008
164900*                                                                 16490008
165000     IF (ASTRTYYL GREATER THAN ZERO                               16500008
165100     OR  ASTRTYYA EQUAL PC-ERASE-EOF)                             16510008
165200         MOVE ASTRTYYI         TO  MB118-SD-YY                    16520008
165210         IF  ASTRTYYA EQUAL PC-ERASE-EOF                          16521012
165220             MOVE SPACES TO MB118-SD-CC                           16522012
165230         END-IF                                                   16523012
165300     END-IF.                                                      16530008
165400*                                                                 16540008
165500     IF (AENDMML GREATER THAN ZERO                                16550008
165600     OR  AENDMMA EQUAL PC-ERASE-EOF)                              16560008
165700         MOVE AENDMMI          TO  MB118-ED-MM                    16570008
165800     END-IF.                                                      16580008
165900*                                                                 16590008
166000     IF (AENDDDL GREATER THAN ZERO                                16600008
166100     OR  AENDDDA EQUAL PC-ERASE-EOF)                              16610008
166200         MOVE AENDDDI          TO  MB118-ED-DD                    16620008
166300     END-IF.                                                      16630008
166400*                                                                 16640008
166500     IF (AENDYYL GREATER THAN ZERO                                16650008
166600     OR  AENDYYA EQUAL PC-ERASE-EOF)                              16660008
167400        MOVE AENDYYI          TO  MB118-ED-YY                     16740008
167410        IF  AENDYYA EQUAL PC-ERASE-EOF                            16741012
167420            MOVE SPACES TO MB118-ED-CC                            16742012
167470        END-IF                                                    16747012
167500     END-IF.                                                      16750008
167600*                                                                 16760008
167700 EJECT                                                            16770008
167800******************************************************************16780008
167900*    HERE WE SIMPLY ENSURE THE DATA IS CORRECT.  IF NOT, ISSUE    16790008
168000*    APPROPRIATE ERRORS.                                          16800008
168100*                                                                 16810008
168200*    PERFORMED BY 3000                                            16820008
168300******************************************************************16830008
168400*                                                                 16840008
168500 3300-EDIT-DATA-IN-COMMAREA.                                      16850008
168600*                                                                 16860008
168700     SET PS-NO-ERROR           TO  TRUE.                          16870008
168800     SET PS-VALID-DATE         TO  TRUE.                          16880008
168900*                                                                 16890008
169000     IF  MB118-CAN-MODIFY-STRT-DATE                               16900008
169100         MOVE DP015-GREEN      TO  ASTRTMMC                       16910008
169200                                   ASTRTDDC                       16920008
169300                                   ASTRTYYC                       16930008
169400         MOVE DP015-UNDERLINE  TO  ASTRTMMH                       16940008
169500                                   ASTRTDDH                       16950008
169600                                   ASTRTYYH                       16960008
169700     END-IF                                                       16970008
169800*                                                                 16980008
169900     MOVE DP015-GREEN          TO  AENDMMC                        16990008
170000                                   AENDDDC                        17000008
170100                                   AENDYYC.                       17010008
170200     MOVE DP015-UNDERLINE      TO  AENDMMH                        17020008
170300                                   AENDDDH                        17030008
170400                                   AENDYYH.                       17040008
170500*                                                                 17050008
170600     IF (MB118-ED-MM NOT GREATER THAN SPACES                      17060008
170700     AND MB118-ED-DD NOT GREATER THAN SPACES                      17070008
170800     AND MB118-ED-YY NOT GREATER THAN SPACES)                     17080008
170900     OR (MB118-ED-MM EQUAL MB118-OED-MM                           17090008
171000     AND MB118-ED-DD EQUAL MB118-OED-DD                           17100008
171100     AND MB118-ED-YY EQUAL MB118-OED-YY)                          17110008
171200         CONTINUE                                                 17120008
171300     ELSE                                                         17130008
172100         INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56      17210008
172200                                                                  17220008
172210         MOVE MB118-ED-MM      TO  DPG52-GREG-DATE-MO-X           17221010
172230         MOVE MB118-ED-DD      TO  DPG52-GREG-DATE-DY-X           17223010
172250         MOVE MB118-ED-YY      TO  DPG52-GREG-DATE-YR-X           17225010
172400                                                                  17240008
172500         SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE                 17250008
172600         SET DPG52-LK-DTE-GREG            TO TRUE                 17260008
172700                                                                  17270008
172800         CALL  DP500-KOHLS-CALENDAR-ROUTINE                       17280008
172900               USING DPG51, DPG52, DPG53,                         17290008
173000                     DPG54, DPG55, DPG56                          17300008
173100                                                                  17310008
173200         IF DPG54-NO-ERROR                                        17320009
173300             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-DATE           17330010
173400             MOVE DPG55-DB2-ISO-DATE TO MB118-END-DATE            17340010
173500                                                                  17350008
173600             PERFORM DP017-0000-GET-CURR-DATE-TIME                17360008
173700                                                                  17370008
173800             IF MB118-END-DATE < DP017-CURRENT-DATE-YYYYMMDD      17380008
173900             OR MB118-END-DATE = DP017-CURRENT-DATE-YYYYMMDD      17390008
174000                 SET PS-INVALID-DATE                              17400008
174100                               TO  TRUE                           17410008
174200                 MOVE PC-TSYMSG-00067                             17420008
174300                               TO  DP020-MSG-NUMBER               17430008
174400             ELSE                                                 17440008
174500                 ADD 1         TO  DP017-CURRENT-YMD-YYYY         17450008
174600                 IF MB118-END-DATE > DP017-CURRENT-DATE-YYYYMMDD  17460008
174700                     SET PS-INVALID-DATE                          17470008
174800                               TO  TRUE                           17480008
174900                     MOVE PC-TSYMSG-00025                         17490008
175000                               TO  DP020-MSG-NUMBER               17500008
175100                 END-IF                                           17510008
175200                 SUBTRACT 1  FROM  DP017-CURRENT-YMD-YYYY         17520008
175300             END-IF                                               17530008
175400                                                                  17540008
175500         ELSE                                                     17550008
175600             SET PS-INVALID-DATE                                  17560008
175700                               TO  TRUE                           17570008
175800             MOVE PC-TSYMSG-00009                                 17580008
175900                               TO  DP020-MSG-NUMBER               17590008
176000         END-IF                                                   17600008
176100                                                                  17610008
176200         IF  PS-VALID-DATE                                        17620008
176300             IF (PV-DB2-DATE GREATER MB118-PARENT-END-DATE        17630008
176400             OR  PV-DB2-DATE GREATER MB118-MDSE-END-DATE)         17640008
176500                 SET PS-INVALID-DATE                              17650008
176600                               TO  TRUE                           17660008
176700                 MOVE PC-TSYMSG-00145                             17670008
176800                               TO  DP020-MSG-NUMBER               17680008
176900             END-IF                                               17690008
177000         END-IF                                                   17700008
177100                                                                  17710008
177200         IF  PS-VALID-DATE                                        17720008
177300             PERFORM 2125-CHECK-START-DATE                        17730008
177400             IF  PV-DB2-COUNT GREATER THAN ZERO                   17740008
177500                 MOVE PC-TSYMSG-00213                             17750008
177600                               TO  DP020-MSG-NUMBER               17760008
177700                 SET PS-INVALID-DATE                              17770008
177800                               TO  TRUE                           17780008
177900             END-IF                                               17790008
178000         END-IF                                                   17800008
178100                                                                  17810008
178200     END-IF.                                                      17820008
178300                                                                  17830008
178400     IF  MB118-END-DATE-YMD GREATER THAN SPACES                   17840012
178500         CONTINUE                                                 17850008
178600     ELSE                                                         17860008
178700         IF  MB118-ORIG-END-DATE NOT EQUAL PC-DEFAULT-DATE        17870008
178800             IF  PC-DEFAULT-DATE GREATER MB118-PARENT-END-DATE    17880008
178900                 SET PS-INVALID-DATE                              17890008
179000                               TO  TRUE                           17900008
179100                 MOVE PC-TSYMSG-00145                             17910008
179200                               TO  DP020-MSG-NUMBER               17920008
179300             END-IF                                               17930008
179400         END-IF                                                   17940008
179500     END-IF.                                                      17950008
179600*                                                                 17960008
179700     IF  PS-INVALID-DATE                                          17970008
179800         MOVE DP015-RED        TO  AENDMMC                        17980008
179900                                   AENDDDC                        17990008
180000                                   AENDYYC                        18000008
180100         MOVE DP015-REVERSE    TO  AENDDDH                        18010008
180200                                   AENDMMH                        18020008
180300                                   AENDYYH                        18030008
180400         MOVE -1               TO  AENDMML                        18040008
180500         SET DP020-MSG-FATAL   TO  TRUE                           18050008
180600         SET PS-ERROR          TO  TRUE                           18060008
180700     END-IF.                                                      18070008
180800*                                                                 18080008
180900*                                                                 18090008
181000     IF (MB118-CANT-MODIFY-STRT-DATE                              18100008
181100     OR (MB118-SD-MM EQUAL MB118-OSD-MM                           18110008
181200     AND MB118-SD-DD EQUAL MB118-OSD-DD                           18120008
181300     AND MB118-SD-YY EQUAL MB118-OSD-YY))                         18130008
181400         CONTINUE                                                 18140008
181500     ELSE                                                         18150008
181600         SET PS-VALID-DATE     TO  TRUE                           18160008
182300         INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56      18230008
182301                                                                  18230110
182310         MOVE MB118-SD-MM      TO  DPG52-GREG-DATE-MO-X           18231010
182320         MOVE MB118-SD-DD      TO  DPG52-GREG-DATE-DY-X           18232010
182330         MOVE MB118-SD-YY      TO  DPG52-GREG-DATE-YR-X           18233010
182600                                                                  18260008
182700         SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE                 18270008
182800         SET DPG52-LK-DTE-GREG            TO TRUE                 18280008
182900                                                                  18290008
183000         CALL  DP500-KOHLS-CALENDAR-ROUTINE                       18300008
183100               USING DPG51, DPG52, DPG53,                         18310008
183200                     DPG54, DPG55, DPG56                          18320008
183300                                                                  18330008
183400         IF DPG54-NO-ERROR                                        18340009
183410             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-DATE           18341010
183420             MOVE DPG55-DB2-ISO-DATE TO MB118-STRT-DATE           18342010
183700                                                                  18370008
183800             PERFORM DP017-0000-GET-CURR-DATE-TIME                18380008
183900                                                                  18390008
184000             IF MB118-STRT-DATE < DP017-CURRENT-DATE-YYYYMMDD     18400008
184100             OR MB118-STRT-DATE = DP017-CURRENT-DATE-YYYYMMDD     18410008
184200                 SET PS-INVALID-DATE                              18420008
184300                               TO  TRUE                           18430008
184400                 MOVE PC-TSYMSG-00067                             18440008
184500                               TO  DP020-MSG-NUMBER               18450008
184600             ELSE                                                 18460008
184700                 ADD 1             TO  DP017-CURRENT-YMD-YYYY     18470008
184800                 IF  MB118-STRT-DATE >                            18480008
184900                                DP017-CURRENT-DATE-YYYYMMDD       18490008
185000                     SET PS-INVALID-DATE                          18500008
185100                               TO  TRUE                           18510008
185200                     MOVE PC-TSYMSG-00025                         18520008
185300                               TO  DP020-MSG-NUMBER               18530008
185400                 END-IF                                           18540008
185500                 SUBTRACT 1  FROM  DP017-CURRENT-YMD-YYYY         18550008
185600             END-IF                                               18560008
185700                                                                  18570008
185800         ELSE                                                     18580008
185900             SET PS-INVALID-DATE                                  18590008
186000                               TO  TRUE                           18600008
186100             MOVE PC-TSYMSG-00009                                 18610008
186200                               TO  DP020-MSG-NUMBER               18620008
186300         END-IF                                                   18630008
186400                                                                  18640008
186500         IF  PS-VALID-DATE                                        18650008
186600             IF (PV-DB2-DATE LESS THAN MB118-PARENT-STRT-DATE     18660008
186700             OR  PV-DB2-DATE LESS THAN MB118-MDSE-STRT-DATE)      18670008
186800                 SET PS-INVALID-DATE                              18680008
186900                               TO  TRUE                           18690008
187000                 MOVE PC-TSYMSG-00144                             18700008
187100                               TO  DP020-MSG-NUMBER               18710008
187200             END-IF                                               18720008
187300         END-IF                                                   18730008
187400                                                                  18740008
187500         IF  PS-VALID-DATE                                        18750008
187600             PERFORM 2126-CHECK-END-DATE                          18760008
187700             IF  PV-DB2-COUNT GREATER THAN ZERO                   18770008
187800                 MOVE PC-TSYMSG-00214                             18780008
187900                               TO  DP020-MSG-NUMBER               18790008
188000                 SET PS-INVALID-DATE                              18800008
188100                               TO  TRUE                           18810008
188200             END-IF                                               18820008
188300         END-IF                                                   18830008
188400                                                                  18840008
188500         IF  PS-INVALID-DATE                                      18850008
188600             MOVE DP015-RED    TO  ASTRTMMC                       18860008
188700                                   ASTRTDDC                       18870008
188800                                   ASTRTYYC                       18880008
188900             MOVE DP015-REVERSE                                   18890008
189000                               TO  ASTRTDDH                       18900008
189100                                   ASTRTMMH                       18910008
189200                                   ASTRTYYH                       18920008
189300             MOVE -1           TO  ASTRTMML                       18930008
189400             SET DP020-MSG-FATAL                                  18940008
189500                               TO  TRUE                           18950008
189600             SET PS-ERROR      TO  TRUE                           18960008
189700         END-IF                                                   18970008
189800     END-IF.                                                      18980008
189900                                                                  18990008
190000     IF  PS-ERROR                                                 19000008
190100         CONTINUE                                                 19010008
190200     ELSE                                                         19020008
190300         MOVE MB118-SD-MM      TO  PV-DD-MM                       19030008
190400         MOVE MB118-SD-DD      TO  PV-DD-DD                       19040008
190500         MOVE MB118-SD-YY      TO  PV-DD-YY                       19050008
190600         MOVE MB118-SD-CC      TO  PV-DD-CC                       19060008
190700         MOVE PV-DB2-DATE      TO  APLAVL-MDSEAR-STRT-DTE         19070008
190800                                                                  19080008
190900         IF  MB118-END-DATE-YMD GREATER THAN SPACES               19090012
191000             MOVE MB118-ED-MM  TO  PV-DD-MM                       19100008
191100             MOVE MB118-ED-DD  TO  PV-DD-DD                       19110008
191200             MOVE MB118-ED-YY  TO  PV-DD-YY                       19120008
191300             MOVE MB118-ED-CC  TO  PV-DD-CC                       19130008
191400         ELSE                                                     19140008
191500             IF  MB118-ORIG-END-DATE NOT EQUAL PC-DEFAULT-DATE    19150008
191600                 MOVE PC-DEFAULT-DATE                             19160008
191700                               TO  PV-DB2-DATE                    19170008
191800             ELSE                                                 19180008
191900                 MOVE MB118-ORIG-END-DATE                         19190008
192000                               TO  PV-DB2-DATE                    19200008
192100             END-IF                                               19210008
192200         END-IF                                                   19220008
192300         MOVE PV-DB2-DATE      TO  APLAVL-MDSEAR-END-DTE          19230008
192400                                                                  19240008
192500         IF (APLAVL-MDSEAR-STRT-DTE > APLAVL-MDSEAR-END-DTE       19250008
192600         OR  APLAVL-MDSEAR-STRT-DTE = APLAVL-MDSEAR-END-DTE)      19260008
192700             MOVE DP015-RED    TO  ASTRTMMC                       19270008
192800                                   ASTRTDDC                       19280008
192900                                   ASTRTYYC                       19290008
193000                                   AENDMMC                        19300008
193100                                   AENDDDC                        19310008
193200                                   AENDYYC                        19320008
193300             MOVE DP015-REVERSE                                   19330008
193400                               TO  ASTRTDDH                       19340008
193500                                   ASTRTMMH                       19350008
193600                                   ASTRTYYH                       19360008
193700                                   AENDMMH                        19370008
193800                                   AENDDDH                        19380008
193900                                   AENDYYH                        19390008
194000             IF  MB118-CAN-MODIFY-STRT-DATE                       19400008
194100                 MOVE -1       TO  ASTRTMML                       19410008
194200             ELSE                                                 19420008
194300                 MOVE -1       TO  AENDMML                        19430008
194400             END-IF                                               19440008
194500             MOVE PC-TSYMSG-00143                                 19450008
194600                               TO  DP020-MSG-NUMBER               19460008
194700             SET DP020-MSG-FATAL                                  19470008
194800                               TO  TRUE                           19480008
194900             SET PS-ERROR      TO  TRUE                           19490008
195000         END-IF                                                   19500008
195100     END-IF.                                                      19510008
195200*                                                                 19520008
195300 EJECT                                                            19530008
195400******************************************************************19540008
195500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.           19550008
195600*                                                                 19560008
195700*    PERFORMED BY 2000, 2180.                                     19570008
195800******************************************************************19580008
195900*                                                                 19590008
196000 3400-MOVE-COMMAREA-TO-SCREEN.                                    19600008
196100*                                                                 19610008
196200     MOVE MB118-DMA-ATTR       TO  ADMAHEDA                       19620008
196300                                   ADMAA                          19630008
196400                                   ADMADESA.                      19640008
196500     MOVE MB118-DEPT-ATTR TO       ADPTHEDA                       19650008
196600                                   ADEPTA                         19660008
196700                                   ADPTDESA.                      19670008
196800     MOVE MB118-MCLASS-ATTR                                       19680008
196900                               TO  AMCLHEDA                       19690008
197000                                   AMCLASSA                       19700008
197100                                   AMCDESA.                       19710008
197200     MOVE MB118-SCLASS-ATTR                                       19720008
197300                               TO  ASCLHEDA                       19730008
197400                                   ASCLASSA                       19740008
197500                                   ASCDESA.                       19750008
197600*                                                                 19760008
197700     MOVE MB118-GMA-NBR        TO  AGMAO.                         19770008
197800     MOVE MB118-DMA-NBR        TO  ADMAO.                         19780008
197900     MOVE MB118-DEPT-NBR       TO  ADEPTO.                        19790008
198000     MOVE MB118-MCLASS-NBR                                        19800008
198100                               TO  AMCLASSO.                      19810008
198200     MOVE MB118-SCLASS-NBR                                        19820008
198300                               TO  ASCLASSO.                      19830008
198400*                                                                 19840008
198500     MOVE MB118-GMA-DESC       TO  AGMADESO.                      19850008
198600     MOVE MB118-DMA-DESC       TO  ADMADESO.                      19860008
198700     MOVE MB118-DEPT-DESC      TO  ADPTDESO.                      19870008
198800     MOVE MB118-MCLASS-DESC    TO  AMCDESO.                       19880008
198900     MOVE MB118-SCLASS-DESC    TO  ASCDESO.                       19890008
199000     MOVE MB118-APPL-SYS-DESC  TO  AAPLDESO.                      19900008
199100*                                                                 19910008
199200     MOVE MB118-SD-MM          TO  ASTRTMMO.                      19920008
199300     MOVE MB118-SD-DD          TO  ASTRTDDO.                      19930008
199400     MOVE MB118-SD-YY          TO  ASTRTYYO.                      19940008
199500     MOVE MB118-ED-MM          TO  AENDMMO.                       19950008
199600     MOVE MB118-ED-DD          TO  AENDDDO.                       19960008
199700     MOVE MB118-ED-YY          TO  AENDYYO.                       19970008
199800     MOVE MB118-MDSELV-CDE     TO  AMDSELVO.                      19980008
199900     MOVE MB118-APPL-SYS-CODE  TO  AAPLSYSO.                      19990008
200000     MOVE PC-COMPANY           TO  AOPERCOO.                      20000008
200100*                                                                 20010008
200200 EJECT                                                            20020008
200300******************************************************************20030008
200400*    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER     20040008
200500*    TRANSACTION, SAVE THE INTER APPLICATION COMMUNICATIONS AREA  20050008
200600*    AND START THE NAVIGATOR.  DONT SAVE THE INTER APPL COMM AREA 20060008
200700*    FOR THE DEPARTMENT OR SUB-CLASS INQUIRY (PF22, PF23).        20070008
200800*                                                                 20080008
200900*    PERFORMED BY 3000                                            20090008
201000******************************************************************20100008
201100*                                                                 20110008
201200 4000-NAVIGATE.                                                   20120008
201300*                                                                 20130008
201400     COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                       20140008
201500         ((MB118-MA-ITEM - 1) * MB023-MAX-ITEMS) +                20150008
201600           MB118-MA-SUB.                                          20160008
201700*                                                                 20170008
201800     MOVE MB005-INTER-APPL-COMMAREA                               20180008
201900                               TO  MB118-SAVE-INTER-APPL-COMMAREA.20190008
202000*                                                                 20200008
202100     PERFORM DP015-1000-START-NAVIGATOR.                          20210008
202200*                                                                 20220008
202300 EJECT                                                            20230008
202400******************************************************************20240008
202500*    ENSURE WE ENTERED THIS PROGRAM PROPERLY.                     20250008
202600*                                                                 20260008
202700*    PERFORMED BY 1000                                            20270008
202800******************************************************************20280008
202900*                                                                 20290008
203000 4100-VALIDATE-COMMAREA.                                          20300008
203100*                                                                 20310008
203200     IF (DP020-MB-APPL-AVAIL-SELECT                               20320008
203300     OR  DP020-MB-APPL-AVAIL-LIST)                                20330008
203400         SET PS-COMMAREA-VALID TO  TRUE                           20340008
203500     ELSE                                                         20350008
203600         SET PS-COMMAREA-NOT-VALID                                20360008
203700                               TO  TRUE                           20370008
203800     END-IF.                                                      20380008
203900*                                                                 20390008
204000 EJECT                                                            20400008
204100******************************************************************20410008
204200*    FILL IN SCREEN HEADER MODULE                                 20420008
204300******************************************************************20430008
204400                                                                  20440008
204500     COPY DPPD002.                                                20450008
204600 EJECT                                                            20460008
204700******************************************************************20470008
204800*    RETURN TO CICS MODULE                                        20480008
204900******************************************************************20490008
205000                                                                  20500008
205100     COPY DPPD003.                                                20510008
205200 EJECT                                                            20520008
205300******************************************************************20530008
205400*    FORMAT MESSAGE LINES MODULE                                  20540008
205500******************************************************************20550008
205600                                                                  20560008
205700     COPY DPPD005.                                                20570008
205800 EJECT                                                            20580008
205900******************************************************************20590008
206000*    GET PANEL MODULE                                             20600008
206100******************************************************************20610008
206200                                                                  20620008
206300     COPY DPPD007.                                                20630008
206400 EJECT                                                            20640008
206500******************************************************************20650008
206600*    WRITE PANEL MODULE                                           20660008
206700******************************************************************20670008
206800                                                                  20680008
206900     COPY DPPD008.                                                20690008
207000 EJECT                                                            20700008
207100******************************************************************20710008
207200*    TOGGLE THE FUNCTION KEY LINE MODULE                          20720008
207300******************************************************************20730008
207400                                                                  20740008
207500     COPY DPPD009.                                                20750008
207600 EJECT                                                            20760008
207700******************************************************************20770008
207800*    ABEND PROCESSOR MODULE                                       20780008
207900******************************************************************20790008
208000                                                                  20800008
208100     COPY DPPD013.                                                20810008
208200 EJECT                                                            20820008
208300******************************************************************20830008
208400*    CHECK COMMUNICATION AREA MODULE                              20840008
208500******************************************************************20850008
208600                                                                  20860008
208700     COPY DPPD015.                                                20870008
208800 EJECT                                                            20880008
208900******************************************************************20890008
209000*    UPDATE TIME AND DATE MODULE                                  20900008
209100******************************************************************20910008
209200                                                                  20920008
209300     COPY DPPD017.                                                20930008
