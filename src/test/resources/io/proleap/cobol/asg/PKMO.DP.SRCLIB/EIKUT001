000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         EIKUT001.                                    00020000
000300 AUTHOR.             KARI HAAK.                                   00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       11-03-2010.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700*                                                                 00070000
000800 ENVIRONMENT DIVISION.                                            00080000
000900                                                                  00090000
001000 CONFIGURATION SECTION.                                           00100000
001100                                                                  00110000
001200 SOURCE-COMPUTER.    IBM-3090.                                    00120000
001300 OBJECT-COMPUTER.    IBM-3090.                                    00130000
001400                                                                  00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800                                                                  00180000
001900     SELECT PREV-INPUT-FILE      ASSIGN TO INP01.                 00190000
002000     SELECT CURR-INPUT-FILE      ASSIGN TO INP02.                 00200000
002100     SELECT CHANGE-FILE          ASSIGN TO OUT01.                 00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  CURR-INPUT-FILE                                              00270000
002800     RECORDING MODE IS F                                          00280000
002900     BLOCK CONTAINS 0 RECORDS                                     00290000
003000     LABEL RECORDS ARE OMITTED.                                   00300000
003100 01  CURR-INPUT-RECORD                   PIC  X(35).              00310000
003200                                                                  00320000
003300 FD  PREV-INPUT-FILE                                              00330000
003400     RECORDING MODE IS F                                          00340000
003500     BLOCK CONTAINS 0 RECORDS                                     00350000
003600     LABEL RECORDS ARE OMITTED.                                   00360000
003700 01  PREV-INPUT-RECORD                   PIC  X(35).              00370000
003800                                                                  00380000
003900 FD  CHANGE-FILE                                                  00390000
004000     RECORDING MODE IS F                                          00400000
004100     BLOCK CONTAINS 0 RECORDS                                     00410000
004200     LABEL RECORDS ARE OMITTED.                                   00420000
004300 01  CHANGE-RECORD                       PIC  X(36).              00430009
004400                                                                  00440000
004500 WORKING-STORAGE SECTION.                                         00450000
005350                                                                  00535000
005310 01 CURR-REC.                                                     00535102
005320     05 CURR-STR-NBR                PIC 9(04) VALUE ZEROES.       00535202
           05 FILLER                      PIC X(01) VALUE SPACE.        00535300
005321     05 CURR-STR-GP-TYP-CDE         PIC 9(04) VALUE ZEROES.       00535402
           05 FILLER                      PIC X(01) VALUE SPACE.        00535500
005330     05 CURR-STR-GP-ID              PIC 9(04) VALUE ZEROES.       00535602
           05 FILLER                      PIC X(01) VALUE SPACE.        00535700
005340     05 CURR-STR-EFF-BEG-DTE        PIC X(10) VALUE SPACE.        00535802
005341     05 CURR-STR-EFF-END-DTE        PIC X(10) VALUE SPACE.        00535902
005350                                                                  00536000
005310 01 PREV-REC.                                                     00536102
005320     05 PREV-STR-NBR                PIC 9(04) VALUE ZEROES.       00536202
           05 FILLER                      PIC X(01) VALUE SPACE.        00536302
005321     05 PREV-STR-GP-TYP-CDE         PIC 9(04) VALUE ZEROES.       00536402
           05 FILLER                      PIC X(01) VALUE SPACE.        00536502
005330     05 PREV-STR-GP-ID              PIC 9(04) VALUE ZEROES.       00536602
           05 FILLER                      PIC X(01) VALUE SPACE.        00536702
005340     05 PREV-STR-EFF-BEG-DTE        PIC X(10) VALUE SPACE.        00536802
005341     05 PREV-STR-EFF-END-DTE        PIC X(10) VALUE SPACE.        00536902
005350                                                                  00537002
005351 01 PC-PROGRAM-CONSTANTS.                                         00537102
005352     05 PC-PGM-NAME                 PIC X(08)  VALUE 'EIKUT001'.  00537202
005353                                                                  00537302
005360 01 PV-PROGRAM-VARIABLES.                                         00537402
005370     05 PV-PREV-KEY.                                              00537502
005380        10 PV-PREV-STR-NBR          PIC 9(04).                    00537602
005381        10 PV-PREV-STR-GP-TYP-CDE   PIC 9(04).                    00537702
005382        10 PV-PREV-STR-GP-ID        PIC 9(04).                    00537802
005383        10 PV-PREV-STR-EFF-BEG-DTE  PIC X(10) VALUE SPACE.        00537902
005390     05 PV-PREV-STR-EFF-END-DTE     PIC X(10) VALUE SPACE.        00538002
005400                                                                  00538102
005410     05 PV-CURR-KEY.                                              00538202
005420        10 PV-CURR-STR-NBR          PIC 9(04).                    00539000
005421        10 PV-CURR-STR-GP-TYP-CDE   PIC 9(04).                    00540000
005422        10 PV-CURR-STR-GP-ID        PIC 9(04).                    00541000
005423        10 PV-CURR-STR-EFF-BEG-DTE  PIC X(10) VALUE SPACE.        00542000
005430     05 PV-CURR-STR-EFF-END-DTE     PIC X(10) VALUE SPACE.        00543000
005433                                                                  00543100
004300 01  PV-CHNG-RECORD.                                              00543209
005320     05 PV-CHNG-STR-NBR              PIC 9(04) VALUE ZEROES.      00543509
           05 FILLER                       PIC X(01) VALUE ' '.         00543609
005321     05 PV-CHNG-STR-GP-TYP-CDE       PIC 9(04) VALUE ZEROES.      00543709
           05 FILLER                       PIC X(01) VALUE ' '.         00543809
005330     05 PV-CHNG-STR-GP-ID            PIC 9(04) VALUE ZEROES.      00543909
           05 FILLER                       PIC X(01) VALUE ' '.         00544009
005340     05 PV-CHNG-STR-EFF-BEG-DTE      PIC X(10) VALUE SPACE.       00545009
005341     05 PV-CHNG-CURR-STR-EFF-END-DTE PIC X(10) VALUE SPACE.       00549009
005572     05 PV-CHNG-INDICATOR            PIC X(01) VALUE SPACE.       00549109
                                                                        00550007
004300*01  PV-CHNG-RECORD.                                              00551009
005572*    05 PV-CHNG-INDICATOR            PIC X(01) VALUE SPACE.       00551109
      *    05 FILLER                       PIC X(01) VALUE ','.         00551209
005320*    05 PV-CHNG-STR-NBR              PIC 9(04) VALUE ZEROES.      00551309
      *    05 FILLER                       PIC X(01) VALUE ','.         00551409
005321*    05 PV-CHNG-STR-GP-TYP-CDE       PIC 9(04) VALUE ZEROES.      00551509
      *    05 FILLER                       PIC X(01) VALUE ','.         00551609
005330*    05 PV-CHNG-STR-GP-ID            PIC 9(04) VALUE ZEROES.      00551709
      *    05 FILLER                       PIC X(01) VALUE ','.         00551809
005340*    05 PV-CHNG-STR-EFF-BEG-DTE      PIC X(10) VALUE SPACE.       00551909
      *    05 FILLER                       PIC X(01) VALUE ','.         00552009
005341*    05 PV-CHNG-PREV-STR-EFF-END-DTE PIC X(10) VALUE SPACE.       00552109
      *    05 FILLER                       PIC X(01) VALUE ','.         00552209
005341*    05 PV-CHNG-CURR-STR-EFF-END-DTE PIC X(10) VALUE SPACE.       00552309
                                                                        00552409
 05565 01 PA-PROGRAM-ACCUMULATORS.                                      00552509
005566     05 PA-CHANGE-RECS-WRITTEN PIC 9(13) VALUE ZERO.              00553005
005567     05 PA-PREV-RECS-READ      PIC 9(13) VALUE ZERO.              00554000
005568     05 PA-CURR-RECS-READ      PIC 9(13) VALUE ZERO.              00555000
005569                                                                  00556000
005571 01 PS-PROGRAM-SWITCHES.                                          00557000
005572     05 PS-MORE-CURR-INPUT-RECS-SW PIC X(01) VALUE 'Y'.           00557100
005573         88 PS-MORE-CURR-INPUT-RECS          VALUE 'Y'.           00557200
005574         88 PS-END-OF-CURR-INPUT-RECS        VALUE 'N'.           00557300
005575     05 PS-MORE-PREV-INPUT-RECS-SW PIC X(01) VALUE 'Y'.           00557400
005576         88 PS-MORE-PREV-INPUT-RECS          VALUE 'Y'.           00557500
005577         88 PS-END-OF-PREV-INPUT-RECS        VALUE 'N'.           00557600
005578     05 PS-CURR-OR-PREV-ERR      PIC X(01)   VALUE '0'.           00557700
005579         88 PS-CURR-ERROR                    VALUE '1'.           00557802
005580         88 PS-PREV-ERROR                    VALUE '2'.           00557900
005581         88 PS-DATA-ERROR                    VALUE '3'.           00558000
005578     05 PS-CHANGE-INDICATOR      PIC X(01)   VALUE ' '.           00559001
005579         88 PS-CHANGE-IND-INSERT             VALUE 'I'.           00560001
005580         88 PS-CHANGE-IND-UPDATE             VALUE 'U'.           00561001
005581         88 PS-CHANGE-IND-DELETE             VALUE 'D'.           00562001
005641                                                                  00563900
005642 PROCEDURE DIVISION.                                              00564000
005643                                                                  00564100
005644 0000-MAIN-MODULE.                                                00564200
005650                                                                  00564300
005660       OPEN INPUT CURR-INPUT-FILE                                 00564400
005670                  PREV-INPUT-FILE                                 00564500
005680            OUTPUT CHANGE-FILE.                                   00564600
005681                                                                  00564700
005690       PERFORM 1000-INITIALIZE.                                   00564800
005694       PERFORM 2000-PROCESS-RECS                                  00567000
005695          UNTIL (PS-END-OF-PREV-INPUT-RECS                        00568000
005696            AND PS-END-OF-CURR-INPUT-RECS).                       00569000
005700                                                                  00570000
005800       CLOSE CURR-INPUT-FILE                                      00573000
005900             PREV-INPUT-FILE                                      00574000
006000             CHANGE-FILE.                                         00575000
006010                                                                  00576000
006100       DISPLAY '**** EIKUT001 STATISTICS ****'                    00577000
006200       DISPLAY 'TOTAL CHANGE RECS WRITTEN: '                      00578002
006200                                      PA-CHANGE-RECS-WRITTEN.     00578105
006300       DISPLAY 'TOTAL PREV RECS READ   : ' PA-PREV-RECS-READ.     00579002
006400       DISPLAY 'TOTAL CURR RECS READ   : ' PA-CURR-RECS-READ.     00580002
006500       DISPLAY ' '                                                00590000
006600                                                                  00600000
006700       STOP RUN.                                                  00610000
006710                                                                  00620000
006800 1000-INITIALIZE.                                                 00630000
006900                                                                  00640000
005691       PERFORM 7000-READ-PREV-INPUT-FILE.                         00650000
005692       PERFORM 7100-READ-CURR-INPUT-FILE.                         00660000
008400                                                                  00790000
008500 2000-PROCESS-RECS.                                               00800000
008501                                                                  00810000
008510       MOVE CURR-STR-NBR          TO  PV-CURR-STR-NBR.            00820002
008511       MOVE CURR-STR-GP-TYP-CDE   TO  PV-CURR-STR-GP-TYP-CDE.     00830002
008512       MOVE CURR-STR-GP-ID        TO  PV-CURR-STR-GP-ID.          00840002
008520       MOVE CURR-STR-EFF-BEG-DTE  TO  PV-CURR-STR-EFF-BEG-DTE.    00850002
008521       MOVE CURR-STR-EFF-END-DTE  TO  PV-CURR-STR-EFF-END-DTE.    00851002
008530                                                                  00852000
008540       MOVE PREV-STR-NBR          TO  PV-PREV-STR-NBR.            00853000
008541       MOVE PREV-STR-GP-TYP-CDE   TO  PV-PREV-STR-GP-TYP-CDE.     00854001
008550       MOVE PREV-STR-GP-ID        TO  PV-PREV-STR-GP-ID.          00855000
008551       MOVE PREV-STR-EFF-BEG-DTE  TO  PV-PREV-STR-EFF-BEG-DTE.    00855101
008552       MOVE PREV-STR-EFF-END-DTE  TO  PV-PREV-STR-EFF-END-DTE.    00855201
008560                                                                  00855300
008561       IF PV-PREV-STR-EFF-END-DTE NOT > ZEROES                    00855400
008562           MOVE SPACES TO PV-PREV-STR-EFF-END-DTE                 00855500
008563       END-IF.                                                    00855600
008564                                                                  00855700
008570      IF PV-PREV-KEY = PV-CURR-KEY                                00855800
008572         PERFORM 3000-COMPARE-FIELDS                              00855900
008573         PERFORM 7000-READ-PREV-INPUT-FILE                        00856000
008574         PERFORM 7100-READ-CURR-INPUT-FILE                        00857000
008575      ELSE                                                        00857100
008580         IF ((PV-CURR-KEY < PV-PREV-KEY)                          00857200
008590             OR PS-END-OF-PREV-INPUT-RECS) AND                    00857300
008591             PS-MORE-CURR-INPUT-RECS                              00857400
                                                                        00857501
                   SET PS-CURR-ERROR        TO TRUE                     00857802
                   SET PS-CHANGE-IND-INSERT TO TRUE                     00857901
                   DISPLAY 'KEY IN CURRENT FILE ONLY, NOT IN PREVIOUS'  00858101
                   DISPLAY 'CURR REC:  ' CURR-REC                       00858206
                   DISPLAY ' '                                          00858306
                                                                        00858406
008595             PERFORM 8000-WRITE-OUTPUT-REC                        00858506
008596             PERFORM 7100-READ-CURR-INPUT-FILE                    00858606
008597          ELSE                                                    00858706
008620             IF ((PV-CURR-KEY > PV-PREV-KEY)                      00859000
008630                OR PS-END-OF-CURR-INPUT-RECS) AND                 00860000
008640                PS-MORE-PREV-INPUT-RECS                           00861000
                                                                        00862002
                      SET PS-PREV-ERROR        TO TRUE                  00862302
                      SET PS-CHANGE-IND-DELETE TO TRUE                  00862402
                      DISPLAY 'KEY IN PREV FILE ONLY, NOT IN CURRENT'   00862606
                      DISPLAY 'PREV-REC:  ' PREV-REC                    00862706
                      DISPLAY ' '                                       00862806
                                                                        00862906
008670                PERFORM 8000-WRITE-OUTPUT-REC                     00864000
008680                PERFORM 7000-READ-PREV-INPUT-FILE                 00865000
008690             END-IF                                               00866000
008691          END-IF                                                  00867000
008692      END-IF.                                                     00868000
008693                                                                  00869000
008694 3000-COMPARE-FIELDS.                                             00869100
008695                                                                  00869200
008696      EVALUATE TRUE                                               00869700
008698         WHEN ((PV-CURR-STR-EFF-END-DTE NOT =                     00869800
008699                 PV-PREV-STR-EFF-END-DTE)                         00869900
008720             AND NOT (PV-PREV-STR-EFF-END-DTE = '9999-09-09'      00870000
008721             AND  PV-CURR-STR-EFF-END-DTE = SPACES ))             00870100
                                                                        00870201
                   SET PS-DATA-ERROR        TO TRUE                     00870301
                   SET PS-CHANGE-IND-UPDATE TO TRUE                     00870401
                   DISPLAY 'EFFECTIVE END DATES DO NOT MATCH'           00870501
                   DISPLAY 'CURR REC:  ' CURR-REC                       00870606
                   DISPLAY 'PREV REC:  ' PREV-REC                       00870706
                   DISPLAY ' '                                          00870806
008729             PERFORM 8000-WRITE-OUTPUT-REC                        00871000
                                                                        00871101
008730      END-EVALUATE.                                               00872000
008731                                                                  00873000
008740 7000-READ-PREV-INPUT-FILE.                                       00874000
008800                                                                  00875000
008900       INITIALIZE PREV-REC.                                       00876000
009000                                                                  00877000
009100       READ PREV-INPUT-FILE INTO PREV-REC                         00878000
009200           AT END SET PS-END-OF-PREV-INPUT-RECS TO TRUE.          00879000
009300                                                                  00880000
009400       ADD 1 TO PA-PREV-RECS-READ.                                00890000
009500                                                                  00900000
009600 7100-READ-CURR-INPUT-FILE.                                       00910000
009700                                                                  00920000
009800       INITIALIZE CURR-REC.                                       00931002
009900                                                                  00940000
010000       READ CURR-INPUT-FILE INTO CURR-REC                         00950002
010100            AT END SET PS-END-OF-CURR-INPUT-RECS TO TRUE.         00960000
010200                                                                  00970000
010300       ADD 1 TO PA-CURR-RECS-READ.                                00980000
010400                                                                  00990000
010500 8000-WRITE-OUTPUT-REC.                                           01000000
010620                                                                  01010000
             INITIALIZE PV-CHNG-INDICATOR                               01011008
                        PV-CHNG-STR-NBR                                 01011108
                        PV-CHNG-STR-GP-TYP-CDE                          01011208
                        PV-CHNG-STR-GP-ID                               01011308
                        PV-CHNG-STR-EFF-BEG-DTE                         01011408
      *                 PV-CHNG-PREV-STR-EFF-END-DTE                    01011509
                        PV-CHNG-CURR-STR-EFF-END-DTE.                   01011608
                                                                        01011705
             MOVE PS-CHANGE-INDICATOR        TO PV-CHNG-INDICATOR.      01012808
                                                                        01013001
010700       IF PS-CURR-ERROR                                           01020002
010900          MOVE PV-CURR-STR-NBR         TO PV-CHNG-STR-NBR         01040008
010901          MOVE PV-CURR-STR-GP-TYP-CDE  TO PV-CHNG-STR-GP-TYP-CDE  01050008
010910          MOVE PV-CURR-STR-GP-ID       TO PV-CHNG-STR-GP-ID       01060008
011000          MOVE PV-CURR-STR-EFF-BEG-DTE                            01070008
011000                                TO PV-CHNG-STR-EFF-BEG-DTE        01071008
011001          MOVE PV-CURR-STR-EFF-END-DTE                            01080001
011620                                TO PV-CHNG-CURR-STR-EFF-END-DTE   01090008
011200       ELSE                                                       01100000
011300          IF PS-PREV-ERROR                                        01110000
011311             MOVE PV-PREV-STR-NBR      TO PV-CHNG-STR-NBR         01130008
011320             MOVE PV-PREV-STR-GP-TYP-CDE                          01131001
011320                                       TO PV-CHNG-STR-GP-TYP-CDE  01131108
011330             MOVE PV-PREV-STR-GP-ID    TO PV-CHNG-STR-GP-ID       01132008
011340             MOVE PV-PREV-STR-EFF-BEG-DTE                         01133001
011340                                       TO PV-CHNG-STR-EFF-BEG-DTE 01133108
011350*            MOVE PV-PREV-STR-EFF-END-DTE                         01134009
011618*                               TO PV-CHNG-PREV-STR-EFF-END-DTE   01135109
011610          ELSE                                                    01136000
011612             MOVE PV-CURR-STR-NBR      TO PV-CHNG-STR-NBR         01138008
011613             MOVE PV-CURR-STR-GP-TYP-CDE                          01139001
011613                                       TO PV-CHNG-STR-GP-TYP-CDE  01139108
011614             MOVE PV-CURR-STR-GP-ID    TO PV-CHNG-STR-GP-ID       01140008
011615             MOVE PV-CURR-STR-EFF-BEG-DTE                         01150000
011616                                       TO PV-CHNG-STR-EFF-BEG-DTE 01160008
011617*            MOVE PV-PREV-STR-EFF-END-DTE                         01161009
011618*                               TO PV-CHNG-PREV-STR-EFF-END-DTE   01161109
011619             MOVE PV-CURR-STR-EFF-END-DTE                         01161200
011620                                TO PV-CHNG-CURR-STR-EFF-END-DTE   01161308
011630          END-IF                                                  01161500
011700       END-IF.                                                    01161600
011710                                                                  01161700
011900       WRITE CHANGE-RECORD FROM PV-CHNG-RECORD.                   01166008
                                                                        01166205
009400       ADD 1 TO PA-CHANGE-RECS-WRITTEN.                           01167005
