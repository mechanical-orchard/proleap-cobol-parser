000100***************************************************************** 00010008
000200 IDENTIFICATION DIVISION.                                         00020008
000300***************************************************************** 00030008
000400                                                                  00040008
000500 PROGRAM-ID.             MRKUP097.                                00050008
000600 AUTHOR.                 T BAGWELL/SMM.                           00060008
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070008
000800 DATE-WRITTEN            02-16-00.                                00080008
000900 DATE-COMPILED.                                                   00090008
001000                                                                  00100008
001100***************************************************************** 00110008
001200*  UPDATE FT CODE ON TMRITST TABLE FOR REGIONAL CLEARANCE ITEMS * 00120008
001300*                                                               * 00130008
001400*  THIS PROGRAM WILL UPDATE THE FT CODE ON THE REPLENISHMENT    * 00140008
001500*  TO 'X' (OFF) WHEN A SKU/STORE GOES INTO CLEARANCE STATUS (30)* 00150008
001600*  ON THE UPC/STORE TABLE. ALSO, RT_NBR AND RT_DAY_NBR WILL BE  * 00160008
001700*  UPDATED TO ZERO WHEN THE SKU IS DISCONTINUED, OR CLEARANCE   * 00170008
001800*        ON THE FASHION SALES TABLE.                            * 00180008
001900***************************************************************** 00190008
002000* 02/16/00 - SMM               NEW PROGRAM - COPIED MRKUP096    * 00200008
002100*                                                               * 00210008
002200* 02/16/00 - SMM               ALTERED CURSORS AND A000- TO     * 00220008
002300*                              ACCOMDATE NEW MR SYSTEMS AND     * 00230008
002301*                              THEIR CORRESPONDING RT CODES     * 00231009
002302* 07/13/00 - AOK               REMOVED TMRITST FROM THE         * 00231109
002303*                              CHG_CSR                          * 00231209
002400***************************************************************** 00232008
002410* 05/16/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         *         
002420* -  TSKXREF ADDED.                                             *         
002430* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES *         
002440*    IN FIELDS.                                                 *         
002450* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       *         
002460*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    *         
002470* -  REMOVE SEQ FROM RPT AND ADD HEADINGS FOR DEPT/CL/SKU.      *         
002480* -  REPORT FORMAT CHANGED TO ZERO SUPPRESS FOR DEPT AND SKU.   *         
002490*****************************************************************         
002410* 07/30/2004 - ANNE KINTOPF STORE NUMBER EXPANSION  WR#26363    *         
002420* -  CHANGED REFERENCES FROM TSTR000 TO XMT_LOC                 *         
002490*****************************************************************         
002410* 05/31/2019 - MODIFIED STORE_CSR TO CHECK FOR                  *         
002420* -  STR_GP_TYP_CDE=5000 INSTEAD OF CHECKING STR_GP_ID =2000    *         
002420* -  IN XMT_STR_GP_MBSHP TABLE.                                 *         
002420* -  CHG0224860                                                           
002490*****************************************************************         
002500 ENVIRONMENT DIVISION.                                            00233008
002600***************************************************************** 00234008
002700                                                                  00235008
002800 CONFIGURATION SECTION.                                           00236008
002900                                                                  00237008
003000 SOURCE-COMPUTER.        IBM-3090.                                00238008
003100 OBJECT-COMPUTER.        IBM-3090.                                00239008
003200                                                                  00240008
003300 INPUT-OUTPUT SECTION.                                            00250008
003400                                                                  00260008
003500 FILE-CONTROL.                                                    00270008
003600                                                                  00280008
003700     SELECT PRINT-REPORT          ASSIGN TO RPT.                  00290008
003800*                                                                 00300008
003900***************************************************************** 00310008
004000 DATA DIVISION.                                                   00320008
004100***************************************************************** 00330008
004200*                                                                 00340008
004300 FILE SECTION.                                                    00350008
004400                                                                  00360008
004500 FD  PRINT-REPORT                                                 00370008
004600     RECORDING MODE F                                             00380008
004700     BLOCK CONTAINS 0 RECORDS                                     00390008
004800     RECORD CONTAINS 132 CHARACTERS                               00400008
004900     LABEL RECORDS ARE OMITTED                                    00410008
005000     DATA RECORD IS PRINT-LINE.                                   00420008
005100                                                                  00430008
005200 01  PRINT-LINE                           PIC X(132).             00440008
005300*                                                                 00450008
005400******************************************                        00460008
005500 WORKING-STORAGE SECTION.                                         00470008
005600******************************************                        00480008
005700                                                                  00490008
005800     COPY MRRD001I.                                               00500008
005900                                                                  00510008
006000 01 SYSTEM-RECORD.                                                00520008
006100     COPY MRRD002I.                                               00530008
006200******************************************                        00540008
006300* STANDARD HEADER LINE - KOHLS 132 COL                            00550008
006400******************************************                        00560008
006500     COPY DPWS132.                                                00570008
006600******************************************                        00580008
006700* COPYBOOKS FOR THE CALENDAR ROUTINE                              00590008
006800******************************************                        00600008
006900     COPY DPWS024.                                                00610008
007000     COPY DPWS500.                                                00620008
007100******************************************                        00630008
007200 01  FILLER.                                                      00640008
007300     05  FILLER                      PIC  X(36)    VALUE          00650008
007400         ' ***** WORKING STORAGE PGM=MRKUP097 '.                  00660008
007500     05  FILLER                      PIC  X(10)    VALUE          00670008
007600         ' LOCATION='.                                            00680008
007700     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00690008
007800     05  FILLER                      PIC  X(06)    VALUE          00700008
007900         ' *****'.                                                00710008
008000                                                                  00720008
008100 01  PROGRAM-SWITCHES.                                            00730008
008200     05  PS-EOC-ITEM-CSR             PIC  X(01)    VALUE 'N'.     00740008
008300         88  EOC-ITEM-CSR                          VALUE 'Y'.     00750008
008400                                                                  00760008
008500     05  PS-EOC-ITEM-CSR2            PIC  X(01)    VALUE 'N'.     00770008
008600         88  EOC-ITEM-CSR2                         VALUE 'Y'.     00780008
008700                                                                  00790008
008800     05  PS-EOC-STORE-CSR            PIC  X(01)    VALUE 'N'.     00800008
008900         88  EOC-STORE-CSR                         VALUE 'Y'.     00810008
009000                                                                  00820008
009100     05  PS-MIXED-STORES             PIC  X(01)    VALUE 'N'.     00830008
009200         88  MIXED-STORES                          VALUE 'Y'.     00840008
009300                                                                  00850008
009400 01  PC-CONSTANTS.                                                00860008
009500     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          00870008
009600                                                   'DPKUT500'.    00880008
009700     05  PC-PLUS-1                   PIC S9(04)    VALUE +1       00890008
009800                                                   COMP SYNC.     00900008
009900     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00910008
010000                                                   COMP SYNC.     00920008
010100     05  PC-RT-ZERO                  PIC S9(03)V   VALUE ZERO     00930008
010200                                                   COMP-3.        00940008
010300     05  PC-RT-DAY-ZERO              PIC S9(03)V   VALUE ZERO     00950008
010400                                                   COMP-3.        00960008
010500     05  PC-FT-X                     PIC  X(01)    VALUE 'X'.     00970008
010600     05  PC-OP-QTY-0                 PIC S9(9)     VALUE ZEROES   00980008
010700                                                   COMP-3.        00990008
010800     05  PC-OUTL-QTY-0               PIC S9(9)     VALUE ZEROES   01000008
010900                                                   COMP-3.        01010008
010901     05  PC-100                      PIC S9(3)     VALUE  +100    01020008
010902                                                   COMP-3.        01030008
010901     05  PC-200                      PIC S9(3)     VALUE  +200    01020008
010902                                                   COMP-3.        01030008
010901     05  PC-400                      PIC S9(3)     VALUE  +400    01020008
010902                                                   COMP-3.        01030008
010903     05  PC-0                        PIC S9(3)     VALUE ZEROES   01040008
010904                                                   COMP-3.        01050008
011000                                                                  01060008
011100     05  PC-MAX-LINES                 PIC S9(3)      VALUE +57.   01070008
011200                                                                  01080008
011300 01  PV-ACCUMULATOR-FIELDS.                                       01090008
011400     05  PV-CHANGE-CNT               PIC S9(07)    VALUE ZERO     01100008
011500                                                   COMP-3.        01110008
011600     05  PV-CURR-TMST                PIC  X(26)    VALUE SPACES.  01120008
011700     05  PV-COMMIT-TMST              PIC  X(26)    VALUE SPACES.  01130008
011800     05  PV-DATE.                                                 01140008
011900         10  PV-CC                   PIC 9(2) VALUE ZEROES.       01150008
012000         10  PV-YR                   PIC 9(2) VALUE ZEROES.       01160008
012100         10  PV-MO                   PIC 9(2) VALUE ZEROES.       01170008
012200         10  PV-DY                   PIC 9(2) VALUE ZEROES.       01180008
012300*                                                                 01190008
012400 01  CD-CPU-DATE.                                                 01200008
012500     05  CD-CPU-YR                    PIC 9(4)       VALUE ZEROS. 01210008
012600     05  CD-CPU-MO                    PIC 9(2)       VALUE ZEROS. 01220008
012700     05  CD-CPU-DY                    PIC 9(2)       VALUE ZEROS. 01230008
012800 01  PV-SCHED-DATE.                                               01240008
012900     05  PV-SCHED-CCYY                PIC 9(4)       VALUE ZEROS. 01250008
013000     05  PV-SCHED-FILLER              PIC X(1)       VALUE SPACE. 01260008
013100     05  PV-SCHED-MM                  PIC 9(2)       VALUE ZEROS. 01270008
013200     05  PV-SCHED-FILLER              PIC X(1)       VALUE SPACE. 01271008
013201     05  PV-SCHED-DD                  PIC 9(2)       VALUE ZEROS. 01272008
013202*                                                                 01273008
013203 01  PV-CPU-DATE.                                                 01274008
013204     05  PV-CPU-MO                    PIC 9(2)       VALUE ZEROS. 01275008
013205     05  FILLER                       PIC X(1)       VALUE '/'.   01276008
013206     05  PV-CPU-DY                    PIC 9(2)       VALUE ZEROS. 01277008
013300     05  FILLER                       PIC X(1)       VALUE '/'.   01278008
013400     05  PV-CPU-YR                    PIC 9(4)       VALUE ZEROS. 01279008
013500*                                                                 01280008
013600 01  CT-CPU-TIME.                                                 01290008
013700     05  CT-CPU-HR                    PIC 9(2)       VALUE ZEROS. 01300008
013800     05  CT-CPU-MIN                   PIC 9(2)       VALUE ZEROS. 01310008
013900     05  CT-CPU-SEC                   PIC 9(2)       VALUE ZEROS. 01320008
014000     05  CT-CPU-HSEC                  PIC 9(2)       VALUE ZEROS. 01330008
014100*                                                                 01340008
014200 01  RT-INFO.                                                     01350008
014300     05  RT-DAY-NO                    PIC 9(1)       VALUE ZEROS. 01360008
014400     05  FILLER                       PIC X(79)      VALUE SPACES.01370008
014500*                                                                 01380008
014600 01  PV-MISC-FIELDS.                                              01390008
014700     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01400008
014800                                                   COMP SYNC.     01410008
014900     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01420008
015000                                                                  01430008
015100     05  PV-CHANGE-ITEM              PIC  S9(15)V  VALUE ZERO     01440008
015200                                                    COMP-3.       01450008
015300     05  PV-CITY-NAME                PIC  X(15)    VALUE SPACES.  01460008
015400                                                                  01470008
015500     05  PV-CLASS-NBR                PIC  X(02)    VALUE SPACES.  01480008
015600                                                                  01490008
015700     05  PV-DELETE-ITEM              PIC  S9(15)V  VALUE ZERO     01500008
015800                                                    COMP-3.       01510008
015900     05  PV-DEPT-DESC                PIC X(25)     VALUE SPACES.  01520008
016000                                                                  01530008
016100     05  PV-DEPT-NBR                 PIC X(03)     VALUE SPACES.  01540008
016200                                                                  01550008
016300     05  PV-DEPT-NBR-HOLD            PIC X(03)     VALUE SPACES.  01560008
016400                                                                  01570008
016500     05  PV-FISCAL-NOSIGN            PIC  9(02)    VALUE ZERO.    01580008
016600     05  PV-FISCAL-SPLIT.                                         01590008
016700         10  PV-FISCAL-DIGIT1        PIC  9(01)    VALUE ZERO.    01600008
016800         10  PV-FISCAL-DIGIT2        PIC  9(01)    VALUE ZERO.    01610008
016900             88  PV-ODD                    VALUE 1, 3, 5, 7, 9.   01620008
017000     05  PV-F2                       PIC  X(02)    VALUE 'F2'.    01630008
017100                                                                  01640008
017200     05  PV-FT-CDE                   PIC  X(01)    VALUE SPACES.  01650008
017300                                                                  01660008
017400     05  PV-ITEM-DAY-NBR             PIC S9(03)V   VALUE ZERO     01670008
017500                                                        COMP-3.   01680008
017501     05  PV-ITEM-DAY-NBRB            PIC S9(03)V   VALUE ZERO     01690008
017502                                                        COMP-3.   01700008
017600     05  PV-LINE-CNT                 PIC S9(04)    VALUE ZEROS    01710008
017700                                                    COMP-3.       01720008
017800     05  PV-METRO                    PIC S9(05)V   VALUE ZERO     01730008
017900                                                        COMP-3.   01740008
018000     05  PV-METRO-HOLD               PIC S9(05)V   VALUE ZERO     01750008
018100                                                        COMP-3.   01760008
018200     05  PV-METRO-COUNT              PIC 9(05)     VALUE ZEROS    01770008
018300                                                     COMP-3.      01780008
018400     05  PV-PAGE-CNT                 PIC 9(04)     VALUE ZEROS    01790008
018500                                                     COMP-3.      01800008
018600     05  PV-RT-NBR                   PIC S9(03)V   VALUE ZERO     01810008
018700                                                       COMP-3.    01820008
018800     05  PV-RT-DAY-NBR               PIC S9(03)V   VALUE ZERO     01830008
018900                                                        COMP-3.   01840008
019000     05  PV-RT-DAY-NBR-7             PIC S9(03)V   VALUE ZERO     01850008
019100                                                        COMP-3.   01860008
019101     05  PV-RT-DAY-NBR-7B            PIC S9(03)V   VALUE ZERO     01870008
019102                                                        COMP-3.   01880008
019101     05  PV-RT-DAY-NBR-7C            PIC S9(03)V   VALUE ZERO     01870008
019102                                                        COMP-3.   01880008
019101     05  PV-RT-DAY-NBR-7D            PIC S9(03)V   VALUE ZERO     01870008
019102                                                        COMP-3.   01880008
019200     05  PV-RT-DAY-NBR-14            PIC S9(03)V   VALUE ZERO     01890008
019300                                                        COMP-3.   01900008
019400     05  PV-SKU                      PIC 9(08)     VALUE ZERO.    01910008
019500                                                                  01920008
019600     05  PV-SKU-DESC                 PIC X(25)     VALUE SPACES.  01930008
019700                                                                  01940008
019701     05  PV-RT-DAY-CAL               PIC 9(01)     VALUE ZERO.    01950008
019702                                                                  01960008
019800***  05  PV-ONE-THRU-SEVEN-X         PIC  9(02).                  01970008
019900***      88 PV-ONE-THRU-SEVEN                      VALUES ARE     01980008
020000***                                  01 02 03 04 05 06 07.        01990008
020001                                                                  02000008
020002***  05  PV-EIGHT-THRU-FOURTEEN-X    PIC  9(02).                  02010008
020003***      88 PV-EIGHT-THRU-FOURTEEN                 VALUES ARE     02011008
020004***                                  08 09 10 11 12 13 14.        02012008
020200                                                                  02013008
020201     05  PV-STAT-CDE                 PIC  9(03)    VALUE ZERO.    02014008
020202         88 MIXED                                  VALUE 25.      02015008
020203         88 CLEARANCE                              VALUE 30.      02016008
020204         88 DISCONTINUED                           VALUE 90.      02017008
020205                                                                  02018008
020500     05  PV-STORE-NO                 PIC 9(05)     VALUE ZEROS.   02030008
020500     05  PV-STORE-COUNT              PIC 9(05)     VALUE ZEROS    02030008
020600                                                     COMP-3.      02040008
020700 01  HL-HEADING-LINE1.                                            02050008
020800     05  FILLER                       PIC X(39)    VALUE SPACE.   02060008
020900     05  FILLER                       PIC X(55)    VALUE          02070008
021000     'ACTIVE TO CLEARANCE OR DISCONTINUED SKUS INFOREM UPDATE'.   02080008
021100     05  FILLER                       PIC X(01)    VALUE SPACE.   02090008
021200                                                                  02100008
021300 01  HL-HEADING-LINE2.                                            02110008
021400     05  FILLER                       PIC X(21)    VALUE SPACE.   02120008
021500     05  FILLER                       PIC X(30)    VALUE          02130008
021600         'INFOREM SKUS WITH CLEARANCE OR'.                        02140008
021700     05  FILLER                       PIC X(29)    VALUE          02150008
021800         ' DISCONTINUED STATUS UPDATED '.                         02160008
021900     05  FILLER                       PIC X(33)    VALUE          02170008
022000         'RT, RT DAY, OP, OUTL = 0 AND FT=X'.                     02180008
022100     05  FILLER                       PIC X(05)    VALUE SPACE.   02190008
022200                                                                  02200008
022300 01  HL-HEADING-LINE3.                                            02210008
022400     05  FILLER                       PIC X(36)    VALUE SPACE.   02220008
022500     05  FILLER                       PIC X(32)    VALUE          02230008
022600         'INFOREM SKUS WITH MIXED STATUS '.                       02240008
022700     05  FILLER                       PIC X(29)    VALUE          02250008
022800         'UPDATED CLEARANCE STORES FT=X'.                         02260008
022900     05  FILLER                       PIC X(01)    VALUE SPACE.   02270008
023000                                                                  02280008
023100 01  HL-HEADING-LINE4.                                            02290008
023200     05  FILLER                       PIC X(03)    VALUE SPACE.   02300008
023300     05  FILLER                       PIC X(12)    VALUE          02310008
023400         'DEPARTMENT: '.                                          02320008
023500     05  HL4-DEPT-NO                  PIC Z(03).                  02330008
023600     05  FILLER                       PIC X(03)    VALUE SPACE.   02340008
023700     05  HL4-DEPT-NAME                PIC X(25).                  02350008
023800     05  FILLER                       PIC X(02)    VALUE SPACE.   02360008
023900                                                                  02370008
024000 01  HL-HEADING-LINE5.                                            02380008
024100     05  FILLER                       PIC X(49)    VALUE SPACE.   02390008
024200     05  FILLER                       PIC X(5)     VALUE          02400008
024300         'METRO'.                                                 02410008
024400     05  FILLER                       PIC X(78)    VALUE SPACE.   02420008
024500                                                                  02430008
024700 01  HL-HEADING-LINE6.                                            02460052
024800     05  FILLER                       PIC X(1)       VALUE SPACE. 02890052
024900     05  FILLER                       PIC X(04)      VALUE        02910052
025000         'DEPT'.                                                  02520052
025100     05  FILLER                       PIC X(01)      VALUE SPACE. 02920052
025200     05  FILLER                       PIC X(02)      VALUE        02930052
025300         'CL'.                                                    02520052
025400     05  FILLER                       PIC X(01)      VALUE SPACE. 02940052
025500     05  FILLER                       PIC X(08)      VALUE              52
025600         'SKU     '.                                                      
025700     05  FILLER                       PIC X(02)      VALUE SPACE. 02960052
025800     05  FILLER                       PIC X(15)      VALUE        02510052
025900         'SKU DESCRIPTION'.                                       02520052
026000     05  FILLER                       PIC X(15)      VALUE SPACE. 02530052
026100     05  FILLER                       PIC X(5)      VALUE         02540052
026200         'NBR  '.                                                 02550052
026300     05  FILLER                       PIC X(04)      VALUE SPACE. 02560052
026400     05  FILLER                       PIC X(09)      VALUE        02570052
026500         'CITY NAME'.                                             02580052
026600     05  FILLER                       PIC X(10)      VALUE SPACE. 02590052
026700     05  FILLER                       PIC X(5)      VALUE         02600052
026710         'STORE'.                                                 02610052
026720     05  FILLER                       PIC X(4)       VALUE SPACE. 02620052
026730     05  FILLER                       PIC X(10)      VALUE        02630052
026740         'STORE NAME'.                                            02640052
026750     05  FILLER                       PIC X(19)      VALUE SPACE. 02650052
026760     05  FILLER                       PIC X(06)      VALUE        02660052
026770         'STATUS'.                                                02670052
026800                                                                  02660008
026900 01  HL-HEADING-LINE7.                                            02670008
027000     05  FILLER                       PIC X(1)    VALUE SPACE.          52
027100     05  FILLER                       PIC X(04)   VALUE ALL '-'.  02910052
027200     05  FILLER                       PIC X(01)   VALUE SPACE.    02920052
027300     05  FILLER                       PIC X(02)   VALUE ALL '-'.  02930052
027400     05  FILLER                       PIC X(01)   VALUE SPACE.    02940052
027500     05  FILLER                       PIC X(08)   VALUE ALL '-'.  02950052
027600     05  FILLER                       PIC X(02)   VALUE SPACE.          52
027700     05  FILLER                       PIC X(25)   VALUE ALL '-'.  02970052
027800     05  FILLER                       PIC X(05)   VALUE SPACE.          52
027900     05  FILLER                       PIC X(04)   VALUE ALL '-'.  02990052
028000     05  FILLER                       PIC X(05)   VALUE SPACE.          52
028100     05  FILLER                       PIC X(15)   VALUE ALL '-'.  03010052
028200     05  FILLER                       PIC X(04)   VALUE SPACE.          52
028300     05  FILLER                       PIC X(05)   VALUE ALL '-'.        52
028310     05  FILLER                       PIC X(04)   VALUE SPACE.          52
028320     05  FILLER                       PIC X(25)   VALUE ALL '-'.  03050052
028330     05  FILLER                       PIC X(04)   VALUE SPACE.    03060052
028340     05  FILLER                       PIC X(12)   VALUE ALL '-'.  03070052
028350     05  FILLER                       PIC X(5)    VALUE SPACE.          52
028400                                                                  02820008
028500 01  HL-HEADING-BLANK.                                            02830008
028600     05  FILLER                       PIC X(20)      VALUE        02840008
028700         '                    '.                                  02850008
028800 01  DETAIL-LINE.                                                 02860008
028900     05  FILLER                       PIC X(1)       VALUE SPACE. 02890052
029000     05  DL-DEPT                      PIC Z(03).                  02910052
029100     05  FILLER                       PIC X(02)      VALUE SPACE. 02920052
029200     05  DL-CLASS                     PIC X(02).                  02930052
029300     05  FILLER                       PIC X(01)      VALUE SPACE. 02940052
029400     05  DL-SKU                       PIC Z(08).                  02950052
029500     05  FILLER                       PIC X(02)      VALUE SPACE. 02960052
029600     05  DL-DESCRIPTION               PIC X(25).                  02970052
029700     05  FILLER                       PIC X(05)      VALUE SPACE. 02980052
029800     05  DL-METRO                     PIC X(04).                  02990052
029900     05  FILLER                       PIC X(05)      VALUE SPACE. 03000052
030000     05  DL-CITY                      PIC X(15).                  03010052
030100     05  FILLER                       PIC X(04)      VALUE SPACE. 03020052
030200     05  DL-STORE-X.                                                    52
030200         10  DL-STORE-NO                  PIC ZZZZ9.                    52
030300     05  FILLER                       PIC X(04)      VALUE SPACE. 03040052
030400     05  DL-STORE-NAME                PIC X(25).                  03050052
030500     05  FILLER                       PIC X(04)      VALUE SPACE. 03060052
030600     05  DL-STATUS                    PIC X(12).                  03070052
030700     05  FILLER                       PIC X(5)       VALUE SPACE. 03080052
030900******************************************                        03070008
031000                                                                  03080008
031100 01  NO-REPORT-LINE.                                              03090008
031200     05  FILLER                       PIC X(20)      VALUE        03100008
031300         '*NO RECORDS UPDATED*'.                                  03110008
031400                                                                  03120008
031500 01  END-OF-REPORT-LINE.                                          03130008
031600     05  FILLER                       PIC X(20)      VALUE        03140008
031700         '** END OF REPORT ** '.                                  03150008
031800                                                                  03160008
031810******************************************************************        
031820*    NI SKU WORK AREA FIELDS                                              
031830******************************************************************        
031840     COPY ISWS006.                                                        
031850                                                                  03180052
031860     EXEC SQL                                                     03190052
031870         INCLUDE TSKXREF                                          03200052
031880     END-EXEC.                                                    03210052
031890                                                                  03220052
031900     EXEC SQL                                                     03170008
032000         INCLUDE TMRITEM                                          03180008
032100     END-EXEC.                                                    03190008
032200                                                                  03200008
032300     EXEC SQL                                                     03210008
032400         INCLUDE TMRITST                                          03220008
032500     END-EXEC.                                                    03230008
032600                                                                  03240008
032700     EXEC SQL                                                     03250008
032800         INCLUDE TSK                                              03260008
032900     END-EXEC.                                                    03270008
033000                                                                  03280008
033100     EXEC SQL                                                     03290008
033200         INCLUDE TUPCPLS                                          03300008
033300     END-EXEC.                                                    03310008
033400                                                                  03320008
033500     EXEC SQL                                                     03330008
033600         INCLUDE XMT00001                                         03340008
033700     END-EXEC.                                                    03350008
033800                                                                  03360008
033500     EXEC SQL                                                     03330008
033600         INCLUDE XMT00003                                         03340008
033700     END-EXEC.                                                    03350008
033800                                                                  03360008
033900     EXEC SQL                                                     03370008
034000         INCLUDE TCKRSTCN                                         03380008
034100     END-EXEC.                                                    03390008
034200                                                                  03400008
034300     EXEC SQL                                                     03410008
034400         INCLUDE TMDSEAR                                          03420008
034500     END-EXEC.                                                    03430008
034600                                                                  03440008
034700* DB2 COMMUNICATION AREA                                          03450008
034800                                                                  03460008
034900     EXEC SQL                                                     03470008
035000         INCLUDE SQLCA                                            03480008
035100     END-EXEC.                                                    03490008
035200                                                                  03500008
035300* DB2 COMMUNICATION AREA2                                         03510008
035400                                                                  03520008
035500     COPY SQLCA2.                                                 03530008
035600                                                                  03540008
035700******************************************                        03550008
035800     EXEC SQL                                                     03560008
035900       DECLARE CHG_CSR CURSOR WITH HOLD FOR                       03570008
036000     SELECT DISTINCT A.ITEM_NBR                                   03580008
036100                    ,C.STATUS_CODE                                03590008
036200                    ,D.DEPT                                             08
036300                    ,D.SUBCLASS                                         08
036400                    ,D.SKU                                              08
036500                    ,C.SKU_DESC                                   03630008
036600     FROM TMRITEM A,                                              03640008
036800          TSK C,                                                  03660008
036810          TSKXREF D                                               03660008
036900     WHERE                                                        03670008
037000            A.ITEM_NBR = C.ITEM_NMBR                              03680008
037010        AND A.ITEM_NBR = D.ITM_NBR                                      08
037100        AND C.STATUS_CODE IN (25,30,90)                           03690008
037200        AND ((A.RT_NBR = 7 AND A.RT_DAY_NBR = :PV-RT-DAY-NBR-7)   03700008
037201         OR  (A.RT_NBR = 14 AND A.RT_DAY_NBR = :PV-RT-DAY-NBR-14) 03710008
037202         OR  (A.RT_NBR = 7 AND A.RT_DAY_NBR = :PV-RT-DAY-NBR-7B)  03720008
037202         OR  (A.RT_NBR = 7 AND A.RT_DAY_NBR = :PV-RT-DAY-NBR-7C)  03720008
037202         OR  (A.RT_NBR = 7 AND A.RT_DAY_NBR = :PV-RT-DAY-NBR-7D)) 03720008
037400     ORDER BY D.DEPT, C.STATUS_CODE                                     08
037500     END-EXEC.                                                    03740008
037600*                                                                 03750008
037700******************************************                        03760008
037800     EXEC SQL                                                     03770008
037900       DECLARE CHG_CSR2 CURSOR WITH HOLD FOR                      03780008
038000     SELECT DISTINCT A.ITEM_NBR                                   03790008
038100                    ,C.STATUS_CODE                                03800008
038200                    ,D.DEPT                                             08
038300                    ,D.SUBCLASS                                         08
038400                    ,D.SKU                                              08
038500     FROM TMRITEM A,                                              03840008
038700          TSK C,                                                  03850008
038710          TSKXREF D                                               03850008
038800     WHERE                                                        03860008
038900            A.ITEM_NBR = C.ITEM_NMBR                              03870008
038910        AND A.ITEM_NBR = D.ITM_NBR                                      08
039000        AND C.STATUS_CODE IN (25,30,90)                           03880008
039100        AND ((A.RT_NBR = 4 AND A.RT_DAY_NBR = :PV-ITEM-DAY-NBR)   03890008
039110         OR (A.RT_NBR = 4 AND A.RT_DAY_NBR = :PV-ITEM-DAY-NBRB))  03900008
039200     ORDER BY D.DEPT, C.STATUS_CODE                                     08
039300     END-EXEC.                                                    03920008
039400*                                                                 03930008
039500******************************************                        03940008
039600     EXEC SQL                                                     03950008
039700       DECLARE STORE_CSR CURSOR WITH HOLD FOR                     03960008
039800     SELECT DISTINCT A.STR_NBR                                    03970008
039900                    ,B.LOC_NBR                                    03980008
040000                    ,B.LOC_NM                                     03990008
040100                    ,B.CTY_NM                                     04000008
040200                    ,D.STR_GP_TYP_CDE                             04010008
040300                    ,C.FT_CDE                                     04020008
040400     FROM TUPCPLS A,                                              04030008
040500          XMT_LOC B,                                              04040008
040600          TMRITST C,                                              04050008
040500          XMT_STR_GP_MBSHP D                                      04040008
040700     WHERE A.STR_NBR = B.LOC_NBR                                  04060008
040800        AND  A.STR_NBR > 0                                        04070008
040900        AND  A.ITM_NBR = C.ITEM_NBR                               04080008
041000        AND ((CURRENT TIMESTAMP                                   04090008
041100             BETWEEN A.EFF_BEG_TMST AND A.EFF_END_TMST)           04100008
041101        OR  ((CURRENT TIMESTAMP   >   A.EFF_BEG_TMST)             04110008
041102                 AND (A.EFF_END_TMST IS NULL)))                   04111008
041200        AND  A.ITM_NBR = :MRITEM-ITEM-NBR                         04112008
041300        AND  B.LOC_NBR    = C.STR_NBR                             04113008
041300        AND  B.LOC_NBR    = D.LOC_NBR                             04113008
041300        AND  D.STR_GP_TYP_CDE = 5000                              04113008
              AND  D.EFF_BEG_DTE    < CURRENT_DATE                              
              AND (D.EFF_END_DTE    > CURRENT_DATE                              
               OR  D.EFF_END_DTE    IS NULL)                                    
041400        AND NOT C.FT_CDE = 'X'                                    04114008
041410        AND A.UPC_STAT_CDE = '30'                                 04115008
041500     ORDER BY D.STR_GP_TYP_CDE, B.LOC_NBR                         04116008
041600     END-EXEC.                                                    04117008
041700*                                                                 04118008
041800***************************************************************** 04119008
041900 PROCEDURE DIVISION.                                              04120008
042000***************************************************************** 04130008
042100 A000-MAINLINE-PROCESSING.                                        04140008
042200                                                                  04150008
042300     PERFORM A100-INITIALIZATION.                                 04160008
042400**                                                                04170008
042500     IF RT-DAY-NO NOT = ZERO                                      04180008
042600*** SMM                                                           04190008
042700        ADD PC-100   TO    RT-DAY-NO  GIVING                      04200008
042701                           PV-RT-DAY-NBR-7B                       04210008
042700        ADD PC-200   TO    RT-DAY-NO  GIVING                      04200008
042701                           PV-RT-DAY-NBR-7C                       04210008
042700        ADD PC-400   TO    RT-DAY-NO  GIVING                      04200008
042701                           PV-RT-DAY-NBR-7D                       04210008
042702        IF PV-ODD                                                 04220008
042703           MOVE RT-DAY-NO TO PV-RT-DAY-NBR-7 PV-RT-DAY-NBR-14     04230008
042800           PERFORM S100-OPEN-CHG-CSR                              04231008
042900           PERFORM B100-PROCESS-CHANGE-RECORD                     04232008
043000             UNTIL EOC-ITEM-CSR                                   04233008
043100        ELSE                                                      04234008
043200           MOVE RT-DAY-NO TO PV-RT-DAY-NBR-7                      04235008
043300           ADD 7 TO RT-DAY-NO GIVING PV-RT-DAY-NBR-14             04236008
043400           PERFORM S100-OPEN-CHG-CSR                              04237008
043500           PERFORM B100-PROCESS-CHANGE-RECORD                     04238008
043600             UNTIL EOC-ITEM-CSR                                   04239008
043700        END-IF                                                    04240008
043800     ELSE                                                         04240108
043900        MOVE 0 TO PV-ITEM-DAY-NBR                                 04240208
043910        MOVE PC-100 TO PV-ITEM-DAY-NBRB                           04240308
044000        PERFORM S200-OPEN-CHG-CSR2                                04240408
044100        PERFORM B200-PROCESS-CHANGE-RECORD2                       04240508
044200             UNTIL EOC-ITEM-CSR2                                  04240608
044300     END-IF.                                                      04240708
044400**                                                                04240808
044500**     WHEN OTHER                                                 04240908
049300**       DISPLAY 'PARAGRAPH A000, BAD RT-DAY-NO: 0-14 GOOD'       04241008
049400**       DISPLAY 'RT-DAY-NO ' RT-DAY-NO                           04241108
049401**       DISPLAY 'PV-RT-DAY-NBR-7  ' PV-RT-DAY-NBR-7              04241208
049402**       DISPLAY 'PV-RT-DAY-NBR-14 ' PV-RT-DAY-NBR-14             04241308
049403**       DISPLAY 'PV-ITEM-DAY-NBR  ' PV-ITEM-DAY-NBR              04241408
049500**       DISPLAY ' '                                              04241508
049600**       PERFORM Z999-SQL-ERROR                                   04241608
049601*** ** ** ** ** ************************** ORIG CODE ********     04241708
049602**   IF RT-DAY-NO NOT = ZERO                                      04241808
049603**      IF PV-ODD                                                 04241908
049604**         MOVE RT-DAY-NO TO PV-RT-DAY-NBR-7 PV-RT-DAY-NBR-14     04242008
049605**         PERFORM S100-OPEN-CHG-CSR                              04243008
049606**         PERFORM B100-PROCESS-CHANGE-RECORD                     04244008
049607**           UNTIL EOC-ITEM-CSR                                   04245008
049608**      ELSE                                                      04246008
049609**         MOVE RT-DAY-NO TO PV-RT-DAY-NBR-7                      04247008
049610**         ADD 7 TO RT-DAY-NO GIVING PV-RT-DAY-NBR-14             04248008
049611**         PERFORM S100-OPEN-CHG-CSR                              04249008
049612**         PERFORM B100-PROCESS-CHANGE-RECORD                     04250008
049613**           UNTIL EOC-ITEM-CSR                                   04260008
049614**      END-IF                                                    04270008
049615**   ELSE                                                         04280008
049616**      MOVE 0 TO PV-ITEM-DAY-NBR                                 04290008
049617**      PERFORM S200-OPEN-CHG-CSR2                                04300008
049618**      PERFORM B200-PROCESS-CHANGE-RECORD2                       04310008
049619**           UNTIL EOC-ITEM-CSR2                                  04320008
049620**   END-IF.                                                      04330008
049621*** ** ** ** ** *********************************************     04340008
049622                                                                  04350008
049623     IF PV-CHANGE-CNT = 0                                         04360008
049624        WRITE PRINT-LINE FROM NO-REPORT-LINE                      04370008
049625             AFTER ADVANCING 2                                    04380008
049626     END-IF.                                                      04390008
049627                                                                  04400008
049628     WRITE PRINT-LINE FROM END-OF-REPORT-LINE                     04410008
049629             AFTER ADVANCING 2.                                   04420008
049630                                                                  04430008
049631     CLOSE  PRINT-REPORT.                                         04440008
049632                                                                  04450008
049633     GOBACK.                                                      04460008
049634*                                                                 04470008
049635******************************************************************04480008
049636** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 04490008
049637** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM    04500008
049638******************************************************************04510008
049639 A100-INITIALIZATION.                                             04520008
049640                                                                  04530008
049641     OPEN OUTPUT PRINT-REPORT.                                    04540008
049642                                                                  04550008
049643     ACCEPT CT-CPU-TIME FROM TIME.                                04560008
049644*    ACCEPT RT-INFO.                                              04570008
049645*    ACCEPT CD-CPU-DATE FROM DATE YYYYMMDD.                       04580008
049646*     CHANGED TO ACCEPT THE SCHEDULED DATE.                       04590008
049647     ACCEPT PV-SCHED-DATE.                                        04600008
049648     MOVE CT-CPU-HR                   TO DP132-RUN-HOUR.          04610008
049649     MOVE CT-CPU-MIN                  TO DP132-RUN-MINUTE.        04620008
049650                                                                  04630008
049651     MOVE PV-SCHED-MM                 TO DP132-RUN-MONTH.         04640008
049652     MOVE PV-SCHED-DD                 TO DP132-RUN-DAY.           04650008
049653     MOVE PV-SCHED-CCYY               TO DP132-RUN-YEAR.          04660008
049654**   MOVE CD-CPU-MO                   TO DP132-RUN-MONTH.         04670008
049655**   MOVE CD-CPU-DY                   TO DP132-RUN-DAY.           04680008
049656**   MOVE CD-CPU-YR                   TO DP132-RUN-YEAR.          04690008
049657     MOVE 1                           TO DP132-REPORT-NUMBER.     04700008
049658     MOVE 'MRKUP097'                  TO DP132-PROGRAM-NAME.      04710008
049659*                                                                 04720008
049660     MOVE ZEROS                       TO PV-LINE-CNT              04730008
049661     MOVE ZEROS                       TO PV-PAGE-CNT              04740008
049662     PERFORM N100-REPORT-HEADINGS.                                04750008
049663*                                                                 04760008
049664*  SET UP FIRST SCHEDULED COMMIT TIME                             04770008
049665*                                                                 04780008
049666     EXEC SQL                                                     04790008
049667         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    04800008
049668           INTO  :PV-COMMIT-TMST                                  04810008
049669           FROM  TCKRSTCNTL                                       04820008
049670          WHERE  PLAN_NAME = 'MRKUP097'                           04830008
049671     END-EXEC.                                                    04840008
049672                                                                  04850008
049673     IF SQLCODE = +0                                              04860008
049674         CONTINUE                                                 04870008
049675     ELSE                                                         04880008
049676         DISPLAY 'PARAGRAPH A100, BAD SELECT FOR TIMESTAMP'       04890008
049677         DISPLAY 'SQLCODE ' SQLCODE                               04900008
049678         DISPLAY ' '                                              04910008
049679         PERFORM Z999-SQL-ERROR                                   04920008
049700     END-IF.                                                      04930008
049800                                                                  04940008
049900     PERFORM R100-FIND-FISCAL-WEEK.                               04950008
050000                                                                  04960008
050100*                                                                 04970008
050200******************************************************************04980008
050300*  PROCESS CHANGE RECORD UNTIL EOC                               *04990008
050400******************************************************************05000008
050500 B100-PROCESS-CHANGE-RECORD.                                      05010008
050600                                                                  05020008
050700     PERFORM D100-FETCH-CHG-ITEM-CURSOR.                          05030008
050800                                                                  05040008
050900     IF EOC-ITEM-CSR                                              05050008
051000       CONTINUE                                                   05060008
051100     ELSE                                                         05070008
051200       PERFORM D100-FETCH-CHG-ITEM-CURSOR                         05080008
051300           UNTIL EOC-ITEM-CSR                                     05090008
051400     END-IF.                                                      05100008
051500*                                                                 05110008
051600******************************************************************05120008
051700*  PROCESS CHANGE RECORD2 UNTIL EOC                               05130008
051800******************************************************************05140008
051900 B200-PROCESS-CHANGE-RECORD2.                                     05150008
052000                                                                  05160008
052100     PERFORM D200-FETCH-CHG-ITEM-CURSOR2.                         05170008
052200                                                                  05180008
052300     IF EOC-ITEM-CSR2                                             05190008
052400       CONTINUE                                                   05200008
052500     ELSE                                                         05210008
052600       PERFORM D200-FETCH-CHG-ITEM-CURSOR2                        05220008
052700           UNTIL EOC-ITEM-CSR2                                    05230008
052800     END-IF.                                                      05240008
052900*                                                                 05250008
053000******************************************************************05260008
053100* THIS PARAGRAPH FETCHES THE ITEM CURSOR FOR CHANGE RECORDS      *05270008
053200******************************************************************05280008
053300 D100-FETCH-CHG-ITEM-CURSOR.                                      05290008
053400                                                                  05300008
053500     MOVE 'D100'                   TO PGM-LOCATION.               05310008
053600     MOVE 'D100-FETCH-CHG-ITEM-CURSOR'                            05320008
053700                                   TO PV-ABEND-PARAGRAPH.         05330008
053800     EXEC SQL                                                     05340008
053900       FETCH CHG_CSR                                              05350008
054000        INTO                                                      05360008
054100             :MRITEM-ITEM-NBR,                                    05370008
054200             :TSK-STATUS-CODE,                                    05380008
054300             :SKXREF-DEPT,                                        05390008
054400             :SKXREF-SUBCLASS,                                    05400008
054500             :SKXREF-SKU,                                         05410008
054600             :TSK-SKU-DESC                                        05420008
054700     END-EXEC.                                                    05430008
054800                                                                  05440008
054900     EVALUATE TRUE                                                05450008
055000       WHEN SQLCODE         = ZERO                                05460008
055100         CONTINUE                                                 05470008
055200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05480008
055300         PERFORM U100-CLOSE-CHG-ITEM-CSR                          05490008
055400         SET EOC-ITEM-CSR TO TRUE                                 05500008
055500       WHEN OTHER                                                 05510008
055600         DISPLAY PV-ABEND-PARAGRAPH                               05520008
055700         PERFORM Z999-SQL-ERROR                                   05530008
055800     END-EVALUATE.                                                05540008
055900                                                                  05550008
056000     IF NOT EOC-ITEM-CSR                                          05560008
056100        MOVE SKXREF-DEPT TO NI-DEPT-9-3                           05570008
056110        MOVE NI-DEPT-X-3 TO PV-DEPT-NBR                           05570008
056200        MOVE TSK-STATUS-CODE    TO PV-STAT-CDE                    05580008
056300        PERFORM D400-GET-DEPT-NAME                                05590008
056400        IF PV-DEPT-NBR NOT = PV-DEPT-NBR-HOLD                     05600008
056500           MOVE PV-DEPT-NBR     TO PV-DEPT-NBR-HOLD               05610008
056600           MOVE PV-DEPT-NBR     TO NI-DEPT-X-3                    05620008
056610           MOVE NI-DEPT-9-3     TO HL4-DEPT-NO                    05620008
056700           MOVE PV-DEPT-DESC    TO HL4-DEPT-NAME                  05630008
056800           IF NOT MIXED                                           05640008
056900              PERFORM N200-DETAIL-HEADINGS                        05650008
057000           END-IF                                                 05660008
057100        END-IF                                                    05670008
057200                                                                  05680008
057300        PERFORM D300-CONTINUE-MOVE                                05690008
057400                                                                  05700008
057500     END-IF.                                                      05710008
057600*                                                                 05720008
057700******************************************************************05730008
057800* THIS PARAGRAPH FETCHES THE ITEM CURSOR2 FOR CHANGE RECORDS     *05740008
057900******************************************************************05750008
058000 D200-FETCH-CHG-ITEM-CURSOR2.                                     05760008
058100                                                                  05770008
058200     MOVE 'D200'                   TO PGM-LOCATION.               05780008
058300     MOVE 'D200-FETCH-CHG-ITEM-CURSOR2'                           05790008
058400                                   TO PV-ABEND-PARAGRAPH.         05800008
058500     EXEC SQL                                                     05810008
058600       FETCH CHG_CSR2                                             05820008
058700        INTO                                                      05830008
058800             :MRITEM-ITEM-NBR,                                    05840008
058900             :TSK-STATUS-CODE,                                    05850008
059000             :SKXREF-DEPT,                                        05860008
059100             :SKXREF-SUBCLASS,                                          08
059200             :SKXREF-SKU,                                         05880008
059300             :TSK-SKU-DESC                                        05890008
059400     END-EXEC.                                                    05900008
059500                                                                  05910008
059600     EVALUATE TRUE                                                05920008
059700       WHEN SQLCODE         = ZERO                                05930008
059800         CONTINUE                                                 05940008
059900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05950008
060000         PERFORM U200-CLOSE-CHG-ITEM-CSR2                         05960008
060100         SET EOC-ITEM-CSR2 TO TRUE                                05970008
060200       WHEN OTHER                                                 05980008
060300         DISPLAY PV-ABEND-PARAGRAPH                               05990008
060400         PERFORM Z999-SQL-ERROR                                   06000008
060500     END-EVALUATE.                                                06010008
060600                                                                  06020008
060700     IF NOT EOC-ITEM-CSR2                                         06030008
060800        MOVE SKXREF-DEPT TO NI-DEPT-9-3                           06040008
060810        MOVE NI-DEPT-X-3 TO PV-DEPT-NBR                           06040008
060900        MOVE TSK-STATUS-CODE    TO PV-STAT-CDE                    06050008
061000        PERFORM D400-GET-DEPT-NAME                                06060008
061100        IF PV-DEPT-NBR NOT = PV-DEPT-NBR-HOLD                     06070008
061200           MOVE PV-DEPT-NBR     TO PV-DEPT-NBR-HOLD               06080008
061300           MOVE PV-DEPT-NBR     TO NI-DEPT-X-3                    06090008
061310           MOVE NI-DEPT-9-3     TO HL4-DEPT-NO                    06090008
061400           MOVE PV-DEPT-DESC    TO HL4-DEPT-NAME                  06100008
061500           IF NOT MIXED                                           06110008
061600              PERFORM N200-DETAIL-HEADINGS                        06120008
061700           END-IF                                                 06130008
061800        END-IF                                                    06140008
061900                                                                  06150008
062000        PERFORM D300-CONTINUE-MOVE                                06160008
062100                                                                  06170008
062200     END-IF.                                                      06180008
062300                                                                  06190008
062400******************************************************************06200008
062500* THIS PARAGRAPH MOVES THE FETCHED FIELDS TO THE DETAIL LINE     *06210008
062600******************************************************************06220008
062700 D300-CONTINUE-MOVE.                                              06230008
062800                                                                  06240008
062900     MOVE 'D300'                   TO PGM-LOCATION.               06250008
063000     MOVE 'D300-CONTINUE-MOVE'                                    06260008
063100                                   TO PV-ABEND-PARAGRAPH.         06270008
063200                                                                  06280008
063300     MOVE SKXREF-DEPT              TO NI-DEPT-9-3.                06290008
063310     MOVE NI-DEPT-X-3              TO PV-DEPT-NBR.                06290008
063320                                                                          
063400     MOVE SKXREF-SUBCLASS          TO NI-SUB-CLASS-9-2.           06300008
063500     MOVE NI-SUB-CLASS-X-2         TO PV-CLASS-NBR.               06300008
063510     MOVE SKXREF-SKU               TO PV-SKU.                           08
063600     MOVE TSK-SKU-DESC             TO PV-SKU-DESC.                06320008
063700                                                                  06330008
063800     IF MIXED                                                     06340008
063900        MOVE SPACES                     TO DETAIL-LINE            06350008
064000        MOVE PV-DEPT-NBR                TO NI-DEPT-X-3            06360008
064010        MOVE NI-DEPT-9-3                TO DL-DEPT                06360008
064200        MOVE PV-CLASS-NBR               TO DL-CLASS               06380008
064400        MOVE PV-SKU                     TO DL-SKU                 06380008
064500        MOVE PV-SKU-DESC                TO DL-DESCRIPTION         06410008
064600        MOVE ALL '*'                    TO DL-METRO               06420008
064700        MOVE ALL '*'                    TO DL-CITY                06430008
064800        MOVE ALL '*'                    TO DL-STORE-X             06440008
064900        MOVE 'SEE LIST BELOW          ' TO DL-STORE-NAME          06450008
065000        MOVE 'MIXED'                    TO DL-STATUS              06460008
065100        PERFORM S300-OPEN-STORE-CSR                               06470008
065200        PERFORM D500-FETCH-STORE-CURSOR                           06480008
065300        IF EOC-STORE-CSR                                          06490008
065400           CONTINUE                                               06500008
065500        ELSE                                                      06510008
065600           PERFORM D500-FETCH-STORE-CURSOR                        06520008
065700              UNTIL EOC-STORE-CSR                                 06530008
065800           MOVE SPACES TO DETAIL-LINE                             06540008
065900           MOVE '-----' TO DL-STORE-X                             06550008
066000           PERFORM P100-PRINT-DETAIL                              06560008
066100           MOVE '   STORE COUNT:' TO DL-CITY                      06570008
066200           MOVE PV-STORE-COUNT TO DL-STORE-NO                     06580008
066300           PERFORM P100-PRINT-DETAIL                              06590008
066400           MOVE SPACES TO DETAIL-LINE                             06600008
066500           PERFORM P100-PRINT-DETAIL                              06610008
066600           MOVE ZERO TO PV-METRO-COUNT                            06620008
066700           MOVE ZERO TO PV-STORE-COUNT                            06630008
066800        END-IF                                                    06640008
066900     ELSE                                                         06650008
067000        PERFORM M100-CHG-SKUS-TMRITEM                             06660008
067100        PERFORM M200-CHG-SKUS-TMRITST                             06670008
067200        PERFORM Z900-COMMIT-TEST                                  06680008
067300        MOVE PV-DEPT-NBR           TO NI-DEPT-X-3                 06690008
067400        MOVE NI-DEPT-9-3           TO DL-DEPT                     06690008
067500        MOVE PV-CLASS-NBR          TO DL-CLASS                    06710008
067700        MOVE PV-SKU                TO DL-SKU                      06710008
067800        MOVE PV-SKU-DESC           TO DL-DESCRIPTION              06740008
067900        MOVE 'ALL'                 TO DL-METRO                    06750008
068000        MOVE 'ALL'                 TO DL-CITY                     06760008
068100        MOVE 'ALL'                 TO DL-STORE-X                  06770008
068200        MOVE 'ALL'                 TO DL-STORE-NAME               06780008
068300        IF DISCONTINUED                                           06790008
068400             MOVE 'DISCONTINUED'   TO DL-STATUS                   06800008
068500        ELSE                                                      06810008
068600             MOVE 'CLEARANCE'      TO DL-STATUS                   06820008
068700        END-IF                                                    06830008
068800        PERFORM P100-PRINT-DETAIL                                 06840008
068900     END-IF.                                                      06850008
069000*                                                                 06860008
069100******************************************************************06870008
069200*  GET DEPARTMENT NAME                                           *06880008
069300******************************************************************06890008
069400 D400-GET-DEPT-NAME.                                              06900008
069500                                                                  06910008
069600     MOVE 'D400-GET-DEPT-NAME' TO PV-ABEND-PARAGRAPH.             06920008
069700                                                                  06930008
069800     EXEC SQL                                                     06940008
069900     SELECT MDSEAR_DESC                                           06950008
070000        INTO             :PV-DEPT-DESC                            06960008
070100        FROM TMDSEAR                                              06970008
070200        WHERE DEPT_NBR = :PV-DEPT-NBR                             06980008
070300          AND MDSELV_CDE = 'DPT'                                  06990008
070400          AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE           07000008
070500     END-EXEC.                                                    07010008
070600                                                                  07020008
070700     EVALUATE TRUE                                                07030008
070800       WHEN SQLCODE         = ZERO                                07040008
070900         CONTINUE                                                 07050008
071000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    07060008
071100         CONTINUE                                                 07070008
071200       WHEN OTHER                                                 07080008
071300         DISPLAY PV-ABEND-PARAGRAPH                               07090008
071400         PERFORM Z999-SQL-ERROR                                   07100008
071500     END-EVALUATE.                                                07110008
071600                                                                  07120008
071700******************************************************************07130008
071800* THIS PARAGRAPH FETCHES THE STORE CURSOR FOR STORE NUMBER, CITY *07140008
071900******************************************************************07150008
072000 D500-FETCH-STORE-CURSOR.                                         07160008
072100                                                                  07170008
072200     MOVE 'D500'                   TO PGM-LOCATION.               07180008
072300     MOVE 'D500-FETCH-STORE-CURSOR'                               07190008
072400                                   TO PV-ABEND-PARAGRAPH.         07200008
072500     EXEC SQL                                                     07210008
072600       FETCH STORE_CSR                                            07220008
072700        INTO                                                      07230008
072800             :UPCPLS-STR-NBR,                                     07240008
072900             :XMT00001-LOC-NBR,                                   07250008
073000             :XMT00001-LOC-NM,                                    07260008
073100             :XMT00001-CTY-NM,                                    07270008
073200             :XMT00003-STR-GP-ID                                  07280008
073300     END-EXEC.                                                    07290008
073400                                                                  07300008
073500     EVALUATE TRUE                                                07310008
073600       WHEN SQLCODE         = ZERO                                07320008
073700         CONTINUE                                                 07330008
073800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    07340008
073900         PERFORM U300-CLOSE-STORE-CSR                             07350008
074000         SET EOC-STORE-CSR TO TRUE                                07360008
074100         MOVE 'N' TO PS-MIXED-STORES                              07370008
074200         IF PV-STORE-COUNT = 0                                    07380008
074300            MOVE SPACES TO PV-DEPT-NBR-HOLD                       07390008
074400         END-IF                                                   07400008
074500       WHEN OTHER                                                 07410008
074600         DISPLAY PV-ABEND-PARAGRAPH                               07420008
074700         PERFORM Z999-SQL-ERROR                                   07430008
074800     END-EVALUATE.                                                07440008
074900                                                                  07450008
075000     IF NOT EOC-STORE-CSR                                         07460008
075100          IF NOT MIXED-STORES                                     07470008
075200             PERFORM N200-DETAIL-HEADINGS                         07480008
075300             PERFORM P100-PRINT-DETAIL                            07490008
075400             SET MIXED-STORES TO TRUE                             07500008
075500          END-IF                                                  07510008
075600          PERFORM M300-CHG-SKUS-STORES                            07520008
075700          PERFORM Z900-COMMIT-TEST                                07530008
075800                                                                  07540008
075900          MOVE SPACES                    TO DETAIL-LINE           07550008
076000          MOVE XMT00003-STR-GP-ID        TO PV-METRO              07560008
076100          IF PV-METRO NOT EQUAL PV-METRO-HOLD                     07570008
076200             IF PV-METRO-COUNT > 1                                07580008
076300                MOVE '-----' TO DL-STORE-X                        07590008
076400                PERFORM P100-PRINT-DETAIL                         07600008
076500                MOVE '   METRO COUNT:'      TO DL-CITY            07610008
076600                MOVE PV-METRO-COUNT         TO DL-STORE-NO        07620008
076700                PERFORM P100-PRINT-DETAIL                         07630008
076800                MOVE SPACES                 TO DETAIL-LINE        07640008
076900                PERFORM P100-PRINT-DETAIL                         07650008
077000             END-IF                                               07660008
077100             MOVE XMT00001-CTY-NM           TO DL-CITY            07670008
077200             MOVE PV-METRO                  TO DL-METRO           07680008
077300             MOVE ZERO                      TO PV-METRO-COUNT     07690008
077400          END-IF                                                  07700008
077500          MOVE XMT00001-LOC-NBR             TO PV-STORE-NO        07710008
077500          MOVE PV-STORE-NO                  TO DL-STORE-NO        07710008
077600          MOVE XMT00001-LOC-NM              TO DL-STORE-NAME      07720008
077700          MOVE 'CLEARANCE'                  TO DL-STATUS          07730008
077800          MOVE PV-METRO TO PV-METRO-HOLD                          07740008
077900          ADD 1 TO PV-STORE-COUNT                                 07750008
078000          ADD 1 TO PV-METRO-COUNT                                 07760008
078100          PERFORM P100-PRINT-DETAIL                               07770008
078200     END-IF.                                                      07780008
078300*                                                                 07790008
078400******************************************************************07800008
078500** CHANGE STATUS ON TMRITEM TABLE FOR CHANGE SKUS PROCESS       **07810008
078600******************************************************************07820008
078700 M100-CHG-SKUS-TMRITEM.                                           07830008
078800                                                                  07840008
078900     MOVE 'M100'                   TO PGM-LOCATION.               07850008
079000     MOVE 'M100-CHG-SKUS-TMRITEM'  TO PV-ABEND-PARAGRAPH.         07860008
079100      DISPLAY ' CHANGE ITEM '   MRITEM-ITEM-NBR                   07870008
079200                                                                  07880008
079300     EXEC SQL                                                     07890008
079400         UPDATE TMRITEM                                           07900008
079500                                                                  07910008
079600         SET   RT_NBR       =  :PC-RT-ZERO,                       07920008
079700               RT_DAY_NBR   =  :PC-RT-DAY-ZERO                    07930008
079800                                                                  07940008
079900         WHERE ITEM_NBR     =  :MRITEM-ITEM-NBR                   07950008
080000     END-EXEC.                                                    07960008
080100                                                                  07970008
080200     EVALUATE TRUE                                                07980008
080300       WHEN SQLCODE         = ZERO                                07990008
080500         ADD PC-PLUS-1 TO PV-CHANGE-CNT                           08010008
080600       WHEN OTHER                                                 08020008
080700         DISPLAY PV-ABEND-PARAGRAPH                               08030008
080800         PERFORM Z999-SQL-ERROR                                   08040008
080900     END-EVALUATE.                                                08050008
081000*                                                                 08060008
081100******************************************************************08070008
081200** CHANGE STATUS ON TMRITST TABLE FOR CHANGE SKUS PROCESS       **08080008
081300******************************************************************08090008
081400 M200-CHG-SKUS-TMRITST.                                           08100008
081500                                                                  08110008
081600     MOVE 'M200'                   TO PGM-LOCATION.               08120008
081700     MOVE 'M200-CHG-SKUS-TMRITST'  TO PV-ABEND-PARAGRAPH.         08130008
081800                                                                  08140008
081900     EXEC SQL                                                     08150008
082000         UPDATE TMRITST                                           08160008
082100                                                                  08170008
082200         SET    FT_CDE      =  :PC-FT-X,                          08180008
082300                OP_QTY      =  :PC-OP-QTY-0,                      08190008
082400                OUTL_QTY    =  :PC-OUTL-QTY-0                     08200008
082500                                                                  08210008
082600         WHERE ITEM_NBR     =  :MRITEM-ITEM-NBR                   08220008
082700     END-EXEC.                                                    08230008
082800                                                                  08240008
082900     EVALUATE TRUE                                                08250008
083000       WHEN SQLCODE         = ZERO                                08260008
083100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    08270008
083200         ADD PC-PLUS-1 TO PV-CHANGE-CNT                           08280008
083300       WHEN OTHER                                                 08290008
083400         DISPLAY PV-ABEND-PARAGRAPH                               08300008
083500         PERFORM Z999-SQL-ERROR                                   08310008
083600     END-EVALUATE.                                                08320008
083700*                                                                 08330008
083800******************************************************************08340008
083900** CHANGE STATUS ON TMRITST TABLE FOR STORES                    **08350008
084000******************************************************************08360008
084100 M300-CHG-SKUS-STORES.                                            08370008
084200                                                                  08380008
084300     MOVE 'M300'                   TO PGM-LOCATION.               08390008
084400     MOVE 'M300-CHG-SKUS-STORES '  TO PV-ABEND-PARAGRAPH.         08400008
084500                                                                  08410008
084600     EXEC SQL                                                     08420008
084700         UPDATE TMRITST                                           08430008
084800                                                                  08440008
084900         SET    FT_CDE      =  :PC-FT-X                           08450008
085000                                                                  08460008
085100         WHERE ITEM_NBR     =  :MRITEM-ITEM-NBR                   08470008
085200           AND STR_NBR      =  :XMT00001-LOC-NBR                  08480008
085300     END-EXEC.                                                    08490008
085400                                                                  08500008
085500     EVALUATE TRUE                                                08510008
085600       WHEN SQLCODE         = ZERO                                08520008
085700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    08530008
086400         ADD PC-PLUS-1 TO PV-CHANGE-CNT                           08540008
086401       WHEN OTHER                                                 08550008
086402         DISPLAY PV-ABEND-PARAGRAPH                               08560008
086403         PERFORM Z999-SQL-ERROR                                   08570008
086404     END-EVALUATE.                                                08580008
086500*                                                                 08600008
086600*                                                                 08610008
086700****************************************************************  08620008
086800* WRITES THE HEADING LINES FOR THE REPORT WHEN THERE IS A      *  08630008
086900* FULL PAGE.                                                   *  08640008
087000****************************************************************  08650008
087100 N100-REPORT-HEADINGS.                                            08660008
087200                                                                  08670008
087300     MOVE ZEROS                       TO PV-LINE-CNT              08680008
087400     ADD +1                           TO PV-PAGE-CNT              08690008
087500     MOVE PV-PAGE-CNT                 TO DP132-PAGE-NUMBER        08700008
087600     WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          08710008
087700         AFTER ADVANCING PAGE                                     08720008
087800     WRITE PRINT-LINE FROM HL-HEADING-LINE1                       08730008
087900         AFTER ADVANCING 1                                        08740008
088000     WRITE PRINT-LINE FROM HL-HEADING-LINE2                       08750008
088100         AFTER ADVANCING 1                                        08760008
088200     WRITE PRINT-LINE FROM HL-HEADING-LINE3                       08770008
088300         AFTER ADVANCING 1                                        08780008
088400     MOVE 4                           TO PV-LINE-CNT.             08790008
088500*                                                                 08800008
088600****************************************************************  08810008
088700* WRITES THE DETAIL HEADINGS FOR THE REPORT WHEN THERE IS A    *  08820008
088800* CHANGE IN DEPARTMENT NUMBERS AND WHEN THE PAGE IS FULL.      *  08830008
088900****************************************************************  08840008
089000 N200-DETAIL-HEADINGS.                                            08850008
089100                                                                  08860008
089200     IF PV-LINE-CNT > +52                                         08870008
089300         PERFORM N100-REPORT-HEADINGS                             08880008
089400     END-IF.                                                      08890008
089500                                                                  08900008
089600     WRITE PRINT-LINE FROM HL-HEADING-LINE4                       08910008
089700         AFTER ADVANCING 2.                                       08920008
089800                                                                  08930008
089900     WRITE PRINT-LINE FROM HL-HEADING-LINE5                       08940008
090000         AFTER ADVANCING 1.                                       08950008
090100                                                                  08960008
090200     WRITE PRINT-LINE FROM HL-HEADING-LINE6                       08970008
090300         AFTER ADVANCING 1.                                       08980008
090400                                                                  08990008
090500     WRITE PRINT-LINE FROM HL-HEADING-LINE7                       09000008
090600         AFTER ADVANCING 1.                                       09010008
090700                                                                  09020008
090800     ADD 5                            TO PV-LINE-CNT.             09030008
090900*                                                                 09040008
091000***************************************************************** 09050008
091100* P100-PRINT-DETAIL - PRINTS OUT EACH DETAIL LINE OF THE SKUS   * 09060008
091200* THAT WERE UPDATED.                                            * 09070008
091300***************************************************************** 09080008
091400 P100-PRINT-DETAIL.                                               09090008
091500                                                                  09100008
091600     IF PV-LINE-CNT > PC-MAX-LINES                                09110008
091700         PERFORM N100-REPORT-HEADINGS                             09120008
091800         PERFORM N200-DETAIL-HEADINGS                             09130008
091900     END-IF.                                                      09140008
092000                                                                  09150008
092100     MOVE SPACES TO PRINT-LINE.                                   09160008
092200                                                                  09170008
092300     WRITE PRINT-LINE FROM DETAIL-LINE AFTER ADVANCING 1.         09180008
092400                                                                  09190008
092500     ADD 1 TO PV-LINE-CNT.                                        09200008
092600*                                                                 09210008
092700******************************************************************09220008
092800* THIS PARAGRAPH SETS THE DATE FOR THE CURSOR                    *09230008
092900******************************************************************09240008
093000 R100-FIND-FISCAL-WEEK.                                           09250008
093100     INITIALIZE            DPG51 DPG52                            09260008
093200                           DPG53 DPG54                            09270008
093300                           DPG55 DPG56.                           09280008
093301                                                                  09290008
093302**   MOVE CD-CPU-YR TO PV-CPU-YR.                                 09300008
093303**   MOVE CD-CPU-DY TO PV-CPU-DY.                                 09310008
093400**   MOVE CD-CPU-MO TO PV-CPU-MO.                                 09320008
093500**   MOVE PV-CPU-DATE TO DPG52-LK-DATE-INPUT.                     09330008
093510     MOVE PV-SCHED-DATE TO DPG52-LK-DATE-INPUT.                   09340008
093600     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            09350008
093700     MOVE PV-F2   TO DPG51-CALENDAR-TYPE.                         09360008
093800                                                                  09370008
093900     PERFORM R200-CALENDAR-ROUTINE.                               09380008
094000                                                                  09390008
094100     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-FISCAL-SPLIT.            09400008
094200     MOVE DPG55-NUMERIC-WEEK-DAY   TO PV-RT-DAY-CAL.              09410008
094300     MOVE PV-RT-DAY-CAL            TO RT-DAY-NO.                  09411008
094400********* FOR TEST ONLY SMM *********************************     09411108
094500***  MOVE 1 TO RT-DAY-NO.                                         09411208
094501     DISPLAY 'PV-RT-DAY-CAL ' PV-RT-DAY-CAL.                      09411308
094502*                                                                 09411408
094503******************************************************************09411508
094504* CALLS THE DATE ROUTINE.                                         09411608
094505******************************************************************09411708
094600 R200-CALENDAR-ROUTINE.                                           09411808
094700*                                                                 09411908
094800     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       09412008
094900                                DPG53 DPG54                       09413008
095000                                DPG55 DPG56.                      09414008
095100     EVALUATE TRUE                                                09415008
095200     WHEN DPG54-SEVERE-ERROR                                      09416008
095300         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               09417008
095400         DISPLAY DPG54-ERROR-MESSAGE                              09418008
095500         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              09419008
095600         CALL 'ILBOABN0'        USING PV-ABEND-CODE               09420008
095700     WHEN DPG54-WARNING-ERROR                                     09430008
095800         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              09440008
095900         DISPLAY DPG54-ERROR-MESSAGE                              09450008
096000     WHEN DPG54-NO-ERROR                                          09460008
096100         CONTINUE                                                 09470008
096200     END-EVALUATE.                                                09480008
096300*                                                                 09490008
096400******************************************************************09500008
096500* THIS PARAGRAPH OPENS THE CHG CURSOR                             09510008
096600******************************************************************09520008
096700 S100-OPEN-CHG-CSR.                                               09530008
096800                                                                  09540008
096900     MOVE 'S100'                   TO PGM-LOCATION.               09550008
097000     MOVE 'S100-OPEN-CHG-CSR'      TO PV-ABEND-PARAGRAPH.         09560008
097100                                                                  09570008
097200     EXEC SQL                                                     09580008
097300         OPEN CHG_CSR                                             09590008
097400     END-EXEC.                                                    09600008
097500                                                                  09610008
097600     EVALUATE TRUE                                                09620008
097700       WHEN SQLCODE         = ZERO                                09630008
097800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09640008
097900         CONTINUE                                                 09650008
098000       WHEN OTHER                                                 09660008
098100         DISPLAY PV-ABEND-PARAGRAPH                               09670008
098200         PERFORM Z999-SQL-ERROR                                   09680008
098300     END-EVALUATE.                                                09690008
098400*                                                                 09700008
098500******************************************************************09710008
098600* THIS PARAGRAPH OPENS THE CHG CURSOR2                            09720008
098700******************************************************************09730008
098800 S200-OPEN-CHG-CSR2.                                              09740008
098900                                                                  09750008
099000     MOVE 'S200'                   TO PGM-LOCATION.               09760008
099100     MOVE 'S200-OPEN-CHG-CSR'      TO PV-ABEND-PARAGRAPH.         09770008
099200                                                                  09780008
099300     EXEC SQL                                                     09790008
099400         OPEN CHG_CSR2                                            09800008
099500     END-EXEC.                                                    09810008
099600                                                                  09820008
099700     EVALUATE TRUE                                                09830008
099800       WHEN SQLCODE         = ZERO                                09840008
099900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    09850008
100000         CONTINUE                                                 09860008
100100       WHEN OTHER                                                 09870008
100200         DISPLAY PV-ABEND-PARAGRAPH                               09880008
100300         PERFORM Z999-SQL-ERROR                                   09890008
100400     END-EVALUATE.                                                09900008
100500*                                                                 09910008
100600******************************************************************09920008
100700* THIS PARAGRAPH OPENS THE STORE CURSOR                           09930008
100800******************************************************************09940008
100900 S300-OPEN-STORE-CSR.                                             09950008
101000                                                                  09960008
101100     MOVE 'S300'                   TO PGM-LOCATION.               09970008
101200     MOVE 'S300-OPEN-STORE-CSR'    TO PV-ABEND-PARAGRAPH.         09980008
101300                                                                  09990008
101400     EXEC SQL                                                     10000008
101500         OPEN STORE_CSR                                           10010008
101600     END-EXEC.                                                    10020008
101700                                                                  10030008
101800     EVALUATE TRUE                                                10040008
101900       WHEN SQLCODE         = ZERO                                10050008
102000         MOVE 'N' TO PS-EOC-STORE-CSR                             10060008
102100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10070008
102200         CONTINUE                                                 10080008
102300       WHEN OTHER                                                 10090008
102400         DISPLAY PV-ABEND-PARAGRAPH                               10100008
102500         PERFORM Z999-SQL-ERROR                                   10110008
102600     END-EVALUATE.                                                10120008
102700*                                                                 10130008
102800******************************************************************10140008
102900*  CLOSE CHANGE CURSOR                                           *10150008
103000******************************************************************10160008
103100 U100-CLOSE-CHG-ITEM-CSR.                                         10170008
103200                                                                  10180008
103300     MOVE 'U100'                   TO PGM-LOCATION.               10190008
103400     MOVE 'U001-CLOSE-CHG-ITEM-CSR'                               10200008
103500                                   TO PV-ABEND-PARAGRAPH.         10210008
103600     EXEC SQL                                                     10220008
103700         CLOSE CHG_CSR                                            10230008
103800     END-EXEC.                                                    10240008
103900                                                                  10250008
104000     EVALUATE TRUE                                                10260008
104100       WHEN SQLCODE         = ZERO                                10270008
104200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10280008
104300         CONTINUE                                                 10290008
104400       WHEN OTHER                                                 10300008
104500         DISPLAY PV-ABEND-PARAGRAPH                               10310008
104600         PERFORM Z999-SQL-ERROR                                   10320008
104700     END-EVALUATE.                                                10330008
104800*                                                                 10340008
104900******************************************************************10350008
105000*  CLOSE CHANGE CURSOR2                                          *10360008
105100******************************************************************10370008
105200 U200-CLOSE-CHG-ITEM-CSR2.                                        10380008
105300                                                                  10390008
105400     MOVE 'U002'                   TO PGM-LOCATION.               10400008
105500     MOVE 'U002-CLOSE-CHG-ITEM-CSR2'                              10410008
105600                                   TO PV-ABEND-PARAGRAPH.         10420008
105700     EXEC SQL                                                     10430008
105800         CLOSE CHG_CSR2                                           10440008
105900     END-EXEC.                                                    10450008
106000                                                                  10460008
106100     EVALUATE TRUE                                                10470008
106200       WHEN SQLCODE         = ZERO                                10480008
106300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10490008
106400         CONTINUE                                                 10500008
106500       WHEN OTHER                                                 10510008
106600         DISPLAY PV-ABEND-PARAGRAPH                               10520008
106700         PERFORM Z999-SQL-ERROR                                   10530008
106800     END-EVALUATE.                                                10540008
106900*                                                                 10550008
107000******************************************************************10560008
107100*  CLOSE STORE CURSOR                                            *10570008
107200******************************************************************10580008
107300 U300-CLOSE-STORE-CSR.                                            10590008
107400                                                                  10600008
107500     MOVE 'U300'                   TO PGM-LOCATION.               10610008
107600     MOVE 'U300-CLOSE-STORE-CSR'                                  10620008
107700                                   TO PV-ABEND-PARAGRAPH.         10630008
107800     EXEC SQL                                                     10640008
107900         CLOSE STORE_CSR                                          10650008
108000     END-EXEC.                                                    10660008
108100                                                                  10670008
108200     EVALUATE TRUE                                                10680008
108300       WHEN SQLCODE         = ZERO                                10690008
108400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    10700008
108500         CONTINUE                                                 10710008
108600       WHEN OTHER                                                 10720008
108700         DISPLAY PV-ABEND-PARAGRAPH                               10730008
108800         PERFORM Z999-SQL-ERROR                                   10740008
108900     END-EVALUATE.                                                10750008
109000*                                                                 10760008
109100*                                                                 10770008
109200 EJECT                                                            10780008
109300******************************************************************10790008
109400*     DB2 COMMIT TEST                                            *10800008
109500******************************************************************10810008
109600                                                                  10820008
109700 Z900-COMMIT-TEST.                                                10830008
109800*-----------------                                                10840008
109900                                                                  10850008
110000     MOVE 'Z900'                   TO PGM-LOCATION.               10860008
110100     MOVE 'Z900-COMMIT-TEST     '  TO PV-ABEND-PARAGRAPH.         10870008
110200                                                                  10880008
110300*  GET THE CURRENT TIMESTAMP                                      10890008
110400                                                                  10900008
110500     EXEC SQL                                                     10910008
110600         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    10920008
110700     END-EXEC.                                                    10930008
110800                                                                  10940008
110900     IF SQLCODE = +0                                              10950008
111000         CONTINUE                                                 10960008
111100     ELSE                                                         10970008
111200         DISPLAY 'PARAGRAPH Z900  BAD SET FOR CURRENT TIMESTAMP'  10980008
111300         DISPLAY ' '                                              10990008
111400         PERFORM Z999-SQL-ERROR.                                  11000008
111500                                                                  11010008
111600*  COMPARE TO THE NEXT SCHEDULED COMMIT TIME                      11020008
111700                                                                  11030008
111800     IF PV-CURR-TMST > PV-COMMIT-TMST                             11040008
111900         PERFORM Z910-COMMIT.                                     11050008
112000                                                                  11060008
112100 EJECT                                                            11070008
112200******************************************************************11080008
112300*     DB2 COMMIT PROCESSING                                      *11090008
112400*                                                                *11100008
112500******************************************************************11110008
112600                                                                  11120008
112700 Z910-COMMIT.                                                     11130008
112800*------------                                                     11140008
112900                                                                  11150008
113000*  TAKE COMMIT                                                    11160008
113100                                                                  11170008
113200     EXEC SQL                                                     11180008
113300         COMMIT                                                   11190008
113400     END-EXEC.                                                    11200008
113500                                                                  11210008
113600     IF SQLCODE = +0                                              11220008
113700         CONTINUE                                                 11230008
113800     ELSE                                                         11240008
113900         DISPLAY 'PARAGRAPH Z910  BAD COMMIT'                     11250008
114000         DISPLAY ' '                                              11260008
114100         PERFORM Z999-SQL-ERROR.                                  11270008
114200                                                                  11280008
114300*  GET THE NEXT SCHEDULED COMMIT TIME                             11290008
114400                                                                  11300008
114500     EXEC SQL                                                     11310008
114600         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    11320008
114700           INTO  :PV-COMMIT-TMST                                  11330008
114800           FROM  TCKRSTCNTL                                       11340008
114900          WHERE  PLAN_NAME = 'MRKUP097'                           11350008
115000     END-EXEC.                                                    11360008
115100                                                                  11370008
115200     IF SQLCODE = +0                                              11380008
115300         CONTINUE                                                 11390008
115400     ELSE                                                         11400008
115500         DISPLAY 'PARAGRAPH Z910  SELECT FOR NEXT TIMESTAMP'      11410008
115600         DISPLAY ' '                                              11420008
115700         PERFORM Z999-SQL-ERROR.                                  11430008
115800*                                                                 11440008
115900******************************************************************11450008
116000*   ERROR MESSAGE ROUTINE                                         11460008
116100******************************************************************11470008
116200 Z999-SQL-ERROR.                                                  11480008
116300                                                                  11490008
116400     MOVE SQLCODE    TO SQLCODE2.                                 11500008
116500     MOVE SQLERRD(3) TO SQLERRD3.                                 11510008
116600     DISPLAY '** ABEND **       ** = SQLERROR'.                   11520008
116700     DISPLAY '** PROGRAM        ** = MRKUP097'.                   11530008
116800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  11540008
116900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  11550008
117000     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   11560008
117100     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  11570008
117200     MOVE +4013 TO PV-ABEND-CODE.                                 11580008
117300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11590008
117400******************************************************************11600008
