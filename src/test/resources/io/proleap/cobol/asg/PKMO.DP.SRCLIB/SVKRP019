000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400                                                                  00040099
000500 PROGRAM-ID.             SVKRP019.                                00050099
000600 AUTHOR.                 DOUGLAS W ROUSAR.                        00060099
000700 INSTALLATION.           KOHLS.                                   00070099
000800 DATE-WRITTEN            DECEMBER, 1997.                          00080099
000900 DATE-COMPILED.                                                   00090099
001000                                                                  00100099
001100******************************************************************00110099
001200* THIS PROGRAM WAS COPIED FROM RDKRP014                           00120099
001300******************************************************************00130099
W3540C*                                                                 00140099
W3540C* REQUIREMENT   : PAYMENT RELATED CHANGES FOR FSH PROJECT         00150099
W3540C* PROJECT ID    : W3540C                                          00160099
W3540C* AUTHOR        : COGNIZANT                                       00170099
W3540C* DATES CHANGED : 15-OCT-2012                                     00180099
W3540C* CHANGES MADE  : A NEW CONTROL CARD WITH THE CURRENT TIMESTAMP   00190099
W3540C* OF FORMAT CCYY-MM-DD-HH.MM.SS.TTTTTT SPACE                      00200099
W3540C* CCYY-MM-DD-HH.MM.SS.TTTTTT SPACE RESTART INDICATOR IS ADDED     00201099
W3540C* TO THE PROGRAM AND THE CODE IS CHANGED ACCORDINGLY.             00202099
W3540C*                                                                 00210099
W3540C* THE CONTROL CARD SVCC103(SVK060), SVCC109(SVK145) AND           00231099
W3540C* SVCC108(SVK540) HAS RESTART VARIABLE AT COL 55.                 00232099
W3540C*                                                                 00233099
W3540C* NORMAL BATCH:                                                   00234099
W3540C* IF THE RESTART VARIABLE NOT 'R', THE PROGRAM WILL USE THE       00235099
W3540C* TIMESTAMP FROM CC. THE CONTROL CARD TIMESTAMP IS MOVED TO       00236099
W3540C* THE TODAY'S TIMESTAMP AND THE CURRENT SYSTEM TIMESTAMP IS MOVED 00237099
W3540C* TO TOMORROW'S TIMESTAMP AT END OF PROCESS.  DATES IN CONTROL    00238099
W3540C* CARD ARE UPDATED FOR NEXT BATCH RUN.                            00239099
W3540C*                                                                 00239199
W3540C* RERUN:                                                          00239299
W3540C* IF THE RESTART VARIABLE IS 'R', THEN THE END DATE FROM THE      00239399
W3540C* CONTROL CARD IS MOVED TO TOMORROW'S TIMESTAMP.                  00239499
W3540C* THIS TIMESTAMP ARE USED IN ISSUED-CSR, VOID-CSR AND TENDERED-CSR00239599
W3540C* DATES IN CONTROL CARD ARE NOT UPDATED.                          00239699
W3540C******************************************************************00240099
001000                                                                  00250099
002700******************************************************************00260099
004300 ENVIRONMENT DIVISION.                                            00270099
004400******************************************************************00280099
004500                                                                  00290099
004600 CONFIGURATION SECTION.                                           00300099
004700                                                                  00310099
004800 SOURCE-COMPUTER.        IBM-3090.                                00320099
004900 OBJECT-COMPUTER.        IBM-3090.                                00330099
005000                                                                  00340099
005100 INPUT-OUTPUT SECTION.                                            00350099
005200                                                                  00360099
005300 FILE-CONTROL.                                                    00370099
005400                                                                  00380099
005500     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00390099
W3540C     SELECT CONTROL-TIMESTAMP-FILE    ASSIGN TO INP02.            00400099
005600     SELECT GFTCRD-REPORT             ASSIGN TO RPT01.            00410099
005700                                                                  00420099
005800******************************************************************00430099
005900 DATA DIVISION.                                                   00440099
006000******************************************************************00450099
006100                                                                  00460099
006200 FILE SECTION.                                                    00470099
006300                                                                  00480099
006400 FD  CONTROL-DATE-FILE                                            00490099
006500     RECORDING MODE IS F                                          00500099
006600     BLOCK CONTAINS 0 RECORDS                                     00510099
006700     LABEL RECORDS ARE OMITTED.                                   00520099
006800 01  CONTROL-DATE-RECORD              PIC X(80).                  00530099
006900                                                                  00540099
W3540C FD  CONTROL-TIMESTAMP-FILE                                       00550099
W3540C     RECORDING MODE IS F                                          00560099
W3540C     BLOCK CONTAINS 0 RECORDS                                     00570099
W3540C     LABEL RECORDS ARE OMITTED.                                   00580099
W3540C                                                                  00590099
W3540C 01  CONTROL-TIMESTAMP-RECORD         PIC X(80).                  00600099
W3540C                                                                  00610099
007000 FD  GFTCRD-REPORT                                                00620099
007100     RECORDING MODE IS F                                          00630099
007200     BLOCK CONTAINS 0 RECORDS                                     00640099
007300     LABEL RECORDS ARE OMITTED.                                   00650099
007400 01  REPORT-OUT                       PIC X(132).                 00660099
007500                                                                  00670099
007600******************************************************************00680099
007700 WORKING-STORAGE SECTION.                                         00690099
007800******************************************************************00700099
007900                                                                  00710099
008000*                                                                 00720099
008100* COPYBOOK USED FOR CONSTANTS PERTAINING TO PV-CRD-TYP-CDE,       00730099
008200* PV-ACT-TYP-CDE, AND PV-TRN-RVRSL-CDE                            00740099
008300*                                                                 00750099
008400                                                                  00760099
008500     COPY SVWS004.                                                00770099
008600                                                                  00780099
008700*                                                                 00790099
008800* COPYBOOK USED FOR STANDARD REPORT HEADER 132                    00800099
008900*                                                                 00810099
009000                                                                  00820099
009100     COPY DPWS132O.                                               00830099
009200                                                                  00840099
009300*                                                                 00850099
009400* DATE ROUTINE COPY MEMBERS                                       00860099
009500*                                                                 00870099
009600     COPY DPWS500.                                                00880099
009700                                                                  00890099
009800*                                                                 00900099
009900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00910099
010000*                                                                 00920099
010100     COPY DPWS004.                                                00930099
010200                                                                  00940099
010300*                                                                 00950099
010400* CR-CONTROL-RECORD                                               00960099
010500*                                                                 00970099
010600                                                                  00980099
010700 01  CR-CONTROL-RECORD.                                           00990099
010800     05  CR-CONTROL-BEG-DATE.                                     01000099
010900         10  CR-BEG-CC                PIC  X(02)    VALUE SPACES. 01010099
011000         10  CR-BEG-YY                PIC  X(02)    VALUE SPACES. 01020099
011100         10  FILLER                   PIC  X(01)    VALUE '-'.    01030099
011200         10  CR-BEG-MM                PIC  X(02)    VALUE SPACES. 01040099
011300         10  FILLER                   PIC  X(01)    VALUE '-'.    01050099
011400         10  CR-BEG-DD                PIC  X(02)    VALUE SPACES. 01060099
011500     05  CR-CONTROL-END-DATE.                                     01070099
011600         10  CR-END-CC                PIC  X(02)    VALUE SPACES. 01080099
011700         10  CR-END-YY                PIC  X(02)    VALUE SPACES. 01090099
011800         10  FILLER                   PIC  X(01)    VALUE '-'.    01100099
011900         10  CR-END-MM                PIC  X(02)    VALUE SPACES. 01110099
012000         10  FILLER                   PIC  X(01)    VALUE '-'.    01120099
012100         10  CR-END-DD                PIC  X(02)    VALUE SPACES. 01130099
012200     05  CR-TIME-PERIOD               PIC  X(01)    VALUE SPACES. 01140099
012210     05  FILLER                       PIC  X(67)    VALUE SPACES. 01150099
012300                                                                  01160099
W3540C*                                                                 01170099
W3540C*    CR-CONTROL RECORD TIMESTAMP (CCYY-MM-DD-HH.MM.SS.TTTTTT)     01180099
W3540C*                                                                 01190099
W3540C 01  CR-CONTROL-RECORD1.                                          01200099
W3540C     05  CR-CONTROL-BEG-TIMESTAMP.                                01210099
W3540C         10  CR-BEG-DATE              PIC  X(10)     VALUE SPACES.01220099
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01230099
W3540C         10  CR-BEG-HH                PIC  X(02)     VALUE SPACES.01240099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01250099
W3540C         10  CR-BEG-MN                PIC  X(02)     VALUE SPACES.01260099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01270099
W3540C         10  CR-BEG-SS                PIC  X(02)     VALUE SPACES.01280099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01290099
W3540C         10  CR-BEG-TTTTTT            PIC  X(06)     VALUE SPACES.01300099
W3540C         10  FILLER                   PIC  X(01)     VALUE SPACES.01310099
W3540C     05  CR-CONTROL-END-TIMESTAMP.                                01320099
W3540C         10  CR-END-DATE              PIC  X(10)     VALUE SPACES.01330099
W3540C         10  FILLER                   PIC  X(01)     VALUE '-'.   01340099
W3540C         10  CR-END-HH                PIC  X(02)     VALUE SPACES.01350099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01360099
W3540C         10  CR-END-MN                PIC  X(02)     VALUE SPACES.01370099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01380099
W3540C         10  CR-END-SS                PIC  X(02)     VALUE SPACES.01390099
W3540C         10  FILLER                   PIC  X(01)     VALUE '.'.   01400099
W3540C         10  CR-END-TTTTTT            PIC  X(06)     VALUE SPACES.01410099
W3540C     05  FILLER                       PIC  X(01)     VALUE SPACES.01420099
W3540C     05  CR-RESTART-IND               PIC  X(01)     VALUE SPACES.01430099
W3540C     05  FILLER                       PIC  X(25)     VALUE SPACES.01440099
W3540C                                                                  01450099
012400*                                                                 01460099
012500* PROGRAM ACCUMULATORS                                            01470099
012600*                                                                 01480099
012700 01  PROGRAM-ACCUMULATORS.                                        01490099
012800     05  PA-LINE-COUNT                   PIC 9(02)     VALUE 0.   01500099
012900     05  PA-PAGE-COUNT                   PIC 9(05)     VALUE 0.   01510099
013000** STOCK ID TOTALS                                                01520099
013100     05  PA-SI-QTY-ISSUED                PIC S9(09)    VALUE 0.   01530099
013200     05  PA-SI-AMT-ISSUED                PIC S9(09)V99 VALUE 0.   01540099
013300     05  PA-SI-QTY-VOIDED                PIC S9(09)    VALUE 0.   01550099
013400     05  PA-SI-AMT-VOIDED                PIC S9(09)V99 VALUE 0.   01560099
013500     05  PA-SI-QTY-TENDERED              PIC S9(09)    VALUE 0.   01570099
013600     05  PA-SI-AMT-TENDERED              PIC S9(09)V99 VALUE 0.   01580099
013700** STORE SUM TOTALS OF ALL DENOM **                               01590099
013800     05  PA-ST-QTY-ISSUED                PIC S9(09)    VALUE 0.   01600099
013900     05  PA-ST-AMT-ISSUED                PIC S9(09)V99 VALUE 0.   01610099
014000     05  PA-ST-QTY-VOIDED                PIC S9(09)    VALUE 0.   01620099
014100     05  PA-ST-AMT-VOIDED                PIC S9(09)V99 VALUE 0.   01630099
014200     05  PA-ST-QTY-TENDERED              PIC S9(09)    VALUE 0.   01640099
014300     05  PA-ST-AMT-TENDERED              PIC S9(09)V99 VALUE 0.   01650099
014400*                                                                 01660099
014500* PROGRAM SWITCHES                                                01670099
014600*                                                                 01680099
014700                                                                  01690099
014800 01  PROGRAM-SWITCHES.                                            01700099
014900     05  PS-END-OF-LOC-CSR-SW          PIC  X(01)     VALUE 'N'.  01710099
015000         88  PS-END-OF-LOC-CSR                        VALUE 'Y'.  01720099
015100     05  PS-END-OF-ISSUED-CSR-SW       PIC  X(01)     VALUE 'N'.  01730099
015200         88  PS-END-OF-ISSUED-CSR                     VALUE 'Y'.  01740099
015300     05  PS-END-OF-VOID-CSR-SW         PIC  X(01)     VALUE 'N'.  01750099
015400         88  PS-END-OF-VOID-CSR                       VALUE 'Y'.  01760099
015500     05  PS-END-OF-TENDERED-CSR-SW     PIC  X(01)     VALUE 'N'.  01770099
015600         88  PS-END-OF-TENDERED-CSR                   VALUE 'Y'.  01780099
015700     05  PS-END-OF-STOCK-ID-CSR-SW     PIC  X(01)     VALUE 'N'.  01790099
015800         88  PS-END-OF-STOCK-ID-CSR                   VALUE 'Y'.  01800099
015900         88  PS-NOT-END-OF-STOCK-ID-CSR               VALUE 'N'.  01810099
016000     05  PS-END-OF-CONTROL-FILE-SW     PIC  X(01)     VALUE 'N'.  01820099
016100         88  PS-END-OF-CONTROL-FILE                   VALUE 'Y'.  01830099
W3540C     05  PS-END-OF-CONTROL-FILE1-SW    PIC  X(01)     VALUE 'N'.  01840099
W3540C         88  PS-END-OF-CONTROL-FILE1                  VALUE 'Y'.  01850099
016200     05  PS-STOCK-ID-FOUND-SW          PIC  X(01)     VALUE 'N'.  01860099
016300         88  PS-STOCK-ID-FOUND                        VALUE 'Y'.  01870099
016400         88  PS-STOCK-ID-NOT-FOUND                    VALUE 'N'.  01880099
016500     05  PS-DENOMINATION-FOUND-SW      PIC  X(01)     VALUE 'N'.  01890099
016600         88  PS-DENOMINATION-FOUND                    VALUE 'Y'.  01900099
016700         88  PS-DENOMINATION-NOT-FOUND                VALUE 'N'.  01910099
016800                                                                  01920099
016900*                                                                 01930099
017000* PROGRAM VARIABLES                                               01940099
017100*                                                                 01950099
017200                                                                  01960099
017300 01  PROGRAM-VAIABLES.                                            01970099
017400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01980099
017500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01990099
017600     05  PV-SPACE-CONTROL             PIC  9(01)     VALUE 1.     02000099
017700     05  PV-DETAIL-CNT                PIC  9(03)     COMP-3.      02010099
017800     05  PV-CRD-STK-TYP-ID            PIC  X(08)     VALUE SPACES.02020099
017900     05  PV-PRE-DNNTD-CRD-AMT         PIC  S9(07)V99 COMP-3       02030099
018000                                                     VALUE ZERO.  02040099
018100     05  PV-HOLD-CRD-STK-TYP-ID       PIC  X(08)     VALUE SPACES.02050099
018200     05  PV-CURRENT-DATE.                                         02060099
018300         10  PV-CURRENT-YEAR          PIC  9(02)     VALUE ZERO.  02070099
018400         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  02080099
018500         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  02090099
018600     05  PV-CURRENT-TIME.                                         02100099
018700         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  02110099
018800         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  02120099
018900         10  FILLER                   PIC  9(04)     VALUE ZERO.  02130099
019000     05  PV-START-RANGE-TIMESTAMP-DET.                            02140099
W3540C         10  PV-START-RANGE-DATE      PIC  X(10)     VALUE SPACES.02150099
019200         10  FILLER                   PIC  X(01)     VALUE '-'.   02160099
W3540C         10  PV-START-RANGE-HH        PIC  X(02)     VALUE SPACES.02170099
019400         10  FILLER                   PIC  X(01)     VALUE '.'.   02180099
W3540C         10  PV-START-RANGE-MN        PIC  X(02)     VALUE SPACES.02190099
019600         10  FILLER                   PIC  X(01)     VALUE '.'.   02200099
W3540C         10  PV-START-RANGE-SS        PIC  X(02)     VALUE SPACES.02210099
019800         10  FILLER                   PIC  X(01)     VALUE '.'.   02220099
W3540C         10  PV-START-RANGE-TTTTTT    PIC  X(06)     VALUE SPACES.02230099
020100     05  PV-START-RANGE-TMSTP REDEFINES                           02240099
020200           PV-START-RANGE-TIMESTAMP-DET                           02250099
020300                                      PIC  X(26).                 02260099
020400     05  PV-END-RANGE-TIMESTAMP-DET.                              02270099
W3540C         10  PV-END-RANGE-DATE        PIC  X(10)     VALUE SPACES.02280099
020600         10  FILLER                   PIC  X(01)     VALUE '-'.   02290099
W3540C         10  PV-END-RANGE-HH          PIC  X(02)     VALUE SPACES.02300099
020800         10  FILLER                   PIC  X(01)     VALUE '.'.   02310099
W3540C         10  PV-END-RANGE-MN          PIC  X(02)     VALUE SPACES.02320099
021000         10  FILLER                   PIC  X(01)     VALUE '.'.   02330099
W3540C         10  PV-END-RANGE-SS          PIC  X(02)     VALUE SPACES.02340099
021200         10  FILLER                   PIC  X(01)     VALUE '.'.   02350099
W3540C         10  PV-END-RANGE-TTTTTT      PIC  X(06)     VALUE SPACES.02360099
021500     05  PV-END-RANGE-TMSTP REDEFINES                             02370099
021600           PV-END-RANGE-TIMESTAMP-DET                             02380099
021700                                      PIC  X(26).                 02390099
021800 01 PV-DATA-FROM-CURSORS.                                         02400099
021900     05  PV-IC-STR-NBR               PIC S9(4)     COMP           02410099
022000                                     VALUE ZERO.                  02420099
022100     05  PV-IC-CRD-STK-TYP-ID        PIC X(08)                    02430099
022200                                     VALUE SPACES.                02440099
022300     05  PV-IC-PRE-DNNTD-CRD-AMT     PIC S9(07)V99 COMP-3         02450099
022400                                     VALUE ZEROES.                02460099
022500     05  PV-IC-COUNT                 PIC S9(09)    COMP-3         02470099
022600                                     VALUE ZEROES.                02480099
022700     05  PV-IC-SUM                   PIC S9(09)V99 COMP-3         02490099
022800                                     VALUE ZEROES.                02500099
022900     05  PV-VC-STR-NBR               PIC S9(4)     COMP           02510099
023000                                     VALUE ZERO.                  02520099
023100     05  PV-VC-CRD-STK-TYP-ID        PIC X(08)                    02530099
023200                                     VALUE SPACES.                02540099
023300     05  PV-VC-PRE-DNNTD-CRD-AMT     PIC S9(07)V99 COMP-3         02550099
023400                                     VALUE ZEROES.                02560099
023500     05  PV-VC-COUNT                 PIC S9(09)    COMP-3         02570099
023600                                     VALUE ZEROES.                02580099
023700     05  PV-VC-SUM                   PIC S9(09)V99 COMP-3         02590099
023800                                     VALUE ZEROES.                02600099
023900     05  PV-TC-STR-NBR               PIC S9(4)     COMP           02610099
024000                                     VALUE ZERO.                  02620099
024100     05  PV-TC-CRD-STK-TYP-ID        PIC X(08)                    02630099
024200                                     VALUE SPACES.                02640099
024300     05  PV-TC-PRE-DNNTD-CRD-AMT     PIC S9(07)V99 COMP-3         02650099
024400                                     VALUE ZEROES.                02660099
024500     05  PV-TC-COUNT                 PIC S9(09)    COMP-3         02670099
024600                                     VALUE ZEROES.                02680099
024700     05  PV-TC-SUM                   PIC S9(09)V99 COMP-3         02690099
024800                                     VALUE ZEROES.                02700099
024900*                                                                 02710099
025000* PROGRAM CONSTANTS                                               02720099
025100*                                                                 02730099
025200                                                                  02740099
025300 01  PROGRAM-CONSTANTS.                                           02750099
025400     05  PC-PROGRAM-NAME                 PIC X(08)  VALUE         02760099
025500                                               'SVKRP019'.        02770099
025600     05  PC-MAX-STOCK-IDS                PIC S9(4) COMP VALUE 999.02780099
025700     05  PC-MAX-DENOMS                   PIC S9(4) COMP VALUE  30.02790099
025800                                                                  02800099
025900*                                                                 02810099
026000* STOCK-ID TABLES. CONTAINS ALL OF THE VALID STOCK IDS AND        02820099
026100* DENOMINATIONS.  TWO SETS OF TOTALS ARE MAINTAINED.  ONE FOR THE 02830099
026200* CURRENT STORE.  ANOTHER FOR CORPORATE TOTALS.                   02840099
026300                                                                  02850099
026400 01  PT-STOCK-ID-TABLE.                                           02860099
026500     05 PT-STOCK-ID-DATA OCCURS 999 TIMES                         02870099
026600                         INDEXED BY PT-INDX1.                     02880099
026700        10 PT-CRD-STK-TYP-ID               PIC X(08).             02890099
026800        10 PT-DENOMINATION-DATA                                   02900099
026900                         OCCURS 30 TIMES                          02910099
027000                         INDEXED BY PT-INDX2.                     02920099
027100           15 PT-PRE-DNNTD-CRD-AMT     PIC S9(07)V99 COMP-3.      02930099
027200           15 PT-DENOMINATION-IND      PIC X(01).                 02940099
027300           15 PT-STR-IC-COUNT          PIC S9(09)    COMP-3.      02950099
027400           15 PT-STR-IC-SUM            PIC S9(09)V99 COMP-3.      02960099
027500           15 PT-STR-VC-COUNT          PIC S9(09)    COMP-3.      02970099
027600           15 PT-STR-VC-SUM            PIC S9(09)V99 COMP-3.      02980099
027700           15 PT-STR-TC-COUNT          PIC S9(09)    COMP-3.      02990099
027800           15 PT-STR-TC-SUM            PIC S9(09)V99 COMP-3.      03000099
027900           15 PT-TTL-IC-COUNT          PIC S9(09)    COMP-3.      03010099
028000           15 PT-TTL-IC-SUM            PIC S9(09)V99 COMP-3.      03020099
028100           15 PT-TTL-VC-COUNT          PIC S9(09)    COMP-3.      03030099
028200           15 PT-TTL-VC-SUM            PIC S9(09)V99 COMP-3.      03040099
028300           15 PT-TTL-TC-COUNT          PIC S9(09)    COMP-3.      03050099
028400           15 PT-TTL-TC-SUM            PIC S9(09)V99 COMP-3.      03060099
028500                                                                  03070099
028600*                                                                 03080099
028700* HEADINGS                                                        03090099
028800*                                                                 03100099
028900                                                                  03110099
029000 01  HEADER-LINE1.                                                03120099
029100     05  FILLER                          PIC X(41)  VALUE SPACES. 03130099
029200     05                                  PIC X(49)  VALUE         03140099
029300         'GIFT CARD SALES BY CARD STOCK ID AND DENOMINATION'.     03150099
029400     05  FILLER                          PIC X(42)  VALUE SPACES. 03160099
029500                                                                  03170099
029600 01  HEADER-LINE2-D.                                              03180099
029700     05  HL2-DESCRIPTION.                                         03190099
029800         10  FILLER                      PIC X(14) VALUE          03200099
029900             'STORE NUMBER: '.                                    03210099
030000         10  HL2-STORE-NUM               PIC 9999.                03220099
W3540C     05  FILLER                          PIC X(11)  VALUE SPACES. 03230099
W3540C     05  FILLER                          PIC X(14)  VALUE         03240099
W3540C         'ACTIVITY FROM '.                                        03250099
W3540C     05  HL2-ACT-FROM-MM                 PIC 9(02).               03260099
030500     05  FILLER                          PIC X      VALUE '/'.    03270099
W3540C     05  HL2-ACT-FROM-DD                 PIC 9(02).               03280099
030700     05  FILLER                          PIC X      VALUE '/'.    03290099
W3540C     05  HL2-ACT-FROM-CC                 PIC 9(02).               03300099
W3540C     05  HL2-ACT-FROM-YY                 PIC 9(02).               03310099
W3540C     05  FILLER                          PIC X      VALUE '-'.    03320099
W3540C     05  HL2-ACT-FROM-HH                 PIC 9(02).               03330099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03340099
W3540C     05  HL2-ACT-FROM-MN                 PIC 9(02).               03350099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03360099
W3540C     05  HL2-ACT-FROM-SS                 PIC 9(02).               03370099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03380099
W3540C     05  HL2-ACT-FROM-TTTTTT             PIC 9(06).               03390099
W3540C     05  FILLER                          PIC X(05)  VALUE         03400099
W3540C         ' TO: '.                                                 03410099
W3540C     05  HL2-ACT-TO-MM                   PIC 9(02).               03420099
W3540C     05  FILLER                          PIC X      VALUE '/'.    03430099
W3540C     05  HL2-ACT-TO-DD                   PIC 9(02).               03440099
W3540C     05  FILLER                          PIC X      VALUE '/'.    03450099
W3540C     05  HL2-ACT-TO-CC                   PIC 9(02).               03460099
W3540C     05  HL2-ACT-TO-YY                   PIC 9(02).               03470099
W3540C     05  FILLER                          PIC X      VALUE '-'.    03480099
W3540C     05  HL2-ACT-TO-HH                   PIC 9(02).               03490099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03500099
W3540C     05  HL2-ACT-TO-MN                   PIC 9(02).               03510099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03520099
W3540C     05  HL2-ACT-TO-SS                   PIC 9(02).               03530099
W3540C     05  FILLER                          PIC X      VALUE '.'.    03540099
W3540C     05  HL2-ACT-TO-TTTTTT               PIC 9(06).               03550099
W3540C     05  FILLER                          PIC X(32)  VALUE SPACES. 03551099
030910                                                                  03560099
030920 01  HEADER-LINE2-W-M.                                            03570099
030930     05  HL2-DESCRIPTION-W-M.                                     03580099
030940         10  FILLER                      PIC X(14) VALUE          03590099
030950             'STORE NUMBER: '.                                    03600099
030960         10  HL2-STORE-NUM-W-M           PIC 9999.                03610099
030961     05  FILLER                          PIC X(29)  VALUE SPACES. 03620099
030962     05  FILLER                          PIC X(14)  VALUE         03630099
030963         'ACTIVITY FROM '.                                        03640099
030990     05  HL2-ACT-MM-W-M                  PIC 9(02).               03650099
030991     05  FILLER                          PIC X      VALUE '/'.    03660099
030992     05  HL2-ACT-DD-W-M                  PIC 9(02).               03670099
030993     05  FILLER                          PIC X      VALUE '/'.    03680099
030994     05  HL2-ACT-CC-W-M                  PIC 9(02).               03690099
030995     05  HL2-ACT-YY-W-M                  PIC 9(02).               03700099
030996     05  FILLER                          PIC X(04)  VALUE ' TO '. 03710099
030999     05  HL2-ACT-MM1                     PIC 9(02).               03720099
031000     05  FILLER                          PIC X(01)  VALUE '/'.    03730099
031001     05  HL2-ACT-DD1                     PIC 9(02).               03740099
031002     05  FILLER                          PIC X(01)  VALUE '/'.    03750099
031003     05  HL2-ACT-CC1                     PIC 9(02).               03760099
031004     05  HL2-ACT-YY1                     PIC 9(02).               03770099
031010                                                                  03780099
031100 01  HEADER-LINE3.                                                03790099
031200     05  FILLER                          PIC X(08)  VALUE SPACES. 03800099
031300     05  FILLER                          PIC X(02)  VALUE SPACES. 03810099
031400     05  FILLER                          PIC X(12)  VALUE SPACES. 03820099
031500     05  FILLER                          PIC X(01)  VALUE SPACES. 03830099
031600     05  FILLER                          PIC X(09)  VALUE         03840099
031700         ' QUANTITY'.                                             03850099
031800     05  FILLER                          PIC X(01)  VALUE SPACES. 03860099
031900     05  FILLER                          PIC X(15)  VALUE         03870099
032000         '         AMOUNT'.                                       03880099
032100     05  FILLER                          PIC X(01)  VALUE SPACES. 03890099
032200     05  FILLER                          PIC X(09)  VALUE         03900099
032300         ' QUANTITY'.                                             03910099
032400     05  FILLER                          PIC X(01)  VALUE SPACES. 03920099
032500     05  FILLER                          PIC X(15)  VALUE         03930099
032600         '         AMOUNT'.                                       03940099
032700     05  FILLER                          PIC X(01)  VALUE SPACES. 03950099
032800     05  FILLER                          PIC X(09)  VALUE         03960099
032900         '      NET'.                                             03970099
033000     05  FILLER                          PIC X(01)  VALUE SPACES. 03980099
033100     05  FILLER                          PIC X(15)  VALUE         03990099
033200         '            NET'.                                       04000099
033300     05  FILLER                          PIC X(01)  VALUE SPACES. 04010099
033400     05  FILLER                          PIC X(09)  VALUE         04020099
033500         ' QUANTITY'.                                             04030099
033600     05  FILLER                          PIC X(01)  VALUE SPACES. 04040099
033700     05  FILLER                          PIC X(15) VALUE          04050099
033800         '         AMOUNT'.                                       04060099
033900                                                                  04070099
034000 01  HEADER-LINE4.                                                04080099
034100     05  FILLER                          PIC X(08)  VALUE         04090099
034200         'STOCK ID'.                                              04100099
034300     05  FILLER                          PIC X(02)  VALUE SPACES. 04110099
034400     05  FILLER                          PIC X(12)  VALUE         04120099
034500         'DENOMINATION'.                                          04130099
034600     05  FILLER                          PIC X(01)  VALUE SPACES. 04140099
034700     05  FILLER                          PIC X(09)  VALUE         04150099
034800         '   ISSUED'.                                             04160099
034900     05  FILLER                          PIC X(01)  VALUE SPACES. 04170099
035000     05  FILLER                          PIC X(15)  VALUE         04180099
035100         '         ISSUED'.                                       04190099
035200     05  FILLER                          PIC X(01)  VALUE SPACES. 04200099
035300     05  FILLER                          PIC X(09)  VALUE         04210099
035400         '   VOIDED'.                                             04220099
035500     05  FILLER                          PIC X(01)  VALUE SPACES. 04230099
035600     05  FILLER                          PIC X(15)  VALUE         04240099
035700         '         VOIDED'.                                       04250099
035800     05  FILLER                          PIC X(01)  VALUE SPACES. 04260099
035900     05  FILLER                          PIC X(09)  VALUE         04270099
036000         ' QUANTITY'.                                             04280099
036100     05  FILLER                          PIC X(01)  VALUE SPACES. 04290099
036200     05  FILLER                          PIC X(15)  VALUE         04300099
036300         '         ISSUED'.                                       04310099
036400     05  FILLER                          PIC X(01)  VALUE SPACES. 04320099
036500     05  FILLER                          PIC X(09)  VALUE         04330099
036600         ' TENDERED'.                                             04340099
036700     05  FILLER                          PIC X(01)  VALUE SPACES. 04350099
036800     05  FILLER                          PIC X(15) VALUE          04360099
036900         '       TENDERED'.                                       04370099
037000                                                                  04380099
037100 01  HEADER-LINE5.                                                04390099
037200     05  FILLER                          PIC X(08)  VALUE ALL '-'.04400099
037300     05  FILLER                          PIC X(02)  VALUE SPACES. 04410099
037400     05  FILLER                          PIC X(12)  VALUE ALL '-'.04420099
037500     05  FILLER                          PIC X(01)  VALUE SPACES. 04430099
037600     05  FILLER                          PIC X(09)  VALUE ALL '-'.04440099
037700     05  FILLER                          PIC X(01)  VALUE SPACES. 04450099
037800     05  FILLER                          PIC X(15)  VALUE ALL '-'.04460099
037900     05  FILLER                          PIC X(01)  VALUE SPACES. 04470099
038000     05  FILLER                          PIC X(09)  VALUE ALL '-'.04480099
038100     05  FILLER                          PIC X(01)  VALUE SPACES. 04490099
038200     05  FILLER                          PIC X(15)  VALUE ALL '-'.04500099
038300     05  FILLER                          PIC X(01)  VALUE SPACES. 04510099
038400     05  FILLER                          PIC X(09)  VALUE ALL '-'.04520099
038500     05  FILLER                          PIC X(01)  VALUE SPACES. 04530099
038600     05  FILLER                          PIC X(15)  VALUE ALL '-'.04540099
038700     05  FILLER                          PIC X(01)  VALUE SPACES. 04550099
038800     05  FILLER                          PIC X(09)  VALUE ALL '-'.04560099
038900     05  FILLER                          PIC X(01)  VALUE SPACES. 04570099
039000     05  FILLER                          PIC X(15)  VALUE ALL '-'.04580099
039100                                                                  04590099
039200*                                                                 04600099
039300* DETAIL LINES                                                    04610099
039400*                                                                 04620099
039500                                                                  04630099
039600 01  DETAIL-LINE1.                                                04640099
039700     05  DL1-STOCK-ID                    PIC X(08).               04650099
039800     05  FILLER                          PIC X(02)  VALUE SPACES. 04660099
039900     05  DL1-DENOM-TEXT                  PIC X(12)  VALUE SPACES. 04670099
040000     05  DL1-DENOM REDEFINES DL1-DENOM-TEXT                       04680099
040100                                         PIC Z,ZZZ,ZZ9.99.        04690099
040200     05  FILLER                          PIC X(01)  VALUE SPACES. 04700099
040300     05  DL1-QTY-ISSUED                  PIC Z,ZZZ,ZZ9.           04710099
040400     05  FILLER                          PIC X(01)  VALUE SPACES. 04720099
040500     05  DL1-AMT-ISSUED                  PIC ZZZ,ZZZ,ZZ9.99-.     04730099
040600     05  FILLER                          PIC X(01)  VALUE SPACES. 04740099
040700     05  DL1-QTY-VOIDED                  PIC Z,ZZZ,ZZ9.           04750099
040800     05  FILLER                          PIC X(01)  VALUE SPACES. 04760099
040900     05  DL1-AMT-VOIDED                  PIC ZZZ,ZZZ,ZZ9.99-.     04770099
041000     05  FILLER                          PIC X(01)  VALUE SPACES. 04780099
041100     05  DL1-NET-QTY                     PIC Z,ZZZ,ZZ9.           04790099
041200     05  FILLER                          PIC X(01)  VALUE SPACES. 04800099
041300     05  DL1-NET-ISSUED                  PIC ZZZ,ZZZ,ZZ9.99-.     04810099
041400     05  FILLER                          PIC X(01)  VALUE SPACES. 04820099
041500     05  DL1-QTY-TENDERED                PIC Z,ZZZ,ZZ9.           04830099
041600     05  FILLER                          PIC X(01)  VALUE SPACES. 04840099
041700     05  DL1-AMT-TENDERED                PIC ZZZ,ZZZ,ZZ9.99-.     04850099
041800                                                                  04860099
041900 01  DETAIL-LINE2.                                                04870099
042000     05  DL2-STOCK-ID                    PIC X(08).               04880099
042100     05  FILLER                          PIC X(02) VALUE SPACES.  04890099
042200     05  DL2-DENOM-SPACES                PIC X(12)  VALUE SPACES. 04900099
042300     05  DL2-DENOM REDEFINES DL2-DENOM-SPACES                     04910099
042400                                         PIC Z,ZZZ,ZZ9.99.        04920099
042500     05  FILLER                          PIC X(06)  VALUE SPACES. 04930099
042600     05                                  PIC X(31)  VALUE         04940099
042700         'N O  A C T I V I T Y  F O U N D'.                       04950099
042800     05  FILLER                          PIC X(70)  VALUE SPACES. 04960099
042900                                                                  04970099
043000                                                                  04980099
043100 01  SUMMARY-LINE1.                                               04990099
043200     05  SL1-DESCRIPTION                 PIC X(22) VALUE SPACES.  05000099
043300     05  FILLER                          PIC X(01)  VALUE SPACES. 05010099
043400     05  SL1-QTY-ISSUED                  PIC Z,ZZZ,ZZ9.           05020099
043500     05  FILLER                          PIC X(01)  VALUE SPACES. 05030099
043600     05  SL1-AMT-ISSUED                  PIC ZZZ,ZZZ,ZZ9.99-.     05040099
043700     05  FILLER                          PIC X(01)  VALUE SPACES. 05050099
043800     05  SL1-QTY-VOIDED                  PIC Z,ZZZ,ZZ9.           05060099
043900     05  FILLER                          PIC X(01)  VALUE SPACES. 05070099
044000     05  SL1-AMT-VOIDED                  PIC ZZZ,ZZZ,ZZ9.99-.     05080099
044100     05  FILLER                          PIC X(01)  VALUE SPACES. 05090099
044200     05  SL1-NET-QTY                     PIC Z,ZZZ,ZZ9.           05100099
044300     05  FILLER                          PIC X(01)  VALUE SPACES. 05110099
044400     05  SL1-NET-ISSUED                  PIC ZZZ,ZZZ,ZZ9.99-.     05120099
044500     05  FILLER                          PIC X(01)  VALUE SPACES. 05130099
044600     05  SL1-QTY-TENDERED                PIC Z,ZZZ,ZZ9.           05140099
044700     05  FILLER                          PIC X(01)  VALUE SPACES. 05150099
044800     05  SL1-AMT-TENDERED                PIC ZZZ,ZZZ,ZZ9.99-.     05160099
044900                                                                  05170099
045000 01  SUMMARY-LINE2.                                               05180099
045100     05  FILLER                          PIC X(08)  VALUE SPACES. 05190099
045200     05  FILLER                          PIC X(02)  VALUE SPACES. 05200099
045300     05  FILLER                          PIC X(12)  VALUE SPACES. 05210099
045400     05  FILLER                          PIC X(01)  VALUE SPACES. 05220099
045500     05  FILLER                          PIC X(09)  VALUE ALL '-'.05230099
045600     05  FILLER                          PIC X(01)  VALUE SPACES. 05240099
045700     05  FILLER                          PIC X(15)  VALUE ALL '-'.05250099
045800     05  FILLER                          PIC X(01)  VALUE SPACES. 05260099
045900     05  FILLER                          PIC X(09)  VALUE ALL '-'.05270099
046000     05  FILLER                          PIC X(01)  VALUE SPACES. 05280099
046100     05  FILLER                          PIC X(15)  VALUE ALL '-'.05290099
046200     05  FILLER                          PIC X(01)  VALUE SPACES. 05300099
046300     05  FILLER                          PIC X(09)  VALUE ALL '-'.05310099
046400     05  FILLER                          PIC X(01)  VALUE SPACES. 05320099
046500     05  FILLER                          PIC X(15)  VALUE ALL '-'.05330099
046600     05  FILLER                          PIC X(01)  VALUE SPACES. 05340099
046700     05  FILLER                          PIC X(09)  VALUE ALL '-'.05350099
046800     05  FILLER                          PIC X(01)  VALUE SPACES. 05360099
046900     05  FILLER                          PIC X(15)  VALUE ALL '-'.05370099
047000                                                                  05380099
047100*                                                                 05390099
047200* ABEND CODES                                                     05400099
047300*                                                                 05410099
047400                                                                  05420099
047500 01  ABEND-CODE                          PIC S9(04) VALUE +0.     05430099
047600     88  ABEND-4002-READ-ERROR                      VALUE +4002.  05440099
047700     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  05450099
047800     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  05460099
047900     88  ABEND-4019-CALENDER-ERROR                  VALUE +4019.  05470099
048000                                                                  05480099
W3540C******************************************************************05490099
W3540C*    CONTROL CARD LAYOUT                                         *05500099
W3540C******************************************************************05510099
W3540C 01  WRITE-CONTROL-CARD.                                          05520099
W3540C     05  CONTROL-CARD-BEG-DATE          PIC  X(26)   VALUE SPACES.05530099
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.05540099
W3540C     05  CONTROL-CARD-END-DATE          PIC  X(26)   VALUE SPACES.05550099
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.05560099
W3540C     05  RESTART-INDICATOR              PIC  X(01)   VALUE SPACES.05570099
W3540C     05  FILLER                         PIC  X(25)   VALUE SPACES.05571099
W3540C                                                                  05580099
048100******************************************************************05590099
048200*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                             *05600099
048300*    SV-KOHL'S MERCHANDISE CARD TABLE                            *05610099
048400******************************************************************05620099
048500     EXEC SQL                                                     05630099
048600         INCLUDE SVT00001                                         05640099
048700     END-EXEC.                                                    05650099
048800                                                                  05660099
048900******************************************************************05670099
049000*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                              *05680099
049100*    SV-KOHL'S MERCHANDISE CARD ACTIVITY TABLE                   *05690099
049200******************************************************************05700099
049300     EXEC SQL                                                     05710099
049400         INCLUDE SVT00002                                         05720099
049500     END-EXEC.                                                    05730099
049600                                                                  05740099
049700******************************************************************05750099
049800*    DB2 AREA FOR SVT_CRD_PROD                                   *05760099
049900*    SV-KOHL'S CONTROL NUMBER INFORMATION TABLE                  *05770099
050000******************************************************************05780099
050100     EXEC SQL                                                     05790099
050200         INCLUDE SVT00000                                         05800099
050300     END-EXEC.                                                    05810099
050400                                                                  05820099
050500******************************************************************05830099
050600*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                             *05840099
050700*    SV-KOHL'S CARD STOCK/DENOMINATION TABLE.                    *05850099
050800******************************************************************05860099
050900     EXEC SQL                                                     05870099
051000         INCLUDE SVT00008                                         05880099
051100     END-EXEC.                                                    05890099
051200                                                                  05900099
051300******************************************************************05910099
051400*   XST_LOC XS DOMAIN LOCATION TABLE                             *05920099
051500******************************************************************05930099
051600     EXEC SQL                                                     05940099
051700         INCLUDE XST00001                                         05950099
051800     END-EXEC.                                                    05960099
051900*                                                                 05970099
052000*                                                                 05980099
052100*    SELECT STORE INFORMATION FROM XST_LOC                        05990099
052200*                                                                 06000099
052300                                                                  06010099
052400     EXEC SQL                                                     06020099
052500       DECLARE LOC-CSR CURSOR FOR                                 06030099
052600           SELECT LOC_NBR                                         06040099
052700             FROM XST_LOC                                         06050099
052800            WHERE LOC_TYP_CDE IN ('DS','SV','HQ')                 06060099
052900              AND                                                 06070099
053000                (:PV-START-RANGE-DATE BETWEEN OPN_DTE AND CLO_DTE 06080099
053100               OR :PV-END-RANGE-DATE BETWEEN OPN_DTE AND CLO_DTE) 06090099
053200           ORDER BY LOC_NBR                                       06100099
053300             WITH UR                                              06110099
053400     END-EXEC.                                                    06120099
053500                                                                  06130099
053600*                                                                 06140099
053700*                                                                 06150099
053800*    CURSOR TO ACCESS THE DIFFERENT DENOMINATIONS                 06160099
053900*                                                                 06170099
054000                                                                  06180099
054100     EXEC SQL                                                     06190099
054200       DECLARE STOCK-ID-CSR CURSOR FOR                            06200099
054300           SELECT CRD_STK_TYP_ID                                  06210099
054400                 ,PRE_DNNTD_CRD_AMT                               06220099
054500             FROM SVT_CRD_STK_DNMNTN                              06230099
054600            WHERE CRD_TYP_CDE = 2                                 06240099
054700         ORDER BY CRD_STK_TYP_ID                                  06250099
054800                 ,PRE_DNNTD_CRD_AMT                               06260099
054900             WITH UR                                              06270099
055000     END-EXEC.                                                    06280099
055100                                                                  06290099
055200*                                                                 06300099
055300* THIS CURSOR SELECTS ALL ISSUED CARDS FOR THE TIME PERIOD        06310099
055400*                                                                 06320099
055500                                                                  06330099
055600     EXEC SQL                                                     06340099
055700         DECLARE ISSUED-CSR CURSOR FOR                            06350099
055800             SELECT A.STR_NBR                                     06360099
055900                   ,CRD_STK_TYP_ID                                06370099
056000                   ,PRE_DNNTD_CRD_AMT                             06380099
056100                   ,COUNT(*)                                      06390099
056200                   ,SUM(APP_AUTH_AMT)                             06400099
056300             FROM SVT_KOHLS_CRD_ACCT T                            06410099
056400                 ,SVT_KOHLS_CRD_TXN  A                            06420099
056500                 ,SVT_CRD_PROD C                                  06430099
056600             WHERE A.CRD_NBR       = T.CRD_NBR                    06440099
056700               AND C.CRD_PROD_YR   = T.CRD_PROD_YR                06450099
056800               AND C.SHIPT_REQ_NBR = T.SHIPT_REQ_NBR              06460099
056900               AND ACTVY_TYP_CDE   = 2                            06470099
057000               AND TRN_RVRSL_CDE   = 0                            06480099
057100               AND (TRN_AUTH_TMST BETWEEN                         06490099
057200                 :PV-START-RANGE-TMSTP AND :PV-END-RANGE-TMSTP)   06500099
057300               AND APP_AUTH_AMT ^= 0                              06510099
057400             GROUP BY A.STR_NBR                                   06520099
057500                     ,CRD_STK_TYP_ID                              06530099
057600                     ,PRE_DNNTD_CRD_AMT                           06540099
057700             ORDER BY A.STR_NBR                                   06550099
057800                     ,CRD_STK_TYP_ID                              06560099
057900                     ,PRE_DNNTD_CRD_AMT                           06570099
058000             WITH UR                                              06580099
058100     END-EXEC.                                                    06590099
058200                                                                  06600099
058300* THIS CURSOR SELECTS ALL VOIDED ISSUES FOR THE TIME PERIOD       06610099
058400*                                                                 06620099
058500                                                                  06630099
058600     EXEC SQL                                                     06640099
058700         DECLARE VOID-CSR CURSOR FOR                              06650099
058800             SELECT A.STR_NBR                                     06660099
058900                   ,CRD_STK_TYP_ID                                06670099
059000                   ,PRE_DNNTD_CRD_AMT                             06680099
059100                   ,COUNT(*)                                      06690099
059200                   ,SUM(APP_AUTH_AMT)                             06700099
059300             FROM SVT_KOHLS_CRD_ACCT T                            06710099
059400                 ,SVT_KOHLS_CRD_TXN  A                            06720099
059500                 ,SVT_CRD_PROD       C                            06730099
059600             WHERE A.CRD_NBR       = T.CRD_NBR                    06740099
059700               AND C.CRD_PROD_YR   = T.CRD_PROD_YR                06750099
059800               AND C.SHIPT_REQ_NBR = T.SHIPT_REQ_NBR              06760099
059900               AND ACTVY_TYP_CDE   = 2                            06770099
060000               AND TRN_RVRSL_CDE   = 1                            06780099
060100               AND (TRN_AUTH_TMST BETWEEN                         06790099
060200                 :PV-START-RANGE-TMSTP AND :PV-END-RANGE-TMSTP)   06800099
060300               AND APP_AUTH_AMT ^= 0                              06810099
060400             GROUP BY A.STR_NBR                                   06820099
060500                     ,CRD_STK_TYP_ID                              06830099
060600                     ,PRE_DNNTD_CRD_AMT                           06840099
060700             ORDER BY A.STR_NBR                                   06850099
060800                     ,CRD_STK_TYP_ID                              06860099
060900                     ,PRE_DNNTD_CRD_AMT                           06870099
061000             WITH UR                                              06880099
061100     END-EXEC.                                                    06890099
061200*                                                                 06900099
061300* THIS CURSOR WILL PROVIDE THE INFORMATION NEEDED TO GATHER THE   06910099
061400* GIFT CARD TENDERED INFORMATION                                  06920099
061500*                                                                 06930099
061600                                                                  06940099
061700     EXEC SQL                                                     06950099
061800         DECLARE TENDERED-CSR CURSOR FOR                          06960099
061900             SELECT A.STR_NBR                                     06970099
062000                   ,CRD_STK_TYP_ID                                06980099
062100                   ,PRE_DNNTD_CRD_AMT                             06990099
062200                   ,COUNT(*)                                      07000099
062300                   ,SUM(APP_AUTH_AMT)                             07010099
062400             FROM SVT_KOHLS_CRD_ACCT T                            07020099
062500                 ,SVT_KOHLS_CRD_TXN A                             07030099
062600                 ,SVT_CRD_PROD C                                  07040099
062700             WHERE A.CRD_NBR       = T.CRD_NBR                    07050099
062800               AND C.CRD_PROD_YR   = T.CRD_PROD_YR                07060099
062900               AND C.SHIPT_REQ_NBR = T.SHIPT_REQ_NBR              07070099
063000               AND C.CRD_TYP_CDE   = 2                            07080099
063100               AND ACTVY_TYP_CDE   = 3                            07090099
063200               AND TRN_RVRSL_CDE   = 0                            07100099
063300               AND TRN_VOID_IND    = 'N'                          07110099
063400               AND (TRN_AUTH_TMST BETWEEN                         07120099
063500                 :PV-START-RANGE-TMSTP AND :PV-END-RANGE-TMSTP)   07130099
063600               AND APP_AUTH_AMT ^= 0                              07140099
063700             GROUP BY A.STR_NBR                                   07150099
063800                     ,CRD_STK_TYP_ID                              07160099
063900                     ,PRE_DNNTD_CRD_AMT                           07170099
064000             ORDER BY A.STR_NBR                                   07180099
064100                     ,CRD_STK_TYP_ID                              07190099
064200                     ,PRE_DNNTD_CRD_AMT                           07200099
064300             WITH UR                                              07210099
064400     END-EXEC.                                                    07220099
064500                                                                  07230099
064600*                                                                 07240099
064700*  COMMUNICATION AREAS FOR DB2                                    07250099
064800*                                                                 07260099
064900     EXEC SQL                                                     07270099
065000         INCLUDE SQLCA                                            07280099
065100     END-EXEC.                                                    07290099
065200                                                                  07300099
065300*                                                                 07310099
065400*  DB2 COMMUNICATION AREA 2                                       07320099
065500*                                                                 07330099
065600     COPY SQLCA2.                                                 07340099
065700                                                                  07350099
065800******************************************************************07360099
065900 PROCEDURE DIVISION.                                              07370099
066000******************************************************************07380099
066100                                                                  07390099
066200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07400099
066300*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    07410099
066400* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07420099
066500                                                                  07430099
066600 0000-PROGRAM-MAINLINE.                                           07440099
066700*---------------------                                            07450099
066800                                                                  07460099
066900     PERFORM 1000-INITIALIZE.                                     07470099
067000                                                                  07480099
067100     PERFORM 2000-PROCESS-LOC-CSR                                 07490099
067200       UNTIL PS-END-OF-LOC-CSR.                                   07500099
067300                                                                  07510099
067400     PERFORM 7000-CORP-TOTALS.                                    07520099
067500                                                                  07530099
067600     PERFORM 9000-EOJ-ROUTINE.                                    07540099
067700     GOBACK.                                                      07550099
067800                                                                  07560099
067900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07570099
068000*  1000-INITIALIZE OPENS ALL THE FILES ASSOCIATED WITH THE JOB.   07580099
068100*  ACCEPTS THE SYSTEM DATE AND TIME, FILLING THE APPROPRIATE RE-  07590099
068200*  PORT HEADERS. ACCEPTS CONTROL CARD FOR ACTIVITY DATE.          07600099
068300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07610099
068400                                                                  07620099
068500 1000-INITIALIZE.                                                 07630099
068600*---------------                                                  07640099
068700                                                                  07650099
W3540C     OPEN INPUT CONTROL-DATE-FILE                                 07660099
W3540C                CONTROL-TIMESTAMP-FILE.                           07670099
068900     OPEN OUTPUT GFTCRD-REPORT.                                   07680099
069000                                                                  07690099
069100     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                07700099
069200       AT END                                                     07710099
069300         SET PS-END-OF-CONTROL-FILE TO TRUE                       07720099
069400     END-READ.                                                    07730099
069500                                                                  07740099
069600     IF PS-END-OF-CONTROL-FILE                                    07750099
069700       DISPLAY ' '                                                07760099
069800       DISPLAY '** ABEND     **'                                  07770099
069900       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              07780099
070000       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '         07790099
070100       DISPLAY '** CONTROL DATE FILE IS EMPTY  '                  07800099
070200       SET  ABEND-4002-READ-ERROR TO TRUE                         07810099
070300       CALL 'ILBOABN0' USING ABEND-CODE                           07820099
070400     ELSE                                                         07830099
071093       IF  CR-TIME-PERIOD = 'W' OR                                07840099
071094           CR-TIME-PERIOD = 'M'                                   07850099
W3540C              MOVE CR-CONTROL-BEG-DATE TO PV-START-RANGE-DATE     07860099
W3540C              MOVE ZEROES              TO PV-START-RANGE-HH       07870099
W3540C                                          PV-START-RANGE-MN       07880099
W3540C                                          PV-START-RANGE-SS       07890099
W3540C                                          PV-START-RANGE-TTTTTT   07900099
W3540C              MOVE CR-CONTROL-END-DATE TO PV-END-RANGE-DATE       07910099
W3540C              MOVE '23'                TO PV-END-RANGE-HH         07920099
W3540C              MOVE '59'                TO PV-END-RANGE-MN         07930099
W3540C                                          PV-END-RANGE-SS         07940099
W3540C              MOVE '999999'            TO PV-END-RANGE-TTTTTT     07950099
W3540C              MOVE CR-BEG-CC           TO HL2-ACT-CC-W-M          07960099
W3540C              MOVE CR-BEG-YY           TO HL2-ACT-YY-W-M          07970099
W3540C              MOVE CR-BEG-MM           TO HL2-ACT-MM-W-M          07980099
W3540C              MOVE CR-BEG-DD           TO HL2-ACT-DD-W-M          07990099
071098              MOVE CR-END-CC           TO HL2-ACT-CC1             08000099
071099              MOVE CR-END-YY           TO HL2-ACT-YY1             08010099
071100              MOVE CR-END-MM           TO HL2-ACT-MM1             08020099
071101              MOVE CR-END-DD           TO HL2-ACT-DD1             08030099
071104       END-IF                                                     08040099
071110       DISPLAY ' '                                                08050099
071200       DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                 08060099
071300               CR-CONTROL-BEG-DATE ' TO '                         08070099
071400               CR-CONTROL-END-DATE                                08080099
071500     END-IF.                                                      08090099
071600                                                                  08100099
071700     PERFORM 1100-VERIFY-DATES.                                   08110099
071800                                                                  08120099
W3540C     IF ((CR-TIME-PERIOD NOT = 'W') AND                           08130099
W3540C         (CR-TIME-PERIOD NOT = 'M'))                              08140099
W3540C         READ CONTROL-TIMESTAMP-FILE INTO CR-CONTROL-RECORD1      08150099
W3540C           AT END                                                 08160099
W3540C             SET PS-END-OF-CONTROL-FILE1 TO TRUE                  08170099
W3540C         END-READ                                                 08180099
W3540C                                                                  08190099
W3540C         IF PS-END-OF-CONTROL-FILE1                               08200099
W3540C           DISPLAY ' '                                            08210099
W3540C           DISPLAY '** ABEND     **'                              08220099
W3540C           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          08230099
W3540C           DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '     08240099
W3540C           DISPLAY '** CONTROL TIMESTAMP FILE IS EMPTY  '         08250099
W3540C           MOVE +4002 TO ABEND-CODE                               08260099
W3540C           CALL 'ILBOABN0' USING ABEND-CODE                       08270099
W3540C         ELSE                                                     08280099
W3540C           DISPLAY ' '                                            08290099
W3540C           DISPLAY PC-PROGRAM-NAME ' CR-CONTROL-BEG-TIMESTAMP:  ' 08300099
W3540C                   CR-CONTROL-BEG-TIMESTAMP                       08310099
W3540C           DISPLAY PC-PROGRAM-NAME ' CR-CONTROL-END-TIMESTAMP:  ' 08320099
W3540C                   CR-CONTROL-END-TIMESTAMP                       08330099
W3540C           DISPLAY PC-PROGRAM-NAME ' CR-RESTART-IND          :  ' 08340099
W3540C                   CR-RESTART-IND                                 08350099
W3540C         END-IF                                                   08360099
W3540C                                                                  08370099
W3540C         CLOSE CONTROL-TIMESTAMP-FILE                             08380099
W3540C                                                                  08390099
W3540C         PERFORM 1600-VERIFY-BEG-DTE-TIMESTMP                     08400099
W3540C                                                                  08410099
W3540C         MOVE CR-CONTROL-BEG-TIMESTAMP TO                         08420099
W3540C              PV-START-RANGE-TIMESTAMP-DET                        08430099
W3540C                                                                  08440099
W3540C         IF CR-RESTART-IND = 'R' THEN                             08450099
W3540C            PERFORM 1650-VERIFY-END-DTE-TIMESTMP                  08460099
W3540C            MOVE CR-CONTROL-END-TIMESTAMP TO                      08470099
W3540C                 PV-END-RANGE-TIMESTAMP-DET                       08480099
W3540C         ELSE                                                     08490099
W3540C            EXEC SQL                                              08500099
W3540C                SET :PV-END-RANGE-TMSTP = CURRENT TIMESTAMP       08510099
W3540C            END-EXEC                                              08520099
W3540C                                                                  08530099
W3540C            EVALUATE SQLCODE                                      08540099
W3540C               WHEN ZERO                                          08550099
W3540C                  CONTINUE                                        08560099
W3540C               WHEN OTHER                                         08570099
W3540C                  DISPLAY ' '                                     08580099
W3540C                  DISPLAY '** ABEND     **'                       08590099
W3540C                  DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME   08600099
W3540C                  DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'    08610099
W3540C                  DISPLAY '** SET CURRENT TIMESTAMP'              08620099
W3540C                  PERFORM 9100-SQL-ABEND                          08630099
W3540C            END-EVALUATE                                          08640099
W3540C         END-IF                                                   08650099
W3540C                                                                  08660099
W3540C         MOVE PV-START-RANGE-DATE(1:2) TO HL2-ACT-FROM-CC         08670099
W3540C         MOVE PV-START-RANGE-DATE(3:2) TO HL2-ACT-FROM-YY         08680099
W3540C         MOVE PV-START-RANGE-DATE(6:2) TO HL2-ACT-FROM-MM         08690099
W3540C         MOVE PV-START-RANGE-DATE(9:2) TO HL2-ACT-FROM-DD         08700099
W3540C         MOVE PV-START-RANGE-HH        TO HL2-ACT-FROM-HH         08710099
W3540C         MOVE PV-START-RANGE-MN        TO HL2-ACT-FROM-MN         08720099
W3540C         MOVE PV-START-RANGE-SS        TO HL2-ACT-FROM-SS         08730099
W3540C         MOVE PV-START-RANGE-TTTTTT    TO HL2-ACT-FROM-TTTTTT     08740099
W3540C                                                                  08750099
W3540C         MOVE PV-END-RANGE-DATE(1:2)   TO HL2-ACT-TO-CC           08760099
W3540C         MOVE PV-END-RANGE-DATE(3:2)   TO HL2-ACT-TO-YY           08770099
W3540C         MOVE PV-END-RANGE-DATE(6:2)   TO HL2-ACT-TO-MM           08780099
W3540C         MOVE PV-END-RANGE-DATE(9:2)   TO HL2-ACT-TO-DD           08790099
W3540C         MOVE PV-END-RANGE-HH          TO HL2-ACT-TO-HH           08800099
W3540C         MOVE PV-END-RANGE-MN          TO HL2-ACT-TO-MN           08810099
W3540C         MOVE PV-END-RANGE-SS          TO HL2-ACT-TO-SS           08820099
W3540C         MOVE PV-END-RANGE-TTTTTT      TO HL2-ACT-TO-TTTTTT       08830099
W3540C     END-IF.                                                      08840099
052700                                                                  08850099
071900** FILL IN THE VARIABLES FOR THE HEADING LINES **                 08860099
072000                                                                  08870099
072100     ACCEPT PV-CURRENT-DATE FROM DATE.                            08880099
072200     MOVE PV-CURRENT-YEAR   TO DP132O-RUN-YEAR.                   08890099
072300     MOVE PV-CURRENT-MONTH  TO DP132O-RUN-MONTH.                  08900099
072400     MOVE PV-CURRENT-DAY    TO DP132O-RUN-DAY.                    08910099
072500                                                                  08920099
072600     ACCEPT PV-CURRENT-TIME FROM TIME.                            08930099
072700     MOVE PV-CURRENT-HOUR   TO DP132O-RUN-HOUR.                   08940099
072800     MOVE PV-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 08950099
072900                                                                  08960099
073000     MOVE PC-PROGRAM-NAME   TO DP132O-PROGRAM-NAME.               08970099
073100     MOVE '1'               TO DP132O-REPORT-NUMBER.              08980099
073200                                                                  08990099
073300****** CREATE THE STOCK ID TABLE.                                 09000099
073400     INITIALIZE PT-STOCK-ID-TABLE.                                09010099
073500     PERFORM 1700-OPEN-STOCKID-CSR.                               09020099
073600     PERFORM 1711-FETCH-STOCK-ID-CSR.                             09030099
073700     PERFORM 1710-LOAD-STOCK-ID-TABLE                             09040099
073800       UNTIL PS-END-OF-STOCK-ID-CSR OR                            09050099
073900             PT-INDX1 > PC-MAX-STOCK-IDS.                         09060099
074000                                                                  09070099
074100     IF PT-INDX1 > PC-MAX-STOCK-IDS                               09080099
074200         DISPLAY '** ABEND     **'                                09090099
074300         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            09100099
074400         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             09110099
074500         DISPLAY '** TABLE OVERFLOW ERROR ON PT-STOCK-ID TABLE'   09120099
074600         DISPLAY '*** MORE THAN ' PC-MAX-STOCK-IDS ' FOUND'       09130099
074700         DISPLAY '*** CURRENT STOCK ID IS '  PV-CRD-STK-TYP-ID    09140099
074800         SET ABEND-4002-READ-ERROR  TO TRUE                       09150099
074900         CALL 'ILBOABN0' USING ABEND-CODE                         09160099
075000     END-IF.                                                      09170099
075100                                                                  09180099
075200     PERFORM 1720-CLOSE-STOCK-ID-CSR.                             09190099
075300                                                                  09200099
075400****** OPEN CURSORS                                               09210099
075500     PERFORM 1200-OPEN-LOC-CSR.                                   09220099
075600     PERFORM 1300-OPEN-ISSUE-CSR.                                 09230099
075700     PERFORM 1400-OPEN-VOID-CSR.                                  09240099
075800     PERFORM 1500-OPEN-TENDER-CSR.                                09250099
075900                                                                  09260099
076000****** FETCH FIRST ROW FROM EACH CURSOR                           09270099
076100     PERFORM 2100-FETCH-LOC-CSR.                                  09280099
076200     PERFORM 3100-FETCH-ISSUE-CSR.                                09290099
076300     PERFORM 4100-FETCH-VOID-CSR.                                 09300099
076400     PERFORM 5100-FETCH-TENDER-CSR.                               09310099
076500                                                                  09320099
076600******************************************************************09330099
076700* VERIFY THAT THE DATES ON THE CONTROL CARD ARE VALID AND THAT   *09340099
076800* THE BEGIN DATE IS LESS THAN THE END DATE.                      *09350099
076900******************************************************************09360099
077000 1100-VERIFY-DATES.                                               09370099
077100                                                                  09380099
077200** VERIFY BEGINNING DATE IS VALID **                              09390099
077300     INITIALIZE DPG51 DPG52 DPG53                                 09400099
077400                DPG54 DPG55 DPG56.                                09410099
077500                                                                  09420099
077600     SET DPG51-ACTUAL-CALENDAR-ONLY                               09430099
077700                                 TO TRUE.                         09440099
077800     MOVE CR-CONTROL-BEG-DATE    TO DPG52-LK-DATE-INPUT.          09450099
077900     SET DPG52-LK-DTE-ISO-FMT    TO TRUE                          09460099
078000                                                                  09470099
078100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09480099
078200                                             DPG54 DPG55 DPG56.   09490099
078300     EVALUATE TRUE                                                09500099
078400       WHEN DPG54-SEVERE-ERROR                                    09510099
078500       WHEN DPG54-DATE-INVALID                                    09520099
078600         DISPLAY ' '                                              09530099
078700         DISPLAY '** ABEND     **'                                09540099
078800         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            09550099
078900         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             09560099
079000         DISPLAY '** BAD CALL TO CALENDAR MODULE '                09570099
079100         DISPLAY '** DETERMINE VALID BEGINNING DATE **'           09580099
079200         DISPLAY DPG54-ERROR-MESSAGE                              09590099
079300         SET ABEND-4019-CALENDER-ERROR TO TRUE                    09600099
079400         CALL 'ILBOABN0' USING ABEND-CODE                         09610099
079500     END-EVALUATE.                                                09620099
079600                                                                  09630099
079700** VERIFY ENDING DATE IS VALID **                                 09640099
079800     INITIALIZE DPG51 DPG52 DPG53                                 09650099
079900                DPG54 DPG55 DPG56.                                09660099
080000     SET DPG51-ACTUAL-CALENDAR-ONLY                               09670099
080100                                 TO TRUE.                         09680099
080200     MOVE CR-CONTROL-END-DATE    TO DPG52-LK-DATE-INPUT.          09690099
080300     SET DPG52-LK-DTE-ISO-FMT    TO TRUE                          09700099
080400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09710099
080500                                             DPG54 DPG55 DPG56.   09720099
080600     EVALUATE TRUE                                                09730099
080700       WHEN DPG54-SEVERE-ERROR                                    09740099
080800       WHEN DPG54-DATE-INVALID                                    09750099
080900         DISPLAY ' '                                              09760099
081000         DISPLAY '** ABEND     **'                                09770099
081100         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            09780099
081200         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             09790099
081300         DISPLAY '** BAD CALL TO CALENDAR MODULE '                09800099
081400         DISPLAY '** DETERMINE VALID ENDING DATE **'              09810099
081500         DISPLAY DPG54-ERROR-MESSAGE                              09820099
081600         SET ABEND-4019-CALENDER-ERROR TO TRUE                    09830099
081700         CALL 'ILBOABN0' USING ABEND-CODE                         09840099
081800     END-EVALUATE.                                                09850099
081900                                                                  09860099
082000** VERIFY THE BEGINNING DATE IS LESS THAN THE ENDING DATE **      09870099
082100     IF CR-CONTROL-END-DATE  < CR-CONTROL-BEG-DATE                09880099
082200       DISPLAY ' '                                                09890099
082300       DISPLAY '** ABEND     **'                                  09900099
082400       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              09910099
082500       DISPLAY '** PARAGRAPH **  = 1100-VERIFY-DATES'             09920099
082600       DISPLAY '** THE BEGINNING DATE CAN NOT BE '                09930099
082700               'GREATER THAN THE ENDING DATE **'                  09940099
082800       SET ABEND-4002-READ-ERROR  TO TRUE                         09950099
082900       CALL 'ILBOABN0' USING ABEND-CODE                           09960099
083000     END-IF.                                                      09970099
083100                                                                  09980099
083200******************************************************************09990099
083300* OPEN THE LOCATION CURSOR THAT ACCESSES OPEN STORES.            *10000099
083400******************************************************************10010099
083500 1200-OPEN-LOC-CSR.                                               10020099
083600                                                                  10030099
083700     EXEC SQL                                                     10040099
083800       OPEN LOC-CSR                                               10050099
083900     END-EXEC.                                                    10060099
084000                                                                  10070099
084100     EVALUATE SQLCODE                                             10080099
084200       WHEN ZERO                                                  10090099
084300           CONTINUE                                               10100099
084400       WHEN OTHER                                                 10110099
084500           DISPLAY ' '                                            10120099
084600           DISPLAY '** ABEND     **'                              10130099
084700           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          10140099
084800           DISPLAY '** PARAGRAPH **  = 1200-OPEN-LOC-CSR'         10150099
084900           DISPLAY '** OPEN LOC-CSR'                              10160099
085000           PERFORM 9100-SQL-ABEND                                 10170099
085100     END-EVALUATE.                                                10180099
085200                                                                  10190099
085300******************************************************************10200099
085400* OPEN THE ISSUE CURSOR                                          *10210099
085500******************************************************************10220099
085600 1300-OPEN-ISSUE-CSR.                                             10230099
085700                                                                  10240099
085800     EXEC SQL                                                     10250099
085900       OPEN ISSUED-CSR                                            10260099
086000     END-EXEC.                                                    10270099
086100                                                                  10280099
086200     EVALUATE SQLCODE                                             10290099
086300       WHEN ZERO                                                  10300099
086400           CONTINUE                                               10310099
086500       WHEN OTHER                                                 10320099
086600           DISPLAY ' '                                            10330099
086700           DISPLAY '** ABEND     **'                              10340099
086800           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          10350099
086900           DISPLAY '** PARAGRAPH **  = 1300-OPEN-ISSUED-CSR'      10360099
087000           DISPLAY '** OPEN ISSUED-CSR'                           10370099
087100           PERFORM 9100-SQL-ABEND                                 10380099
087200     END-EVALUATE.                                                10390099
087300                                                                  10400099
087400******************************************************************10410099
087500* OPEN THE VOID CURSOR                                           *10420099
087600******************************************************************10430099
087700 1400-OPEN-VOID-CSR.                                              10440099
087800                                                                  10450099
087900     EXEC SQL                                                     10460099
088000       OPEN VOID-CSR                                              10470099
088100     END-EXEC.                                                    10480099
088200                                                                  10490099
088300     EVALUATE SQLCODE                                             10500099
088400       WHEN ZERO                                                  10510099
088500           CONTINUE                                               10520099
088600       WHEN OTHER                                                 10530099
088700           DISPLAY ' '                                            10540099
088800           DISPLAY '** ABEND     **'                              10550099
088900           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          10560099
089000           DISPLAY '** PARAGRAPH **  = 1400-OPEN-VOID-CSR'        10570099
089100           DISPLAY '** OPEN VOID-CSR'                             10580099
089200           PERFORM 9100-SQL-ABEND                                 10590099
089300     END-EVALUATE.                                                10600099
089400                                                                  10610099
089500******************************************************************10620099
089600* OPEN THE TENDERED CURSOR                                       *10630099
089700******************************************************************10640099
089800 1500-OPEN-TENDER-CSR.                                            10650099
089900                                                                  10660099
090000     EXEC SQL                                                     10670099
090100       OPEN TENDERED-CSR                                          10680099
090200     END-EXEC.                                                    10690099
090300                                                                  10700099
090400     EVALUATE SQLCODE                                             10710099
090500       WHEN ZERO                                                  10720099
090600           CONTINUE                                               10730099
090700       WHEN OTHER                                                 10740099
090800           DISPLAY ' '                                            10750099
090900           DISPLAY '** ABEND     **'                              10760099
091000           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          10770099
091100           DISPLAY '** PARAGRAPH **  = 1500-OPEN-TENDERED-CSR'    10780099
091200           DISPLAY '** OPEN TENDERED-CSR'                         10790099
091300           PERFORM 9100-SQL-ABEND                                 10800099
091400     END-EVALUATE.                                                10810099
091500                                                                  10820099
W3540C******************************************************************10830099
W3540C* VERIFY THAT THE DATE IN THE TIMESTAMP CONTROL CARD IS VALID    *10840099
W3540C******************************************************************10850099
W3540C 1600-VERIFY-BEG-DTE-TIMESTMP.                                    10860099
W3540C                                                                  10870099
W3540C** VERIFY IF CONTROL CARD BEGIN TIMESTAMP IS VALID **             10880099
W3540C     INITIALIZE DPG51 DPG52 DPG53                                 10890099
W3540C                DPG54 DPG55 DPG56.                                10900099
W3540C                                                                  10910099
W3540C     SET  DPG51-ACTUAL-CALENDAR-ONLY                              10920099
W3540C                                 TO TRUE.                         10930099
W3540C     MOVE CR-BEG-DATE            TO DPG52-LK-DATE-INPUT.          10940099
W3540C     SET  DPG52-LK-DTE-ISO-FMT   TO TRUE.                         10950099
W3540C                                                                  10960099
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    10970099
W3540C                                             DPG54 DPG55 DPG56.   10980099
W3540C     EVALUATE TRUE                                                10990099
W3540C       WHEN DPG54-SEVERE-ERROR                                    11000099
W3540C       WHEN DPG54-DATE-INVALID                                    11010099
W3540C         DISPLAY ' '                                              11020099
W3540C         DISPLAY '** ABEND     **'                                11030099
W3540C         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            11040099
W3540C         DISPLAY '** PARAGRAPH **  = 1600-VERIFY-BEG-DTE-TIMESTMP'11050099
W3540C         DISPLAY '** BAD CALL TO CALENDAR MODULE '                11060099
W3540C         DISPLAY '** DETERMINE VALID CONTROL CARD BEG-TIMESTAMP**'11070099
W3540C         DISPLAY DPG54-ERROR-MESSAGE                              11080099
W3540C         SET ABEND-4019-CALENDER-ERROR TO TRUE                    11090099
W3540C         CALL 'ILBOABN0' USING ABEND-CODE                         11100099
W3540C     END-EVALUATE.                                                11110099
W3540C                                                                  11120099
W3540C******************************************************************11130099
W3540C* VERIFY THAT THE DATE IN THE TIMESTAMP CONTROL CARD IS VALID    *11140099
W3540C******************************************************************11150099
W3540C 1650-VERIFY-END-DTE-TIMESTMP.                                    11160099
W3540C                                                                  11170099
W3540C** VERIFY IF CONTROL CARD END TIMESTAMP IS VALID **               11180099
W3540C     INITIALIZE DPG51 DPG52 DPG53                                 11190099
W3540C                DPG54 DPG55 DPG56.                                11200099
W3540C                                                                  11210099
W3540C     SET  DPG51-ACTUAL-CALENDAR-ONLY                              11220099
W3540C                                 TO TRUE.                         11230099
W3540C     MOVE CR-END-DATE            TO DPG52-LK-DATE-INPUT.          11240099
W3540C     SET  DPG52-LK-DTE-ISO-FMT   TO TRUE.                         11250099
W3540C                                                                  11260099
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11270099
W3540C                                             DPG54 DPG55 DPG56.   11280099
W3540C     EVALUATE TRUE                                                11290099
W3540C       WHEN DPG54-SEVERE-ERROR                                    11300099
W3540C       WHEN DPG54-DATE-INVALID                                    11310099
W3540C         DISPLAY ' '                                              11320099
W3540C         DISPLAY '** ABEND     **'                                11330099
W3540C         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            11340099
W3540C         DISPLAY '** PARAGRAPH **  = 1650-VERIFY-END-DTE-TIMESTMP'11350099
W3540C         DISPLAY '** BAD CALL TO CALENDAR MODULE '                11360099
W3540C         DISPLAY '** DETERMINE VALID CONTROL CARD END-TIMESTAMP**'11370099
W3540C         DISPLAY DPG54-ERROR-MESSAGE                              11380099
W3540C         SET ABEND-4019-CALENDER-ERROR TO TRUE                    11390099
W3540C         CALL 'ILBOABN0' USING ABEND-CODE                         11400099
W3540C     END-EVALUATE.                                                11410099
W3540C                                                                  11420099
091600******************************************************************11430099
091700* OPEN THE STOCK ID CURSOR.                                      *11440099
091800******************************************************************11450099
091900 1700-OPEN-STOCKID-CSR.                                           11460099
092000                                                                  11470099
092100     EXEC SQL                                                     11480099
092200       OPEN STOCK-ID-CSR                                          11490099
092300     END-EXEC.                                                    11500099
092400                                                                  11510099
092500     EVALUATE SQLCODE                                             11520099
092600       WHEN ZERO                                                  11530099
092700           CONTINUE                                               11540099
092800       WHEN OTHER                                                 11550099
092900           DISPLAY ' '                                            11560099
093000           DISPLAY '** ABEND     **'                              11570099
093100           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          11580099
093200           DISPLAY '** PARAGRAPH **  = 1700-OPEN-STOCK-ID-CSR'    11590099
093300           DISPLAY '** OPEN STOCK-ID-CSR'                         11600099
093400           PERFORM 9100-SQL-ABEND                                 11610099
093500     END-EVALUATE.                                                11620099
093600                                                                  11630099
093700******************************************************************11640099
093800* LOAD THE STOCK ID TABLE.                                       *11650099
093900******************************************************************11660099
094000 1710-LOAD-STOCK-ID-TABLE.                                        11670099
094100                                                                  11680099
094200     IF SVT00008-CRD-STK-TYP-ID > PV-CRD-STK-TYP-ID               11690099
094300         IF PV-CRD-STK-TYP-ID > SPACES                            11700099
094400             SET PT-INDX1 UP BY 1                                 11710099
094500         ELSE                                                     11720099
094600             SET PT-INDX1 TO 1                                    11730099
094700         END-IF                                                   11740099
094800         MOVE SVT00008-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID        11750099
094900                                         PT-CRD-STK-TYP-ID        11760099
095000                                         (PT-INDX1)               11770099
095100         SET PT-INDX2 TO 1                                        11780099
095200     END-IF.                                                      11790099
095300                                                                  11800099
095400     MOVE 'Y'                        TO PT-DENOMINATION-IND       11810099
095500                                        (PT-INDX1 PT-INDX2).      11820099
095600     MOVE SVT00008-PRE-DNNTD-CRD-AMT TO PT-PRE-DNNTD-CRD-AMT      11830099
095700                                        (PT-INDX1 PT-INDX2).      11840099
095800     SET PT-INDX2 UP BY 1.                                        11850099
095900                                                                  11860099
096000     IF PT-INDX2 > PC-MAX-DENOMS                                  11870099
096100         DISPLAY '** ABEND     **'                                11880099
096200         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            11890099
096300         DISPLAY '** PARAGRAPH **  = 1710-LOAD-STOCK-ID-TABLE'    11900099
096400         DISPLAY '** TABLE OVERFLOW ERROR ON PT-STOCK-ID TABLE'   11910099
096500         DISPLAY '*** MORE THAN ' PC-MAX-DENOMS ' FOR STOCK ID '  11920099
096600                  PV-CRD-STK-TYP-ID                               11930099
096700         SET ABEND-4002-READ-ERROR  TO TRUE                       11940099
096800         CALL 'ILBOABN0' USING ABEND-CODE                         11950099
096900     END-IF.                                                      11960099
097000                                                                  11970099
097100     PERFORM 1711-FETCH-STOCK-ID-CSR.                             11980099
097200                                                                  11990099
097300******************************************************************12000099
097400* FETCH A ROW FROM THE STOCK ID CURSOR                           *12010099
097500******************************************************************12020099
097600 1711-FETCH-STOCK-ID-CSR.                                         12030099
097700                                                                  12040099
097800     EXEC SQL                                                     12050099
097900         FETCH STOCK-ID-CSR                                       12060099
098000          INTO :SVT00008-CRD-STK-TYP-ID                           12070099
098100              ,:SVT00008-PRE-DNNTD-CRD-AMT                        12080099
098200     END-EXEC.                                                    12090099
098300                                                                  12100099
098400     EVALUATE SQLCODE                                             12110099
098500       WHEN ZERO                                                  12120099
098600           CONTINUE                                               12130099
098700       WHEN +100                                                  12140099
098800           SET PS-END-OF-STOCK-ID-CSR TO TRUE                     12150099
098900       WHEN OTHER                                                 12160099
099000           DISPLAY ' '                                            12170099
099100           DISPLAY '** ABEND     **'                              12180099
099200           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          12190099
099300           DISPLAY '** PARAGRAPH **  = 2100-FETCH-LOC-CSR'        12200099
099400           DISPLAY '** FETCH LOC-CSR'                             12210099
099500           PERFORM 9100-SQL-ABEND                                 12220099
099600     END-EVALUATE.                                                12230099
099700                                                                  12240099
099800******************************************************************12250099
099900* CLOSE THE STOCK ID CURSOR.                                     *12260099
100000******************************************************************12270099
100100 1720-CLOSE-STOCK-ID-CSR.                                         12280099
100200                                                                  12290099
100300     EXEC SQL                                                     12300099
100400       CLOSE STOCK-ID-CSR                                         12310099
100500     END-EXEC.                                                    12320099
100600                                                                  12330099
100700     EVALUATE SQLCODE                                             12340099
100800       WHEN ZERO                                                  12350099
100900           CONTINUE                                               12360099
101000       WHEN OTHER                                                 12370099
101100           DISPLAY ' '                                            12380099
101200           DISPLAY '** ABEND     **'                              12390099
101300           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          12400099
101400           DISPLAY '** PARAGRAPH **  = 1720-CLOSE-STOCK-ID-CSR'   12410099
101500           DISPLAY '** CLOSE STOCK-ID-CSR'                        12420099
101600           PERFORM 9100-SQL-ABEND                                 12430099
101700     END-EVALUATE.                                                12440099
101800                                                                  12450099
101900******************************************************************12460099
102000* ACCUMULATE AMOUNTS FOR EACH STOCK ID AND DENOMINATION AND STORE.12470099
102100******************************************************************12480099
102200 2000-PROCESS-LOC-CSR.                                            12490099
102300                                                                  12500099
102400     PERFORM VARYING PT-INDX1 FROM 1 BY 1                         12510099
102500             UNTIL PT-INDX1 GREATER THAN PC-MAX-STOCK-IDS         12520099
102600         PERFORM VARYING PT-INDX2 FROM 1 BY 1                     12530099
102700                 UNTIL PT-INDX2 GREATER THAN PC-MAX-DENOMS        12540099
102800             MOVE ZERO TO PT-STR-IC-COUNT (PT-INDX1 PT-INDX2)     12550099
102900                          PT-STR-IC-SUM   (PT-INDX1 PT-INDX2)     12560099
103000                          PT-STR-VC-COUNT (PT-INDX1 PT-INDX2)     12570099
103100                          PT-STR-VC-SUM   (PT-INDX1 PT-INDX2)     12580099
103200                          PT-STR-TC-COUNT (PT-INDX1 PT-INDX2)     12590099
103300                          PT-STR-TC-SUM   (PT-INDX1 PT-INDX2)     12600099
103400         END-PERFORM                                              12610099
103500     END-PERFORM.                                                 12620099
103600                                                                  12630099
103700     PERFORM 3000-PROCESS-ISSUES                                  12640099
103800         UNTIL PS-END-OF-ISSUED-CSR OR                            12650099
103900               PV-IC-STR-NBR > XST00001-LOC-NBR.                  12660099
104000                                                                  12670099
104100     PERFORM 4000-PROCESS-VOIDS                                   12680099
104200         UNTIL PS-END-OF-VOID-CSR OR                              12690099
104300               PV-VC-STR-NBR > XST00001-LOC-NBR.                  12700099
104400                                                                  12710099
104500     PERFORM 5000-PROCESS-TENDERS                                 12720099
104600         UNTIL PS-END-OF-TENDERED-CSR OR                          12730099
104700               PV-TC-STR-NBR > XST00001-LOC-NBR.                  12740099
104800                                                                  12750099
104900     PERFORM 6000-WRITE-REPORT.                                   12760099
105000                                                                  12770099
105100     PERFORM 2100-FETCH-LOC-CSR.                                  12780099
105200                                                                  12790099
105300***************************************************************** 12800099
105400* FETCH AN THE NEXT STORE FROM THE LOCATION CURSOR.             * 12810099
105500***************************************************************** 12820099
105600 2100-FETCH-LOC-CSR.                                              12830099
105700                                                                  12840099
105800     EXEC SQL                                                     12850099
105900         FETCH LOC-CSR                                            12860099
106000          INTO :XST00001-LOC-NBR                                  12870099
106100     END-EXEC.                                                    12880099
106200                                                                  12890099
106300     EVALUATE SQLCODE                                             12900099
106400       WHEN ZERO                                                  12910099
106500           CONTINUE                                               12920099
106600       WHEN +100                                                  12930099
106700           SET PS-END-OF-LOC-CSR TO TRUE                          12940099
106800       WHEN OTHER                                                 12950099
106900           DISPLAY ' '                                            12960099
107000           DISPLAY '** ABEND     **'                              12970099
107100           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          12980099
107200           DISPLAY '** PARAGRAPH **  = 2100-FETCH-LOC-CSR'        12990099
107300           DISPLAY '** FETCH LOC-CSR'                             13000099
107400           PERFORM 9100-SQL-ABEND                                 13010099
107500     END-EVALUATE.                                                13020099
107600                                                                  13030099
107700******************************************************************13040099
107800* FETCH ISSUE ROWS AND LOAD THEM TO THE CARD STOCK TABLE         *13050099
107900******************************************************************13060099
108000 3000-PROCESS-ISSUES.                                             13070099
108100                                                                  13080099
108200     IF PV-IC-STR-NBR = XST00001-LOC-NBR                          13090099
108300       SET PT-INDX1                                               13100099
108400           PT-INDX2 TO 1                                          13110099
108500       SEARCH  PT-STOCK-ID-DATA                                   13120099
108600         AT END                                                   13130099
108700           DISPLAY 'CARD STOCK NOT FOUND '                        13140099
108800                   PV-IC-CRD-STK-TYP-ID                           13150099
108900         WHEN PT-CRD-STK-TYP-ID (PT-INDX1) =                      13160099
109000                               PV-IC-CRD-STK-TYP-ID               13170099
109100           SEARCH PT-DENOMINATION-DATA                            13180099
109200             AT END                                               13190099
109300                 DISPLAY 'DENOMINATION NOT FOUND '                13200099
109400                         PV-IC-PRE-DNNTD-CRD-AMT                  13210099
109500             WHEN PT-PRE-DNNTD-CRD-AMT (PT-INDX1 PT-INDX2) =      13220099
109600                                     PV-IC-PRE-DNNTD-CRD-AMT      13230099
109700                 MOVE PV-IC-COUNT TO PT-STR-IC-COUNT              13240099
109800                                     (PT-INDX1 PT-INDX2)          13250099
109900                 ADD  PV-IC-COUNT TO PT-TTL-IC-COUNT              13260099
110000                                     (PT-INDX1 PT-INDX2)          13270099
110100                 MOVE PV-IC-SUM   TO PT-STR-IC-SUM                13280099
110200                                     (PT-INDX1 PT-INDX2)          13290099
110300                 ADD  PV-IC-SUM   TO PT-TTL-IC-SUM                13300099
110400                                     (PT-INDX1 PT-INDX2)          13310099
110500           END-SEARCH                                             13320099
110600       END-SEARCH                                                 13330099
110700     END-IF.                                                      13340099
110800                                                                  13350099
110900     PERFORM 3100-FETCH-ISSUE-CSR.                                13360099
111000                                                                  13370099
111100***************************************************************** 13380099
111200* FETCH AN THE NEXT ISSUE COUNT.                                * 13390099
111300***************************************************************** 13400099
111400 3100-FETCH-ISSUE-CSR.                                            13410099
111500                                                                  13420099
111600     EXEC SQL                                                     13430099
111700        FETCH ISSUED-CSR                                          13440099
111800          INTO :PV-IC-STR-NBR                                     13450099
111900              ,:PV-IC-CRD-STK-TYP-ID                              13460099
112000              ,:PV-IC-PRE-DNNTD-CRD-AMT                           13470099
112100              ,:PV-IC-COUNT                                       13480099
112200              ,:PV-IC-SUM                                         13490099
112300     END-EXEC.                                                    13500099
112400                                                                  13510099
112500     EVALUATE SQLCODE                                             13520099
112600       WHEN ZERO                                                  13530099
112700           CONTINUE                                               13540099
112800       WHEN +100                                                  13550099
112900           SET PS-END-OF-ISSUED-CSR TO TRUE                       13560099
113000       WHEN OTHER                                                 13570099
113100           DISPLAY ' '                                            13580099
113200           DISPLAY '** ABEND     **'                              13590099
113300           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          13600099
113400           DISPLAY '** PARAGRAPH **  = 3100-FETCH-ISSUE-CSR'      13610099
113500           DISPLAY '** ERROR ON FETCH OF CURSOR ISSUED-CSR'       13620099
113600           PERFORM 9100-SQL-ABEND                                 13630099
113700     END-EVALUATE.                                                13640099
113800                                                                  13650099
113900******************************************************************13660099
114000* FETCH VOID ROWS AND LOAD THEM TO THE CARD STOCK TABLE          *13670099
114100******************************************************************13680099
114200 4000-PROCESS-VOIDS.                                              13690099
114300                                                                  13700099
114400     IF PV-VC-STR-NBR = XST00001-LOC-NBR                          13710099
114500       SET PT-INDX1                                               13720099
114600           PT-INDX2 TO 1                                          13730099
114700       SEARCH  PT-STOCK-ID-DATA                                   13740099
114800         AT END                                                   13750099
114900           DISPLAY 'CARD STOCK NOT FOUND '                        13760099
115000                   PV-VC-CRD-STK-TYP-ID                           13770099
115100         WHEN PT-CRD-STK-TYP-ID (PT-INDX1) =                      13780099
115200                               PV-VC-CRD-STK-TYP-ID               13790099
115300           SEARCH PT-DENOMINATION-DATA                            13800099
115400             AT END                                               13810099
115500               DISPLAY 'DENOMINATION NOT FOUND '                  13820099
115600                        PV-VC-PRE-DNNTD-CRD-AMT                   13830099
115700             WHEN PT-PRE-DNNTD-CRD-AMT (PT-INDX1 PT-INDX2) =      13840099
115800                               PV-VC-PRE-DNNTD-CRD-AMT            13850099
115900             MOVE PV-VC-COUNT TO PT-STR-VC-COUNT                  13860099
116000                                 (PT-INDX1 PT-INDX2)              13870099
116100             ADD  PV-VC-COUNT TO PT-TTL-VC-COUNT                  13880099
116200                                 (PT-INDX1 PT-INDX2)              13890099
116300             MOVE PV-VC-SUM   TO PT-STR-VC-SUM                    13900099
116400                                 (PT-INDX1 PT-INDX2)              13910099
116500             ADD  PV-VC-SUM   TO PT-TTL-VC-SUM                    13920099
116600                                 (PT-INDX1 PT-INDX2)              13930099
116700           END-SEARCH                                             13940099
116800       END-SEARCH                                                 13950099
116900     END-IF.                                                      13960099
117000                                                                  13970099
117100     PERFORM 4100-FETCH-VOID-CSR.                                 13980099
117200                                                                  13990099
117300***************************************************************** 14000099
117400* FETCH AN THE NEXT VOID COUNT.                                 * 14010099
117500***************************************************************** 14020099
117600 4100-FETCH-VOID-CSR.                                             14030099
117700                                                                  14040099
117800     EXEC SQL                                                     14050099
117900        FETCH VOID-CSR                                            14060099
118000          INTO :PV-VC-STR-NBR                                     14070099
118100              ,:PV-VC-CRD-STK-TYP-ID                              14080099
118200              ,:PV-VC-PRE-DNNTD-CRD-AMT                           14090099
118300              ,:PV-VC-COUNT                                       14100099
118400              ,:PV-VC-SUM                                         14110099
118500     END-EXEC.                                                    14120099
118600                                                                  14130099
118700     EVALUATE SQLCODE                                             14140099
118800       WHEN ZERO                                                  14150099
118900           CONTINUE                                               14160099
119000       WHEN +100                                                  14170099
119100           SET PS-END-OF-VOID-CSR TO TRUE                         14180099
119200       WHEN OTHER                                                 14190099
119300           DISPLAY ' '                                            14200099
119400           DISPLAY '** ABEND     **'                              14210099
119500           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          14220099
119600           DISPLAY '** PARAGRAPH **  = 4100-FETCH-ISSUE-CSR'      14230099
119700           DISPLAY '** ERROR ON FETCH OF CURSOR VOID-CSR'         14240099
119800           PERFORM 9100-SQL-ABEND                                 14250099
119900     END-EVALUATE.                                                14260099
120000                                                                  14270099
120100******************************************************************14280099
120200* FETCH TENDER ROWS AND LOAD THEM TO THE CARD STOCK TABLE        *14290099
120300******************************************************************14300099
120400 5000-PROCESS-TENDERS.                                            14310099
120500                                                                  14320099
120600     IF PV-TC-STR-NBR = XST00001-LOC-NBR                          14330099
120700       SET PT-INDX1                                               14340099
120800           PT-INDX2 TO 1                                          14350099
120900       SEARCH  PT-STOCK-ID-DATA                                   14360099
121000         AT END                                                   14370099
121100           DISPLAY 'CARD STOCK NOT FOUND '                        14380099
121200                   PV-TC-CRD-STK-TYP-ID                           14390099
121300         WHEN PT-CRD-STK-TYP-ID (PT-INDX1) =                      14400099
121400                               PV-TC-CRD-STK-TYP-ID               14410099
121500           SEARCH PT-DENOMINATION-DATA                            14420099
121600             AT END                                               14430099
121700               DISPLAY 'DENOMINATION NOT FOUND '                  14440099
121800                        PV-TC-PRE-DNNTD-CRD-AMT                   14450099
121900             WHEN PT-PRE-DNNTD-CRD-AMT (PT-INDX1 PT-INDX2) =      14460099
122000                               PV-TC-PRE-DNNTD-CRD-AMT            14470099
122100             MOVE PV-TC-COUNT TO PT-STR-TC-COUNT                  14480099
122200                                 (PT-INDX1 PT-INDX2)              14490099
122300             ADD  PV-TC-COUNT TO PT-TTL-TC-COUNT                  14500099
122400                                 (PT-INDX1 PT-INDX2)              14510099
122500             MOVE PV-TC-SUM   TO PT-STR-TC-SUM                    14520099
122600                                 (PT-INDX1 PT-INDX2)              14530099
122700             ADD  PV-TC-SUM   TO PT-TTL-TC-SUM                    14540099
122800                                 (PT-INDX1 PT-INDX2)              14550099
122900           END-SEARCH                                             14560099
123000       END-SEARCH                                                 14570099
123100     END-IF.                                                      14580099
123200                                                                  14590099
123300     PERFORM 5100-FETCH-TENDER-CSR.                               14600099
123400                                                                  14610099
123500***************************************************************** 14620099
123600* FETCH AN THE NEXT TENDER COUNT.                               * 14630099
123700***************************************************************** 14640099
123800 5100-FETCH-TENDER-CSR.                                           14650099
123900                                                                  14660099
124000     EXEC SQL                                                     14670099
124100        FETCH TENDERED-CSR                                        14680099
124200          INTO :PV-TC-STR-NBR                                     14690099
124300              ,:PV-TC-CRD-STK-TYP-ID                              14700099
124400              ,:PV-TC-PRE-DNNTD-CRD-AMT                           14710099
124500              ,:PV-TC-COUNT                                       14720099
124600              ,:PV-TC-SUM                                         14730099
124700     END-EXEC.                                                    14740099
124800                                                                  14750099
124900     EVALUATE SQLCODE                                             14760099
125000       WHEN ZERO                                                  14770099
125100            CONTINUE                                              14780099
125200       WHEN +100                                                  14790099
125300            SET PS-END-OF-TENDERED-CSR TO TRUE                    14800099
125400       WHEN OTHER                                                 14810099
125500            DISPLAY ' '                                           14820099
125600            DISPLAY '** ABEND     **'                             14830099
125700            DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME         14840099
125800            DISPLAY '** PARAGRAPH **  = 5100-FETCH-TENDER-CSR'    14850099
125900            DISPLAY '** ERROR ON FETCH OF CURSOR TENDERED-CSR'    14860099
126000            PERFORM 9100-SQL-ABEND                                14870099
126100     END-EVALUATE.                                                14880099
126200                                                                  14890099
126300                                                                  14900099
126400***************************************************************** 14910099
126500* 6000-WRITE-REPORT                                            *  14920099
126600***************************************************************** 14930099
126700                                                                  14940099
126800 6000-WRITE-REPORT.                                               14950099
126900*------------------                                               14960099
127000                                                                  14970099
127100     MOVE XST00001-LOC-NBR TO HL2-STORE-NUM                       14980099
127110                              HL2-STORE-NUM-W-M.                  14990099
127200                                                                  15000099
127300     PERFORM 8000-PRINT-HEADINGS.                                 15010099
127400                                                                  15020099
127500     PERFORM VARYING PT-INDX1 FROM 1 BY 1                         15030099
127600             UNTIL PT-INDX1 > PC-MAX-STOCK-IDS                    15040099
127700       IF PT-CRD-STK-TYP-ID (PT-INDX1) NOT EQUAL SPACES           15050099
127800         MOVE PT-CRD-STK-TYP-ID (PT-INDX1) TO DL1-STOCK-ID        15060099
127900                                    PV-HOLD-CRD-STK-TYP-ID        15070099
128000         MOVE ZERO TO PV-DETAIL-CNT                               15080099
128100         PERFORM VARYING PT-INDX2 FROM 1 BY 1                     15090099
128200                 UNTIL PT-INDX2 > PC-MAX-DENOMS                   15100099
128300           IF PT-DENOMINATION-IND (PT-INDX1 PT-INDX2) = 'Y'       15110099
128400               IF PT-STR-IC-COUNT (PT-INDX1 PT-INDX2) > ZERO OR   15120099
128500                  PT-STR-VC-COUNT (PT-INDX1 PT-INDX2) > ZERO OR   15130099
128600                  PT-STR-TC-COUNT (PT-INDX1 PT-INDX2) > ZERO      15140099
128700                       PERFORM 6100-PROCESS-DETAIL                15150099
128800                       ADD +1 TO PV-DETAIL-CNT                    15160099
128900               END-IF                                             15170099
129000           END-IF                                                 15180099
129100         END-PERFORM                                              15190099
129200         IF PV-DETAIL-CNT       > ZERO                            15200099
129300              PERFORM 6200-CRD-STK-TYP-ID-BREAK                   15210099
129400         END-IF                                                   15220099
129500       END-IF                                                     15230099
129600     END-PERFORM.                                                 15240099
129700                                                                  15250099
129800     PERFORM 6300-PROCESS-STORE-TOTAL.                            15260099
129900                                                                  15270099
130000******************************************************************15280099
130100* 6100-PROCESS-DETAIL                                             15290099
130200******************************************************************15300099
130300 6100-PROCESS-DETAIL.                                             15310099
130400                                                                  15320099
130500     IF PA-LINE-COUNT > 55                                        15330099
130600        PERFORM 8000-PRINT-HEADINGS                               15340099
130700        MOVE PV-HOLD-CRD-STK-TYP-ID TO DL1-STOCK-ID               15350099
130800     END-IF.                                                      15360099
130900                                                                  15370099
131000     COMPUTE DL1-NET-QTY =                                        15380099
131100             PT-STR-IC-COUNT (PT-INDX1 PT-INDX2) -                15390099
131200             PT-STR-VC-COUNT (PT-INDX1 PT-INDX2)                  15400099
131300     END-COMPUTE.                                                 15410099
131400                                                                  15420099
131500     COMPUTE DL1-NET-ISSUED =                                     15430099
131600             PT-STR-IC-SUM (PT-INDX1 PT-INDX2) +                  15440099
131700             PT-STR-VC-SUM (PT-INDX1 PT-INDX2)                    15450099
131800     END-COMPUTE.                                                 15460099
131900                                                                  15470099
132000     MOVE PT-PRE-DNNTD-CRD-AMT (PT-INDX1 PT-INDX2)                15480099
132100                                          TO DL1-DENOM.           15490099
132200                                                                  15500099
132300     MOVE PT-STR-IC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-ISSUED.  15510099
132400     MOVE PT-STR-IC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-ISSUED.  15520099
132500     MOVE PT-STR-VC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-VOIDED.  15530099
132600     MOVE PT-STR-VC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-VOIDED.  15540099
132700     MOVE PT-STR-TC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-TENDERED.15550099
132800     MOVE PT-STR-TC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-TENDERED.15560099
132900                                                                  15570099
133000     ADD  PT-STR-IC-COUNT (PT-INDX1 PT-INDX2) TO PA-SI-QTY-ISSUED 15580099
133100                                                 PA-ST-QTY-ISSUED.15590099
133200     ADD  PT-STR-IC-SUM   (PT-INDX1 PT-INDX2) TO PA-SI-AMT-ISSUED 15600099
133300                                                 PA-ST-AMT-ISSUED.15610099
133400     ADD  PT-STR-VC-COUNT (PT-INDX1 PT-INDX2) TO PA-SI-QTY-VOIDED 15620099
133500                                                 PA-ST-QTY-VOIDED.15630099
133600     ADD  PT-STR-VC-SUM   (PT-INDX1 PT-INDX2) TO PA-SI-AMT-VOIDED 15640099
133700                                                 PA-ST-AMT-VOIDED.15650099
133800     ADD  PT-STR-TC-COUNT (PT-INDX1 PT-INDX2) TO                  15660099
133900                                               PA-SI-QTY-TENDERED 15670099
134000                                               PA-ST-QTY-TENDERED.15680099
134100     ADD  PT-STR-TC-SUM   (PT-INDX1 PT-INDX2) TO                  15690099
134200                                               PA-SI-AMT-TENDERED 15700099
134300                                               PA-ST-AMT-TENDERED.15710099
134400     MOVE DETAIL-LINE1 TO REPORT-OUT.                             15720099
134500     IF DL1-STOCK-ID = SPACES                                     15730099
134600         MOVE 1 TO PV-SPACE-CONTROL                               15740099
134700     ELSE                                                         15750099
134800         MOVE 2 TO PV-SPACE-CONTROL                               15760099
134900     END-IF.                                                      15770099
135000     PERFORM 8100-WRITE-DETAIL.                                   15780099
135100     MOVE SPACES TO DL1-STOCK-ID.                                 15790099
135200                                                                  15800099
135300******************************************************************15810099
135400* IF MORE THAN ONE DENOMINATION WAS LISTED FOR THE CARD STOCK,   *15820099
135500* WRITE CARD STOCK TOTALS.  ALWAYS RESET THE CARD STOCK TOTAL    *15830099
135600* AMOUNTS.                                                       *15840099
135700******************************************************************15850099
135800 6200-CRD-STK-TYP-ID-BREAK.                                       15860099
135900                                                                  15870099
136000     IF PV-DETAIL-CNT > 1                                         15880099
136100         PERFORM 6210-WRITE-CRD-STK-TOTALS                        15890099
136200     END-IF.                                                      15900099
136300                                                                  15910099
136400     IF PA-LINE-COUNT > 55                                        15920099
136500         PERFORM 8000-PRINT-HEADINGS                              15930099
136600     ELSE                                                         15940099
136700         MOVE 1            TO PV-SPACE-CONTROL                    15950099
136800         MOVE SPACES       TO REPORT-OUT                          15960099
136900         PERFORM 8100-WRITE-DETAIL                                15970099
137000     END-IF.                                                      15980099
137100                                                                  15990099
137200     MOVE ZERO TO PA-SI-QTY-ISSUED                                16000099
137300                  PA-SI-AMT-ISSUED                                16010099
137400                  PA-SI-QTY-VOIDED                                16020099
137500                  PA-SI-AMT-VOIDED                                16030099
137600                  PA-SI-QTY-TENDERED                              16040099
137700                  PA-SI-AMT-TENDERED.                             16050099
137800                                                                  16060099
137900******************************************************************16070099
138000* PRINT THE CARD STOCK TOTAL LINE AFTER CHECKING IF A PAGE BREAK *16080099
138100* IS NEEDED.  IF THE CARD STOCK TOTAL IS PRINTED ON THE NEXT PAGE*16090099
138200* PUT THE CARD STOCK ID IN THE TOTAL DESCRIPTION.                *16100099
138300******************************************************************16110099
138400 6210-WRITE-CRD-STK-TOTALS.                                       16120099
138500                                                                  16130099
138600     IF PA-LINE-COUNT > 54                                        16140099
138700        PERFORM 8000-PRINT-HEADINGS                               16150099
138800        MOVE PV-HOLD-CRD-STK-TYP-ID                               16160099
138900                            TO DL1-STOCK-ID                       16170099
139000     ELSE                                                         16180099
139100         MOVE SUMMARY-LINE2 TO REPORT-OUT                         16190099
139200         MOVE 1 TO PV-SPACE-CONTROL                               16200099
139300         PERFORM 8100-WRITE-DETAIL                                16210099
139400         MOVE SPACES        TO DL1-STOCK-ID                       16220099
139500     END-IF.                                                      16230099
139600                                                                  16240099
139700     MOVE '       TOTAL'     TO DL1-DENOM-TEXT.                   16250099
139800     MOVE PA-SI-QTY-ISSUED   TO DL1-QTY-ISSUED.                   16260099
139900     MOVE PA-SI-AMT-ISSUED   TO DL1-AMT-ISSUED.                   16270099
140000     MOVE PA-SI-QTY-VOIDED   TO DL1-QTY-VOIDED.                   16280099
140100     MOVE PA-SI-AMT-VOIDED   TO DL1-AMT-VOIDED.                   16290099
140200     MOVE PA-SI-QTY-TENDERED TO DL1-QTY-TENDERED.                 16300099
140300     MOVE PA-SI-AMT-TENDERED TO DL1-AMT-TENDERED.                 16310099
140400                                                                  16320099
140500     COMPUTE DL1-NET-QTY =                                        16330099
140600             PA-SI-QTY-ISSUED -                                   16340099
140700             PA-SI-QTY-VOIDED                                     16350099
140800     END-COMPUTE.                                                 16360099
140900                                                                  16370099
141000     COMPUTE DL1-NET-ISSUED =                                     16380099
141100             PA-SI-AMT-ISSUED +                                   16390099
141200             PA-SI-AMT-VOIDED                                     16400099
141300     END-COMPUTE.                                                 16410099
141400                                                                  16420099
141500     MOVE DETAIL-LINE1 TO REPORT-OUT.                             16430099
141600     MOVE 1 TO PV-SPACE-CONTROL.                                  16440099
141700     PERFORM 8100-WRITE-DETAIL.                                   16450099
141800                                                                  16460099
141900******************************************************************16470099
142000* 6300-PROCESS-STORE-TOTAL.                                       16480099
142100******************************************************************16490099
142200 6300-PROCESS-STORE-TOTAL.                                        16500099
142300                                                                  16510099
142400     IF PA-LINE-COUNT > 54                                        16520099
142500        PERFORM 8000-PRINT-HEADINGS                               16530099
142600     END-IF.                                                      16540099
142700                                                                  16550099
142800     MOVE 'STORE '           TO SL1-DESCRIPTION (1:6).            16560099
142810     IF  CR-TIME-PERIOD = 'W' OR                                  16570099
142820         CR-TIME-PERIOD = 'M'                                     16580099
142900        MOVE HL2-STORE-NUM-W-M  TO SL1-DESCRIPTION (7:4)          16590099
142901     ELSE                                                         16600099
142910        MOVE HL2-STORE-NUM      TO SL1-DESCRIPTION (7:4)          16610099
142920     END-IF.                                                      16620099
143000     MOVE 'TOTALS ===>'      TO SL1-DESCRIPTION (12:11).          16630099
143100     MOVE PA-ST-QTY-ISSUED   TO SL1-QTY-ISSUED.                   16640099
143200     MOVE PA-ST-AMT-ISSUED   TO SL1-AMT-ISSUED.                   16650099
143300     MOVE PA-ST-QTY-VOIDED   TO SL1-QTY-VOIDED.                   16660099
143400     MOVE PA-ST-AMT-VOIDED   TO SL1-AMT-VOIDED.                   16670099
143500     MOVE PA-ST-QTY-TENDERED TO SL1-QTY-TENDERED.                 16680099
143600     MOVE PA-ST-AMT-TENDERED TO SL1-AMT-TENDERED.                 16690099
143700                                                                  16700099
143800     COMPUTE SL1-NET-QTY =                                        16710099
143900             PA-ST-QTY-ISSUED -                                   16720099
144000             PA-ST-QTY-VOIDED                                     16730099
144100     END-COMPUTE.                                                 16740099
144200                                                                  16750099
144300     COMPUTE SL1-NET-ISSUED =                                     16760099
144400             PA-ST-AMT-ISSUED +                                   16770099
144500             PA-ST-AMT-VOIDED                                     16780099
144600     END-COMPUTE.                                                 16790099
144700                                                                  16800099
144800     MOVE SUMMARY-LINE1 TO REPORT-OUT.                            16810099
144900     MOVE 2             TO PV-SPACE-CONTROL.                      16820099
145000                                                                  16830099
145100     PERFORM 8100-WRITE-DETAIL.                                   16840099
145200                                                                  16850099
145300     MOVE ZERO   TO PA-ST-QTY-ISSUED                              16860099
145400                    PA-ST-AMT-ISSUED                              16870099
145500                    PA-ST-QTY-VOIDED                              16880099
145600                    PA-ST-AMT-VOIDED                              16890099
145700                    PA-ST-QTY-TENDERED                            16900099
145800                    PA-ST-AMT-TENDERED.                           16910099
145900     MOVE SPACES TO PV-HOLD-CRD-STK-TYP-ID.                       16920099
146000                                                                  16930099
146100******************************************************************16940099
146200* 7000-CORP-TOTALS.                                               16950099
146300******************************************************************16960099
146400                                                                  16970099
146500 7000-CORP-TOTALS.                                                16980099
146600                                                                  16990099
146704     MOVE 'STORE NUMBER: CORP' TO HL2-DESCRIPTION                 17000099
146705                                  HL2-DESCRIPTION-W-M.            17010099
146800     PERFORM 8000-PRINT-HEADINGS.                                 17020099
146900                                                                  17030099
147000     PERFORM VARYING PT-INDX1 FROM 1 BY 1                         17040099
147100             UNTIL PT-INDX1 > PC-MAX-STOCK-IDS                    17050099
147200       IF PT-CRD-STK-TYP-ID (PT-INDX1) NOT EQUAL SPACES           17060099
147300         MOVE PT-CRD-STK-TYP-ID (PT-INDX1) TO DL1-STOCK-ID        17070099
147400                                    PV-HOLD-CRD-STK-TYP-ID        17080099
147500         MOVE ZERO TO PV-DETAIL-CNT                               17090099
147600         PERFORM VARYING PT-INDX2 FROM 1 BY 1                     17100099
147700                 UNTIL PT-INDX2 > PC-MAX-DENOMS                   17110099
147800           IF PT-DENOMINATION-IND (PT-INDX1 PT-INDX2) = 'Y'       17120099
147900               IF PT-TTL-IC-COUNT (PT-INDX1 PT-INDX2) > ZERO OR   17130099
148000                  PT-TTL-VC-COUNT (PT-INDX1 PT-INDX2) > ZERO OR   17140099
148100                  PT-TTL-TC-COUNT (PT-INDX1 PT-INDX2) > ZERO      17150099
148200                       PERFORM 7100-PROCESS-DETAIL                17160099
148300                       ADD +1 TO PV-DETAIL-CNT                    17170099
148400               END-IF                                             17180099
148500           END-IF                                                 17190099
148600         END-PERFORM                                              17200099
148700         IF PV-DETAIL-CNT > 0                                     17210099
148800             PERFORM 7200-CRD-STK-TYP-ID-BREAK                    17220099
148900         END-IF                                                   17230099
149000       END-IF                                                     17240099
149100     END-PERFORM.                                                 17250099
149200                                                                  17260099
149300     PERFORM 7300-ALL-STORES-TOTALS.                              17270099
149400                                                                  17280099
149500                                                                  17290099
149600******************************************************************17300099
149700* 7100-PROCESS-DETAIL                                             17310099
149800******************************************************************17320099
149900                                                                  17330099
150000 7100-PROCESS-DETAIL.                                             17340099
150100                                                                  17350099
150200     IF PA-LINE-COUNT > 55                                        17360099
150300         PERFORM 8000-PRINT-HEADINGS                              17370099
150400         MOVE PV-HOLD-CRD-STK-TYP-ID TO DL1-STOCK-ID              17380099
150500     END-IF.                                                      17390099
150600                                                                  17400099
150700     COMPUTE DL1-NET-QTY =                                        17410099
150800             PT-TTL-IC-COUNT (PT-INDX1 PT-INDX2) -                17420099
150900             PT-TTL-VC-COUNT (PT-INDX1 PT-INDX2)                  17430099
151000     END-COMPUTE.                                                 17440099
151100                                                                  17450099
151200     COMPUTE DL1-NET-ISSUED =                                     17460099
151300             PT-TTL-IC-SUM (PT-INDX1 PT-INDX2) +                  17470099
151400             PT-TTL-VC-SUM (PT-INDX1 PT-INDX2)                    17480099
151500     END-COMPUTE.                                                 17490099
151600                                                                  17500099
151700     MOVE PT-PRE-DNNTD-CRD-AMT (PT-INDX1 PT-INDX2)                17510099
151800                                          TO DL1-DENOM.           17520099
151900                                                                  17530099
152000     MOVE PT-TTL-IC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-ISSUED.  17540099
152100     MOVE PT-TTL-IC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-ISSUED.  17550099
152200     MOVE PT-TTL-VC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-VOIDED.  17560099
152300     MOVE PT-TTL-VC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-VOIDED.  17570099
152400     MOVE PT-TTL-TC-COUNT (PT-INDX1 PT-INDX2) TO DL1-QTY-TENDERED.17580099
152500     MOVE PT-TTL-TC-SUM   (PT-INDX1 PT-INDX2) TO DL1-AMT-TENDERED.17590099
152600                                                                  17600099
152700     ADD  PT-TTL-IC-COUNT (PT-INDX1 PT-INDX2) TO PA-SI-QTY-ISSUED 17610099
152800                                                 PA-ST-QTY-ISSUED.17620099
152900     ADD  PT-TTL-IC-SUM   (PT-INDX1 PT-INDX2) TO PA-SI-AMT-ISSUED 17630099
153000                                                 PA-ST-AMT-ISSUED.17640099
153100     ADD  PT-TTL-VC-COUNT (PT-INDX1 PT-INDX2) TO PA-SI-QTY-VOIDED 17650099
153200                                                 PA-ST-QTY-VOIDED.17660099
153300     ADD  PT-TTL-VC-SUM   (PT-INDX1 PT-INDX2) TO PA-SI-AMT-VOIDED 17670099
153400                                                 PA-ST-AMT-VOIDED.17680099
153500     ADD  PT-TTL-TC-COUNT (PT-INDX1 PT-INDX2) TO                  17690099
153600                                               PA-SI-QTY-TENDERED 17700099
153700                                               PA-ST-QTY-TENDERED.17710099
153800     ADD  PT-TTL-TC-SUM   (PT-INDX1 PT-INDX2) TO                  17720099
153900                                               PA-SI-AMT-TENDERED 17730099
154000                                               PA-ST-AMT-TENDERED.17740099
154100     MOVE DETAIL-LINE1 TO REPORT-OUT.                             17750099
154200     IF DL1-STOCK-ID = SPACES                                     17760099
154300         MOVE 1 TO PV-SPACE-CONTROL                               17770099
154400     ELSE                                                         17780099
154500         MOVE 2 TO PV-SPACE-CONTROL                               17790099
154600     END-IF.                                                      17800099
154700     PERFORM 8100-WRITE-DETAIL.                                   17810099
154800     MOVE SPACES TO DL1-STOCK-ID.                                 17820099
154900                                                                  17830099
155000******************************************************************17840099
155100* CARD STOCK ID BREAK.  PRINT TOTALS IF THERE WAS MORE THAN ONE  *17850099
155200* DENOMINATION FOR THE CARD STOCK.  ALWAYS RESET CARD STOCK      *17860099
155300* TOTALS TO ZERO.                                                *17870099
155400******************************************************************17880099
155500 7200-CRD-STK-TYP-ID-BREAK.                                       17890099
155600                                                                  17900099
155700     IF PV-DETAIL-CNT > 1                                         17910099
155800         PERFORM 7210-WRITE-CRD-STK-TOTALS                        17920099
155900     END-IF.                                                      17930099
156000                                                                  17940099
156100     IF PA-LINE-COUNT > 55                                        17950099
156200         PERFORM 8000-PRINT-HEADINGS                              17960099
156300     ELSE                                                         17970099
156400         MOVE 1            TO PV-SPACE-CONTROL                    17980099
156500         MOVE SPACES       TO REPORT-OUT                          17990099
156600         PERFORM 8100-WRITE-DETAIL                                18000099
156700     END-IF.                                                      18010099
156800                                                                  18020099
156900     MOVE ZERO TO PA-SI-QTY-ISSUED                                18030099
157000                  PA-SI-AMT-ISSUED                                18040099
157100                  PA-SI-QTY-VOIDED                                18050099
157200                  PA-SI-AMT-VOIDED                                18060099
157300                  PA-SI-QTY-TENDERED                              18070099
157400                  PA-SI-AMT-TENDERED.                             18080099
157500                                                                  18090099
157600******************************************************************18100099
157700* PRINT THE CARD STOCK TOTAL LINE AFTER CHECKING IF A PAGE BREAK *18110099
157800* IS NEEDED.  IF THE CARD STOCK TOTAL IS PRINTED ON THE NEXT PAGE*18120099
157900* PUT THE CARD STOCK ID IN THE TOTAL DESCRIPTION.                *18130099
158000******************************************************************18140099
158100 7210-WRITE-CRD-STK-TOTALS.                                       18150099
158200                                                                  18160099
158300     IF PA-LINE-COUNT > 54                                        18170099
158400        PERFORM 8000-PRINT-HEADINGS                               18180099
158500        MOVE PV-HOLD-CRD-STK-TYP-ID                               18190099
158600                            TO DL1-STOCK-ID                       18200099
158700     ELSE                                                         18210099
158800         MOVE SUMMARY-LINE2 TO REPORT-OUT                         18220099
158900         MOVE 1 TO PV-SPACE-CONTROL                               18230099
159000         PERFORM 8100-WRITE-DETAIL                                18240099
159100         MOVE SPACES        TO DL1-STOCK-ID                       18250099
159200     END-IF.                                                      18260099
159300                                                                  18270099
159400     MOVE '       TOTAL'     TO DL1-DENOM-TEXT.                   18280099
159500     MOVE PA-SI-QTY-ISSUED   TO DL1-QTY-ISSUED.                   18290099
159600     MOVE PA-SI-AMT-ISSUED   TO DL1-AMT-ISSUED.                   18300099
159700     MOVE PA-SI-QTY-VOIDED   TO DL1-QTY-VOIDED.                   18310099
159800     MOVE PA-SI-AMT-VOIDED   TO DL1-AMT-VOIDED.                   18320099
159900     MOVE PA-SI-QTY-TENDERED TO DL1-QTY-TENDERED.                 18330099
160000     MOVE PA-SI-AMT-TENDERED TO DL1-AMT-TENDERED.                 18340099
160100                                                                  18350099
160200     COMPUTE DL1-NET-QTY =                                        18360099
160300             PA-SI-QTY-ISSUED -                                   18370099
160400             PA-SI-QTY-VOIDED                                     18380099
160500     END-COMPUTE.                                                 18390099
160600                                                                  18400099
160700     COMPUTE DL1-NET-ISSUED =                                     18410099
160800             PA-SI-AMT-ISSUED +                                   18420099
160900             PA-SI-AMT-VOIDED                                     18430099
161000     END-COMPUTE.                                                 18440099
161100                                                                  18450099
161200     MOVE DETAIL-LINE1 TO REPORT-OUT.                             18460099
161300     MOVE 1 TO PV-SPACE-CONTROL.                                  18470099
161400     PERFORM 8100-WRITE-DETAIL.                                   18480099
161500                                                                  18490099
161600******************************************************************18500099
161700* WRITE THE FINAL TOTAL LINE ON THE REPORT.                      *18510099
161800******************************************************************18520099
161900 7300-ALL-STORES-TOTALS.                                          18530099
162000                                                                  18540099
162100     IF PA-LINE-COUNT > 54                                        18550099
162200        PERFORM 8000-PRINT-HEADINGS                               18560099
162300     END-IF.                                                      18570099
162400                                                                  18580099
162500     MOVE 'ALL STORES TOTALS ===>'                                18590099
162600                             TO SL1-DESCRIPTION.                  18600099
162700     MOVE PA-ST-QTY-ISSUED   TO SL1-QTY-ISSUED.                   18610099
162800     MOVE PA-ST-AMT-ISSUED   TO SL1-AMT-ISSUED.                   18620099
162900     MOVE PA-ST-QTY-VOIDED   TO SL1-QTY-VOIDED.                   18630099
163000     MOVE PA-ST-AMT-VOIDED   TO SL1-AMT-VOIDED.                   18640099
163100     MOVE PA-ST-QTY-TENDERED TO SL1-QTY-TENDERED.                 18650099
163200     MOVE PA-ST-AMT-TENDERED TO SL1-AMT-TENDERED.                 18660099
163300                                                                  18670099
163400     COMPUTE SL1-NET-QTY =                                        18680099
163500             PA-ST-QTY-ISSUED -                                   18690099
163600             PA-ST-QTY-VOIDED                                     18700099
163700     END-COMPUTE.                                                 18710099
163800                                                                  18720099
163900     COMPUTE SL1-NET-ISSUED =                                     18730099
164000             PA-ST-AMT-ISSUED +                                   18740099
164100             PA-ST-AMT-VOIDED                                     18750099
164200     END-COMPUTE.                                                 18760099
164300                                                                  18770099
164400     MOVE 2             TO PV-SPACE-CONTROL.                      18780099
164500     MOVE SUMMARY-LINE1 TO REPORT-OUT.                            18790099
164600     PERFORM 8100-WRITE-DETAIL.                                   18800099
164700                                                                  18810099
164800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18820099
164900* 8000-PRINT-HEADINGS                                             18830099
165000* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18840099
165100                                                                  18850099
165200 8000-PRINT-HEADINGS.                                             18860099
165300*-------------------                                              18870099
165400                                                                  18880099
165500     MOVE 0 TO PA-LINE-COUNT.                                     18890099
165600                                                                  18900099
165700     MOVE 1 TO PV-SPACE-CONTROL.                                  18910099
165800     ADD 1 TO PA-PAGE-COUNT.                                      18920099
165900     MOVE PA-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    18930099
166000                                                                  18940099
166100     MOVE DP132O-STANDRD-HEADER-132-COLS TO REPORT-OUT.           18950099
166200     PERFORM 8300-WRITE-TOP.                                      18960099
166300                                                                  18970099
166400     MOVE HEADER-LINE1 TO REPORT-OUT.                             18980099
166500     PERFORM 8100-WRITE-DETAIL.                                   18990099
166600                                                                  19000099
166700     MOVE 2 TO PV-SPACE-CONTROL.                                  19010099
166710     IF CR-TIME-PERIOD = 'W' OR                                   19020099
166720        CR-TIME-PERIOD = 'M'                                      19030099
166800        MOVE HEADER-LINE2-W-M TO REPORT-OUT                       19040099
166801     ELSE                                                         19050099
166810        MOVE HEADER-LINE2-D TO REPORT-OUT                         19060099
166820     END-IF.                                                      19070099
166900     PERFORM 8100-WRITE-DETAIL.                                   19080099
167000                                                                  19090099
167100     MOVE HEADER-LINE3 TO REPORT-OUT.                             19100099
167200     PERFORM 8100-WRITE-DETAIL.                                   19110099
167300                                                                  19120099
167400     MOVE 1 TO PV-SPACE-CONTROL.                                  19130099
167500     MOVE HEADER-LINE4 TO REPORT-OUT.                             19140099
167600     PERFORM 8100-WRITE-DETAIL.                                   19150099
167700                                                                  19160099
167800     MOVE HEADER-LINE5 TO REPORT-OUT.                             19170099
167900     PERFORM 8100-WRITE-DETAIL.                                   19180099
168000                                                                  19190099
168100     MOVE 2 TO PV-SPACE-CONTROL.                                  19200099
168200                                                                  19210099
168300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19220099
168400* 8100-WRITE-DETAIL                                               19230099
168500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19240099
168600                                                                  19250099
168700 8100-WRITE-DETAIL.                                               19260099
168800*-----------------                                                19270099
168900                                                                  19280099
169000     WRITE REPORT-OUT                                             19290099
169100        AFTER ADVANCING PV-SPACE-CONTROL.                         19300099
169200                                                                  19310099
169300     ADD PV-SPACE-CONTROL TO PA-LINE-COUNT.                       19320099
169400                                                                  19330099
169500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19340099
169600* 8300-WRITE-TOP                                                  19350099
169700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19360099
169800                                                                  19370099
169900 8300-WRITE-TOP.                                                  19380099
170000*--------------                                                   19390099
170100                                                                  19400099
170200     WRITE REPORT-OUT AFTER ADVANCING PAGE.                       19410099
170300                                                                  19420099
170400     ADD PV-SPACE-CONTROL TO PA-LINE-COUNT.                       19430099
170500                                                                  19440099
170600* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19450099
170700* 9000-EOJ-ROUTINE - CLOSES ALL FILES ASSOCIATED WITH THE JOB     19460099
170800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19470099
170900                                                                  19480099
171000 9000-EOJ-ROUTINE.                                                19490099
171100*----------------                                                 19500099
171200                                                                  19510099
W3540C     IF ((CR-TIME-PERIOD NOT = 'W') AND                           19520099
W3540C         (CR-TIME-PERIOD NOT = 'M') AND                           19530099
W3540C         (CR-RESTART-IND NOT = 'R'))                              19540099
W3540C         OPEN OUTPUT CONTROL-TIMESTAMP-FILE                       19550099
W3540C         MOVE CR-CONTROL-END-TIMESTAMP     TO                     19560099
W3540C              CONTROL-CARD-END-DATE                               19561099
W3540C         MOVE PV-END-RANGE-TIMESTAMP-DET   TO                     19580099
W3540C              CONTROL-CARD-BEG-DATE                               19590099
W3540C         MOVE CR-RESTART-IND               TO                     19600099
W3540C              RESTART-INDICATOR                                   19610099
W3540C                                                                  19620099
W3540C         WRITE CONTROL-TIMESTAMP-RECORD                           19630099
W3540C                           FROM WRITE-CONTROL-CARD                19640099
W3540C         DISPLAY ' '                                              19650099
W3540C         DISPLAY 'UPDATED DATE AND TIME IN CONTROL CARD: '        19660099
W3540C         DISPLAY 'BEGIN TIMESTAMP   : ' CONTROL-CARD-BEG-DATE     19670099
W3540C         DISPLAY 'END TIMESTAMP     : ' CONTROL-CARD-END-DATE     19680099
W3540C         DISPLAY 'RESTART INDICATOR : ' RESTART-INDICATOR         19690099
W3540C         CLOSE CONTROL-TIMESTAMP-FILE                             19691099
W3540C     END-IF.                                                      19700099
079100                                                                  19740099
171300     PERFORM 9010-CLOSE-LOC-CSR.                                  19750099
171400     PERFORM 9020-CLOSE-ISSUE-CSR.                                19760099
171500     PERFORM 9030-CLOSE-VOID-CSR.                                 19770099
171600     PERFORM 9040-CLOSE-TENDER-CSR.                               19780099
171700                                                                  19790099
171800     CLOSE GFTCRD-REPORT.                                         19800099
171900                                                                  19810099
172000 9010-CLOSE-LOC-CSR.                                              19820099
172100                                                                  19830099
172200     EXEC SQL                                                     19840099
172300       CLOSE LOC-CSR                                              19850099
172400     END-EXEC.                                                    19860099
172500                                                                  19870099
172600     EVALUATE SQLCODE                                             19880099
172700       WHEN ZERO                                                  19890099
172800           CONTINUE                                               19900099
172900       WHEN OTHER                                                 19910099
173000           DISPLAY ' '                                            19920099
173100           DISPLAY '** ABEND     **'                              19930099
173200           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          19940099
173300           DISPLAY '** PARAGRAPH **  = 9010-CLOSE-LOC-CSR'        19950099
173400           DISPLAY '** CLOSE LOC-CSR'                             19960099
173500           PERFORM 9100-SQL-ABEND                                 19970099
173600     END-EVALUATE.                                                19980099
173700                                                                  19990099
173800 9020-CLOSE-ISSUE-CSR.                                            20000099
173900                                                                  20010099
174000     EXEC SQL                                                     20020099
174100       CLOSE ISSUED-CSR                                           20030099
174200     END-EXEC.                                                    20040099
174300                                                                  20050099
174400     EVALUATE SQLCODE                                             20060099
174500       WHEN ZERO                                                  20070099
174600           CONTINUE                                               20080099
174700       WHEN OTHER                                                 20090099
174800           DISPLAY ' '                                            20100099
174900           DISPLAY '** ABEND     **'                              20110099
175000           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          20120099
175100           DISPLAY '** PARAGRAPH **  = 9020-CLOSE-ISSUED-CSR'     20130099
175200           DISPLAY '** CLOSE ISSUED-CSR'                          20140099
175300           PERFORM 9100-SQL-ABEND                                 20150099
175400     END-EVALUATE.                                                20160099
175500                                                                  20170099
175600 9030-CLOSE-VOID-CSR.                                             20180099
175700                                                                  20190099
175800     EXEC SQL                                                     20200099
175900       CLOSE VOID-CSR                                             20210099
176000     END-EXEC.                                                    20220099
176100                                                                  20230099
176200     EVALUATE SQLCODE                                             20240099
176300       WHEN ZERO                                                  20250099
176400           CONTINUE                                               20260099
176500       WHEN OTHER                                                 20270099
176600           DISPLAY ' '                                            20280099
176700           DISPLAY '** ABEND     **'                              20290099
176800           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          20300099
176900           DISPLAY '** PARAGRAPH **  = 9030-CLOSE-ISSUED-CSR'     20310099
177000           DISPLAY '** CLOSE VOID-CSR'                            20320099
177100           PERFORM 9100-SQL-ABEND                                 20330099
177200     END-EVALUATE.                                                20340099
177300                                                                  20350099
177400 9040-CLOSE-TENDER-CSR.                                           20360099
177500                                                                  20370099
177600     EXEC SQL                                                     20380099
177700       CLOSE TENDERED-CSR                                         20390099
177800     END-EXEC.                                                    20400099
177900                                                                  20410099
178000     EVALUATE SQLCODE                                             20420099
178100       WHEN ZERO                                                  20430099
178200           CONTINUE                                               20440099
178300       WHEN OTHER                                                 20450099
178400           DISPLAY ' '                                            20460099
178500           DISPLAY '** ABEND     **'                              20470099
178600           DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME          20480099
178700           DISPLAY '** PARAGRAPH **  = 9040-CLOSE-TENDER-CSR'     20490099
178800           DISPLAY '** CLOSE TENDERED-CSR'                        20500099
178900           PERFORM 9100-SQL-ABEND                                 20510099
179000     END-EVALUATE.                                                20520099
179100                                                                  20530099
179200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20540099
179300* 9100-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      20550099
179400* EVENT THAT AN SQL ERROR CODE OCCURS.                            20560099
179500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20570099
179600                                                                  20580099
179700 9100-SQL-ABEND.                                                  20590099
179800                                                                  20600099
179900     DISPLAY ' '.                                                 20610099
180000     DISPLAY '9100-SQL-ABEND'.                                    20620099
180100     DISPLAY '**  ABEND     **'.                                  20630099
180200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               20640099
180300     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             20650099
180400     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    20660099
180500                                                                  20670099
180600*                                                                 20680099
180700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    20690099
180800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         20700099
180900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     20710099
181000* FORMAT.                                                         20720099
181100*                                                                 20730099
181200     COPY DPPD004.                                                20740099
181300                                                                  20750099
181400     SET ABEND-4013-DB2-ERROR TO TRUE.                            20760099
181500     CALL 'ILBOABN0' USING ABEND-CODE.                            20770099
