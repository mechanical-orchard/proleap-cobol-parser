000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUP202.                                        00020000
000300 AUTHOR.         M WILKINSON.                                     00030000
000400*DATE-WRITTEN.   JUNE 6,1994.                                     00040000
000500*DATE-COMPILED.                                                   00050000
000600****************************************************************  00060000
000700* COBOL II WITH SQL                                            *  00070000
000800*--------------------------------------------------------------*  00080000
000900* EDI INVOICE ADD PROGRAM                                      *  00090000
001000*--------------------------------------------------------------*  00100000
001100* INPUT:                                                       *  00110000
001200*  1. ALLOWANCE CHARGE TABLE                     (TALCHRG)     *  00120000
001300*  2. INVOICE TERMS TABLE                        (TINVCTM)     *  00130000
001400*  3. INVOICE TABLE                              (TINVOIC)     *  00140000
001500*  4. MERCHANDISE INVOICE TABLE                  (TMDINVC)     *  00150000
001600*  5. MERCHANDISE INVOICE ITEM TABLE             (TMIITEM)     *  00160000
001700*  6. PAYMENT REQUEST ITEM TABLE                 (TPREQIT)     *  00170000
001800*  7. VENDOR SUPPLIED INVOICE ITEM DATA TABLE    (TVNDINV)     *  00180000
001900*  8. CHECKPOINT RESTART CONTROL TABLE           (TCKRSTCNTL)  *  00190000
002000*  9. CHECKPOINT RESTART INFORMATION TABLE       (TCKRSTINF)   *  00200000
002100* 10. EDI EDITED AND VALIDATED INVOICE RECORDS   (APRD052)     *  00210000
002200*                                                              *  00220000
002300* OUTPUT:                                                      *  00230000
002400*  1. REPORT OF TOTALS                                         *  00240000
002500*--------------------------------------------------------------*  00250000
002600* CHANGE LOG:                                                     00260000
002700*                                                                 00270000
002800* 06/06/94     INITIAL VERSION.                                   00280000
002900*                                                                 00290000
003000* 06/04/96 DSW ADDED CODE TO HARDCODE DEFAULT VALUES FOR          00300000
003100*              CALC_DUE_DTE AND DUE_DTE_SRC_CDE WHEN              00310000
003200*              INSERTING RECORDS INTO TINVOIC.                    00320000
003300*                                                                 00330000
003400* 08/25/97  MOD THE LOGIC IN D400-MOVE-REC06 WHICH SETS UP THE ROW00340000
003500*           TO INSERT TO TINVOIC TO PUT VALUES IN THE 2 NEW COLUMN00350000
003600*           AS FOLLOWS: INVOIC-PPD-RVRSL-IND WILL BE SET TO "N"   00360000
003700*           AND INVOIC-INVC-NET-COST-AMT WILL GET                 00370000
003800*           THE SAME VALUE AS THE INVOIC-GRO-COST-AMT.            00380000
003900*           MODIFIED THE LOGIC WHICH INSERTS ROWS TO TMDINVC TO   00390000
004000*           INITIALIZE THE NEW COL MDINVC-IMPRT-CHRG-PRC-CDE TO   00400000
004100*           SPACES.                                               00410000
004200*           BY:  MIKE BESKE                   WR/PIT 4164         00420000
004300*                                                                 00430000
004400* 09/29/97  ADDED LOGIC TO MOVE '1ST' INTO IMPRT CHRG PRC CDE IF  00440000
004500*           THE INPUT VENDOR NUMBER INDICATES AN IMPORT VENDOR.   00450000
004600*           BY:  MARY KING                    WR/PIT 4164         00460000
004700*                                                                 00470000
004800* 10/28/97  CHANGED THE INITIAL VALUE OF PPD-RVRSL-IND TO SPACE   00480000
004900*           ON INSERTS TO TINVOIC, EXCEPT WHEN VENDOR IS IMPORT,  00490000
005000*           THEN IT WILL CONTINUE TO BE INITIALIZED TO 'N'.       00500000
005100*           BY:  NANCY EILBES                 WR/PIT 4164         00510000
005200*                                                                 00520000
005300* 12/10/97  MODIFIED THE LOGIC TO HANDLE THE NEW CHANGES TO INVOIC00530000
005400*           TERMS PROCESSING.  CLEANED UP SOME OF THE VARIOUS     00540000
005500*           EXISTING PARAGRAPHS TO MEET CURRENT PROGRAMMING STAND-00550000
005600*           ARDS AND FOR EASIER READABILITY (PARAS - A100,C100).  00560000
005700*           ALSO CHANGED THE '++INCLUDE' STATEMENTS TO 'COPY' IN  00570000
005800*           ACCORDANCE WITH Y2K.  C100- PARAGRAPH WAS BROKEN DOWN 00580000
005900*           TO DO PERFORMS OF THE VARIOUS DB2 TABLE INSERTS.  NEW 00590000
006000*           PARAGRAPHS WERE CREATED TO DO THE ACTUAL FIELD MOVES  00600000
006100*           (F100-, F200-, F300-, F500-, F600-, F700-, F800, F810,00610000
006200*            F820-) AND THE DB2 COMMIT WAS PLACED IN A SEPARATE   00620000
006300*           PARAGRAPH (Y100-) ALSO.  ADDED A 'COPY REPLACING' FOR 00630000
006400*           THE WS-WORK-REC.  THIS WILL ELIMINATE THE NEED TO HAVE00640000
006500*           THE PHRASE 'OF WS-WORK-REC' WHENEVER REFERRING TO THE 00650000
006600*           APRD052 COPYBOOK FOR THE OUTPUT LAYOUT.  THE SAME     00660000
006700*           COPYBOOK IS USED FOR THE INPUT LAYOUT ALSO.  BECAUSE  00670000
006800*           OF THE 'REPLACING' CLAUSE, THE 'OF AP052-EDI-IN-FILE' 00680000
006900*           CAN ALSO BE ELIMINATED.  THIS WILL MAKE THE CODE ALOT 00690000
007000*           CLEANER TO READ.                                      00700000
007100*           BY:  MIKE BESKE                   WR/PIT 5091         00710000
007200*                                                                 00720000
007300* 02/13/98  ADDED DISPLAYS FOR PO NUMBER PAYT-REQ-SEQ-NBR AND PAYT00730000
007400*           REQ-LNE-NBR IN Z999-SQL-ERROR TO HELP IN DEBUGGING    00740000
007500*           ABENDS.  MOVED THE PERFORM F820-FILL-VNDINV TO BE DONE00750000
007600*           AFTER I800-INSERT-MIITEM-PO-LNE AND                   00760000
007700*           I850-INSERT-MIITEM-NO-PO-LNE DUE TO A FOREIGN KEY     00770000
007800*           RELATION BETWEEN MIITEM AND VNDINV.                   00780000
007900*           BY:  MIKE BESKE                   WR/PIT 5091         00790000
008000*                                                                 00800000
008100* 07/08/98  Y2K. ADD WINDOW LOGIC TO CALCULATE CENTURY FOR VALID  00810000
008200*           DATE IN H100-HOUSEKEEPING, D100-MOVE-REC01,           00820000
008300*           D200-MOVE-REC02, & F500-FILL-INVCTM.                  00830000
008400*           BY:  CAROLYN GIFFORD              WR/IR #:6041        00840000
008500*                                                                 00850000
008600* 01/11/99  MODIFIED CODE TO ALWAYS MOVE THE EAN-CODE TO THE      00860000
008700*           VNDINV-UPC-EAN-CDE.  CHANGE WAS MADE BECAUSE THE      00870000
008800*           UPC WAS BEING TRUNCATED.                              00880000
008900*           BY:  ROBIN BERNOSKI               WR/IR #:            00890000
009000*                                                                 00900000
009100* 11/30/99  INCREASED THE WS-R07-MAX TO 11000 AND WS-R05-MAX TO   00910000
009200*           5000.  THIS WILL BE TEMPORARY UNTIL AFTER THE HOLIDAY 00920000
009300*           SEASON.  THE CORRESPONDING INDEXES R07-INDX AND       00930000
009400*           R05-INDX WERE INCREASED BY A LIKE AMOUNT.             00940000
009500*           BY:  MIKE BESKE                   WR/IR #: 331480     00950000
009600*                                                                 00960000
009700* 02/02/2000 RECOMPILED PROGRAM. CHANGES WERE MADE TO APRD050,    00970000
009800*            APRD051, APRD052, AND APRD056 BY THE EDI TEAM.       00980000
009900*            BY:  JILL JUEL                    WR#: 20626         00990000
010000*                                                                 01000000
010100* 11/08/2001 ADDED DB2 CHECKPOINT RESTART LOGIC TO REPLACE THE    01010000
010200*            PREVIOUSLY USED CONTROL CARD RESTART LOGIC.  THIS    01020000
010300*            CONTROL CARD LOGIC HAD PROBLEMS WITH RESTARTING WHEN 01030000
010400*            THE PROGRAM HAD BEEN FORCED TO ABEND BY THE OPERATOR 01040000
010500*            (S222).  CHECKPOINT RESTART WILL NOT HAVE ANY PROBLEM01050000
010600*            RESTARTING THE PROGRAM WHATEVER THE CAUSE OF THE     01060000
010700*            ABEND.                                               01070000
010800*            BY: MIKE BESKE                    WR#: 21654         01080000
010900*                                                                 01090000
011000* 12/05/2001 CORRECTED THE DISPLAYS IN THE ABEND PARAGRAPH TO     01100000
011100*            SHOW THE CORRECT VALUES OF THE INVOICE THAT THE ABEND01110000
011200*            OCCURED ON.                                          01120000
011300*            BY: MIKE BESKE                  PITS#:PM00435881     01130000
011400*                                                                 01140000
011500* 06/16/2002 ARK PO PROJECT PHASE 1.  ELIMINATED ALL REFERENCES TO01150000
011600*            TABLE TINCEDI AND INIT_INVC_ID.  ADDED LOGIC TO      01160000
011700*            POPULATE NEW COLUMNS FOR TABLES TINVOIC AND TMDINVC. 01170000
011800*            ADDED NEW COLUMNS AND SEQUENCE ON THE INSERTS TO     01180000
011900*            TINVOIC AND TMDINVC.  PARAGRAPHS MODIFIED ARE D100,  01190000
012000*            D300, F200, I200, AND I300.                          01200000
012100*            MADE BY:  KEVIN CATLIN           WR/IR #: 23500      01210000
012200*                                                                 01220000
012300* 07/01/2002 ARK PO PROJECT PHASE 3 - PRELIMINARY CHANGE TO STOP  01230000
012400*            PERPETUATING UNNECESSARY INSERTS TO TABLE TVNDINV.   01240000
012500*            MODIFIED PARAGRAPH  F800-FILL-MISC-TABLES SO THAT THE01250000
012600*            INSERTS TO TVNDINV ARE ONLY PERFORMED WHEN THE PO    01260000
012700*            LINE NUMBER IS ZERO.                                 01270000
012800*            MADE BY:  NANCY EILBES           WR/IR #: 23500      01280000
012900*                                                                 01290000
013000* 09/09/2002 ARK PO PROJECT PHASE 2 - PROGRAM NOW USES THE PO     01300000
013100*            NUMBER AND INVOICE ID IN PLACE OF THE PAYMENT        01310000
013200*            REQUEST SEQUENCE NUMBER BECASE IT IS BEING OBSOLETED.01320000
013300*            PO_NBR AND INVC_ID WERE ADDED TO THE SQL IN PARAS    01330000
013400*            I500, I600 AND J100.  THE PO NUMBER AND INVOICE IDS  01340000
013500*            WERE MOVED TO THE CORRECT COPY BOOK VARS IN D100 AND 01350000
013600*            REMOVED FROM PARAGRAPH R200.                         01360000
013700*            ALSO, ANY REFERENCES TO THE APWS900 COPY BOOK WAS    01370000
013800*            REMOVED BECAUSE IT IS NO LONGER SUPPORTED.           01380000
013900* MADE BY: BRIAN HASSLINGER                         WR/IR #:23500 01390000
014000*                                                                 01400000
014100* DATE  05/16/2003                                                01410000
014200*     CHANGE MADE: NI-SKU PROJECT.                                01420000
014300*     MODIFIED CODE IN PARA F820- TO MOVE THE KOHLS-SKU TO A W/S  01430000
014400*     SKU DEFINED AS PIC X(8).  THIS FIELD WILL BE REDEFINED TO   01440000
014500*     SPLIT THE SKU INTO THE PRE-NI SKU BREAKDOWN SO THAT IT CAN  01450000
014600*     BE LOADED ON TVNDINV.  THIS WILL ALLOW US TO KEEP THE EDI   01460000
014700*     SENT SKU UNTIL TVNDINV IS ALTERED LATER ON AS A CONTINUING  01470000
014800*     PROCESS OF ARK PO.                                          01480000
014900*     MADE BY: MIKE BESKE              WR/IR #: WR22557           01490000
015000*                                                                 01500000
015100* DATE  07/22/2003                                                01510000
015200*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                   01520000
015300*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).                  01530000
015400*     MADE BY: MIKE BESKE              WR/IR #: WR24685           01540000
015500*                                                                 01550000
015600* DATE  09/13/2003                                                01560000
015700*     CHANGE MADE: ADDED LOGIC TO ADD A LEADING ZERO TO THE UPC   01570000
015800*     NUMBER BEFORE INSERTING TO TVNDINV IN F820-FILL-VNDINV. THIS01580000
015900*     WAS NECESSARY BECAUSE PROGRAM APKED201 IS NO LONGER ADDING  01590000
016000*     THIS LEADING ZERO BECAUSE IT WAS CAUSING PROBLEMS WITH THE  01600000
016100*     RECYCLED INVOICES.                                          01610000
016200*     MADE BY: NANCY EILBES            WR/IR #: PM000586320       01620000
016300*                                                                 01630000
016400* DATE  03/29/2004                                                01640000
016500*     CHANGE MADE: INCREASED THE SIZE OF VARIOUS W/S STORE NUMBER 01650000
016600*     FIELDS FROM 3 TO 5.                                         01660000
016700*     MADE BY: MIKE BESKE              WR/IR #: 25805             01670000
016800*                                                                 01680000
016900* DATE  08/09/2006                                                01690000
017000*     CHANGE MADE: TEMP INCREASED THE R07-INDX AND WS-R07-MAX     01700000
017100*     INDEX LIMITS FROM 11000 TO 21000 TO SOLVE A PROD ABEND.     01710000
017200*     MADE BY: MIKE BESKE              WR/IR #: PM00909888        01720000
017300*                                                                 01730000
017400* DATE  08/09/2006                                                01740000
017500*     CHANGE MADE: TEMP DECREASED THE R07-INDX AND WS-R07-MAX     01750000
017600*     INDEX LIMITS FROM 21000 TO 11000 TO SOLVE A PROD ABEND.     01760000
017700*     MADE BY: TIGHE BRONAUGH          WR/IR #: PM00909888        01770000
017800*                                                                 01780000
017900* DATE  10/16/2006                                                01790000
017910*     CHANGE MADE: REMOVED ALL REFERENCES TO THE DB2 TABLE        01791000
017920*     TAUDINC. REVERSED LOGIC TO INSERT INTO TINVOIC (F200) BEFORE01792000
017930*     INSERT TO TPAYREQ (F100). THIS ALSO REQUIRED THE CHANGE TO  01793000
017940*     DETERMINE A RANDOM PAYT-REQ-SEQ-NBR WHEN A -803 RETURN CODE 01794000
017941*     RESULTS IN THE TINVOIC INSERT RATHER THAN IN TPAYREQ INSERT.01794100
017942*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR30042           01794200
017943*                                                                 01794300
017944* DATE  12/01/2006                                                01794400
017945*     CHANGE MADE: ADDED THE VARIABLE CONSTANTS                   01794500
017946*     PC-LOWER-CASE-LETTERS AND PC-UPPER-CASE-LETTERS TO WORKING  01794600
017947*     STORAGE.  ALSO ADDED LOGIC TO PARAGRAPH D100-MOVE-REC01 TO  01794700
017948*     INSPECT THE AP052-VENDOR-INVOICE-NBR FIELD AND CONVERT ANY  01794800
017949*     LOWERCASE LETTERS INTO UPPERCASE LETTERS BEFORE INSERTING   01794900
017950*     INTO THE TINVOIC TABLE.  THIS WILL ELIMINATE INSTANCES OF   01795000
017951*     INVOICES NOT MATCHING.                                      01795100
017952*     MADE BY: KRYSTEN LEARY          WR/IR #: WR31180            01795200
017953*                                                                 01795300
017954* DATE  01/02/2007                                                01795400
017955*     CHANGE MADE: MODIFIED RETRY COUNTER IN PARAGRAPH I200-      01795500
017956*     FOR THE INVOICE INSERT SO THAT IT WOULD BE DIFFERENT FROM   01795600
017957*     NORMAL COUNTER USED THROUGH THE REST OF APKUP202.  THIS WAS 01795700
017958*     DONE BECAUSE THE CALL TO R200- WAS ACTUALLY OVER-WRITING THE01795800
017959*     RETRY COUNTER FROM THE INVOICE INSERT AS R200- PROCESSED FOR01795900
017960*     A NEW PAY REQ SEQ NUMBER.                                   01796000
017961*     MADE BY: ROLF NOHE               WR/IR #: PM00966086        01796100
017962*                                                                 01796200
017963* DATE  01/25/2007                                                01796300
017964*     CHANGE MADE: REMOVED ALL REFERENCES OF TABLE TPAYREQ FROM   01796400
017965*     THE PROGRAM (INCLUDED DELETING THE PARAGRAPHS               01796500
017966*     I100-INSERT-PAYREQ AND F100-FILL-PAYREQ).  ALSO CHANGED ALL 01796600
017967*     INSTANCES OF PAYREQ-REMIT-TO-DUN-NBR TO BE                  01796700
017968*     INVOIC-RMIT-VND-ID WHERE COMPARISON LOGIC WAS USED IN       01796800
017969*     PARAGRAPHS F600-FILL-MDINVC AND D400-MOVE-REC06.            01796900
017970*     MADE BY: KRYSTEN LEARY           WR/IR #: WR31939           01797000
017971*                                                                 01797100
017972* DATE  03/11/2007                                                01797201
017973*     CHANGE MADE: MATCH BY DC -- ADDED THE FIELDS WS-DC-NBR,     01797300
017974*     WS-MTCH-LVL, AND WS-SAVE-MTCH-LVL TO WORKING STORAGE.       01797400
017975*     CHANGED ALL INSTANCES OF PV-STORE-NBR TO PV-MTCH-LVL ALONG  01797500
017976*     WITH ALL INSTANCES OF CR-STORE-NBR TO CR-MTCH-LVL.  ALSO    01797600
017977*     CHANGED ALL REFERENCES OF AP052-SORT-STORE TO               01797700
017978*     AP052-SORT-MTCH-LVL AND WS-SAVE-STORE TO WS-SAVE-MTCH-LVL.  01797800
017979*     IN PARAGRAPH X200-CHECKPOINT-RESTART, ALTERED THE LOGIC TO  01797900
017980*     USE THE MATCH LEVEL INSTEAD OF THE STORE NUMBER WHEN READING01798000
017981*     THE INPUT FILE TO FIND THE RESTART RECORD.  IN PARAGRAPH    01798100
017982*     D200-MOVE-REC02, ADDED LOGIC TO VALIDATE AND MOVE THE       01798200
017983*     AP052-KOHLS-DC-TO-USE AND AP052-KOHLS-MTCH-LVL-TO-USE FIELDS01798300
017984*     TO THE INVOIC-DC-NBR AND INVOIC-MTCH-LVL-CDE FIELDS         01798400
017985*     RESPECTIVELY.  LASTLY, ADDED THE FIELDS DC_NBR AND          01798500
017986*     MTCH_LVL_CDE TO THE INSERT STATEMENT IN PARAGRAPH           01798600
017987*     I200-INSERT-INVOIC.                                         01798700
017988*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578           01798800
017989*                                                                 01798902
017990* DATE  11/08/2014                                                01799002
018000*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                     01799102
018100*     EXTENDED PO# FROM 7 TO 9                                    01799202
018101*     MADE BY: COGNIZANT               WR/IR #: CHG0094517        01799302
017989*                                                                 01799406
017990* DATE  03/16/2023                                                01799509
018000*     CHANGE MADE: POPULATE IMPRT_CHRG_PRC_CDE FOR DIRECT         01799606
018100*                  IMPORTERS WITH '1NX'                           01799706
018101*     MADE BY: JEAN KURK               WR/IR #: CHG0285404        01799809
018102******************************************************************01799900
018103                                                                  01800000
018104 ENVIRONMENT DIVISION.                                            01800100
018105                                                                  01800200
018106 INPUT-OUTPUT SECTION.                                            01800300
018107                                                                  01800400
018108 FILE-CONTROL.                                                    01800500
018109                                                                  01800600
018110     SELECT EDIIN-AP052-FILE ASSIGN TO INP01.                     01800700
018111                                                                  01800800
018112     SELECT TOT-REPORT       ASSIGN TO RPT01.                     01800900
018113                                                                  01801000
018114 DATA DIVISION.                                                   01810000
018200                                                                  01820000
018300 FILE SECTION.                                                    01830000
018400                                                                  01840000
018500 FD  EDIIN-AP052-FILE                                             01850000
018600     RECORDING MODE IS  F                                         01860000
018700     LABEL RECORDS  ARE STANDARD                                  01870000
018800     RECORD CONTAINS 350 CHARACTERS                               01880000
018900     BLOCK CONTAINS 0 RECORDS                                     01890000
019000     DATA RECORD IS EDIIN-AP052-RECORD.                           01900000
019100 01  EDIIN-AP052-RECORD               PIC X(350).                 01910000
019200                                                                  01920000
019300 FD  TOT-REPORT                                                   01930000
019400     RECORDING MODE IS F                                          01940000
019500     LABEL RECORDS ARE STANDARD                                   01950000
019600     RECORD CONTAINS 132 CHARACTERS                               01960000
019700     BLOCK CONTAINS 0 RECORDS                                     01970000
019800     DATA RECORD IS TOT-LINE.                                     01980000
019900 01  TOT-LINE                         PIC X(132).                 01990000
020000                                                                  02000000
020100 WORKING-STORAGE SECTION.                                         02010000
020200                                                                  02020000
020300 01  FILLER                           PIC X(25) VALUE             02030000
020400                             'WS FOR APKUP202 BEGINS==>'.         02040000
020500 01  ABEND-CODE                       PIC S9(4) COMP SYNC         02050000
020600                                             VALUE ZEROS.         02060000
020700     88 AP-TABLE-FULL              VALUE +4004.                   02070000
020800     88 AP-EMPTY-FILE              VALUE +4005.                   02080000
020900     88 AP-DB2-ERROR               VALUE +4013.                   02090000
021000                                                                  02100000
021100 01  WS-NULLS-INDICATORS.                                         02110000
021200     05  WS-MIITEM-VER-NBR-NULL       PIC S9(4) COMP VALUE ZERO.  02120000
021300     05  WS-MIITEM-PO-LNE-NBR-NULL    PIC S9(4) COMP VALUE ZERO.  02130000
021400                                                                  02140000
021500 01  WS-RETRY-COUNTER                 PIC S9(4) COMP VALUE ZERO.  02150000
021600 01  WS-INSERT-INVC-RETRY-COUNTER     PIC S9(4) COMP VALUE ZERO.  02160000
021700 01  WS-DISPLAY-RETRY-COUNTER         PIC 9(9)  VALUE ZEROS.      02170000
021800 01  WS-ABEND-FILEDS.                                             02180000
021900     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP202'. 02190000
022000     05  WS-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     02200000
022100     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     02210000
022200     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     02220000
022300     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     02230000
022400     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     02240000
022500     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     02250000
022600                                                                  02260000
022700 01  WS-TIMESTAMP                     PIC X(26) VALUE SPACES.     02270000
022800 01  FILLER REDEFINES WS-TIMESTAMP.                               02280000
022900     05  FILLER                       PIC X(14).                  02290000
023000     05  WS-MINUTE                    PIC X(02).                  02300000
023100     05  FILLER                       PIC X(02).                  02310000
023200     05  WS-SECOND                    PIC X(01).                  02320000
023300     05  FILLER                       PIC X(01).                  02330000
023400     05  WS-NANOSEC-1-3               PIC X(03).                  02340000
023500     05  WS-NANOSEC-4-6               PIC X(03).                  02350000
023600                                                                  02360000
023700 01  WS-RANDOM-KEY                    PIC 9(09) VALUE 0.          02370000
023800 01  FILLER REDEFINES WS-RANDOM-KEY.                              02380000
023900     05  WS-RND-NANOSEC-4-6           PIC X(03).                  02390000
024000     05  WS-RND-NANOSEC-1-3           PIC X(03).                  02400000
024100     05  WS-RND-MINUTE                PIC X(02).                  02410000
024200     05  WS-RND-SECOND                PIC X(01).                  02420000
024300                                                                  02430000
024400 01  WS-RANDOM-KEY-COMP               PIC S9(09) VALUE 0 COMP.    02440000
024500                                                                  02450000
024600 01  WS-WORK-AREA.                                                02460000
024700     05  WS-PO-NBR                    PIC 9(9)  VALUE ZEROS.      02470000
024800     05  WS-STORE-NBR                 PIC X(5)  VALUE SPACES.     02480000
024900     05  PV-PO-NBR                    PIC 9(9)  VALUE ZEROS.      02490000
025000     05  PV-MTCH-LVL                  PIC X(1)  VALUE SPACES.     02500000
025000     05  PV-NEXUS-INVC                PIC X(01) VALUE SPACES.     02501008
025000         88 PV-NEXUS-INVC-YES         VALUE 'Y'.                  02502008
025000         88 PV-NEXUS-INVC-NO          VALUE 'N'.                  02503008
025100     05  PV-INVC-ID                   PIC X(22) VALUE SPACES.     02510000
025200     05  PV-INVOICE-COUNT             PIC 9(9)  VALUE ZEROS.      02520000
025300     05  PV-PROGRAM-NAME              PIC X(08) VALUE 'APKUP202'. 02530000
025400     05  PV-CKPT-STAT-CODE            PIC X(01) VALUE SPACE.      02540000
025500     05  PV-8V99                      PIC Z(8).99.                02550000
025600     05  PV-8V99-X REDEFINES                                      02560000
025700         PV-8V99                      PIC X(11).                  02570000
025800     05  PV-8V99-SIGN                 PIC -Z(8).99.               02580000
025900     05  PV-8V99-SIGN-X REDEFINES                                 02590000
026000         PV-8V99-SIGN                 PIC X(12).                  02600000
026100                                                                  02610000
026200     05  WS-MAX-RETRIES               PIC S9(4) COMP VALUE +3.    02620000
026300     05  WS-R04-MAX                   PIC 9(4)  VALUE 25.         02630000
026400     05  WS-R05-MAX                   PIC 9(4)  VALUE 5000.       02640000
026500     05  WS-R07-MAX                   PIC 9(5)  VALUE 11000.      02650000
026600                                                                  02660000
026700     05  WS-IMPORT-DUN-NBR            PIC X(09) VALUE             02670000
026800                                                   '009206194'.   02680000
026900     05  WS-IMPORT-CHRG-PRC-CDE       PIC X(09) VALUE '1ST'.      02690000
026900     05  WS-DIRECT-IMPORT-PRC-CDE     PIC X(09) VALUE '1NX'.      02691005
027000                                                                  02700000
027100     05  WS-TOT-NO-PAY-REQ-ADDED      PIC S9(11) VALUE 0.         02710000
027200     05  WS-TOT-GROSS-COST-ADDED      PIC S9(09)V99 VALUE 0.      02720000
027300                                                                  02730000
027400     05  WS-SAVE-PO-NBR               PIC S9(9) COMP VALUE ZEROS. 02740000
027500     05  WS-SAVE-STORE-NBR            PIC X(5)  VALUE SPACES.     02750000
027600     05  WS-SAVE-INVOICE-NBR          PIC X(22) VALUE SPACES.     02760000
027700     05  WS-SAVE-MTCH-LVL             PIC X(01) VALUE SPACE.      02770000
027800     05  WS-PAYT-REQ-SEQ-NBR          PIC S9(9) COMP VALUE ZEROS. 02780000
027900     05  WS-PAYT-REQ-LNE-NBR          PIC S9(9) COMP VALUE ZEROS. 02790000
028000     05  WS-PAYT-REQ-LNE-NBR-UNPK     PIC 9(18) VALUE ZEROS.      02800000
028100     05  WS-TERMS-SEQ-NBR             PIC S9(4) COMP VALUE ZEROS. 02810000
028200     05  WS-ALW-CHRG-SEQ-NBR          PIC S9(4) COMP VALUE ZEROS. 02820000
028300     05  WS-ALLW-CHRG-PCT             PIC SV9(04) COMP-3 VALUE +0.02830000
028400     05  WS-DC-NBR                    PIC 9(05) VALUE ZEROS.      02840000
028500     05  WS-MTCH-LVL                  PIC X(01) VALUE SPACES.     02850000
028600                                                                  02860000
028700     05  WS-SAVE-CURRENT-DATE.                                    02870000
028800         10  WS-SAVE-CURRENT-CC       PIC X(02) VALUE ZEROS.      02880000
028900         10  WS-SAVE-CURRENT-YY       PIC X(02) VALUE ZEROS.      02890000
029000         10  FILLER                   PIC X(01) VALUE '-'.        02900000
029100         10  WS-SAVE-CURRENT-MM       PIC X(02) VALUE ZEROS.      02910000
029200         10  FILLER                   PIC X(01) VALUE '-'.        02920000
029300         10  WS-SAVE-CURRENT-DD       PIC X(02) VALUE ZEROS.      02930000
029400                                                                  02940000
029500     05  WS-KOHLS-SKU-X               PIC X(8).                   02950000
029600     05  WS-KOHLS-SKU-RED REDEFINES WS-KOHLS-SKU-X.               02960000
029700         10  WS-DEPT-NBR              PIC X(03).                  02970000
029800         10  WS-CL-CDE                PIC X(02).                  02980000
029900         10  WS-SKU-SEQ-NBR           PIC X(03).                  02990000
030000                                                                  03000000
030100     05  WS-UPC-13.                                               03010000
030200         10  WS-UPC-ZERO              PIC 9(01) VALUE ZEROS.      03020000
030300         10  WS-UPC-12                PIC X(12) VALUE SPACES.     03030000
030400                                                                  03040000
030500 01  WS-PROGRAM-COUNTERS.                                         03050000
030600     05  WS-EDIIN-REC-CNT             PIC 9(9)  VALUE ZEROS.      03060000
030700                                                                  03070000
030800 01  WS-SWITCHES.                                                 03080000
030900     05  END-OF-EDIIN-SW              PIC X(01) VALUE 'N'.        03090000
031000         88  END-OF-EDIIN                       VALUE 'Y'.        03100000
031100                                                                  03110000
031200     05  END-OF-CURSOR-SW             PIC X(01) VALUE 'N'.        03120000
031300         88  END-OF-CURSOR                      VALUE 'Y'.        03130000
031400         88  NOT-END-OF-CURSOR                  VALUE 'N'.        03140000
031500                                                                  03150000
031600     05  INSERT-SUCCESSFUL-SW         PIC X(01) VALUE 'N'.        03160000
031700         88  INSERT-SUCCESSFUL                  VALUE 'Y'.        03170000
031800         88  INSERT-NOT-SUCCESSFUL              VALUE 'N'.        03180000
031810                                                                  03181000
031820 01  PS-PROGRAM-SWITCHES-II.                                      03182000
031830     05  PS-RUN-TYPE-SW               PIC X(01) VALUE ' '.        03183000
031840         88  NORMAL-RUN                         VALUE '0'.        03184000
031850         88  RESTART-RUN                        VALUE '9'.        03185000
031860                                                                  03186000
031870 01  WS-REC04-AREA.                                               03187000
031880     05  WS-R04-TABLE            OCCURS 25  TIMES                 03188000
031890                                 INDEXED BY R04-INDX.             03189000
031900         10  WS-R04-REC.                                          03190000
032000             15  WS-R04-KEY-AREA.                                 03200000
032100                 20  WS-R04-PO-NBR    PIC X(09).                  03210003
032200                 20  WS-R04-INV-NBR   PIC X(22).                  03220000
032300                 20  WS-R04-REC-TYPE  PIC X(02).                  03230000
032400                 20  WS-R04-FILLER    PIC X(17).                  03240003
032500             15  WS-R04-DATA-AREA     PIC X(300).                 03250000
032600 01  WS-REC05-AREA.                                               03260000
032700     05  WS-R05-TABLE            OCCURS 5000 TIMES                03270000
032800                                 INDEXED BY R05-INDX.             03280000
032900         10  WS-R05-REC.                                          03290000
033000             15  WS-R05-KEY-AREA.                                 03300000
033100                 20  WS-R05-PO-NBR    PIC X(09).                  03310003
033200                 20  WS-R05-INV-NBR   PIC X(22).                  03320000
033300                 20  WS-R05-REC-TYPE  PIC X(02).                  03330000
033400                 20  WS-R05-FILLER    PIC X(17).                  03340003
033500             15  WS-R05-DATA-AREA     PIC X(300).                 03350000
033600 01  WS-REC07-AREA.                                               03360000
033700     05  WS-R07-TABLE            OCCURS 11000 TIMES               03370000
033800                                 INDEXED BY R07-INDX.             03380000
033900         10  WS-R07-REC.                                          03390000
034000             15  WS-R07-KEY-AREA.                                 03400000
034100                 20  WS-R07-PO-NBR    PIC X(09).                  03410003
034200                 20  WS-R07-INV-NBR   PIC X(22).                  03420000
034300                 20  WS-R07-REC-TYPE  PIC X(02).                  03430000
034400                 20  WS-R07-FILLER    PIC X(17).                  03440003
034500             15  WS-R07-DATA-AREA     PIC X(300).                 03450000
034600                                                                  03460000
034700 01  RUN-TIME.                                                    03470000
034800     05  R-HR                         PIC 99.                     03480000
034900     05  R-MIN                        PIC 99.                     03490000
035000     05  R-SEC                        PIC 99.                     03500000
035100     05  R-TH                         PIC 99.                     03510000
035200 01  DATE-IN.                                                     03520000
035300     05 DATE-IN-YY                    PIC XX.                     03530000
035400     05 DATE-IN-MM                    PIC XX.                     03540000
035500     05 DATE-IN-DD                    PIC XX.                     03550000
035600                                                                  03560000
035700 01  PC-PROGRAM-CONSTANTS.                                        03570000
035800     05  PC-IN-PROCESS-CODE           PIC X(01)  VALUE '9'.       03580000
035900     05  PC-RUN-COMPLETE-CODE         PIC X(01)  VALUE '0'.       03590000
036000     05  PC-LOWER-CASE-LETTERS        PIC X(26)  VALUE            03600000
036100         'abcdefghijklmnopqrstuvwxyz'.                            03610000
036200     05  PC-UPPER-CASE-LETTERS        PIC X(26)  VALUE            03620000
036300         'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.                            03630000
036400                                                                  03640000
036500 01  CKPT-RESTART-INFO.                                           03650000
036600     05  CR-PO-NBR                    PIC S9(9) VALUE ZEROS  COMP.03660000
036700     05  CR-MTCH-LVL                  PIC X(01)   VALUE SPACES.   03670000
036800     05  CR-INVC-ID                   PIC X(22)   VALUE SPACES.   03680000
036900     05  CR-TOT-NO-PAY-REQ-ADDED      PIC S9(11)    VALUE ZEROS.  03690000
037000     05  CR-TOT-GROSS-COST-ADDED      PIC S9(09)V99 VALUE ZEROS.  03700000
037010                                                                  03701000
037020 01  CKPT-RESTART-TMST.                                           03702000
037030     05  CR-CURR-TMST                 PIC X(26)   VALUE SPACES.   03703000
037040     05  CR-NEXT-TMST                 PIC X(26)   VALUE SPACES.   03704000
037050                                                                  03705000
037060*--------------------------------------------------------------*  03706000
037070* STANDARD HEADER LAYOUT                                       *  03707000
037080*--------------------------------------------------------------*  03708000
037090     COPY DPWS132O.                                               03709000
037100                                                                  03710000
037200 01  HL-HEADING-LINE1.                                            03720000
037300     05  FILLER                       PIC X(50) VALUE SPACES.     03730000
037400     05  FILLER                       PIC X(30) VALUE             03740000
037500             ' EDI PRODUCTION UPDTE TOTALS '.                     03750000
037600     05  FILLER                       PIC X(05) VALUE SPACE.      03760000
037700     05  FILLER                       PIC X(25) VALUE SPACE.      03770000
037800     05  FILLER                       PIC X(20) VALUE SPACE.      03780000
037900                                                                  03790000
038000 01  DETAIL-LINE1.                                                03800000
038100     05  FILLER                       PIC X(50)     VALUE         03810000
038200     'TOTAL NUMBER OF INVOICES ADDED TO DB2 TABLES =    '.        03820000
038300     05  WS-EDITTED-PAY-REQ           PIC  ZZ,ZZZ,ZZZ,ZZ9.        03830000
038400     05  FILLER                       PIC X(68) VALUE SPACE.      03840000
038500                                                                  03850000
038600 01  DETAIL-LINE2.                                                03860000
038700     05  FILLER                       PIC X(49) VALUE             03870000
038800     'TOTAL GROSS AMOUNT ADDED TO DB2 TABLES =         '.         03880000
038900     05  WS-EDITTED-COST              PIC $ZZZ,ZZZ,ZZ9.99.        03890000
039000     05  FILLER                       PIC X(68) VALUE SPACES.     03900000
039100                                                                  03910000
039200*--------------------------------------------------------------*  03920000
039300* EDI INPUT LAYOUT                                             *  03930000
039400*--------------------------------------------------------------*  03940000
039500 01  FILLER                           PIC X(35)  VALUE            03950000
039600     'BEGINNING OF AP052 INPUT FILE    **'.                       03960000
039700 01  AP052-EDI-IN-FILE.                                           03970000
039800     COPY APRD052.                                                03980000
039900                                                                  03990000
040000 01  FILLER                           PIC X(35)  VALUE            04000000
040100     'BEGINNING OF AP WORK RECORD AREA **'.                       04010000
040200 01  WS-WORK-REC.                                                 04020000
040300     COPY APRD052 REPLACING 'AP052-' BY 'WS052-'.                 04030000
040400                                                                  04040000
040500 01  FILLER                           PIC X(35)  VALUE            04050000
040600     'END OF AP WORK RECORD AREA       **'.                       04060000
040700                                                                  04070000
040800*--------------------------------------------------------------*  04080000
040900* SQLCA FORMATTED MESSAGE AREA                                 *  04090000
041000*--------------------------------------------------------------*  04100000
041100     COPY DPWS004.                                                04110000
041200                                                                  04120000
041300*--------------------------------------------------------------*  04130000
041400* COMMUNICATIONS AREA FOR DB2                                  *  04140000
041500*--------------------------------------------------------------*  04150000
041600     COPY SQLCA2.                                                 04160000
041700                                                                  04170000
041800     EXEC SQL                                                     04180000
041900          INCLUDE SQLCA                                           04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200*--------------------------------------------------------------*  04220000
042300* ALLOWANCE/CHARGE TABLE                                       *  04230000
042400*--------------------------------------------------------------*  04240000
042500     EXEC SQL                                                     04250000
042600          INCLUDE TALCHRG                                         04260000
042700     END-EXEC.                                                    04270000
042800                                                                  04280000
042900*--------------------------------------------------------------*  04290000
043000* INVOICE TERMS TABLE                                          *  04300000
043100*--------------------------------------------------------------*  04310000
043200     EXEC SQL                                                     04320000
043300          INCLUDE TINVCTM                                         04330000
043400     END-EXEC.                                                    04340000
043500                                                                  04350000
043600*--------------------------------------------------------------*  04360000
043700* INVOICE TABLE                                                *  04370000
043800*--------------------------------------------------------------*  04380000
043900     EXEC SQL                                                     04390000
044000          INCLUDE TINVOIC                                         04400000
044100     END-EXEC.                                                    04410000
044200                                                                  04420000
044300*--------------------------------------------------------------*  04430000
044400* MERCHANDISE INVOICE TABLE                                    *  04440000
044500*--------------------------------------------------------------*  04450000
044600     EXEC SQL                                                     04460000
044700          INCLUDE TMDINVC                                         04470000
044800     END-EXEC.                                                    04480000
044900                                                                  04490000
045000*--------------------------------------------------------------*  04500000
045010* MERCHANDISE INVOICE ITEM TABLE                               *  04501000
045020*--------------------------------------------------------------*  04502000
045030     EXEC SQL                                                     04503000
045040          INCLUDE TMIITEM                                         04504000
045050     END-EXEC.                                                    04505000
045060                                                                  04506000
045070*--------------------------------------------------------------*  04507000
045080* PAYMENT REQUEST ITEM TABLE                                   *  04508000
045090*--------------------------------------------------------------*  04509000
045100     EXEC SQL                                                     04510000
045200          INCLUDE TPREQIT                                         04520000
045300     END-EXEC.                                                    04530000
045400                                                                  04540000
045500*--------------------------------------------------------------*  04550000
045600* VENDOR SUPPLIED INVOICE ITEM DATA TABLE                      *  04560000
045700*--------------------------------------------------------------*  04570000
045800     EXEC SQL                                                     04580000
045900          INCLUDE TVNDINV                                         04590000
046000     END-EXEC.                                                    04600000
046100                                                                  04610000
046200*--------------------------------------------------------------*  04620000
046300* CHECKPOINT RESTART CONTROL TABLE                             *  04630000
046400*--------------------------------------------------------------*  04640000
046500     EXEC SQL                                                     04650000
046600          INCLUDE TCKRSTCN                                        04660000
046700     END-EXEC.                                                    04670000
046800                                                                  04680000
046900*--------------------------------------------------------------*  04690000
047000* CHECKPOINT RESTART INFORMATION TABLE                         *  04700000
047100*--------------------------------------------------------------*  04710000
047200     EXEC SQL                                                     04720000
047300          INCLUDE TCKRSTIN                                        04730000
047400     END-EXEC.                                                    04740000
047410                                                                  04741000
047420 01  FILLER                           PIC X(25) VALUE             04742000
047430          '<====WS FOR APKUP202 ENDS'.                            04743000
047440                                                                  04744000
047450*------------------------------*                                  04745000
047460 PROCEDURE DIVISION.                                              04746000
047470*------------------------------*                                  04747000
047480 A100-MAINLINE.                                                   04748000
047490                                                                  04749000
047500     PERFORM B100-HOUSEKEEPING.                                   04750000
047600                                                                  04760000
047700     IF NOT END-OF-EDIIN                                          04770000
047800        PERFORM B200-PROCESSING                                   04780000
047900                     UNTIL END-OF-EDIIN                           04790000
048000        PERFORM C100-INSERT-TABLES                                04800000
048100     END-IF.                                                      04810000
048200                                                                  04820000
048300     PERFORM B300-END-OF-JOB.                                     04830000
048400                                                                  04840000
048500     GOBACK.                                                      04850000
048600                                                                  04860000
048700*--------------------------------------------------------------*  04870000
048800* GET DATE AND TIME, OPEN FILES, SET UP CONTROLS, ETC.         *  04880000
048900*--------------------------------------------------------------*  04890000
049000 B100-HOUSEKEEPING.                                               04900000
049100                                                                  04910000
049200     ACCEPT RUN-TIME FROM TIME.                                   04920000
049300     ACCEPT DATE-IN  FROM DATE.                                   04930000
049400                                                                  04940000
049500     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    04950000
049600     IF DATE-IN-YY > 80                                           04960000
049700        MOVE '19' TO WS-SAVE-CURRENT-CC                           04970000
049800     ELSE                                                         04980000
049900        MOVE '20' TO WS-SAVE-CURRENT-CC                           04990000
050000     END-IF                                                       05000000
050100     MOVE DATE-IN-YY TO WS-SAVE-CURRENT-YY                        05010000
050200                        DP132O-RUN-YEAR.                          05020000
050300     MOVE DATE-IN-MM TO WS-SAVE-CURRENT-MM                        05030000
050400                        DP132O-RUN-MONTH.                         05040000
050500     MOVE DATE-IN-DD TO WS-SAVE-CURRENT-DD                        05050000
050600                        DP132O-RUN-DAY.                           05060000
050700                                                                  05070000
050800     MOVE R-HR   TO DP132O-RUN-HOUR.                              05080000
050900     MOVE R-MIN  TO DP132O-RUN-MINUTE.                            05090000
051000                                                                  05100000
051100     MOVE PV-PROGRAM-NAME TO DP132O-PROGRAM-NAME.                 05110000
051200                                                                  05120000
051300     OPEN  INPUT   EDIIN-AP052-FILE                               05130000
051400          OUTPUT   TOT-REPORT.                                    05140000
051500                                                                  05150000
051600     PERFORM H100-INITIALIZE.                                     05160000
051700                                                                  05170000
051800     PERFORM S400-GET-CHECKPOINT-CNTL.                            05180000
051900     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    05190000
052000                                                                  05200000
052100     IF RESTART-RUN                                               05210000
052200        PERFORM X200-CHECKPOINT-RESTART                           05220000
052300     ELSE                                                         05230000
052400        PERFORM R100-READ-AP052                                   05240000
052500     END-IF.                                                      05250000
052600                                                                  05260000
052700     IF END-OF-EDIIN                                              05270000
052800        IF NORMAL-RUN                                             05280000
052900           DISPLAY '**********************************'           05290000
053000           DISPLAY '*   EMPTY EDI INVOICE FILE       *'           05300000
053100           DISPLAY '*   PROGRAM ** = APKUP202        *'           05310000
053200           DISPLAY '**********************************'           05320000
053300        ELSE                                                      05330000
053400           DISPLAY '***********************************'          05340000
053500           DISPLAY '*   NO MATCH TO PO/MATCH LVL/INVC  '          05350000
053600           DISPLAY '*   PROGRAM ** = APKUP202'                    05360000
053700           DISPLAY '*   PO NUMBER    = ' PV-PO-NBR                05370000
053800           DISPLAY '*   MATCH LEVEL  = ' PV-MTCH-LVL              05380000
053900           DISPLAY '*   INVOICE ID   = ' PV-INVC-ID               05390000
054000           DISPLAY '***********************************'          05400000
054100        END-IF                                                    05410000
054200     ELSE                                                         05420000
054300        MOVE AP052-KOHLS-PO-NBR       TO WS-SAVE-PO-NBR           05430000
054400        MOVE AP052-SORT-MTCH-LVL      TO WS-SAVE-MTCH-LVL         05440000
054500        MOVE AP052-VENDOR-INVOICE-NBR TO WS-SAVE-INVOICE-NBR      05450000
054600     END-IF.                                                      05460000
054700                                                                  05470000
054800*--------------------------------------------------------------*  05480000
054900* PROCESS EDI INVOICES:                                        *  05490000
055000* -- THE ENTIRE INVOICE IS LOADED INTO WORKING STORAGE         *  05500000
055100* -- DATA FOR EACH INVOICE THAT HAS ONE AND ONLY ONE OF        *  05510000
055200*    THE RECORD TYPE IS LOADED TO THE DCLGENS THAT IT WILL     *  05520000
055300*    BE UPDATING                                               *  05530000
055400* -- DATA THAT IS COMING IN ON A RECORD TYPE THAT CAN HAVE     *  05540000
055500*    MULTIPLE RECORDS IS LOADED TO TABLES AND PROCESSED TO     *  05550000
055600*    THE DCLGEN DURING TABLE CREATION                          *  05560000
055700* -- ON BREAK IN INVOICE NUMBER THE TABLES ARE CREATED FOR     *  05570000
055800*    THE INVOICE AND THE WORKING STORAGE,DCLGEN AREAS ARE      *  05580000
055900*    RE-INITIALIZED FOR THE NEXT INVOICE                       *  05590000
056000*--------------------------------------------------------------*  05600000
056100 B200-PROCESSING.                                                 05610000
056200                                                                  05620000
056300     IF (AP052-KOHLS-PO-NBR NOT = WS-SAVE-PO-NBR) OR              05630000
056400        ((AP052-KOHLS-PO-NBR = WS-SAVE-PO-NBR) AND                05640000
056500         (AP052-VENDOR-INVOICE-NBR NOT = WS-SAVE-INVOICE-NBR))    05650000
056600        PERFORM C100-INSERT-TABLES                                05660000
056700        MOVE AP052-KOHLS-PO-NBR       TO WS-SAVE-PO-NBR           05670000
056800        MOVE AP052-SORT-MTCH-LVL      TO WS-SAVE-MTCH-LVL         05680000
056900        MOVE AP052-VENDOR-INVOICE-NBR TO WS-SAVE-INVOICE-NBR      05690000
057000        PERFORM H100-INITIALIZE                                   05700000
057100     END-IF.                                                      05710000
057200                                                                  05720000
057300     IF (R07-INDX >= WS-R07-MAX AND                               05730000
057400           AP052-RECORD-TYPE-IND  = '07') OR                      05740000
057500        (R04-INDX >= WS-R04-MAX AND                               05750000
057600           AP052-RECORD-TYPE-IND  = '04') OR                      05760000
057700        (R05-INDX >= WS-R05-MAX AND                               05770000
057800           AP052-RECORD-TYPE-IND  = '05')                         05780000
057900        DISPLAY '************** ABEND *************'              05790000
058000        DISPLAY '*   INVOICE ITEM, TERM, OR ALLW/ *'              05800000
058100        DISPLAY '*   CHRG TABLES ARE FULL         *'              05810000
058200        DISPLAY '*   PROGRAM ** = APKUP202        *'              05820000
058300        DISPLAY '*   PARAGRAPH  = B200-PROCESSING *'              05830000
058400        DISPLAY '**********************************'              05840000
058500        CLOSE TOT-REPORT                                          05850000
058600        SET AP-TABLE-FULL TO TRUE                                 05860000
058700        CALL 'ILBOABN0' USING ABEND-CODE                          05870000
058800     ELSE                                                         05880000
058900        EVALUATE AP052-RECORD-TYPE-IND                            05890000
059000           WHEN '01'                                              05900000
059100                PERFORM D100-MOVE-REC01                           05910000
059200           WHEN '02'                                              05920000
059300                PERFORM D200-MOVE-REC02                           05930000
059400           WHEN '03'                                              05940000
059500                PERFORM D300-MOVE-REC03                           05950000
059600           WHEN '04'                                              05960000
059700                 SET R04-INDX UP BY 1                             05970000
059800                 MOVE AP052-EDI-IN-FILE TO WS-R04-REC(R04-INDX)   05980000
059900           WHEN '05'                                              05990000
060000                 SET R05-INDX UP BY 1                             06000000
060100                 MOVE AP052-EDI-IN-FILE TO WS-R05-REC(R05-INDX)   06010000
060200           WHEN '06'                                              06020000
060300                PERFORM D400-MOVE-REC06                           06030000
060400           WHEN '07'                                              06040000
060500                 SET R07-INDX UP BY 1                             06050000
060600                 MOVE AP052-EDI-IN-FILE TO WS-R07-REC(R07-INDX)   06060000
060700        END-EVALUATE                                              06070000
060800     END-IF.                                                      06080000
060900                                                                  06090000
061000     PERFORM R100-READ-AP052.                                     06100000
061100                                                                  06110000
061200*--------------------------------------------------------------*  06120000
061300* CLOSE ALL FILES AND REPORT ON NECESSARY TOTALS               *  06130000
061400*--------------------------------------------------------------*  06140000
061500 B300-END-OF-JOB.                                                 06150000
061600                                                                  06160000
061700     DISPLAY '************************************************'.  06170000
061800     DISPLAY 'TOTAL INVOICES RECORDS READ    = '                  06180000
061900              WS-EDIIN-REC-CNT                                    06190000
062000     DISPLAY '************************************************'.  06200000
062100                                                                  06210000
062200     MOVE WS-TOT-NO-PAY-REQ-ADDED TO WS-EDITTED-PAY-REQ.          06220000
062300     MOVE WS-TOT-GROSS-COST-ADDED TO WS-EDITTED-COST.             06230000
062400                                                                  06240000
062500     DISPLAY '************************************************'.  06250000
062600     DISPLAY 'TOT NUMBER PAY REQS ADDED = '                       06260000
062700              WS-EDITTED-PAY-REQ                                  06270000
062800     DISPLAY '************************************************'.  06280000
062900                                                                  06290000
063000     DISPLAY '************************************************'.  06300000
063100     DISPLAY 'TOT GROSS COST ADDED = '                            06310000
063200              WS-EDITTED-COST                                     06320000
063300     DISPLAY '************************************************'.  06330000
063400                                                                  06340000
063500     PERFORM W100-TOT-REPORT.                                     06350000
063600                                                                  06360000
063700     CLOSE EDIIN-AP052-FILE                                       06370000
063800           TOT-REPORT.                                            06380000
063900                                                                  06390000
064000     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              06400000
064100     PERFORM U100-UPDATE-TCKRSTCNTL.                              06410000
064200     PERFORM U200-UPDATE-TCKRSTINF.                               06420000
064300     PERFORM U300-COMMIT.                                         06430000
064400                                                                  06440000
064500     IF   END-OF-EDIIN                                            06450000
064600          DISPLAY ' PROGRAM APKUP202 ENDS NORMALLY '              06460000
064700     ELSE                                                         06470000
064800          DISPLAY ' PROGRAM APKUP202 ENDS ABNORMALLY '            06480000
064900     END-IF.                                                      06490000
065000                                                                  06500000
065100     ACCEPT RUN-TIME FROM TIME.                                   06510000
065200     ACCEPT DATE-IN  FROM DATE.                                   06520000
065300                                                                  06530000
065400     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    06540000
065500     DISPLAY '************************************************'.  06550000
065600                                                                  06560000
065700*--------------------------------------------------------------*  06570000
065800* INSERT ALL OF THE NECESSARY TABLE DATA FOR THE INVOICE.      *  06580000
065900* SOME OF THE INFORMATION WAS STORED IN THE DCLGEN WHILE THE   *  06590000
066000* ENTIRE INVOICE WAS BEING RETRIEVED.  ADDITIONAL DATA FOR     *  06600000
066100* THE COLUMNS WILL BE LOADED WITHIN THE VARIOUS PERFORMED      *  06610000
066200* PARAGRAPHS.                                                  *  06620000
066300*--------------------------------------------------------------*  06630000
066400 C100-INSERT-TABLES.                                              06640000
066500                                                                  06650000
066600     PERFORM R200-DETERMINE-PAYT-NBR.                             06660000
066700     PERFORM F200-FILL-INVOIC.                                    06670000
066800                                                                  06680000
066900*---------------------------------------------------------------  06690000
067000* PROCESS THE TERMS RECORDS FOR THE INVCTM ROWS                   06700000
067100* -- CHECK IF ANY TERMS RECORDS EXIST -                           06710000
067200* -- IF YES THEN INSERT ALL THE LOADED TERMS RECORDS (THE TERMS   06720000
067300*    CAN HAVE MULTIPLE ROWS)                                      06730000
067400*---------------------------------------------------------------  06740000
067500                                                                  06750000
067600     IF WS-R04-KEY-AREA(1) NOT = HIGH-VALUES                      06760000
067700        PERFORM F500-FILL-INVCTM                                  06770000
067800          VARYING R04-INDX FROM 1 BY 1                            06780000
067900          UNTIL R04-INDX > WS-R04-MAX OR                          06790000
068000                WS-R04-KEY-AREA(R04-INDX) = HIGH-VALUES           06800000
068100     END-IF.                                                      06810000
068200                                                                  06820000
068300     PERFORM F600-FILL-MDINVC.                                    06830000
068400                                                                  06840000
068500*---------------------------------------------------------------  06850000
068600* PROCESS THE ALLW/CHRG RECORDS FOR THE ALCHRG ROWS and check     06860000
068700* IF ANY ALLW/CHRG RECORDS EXIST.  if yes, then insert all of     06870000
068800* THE LOADED RECORDS (the allw/chrg can have multiple rows)       06880000
068900*---------------------------------------------------------------  06890000
069000                                                                  06900000
069100     IF WS-R05-KEY-AREA(1) NOT = HIGH-VALUES                      06910000
069200        MOVE 1 TO WS-ALW-CHRG-SEQ-NBR                             06920000
069300        PERFORM F700-FILL-ALCHRG                                  06930000
069400          VARYING R05-INDX FROM 1 BY 1                            06940000
069500          UNTIL R05-INDX > WS-R05-MAX OR                          06950000
069600                WS-R05-KEY-AREA(R05-INDX) = HIGH-VALUES           06960000
069700     END-IF.                                                      06970000
069800                                                                  06980000
069900     PERFORM F800-FILL-MISC-TABLES.                               06990000
070000                                                                  07000000
070100     ADD 1                   TO WS-TOT-NO-PAY-REQ-ADDED.          07010000
070200     ADD INVOIC-GRO-COST-AMT TO WS-TOT-GROSS-COST-ADDED.          07020000
070300                                                                  07030000
070400     PERFORM X100-CHECKPOINT-COMMIT.                              07040000
070500                                                                  07050000
070600*--------------------------------------------------------------*  07060000
070700* CONVERT ANY LOWERCASE LETTERS IN THE INVOICE ID INTO UPPER-  *  07070000
070800* CASE LETTERS AND MOVE THE 01 RECORD TYPE FIELDS TO THE       *  07080000
070900* DCLGENS.                                                     *  07090000
071000*--------------------------------------------------------------*  07100000
071100 D100-MOVE-REC01.                                                 07110000
071200                                                                  07120000
071300     MOVE AP052-KOHLS-PO-NBR  TO  WS-PO-NBR                       07130000
071400                                  MIITEM-PO-NBR                   07140000
071500                                  INVOIC-PO-NBR                   07150000
071600                                  MDINVC-PO-NBR                   07160000
071700                                  ALCHRG-PO-NBR                   07170000
071800                                  INVCTM-PO-NBR.                  07180000
071900                                                                  07190000
072000     INSPECT AP052-VENDOR-INVOICE-NBR                             07200000
072100        CONVERTING PC-LOWER-CASE-LETTERS                          07210000
072200                TO PC-UPPER-CASE-LETTERS.                         07220000
072300                                                                  07230000
072400     MOVE AP052-VENDOR-INVOICE-NBR  TO  INVOIC-INVC-ID            07240000
072500                                        MDINVC-INVC-ID            07250000
072600                                        ALCHRG-INVC-ID            07260000
072700                                        INVCTM-INVC-ID.           07270000
072800                                                                  07280000
072900** IF A VALID DUN NBR IS SENT ON AN 03 RECORD - THE               07290000
073000** INVOIC-RMIT-VND-ID MOVED HERE WILL BE OVERLAYED IN THE         07300000
073100** MOVE REC03 AREA.                                               07310000
073200     MOVE AP052-EXTENT-DUN-NBR  TO  INVOIC-RMIT-VND-ID.           07320000
073200     MOVE AP052-NEXUS-INVC      TO  PV-NEXUS-INVC.                07321008
073300                                                                  07330000
073400*--------------------------------------------------------------*  07340000
073500* MOVE THE 02 RECORD TYPE FIELDS TO THE DCLGENS                *  07350000
073600*--------------------------------------------------------------*  07360000
073700 D200-MOVE-REC02.                                                 07370000
073800                                                                  07380000
073900     IF AP052-KOHLS-STORE-TO-USE NOT NUMERIC                      07390000
074000        MOVE 0                        TO INVOIC-STR-NBR           07400000
074100                                         WS-STORE-NBR             07410000
074200     ELSE                                                         07420000
074300        MOVE AP052-KOHLS-STORE-TO-USE TO INVOIC-STR-NBR           07430000
074400                                         WS-STORE-NBR             07440000
074500     END-IF.                                                      07450000
074600     IF AP052-KOHLS-DC-TO-USE NOT NUMERIC                         07460000
074700        MOVE 0                        TO INVOIC-DC-NBR            07470000
074800                                         WS-DC-NBR                07480000
074900     ELSE                                                         07490000
075000        MOVE AP052-KOHLS-DC-TO-USE    TO INVOIC-DC-NBR            07500000
075100                                         WS-DC-NBR                07510000
075200     END-IF.                                                      07520000
075300     MOVE AP052-KOHLS-MTCH-LVL-TO-USE TO INVOIC-MTCH-LVL-CDE      07530000
075400                                         WS-MTCH-LVL.             07540000
075500                                                                  07550000
075600     IF AP052-INVOICE-DATE = SPACES OR '000000'                   07560000
075700        MOVE '9999-09-09'             TO INVOIC-INVC-DTE          07570000
075800     ELSE                                                         07580000
075900        IF AP052-INV-DTE-YY > 80                                  07590000
076000           MOVE '19'                  TO INVOIC-INVC-DTE(1:2)     07600000
076100        ELSE                                                      07610000
076200           MOVE '20'                  TO INVOIC-INVC-DTE(1:2)     07620000
076300        END-IF                                                    07630000
076310        MOVE AP052-INV-DTE-YY         TO INVOIC-INVC-DTE(3:2)     07631000
076320        MOVE '-'                      TO INVOIC-INVC-DTE(5:1)     07632000
076330        MOVE AP052-INV-DTE-MM         TO INVOIC-INVC-DTE(6:2)     07633000
076340        MOVE '-'                      TO INVOIC-INVC-DTE(8:1)     07634000
076350        MOVE AP052-INV-DTE-DD         TO INVOIC-INVC-DTE(9:2)     07635000
076360     END-IF.                                                      07636000
076370                                                                  07637000
076380     IF AP052-EFFECTIVE-DATE = SPACES OR '000000'                 07638000
076390        MOVE '9999-09-09'             TO INVCTM-EFF-DTE           07639000
076400     ELSE                                                         07640000
076500        IF AP052-EFF-DTE-YY > 80                                  07650000
076600           MOVE '19'                  TO INVCTM-EFF-DTE(1:2)      07660000
076700        ELSE                                                      07670000
076800           MOVE '20'                  TO INVCTM-EFF-DTE(1:2)      07680000
076900        END-IF                                                    07690000
077000        MOVE AP052-EFF-DTE-YY         TO INVCTM-EFF-DTE(3:2)      07700000
077100        MOVE '-'                      TO INVCTM-EFF-DTE(5:1)      07710000
077200        MOVE AP052-EFF-DTE-MM         TO INVCTM-EFF-DTE(6:2)      07720000
077300        MOVE '-'                      TO INVCTM-EFF-DTE(8:1)      07730000
077400        MOVE AP052-EFF-DTE-DD         TO INVCTM-EFF-DTE(9:2)      07740000
077500     END-IF.                                                      07750000
077600                                                                  07760000
077700     MOVE AP052-LADING-CARRIER-NBR    TO MDINVC-BOL-ID.           07770000
077800     MOVE AP052-INVC-HOLD-IND         TO INVOIC-HOLD-IND.         07780000
077900     MOVE AP052-SPLIT-TERMS-IND       TO INVOIC-SPLIT-TERMS-IND.  07790000
078000     MOVE AP052-VEND-FRGT-PCT         TO MDINVC-VEND-FRGT-PCT.    07800000
078100     MOVE AP052-KOHLS-FRGT-PCT        TO MDINVC-KOHLS-FRGT-PCT.   07810000
078200                                                                  07820000
078300*--------------------------------------------------------------*  07830000
078400* MOVE THE 03 RECORD TYPE FIELDS TO THE DCLGENS                *  07840000
078500*--------------------------------------------------------------*  07850000
078600 D300-MOVE-REC03.                                                 07860000
078700                                                                  07870000
078800     MOVE AP052-REMIT-VNDR-DUNS-NBR TO INVOIC-RMIT-VND-ID.        07880000
078900                                                                  07890000
079000*--------------------------------------------------------------*  07900000
079100* MOVE THE 06 RECORD TYPE FIELDS TO THE DCLGENS                *  07910000
079200*--------------------------------------------------------------*  07920000
079300 D400-MOVE-REC06.                                                 07930000
079400                                                                  07940000
079500     MOVE AP052-GROSS-COST-INV-AMT                                07950000
079600                                   TO INVOIC-GRO-COST-AMT.        07960000
079700     MOVE AP052-GROSS-INVOICE-AMT                                 07970000
079800                                   TO INVOIC-INVC-NET-COST-AMT.   07980000
079900     IF  INVOIC-RMIT-VND-ID = WS-IMPORT-DUN-NBR                   07990000
080000         MOVE 'N'   TO INVOIC-PPD-RVRSL-IND                       08000000
080100     ELSE                                                         08010000
080200         MOVE SPACE TO INVOIC-PPD-RVRSL-IND                       08020000
080300     END-IF.                                                      08030000
080400                                                                  08040000
080500     MOVE AP052-TOTAL-QTY-INVOICED                                08050000
080600                                   TO MDINVC-TOT-INVC-PC-QTY.     08060000
080700     IF (AP052-SHIP-MSR-CASE  OR                                  08070000
080800         AP052-SHIP-MSR-CARTON )                                  08080000
080900         MOVE AP052-QUANTITY-SHIPPED                              08090000
081000                                   TO INVOIC-INVC-CART-CT         08100000
081100     ELSE                                                         08110000
081200         MOVE ZEROS                TO INVOIC-INVC-CART-CT         08120000
081300     END-IF.                                                      08130000
081400                                                                  08140000
081500*--------------------------------------------------------------*  08150000
081600* MOVE THE DATA TO COMPLETE THE INVOIC ROW                     *  08160000
081700*--------------------------------------------------------------*  08170000
081800 F200-FILL-INVOIC.                                                08180000
081900                                                                  08190000
082000     MOVE 'MI'                  TO INVOIC-INVC-TYP-CDE.           08200000
082100     MOVE 'ED'                  TO INVOIC-ENTR-MTHD-CDE.          08210000
082200     MOVE 'APKUP202'            TO INVOIC-CRE-BY-USR-ID.          08220000
082300     MOVE SPACES                TO INVOIC-BAR-CDE.                08230000
082400     MOVE 'Y'                   TO INVOIC-DTL-ENTR-IND.           08240000
082500     MOVE WS-SAVE-CURRENT-DATE  TO INVOIC-CRE-DTE.                08250000
082600     MOVE SPACE                 TO INVOIC-DUE-DTE-SRC-CDE.        08260000
082700     MOVE '0001-01-01'          TO INVOIC-CALC-DUE-DTE.           08270000
082800     MOVE '9999-09-09'          TO INVOIC-PAYT-DTE.               08280000
082900     MOVE '9999-09-09'          TO INVOIC-AP-PRC-DTE.             08290000
083000     MOVE SPACE                 TO INVOIC-AP-PRC-CDE.             08300000
083100     MOVE '9999-09-09-09.09.09.999999'                            08310000
083200                                TO INVOIC-PAYT-RLSE-TMST.         08320000
083300     MOVE 'EN'                  TO INVOIC-STATUS-CDE.             08330000
083400                                                                  08340000
083500                                                                  08350000
083600     PERFORM I200-INSERT-INVOIC.                                  08360000
083700                                                                  08370000
083800*--------------------------------------------------------------*  08380000
083900* MOVE THE DATA TO COMPLETE THE INVCTM ROW                     *  08390000
084000*--------------------------------------------------------------*  08400000
084100 F500-FILL-INVCTM.                                                08410000
084200                                                                  08420000
084300     MOVE WS-R04-REC(R04-INDX) TO WS-WORK-REC.                    08430000
084400     MOVE WS052-TERMS-TYPE-CODE  TO                               08440000
084500                INVCTM-TERM-TYP-CDE.                              08450000
084600     MOVE WS052-TRMS-BASIS-DTE-CODE  TO                           08460000
084700                INVCTM-TERM-BASIS-DTE-CDE.                        08470000
084800     IF WS052-TERMS-TYPE-CODE  = '04'                             08480000
084900        DIVIDE WS052-PCT-PAYABLE BY 100 GIVING                    08490000
085000                INVCTM-DISC-PCT                                   08500000
085100        END-DIVIDE                                                08510000
085200        MOVE WS052-DEFERRED-AMT  TO                               08520000
085300                INVCTM-DISC-AMT                                   08530000
085400        IF WS052-DEFERRED-DUE-DATE  = SPACES                      08540000
085500                                                OR '000000'       08550000
085600           MOVE '9999-09-09' TO INVCTM-DISC-DUE-DTE               08560000
085700        ELSE                                                      08570000
085800           IF WS052-DEF-DUE-DTE-YY > 80                           08580000
085900           MOVE '19'         TO INVCTM-DISC-DUE-DTE(1:2)          08590000
086000           ELSE                                                   08600000
086100             MOVE '20'       TO INVCTM-DISC-DUE-DTE(1:2)          08610000
086200           END-IF                                                 08620000
086300           MOVE WS052-DEF-DUE-DTE-YY  TO                          08630000
086400                                INVCTM-DISC-DUE-DTE(3:2)          08640000
086500           MOVE '-'          TO INVCTM-DISC-DUE-DTE(5:1)          08650000
086600           MOVE WS052-DEF-DUE-DTE-MM  TO                          08660000
086700                                INVCTM-DISC-DUE-DTE(6:2)          08670000
086800           MOVE '-'          TO INVCTM-DISC-DUE-DTE(8:1)          08680000
086900           MOVE WS052-DEF-DUE-DTE-DD  TO                          08690000
087000                                INVCTM-DISC-DUE-DTE(9:2)          08700000
087100        END-IF                                                    08710000
087200        MOVE WS052-NET-DEFRD-DAYS-DUE  TO                         08720000
087300                INVCTM-DISC-DUE-DAY-QTY                           08730000
087400     ELSE                                                         08740000
087500        DIVIDE WS052-DISC-PCT  BY 100 GIVING                      08750000
087600                INVCTM-DISC-PCT                                   08760000
087700        END-DIVIDE                                                08770000
087800        MOVE WS052-DISC-AMT  TO                                   08780000
087900                INVCTM-DISC-AMT                                   08790000
088000        IF WS052-DISC-DUE-DATE  = SPACES                          08800000
088100                                            OR '000000'           08810000
088200           MOVE '9999-09-09'     TO INVCTM-DISC-DUE-DTE           08820000
088300        ELSE                                                      08830000
088400           IF WS052-DISC-DUE-DTE-YY > 80                          08840000
088500           MOVE '19'        TO INVCTM-DISC-DUE-DTE(1:2)           08850000
088600           ELSE                                                   08860000
088700             MOVE '20'      TO INVCTM-DISC-DUE-DTE(1:2)           08870000
088800           END-IF                                                 08880000
088900           MOVE WS052-DISC-DUE-DTE-YY  TO                         08890000
089000                               INVCTM-DISC-DUE-DTE(3:2)           08900000
089100           MOVE '-'         TO INVCTM-DISC-DUE-DTE(5:1)           08910000
089200           MOVE WS052-DISC-DUE-DTE-MM  TO                         08920000
089300                               INVCTM-DISC-DUE-DTE(6:2)           08930000
089400           MOVE '-'         TO INVCTM-DISC-DUE-DTE(8:1)           08940000
089500           MOVE WS052-DISC-DUE-DTE-DD  TO                         08950000
089600                               INVCTM-DISC-DUE-DTE(9:2)           08960000
089700        END-IF                                                    08970000
089800        MOVE WS052-DISC-DAYS-DUE  TO                              08980000
089900                INVCTM-DISC-DUE-DAY-QTY                           08990000
090000     END-IF.                                                      09000000
090100     IF WS052-NET-DUE-DATE  = SPACES                              09010000
090200                                             OR '000000'          09020000
090300        MOVE '9999-09-09' TO INVCTM-NET-DUE-DTE                   09030000
090400     ELSE                                                         09040000
090500        IF WS052-NET-DUE-DTE-YY > 80                              09050000
090600        MOVE '19'           TO INVCTM-NET-DUE-DTE(1:2)            09060000
090700        ELSE                                                      09070000
090800          MOVE '20'         TO INVCTM-NET-DUE-DTE(1:2)            09080000
090900        END-IF                                                    09090000
091000        MOVE WS052-NET-DUE-DTE-YY  TO                             09100000
091100                               INVCTM-NET-DUE-DTE(3:2)            09110000
091200        MOVE '-'            TO INVCTM-NET-DUE-DTE(5:1)            09120000
091300        MOVE WS052-NET-DUE-DTE-MM  TO                             09130000
091400                               INVCTM-NET-DUE-DTE(6:2)            09140000
091500        MOVE '-'            TO INVCTM-NET-DUE-DTE(8:1)            09150000
091600        MOVE WS052-NET-DUE-DTE-DD  TO                             09160000
091700                               INVCTM-NET-DUE-DTE(9:2)            09170000
091800     END-IF.                                                      09180000
091900     MOVE WS052-NET-DEFRD-DAYS-DUE  TO                            09190000
092000                INVCTM-NET-DUE-DAY-QTY.                           09200000
092100     MOVE WS052-TERMS-SEQ-NBR  TO                                 09210000
092200                INVCTM-TERM-SEQ-NBR.                              09220000
092300     MOVE WS052-TERMS-EXTD-DAYS-QTY  TO                           09230000
092400                INVCTM-EXTD-DAYS-QTY.                             09240000
092500                                                                  09250000
092600     PERFORM I500-INSERT-INVCTM.                                  09260000
092700                                                                  09270000
092800*--------------------------------------------------------------*  09280000
092900* MOVE THE DATA TO COMPLETE THE MDINVC ROW                     *  09290000
093000*--------------------------------------------------------------*  09300000
093100 F600-FILL-MDINVC.                                                09310000
093200                                                                  09320000
093300     IF WS-R04-KEY-AREA(1) NOT = HIGH-VALUES                      09330000
093400        MOVE WS052-TERMS-SEL-CDE                                  09340000
093500                                 TO MDINVC-TERM-SEL-CDE           09350000
093600     ELSE                                                         09360000
093700        MOVE 'P'                 TO MDINVC-TERM-SEL-CDE           09370000
093800     END-IF.                                                      09380000
093900     IF INVOIC-RMIT-VND-ID = WS-IMPORT-DUN-NBR                    09390000
094000        MOVE WS-IMPORT-CHRG-PRC-CDE                               09400000
094100                                 TO MDINVC-IMPRT-CHRG-PRC-CDE     09410000
094200     ELSE                                                         09420000
094200        IF PV-NEXUS-INVC-YES                                      09421008
094000            MOVE WS-DIRECT-IMPORT-PRC-CDE                         09422006
094100                                 TO MDINVC-IMPRT-CHRG-PRC-CDE     09423006
094300        ELSE                                                      09430006
094300            MOVE SPACES          TO MDINVC-IMPRT-CHRG-PRC-CDE     09431006
094400        END-IF                                                    09440006
094400     END-IF.                                                      09440106
094300*       MOVE SPACES              TO MDINVC-IMPRT-CHRG-PRC-CDE     09441006
094400*    END-IF.                                                      09442006
094500                                                                  09450000
094600     PERFORM I300-INSERT-MDINVC.                                  09460000
094700                                                                  09470000
094800*--------------------------------------------------------------*  09480000
094900* MOVE THE DATA TO COMPLETE THE ALCHRG ROW                     *  09490000
095000*--------------------------------------------------------------*  09500000
095100 F700-FILL-ALCHRG.                                                09510000
095200                                                                  09520000
095300     MOVE WS-ALW-CHRG-SEQ-NBR TO ALCHRG-ALW-CHRG-SEQ-NBR.         09530000
095400     MOVE WS-R05-REC(R05-INDX) TO WS-WORK-REC.                    09540000
095500     MOVE WS052-ALLW-CHG-TYPE  TO                                 09550000
095600                         ALCHRG-ALW-CHRG-TYP-CDE.                 09560000
095700     MOVE WS052-ALLW-CHRG-CODE  TO                                09570000
095800                         ALCHRG-ALW-CHRG-CDE.                     09580000
095900     MOVE WS052-SPEC-SRVC-CODE  TO                                09590000
096000                         ALCHRG-ALW-CHRG-SER-CDE.                 09600000
096100     COMPUTE WS-ALLW-CHRG-PCT                                     09610000
096200        =    WS052-ALLW-CHRG-PCT                                  09620000
096300        /    100.                                                 09630000
096400     MOVE WS-ALLW-CHRG-PCT TO ALCHRG-ALW-CHRG-PCT.                09640000
096500     MOVE WS052-ALLW-CHRG-TOTAL  TO                               09650000
096600                         ALCHRG-ALW-CHRG-AMT.                     09660000
096700     PERFORM I600-INSERT-ALCHRG.                                  09670000
096800     COMPUTE WS-ALW-CHRG-SEQ-NBR                                  09680000
096900        =    WS-ALW-CHRG-SEQ-NBR                                  09690000
097000        +    1                                                    09700000
097100     END-COMPUTE.                                                 09710000
097200                                                                  09720000
097300*--------------------------------------------------------------*  09730000
097400* MOVE THE DATA TO COMPLETE THE PREQIT, MIITEM, AND VNDINV     *  09740000
097500* ROWS.  INSER THE THREE TABLES ONCE PER EACH 07 RECORDS --    *  09750000
097600* THERE MAY BE MULTIPLE 07 ITEM ROWS PER INVOICE.              *  09760000
097700*--------------------------------------------------------------*  09770000
097800 F800-FILL-MISC-TABLES.                                           09780000
097900                                                                  09790000
098000     MOVE 1 TO WS-PAYT-REQ-LNE-NBR.                               09800000
098100     MOVE 'I'            TO MIITEM-UNT-COST-SEL-CDE.              09810000
098200     MOVE -1             TO WS-MIITEM-VER-NBR-NULL                09820000
098300                            WS-MIITEM-PO-LNE-NBR-NULL.            09830000
098400                                                                  09840000
098500     PERFORM VARYING R07-INDX FROM 1 BY 1                         09850000
098600       UNTIL R07-INDX > WS-R07-MAX                                09860000
098700          OR WS-R07-KEY-AREA(R07-INDX) = HIGH-VALUES              09870000
098800                                                                  09880000
098900       MOVE WS-PAYT-REQ-LNE-NBR TO PREQIT-PAYT-REQ-LNE-NBR        09890000
099000                                   MIITEM-PAYT-REQ-LNE-NBR        09900000
099100                                   VNDINV-PAYT-REQ-LNE-NBR        09910000
099200       MOVE WS-R07-REC(R07-INDX) TO WS-WORK-REC                   09920000
099300                                                                  09930000
099400       PERFORM F810-FILL-PREQIT                                   09940000
099500                                                                  09950000
099600       IF WS052-PO-LNE-NBR  NOT = ZEROS                           09960000
099700          MOVE WS052-PO-LNE-NBR  TO MIITEM-PO-LNE-NBR             09970000
099800          PERFORM I800-INSERT-MIITEM-PO-LNE                       09980000
099900       ELSE                                                       09990000
100000          PERFORM I850-INSERT-MIITEM-NO-PO-LNE                    10000000
100100          PERFORM F820-FILL-VNDINV                                10010000
100200       END-IF                                                     10020000
100300                                                                  10030000
100400       COMPUTE WS-PAYT-REQ-LNE-NBR = WS-PAYT-REQ-LNE-NBR + 1      10040000
100500                                                                  10050000
100600     END-PERFORM.                                                 10060000
100700                                                                  10070000
100800*--------------------------------------------------------------*  10080000
100900* MOVE THE DATA TO COMPLETE THE PREQIT ROW                     *  10090000
101000*--------------------------------------------------------------*  10100000
101100 F810-FILL-PREQIT.                                                10110000
101200                                                                  10120000
101300     MOVE WS052-QUANTITY-INVOICED  TO                             10130000
101400                           PREQIT-PAY-REQ-LNE-QTY.                10140000
101500     MOVE WS052-IT1-UNIT-MEASURE  TO                              10150000
101600                           PREQIT-QTY-UNT-OF-MSMT.                10160000
101700     MOVE WS052-WHOLSALE-UNIT-COST  TO                            10170000
101800                           PREQIT-UNT-COST-AMT.                   10180000
101900                                                                  10190000
102000     PERFORM I700-INSERT-PREQIT.                                  10200000
102100                                                                  10210000
102200*--------------------------------------------------------------*  10220000
102300* MOVE THE DATA TO COMPLETE THE VNDINV ROW                     *  10230000
102400*--------------------------------------------------------------*  10240000
102500 F820-FILL-VNDINV.                                                10250000
102600                                                                  10260000
102700     MOVE WS052-ID-QUALIFIER  TO  VNDINV-UPC-EAN-QUAL-CDE.        10270000
102800                                                                  10280000
102900     IF WS052-UPC                                                 10290000
103000        MOVE WS052-UPC-CODE TO WS-UPC-12                          10300000
103100        MOVE ZERO           TO WS-UPC-ZERO                        10310000
103200        MOVE WS-UPC-13      TO WS052-EAN-UPC                      10320000
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500     MOVE ZEROS TO VNDINV-UPC-EAN-CDE.                            10350000
103600     MOVE WS052-EAN-CODE  TO                                      10360000
103700                           VNDINV-UPC-EAN-CDE(3:13).              10370000
103800                                                                  10380000
103900     MOVE WS052-VENDOR-STYLE  TO                                  10390000
104000                           VNDINV-VEND-STYL-CDE.                  10400000
104100     MOVE WS052-VENDOR-STYLE-DSCRPT  TO                           10410000
104200                           VNDINV-SKU-DESC.                       10420000
104300     MOVE WS052-NRMA-COLOR-CODE  TO                               10430000
104400                           VNDINV-COLOR-CDE.                      10440000
104500     MOVE WS052-VENDOR-COLOR-DSCRPT  TO                           10450000
104600                           VNDINV-COLOR-DESC.                     10460000
104700     MOVE WS052-NRMA-SIZE-CODE  TO                                10470000
104800                           VNDINV-SIZE-CDE.                       10480000
104900     MOVE WS052-VENDOR-SIZE-DSCRPT  TO                            10490000
105000                           VNDINV-SIZE-DESC.                      10500000
105100                                                                  10510000
105200     MOVE WS052-KOHLS-SKU TO WS-KOHLS-SKU-X.                      10520000
105300     MOVE WS-DEPT-NBR     TO VNDINV-DEPT-NBR.                     10530000
105400     MOVE WS-CL-CDE       TO VNDINV-CL-CDE.                       10540000
105500     MOVE WS-SKU-SEQ-NBR  TO VNDINV-SKU-SEQ-NBR.                  10550000
105600                                                                  10560000
105700     PERFORM I900-INSERT-VNDINV.                                  10570000
105800                                                                  10580000
105900*--------------------------------------------------------------*  10590000
106000* INITIALIZE THE TABLE THAT WILL HOLD THE ENTIRE INVOICE AND   *  10600000
106100* THE AREAS THAT WILL HOLD INFORMATION FOR THE TABLE INSERTS.  *  10610000
106200*--------------------------------------------------------------*  10620000
106300 H100-INITIALIZE.                                                 10630000
106400                                                                  10640000
106500     PERFORM VARYING R04-INDX FROM 1 BY 1                         10650000
106600        UNTIL R04-INDX > WS-R04-MAX                               10660000
106700        MOVE HIGH-VALUES TO WS-R04-KEY-AREA(R04-INDX)             10670000
106800        INITIALIZE WS-R04-DATA-AREA(R04-INDX)                     10680000
106900     END-PERFORM.                                                 10690000
107000                                                                  10700000
107100     PERFORM VARYING R05-INDX FROM 1 BY 1                         10710000
107200        UNTIL R05-INDX > WS-R05-MAX                               10720000
107300        MOVE HIGH-VALUES TO WS-R05-KEY-AREA(R05-INDX)             10730000
107400        INITIALIZE WS-R05-DATA-AREA(R05-INDX)                     10740000
107500     END-PERFORM.                                                 10750000
107600                                                                  10760000
107700     PERFORM VARYING R07-INDX FROM 1 BY 1                         10770000
107800        UNTIL R07-INDX > WS-R07-MAX                               10780000
107900        MOVE HIGH-VALUES TO WS-R07-KEY-AREA(R07-INDX)             10790000
108000        INITIALIZE WS-R07-DATA-AREA(R07-INDX)                     10800000
108100     END-PERFORM.                                                 10810000
108200                                                                  10820000
108300     SET R04-INDX TO 1.                                           10830000
108400     SET R04-INDX DOWN BY 1.                                      10840000
108500     SET R05-INDX TO 1.                                           10850000
108600     SET R05-INDX DOWN BY 1.                                      10860000
108700     SET R07-INDX TO 1.                                           10870000
108800     SET R07-INDX DOWN BY 1.                                      10880000
108900                                                                  10890000
109000     INITIALIZE DCLTALCHRG.                                       10900000
109100     INITIALIZE DCLTINVCTM.                                       10910000
109200     INITIALIZE DCLTINVOIC.                                       10920000
109300     INITIALIZE DCLTMDINVC.                                       10930000
109400     INITIALIZE DCLTPREQIT.                                       10940000
109500     INITIALIZE DCLTMIITEM.                                       10950000
109600     INITIALIZE DCLTVNDINV.                                       10960000
109700     INITIALIZE DCLTCKRSTCNTL.                                    10970000
109800     INITIALIZE DCLTCKRSTINF.                                     10980000
109900                                                                  10990000
110000*--------------------------------------------------------------*  11000000
110100* INSERT THE INVOIC ROW FOR THIS INVOICE NUMBER                *  11010000
110200*--------------------------------------------------------------*  11020000
110300 I200-INSERT-INVOIC.                                              11030000
110400                                                                  11040000
110500* SET THE MAX RETRIES HIGHER HERE SO THAT MORE ATTEMPTS WILL      11050000
110600* BE MADE TO DETERMINE A UNIQUE RANDOM PAYT-REQ-SEQ-NBR           11060000
110700                                                                  11070000
110800     SET INSERT-NOT-SUCCESSFUL TO TRUE.                           11080000
110900                                                                  11090000
111000     PERFORM WITH TEST AFTER                                      11100000
111100             VARYING WS-INSERT-INVC-RETRY-COUNTER FROM 1 BY 1     11110000
111200             UNTIL   WS-INSERT-INVC-RETRY-COUNTER > 100           11120000
111300                OR   INSERT-SUCCESSFUL                            11130000
111400                                                                  11140000
111500             EXEC SQL                                             11150000
111600                 INSERT INTO TINVOIC                              11160000
111700                    ( PO_NBR                                      11170000
111800                     ,INVC_ID                                     11180000
111900                     ,PAYT_REQ_SEQ_NBR                            11190000
112000                     ,INVC_TYP_CDE                                11200000
112100                     ,ENTR_MTHD_CDE                               11210000
112200                     ,CRE_BY_USR_ID                               11220000
112300                     ,BAR_CDE                                     11230000
112400                     ,SPLIT_TERMS_IND                             11240000
112500                     ,DTL_ENTR_IND                                11250000
112600                     ,INVC_CART_CT                                11260000
112700                     ,CRE_DTE                                     11270000
112800                     ,PPD_RVRSL_IND                               11280000
112900                     ,INVC_DTE                                    11290000
113000                     ,GRO_COST_AMT                                11300000
113100                     ,INVC_NET_COST_AMT                           11310000
113200                     ,RMIT_VND_ID                                 11320000
113300                     ,STR_NBR                                     11330000
113400                     ,HOLD_IND                                    11340000
113500                     ,DUE_DTE_SRC_CDE                             11350000
113600                     ,CALC_DUE_DTE                                11360000
113700                     ,PAYT_DTE                                    11370000
113800                     ,AP_PRC_DTE                                  11380000
113900                     ,AP_PRC_CDE                                  11390000
114000                     ,PAYT_RLSE_TMST                              11400000
114100                     ,STATUS_CDE                                  11410000
114200                     ,STATUS_CHG_TMST                             11420000
114300                     ,DC_NBR                                      11430000
114400                     ,MTCH_LVL_CDE)                               11440000
114500                 VALUES                                           11450000
114600                     (:INVOIC-PO-NBR                              11460000
114700                     ,:INVOIC-INVC-ID                             11470000
114800                     ,:INVOIC-PAYT-REQ-SEQ-NBR                    11480000
114900                     ,:INVOIC-INVC-TYP-CDE                        11490000
115000                     ,:INVOIC-ENTR-MTHD-CDE                       11500000
115100                     ,:INVOIC-CRE-BY-USR-ID                       11510000
115200                     ,:INVOIC-BAR-CDE                             11520000
115300                     ,:INVOIC-SPLIT-TERMS-IND                     11530000
115400                     ,:INVOIC-DTL-ENTR-IND                        11540000
115500                     ,:INVOIC-INVC-CART-CT                        11550000
115600                     ,:INVOIC-CRE-DTE                             11560000
115700                     ,:INVOIC-PPD-RVRSL-IND                       11570000
115800                     ,:INVOIC-INVC-DTE                            11580000
115900                     ,:INVOIC-GRO-COST-AMT                        11590000
116000                     ,:INVOIC-INVC-NET-COST-AMT                   11600000
116100                     ,:INVOIC-RMIT-VND-ID                         11610000
116200                     ,:INVOIC-STR-NBR                             11620000
116300                     ,:INVOIC-HOLD-IND                            11630000
116400                     ,:INVOIC-DUE-DTE-SRC-CDE                     11640000
116500                     ,:INVOIC-CALC-DUE-DTE                        11650000
116600                     ,:INVOIC-PAYT-DTE                            11660000
116700                     ,:INVOIC-AP-PRC-DTE                          11670000
116800                     ,:INVOIC-AP-PRC-CDE                          11680000
116900                     ,:INVOIC-PAYT-RLSE-TMST                      11690000
117000                     ,:INVOIC-STATUS-CDE                          11700000
117100                     , CURRENT TIMESTAMP                          11710000
117200                     ,:INVOIC-DC-NBR                              11720000
117300                     ,:INVOIC-MTCH-LVL-CDE)                       11730000
117400             END-EXEC                                             11740000
117500                                                                  11750000
117600             EVALUATE TRUE                                        11760000
117700                 WHEN SQLCODE = ZERO                              11770000
117800                      SET INSERT-SUCCESSFUL TO TRUE               11780000
117900                 WHEN SQLCODE = -904                              11790000
118000                 WHEN SQLCODE = -913                              11800000
118100                      CONTINUE                                    11810000
118200                 WHEN SQLCODE = -803                              11820000
118300                      MOVE WS-INSERT-INVC-RETRY-COUNTER TO        11830000
118400                                    WS-DISPLAY-RETRY-COUNTER      11840000
118500                      DISPLAY 'DUPLICATE INVOIC:'                 11850000
118600                          ' PO: ' INVOIC-PO-NBR                   11860000
118700                          ' INVC ID: ' INVOIC-INVC-ID             11870000
118800                          ' PAYREQ: ' INVOIC-PAYT-REQ-SEQ-NBR     11880000
118900                          ' RETRY#: ' WS-DISPLAY-RETRY-COUNTER    11890000
119000                      PERFORM R200-DETERMINE-PAYT-NBR             11900000
119100                 WHEN SQLWARN0 NOT = SPACES                       11910000
119200                 WHEN SQLCODE  NOT = ZERO                         11920000
119300                      MOVE 'I200-INSERT-TINVOIC '                 11930000
119400                                      TO WS-ABEND-PARAGRAPH       11940000
119500                      MOVE 'UNSUCCESSFUL INSERT INVOIC  ROW'      11950000
119600                                      TO WS-ABEND-OPERATION       11960000
119700                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     11970000
119800                      PERFORM Z999-SQL-ERROR                      11980000
119900             END-EVALUATE                                         11990000
120000     END-PERFORM.                                                 12000000
120100                                                                  12010000
120200     IF WS-INSERT-INVC-RETRY-COUNTER > 100                        12020000
120300         MOVE 'I200-INSERT-TINVOIC '                              12030000
120400                         TO WS-ABEND-PARAGRAPH                    12040000
120500         MOVE 'MAX RETRIES EXCEEDED ON INSERT  INVOIC ROW'        12050000
120600                         TO WS-ABEND-OPERATION                    12060000
120700         MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1                  12070000
120800         PERFORM Z999-SQL-ERROR                                   12080000
120900     END-IF.                                                      12090000
121000                                                                  12100000
121100     EVALUATE TRUE                                                12110000
121200        WHEN SQLCODE = ZEROS                                      12120000
121300             CONTINUE                                             12130000
121400        WHEN OTHER                                                12140000
121500             MOVE 'I200-INSERT-TINVOIC           ' TO             12150000
121600                                       WS-ABEND-PARAGRAPH         12160000
121700             MOVE 'UNSUCCESSFUL INSERT  INVOIC ROW'               12170000
121800                             TO WS-ABEND-OPERATION                12180000
121900             MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1              12190000
122000             PERFORM Z999-SQL-ERROR                               12200000
122100     END-EVALUATE.                                                12210000
122200                                                                  12220000
122300*--------------------------------------------------------------*  12230000
122400* INSERT THE MDVINC ROW FOR THIS INVOICE NUMBER                *  12240000
122500*--------------------------------------------------------------*  12250000
122600 I300-INSERT-MDINVC.                                              12260000
122700                                                                  12270000
122800     PERFORM WITH TEST AFTER                                      12280000
122900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 12290000
123000             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         12300000
123100                     SQLCODE = ZERO                               12310000
123200                                                                  12320000
123300             EXEC SQL                                             12330000
123400                 INSERT INTO TMDINVC                              12340000
123500                    ( PO_NBR                                      12350000
123600                     ,INVC_ID                                     12360000
123700                     ,BOL_ID                                      12370000
123800                     ,VEND_FRGT_PCT                               12380000
123900                     ,KOHLS_FRGT_PCT                              12390000
124000                     ,TERM_SEL_CDE                                12400000
124100                     ,TOT_INVC_PC_QTY                             12410000
124200                     ,IMPRT_CHRG_PRC_CDE                          12420000
124300                     ,PAYT_REQ_SEQ_NBR )                          12430000
124400                 VALUES                                           12440000
124500                     (:MDINVC-PO-NBR                              12450000
124600                     ,:MDINVC-INVC-ID                             12460000
124700                     ,:MDINVC-BOL-ID                              12470000
124800                     ,:MDINVC-VEND-FRGT-PCT                       12480000
124900                     ,:MDINVC-KOHLS-FRGT-PCT                      12490000
125000                     ,:MDINVC-TERM-SEL-CDE                        12500000
125100                     ,:MDINVC-TOT-INVC-PC-QTY                     12510000
125200                     ,:MDINVC-IMPRT-CHRG-PRC-CDE                  12520000
125300                     ,:MDINVC-PAYT-REQ-SEQ-NBR)                   12530000
125400             END-EXEC                                             12540000
125500                                                                  12550000
125600             EVALUATE TRUE                                        12560000
125700                 WHEN SQLCODE = ZERO                              12570000
125800                 WHEN SQLCODE = -904                              12580000
125900                 WHEN SQLCODE = -913                              12590000
126000                      CONTINUE                                    12600000
126100                                                                  12610000
126200                 WHEN SQLWARN0 NOT = SPACES                       12620000
126300                 WHEN SQLCODE  NOT = ZERO                         12630000
126400                      MOVE 'I300-INSERT-TMDVINC '                 12640000
126500                                      TO WS-ABEND-PARAGRAPH       12650000
126600                      MOVE 'UNSUCCESSFUL INSERT MDVINC  ROW'      12660000
126700                                      TO WS-ABEND-OPERATION       12670000
126800                      MOVE 'TMDVINC ' TO WS-ABEND-STRUCTURE-1     12680000
126900                      PERFORM Z999-SQL-ERROR                      12690000
127000             END-EVALUATE                                         12700000
127100     END-PERFORM.                                                 12710000
127200                                                                  12720000
127300     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         12730000
127400         MOVE 'I300-INSERT-TMDVINC '                              12740000
127500                         TO WS-ABEND-PARAGRAPH                    12750000
127600         MOVE 'MAX RETRIES EXCEEDED ON INSERT  MDVINC ROW'        12760000
127700                         TO WS-ABEND-OPERATION                    12770000
127800         MOVE 'TMDVINC ' TO WS-ABEND-STRUCTURE-1                  12780000
127900         PERFORM Z999-SQL-ERROR                                   12790000
128000     END-IF.                                                      12800000
128100                                                                  12810000
128200     EVALUATE TRUE                                                12820000
128300        WHEN SQLCODE = ZEROS                                      12830000
128400             CONTINUE                                             12840000
128500        WHEN OTHER                                                12850000
128600             MOVE 'I300-INSERT-TMDVINC           ' TO             12860000
128700                                       WS-ABEND-PARAGRAPH         12870000
128800             MOVE 'UNSUCCESSFUL INSERT  MDVINC ROW'               12880000
128900                             TO WS-ABEND-OPERATION                12890000
129000             MOVE 'TMDVINC ' TO WS-ABEND-STRUCTURE-1              12900000
129100             PERFORM Z999-SQL-ERROR                               12910000
129200     END-EVALUATE.                                                12920000
129300                                                                  12930000
129400*--------------------------------------------------------------*  12940000
129500* INSERT THE INVCTM ROW FOR THIS INVOICE NUMBER                *  12950000
129600*--------------------------------------------------------------*  12960000
129700 I500-INSERT-INVCTM.                                              12970000
129800                                                                  12980000
129900     PERFORM WITH TEST AFTER                                      12990000
130000             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 13000000
130100             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         13010000
130200                     SQLCODE = ZERO                               13020000
130300                                                                  13030000
130400             EXEC SQL                                             13040000
130500                 INSERT INTO TINVCTM                              13050000
130600                    ( PO_NBR                                      13060000
130700                     ,INVC_ID                                     13070000
130800                     ,TERM_SEQ_NBR                                13080000
130900                     ,TERM_TYP_CDE                                13090000
131000                     ,TERM_BASIS_DTE_CDE                          13100000
131100                     ,EFF_DTE                                     13110000
131200                     ,DISC_PCT                                    13120000
131300                     ,DISC_AMT                                    13130000
131400                     ,DISC_DUE_DTE                                13140000
131500                     ,DISC_DUE_DAY_QTY                            13150000
131600                     ,NET_DUE_DTE                                 13160000
131700                     ,NET_DUE_DAY_QTY                             13170000
131800                     ,EXTD_DAYS_QTY)                              13180000
131900                 VALUES                                           13190000
132000                     (:INVCTM-PO-NBR                              13200000
132100                     ,:INVCTM-INVC-ID                             13210000
132200                     ,:INVCTM-TERM-SEQ-NBR                        13220000
132300                     ,:INVCTM-TERM-TYP-CDE                        13230000
132400                     ,:INVCTM-TERM-BASIS-DTE-CDE                  13240000
132500                     ,:INVCTM-EFF-DTE                             13250000
132600                     ,:INVCTM-DISC-PCT                            13260000
132700                     ,:INVCTM-DISC-AMT                            13270000
132800                     ,:INVCTM-DISC-DUE-DTE                        13280000
132900                     ,:INVCTM-DISC-DUE-DAY-QTY                    13290000
133000                     ,:INVCTM-NET-DUE-DTE                         13300000
133100                     ,:INVCTM-NET-DUE-DAY-QTY                     13310000
133200                     ,:INVCTM-EXTD-DAYS-QTY)                      13320000
133300             END-EXEC                                             13330000
133400                                                                  13340000
133500             EVALUATE TRUE                                        13350000
133600                 WHEN SQLCODE = ZERO                              13360000
133700                 WHEN SQLCODE = -904                              13370000
133800                 WHEN SQLCODE = -913                              13380000
133900                      CONTINUE                                    13390000
134000                                                                  13400000
134100                 WHEN SQLWARN0 NOT = SPACES                       13410000
134200                 WHEN SQLCODE  NOT = ZERO                         13420000
134300                      MOVE 'I500-INSERT-TINVCTM '                 13430000
134400                                      TO WS-ABEND-PARAGRAPH       13440000
134500                      MOVE 'UNSUCCESSFUL INSERT INVCTM  ROW'      13450000
134600                                      TO WS-ABEND-OPERATION       13460000
134700                      MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1     13470000
134800                      PERFORM Z999-SQL-ERROR                      13480000
134900             END-EVALUATE                                         13490000
135000     END-PERFORM.                                                 13500000
135100                                                                  13510000
135200     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         13520000
135300         MOVE 'I500-INSERT-TINVCTM '                              13530000
135400                         TO WS-ABEND-PARAGRAPH                    13540000
135500         MOVE 'MAX RETRIES EXCEEDED ON INSERT  INVCTM ROW'        13550000
135600                         TO WS-ABEND-OPERATION                    13560000
135700         MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1                  13570000
135800         PERFORM Z999-SQL-ERROR                                   13580000
135900     END-IF.                                                      13590000
136000                                                                  13600000
136100     EVALUATE TRUE                                                13610000
136200        WHEN SQLCODE = ZEROS                                      13620000
136300             CONTINUE                                             13630000
136400        WHEN OTHER                                                13640000
136500             MOVE 'I500-INSERT-TINVCTM           ' TO             13650000
136600                                       WS-ABEND-PARAGRAPH         13660000
136700             MOVE 'UNSUCCESSFUL INSERT  INVCTM ROW'               13670000
136800                             TO WS-ABEND-OPERATION                13680000
136900             MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1              13690000
137000             PERFORM Z999-SQL-ERROR                               13700000
137100     END-EVALUATE.                                                13710000
137200                                                                  13720000
137300*--------------------------------------------------------------*  13730000
137400* INSERT THE ALCHRG ROW FOR THIS INVOICE NUMBER                *  13740000
137500*--------------------------------------------------------------*  13750000
137600 I600-INSERT-ALCHRG.                                              13760000
137700                                                                  13770000
137800     PERFORM WITH TEST AFTER                                      13780000
137900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 13790000
138000             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         13800000
138100                     SQLCODE = ZERO                               13810000
138200                                                                  13820000
138300             EXEC SQL                                             13830000
138400                 INSERT INTO TALCHRG                              13840000
138500                    ( PO_NBR                                      13850000
138600                     ,INVC_ID                                     13860000
138700                     ,ALW_CHRG_SEQ_NBR                            13870000
138800                     ,ALW_CHRG_TYP_CDE                            13880000
138900                     ,ALW_CHRG_CDE                                13890000
139000                     ,ALW_CHRG_SER_CDE                            13900000
139100                     ,ALW_CHRG_PCT                                13910000
139200                     ,ALW_CHRG_AMT)                               13920000
139300                 VALUES                                           13930000
139400                     (:ALCHRG-PO-NBR                              13940000
139500                     ,:ALCHRG-INVC-ID                             13950000
139600                     ,:ALCHRG-ALW-CHRG-SEQ-NBR                    13960000
139700                     ,:ALCHRG-ALW-CHRG-TYP-CDE                    13970000
139800                     ,:ALCHRG-ALW-CHRG-CDE                        13980000
139900                     ,:ALCHRG-ALW-CHRG-SER-CDE                    13990000
140000                     ,:ALCHRG-ALW-CHRG-PCT                        14000000
140100                     ,:ALCHRG-ALW-CHRG-AMT)                       14010000
140200             END-EXEC                                             14020000
140300                                                                  14030000
140400             EVALUATE TRUE                                        14040000
140500                 WHEN SQLCODE = ZERO                              14050000
140600                 WHEN SQLCODE = -904                              14060000
140700                 WHEN SQLCODE = -913                              14070000
140800                      CONTINUE                                    14080000
140900                                                                  14090000
141000                 WHEN SQLWARN0 NOT = SPACES                       14100000
141100                 WHEN SQLCODE  NOT = ZERO                         14110000
141200                      MOVE 'I600-INSERT-TALCHRG '                 14120000
141300                                      TO WS-ABEND-PARAGRAPH       14130000
141400                      MOVE 'UNSUCCESSFUL INSERT ALCHRG  ROW'      14140000
141500                                      TO WS-ABEND-OPERATION       14150000
141600                      MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1     14160000
141700                      PERFORM Z999-SQL-ERROR                      14170000
141800             END-EVALUATE                                         14180000
141900     END-PERFORM.                                                 14190000
142000                                                                  14200000
142100     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         14210000
142200         MOVE 'I600-INSERT-TALCHRG '                              14220000
142300                         TO WS-ABEND-PARAGRAPH                    14230000
142400         MOVE 'MAX RETRIES EXCEEDED ON INSERT  ALCHRG ROW'        14240000
142500                         TO WS-ABEND-OPERATION                    14250000
142600         MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1                  14260000
142700         PERFORM Z999-SQL-ERROR                                   14270000
142800     END-IF.                                                      14280000
142900                                                                  14290000
143000     EVALUATE TRUE                                                14300000
143100        WHEN SQLCODE = ZEROS                                      14310000
143200             CONTINUE                                             14320000
143300        WHEN OTHER                                                14330000
143400             MOVE 'I600-INSERT-TALCHRG           ' TO             14340000
143500                                       WS-ABEND-PARAGRAPH         14350000
143600             MOVE 'UNSUCCESSFUL INSERT  ALCHRG ROW'               14360000
143700                             TO WS-ABEND-OPERATION                14370000
143800             MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1              14380000
143900             PERFORM Z999-SQL-ERROR                               14390000
144000     END-EVALUATE.                                                14400000
144100                                                                  14410000
144200*--------------------------------------------------------------*  14420000
144300* INSERT THE PREQIT ROW FOR THIS INVOICE NUMBER                *  14430000
144400*--------------------------------------------------------------*  14440000
144500 I700-INSERT-PREQIT.                                              14450000
144600                                                                  14460000
144700     PERFORM WITH TEST AFTER                                      14470000
144800             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 14480000
144900             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         14490000
145000                     SQLCODE = ZERO                               14500000
145100                                                                  14510000
145200             EXEC SQL                                             14520000
145300                 INSERT INTO TPREQIT                              14530000
145400                    ( PAYT_REQ_SEQ_NBR                            14540000
145500                     ,PAYT_REQ_LNE_NBR                            14550000
145600                     ,PAY_REQ_LNE_QTY                             14560000
145700                     ,QTY_UNT_OF_MSMT                             14570000
145800                     ,UNT_COST_AMT)                               14580000
145900                 VALUES                                           14590000
146000                     (:PREQIT-PAYT-REQ-SEQ-NBR                    14600000
146100                     ,:PREQIT-PAYT-REQ-LNE-NBR                    14610000
146200                     ,:PREQIT-PAY-REQ-LNE-QTY                     14620000
146300                     ,:PREQIT-QTY-UNT-OF-MSMT                     14630000
146400                     ,:PREQIT-UNT-COST-AMT)                       14640000
146500             END-EXEC                                             14650000
146600                                                                  14660000
146700             EVALUATE TRUE                                        14670000
146800                 WHEN SQLCODE = ZERO                              14680000
146900                 WHEN SQLCODE = -904                              14690000
147000                 WHEN SQLCODE = -913                              14700000
147100                      CONTINUE                                    14710000
147200                                                                  14720000
147300                 WHEN SQLWARN0 NOT = SPACES                       14730000
147400                 WHEN SQLCODE  NOT = ZERO                         14740000
147500                      MOVE 'I700-INSERT-TPREQIT '                 14750000
147600                                      TO WS-ABEND-PARAGRAPH       14760000
147700                      MOVE 'UNSUCCESSFUL INSERT PREQIT  ROW'      14770000
147800                                      TO WS-ABEND-OPERATION       14780000
147900                      MOVE 'TPREQIT ' TO WS-ABEND-STRUCTURE-1     14790000
148000                      PERFORM Z999-SQL-ERROR                      14800000
148100             END-EVALUATE                                         14810000
148200     END-PERFORM.                                                 14820000
148300                                                                  14830000
148400     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         14840000
148500         MOVE 'I700-INSERT-TPREQIT '                              14850000
148600                         TO WS-ABEND-PARAGRAPH                    14860000
148700         MOVE 'MAX RETRIES EXCEEDED ON INSERT  PREQIT ROW'        14870000
148800                         TO WS-ABEND-OPERATION                    14880000
148900         MOVE 'TPREQIT ' TO WS-ABEND-STRUCTURE-1                  14890000
149000         PERFORM Z999-SQL-ERROR                                   14900000
149100     END-IF.                                                      14910000
149200                                                                  14920000
149300     EVALUATE TRUE                                                14930000
149400        WHEN SQLCODE = ZEROS                                      14940000
149500             CONTINUE                                             14950000
149600        WHEN OTHER                                                14960000
149700             MOVE 'I700-INSERT-TPREQIT           ' TO             14970000
149800                                       WS-ABEND-PARAGRAPH         14980000
149900             MOVE 'UNSUCCESSFUL INSERT  PREQIT ROW'               14990000
150000                             TO WS-ABEND-OPERATION                15000000
150100             MOVE 'TPREQIT ' TO WS-ABEND-STRUCTURE-1              15010000
150200             PERFORM Z999-SQL-ERROR                               15020000
150300     END-EVALUATE.                                                15030000
150400                                                                  15040000
150500*--------------------------------------------------------------*  15050000
150600* INSERT THE MIITEM ROW FOR THIS INVOICE NUMBER.  THIS INSERT  *  15060000
150700* IS AN ITEM WITH A PO-LNE-NBR AVAILABLE.                      *  15070000
150800*--------------------------------------------------------------*  15080000
150900 I800-INSERT-MIITEM-PO-LNE.                                       15090000
151000                                                                  15100000
151100     PERFORM WITH TEST AFTER                                      15110000
151200             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 15120000
151300             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         15130000
151400                     SQLCODE = ZERO                               15140000
151500                                                                  15150000
151600             EXEC SQL                                             15160000
151700                 INSERT INTO TMIITEM                              15170000
151800                    ( PAYT_REQ_SEQ_NBR                            15180000
151900                     ,PAYT_REQ_LNE_NBR                            15190000
152000                     ,UNT_COST_SEL_CDE                            15200000
152100                     ,PO_NBR                                      15210000
152200                     ,VER_NBR                                     15220000
152300                     ,PO_LNE_NBR)                                 15230000
152400                 VALUES                                           15240000
152500                     (:MIITEM-PAYT-REQ-SEQ-NBR                    15250000
152600                     ,:MIITEM-PAYT-REQ-LNE-NBR                    15260000
152700                     ,:MIITEM-UNT-COST-SEL-CDE                    15270000
152800                     ,:MIITEM-PO-NBR                              15280000
152900                     ,:MIITEM-VER-NBR :WS-MIITEM-VER-NBR-NULL     15290000
153000                     ,:MIITEM-PO-LNE-NBR)                         15300000
153100             END-EXEC                                             15310000
153200                                                                  15320000
153300             EVALUATE TRUE                                        15330000
153400                 WHEN SQLCODE = ZERO                              15340000
153500                 WHEN SQLCODE = -904                              15350000
153600                 WHEN SQLCODE = -913                              15360000
153700                      CONTINUE                                    15370000
153800                                                                  15380000
153900                 WHEN SQLWARN0 NOT = SPACES                       15390000
154000                 WHEN SQLCODE  NOT = ZERO                         15400000
154100                      MOVE 'I800-INSERT-TMIITEM  '                15410000
154200                                      TO WS-ABEND-PARAGRAPH       15420000
154300                      MOVE 'UNSUCCESSFUL INSERT MIITEM  ROW'      15430000
154400                                      TO WS-ABEND-OPERATION       15440000
154500                      MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1    15450000
154600                      PERFORM Z999-SQL-ERROR                      15460000
154700             END-EVALUATE                                         15470000
154800     END-PERFORM.                                                 15480000
154900                                                                  15490000
155000     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         15500000
155100         MOVE 'I800-INSERT-TMIITEM  '                             15510000
155200                         TO WS-ABEND-PARAGRAPH                    15520000
155300         MOVE 'MAX RETRIES EXCEEDED ON INSERT  MIITEM ROW'        15530000
155400                         TO WS-ABEND-OPERATION                    15540000
155500         MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1                 15550000
155600         PERFORM Z999-SQL-ERROR                                   15560000
155700     END-IF.                                                      15570000
155800                                                                  15580000
155900     EVALUATE TRUE                                                15590000
156000        WHEN SQLCODE = ZEROS                                      15600000
156100             CONTINUE                                             15610000
156200        WHEN OTHER                                                15620000
156300             MOVE 'I800-INSERT-TMIITEM            ' TO            15630000
156400                                       WS-ABEND-PARAGRAPH         15640000
156500             MOVE 'UNSUCCESSFUL INSERT  MIITEM ROW'               15650000
156600                             TO WS-ABEND-OPERATION                15660000
156700             MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1             15670000
156800             PERFORM Z999-SQL-ERROR                               15680000
156900     END-EVALUATE.                                                15690000
157000                                                                  15700000
157100*--------------------------------------------------------------*  15710000
157200* INSERT THE MIITEM ROW FOR THIS INVOICE NUMBER.  THIS INSERT  *  15720000
157300* IS AN ITEM WITH NO PO-LNE-NBR AVAILABLE.                     *  15730000
157400*--------------------------------------------------------------*  15740000
157500 I850-INSERT-MIITEM-NO-PO-LNE.                                    15750000
157600                                                                  15760000
157700     PERFORM WITH TEST AFTER                                      15770000
157800             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 15780000
157900             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         15790000
158000                     SQLCODE = ZERO                               15800000
158100                                                                  15810000
158200             EXEC SQL                                             15820000
158300                 INSERT INTO TMIITEM                              15830000
158400                    ( PAYT_REQ_SEQ_NBR                            15840000
158500                     ,PAYT_REQ_LNE_NBR                            15850000
158600                     ,UNT_COST_SEL_CDE                            15860000
158700                     ,PO_NBR                                      15870000
158800                     ,VER_NBR                                     15880000
158900                     ,PO_LNE_NBR)                                 15890000
159000                 VALUES                                           15900000
159100                     (:MIITEM-PAYT-REQ-SEQ-NBR                    15910000
159200                     ,:MIITEM-PAYT-REQ-LNE-NBR                    15920000
159300                     ,:MIITEM-UNT-COST-SEL-CDE                    15930000
159400                     ,:MIITEM-PO-NBR                              15940000
159500                     ,:MIITEM-VER-NBR :WS-MIITEM-VER-NBR-NULL     15950000
159600                     ,:MIITEM-PO-LNE-NBR                          15960000
159700                      :WS-MIITEM-PO-LNE-NBR-NULL)                 15970000
159800             END-EXEC                                             15980000
159900                                                                  15990000
160000             EVALUATE TRUE                                        16000000
160100                 WHEN SQLCODE = ZERO                              16010000
160200                 WHEN SQLCODE = -904                              16020000
160300                 WHEN SQLCODE = -913                              16030000
160400                      CONTINUE                                    16040000
160500                                                                  16050000
160600                 WHEN SQLWARN0 NOT = SPACES                       16060000
160700                 WHEN SQLCODE  NOT = ZERO                         16070000
160800                      MOVE 'I850-INSERT-TMIITEM  '                16080000
160900                                      TO WS-ABEND-PARAGRAPH       16090000
161000                      MOVE 'UNSUCCESSFUL INSERT MIITEM  ROW'      16100000
161100                                      TO WS-ABEND-OPERATION       16110000
161200                      MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1    16120000
161300                      PERFORM Z999-SQL-ERROR                      16130000
161400             END-EVALUATE                                         16140000
161500     END-PERFORM.                                                 16150000
161600                                                                  16160000
161700     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         16170000
161800         MOVE 'I850-INSERT-TMIITEM  '                             16180000
161900                         TO WS-ABEND-PARAGRAPH                    16190000
162000         MOVE 'MAX RETRIES EXCEEDED ON INSERT  MIITEM ROW'        16200000
162100                         TO WS-ABEND-OPERATION                    16210000
162200         MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1                 16220000
162300         PERFORM Z999-SQL-ERROR                                   16230000
162400     END-IF.                                                      16240000
162500                                                                  16250000
162600     EVALUATE TRUE                                                16260000
162700        WHEN SQLCODE = ZEROS                                      16270000
162800             CONTINUE                                             16280000
162900        WHEN OTHER                                                16290000
163000             MOVE 'I850-INSERT-TMIITEM            ' TO            16300000
163100                                       WS-ABEND-PARAGRAPH         16310000
163200             MOVE 'UNSUCCESSFUL INSERT  MIITEM ROW'               16320000
163300                             TO WS-ABEND-OPERATION                16330000
163400             MOVE 'TMIITEM  ' TO WS-ABEND-STRUCTURE-1             16340000
163500             PERFORM Z999-SQL-ERROR                               16350000
163600     END-EVALUATE.                                                16360000
163700                                                                  16370000
163800*--------------------------------------------------------------*  16380000
163900* INSERT THE VNDINV ROW FOR THIS INVOICE NUMBER                *  16390000
164000*--------------------------------------------------------------*  16400000
164100 I900-INSERT-VNDINV.                                              16410000
164200                                                                  16420000
164300     PERFORM WITH TEST AFTER                                      16430000
164400             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 16440000
164500             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         16450000
164600                     SQLCODE = ZERO                               16460000
164700                                                                  16470000
164800             EXEC SQL                                             16480000
164900                 INSERT INTO TVNDINV                              16490000
165000                    ( PAYT_REQ_SEQ_NBR                            16500000
165100                     ,PAYT_REQ_LNE_NBR                            16510000
165200                     ,UPC_EAN_QUAL_CDE                            16520000
165300                     ,UPC_EAN_CDE                                 16530000
165400                     ,VEND_STYL_CDE                               16540000
165500                     ,COLOR_CDE                                   16550000
165600                     ,COLOR_DESC                                  16560000
165700                     ,SIZE_CDE                                    16570000
165800                     ,SIZE_DESC                                   16580000
165900                     ,SKU_DESC                                    16590000
166000                     ,DEPT_NBR                                    16600000
166100                     ,CL_CDE                                      16610000
166200                     ,SKU_SEQ_NBR)                                16620000
166300                 VALUES                                           16630000
166400                     (:VNDINV-PAYT-REQ-SEQ-NBR                    16640000
166500                     ,:VNDINV-PAYT-REQ-LNE-NBR                    16650000
166600                     ,:VNDINV-UPC-EAN-QUAL-CDE                    16660000
166700                     ,:VNDINV-UPC-EAN-CDE                         16670000
166800                     ,:VNDINV-VEND-STYL-CDE                       16680000
166900                     ,:VNDINV-COLOR-CDE                           16690000
167000                     ,:VNDINV-COLOR-DESC                          16700000
167100                     ,:VNDINV-SIZE-CDE                            16710000
167200                     ,:VNDINV-SIZE-DESC                           16720000
167300                     ,:VNDINV-SKU-DESC                            16730000
167400                     ,:VNDINV-DEPT-NBR                            16740000
167500                     ,:VNDINV-CL-CDE                              16750000
167600                     ,:VNDINV-SKU-SEQ-NBR)                        16760000
167700             END-EXEC                                             16770000
167800                                                                  16780000
167900             EVALUATE TRUE                                        16790000
168000                 WHEN SQLCODE = ZERO                              16800000
168100                 WHEN SQLCODE = -904                              16810000
168200                 WHEN SQLCODE = -913                              16820000
168300                      CONTINUE                                    16830000
168400                                                                  16840000
168500                 WHEN SQLWARN0 NOT = SPACES                       16850000
168600                 WHEN SQLCODE  NOT = ZERO                         16860000
168700                      MOVE 'I900-INSERT-TVNDINV '                 16870000
168800                                      TO WS-ABEND-PARAGRAPH       16880000
168900                      MOVE 'UNSUCCESSFUL INSERT VNDINV  ROW'      16890000
169000                                      TO WS-ABEND-OPERATION       16900000
169100                      MOVE 'TVNDINV ' TO WS-ABEND-STRUCTURE-1     16910000
169200                      PERFORM Z999-SQL-ERROR                      16920000
169300             END-EVALUATE                                         16930000
169400     END-PERFORM.                                                 16940000
169500                                                                  16950000
169600     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         16960000
169700         MOVE 'I900-INSERT-TVNDINV '                              16970000
169800                         TO WS-ABEND-PARAGRAPH                    16980000
169900         MOVE 'MAX RETRIES EXCEEDED ON INSERT  VNDINV ROW'        16990000
170000                         TO WS-ABEND-OPERATION                    17000000
170100         MOVE 'TVNDINV ' TO WS-ABEND-STRUCTURE-1                  17010000
170200         PERFORM Z999-SQL-ERROR                                   17020000
170300     END-IF.                                                      17030000
170400                                                                  17040000
170500     EVALUATE TRUE                                                17050000
170600        WHEN SQLCODE = ZEROS                                      17060000
170700             CONTINUE                                             17070000
170800        WHEN OTHER                                                17080000
170900             MOVE 'I900-INSERT-TVNDINV           ' TO             17090000
171000                                       WS-ABEND-PARAGRAPH         17100000
171100             MOVE 'UNSUCCESSFUL INSERT  VNDINV ROW'               17110000
171200                             TO WS-ABEND-OPERATION                17120000
171300             MOVE 'TVNDINV ' TO WS-ABEND-STRUCTURE-1              17130000
171400             PERFORM Z999-SQL-ERROR                               17140000
171500     END-EVALUATE.                                                17150000
171600                                                                  17160000
171700*--------------------------------------------------------------*  17170000
171800* READ THE EDI PRODUCTION FILE INTO WORKING STORAGE COPYBOOK   *  17180000
171900*--------------------------------------------------------------*  17190000
172000 R100-READ-AP052.                                                 17200000
172100                                                                  17210000
172200     READ EDIIN-AP052-FILE INTO AP052-EDI-IN-FILE                 17220000
172300          AT END      SET END-OF-EDIIN TO TRUE.                   17230000
172400                                                                  17240000
172500     IF NOT END-OF-EDIIN                                          17250000
172600        ADD 1 TO WS-EDIIN-REC-CNT                                 17260000
172700     END-IF.                                                      17270000
172800                                                                  17280000
172900*--------------------------------------------------------------*  17290000
173000* DETERMINE A RANDOM PAYT-REQ-SEQ-NBR                          *  17300000
173100*--------------------------------------------------------------*  17310000
173200 R200-DETERMINE-PAYT-NBR.                                         17320000
173300                                                                  17330000
173400     PERFORM WITH TEST AFTER                                      17340000
173500             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 17350000
173600             UNTIL   WS-RETRY-COUNTER > 3  OR                     17360000
173700                     SQLCODE = ZERO                               17370000
173800                                                                  17380000
173900             EXEC SQL                                             17390000
174000                 SET  :WS-TIMESTAMP = CURRENT TIMESTAMP           17400000
174100             END-EXEC                                             17410000
174200                                                                  17420000
174300             EVALUATE TRUE                                        17430000
174400                 WHEN SQLCODE = ZERO                              17440000
174500                 WHEN SQLCODE = -904                              17450000
174600                 WHEN SQLCODE = -913                              17460000
174700                      CONTINUE                                    17470000
174800                                                                  17480000
174900                 WHEN SQLWARN0 NOT = SPACES                       17490000
175000                 WHEN SQLCODE  NOT = ZERO                         17500000
175100                      MOVE 'R200-DETERMINE-PAYT-NBR           '   17510000
175200                                    TO WS-ABEND-PARAGRAPH         17520000
175300                      MOVE 'UNSUCCESSFUL SET TIMESTAMP'           17530000
175400                                    TO WS-ABEND-OPERATION         17540000
175500                      MOVE SPACES     TO WS-ABEND-STRUCTURE-1     17550000
175600                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     17560000
175700                      PERFORM Z999-SQL-ERROR                      17570000
175800             END-EVALUATE                                         17580000
175900     END-PERFORM.                                                 17590000
176000                                                                  17600000
176100     IF WS-RETRY-COUNTER > 3                                      17610000
176200         MOVE 'R200-DETERMINE-PAYT-NBR           '                17620000
176300                       TO WS-ABEND-PARAGRAPH                      17630000
176400         MOVE 'MAX RETRIES EXCEEDED ON SET TIMESTAMP'             17640000
176500                         TO WS-ABEND-OPERATION                    17650000
176600         PERFORM Z999-SQL-ERROR                                   17660000
176700     END-IF.                                                      17670000
176800                                                                  17680000
176900     EVALUATE TRUE                                                17690000
177000        WHEN SQLCODE = ZEROS                                      17700000
177100          MOVE WS-MINUTE      TO WS-RND-MINUTE                    17710000
177200          MOVE WS-SECOND      TO WS-RND-SECOND                    17720000
177300          MOVE WS-NANOSEC-1-3 TO WS-RND-NANOSEC-1-3               17730000
177400          MOVE WS-NANOSEC-4-6 TO WS-RND-NANOSEC-4-6               17740000
177500          MOVE WS-RANDOM-KEY  TO WS-RANDOM-KEY-COMP               17750000
177600          MOVE WS-RANDOM-KEY-COMP TO                              17760000
177700                              INVOIC-PAYT-REQ-SEQ-NBR             17770000
177800                              MDINVC-PAYT-REQ-SEQ-NBR             17780000
177900                              PREQIT-PAYT-REQ-SEQ-NBR             17790000
178000                              MIITEM-PAYT-REQ-SEQ-NBR             17800000
178100                              VNDINV-PAYT-REQ-SEQ-NBR             17810000
178200        WHEN SQLCODE NOT = ZEROS                                  17820000
178300             MOVE 'R200-DETERMINE-PAYT-NBR           ' TO         17830000
178400                                       WS-ABEND-PARAGRAPH         17840000
178500             MOVE 'UNSUCCESSFUL SET TIMESTAMP'                    17850000
178600                           TO WS-ABEND-OPERATION                  17860000
178700             MOVE '        ' TO WS-ABEND-STRUCTURE-1              17870000
178800             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              17880000
178900             PERFORM Z999-SQL-ERROR                               17890000
179000     END-EVALUATE.                                                17900000
179100                                                                  17910000
179200*--------------------------------------------------------------*  17920000
179300* SELECT CHECKPOINT RESTART CONTROL INFORMATION                *  17930000
179400*--------------------------------------------------------------*  17940000
179500 S400-GET-CHECKPOINT-CNTL.                                        17950000
179600                                                                  17960000
179700     EXEC SQL                                                     17970000
179800      SELECT CKPT_STAT_CODE                                       17980000
179900       INTO :PV-CKPT-STAT-CODE                                    17990000
180000       FROM TCKRSTCNTL                                            18000000
180100       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         18010000
180200     END-EXEC.                                                    18020000
180300                                                                  18030000
180400     EVALUATE TRUE                                                18040000
180500         WHEN SQLCODE = ZERO                                      18050000
180600             CONTINUE                                             18060000
180700                                                                  18070000
180800         WHEN SQLWARN0 NOT = SPACES                               18080000
180900         WHEN SQLCODE  NOT = ZERO                                 18090000
181000             MOVE 'S400-GET-CHECKPOINT-CNTL'                      18100000
181100                                 TO WS-ABEND-PARAGRAPH            18110000
181200             DISPLAY '******** PLAN_NAME:'                        18120000
181300                      PV-PROGRAM-NAME                             18130000
181400             MOVE 'UNSUCCESSFUL SELECT'                           18140000
181500                                 TO WS-ABEND-OPERATION            18150000
181600             MOVE 'TCKRSTCNTL'   TO WS-ABEND-STRUCTURE-1          18160000
181700             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          18170000
181800             PERFORM Z999-SQL-ERROR                               18180000
181900     END-EVALUATE.                                                18190000
182000                                                                  18200000
182100*--------------------------------------------------------------*  18210000
182200* SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO.  *  18220000
182300*--------------------------------------------------------------*  18230000
182400 S500-GET-CHECKPOINT-INFO.                                        18240000
182500                                                                  18250000
182600     EXEC SQL                                                     18260000
182700      SELECT WORK_STRG_DESC                                       18270000
182800       INTO :TCKRSTINF-WORK-STRG-DESC                             18280000
182900       FROM TCKRSTINF                                             18290000
183000       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         18300000
183100     END-EXEC.                                                    18310000
183200                                                                  18320000
183300     EVALUATE TRUE                                                18330000
183400         WHEN SQLCODE = ZERO                                      18340000
183500              CONTINUE                                            18350000
183600                                                                  18360000
183700         WHEN SQLWARN0 NOT = SPACES                               18370000
183800         WHEN SQLCODE  NOT = ZERO                                 18380000
183900             MOVE 'S500-GET-CHECKPOINT-INFO'                      18390000
184000                                 TO WS-ABEND-PARAGRAPH            18400000
184100             DISPLAY '******** PLAN_NAME:'                        18410000
184200                      PV-PROGRAM-NAME                             18420000
184300             MOVE 'UNSUCCESSFUL SELECT'                           18430000
184400                                 TO WS-ABEND-OPERATION            18440000
184500             MOVE 'TCKRSTINF'    TO WS-ABEND-STRUCTURE-1          18450000
184600             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          18460000
184700             PERFORM Z999-SQL-ERROR                               18470000
184800     END-EVALUATE.                                                18480000
184900                                                                  18490000
185000*--------------------------------------------------------------*  18500000
185100* UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS    *  18510000
185200* CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE).  *  18520000
185300*--------------------------------------------------------------*  18530000
185400 U100-UPDATE-TCKRSTCNTL.                                          18540000
185500                                                                  18550000
185600     EXEC SQL                                                     18560000
185700         UPDATE TCKRSTCNTL                                        18570000
185800         SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE                  18580000
185900         WHERE PLAN_NAME    = :PV-PROGRAM-NAME                    18590000
186000     END-EXEC.                                                    18600000
186100                                                                  18610000
186200     EVALUATE TRUE                                                18620000
186300         WHEN SQLCODE = ZERO                                      18630000
186400              CONTINUE                                            18640000
186500                                                                  18650000
186600         WHEN SQLWARN0 NOT = SPACES                               18660000
186700         WHEN SQLCODE  NOT = ZERO                                 18670000
186800             MOVE 'U100-UPDATE-TCKRSTCNTL'                        18680000
186900                                 TO WS-ABEND-PARAGRAPH            18690000
187000             DISPLAY '******** PLAN_NAME:'                        18700000
187100                      PV-PROGRAM-NAME                             18710000
187200             MOVE 'UNSUCCESSFUL UPDATE'                           18720000
187300                                 TO WS-ABEND-OPERATION            18730000
187400             MOVE 'TCKRSTCNTL'   TO WS-ABEND-STRUCTURE-1          18740000
187500             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          18750000
187600             PERFORM Z999-SQL-ERROR                               18760000
187700     END-EVALUATE.                                                18770000
187800                                                                  18780000
187900*--------------------------------------------------------------*  18790000
188000* UPDATE THE CHECKPOINT RESTART INFORMATION TABLE.  THE        *  18800000
188100* WORKING STORAGE DESCRIPTION FIELD IS UPDATED WITH THE        *  18810000
188200* CURRENT INPUT FILE RECORD COUNTS AND THE FILE PROCESSOR      *  18820000
188300* INDICATOR.                                                   *  18830000
188400*--------------------------------------------------------------*  18840000
188500 U200-UPDATE-TCKRSTINF.                                           18850000
188600                                                                  18860000
188700     MOVE WS-SAVE-PO-NBR          TO CR-PO-NBR.                   18870000
188800     MOVE WS-SAVE-MTCH-LVL        TO CR-MTCH-LVL.                 18880000
188900     MOVE WS-SAVE-INVOICE-NBR     TO CR-INVC-ID.                  18890000
189000     MOVE WS-TOT-NO-PAY-REQ-ADDED TO CR-TOT-NO-PAY-REQ-ADDED.     18900000
189100     MOVE WS-TOT-GROSS-COST-ADDED TO CR-TOT-GROSS-COST-ADDED.     18910000
189200     MOVE CKPT-RESTART-INFO       TO                              18920000
189300                                    TCKRSTINF-WORK-STRG-DESC-TEXT.18930000
189400     MOVE 4022                    TO TCKRSTINF-WORK-STRG-DESC-LEN.18940000
189500                                                                  18950000
189600     EXEC SQL                                                     18960000
189700         UPDATE TCKRSTINF                                         18970000
189800         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC         18980000
189900         WHERE PLAN_NAME      = :PV-PROGRAM-NAME                  18990000
190000     END-EXEC.                                                    19000000
190100                                                                  19010000
190200     EVALUATE TRUE                                                19020000
190300         WHEN SQLCODE = ZERO                                      19030000
190400              CONTINUE                                            19040000
190500                                                                  19050000
190600         WHEN SQLWARN0 NOT = SPACES                               19060000
190700         WHEN SQLCODE  NOT = ZERO                                 19070000
190800             MOVE 'U200-UPDATE-TCKRSTINF'                         19080000
190900                         TO WS-ABEND-PARAGRAPH                    19090000
191000             DISPLAY '******** PLAN_NAME:'                        19100000
191100                      PV-PROGRAM-NAME                             19110000
191200             MOVE 'UNSUCCESSFUL UPDATE'                           19120000
191300                                 TO WS-ABEND-OPERATION            19130000
191400             MOVE 'TCKRSTINF'    TO WS-ABEND-STRUCTURE-1          19140000
191500             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          19150000
191600             PERFORM Z999-SQL-ERROR                               19160000
191700     END-EVALUATE.                                                19170000
191800                                                                  19180000
191900*--------------------------------------------------------------*  19190000
192000* WRITE THE DETAIL LINE HEADING                                *  19200000
192100*--------------------------------------------------------------*  19210000
192200 W100-TOT-REPORT.                                                 19220000
192300                                                                  19230000
192400     MOVE 1 TO DP132O-REPORT-NUMBER.                              19240000
192500                                                                  19250000
192600     MOVE 1             TO DP132O-PAGE-NUMBER.                    19260000
192700                                                                  19270000
192800     WRITE TOT-LINE FROM DP132O-STANDRD-HEADER-132-COLS           19280000
192900         AFTER ADVANCING PAGE.                                    19290000
193000                                                                  19300000
193100     WRITE TOT-LINE FROM HL-HEADING-LINE1                         19310000
193200         AFTER ADVANCING 3 LINE.                                  19320000
193300                                                                  19330000
193400     WRITE TOT-LINE FROM DETAIL-LINE1                             19340000
193500         AFTER ADVANCING 2 LINE.                                  19350000
193600                                                                  19360000
193700     WRITE TOT-LINE FROM DETAIL-LINE2                             19370000
193800         AFTER ADVANCING 2 LINE.                                  19380000
193900                                                                  19390000
194000*--------------------------------------------------------------*  19400000
194100* COMMITS DB2 UPDATES FOR THE PO PROCESSED                     *  19410000
194200*--------------------------------------------------------------*  19420000
194300 U300-COMMIT.                                                     19430000
194400                                                                  19440000
194500     EXEC SQL                                                     19450000
194600         COMMIT                                                   19460000
194700     END-EXEC.                                                    19470000
194800                                                                  19480000
194900     EVALUATE TRUE                                                19490000
195000         WHEN SQLCODE = ZEROS                                     19500000
195100              CONTINUE                                            19510000
195200         WHEN OTHER                                               19520000
195300             MOVE   'U300-COMMIT'                                 19530000
195400                                 TO WS-ABEND-PARAGRAPH            19540000
195500             MOVE 'UNSUCCESSFUL COMMIT'                           19550000
195600                                 TO WS-ABEND-OPERATION            19560000
195700             MOVE SPACES         TO WS-ABEND-STRUCTURE-1          19570000
195800                                    WS-ABEND-STRUCTURE-2          19580000
195900             PERFORM Z999-SQL-ERROR                               19590000
196000     END-EVALUATE.                                                19600000
196100                                                                  19610000
196200*--------------------------------------------------------------*  19620000
196300* DO THE CHECKPOINT RESTART AND THE COMMIT                     *  19630000
196400*--------------------------------------------------------------*  19640000
196500 X100-CHECKPOINT-COMMIT.                                          19650000
196600                                                                  19660000
196700     EXEC SQL                                                     19670000
196800       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      19680000
196900     END-EXEC.                                                    19690000
197000                                                                  19700000
197100     EVALUATE TRUE                                                19710000
197200         WHEN SQLCODE = ZERO                                      19720000
197300              CONTINUE                                            19730000
197400                                                                  19740000
197500        WHEN SQLWARN0 NOT = SPACES                                19750000
197600        WHEN SQLCODE  NOT = ZERO                                  19760000
197700            MOVE 'UNSUCCESSFUL SET TMST'                          19770000
197800                                TO WS-ABEND-PARAGRAPH             19780000
197900            PERFORM Z999-SQL-ERROR                                19790000
198000     END-EVALUATE.                                                19800000
198100                                                                  19810000
198200     IF CR-CURR-TMST > CR-NEXT-TMST                               19820000
198300        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         19830000
198400        PERFORM U100-UPDATE-TCKRSTCNTL                            19840000
198500        PERFORM U200-UPDATE-TCKRSTINF                             19850000
198600        PERFORM U300-COMMIT                                       19860000
198700                                                                  19870000
198800        EXEC SQL                                                  19880000
198900         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     19890000
199000          INTO :CR-NEXT-TMST                                      19900000
199100          FROM TCKRSTCNTL                                         19910000
199200          WHERE PLAN_NAME = :PV-PROGRAM-NAME                      19920000
199300        END-EXEC                                                  19930000
199400                                                                  19940000
199500          EVALUATE TRUE                                           19950000
199600              WHEN SQLCODE = ZERO                                 19960000
199700                   CONTINUE                                       19970000
199800                                                                  19980000
199900          WHEN SQLWARN0 NOT = SPACES                              19990000
200000          WHEN SQLCODE  NOT = ZERO                                20000000
200100              MOVE 'UNSUCCESSFUL NEXT TMST'                       20010000
200200                                  TO WS-ABEND-PARAGRAPH           20020000
200300              PERFORM Z999-SQL-ERROR                              20030000
200400       END-EVALUATE                                               20040000
200500     END-IF.                                                      20050000
200600                                                                  20060000
200700*--------------------------------------------------------------*  20070000
200800* GET THE RESTART INFORMATION                                  *  20080000
200900*--------------------------------------------------------------*  20090000
201000 X200-CHECKPOINT-RESTART.                                         20100000
201100                                                                  20110000
201200     PERFORM S500-GET-CHECKPOINT-INFO.                            20120000
201300     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     20130000
201400                                                                  20140000
201500     MOVE CR-PO-NBR           TO PV-PO-NBR.                       20150000
201600     MOVE CR-MTCH-LVL         TO PV-MTCH-LVL.                     20160000
201700     MOVE CR-INVC-ID          TO PV-INVC-ID.                      20170000
201800                                                                  20180000
201900     DISPLAY '***********************************************'.   20190000
202000     DISPLAY '** APKUP202 CHECKPOINT RESTART **'.                 20200000
202100     DISPLAY '** TCKRST PO NUMBER ON RESTART  = ' PV-PO-NBR.      20210000
202200     DISPLAY '** TCKRST MATCH LVL ON RESTART  = ' PV-MTCH-LVL.    20220000
202300     DISPLAY '** TCKRST INVOICE ID ON RESTART = ' PV-INVC-ID.     20230000
202400     DISPLAY '***********************************************'.   20240000
202500                                                                  20250000
202600     PERFORM R100-READ-AP052                                      20260000
202700           WITH TEST AFTER                                        20270000
202800                UNTIL END-OF-EDIIN                                20280000
202900                  OR  AP052-KOHLS-PO-NBR > CR-PO-NBR              20290000
203000                  OR (AP052-KOHLS-PO-NBR = CR-PO-NBR              20300000
203100                      AND AP052-SORT-MTCH-LVL = CR-MTCH-LVL       20310000
203200                      AND AP052-VENDOR-INVOICE-NBR > CR-INVC-ID). 20320000
203300                                                                  20330000
203400     MOVE CR-TOT-NO-PAY-REQ-ADDED TO WS-TOT-NO-PAY-REQ-ADDED.     20340000
203500     MOVE CR-TOT-GROSS-COST-ADDED TO WS-TOT-GROSS-COST-ADDED.     20350000
203600                                                                  20360000
203700*--------------------------------------------------------------*  20370000
203800* PROCESS DB2 ABENDS                                           *  20380000
203900*--------------------------------------------------------------*  20390000
204000 Z999-SQL-ERROR.                                                  20400000
204100                                                                  20410000
204200     CLOSE TOT-REPORT.                                            20420000
204300                                                                  20430000
204400     MOVE WS-PAYT-REQ-LNE-NBR TO WS-PAYT-REQ-LNE-NBR-UNPK.        20440000
204500     DISPLAY 'PO NUMBER        = ' WS-PO-NBR.                     20450000
204600     DISPLAY 'INVOICE NUMBER   = ' INVOIC-INVC-ID.                20460000
204700     DISPLAY 'STORE NUMBER     = ' WS-STORE-NBR.                  20470000
204800     DISPLAY 'PAYT REQ SEQ NBR = ' WS-RANDOM-KEY.                 20480000
204900     DISPLAY 'PAYT REQ LNE NBR = ' WS-PAYT-REQ-LNE-NBR-UNPK.      20490000
205000     DISPLAY 'MATCH LEVEL CODE = ' WS-MTCH-LVL.                   20500000
205100     DISPLAY 'DC NUMBER        = ' WS-DC-NBR.                     20510000
205200     DISPLAY '*** DB2 ERROR '.                                    20520000
205300     DISPLAY '*** SQL CODE = '  WS-ABEND-SQLCODE.                 20530000
205400     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 20540000
205500     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               20550000
205600     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               20560000
205700     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             20570000
205800     IF WS-ABEND-STRUCTURE-2 > SPACES                             20580000
205900         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         20590000
206000                                                                  20600000
206100     COPY DPPD004.                                                20610000
206200                                                                  20620000
206300     MOVE +4013                    TO ABEND-CODE.                 20630000
206400                                                                  20640000
206500     CALL 'ILBOABN0' USING ABEND-CODE.                            20650000
206600                                                                  20660000
