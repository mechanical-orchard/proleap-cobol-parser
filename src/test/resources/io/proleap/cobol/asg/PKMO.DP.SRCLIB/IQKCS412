000110*-----------------------*                                         00011000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    IQKCS412.                                         00040000
000500 AUTHOR.        BARB ERTL.                                        00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DECEMBER 2003.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*----------------------------------------------------------------*00100000
001100*    I412 - RECEIPT LOOKUP LIST                                  *00110000
001200*                                                                *00120000
001300*    THIS PROGRAM GENERATES A LIST OF TRANSACTIONS BASED ON THE  *00130000
001400*    CRITERIA PASSED FROM THE CRITERIA SPEC                      *00140000
001401*----------------------------------------------------------------*00140199
001410* HISTORY LOG:                                                    00141000
001420*                                                                 00142000
001430* DATE: 09/06/13                                                  00143000
001440* WR/IR#: CHG0062728                                              00144000
001450* PROGRAMMER: COGNIZANT                                           00145000
001460* DESCRIPTION: REMOVED LOGIC THAT REFERENCING THE FOLLOWING       00146000
001470*              HISTORY TABLES.                                    00147000
001480*              TEPITMH                                            00148000
001490*              TEPTRNH                                            00149000
001491*              TEPTNDH                                            00149100
001492*              TEPLIDH                                            00149200
001500******************************************************************00150000
001510* DATE:        04/08/15                                           00151099
001520* WR/IR#:      CHG0104429                                         00152099
001530* PROGRAMMER:  COGNIZANT                                          00153099
001540* DESCRIPTION: CHANGES TO HANDLE THE TOKENIZED TNDR_ID FIELD IN   00154000
001550*              THE TRANS-OPER-CSR CURSOR AS PART OF COSA DATA     00155099
001560*              SECURITY PROJECT.                                  00156099
001591******************************************************************00159100
001593* DATE:        09/14/2021                                         00159399
001594* WR/IR#:      CHG0261678                                         00159499
001595* PROGRAMMER:  GERMAN BANDA                                       00159599
001596* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00159699
001597*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00159799
001598*              MAKING THE CALL DYNAMIC VS STATIC                  00159899
001599*---------------------------------------------------------------* 00159999
CICS  * CHANGED 11/01/2022    BY JIM HUNTER      WR: CHG0277565         00160099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00160199
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00160299
CICS  ******************************************************************00160399
001600                                                                  00161000
001700 DATA DIVISION.                                                   00170000
001800                                                                  00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000                                                                  00200000
002100 01  PC-PROGRAM-CONSTANTS.                                        00210000
002200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00220000
002300                                                    'IQ412A  '.   00230000
002400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00240000
002500                                                    'IQKM412 '.   00250000
002600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00260000
002700                                                    'IQKCS412'.   00270000
002800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00280000
002900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00290000
003000     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00300000
003100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00310000
003200                                                    COMP SYNC.    00320000
003300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00330000
003400                                                    COMP SYNC.    00340000
003500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00350000
003600                                                    +1000000      00360000
003700                                                    COMP-3.       00370000
003800     05  PC-MAX-LIDS                    PIC S9(09)  VALUE         00380000
003900                                                    +100          00390000
004000                                                    COMP-3.       00400000
004100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00410000
004200                                                    COMP-3.       00420000
004300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00430000
004400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00440000
004500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00450000
004600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00460000
004700     05  PC-REV                         PIC  X(03)  VALUE 'REV'.  00470000
004800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00480000
004900                                                    COMP SYNC.    00490000
005000     05  PC-QUOTE                       PIC  X(01)  VALUE QUOTE.  00500000
005100                                                                  00510000
005200     05  PC-TSYMSG-NUMBERS.                                       00520000
005300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00530000
005400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00540000
005500         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00550000
005600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00560000
005700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00570000
005800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00580000
005900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00590000
006000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00600000
006100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00610000
006200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00620000
006300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00630000
006400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00640000
006500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00650000
006600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00660000
006700         10  PC-TSYMSG-02416            PIC  9(05)  VALUE 02416.  00670000
006800         10  PC-TSYMSG-02748            PIC  9(05)  VALUE 02748.  00680000
006810     05  PC-OPERATIONAL                 PIC  X(01)  VALUE 'O'.    00681000
006900                                                                  00690000
007000 01  PS-PROGRAM-SWITCHES.                                         00700000
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00710000
007200         88  PS-NO-ERROR                            VALUE 'Y'.    00720000
007300         88  PS-ERROR                               VALUE 'N'.    00730000
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00740000
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00750000
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00760000
007700     05  PS-LIDS-LEFT-INDICATOR         PIC  X(01).               00770000
007800         88  PS-LIDS-LEFT-ON-DB                     VALUE 'Y'.    00780000
007900         88  PS-NO-LIDS-LEFT-ON-DB                  VALUE 'N'.    00790000
008000                                                                  00800000
008100 01  PV-PROGRAM-VARIABLES.                                        00810000
008220     05  PV-SUB                         PIC S9(04)  VALUE +0      00822099
008300                                                    COMP SYNC.    00830000
008400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00840000
008500                                                    COMP SYNC.    00850000
008600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00860000
008700                                                    COMP-3.       00870000
008800     05  PV-LID-COUNT                   PIC S9(09)  VALUE +0      00880000
008900                                                    COMP-3.       00890000
009000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00900000
009100                                                    COMP-3.       00910000
009200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00920000
009300                                                    COMP-3.       00930000
009400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00940000
009500                                                    COMP-3.       00950000
009600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00960000
009700                                                    COMP-3.       00970000
009800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00980000
009900                                                    COMP-3.       00990000
010000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01000000
010100                                                    COMP-3.       01010000
010200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01020000
010300                                                    COMP SYNC.    01030000
010400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01040000
010500                                                    COMP SYNC.    01050000
010600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01060000
010700                                                    COMP SYNC.    01070000
010800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01080000
010900                                                    COMP SYNC.    01090000
011000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01100000
011100                                                    COMP SYNC.    01110000
011200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01120000
011300                                                    COMP SYNC.    01130000
011400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01220000
012300                                                    COMP SYNC.    01230000
012400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01240000
012500                                                    COMP SYNC.    01250000
012600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01260000
012700                                                    COMP SYNC.    01270000
012800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01280000
012900                                                    COMP SYNC.    01290000
013000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-RETURN-AMT                  PIC  9(07)V99 VALUE 0.    01340000
013500     05  PV-SLS-DTE-FORMATTED.                                    01350000
013600         10  PV-SLS-DTE-FORMATTED-MM    PIC X(02)  VALUE SPACES.  01360000
013700         10  FILLER                     PIC X(01)  VALUE '/'.     01370000
013800         10  PV-SLS-DTE-FORMATTED-DD    PIC X(02)  VALUE SPACES.  01380000
013900         10  FILLER                     PIC X(01)  VALUE '/'.     01390000
014000         10  PV-SLS-DTE-FORMATTED-YYYY  PIC X(04)  VALUE SPACES.  01400000
014100     05  PV-SLS-DTE-ISO.                                          01410000
014200         10  PV-SLS-DTE-ISO-YYYY        PIC X(04)  VALUE SPACES.  01420000
014300         10  FILLER                     PIC X(01)  VALUE '-'.     01430000
014400         10  PV-SLS-DTE-ISO-MM          PIC X(02)  VALUE SPACES.  01440000
014500         10  FILLER                     PIC X(01)  VALUE '-'.     01450000
014600         10  PV-SLS-DTE-ISO-DD          PIC X(02)  VALUE SPACES.  01460000
014700     05  PV-SAVE-SLS-DATE               PIC X(10)  VALUE SPACES.  01470000
014800     05  PV-SAVE-SLS-DAY                PIC X(03)  VALUE SPACES.  01480000
014900     05  PV-LID-PCT                     PIC S9(03) COMP-3 VALUE 0.01490000
015000     05  PV-NOTE                        PIC X(30).                01500000
015100     05  PV-NOTE-R REDEFINES PV-NOTE.                             01510000
015200         10  PV-NOTE-1                  PIC X(10).                01520000
015300         10  PV-NOTE-2                  PIC X(10).                01530000
015400         10  PV-NOTE-3                  PIC X(10).                01540000
015500     05  PV-NOTE-MORE-DISCOUNTS         PIC X(10)                 01550000
015600                                            VALUE 'MORE DISC'.    01560000
015700     05  PV-NOTE-BOGO                   PIC X(10)                 01570000
015800                                            VALUE 'BOGO     '.    01580000
015810     05  PV-OFFERS-BWP                  PIC X(10)                 01581000
015820                                            VALUE 'OFFERS BWP'.   01582000
015900     05  PV-NOTE-DLR-OFF.                                         01590000
016000         10  FILLER                     PIC X(04)                 01600000
016100                                            VALUE 'MKDN'.         01610000
016200         10  PV-NOTE-DLR-OFF-DLR        PIC $$$.99.               01620000
016300     05  PV-NOTE-PCT-OFF.                                         01630000
016400         10  FILLER                     PIC X(04)                 01640000
016500                                            VALUE 'MKDN'.         01650000
016600         10  PV-NOTE-PCT-OFF-PCT        PIC ZZZ.                  01660000
016700         10  FILLER                     PIC X(03)                 01670000
016800                                            VALUE '%  '.          01680000
016900     05  PV-NOTE-TTL-DLR-OFF.                                     01690000
017000         10  FILLER                     PIC X(04)                 01700000
017100                                            VALUE 'TTL '.         01710000
017200         10  PV-NOTE-TTL-DLR            PIC $$$.99.               01720000
017300     05  PV-NOTE-TTL-PCT-OFF.                                     01730000
017400         10  FILLER                     PIC X(04)                 01740000
017500                                            VALUE 'TTL '.         01750000
017600         10  PV-NOTE-TTL-PCT            PIC ZZZ.                  01760000
017700         10  FILLER                     PIC X(03)                 01770000
017800                                            VALUE '%  '.          01780000
017900     05  PV-NOTE-SCD-OFF.                                         01790000
018000         10  FILLER                     PIC X(04)                 01800000
018100                                            VALUE 'SCD '.         01810000
018200         10  PV-NOTE-SCD-PCT            PIC ZZZ.                  01820000
018300         10  FILLER                     PIC X(03)                 01830000
018400                                            VALUE '%  '.          01840000
018420     05  PV-FIND-DB-DATE                PIC  X(10).               01842000
018500                                                                  01850000
018600*----------------------------------------------------------------*01860000
018700*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01870000
018800*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *01880000
018900*   APPLICATION-SPECIFIC COMMAREA.                               *01890000
019000*----------------------------------------------------------------*01900000
019100 01  LQW-LIST-QUEUE-WORK-AREA.                                    01910000
019200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01920000
019300     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01930000
019400                                        INDEXED BY LQW-IDX.       01940000
019500         10  LQW-LIST-ITEM-NUMBER       PIC S9(07)  COMP-3.       01950000
019600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01960000
019700         10  LQW-SELECTED-SW            PIC  X(01).               01970000
019800             88  LQW-SELECT                         VALUE 'S'.    01980000
019900             88  LQW-DESELECT                       VALUE ' '.    01990000
020000         10  LQW-PARTITION-NBR          PIC S9(04)  COMP.         02000000
020100         10  LQW-DB-STRUC-CDE           PIC  X(01).               02010000
020200         10  LQW-SALES-DATE             PIC  X(10).               02020000
020300         10  LQW-SALES-DATE-ISO         PIC  X(10).               02030000
020400         10  LQW-SALES-DAY              PIC  X(03).               02040000
020500         10  LQW-STORE                  PIC S9(04)  COMP.         02050000
020600         10  LQW-REGISTER               PIC S9(04)  COMP.         02060000
020700         10  LQW-TRANSACTION            PIC S9(04)  COMP.         02070000
020800         10  LQW-START-TIME             PIC  X(08).               02080000
020900         10  LQW-SALES-CORR-SEQ-NBR     PIC S9(04)  COMP.         02090000
021000         10  LQW-AMOUNT                 PIC S9(07)V9(02)          02100000
021100                                                    COMP-3.       02110000
021200         10  LQW-NOTE                   PIC  X(30).               02120000
021300                                                                  02130000
021400*---------------------------------------------------------------* 02140000
021500*  RECORD LAYOUT FOR THE TRANSACTION SELECTION TEMP STORAGE Q.  * 02150000
021600*---------------------------------------------------------------* 02160000
021700                                                                  02170000
021800     COPY IQWS003.                                                02180000
021900                                                                  02190000
022000*---------------------------------------------------------------* 02200000
022100*    MAP LAYOUT                                                 * 02210000
022200*---------------------------------------------------------------* 02220000
022300                                                                  02230000
022400     COPY IQKM412.                                                02240000
022500                                                                  02250000
022600 01  MR-OCCURS-LAYOUT                   REDEFINES  IQ412AO.       02260000
022700     05  FILLER                         PIC X(42).                02270000
022800     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02280000
022900         10  MR-SELECTL                 PIC S9(04) COMP.          02290000
023000         10  MR-SELECTA                 PIC  X(01).               02300000
023100         10  MR-SELECTC                 PIC  X(01).               02310000
023200         10  MR-SELECTH                 PIC  X(01).               02320000
023300         10  MR-SELECTI                 PIC  X(01).               02330000
023400                                                                  02340000
023500         10  MR-DATEL                   PIC S9(04) COMP.          02350000
023600         10  MR-DATEA                   PIC  X(01).               02360000
023700         10  MR-DATEC                   PIC  X(01).               02370000
023800         10  MR-DATEH                   PIC  X(01).               02380000
023900         10  MR-DATE                    PIC  X(10).               02390000
024000                                                                  02400000
024100         10  MR-DAYL                    PIC S9(04) COMP.          02410000
024200         10  MR-DAYA                    PIC  X(01).               02420000
024300         10  MR-DAYC                    PIC  X(01).               02430000
024400         10  MR-DAYH                    PIC  X(01).               02440000
024500         10  MR-DAY                     PIC  X(03).               02450000
024600                                                                  02460000
024700         10  MR-STOREL                  PIC S9(04) COMP.          02470000
024800         10  MR-STOREA                  PIC  X(01).               02480000
024900         10  MR-STOREC                  PIC  X(01).               02490000
025000         10  MR-STOREH                  PIC  X(01).               02500000
025100         10  MR-STORE-X.                                          02510000
025200             15  MR-STORE               PIC  9(04).               02520000
025300                                                                  02530000
025400         10  MR-TRANSL                  PIC S9(04) COMP.          02540000
025500         10  MR-TRANSA                  PIC  X(01).               02550000
025600         10  MR-TRNASC                  PIC  X(01).               02560000
025700         10  MR-TRANSH                  PIC  X(01).               02570000
025800         10  MR-TRANS-X.                                          02580000
025900             15  MR-TRANS               PIC  9(04).               02590000
026000                                                                  02600000
026100         10  MR-RETURN-AMTL             PIC S9(04) COMP.          02610000
026200         10  MR-RETURN-AMTA             PIC  X(01).               02620000
026300         10  MR-RETURN-AMTC             PIC  X(01).               02630000
026400         10  MR-RETURN-AMTH             PIC  X(01).               02640000
026500         10  MR-RETURN-AMT-X.                                     02650000
026600             15  MR-RETURN-AMT          PIC  Z(07).ZZ.            02660000
026700                                                                  02670000
026800         10  MR-NOTEL                   PIC S9(04) COMP.          02680000
026900         10  MR-NOTEA                   PIC  X(01).               02690000
027000         10  MR-NOTEC                   PIC  X(01).               02700000
027100         10  MR-NOTEH                   PIC  X(01).               02710000
027200         10  MR-NOTE                    PIC  X(30).               02720000
027300     05  FILLER                         PIC  X(12).               02730000
027400                                                                  02740000
027500*----------------------------------------------------------------*02750000
027600*    KOHL'S CALENDAR ROUTINE COPYBOOK                            *02760000
027700*----------------------------------------------------------------*02770000
027800     COPY DPWS500.                                                02780000
027900                                                                  02790000
028000*---------------------------------------------------------------* 02800000
028100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02810000
028200*---------------------------------------------------------------* 02820000
028300                                                                  02830000
028400     COPY DPWS015.                                                02840000
028500                                                                  02850000
028600*---------------------------------------------------------------* 02860000
028700*    FUNCTION KEYS COPYBOOK.                                    * 02870000
028800*---------------------------------------------------------------* 02880000
028900                                                                  02890000
029000     COPY DPWS016.                                                02900000
029100                                                                  02910000
029200*---------------------------------------------------------------* 02920000
029300*    NUMERIC EDIT LAYOUT.                                       * 02930000
029400*---------------------------------------------------------------* 02940000
029500                                                                  02950000
029600     COPY DPWS010I.                                               02960000
029700                                                                  02970000
029800*---------------------------------------------------------------* 02980000
029900*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02990099
030000*---------------------------------------------------------------* 03000000
030100                                                                  03010000
030200     COPY DPWS030.                                                03020000
CICS       COPY DPWS930.                                                03021099
030300                                                                  03030000
030400*---------------------------------------------------------------* 03040000
030500*    STANDARD COMMAREA.                                         * 03050000
030600*---------------------------------------------------------------* 03060000
030700                                                                  03070000
030800     COPY DPWS020.                                                03080000
030900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03090000
031000                                                                  03100000
031100*---------------------------------------------------------------* 03110000
031200* INTER-APPLICATION COMMAREA.                                   * 03120000
031300*   IQWS002 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03130000
031400*             SPEC SCREEN.                                      * 03140000
031500*---------------------------------------------------------------* 03150000
031600                                                                  03160000
031700         10  INTER-APPL-COMM-AREA       PIC X(200).               03170000
031800     COPY IQWS002.                                                03180000
031900     COPY IQWS004.                                                03190000
032000                                                                  03200000
032100*---------------------------------------------------------------* 03210000
032200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03220000
032300*---------------------------------------------------------------* 03230000
032400         10  ASC-SPECIFIC-COMMAREA.                               03240000
032500             15  ASC-LIST-KEYS.                                   03250000
032600                 20  ASC-KEY-SALES-DATE-FROM     PIC  X(10).      03260000
032700                 20  ASC-KEY-SALES-DATE-TO       PIC  X(10).      03270000
032800                 20  ASC-KEY-STORE               PIC S9(04)       03280000
032900                                                 COMP.            03290000
033000                 20  ASC-KEY-STORE-GROUP         PIC S9(04)       03300000
033100                                                 COMP.            03310000
033200                 20  ASC-KEY-TENDER-ID           PIC  X(33).      03320000
033300                 20  ASC-KEY-SKU-NBR             PIC S9(08)       03330000
033400                                                      COMP-3.     03340000
033500                 20  ASC-KEY-UPC-NBR             PIC S9(15)       03350000
033600                                                     COMP-3.      03360000
033700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03370000
033800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03380000
033900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03390000
034000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03400000
034100                                                                  03410000
034200                 20  ASC-ITEM-ARRAY.                              03420000
034300                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03430000
034400                         30  ASC-LIST-ITEM-NUMBER                 03440000
034500                                                     PIC S9(07)   03450000
034600                                                     COMP-3.      03460000
034700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03470000
034800                             88  ASC-VALID-SELECT    VALUE ' '    03480000
034900                                                           'S'    03490000
035000                                                           'B'    03500000
035100                                                           'E'.   03510000
035200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03520000
035300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03530000
035400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03540000
035500                             88  ASC-TEMP-END        VALUE 'E'.   03550000
035600                         30  ASC-SELECTED-SW         PIC  X(01).  03560000
035700                             88  ASC-NO-SELECT       VALUE ' '.   03570000
035800                             88  ASC-SELECT          VALUE 'S'.   03580000
035900                             88  ASC-BEGIN           VALUE 'B'.   03590000
036000                             88  ASC-END             VALUE 'E'.   03600000
036100                         30  ASC-PARTITION-NBR       PIC S9(04)   03610000
036200                                                         COMP.    03620000
036300                         30  FILLER                  PIC  X(01).  03630000
036400                         30  ASC-SALES-DATE          PIC  X(10).  03640000
036500                         30  ASC-SALES-DATE-ISO      PIC  X(10).  03650000
036600                         30  ASC-SALES-DAY           PIC  X(03).  03660000
036700                         30  ASC-STORE               PIC S9(04)   03670000
036800                                                          COMP.   03680000
036900                         30  ASC-REGISTER            PIC S9(04)   03690000
037000                                                          COMP.   03700000
037100                         30  ASC-TRANSACTION         PIC S9(04)   03710000
037200                                                          COMP.   03720000
037300                         30  ASC-START-TIME          PIC X(08).   03730000
037400                         30  ASC-SALES-CORR-SEQ-NBR  PIC S9(04)   03740000
037500                                                           COMP.  03750000
037600                         30  ASC-AMOUNT          PIC S9(07)V9(02) 03760000
037700                                                          COMP-3. 03770000
037800                         30  ASC-NOTE                PIC  X(30).  03780000
037900                                                                  03790000
038000             15  ASC-BLK-SUB                         PIC S9(04)   03800000
038100                                                          COMP    03810000
038200                                                          SYNC.   03820000
038300             15  ASC-ITEM-SUB                        PIC S9(04)   03830000
038400                                                          COMP    03840000
038500                                                          SYNC.   03850000
038600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03860000
038700                                                          COMP-3. 03870000
038800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03880000
038900                                                          COMP-3. 03890000
039000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03900000
039100                                                          COMP-3. 03910000
039200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03920000
039300                                                          COMP-3. 03930000
039400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03940000
039500                                                          COMP-3. 03950000
039600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03960000
039700                                                          COMP    03970000
039800                                                          SYNC.   03980000
039900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03990000
040000                                                          COMP-3. 04000000
040100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04010000
040200                                                          COMP-3. 04020000
040300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04030000
040400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04040000
040500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04050000
040600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04060000
040700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04070000
040800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04080000
040900             15  ASC-LIST-QUEUE-NAME.                             04090000
041000                 20  ASC-LIST-TERM-ID                PIC  X(04).  04100000
041100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04110000
041200                                                          COMP-3. 04120000
041300                 20  ASC-LIST-SEQ                    PIC  9(01).  04130000
041400             15  ASC-SEL-QUEUE-NAME.                              04140000
041500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04150000
041600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04160000
041700                                                          COMP-3. 04170000
041800                 20  ASC-SEL-SEQ                     PIC  9(01).  04180000
041900                                                                  04190000
042000             15  ASC-START-ITEM-REQUEST.                          04200000
042100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04210000
042200         10  FILLER                                  PIC  X(407). 04220000
042300                                                                  04230000
042400*---------------------------------------------------------------* 04240000
042500*    ABEND PROCESSING COPYBOOK.                                 * 04250000
042600*---------------------------------------------------------------* 04260000
042700                                                                  04270000
042800     COPY DPWS013.                                                04280000
042900                                                                  04290000
042910*---------------------------------------------------------------* 04291000
042920* LAYOUT FOR THE PARAMETERS NEEDED TO INVOKE PROTEGRITY MODULE  * 04292099
042930*---------------------------------------------------------------* 04293000
042950     COPY PTYCCSIP.                                               04295000
042960                                                                  04296099
042970*---------------------------------------------------------------* 04297099
042980* LAYOUT FOR THE WORKING VARIABLES TO INVOKE PROTEGRITY MODULE  * 04298099
042990*---------------------------------------------------------------* 04299099
042991     COPY DPWS031.                                                04299199
042993                                                                  04299399
043000*---------------------------------------------------------------* 04300000
043100*    DB2 AREA FOR XST_UPC                                       * 04310000
043200*---------------------------------------------------------------* 04320000
043300     EXEC SQL                                                     04330000
043400          INCLUDE XST00012                                        04340000
043500     END-EXEC.                                                    04350000
043600                                                                  04360000
043700*---------------------------------------------------------------* 04370000
043800*    DB2 AREA FOR XST_SKU                                       * 04380000
043900*---------------------------------------------------------------* 04390000
044000     EXEC SQL                                                     04400000
044100          INCLUDE XST00010                                        04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400*---------------------------------------------------------------* 04440000
044500*    DB2 AREA FOR TEPPART (PARTITION TABLE)                     * 04450000
044600*---------------------------------------------------------------* 04460000
044700     EXEC SQL                                                     04470000
044800          INCLUDE TEPPART                                         04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100*---------------------------------------------------------------* 04510000
045200*    DB2 AREA FOR TEPTRN (TRANSACTION TABLE)                    * 04520000
045300*---------------------------------------------------------------* 04530000
045400     EXEC SQL                                                     04540000
045500          INCLUDE TEPTRN                                          04550000
045600     END-EXEC.                                                    04560000
045700                                                                  04570000
046500*---------------------------------------------------------------* 04650000
046600*    DB2 AREA FOR TEPITM  (ITEM TABLE)                          * 04660000
046700*---------------------------------------------------------------* 04670000
046800     EXEC SQL                                                     04680000
046900          INCLUDE TEPITM                                          04690000
047000     END-EXEC.                                                    04700000
047100                                                                  04710000
047900*---------------------------------------------------------------* 04790000
048000*    DB2 AREA FOR TEPLID  (LINE ITEM DISCOUNT TABLE)            * 04800000
048100*---------------------------------------------------------------* 04810000
048200     EXEC SQL                                                     04820000
048300          INCLUDE TEPLID                                          04830000
048400     END-EXEC.                                                    04840000
048500                                                                  04850000
049300*---------------------------------------------------------------* 04930000
049400*    DB2 AREA FOR TEPTND  (TENDER TABLE)                        * 04940000
049500*---------------------------------------------------------------* 04950000
049600     EXEC SQL                                                     04960000
049700          INCLUDE TEPTND                                          04970000
049800     END-EXEC.                                                    04980000
049900                                                                  04990000
050700*---------------------------------------------------------------* 05070000
050800*    DB2 AREA FOR XST_STR_GP_MBSHP                              * 05080000
050900*    (DOMAIN STORE GROUP MEMBERSHIP TABLE)                      * 05090000
051000*---------------------------------------------------------------* 05100000
051100     EXEC SQL                                                     05110000
051200          INCLUDE XST00023                                        05120000
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500*---------------------------------------------------------------* 05150000
051600*    DB2 AREA FOR COMMUNICATIONS                                * 05160000
051700*---------------------------------------------------------------* 05170000
051800     EXEC SQL                                                     05180000
051900          INCLUDE SQLCA                                           05190000
052000     END-EXEC.                                                    05200000
052100                                                                  05210000
052200*---------------------------------------------------------------* 05220000
052220*    TRANSACTION CURSOR THAT UTILIZES THE OPERATIONAL DATABASE  * 05222000
052230*    REQUIRED WHEN THE USER SELECTS A DAY FOR WHICH THE FULL    * 05223000
052240*    MONTH RESIDES ON THE OPERATIONAL DATABASE.                 * 05224000
052250*---------------------------------------------------------------* 05225000
052500                                                                  05250000
052600     EXEC SQL                                                     05260000
052700          DECLARE TRANS-OPER-CSR CURSOR FOR                       05270000
052800            SELECT  PRT.PARTN_NBR                                 05280000
053000                   ,TRN.STR_NBR                                   05300000
053100                   ,TRN.RGST_ID                                   05310000
053200                   ,TRN.TRN_NBR                                   05320000
053300                   ,TRN.STRT_TM                                   05330000
053400                   ,TRN.SLS_CORR_SEQ_NBR                          05340000
053500                   ,PRT.SLS_DTE                                   05350000
053600                   ,ITM.LNE_ITM_SEQ_NBR                           05360000
053700                   ,ITM.SLD_QTY                                   05370000
053800                   ,ITM.CUST_CHRGD_AMT                            05380000
053900             FROM   TEPPART PRT                                   05390000
054000                  , TEPTRN  TRN                                   05400000
054100                  , TEPITM  ITM                                   05410000
054200                  , TEPTND  TND                                   05420000
054300                  , XST_STR_GP_MBSHP SGM                          05430000
054400              WHERE  PRT.PARTN_NBR      = TRN.PARTN_NBR           05440000
054500                AND  (PRT.SLS_DTE BETWEEN :ASC-KEY-SALES-DATE-FROM05450000
054600                         AND :ASC-KEY-SALES-DATE-TO)              05460000
054700                AND  PRT.STR_GP_CDE     = 'A'                     05470000
054900                AND  TRN.STR_NBR        = SGM.STR_NBR             05490000
055000                AND  SGM.STR_GP_TYP_CDE = 2000                    05500000
055100                AND  SGM.STR_GP_ID = :ASC-KEY-STORE-GROUP         05510000
055200                AND  TRN.PARTN_NBR      = ITM.PARTN_NBR           05520000
055300                AND  TRN.STR_NBR        = ITM.STR_NBR             05530000
055400                AND  TRN.RGST_ID        = ITM.RGST_ID             05540000
055500                AND  TRN.TRN_NBR        = ITM.TRN_NBR             05550000
055600                AND  TRN.STRT_TM        = ITM.STRT_TM             05560000
055700                AND  TRN.SLS_CORR_SEQ_NBR = ITM.SLS_CORR_SEQ_NBR  05570000
055800                AND  TRN.PARTN_NBR      = TND.PARTN_NBR           05580000
055900                AND  TRN.STR_NBR        = TND.STR_NBR             05590000
056000                AND  TRN.RGST_ID        = TND.RGST_ID             05600000
056100                AND  TRN.TRN_NBR        = TND.TRN_NBR             05610000
056200                AND  TRN.STRT_TM        = TND.STRT_TM             05620000
056300                AND  TRN.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR  05630000
056400                AND  TRN.VOID_ABRT_CDE = 'N'                      05640000
056500                AND  TRN.TRN_STAT_CDE IN ('V', 'L', 'Z')          05650000
056600                AND  TRN.TRN_TYP_CDE IN ('01','02','22','23')     05660000
056700                AND  ITM.LIV_RSLU_CDE = '+'                       05670000
056800                AND  ITM.SKU_NBR = :ASC-KEY-SKU-NBR               05680000
056900                AND  ITM.CUST_CHRGD_AMT > 0                       05690000
057000                AND  TND.TNDR_ID LIKE :ASC-KEY-TENDER-ID          05700099
057100                AND  TND.TNDR_VOID_IND = 'N'                      05710000
057200           WITH UR                                                05720000
057300     END-EXEC.                                                    05730000
057400                                                                  05740000
062217     EXEC SQL                                                     06221700
062220          DECLARE DISCOUNT-CSR-OP CURSOR FOR                      06222000
062300         SELECT LID_AMT                                           06230000
062400               ,LID_TYP_CDE                                       06240000
062500               ,LID_PCT                                           06250000
062600           FROM TEPLID                                            06260000
062700          WHERE PARTN_NBR        = :EPPART-PARTN-NBR              06270000
062800            AND STR_NBR          = :EPTRN-STR-NBR                 06280000
062900            AND RGST_ID          = :EPTRN-RGST-ID                 06290000
063000            AND TRN_NBR          = :EPTRN-TRN-NBR                 06300000
063100            AND STRT_TM          = :EPTRN-STRT-TM                 06310000
063200            AND SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR        06320000
063300            AND LNE_ITM_SEQ_NBR  = :EPITM-LNE-ITM-SEQ-NBR         06330000
063400            AND LID_TYP_CDE NOT IN ('R','E','G')                  06340000
063500           WITH UR                                                06350000
063600     END-EXEC.                                                    06360000
063700                                                                  06370000
065400 LINKAGE SECTION.                                                 06540000
065500                                                                  06550000
065600 01  DFHCOMMAREA.                                                 06560000
065700     05  FILLER                         OCCURS  1 TO 4072 TIMES   06570000
065800                                        DEPENDING ON EIBCALEN.    06580000
065900         10  FILLER                     PIC X.                    06590000
066000                                                                  06600000
066100 PROCEDURE DIVISION.                                              06610000
066200*----------------------------------------------------------------*06620000
066300*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *06630000
066400*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *06640000
066500*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *06650000
066600*----------------------------------------------------------------*06660000
066700 0000-MAIN-MODULE.                                                06670000
066800                                                                  06680099
066801     MOVE PC-CURRENT-PROGRAM-NAME TO DP031-PROGRAM-NAME.          06680199
066810     INITIALIZE DP030-CICS-API-FIELDS.                            06681099
066900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06690000
067000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06700000
067100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06710000
067200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06720000
067300     MOVE LENGTH OF IQ412AI        TO DP030-MAP-LENGTH (1).       06730000
067400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06740000
067500     PERFORM 0001-CALL-CICS-ARCH-API.                             06750000
067600                                                                  06760000
067700     PERFORM 1000-CONTROL-PROCESSING                              06770000
067800                                                                  06780000
067900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06790000
068000     PERFORM 0001-CALL-CICS-ARCH-API.                             06800000
068100                                                                  06810000
068200*----------------------------------------------------------------*06820000
068300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *06830000
068400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *06840000
068500*----------------------------------------------------------------*06850000
068600 0001-CALL-CICS-ARCH-API.                                         06860000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06870099
068800                                    DFHCOMMAREA                   06880099
068900                                    DP030-CICS-API-FIELDS         06890099
069000                                    DP020-STANDARD-COMMAREA       06900099
069100                                    IQ412AI.                      06910099
069200                                                                  06920000
069300     IF  DP030-RC-CALL-SUCCESSFUL                                 06930000
069400         CONTINUE                                                 06940000
069500     ELSE                                                         06950000
069600         SET DP013-NO-ROLLBACK                                    06960000
069700             DP013-XCTL-DISPLAY-RESTART                           06970000
069800             DP013-CICS-ABEND      TO TRUE                        06980000
069900         MOVE '0001-CALL-CICS-ARCH-API'                           06990000
070000                                   TO DP013-PARAGRAPH             07000000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07001099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07002099
070300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07030000
070400         PERFORM DP013-0000-PROCESS-ABEND                         07040000
070500     END-IF.                                                      07050000
070600*----------------------------------------------------------------*07060000
070700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07070000
070800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07080000
070900*                                                                *07090000
071000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07100000
071100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07110000
071200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07120000
071300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07130000
071400*----------------------------------------------------------------*07140000
071500                                                                  07150000
071600 1000-CONTROL-PROCESSING.                                         07160000
071700                                                                  07170000
071800     EVALUATE TRUE                                                07180000
071900         WHEN DP020-NEXT-ACT-INITIAL                              07190000
072000             INITIALIZE ASC-SPECIFIC-COMMAREA                     07200000
072100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07210000
072200                                      ASC-SEL-TERM-ID             07220000
072300             MOVE DP020-SRC-TASK-NUMBER                           07230000
072400                                   TO ASC-LIST-TASK-NUMBER        07240000
072500                                      ASC-SEL-TASK-NUMBER         07250000
072600             MOVE PC-LIST-QUEUE-SEQ                               07260000
072700                                   TO ASC-LIST-SEQ                07270000
072800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07280000
072900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07290000
073000***-----$TEMPLATE NOTE$-------------------------------------------07300000
073100*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07310000
073200*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07320000
073300*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07330000
073400***---------------------------------------------------------------07340000
073500             IF  PS-COMMAREA-NOT-VALID                            07350000
073600                 SET DP020-NEXT-ACT-APPL-ERROR                    07360000
073700                                   TO TRUE                        07370000
073800             ELSE                                                 07380000
073900                 PERFORM 4000-BUILD-INITIAL-PANEL                 07390000
074000             END-IF                                               07400000
074100                                                                  07410000
074200         WHEN DP020-NEXT-ACT-READ-MAP                             07420000
074300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07430000
074400                                   TO PV-TOP-ITEM                 07440000
074500             PERFORM 2000-PROCESS-PANEL                           07450000
074600                                                                  07460000
074700         WHEN DP020-NEXT-ACT-RETURN                               07470000
074800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07480000
074900                                   TO PV-TOP-ITEM                 07490000
075000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07500000
075100             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07510000
075200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07520000
075300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07530000
075400                                                                  07540000
075500         WHEN OTHER                                               07550000
075600             SET DP013-LOGIC-ABEND TO TRUE                        07560000
075700             SET DP013-NO-ROLLBACK TO TRUE                        07570000
075800             MOVE '1000-CONTROL-PROCESSING'                       07580000
075900                                   TO DP013-PARAGRAPH             07590000
076000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07600000
076100                                   TO DP013-MESSAGE-TEXT(1)       07610000
076200             PERFORM DP013-0000-PROCESS-ABEND                     07620000
076300     END-EVALUATE.                                                07630000
076400                                                                  07640000
076500*----------------------------------------------------------------*07650000
076600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07660000
076700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07670000
076800*----------------------------------------------------------------*07680000
076900                                                                  07690000
077000 1100-PROCESS-INTER-APPL-COMM.                                    07700000
077100                                                                  07710000
077200     SET PS-COMMAREA-VALID         TO TRUE.                       07720000
077300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07730000
077400     MOVE IQ002-SALES-DATE-FROM    TO ASC-KEY-SALES-DATE-FROM.    07740000
077500     MOVE IQ002-SALES-DATE-TO      TO ASC-KEY-SALES-DATE-TO.      07750000
077600     MOVE IQ002-STORE              TO ASC-KEY-STORE.              07760000
077700     MOVE IQ002-TENDER-ID          TO ASC-KEY-TENDER-ID.          07770000
077800     MOVE IQ002-UPC-NBR            TO ASC-KEY-UPC-NBR.            07780000
077900                                                                  07790000
078000*----------------------------------------------------------------*07800000
078100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07810000
078200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07820000
078300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07830000
078400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07840000
078500* FUNCTION KEYS CAN GET THIS FAR.                                *07850000
078600*----------------------------------------------------------------*07860000
078700                                                                  07870000
078800 2000-PROCESS-PANEL.                                              07880000
078900     EVALUATE TRUE                                                07890000
079000         WHEN DP020-SRC-AID = DP016-CLEAR                         07900000
079100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07910000
079200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07920000
079300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07930000
079400                                                                  07940000
079500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07950000
079600             PERFORM 4000-BUILD-INITIAL-PANEL                     07960000
079700                                                                  07970000
079800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07980000
079900             PERFORM 2140-DESELECT-ALL-ITEMS                      07990000
080000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08000000
080100                                                                  08010000
080200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08020000
080300             PERFORM 2150-SELECT-ALL-ITEMS                        08030000
080400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08040000
080500                                                                  08050000
080600         WHEN OTHER                                               08060000
080700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08070000
080800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08080000
080900             IF  PS-NO-ERROR                                      08090000
081000                 SET DP030-CONTINUE-GO                            08100000
081100                                 TO TRUE                          08110000
081200                 PERFORM 2100-CHECK-FUNCTION-KEY                  08120000
081300             ELSE                                                 08130000
081400                 SET DP030-OVERRIDE-GO                            08140000
081500                                 TO TRUE                          08150000
081600             END-IF                                               08160000
081700     END-EVALUATE.                                                08170000
081800                                                                  08180000
081900*----------------------------------------------------------------*08190000
082000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08200000
082100*----------------------------------------------------------------*08210000
082200 2050-DELETE-LIST-QUEUE.                                          08220000
082300                                                                  08230000
082400     EXEC CICS                                                    08240000
082500         DELETEQ TS                                               08250000
082600             QUEUE (ASC-LIST-QUEUE-NAME)                          08260000
082700             RESP  (PV-CICS-RESP)                                 08270000
082800     END-EXEC.                                                    08280000
082900                                                                  08290000
083000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08300000
083100        (PV-CICS-RESP = DFHRESP(QIDERR))                          08310000
083200         CONTINUE                                                 08320000
083300     ELSE                                                         08330000
083400         SET DP013-CICS-ABEND      TO TRUE                        08340000
083500         SET DP013-NO-ROLLBACK     TO TRUE                        08350000
083600                                                                  08360000
083700         MOVE '2050-DELETE-LIST-QUEUE'                            08370000
083800                                   TO DP013-PARAGRAPH             08380000
083900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08390000
084000                                   TO DP013-MESSAGE-TEXT (1)      08400000
084100         PERFORM DP013-0000-PROCESS-ABEND                         08410000
084200     END-IF.                                                      08420000
084300                                                                  08430000
084400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08440000
084500                                                                  08450000
084600*----------------------------------------------------------------*08460000
084700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08470000
084800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08480000
084900* CICS ARCHITECTURE API.                                         *08490000
085000*----------------------------------------------------------------*08500000
085100 2100-CHECK-FUNCTION-KEY.                                         08510000
085200     EVALUATE TRUE                                                08520000
085300         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08530000
085400                                                                  08540000
085500             IF  ASC-NUMBER-OF-SELECTED-ITEMS = +1                08550000
085600                 INITIALIZE IQ004-INTER-APPL-COMMAREA             08560000
085700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08570000
085800                                TO IQ004-NUMBER-OF-SELECTED-ITEMS 08580000
085900                 PERFORM 5000-PREPARE-SEL-QUEUE                   08590000
086000             ELSE                                                 08600000
086100                 IF ASC-NUMBER-OF-SELECTED-ITEMS > +1             08610000
086200                     SET DP030-OVERRIDE-GO                        08620000
086300                                   TO TRUE                        08630000
086400                     MOVE PC-TSYMSG-00047                         08640000
086500                                   TO DP020-MSG-NUMBER            08650000
086600                     SET DP020-MSG-FATAL                          08660000
086700                                   TO TRUE                        08670000
086800                 ELSE                                             08680000
086900                     SET DP030-OVERRIDE-GO                        08690000
087000                                   TO TRUE                        08700000
087100                     MOVE PC-TSYMSG-00057                         08710000
087200                                   TO DP020-MSG-NUMBER            08720000
087300                     SET DP020-MSG-WARNING                        08730000
087400                                   TO TRUE                        08740000
087500                 END-IF                                           08750000
087600             END-IF                                               08760000
087700                                                                  08770000
087800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08780000
087900             MOVE +1               TO PV-TOP-ITEM                 08790000
088000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08800000
088100                                                                  08810000
088200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08820000
088300             PERFORM 2110-BROWSE-BACKWARD                         08830000
088400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08840000
088500                                                                  08850000
088600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08860000
088700             PERFORM 2120-BROWSE-FORWARD                          08870000
088800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08880000
088900                                                                  08890000
089000         WHEN DP020-SRC-AID = DP016-ENTER                         08900000
089100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08910000
089200             IF  PS-ERROR                                         08920000
089300                 CONTINUE                                         08930000
089400             ELSE                                                 08940000
089500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08950000
089600             END-IF                                               08960000
089700                                                                  08970000
089800         WHEN OTHER                                               08980000
089900             SET DP013-NO-ROLLBACK                                08990000
090000                 DP013-XCTL-DISPLAY-RESTART                       09000000
090100                 DP013-CICS-ABEND  TO TRUE                        09010000
090200             MOVE '2100-CHECK-FUNCTION-KEY'                       09020000
090300                                   TO DP013-PARAGRAPH             09030000
090400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09040000
090500                                   TO DP013-MESSAGE-TEXT (1)      09050000
090600             PERFORM DP013-0000-PROCESS-ABEND                     09060000
090700     END-EVALUATE.                                                09070000
090800                                                                  09080000
090900*----------------------------------------------------------------*09090000
091000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09100000
091100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09110000
091200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09120000
091300*    MESSAGE.                                                    *09130000
091400*----------------------------------------------------------------*09140000
091500                                                                  09150000
091600 2110-BROWSE-BACKWARD.                                            09160000
091700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09170000
091800         GIVING PV-TOP-ITEM.                                      09180000
091900                                                                  09190000
092000     IF  ((PV-TOP-ITEM < +1)                                      09200000
092100       OR (PV-TOP-ITEM = +1))                                     09210000
092200         MOVE +1                   TO PV-TOP-ITEM                 09220000
092300*        -- TOP OF LIST --                                        09230000
092400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09240000
092500         SET DP020-MSG-INFORMATIONAL TO TRUE                      09250000
092600     END-IF.                                                      09260000
092700                                                                  09270000
092800*----------------------------------------------------------------*09280000
092900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09290000
093000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09300000
093100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09310000
093200*----------------------------------------------------------------*09320000
093300 2120-BROWSE-FORWARD.                                             09330000
093400                                                                  09340000
093500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09350000
093600         GIVING PV-TOP-ITEM.                                      09360000
093700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09370000
093800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09380000
093900                                   TO PV-TOP-ITEM                 09390000
094000*        -- BOTTOM OF LIST --                                     09400000
094100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09410000
094200         SET DP020-MSG-INFORMATIONAL                              09420000
094300                                   TO TRUE                        09430000
094400     ELSE                                                         09440000
094500         COMPUTE PV-BOTTOM-ITEM =                                 09450000
094600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09460000
094700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09470000
094800*            -- BOTTOM OF LIST --                                 09480000
094900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09490000
095000             SET DP020-MSG-INFORMATIONAL                          09500000
095100                                   TO TRUE                        09510000
095200         END-IF                                                   09520000
095300     END-IF.                                                      09530000
095400                                                                  09540000
095500*----------------------------------------------------------------*09550000
095600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09560000
095700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09570000
095800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09580000
095900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09590000
096000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09600000
096100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09610000
096200*----------------------------------------------------------------*09620000
096300 2130-CHECK-FOR-JUMP-BROWSE.                                      09630000
096400                                                                  09640000
096500     IF ASTRTITL > ZERO                                           09650000
096600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      09660000
096700     ELSE                                                         09670000
096800         IF ASTRTITF = DP015-ERASE-EOF                            09680000
096900             INITIALIZE ASC-START-ITEM-REQUEST                    09690000
097000         END-IF                                                   09700000
097100     END-IF.                                                      09710000
097200                                                                  09720000
097300     SET PS-NO-ERROR               TO TRUE.                       09730000
097400     IF (ASC-START-ITEM-REQUEST = SPACE)                          09740000
097500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09750000
097600                                   TO PV-TOP-ITEM                 09760000
097700     ELSE                                                         09770000
097800         MOVE ASC-START-ITEM-REQUEST                              09780000
097900                                   TO DP010I-UNEDITED-FIELD       09790000
098000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09800000
098100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09810000
098200         SET DP010I-NEGATIVE-NOT-ALLOWED                          09820000
098300                                   TO TRUE                        09830000
098410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09841099
098420                         USING DP010I-NUMERIC-EDIT-AREA           09842099
098500                                                                  09850000
098600         IF  NOT DP010I-ERROR-DETECTED                            09860000
098700             MOVE DP010I-NUMERIC-FIELD                            09870000
098800                                   TO  ASC-START-ITEM-REQUEST-N   09880000
098900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09890000
099000                 IF  ASC-START-ITEM-REQUEST-N >                   09900000
099100                                          ASC-NUMBER-OF-ITEMS-READ09910000
099200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09920000
099300                     COMPUTE PV-TOP-ITEM =                        09930000
099400                             ASC-NUMBER-OF-ITEMS-READ             09940000
099500                             - PC-ITEMS-PER-PANEL + 1             09950000
099600                     IF  PV-TOP-ITEM < +1                         09960000
099700                         MOVE +1   TO PV-TOP-ITEM                 09970000
099800                         MOVE PC-TSYMSG-00070                     09980000
099900                                   TO DP020-MSG-NUMBER            09990000
100000                         SET DP020-MSG-INFORMATIONAL              10000000
100100                                   TO TRUE                        10010000
100200                     END-IF                                       10020000
100300                 ELSE                                             10030000
100400                     MOVE ASC-START-ITEM-REQUEST-N                10040000
100500                                   TO PV-TOP-ITEM                 10050000
100600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10060000
100700                     COMPUTE PV-BOTTOM-ITEM =                     10070000
100800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10080000
100900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10090000
101000*                        -- BOTTOM OF LIST --                     10100000
101100                         MOVE PC-TSYMSG-00070                     10110000
101200                                   TO DP020-MSG-NUMBER            10120000
101300                         SET DP020-MSG-INFORMATIONAL              10130000
101400                                   TO TRUE                        10140000
101500                     END-IF                                       10150000
101600                 END-IF                                           10160000
101700             ELSE                                                 10170000
101800*                --- VALUE OUT OF RANGE ----                      10180000
101900                 MOVE PC-TSYMSG-00101                             10190000
102000                                   TO DP020-MSG-NUMBER            10200000
102100                 MOVE -1           TO ASTRTITL                    10210000
102200                 SET DP030-SET-CURSOR-APPL-1                      10220000
102300                                   TO TRUE                        10230000
102400                 MOVE DP015-REVERSE                               10240000
102500                                   TO ASTRTITH                    10250000
102600                 MOVE DP015-RED    TO ASTRTITC                    10260000
102700                 MOVE DP015-UNP-NUM-BRT-MDT                       10270000
102800                                   TO ASTRTITA                    10280000
102900                 SET DP020-MSG-FATAL                              10290000
103000                                   TO TRUE                        10300000
103100                 SET PS-ERROR      TO TRUE                        10310000
103200             END-IF                                               10320000
103300                                                                  10330000
103400         ELSE                                                     10340000
103500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10350000
103600             MOVE -1               TO ASTRTITL                    10360000
103700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10370000
103800             MOVE DP015-REVERSE    TO ASTRTITH                    10380000
103900             MOVE DP015-RED        TO ASTRTITC                    10390000
104000             MOVE DP015-UNP-NUM-BRT-MDT                           10400000
104100                                   TO ASTRTITA                    10410000
104200             SET DP020-MSG-FATAL   TO TRUE                        10420000
104300             SET PS-ERROR          TO TRUE                        10430000
104400         END-IF                                                   10440000
104500     END-IF.                                                      10450000
104600                                                                  10460000
104700*----------------------------------------------------------------*10470000
104800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10480000
104900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10490000
105000*----------------------------------------------------------------*10500000
105100 2140-DESELECT-ALL-ITEMS.                                         10510000
105200                                                                  10520000
105300     MOVE +1                       TO ASC-BLK-SUB.                10530000
105400                                                                  10540000
105500     PERFORM 2141-CLEAR-SELECTED-INDS                             10550000
105600         VARYING ASC-ITEM-SUB                                     10560000
105700         FROM 1 BY 1                                              10570000
105800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10580000
105900                                                                  10590000
106000     ADD +1                        TO ASC-BLK-SUB.                10600000
106100                                                                  10610000
106200     PERFORM 2141-CLEAR-SELECTED-INDS                             10620000
106300         VARYING ASC-ITEM-SUB                                     10630000
106400         FROM 1 BY 1                                              10640000
106500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10650000
106600                                                                  10660000
106700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10670000
106800                                   TO PV-LIST-ITEM-NUMBER.        10680000
106900                                                                  10690000
107000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10700000
107100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10710000
107200                                                                  10720000
107300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10730000
107400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10740000
107500         MOVE +1                   TO ASC-BLK-SUB                 10750000
107600                                                                  10760000
107700         PERFORM 5100-WRITE-TEMP-STORAGE                          10770000
107800                                                                  10780000
107900         MOVE +1                   TO PV-BLOCK-NUMBER             10790000
108000                                                                  10800000
108100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10810000
108200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10820000
108300                                                                  10830000
108400         PERFORM                                                  10840000
108500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10850000
108600                                                                  10860000
108700             PERFORM 4410-READ-TEMP-STORAGE                       10870000
108800                                                                  10880000
108900             PERFORM 2141-CLEAR-SELECTED-INDS                     10890000
109000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10900000
109100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10910000
109200                                                                  10920000
109300             PERFORM 5100-WRITE-TEMP-STORAGE                      10930000
109400                                                                  10940000
109500             ADD +1                TO PV-BLOCK-NUMBER             10950000
109600                                                                  10960000
109700         END-PERFORM                                              10970000
109800                                                                  10980000
109900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10990000
110000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11000000
110100                                                                  11010000
110200         PERFORM                                                  11020000
110300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11030000
110400                   ASC-HIGHEST-BLOCK-WRITTEN                      11040000
110500                                                                  11050000
110600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11060000
110700                                   TO PV-BLOCK-NUMBER             11070000
110800                                                                  11080000
110900             PERFORM 4410-READ-TEMP-STORAGE                       11090000
111000                                                                  11100000
111100             PERFORM 2141-CLEAR-SELECTED-INDS                     11110000
111200                 VARYING ASC-ITEM-SUB                             11120000
111300                 FROM 1 BY 1                                      11130000
111400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11140000
111500                                                                  11150000
111600             PERFORM 5100-WRITE-TEMP-STORAGE                      11160000
111700                                                                  11170000
111800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11180000
111900                                                                  11190000
112000         END-PERFORM                                              11200000
112100                                                                  11210000
112200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11220000
112300                                   TO PV-BLOCK-NUMBER             11230000
112400                                                                  11240000
112500         PERFORM 4410-READ-TEMP-STORAGE                           11250000
112600     END-IF.                                                      11260000
112700                                                                  11270000
112800                                                                  11280000
112900     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS  11290000
113000                                    ASC-START-OF-SELECTED-RANGE   11300000
113100                                    ASC-END-OF-SELECTED-RANGE.    11310000
113200                                                                  11320000
113300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11330000
113400                                                                  11340000
113500*----------------------------------------------------------------*11350000
113600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11360000
113700*----------------------------------------------------------------*11370000
113800 2141-CLEAR-SELECTED-INDS.                                        11380000
113900                                                                  11390000
114000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11400000
114100             NOT EQUAL ZERO                                       11410000
114200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11420000
114300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11430000
114400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11440000
114500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11450000
114600                                   TO TRUE                        11460000
114700         END-IF                                                   11470000
114800     END-IF.                                                      11480000
114900                                                                  11490000
115000*----------------------------------------------------------------*11500000
115100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11510000
115200*  FOR ALL ITEMS.                                                *11520000
115300*----------------------------------------------------------------*11530000
115400 2150-SELECT-ALL-ITEMS.                                           11540000
115500                                                                  11550000
115600     MOVE +1                       TO ASC-BLK-SUB.                11560000
115700                                                                  11570000
115800     PERFORM 2151-SET-SELECTED-INDS                               11580000
115900         VARYING ASC-ITEM-SUB                                     11590000
116000         FROM 1 BY 1                                              11600000
116100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11610000
116200                                                                  11620000
116300     ADD +1                        TO ASC-BLK-SUB.                11630000
116400                                                                  11640000
116500     PERFORM 2151-SET-SELECTED-INDS                               11650000
116600         VARYING ASC-ITEM-SUB                                     11660000
116700         FROM 1 BY 1                                              11670000
116800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11680000
116900                                                                  11690000
117000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11700000
117100                                   TO PV-LIST-ITEM-NUMBER.        11710000
117200                                                                  11720000
117300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11730000
117400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11740000
117500                                                                  11750000
117600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11760000
117700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11770000
117800         MOVE +1                   TO ASC-BLK-SUB                 11780000
117900                                                                  11790000
118000         PERFORM 5100-WRITE-TEMP-STORAGE                          11800000
118100                                                                  11810000
118200         MOVE +1                   TO PV-BLOCK-NUMBER             11820000
118300                                                                  11830000
118400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11840000
118500             PV-FIRST-BLOCK-IN-ARRAY - 1                          11850000
118600                                                                  11860000
118700         PERFORM                                                  11870000
118800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11880000
118900                                                                  11890000
119000             PERFORM 4410-READ-TEMP-STORAGE                       11900000
119100                                                                  11910000
119200             PERFORM 2151-SET-SELECTED-INDS                       11920000
119300                 VARYING ASC-ITEM-SUB                             11930000
119400                 FROM 1 BY 1                                      11940000
119500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11950000
119600                                                                  11960000
119700             PERFORM 5100-WRITE-TEMP-STORAGE                      11970000
119800                                                                  11980000
119900             ADD +1                TO PV-BLOCK-NUMBER             11990000
120000                                                                  12000000
120100         END-PERFORM                                              12010000
120200                                                                  12020000
120300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12030000
120400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12040000
120500                                                                  12050000
120600         PERFORM                                                  12060000
120700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12070000
120800                   ASC-HIGHEST-BLOCK-WRITTEN                      12080000
120900                                                                  12090000
121000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12100000
121100                                   TO PV-BLOCK-NUMBER             12110000
121200                                                                  12120000
121300             PERFORM 4410-READ-TEMP-STORAGE                       12130000
121400                                                                  12140000
121500             PERFORM 2151-SET-SELECTED-INDS                       12150000
121600                 VARYING ASC-ITEM-SUB                             12160000
121700                 FROM 1 BY 1                                      12170000
121800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12180000
121900                                                                  12190000
122000             PERFORM 5100-WRITE-TEMP-STORAGE                      12200000
122100                                                                  12210000
122200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12220000
122300                                                                  12230000
122400         END-PERFORM                                              12240000
122500                                                                  12250000
122600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12260000
122700                                   TO PV-BLOCK-NUMBER             12270000
122800                                                                  12280000
122900         PERFORM 4410-READ-TEMP-STORAGE                           12290000
123000     END-IF.                                                      12300000
123100                                                                  12310000
123200                                                                  12320000
123300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12330000
123400                       ASC-NUMBER-OF-SELECTED-ITEMS.              12340000
123500                                                                  12350000
123600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12360000
123700                                                                  12370000
123800*----------------------------------------------------------------*12380000
123900*    MARK EACH ITEM AS BEING SELECTED.                           *12390000
124000*----------------------------------------------------------------*12400000
124100 2151-SET-SELECTED-INDS.                                          12410000
124200                                                                  12420000
124300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12430000
124400             NOT EQUAL ZERO                                       12440000
124500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12450000
124600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12460000
124700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12470000
124800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12480000
124900                               TO  TRUE                           12490000
125000         END-IF                                                   12500000
125100     END-IF.                                                      12510000
125200*----------------------------------------------------------------*12520000
125300*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12530000
125400*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12540000
125500*----------------------------------------------------------------*12550000
125600 2200-MOVE-SCREEN-TO-COMMAREA.                                    12560000
125700                                                                  12570000
125800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12580000
125900     MOVE +1                       TO PV-SUB.                     12590000
126000                                                                  12600000
126100     PERFORM 3100-SET-SUBSCRIPTS.                                 12610000
126200     IF  ASTRTITL > ZERO                                          12620000
126300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12630000
126400     ELSE                                                         12640000
126500         IF  ASTRTITF = DP015-ERASE-EOF                           12650000
126600             INITIALIZE ASC-START-ITEM-REQUEST                    12660000
126700         END-IF                                                   12670000
126800     END-IF.                                                      12680000
126900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12690000
127000         VARYING PV-SUB                                           12700000
127100         FROM 1 BY 1                                              12710000
127200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12720000
127300*----------------------------------------------------------------*12730000
127400*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *12740000
127500*----------------------------------------------------------------*12750000
127600 2210-MOVE-LINES-TO-COMMAREA.                                     12760000
127700     IF  MR-SELECTL (PV-SUB) > ZERO                               12770000
127800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12780000
127900         MOVE MR-SELECTI (PV-SUB)                                 12790000
128000                                   TO ASC-TEMP-SELECTED-SW        12800000
128100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12810000
128200     ELSE                                                         12820000
128300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12830000
128400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12840000
128500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12850000
128600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12860000
128700         END-IF                                                   12870000
128800     END-IF.                                                      12880000
128900                                                                  12890000
129000     ADD +1                        TO ASC-ITEM-SUB.               12900000
129100                                                                  12910000
129200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12920000
129300         ADD +1                    TO ASC-BLK-SUB                 12930000
129400         MOVE +1                   TO ASC-ITEM-SUB                12940000
129500     END-IF.                                                      12950000
129600*----------------------------------------------------------------*12960000
129700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12970000
129800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12980000
129900*----------------------------------------------------------------*12990000
130000 3000-EDIT-DATA-IN-COMMAREA.                                      13000000
130100     SET PS-NO-ERROR               TO TRUE.                       13010000
130200     PERFORM 3200-RESET-ATTRIBUTES.                               13020000
130300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13030000
130400**                                                                13040000
130500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13050000
130600* EDITTING IS DONE FROM THE BOTTOM UP.                            13060000
130700**                                                                13070000
130800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13080000
130900         ASC-ITEMS-DISPLAYED - 1.                                 13090000
131000     PERFORM 3100-SET-SUBSCRIPTS.                                 13100000
131100     PERFORM 3300-EDIT-SELECTIONS                                 13110000
131200         VARYING PV-SUB                                           13120000
131300         FROM PV-SUB BY -1                                        13130000
131400         UNTIL PV-SUB < +1                                        13140000
131500                                                                  13150000
131600     IF  PS-NO-ERROR                                              13160000
131700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13170000
131800     END-IF.                                                      13180000
131900                                                                  13190000
132000     IF  ((PS-NO-ERROR)                                           13200000
132100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13210000
132200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13220000
132300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13230000
132400     END-IF.                                                      13240000
132500                                                                  13250000
132600*----------------------------------------------------------------*13260000
132700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13270000
132800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13280000
132900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13290000
133000*                                                                *13300000
133100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13310000
133200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13320000
133300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13330000
133400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13340000
133500*----------------------------------------------------------------*13350000
133600                                                                  13360000
133700 3100-SET-SUBSCRIPTS.                                             13370000
133800                                                                  13380000
133900     COMPUTE ASC-ITEM-SUB =                                       13390000
134000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13400000
134100                                                                  13410000
134200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13420000
134300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13430000
134400                                                                  13440000
134500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13450000
134600     ELSE                                                         13460000
134700         MOVE +1                     TO ASC-BLK-SUB               13470000
134800     END-IF.                                                      13480000
134900*----------------------------------------------------------------*13490000
135000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13500000
135100*----------------------------------------------------------------*13510000
135200                                                                  13520000
135300 3200-RESET-ATTRIBUTES.                                           13530000
135400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13540000
135500     MOVE DP015-GREEN              TO ASTRTITC.                   13550000
135600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13560000
135700                                                                  13570000
135800     PERFORM                                                      13580000
135900         VARYING PV-SUB                                           13590000
136000         FROM 1 BY 1                                              13600000
136100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13610000
136200         MOVE DP015-UNP-ALP-NOR-OFF                               13620000
136300                                   TO MR-SELECTA (PV-SUB)         13630000
136400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13640000
136500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13650000
136600     END-PERFORM.                                                 13660000
136700*----------------------------------------------------------------*13670000
136800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13680000
136900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13690000
137000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13700000
137100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13710000
137200*----------------------------------------------------------------*13720000
137300 3300-EDIT-SELECTIONS.                                            13730000
137400     EVALUATE TRUE                                                13740000
137500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13750000
137600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13760000
137700                 CONTINUE                                         13770000
137800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13780000
137900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13790000
138000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13800000
138100                 MOVE ASC-TEMP-SELECTED-SW                        13810000
138200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13820000
138300                                TO ASC-SELECTED-SW                13830000
138400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13840000
138500             END-IF                                               13850000
138600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13860000
138700                 = SPACE                                          13870000
138800             EVALUATE TRUE                                        13880000
138900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13890000
139000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13900000
139100                     MOVE SPACE TO ASC-SELECTED-SW                13910000
139200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13920000
139300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13930000
139400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13940000
139500                     MOVE SPACE TO ASC-SELECTED-SW                13950000
139600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13960000
139700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13970000
139800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13980000
139900                     MOVE SPACE TO ASC-SELECTED-SW                13990000
140000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14000000
140100             END-EVALUATE                                         14010000
140200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14020000
140300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14030000
140400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14040000
140500             END-IF                                               14050000
140600             PERFORM 3310-EDIT-RANGE                              14060000
140700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14070000
140800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14080000
140900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14090000
141000             END-IF                                               14100000
141100             PERFORM 3310-EDIT-RANGE                              14110000
141200         WHEN OTHER                                               14120000
141300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14130000
141400             SET DP020-MSG-FATAL    TO TRUE                       14140000
141500             MOVE -1                TO MR-SELECTL (PV-SUB)        14150000
141600             SET DP030-SET-CURSOR-APPL-1                          14160000
141700                                    TO TRUE                       14170000
141800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14180000
141900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14190000
142000             SET PS-ERROR TO TRUE                                 14200000
142100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14210000
142200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14220000
142300                 MOVE SPACE         TO ASC-SELECTED-SW            14230000
142400                                        (ASC-BLK-SUB ASC-ITEM-SUB)14240000
142500             END-IF                                               14250000
142600     END-EVALUATE.                                                14260000
142700                                                                  14270000
142800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14280000
142900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14290000
143000     IF  ASC-ITEM-SUB < 1                                         14300000
143100         SUBTRACT +1 FROM ASC-BLK-SUB                             14310000
143200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14320000
143300     END-IF.                                                      14330000
143400*----------------------------------------------------------------*14340000
143500*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *14350000
143600*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *14360000
143700*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *14370000
143800*  THE ENDING.                                                   *14380000
143900*----------------------------------------------------------------*14390000
144000 3310-EDIT-RANGE.                                                 14400000
144100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14410000
144200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14420000
144300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14430000
144400                                   TO ASC-SELECTED-SW             14440000
144500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14450000
144600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14460000
144700         ELSE                                                     14470000
144800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14480000
144900                 CONTINUE                                         14490000
145000             ELSE                                                 14500000
145100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14510000
145200                 MOVE PC-TSYMSG-00054                             14520000
145300                                   TO DP020-MSG-NUMBER            14530000
145400                 SET DP020-MSG-FATAL                              14540000
145500                                   TO TRUE                        14550000
145600                 MOVE -1           TO MR-SELECTL (PV-SUB)         14560000
145700                 SET DP030-SET-CURSOR-APPL-1                      14570000
145800                                   TO TRUE                        14580000
145900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14590000
146000                 MOVE DP015-UNDERLINE                             14600000
146100                                   TO MR-SELECTH (PV-SUB)         14610000
146200                 SET PS-ERROR      TO TRUE                        14620000
146300             END-IF                                               14630000
146400         END-IF                                                   14640000
146500     ELSE                                                         14650000
146600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14660000
146700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14670000
146800                                   TO ASC-SELECTED-SW             14680000
146900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14690000
147000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14700000
147100         ELSE                                                     14710000
147200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14720000
147300                 CONTINUE                                         14730000
147400             ELSE                                                 14740000
147500*                -- ONLY ONE END-OF-RANGE ALLOWED --              14750000
147600                 MOVE PC-TSYMSG-00055                             14760000
147700                                   TO DP020-MSG-NUMBER            14770000
147800                 SET DP020-MSG-FATAL                              14780000
147900                                   TO TRUE                        14790000
148000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14800000
148100                 SET DP030-SET-CURSOR-APPL-1                      14810000
148200                                   TO TRUE                        14820000
148300                 SET PS-ERROR      TO TRUE                        14830000
148400             END-IF                                               14840000
148500         END-IF                                                   14850000
148600     END-IF.                                                      14860000
148700                                                                  14870000
148800*----------------------------------------------------------------*14880000
148900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14890000
149000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14900000
149100*----------------------------------------------------------------*14910000
149200 3400-CHECK-RANGE-SEQUENCE.                                       14920000
149300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14930000
149400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14940000
149500       AND  ASC-START-OF-SELECTED-RANGE >                         14950000
149600                                         ASC-END-OF-SELECTED-RANGE14960000
149700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14970000
149800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14980000
149900         SET DP020-MSG-FATAL TO TRUE                              14990000
150000         SET PS-ERROR TO TRUE                                     15000000
150100         PERFORM 3410-POSITION-AT-ERROR                           15010000
150200     END-IF.                                                      15020000
150300*----------------------------------------------------------------*15030000
150400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *15040000
150500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *15050000
150600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *15060000
150700*----------------------------------------------------------------*15070000
150800 3410-POSITION-AT-ERROR.                                          15080000
150900     SET DP030-SET-CURSOR-APPL-1                                  15090000
151000                                   TO TRUE.                       15100000
151100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15110000
151200                    - PV-TOP-ITEM + 1.                            15120000
151300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15130000
151400         CONTINUE                                                 15140000
151500     ELSE                                                         15150000
151600         CONTINUE                                                 15160000
151700         MOVE -1                   TO MR-SELECTL (PV-SUB)         15170000
151800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15180000
151900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15190000
152000     END-IF.                                                      15200000
152100                                                                  15210000
152200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15220000
152300                    - PV-TOP-ITEM + 1.                            15230000
152400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15240000
152500         CONTINUE                                                 15250000
152600     ELSE                                                         15260000
152700         CONTINUE                                                 15270000
152800         MOVE -1                   TO MR-SELECTL (PV-SUB)         15280000
152900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15290000
153000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15300000
153100     END-IF.                                                      15310000
153200                                                                  15320000
153300*----------------------------------------------------------------*15330000
153400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15340000
153500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15350000
153600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15360000
153700*----------------------------------------------------------------*15370000
153800                                                                  15380000
153900 3500-MARK-RANGE-AS-SELECTED.                                     15390000
154000     MOVE +1                       TO  ASC-BLK-SUB.               15400000
154100     PERFORM 3510-MARK-SELECTED-INDS                              15410000
154200         VARYING ASC-ITEM-SUB                                     15420000
154300         FROM 1 BY 1                                              15430000
154400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15440000
154500                                                                  15450000
154600     ADD +1                        TO ASC-BLK-SUB.                15460000
154700     PERFORM 3510-MARK-SELECTED-INDS                              15470000
154800         VARYING ASC-ITEM-SUB                                     15480000
154900         FROM 1 BY 1                                              15490000
155000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15500000
155100                                                                  15510000
155200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15520000
155300                                   TO  PV-LIST-ITEM-NUMBER.       15530000
155400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15540000
155500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15550000
155600               PC-ITEMS-PER-PANEL).                               15560000
155700                                                                  15570000
155800     MOVE ASC-START-OF-SELECTED-RANGE                             15580000
155900                                   TO PV-START-OF-SELECTED-RANGE. 15590000
156000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15600000
156100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15610000
156200               PC-ITEMS-PER-PANEL).                               15620000
156300                                                                  15630000
156400     MOVE ASC-END-OF-SELECTED-RANGE                               15640000
156500                                   TO  PV-END-OF-SELECTED-RANGE.  15650000
156600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15660000
156700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15670000
156800               PC-ITEMS-PER-PANEL).                               15680000
156900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15690000
157000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15700000
157100                                                                  15710000
157200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15720000
157300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15730000
157400         MOVE +1                   TO ASC-BLK-SUB                 15740000
157500         PERFORM 5100-WRITE-TEMP-STORAGE                          15750000
157600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15760000
157700             PV-FIRST-BLOCK-IN-ARRAY - 1                          15770000
157800                                                                  15780000
157900         PERFORM                                                  15790000
158000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15800000
158100                   PV-PREV-BLOCK-IN-ARRAY                         15810000
158200             MOVE PV-FIRST-BLOCK-IN-RANGE                         15820000
158300                                   TO PV-BLOCK-NUMBER             15830000
158400             PERFORM 4410-READ-TEMP-STORAGE                       15840000
158500             PERFORM 3510-MARK-SELECTED-INDS                      15850000
158600                 VARYING ASC-ITEM-SUB                             15860000
158700                 FROM 1 BY 1                                      15870000
158800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15880000
158900             PERFORM 5100-WRITE-TEMP-STORAGE                      15890000
159000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15900000
159100         END-PERFORM                                              15910000
159200                                                                  15920000
159300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15930000
159400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15940000
159500         PERFORM                                                  15950000
159600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15960000
159700                   PV-LAST-BLOCK-IN-RANGE                         15970000
159800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15980000
159900                                   TO PV-BLOCK-NUMBER             15990000
160000             PERFORM 4410-READ-TEMP-STORAGE                       16000000
160100             PERFORM 3510-MARK-SELECTED-INDS                      16010000
160200                 VARYING ASC-ITEM-SUB                             16020000
160300                 FROM 1 BY 1                                      16030000
160400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16040000
160500             PERFORM 5100-WRITE-TEMP-STORAGE                      16050000
160600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16060000
160700         END-PERFORM                                              16070000
160800                                                                  16080000
160900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16090000
161000                                   TO PV-BLOCK-NUMBER             16100000
161100         PERFORM 4410-READ-TEMP-STORAGE                           16110000
161200     END-IF.                                                      16120000
161300                                                                  16130000
161400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16140000
161500                                      ASC-END-OF-SELECTED-RANGE.  16150000
161600                                                                  16160000
161700*----------------------------------------------------------------*16170000
161800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16180000
161900*----------------------------------------------------------------*16190000
162000                                                                  16200000
162100 3510-MARK-SELECTED-INDS.                                         16210000
162200                                                                  16220000
162300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16230000
162400                                ASC-ITEM-SUB) >                   16240000
162500         ASC-START-OF-SELECTED-RANGE)                             16250000
162600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16260000
162700                                ASC-ITEM-SUB) =                   16270000
162800         ASC-START-OF-SELECTED-RANGE)                             16280000
162900                                                                  16290000
163000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16300000
163100                                    ASC-ITEM-SUB) <               16310000
163200             ASC-END-OF-SELECTED-RANGE)                           16320000
163300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16330000
163400                                    ASC-ITEM-SUB) =               16340000
163500             ASC-END-OF-SELECTED-RANGE)                           16350000
163600                                                                  16360000
163700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16370000
163800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16380000
163900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16390000
164000                               TO TRUE                            16400000
164100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16410000
164200                               TO TRUE                            16420000
164300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16430000
164400             END-IF                                               16440000
164500         END-IF                                                   16450000
164600     END-IF.                                                      16460000
164700                                                                  16470000
164800*----------------------------------------------------------------*16480000
164900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16490000
165000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16500000
165100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16510000
165200*    DISPLAY THE PANEL TO USER.                                  *16520000
165300*----------------------------------------------------------------*16530000
165400                                                                  16540000
165500 4000-BUILD-INITIAL-PANEL.                                        16550000
165600                                                                  16560000
165700     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             16570000
165800                                ASC-BLOCK-ENTRIES (2).            16580000
165900     MOVE +1                 TO ASC-BLK-SUB.                      16590000
166000                                                                  16600000
166100     SET ASC-ITEMS-LEFT-ON-DB                                     16610000
166200                             TO TRUE.                             16620000
166300                                                                  16630000
166400     MOVE +0                 TO ASC-ITEM-SUB                      16640000
166500                                ASC-NUMBER-OF-ITEMS-READ          16650000
166600                                ASC-NUMBER-OF-SELECTED-ITEMS      16660000
166700                                ASC-HIGHEST-BLOCK-WRITTEN         16670000
166800                                ASC-START-OF-SELECTED-RANGE       16680000
166900                                ASC-END-OF-SELECTED-RANGE         16690000
167000                                ASC-ITEM-AT-TOP-OF-PANEL.         16700000
167100     PERFORM 4100-PREPARE-CURSOR                                  16710000
167200                                                                  16720000
167301     PERFORM 4030-DET-TRAN-CSR-TO-OPN.                            16730100
167400     PERFORM 4300-READ-ITEMS-FROM-DB.                             16740000
167500     PERFORM 4040-DET-TRAN-CSR-TO-CLO.                            16750000
167600                                                                  16760000
167700     MOVE +1                   TO  PV-TOP-ITEM.                   16770000
167800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16780000
167900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16790000
168000         SET DP020-MSG-FATAL   TO  TRUE                           16800000
168100         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16810000
168200     ELSE                                                         16820000
168300         MOVE -1               TO MR-SELECTL (1)                  16830000
168400         SET DP030-SET-CURSOR-APPL-1                              16840000
168500                               TO TRUE                            16850000
168600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16860000
168700     END-IF.                                                      16870000
171217                                                                  17121700
171223*----------------------------------------------------------------*17122300
171224*  OPENS THE TRANSACTION CURSOR REQUIRED GIVEN THE MONTH IN      *17122400
171225*  PROCESS.                                                      *17122500
171226*----------------------------------------------------------------*17122600
171227 4030-DET-TRAN-CSR-TO-OPN.                                        17122700
171228                                                                  17122800
171231        PERFORM 4032-OPEN-OPER-CSR.                               17123100
171241                                                                  17124100
171242*----------------------------------------------------------------*17124200
171243*  OPEN THE TRANSACTION CURSOR WHEN THE MONTH IN PROCESS FALLS   *17124300
171244*  ENTIRELY ON THE OPERATIONAL DATABASE.                         *17124400
171245*----------------------------------------------------------------*17124500
171246 4032-OPEN-OPER-CSR.                                              17124600
171250                                                                  17125000
171260     EXEC SQL                                                     17126000
171270         OPEN TRANS-OPER-CSR                                      17127000
171280     END-EXEC.                                                    17128000
171290                                                                  17129000
171291     EVALUATE TRUE                                                17129100
171292         WHEN SQLCODE = ZERO                                      17129200
171293              CONTINUE                                            17129300
171294         WHEN SQLWARN0 NOT = SPACE                                17129400
171295         WHEN SQLCODE NOT = ZERO                                  17129500
171296              MOVE '4032-OPEN-OPER-CSR'                           17129600
171297                               TO DP013-PARAGRAPH                 17129700
171298              MOVE 'OPEN CURSOR '                                 17129800
171299                               TO DP013-MESSAGE-TEXT (1)          17129900
171300              MOVE SQLCA       TO DP013-SQLCA                     17130000
171301              SET DP013-DB2-ABEND                                 17130100
171302                               TO TRUE                            17130200
171303              PERFORM DP013-0000-PROCESS-ABEND                    17130300
171304     END-EVALUATE.                                                17130400
171361                                                                  17136100
171363*----------------------------------------------------------------*17136300
171370*  CLOSES THE TRANSACTION CURSOR REQUIRED GIVEN THE MONTH IN     *17137000
171380*  PROCESS.                                                      *17138000
171500*----------------------------------------------------------------*17150000
171600 4040-DET-TRAN-CSR-TO-CLO.                                        17160000
171850                                                                  17185000
171870        PERFORM 4042-CLOSE-OPER-CSR.                              17187000
173600                                                                  17360000
173610*----------------------------------------------------------------*17361000
173620*  CLOSE THE TRANSACTION CURSOR WHEN THE MONTH IN PROCESS FALLS  *17362000
173630*  ENTIRELY ON THE OPERATIONAL DATABASE.                         *17363000
173640*----------------------------------------------------------------*17364000
173650 4042-CLOSE-OPER-CSR.                                             17365000
173660                                                                  17366000
173670     EXEC SQL                                                     17367000
173680         CLOSE TRANS-OPER-CSR                                     17368000
173690     END-EXEC.                                                    17369000
173691                                                                  17369100
173692     EVALUATE TRUE                                                17369200
173693         WHEN SQLCODE = ZERO                                      17369300
173694              CONTINUE                                            17369400
173695         WHEN SQLWARN0 NOT = SPACE                                17369500
173696         WHEN SQLCODE NOT = ZERO                                  17369600
173697              MOVE '4042-CLOSE-OPER-CSR'                          17369700
173698                               TO DP013-PARAGRAPH                 17369800
173699              MOVE 'CLOSE CURSOR '                                17369900
173700                               TO DP013-MESSAGE-TEXT (1)          17370000
173701              MOVE SQLCA       TO DP013-SQLCA                     17370100
173702              SET DP013-DB2-ABEND                                 17370200
173703                               TO TRUE                            17370300
173704              PERFORM DP013-0000-PROCESS-ABEND                    17370400
173705     END-EVALUATE.                                                17370500
173706                                                                  17370600
173770*----------------------------------------------------------------*17377000
173800*    SET UP THE HOST VARIABLES.                                  *17380000
173900*----------------------------------------------------------------*17390000
174000 4100-PREPARE-CURSOR.                                             17400000
174100                                                                  17410000
174200     EXEC SQL                                                     17420000
174300         SELECT STR_GP_ID                                         17430000
174400           INTO :XST00023-STR-GP-ID                               17440000
174500           FROM XST_STR_GP_MBSHP                                  17450000
174600          WHERE STR_GP_TYP_CDE = 2000                             17460000
174700            AND STR_NBR = :ASC-KEY-STORE                          17470000
174800            AND ((CURRENT DATE BETWEEN EFF_BEG_DTE AND            17480000
174900                  EFF_END_DTE)                                    17490000
175000             OR (EFF_BEG_DTE <= CURRENT DATE                      17500000
175100            AND EFF_END_DTE IS NULL))                             17510000
175200           WITH UR                                                17520000
175300     END-EXEC                                                     17530000
175400                                                                  17540000
175500     EVALUATE TRUE                                                17550000
175600         WHEN SQLCODE = 0                                         17560000
175700             MOVE XST00023-STR-GP-ID TO ASC-KEY-STORE-GROUP       17570000
175800         WHEN SQLCODE = +100                                      17580000
175900             MOVE 0 TO ASC-KEY-STORE-GROUP                        17590000
176000         WHEN SQLWARN0 NOT = SPACE                                17600000
176100         WHEN SQLCODE NOT = ZERO                                  17610000
176200              MOVE '4100-PREPARE-CURSOR'                          17620000
176300                               TO DP013-PARAGRAPH                 17630000
176400              MOVE 'READ FOR STORE GROUP'                         17640000
176500                               TO DP013-MESSAGE-TEXT (1)          17650000
176600              MOVE SQLCA       TO DP013-SQLCA                     17660000
176700              SET DP013-DB2-ABEND                                 17670000
176800                               TO TRUE                            17680000
176900              PERFORM DP013-0000-PROCESS-ABEND                    17690000
177000     END-EVALUATE.                                                17700000
177100                                                                  17710000
177200     EXEC SQL                                                     17720000
177300         SELECT SKU_NBR                                           17730000
177400           INTO :XST00010-SKU-NBR                                 17740000
177500           FROM XST_UPC A                                         17750000
177600               ,XST_SKU B                                         17760000
177700          WHERE A.INTR_UPC_ID = B.INTR_UPC_ID                     17770000
177800            AND A.UPC_NBR = :ASC-KEY-UPC-NBR                      17780000
177900            AND A.LAST_ACTN_CDE <> 'D'                            17790000
178000           WITH UR                                                17800000
178100     END-EXEC                                                     17810000
178200                                                                  17820000
178300     EVALUATE TRUE                                                17830000
178400         WHEN SQLCODE = 0                                         17840000
178500             MOVE XST00010-SKU-NBR TO ASC-KEY-SKU-NBR             17850000
178600         WHEN SQLCODE = +100                                      17860000
178700             MOVE 0 TO ASC-KEY-SKU-NBR                            17870000
178800         WHEN SQLWARN0 NOT = SPACE                                17880000
178900         WHEN SQLCODE NOT = ZERO                                  17890000
179000              MOVE '4100-PREPARE-CURSOR'                          17900000
179100                               TO DP013-PARAGRAPH                 17910000
179200              MOVE 'READ FOR SKU BASED ON UPC'                    17920000
179300                               TO DP013-MESSAGE-TEXT (1)          17930000
179400              MOVE SQLCA       TO DP013-SQLCA                     17940000
179500              SET DP013-DB2-ABEND                                 17950000
179600                               TO TRUE                            17960000
179700              PERFORM DP013-0000-PROCESS-ABEND                    17970000
179800     END-EVALUATE.                                                17980000
179900                                                                  17990000
179901     INITIALIZE CSI-PARAMETERS                                    17990100
179902                DP031-PROTEG-PGM-PARAMETERS.                      17990299
179940     MOVE 'TENDER-ID'             TO DP031-FIELD.                 17994099
179950     SET CSI-ENCRYPT-FUNCTION     TO TRUE.                        17995000
179960     SET DP031-ACCTNBR            TO TRUE.                        17996099
179970     MOVE ASC-KEY-TENDER-ID       TO DP031-CLEAR-TEXT.            17997099
179981     MOVE 12                      TO DP031-INPUT-LEN.             17998199
179990     PERFORM DP032-0000-PROTG-TOKEN-DETOKEN.                      17999099
179994     MOVE DP031-CIPHER-TEXT       TO ASC-KEY-TENDER-ID.           17999499
179995                                                                  17999599
180000     MOVE ALL '%' TO ASC-KEY-TENDER-ID(11:23).                    18000099
180100*----------------------------------------------------------------*18010000
180200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18020000
180300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18030000
180400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18040000
180500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18050000
180600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18060000
180700*                                                                *18070000
180800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18080000
180900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18090000
181000*    UPON INITIALIZATION.                                        *18100000
181100*----------------------------------------------------------------*18110000
181200                                                                  18120000
181300 4300-READ-ITEMS-FROM-DB.                                         18130000
181410                                                                  18141000
181500     PERFORM                                                      18150000
181600         VARYING PV-READ-COUNT                                    18160000
181700         FROM 1 BY 1                                              18170000
181800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18180000
181900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18190000
182000                                                                  18200000
182100         PERFORM 4310-DET-TRAN-CSR-TO-FETCH                       18210000
182200                                                                  18220000
182300         IF  ASC-ITEMS-LEFT-ON-DB                                 18230000
182400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18240000
182500                 ADD +1            TO ASC-ITEM-SUB                18250000
182600             ELSE                                                 18260000
182700                 ADD +1            TO ASC-BLK-SUB                 18270000
182800                 MOVE +1           TO ASC-ITEM-SUB                18280000
182900                                                                  18290000
183000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18300000
183100                     MOVE +1       TO ASC-BLK-SUB                 18310000
183200                     SET ASC-BLOCK-MODIFIED (1)                   18320000
183300                                   TO TRUE                        18330000
183400                     PERFORM 5100-WRITE-TEMP-STORAGE              18340000
183500                     MOVE ASC-BLOCK-ENTRIES                       18350000
183600                               (PC-MAX-BLOCKS-IN-ARRAY)           18360000
183700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18370000
183800                     ADD +1        TO ASC-BLK-SUB                 18380000
183900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18390000
184000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18400000
184100                                   TO TRUE                        18410000
184200                 END-IF                                           18420000
184300             END-IF                                               18430000
184400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18440000
184500             MOVE ASC-NUMBER-OF-ITEMS-READ                        18450000
184600                                   TO ASC-LIST-ITEM-NUMBER        18460000
184700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18470000
184800             MOVE EPPART-PARTN-NBR TO ASC-PARTITION-NBR           18480000
184900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18490000
185200             MOVE EPPART-SLS-DTE   TO ASC-SALES-DATE-ISO          18520000
185300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18530000
185400             MOVE EPPART-SLS-DTE (1:4)                            18540000
185500                                   TO PV-SLS-DTE-FORMATTED-YYYY   18550000
185600             MOVE EPPART-SLS-DTE (6:2)                            18560000
185700                                   TO PV-SLS-DTE-FORMATTED-MM     18570000
185800             MOVE EPPART-SLS-DTE (9:2)                            18580000
185900                                   TO PV-SLS-DTE-FORMATTED-DD     18590000
186000             MOVE PV-SLS-DTE-FORMATTED                            18600000
186100                                   TO ASC-SALES-DATE              18610000
186200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18620000
186300             IF EPPART-SLS-DTE = PV-SAVE-SLS-DATE                 18630000
186400                 MOVE PV-SAVE-SLS-DAY TO ASC-SALES-DAY            18640000
186500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18650000
186600             ELSE                                                 18660000
186700                 PERFORM 4320-GET-DAY-OF-WEEK                     18670000
186800                 MOVE PV-SAVE-SLS-DAY TO ASC-SALES-DAY            18680000
186900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18690000
187000                 MOVE EPPART-SLS-DTE TO PV-SAVE-SLS-DATE          18700000
187100             END-IF                                               18710000
187200             MOVE EPTRN-STR-NBR    TO ASC-STORE                   18720000
187300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18730000
187400             MOVE EPTRN-RGST-ID    TO ASC-REGISTER                18740000
187500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18750000
187600             MOVE EPTRN-TRN-NBR    TO ASC-TRANSACTION             18760000
187700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18770000
187800             MOVE EPTRN-STRT-TM    TO ASC-START-TIME              18780000
187900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18790000
188000             MOVE EPTRN-SLS-CORR-SEQ-NBR                          18800000
188100                                   TO ASC-SALES-CORR-SEQ-NBR      18810000
188200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18820000
188300             MOVE EPITM-CUST-CHRGD-AMT TO PV-RETURN-AMT           18830000
188400             MOVE SPACES               TO PV-NOTE                 18840000
188700             PERFORM 4330-CALC-RETURN-AMT-OPER                    18870000
189000             COMPUTE PV-RETURN-AMT = PV-RETURN-AMT                18900000
189100                                   / EPITM-SLD-QTY                18910000
189200             MOVE PV-RETURN-AMT         TO ASC-AMOUNT             18920000
189300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18930000
189400         END-IF                                                   18940000
189500     END-PERFORM.                                                 18950000
189600                                                                  18960000
189700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18970000
189800         MOVE +1               TO ASC-BLK-SUB                     18980000
189900         PERFORM 5100-WRITE-TEMP-STORAGE                          18990000
190000         ADD +1                TO ASC-BLK-SUB                     19000000
190100         PERFORM 5100-WRITE-TEMP-STORAGE                          19010000
190200                                                                  19020000
190300         MOVE 1                TO ASC-BLK-SUB                     19030000
190400                                  PV-BLOCK-NUMBER                 19040000
190500         PERFORM 4410-READ-TEMP-STORAGE                           19050000
190600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19060000
190700             MOVE 2            TO ASC-BLK-SUB                     19070000
190800                                  PV-BLOCK-NUMBER                 19080000
190900             PERFORM 4410-READ-TEMP-STORAGE                       19090000
191000         END-IF                                                   19100000
191100     END-IF.                                                      19110000
191200                                                                  19120000
191300*----------------------------------------------------------------*19130000
191310*  FETCH THE TRANSACTION CURSOR REQUIRED GIVEN THE MONTH IN      *19131000
191320*  PROCESS.                                                      *19132000
191500*----------------------------------------------------------------*19150000
191600                                                                  19160000
191700 4310-DET-TRAN-CSR-TO-FETCH.                                      19170000
191800                                                                  19180000
191802        PERFORM 4312-FETCH-OPER-CSR.                              19180200
195000                                                                  19500000
195010*----------------------------------------------------------------*19501000
195021* FETCH THE TRANSACTION CURSOR WHEN THE MONTH IN PROCESS FALLS   *19502100
195022* ENTIRELY ON THE OPERATIONAL DATABASE.                          *19502200
195030*----------------------------------------------------------------*19503000
195040                                                                  19504000
195050 4312-FETCH-OPER-CSR.                                             19505000
195060                                                                  19506000
195100     EXEC SQL                                                     19510099
195101         FETCH TRANS-OPER-CSR                                     19510199
195102         INTO  :EPPART-PARTN-NBR                                  19510299
195103              ,:EPTRN-STR-NBR                                     19510399
195104              ,:EPTRN-RGST-ID                                     19510499
195105              ,:EPTRN-TRN-NBR                                     19510599
195106              ,:EPTRN-STRT-TM                                     19510699
195107              ,:EPTRN-SLS-CORR-SEQ-NBR                            19510799
195108              ,:EPPART-SLS-DTE                                    19510899
195109              ,:EPITM-LNE-ITM-SEQ-NBR                             19510999
195110              ,:EPITM-SLD-QTY                                     19511099
195111              ,:EPITM-CUST-CHRGD-AMT                              19511199
195112     END-EXEC.                                                    19511299
195113                                                                  19511399
195114     EVALUATE TRUE                                                19511499
195115         WHEN SQLCODE = ZERO                                      19511599
195116              CONTINUE                                            19511699
195117         WHEN SQLCODE = +100                                      19511799
195118             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  19511899
195119         WHEN SQLWARN0 NOT = SPACE                                19511999
195120         WHEN SQLCODE NOT = ZERO                                  19512099
195121              MOVE '4312-FETCH-OPER-CSR'                          19512199
195122                               TO DP013-PARAGRAPH                 19512299
195123              MOVE 'FETCH CURSOR '                                19512399
195124                               TO DP013-MESSAGE-TEXT (1)          19512499
195125              MOVE SQLCA       TO DP013-SQLCA                     19512599
195126              SET DP013-DB2-ABEND                                 19512699
195127                               TO TRUE                            19512799
195128              PERFORM DP013-0000-PROCESS-ABEND                    19512899
195129     END-EVALUATE.                                                19512999
195130                                                                  19513099
195212******************************************************************19521200
195220 4320-GET-DAY-OF-WEEK.                                            19522000
195300*  GET THE DAY OF WEEK FOR THE SALES DATE                         19530000
195400******************************************************************19540000
195500                                                                  19550000
195600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              19560000
195700     MOVE EPPART-SLS-DTE                TO DPG52-LK-DATE-INPUT.   19570000
195800     SET DPG52-LK-DTE-ISO-FMT           TO TRUE.                  19580000
195900     SET DPG51-ACTUAL-CALENDAR-ONLY     TO TRUE.                  19590000
196000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          19600000
196100                                             DPG53 DPG54          19610000
196200                                             DPG55 DPG56.         19620000
196300                                                                  19630000
196400     EVALUATE TRUE                                                19640000
196500         WHEN DPG54-NO-ERROR                                      19650000
196600             MOVE DPG55-ALPHA-WEEK-DAY-ABBR3 TO PV-SAVE-SLS-DAY   19660000
196700                                                                  19670000
196800         WHEN DPG54-SEVERE-ERROR                                  19680000
196900         WHEN DPG54-WARNING-ERROR                                 19690000
197000         WHEN DPG54-DATE-INVALID                                  19700000
197100             CONTINUE                                             19710000
197200     END-EVALUATE.                                                19720000
197300                                                                  19730000
197400*----------------------------------------------------------------*19740000
197500*    CALCULATE THE RETURN AMOUNT FOR THIS ITEM USING ALL PERCENT *19750000
197600*    OFF LINE ITEM DISCOUNTS - FROM THE OPERATIONAL TABLE        *19760000
197700*----------------------------------------------------------------*19770000
197800 4330-CALC-RETURN-AMT-OPER.                                       19780000
197900                                                                  19790000
198000     EXEC SQL                                                     19800000
198100         OPEN DISCOUNT-CSR-OP                                     19810000
198200     END-EXEC.                                                    19820000
198300                                                                  19830000
198400     EVALUATE TRUE                                                19840000
198500         WHEN SQLCODE = ZERO                                      19850000
198600              SET PS-LIDS-LEFT-ON-DB TO TRUE                      19860000
198700         WHEN SQLWARN0 NOT = SPACE                                19870000
198800         WHEN SQLCODE NOT = ZERO                                  19880000
198900              MOVE '4330-CALC-RETURN-AMT-OPER'                    19890000
199000                               TO DP013-PARAGRAPH                 19900000
199100              MOVE 'OPEN DISCOUNT-CSR-OP'                         19910000
199200                               TO DP013-MESSAGE-TEXT (1)          19920000
199300              MOVE SQLCA       TO DP013-SQLCA                     19930000
199400              SET DP013-DB2-ABEND                                 19940000
199500                               TO TRUE                            19950000
199600              PERFORM DP013-0000-PROCESS-ABEND                    19960000
199700     END-EVALUATE.                                                19970000
199800                                                                  19980000
199900     PERFORM                                                      19990000
200000         VARYING PV-LID-COUNT                                     20000000
200100         FROM 1 BY 1                                              20010000
200200         UNTIL ((PV-LID-COUNT > PC-MAX-LIDS)                      20020000
200300            OR (PS-NO-LIDS-LEFT-ON-DB))                           20030000
200400                                                                  20040000
200500         PERFORM 4331-FETCH                                       20050000
200600                                                                  20060000
200700         IF  PS-LIDS-LEFT-ON-DB                                   20070000
200800             PERFORM 4345-RETURN-AMT-NOTE                         20080000
200900         END-IF                                                   20090000
201000     END-PERFORM.                                                 20100000
201100                                                                  20110000
201200     EXEC SQL                                                     20120000
201300         CLOSE DISCOUNT-CSR-OP                                    20130000
201400     END-EXEC.                                                    20140000
201500                                                                  20150000
201600     EVALUATE TRUE                                                20160000
201700         WHEN SQLCODE = ZERO                                      20170000
201800              CONTINUE                                            20180000
201900         WHEN SQLWARN0 NOT = SPACE                                20190000
202000         WHEN SQLCODE NOT = ZERO                                  20200000
202100              MOVE '4330-CALC-RETURN-AMT-OP'                      20210000
202200                               TO DP013-PARAGRAPH                 20220000
202300              MOVE 'CLOSE DISCOUNT-CSR-OP'                        20230000
202400                               TO DP013-MESSAGE-TEXT (1)          20240000
202500              MOVE SQLCA       TO DP013-SQLCA                     20250000
202600              SET DP013-DB2-ABEND                                 20260000
202700                               TO TRUE                            20270000
202800              PERFORM DP013-0000-PROCESS-ABEND                    20280000
202900     END-EVALUATE.                                                20290000
203000                                                                  20300000
203100*----------------------------------------------------------------*20310000
203200*    FETCH THE LINE ITEM DISCOUNT OPERATIONAL CURSOR             *20320000
203300*----------------------------------------------------------------*20330000
203400                                                                  20340000
203500 4331-FETCH.                                                      20350000
203600                                                                  20360000
203700     EXEC SQL                                                     20370000
203800         FETCH DISCOUNT-CSR-OP                                    20380000
203900         INTO  :EPLID-LID-AMT                                     20390000
204000              ,:EPLID-LID-TYP-CDE                                 20400000
204100              ,:EPLID-LID-PCT                                     20410000
204200     END-EXEC.                                                    20420000
204300                                                                  20430000
204400     EVALUATE TRUE                                                20440000
204500         WHEN SQLCODE = ZERO                                      20450000
204600              CONTINUE                                            20460000
204700         WHEN SQLCODE = +100                                      20470000
204800             SET PS-NO-LIDS-LEFT-ON-DB TO TRUE                    20480000
204900         WHEN SQLWARN0 NOT = SPACE                                20490000
205000         WHEN SQLCODE NOT = ZERO                                  20500000
205100              MOVE '4331-FETCH'                                   20510000
205200                               TO DP013-PARAGRAPH                 20520000
205300              MOVE 'FETCH DISCOUNT OP CURSOR '                    20530000
205400                               TO DP013-MESSAGE-TEXT (1)          20540000
205500              MOVE SQLCA       TO DP013-SQLCA                     20550000
205600              SET DP013-DB2-ABEND                                 20560000
205700                               TO TRUE                            20570000
205800              PERFORM DP013-0000-PROCESS-ABEND                    20580000
205900     END-EVALUATE.                                                20590000
206000                                                                  20600000
214800*----------------------------------------------------------------*21480000
214900* POPULATE THE RETURN AMOUNT AND NOTES COLUMNS                   *21490000
215000*----------------------------------------------------------------*21500000
215100                                                                  21510000
215200 4345-RETURN-AMT-NOTE.                                            21520000
215300                                                                  21530000
215400     COMPUTE PV-RETURN-AMT = PV-RETURN-AMT                        21540000
215500                           + EPLID-LID-AMT.                       21550000
215600                                                                  21560000
215700     EVALUATE EPLID-LID-TYP-CDE                                   21570000
215800         WHEN 'P'                                                 21580000
215900             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             21590000
216000             MOVE PV-LID-PCT TO PV-NOTE-PCT-OFF-PCT               21600000
216100             IF PV-NOTE-1 = SPACES                                21610000
216200                 MOVE PV-NOTE-PCT-OFF         TO PV-NOTE-1        21620000
216300             ELSE                                                 21630000
216400                 IF PV-NOTE-2 = SPACES                            21640000
216500                     MOVE PV-NOTE-PCT-OFF     TO PV-NOTE-2        21650000
216600                 ELSE                                             21660000
216700                     IF PV-NOTE-3 = SPACES                        21670000
216800                         MOVE PV-NOTE-PCT-OFF TO PV-NOTE-3        21680000
216900                     ELSE                                         21690000
217000                         MOVE PV-NOTE-MORE-DISCOUNTS              21700000
217100                                              TO PV-NOTE-3        21710000
217200                     END-IF                                       21720000
217300                 END-IF                                           21730000
217400             END-IF                                               21740000
217500         WHEN 'C'                                                 21750000
217600         WHEN 'D'                                                 21760000
217700             MOVE EPLID-LID-AMT TO PV-NOTE-DLR-OFF-DLR            21770000
217800             IF PV-NOTE-1 = SPACES                                21780000
217900                 MOVE PV-NOTE-DLR-OFF         TO PV-NOTE-1        21790000
218000             ELSE                                                 21800000
218100                 IF PV-NOTE-2 = SPACES                            21810000
218200                     MOVE PV-NOTE-DLR-OFF     TO PV-NOTE-2        21820000
218300                 ELSE                                             21830000
218400                     IF PV-NOTE-3 = SPACES                        21840000
218500                         MOVE PV-NOTE-DLR-OFF TO PV-NOTE-3        21850000
218600                     ELSE                                         21860000
218700                         MOVE PV-NOTE-MORE-DISCOUNTS              21870000
218800                                              TO PV-NOTE-3        21880000
218900                     END-IF                                       21890000
219000                 END-IF                                           21900000
219100             END-IF                                               21910000
219200         WHEN 'B'                                                 21920000
219300             MOVE EPLID-LID-AMT TO PV-NOTE-TTL-DLR                21930000
219400             IF PV-NOTE-1 = SPACES                                21940000
219500                 MOVE PV-NOTE-TTL-DLR-OFF     TO PV-NOTE-1        21950000
219600             ELSE                                                 21960000
219700                 IF PV-NOTE-2 = SPACES                            21970000
219800                     MOVE PV-NOTE-TTL-DLR-OFF TO PV-NOTE-2        21980000
219900                 ELSE                                             21990000
220000                     IF PV-NOTE-3 = SPACES                        22000000
220100                        MOVE PV-NOTE-TTL-DLR-OFF                  22010000
220200                                              TO PV-NOTE-3        22020000
220300                     ELSE                                         22030000
220400                         MOVE PV-NOTE-MORE-DISCOUNTS              22040000
220500                                              TO PV-NOTE-3        22050000
220600                     END-IF                                       22060000
220700                 END-IF                                           22070000
220800             END-IF                                               22080000
220900         WHEN 'S'                                                 22090000
221000             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             22100000
221100             MOVE PV-LID-PCT TO PV-NOTE-SCD-PCT                   22110000
221200             IF PV-NOTE-1 = SPACES                                22120000
221300                 MOVE PV-NOTE-SCD-OFF         TO PV-NOTE-1        22130000
221400             ELSE                                                 22140000
221500                 IF PV-NOTE-2 = SPACES                            22150000
221600                     MOVE PV-NOTE-SCD-OFF     TO PV-NOTE-2        22160000
221700                 ELSE                                             22170000
221800                     IF PV-NOTE-3 = SPACES                        22180000
221900                         MOVE PV-NOTE-SCD-OFF TO PV-NOTE-3        22190000
222000                     ELSE                                         22200000
222100                         MOVE PV-NOTE-MORE-DISCOUNTS              22210000
222200                                              TO PV-NOTE-3        22220000
222300                     END-IF                                       22230000
222400                 END-IF                                           22240000
222500             END-IF                                               22250000
222600         WHEN 'A'                                                 22260000
222700         WHEN 'Q'                                                 22270000
222800         WHEN 'T'                                                 22280000
222810         WHEN 'I'                                                 22281000
222820         WHEN 'J'                                                 22282000
222900             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             22290000
223000             MOVE PV-LID-PCT TO PV-NOTE-TTL-PCT                   22300000
223100             IF PV-NOTE-1 = SPACES                                22310000
223200                 MOVE PV-NOTE-TTL-PCT-OFF     TO PV-NOTE-1        22320000
223300             ELSE                                                 22330000
223400                 IF PV-NOTE-2 = SPACES                            22340000
223500                     MOVE PV-NOTE-TTL-PCT-OFF TO PV-NOTE-2        22350000
223600                 ELSE                                             22360000
223700                     IF PV-NOTE-3 = SPACES                        22370000
223800                         MOVE PV-NOTE-TTL-PCT-OFF                 22380000
223900                                              TO PV-NOTE-3        22390000
224000                     ELSE                                         22400000
224100                         MOVE PV-NOTE-MORE-DISCOUNTS              22410000
224200                                              TO PV-NOTE-3        22420000
224300                     END-IF                                       22430000
224400                 END-IF                                           22440000
224500             END-IF                                               22450000
224600         WHEN 'F'                                                 22460000
224700             IF PV-NOTE-1 = SPACES                                22470000
224800                 MOVE PV-NOTE-BOGO            TO PV-NOTE-1        22480000
224900             ELSE                                                 22490000
225000                 IF PV-NOTE-2 = SPACES                            22500000
225100                     MOVE PV-NOTE-BOGO        TO PV-NOTE-2        22510000
225200                 ELSE                                             22520000
225300                     IF PV-NOTE-3 = SPACES                        22530000
225400                         MOVE PV-NOTE-BOGO    TO PV-NOTE-3        22540000
225500                     ELSE                                         22550000
225600                         MOVE PV-NOTE-MORE-DISCOUNTS              22560000
225700                                              TO PV-NOTE-3        22570000
225800                     END-IF                                       22580000
225900                END-IF                                            22590000
226000             END-IF                                               22600000
226010         WHEN 'H'                                                 22601000
226020             IF PV-NOTE-1 = SPACES                                22602000
226030                 MOVE PV-OFFERS-BWP           TO PV-NOTE-1        22603000
226040             ELSE                                                 22604000
226050                 IF PV-NOTE-2 = SPACES                            22605000
226060                     MOVE PV-OFFERS-BWP       TO PV-NOTE-2        22606000
226070                 ELSE                                             22607000
226080                     IF PV-NOTE-3 = SPACES                        22608000
226090                         MOVE PV-OFFERS-BWP   TO PV-NOTE-3        22609000
226091                     ELSE                                         22609100
226092                         MOVE PV-NOTE-MORE-DISCOUNTS              22609200
226093                                              TO PV-NOTE-3        22609300
226094                     END-IF                                       22609400
226095                END-IF                                            22609500
226096             END-IF                                               22609600
226100     END-EVALUATE.                                                22610000
226200                                                                  22620000
226300     MOVE PV-NOTE                            TO ASC-NOTE          22630000
226400                                      (ASC-BLK-SUB ASC-ITEM-SUB). 22640000
226500*----------------------------------------------------------------*22650000
226600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22660000
226700*----------------------------------------------------------------*22670000
226800                                                                  22680000
226900 4400-MOVE-COMMAREA-TO-SCREEN.                                    22690000
227000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22700000
227100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22710000
227200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22720000
227300             MOVE +1    TO ASC-BLK-SUB                            22730000
227400             PERFORM 5100-WRITE-TEMP-STORAGE                      22740000
227500             ADD +1     TO ASC-BLK-SUB                            22750000
227600             PERFORM 5100-WRITE-TEMP-STORAGE                      22760000
227700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22770000
227800                 GIVING PV-BLOCK-NUMBER                           22780000
227900                 REMAINDER PV-REMAINDER                           22790000
228000             IF  PV-REMAINDER > ZERO                              22800000
228100                 ADD +1 TO PV-BLOCK-NUMBER                        22810000
228200             END-IF                                               22820000
228300             MOVE +1    TO ASC-BLK-SUB                            22830000
228400             PERFORM 4410-READ-TEMP-STORAGE                       22840000
228500             ADD +1     TO ASC-BLK-SUB                            22850000
228600                           PV-BLOCK-NUMBER                        22860000
228700             PERFORM 4410-READ-TEMP-STORAGE                       22870000
228800     END-IF.                                                      22880000
228900     MOVE +1            TO ASC-BLK-SUB.                           22890000
229000     COMPUTE ASC-ITEM-SUB =                                       22900000
229100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22910000
229200         + PC-ITEMS-PER-PANEL).                                   22920000
229300                                                                  22930000
229400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22940000
229500         ADD +1         TO ASC-BLK-SUB                            22950000
229600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22960000
229700     END-IF.                                                      22970000
229800                                                                  22980000
229900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22990000
230000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23000000
230100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23010000
230200     PERFORM 4420-FORMAT-LIST-LINES                               23020000
230300         VARYING PV-SUB                                           23030000
230400         FROM PC-ITEMS-PER-PANEL BY -1                            23040000
230500         UNTIL PV-SUB < +1.                                       23050000
230600                                                                  23060000
230700     COMPUTE ASC-ITEMS-DISPLAYED =                                23070000
230800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23080000
230900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23090000
231000                                      ASTRTITO.                   23100000
231100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23110000
231200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23120000
231300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23130000
231400                                   TO ASELITO.                    23140000
231500                                                                  23150000
231600     IF  DP020-MSG-NUMBER-X = SPACE                               23160000
231700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23170000
231800*            --- MORE ITEMS TO DISPLAY ----                       23180000
231900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23190000
232000             SET DP020-MSG-INFORMATIONAL TO TRUE                  23200000
232100         END-IF                                                   23210000
232200     END-IF.                                                      23220000
232300*----------------------------------------------------------------*23230000
232400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23240000
232500*----------------------------------------------------------------*23250000
232600                                                                  23260000
232700 4410-READ-TEMP-STORAGE.                                          23270000
232800                                                                  23280000
232900     EXEC CICS                                                    23290000
233000         READQ TS                                                 23300000
233100             QUEUE (ASC-LIST-QUEUE-NAME)                          23310000
233200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23320000
233300             ITEM  (PV-BLOCK-NUMBER)                              23330000
233400             RESP  (PV-CICS-RESP)                                 23340000
233500     END-EXEC.                                                    23350000
233600                                                                  23360000
233700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23370000
233800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23380000
233900         CONTINUE                                                 23390000
234000     ELSE                                                         23400000
234100         SET DP013-CICS-ABEND     TO TRUE                         23410000
234200         SET DP013-NO-ROLLBACK    TO TRUE                         23420000
234300         MOVE '4410-READ-TEMP-STORAGE'                            23430000
234400                                  TO DP013-PARAGRAPH              23440000
234500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23450000
234600                                  TO DP013-MESSAGE-TEXT(1)        23460000
234700         PERFORM DP013-0000-PROCESS-ABEND                         23470000
234800     END-IF.                                                      23480000
234900                                                                  23490000
235000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23500000
235100                                                                  23510000
235200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23520000
235300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23530000
235400     END-IF.                                                      23540000
235500                                                                  23550000
235600*----------------------------------------------------------------*23560000
235700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23570000
235800*----------------------------------------------------------------*23580000
235900                                                                  23590000
236000 4420-FORMAT-LIST-LINES.                                          23600000
236100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23610000
236200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23620000
236300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           23630000
236400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           23640000
236500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           23650000
236600         MOVE SPACE              TO MR-DATE (PV-SUB)              23660000
236700                                    MR-DAY (PV-SUB)               23670000
236800                                    MR-STORE-X (PV-SUB)           23680000
236900                                    MR-TRANS-X (PV-SUB)           23690000
237000                                    MR-NOTE (PV-SUB)              23700000
237100         MOVE ZERO               TO MR-RETURN-AMT (PV-SUB)        23710000
237200     ELSE                                                         23720000
237300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23730000
237400                                                   > SPACE        23740000
237500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23750000
237600                                 TO MR-SELECTI (PV-SUB)           23760000
237700         ELSE                                                     23770000
237800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23780000
237900                                 TO MR-SELECTI (PV-SUB)           23790000
238000         END-IF                                                   23800000
238100                                                                  23810000
238200         IF  DP030-SET-CURSOR-TRAILER                             23820000
238300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23830000
238400                 > SPACE)                                         23840000
238500               OR (PV-SUB = 1))                                   23850000
238600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23860000
238700                MOVE -1          TO MR-SELECTL (PV-SUB)           23870000
238800             END-IF                                               23880000
238900         END-IF                                                   23890000
239000                                                                  23900000
239100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23910000
239200             MOVE ASC-SALES-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       23920000
239300                                   TO MR-DATE (PV-SUB)            23930000
239400             MOVE ASC-SALES-DAY  (ASC-BLK-SUB ASC-ITEM-SUB)       23940000
239500                                   TO MR-DAY  (PV-SUB)            23950000
239600             MOVE ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)            23960000
239700                                   TO MR-STORE (PV-SUB)           23970000
239800             MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)      23980000
239900                                   TO MR-TRANS (PV-SUB)           23990000
240000             MOVE ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB)           24000000
240100                                   TO MR-RETURN-AMT (PV-SUB)      24010000
240200             MOVE ASC-NOTE (ASC-BLK-SUB ASC-ITEM-SUB)             24020000
240300                                   TO MR-NOTE (PV-SUB)            24030000
240400         END-IF                                                   24040000
240500     END-IF.                                                      24050000
240600     SUBTRACT +1 FROM ASC-ITEM-SUB                                24060000
240700     IF  ASC-ITEM-SUB < + 1                                       24070000
240800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24080000
240900         MOVE +1                 TO ASC-BLK-SUB                   24090000
241000     END-IF.                                                      24100000
241100*----------------------------------------------------------------*24110000
241200*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *24120000
241300*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *24130000
241400*  ISSUE A WARNING.                                              *24140000
241500*----------------------------------------------------------------*24150000
241600 4430-CHECK-FOR-BEGIN-AND-END.                                    24160000
241700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24170000
241800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24180000
241900*            -- NO END-OF-RANGE SPECFIED ---                      24190000
242000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24200000
242100             SET DP020-MSG-WARNING TO TRUE                        24210000
242200             PERFORM 4431-POSITION-AT-WARNING                     24220000
242300         END-IF                                                   24230000
242400     ELSE                                                         24240000
242500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24250000
242600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24260000
242700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24270000
242800             SET DP020-MSG-WARNING TO TRUE                        24280000
242900             PERFORM 4431-POSITION-AT-WARNING                     24290000
243000         END-IF                                                   24300000
243100     END-IF.                                                      24310000
243200*----------------------------------------------------------------*24320000
243300*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24330000
243400*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24340000
243500*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24350000
243600*  POSITION THE CURSOR THERE.                                    *24360000
243700*----------------------------------------------------------------*24370000
243800 4431-POSITION-AT-WARNING.                                        24380000
243900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24390000
244000                    - PV-TOP-ITEM + 1.                            24400000
244100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24410000
244200         CONTINUE                                                 24420000
244300     ELSE                                                         24430000
244400         SET DP030-SET-CURSOR-APPL-1                              24440000
244500                                   TO TRUE                        24450000
244600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24460000
244700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24470000
244800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24480000
244900     END-IF.                                                      24490000
245000                                                                  24500000
245100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24510000
245200                    - PV-TOP-ITEM + 1.                            24520000
245300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24530000
245400         CONTINUE                                                 24540000
245500     ELSE                                                         24550000
245600         SET DP030-SET-CURSOR-APPL-1                              24560000
245700                                   TO TRUE                        24570000
245800         MOVE -1                   TO MR-SELECTL (PV-SUB)         24580000
245900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24590000
246000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24600000
246100     END-IF.                                                      24610000
246200                                                                  24620000
246300*----------------------------------------------------------------*24630000
246400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24640000
246500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24650000
246600* FOR THE SELECTED ITEMS QUEUE.                                  *24660000
246700*                                                                *24670000
246800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24680000
246900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24690000
247000* THE ARRAY IS FULL.                                             *24700000
247100*----------------------------------------------------------------*24710000
247200                                                                  24720000
247300 5000-PREPARE-SEL-QUEUE.                                          24730000
247400                                                                  24740000
247500     MOVE +1                   TO  ASC-BLK-SUB.                   24750000
247600     PERFORM 5100-WRITE-TEMP-STORAGE.                             24760000
247700     ADD +1                    TO  ASC-BLK-SUB.                   24770000
247800     PERFORM 5100-WRITE-TEMP-STORAGE.                             24780000
247900                                                                  24790000
248000     MOVE ASC-SEL-QUEUE-NAME   TO  IQ004-SEL-QUEUE-NAME.          24800000
248100     PERFORM 6010-DELETE-SEL-QUEUE.                               24810000
248200                                                                  24820000
248300     SET ASC-UPDATE-TSQ        TO  TRUE.                          24830000
248400                                                                  24840000
248500     SET IQ003-IDX             TO  1.                             24850000
248600     MOVE ZERO                 TO IQ004-NUMBER-OF-TS-ITEMS.       24860000
248700     INITIALIZE IQ003-SELECTED-ITEM-ARRAY.                        24870000
248800                                                                  24880000
248900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24890000
249000             VARYING PV-ITEM                                      24900000
249100             FROM 1 BY 1                                          24910000
249200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24920000
249300                                                                  24930000
249400     IF  IQ003-IDX > 1                                            24940000
249500         PERFORM 5205-WRITE-SEL-QUEUE                             24950000
249600         ADD +1                TO IQ004-NUMBER-OF-TS-ITEMS        24960000
249700     END-IF.                                                      24970000
249800                                                                  24980000
249900*----------------------------------------------------------------*24990000
250000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25000000
250100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25010000
250200*----------------------------------------------------------------*25020000
250300                                                                  25030000
250400 5100-WRITE-TEMP-STORAGE.                                         25040000
250500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25050000
250600                                   TO PV-LIST-ITEM-NUMBER.        25060000
250700     COMPUTE PV-BLOCK-NUMBER =                                    25070000
250800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25080000
250900                                                                  25090000
251000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25100000
251100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25110000
251200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25120000
251300             PERFORM 5105-REWRITE-ASC-LISTQ                       25130000
251400         END-IF                                                   25140000
251500     ELSE                                                         25150000
251600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25160000
251700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25170000
251800         PERFORM 5110-WRITE-ASC-LISTQ                             25180000
251900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25190000
252000     END-IF.                                                      25200000
252100                                                                  25210000
252200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25220000
252300*----------------------------------------------------------------*25230000
252400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *25240000
252500*  SPECIFIC COMMAREA.                                            *25250000
252600*----------------------------------------------------------------*25260000
252700 5105-REWRITE-ASC-LISTQ.                                          25270000
252800     EXEC CICS                                                    25280000
252900         WRITEQ TS                                                25290000
253000             QUEUE (ASC-LIST-QUEUE-NAME)                          25300000
253100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25310000
253200             ITEM  (PV-BLOCK-NUMBER)                              25320000
253300             REWRITE                                              25330000
253400             RESP  (PV-CICS-RESP)                                 25340000
253500     END-EXEC.                                                    25350000
253600                                                                  25360000
253700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25370000
253800         CONTINUE                                                 25380000
253900     ELSE                                                         25390000
254000         SET DP013-CICS-ABEND            TO TRUE                  25400000
254100         SET DP013-NO-ROLLBACK           TO TRUE                  25410000
254200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25420000
254300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25430000
254400                                         TO DP013-MESSAGE-TEXT(1) 25440000
254500         PERFORM DP013-0000-PROCESS-ABEND                         25450000
254600     END-IF.                                                      25460000
254700                                                                  25470000
254800*----------------------------------------------------------------*25480000
254900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *25490000
255000*  SPECIFIC COMMAREA.                                            *25500000
255100*----------------------------------------------------------------*25510000
255200 5110-WRITE-ASC-LISTQ.                                            25520000
255300     EXEC CICS                                                    25530000
255400         WRITEQ TS                                                25540000
255500             QUEUE (ASC-LIST-QUEUE-NAME)                          25550000
255600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25560000
255700             ITEM  (PV-BLOCK-NUMBER)                              25570000
255800             RESP  (PV-CICS-RESP)                                 25580000
255900     END-EXEC.                                                    25590000
256000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25600000
256100         SET DP013-CICS-ABEND      TO TRUE                        25610000
256200         SET DP013-NO-ROLLBACK     TO TRUE                        25620000
256300         MOVE '5110-WRITE-ASC-LISTQ'                              25630000
256400                                   TO DP013-PARAGRAPH             25640000
256500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25650000
256600                                   TO DP013-MESSAGE-TEXT(1)       25660000
256700         PERFORM DP013-0000-PROCESS-ABEND                         25670000
256800     END-IF.                                                      25680000
256900                                                                  25690000
257000*----------------------------------------------------------------*25700000
257100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25710000
257200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25720000
257300*----------------------------------------------------------------*25730000
257400                                                                  25740000
257500 5200-FILL-SEL-QUEUE-RECORD.                                      25750000
257600                                                                  25760000
257700     PERFORM 6112-READ-LIST-QUEUE.                                25770000
257800                                                                  25780000
257900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25790000
258000         PERFORM                                                  25800000
258100         VARYING LQW-IDX                                          25810000
258200         FROM 1 BY 1                                              25820000
258300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25830000
258400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25840000
258500                                                                  25850000
258600             IF  LQW-SELECT (LQW-IDX)                             25860000
258700                                                                  25870000
258800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25880000
258900                                   TO IQ003-ITEM (IQ003-IDX)      25890000
259000                 MOVE LQW-SALES-DATE    (LQW-IDX)                 25900000
259100                                   TO IQ003-SALES-DATE (IQ003-IDX)25910000
259200                 MOVE LQW-PARTITION-NBR (LQW-IDX)                 25920000
259300                                   TO IQ003-PARTITION (IQ003-IDX) 25930000
259400                 MOVE LQW-DB-STRUC-CDE  (LQW-IDX)                 25940000
259500                                 TO IQ003-DB-STRUC-CDE (IQ003-IDX)25950000
259600                 MOVE LQW-SALES-DATE-ISO (LQW-IDX)                25960000
259700                               TO IQ003-SALES-DATE-ISO (IQ003-IDX)25970000
259800                 MOVE LQW-STORE (LQW-IDX)                         25980000
259900                                   TO IQ003-STORE (IQ003-IDX)     25990000
260000                 MOVE LQW-REGISTER (LQW-IDX)                      26000000
260100                                   TO IQ003-REGISTER (IQ003-IDX)  26010000
260200                 MOVE LQW-TRANSACTION (LQW-IDX)                   26020000
260300                                   TO IQ003-TRANS (IQ003-IDX)     26030000
260400                 MOVE LQW-START-TIME  (LQW-IDX)                   26040000
260500                                   TO IQ003-START-TIME (IQ003-IDX)26050000
260600                 MOVE LQW-SALES-CORR-SEQ-NBR (LQW-IDX)            26060000
260700                           TO IQ003-SALES-CORR-SEQ-NBR (IQ003-IDX)26070000
260800                 MOVE SPACE        TO IQ003-ACTION-SW (IQ003-IDX) 26080000
260900                 SET IQ003-IDX UP BY 1                            26090000
261000                 IF  IQ003-IDX > IQ003-MAX-ITEMS                  26100000
261100                     PERFORM 5205-WRITE-SEL-QUEUE                 26110000
261200                     ADD +1        TO IQ004-NUMBER-OF-TS-ITEMS    26120000
261300                     INITIALIZE IQ003-SELECTED-ITEM-ARRAY         26130000
261400                     SET IQ003-IDX TO  1                          26140000
261500                 END-IF                                           26150000
261600             END-IF                                               26160000
261700         END-PERFORM                                              26170000
261800     END-IF.                                                      26180000
261900                                                                  26190000
262000*----------------------------------------------------------------*26200000
262100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26210000
262200*----------------------------------------------------------------*26220000
262300                                                                  26230000
262400 5205-WRITE-SEL-QUEUE.                                            26240000
262500                                                                  26250000
262600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26260000
262700                                   TO IQ003-SELECTED-ITEMS.       26270000
262800                                                                  26280000
262900     EXEC CICS                                                    26290000
263000          WRITEQ TS                                               26300000
263100              QUEUE (ASC-SEL-QUEUE-NAME)                          26310000
263200              FROM  (IQ003-TRANSACTION-SEL-REC)                   26320000
263300              ITEM  (PV-SEL-QUEUE-ITEM)                           26330000
263400              RESP  (PV-CICS-RESP)                                26340000
263500     END-EXEC.                                                    26350000
263600                                                                  26360000
263700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26370000
263800         CONTINUE                                                 26380000
263900     ELSE                                                         26390000
264000         SET DP013-CICS-ABEND      TO TRUE                        26400000
264100         SET DP013-NO-ROLLBACK     TO TRUE                        26410000
264200         MOVE '5205-WRITE-SEL-QUEUE'                              26420000
264300                                   TO DP013-PARAGRAPH             26430000
264400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26440000
264500                                   TO DP013-MESSAGE-TEXT(1)       26450000
264600         PERFORM DP013-0000-PROCESS-ABEND                         26460000
264700     END-IF.                                                      26470000
264800                                                                  26480000
264900*----------------------------------------------------------------*26490000
265000*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *26500000
265100*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *26510000
265200*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *26520000
265300*  THE USER.                                                     *26530000
265400*----------------------------------------------------------------*26540000
265500 6000-REFRESH-PANEL-FROM-TEMP.                                    26550000
265600     IF  ASC-UPDATE-TSQ                                           26560000
265700         SET ASC-NO-TSQ-UPDATE TO TRUE                            26570000
265800         MOVE ZERO                 TO PV-SAVE-ITEM                26580000
265900                                      PV-SEL-QUEUE-ITEM           26590000
266000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26600000
266100                                   TO PV-HOLD-SELECTED-ITEMS      26610000
266200         MOVE +1                   TO PV-ITEMS-PROCESSED          26620000
266300         PERFORM 6100-UPDATE-TSQ                                  26630000
266400             UNTIL PV-ITEMS-PROCESSED >                           26640000
266500                                     PV-HOLD-SELECTED-ITEMS       26650000
266600         PERFORM 6010-DELETE-SEL-QUEUE                            26660000
266700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26670000
266800                    ASC-BLOCK-ENTRIES (2)                         26680000
266900     END-IF.                                                      26690000
267000                                                                  26700000
267100*----------------------------------------------------------------*26710000
267200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26720000
267300*----------------------------------------------------------------*26730000
267400 6010-DELETE-SEL-QUEUE.                                           26740000
267500                                                                  26750000
267600     EXEC CICS                                                    26760000
267700         DELETEQ TS                                               26770000
267800             QUEUE (ASC-SEL-QUEUE-NAME)                           26780000
267900             RESP  (PV-CICS-RESP)                                 26790000
268000     END-EXEC.                                                    26800000
268100                                                                  26810000
268200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26820000
268300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26830000
268400         CONTINUE                                                 26840000
268500     ELSE                                                         26850000
268600         SET DP013-CICS-ABEND TO TRUE                             26860000
268700         SET DP013-NO-ROLLBACK TO TRUE                            26870000
268800         MOVE '6010-DELETE-SEL-QUEUE'                             26880000
268900                        TO DP013-PARAGRAPH                        26890000
269000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26900000
269100                        TO DP013-MESSAGE-TEXT (1)                 26910000
269200         PERFORM DP013-0000-PROCESS-ABEND                         26920000
269300     END-IF.                                                      26930000
269400                                                                  26940000
269500*----------------------------------------------------------------*26950000
269600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26960000
269700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26970000
269800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26980000
269900*    THE TEMP QUEUE.                                             *26990000
270000*----------------------------------------------------------------*27000000
270100                                                                  27010000
270200 6100-UPDATE-TSQ.                                                 27020000
270300                                                                  27030000
270400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27040000
270500     PERFORM 6105-READ-SEL-QUEUE.                                 27050000
270600     PERFORM                                                      27060000
270700         VARYING IQ003-IDX                                        27070000
270800         FROM 1 BY 1                                              27080000
270900         UNTIL ((PV-ITEMS-PROCESSED >                             27090000
271000                              PV-HOLD-SELECTED-ITEMS)             27100000
271100         OR (IQ003-IDX GREATER THAN IQ003-MAX-ITEMS))             27110000
271200         IF  IQ003-ACTION-SW (IQ003-IDX) > SPACE                  27120000
271300             PERFORM 6110-PROCESS-ITEMS                           27130000
271400         END-IF                                                   27140000
271500         ADD +1                TO PV-ITEMS-PROCESSED              27150000
271600     END-PERFORM.                                                 27160000
271700     PERFORM 6111-WRITE-LIST-QUEUE.                               27170000
271800*----------------------------------------------------------------*27180000
271900*    READ THE LIST QUEUE RECORD.                                 *27190000
272000*----------------------------------------------------------------*27200000
272100                                                                  27210000
272200 6105-READ-SEL-QUEUE.                                             27220000
272300                                                                  27230000
272400     EXEC CICS                                                    27240000
272500          READQ TS                                                27250000
272600              QUEUE (ASC-SEL-QUEUE-NAME)                          27260000
272700              INTO  (IQ003-TRANSACTION-SEL-REC)                   27270000
272800              ITEM  (PV-SEL-QUEUE-ITEM)                           27280000
272900              RESP  (PV-CICS-RESP)                                27290000
273000     END-EXEC.                                                    27300000
273100                                                                  27310000
273200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27320000
273300         CONTINUE                                                 27330000
273400     ELSE                                                         27340000
273500         SET DP013-CICS-ABEND      TO  TRUE                       27350000
273600         SET DP013-NO-ROLLBACK     TO  TRUE                       27360000
273700         MOVE '6105-READ-SEL-QUEUE'                               27370000
273800                                   TO  DP013-PARAGRAPH            27380000
273900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27390000
274000                                   TO  DP013-MESSAGE-TEXT(1)      27400000
274100         PERFORM DP013-0000-PROCESS-ABEND                         27410000
274200     END-IF.                                                      27420000
274300                                                                  27430000
274400*----------------------------------------------------------------*27440000
274500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27450000
274600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27460000
274700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27470000
274800*----------------------------------------------------------------*27480000
274900                                                                  27490000
275000 6110-PROCESS-ITEMS.                                              27500000
275100                                                                  27510000
275200     COMPUTE PV-ITEM = 1 + ((IQ003-ITEM (IQ003-IDX) - 1)          27520000
275300                     / PC-ITEMS-PER-PANEL).                       27530000
275400                                                                  27540000
275500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27550000
275600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27560000
275700             PERFORM 6111-WRITE-LIST-QUEUE                        27570000
275800         END-IF                                                   27580000
275900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27590000
276000                                                                  27600000
276100         PERFORM 6112-READ-LIST-QUEUE                             27610000
276200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27620000
276300             CONTINUE                                             27630000
276400         END-IF                                                   27640000
276500     END-IF.                                                      27650000
276600                                                                  27660000
276700     COMPUTE PV-SUB = (IQ003-ITEM (IQ003-IDX)                     27670000
276800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27680000
276900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         27690000
277000     MOVE LQW-SELECTED-SW (PV-SUB)                                27700000
277100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  27710000
277200                                                                  27720000
277300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27730000
277400                                                                  27740000
277500*----------------------------------------------------------------*27750000
277600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27760000
277700*----------------------------------------------------------------*27770000
277800                                                                  27780000
277900 6111-WRITE-LIST-QUEUE.                                           27790000
278000                                                                  27800000
278100     EXEC CICS                                                    27810000
278200         WRITEQ TS                                                27820000
278300             QUEUE (ASC-LIST-QUEUE-NAME)                          27830000
278400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27840000
278500             ITEM  (PV-SAVE-ITEM)                                 27850000
278600             REWRITE                                              27860000
278700             RESP  (PV-CICS-RESP)                                 27870000
278800     END-EXEC.                                                    27880000
278900                                                                  27890000
279000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27900000
279100         CONTINUE                                                 27910000
279200     ELSE                                                         27920000
279300         SET DP013-CICS-ABEND  TO  TRUE                           27930000
279400         SET DP013-NO-ROLLBACK TO  TRUE                           27940000
279500         MOVE '6111-WRITE-LIST-QUEUE'                             27950000
279600                               TO  DP013-PARAGRAPH                27960000
279700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27970000
279800                               TO  DP013-MESSAGE-TEXT(1)          27980000
279900         PERFORM DP013-0000-PROCESS-ABEND                         27990000
280000     END-IF.                                                      28000000
280100                                                                  28010000
280200                                                                  28020000
280300*----------------------------------------------------------------*28030000
280400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28040000
280500*----------------------------------------------------------------*28050000
280600                                                                  28060000
280700 6112-READ-LIST-QUEUE.                                            28070000
280800                                                                  28080000
280900     EXEC CICS                                                    28090000
281000         READQ TS                                                 28100000
281100             QUEUE (ASC-LIST-QUEUE-NAME)                          28110000
281200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28120000
281300             ITEM  (PV-ITEM)                                      28130000
281400             RESP  (PV-CICS-RESP)                                 28140000
281500     END-EXEC.                                                    28150000
281600                                                                  28160000
281700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28170000
281800         CONTINUE                                                 28180000
281900     ELSE                                                         28190000
282000         SET DP013-CICS-ABEND        TO TRUE                      28200000
282100         SET DP013-NO-ROLLBACK       TO TRUE                      28210000
282200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28220000
282300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28230000
282400                                     TO DP013-MESSAGE-TEXT(1)     28240000
282500         PERFORM DP013-0000-PROCESS-ABEND                         28250000
282600     END-IF.                                                      28260000
282700                                                                  28270000
282800*----------------------------------------------------------------*28280000
283400*    ABEND PROCESSOR MODULE                                      *28340000
283500*----------------------------------------------------------------*28350000
283600                                                                  28360000
283700     COPY DPPD013.                                                28370000
283710*----------------------------------------------------------------*28371099
283800* COPY MEMBER DPPD032 CONTAINS STATEMENTS NEEDED TO INVOKE       *28380099
283810* PROTEGRITY MODULE FOR TOKENIZATION                             *28381099
283900*----------------------------------------------------------------*28390099
284000                                                                  28400099
284100     COPY DPPD032.                                                28410099
284200*----------------------------------------------------------------*28420099
