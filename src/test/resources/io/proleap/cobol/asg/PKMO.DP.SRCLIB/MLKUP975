       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUP975.                                         00020000
       AUTHOR.        B. GRAHAM - STRATAGEM.                            00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  02/04/08.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      * THE PURPOSE OF THIS PROGRAM IS TO MOVE ROWS FROM ONE DKEY       00090000
      * IN A DEPT TO ANOTHER DKEY AS INDICATED BY INPUT CONTROL         00091000
      * INFORMATION                                                     00092000
      * 1.READ FROM/TO DEPT AND DKEY FROM CONTROL FILE                  00093000
      * 2.RETRIEVE ROWS FROM MLT_WKLY_SUM WITH FROM DEPT AND DKEY       00094000
      * 3.LOOK UP THE DKEY OF THE 'TO' DEPT AND DKEY TO SEE THAT IT IS  00095000
      *   VALID                                                         00096000
      * 4.INSERT THE ROW WITH THE NEW DKEY                              00097000
      * 5.DELETE THE ROW WITH THE OLD DKEY                              00098000
      * 6.IF THE ROW WITH THE NEW DKEY ALREADY EXISTS, RETRIEVE THAT    00099000
      *   ROW AND COMBINE THE MONEYS FROM THE 'FROM' DKEY ROW WITH      00100000
      *   'TO' DKEY AND REPLACE IT IN THE TABLE, THEN DELETE            00110000
      *   ORIGINAL 'FROM'  DKEY ROW.                                    00120000
      *                                                                 00130000
      * THE PROCESS NOTED ABOVE WILL BE DONE BASED UPON AN INPUT        00140000
      * WEEK END CONTROL CARD DATE.                                     00150000
      *                                                                 00160000
      ******************************************************************00170000
                                                                        00180000
      ******************** HISTORY OF CHANGES **************************00181005
      * CHG ID/                                                        *00182005
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00183005
      * -------  ----------  ----------------------------------------  *00184005
      * W32898   02-14-2008  B.GRAHAM - STRATAGEM                       00185010
      *                      INITIAL IMPLEMENTATION                     00186005
      * 238672   03-10-2008  B.GRAHAM - STRATAGEM                       00186110
      *                      QUALIFY MNLY-SUM CURSOR BY DEPT            00186210
      *                      CHG DKEY VALIDATION TO USE DEPT            00186310
      ******************************************************************00187005
      ******************************************************************00190000
       ENVIRONMENT DIVISION.                                            00200000
      ******************************************************************00210000
                                                                        00220000
       CONFIGURATION SECTION.                                           00230000
                                                                        00240000
       SOURCE-COMPUTER.        IBM-3090.                                00250000
       OBJECT-COMPUTER.        IMB-3090.                                00260000
                                                                        00270000
       INPUT-OUTPUT SECTION.                                            00280000
                                                                        00290000
       FILE-CONTROL.                                                    00300000
                                                                        00310000
           SELECT CNTL-DATE-FILE                                        00320000
               ASSIGN TO INP01.                                         00330000
                                                                        00340000
           SELECT FROM-TO-DKEY-FILE                                     00350000
               ASSIGN TO INP02.                                         00360000
                                                                        00370000
           SELECT AUDIT-FILE                                            00380000
               ASSIGN TO OUT01.                                         00381000
                                                                        00382000
      ******************************************************************00383000
       DATA DIVISION.                                                   00384000
      ******************************************************************00385000
                                                                        00386000
       FILE SECTION.                                                    00387000
                                                                        00388000
       FD  CNTL-DATE-FILE                                               00389000
           RECORDING  MODE IS F.                                        00390000
       01  CNTL-DATE-REC                    PIC X(80).                  00400000
                                                                        00401000
       FD  FROM-TO-DKEY-FILE                                            00402000
           RECORDING  MODE IS F.                                        00403000
       01  FROM-TO-DKEY-REC                 PIC X(80).                  00404000
                                                                        00405000
       FD  AUDIT-FILE                                                   00406000
           RECORDING  MODE IS F.                                        00407000
       01  AUDIT-REC                        PIC X(80).                  00408000
                                                                        00409000
                                                                        00410000
       WORKING-STORAGE SECTION.                                         00420000
                                                                        00430000
                                                                        00440000
       01  PS-PROGRAM-SWITCHES.                                         00450000
           05  PS-FROM-DKEY-CSR-AT-END-SW    PIC X     VALUE 'N'.       00460000
               88  PS-FROM-DKEY-CSR-AT-END-NO          VALUE 'N'.       00470000
               88  PS-FROM-DKEY-CSR-AT-END-YES         VALUE 'Y'.       00480000
           05  PS-FROM-TO-FILE-AT-END-SW     PIC X     VALUE 'N'.       00490000
               88  PS-FROM-TO-FILE-AT-END-NO           VALUE 'N'.       00500000
               88  PS-FROM-TO-FILE-AT-END-YES          VALUE 'Y'.       00510000
                                                                        00520000
       01  PC-PROGRAM-CONSTANTS.                                        00530000
           05 PC-PGM-NAME                  PIC X(8)  VALUE 'MLKUP975'.  00540000
           05 PC-MAX-RETRIES               PIC S9(03) VALUE 3 COMP-3.   00550000
           05 PC-W                         PIC X(01)  VALUE 'W'.        00560000
           05 PC-4001                      PIC S9(04) VALUE +4001 COMP. 00570000
           05 PC-4002                      PIC S9(04) VALUE +4002 COMP. 00580000
           05 PC-4003                      PIC S9(04) VALUE +4003 COMP. 00590000
           05 PC-4004                      PIC S9(04) VALUE +4004 COMP. 00600000
           05 PC-4005                      PIC S9(04) VALUE +4005 COMP. 00610000
           05 PC-INSERT                    PIC X(10) VALUE              00620000
                                                         'INSERT    '.  00630000
           05 PC-UPDATE                    PIC X(10) VALUE              00640000
                                                         'UPDATE    '.  00650000
           05 PC-DELETE                    PIC X(10) VALUE              00660000
                                                         'DELETE    '.  00670000
                                                                        00700000
       01  PV-PROGRAM-VARIABLES.                                        00701000
           05 PV-PROCESS-DATE              PIC   X(10) VALUE SPACES.    00702000
                                                                        00703000
           05 PV-RETRY-COUNTER             PIC S9(04) COMP.             00704000
           05 PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.     00705000
           05 PV-DB2-DATE-EXISTS           PIC X(01).                   00706000
                                                                        00707000
           05  PV-FROM-DKEY-NBR-COMP       PIC S9(09) VALUE +0 COMP.    00708000
           05  PV-SAVE-FROM-DKEY-NBR       PIC S9(09) VALUE +0 COMP.    00709000
           05  PV-SAVE-TO-DKEY-NBR         PIC S9(09) VALUE +0 COMP.    00710000
           05  PV-TO-DKEY-NBR-COMP         PIC S9(09) VALUE +0 COMP.    00710100
           05  PV-FROM-TO-DEPT-NBR-COMP3   PIC S9(4)V VALUE +0 COMP-3.  00710200
                                                                        00710300
       01  PA-PROGRAM-ACCUMULATORS.                                     00710400
           05  PA-INPUT-COUNT              PIC  9(11) VALUE ZEROS.      00710500
           05  PA-INSERT-COUNT             PIC  9(11) VALUE ZEROS.      00710600
           05  PA-UPDATE-COUNT             PIC  9(11) VALUE ZEROS.      00710700
           05  PA-DELETE-COUNT             PIC  9(11) VALUE ZEROS.      00710800
           05  PA-FROM-DKEY-ROW-COUNT      PIC  9(11) VALUE ZEROS.      00710900
                                                                        00711000
       01  ABEND-CODE                        PIC S9(4) VALUE ZEROS      00712000
                                                       COMP SYNC.       00713000
                                                                        00714000
       01  ABEND-CODE-SQL              PIC S9(04)  VALUE ZERO COMP SYNC.00715000
                                                                        00716000
      ***************************************************************** 00717000
      *  CONTROL CARD WITH DATE                                         00718000
      ***************************************************************** 00719000
       01  CC-CONTROL-CARD.                                             00720000
           05  CC-PROC-DATE-ISO                PIC X(10).               00730000
           05  CC-PROC-DATE-RDF  REDEFINES                              00740000
               CC-PROC-DATE-ISO.                                        00750000
               10  CC-PROC-CC                  PIC X(02).               00760000
               10  CC-PROC-YY                  PIC X(02).               00770000
               10  FILLER                      PIC X(01).               00780000
               10  CC-PROC-MM                  PIC X(02).               00790000
               10  FILLER                      PIC X(01).               00800000
               10  CC-PROC-DD                  PIC X(02).               00810000
           05  FILLER                          PIC X(70).               00820000
                                                                        00830000
      ***************************************************************** 00840000
      *  FROM/TO DEPT AND DKEY                                          00850000
      ***************************************************************** 00860000
       01  PV-FROM-TO-DKEY-REC.                                         00870000
           05  PV-FROM-TO-DEPT-NBR             PIC 9(04).               00880000
           05  FILLER                          PIC X(01).               00890000
           05  PV-FROM-DKEY-NBR                PIC 9(09).               00900000
           05  FILLER                          PIC X(01).               00910000
           05  PV-TO-DKEY-NBR                  PIC 9(09).               00920000
           05  FILLER                          PIC X(56).               00930000
                                                                        00940000
      ***************************************************************** 00950000
      *  AUDIT FILE OF ACTION TAKEN                                     00951000
      ***************************************************************** 00952000
       01  PV-AUDIT-REC.                                                00953000
           05  PV-AUDIT-ACTION                 PIC X(10).               00954000
           05  PV-AUDIT-PARTN-NBR              PIC 9(04).               00955000
           05  PV-AUDIT-DEPT-NBR               PIC 9(04).               00956000
           05  PV-AUDIT-MAJ-CL-NBR             PIC 9(04).               00957000
           05  PV-AUDIT-SUB-CL-NBR             PIC 9(04).               00958000
           05  PV-AUDIT-LOC-NBR                PIC 9(04).               00959000
           05  PV-AUDIT-ML-LO-MDSE-LVL-ID      PIC 9(09).               00960000
           05  PV-AUDIT-FSCL-WK-END-DTE        PIC X(10).               00970000
           05  FILLER                          PIC X(31).               00980000
                                                                        00990000
      ******************************************************************01000000
      *  DB2 SQL ERROR MESSAGE FORMAT AREA                              01010000
      ******************************************************************01020000
           COPY DPWS004.                                                01030000
                                                                        01040000
      ******************************************************************01050000
      * DATE ATTRIBUTE TABLE                                            01060000
      ******************************************************************01070000
           EXEC SQL                                                     01080000
             INCLUDE TDTATTR                                            01090000
           END-EXEC.                                                    01100000
      ******************************************************************01110000
      *  MLV00000  MLV_BRND_VND VIEW                                    01120000
      ******************************************************************01130000
           EXEC SQL                                                     01140000
                INCLUDE MLV00000                                        01150000
           END-EXEC.                                                    01160000
      ******************************************************************01170000
      * PARTITION NUMBER TABLE                                          01180000
      ******************************************************************01190000
           EXEC SQL                                                     01200000
             INCLUDE MLT00003                                           01210000
           END-EXEC.                                                    01220000
      ******************************************************************01230000
      * PARTITION BAL TABLE                                             01240000
      ******************************************************************01250000
           EXEC SQL                                                     01260000
             INCLUDE MLT00002                                           01270000
           END-EXEC.                                                    01280000
      ******************************************************************01290000
      * MLT_WKLY_SUM TABLE                                              01300000
      ******************************************************************01310000
           EXEC SQL                                                     01320000
             INCLUDE MLT00005                                           01330000
           END-EXEC.                                                    01340000
      ***************************************************************** 01350000
      *    DB2 AREA FOR COMMUNICATIONS                                * 01360000
      ***************************************************************** 01370000
           EXEC SQL                                                     01380000
                INCLUDE SQLCA                                           01390000
           END-EXEC.                                                    01400000
                                                                        01410000
                                                                        01420000
           EXEC SQL                                                     01430000
              DECLARE FROM_DKEY_CSR CURSOR FOR                          01440000
                SELECT                                                  01450000
                       PARTN_NBR                                        01460000
                     , DEPT_NBR                                         01470000
                     , MAJ_CL_NBR                                       01480000
                     , SUB_CL_NBR                                       01490000
                     , LOC_NBR                                          01500000
                     , ML_LO_MDSE_LVL_ID                                01510000
                     , FSCL_WK_END_DTE                                  01520002
                     , SLS_REG_RTL_AMT                                  01530000
                     , SLS_PROMO_RTL_AMT                                01540000
                     , SLS_PROCLR_RTL_AMT                               01550000
                     , SLS_CLR_RTL_AMT                                  01560000
                     , SLS_OTH_RTL_AMT                                  01570000
                     , MKDN_PLU_RTL_AMT                                 01580000
                     , MKDN_PROMO_RTL_AMT                               01590000
                     , MKDN_RGST_RTL_AMT                                01600000
                     , MKDN_GLDST_RTL_AMT                               01610000
                     , MKDN_UMTCH_RTL_AMT                               01620000
                     , MKDN_BYR_RTL_AMT                                 01630000
                     , MKDN_STR_RTL_AMT                                 01640000
                     , MKDN_PRPT_RTL_AMT                                01650000
                     , MKDN_OTH_RTL_AMT                                 01660000
                     , MKDN_RTL_AMT                                     01670000
                     , MKUP_RTL_AMT                                     01680000
                     , XFER_IN_RTL_AMT                                  01690000
                     , XFER_OUT_RTL_AMT                                 01700000
                     , RCPT_RTL_AMT                                     01710000
                     , RCPT_NET_COST_AMT                                01720000
                     , RCPT_GRO_COST_AMT                                01730000
                     , PADJ_RTL_AMT                                     01740000
                     , PADJ_FRGT_COST_AMT                               01750000
                     , PADJ_DISC_COST_AMT                               01760000
                     , PADJ_RTV_COST_AMT                                01770000
                     , PADJ_RTV_RTL_AMT                                 01780000
                     , PADJ_DA_COST_AMT                                 01790000
                     , PADJ_DA_RTL_AMT                                  01800000
                     , PADJ_NET_COST_AMT                                01810000
                     , PADJ_OTH_COST_AMT                                01820000
                     , PADJ_OTH_RTL_AMT                                 01830000
                     , DR_ALW_RTL_AMT                                   01840000
                     , RTV_RTL_AMT                                      01850000
                     , MKUP_INIT_AMT                                    01860000
                     , MKUP_NET_AMT                                     01870000
                     , INV_ADJ_RTL_AMT                                  01880000
                     , ONORD_RTL_AMT                                    01890000
                     , ONORD_COST_AMT                                   01900000
                     , SHNK_RTL_AMT                                     01910000
                     , END_INV_RTL_AMT                                  01920000
                     , END_INV_COST_AMT                                 01930000
                     , INV_COST_ADJ1_AMT                                01950000
                     , INV_COST_ADJ2_AMT                                01960000
                     , END_INV_COST1_AMT                                01970000
                     , END_INV_COST2_AMT                                01980000
                     , ADJ_GRO_MRGN_AMT                                 01990000
                    FROM  MLT_WKLY_SUM                                  02000000
                WHERE PARTN_NBR         = :MLT00003-PARTN-NBR           02010000
238672            AND DEPT_NBR          = :PV-FROM-TO-DEPT-NBR-COMP3    02020010
                  AND ML_LO_MDSE_LVL_ID = :PV-FROM-DKEY-NBR-COMP        02021008
                  AND FSCL_WK_END_DTE   = :PV-PROCESS-DATE              02030002
                   ORDER BY PARTN_NBR                                   02040000
                           ,DEPT_NBR                                    02050000
                           ,MAJ_CL_NBR                                  02060000
                           ,SUB_CL_NBR                                  02070000
                           ,LOC_NBR                                     02080000
                           ,ML_LO_MDSE_LVL_ID                           02090000
                                                                        02100000
           END-EXEC.                                                    02110000
      ******************************************************************02120000
       PROCEDURE DIVISION.                                              02130000
      ******************************************************************02140000
                                                                        02150000
       0000-MAINLINE.                                                   02160000
                                                                        02170000
           PERFORM 1000-INITIALIZE.                                     02180000
                                                                        02190000
           PERFORM 1100-PROCESS-FROM-TO-FILE                            02200000
               UNTIL PS-FROM-TO-FILE-AT-END-YES.                        02210000
                                                                        02220000
           DISPLAY 'PA-INPUT-COUNT     ' PA-INPUT-COUNT.                02230000
           DISPLAY 'PA-FROM-DKEY-COUNT ' PA-FROM-DKEY-ROW-COUNT         02240000
           DISPLAY 'PA-INSERT-COUNT    ' PA-INSERT-COUNT.               02250000
           DISPLAY 'PA-UPDATE-COUNT    ' PA-UPDATE-COUNT.               02260000
           DISPLAY 'PA-DELETE-COUNT    ' PA-DELETE-COUNT.               02261000
                                                                        02262000
           CLOSE CNTL-DATE-FILE                                         02263000
                 FROM-TO-DKEY-FILE                                      02263100
                 AUDIT-FILE.                                            02263200
                                                                        02263300
           STOP RUN.                                                    02263400
                                                                        02263500
                                                                        02263600
      ******************************************************************02263700
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     02263800
      ******************************************************************02263900
       1000-INITIALIZE.                                                 02264000
                                                                        02265000
           OPEN INPUT  CNTL-DATE-FILE                                   02266000
                       FROM-TO-DKEY-FILE                                02267000
                OUTPUT AUDIT-FILE.                                      02268000
                                                                        02269000
           INITIALIZE PV-AUDIT-REC.                                     02270000
                                                                        02280000
           PERFORM 8000-READ-CNTL-DTE.                                  02290000
                                                                        02300000
           PERFORM 8100-GET-PROCESS-DATE-INFO.                          02310000
                                                                        02320000
                                                                        02330000
       1100-PROCESS-FROM-TO-FILE.                                       02340000
                                                                        02350000
           PERFORM 8200-READ-FROM-TO-FILE.                              02360000
                                                                        02370000
           IF PS-FROM-TO-FILE-AT-END-NO                                 02380000
               PERFORM 1200-EDIT-FROM-TO-DATA                           02390000
               PERFORM 1500-GET-PARTN-NBR                               02400000
               PERFORM 1600-PROCESS-DKEYS                               02410000
           END-IF.                                                      02420000
                                                                        02430000
                                                                        02440000
       1200-EDIT-FROM-TO-DATA.                                          02450000
                                                                        02460000
           IF PV-FROM-TO-DEPT-NBR NOT NUMERIC                           02470000
               MOVE PC-4001 TO ABEND-CODE                               02480000
               DISPLAY '** PROGRAM ABEND **'                            02490000
               DISPLAY 'INPUT DEPT NOT NUMERIC FOR REC # '              02500000
                                                 PA-INPUT-COUNT         02510000
               CALL 'ILBOABN0' USING ABEND-CODE.                        02520000
                                                                        02530000
           IF PV-FROM-DKEY-NBR NOT NUMERIC                              02540000
               MOVE PC-4002 TO ABEND-CODE                               02550000
               DISPLAY '** PROGRAM ABEND **'                            02560000
               DISPLAY 'INPUT FROM DKEY NOT NUMERIC FOR REC # '         02570000
                                                 PA-INPUT-COUNT         02580000
               CALL 'ILBOABN0' USING ABEND-CODE.                        02581000
                                                                        02581100
           IF PV-TO-DKEY-NBR NOT NUMERIC                                02581200
               MOVE PC-4003 TO ABEND-CODE                               02581300
               DISPLAY '** PROGRAM ABEND **'                            02581400
               DISPLAY 'INPUT TO DKEY NOT NUMERIC FOR REC # '           02581500
                                                 PA-INPUT-COUNT         02581600
               CALL 'ILBOABN0' USING ABEND-CODE.                        02581700
                                                                        02581800
           MOVE PV-FROM-DKEY-NBR TO  PV-FROM-DKEY-NBR-COMP.             02581907
                                                                        02582009
238672     DISPLAY 'INPUT CONTROL RECORD ' PA-INPUT-COUNT.              02582110
238672     DISPLAY 'PV-FROM-TO-DEPT-NBR ' PV-FROM-TO-DEPT-NBR.          02582210
238672     DISPLAY 'PV-FROM-DKEY-NBR    ' PV-FROM-DKEY-NBR.             02582310
238672     DISPLAY 'PV-TO-DKEY-NBR      ' PV-TO-DKEY-NBR.               02582410
                                                                        02582509
238672     MOVE PV-FROM-TO-DEPT-NBR  TO PV-FROM-TO-DEPT-NBR-COMP3.      02582610
                                                                        02582709
                                                                        02582807
      *    IF PV-FROM-DKEY-NBR > ZEROS                                  02582907
      *        PERFORM 1205-CHECK-VALID-FROM-DKEY                       02583007
      *    END-IF.                                                      02583107
                                                                        02583200
           MOVE PV-TO-DKEY-NBR   TO PV-TO-DKEY-NBR-COMP.                02583300
                                                                        02583400
           EXEC SQL                                                     02583500
               SELECT ML_LO_MDSE_LVL_ID                                 02583600
                 INTO :PV-SAVE-TO-DKEY-NBR                              02583700
                 FROM MLV_BRND_VND                                      02583800
                 WHERE  ML_LO_MDSE_LVL_ID = :PV-TO-DKEY-NBR-COMP        02583900
238672             AND  DEPT_NBR          = :PV-FROM-TO-DEPT-NBR-COMP3  02584010
                   AND  EFF_BEG_DTE <= :PV-PROCESS-DATE                 02584108
                   AND (EFF_END_DTE >= :PV-PROCESS-DATE                 02584208
                    OR  EFF_END_DTE IS NULL)                            02584308
               WITH UR                                                  02584408
           END-EXEC.                                                    02584508
                                                                        02584608
           EVALUATE TRUE                                                02584708
               WHEN SQLCODE = ZERO                                      02584808
                   CONTINUE                                             02584908
               WHEN SQLCODE = +100                                      02585008
                   MOVE PC-4004 TO ABEND-CODE                           02585108
                   DISPLAY '** PROGRAM ABEND **'                        02585208
                   DISPLAY 'INPUT TO DKEY NOT FOUND FOR REC # '         02585308
                                                 PA-INPUT-COUNT         02585408
                   CALL 'ILBOABN0' USING ABEND-CODE                     02585508
               WHEN OTHER                                               02585608
                   MOVE '1200-EDIT-FROM-TO-DATA     '                   02585708
                                       TO PV-PARAGRAPH-NAME             02585808
                   PERFORM 9999-SQL-ABEND                               02585908
           END-EVALUATE.                                                02586008
                                                                        02586108
                                                                        02586208
      *1205-CHECK-VALID-FROM-DKEY.                                      02586308
      *                                                                 02586408
      *    MOVE PV-FROM-DKEY-NBR TO  PV-FROM-DKEY-NBR-COMP.             02586508
      *                                                                 02586608
      *    EXEC SQL                                                     02586708
      *        SELECT ML_LO_MDSE_LVL_ID                                 02586808
      *          INTO :PV-SAVE-FROM-DKEY-NBR                            02586908
      *          FROM MLV_BRND_VND                                      02587008
      *          WHERE  ML_LO_MDSE_LVL_ID = :PV-FROM-DKEY-NBR-COMP      02587108
      *            AND  EFF_BEG_DTE <= :PV-PROCESS-DATE                 02587208
      *            AND (EFF_END_DTE >= :PV-PROCESS-DATE                 02587308
      *             OR  EFF_END_DTE IS NULL)                            02587408
      *        WITH UR                                                  02587508
      *    END-EXEC.                                                    02587608
      *                                                                 02587708
      *    EVALUATE TRUE                                                02587808
      *        WHEN SQLCODE = ZERO                                      02587908
      *            CONTINUE                                             02588008
      *        WHEN SQLCODE = +100                                      02588108
      *            MOVE PC-4004 TO ABEND-CODE                           02588208
      *            DISPLAY '** PROGRAM ABEND **'                        02588308
      *            DISPLAY 'INPUT FROM DKEY NOT FOUND FOR REC # '       02588408
      *                                          PA-INPUT-COUNT         02588508
      *            CALL 'ILBOABN0' USING ABEND-CODE                     02588608
      *        WHEN OTHER                                               02588708
      *            MOVE '1205-CHECK-VALID-FROM-DKEY '                   02588808
      *                                TO PV-PARAGRAPH-NAME             02588908
      *            PERFORM 9999-SQL-ABEND                               02589008
      *    END-EVALUATE.                                                02589108
      *                                                                 02589207
                                                                        02589300
      ******************************************************************02589400
      *  1500-GET-PARTN-NBR                                             02589500
      ******************************************************************02589600
                                                                        02589700
       1500-GET-PARTN-NBR.                                              02589800
                                                                        02589900
           EXEC SQL                                                     02591000
                SELECT PARTN_NBR                                        02600000
                    INTO   :MLT00003-PARTN-NBR                          02610000
                FROM MLT_PARTN_CNTL A                                   02620000
                    ,MLT_PARTN_BAL  B                                   02630000
                WHERE B.DEPT_NBR = :PV-FROM-TO-DEPT-NBR-COMP3           02640000
                  AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE               02641000
                  AND A.TBL_TM_LVL_CDE = :PC-W                          02642000
                  AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                     02643000
                  AND A.FSCL_DTE = :PV-PROCESS-DATE                     02644000
                  AND B.EFF_BEG_DTE <= :PV-PROCESS-DATE                 02645000
                  AND B.EFF_END_DTE >= :PV-PROCESS-DATE                 02646000
                                                                        02647000
           END-EXEC.                                                    02648000
                                                                        02649000
           EVALUATE TRUE                                                02649100
               WHEN SQLCODE = 0                                         02649200
                    CONTINUE                                            02649300
               WHEN SQLWARN0 NOT = SPACES                               02649400
               WHEN SQLCODE < +0                                        02649500
               WHEN SQLCODE > +0                                        02649600
                    MOVE '1500-GET-PARTN-NBR        '                   02649700
                          TO PV-PARAGRAPH-NAME                          02649800
                    PERFORM 9999-SQL-ABEND                              02649900
           END-EVALUATE.                                                02650000
                                                                        02660000
                                                                        02670000
       1600-PROCESS-DKEYS.                                              02680000
                                                                        02690000
           PERFORM 2200-OPEN-FROM-DKEY-CSR.                             02700000
                                                                        02710000
           SET PS-FROM-DKEY-CSR-AT-END-NO TO TRUE.                      02720000
                                                                        02730000
           PERFORM 2400-PROCESS-FROM-DKEY-CSR                           02740000
              UNTIL PS-FROM-DKEY-CSR-AT-END-YES.                        02750000
                                                                        02760000
           PERFORM 2300-CLOSE-FROM-DKEY-CSR.                            02770000
                                                                        02780000
                                                                        02790000
       2200-OPEN-FROM-DKEY-CSR.                                         02800000
                                                                        02810000
           EXEC SQL                                                     02820000
               OPEN FROM_DKEY_CSR                                       02830000
           END-EXEC.                                                    02840000
                                                                        02850000
           IF SQLCODE NOT = ZERO                                        02860000
               MOVE '2200-OPEN-FROM-DKEY-CSR '                          02870000
                                       TO PV-PARAGRAPH-NAME             02880000
               PERFORM 9999-SQL-ABEND                                   02890000
           END-IF.                                                      02900000
                                                                        02910000
       2300-CLOSE-FROM-DKEY-CSR.                                        02920000
                                                                        02930000
           EXEC SQL                                                     02940000
               CLOSE FROM_DKEY_CSR                                      02950000
           END-EXEC.                                                    02960000
                                                                        02970000
           IF SQLCODE NOT = ZERO                                        02980000
               MOVE '2300-CLOSE-FROM-DKEY-CSR '                         02990000
                                       TO PV-PARAGRAPH-NAME             03000000
               PERFORM 9999-SQL-ABEND                                   03010000
           END-IF.                                                      03020000
                                                                        03030000
                                                                        03040000
       2400-PROCESS-FROM-DKEY-CSR.                                      03050000
                                                                        03060000
           PERFORM 2500-FETCH-FROM-DKEY.                                03070000
                                                                        03080000
           IF PS-FROM-DKEY-CSR-AT-END-NO                                03090000
               ADD 1               TO PA-FROM-DKEY-ROW-COUNT            03100000
               MOVE MLT00005-PARTN-NBR                                  03110000
                                   TO PV-AUDIT-PARTN-NBR                03120000
               MOVE MLT00005-DEPT-NBR                                   03130000
                                   TO PV-AUDIT-DEPT-NBR                 03140000
               MOVE MLT00005-MAJ-CL-NBR                                 03150000
                                   TO PV-AUDIT-MAJ-CL-NBR               03160000
               MOVE MLT00005-SUB-CL-NBR                                 03170000
                                   TO PV-AUDIT-SUB-CL-NBR               03180000
               MOVE MLT00005-LOC-NBR                                    03190000
                                   TO PV-AUDIT-LOC-NBR                  03200000
               MOVE MLT00005-ML-LO-MDSE-LVL-ID                          03210000
                                   TO PV-AUDIT-ML-LO-MDSE-LVL-ID        03220000
               MOVE MLT00005-FSCL-WK-END-DTE                            03230000
                                   TO PV-AUDIT-FSCL-WK-END-DTE          03240000
                                                                        03250000
               PERFORM 2700-INSERT-NEW-DKEY-ROW                         03260000
                                                                        03270000
               PERFORM 2900-DELETE-OLD-FROM-DKEY-ROW                    03280000
           END-IF.                                                      03290000
                                                                        03300000
                                                                        03310000
       2500-FETCH-FROM-DKEY.                                            03320000
                                                                        03330000
           EXEC SQL                                                     03340000
               FETCH FROM_DKEY_CSR                                      03350000
               INTO    :MLT00005-PARTN-NBR                              03360000
                      ,:MLT00005-DEPT-NBR                               03370000
                      ,:MLT00005-MAJ-CL-NBR                             03380000
                      ,:MLT00005-SUB-CL-NBR                             03390000
                      ,:MLT00005-LOC-NBR                                03400000
                      ,:MLT00005-ML-LO-MDSE-LVL-ID                      03410000
                      ,:MLT00005-FSCL-WK-END-DTE                        03420000
                      ,:MLT00005-SLS-REG-RTL-AMT                        03430000
                      ,:MLT00005-SLS-PROMO-RTL-AMT                      03440000
                      ,:MLT00005-SLS-PROCLR-RTL-AMT                     03450000
                      ,:MLT00005-SLS-CLR-RTL-AMT                        03460000
                      ,:MLT00005-SLS-OTH-RTL-AMT                        03470000
                      ,:MLT00005-MKDN-PLU-RTL-AMT                       03480000
                      ,:MLT00005-MKDN-PROMO-RTL-AMT                     03490000
                      ,:MLT00005-MKDN-RGST-RTL-AMT                      03500000
                      ,:MLT00005-MKDN-GLDST-RTL-AMT                     03510000
                      ,:MLT00005-MKDN-UMTCH-RTL-AMT                     03520000
                      ,:MLT00005-MKDN-BYR-RTL-AMT                       03530000
                      ,:MLT00005-MKDN-STR-RTL-AMT                       03540000
                      ,:MLT00005-MKDN-PRPT-RTL-AMT                      03550000
                      ,:MLT00005-MKDN-OTH-RTL-AMT                       03560000
                      ,:MLT00005-MKDN-RTL-AMT                           03570000
                      ,:MLT00005-MKUP-RTL-AMT                           03580000
                      ,:MLT00005-XFER-IN-RTL-AMT                        03590000
                      ,:MLT00005-XFER-OUT-RTL-AMT                       03600000
                      ,:MLT00005-RCPT-RTL-AMT                           03610000
                      ,:MLT00005-RCPT-NET-COST-AMT                      03620000
                      ,:MLT00005-RCPT-GRO-COST-AMT                      03630000
                      ,:MLT00005-PADJ-RTL-AMT                           03640000
                      ,:MLT00005-PADJ-FRGT-COST-AMT                     03650000
                      ,:MLT00005-PADJ-DISC-COST-AMT                     03660000
                      ,:MLT00005-PADJ-RTV-COST-AMT                      03670000
                      ,:MLT00005-PADJ-RTV-RTL-AMT                       03680000
                      ,:MLT00005-PADJ-DA-COST-AMT                       03690000
                      ,:MLT00005-PADJ-DA-RTL-AMT                        03700000
                      ,:MLT00005-PADJ-NET-COST-AMT                      03710000
                      ,:MLT00005-PADJ-OTH-COST-AMT                      03720000
                      ,:MLT00005-PADJ-OTH-RTL-AMT                       03730000
                      ,:MLT00005-DR-ALW-RTL-AMT                         03740000
                      ,:MLT00005-RTV-RTL-AMT                            03750000
                      ,:MLT00005-MKUP-INIT-AMT                          03760000
                      ,:MLT00005-MKUP-NET-AMT                           03770000
                      ,:MLT00005-INV-ADJ-RTL-AMT                        03780000
                      ,:MLT00005-ONORD-RTL-AMT                          03790000
                      ,:MLT00005-ONORD-COST-AMT                         03800000
                      ,:MLT00005-SHNK-RTL-AMT                           03810000
                      ,:MLT00005-END-INV-RTL-AMT                        03820000
                      ,:MLT00005-END-INV-COST-AMT                       03830000
                      ,:MLT00005-INV-COST-ADJ1-AMT                      03850000
                      ,:MLT00005-INV-COST-ADJ2-AMT                      03860000
                      ,:MLT00005-END-INV-COST1-AMT                      03870000
                      ,:MLT00005-END-INV-COST2-AMT                      03880000
                      ,:MLT00005-ADJ-GRO-MRGN-AMT                       03890000
           END-EXEC.                                                    03900000
                                                                        03910000
           EVALUATE TRUE                                                03920000
               WHEN SQLCODE = ZERO                                      03930000
                   SET PS-FROM-DKEY-CSR-AT-END-NO TO TRUE               03940000
               WHEN SQLCODE = +100                                      03950000
                   SET PS-FROM-DKEY-CSR-AT-END-YES TO TRUE              03960000
               WHEN OTHER                                               03970000
                   MOVE '2500-FETCH-FROM-DKEY       '                   03980004
                                       TO PV-PARAGRAPH-NAME             03990000
                   PERFORM 9999-SQL-ABEND                               04000000
           END-EVALUATE.                                                04010000
                                                                        04020000
                                                                        04030000
                                                                        04040000
                                                                        04050000
       2700-INSERT-NEW-DKEY-ROW.                                        04060000
                                                                        04070000
           EXEC SQL                                                     04080000
               INSERT INTO MLT_WKLY_SUM                                 04090000
                    (  PARTN_NBR                                        04100000
                     , DEPT_NBR                                         04110000
                     , MAJ_CL_NBR                                       04120000
                     , SUB_CL_NBR                                       04130000
                     , LOC_NBR                                          04140000
                     , ML_LO_MDSE_LVL_ID                                04150000
                     , FSCL_WK_END_DTE                                  04160002
                     , SLS_REG_RTL_AMT                                  04170000
                     , SLS_PROMO_RTL_AMT                                04180000
                     , SLS_PROCLR_RTL_AMT                               04190000
                     , SLS_CLR_RTL_AMT                                  04200000
                     , SLS_OTH_RTL_AMT                                  04210000
                     , MKDN_PLU_RTL_AMT                                 04220000
                     , MKDN_PROMO_RTL_AMT                               04230000
                     , MKDN_RGST_RTL_AMT                                04240000
                     , MKDN_GLDST_RTL_AMT                               04250000
                     , MKDN_UMTCH_RTL_AMT                               04260000
                     , MKDN_BYR_RTL_AMT                                 04270000
                     , MKDN_STR_RTL_AMT                                 04280000
                     , MKDN_PRPT_RTL_AMT                                04290000
                     , MKDN_OTH_RTL_AMT                                 04300000
                     , MKDN_RTL_AMT                                     04310000
                     , MKUP_RTL_AMT                                     04320000
                     , XFER_IN_RTL_AMT                                  04330000
                     , XFER_OUT_RTL_AMT                                 04340000
                     , RCPT_RTL_AMT                                     04350000
                     , RCPT_NET_COST_AMT                                04360000
                     , RCPT_GRO_COST_AMT                                04370000
                     , PADJ_RTL_AMT                                     04380000
                     , PADJ_FRGT_COST_AMT                               04390000
                     , PADJ_DISC_COST_AMT                               04400000
                     , PADJ_RTV_COST_AMT                                04410000
                     , PADJ_RTV_RTL_AMT                                 04420000
                     , PADJ_DA_COST_AMT                                 04430000
                     , PADJ_DA_RTL_AMT                                  04440000
                     , PADJ_NET_COST_AMT                                04450000
                     , PADJ_OTH_COST_AMT                                04460000
                     , PADJ_OTH_RTL_AMT                                 04470000
                     , DR_ALW_RTL_AMT                                   04480000
                     , RTV_RTL_AMT                                      04490000
                     , MKUP_INIT_AMT                                    04500000
                     , MKUP_NET_AMT                                     04510000
                     , INV_ADJ_RTL_AMT                                  04520000
                     , ONORD_RTL_AMT                                    04530000
                     , ONORD_COST_AMT                                   04540000
                     , SHNK_RTL_AMT                                     04550000
                     , END_INV_RTL_AMT                                  04560000
                     , END_INV_COST_AMT                                 04570000
                     , INV_COST_ADJ1_AMT                                04590000
                     , INV_COST_ADJ2_AMT                                04600000
                     , END_INV_COST1_AMT                                04610000
                     , END_INV_COST2_AMT                                04620000
                     , ADJ_GRO_MRGN_AMT )                               04630000
               VALUES (:MLT00005-PARTN-NBR                              04640000
                      ,:MLT00005-DEPT-NBR                               04650000
                      ,:MLT00005-MAJ-CL-NBR                             04660000
                      ,:MLT00005-SUB-CL-NBR                             04670000
                      ,:MLT00005-LOC-NBR                                04680000
                      ,:PV-SAVE-TO-DKEY-NBR                             04690000
                      ,:MLT00005-FSCL-WK-END-DTE                        04700000
                      ,:MLT00005-SLS-REG-RTL-AMT                        04710000
                      ,:MLT00005-SLS-PROMO-RTL-AMT                      04720000
                      ,:MLT00005-SLS-PROCLR-RTL-AMT                     04730000
                      ,:MLT00005-SLS-CLR-RTL-AMT                        04740000
                      ,:MLT00005-SLS-OTH-RTL-AMT                        04750000
                      ,:MLT00005-MKDN-PLU-RTL-AMT                       04760000
                      ,:MLT00005-MKDN-PROMO-RTL-AMT                     04770000
                      ,:MLT00005-MKDN-RGST-RTL-AMT                      04780000
                      ,:MLT00005-MKDN-GLDST-RTL-AMT                     04790000
                      ,:MLT00005-MKDN-UMTCH-RTL-AMT                     04800000
                      ,:MLT00005-MKDN-BYR-RTL-AMT                       04810000
                      ,:MLT00005-MKDN-STR-RTL-AMT                       04820000
                      ,:MLT00005-MKDN-PRPT-RTL-AMT                      04830000
                      ,:MLT00005-MKDN-OTH-RTL-AMT                       04840000
                      ,:MLT00005-MKDN-RTL-AMT                           04850000
                      ,:MLT00005-MKUP-RTL-AMT                           04860000
                      ,:MLT00005-XFER-IN-RTL-AMT                        04870000
                      ,:MLT00005-XFER-OUT-RTL-AMT                       04880000
                      ,:MLT00005-RCPT-RTL-AMT                           04890000
                      ,:MLT00005-RCPT-NET-COST-AMT                      04900000
                      ,:MLT00005-RCPT-GRO-COST-AMT                      04910000
                      ,:MLT00005-PADJ-RTL-AMT                           04920000
                      ,:MLT00005-PADJ-FRGT-COST-AMT                     04930000
                      ,:MLT00005-PADJ-DISC-COST-AMT                     04940000
                      ,:MLT00005-PADJ-RTV-COST-AMT                      04950000
                      ,:MLT00005-PADJ-RTV-RTL-AMT                       04960000
                      ,:MLT00005-PADJ-DA-COST-AMT                       04970000
                      ,:MLT00005-PADJ-DA-RTL-AMT                        04980000
                      ,:MLT00005-PADJ-NET-COST-AMT                      04990000
                      ,:MLT00005-PADJ-OTH-COST-AMT                      05000000
                      ,:MLT00005-PADJ-OTH-RTL-AMT                       05010000
                      ,:MLT00005-DR-ALW-RTL-AMT                         05020000
                      ,:MLT00005-RTV-RTL-AMT                            05030000
                      ,:MLT00005-MKUP-INIT-AMT                          05040000
                      ,:MLT00005-MKUP-NET-AMT                           05050000
                      ,:MLT00005-INV-ADJ-RTL-AMT                        05060000
                      ,:MLT00005-ONORD-RTL-AMT                          05070000
                      ,:MLT00005-ONORD-COST-AMT                         05080000
                      ,:MLT00005-SHNK-RTL-AMT                           05090000
                      ,:MLT00005-END-INV-RTL-AMT                        05100000
                      ,:MLT00005-END-INV-COST-AMT                       05110000
                      ,:MLT00005-INV-COST-ADJ1-AMT                      05130000
                      ,:MLT00005-INV-COST-ADJ2-AMT                      05140000
                      ,:MLT00005-END-INV-COST1-AMT                      05150000
                      ,:MLT00005-END-INV-COST2-AMT                      05160000
                      ,:MLT00005-ADJ-GRO-MRGN-AMT )                     05170000
           END-EXEC.                                                    05180000
                                                                        05190000
           EVALUATE TRUE                                                05200000
               WHEN SQLCODE = ZERO                                      05210000
                   ADD 1                      TO PA-INSERT-COUNT        05220000
                   MOVE PV-SAVE-TO-DKEY-NBR   TO                        05230000
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   05240000
                   MOVE PC-INSERT             TO PV-AUDIT-ACTION        05250000
                   PERFORM 8300-WRITE-AUDIT-REC                         05260000
               WHEN SQLCODE = -803                                      05270000
                   PERFORM 2800-UPDATE-EXISTING-UNK-ROW                 05280000
               WHEN OTHER                                               05290000
                   DISPLAY                                              05300000
                        ' PARTN: ' MLT00005-PARTN-NBR,                  05310000
                        ' DEPT:  ' MLT00005-DEPT-NBR,                   05320000
                        ' MAJCL: ' MLT00005-MAJ-CL-NBR,                 05330000
                        ' SUBCL: ' MLT00005-SUB-CL-NBR,                 05340000
                        ' LOC:   ' MLT00005-LOC-NBR,                    05350000
                        ' ML-LWST-ID: ' PV-SAVE-TO-DKEY-NBR             05360000
                   MOVE '2700-INSERT-NEW-DKEY ROW '                     05370000
                                         TO PV-PARAGRAPH-NAME           05380000
                   PERFORM 9999-SQL-ABEND                               05390000
           END-EVALUATE.                                                05400000
                                                                        05410000
                                                                        05420000
       2800-UPDATE-EXISTING-UNK-ROW.                                    05430000
                                                                        05440000
           EXEC SQL                                                     05450000
             UPDATE MLT_WKLY_SUM                                        05460000
               SET SLS_REG_RTL_AMT    = SLS_REG_RTL_AMT                 05470000
                            + :MLT00005-SLS-REG-RTL-AMT                 05480000
                  ,SLS_PROMO_RTL_AMT  = SLS_PROMO_RTL_AMT               05490000
                            + :MLT00005-SLS-PROMO-RTL-AMT               05500000
                  ,SLS_PROCLR_RTL_AMT = SLS_PROCLR_RTL_AMT              05510000
                            + :MLT00005-SLS-PROCLR-RTL-AMT              05520000
                  ,SLS_CLR_RTL_AMT    = SLS_CLR_RTL_AMT                 05530000
                            + :MLT00005-SLS-CLR-RTL-AMT                 05540000
                  ,SLS_OTH_RTL_AMT    = SLS_OTH_RTL_AMT                 05550000
                            + :MLT00005-SLS-OTH-RTL-AMT                 05560000
                  ,MKDN_PLU_RTL_AMT   = MKDN_PLU_RTL_AMT                05570000
                            + :MLT00005-MKDN-PLU-RTL-AMT                05580000
                  ,MKDN_PROMO_RTL_AMT = MKDN_PROMO_RTL_AMT              05590000
                            + :MLT00005-MKDN-PROMO-RTL-AMT              05600000
                  ,MKDN_RGST_RTL_AMT  = MKDN_RGST_RTL_AMT               05610000
                            + :MLT00005-MKDN-RGST-RTL-AMT               05620000
                  ,MKDN_GLDST_RTL_AMT = MKDN_GLDST_RTL_AMT              05630000
                            + :MLT00005-MKDN-GLDST-RTL-AMT              05640000
                  ,MKDN_UMTCH_RTL_AMT = MKDN_UMTCH_RTL_AMT              05650000
                            + :MLT00005-MKDN-UMTCH-RTL-AMT              05660000
                  ,MKDN_BYR_RTL_AMT   = MKDN_BYR_RTL_AMT                05670000
                            + :MLT00005-MKDN-BYR-RTL-AMT                05680000
                  ,MKDN_STR_RTL_AMT   = MKDN_STR_RTL_AMT                05690000
                            + :MLT00005-MKDN-STR-RTL-AMT                05700000
                  ,MKDN_PRPT_RTL_AMT  = MKDN_PRPT_RTL_AMT               05710000
                            + :MLT00005-MKDN-PRPT-RTL-AMT               05720000
                  ,MKDN_OTH_RTL_AMT   = MKDN_OTH_RTL_AMT                05730000
                            + :MLT00005-MKDN-OTH-RTL-AMT                05740000
                  ,MKDN_RTL_AMT       = MKDN_RTL_AMT                    05750000
                            + :MLT00005-MKDN-RTL-AMT                    05760000
                  ,MKUP_RTL_AMT       = MKUP_RTL_AMT                    05770000
                            + :MLT00005-MKUP-RTL-AMT                    05780000
                  ,XFER_IN_RTL_AMT    = XFER_IN_RTL_AMT                 05790000
                            + :MLT00005-XFER-IN-RTL-AMT                 05800000
                  ,XFER_OUT_RTL_AMT   = XFER_OUT_RTL_AMT                05810000
                            + :MLT00005-XFER-OUT-RTL-AMT                05820000
                  ,RCPT_RTL_AMT       = RCPT_RTL_AMT                    05830000
                            + :MLT00005-RCPT-RTL-AMT                    05840000
                  ,RCPT_NET_COST_AMT  = RCPT_NET_COST_AMT               05850000
                            + :MLT00005-RCPT-NET-COST-AMT               05860000
                  ,RCPT_GRO_COST_AMT  = RCPT_GRO_COST_AMT               05870000
                            + :MLT00005-RCPT-GRO-COST-AMT               05880000
                  ,PADJ_RTL_AMT       = PADJ_RTL_AMT                    05890000
                            + :MLT00005-PADJ-RTL-AMT                    05900000
                  ,PADJ_FRGT_COST_AMT = PADJ_FRGT_COST_AMT              05910000
                            + :MLT00005-PADJ-FRGT-COST-AMT              05920000
                  ,PADJ_DISC_COST_AMT = PADJ_DISC_COST_AMT              05930000
                            + :MLT00005-PADJ-DISC-COST-AMT              05940000
                  ,PADJ_RTV_COST_AMT  = PADJ_RTV_COST_AMT               05950000
                            + :MLT00005-PADJ-RTV-COST-AMT               05960000
                  ,PADJ_RTV_RTL_AMT   = PADJ_RTV_RTL_AMT                05970000
                            + :MLT00005-PADJ-RTV-RTL-AMT                05980000
                  ,PADJ_DA_COST_AMT   = PADJ_DA_COST_AMT                05990000
                            + :MLT00005-PADJ-DA-COST-AMT                06000000
                  ,PADJ_DA_RTL_AMT    = PADJ_DA_RTL_AMT                 06010000
                            + :MLT00005-PADJ-DA-RTL-AMT                 06020000
                  ,PADJ_NET_COST_AMT  = PADJ_NET_COST_AMT               06030000
                            + :MLT00005-PADJ-NET-COST-AMT               06040000
                  ,PADJ_OTH_COST_AMT  = PADJ_OTH_COST_AMT               06050000
                            + :MLT00005-PADJ-OTH-COST-AMT               06060000
                  ,PADJ_OTH_RTL_AMT   = PADJ_OTH_RTL_AMT                06070000
                            + :MLT00005-PADJ-OTH-RTL-AMT                06080000
                  ,DR_ALW_RTL_AMT     = DR_ALW_RTL_AMT                  06090000
                            + :MLT00005-DR-ALW-RTL-AMT                  06100000
                  ,RTV_RTL_AMT        = RTV_RTL_AMT                     06110000
                            + :MLT00005-RTV-RTL-AMT                     06120000
                  ,MKUP_INIT_AMT      = MKUP_INIT_AMT                   06130000
                            + :MLT00005-MKUP-INIT-AMT                   06140000
                  ,MKUP_NET_AMT       = MKUP_NET_AMT                    06150000
                            + :MLT00005-MKUP-NET-AMT                    06160000
                  ,INV_ADJ_RTL_AMT    = INV_ADJ_RTL_AMT                 06170000
                            + :MLT00005-INV-ADJ-RTL-AMT                 06180000
                  ,ONORD_RTL_AMT      = ONORD_RTL_AMT                   06190000
                            + :MLT00005-ONORD-RTL-AMT                   06200000
                  ,ONORD_COST_AMT     = ONORD_COST_AMT                  06210000
                            + :MLT00005-ONORD-COST-AMT                  06220000
                  ,SHNK_RTL_AMT       = SHNK_RTL_AMT                    06230000
                            + :MLT00005-SHNK-RTL-AMT                    06240000
                  ,END_INV_RTL_AMT    = END_INV_RTL_AMT                 06250000
                            + :MLT00005-END-INV-RTL-AMT                 06260000
                  ,END_INV_COST_AMT   = END_INV_COST_AMT                06270000
                            + :MLT00005-END-INV-COST-AMT                06280000
                  ,INV_COST_ADJ1_AMT  = INV_COST_ADJ1_AMT               06310000
                            + :MLT00005-INV-COST-ADJ1-AMT               06320000
                  ,INV_COST_ADJ2_AMT  = INV_COST_ADJ2_AMT               06330000
                            + :MLT00005-INV-COST-ADJ2-AMT               06340000
                  ,END_INV_COST1_AMT  = END_INV_COST1_AMT               06350000
                            + :MLT00005-END-INV-COST1-AMT               06360000
                  ,END_INV_COST2_AMT  = END_INV_COST2_AMT               06370000
                            + :MLT00005-END-INV-COST2-AMT               06380000
                  ,ADJ_GRO_MRGN_AMT   = ADJ_GRO_MRGN_AMT                06390000
                            + :MLT00005-ADJ-GRO-MRGN-AMT                06400000
                 WHERE PARTN_NBR       = :MLT00005-PARTN-NBR            06410000
                   AND DEPT_NBR        = :MLT00005-DEPT-NBR             06420000
                   AND MAJ_CL_NBR      = :MLT00005-MAJ-CL-NBR           06430000
                   AND SUB_CL_NBR      = :MLT00005-SUB-CL-NBR           06440000
                   AND LOC_NBR         = :MLT00005-LOC-NBR              06450000
                   AND ML_LO_MDSE_LVL_ID = :PV-SAVE-TO-DKEY-NBR         06460000
           END-EXEC.                                                    06470000
                                                                        06480000
           EVALUATE SQLCODE                                             06490000
               WHEN ZERO                                                06500000
                   ADD 1                      TO PA-UPDATE-COUNT        06510000
                   MOVE PV-SAVE-TO-DKEY-NBR   TO                        06520000
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   06530000
                   MOVE PC-UPDATE             TO PV-AUDIT-ACTION        06540000
                   PERFORM 8300-WRITE-AUDIT-REC                         06550000
               WHEN OTHER                                               06560000
                    DISPLAY '*************************************'     06570000
                    DISPLAY 'ROW IN PROCESS : '                         06580000
                         ' PARTN: ' MLT00005-PARTN-NBR,                 06590000
                         ' DEPT:  ' MLT00005-DEPT-NBR,                  06600000
                         ' MAJCL: ' MLT00005-MAJ-CL-NBR,                06610000
                         ' SUBCL: ' MLT00005-SUB-CL-NBR,                06620000
                         ' LOC:   ' MLT00005-LOC-NBR,                   06630000
                         ' ML-LWST-ID: ' PV-SAVE-TO-DKEY-NBR            06640000
                    DISPLAY '*************************************'     06650000
                    MOVE '2800-UPDATE-EXISTING-UNK-ROW '                06660000
                                          TO PV-PARAGRAPH-NAME          06670000
                    PERFORM 9999-SQL-ABEND                              06680000
           END-EVALUATE.                                                06690000
                                                                        06700000
                                                                        06710000
      ****************************************************************  06720000
      * 2900-DELETE-OLD-FROM-DKEY-ROW.                                  06730000
      ****************************************************************  06740000
                                                                        06750000
       2900-DELETE-OLD-FROM-DKEY-ROW.                                   06760000
                                                                        06770000
           EXEC SQL                                                     06780000
             DELETE FROM MLT_WKLY_SUM                                   06790000
                 WHERE PARTN_NBR       = :MLT00005-PARTN-NBR            06800000
                   AND DEPT_NBR        = :MLT00005-DEPT-NBR             06810000
                   AND MAJ_CL_NBR      = :MLT00005-MAJ-CL-NBR           06820000
                   AND SUB_CL_NBR      = :MLT00005-SUB-CL-NBR           06830000
                   AND LOC_NBR         = :MLT00005-LOC-NBR              06840000
                   AND ML_LO_MDSE_LVL_ID                                06850000
                                       = :MLT00005-ML-LO-MDSE-LVL-ID    06860000
           END-EXEC.                                                    06870000
                                                                        06880000
           EVALUATE SQLCODE                                             06890000
               WHEN ZERO                                                06900000
                   ADD 1                      TO PA-DELETE-COUNT        06910000
                   MOVE MLT00005-ML-LO-MDSE-LVL-ID  TO                  06920000
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   06930000
                   MOVE PC-DELETE             TO PV-AUDIT-ACTION        06940000
                   PERFORM 8300-WRITE-AUDIT-REC                         06950000
               WHEN OTHER                                               06960000
                    DISPLAY '*************************************'     06970000
                    DISPLAY 'ROW IN PROCESS : '                         06980000
                         ' PARTN: ' MLT00005-PARTN-NBR,                 06990000
                         ' DEPT:  ' MLT00005-DEPT-NBR,                  07000000
                         ' MAJCL: ' MLT00005-MAJ-CL-NBR,                07010000
                         ' SUBCL: ' MLT00005-SUB-CL-NBR,                07020000
                         ' LOC:   ' MLT00005-LOC-NBR,                   07030000
                         ' ML-LWST-ID: '                                07040000
                                    MLT00005-ML-LO-MDSE-LVL-ID          07050000
                    DISPLAY '*************************************'     07060000
                    MOVE '2900-DELETE-OLD-FROM-DKEY-ROW'                07070000
                                          TO PV-PARAGRAPH-NAME          07080000
                    PERFORM 9999-SQL-ABEND                              07090000
           END-EVALUATE.                                                07100000
                                                                        07110000
                                                                        07120000
      ******************************************************************07130000
      * 8000-READ-CNTL-DTE.                                             07140000
      ******************************************************************07150000
                                                                        07160000
       8000-READ-CNTL-DTE.                                              07170000
           READ CNTL-DATE-FILE INTO CC-CONTROL-CARD                     07180000
               AT END                                                   07190000
                   DISPLAY '** PROGRAM ABEND **'                        07200000
                   DISPLAY 'MLKUP975  - CONTROL DATE EMPTY'             07210000
                   MOVE PC-4005 TO ABEND-CODE                           07220000
                   CALL 'ILBOABN0' USING ABEND-CODE.                    07230000
                                                                        07240000
           DISPLAY '** MLKUP975 CONTROL CARD:' CNTL-DATE-REC.           07250000
                                                                        07251000
           MOVE CC-PROC-DATE-ISO TO PV-PROCESS-DATE.                    07252000
                                                                        07253000
      ****************************************************************  07254000
      * VALIDATE THE PROCESS DATE.                                      07255000
      ****************************************************************  07256000
                                                                        07256100
       8100-GET-PROCESS-DATE-INFO.                                      07256200
                                                                        07256300
           PERFORM                                                      07256400
               WITH TEST AFTER                                          07256500
               VARYING PV-RETRY-COUNTER                                 07256600
               FROM 1 BY 1                                              07256700
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07256800
                         OR (SQLCODE = ZERO)                            07256900
                         OR (SQLCODE = 100))                            07257000
                  EXEC SQL                                              07258000
                      SELECT 'Y'                                        07259000
                        INTO :PV-DB2-DATE-EXISTS                        07260000
                        FROM TDTATTR                                    07270000
                       WHERE KY_DTE          = :PV-PROCESS-DATE         07280003
                       AND   FSCL_WK_END_DTE = :PV-PROCESS-DATE         07290003
                  END-EXEC                                              07300000
                                                                        07310000
                  EVALUATE TRUE                                         07320000
                      WHEN SQLCODE = ZERO                               07330000
                           DISPLAY 'DATE SELECT: '                      07340000
                                  PV-PROCESS-DATE                       07350000
                                  ' SUCCESSFUL'                         07360000
                           CONTINUE                                     07370000
                      WHEN SQLCODE = -904                               07380000
                      WHEN SQLCODE = -913                               07390000
                           CONTINUE                                     07400000
                      WHEN SQLWARN0 NOT = SPACES                        07410000
                      WHEN SQLCODE < ZERO                               07420000
                      WHEN SQLCODE > ZERO                               07430000
                           MOVE '3000-GET-PROCESS-DATE-INFO'            07440000
                                 TO PV-PARAGRAPH-NAME                   07450000
                           PERFORM 9999-SQL-ABEND                       07460000
                  END-EVALUATE                                          07470000
           END-PERFORM.                                                 07480000
                                                                        07490000
           IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07500000
              DISPLAY 'RETRIES EXCEEDED FOR PROCESS DATE '              07510000
           END-IF.                                                      07520000
                                                                        07530000
      ******************************************************************07540000
      * 8200-READ-FROM-TO-FILE                                          07550000
      ******************************************************************07560000
                                                                        07570000
       8200-READ-FROM-TO-FILE.                                          07580000
                                                                        07590000
           READ FROM-TO-DKEY-FILE INTO PV-FROM-TO-DKEY-REC              07600000
               AT END                                                   07610000
                   SET PS-FROM-TO-FILE-AT-END-YES TO TRUE.              07620000
                                                                        07630000
           IF PS-FROM-TO-FILE-AT-END-NO                                 07640000
               ADD 1 TO PA-INPUT-COUNT                                  07650000
           END-IF.                                                      07660000
                                                                        07670000
      ******************************************************************07680000
      * 8300-WRITE-AUDIT-REC.                                           07690000
      ******************************************************************07700000
                                                                        07710000
       8300-WRITE-AUDIT-REC.                                            07720000
                                                                        07730000
           WRITE AUDIT-REC FROM PV-AUDIT-REC.                           07740000
                                                                        07750000
                                                                        07760000
                                                                        07770000
      ******************************************************************07780000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               07790000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             07800000
      ******************************************************************07810000
       9999-SQL-ABEND.                                                  07820000
                                                                        07830000
           DISPLAY '**  ABEND     **'.                                  07840000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  07850000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            07860000
                                                                        07870000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07880000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07890000
                                                                        07900000
           COPY DPPD004.                                                07910000
                                                                        07920000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           07930000
                                                                        07940000
