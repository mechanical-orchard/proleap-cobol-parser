000100******************************************************************00010029
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SAKRP102.                                00050000
000600 AUTHOR.                 BARB SCHULTZ.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           FEBRUARY 2023.                           00080002
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200* THIS PROGRAM CREATES A REPORT THAT SHOWS SALES AND RETURN       00120000
001300* TRANSACTIONS FOR DEPT 985. (MARKETPLACE)                        00130002
001400* IT ALSO SHOWS THE LINE LEVEL DISCOUNTS PER ITEM FOR DEPT 985.   00140000
001500* THIS IS A BASED OFF OF SAKRP101 WITHOUT ANY STORE OR FINAL      00150002
001600* TOTALS.                                                         00160002
001700***************************************************************** 00170000
001800* DATE: 02-08-2023                    CHG#: CHG0282599            00180030
001900* WHO: BARB SCHULTZ                                               00190010
002000* WHY: NEW IMPLEMENTATION                                         00200010
002100***************************************************************** 00210000
283520* DATE: 02-15-2023                   CHG#: CHG0283520             00211051
283520* WHO: BARB SCHULTZ                                               00212051
283520* WHY: FIXED TOTAL AMT BY SUBTRACTING TX AMT FROM IT. ALSO ADDED  00213051
283520* A COMMA DELIMITED CSV FILE.                                     00213151
283520***************************************************************** 00214051
283763* DATE: 02-20-2023                   CHG#: CHG0283763             00215055
283763* WHO: BARB SCHULTZ                                               00216055
283763* WHY: FIXED THE ORDER NUMBER ON THE CSV FILE.  IT WAS NOT BEING  00217055
283763* INITIALIZED IN ONE PLACE.                                       00218055
283763***************************************************************** 00219055
283763* DATE: 03-06-2023                   CHG#: CHG0285002             00219158
283763* WHO: BARB SCHULTZ                                               00219258
283763* WHY: INCREASED THE SIZES OF LIST PRICE, TOTAL DISCOUNT, OTHER,  00219358
283763* KOHLS CASH USED, KOHLS CASH EARNED, ASSOCIATE DISCOUNT, NET     00219458
283763* CHARGED AMOUNT, TAX AMOUNT, AND TOTAL AMOUNT ON THE CSV FILE.   00219558
283763***************************************************************** 00219658
285318* DATE: 03-09-2023                   CHG#: CHG0285318             00219760
585318* WHO: BARB SCHULTZ                                               00219874
285318* WHY: ADDED TRANSACTION TYPES '24' AND '25' (PRICE ADJUSTMENTS)  00219960
285318* TO THE CURSOR.                                                  00220060
285318***************************************************************** 00220161
FIX24 * DATE: 01-31-2024                   CHG#: CHG0300818             00220266
FIX24 * WHO: JIM HUNTER                                                 00220366
FIX24 * WHY:                                                            00220466
FIX24 *  ADDING FETCH FIRST 1 ROW ONLY TO AVOID -811 ABENDS WHEN A      00220672
FIX24 *  SALES CORRECTION WAS PERFORMED AND MORE THAN 1 ROW IS RETURNED 00220766
FIX24 *  IN THE 4200-FIND-ORIG-ORD-NBR PARAGRAPH.                       00220872
FIX24 ***************************************************************** 00220966
TRNT21* DATE: 02-20-2024                   CHG#: CHG0301703             00221074
TRNT21* WHO: JIM HUNTER                                                 00221173
TRNT21* WHY: ADDED TRAN TYPE '21' (EVEN EXCHANGES) TO THE CURSOR.       00221273
TRNT21***************************************************************** 00221673
002200 ENVIRONMENT DIVISION.                                            00222059
002300***************************************************************** 00230000
002400                                                                  00240000
002500 CONFIGURATION SECTION.                                           00250000
002600                                                                  00260000
002700 SOURCE-COMPUTER.        IBM-3090.                                00270000
002800                                                                  00280000
002900 OBJECT-COMPUTER.        IBM-3090.                                00290000
003000                                                                  00300000
003100 INPUT-OUTPUT SECTION.                                            00310000
003200                                                                  00320000
003300 FILE-CONTROL.                                                    00330000
003400                                                                  00340000
003500     SELECT POS-DATE-CARD-FILE                                    00350000
003600         ASSIGN TO INP01.                                         00360000
003700                                                                  00370000
003800     SELECT SALES-REPORT-FILE                                     00380000
003900         ASSIGN TO RPT01.                                         00390000
004000                                                                  00400000
283520     SELECT SALES-CSV-FILE                                        00401052
283520         ASSIGN TO OUT01.                                         00402052
283520                                                                  00403052
004100******************************************************************00410000
004200 DATA DIVISION.                                                   00420000
004300******************************************************************00430000
004400                                                                  00440000
004500 FILE SECTION.                                                    00450000
004600                                                                  00460000
004700 FD  POS-DATE-CARD-FILE                                           00470000
004800     RECORDING MODE IS F                                          00480000
004900     BLOCK CONTAINS 0 RECORDS                                     00490000
005000     LABEL RECORDS ARE STANDARD.                                  00500000
005100                                                                  00510000
005200 01  POS-DATE-CARD-RECORD            PIC X(80).                   00520000
005300                                                                  00530000
005400 FD  SALES-REPORT-FILE                                            00540000
005500     RECORDING MODE IS F                                          00550000
005600     BLOCK CONTAINS 0  RECORDS.                                   00560000
005700                                                                  00570000
005800 01  SALES-REPORT-RECORD             PIC X(150).                  00580000
005900                                                                  00590000
283520 FD  SALES-CSV-FILE                                               00591052
283520     RECORDING MODE IS F                                          00592052
283520     BLOCK CONTAINS 0  RECORDS.                                   00593052
283520                                                                  00594052
283520 01  SALES-CSV-RECORD                PIC X(140).                  00595052
083520                                                                  00596052
006000******************************************************************00600000
006100 WORKING-STORAGE SECTION.                                         00610000
006200******************************************************************00620000
006300 01  FILLER                            PIC X(50)  VALUE           00630000
006400     ' *** WORKING STORAGE STARTS HERE FOR SAKRP102 *** '.        00640000
006500                                                                  00650000
006600******************************************************************00660000
006700* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    00670000
006800******************************************************************00680000
006900 01  CC-CONTROL-CARD.                                             00690000
007000     05  CC-CONTROL-CARD-DISPLAY.                                 00700000
007100         10  CC-BEGIN-DATE       PIC X(10)    VALUE SPACES.       00710000
007200         10  FILLER              PIC X        VALUE SPACE.        00720000
007300         10  CC-END-DATE         PIC X(10)    VALUE ZERO.         00730000
007400     05  FILLER                  PIC X(59)    VALUE SPACE.        00740000
007500 01  DATE-CONTROL-CARD.                                           00750000
007600     05  CC-WEEK-ENDING-DATE-ISO.                                 00760000
007700         10  CC-WEEK-ENDING-CC   PIC X(02).                       00770000
007800         10  CC-WEEK-ENDING-YY   PIC X(02).                       00780000
007900         10  FILLER              PIC X(01).                       00790000
008000         10  CC-WEEK-ENDING-MM   PIC X(02).                       00800000
008100         10  FILLER              PIC X(01).                       00810000
008200         10  CC-WEEK-ENDING-DD   PIC X(02).                       00820000
008300     05  FILLER                  PIC X(70).                       00830000
008400                                                                  00840000
008500******************************************************************00850000
008600*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             00860000
008700******************************************************************00870000
008800     COPY DPWS500.                                                00880000
008900                                                                  00890000
009000 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00900000
009100                                                  COMP SYNC.      00910000
283520     88  AC-ANY-ERROR                             VALUE +4001     00920052
283520                                                  THRU  +4019.    00920152
283520     88  AC-INVALID-KEY-WRITE                     VALUE +4001.    00921052
283520     88  AC-INVALID-KEY-READ                      VALUE +4002.    00922052
009200     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00923039
283520     88  AC-OPEN-ERROR                            VALUE +4005.    00924052
283520     88  AC-CLOSE-ERROR                           VALUE +4006.    00925052
283520     88  AC-INVALID-DATA                          VALUE +4008.    00926052
009300     88  AC-DB2-ERROR                             VALUE +4013.    00930000
283520     88  AC-UNSUCCESSFUL-SELECT                   VALUE +4015.    00931052
283520     88  AC-MAX-RETRIES-EXCEEDED                  VALUE +4016.    00932052
009400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00940000
009500                                                                  00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009700     05  PS-END-OF-ITEM                PIC X(01)  VALUE 'N'.      00970000
009800         88  PS-END-OF-ITEM-YES                   VALUE 'Y'.      00980000
009900         88  PS-END-OF-ITEM-NO                    VALUE 'N'.      00990000
010000     05  PS-END-OF-LID-CURSOR          PIC X(01)  VALUE 'N'.      01000000
010100         88  PS-END-OF-LID-YES                    VALUE 'Y'.      01010000
010200         88  PS-END-OF-LID-NO                     VALUE 'N'.      01020000
010300     05  PS-ORIG-TRN-FOUND-SW          PIC X(01)  VALUE 'N'.      01030010
010400         88  PS-ORIG-TRN-FOUND-Y                  VALUE 'Y'.      01040010
010500         88  PS-ORIG-TRN-FOUND-N                  VALUE 'N'.      01050010
010600     05  PS-END-OF-EID-CURSOR          PIC X(01)  VALUE 'N'.      01060000
010700         88  PS-END-OF-EID-YES                    VALUE 'Y'.      01070000
010800         88  PS-END-OF-EID-NO                     VALUE 'N'.      01080000
010900     05  PS-FIRST-TIME-SW              PIC X(01)  VALUE 'Y'.      01090000
011000         88  PS-FIRST-TIME                        VALUE 'Y'.      01100000
011100         88  PS-FIRST-TIME-NO                     VALUE 'N'.      01110000
011200     05  PS-END-OF-CARD-FILE           PIC X(01)  VALUE 'N'.      01120000
011300         88  PS-END-OF-CARD-FILE-YES              VALUE 'Y'.      01130000
011400     05  PS-ORDER-NUMBER-IND           PIC X(01)  VALUE 'N'.      01140000
011500         88  PS-ORDER-NUMBER-FOUND-Y              VALUE 'Y'.      01150000
011600         88  PS-ORDER-NUMBER-FOUND-N              VALUE 'N'.      01160000
011700                                                                  01170000
011800 01  PC-CONSTANTS.                                                01180000
011900     05  PC-NOT-FOUND                PIC S9(04)    VALUE +100.    01190000
012000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01200000
012100                                     'SAKRP102'.                  01210000
012200     05  PC-REPORT-NBR-1             PIC 9(1)      VALUE 1.       01220000
012300                                                                  01230000
012400 01  PV-MISC-FIELDS.                                              01240000
012500     05  PV-LINE-SPACING             PIC  9        VALUE 1.       01250000
012600     05  PV-LINE-CNT                 PIC  9(03)    VALUE ZERO.    01260000
283520     05  PV-CSV-LINE-CNT             PIC  9(05)    VALUE ZERO.    01261051
012700     05  PV-TOTAL-LINES              PIC  9(05)    VALUE ZERO.    01270000
012800     05  PV-PAGE-CNT                 PIC  9(04)    VALUE ZERO.    01280000
012900     05  PV-PRINT-RECORD             PIC  X(150)   VALUE SPACE.   01290000
013000     05  PV-LINE-SEQ-NBR             PIC  9(03)    VALUE ZERO.    01300000
013100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01310000
013200     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01320000
013300     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01330000
013400     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01340000
013500     05  PV-SUBTOTAL                 PIC  9(7).99- VALUE ZERO.    01350000
013600     05  PV-TX-AMT                   PIC S9(7)V99  VALUE ZERO.    01360000
013700     05  PV-EMP-DISC-AMT             PIC S9(7)V99  VALUE ZERO.    01370000
013800     05  PV-TEPSHP-SHIP-CHRG-AMT     PIC S9(7)V99  VALUE ZERO     01380000
013900                                                   COMP-3.        01390000
014000     05  PV-KOHLS-CASH-U             PIC S9(7)V99  VALUE ZERO     01400000
014100                                                   COMP-3.        01410000
014200     05  PV-KOHLS-CASH-E             PIC S9(7)V99  VALUE ZERO     01420000
014300                                                   COMP-3.        01430000
014400     05  PV-OTHER-AMT                PIC S9(7)V99  VALUE ZERO     01440010
014500                                                   COMP-3.        01450010
014600     05  PV-TEPSHP-TX-AMT            PIC S9(7)V99  VALUE ZERO     01460000
014700                                                   COMP-3.        01470000
014800     05  PV-GIFT-SALE                PIC S9(7)V99  VALUE ZERO.    01480000
014900     05  PV-GIFT-RTN                 PIC S9(7)V99  VALUE ZERO.    01490000
015000     05  PV-RTN-DISC                 PIC S9(7)V99  VALUE ZERO.    01500000
015100     05  PV-SALE-DISC                PIC S9(7)V99  VALUE ZERO.    01510000
015200     05  PV-DISC                     PIC S9(7)V99  VALUE ZERO.    01520000
015300     05  PV-TOTAL-DISCOUNT           PIC S9(7)V99  VALUE ZERO.    01530010
015400     05  PV-SHP-RTN-AMT              PIC S9(7)V99  VALUE ZERO.    01540000
015500     05  PV-SHP-RTN-TX-AMT           PIC S9(7)V99  VALUE ZERO.    01550000
015600                                                                  01560000
015700     05  PV-SUM-TOTAL                PIC S9(7)V99  VALUE ZERO     01570000
015800                                                   COMP-3.        01580000
283520     05  PV-DET-TOTAL-AMT            PIC S9(7)V99  VALUE ZERO.    01581051
015900     05  PV-HOLD-STR-NBR             PIC  9(04)    VALUE ZERO.    01590000
016000     05  PV-HOLD-PARTN-NBR           PIC  9(04)    VALUE ZERO.    01600000
016100     05  PV-HOLD-TRN-TYP-CDE         PIC  X(02)    VALUE SPACES.  01610000
016200     05  PV-SLS-DTE.                                              01620013
016300         10  PV-SLS-CC               PIC  X(02)    VALUE SPACES.  01630023
016400         10  PV-SLS-YEAR             PIC  X(02)    VALUE SPACES.  01640023
016500         10  FILLER                  PIC  X(01)    VALUE SPACES.  01650023
016600         10  PV-SLS-MONTH            PIC  X(02)    VALUE SPACES.  01660023
016700         10  FILLER                  PIC  X(01)    VALUE SPACES.  01670023
016800         10  PV-SLS-DAY              PIC  X(02)    VALUE SPACES.  01680023
016900     05  PV-TRN-DTE.                                              01690023
017000         10  PV-MONTH                PIC  X(02)    VALUE SPACES.  01700013
017100         10  FILLER                  PIC  X(01)    VALUE '/'.     01710013
017200         10  PV-DAY                  PIC  X(02)    VALUE SPACES.  01720013
017300         10  FILLER                  PIC  X(01)    VALUE '/'.     01730013
017400         10  PV-YEAR                 PIC  X(02)    VALUE SPACES.  01740023
017500                                                                  01750000
017600     05  PV-BEG-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01760000
017700     05  FILLER REDEFINES PV-BEG-CCYY-MM-DD.                      01770000
017800         10  PV-BEG-CCYY             PIC  X(04).                  01780000
017900         10  FILLER                  PIC  X(01).                  01790000
018000         10  PV-BEG-MM               PIC  X(02).                  01800000
018100         10  FILLER                  PIC  X(01).                  01810000
018200         10  PV-BEG-DD               PIC  X(02).                  01820000
018300     05  PV-END-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01830000
018400     05  FILLER REDEFINES PV-END-CCYY-MM-DD.                      01840000
018500         10  PV-END-CCYY             PIC  X(04).                  01850000
018600         10  FILLER                  PIC  X(01).                  01860000
018700         10  PV-END-MM               PIC  X(02).                  01870000
018800         10  FILLER                  PIC  X(01).                  01880000
018900         10  PV-END-DD               PIC  X(02).                  01890000
019000     05  PV-SALES-DATE.                                           01900000
019100         10  PV-SALES-MM             PIC  X(02)   VALUE SPACE.    01910000
019200         10  FILLER                  PIC  X(01)    VALUE '/'.     01920000
019300         10  PV-SALES-DD             PIC  X(02)    VALUE SPACE.   01930000
019400         10  FILLER                  PIC  X(01)    VALUE '/'.     01940000
019500         10  PV-SALES-CCYY           PIC  X(04)    VALUE SPACE.   01950000
019600     05  PV-CURR-DATE-CCYYMMDD.                                   01960000
019700         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01970000
019800         10  PV-CURR-DATE-MM         PIC  9(02).                  01980000
019900         10  PV-CURR-DATE-DD         PIC  9(02).                  01990000
020000     05  PV-CURR-TIME.                                            02000000
020100         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    02010000
020200         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    02020000
020300         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    02030000
020400                                                                  02040000
020500******************************************************************02050000
020600*  TOP OF PAGE HEADING LINE FOR PRINTING A 150 CHARACTER REPORT.  02060000
020700******************************************************************02070000
020800     COPY DPWS150.                                                02080000
020900                                                                  02090000
021000******************************************************************02100000
021100*  HEADING LINES FOR THE MARKETPLACE REPORT.                      02110000
021200******************************************************************02120000
021300 01  H1-HEADING-LINE-1.                                           02130000
021400     05  FILLER                      PIC  X(48)    VALUE SPACE.   02140000
021500     05  FILLER                      PIC  X(12)    VALUE          02150000
021600                                          'MARKETPLACE '.         02160000
021700     05  FILLER                      PIC  X(07)    VALUE          02170000
021800                                          'REPORT '.              02180000
021900     05  FILLER                      PIC  X(04)    VALUE 'FOR '.  02190000
022000     05  FILLER                      PIC  X(6)     VALUE          02200000
022100                                          'SALES '.               02210000
022200     05  H1-BEGIN-DATE.                                           02220000
022300         10  H1-BEG-MM               PIC  X(02)    VALUE SPACE.   02230000
022400         10  FILLER                  PIC  X(01)    VALUE '/'.     02240000
022500         10  H1-BEG-DD               PIC  X(02)    VALUE SPACE.   02250000
022600         10  FILLER                  PIC  X(01)    VALUE '/'.     02260000
022700         10  H1-BEG-CCYY             PIC  X(04)    VALUE SPACE.   02270000
022800     05  FILLER                      PIC  X(06)    VALUE ' THRU '.02280000
022900     05  H1-END-DATE.                                             02290000
023000         10  H1-END-MM               PIC  X(02)    VALUE SPACE.   02300000
023100         10  FILLER                  PIC  X(01)    VALUE '/'.     02310000
023200         10  H1-END-DD               PIC  X(02)    VALUE SPACE.   02320000
023300         10  FILLER                  PIC  X(01)    VALUE '/'.     02330000
023400         10  H1-END-CCYY             PIC  X(04)    VALUE SPACE.   02340000
023500     05  FILLER                      PIC  X(12)    VALUE SPACE.   02350000
023600                                                                  02360000
023700 01  H2-HEADING-LINE-2.                                           02370000
023800     05  FILLER                      PIC  X(2)     VALUE SPACES.  02380026
023900     05  FILLER                      PIC  X(7)     VALUE          02390023
024000                                                       'TRAN DT'. 02400023
024100     05  FILLER                      PIC  X(2)     VALUE SPACES.  02410027
024200     05  FILLER                      PIC  X(5)     VALUE          02420013
024300                                                        'STORE'.  02430013
024400     05  FILLER                      PIC  X(2)     VALUE SPACES.  02440017
024500     05  FILLER                      PIC  X(4)     VALUE 'RGST'.  02450000
024600     05  FILLER                      PIC  X(2)     VALUE SPACES.  02460000
024700     05  FILLER                      PIC  X(4)     VALUE 'TRAN'.  02470000
024800     05  FILLER                      PIC  X(2)     VALUE SPACES.  02480000
024900     05  FILLER                      PIC  X(4)     VALUE ' SEQ'.  02490010
025000     05  FILLER                      PIC  X(2)     VALUE SPACES.  02500010
025100     05  FILLER                      PIC  X(3)     VALUE 'TYP'.   02510000
025200     05  FILLER                      PIC  X(4)     VALUE SPACES.  02520000
025300     05  FILLER                      PIC  X(6)     VALUE 'ORDER '.02530000
025400     05  FILLER                      PIC  X(5)     VALUE SPACES.  02540022
025500     05  FILLER                      PIC  X(3)     VALUE 'SKU'.   02550018
025600     05  FILLER                      PIC  X(5)     VALUE SPACES.  02560027
025700     05  FILLER                      PIC  X(3)     VALUE 'QTY'.   02570000
025800     05  FILLER                      PIC  X(3)     VALUE SPACES.  02580024
025900     05  FILLER                      PIC  X(5)     VALUE 'PRICE'. 02590013
026000     05  FILLER                      PIC  X(2)     VALUE SPACES.  02600019
026100     05  FILLER                      PIC  X(8)     VALUE          02610010
026200                                          'TOT DISC'.             02620010
026300     05  FILLER                      PIC  X(3)     VALUE SPACES.  02630010
026400     05  FILLER                      PIC  X(5)     VALUE          02640010
026500                                          'OTHER'.                02650010
026600     05  FILLER                      PIC  X(2)     VALUE SPACES.  02660019
026700     05  FILLER                      PIC  X(7)     VALUE          02670010
026800                                          'KC USED'.              02680010
026900     05  FILLER                      PIC  X(3)     VALUE SPACES.  02690010
027000     05  FILLER                      PIC  X(7)     VALUE          02700010
027100                                          'KC EARN'.              02710010
027200     05  FILLER                      PIC  X(2)     VALUE SPACES.  02720019
027300     05  FILLER                      PIC  X(6) VALUE 'ASCDSC'.    02730000
027400     05  FILLER                      PIC  X(2)     VALUE SPACES.  02740000
027500     05  FILLER                      PIC  X(2)     VALUE SPACES.  02750000
027600     05  FILLER                      PIC  X(7)     VALUE          02760000
027700                                          'NET AMT'.              02770000
027800     05  FILLER                      PIC  X(2)    VALUE SPACES.   02780019
027900     05  FILLER                      PIC  X(6)     VALUE          02790000
028000                                          'TX AMT'.               02800000
028100     05  FILLER                      PIC  X(2)     VALUE SPACES.  02810024
028200     05  FILLER                      PIC  X(9)     VALUE          02820000
028300                                          'TOTAL AMT'.            02830000
028400                                                                  02840000
028500******************************************************************02850000
028600*  DETAIL LINE.                                                   02860000
028700******************************************************************02870000
028800 01  D1-DETAIL-LINE-1.                                            02880000
028900     05  FILLER                      PIC  XX       VALUE SPACES.  02890026
029000     05  D1-TRN-DTE                  PIC  X(8)     VALUE ZERO.    02900013
029100     05  FILLER                      PIC  XX       VALUE SPACES.  02910027
029200     05  D1-STR-NBR                  PIC  9(4)     VALUE ZERO.    02920013
029300     05  FILLER                      PIC  XX       VALUE SPACES.  02930013
029400     05  D1-RGST-ID                  PIC  9(4)     VALUE ZERO.    02940000
029500     05  FILLER                      PIC  XX       VALUE SPACES.  02950000
029600     05  D1-TRN-NBR                  PIC  9(4)     VALUE ZERO.    02960000
029700     05  FILLER                      PIC  XX       VALUE SPACES.  02970000
029800     05  D1-SEQ-NBR                  PIC  X(5)     VALUE SPACES.  02980010
029900     05  FILLER                      PIC  XX       VALUE SPACES.  02990010
030000     05  D1-TRN-TYP-CDE              PIC  XX       VALUE SPACES.  03000000
030100     05  FILLER                      PIC  X        VALUE SPACES.  03010000
030200     05  D1-ORD-NBR                  PIC  X(10)    VALUE SPACES.  03020000
030300     05  FILLER                      PIC  X(2)     VALUE SPACES.  03030022
030400     05  D1-SKU                      PIC  9(8)     VALUE ZERO.    03040013
030500     05  FILLER                      PIC  X(2)     VALUE SPACES.  03050027
030600     05  D1-SLD-QTY                  PIC  ZZZ-     VALUE ZERO.    03060000
283520*    05  FILLER                      PIC  X(1)     VALUE SPACES.  03070052
283520     05  D1-LIST-PRICE               PIC ZZZZ.99-  VALUE ZERO.    03080052
030900     05  FILLER                      PIC  X(1)     VALUE SPACES.  03090013
031000     05  D1-TOT-DISC                 PIC ZZZZZ.99- VALUE ZERO.    03100010
031100     05  D1-OTHER                    PIC  ZZZZ.99- VALUE ZERO.    03110010
031200     05  D1-KOHLS-CASH-USED          PIC  ZZZZ.99- VALUE ZERO.    03120010
031300     05  FILLER                      PIC  X(2)     VALUE SPACES.  03130010
031400     05  D1-KOHLS-CASH-EARN          PIC  ZZZZ.99- VALUE ZERO.    03140010
031500     05  FILLER                      PIC  X(1)     VALUE SPACES.  03150025
031600     05  D1-ASSOC-DSC                PIC  ZZZ.99-  VALUE ZERO.    03160000
031700     05  FILLER                      PIC  X(3)     VALUE SPACES.  03170025
031800     05  D1-NET-CHRGD-AMT            PIC  ZZZZZ.99- VALUE ZERO.   03180000
031900     05  D1-TX-AMT                   PIC  ZZZZ.99-  VALUE ZERO.   03190000
032000     05  FILLER                      PIC  X(2)     VALUE SPACES.  03200024
032100     05  D1-TOTAL-AMT                PIC  ZZZZZ.99- VALUE ZERO.   03210000
032200                                                                  03220000
032300******************************************************************03230000
032400*  BLANK LINE.                                                    03240000
032500******************************************************************03250000
032600 01  D4-BLANK-LINE.                                               03260000
032700     05  FILLER                      PIC  X(150)   VALUE SPACES.  03270000
032800                                                                  03280000
283520******************************************************************03282052
283520* RECORD LAYOUT FOR OUTPUT SALES CSV FILE.                        03283052
283520******************************************************************03284052
283520 01  SA-CSV-HEADER-RECORD.                                        03285052
283520     05  SA-HDR-TRAN-DATE            PIC  X(7)  VALUE 'TRAN DT'.  03285152
283520     05  FILLER                      PIC  X     VALUE ','.        03285352
283520     05  SA-HDR-STORE                PIC  X(5)  VALUE 'STORE'.    03285452
283520     05  FILLER                      PIC  X     VALUE ','.        03285552
283520     05  SA-HDR-RGST                 PIC  X(4)  VALUE 'RGST'.     03285752
283520     05  FILLER                      PIC  X     VALUE ','.        03285852
283520     05  SA-HDR-TRAN                 PIC  X(4)  VALUE 'TRAN'.     03286052
283520     05  FILLER                      PIC  X     VALUE ','.        03286152
283520     05  SA-HDR-SEQ                  PIC  X(3)  VALUE 'SEQ'.      03286352
283520     05  FILLER                      PIC  X     VALUE ','.        03286452
283520     05  SA-HDR-TYP                  PIC  X(3)  VALUE 'TYP'.      03286652
283520     05  FILLER                      PIC  X     VALUE ','.        03286752
283520     05  SA-HDR-ORDER                PIC  X(5)  VALUE 'ORDER'.    03286952
283520     05  FILLER                      PIC  X     VALUE ','.        03287052
283520     05  SA-HDR-SKU                  PIC  X(3)  VALUE 'SKU'.      03287252
283520     05  FILLER                      PIC  X     VALUE ','.        03287352
283520     05  SA-HDR-QTY                  PIC  X(3)  VALUE 'QTY'.      03287552
283520     05  FILLER                      PIC  X     VALUE ','.        03287652
283520     05  SA-HDR-PRICE                PIC  X(5)  VALUE 'PRICE'.    03287852
283520     05  FILLER                      PIC  X     VALUE ','.        03287952
283520     05  SA-HDR-TOT-DISC             PIC  X(8)  VALUE 'TOT DISC'. 03288152
283520     05  FILLER                      PIC  X     VALUE ','.        03288252
283520     05  SA-HDR-OTHER                PIC  X(5)  VALUE 'OTHER'.    03288452
283520     05  FILLER                      PIC  X     VALUE ','.        03288552
283520     05  SA-HDR-KC-USED              PIC  X(7)  VALUE 'KC USED'.  03288752
283520     05  FILLER                      PIC  X     VALUE ','.        03288852
283520     05  SA-HDR-KC-EARN              PIC  X(7)  VALUE 'KC EARN'.  03289052
283520     05  FILLER                      PIC  X     VALUE ','.        03289252
283520     05  SA-HDR-ASCDSC               PIC  X(6)  VALUE 'ASCDSC'.   03289452
283520     05  FILLER                      PIC  X     VALUE ','.        03289552
283520     05  SA-HDR-NET-AMT              PIC  X(7)  VALUE 'NET AMT'.  03289852
283520     05  FILLER                      PIC  X     VALUE ','.        03289952
283520     05  SA-HDR-TX-AMT               PIC  X(6)  VALUE 'TX AMT'.   03290152
283520     05  FILLER                      PIC  X     VALUE ','.        03290252
283520     05  SA-HDR-TOTAL-AMT            PIC  X(9)  VALUE 'TOTAL AMT'.03290452
283520     05  FILLER                      PIC  X     VALUE ' '.        03290552
283520                                                                  03290752
283520 01  SA-CSV-DETAIL-RECORD.                                        03290852
283520     05  SA-DTL-TRN-DTE              PIC  X(8).                   03290952
283520     05  FILLER                      PIC  X     VALUE ','.        03291052
283520     05  SA-DTL-STR-NBR              PIC  9(4).                   03291252
283520     05  FILLER                      PIC  X     VALUE ','.        03291352
283520     05  SA-DTL-RGST-ID              PIC  9(4).                   03291552
283520     05  FILLER                      PIC  X     VALUE ','.        03291652
283520     05  SA-DTL-TRN-NBR              PIC  9(4).                   03291852
283520     05  FILLER                      PIC  X     VALUE ','.        03291952
283520     05  SA-DTL-SEQ-NBR              PIC  9(4).                   03292152
283520     05  FILLER                      PIC  X     VALUE ','.        03292252
283520     05  SA-DTL-TRN-TYP-CDE          PIC  X(2).                   03292452
283520     05  FILLER                      PIC  X     VALUE ','.        03292552
283520     05  SA-DTL-ORD-NBR              PIC  X(10).                  03292752
283520     05  FILLER                      PIC  X     VALUE ','.        03292852
283520     05  SA-DTL-SKU                  PIC  9(8).                   03293052
283520     05  FILLER                      PIC  X     VALUE ','.        03293152
283520     05  SA-DTL-SLD-QTY              PIC  ---9.                   03293352
283520     05  FILLER                      PIC  X     VALUE ','.        03293553
283520     05  SA-DTL-LIST-PRICE           PIC  -----.99.               03293657
283520     05  FILLER                      PIC  X     VALUE ','.        03293852
283520     05  SA-DTL-TOT-DISC             PIC  ------.99.              03294057
283520     05  FILLER                      PIC  X     VALUE ','.        03294152
283520     05  SA-DTL-OTHER                PIC  -----.99.               03294357
283520     05  FILLER                      PIC  X     VALUE ','.        03294452
283520     05  SA-DTL-KOHLS-CASH-USED      PIC  -----.99.               03294656
283520     05  FILLER                      PIC  X     VALUE ','.        03294752
283520     05  SA-DTL-KOHLS-CASH-EARN      PIC  -----.99.               03294956
283520     05  FILLER                      PIC  X     VALUE ','.        03295052
283520     05  SA-DTL-ASSOC-DSC            PIC  ----.99.                03295256
283520     05  FILLER                      PIC  X     VALUE ','.        03295352
283520     05  SA-DTL-NET-CHRGD-AMT        PIC  ------.99.              03295557
283520     05  FILLER                      PIC  X     VALUE ','.        03295652
283520     05  SA-DTL-TX-AMT               PIC  -----.99.               03295857
283520     05  FILLER                      PIC  X     VALUE ','.        03295952
283520     05  SA-DTL-TOTAL-AMT            PIC  ------.99.              03296157
283520     05  FILLER                      PIC  X     VALUE ' '.        03296252
032800                                                                  03296345
032900******************************************************************03297000
033000*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03300000
033100******************************************************************03310000
033200     COPY DPWS004.                                                03320000
033300                                                                  03330000
033400******************************************************************03340000
033500*  DB2 COMMUNICATION AREA.                                        03350000
033600******************************************************************03360000
033700     EXEC SQL                                                     03370000
033800          INCLUDE SQLCA                                           03380000
033900     END-EXEC.                                                    03390000
034000                                                                  03400000
034100******************************************************************03410000
034200*  DB2 TABLE TEPPART - COSA-PARTITIONING TABLE                    03420000
034300******************************************************************03430000
034400     EXEC SQL                                                     03440000
034500          INCLUDE TEPPART                                         03450000
034600     END-EXEC.                                                    03460000
034700                                                                  03470000
034800******************************************************************03480000
034900*  DB2 TABLE TEPTRN - COSA-TRANSACTION TABLE                      03490000
035000******************************************************************03500000
035100     EXEC SQL                                                     03510000
035200          INCLUDE TEPTRN                                          03520000
035300     END-EXEC.                                                    03530000
035400                                                                  03540000
035500******************************************************************03550000
035600*  DB2 TABLE TEPITM - COSA-ITEM TABLE                             03560000
035700******************************************************************03570000
035800     EXEC SQL                                                     03580000
035900          INCLUDE TEPITM                                          03590000
036000     END-EXEC.                                                    03600000
036100                                                                  03610000
036200******************************************************************03620000
036300*  DB2 TABLE TEPORD - COSA-ORDER TABLE                            03630000
036400******************************************************************03640000
036500     EXEC SQL                                                     03650000
036600          INCLUDE TEPORD                                          03660000
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900******************************************************************03690000
037000*  DB2 TABLE TEPLID - COSA-LINE ITEM DISCOUNT                     03700000
037100******************************************************************03710000
037200     EXEC SQL                                                     03720000
037300          INCLUDE TEPLID                                          03730000
037400     END-EXEC.                                                    03740000
037500                                                                  03750000
037600******************************************************************03760000
037700*  DB2 TABLE TEPEID - EMPLOYEE ITEM DISCOUNT                      03770000
037800******************************************************************03780000
037900     EXEC SQL                                                     03790000
038000          INCLUDE TEPEID                                          03800000
038100     END-EXEC.                                                    03810000
038200                                                                  03820000
038300******************************************************************03830000
038400*  COSA SHIP TABLE                                                03840000
038500******************************************************************03850000
038600     EXEC SQL                                                     03860000
038700         INCLUDE TEPSHP                                           03870000
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
039000******************************************************************03900000
039100*  COSA ITEM PLANNED SHIPMENT TABLE                               03910005
039200******************************************************************03920000
039300     EXEC SQL                                                     03930000
039400         INCLUDE TEPIPS                                           03940000
039500     END-EXEC.                                                    03950000
039600                                                                  03960000
039700******************************************************************03970000
039800*  COSA ITEM RETURN TABLE                                         03980000
039900******************************************************************03990000
040000     EXEC SQL                                                     04000000
040100         INCLUDE TEPIRT                                           04010000
040200     END-EXEC.                                                    04020000
040300                                                                  04030000
040400******************************************************************04040000
040500*  DB2 TABLE XST_LOC - STORE INFORMATION TABLE.                   04050000
040600*      WILL USE TO IDENTIFY E-STORE(S)                            04060000
040700******************************************************************04070000
040800     EXEC SQL                                                     04080000
040900          INCLUDE XST00001                                        04090000
041000     END-EXEC.                                                    04100000
041100                                                                  04110000
041200******************************************************************04120000
041300*  ITEM 3URSOR (CURSOR TO PRODUCE THE REPORT)                     04130015
041400******************************************************************04140000
041500     EXEC SQL                                                     04150000
041600       DECLARE ITEM-CURSOR CURSOR FOR                             04160000
041700            SELECT A.SLS_DTE                                      04170013
041800                 , C.PARTN_NBR                                    04180013
041900                 , C.STR_NBR                                      04190000
042000                 , C.RGST_ID                                      04200000
042100                 , C.TRN_NBR                                      04210000
042200                 , C.STRT_TM                                      04220000
042300                 , C.SLS_CORR_SEQ_NBR                             04230000
042400                 , C.LNE_ITM_SEQ_NBR                              04240000
042500                 , C.DEPT_NBR                                     04250000
042600                 , C.SLD_QTY                                      04260000
042700                 , C.CUST_CHRGD_AMT                               04270013
042800                 , C.NET_CHRGD_AMT                                04280000
042900                 , C.SKU_NBR                                      04290016
043000                 , C.TX_AMT                                       04300000
043100                 , B.TRN_TYP_CDE                                  04310000
043200                 , B.TRN_STAT_CDE                                 04320000
043300             FROM TEPPART A                                       04330000
043400                , TEPTRN  B                                       04340000
043500                , TEPITM  C                                       04350000
043600                , XST_LOC D                                       04360000
043700            WHERE A.PARTN_NBR        = B.PARTN_NBR                04370000
043800              AND A.PARTN_NBR        = C.PARTN_NBR                04380000
043900              AND B.STR_NBR          = D.LOC_NBR                  04390000
044000              AND B.STR_NBR          = C.STR_NBR                  04400000
044100              AND B.RGST_ID          = C.RGST_ID                  04410000
044200              AND B.TRN_NBR          = C.TRN_NBR                  04420000
044300              AND B.STRT_TM          = C.STRT_TM                  04430000
044400              AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR         04440000
044500              AND A.SLS_DTE BETWEEN :CC-BEGIN-DATE                04450000
044600                                AND :CC-END-DATE                  04460000
044700              AND A.DB_STRUC_CDE     = 'O'                        04470000
044800              AND B.VOID_ABRT_CDE   IN ('N', 'U')                 04480000
044900              AND B.TRN_STAT_CDE    IN ('V', 'Z', 'R', 'L')       04490000
045000              AND B.TRN_TYP_CDE     IN ('01', '02', '11', '12',   04500059
TRNT21                                        '21', '24', '25')         04500173
045100              AND C.DEPT_NBR         =  '985'                     04510000
045200              AND C.LIV_RSLU_CDE     IN ('+', '-')                04520000
045300          ORDER BY C.STR_NBR                                      04530012
045400                 , C.RGST_ID                                      04540012
045500                 , C.TRN_NBR                                      04550012
045600                 , C.LNE_ITM_SEQ_NBR                              04560012
045700                 , B.TRN_TYP_CDE                                  04570012
045800          WITH UR                                                 04580000
045900     END-EXEC.                                                    04590000
046000                                                                  04600000
046100******************************************************************04610000
046200*   LINE ITEM DISCOUNT CURSOR                                     04620000
046300******************************************************************04630000
046400     EXEC SQL                                                     04640000
046500       DECLARE LID-CURSOR CURSOR FOR                              04650000
046600         SELECT B.PARTN_NBR                                       04660000
046700              , B.STR_NBR                                         04670000
046800              , B.RGST_ID                                         04680000
046900              , B.TRN_NBR                                         04690000
047000              , B.STRT_TM                                         04700000
047100              , B.SLS_CORR_SEQ_NBR                                04710000
047200              , B.LNE_ITM_SEQ_NBR                                 04720000
047300              , B.LID_SEQ_NBR                                     04730000
047400              , B.LID_TYP_CDE                                     04740000
047500              , B.LID_RSN_CDE                                     04750000
047600              , B.LID_AMT                                         04760000
047700         FROM TEPLID  B                                           04770000
047800         WHERE B.PARTN_NBR        = :EPITM-PARTN-NBR              04780000
047900           AND B.STR_NBR          = :EPITM-STR-NBR                04790000
048000           AND B.RGST_ID          = :EPITM-RGST-ID                04800000
048100           AND B.TRN_NBR          = :EPITM-TRN-NBR                04810000
048200           AND B.STRT_TM          = :EPITM-STRT-TM                04820000
048300           AND B.SLS_CORR_SEQ_NBR = :EPITM-SLS-CORR-SEQ-NBR       04830000
048400           AND B.LNE_ITM_SEQ_NBR  = :EPITM-LNE-ITM-SEQ-NBR        04840000
048500         ORDER BY B.PARTN_NBR                                     04850006
048600                , B.STR_NBR                                       04860006
048700                , B.RGST_ID                                       04870006
048800                , B.TRN_NBR                                       04880006
048900                , B.STRT_TM                                       04890006
049000                , B.SLS_CORR_SEQ_NBR                              04900006
049100                , B.LNE_ITM_SEQ_NBR                               04910006
049200                , B.LID_SEQ_NBR                                   04920006
049300                , B.LID_TYP_CDE                                   04930006
049400        WITH UR                                                   04940000
049500     END-EXEC.                                                    04950000
049600                                                                  04960000
049700******************************************************************04970000
049800*   EMPLOYEE DISCOUNT CURSOR                                      04980000
049900******************************************************************04990000
050000     EXEC SQL                                                     05000000
050100       DECLARE EID-CURSOR CURSOR FOR                              05010000
050200         SELECT EID.EMP_DISC_AMT                                  05020000
050300              , EID.EMP_DISC_CTG_CDE                              05030000
050400         FROM TEPEID EID                                          05040000
050500            , TEPITM ITM                                          05050000
050600         WHERE EID.PARTN_NBR         =:EPITM-PARTN-NBR            05060000
050700           AND EID.STR_NBR           =:EPITM-STR-NBR              05070000
050800           AND EID.RGST_ID           =:EPITM-RGST-ID              05080000
050900           AND EID.TRN_NBR           =:EPITM-TRN-NBR              05090000
051000           AND EID.STRT_TM           =:EPITM-STRT-TM              05100000
051100           AND EID.SLS_CORR_SEQ_NBR  =:EPITM-SLS-CORR-SEQ-NBR     05110000
051200           AND EID.LNE_ITM_SEQ_NBR   =:EPITM-LNE-ITM-SEQ-NBR      05120000
051300          WITH UR                                                 05130000
051400     END-EXEC.                                                    05140000
051500                                                                  05150000
051600***************************************************************** 05160000
051700 PROCEDURE DIVISION.                                              05170000
051800******************************************************************05180000
051900 0000-MAINLINE-PARAGRAPH.                                         05190000
052000                                                                  05200000
052100     PERFORM 1000-PROCESS-CONTROL-CARD.                           05210000
052200                                                                  05220000
052300     PERFORM 3000-OPEN-ITEM.                                      05230000
052400                                                                  05240000
052500     PERFORM 3200-FETCH-ITEM.                                     05250000
052600                                                                  05260000
052700     PERFORM 3300-PROCESS-ITEM                                    05270000
052800        UNTIL PS-END-OF-ITEM-YES.                                 05280000
052900                                                                  05290000
053000     PERFORM 3700-CLOSE-ITEM.                                     05300000
053100                                                                  05310000
053200     CLOSE POS-DATE-CARD-FILE                                     05320000
283520           SALES-CSV-FILE                                         05321052
053300           SALES-REPORT-FILE.                                     05330000
283520                                                                  05340052
283520     DISPLAY 'SAKRP102 CSV OUTPUT RECORDS INCLUDING HEADER = '    05340151
283520           PV-CSV-LINE-CNT.                                       05341051
053400                                                                  05342038
053500     STOP RUN.                                                    05350000
053600                                                                  05360000
053700******************************************************************05370000
053800*     OPEN FILES. READ CONTROL CARD TO GET POS DATE IN MMDDYY     05380000
053900*     FORMAT. CALL DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD   05390000
054000*     PROCESS DATE.                                               05400000
054100******************************************************************05410000
054200                                                                  05420000
054300 1000-PROCESS-CONTROL-CARD.                                       05430000
054400                                                                  05440000
054500     OPEN INPUT  POS-DATE-CARD-FILE                               05450000
054600          OUTPUT SALES-REPORT-FILE                                05460040
283520                 SALES-CSV-FILE.                                  05461052
054700                                                                  05470000
054800     READ POS-DATE-CARD-FILE INTO DATE-CONTROL-CARD               05480000
054900        AT END                                                    05490000
055000           SET PS-END-OF-CARD-FILE-YES TO TRUE.                   05500000
055100                                                                  05510000
055200     IF PS-END-OF-CARD-FILE-YES                                   05520000
055300         MOVE '1000-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05530000
055400         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05540000
055500         SET AC-CONTROL-CARD-ERROR TO TRUE                        05550000
055600         PERFORM 9999-ABEND                                       05560000
055700     END-IF.                                                      05570000
055800                                                                  05580000
055900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05590000
056000     MOVE CC-WEEK-ENDING-DATE-ISO                                 05600000
056100                           TO DPG52-LK-DATE-INPUT.                05610000
056200     SET DPG52-LK-DTE-ISO-FMT  TO TRUE.                           05620000
056300     SET DPG51-FISCAL-454-CALENDAR                                05630000
056400                               TO TRUE.                           05640000
056500     SET DPG51-DO-NOT-INCR-DECR-DATE                              05650000
056600                               TO TRUE.                           05660000
056700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          05670000
056800                                             DPG53 DPG54          05680000
056900                                             DPG55 DPG56.         05690000
057000     EVALUATE TRUE                                                05700000
057100         WHEN DPG54-NO-ERROR                                      05710000
057200             CONTINUE                                             05720000
057300         WHEN DPG54-SEVERE-ERROR                                  05730000
057400         WHEN DPG54-WARNING-ERROR                                 05740000
057500             DISPLAY '** ABEND **'                                05750000
057600             DISPLAY '** PROGRAM   ** = SAKRP102'                 05760000
057700             DISPLAY '** PARAGRAPH ** = 1000-PROCESS-CONTROL-CARD'05770000
057800             DISPLAY 'BAD INPUT DATE: '                           05780000
057900                            CC-WEEK-ENDING-DATE-ISO               05790000
058000             DISPLAY DPG54-ERROR-MESSAGE                          05800000
058100             SET AC-CONTROL-CARD-ERROR TO TRUE                    05810000
058200             CALL 'ILBOABN0' USING AC-ABEND-CODE                  05820000
058300     END-EVALUATE.                                                05830000
058400                                                                  05840000
058500     IF DPG55-ALPHA-WEEK-DAY-SATURDAY                             05850000
058600         CONTINUE                                                 05860000
058700     ELSE                                                         05870000
058800         DISPLAY '** ABEND **'                                    05880000
058900         DISPLAY '** PROGRAM   ** = SAKRP100'                     05890000
059000         DISPLAY '** PARAGRAPH ** = 1000-PROCESS-CONTROL-CARD'    05900000
059100         DISPLAY 'BAD INPUT DATE: '                               05910000
059200                            CC-WEEK-ENDING-DATE-ISO               05920000
059300         DISPLAY 'INPUT DATE IS NOT A WEEK ENDING DATE'           05930000
059400         SET AC-CONTROL-CARD-ERROR TO TRUE                        05940000
059500         CALL 'ILBOABN0' USING AC-ABEND-CODE                      05950000
059600     END-IF.                                                      05960000
059700                                                                  05970000
059800     MOVE CC-WEEK-ENDING-DATE-ISO   TO CC-END-DATE.               05980000
059900     MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO CC-BEGIN-DATE.             05990000
060000                                                                  06000000
060100     DISPLAY PC-CURRENT-PROGRAM-NAME                              06010000
060200             ' - CALENDAR = (' CC-CONTROL-CARD-DISPLAY  ')'.      06020000
060300                                                                  06030000
060400     DISPLAY PC-CURRENT-PROGRAM-NAME                              06040000
060500             ' - DATE CONTROL CARD = (' DATE-CONTROL-CARD ')'.    06050000
060600                                                                  06060000
283520     WRITE SALES-CSV-RECORD                                       06060151
283520         FROM SA-CSV-HEADER-RECORD.                               06060251
283520     ADD +1 TO PV-CSV-LINE-CNT.                                   06064051
060800                                                                  06066039
060700     PERFORM 1200-FORMAT-HEADINGS.                                06070000
060800                                                                  06080000
060900     PERFORM 8000-PRINT-HEADINGS.                                 06090000
061000                                                                  06100000
061100******************************************************************06110000
061200*     GET CURRENT DATE AND TIME FROM SYSTEM.                      06120000
061300*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          06130000
061400*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              06140000
061500******************************************************************06150000
061600                                                                  06160000
061700 1200-FORMAT-HEADINGS.                                            06170000
061800                                                                  06180000
061900     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   06190000
062000     ACCEPT PV-CURR-TIME FROM TIME.                               06200000
062100                                                                  06210000
062200     MOVE PV-CURR-DATE-MM             TO DP150-RUN-MONTH.         06220000
062300     MOVE PV-CURR-DATE-DD             TO DP150-RUN-DAY.           06230000
062400     MOVE PV-CURR-DATE-CCYY           TO DP150-RUN-YEAR.          06240000
062500                                                                  06250000
062600     MOVE PV-CURR-TIME-HH             TO DP150-RUN-HOUR.          06260000
062700     MOVE PV-CURR-TIME-MM             TO DP150-RUN-MINUTE.        06270000
062800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP150-PROGRAM-NAME.      06280000
062900     MOVE PC-REPORT-NBR-1             TO DP150-REPORT-NUMBER.     06290000
063000                                                                  06300000
063100     MOVE CC-BEGIN-DATE               TO PV-BEG-CCYY-MM-DD.       06310000
063200     MOVE CC-END-DATE                 TO PV-END-CCYY-MM-DD.       06320000
063300     MOVE PV-BEG-CCYY                 TO H1-BEG-CCYY.             06330000
063400     MOVE PV-BEG-MM                   TO H1-BEG-MM.               06340000
063500     MOVE PV-BEG-DD                   TO H1-BEG-DD.               06350000
063600     MOVE PV-END-CCYY                 TO H1-END-CCYY.             06360000
063700     MOVE PV-END-MM                   TO H1-END-MM.               06370000
063800     MOVE PV-END-DD                   TO H1-END-DD.               06380000
063900                                                                  06390000
064000******************************************************************06400000
064100* OPEN ITEM CURSOR                                                06410000
064200******************************************************************06420000
064300                                                                  06430000
064400 3000-OPEN-ITEM.                                                  06440000
064500                                                                  06450000
064600     EXEC SQL                                                     06460000
064700          OPEN ITEM-CURSOR                                        06470000
064800     END-EXEC.                                                    06480000
064900                                                                  06490000
065000     IF NOT SQLCODE = ZERO                                        06500000
065100        MOVE SQLCODE                 TO PV-DB2-OPERATION          06510000
065200        PERFORM 9800-SQL-ABEND                                    06520000
065300     END-IF.                                                      06530000
065400                                                                  06540000
065500******************************************************************06550000
065600* FETCH ITEM CURSOR                                               06560000
065700******************************************************************06570000
065800                                                                  06580000
065900 3200-FETCH-ITEM.                                                 06590000
066000                                                                  06600000
066100     EXEC SQL                                                     06610000
066200          FETCH ITEM-CURSOR                                       06620000
066300           INTO :EPPART-SLS-DTE                                   06630013
066400              , :EPITM-PARTN-NBR                                  06640013
066500              , :EPITM-STR-NBR                                    06650000
066600              , :EPITM-RGST-ID                                    06660000
066700              , :EPITM-TRN-NBR                                    06670000
066800              , :EPITM-STRT-TM                                    06680000
066900              , :EPITM-SLS-CORR-SEQ-NBR                           06690000
067000              , :EPITM-LNE-ITM-SEQ-NBR                            06700000
067100              , :EPITM-DEPT-NBR                                   06710000
067200              , :EPITM-SLD-QTY                                    06720000
067300              , :EPITM-CUST-CHRGD-AMT                             06730013
067400              , :EPITM-NET-CHRGD-AMT                              06740000
067500              , :EPITM-SKU-NBR                                    06750014
067600              , :EPITM-TX-AMT                                     06760000
067700              , :EPTRN-TRN-TYP-CDE                                06770000
067800              , :EPTRN-TRN-STAT-CDE                               06780000
067900     END-EXEC.                                                    06790000
068000                                                                  06800000
068100     EVALUATE TRUE                                                06810000
068200        WHEN SQLCODE = ZERO                                       06820000
068300             CONTINUE                                             06830000
068400        WHEN SQLCODE = PC-NOT-FOUND                               06840000
068500             SET PS-END-OF-ITEM-YES          TO TRUE              06850000
068600        WHEN OTHER                                                06860000
068700             MOVE '3200-FETCH-ITEM'          TO PV-PARAGRAPH-NAME 06870000
068800             MOVE SQLCODE                    TO PV-DB2-OPERATION  06880000
068900             PERFORM 9800-SQL-ABEND                               06890000
069000     END-EVALUATE.                                                06900000
069100                                                                  06910000
069200     IF PS-FIRST-TIME                                             06920000
069300         MOVE EPITM-PARTN-NBR     TO PV-HOLD-PARTN-NBR            06930000
069400         MOVE EPITM-STR-NBR       TO PV-HOLD-STR-NBR              06940000
069500         MOVE EPTRN-TRN-TYP-CDE   TO PV-HOLD-TRN-TYP-CDE          06950000
069600         MOVE 'N' TO PS-FIRST-TIME-SW                             06960000
069700         MOVE ZERO                TO D1-KOHLS-CASH-USED           06970000
069800                                     D1-KOHLS-CASH-EARN           06980000
069900                                     D1-OTHER                     06990000
070000                                     D1-ASSOC-DSC                 07000000
070100                                     D1-TOT-DISC                  07010010
283520                                     SA-DTL-KOHLS-CASH-USED       07011051
283520                                     SA-DTL-KOHLS-CASH-EARN       07012051
283520                                     SA-DTL-OTHER                 07013051
283520                                     SA-DTL-ASSOC-DSC             07014051
283520                                     SA-DTL-TOT-DISC              07015051
070200                                     PV-KOHLS-CASH-U              07020010
070300                                     PV-KOHLS-CASH-E              07030010
070400                                     PV-OTHER-AMT                 07040010
070500                                     PV-TOTAL-DISCOUNT            07050010
070600     END-IF.                                                      07060000
070700                                                                  07070000
070800     IF PV-LINE-CNT > 55                                          07080000
070900         PERFORM 8000-PRINT-HEADINGS                              07090000
071000     END-IF.                                                      07100000
071100                                                                  07110000
071200******************************************************************07120000
071300* PROCESS ITEM DETAIL LINE                                        07130000
071400******************************************************************07140000
071500                                                                  07150000
071600 3300-PROCESS-ITEM.                                               07160000
071700                                                                  07170000
071800     IF EPITM-STR-NBR = PV-HOLD-STR-NBR                           07180003
071900         CONTINUE                                                 07190003
072000     ELSE                                                         07200003
072100         PERFORM 3350-DETAIL-TOTAL                                07210003
072200     END-IF.                                                      07220003
072300                                                                  07230000
072400     MOVE EPITM-PARTN-NBR        TO PV-HOLD-PARTN-NBR.            07240000
072500     MOVE EPITM-STR-NBR          TO PV-HOLD-STR-NBR.              07250000
072600     MOVE EPTRN-TRN-TYP-CDE      TO PV-HOLD-TRN-TYP-CDE.          07260000
072700                                                                  07270000
072800     MOVE EPPART-SLS-DTE         TO PV-SLS-DTE.                   07280019
072900     MOVE PV-SLS-YEAR            TO PV-YEAR.                      07290013
073000     MOVE PV-SLS-MONTH           TO PV-MONTH.                     07300013
073100     MOVE PV-SLS-DAY             TO PV-DAY.                       07310013
073200     MOVE PV-TRN-DTE             TO D1-TRN-DTE                    07320034
283520                                    SA-DTL-TRN-DTE.               07320151
073300                                                                  07330013
073400     MOVE EPITM-STR-NBR          TO D1-STR-NBR                    07340034
283520                                    SA-DTL-STR-NBR.               07341051
073500     MOVE EPITM-RGST-ID          TO D1-RGST-ID                    07350034
283520                                    SA-DTL-RGST-ID.               07351051
073600     MOVE EPITM-TRN-NBR          TO D1-TRN-NBR                    07360034
283520                                    SA-DTL-TRN-NBR.               07361051
073700     MOVE EPITM-LNE-ITM-SEQ-NBR  TO D1-SEQ-NBR                    07370034
283520                                    SA-DTL-SEQ-NBR.               07371051
073800     MOVE EPTRN-TRN-TYP-CDE      TO D1-TRN-TYP-CDE                07380034
283520                                    SA-DTL-TRN-TYP-CDE.           07381051
073900     MOVE EPITM-SKU-NBR          TO D1-SKU                        07390034
283520                                    SA-DTL-SKU.                   07391051
074000     PERFORM 4000-SELECT-ORDER-NUMBER.                            07400000
074100     IF PS-ORDER-NUMBER-FOUND-N                                   07410000
074200** CHECK IF THIS IS A RETURN TO THE STORE FROM AN ECOM ORDER      07420010
074300         PERFORM 4100-SELECT-ORIG-TRN                             07430010
074400     ELSE                                                         07440000
074500         MOVE EPORD-ORD-NBR-TEXT                                  07450000
074600                                 TO D1-ORD-NBR                    07460000
283520                                    SA-DTL-ORD-NBR                07461051
074700     END-IF.                                                      07470000
074800                                                                  07480000
074900     MOVE EPITM-SLD-QTY          TO D1-SLD-QTY                    07490034
283520                                    SA-DTL-SLD-QTY.               07491051
075000     MOVE EPITM-CUST-CHRGD-AMT   TO D1-LIST-PRICE                 07500034
283520                                    SA-DTL-LIST-PRICE.            07501051
075100                                                                  07510000
075200     MOVE EPITM-NET-CHRGD-AMT    TO D1-NET-CHRGD-AMT              07520034
283520                                    SA-DTL-NET-CHRGD-AMT.         07521051
075300     MOVE EPITM-TX-AMT           TO D1-TX-AMT                     07530034
283520                                    SA-DTL-TX-AMT.                07531051
283520     COMPUTE PV-DET-TOTAL-AMT = EPITM-NET-CHRGD-AMT               07540051
283520                              + EPITM-TX-AMT.                     07541051
075400                                                                  07542031
283520     MOVE PV-DET-TOTAL-AMT       TO D1-TOTAL-AMT                  07550051
283520                                    SA-DTL-TOTAL-AMT.             07551051
075600                                                                  07560000
075700     PERFORM 3500-OPEN-LID-CURSOR.                                07570000
075800     PERFORM 3510-FETCH-LID                                       07580000
075900           UNTIL PS-END-OF-LID-YES.                               07590000
076000                                                                  07600000
076100     MOVE PV-KOHLS-CASH-U TO D1-KOHLS-CASH-USED                   07610034
283520                             SA-DTL-KOHLS-CASH-USED.              07611051
076200     MOVE PV-KOHLS-CASH-E TO D1-KOHLS-CASH-EARN                   07620034
283520                             SA-DTL-KOHLS-CASH-EARN.              07621051
076300     MOVE PV-OTHER-AMT   TO D1-OTHER                              07630034
283520                            SA-DTL-OTHER.                         07631051
076400                                                                  07640000
076500     PERFORM 3800-CLOSE-LID-CURSOR.                               07650000
076600                                                                  07660000
076700     PERFORM 3530-OPEN-EID-CURSOR.                                07670000
076800     PERFORM 3535-FETCH-EID                                       07680000
076900           UNTIL PS-END-OF-EID-YES.                               07690000
077000                                                                  07700000
077100     MOVE PV-EMP-DISC-AMT TO D1-ASSOC-DSC                         07710034
283520                             SA-DTL-ASSOC-DSC.                    07711051
077200                                                                  07720000
077300     PERFORM 3850-CLOSE-EID-CURSOR.                               07730000
077400     MOVE PV-TOTAL-DISCOUNT TO D1-TOT-DISC                        07740034
283520                               SA-DTL-TOT-DISC.                   07741051
077500                                                                  07750000
077600     PERFORM 3600-WRITE-ITEM-REPORT.                              07760000
077700     ADD +1 TO PV-LINE-CNT                                        07770034
283520               PV-CSV-LINE-CNT.                                   07771051
077800                                                                  07780000
077900     IF PV-LINE-CNT > 55                                          07790000
078000         PERFORM 8000-PRINT-HEADINGS                              07800000
078100     END-IF.                                                      07810000
078200                                                                  07820000
078300     PERFORM 3200-FETCH-ITEM.                                     07830000
078400                                                                  07840000
078500     MOVE 'N'   TO PS-END-OF-LID-CURSOR                           07850000
078600                   PS-END-OF-EID-CURSOR.                          07860000
078700     MOVE ZERO  TO D1-OTHER                                       07870010
078800                   D1-TOT-DISC                                    07880010
078900                   D1-KOHLS-CASH-EARN                             07890010
079000                   D1-KOHLS-CASH-USED                             07900010
079100                   D1-ASSOC-DSC                                   07910000
283520                   SA-DTL-OTHER                                   07911051
283520                   SA-DTL-TOT-DISC                                07912051
283520                   SA-DTL-KOHLS-CASH-EARN                         07913051
283520                   SA-DTL-KOHLS-CASH-USED                         07914051
283520                   SA-DTL-ASSOC-DSC                               07915051
079200                   PV-TX-AMT                                      07920000
079300                   PV-TEPSHP-TX-AMT                               07930000
079400                   PV-TEPSHP-SHIP-CHRG-AMT                        07940000
079500                   PV-GIFT-SALE                                   07950000
079600                   PV-SALE-DISC                                   07960000
079700                   PV-GIFT-RTN                                    07970000
079800                   PV-RTN-DISC                                    07980000
079900                   PV-SHP-RTN-AMT                                 07990000
080000                   PV-SHP-RTN-TX-AMT                              08000000
080100                   PV-EMP-DISC-AMT                                08010000
080200                   PV-KOHLS-CASH-U                                08020010
080300                   PV-KOHLS-CASH-E                                08030010
080400                   PV-TOTAL-DISCOUNT                              08040010
080500                   PV-OTHER-AMT.                                  08050010
080600                                                                  08060000
080700******************************************************************08070000
080800* WRITE DETAIL TOTAL LINE                                         08080000
080900******************************************************************08090000
081000                                                                  08100030
081100 3350-DETAIL-TOTAL.                                               08110003
081200                                                                  08120003
081300     WRITE SALES-REPORT-RECORD FROM D4-BLANK-LINE AFTER           08130003
081400               ADVANCING 2 LINE.                                  08140003
081500     ADD +1 TO PV-LINE-CNT.                                       08150003
081600                                                                  08160003
081700     PERFORM 8000-PRINT-HEADINGS.                                 08170003
081800                                                                  08180003
081900******************************************************************08190000
082000* OPEN LID-CURSOR                                                 08200000
082100******************************************************************08210000
082200                                                                  08220000
082300 3500-OPEN-LID-CURSOR.                                            08230000
082400                                                                  08240000
082500     EXEC SQL                                                     08250000
082600          OPEN LID-CURSOR                                         08260000
082700     END-EXEC.                                                    08270000
082800                                                                  08280000
082900     IF NOT SQLCODE = ZERO                                        08290000
083000        MOVE '3500-OPEN-LID-CURSOR'  TO PV-PARAGRAPH-NAME         08300000
083100        MOVE SQLCODE                 TO PV-DB2-OPERATION          08310000
083200        PERFORM 9800-SQL-ABEND                                    08320000
083300     END-IF.                                                      08330000
083400                                                                  08340000
083500******************************************************************08350000
083600* FETCH LID CURSOR                                                08360000
083700******************************************************************08370000
083800                                                                  08380000
083900 3510-FETCH-LID.                                                  08390000
084000                                                                  08400000
084100     EXEC SQL                                                     08410000
084200          FETCH LID-CURSOR                                        08420000
084300           INTO :EPLID-PARTN-NBR                                  08430000
084400               ,:EPLID-STR-NBR                                    08440000
084500               ,:EPLID-RGST-ID                                    08450000
084600               ,:EPLID-TRN-NBR                                    08460000
084700               ,:EPLID-STRT-TM                                    08470000
084800               ,:EPLID-SLS-CORR-SEQ-NBR                           08480000
084900               ,:EPLID-LNE-ITM-SEQ-NBR                            08490000
085000               ,:EPLID-LID-SEQ-NBR                                08500000
085100               ,:EPLID-LID-TYP-CDE                                08510000
085200               ,:EPLID-LID-RSN-CDE                                08520000
085300               ,:EPLID-LID-AMT                                    08530000
085400     END-EXEC.                                                    08540000
085500                                                                  08550000
085600     EVALUATE TRUE                                                08560000
085700        WHEN SQLCODE = ZERO                                       08570000
085800            PERFORM 3520-LID-AMT                                  08580000
085900            MOVE 'N' TO PS-END-OF-LID-CURSOR                      08590000
086000        WHEN SQLCODE = -811                                       08600000
086100            PERFORM 3520-LID-AMT                                  08610000
086200            MOVE 'N' TO PS-END-OF-LID-CURSOR                      08620000
086300        WHEN SQLCODE = +100                                       08630000
086400            MOVE 'Y' TO PS-END-OF-LID-CURSOR                      08640000
086500        WHEN OTHER                                                08650000
086600            MOVE 'Y' TO PS-END-OF-LID-CURSOR                      08660000
086700     END-EVALUATE.                                                08670000
086800                                                                  08680000
086900******************************************************************08690000
087000* MOVE THE DISCOUNTS TO THE APPROPRIATE COLUMN                    08700000
087100******************************************************************08710000
087200                                                                  08720000
087300 3520-LID-AMT.                                                    08730000
087400                                                                  08740000
087500*    PRORATED DOLLAR OFF (KOHLS COUPON - KOHLSCASH USED)          08750010
087600     IF EPLID-LID-TYP-CDE = 'R' AND                               08760000
087700        EPLID-LID-RSN-CDE = '733'                                 08770000
087800           ADD  EPLID-LID-AMT   TO PV-KOHLS-CASH-U                08780000
087900                                   PV-TOTAL-DISCOUNT              08790010
088000     ELSE                                                         08800000
088100*    PRORATED DOLLAR OFF (KOHLS CASH EARNED/SPE)                  08810000
088200       IF EPLID-LID-TYP-CDE = 'R' AND                             08820000
088300          EPLID-LID-RSN-CDE = '780'                               08830000
088400           ADD  EPLID-LID-AMT   TO PV-KOHLS-CASH-E                08840000
088500                                   PV-TOTAL-DISCOUNT              08850010
088600       ELSE                                                       08860000
088700           ADD  EPLID-LID-AMT   TO PV-OTHER-AMT                   08870010
088800                                   PV-TOTAL-DISCOUNT              08880010
088900       END-IF                                                     08890000
089000     END-IF.                                                      08900010
089100                                                                  08910000
089200******************************************************************08920000
089300* OPEN EID-CURSOR                                                 08930000
089400******************************************************************08940000
089500                                                                  08950000
089600 3530-OPEN-EID-CURSOR.                                            08960000
089700                                                                  08970000
089800     EXEC SQL                                                     08980000
089900          OPEN EID-CURSOR                                         08990000
090000     END-EXEC.                                                    09000000
090100                                                                  09010000
090200     IF NOT SQLCODE = ZERO                                        09020000
090300        MOVE '3530-OPEN-EID-CURSOR'  TO PV-PARAGRAPH-NAME         09030000
090400        MOVE SQLCODE                 TO PV-DB2-OPERATION          09040000
090500        PERFORM 9800-SQL-ABEND                                    09050000
090600     END-IF.                                                      09060000
090700                                                                  09070000
090800******************************************************************09080000
090900* FETCH EID CURSOR                                                09090000
091000******************************************************************09100000
091100                                                                  09110000
091200 3535-FETCH-EID.                                                  09120000
091300                                                                  09130000
091400     EXEC SQL                                                     09140000
091500          FETCH EID-CURSOR                                        09150000
091600           INTO :EPEID-EMP-DISC-AMT                               09160000
091700              , :EPEID-EMP-DISC-CTG-CDE                           09170000
091800     END-EXEC.                                                    09180000
091900                                                                  09190000
092000     EVALUATE TRUE                                                09200000
092100        WHEN SQLCODE = ZERO                                       09210000
092200            ADD EPEID-EMP-DISC-AMT TO PV-EMP-DISC-AMT             09220000
092300                                      PV-TOTAL-DISCOUNT           09230010
092400            MOVE 'Y' TO PS-END-OF-EID-CURSOR                      09240000
092500        WHEN SQLCODE = -811                                       09250000
092600            ADD EPEID-EMP-DISC-AMT TO PV-EMP-DISC-AMT             09260000
092700                                      PV-TOTAL-DISCOUNT           09270010
092800            MOVE 'N' TO PS-END-OF-EID-CURSOR                      09280000
092900        WHEN SQLCODE = +100                                       09290000
093000            MOVE 'Y' TO PS-END-OF-EID-CURSOR                      09300000
093100        WHEN OTHER                                                09310000
093200            MOVE 'Y' TO PS-END-OF-EID-CURSOR                      09320000
093300            MOVE ZERO  TO D1-ASSOC-DSC                            09330000
283520                          SA-DTL-ASSOC-DSC                        09331051
093400     END-EVALUATE.                                                09340000
093500                                                                  09350000
093600******************************************************************09360000
093700* GET THE TX AMT FROM TEPSHP FOR MARKETPLACE ITEMS SOLD.  NEED    09370000
093800* TEPIPS TO KNOW WHICH LINE ITEM IS THE SHIPPING TAX.             09380000
093900******************************************************************09390000
094000                                                                  09400000
094100 3550-SELECT-TEPSHP-AMT.                                          09410000
094200                                                                  09420000
094300     MOVE ZERO TO PV-TEPSHP-SHIP-CHRG-AMT                         09430000
094400                  PV-TEPSHP-TX-AMT.                               09440000
094500     EXEC SQL                                                     09450000
094600        SELECT SHP.TX_AMT                                         09460000
094700             , SHP.SHIP_CHRG_AMT                                  09470000
094800        INTO :PV-TEPSHP-TX-AMT                                    09480000
094900           , :PV-TEPSHP-SHIP-CHRG-AMT                             09490000
095000        FROM TEPSHP SHP                                           09500000
095100           , TEPIPS IPS                                           09510000
095200           , TEPITM ITM                                           09520000
095300        WHERE SHP.PARTN_NBR         = :EPITM-PARTN-NBR            09530000
095400          AND SHP.STR_NBR           = :EPITM-STR-NBR              09540000
095500          AND SHP.RGST_ID           = :EPITM-RGST-ID              09550000
095600          AND SHP.TRN_NBR           = :EPITM-TRN-NBR              09560000
095700          AND SHP.STRT_TM           = :EPITM-STRT-TM              09570000
095800          AND SHP.SLS_CORR_SEQ_NBR  = :EPITM-SLS-CORR-SEQ-NBR     09580000
095900          AND ITM.LNE_ITM_SEQ_NBR   = :EPITM-LNE-ITM-SEQ-NBR      09590000
096000          AND SHP.PARTN_NBR         = IPS.PARTN_NBR               09600000
096100          AND SHP.PARTN_NBR         = ITM.PARTN_NBR               09610000
096200          AND SHP.STR_NBR           = IPS.STR_NBR                 09620000
096300          AND SHP.STR_NBR           = ITM.STR_NBR                 09630000
096400          AND SHP.RGST_ID           = IPS.RGST_ID                 09640000
096500          AND SHP.RGST_ID           = ITM.RGST_ID                 09650000
096600          AND SHP.TRN_NBR           = IPS.TRN_NBR                 09660000
096700          AND SHP.TRN_NBR           = ITM.TRN_NBR                 09670000
096800          AND SHP.STRT_TM           = IPS.STRT_TM                 09680000
096900          AND SHP.STRT_TM           = ITM.STRT_TM                 09690000
097000          AND SHP.SLS_CORR_SEQ_NBR  = IPS.SLS_CORR_SEQ_NBR        09700000
097100          AND SHP.SLS_CORR_SEQ_NBR  = ITM.SLS_CORR_SEQ_NBR        09710000
097200          AND IPS.LNE_ITM_SEQ_NBR   = ITM.LNE_ITM_SEQ_NBR         09720000
097300          AND SHP.PLND_SHIPT_NBR    = IPS.PLND_SHIPT_NBR          09730000
097400          WITH UR                                                 09740000
097500     END-EXEC.                                                    09750000
097600                                                                  09760000
097700     EVALUATE TRUE                                                09770000
097800        WHEN SQLCODE = ZERO                                       09780000
097900             CONTINUE                                             09790000
098000        WHEN SQLCODE = +100                                       09800000
098100             CONTINUE                                             09810000
098200        WHEN SQLCODE = -305                                       09820000
098300             CONTINUE                                             09830000
098400        WHEN OTHER                                                09840000
098500             MOVE '3550-SELECT-TEPSHP-AMT'   TO PV-PARAGRAPH-NAME 09850000
098600             MOVE SQLCODE                    TO PV-DB2-OPERATION  09860000
098700             PERFORM 9800-SQL-ABEND                               09870000
098800     END-EVALUATE.                                                09880000
098900                                                                  09890000
099000******************************************************************09900000
099100 3600-WRITE-ITEM-REPORT.                                          09910000
099200******************************************************************09920000
099300                                                                  09930000
099400     WRITE SALES-REPORT-RECORD FROM D1-DETAIL-LINE-1 AFTER        09940000
099500                   ADVANCING 1 LINE.                              09950000
283520     WRITE SALES-CSV-RECORD                                       09951051
283520         FROM SA-CSV-DETAIL-RECORD.                               09952051
099600                                                                  09960000
099700******************************************************************09970000
099800 3700-CLOSE-ITEM.                                                 09980000
099900******************************************************************09990000
100000                                                                  10000000
100100     EXEC SQL                                                     10010000
100200          CLOSE ITEM-CURSOR                                       10020000
100300     END-EXEC.                                                    10030000
100400                                                                  10040000
100500     IF NOT SQLCODE = ZERO                                        10050000
100600        MOVE '3700-CLOSE-ITEM'        TO PV-PARAGRAPH-NAME        10060000
100700        MOVE SQLCODE                  TO PV-DB2-OPERATION         10070000
100800        PERFORM 9800-SQL-ABEND                                    10080000
100900     END-IF.                                                      10090000
101000                                                                  10100000
101100******************************************************************10110000
101200 3800-CLOSE-LID-CURSOR.                                           10120000
101300******************************************************************10130000
101400                                                                  10140000
101500     EXEC SQL                                                     10150000
101600          CLOSE LID-CURSOR                                        10160000
101700     END-EXEC.                                                    10170000
101800                                                                  10180000
101900     IF NOT SQLCODE = ZERO                                        10190000
102000        MOVE '3800-CLOSE-LID-CURSOR'  TO PV-PARAGRAPH-NAME        10200000
102100        MOVE SQLCODE                  TO PV-DB2-OPERATION         10210000
102200        PERFORM 9800-SQL-ABEND                                    10220000
102300     END-IF.                                                      10230000
102400                                                                  10240000
102500******************************************************************10250000
102600 3850-CLOSE-EID-CURSOR.                                           10260000
102700******************************************************************10270000
102800                                                                  10280000
102900     EXEC SQL                                                     10290000
103000          CLOSE EID-CURSOR                                        10300000
103100     END-EXEC.                                                    10310000
103200                                                                  10320000
103300     IF NOT SQLCODE = ZERO                                        10330000
103400        MOVE '3850-CLOSE-EID-CURSOR'  TO PV-PARAGRAPH-NAME        10340000
103500        MOVE SQLCODE                  TO PV-DB2-OPERATION         10350000
103600        PERFORM 9800-SQL-ABEND                                    10360000
103700     END-IF.                                                      10370000
103800                                                                  10380000
103900******************************************************************10390000
104000*     CHECK IF ORDER NUMBER FOUND                                 10400000
104100******************************************************************10410000
104200 4000-SELECT-ORDER-NUMBER.                                        10420000
104300                                                                  10430000
104400     SET PS-ORDER-NUMBER-FOUND-N TO TRUE.                         10440000
104500                                                                  10450000
104600     EXEC SQL                                                     10460000
104700        SELECT  ORD_NBR                                           10470000
104800          INTO :EPORD-ORD-NBR                                     10480000
104900          FROM  TEPORD                                            10490000
105000        WHERE PARTN_NBR         = :EPITM-PARTN-NBR                10500000
105100           AND STR_NBR          = :EPITM-STR-NBR                  10510000
105200           AND RGST_ID          = :EPITM-RGST-ID                  10520000
105300           AND TRN_NBR          = :EPITM-TRN-NBR                  10530000
105400           AND STRT_TM          = :EPITM-STRT-TM                  10540000
105500           AND SLS_CORR_SEQ_NBR = :EPITM-SLS-CORR-SEQ-NBR         10550000
105600        WITH UR                                                   10560000
105700     END-EXEC.                                                    10570000
105800                                                                  10580000
105900     EVALUATE TRUE                                                10590000
106000        WHEN SQLCODE = ZERO                                       10600000
106100            SET PS-ORDER-NUMBER-FOUND-Y TO TRUE                   10610000
106200        WHEN SQLCODE = +100                                       10620000
106300            SET PS-ORDER-NUMBER-FOUND-N TO TRUE                   10630000
106400        WHEN OTHER                                                10640000
106500            MOVE '4000-SELECT-ORDER-NUMBER'  TO PV-PARAGRAPH-NAME 10650000
106600            MOVE SQLCODE                     TO PV-DB2-OPERATION  10660000
106700            PERFORM 9800-SQL-ABEND                                10670000
106800     END-EVALUATE.                                                10680000
106900                                                                  10690000
107000******************************************************************10700010
107100*  IF THE ORDER NUMBER WAS NOT FOUND, IS THIS A RETURN FROM A     10710010
107200*  ECOMMERCE TRANSACTION?                                         10720010
107300******************************************************************10730010
107400 4100-SELECT-ORIG-TRN.                                            10740010
107500                                                                  10750010
107600     EXEC SQL                                                     10760010
107700        SELECT  PARTN_NBR                                         10770010
107800             ,  ORIG_SLS_DTE                                      10780010
107900             ,  ORIG_STR_NBR                                      10790010
108000             ,  ORIG_RGST_ID                                      10800010
108100             ,  ORIG_TRN_NBR                                      10810010
108200             ,  ORIG_STRT_TM                                      10820010
108300             ,  ORIG_LNE_ITM_NBR                                  10830010
108400          INTO :EPIRT-PARTN-NBR                                   10840010
108500             , :EPIRT-ORIG-SLS-DTE                                10850010
108600             , :EPIRT-ORIG-STR-NBR                                10860010
108700             , :EPIRT-ORIG-RGST-ID                                10870010
108800             , :EPIRT-ORIG-TRN-NBR                                10880010
108900             , :EPIRT-ORIG-STRT-TM                                10890010
109000             , :EPIRT-ORIG-LNE-ITM-NBR                            10900010
109100          FROM  TEPIRT                                            10910010
109200        WHERE PARTN_NBR   = :EPITM-PARTN-NBR                      10920010
109300          AND STR_NBR     = :EPITM-STR-NBR                        10930010
109400          AND RGST_ID     = :EPITM-RGST-ID                        10940010
109500          AND TRN_NBR     = :EPITM-TRN-NBR                        10950010
109600          AND STRT_TM     = :EPITM-STRT-TM                        10960010
109700          AND SLS_CORR_SEQ_NBR = :EPITM-SLS-CORR-SEQ-NBR          10970010
109800          AND LNE_ITM_SEQ_NBR = :EPITM-LNE-ITM-SEQ-NBR            10980010
109900        WITH UR                                                   10990010
110000     END-EXEC.                                                    11000010
110100                                                                  11010010
110200     EVALUATE TRUE                                                11020010
110300        WHEN SQLCODE = ZERO                                       11030010
110400            SET PS-ORIG-TRN-FOUND-Y TO TRUE                       11040010
110500            PERFORM 4200-FIND-ORIG-ORD-NBR                        11050010
110600        WHEN SQLCODE = +100                                       11060010
110700            SET PS-ORIG-TRN-FOUND-N TO TRUE                       11070010
110800            MOVE SPACES             TO D1-ORD-NBR                 11080010
283763                                       SA-DTL-ORD-NBR             11081055
110900        WHEN OTHER                                                11090010
111000            MOVE '4100-SELECT-ORIG-TRN '  TO PV-PARAGRAPH-NAME    11100010
111100            MOVE SQLCODE                     TO PV-DB2-OPERATION  11110010
111200            PERFORM 9800-SQL-ABEND                                11120010
111300     END-EVALUATE.                                                11130010
111400                                                                  11140010
111500******************************************************************11150010
111600*  FIND ORIGINAL ORDER NUMBER                                     11160010
FIX24 *  ADDING FETCH FIRST ROW ONLY TO AVOID -811 ABENDS WHEN A        11161066
FIX24 *  SALES CORRECTION WAS PERFORMED AND MORE THAN 1 ROW IS RETURNED.11162066
111700******************************************************************11170010
111800 4200-FIND-ORIG-ORD-NBR.                                          11180010
111900                                                                  11190010
112000     EXEC SQL                                                     11200010
112100        SELECT  ORD_NBR                                           11210010
112200          INTO :EPORD-ORD-NBR                                     11220010
112300          FROM  TEPPART A                                         11230010
112400             ,  TEPORD  B                                         11240010
112500        WHERE A.PARTN_NBR     = B.PARTN_NBR                       11250010
112600          AND A.SLS_DTE       = :EPIRT-ORIG-SLS-DTE               11260010
112700          AND B.STR_NBR       = :EPIRT-ORIG-STR-NBR               11270010
112800          AND B.RGST_ID       = :EPIRT-ORIG-RGST-ID               11280010
112900          AND B.TRN_NBR       = :EPIRT-ORIG-TRN-NBR               11290010
113000          AND B.STRT_TM       = :EPIRT-ORIG-STRT-TM               11300010
FIX24         FETCH FIRST 1 ROW ONLY                                    11301066
113100        WITH UR                                                   11310010
113200     END-EXEC.                                                    11320010
113300                                                                  11330010
113400     EVALUATE TRUE                                                11340010
113500        WHEN SQLCODE = ZERO                                       11350010
113600            SET PS-ORDER-NUMBER-FOUND-Y TO TRUE                   11360010
113700            MOVE EPORD-ORD-NBR-TEXT    TO D1-ORD-NBR              11370010
283520                                          SA-DTL-ORD-NBR          11371051
113800        WHEN SQLCODE = +100                                       11380010
113900            SET PS-ORDER-NUMBER-FOUND-N TO TRUE                   11390010
114000            MOVE SPACES                TO D1-ORD-NBR              11400010
283520                                          SA-DTL-ORD-NBR          11401051
114100        WHEN OTHER                                                11410010
114200            MOVE '4200-FIND-ORIG-ORD-NBR'    TO PV-PARAGRAPH-NAME 11420010
FIX24             DISPLAY 'EPITM-PARTN-NBR    = '   EPITM-PARTN-NBR     11420170
FIX24             DISPLAY 'EPITM-STR-NBR      = '   EPITM-STR-NBR       11420270
FIX24             DISPLAY 'EPITM-RGST-ID      = '   EPITM-RGST-ID       11420370
FIX24             DISPLAY 'EPITM-TRN-NBR      = '   EPITM-TRN-NBR       11420470
FIX24             DISPLAY 'EPITM-STRT-TM      = '   EPITM-STRT-TM       11420570
FIX24             DISPLAY 'EPIRT-ORIG-SLS-DTE = '   EPIRT-ORIG-SLS-DTE  11421070
FIX24             DISPLAY 'EPIRT-ORIG-STR-NBR = '   EPIRT-ORIG-STR-NBR  11422070
FIX24             DISPLAY 'EPIRT-ORIG-RGST-ID = '   EPIRT-ORIG-RGST-ID  11423070
FIX24             DISPLAY 'EPIRT-ORIG-TRN-NBR = '   EPIRT-ORIG-TRN-NBR  11424070
FIX24             DISPLAY 'EPIRT-ORIG-STRT-TM = '   EPIRT-ORIG-STRT-TM  11425070
114300            MOVE SQLCODE                     TO PV-DB2-OPERATION  11430070
114400            PERFORM 9800-SQL-ABEND                                11440010
114500     END-EVALUATE.                                                11450010
114600******************************************************************11460000
114700* 8000-PRINT-HEADINGS                                             11470000
114800*     PRINT THE HEADINGS FOR THE REPORT.                          11480000
114900******************************************************************11490000
115000 8000-PRINT-HEADINGS.                                             11500000
115100                                                                  11510000
115200     ADD +1                      TO PV-PAGE-CNT.                  11520000
115300     MOVE PV-PAGE-CNT TO DP150-PAGE-NUMBER.                       11530000
115400     MOVE DP150-STANDRD-HEADER-150-COLS                           11540000
115500                                 TO PV-PRINT-RECORD.              11550000
115600     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          11560000
115700                                                                  11570000
115800     MOVE H1-HEADING-LINE-1      TO PV-PRINT-RECORD.              11580000
115900     MOVE +2                     TO PV-LINE-SPACING.              11590000
116000     PERFORM 8200-WRITE-REPORT-LINE.                              11600000
116100     ADD  PV-LINE-SPACING        TO PV-LINE-CNT.                  11610000
116200                                                                  11620000
116300     WRITE SALES-REPORT-RECORD FROM D4-BLANK-LINE AFTER           11630000
116400               ADVANCING 2 LINE.                                  11640000
116500                                                                  11650000
116600     IF PS-END-OF-ITEM-NO                                         11660000
116700        MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD            11670000
116800        MOVE +2                     TO PV-LINE-SPACING            11680000
116900        PERFORM 8200-WRITE-REPORT-LINE                            11690000
117000        ADD  PV-LINE-SPACING        TO PV-LINE-CNT                11700000
117100     END-IF.                                                      11710000
117200                                                                  11720000
117300******************************************************************11730000
117400* 8100-WRITE-RPT-TOP-OF-PAGE                                      11740000
117500*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   11750000
117600******************************************************************11760000
117700 8100-WRITE-RPT-TOP-OF-PAGE.                                      11770000
117800                                                                  11780000
117900     WRITE SALES-REPORT-RECORD                                    11790000
118000       FROM PV-PRINT-RECORD                                       11800000
118100         AFTER ADVANCING PAGE.                                    11810000
118200                                                                  11820000
118300     MOVE +3                     TO PV-LINE-CNT.                  11830000
118400                                                                  11840000
118500******************************************************************11850000
118600* 8200-WRITE-REPORT-LINE                                          11860000
118700*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             11870000
118800******************************************************************11880000
118900 8200-WRITE-REPORT-LINE.                                          11890000
119000                                                                  11900000
119100     WRITE SALES-REPORT-RECORD                                    11910000
119200       FROM PV-PRINT-RECORD                                       11920000
119300         AFTER ADVANCING PV-LINE-SPACING.                         11930000
119400                                                                  11940000
119500     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          11950000
119600                                                                  11960000
119700                                                                  11970000
119800******************************************************************11980000
119900 9800-SQL-ABEND.                                                  11990000
120000*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.12000000
120100******************************************************************12010000
120200     DISPLAY '** ABEND     **'.                                   12020000
120300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        12030000
120400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12040000
120500     DISPLAY '** SQLCODE   ** = ' PV-DB2-OPERATION.               12050000
120600     DISPLAY '** PARTITION ** = ' EPTRN-PARTN-NBR                 12060071
120700     DISPLAY '** STORE     ** = ' EPTRN-STR-NBR                   12070071
120800     DISPLAY '** REGISTER  ** = ' EPTRN-RGST-ID                   12080071
120900     DISPLAY '** TRANSACT  ** = ' EPTRN-TRN-NBR                   12090071
121000                                                                  12100000
121100******************************************************************12110000
121200* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     12120000
121300* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      12130000
121400******************************************************************12140000
121500     COPY DPPD004.                                                12150000
121600                                                                  12160000
121700     SET AC-DB2-ERROR TO TRUE.                                    12170000
121800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12180000
121900                                                                  12190000
122000******************************************************************12200000
122100*9999-ABEND.                                                      12210000
122200*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  12220000
122300******************************************************************12230000
122400 9999-ABEND.                                                      12240000
122500     DISPLAY '** ABEND           **'.                             12250000
122600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  12260000
122700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12270000
122800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       12280000
122900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       12290000
123000     DISPLAY '** PARTITION       ** = ' EPITM-PARTN-NBR           12300000
123100     DISPLAY '** STORE           ** = ' EPITM-STR-NBR             12310000
123200     DISPLAY '** REGISTER        ** = ' EPITM-RGST-ID             12320000
123300     DISPLAY '** TRANSACTION     ** = ' EPITM-TRN-NBR             12330000
123400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12340000
123500                                                                  12350000
