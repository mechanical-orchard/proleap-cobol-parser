000100*----------------------------------------------------------       00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*----------------------------------------------------------       00030001
000400 PROGRAM-ID.           EPKUT208.                                  00040001
000500 AUTHOR.               MEDHA CHOUDHURY.                           00050001
000510 INSTALLATION.         KOHLS DEPARTMENT STORES.                   00051001
000520 DATE-WRITTEN.         OCTOBER 30, 2007.                          00052001
000530                                                                  00053001
000540*-------------------------------------------------------------*   00054001
000550*    NEXT/FUTURE DAY OFFER EXTRACT PROCESSING                 *   00055001
000560*-------------------------------------------------------------*   00056001
000570* THIS PROGRAM WILL READ THE BATCH CONTROL CARD WITH FUTURE   *   00057001
000580* DATE AND EXTRACT ALL THE OFFER WITH EFFECTIVE BEGIN DATE    *   00058001
000590* MATCHING TO THE FUTURE DATE IN BATCH CONTROL CARD.          *   00059001
000600*                                                             *   00060001
000700*    THE OFFER DATA IS MAINTAINED IN ORACLE                   *   00070001
000800*                                                             *   00080001
000900*-------------------------------------------------------------*   00090001
001000*  ORACLE TABLES:                         DCLGEN:             *   00100001
001100*  --------------                         -------             *   00110001
001200*   K_OM01.OMT_OFR                        OMT00001            *   00120001
001300*   K_OM01.OMT_OFR_SECT                   OMT00002            *   00130001
001400*   K_OM01.OMT_OFR_SECT_BWP               OMT00003            *   00140001
001410*   K_OM01.OMT_OFR_LOC_GP                 OMT00004            *   00141001
001420*   K_OM01.OMT_MDSE_SET                   OMT00005            *   00142001
001421*   K_OM01.OMT_POS_BTN                    OMT00006            *   00142101
001422*   K_OM01.OMT_EVNT_CTG                   OMT00007            *   00142201
001423*   K_OM01.OMT_OFR_CUSTFACG_DESC          OMT00008            *   00142301
001424*   K_OM01.OMT_EVNT                       OMT00009            *   00142401
001425*                                                             *   00142501
001426*-------------------------------------------------------------*   00142601
001427*                                                             *   00142701
001428*  INPUT:                                                     *   00142801
001429*        CC-FUT-OFFSET-FILE       EPRD252- CREATED IN EPKUT207*   00142901
001430*        ORACLE-LOGIN-FILE                                    *   00143001
001431*                                                             *   00143101
001432*  OUTPUT:                                                    *   00143201
001433*        NEXT-FUTURE-DAY-FILE             EPRD205             *   00143301
001434*        STORE-GROUP-FILE                 EPRD206             *   00143401
001435*                                                             *   00143501
001436*-------------------------------------------------------------*   00143601
001437* HISTORY LOG:                                                *   00143701
001438*                                                             *   00143801
001439*-------------------------------------------------------------*   00143901
001440* DATE:        08/22/2008                                         00144001
001450* WR/IR#:      WR34938                                            00145001
001460* PROGRAMMER:  THOMAS HANSON                                      00146001
001470* DESCRIPTION: ADDED BWP_DLT_IND FIELD TO CURSOR, MUST BE 'N'     00147001
001480*              TO BE PULLED FOR THE EXTRACT. MARKED AS '080822'.  00148001
001490*-------------------------------------------------------------*   00148110
214901*                                                                 00148208
214901* DATE: 12/19/2018                                                00148308
214901* WR/IR#: CHG0214901                                              00148408
214901* PROGRAMMER: JIM ARENDT                                          00148508
214901* DESCRIPTION: IN CURSROR OFFERCRSR ADDED 'TO_CHAR' TO CHANGE THE 00148608
214901*              INPUT FORMAT OF THE TIMESTAMP DATES.               00148708
001600*-------------------------------------------------------------*   00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800*-------------------------------------------------------------*   00180001
001900 CONFIGURATION SECTION.                                           00190001
002000 SOURCE-COMPUTER. IBM-3090.                                       00200001
002100 OBJECT-COMPUTER. IBM-3090.                                       00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400                                                                  00240001
002500 FILE-CONTROL.                                                    00250001
002600                                                                  00260001
002700     SELECT CC-FUT-OFFSET-FILE                                    00270001
002800       ASSIGN TO INP01.                                           00280001
002900                                                                  00290001
003000     SELECT ORACLE-LOGIN-FILE                                     00300001
003100       ASSIGN TO ORALOGON.                                        00310001
003200                                                                  00320001
003300     SELECT NEXT-FUTURE-DAY-FILE                                  00330001
003400       ASSIGN TO OUT01.                                           00340001
003500                                                                  00350001
003600     SELECT STORE-GROUP-FILE                                      00360001
003610       ASSIGN TO OUT02.                                           00361001
003620                                                                  00362001
003630*-------------------------------------------------------------*   00363001
003640 DATA DIVISION.                                                   00364001
003650*----------------------------------------------------------       00365001
003660 FILE SECTION.                                                    00366001
003670                                                                  00367001
003680 FD  CC-FUT-OFFSET-FILE                                           00368001
003690     RECORDING MODE IS F                                          00369001
003700     BLOCK CONTAINS 0 RECORDS                                     00370001
003800     LABEL RECORDS ARE STANDARD                                   00380001
003900     DATA RECORD IS CC-FUT-OFFSET-RECORD.                         00390001
004000                                                                  00400001
004100 01  CC-FUT-OFFSET-RECORD         PIC X(80).                      00410001
004200                                                                  00420001
004300 FD  ORACLE-LOGIN-FILE                                            00430001
004400     RECORDING MODE IS F                                          00440001
004500     BLOCK CONTAINS 0 RECORDS                                     00450001
004600     LABEL RECORDS ARE STANDARD                                   00460001
004700     DATA RECORD IS ORACLE-LOGIN-RECORD.                          00470001
004800                                                                  00480001
004801 01  CC-FUT-OFFSET-RECORD         PIC X(80).                      00480101
004802                                                                  00480201
004803 FD  NEXT-FUTURE-DAY-FILE                                         00480301
004804     RECORDING MODE IS F                                          00480401
004805     BLOCK CONTAINS 0 RECORDS                                     00480501
004806     LABEL RECORDS ARE STANDARD                                   00480601
004807     DATA RECORD IS NEXT-FUTURE-DAY-RECORD.                       00480701
004808                                                                  00480801
004809 01  NEXT-FUTURE-DAY-RECORD            PIC X(176).                00480901
004810                                                                  00481001
004820 FD  STORE-GROUP-FILE                                             00482001
004830     RECORDING MODE IS F                                          00483001
004840     BLOCK CONTAINS 0 RECORDS                                     00484001
004850     LABEL RECORDS ARE STANDARD                                   00485001
004860     DATA RECORD IS STORE-GROUP-RECORD.                           00486001
004870                                                                  00487001
004880 01  STORE-GROUP-RECORD           PIC X(50).                      00488001
004890                                                                  00489001
004900                                                                  00490001
005000*----------------------------------------------------------       00500001
005100 WORKING-STORAGE SECTION.                                         00510001
005200                                                                  00520001
005300 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00530001
005400                                                  COMP SYNC.      00540001
005500     88  AC-4003-INPUT-CONTROL-CARD-ERR           VALUE +4003.    00550001
005600     88  AC-4004-TABLE-OVERFLOW-ERR               VALUE +4004.    00560001
005700     88  AC-4013-ORA-ERR                          VALUE +4013.    00570001
005800     88  AC-4019-CALENDAR-ROUTINE-ERR             VALUE +4019.    00580001
005900                                                                  00590001
006000*----------------------------------------------------------       00600001
006100* PC- PROGRAM CONSTANTS                                           00610001
006200*----------------------------------------------------------       00620001
006300 01  PC-PROGRAM-CONSTANTS.                                        00630001
006400     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT208'. 00640001
006500     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00650001
006600     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.00660001
006610     05  PC-NULL-VALUE                PIC X(01) VALUE '~'.        00661001
006620     05  PC-DASH-VALUE                PIC X(01) VALUE '-'.        00662001
006630     05  PC-PROMO-SCHM-CDE-1008       PIC X(04) VALUE '1008'.     00663001
006631     05  PC-PROMO-SCHM-CDE-1009       PIC X(04) VALUE '1009'.     00663101
006632     05  PC-PROMO-SCHM-CDE-1010       PIC X(04) VALUE '1010'.     00663201
006633     05  PC-BTN-TBL-THRSHOLD          PIC S9(04) VALUE +10 COMP.  00663301
006634     05  PC-AUTO-LOGON                PIC X(01)       VALUE '/'.  00663401
006635                                                                  00663501
006636*----------------------------------------------------------       00663601
006637 01  CC-ORACLE-CONNECTION.                                        00663701
006638     05  CC-ORACLE-USERID             PIC X(40).                  00663801
006639         88 CC-AUTO-LOGON                   VALUE '/'.            00663901
006640     05  CC-ORACLE-PASSWORD           PIC X(40).                  00664001
006641*----------------------------------------------------------       00664101
006642* PV- PROGRAM VARIABLES                                           00664201
006643*----------------------------------------------------------       00664301
006644 01  PV-PROGRAM-STATUS.                                           00664401
006645     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     00664501
006646     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     00664601
006647     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     00664701
006648     05  PV-ORA-OPERATION             PIC X(30) VALUE SPACES.     00664801
006649     05  PV-FUTURE-ORACLE-DTE         PIC X(09).                  00664901
006650     05  PV-FUTURE-OFFSET-DTE.                                    00665001
006660         10  PV-FUTURE-DD             PIC X(02).                  00666001
006670         10  PV-FUTURE-FILLER1        PIC X(01) VALUE '-'.        00667001
006680         10  PV-FUTURE-MON            PIC X(03).                  00668001
006690         10  PV-FUTURE-FILLER2        PIC X(01) VALUE '-'.        00669001
006700         10  PV-FUTURE-YY             PIC X(02).                  00670001
006800     05  PV-EFF-BEG-TMST.                                         00680001
006900         10  PV-EFF-BEG-DATE          PIC X(10).                  00690001
007000         10  PV-EFF-BEG-TIME          PIC X(09).                  00700001
007100     05  PV-EFF-END-TMST.                                         00710001
007200         10  PV-EFF-END-DATE          PIC X(10).                  00720001
007300         10  PV-EFF-END-TIME          PIC X(09).                  00730001
007400     05  PV-EFF-DATE.                                             00740001
007500         10 PV-DATE-CCYY              PIC X(04).                  00750001
007600         10 PV-DATE-MM                PIC X(02).                  00760001
007700         10 PV-DATE-DD                PIC X(02).                  00770001
007800     05  PV-FORMAT-DATE.                                          00780001
007900         10 PV-FORMAT-DATE-CCYY.                                  00790001
008000            15 PV-FORMAT-CC           PIC X(02).                  00800001
008100            15 PV-FORMAT-YY           PIC X(02).                  00810001
008200         10 PV-DASH1                  PIC X(01).                  00820001
008300         10 PV-FORMAT-DATE-MM         PIC X(02).                  00830001
008310         10 PV-DASH2                  PIC X(01).                  00831001
008311         10 PV-FORMAT-DATE-DD         PIC X(02).                  00831101
008312                                                                  00831201
008313******************************************************************00831301
008314* NULL INDICATORS                                                 00831401
008315******************************************************************00831501
008316 01  PV-NULL-INDICATORS.                                          00831601
008317     05  PV-POS-RLTV-NUM-NULL-IND       PIC S9(4) COMP VALUE +0.  00831701
008318     05  PV-ITM-DISC-APL-NULL-IND       PIC S9(4) COMP VALUE +0.  00831801
008319     05  PV-POS-BTN-CDE-NULL-IND        PIC S9(4) COMP VALUE +0.  00831901
008320     05  PV-BWP-BUY-QTY-NULL-IND        PIC S9(4) COMP VALUE +0.  00832001
008330     05  PV-BWP-BUY-AMT-NULL-IND        PIC S9(4) COMP VALUE +0.  00833001
008331     05  PV-BWP-BUY-TOL-AMT-NULL-IND    PIC S9(4) COMP VALUE +0.  00833101
008332     05  PV-BWP-GET-QTY-NULL-IND        PIC S9(4) COMP VALUE +0.  00833201
008333     05  PV-BWP-GET-PCT-NULL-IND        PIC S9(4) COMP VALUE +0.  00833301
008334     05  PV-BWP-GET-DOL-NULL-IND        PIC S9(4) COMP VALUE +0.  00833401
008335     05  PV-BWP-GET-PRPT-NULL-IND       PIC S9(4) COMP VALUE +0.  00833501
008336     05  PV-MDSE-DEPT-NBR-NULL-IND      PIC S9(4) COMP VALUE +0.  00833601
008337     05  PV-MDSE-MAJ-CLS-NULL-IND       PIC S9(4) COMP VALUE +0.  00833701
008338     05  PV-MDSE-SUB-CLS-NULL-IND       PIC S9(4) COMP VALUE +0.  00833801
008339     05  PV-MDSE-STL-ID-NULL-IND        PIC S9(4) COMP VALUE +0.  00833901
008340     05  PV-MDSE-SKU-NB-NULL-IND        PIC S9(4) COMP VALUE +0.  00834001
008341     05  PV-MDSE-EMP-DS-NULL-IND        PIC S9(4) COMP VALUE +0.  00834101
008342     05  PV-MDSE-DSC-EL-NULL-IND        PIC S9(4) COMP VALUE +0.  00834201
008343     05  PV-MDSE-TKT-CL-NULL-IND        PIC S9(4) COMP VALUE +0.  00834301
008344*                                                                 00834401
008345*----------------------------------------------------------       00834501
008346* PV- PROGRAM VARIABLES                                           00834601
008347*     (THE BELOW TABLE WILL HOLD ALL THE ROWS OF                  00834701
008348*                       K_OM01.OMT_POS_BTN TABLE )                00834801
008349*----------------------------------------------------------       00834901
008350 01  PV-OMT-POS-BTN.                                              00835001
008351     05  PV-BTN-RECORD                  OCCURS 10 TIMES           00835101
008352                                        INDEXED BY PV-BTN-INDEX.  00835201
008353         10  PV-POS-BTN-CDE             PIC X(03).                00835301
008354         10  PV-POS-BTN-TEXT            PIC X(16).                00835401
008355         10  PV-POS-BTN-RLTV-SEQ-NBR    PIC 9(10).                00835501
008356         10  PV-POS-BTN-RLTV-SEQ-NBR-X REDEFINES                  00835601
008357             PV-POS-BTN-RLTV-SEQ-NBR PIC X(10).                   00835701
008358                                                                  00835801
008359 01  PV-PROGRAM-VARIABLES.                                        00835901
008360     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 00836001
008361     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      00836101
008362     05  PV-BYTE-COUNT-OFFER          PIC  9(04) VALUE ZERO.      00836201
008363     05  PV-SQL-SUB                   PIC  9(01) VALUE ZERO.      00836301
008364     05  PV-SPACE                     PIC  X(01).                 00836401
008365     05  PV-DISPLAY-INDEX             PIC S9(04) COMP.            00836501
008366                                                                  00836601
008367*----------------------------------------------------------       00836701
008368* PV- PROGRAM COUNT VARIABLES                                     00836801
008369*----------------------------------------------------------       00836901
008370 01  PV-PROGRAM-COUNTERS.                                         00837001
008380     05  PV-OFFER-FETCHED            PIC 9(09) VALUE 0.           00838001
008390     05  PV-OFFER-WRITEN             PIC 9(09) VALUE 0.           00839001
008400     05  PV-OFFER-SECTION            PIC 9(09) VALUE 0.           00840001
008410     05  PV-OFFER-BWP                PIC 9(09) VALUE 0.           00841001
008411     05  PV-OFFER-MDSE               PIC 9(09) VALUE 0.           00841101
008412     05  PV-OFFER-STORE-FETCHED      PIC 9(09) VALUE 0.           00841201
008413     05  PV-OFFER-STORE-WRITEN       PIC 9(09) VALUE 0.           00841301
008414     05  PV-POS-BTN-REC-FETCHED      PIC 9(09) VALUE 0.           00841401
008415     05  PV-POS-BTN-REC-WRITEN       PIC 9(09) VALUE 0.           00841501
008416     05  PV-TOTAL-RECORDS-OUT        PIC 9(09) VALUE 0.           00841601
008417                                                                  00841701
008418 01  PV-OFFER-DATA-WRITEN.                                        00841801
008419     05  PV-OFR-ID                   PIC 9(10).                   00841901
008420     05  PV-EVNT-ID                  PIC 9(10).                   00842001
008421     05  PV-OFR-SECT-TYP-CDE         PIC X(01).                   00842101
008422     05  PV-OFR-SECT-BWP-ID          PIC 9(10).                   00842201
008423     05  PV-MDSE-SET-ID              PIC 9(10).                   00842301
008424                                                                  00842401
008425 01  PV-LOGON-SYSIN.                                              00842501
008426     05  PV-SYSIN-ORACLE-ID          PIC X(10) VALUE SPACES.      00842601
008427     05  FILLER                      PIC X(01) VALUE '*'.         00842701
008428     05  PV-SYSIN-PASSWD             PIC X(10) VALUE SPACES.      00842801
008429                                                                  00842901
008430     05  PV-ORACLE-USERID-LEN       PIC S9(04)      VALUE ZEROS.  00843001
008431     05  PV-ORACLE-PASSWORD-LEN     PIC S9(04)      VALUE ZEROS.  00843101
008432*----------------------------------------------------------------*00843201
008433* PS- PROGRAM SWITCHES                                           *00843301
008434*----------------------------------------------------------------*00843401
008435 01  PS-PROGRAM-SWITCHES.                                         00843501
008436     05  PS-END-OF-FILE-SW         PIC  X(01) VALUE 'N'.          00843601
008437         88  PS-END-OF-FILE                   VALUE 'Y'.          00843701
008438         88  PS-NOT-END-OF-FILE               VALUE 'N'.          00843801
008439     05  PS-END-OF-FETCH-OF-SW     PIC  X(01) VALUE 'N'.          00843901
008440         88  PS-END-OF-FETCH-OF               VALUE 'Y'.          00844001
008450         88  PS-NOT-END-OF-FETCH-OF           VALUE 'N'.          00845001
008460     05  PS-END-OF-FETCH-STR-SW    PIC  X(01) VALUE 'N'.          00846001
008470         88  PS-END-OF-FETCH-STR              VALUE 'Y'.          00847001
008480         88  PS-NOT-END-OF-FETCH-STR          VALUE 'N'.          00848001
008490     05  PS-END-OF-FETCH-BTN-SW    PIC  X(01) VALUE 'N'.          00849001
008491         88  PS-END-OF-FETCH-BTN              VALUE 'Y'.          00849101
008492         88  PS-NOT-END-OF-FETCH-BTN          VALUE 'N'.          00849201
008493     05  PS-READY-TRACE-SW         PIC  X(01) VALUE 'N'.          00849301
008494         88 PS-READY-TRACE                    VALUE 'Y'.          00849401
008495         88 PS-RESET-TRACE                    VALUE 'N'.          00849501
008496     05  PS-OFFER-TYPE-SW          PIC  X(01) VALUE 'N'.          00849601
008497         88 PS-NEW-OFFER                      VALUE 'Y'.          00849701
008498         88 PS-PRS-OFFER                      VALUE 'N'.          00849801
008499     05  PS-ORACLE-LOGIN-EOF-SW    PIC X(01)  VALUE 'N'.          00849901
008500         88  ORACLE-LOGIN-EOF                 VALUE 'Y'.          00850001
008501*----------------------------------------------------------       00850101
008502* NETCOOL VARIABLES COPYBOOK  EPWS208                             00850201
008503*----------------------------------------------------------       00850301
008504     COPY EPWS208.                                                00850401
008505                                                                  00850501
008506*----------------------------------------------------------       00850601
008507* DATE ROUTINE COPY MEMBERS                                       00850701
008508*----------------------------------------------------------       00850801
008509     COPY DPWS500.                                                00850901
008510                                                                  00851001
008520*----------------------------------------------------------       00852001
008530* NETCOOL ERROR MESSAGE COPYBOOK                                  00853001
008531*----------------------------------------------------------       00853101
008532     COPY ISWS003.                                                00853201
008533                                                                  00853301
008534*----------------------------------------------------------       00853401
008535* CONTROL CARD EPCC252 LAYOUT                                     00853501
008536*----------------------------------------------------------       00853601
008537     COPY EPRD252.                                                00853701
008538                                                                  00853801
008539*----------------------------------------------------------       00853901
008540* COPYBOOK  EPRD205 LAYOUT                                        00854001
008541*----------------------------------------------------------       00854101
008542     COPY EPRD205.                                                00854201
008543                                                                  00854301
008544*----------------------------------------------------------       00854401
008545* COPYBOOK  EPRD206 LAYOUT                                        00854501
008546*  PUT THE TEST COPYBOOK EPRD206C TEMPORARILY FOR TEST            00854601
008547*----------------------------------------------------------       00854701
008548     COPY EPRD206.                                                00854801
008549                                                                  00854901
008550*----------------------------------------------------------       00855001
008560* ORACLE DECLARE SECTION START                                    00856001
008570*----------------------------------------------------------       00857001
008580     EXEC SQL                                                     00858001
008590        BEGIN DECLARE SECTION                                     00859001
008600     END-EXEC.                                                    00860001
008700                                                                  00870001
008800*----------------------------------------------------------------*00880001
008900* PD- ORA VARIABLES (NON DCLGEN)                                 *00890001
009000*----------------------------------------------------------------*00900001
009100 01  USERNAME                      PIC X(10)  VARYING.            00910001
009200 01  PASSWD                        PIC X(10)  VARYING.            00920001
009300 01  PV-ORACLE-ID                  PIC X(01)  VALUE '/'.          00930001
009400                                                                  00940001
009500*----------------------------------------------------------------*00950001
009600* OMT00001 COBOL DECLARATION FOR TABLE K_OM01.OMT_OFR            *00960001
009700*----------------------------------------------------------------*00970001
009800     EXEC SQL                                                     00980001
009900         INCLUDE OMT00001                                         00990001
010000     END-EXEC.                                                    01000001
010100                                                                  01010001
010200*----------------------------------------------------------------*01020001
010210* OMT00002 COBOL DECLARATION FOR TABLE K_OM01.OMT_OFR_SECT       *01021001
010211*----------------------------------------------------------------*01021101
010212     EXEC SQL                                                     01021201
010213         INCLUDE OMT00002                                         01021301
010214     END-EXEC.                                                    01021401
010215                                                                  01021501
010216*----------------------------------------------------------------*01021601
010217* OMT00003 COBOL DECLARATION FOR TABLE K_OM01.OMT_OFR_SECT_BWP   *01021701
010218*----------------------------------------------------------------*01021801
010219     EXEC SQL                                                     01021901
010220         INCLUDE OMT00003                                         01022001
010221     END-EXEC.                                                    01022101
010222                                                                  01022201
010223*----------------------------------------------------------------*01022301
010224* OMT00004 COBOL DECLARATION FOR TABLE K_OM01.OMT_OFR_LOC_GP     *01022401
010225*----------------------------------------------------------------*01022501
010226     EXEC SQL                                                     01022601
010227         INCLUDE OMT00004                                         01022701
010228     END-EXEC.                                                    01022801
010229                                                                  01022901
010230*----------------------------------------------------------------*01023001
010231* OMT00005  COBOL DECLARATION FOR TABLE K_OM01.OMT_MDSE_SET      *01023101
010232*----------------------------------------------------------------*01023201
010233     EXEC SQL                                                     01023301
010234         INCLUDE OMT00005                                         01023401
010235     END-EXEC.                                                    01023501
010236                                                                  01023601
010237*----------------------------------------------------------------*01023701
010238* OMT00006  COBOL DECLARATION FOR TABLE K_OM01.OMT_POS_BTN      * 01023801
010239*----------------------------------------------------------------*01023901
010240     EXEC SQL                                                     01024001
010241         INCLUDE OMT00006                                         01024101
010242     END-EXEC.                                                    01024201
010243                                                                  01024301
010244*----------------------------------------------------------------*01024401
010245* OMT00007  COBOL DECLARATION FOR TABLE K_OM01.OMT_EVNT_CTG      *01024501
010246*----------------------------------------------------------------*01024601
010247     EXEC SQL                                                     01024701
010248         INCLUDE OMT00007                                         01024801
010249     END-EXEC.                                                    01024901
010250                                                                  01025001
010251*----------------------------------------------------------------*01025101
010252* OMT00008                                                       *01025201
010253*    COBOL DECLARATION FOR TABLE K_OM01.OMT_OFR_CUSTFACG_DESC    *01025301
010254*----------------------------------------------------------------*01025401
010255     EXEC SQL                                                     01025501
010256         INCLUDE OMT00008                                         01025601
010257     END-EXEC.                                                    01025701
010258                                                                  01025801
010259*----------------------------------------------------------------*01025901
010260* OMT00009  COBOL DECLARATION FOR TABLE K_OM01.OMT_EVNT          *01026001
010261*----------------------------------------------------------------*01026101
010262     EXEC SQL                                                     01026201
010263         INCLUDE OMT00009                                         01026301
010264     END-EXEC.                                                    01026401
010265                                                                  01026501
010266*----------------------------------------------------------------*01026601
010267* ORACLE END OF DECLARATIVE SECTION                              *01026701
010268*----------------------------------------------------------------*01026801
010269     EXEC SQL                                                     01026901
010270       END DECLARE SECTION                                        01027001
010271     END-EXEC.                                                    01027101
010272                                                                  01027201
010273     EXEC SQL                                                     01027301
010274          INCLUDE SQLCACOB                                        01027401
010275     END-EXEC.                                                    01027501
010276                                                                  01027601
010277*----------------------------------------------------------------*01027701
010278* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *01027801
010279*----------------------------------------------------------------*01027901
010280     COPY DPWS004.                                                01028001
010290                                                                  01029001
010300*----------------------------------------------------------------*01030001
010400* ORA ABEND COPYBOOK                                             *01040001
010500*----------------------------------------------------------------*01050001
010600     COPY DPWS900.                                                01060001
010610                                                                  01061001
010620*----------------------------------------------------------       01062001
010630 PROCEDURE DIVISION.                                              01063001
010640*----------------------------------------------------------       01064001
010650 0000-MAINLINE.                                                   01065001
010660                                                                  01066001
010670     PERFORM 1000-INITIALIZATION.                                 01067001
010680                                                                  01068001
010690     PERFORM 2000-PROCESS-EXTRACT-OFFERS.                         01069001
010700                                                                  01070001
010800     PERFORM 5000-EXTRACT-OFFER-STORES.                           01080001
010900                                                                  01090001
011000     PERFORM 9200-WRAPUP.                                         01100001
011100                                                                  01110001
011200     GOBACK.                                                      01120001
011300                                                                  01130001
011400*0000-EXIT.                                                       01140001
011500 EJECT.                                                           01150001
011510                                                                  01151001
011520*----------------------------------------------------------       01152001
011530* 1000-INITIALIZATION.                                            01153001
011540*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           01154001
011550*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      01155001
011560*     FILES.                                                      01156001
011570*----------------------------------------------------------       01157001
011580 1000-INITIALIZATION.                                             01158001
011590                                                                  01159001
011600     INITIALIZE EP252-CC-CONTROL-CARD.                            01160001
011700     INITIALIZE PV-OMT-POS-BTN.                                   01170001
011800     INITIALIZE PS-PROGRAM-SWITCHES.                              01180001
011900     INITIALIZE PV-OFFER-DATA-WRITEN.                             01190001
012000     INITIALIZE PV-NULL-INDICATORS.                               01200001
012100                                                                  01210001
012200     DISPLAY '****************************************'.          01220001
012300     DISPLAY '**          EPKUT208 STARTED          **'.          01230001
012400     DISPLAY '****************************************'.          01240001
012500                                                                  01250001
012600     OPEN INPUT CC-FUT-OFFSET-FILE.                               01260001
012700                                                                  01270001
012800     PERFORM 1100-READ-FUT-OFFSET-CARD.                           01280001
012900                                                                  01290001
013000     CLOSE CC-FUT-OFFSET-FILE.                                    01300001
013100                                                                  01310001
013200     OPEN INPUT ORACLE-LOGIN-FILE.                                01320001
013300     PERFORM 1200-SET-UP-FOR-ORACLE.                              01330001
013400                                                                  01340001
013500     OPEN OUTPUT NEXT-FUTURE-DAY-FILE.                            01350001
013600     OPEN OUTPUT STORE-GROUP-FILE.                                01360001
013700                                                                  01370001
013800                                                                  01380001
013900*1000-EXIT.                                                       01390001
014000 EJECT.                                                           01400001
014100                                                                  01410001
014200*----------------------------------------------------------       01420001
014300* 1100-READ-FUT-OFFSET-CARD.                                      01430001
014400*     READS IN THE FUTURE OFFSET(EPCC252) CONTROL CARD            01440001
014500*     VALIDATES THE INPUT NEXT/FUTURE DATE AND FORMATS            01450001
014600*     IT TO THE ORACLE FORMAT WHICH WILL BE USED LATER IN THE     01460001
014700*     CURSOR TO EXTRACT THE OFFERS.                               01470001
014800*----------------------------------------------------------       01480001
014900 1100-READ-FUT-OFFSET-CARD.                                       01490001
015000                                                                  01500001
015100     READ CC-FUT-OFFSET-FILE                                      01510001
015200         INTO EP252-CC-CONTROL-CARD                               01520001
015300     END-READ.                                                    01530001
015400                                                                  01540001
015500     DISPLAY ' '.                                                 01550001
015600     DISPLAY 'INPUT EPRD252 CONTROL CARD'.                        01560001
015700     DISPLAY EP252-CC-CONTROL-CARD-DISPLY.                        01570001
015800                                                                  01580001
015900     IF EP252-CC-PREVIOUS-FUTURE-DATE  = SPACES                   01590001
016000        DISPLAY 'EMPTY CONTROL CARD'                              01600001
016100        DISPLAY 'FUTURE DATE: ' EP252-CC-PREVIOUS-FUTURE-DATE     01610001
016200        MOVE '1100-READ-FUT-OFFSET-CARD' TO PV-PARAGRAPH-NAME     01620001
016210        MOVE 'CONTROL CARD IS EMPTY' TO PV-OPERATION-MSG-1        01621001
016220        SET AC-4003-INPUT-CONTROL-CARD-ERR  TO TRUE               01622001
016221        PERFORM 9910-ABEND                                        01622101
016222     END-IF.                                                      01622201
016223                                                                  01622301
016224     PERFORM 6000-VALIDATE-DATE-INPUT.                            01622401
016225                                                                  01622501
016226*****  FORMATING THE FUTURE DATE IN ORACLE FORMAT ***********     01622601
016227                                                                  01622701
016228     MOVE PC-DASH-VALUE TO PV-FUTURE-FILLER1.                     01622801
016229     MOVE PC-DASH-VALUE TO PV-FUTURE-FILLER2.                     01622901
016230                                                                  01623001
016240     MOVE EP252-CC-FUTURE-DATE     TO PV-FORMAT-DATE.             01624001
016250                                                                  01625001
016260     MOVE PV-FORMAT-DATE-DD        TO PV-FUTURE-DD.               01626001
016270     MOVE PV-FORMAT-YY             TO PV-FUTURE-YY.               01627001
016280     MOVE DPG55-ALPHA-MONTH-ABBR3  TO PV-FUTURE-MON.              01628001
016290     MOVE PV-FUTURE-OFFSET-DTE     TO PV-FUTURE-ORACLE-DTE.       01629001
016300                                                                  01630001
016301*1100-EXIT.                                                       01630101
016302 EJECT.                                                           01630201
016303                                                                  01630301
016304*--------------------------------------------------------------*  01630401
016305* 1200-SET-UP-FOR-ORACLE.                                      *  01630501
016306*     SET UP TO CONNECT TO THE ORACLE DATABASE.                *  01630601
016307*     THE LOGIN ID AND PASSWORD IS OBTAINED FROM THE SYSIN     *  01630701
016308*     CONTROL CARD 'TKMA.CONTROL(EPCC261)'                     *  01630801
016309*                                                              *  01630901
016310* IF USERNAME-LEN IS ZERO, THE LOGON ID IS MISSING FROM SYSIN. *  01631001
016320* THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES  *  01632001
016330* FROM THE JCL                                                 *  01633001
016340*--------------------------------------------------------------*  01634001
016350 1200-SET-UP-FOR-ORACLE.                                          01635001
016360                                                                  01636001
016370     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             01637002
016380        AT END                                                    01638001
016390           SET ORACLE-LOGIN-EOF TO TRUE.                          01639001
016400     CLOSE ORACLE-LOGIN-FILE.                                     01640001
016500                                                                  01650001
016510     IF  ((ORACLE-LOGIN-EOF)                                      01651001
016520           OR ((CC-ORACLE-CONNECTION = SPACES)))                  01652001
016530           DISPLAY '** ABEND **'                                  01653001
016531           DISPLAY ' ORACLE LOGON NOT PROVIDED'                   01653101
016532           MOVE    '1200-SET-UP-FOR-ORACLE'   TO PV-PARAGRAPH-NAME01653201
016533           PERFORM 9900-ORA-ERROR                                 01653301
016534     END-IF.                                                      01653401
016535     PERFORM 7000-CONNECT-TO-ORACLE.                              01653501
016536                                                                  01653601
016537*1200-EXIT.                                                       01653701
016538 EJECT.                                                           01653801
016539                                                                  01653901
016540*----------------------------------------------------------       01654001
016550* 2000-PROCESS-EXTRACT-OFFERS.                                    01655001
016560* ----------------------------                                    01656001
016570* THIS PARAGRAPH WILL PERFORM THE FOLLOWING:                      01657001
016580* (1) LOAD THE DATA FROM OMT_POS_BTN TABLE TO A TEMPORARY TABLE   01658001
016590*                                                                 01659001
016600* (2) EXTRACT ALL THE FUTURE DATE OFFERS, ALL THE COLUMNS THAT MAP01660001
016700*     TO THE POS STORE SERVER DATABASE NEEDS TO BE SELECTED       01670001
016800*                                                                 01680001
016810* (3) EXTRACT THE STORE GROUP INFORMATION OF THE THE FUTURE DATE  01681001
016820*     OFFERS.                                                     01682001
016830*----------------------------------------------------------       01683001
016840 2000-PROCESS-EXTRACT-OFFERS.                                     01684001
016850                                                                  01685001
016860     PERFORM 2100-DEC-OPEN-BTN-CURSOR.                            01686001
016870                                                                  01687001
016880     SET PS-NOT-END-OF-FETCH-BTN TO TRUE.                         01688001
016890                                                                  01689001
016900     SET PV-BTN-INDEX TO 1.                                       01690001
017000                                                                  01700001
017100     PERFORM 2200-FETCH-BTN-CURSOR                                01710001
017110          UNTIL PS-END-OF-FETCH-BTN.                              01711001
017120                                                                  01712001
017121     PERFORM 2400-DEC-OPEN-OFFER-CURSOR.                          01712101
017122                                                                  01712201
017123     SET PS-NOT-END-OF-FETCH-OF  TO TRUE.                         01712301
017124                                                                  01712401
017125     PERFORM 2500-FETCH-OFFER-CURSOR                              01712501
017126          UNTIL PS-END-OF-FETCH-OF.                               01712601
017127                                                                  01712701
017128*2000-EXIT.                                                       01712801
017129 EJECT.                                                           01712901
017130                                                                  01713001
017140*----------------------------------------------------------       01714001
017150* 2100-DEC-OPEN-BTN-CURSOR.                                       01715001
017160* THIS PARAGRAPH WILL DECLARE AND OPEN BTNCRSR                    01716001
017170*----------------------------------------------------------       01717001
017180 2100-DEC-OPEN-BTN-CURSOR.                                        01718001
017190                                                                  01719001
017200        EXEC SQL  DECLARE BTNCRSR CURSOR FOR                      01720001
017300           SELECT                                                 01730001
017400               POS_BTN_CDE                                        01740001
017410              ,POS_BTN_TXT                                        01741001
017420              ,POS_BTN_RLTV_SEQ_NBR                               01742001
017430          FROM OMT_POS_BTN                                        01743001
017440          WHERE POS_BTN_CDE IS NOT NULL                           01744001
017450        END-EXEC.                                                 01745001
017460                                                                  01746001
017461     PERFORM                                                      01746101
017462         WITH TEST AFTER                                          01746201
017463         VARYING PV-SQL-SUB                                       01746301
017464         FROM 1 BY 1                                              01746401
017465         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 01746501
017466                   OR  SQLCODE = 0)                               01746601
017467                                                                  01746701
017468           EXEC SQL                                               01746801
017469              OPEN BTNCRSR                                        01746901
017470           END-EXEC                                               01747001
017471                                                                  01747101
017472           EVALUATE TRUE                                          01747201
017473               WHEN SQLCODE = 0                                   01747301
017474                    CONTINUE                                      01747401
017475               WHEN SQLCODE NOT EQUAL ZERO                        01747501
017476                    MOVE 'OPEN CURSOR FOR BTNCRSR     '           01747601
017477                                       TO PV-ORA-OPERATION        01747701
017478                    MOVE '2100-DEC-OPEN-BTN-CURSOR        '       01747801
017479                      TO PV-PARAGRAPH-NAME                        01747901
017480                    PERFORM 9900-ORA-ERROR                        01748001
017481           END-EVALUATE                                           01748101
017482                                                                  01748201
017483     END-PERFORM.                                                 01748301
017484                                                                  01748401
017485*2100-EXIT.                                                       01748501
017486 EJECT.                                                           01748601
017487*----------------------------------------------------------       01748701
017488* 2200-FETCH-BTN-CURSOR                                           01748801
017489* THIS PARAGRAPH WILL FETCH DATA FROM THE BTNCRSR CURSOR          01748901
017490*  AND POPULATE THE PROGRAM TABLE (PV-OMT-POS-BTN)                01749001
017491*----------------------------------------------------------       01749101
017492 2200-FETCH-BTN-CURSOR.                                           01749201
017493                                                                  01749301
017494      SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                    01749401
017495                                                                  01749501
017496     EXEC SQL                                                     01749601
017497         FETCH BTNCRSR                                            01749701
017498          INTO                                                    01749801
017499               :OMT00006.POS-BTN-CDE                              01749901
017500              ,:OMT00006.POS-BTN-TXT                              01750001
017501              ,:OMT00006.POS-BTN-RLTV-SEQ-NBR                     01750101
017502               :PV-POS-RLTV-NUM-NULL-IND                          01750201
017503     END-EXEC.                                                    01750301
017504                                                                  01750401
017505     EVALUATE TRUE                                                01750501
017506                                                                  01750601
017507         WHEN SQLCODE IS EQUAL TO ZEROS                           01750701
017508                                                                  01750801
017509            ADD 1 TO PV-POS-BTN-REC-FETCHED                       01750901
017510                                                                  01751001
017511            IF  PV-POS-RLTV-NUM-NULL-IND = -1                     01751101
017512                SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE           01751201
017513            ELSE                                                  01751301
017514                PERFORM EP208-1100-DETERMNE-POS-OVRFLW            01751401
017515            END-IF                                                01751501
017516                                                                  01751601
017517            IF EPWS208-OFFER-DATA-IN-RANGE                        01751701
017518               PERFORM 2300-MOVE-BTNCRSR-VALUES                   01751801
017519            END-IF                                                01751901
017520                                                                  01752001
017521         WHEN SQLCODE IS EQUAL TO 1403                            01752101
017522                                                                  01752201
017523             SET PS-END-OF-FETCH-BTN   TO TRUE                    01752301
017524                                                                  01752401
017525         WHEN OTHER                                               01752501
017526                                                                  01752601
017527             MOVE 'FETCH DATA FROM BTNCRSR   '                    01752701
017528                                      TO PV-ORA-OPERATION         01752801
017529             PERFORM 9900-ORA-ERROR                               01752901
017530         END-EVALUATE.                                            01753001
017540                                                                  01754001
017541     IF PV-BTN-INDEX > PC-BTN-TBL-THRSHOLD                        01754101
017542        DISPLAY 'LIMIT OF POST-BTN-CURSOR REACHED'                01754201
017543        MOVE '2200-FETCH-BTN-CURSOR' TO                           01754301
017544                               PV-PARAGRAPH-NAME                  01754401
017545        MOVE 'TABLE LIMIT REACHED FOR POS-BTN-ARRAY' TO           01754501
017546                             PV-OPERATION-MSG-1                   01754601
017547        SET AC-4004-TABLE-OVERFLOW-ERR     TO TRUE                01754701
017548        PERFORM 9910-ABEND                                        01754801
017549     END-IF.                                                      01754901
017550                                                                  01755001
017551*                                                                 01755101
017552*2200-EXIT.                                                       01755201
017553 EJECT.                                                           01755301
017554*----------------------------------------------------------       01755401
017555* 2300-MOVE-BTNCRSR-VALUES.                                       01755501
017556* THIS PARAGRAPH WILL MOVE THE FETCHED VALUES FROM THE BTNCRSR    01755601
017557* TO WORKING STORAGE TABLE.                                       01755701
017558*----------------------------------------------------------       01755801
017559 2300-MOVE-BTNCRSR-VALUES.                                        01755901
017560                                                                  01756001
017561     MOVE POS-BTN-CDE IN OMT00006 TO                              01756101
017562                             PV-POS-BTN-CDE(PV-BTN-INDEX).        01756201
017563     MOVE POS-BTN-TXT IN OMT00006 TO                              01756301
017564                             PV-POS-BTN-TEXT(PV-BTN-INDEX).       01756401
017565     IF PV-POS-RLTV-NUM-NULL-IND = -1                             01756501
017566        MOVE PC-NULL-VALUE TO                                     01756601
017567                    PV-POS-BTN-RLTV-SEQ-NBR-X(PV-BTN-INDEX)       01756701
017568     ELSE                                                         01756801
017569        MOVE POS-BTN-RLTV-SEQ-NBR IN OMT00006 TO                  01756901
017570                  PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX)           01757001
017571     END-IF.                                                      01757101
017572                                                                  01757201
017573     ADD 1 TO PV-POS-BTN-REC-WRITEN                               01757301
017574     SET  PV-BTN-INDEX UP BY 1.                                   01757401
017575                                                                  01757501
017576*2300-EXIT.                                                       01757601
017577 EJECT.                                                           01757701
017578*----------------------------------------------------------       01757801
017579* 2400-DEC-OPEN-OFFER-CURSOR.                                     01757901
017580* THIS PARAGRAPH WILL DECLARE AND OPEN OFFERCRSR                  01758001
017581*----------------------------------------------------------       01758101
017582 2400-DEC-OPEN-OFFER-CURSOR.                                      01758201
017583                                                                  01758301
017584        EXEC SQL  DECLARE OFFERCRSR CURSOR FOR                    01758401
017585           SELECT                                                 01758501
017586               C.OFR_ID                                           01758601
017587              ,C.EVNT_ID                                          01758701
017588              ,C.OFR_NM                                           01758801
017589              ,C.DISC_LVL_CDE                                     01758901
017590              ,C.OFR_USG_TYP_CDE                                  01759001
017591              ,C.BRCDE_TYP_CDE                                    01759101
017592              ,C.UNEARN_IND                                       01759201
017593              ,C.OFR_TRGR_TYP_CDE                                 01759301
017594              ,C.ITM_DISC_APPL_CDE                                01759401
017595              ,B.EVNT_TYP_CDE                                     01759501
017596              ,A.EVNT_CTG_NM                                      01759601
017597              ,D.OFR_SECT_TYP_CDE                                 01759701
214901**            ,D.EFF_BEG_TMST                                     01759806
214901              ,TO_CHAR(D.EFF_BEG_TMST,'YYYY-MM-DD.HH24.MI.SS')    01759906
214901**            ,D.EFF_END_TMST                                     01760006
214901              ,TO_CHAR(D.EFF_END_TMST,'YYYY-MM-DD.HH24.MI.SS')    01760106
017600              ,D.TOL_STRT_NMOFDA_QTY                              01760201
017601              ,D.TOL_END_NMOFDA_QTY                               01760301
017602              ,D.REDMN_SUPVR_OVRRID_NMOFDA_QTY                    01760401
017603              ,D.LMT_PER_TRN_QTY                                  01760501
017604              ,D.BWP_GET_CNCTR_CDE                                01760601
017605              ,D.BWP_BUY_CNCTR_CDE                                01760701
017606              ,D.VLD_POS_TNDR_COMB_TYP_CDE                        01760801
017607              ,D.POS_BTN_CDE                                      01760901
017608              ,E.CUSTFACG_SHRT_DESC                               01761001
017609              ,G.OFR_SECT_BWP_ID                                  01761101
017610              ,G.TIER_LVL_NBR                                     01761201
017611              ,G.BWP_SELN_TYP_CDE                                 01761301
017612              ,G.BWP_BUY_QTY                                      01761401
017613              ,G.BWP_BUY_AMT                                      01761501
017614              ,G.BWP_BUY_TOL_AMT                                  01761601
017615              ,G.BWP_GET_QTY                                      01761701
017616              ,G.BWP_GET_PCT_OFF_PCT                              01761801
017617              ,G.BWP_GET_DOL_OFF_AMT                              01761901
017618              ,G.BWP_GET_PRPT_AMT                                 01762001
017619              ,H.MDSE_SET_ID                                      01762101
017620              ,H.MDSE_HIER_CDE                                    01762201
017621              ,H.DEPT_NBR                                         01762301
017622              ,H.MAJ_CL_NBR                                       01762401
017623              ,H.SUB_CL_NBR                                       01762501
017624              ,H.STYL_ID                                          01762601
017625              ,H.SKU_NBR                                          01762701
017626              ,H.IE_IND                                           01762801
017627              ,H.EMP_DISC_CDE                                     01762901
017628              ,H.DISC_ELIG_IND                                    01763001
017629              ,H.TKT_CLOR_CDE                                     01763101
017630         FROM                                                     01763201
017631              OMT_EVNT_CTG A                                      01763301
017632             ,OMT_EVNT B                                          01763401
017633             ,OMT_OFR C                                           01763501
017634             ,OMT_OFR_SECT D                                      01763601
017635             ,OMT_OFR_CUSTFACG_DESC E                             01763701
017636             ,OMT_OFR_SECT_BWP G                                  01763801
017637             ,OMT_MDSE_SET H                                      01763901
017638        WHERE                                                     01764001
017639              D.EFF_BEG_TMST = TO_DATE(:PV-FUTURE-ORACLE-DTE      01764101
017640                                        ,'DD-MON-YY') +           01764201
017641                                     D.TOL_STRT_NMOFDA_QTY        01764301
017642          AND C.EVNT_ID = B.EVNT_ID                               01764701
017643          AND H.EVNT_ID = B.EVNT_ID                               01764801
017644          AND G.EVNT_ID = B.EVNT_ID                               01764901
017645          AND H.EVNT_ID = C.EVNT_ID                               01765001
017646          AND G.EVNT_ID = C.EVNT_ID                               01765101
017647          AND H.EVNT_ID = D.EVNT_ID                               01765201
017648          AND G.EVNT_ID = D.EVNT_ID                               01765301
017649          AND B.EVNT_CTG_ID = A.EVNT_CTG_ID                       01765401
017650          AND C.EVNT_ID = D.EVNT_ID                               01765501
017651          AND B.EVNT_ID = D.EVNT_ID                               01765601
017652          AND C.OFR_ID = D.OFR_ID                                 01765701
017653          AND C.OFR_STAT_CDE = 'A'                                01765801
017654          AND D.CUSTFACG_DESC_ID = E.CUSTFACG_DESC_ID             01765901
017655          AND D.OFR_ID = G.OFR_ID                                 01766001
017656          AND C.OFR_ID = G.OFR_ID                                 01766101
017657          AND D.OFR_SECT_TYP_CDE = G.OFR_SECT_TYP_CDE             01766201
017658          AND D.OFR_ID = H.OFR_ID                                 01766301
017659          AND C.OFR_ID = H.OFR_ID                                 01766401
017660          AND G.OFR_ID = H.OFR_ID                                 01766501
017661          AND G.OFR_SECT_BWP_ID = H.OFR_SECT_BWP_ID               01766601
017662          AND G.BWP_DLT_IND  = 'N'                                01766701
017663          AND H.MDSE_DLT_IND = 'N'                                01766801
017664          ORDER BY C.OFR_ID                                       01766901
017665      END-EXEC.                                                   01767001
017666                                                                  01767101
017667     PERFORM                                                      01767201
017668         WITH TEST AFTER                                          01767301
017669         VARYING PV-SQL-SUB                                       01767401
017670         FROM 1 BY 1                                              01767501
017671         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 01767601
017672                   OR  SQLCODE = 0)                               01767701
017673                                                                  01767801
017674           EXEC SQL                                               01767901
017675              OPEN OFFERCRSR                                      01768001
017676           END-EXEC                                               01768101
017677                                                                  01768201
017678           EVALUATE TRUE                                          01768301
017679               WHEN SQLCODE = 0                                   01768401
017680                    CONTINUE                                      01768501
017681               WHEN SQLWARN0 NOT EQUAL SPACE                      01768601
017682               WHEN SQLCODE NOT EQUAL ZERO                        01768701
017683                    MOVE 'OPEN CURSOR FOR OFFERCRSR   '           01768801
017684                                       TO PV-ORA-OPERATION        01768901
017685                    MOVE '2400-DEC-OPEN-OFFER-CURSOR      '       01769001
017686                      TO PV-PARAGRAPH-NAME                        01769101
017687                    PERFORM 9900-ORA-ERROR                        01769201
017688           END-EVALUATE                                           01769301
017689                                                                  01769401
017690      END-PERFORM.                                                01769501
017691                                                                  01769601
017692*2400-EXIT.                                                       01769701
017693 EJECT.                                                           01769801
017694*----------------------------------------------------------       01769901
017695* 2500-FETCH-OFFER-CURSOR                                         01770001
017696* THIS PARAGRAPH WILL FETCH DATA FROM THE OFFERCRSR CURSOR        01770101
017697*                                                                 01770201
017698*----------------------------------------------------------       01770301
017699 2500-FETCH-OFFER-CURSOR.                                         01770401
017700                                                                  01770501
017701     INITIALIZE PV-NULL-INDICATORS.                               01770601
017702     SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                     01770701
017703                                                                  01770801
017704     EXEC SQL                                                     01770901
017705         FETCH OFFERCRSR                                          01771001
017706          INTO                                                    01771101
017707               :OMT00001.OFR-ID                                   01771201
017708              ,:OMT00001.EVNT-ID                                  01771301
017709              ,:OMT00001.OFR-NM                                   01771401
017710              ,:OMT00001.DISC-LVL-CDE                             01771501
017711              ,:OMT00001.OFR-USG-TYP-CDE                          01771601
017712              ,:OMT00001.BRCDE-TYP-CDE                            01771701
017713              ,:OMT00001.UNEARN-IND                               01771801
017714              ,:OMT00001.OFR-TRGR-TYP-CDE                         01771901
017715              ,:OMT00001.ITM-DISC-APPL-CDE                        01772001
017716               :PV-ITM-DISC-APL-NULL-IND                          01772101
017717              ,:OMT00009.EVNT-TYP-CDE                             01772201
017718              ,:OMT00007.EVNT-CTG-NM                              01772301
017719              ,:OMT00002.OFR-SECT-TYP-CDE                         01772401
017720              ,:OMT00002.EFF-BEG-TMST                             01772501
017721              ,:OMT00002.EFF-END-TMST                             01772601
017722              ,:OMT00002.TOL-STRT-NMOFDA-QTY                      01772701
017723              ,:OMT00002.TOL-END-NMOFDA-QTY                       01772801
017724              ,:OMT00002.REDMN-SUPVR-OVRRID-NMOFDA-QTY            01772901
017725              ,:OMT00002.LMT-PER-TRN-QTY                          01773001
017726              ,:OMT00002.BWP-GET-CNCTR-CDE                        01773101
017727              ,:OMT00002.BWP-BUY-CNCTR-CDE                        01773201
017728              ,:OMT00002.VLD-POS-TNDR-COMB-TYP-CDE                01773301
017729              ,:OMT00002.POS-BTN-CDE                              01773401
017730               :PV-POS-BTN-CDE-NULL-IND                           01773501
017731              ,:OMT00008.CUSTFACG-SHRT-DESC                       01773601
017732              ,:OMT00003.OFR-SECT-BWP-ID                          01773701
017733              ,:OMT00003.TIER-LVL-NBR                             01773801
017734              ,:OMT00003.BWP-SELN-TYP-CDE                         01773901
017735              ,:OMT00003.BWP-BUY-QTY                              01774001
017736               :PV-BWP-BUY-QTY-NULL-IND                           01774101
017737              ,:OMT00003.BWP-BUY-AMT                              01774201
017738               :PV-BWP-BUY-AMT-NULL-IND                           01774301
017739              ,:OMT00003.BWP-BUY-TOL-AMT                          01774401
017740               :PV-BWP-BUY-TOL-AMT-NULL-IND                       01774501
017741              ,:OMT00003.BWP-GET-QTY                              01774601
017742               :PV-BWP-GET-QTY-NULL-IND                           01774701
017743              ,:OMT00003.BWP-GET-PCT-OFF-PCT                      01774801
017744               :PV-BWP-GET-PCT-NULL-IND                           01774901
017745              ,:OMT00003.BWP-GET-DOL-OFF-AMT                      01775001
017746               :PV-BWP-GET-DOL-NULL-IND                           01775101
017747              ,:OMT00003.BWP-GET-PRPT-AMT                         01775201
017748               :PV-BWP-GET-PRPT-NULL-IND                          01775301
017749              ,:OMT00005.MDSE-SET-ID                              01775401
017750              ,:OMT00005.MDSE-HIER-CDE                            01775501
017751              ,:OMT00005.DEPT-NBR                                 01775601
017752               :PV-MDSE-DEPT-NBR-NULL-IND                         01775701
017753              ,:OMT00005.MAJ-CL-NBR                               01775801
017754               :PV-MDSE-MAJ-CLS-NULL-IND                          01775901
017755              ,:OMT00005.SUB-CL-NBR                               01776001
017756               :PV-MDSE-SUB-CLS-NULL-IND                          01776101
017757              ,:OMT00005.STYL-ID                                  01776201
017758               :PV-MDSE-STL-ID-NULL-IND                           01776301
017759              ,:OMT00005.SKU-NBR                                  01776401
017760               :PV-MDSE-SKU-NB-NULL-IND                           01776501
017761              ,:OMT00005.IE-IND                                   01776601
017762              ,:OMT00005.EMP-DISC-CDE                             01776701
017763               :PV-MDSE-EMP-DS-NULL-IND                           01776801
017764              ,:OMT00005.DISC-ELIG-IND                            01776901
017765               :PV-MDSE-DSC-EL-NULL-IND                           01777001
017766              ,:OMT00005.TKT-CLOR-CDE                             01777101
017767               :PV-MDSE-TKT-CL-NULL-IND                           01777201
017768     END-EXEC.                                                    01777301
017769                                                                  01777401
017770     EVALUATE TRUE                                                01777501
017771       WHEN SQLCODE IS EQUAL TO ZEROS                             01777601
017772           ADD 1 TO PV-OFFER-FETCHED                              01777701
017773           PERFORM EP208-1000-DETERMNE-FLD-OVRFLW                 01777801
017774           IF EPWS208-OFFER-DATA-IN-RANGE                         01777901
017775              PERFORM 2700-PROCESS-OFFER-DATA                     01778001
017776           END-IF                                                 01778101
017777       WHEN SQLCODE IS EQUAL TO 1403                              01778201
017778         SET PS-END-OF-FETCH-OF    TO TRUE                        01778301
017779       WHEN OTHER                                                 01778401
017780         MOVE 'FETCH DATA FROM OFFERCRSR '                        01778501
017781                                    TO PV-ORA-OPERATION           01778601
017782         MOVE '2500-FETCH-OFFER-CURSOR         '                  01778701
017783           TO PV-PARAGRAPH-NAME                                   01778801
017784         PERFORM 9900-ORA-ERROR                                   01778901
017785     END-EVALUATE.                                                01779001
017786*                                                                 01779101
017787*2500-EXIT.                                                       01779201
017788 EJECT.                                                           01779301
017789*----------------------------------------------------------       01779401
017790* 2700-PROCESS-OFFER-DATA                                         01779501
017800* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01780001
017810*                                                                 01781001
017811*----------------------------------------------------------       01781101
017812 2700-PROCESS-OFFER-DATA.                                         01781201
017813                                                                  01781301
017814     PERFORM 3000-MOVE-COMMON-VALUES.                             01781401
017815                                                                  01781501
017816     IF OFR-ID IN OMT00001 NOT = PV-OFR-ID                        01781601
017817        PERFORM 3100-WRITE-XST-OFR-DATA                           01781701
017818        PERFORM 3200-WRITE-XST-SEC-DATA                           01781801
017819        PERFORM 3300-WRITE-XST-BWP-DATA                           01781901
017820        PERFORM 3400-WRITE-XST-MDS-DATA                           01782001
017830     ELSE                                                         01783001
017831       IF OFR-ID IN OMT00001 = PV-OFR-ID AND                      01783101
017832          OFR-SECT-TYP-CDE IN OMT00002 NOT = PV-OFR-SECT-TYP-CDE  01783201
017833          PERFORM 3200-WRITE-XST-SEC-DATA                         01783301
017834          PERFORM 3300-WRITE-XST-BWP-DATA                         01783401
017835          PERFORM 3400-WRITE-XST-MDS-DATA                         01783501
017836       ELSE                                                       01783601
017837         IF OFR-ID IN OMT00001 = PV-OFR-ID AND                    01783701
017838            OFR-SECT-TYP-CDE IN OMT00002  =                       01783801
017839                                      PV-OFR-SECT-TYP-CDE AND     01783901
017840            OFR-SECT-BWP-ID IN OMT00003 NOT = PV-OFR-SECT-BWP-ID  01784001
017841            PERFORM 3300-WRITE-XST-BWP-DATA                       01784101
017842            PERFORM 3400-WRITE-XST-MDS-DATA                       01784201
017843         ELSE                                                     01784301
017844           IF OFR-ID IN OMT00001 = PV-OFR-ID AND                  01784401
017845              OFR-SECT-TYP-CDE IN OMT00002 =                      01784501
017846                                           PV-OFR-SECT-TYP-CDE AND01784601
017847              OFR-SECT-BWP-ID IN OMT00003  =                      01784701
017848                                           PV-OFR-SECT-BWP-ID AND 01784801
017849              MDSE-SET-ID IN OMT00005 NOT = PV-MDSE-SET-ID        01784901
017850              PERFORM 3400-WRITE-XST-MDS-DATA                     01785001
017851           END-IF                                                 01785101
017852         END-IF                                                   01785201
017853       END-IF                                                     01785301
017854     END-IF.                                                      01785401
017855                                                                  01785501
017856*2700-EXIT.                                                       01785601
017857 EJECT.                                                           01785701
017858*----------------------------------------------------------       01785801
017859* 3000-MOVE-COMMON-VALUES                                         01785901
017860* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01786001
017861*                                                                 01786101
017862*----------------------------------------------------------       01786201
017863 3000-MOVE-COMMON-VALUES.                                         01786301
017864                                                                  01786401
017865     SET EP205-TRIGGER-TYPE-ADD TO TRUE.                          01786501
017866     SET EP205-FILE-TYPE-NEW TO TRUE.                             01786601
017867     MOVE ZEROES TO EP205-STR-NBR.                                01786701
017868                                                                  01786801
017869     MOVE OFR-ID IN OMT00001 TO EP205-OFFER-ID.                   01786901
017870     MOVE EVNT-ID IN OMT00001 TO EP205-EVENT-ID.                  01787001
017871     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO                         01787101
017872                                      EP205-OFR-SECT-TYP-CDE.     01787201
017873                                                                  01787301
017874*3000-EXIT.                                                       01787401
017875 EJECT.                                                           01787501
017876*----------------------------------------------------------       01787601
017877* 3100-WRITE-XST-OFR-DATA                                         01787701
017878* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01787801
017879*                                                                 01787901
017880*----------------------------------------------------------       01788001
017881 3100-WRITE-XST-OFR-DATA.                                         01788101
017882                                                                  01788201
017883     INITIALIZE EP205-VARIABLE-DATA.                              01788301
017884     SET EP205-XST-OFFER TO TRUE.                                 01788401
017885                                                                  01788501
017886*    MOVE PC-PROMO-SCHM-CDE TO EP205-PROMO-SCHM-CDE.              01788601
017887                                                                  01788701
017888     EVALUATE TRUE                                                01788801
017889         WHEN EVNT-TYP-CDE   IN OMT00009 = 'SP'                   01788901
017890            MOVE PC-PROMO-SCHM-CDE-1008  TO                       01789001
017891                                      EP205-PROMO-SCHM-CDE        01789101
017892         WHEN EVNT-TYP-CDE   IN OMT00009 = 'TR'                   01789201
017893            MOVE PC-PROMO-SCHM-CDE-1009       TO                  01789301
017894                                      EP205-PROMO-SCHM-CDE        01789401
017895         WHEN EVNT-TYP-CDE   IN OMT00009 = 'BW'                   01789501
017896            MOVE PC-PROMO-SCHM-CDE-1010       TO                  01789601
017897                                      EP205-PROMO-SCHM-CDE        01789701
017898     END-EVALUATE.                                                01789801
017899                                                                  01789901
017900     MOVE EVNT-TYP-CDE IN OMT00009 TO EP205-EVENT-TYP-CODE.       01790001
017901     MOVE EVNT-CTG-NM IN OMT00007 TO EP205-EVENT-NAME.            01790101
017902     MOVE OFR-NM IN OMT00001 TO EP205-OFFER-NAME.                 01790201
017903     MOVE DISC-LVL-CDE IN  OMT00001 TO EP205-DISC-LEVEL-CODE.     01790301
017904     MOVE OFR-USG-TYP-CDE IN OMT00001 TO                          01790401
017905                                      EP205-OFFER-USAGE-TYPE-CODE.01790501
017906     MOVE BRCDE-TYP-CDE IN OMT00001 TO EP205-BARCODE-TYPE-CODE.   01790601
017907     MOVE UNEARN-IND IN OMT00001 TO EP205-UNEARN-IND.             01790701
017908     MOVE OFR-TRGR-TYP-CDE IN OMT00001 TO EP205-OFR-TRGR-TYP-CDE. 01790801
017909                                                                  01790901
017910     IF PV-ITM-DISC-APL-NULL-IND = -1                             01791001
017911        MOVE PC-NULL-VALUE    TO EP205-BWP-ITM-APPL-CDE           01791101
017912     ELSE                                                         01791201
017913        MOVE ITM-DISC-APPL-CDE IN OMT00001 TO                     01791301
017914                                        EP205-BWP-ITM-APPL-CDE    01791401
017915     END-IF.                                                      01791501
017916                                                                  01791601
017917     MOVE SPACES TO NEXT-FUTURE-DAY-RECORD.                       01791701
017918     MOVE EP205-OFFER-EXTRACT         TO NEXT-FUTURE-DAY-RECORD.  01791801
017919     WRITE  NEXT-FUTURE-DAY-RECORD.                               01791901
017920     ADD 1 TO PV-OFFER-WRITEN.                                    01792001
017921     MOVE OFR-ID IN OMT00001 TO PV-OFR-ID.                        01792101
017922     MOVE EVNT-ID IN OMT00001 TO PV-EVNT-ID.                      01792201
017923                                                                  01792301
017924*3100-EXIT.                                                       01792401
017925 EJECT.                                                           01792501
017926*----------------------------------------------------------       01792601
017927* 3200-WRITE-XST-SEC-DATA                                         01792701
017928* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01792801
017929*                                                                 01792901
017930*----------------------------------------------------------       01793001
017931 3200-WRITE-XST-SEC-DATA.                                         01793101
017932                                                                  01793201
017933     INITIALIZE EP205-VARIABLE-DATA.                              01793301
017934     SET EP205-XST-OFR-SECT TO TRUE.                              01793401
017935                                                                  01793501
017936     PERFORM 3250-CALCULATE-DATES.                                01793601
017937     MOVE BWP-GET-CNCTR-CDE IN OMT00002 TO                        01793701
017938                                         EP205-BWP-GET-CNCTR-CDE. 01793801
017939     MOVE BWP-BUY-CNCTR-CDE IN OMT00002 TO                        01793901
017940                                         EP205-BWP-BUY-CNCTR-CDE. 01794001
017941     MOVE VLD-POS-TNDR-COMB-TYP-CDE IN OMT00002 TO                01794101
017942                                  EP205-VLD-POS-TNDR-CMP-TYP-CDE. 01794201
017943     MOVE LMT-PER-TRN-QTY   IN OMT00002 TO EP205-LMT-PER-TRN-QTY. 01794301
017944     MOVE CUSTFACG-SHRT-DESC IN OMT00008 TO                       01794401
017945                                        EP205-CUSTFACG-SHRT-DESC. 01794501
017946                                                                  01794601
017947     IF PV-POS-BTN-CDE-NULL-IND = -1                              01794701
017948         MOVE PC-NULL-VALUE TO EP205-POS-BTN-TXT                  01794801
017949         MOVE PC-NULL-VALUE TO EP205-POS-BTN-RLTV-SEQ-NBR-X       01794901
017950     ELSE                                                         01795001
017951         PERFORM 3500-POPULATE-BTN-VALUE                          01795101
017952     END-IF.                                                      01795201
017953                                                                  01795301
017954     MOVE SPACES TO NEXT-FUTURE-DAY-RECORD.                       01795401
017955     MOVE EP205-OFFER-EXTRACT        TO NEXT-FUTURE-DAY-RECORD.   01795501
017956                                                                  01795601
017957     WRITE NEXT-FUTURE-DAY-RECORD.                                01795701
017958     ADD 1 TO PV-OFFER-SECTION.                                   01795801
017959     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO PV-OFR-SECT-TYP-CDE.    01795901
017960                                                                  01796001
017961*3200-EXIT.                                                       01796101
017962 EJECT.                                                           01796201
017963*----------------------------------------------------------       01796301
017964* 3250-CALCULATE-DATES                                            01796401
017965* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01796501
017966*                                                                 01796601
017967*----------------------------------------------------------       01796701
017968 3250-CALCULATE-DATES.                                            01796801
017969                                                                  01796901
017970     IF TOL-STRT-NMOFDA-QTY IN OMT00002 = 0                       01797001
017971        MOVE EFF-BEG-TMST IN OMT00002 TO PV-EFF-BEG-TMST          01797101
017972        MOVE PV-EFF-BEG-DATE          TO PV-FORMAT-DATE           01797201
017973        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             01797301
017974        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               01797401
017975        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               01797501
017976        MOVE PV-EFF-DATE          TO EP205-EFF-BEG-DTE            01797601
017977     ELSE                                                         01797701
017978        PERFORM 4100-CALC-EFF-BEG-DATE                            01797801
017979     END-IF.                                                      01797901
017980                                                                  01798001
017981     IF TOL-END-NMOFDA-QTY IN OMT00002 = 0                        01798101
017982        MOVE EFF-END-TMST IN OMT00002 TO PV-EFF-END-TMST          01798201
017983        MOVE PV-EFF-END-DATE          TO PV-FORMAT-DATE           01798301
017984        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             01798401
017985        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               01798501
017986        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               01798601
017987        MOVE PV-EFF-DATE              TO EP205-EFF-END-DTE        01798701
017988        MOVE PV-EFF-DATE           TO EP205-REDMN-SUPVR-OVRRID-DTE01798801
017989     ELSE                                                         01798901
017990        PERFORM 4200-CALC-EFF-END-DATE                            01799001
017991     END-IF.                                                      01799101
017992                                                                  01799201
017993     IF REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 = 0             01799301
017994        MOVE EP205-EFF-END-DTE     TO EP205-REDMN-SUPVR-OVRRID-DTE01799401
017995     ELSE                                                         01799501
017996        PERFORM 4300-CALC-SUP-END-DATE                            01799601
017997     END-IF.                                                      01799701
017998                                                                  01799801
017999*3250-EXIT.                                                       01799901
018000 EJECT.                                                           01800001
018001*----------------------------------------------------------       01800101
018002* 3300-WRITE-XST-BWP-DATA                                         01800201
018003* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01800301
018004*                                                                 01800401
018005*----------------------------------------------------------       01800501
018006 3300-WRITE-XST-BWP-DATA.                                         01800601
018007                                                                  01800701
018008     INITIALIZE EP205-VARIABLE-DATA.                              01800801
018009     SET EP205-XST-OFR-BWP TO TRUE.                               01800901
018010                                                                  01801001
018011     MOVE OFR-SECT-BWP-ID IN OMT00003 TO EP205-OFR-SECT-BWP-ID.   01801101
018012     MOVE TIER-LVL-NBR    IN OMT00003 TO EP205-TIER-LVL-NBR.      01801201
018013     MOVE BWP-SELN-TYP-CDE IN OMT00003 TO EP205-BWP-SELN-TYP-CDE. 01801301
018014                                                                  01801401
018015     IF PV-BWP-BUY-QTY-NULL-IND = -1                              01801501
018016        MOVE PC-NULL-VALUE TO EP205-BWP-BUY-QTY-X                 01801601
018017     ELSE                                                         01801701
018018        MOVE BWP-BUY-QTY     IN OMT00003 TO EP205-BWP-BUY-QTY     01801801
018019     END-IF.                                                      01801901
018020                                                                  01802001
018021     IF PV-BWP-BUY-AMT-NULL-IND = -1                              01802101
018022        MOVE PC-NULL-VALUE TO EP205-BWP-BUY-AMT-X                 01802201
018023     ELSE                                                         01802301
018024        MOVE BWP-BUY-AMT     IN OMT00003 TO EP205-BWP-BUY-AMT     01802401
018025     END-IF.                                                      01802501
018026                                                                  01802601
018027     IF PV-BWP-BUY-TOL-AMT-NULL-IND = -1                          01802701
018028        MOVE PC-NULL-VALUE TO EP205-BWP-BUY-TOL-AMT-X             01802801
018029     ELSE                                                         01802901
018030        MOVE BWP-BUY-TOL-AMT IN OMT00003 TO EP205-BWP-BUY-TOL-AMT 01803001
018031     END-IF.                                                      01803101
018032                                                                  01803201
018033     IF PV-BWP-GET-QTY-NULL-IND = -1                              01803301
018034        MOVE PC-NULL-VALUE TO EP205-BWP-GET-QTY-X                 01803401
018035     ELSE                                                         01803501
018036        MOVE BWP-GET-QTY     IN OMT00003 TO EP205-BWP-GET-QTY     01803601
018037     END-IF.                                                      01803701
018038                                                                  01803801
018039     IF PV-BWP-GET-PCT-NULL-IND = -1                              01803901
018040        MOVE PC-NULL-VALUE TO EP205-BWP-GET-PCT-OFF-PCT-X         01804001
018041     ELSE                                                         01804101
018042        MOVE BWP-GET-PCT-OFF-PCT   IN OMT00003 TO                 01804201
018043                                       EP205-BWP-GET-PCT-OFF-PCT  01804301
018044     END-IF.                                                      01804401
018045                                                                  01804501
018046     IF PV-BWP-GET-DOL-NULL-IND = -1                              01804601
018047        MOVE PC-NULL-VALUE TO EP205-BWP-GET-DOL-OFF-AMT-X         01804701
018048     ELSE                                                         01804801
018049        MOVE BWP-GET-DOL-OFF-AMT   IN OMT00003 TO                 01804901
018050                                       EP205-BWP-GET-DOL-OFF-AMT  01805001
018051     END-IF.                                                      01805101
018052                                                                  01805201
018053     IF PV-BWP-GET-PRPT-NULL-IND = -1                             01805301
018054        MOVE PC-NULL-VALUE TO EP205-BWP-GET-PRPT-AMT-X            01805401
018055     ELSE                                                         01805501
018056        MOVE BWP-GET-PRPT-AMT  IN OMT00003                        01805601
018057                                     TO EP205-BWP-GET-PRPT-AMT    01805701
018058     END-IF.                                                      01805801
018059                                                                  01805901
018060     MOVE SPACES TO NEXT-FUTURE-DAY-RECORD.                       01806001
018061     MOVE EP205-OFFER-EXTRACT        TO NEXT-FUTURE-DAY-RECORD.   01806101
018062                                                                  01806201
018063     WRITE NEXT-FUTURE-DAY-RECORD.                                01806301
018064     ADD 1 TO PV-OFFER-BWP.                                       01806401
018065     MOVE OFR-SECT-BWP-ID IN OMT00003  TO PV-OFR-SECT-BWP-ID.     01806501
018066                                                                  01806601
018067*3300-EXIT.                                                       01806701
018068 EJECT.                                                           01806801
018069*----------------------------------------------------------       01806901
018070* 3400-WRITE-XST-MDS-DATA                                         01807001
018071* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITEN OUT  01807101
018072*                                                                 01807201
018073*----------------------------------------------------------       01807301
018074 3400-WRITE-XST-MDS-DATA.                                         01807401
018075                                                                  01807501
018076     INITIALIZE EP205-VARIABLE-DATA.                              01807601
018077     SET EP205-XST-OFR-MDSE TO TRUE.                              01807701
018078                                                                  01807801
018079     MOVE OFR-SECT-BWP-ID IN OMT00003 TO EP205-OFR-SECT-BWP-ID-M. 01807901
018080     MOVE MDSE-SET-ID    IN OMT00005 TO EP205-MDSE-SET-ID.        01808001
018081     MOVE MDSE-HIER-CDE  IN OMT00005 TO EP205-MDSE-HIER-CDE.      01808101
018082                                                                  01808201
018083     IF PV-MDSE-DEPT-NBR-NULL-IND = -1                            01808301
018084        MOVE PC-NULL-VALUE TO EP205-DEPT-NBR-X                    01808401
018085     ELSE                                                         01808501
018086        MOVE DEPT-NBR       IN OMT00005 TO EP205-DEPT-NBR         01808601
018087     END-IF.                                                      01808701
018088                                                                  01808801
018089     IF PV-MDSE-MAJ-CLS-NULL-IND = -1                             01808901
018090        MOVE PC-NULL-VALUE TO EP205-MAJ-CL-NBR-X                  01809001
018091     ELSE                                                         01809101
018092        MOVE MAJ-CL-NBR     IN OMT00005 TO EP205-MAJ-CL-NBR       01809201
018093     END-IF.                                                      01809301
018094                                                                  01809401
018095     IF PV-MDSE-SUB-CLS-NULL-IND = -1                             01809501
018096        MOVE PC-NULL-VALUE TO EP205-SUB-CL-NBR-X                  01809601
018097     ELSE                                                         01809701
018098        MOVE SUB-CL-NBR     IN OMT00005 TO EP205-SUB-CL-NBR       01809801
018099     END-IF.                                                      01809901
018100                                                                  01810001
018101     IF PV-MDSE-STL-ID-NULL-IND = -1                              01810101
018102        MOVE PC-NULL-VALUE TO EP205-STYL-ID-X                     01810201
018103     ELSE                                                         01810301
018104        MOVE STYL-ID        IN OMT00005 TO EP205-STYL-ID          01810401
018105     END-IF.                                                      01810501
018106                                                                  01810601
018107     IF PV-MDSE-SKU-NB-NULL-IND = -1                              01810701
018108        MOVE PC-NULL-VALUE TO EP205-SKU-NBR-X                     01810801
018109     ELSE                                                         01810901
018110        MOVE SKU-NBR        IN OMT00005 TO EP205-SKU-NBR          01811001
018111     END-IF.                                                      01811101
018112                                                                  01811201
018113     MOVE IE-IND         IN OMT00005 TO EP205-IE-IND.             01811301
018114                                                                  01811401
018115     IF PV-MDSE-EMP-DS-NULL-IND = -1                              01811501
018116        MOVE PC-NULL-VALUE TO EP205-EMP-DISC-CDE                  01811601
018117     ELSE                                                         01811701
018118        MOVE EMP-DISC-CDE   IN OMT00005 TO EP205-EMP-DISC-CDE     01811801
018119     END-IF.                                                      01811901
018120                                                                  01812001
018121     IF PV-MDSE-DSC-EL-NULL-IND = -1                              01812101
018122        MOVE PC-NULL-VALUE TO EP205-DISC-ELIG-IND                 01812201
018123     ELSE                                                         01812301
018124        MOVE DISC-ELIG-IND  IN OMT00005 TO EP205-DISC-ELIG-IND    01812401
018125     END-IF.                                                      01812501
018126                                                                  01812601
018127     IF PV-MDSE-TKT-CL-NULL-IND = -1                              01812701
018128        MOVE PC-NULL-VALUE TO EP205-TKT-CLOR-CDE                  01812801
018129     ELSE                                                         01812901
018130        MOVE TKT-CLOR-CDE   IN OMT00005 TO EP205-TKT-CLOR-CDE     01813001
018131     END-IF.                                                      01813101
018132                                                                  01813201
018133     MOVE SPACES TO NEXT-FUTURE-DAY-RECORD.                       01813301
018134     MOVE EP205-OFFER-EXTRACT        TO NEXT-FUTURE-DAY-RECORD.   01813401
018135                                                                  01813501
018136     WRITE NEXT-FUTURE-DAY-RECORD.                                01813601
018137     ADD 1 TO PV-OFFER-MDSE.                                      01813701
018138     MOVE MDSE-SET-ID IN OMT00005 TO PV-MDSE-SET-ID.              01813801
018139                                                                  01813901
018140*3400-EXIT.                                                       01814001
018141 EJECT.                                                           01814101
018142*----------------------------------------------------------       01814201
018143* 3500-POPULATE-BTN-VALUE                                         01814301
018144*THIS PARAGRAPH WILL POPULATE THE POS-BTN-TXT AND THE             01814401
018145* POS-BTN-RLTV-SEQ-NBR IN THE OUPUT FILE, FOR A NON NULL          01814501
018146* VALUE OF POS-BTN-CDE IN OMT_OFR_SECT TABLE                      01814601
018147*----------------------------------------------------------       01814701
018148 3500-POPULATE-BTN-VALUE.                                         01814801
018149                                                                  01814901
018150     SET PV-BTN-INDEX TO 1                                        01815001
018151     SEARCH PV-BTN-RECORD                                         01815101
018152       VARYING PV-BTN-INDEX                                       01815201
018153       AT END                                                     01815301
018154           DISPLAY ' BTN CODE NOT FOUND IN TABLE'                 01815401
018155                                                                  01815501
018156      WHEN PV-POS-BTN-CDE(PV-BTN-INDEX) = POS-BTN-CDE IN OMT00002 01815601
018157         MOVE PV-POS-BTN-TEXT(PV-BTN-INDEX) TO EP205-POS-BTN-TXT  01815701
018158         MOVE PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX) TO            01815801
018159                                      EP205-POS-BTN-RLTV-SEQ-NBR  01815901
018160     END-SEARCH.                                                  01816001
018161                                                                  01816101
018162*3500-EXIT.                                                       01816201
018163 EJECT.                                                           01816301
018164*----------------------------------------------------------       01816401
018165* 4100-CALC-EFF-BEG-DATE                                          01816501
018166* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     01816601
018167* THE EFFECTIVE BEGIN DATE FOR THE POS STORE SERVER DB.           01816701
018168* WHICH WILL BE THE (EFF-BEG-TMST - TOL-START-QTY)                01816801
018169*----------------------------------------------------------       01816901
018170 4100-CALC-EFF-BEG-DATE.                                          01817001
018171                                                                  01817101
018172     MOVE EFF-BEG-TMST IN OMT00002 TO PV-EFF-BEG-TMST.            01817201
018173     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01817301
018174     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01817401
018175     SET DPG51-DECREMENT-DATE      TO TRUE.                       01817501
018176     MOVE TOL-STRT-NMOFDA-QTY  IN OMT00002  TO                    01817601
018177                                    DPG51-INCR-DECR-DAYS-9.       01817701
018178     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       01817801
018179     MOVE PV-EFF-BEG-DATE          TO DPG52-LK-DATE-INPUT.        01817901
018180                                                                  01818001
018181     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          01818101
018182                                             DPG53 DPG54          01818201
018183                                             DPG55 DPG56.         01818301
018184                                                                  01818401
018185     EVALUATE TRUE                                                01818501
018186         WHEN DPG54-NO-ERROR                                      01818601
018187             DISPLAY 'DAYS PRIOR NEEDED: ' TOL-STRT-NMOFDA-QTY IN 01818701
018188                                           OMT00002               01818801
018189             DISPLAY 'RETRIEVING EFF BEGIN DATE'                  01818901
018190         WHEN OTHER                                               01819001
018191             DISPLAY ' '                                          01819101
018192             DISPLAY '** ABEND ** IN EPKUT208'                    01819201
018193             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    01819301
018194             DISPLAY '** CALLED BY 4100-CALC-EFF-BEG-DATE'        01819401
018195             DISPLAY '** ERROR MESSAGE = '                        01819501
018196                               DPG54-ERROR-MESSAGE                01819601
018197             DISPLAY '** DPG55-DB2-ISO-DATE **'                   01819701
018198             DISPLAY DPG55-DB2-ISO-DATE                           01819801
018199             DISPLAY '** DPG52-LK-DATE-INPUT **'                  01819901
018200             DISPLAY DPG52-LK-DATE-INPUT                          01820001
018201             MOVE '4100-CALC-EFF-BEG-DATE'                        01820101
018202                                           TO PV-PARAGRAPH-NAME   01820201
018203             MOVE 'ERROR VALIDATING INPUT DATE'                   01820301
018204                                           TO PV-OPERATION-MSG-1  01820401
018205             SET AC-4019-CALENDAR-ROUTINE-ERR TO TRUE             01820501
018206             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  01820601
018207             PERFORM 9910-ABEND                                   01820701
018208      END-EVALUATE.                                               01820801
018209                                                                  01820901
018210      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-BEG-DTE.           01821001
018211                                                                  01821101
018212*4100-EXIT.                                                       01821201
018213 EJECT.                                                           01821301
018214                                                                  01821401
018215*----------------------------------------------------------       01821501
018216* 4200-CALC-EFF-END-DATE                                          01821601
018217* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     01821701
018218* THE EFFECTIVE END DATE FOR THE POS STORE SERVER DB.             01821801
018219* WHICH WILL BE THE (EFF-END-TMST - TOL-END-QTY)                  01821901
018220*----------------------------------------------------------       01822001
018221 4200-CALC-EFF-END-DATE.                                          01822101
018222                                                                  01822201
018223     MOVE EFF-END-TMST IN OMT00002 TO PV-EFF-END-TMST.            01822301
018224     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01822401
018225     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01822501
018226     SET DPG51-INCREMENT-DATE      TO TRUE.                       01822601
018227     MOVE TOL-END-NMOFDA-QTY  IN OMT00002 TO                      01822701
018228                                    DPG51-INCR-DECR-DAYS-9.       01822801
018229     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       01822901
018230     MOVE PV-EFF-END-DATE          TO DPG52-LK-DATE-INPUT.        01823001
018231                                                                  01823101
018232     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          01823201
018233                                             DPG53 DPG54          01823301
018234                                             DPG55 DPG56.         01823401
018235                                                                  01823501
018236     EVALUATE TRUE                                                01823601
018237         WHEN DPG54-NO-ERROR                                      01823701
018238             DISPLAY 'RETRIEVING EFF  END  DATE'                  01823801
018239         WHEN OTHER                                               01823901
018240             DISPLAY ' '                                          01824001
018241             DISPLAY '** ABEND ** IN EPKUT208'                    01824101
018242             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    01824201
018243             DISPLAY '** CALLED BY 4200-CALC-EFF-END-DATE'        01824301
018244             DISPLAY '** ERROR MESSAGE = '                        01824401
018245                               DPG54-ERROR-MESSAGE                01824501
018246             DISPLAY '** DPG55-DB2-ISO-DATE **'                   01824601
018247             DISPLAY DPG55-DB2-ISO-DATE                           01824701
018248             DISPLAY '** DPG52-LK-DATE-INPUT **'                  01824801
018249             DISPLAY DPG52-LK-DATE-INPUT                          01824901
018250             MOVE '4200-CALC-EFF-END-DATE'                        01825001
018251                                           TO PV-PARAGRAPH-NAME   01825101
018252             MOVE 'ERROR VALIDATING INPUT DATE'                   01825201
018253                                           TO PV-OPERATION-MSG-1  01825301
018254             SET AC-4019-CALENDAR-ROUTINE-ERR TO TRUE             01825401
018255             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  01825501
018256             PERFORM 9910-ABEND                                   01825601
018257      END-EVALUATE.                                               01825701
018258                                                                  01825801
018259      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-END-DTE.           01825901
018260                                                                  01826001
018261*4200-EXIT.                                                       01826101
018262 EJECT.                                                           01826201
018263                                                                  01826301
018264*----------------------------------------------------------       01826401
018265* 4300-CALC-SUP-END-DATE                                          01826501
018266* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     01826601
018267* THE SUPERVISOR END DATE FOR THE POS STORE SERVER DB.            01826701
018268* WHICH WILL BE THE (EFF-END-TMST - TOL-END-QTY) - REDMN-SUVR-QTY 01826801
018269*----------------------------------------------------------       01826901
018270 4300-CALC-SUP-END-DATE.                                          01827001
018271                                                                  01827101
018272     MOVE EFF-END-TMST IN OMT00002 TO PV-EFF-END-TMST.            01827201
018273     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01827301
018274     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01827401
018275     SET DPG51-INCREMENT-DATE      TO TRUE.                       01827501
018276     ADD  TOL-END-NMOFDA-QTY IN OMT00002   TO                     01827601
018277          REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002               01827701
018278     MOVE REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 TO            01827801
018279                                    DPG51-INCR-DECR-DAYS-9.       01827901
018280     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       01828001
018290     MOVE PV-EFF-END-DATE          TO DPG52-LK-DATE-INPUT.        01829001
018291                                                                  01829101
018292     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          01829201
018293                                             DPG53 DPG54          01829301
018294                                             DPG55 DPG56.         01829401
018295                                                                  01829501
018296     EVALUATE TRUE                                                01829601
018297         WHEN DPG54-NO-ERROR                                      01829701
018298             DISPLAY 'RETRIEVING SUPV END  DATE'                  01829801
018299         WHEN OTHER                                               01829901
018300             DISPLAY ' '                                          01830001
018301             DISPLAY '** ABEND ** IN EPKUT208'                    01830101
018302             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    01830201
018303             DISPLAY '** CALLED BY 4300-CALC-SUP-END-DATE'        01830301
018304             DISPLAY '** ERROR MESSAGE = '                        01830401
018305                               DPG54-ERROR-MESSAGE                01830501
018306             DISPLAY '** DPG55-DB2-ISO-DATE **'                   01830601
018307             DISPLAY DPG55-DB2-ISO-DATE                           01830701
018308             DISPLAY '** DPG52-LK-DATE-INPUT **'                  01830801
018309             DISPLAY DPG52-LK-DATE-INPUT                          01830901
018310             MOVE '4300-CALC-SUP-END-DATE'                        01831001
018320                                           TO PV-PARAGRAPH-NAME   01832001
018321             MOVE 'ERROR VALIDATING INPUT DATE'                   01832101
018322                                           TO PV-OPERATION-MSG-1  01832201
018323             SET AC-4019-CALENDAR-ROUTINE-ERR TO TRUE             01832301
018324             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  01832401
018325             PERFORM 9910-ABEND                                   01832501
018326      END-EVALUATE.                                               01832601
018327                                                                  01832701
018328      MOVE DPG55-DB2-ISO-DATE     TO EP205-REDMN-SUPVR-OVRRID-DTE.01832801
018329                                                                  01832901
018330*4300-EXIT.                                                       01833001
018331 EJECT.                                                           01833101
018332                                                                  01833201
018333*----------------------------------------------------------       01833301
018334* 5000-EXTRACT-OFFER-STORES.                                      01833401
018335* ----------------------------                                    01833501
018336* THIS PARAGRAPH WILL PERFORM THE FOLLOWING:                      01833601
018337* (1) DECLARE AND OPEN THE STORE GROUP CURSOR                     01833701
018338*                                                                 01833801
018339* (2) EXTRACT THE STORE GROUP TYPE CODE AND THE STORE GROUP ID    01833901
018340*     FOR ALL THE FUTURE DATE OFFERS                              01834001
018341*                                                                 01834101
018342* (3) WRITE THE INFORMATION OUT TO THE STORE GROUP FILE           01834201
018343*                                                                 01834301
018344*----------------------------------------------------------       01834401
018345 5000-EXTRACT-OFFER-STORES.                                       01834501
018346                                                                  01834601
018347     PERFORM 5100-DEC-OPEN-STR-CURSOR.                            01834701
018348                                                                  01834801
018349     SET PS-NOT-END-OF-FETCH-STR TO TRUE.                         01834901
018350                                                                  01835001
018351     PERFORM 5150-FETCH-STR-CURSOR                                01835101
018352          UNTIL PS-END-OF-FETCH-STR.                              01835201
018353                                                                  01835301
018354*5000-EXIT.                                                       01835401
018355 EJECT.                                                           01835501
018356                                                                  01835601
018357*----------------------------------------------------------       01835701
018358* 5100-DEC-OPEN-STR-CURSOR.                                       01835801
018359* THIS PARAGRAPH WILL DECLARE AND OPEN STRCRSR                    01835901
018360*----------------------------------------------------------       01836001
018361 5100-DEC-OPEN-STR-CURSOR.                                        01836101
018362                                                                  01836201
018363        EXEC SQL  DECLARE STRCRSR CURSOR FOR                      01836301
018364           SELECT                                                 01836401
018365               A.EVNT_ID                                          01836501
018366              ,A.OFR_ID                                           01836601
018367              ,A.OFR_SECT_TYP_CDE                                 01836701
018368              ,A.STR_GP_TYP_CDE                                   01836801
018369              ,A.STR_GP_ID                                        01836901
018370              ,A.IE_IND                                           01837001
018371          FROM OMT_OFR_LOC_GP A                                   01837101
018372              ,OMT_OFR_SECT B                                     01837201
018373              ,OMT_OFR C                                          01837301
018374          WHERE                                                   01837401
018375                B.EFF_BEG_TMST = TO_DATE(:PV-FUTURE-ORACLE-DTE    01837501
018376                                          ,'DD-MON-YY') +         01837601
018377                                       B.TOL_STRT_NMOFDA_QTY      01837701
018378            AND A.EVNT_ID = B.EVNT_ID                             01837801
018379            AND A.EVNT_ID = C.EVNT_ID                             01837901
018380            AND B.EVNT_ID = C.EVNT_ID                             01838001
018381            AND A.OFR_ID  = B.OFR_ID                              01838101
018382            AND B.OFR_ID  = C.OFR_ID                              01838201
018383            AND A.OFR_ID  = C.OFR_ID                              01838301
018384            AND C.OFR_STAT_CDE = 'A'                              01838401
018385            AND A.OFR_SECT_TYP_CDE = B.OFR_SECT_TYP_CDE           01838501
018386            AND A.LOC_DLT_IND = 'N'                               01838601
018387            ORDER BY A.OFR_ID,                                    01838701
018388                     A.IE_IND DESC,                               01838801
018389                     A.STR_GP_TYP_CDE                             01838901
018390        END-EXEC.                                                 01839001
018391                                                                  01839101
018392     PERFORM                                                      01839201
018393         WITH TEST AFTER                                          01839301
018394         VARYING PV-SQL-SUB                                       01839401
018395         FROM 1 BY 1                                              01839501
018396         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 01839601
018397                   OR  SQLCODE = 0)                               01839701
018398                                                                  01839801
018399           EXEC SQL                                               01839901
018400              OPEN STRCRSR                                        01840001
018401           END-EXEC                                               01840101
018402                                                                  01840201
018403           EVALUATE TRUE                                          01840301
018404               WHEN SQLCODE = 0                                   01840401
018405                    CONTINUE                                      01840501
018406               WHEN SQLCODE NOT EQUAL ZERO                        01840601
018407                    MOVE 'OPEN CURSOR FOR STRCRSR     '           01840701
018408                                       TO PV-ORA-OPERATION        01840801
018409                    MOVE '5100-DEC-OPEN-STR-CURSOR        '       01840901
018410                      TO PV-PARAGRAPH-NAME                        01841001
018411                    PERFORM 9900-ORA-ERROR                        01841101
018412           END-EVALUATE                                           01841201
018413                                                                  01841301
018414     END-PERFORM.                                                 01841401
018415                                                                  01841501
018416*5100-EXIT.                                                       01841601
018417 EJECT.                                                           01841701
018418*----------------------------------------------------------       01841801
018419* 5150-FETCH-STR-CURSOR                                           01841901
018420* THIS PARAGRAPH WILL FETCH DATA FROM THE BTNCRSR CURSOR          01842001
018421*  AND POPULATE THE PROGRAM TABLE (PV-OMT-POS-BTN)                01842101
018422*----------------------------------------------------------       01842201
018423 5150-FETCH-STR-CURSOR.                                           01842301
018424                                                                  01842401
018425                                                                  01842501
018426     EXEC SQL                                                     01842601
018427         FETCH STRCRSR                                            01842701
018428          INTO                                                    01842801
018429               :OMT00004.EVNT-ID                                  01842901
018430              ,:OMT00004.OFR-ID                                   01843001
018431              ,:OMT00004.OFR-SECT-TYP-CDE                         01843101
018432              ,:OMT00004.STR-GP-TYP-CDE                           01843201
018433              ,:OMT00004.STR-GP-ID                                01843301
018434              ,:OMT00004.IE-IND                                   01843401
018435     END-EXEC.                                                    01843501
018436                                                                  01843601
018437      EVALUATE TRUE                                               01843701
018438       WHEN SQLCODE IS EQUAL TO ZEROS                             01843801
018439           ADD 1 TO PV-OFFER-STORE-FETCHED                        01843901
018440                                                                  01844001
018441           PERFORM 5200-WRITE-STORE-GROUP                         01844101
018442                                                                  01844201
018443       WHEN SQLCODE IS EQUAL TO 1403                              01844301
018444           SET PS-END-OF-FETCH-STR   TO TRUE                      01844401
018445       WHEN OTHER                                                 01844501
018446           MOVE 'FETCH DATA FROM STRCRSR   '                      01844601
018447                                    TO PV-ORA-OPERATION           01844701
018448           MOVE '5150-FETCH-STR-CURSOR           '                01844801
018449             TO PV-PARAGRAPH-NAME                                 01844901
018450           PERFORM 9900-ORA-ERROR                                 01845001
018451      END-EVALUATE.                                               01845101
018452*                                                                 01845201
018453*5150-EXIT.                                                       01845301
018454 EJECT.                                                           01845401
018455*----------------------------------------------------------       01845501
018456* 5200-WRITE-STORE-GROUP                                          01845601
018457* THIS PARAGRAPH WILL WRITE THE FETCHED DATA FROM STRCRSR         01845701
018458*  TO STORE GROUP FILE                                            01845801
018459*----------------------------------------------------------       01845901
018460 5200-WRITE-STORE-GROUP.                                          01846001
018461     MOVE EVNT-ID IN OMT00004 TO EP206-EVENT-ID.                  01846101
018462     MOVE OFR-ID  IN OMT00004 TO EP206-OFFER-ID.                  01846201
018463     MOVE OFR-SECT-TYP-CDE IN OMT00004 TO EP206-OFR-SECT-TYP-CDE. 01846301
018464     MOVE STR-GP-TYP-CDE IN OMT00004 TO EP206-STR-GRP-TYP-CDE.    01846401
018465     MOVE STR-GP-ID IN OMT00004 TO EP206-STR-GRP-ID               01846501
018466     MOVE IE-IND IN OMT00004  TO EP206-IE-IND                     01846601
018467     SET EP206-ADD TO TRUE.                                       01846701
018468                                                                  01846801
018469     MOVE EP206-STORE-LIST-RCD TO STORE-GROUP-RECORD.             01846901
018470                                                                  01847001
018471     ADD 1 TO PV-OFFER-STORE-WRITEN.                              01847101
018472     WRITE STORE-GROUP-RECORD.                                    01847201
018473                                                                  01847301
018474*5200-EXIT.                                                       01847401
018475 EJECT.                                                           01847501
018476******************************************************************01847601
018477* 6000-VALIDATE-DATE-INPUT.                                       01847701
018478*     VALIDIATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR      01847801
018479*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.     01847901
018480******************************************************************01848001
018481 6000-VALIDATE-DATE-INPUT.                                        01848101
018482     MOVE '6000-VALIDATE-DATE-INPUT   ' TO PV-PARAGRAPH-NAME.     01848201
018483                                                                  01848301
018484     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01848401
018485     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      01848501
018486     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      01848601
018487                                                                  01848701
018488     MOVE EP252-CC-FUTURE-DATE      TO DPG52-LK-DATE-INPUT.       01848801
018489                                                                  01848901
018490     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    01849001
018491                                             DPG54 DPG55 DPG56.   01849101
018492                                                                  01849201
018493     EVALUATE TRUE                                                01849301
018494        WHEN DPG54-NO-ERROR                                       01849401
018495           CONTINUE                                               01849501
018496        WHEN OTHER                                                01849601
018497           DISPLAY ' '                                            01849701
018498           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      01849801
018499           DISPLAY '** CALLED BY 6000-VALIDATE-DATE-INPUT'        01849901
018500           DISPLAY '** ERROR MESSAGE = '                          01850001
018501                             DPG54-ERROR-MESSAGE                  01850101
018502           DISPLAY '** DPG52-LK-DATE-INPUT **'                    01850201
018503           DISPLAY DPG52-LK-DATE-INPUT                            01850301
018504           MOVE '6000-VALIDATE-DATE-INPUT ' TO PV-PARAGRAPH-NAME  01850401
018505           MOVE 'INVALID DATE PASSED IN CC' TO PV-OPERATION-MSG-1 01850501
018506           MOVE  DPG54-ERROR-MESSAGE        TO PV-OPERATION-MSG-2 01850601
018507           SET AC-4019-CALENDAR-ROUTINE-ERR TO TRUE               01850701
018508             PERFORM 9910-ABEND                                   01850801
018509     END-EVALUATE.                                                01850901
018510                                                                  01851001
018520*6000-EXIT.                                                       01852001
018521******************************************************************01852101
018522*     CONNECT TO THE ORACLE DATABASE.                            *01852201
018523******************************************************************01852301
018524 7000-CONNECT-TO-ORACLE.                                          01852401
018525     MOVE '7000-CONNECT-TO-ORACLE          ' TO PV-PARAGRAPH-NAME.01852501
018526     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          01852601
018527*                                                                 01852701
018528     IF CC-AUTO-LOGON                                             01852801
018529        DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         01852901
018530        EXEC SQL                                                  01853001
018540             CONNECT :PC-AUTO-LOGON                               01854001
018550        END-EXEC                                                  01855001
018551     ELSE                                                         01855101
018552        INITIALIZE PV-ORACLE-USERID-LEN                           01855201
018553                   PV-ORACLE-PASSWORD-LEN                         01855301
018554        INSPECT CC-ORACLE-USERID                                  01855401
018555                TALLYING PV-ORACLE-USERID-LEN                     01855501
018556                FOR CHARACTERS BEFORE INITIAL SPACE               01855601
018557        INSPECT CC-ORACLE-PASSWORD                                01855701
018558                TALLYING PV-ORACLE-PASSWORD-LEN                   01855801
018559                FOR CHARACTERS BEFORE INITIAL SPACE               01855901
018560        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         01856001
018561                USERNAME-ARR                                      01856101
018562        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 01856201
018563        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     01856301
018564                PASSWD-ARR                                        01856401
018565        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 01856501
018566        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     01856601
018567             PASSWD-ARR                                           01856701
018568        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 01856801
018569        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         01856901
018570             USERNAME-ARR                                         01857001
018571        MOVE PV-ORACLE-USERID-LEN  TO USERNAME-LEN                01857101
018572        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     01857201
018573             PASSWD-ARR                                           01857301
018574        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                01857401
018575        DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    01857501
018576             USERNAME-ARR                                         01857601
018577        EXEC SQL                                                  01857701
018578             CONNECT :USERNAME IDENTIFIED BY :PASSWD              01857801
018579        END-EXEC                                                  01857901
018580        INITIALIZE CC-ORACLE-PASSWORD                             01858001
018581                   PASSWD                                         01858101
018582     END-IF                                                       01858201
018583                                                                  01858301
018584     IF (SQLCODE NOT = 0)                                         01858401
018585         DISPLAY PV-PARAGRAPH-NAME                                01858501
018586         PERFORM 9900-ORA-ERROR                                   01858601
018587     END-IF.                                                      01858701
018588                                                                  01858801
018589*7000-EXIT.                                                       01858901
018590******************************************************************01859001
018591*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *01859101
018592******************************************************************01859201
018593 9200-WRAPUP.                                                     01859301
018594     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.01859401
018595                                                                  01859501
018596     PERFORM 9920-DISPLAY-TOTALS.                                 01859601
018597                                                                  01859701
018598     CLOSE NEXT-FUTURE-DAY-FILE.                                  01859801
018599     CLOSE STORE-GROUP-FILE.                                      01859901
018600                                                                  01860001
018700     PERFORM EP208-1200-DETERMINE-IF-ALERT.                       01870001
018800                                                                  01880001
018900     DISPLAY '****************************************'.          01890001
019000     DISPLAY '**          EPKUT208 END              **'.          01900001
019100     DISPLAY '****************************************'.          01910001
019200                                                                  01920001
019300*9200-EXIT.  EXIT.                                                01930001
019400******************************************************************01940001
019500*     COPYBOOK THAT CONTAINS NETCOOL OVERFLOW LOGIC              *01950001
019600******************************************************************01960001
019700      COPY EPPD208.                                               01970001
019800*                                                                 01980001
019900***************************************************************** 01990001
020000*     ORA ABEND ROUTINE.                                        * 02000001
020100***************************************************************** 02010001
020200 9900-ORA-ERROR.                                                  02020001
020300                                                                  02030001
020400     EXEC SQL                                                     02040001
020500        ROLLBACK                                                  02050001
020600     END-EXEC.                                                    02060001
020700                                                                  02070001
020800     PERFORM 9920-DISPLAY-TOTALS.                                 02080001
020900                                                                  02090001
021000     SET AC-4013-ORA-ERR           TO TRUE.                       02100001
021100     DISPLAY '** ABEND     **'.                                   02110001
021200     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                02120001
021300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02130001
021400     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               02140001
021500                                                                  02150001
021600     COPY DPPD004.                                                02160001
021700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02170001
021800                                                                  02180001
021900*9900-EXIT.  EXIT.                                                02190001
022000******************************************************************02200001
022100*     ABEND PROGRAM WHEN A NON-ORACLE ERROR OCCURS.              *02210001
022200******************************************************************02220001
022300 9910-ABEND.                                                      02230001
022400                                                                  02240001
022500     PERFORM 9920-DISPLAY-TOTALS.                                 02250001
022600                                                                  02260001
022700     DISPLAY '** ABEND           **'.                             02270001
022800     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02280001
022810     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02281001
022820     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02282001
022830     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       02283001
022840                                                                  02284001
022850     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02285001
022860                                                                  02286001
022870*9910-EXIT.  EXIT.                                                02287001
022880******************************************************************02288001
022890*     DISPLAY END OF JOB TOTALS                                  *02289001
022900******************************************************************02290001
022910 9920-DISPLAY-TOTALS.                                             02291001
022911                                                                  02291101
022912     DISPLAY '***********************************************'.   02291201
022913     DISPLAY '**     EOJ STATISTICS FOR EPKUT208           **'    02291301
022914     DISPLAY '***********************************************'.   02291401
022915                                                                  02291501
022916     DISPLAY '** OFFER RECS  FETCHED====> '                       02291601
022917             PV-OFFER-FETCHED                                     02291701
022918             '        **'.                                        02291801
022919                                                                  02291901
022920     DISPLAY '** OFFER RECS  WRITEN ====> '                       02292001
022921             PV-OFFER-WRITEN                                      02292101
022922             '        **'.                                        02292201
022923     DISPLAY '** OFR_SECT WRITEN    ====> '                       02292301
022924             PV-OFFER-SECTION                                     02292401
022925             '        **'.                                        02292501
022926     DISPLAY '** OFR_BWP WRITEN     ====> '                       02292601
022927             PV-OFFER-BWP                                         02292701
022928             '        **'.                                        02292801
022929     DISPLAY '** OFR_MDSE WRITEN    ====> '                       02292901
022930             PV-OFFER-MDSE                                        02293001
022940             '        **'.                                        02294001
022950     DISPLAY '*---------------------------------------------*'.   02295001
022960                                                                  02296001
022970     DISPLAY '** POS-BTN-CODE RECS FETCHED ====> '                02297001
022980             PV-POS-BTN-REC-FETCHED                               02298001
022990             ' **'.                                               02299001
022991                                                                  02299101
022992     DISPLAY '** POS-BTN-CODE RECS WRITEN  ====> '                02299201
022993             PV-POS-BTN-REC-WRITEN                                02299301
022994             ' **'.                                               02299401
022995     DISPLAY '*---------------------------------------------*'.   02299501
022996                                                                  02299601
022997     DISPLAY '** STORE GROUP RECS FETCHED ====> '                 02299701
022998             PV-OFFER-STORE-FETCHED                               02299801
022999             ' **'.                                               02299901
023000                                                                  02300001
023001     DISPLAY '** STORE GROUP RECS WRITEN  ====> '                 02300101
023002             PV-OFFER-STORE-WRITEN                                02300201
023003             ' **'.                                               02300301
023004     DISPLAY '***********************************************'.   02300401
023005                                                                  02300501
023006*9920-EXIT.  EXIT.                                                02300601
023007                                                                  02300701
