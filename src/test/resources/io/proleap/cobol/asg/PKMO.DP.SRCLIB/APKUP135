000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKUP135.                                        00020099
000300 AUTHOR.         R BERNOSKI.                                      00030099
000400*DATE-WRITTEN.   NOV 16, 1998.                                    00040099
000500*DATE-COMPILED.                                                   00050099
000600*************************************************************     00060099
000700*    COBOL 2  WITH SQL                                      *     00070099
000800*                                                           *     00080099
000900*    EXTRACT AND REFORMAT PEOPLESOFT AP ADJUSTMENTS         *     00090099
001000*                                                           *     00100099
001100*    THE PURPOSE OF THIS PROGRAM IS TO RETRIEVE ALL OF THE  *     00110099
001200*    ADJUSTMENT TRANSACTIONS FROM THE ADJUSTMENT JOURNAL    *     00120099
001300*    DATABASE THAT NEED TO BE INTERFACED TO PEOPLESOFT AP.  *     00130099
001400*    THIS PROCESS WILL BE PERFORMED ON A DAILY BASIS AND    *     00140099
001500*    WILL ONLY EXTRACT TRANSACTIONS FOR THE CURRENT DATE    *     00150099
001600*    UNLESS THERE IS A REJECTED BATCH THAT NEEDS TO BE      *     00160099
001700*    RESENT.                                                *     00170099
001800*                                                           *     00180099
001900*************************************************************     00190099
002000*                                                           *     00200099
002100* INPUT:                                                    *     00210099
002200*    TAPCNTL - AP CONTROL TABLE                             *     00220099
002300*    TADJRNL - ADJUSTMENT JOURNAL TABLE                     *     00230099
002400*    TAJPSINT- ADJUSTMENT PEOPLESOFT INFO TABLE             *     00240099
002500*    TTRNCDE - TRANCODE TABLE                               *     00250099
002600*    TEXTENT - EXTERNAL ENTERPRISE TABLE                    *     00260099
002700*    TENTNME - EXTERNAL ENTERPRISE NAME TABLE               *     00270099
002800*                                                           *     00280099
002900*                                                           *     00290099
003000* OUTPUT:                                                   *     00300099
003100*    COPYBOOK APRD040                                       *     00310099
003200*    AP TRANSACTIONS                                        *     00320099
003300*    TOUTAPE                                                *     00330099
003400*                                                           *     00340099
003500*                                                           *     00350099
003600*************************************************************     00360099
003700* CHANGE LOG:                                               *     00370099
003800*                                                           *     00380099
003900* 11/16/98  INITIAL VERSION                                 *     00390099
004000*                                                           *     00400099
004100* 10/11/99  REMOVED COPYBOOK DPWS500 - NOT USED             *     00410099
004200*    BY L SCHALLHORN                       WR # 06041       *     00420099
004300*                                                           *     00430099
004400* 12/07/99                                                  *     00440099
004500*    CHANGED VALUE OF AP040-DOC-HLD-CDE TO 'D' FOR          *     00450099
004600*    DOCUMENT HOLD IN CASE WHERE AJPSINT-DOC-HLD-CDE IS 'Y' *     00460099
004700*    BECAUSE 'Y' IS NOT A VALID 88 LEVEL VALUE IN APRD040   *     00470099
004800*    COPYBOOK.                                              *     00480099
004900*    BY MARK BURNSIDE                      WR # 05998       *     00490099
005000*                                                           *     00500099
005100* 11/10/2000                                                *     00510099
005200*    ADDED LOGIC TO PROCESS THE NEW MOS-DISC AND ADV-DISC   *     00520099
005300*    FIELDS. THE NEW FIELDS ARE HANDLED THE SAME WAY THE    *     00530099
005400*    NEW STORE DISCOUNT IS HANDLED.                         *     00540099
005500* MADE BY: JILL JUEL                   WR/IR #: 20224       *     00550099
005600*                                                           *     00560099
005700* 07/23/2001                                                *     00570099
005800*    CHANGED PC-AP040-LEN FROM VALUE 400 TO 500.  THIS      *     00580099
005900*    MODIFICATION WAS MADE TO REFLECT THE CHANGE MADE IN    *     00590099
006000*    COPYBOOK APRD040.                                      *     00600099
006100* MADE BY: ALEXIS KEIKER               WR/IR #: 22467       *     00610099
006200*                                                           *     00620099
006300* 11/04/2002                                                *     00630099
006400*    ADDED LOGIC TO PUT ALL ADJUSTMENTS FOR COLBY ON HOLD.  *     00640099
006500*    CHANGES FOR COLBY DATING PROJECT.                      *     00650099
006600* MADE BY: NANCY EILBES                WR/IR #: 23750       *     00660099
006700*                                                           *     00670099
006800* 09/03/2003                                                *     00680099
006900*    ADDED EFFECTIVE DATE CHECKING TO THE WHERE CLAUSE IN   *     00690099
007000*    THE EXTRACT_CSR FOR THE TTRNCDE TABLE.  CORRECTED THE  *     00700099
007100*    CODE IN PARA S200- IN THE SQLCODE = +100 TO INITIALIZE *     00710099
007200*    THE DCLGEN FIELDS INSTEAD OF THE AP040 FIELDS.         *     00720099
007300* MADE BY: MIKE BESKE                  WR/IR #: 21316       *     00730099
007400*                                                           *     00740099
007500* 04/08/2004                                                *     00750099
007600*    ADDED A CHECK FOR LOW-VALUES IN AJPSINT-AUTH-NBR IN    *     00760099
007700*    PARA B200-. THE NEW CODE WILL MOVE SPACES TO AP040-    *     00770099
007800*    AUTH-NBR IF LOW-VALUES ARE FOUND OTHERWISE THE DATABASE*     00780099
007900*    FIELD WILL BE MOVED INTO THE AP040-AUTH-NBR.           *     00790099
008000* MADE BY: MIKE BESKE                  WR/IR #: P000647235  *     00800099
008100*                                                           *     00810099
008110* 08/10/2005                                                *     00811099
008120*    ADDED THE COLUMN TR.TRN_TYP_CDE TO THE EXTRACT_CSR     *     00812099
008130*    SELECT STATEMENT.  THIS COLUMN WAS NEEDED SO THAT THE  *     00813099
008140*    CHECKPOINT RESTART LOGIC OPERATED PROPERLY.  ALSO      *     00814099
008150*    CHANGED THE FIELDS CR-PO-NBR AND CR-STR-NBR IN THE     *     00815099
008151*    CR-CKPT-RESTART-INFO AREA TO BE 'COMP'.                *     00815199
008152* MADE BY: KRYSTEN LEARY               WR/IR #: P000786899  *     00815299
008153*                                                           *     00815399
008154* 09/26/2006                                                *     00815499
008155*    RECOMPILE FROM PRODUCTION TO PICK UP THE NEW FIELD     *     00815599
008156*    AP040-SEPARATE-CHCK IN THE APRD040 COPYBOOK.           *     00815699
008157* MADE BY: KRYSTEN LEARY               WR/IR #: WR31177     *     00815799
008158*                                                           *     00815899
008159* 03/22/2007                                                *     00815999
008160*    RECOMPILE FROM PRODUCTION TO PICK UP THE NEW FIELDS    *     00816099
008170*    AP040-WTHD-SETID, AP040-WTHD-SW, AND AP040-WTHD-CD     *     00817099
008180*    IN THE APRD040 COPYBOOK.                               *     00818099
008190* MADE BY: KRYSTEN LEARY               WR/IR #: WR32060     *     00819099
008200*                                                           *     00820099
008201* 01/30/2012                                                *     00820199
008202*    ADDED CODE TO GO AROUND CODE IF THE TRAN CODE IS       *     00820299
008203*    '9T' OR '9S'.  THIS IS FOR THE ADJUSTMENT RECORD FOR   *     00820399
008204*    'CRB' CREDIT REBATE ADJUSTMENTS FOR LI&FUNG PO'S.      *     00820499
008205* MADE BY: BARB SCHULTZ                WR/IR #: WR40026     *     00820599
008206*                                                           *     00820699
008207* 02/28/2019                                                *     00820799
008208*    ADDED INITIALIZATION OF NEW DISCOUNT PCT AND DISCOUNT  *     00820899
008209*    AMOUNTS FROM APRD040 COPYBOOK.                         *     00820999
008210* MADE BY: GERMAN BANDA                WR/IR #: CHG0220043  *     00821099
008211*************************************************************     00821199
008212                                                                  00821299
008213 ENVIRONMENT DIVISION.                                            00821399
008214                                                                  00821499
008215 INPUT-OUTPUT SECTION.                                            00821599
008216                                                                  00821699
008217 FILE-CONTROL.                                                    00821799
008218                                                                  00821899
008219 DATA DIVISION.                                                   00821999
008220                                                                  00822099
008230 FILE SECTION.                                                    00823099
008240/                                                                 00824099
008250 WORKING-STORAGE SECTION.                                         00825099
008260                                                                  00826099
008270 01  FILLER                        PIC X(25) VALUE                00827099
008280                             'WS FOR APKUP135 BEGINS==>'.         00828099
008290 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00829099
008300                                             VALUE ZEROS.         00830099
008400     88 AP-EMPTY-FILE              VALUE +4005.                   00840099
008500     88 AP-DB2-ERROR               VALUE +4013.                   00850099
008600                                                                  00860099
008700 01  PROGRAM-CONSTANTS.                                           00870099
008800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'APKUP135'.00880099
008900     05  PC-RETRY-MAX                 PIC S9(04)  VALUE +3  COMP. 00890099
009000     05  PC-RETRY-COUNT               PIC S9(04)  VALUE ZEROS.    00900099
009100     05  PC-IN-PROCESS-CODE           PIC X(01)   VALUE '9'.      00910099
009200     05  PC-RUN-COMPLETE-CODE         PIC X(01)   VALUE '0'.      00920099
009300* PC-AP040-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD040. 00930099
009400     05  PC-AP040-LEN                 PIC S9(04)  VALUE 500 COMP. 00940099
009500                                                                  00950099
009600 01  PV-ABEND-FIELDS.                                             00960099
009700     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP135'. 00970099
009800     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     00980099
009900     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00990099
010000     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01000099
010100     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01010099
010200     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01020099
010300     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     01030099
010400     05  PV-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     01040099
010500     05  PV-ABEND-STRUCTURE-5         PIC X(8)  VALUE SPACES.     01050099
010600     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     01060099
010700     05  AA-PARAGRAPH-NAME            PIC X(50) VALUE SPACES.     01070099
010800                                                                  01080099
010900 01  PV-RECORD-CNTS-PER-COMMIT.                                   01090099
011000     05  PV-RECEIPT-IN-REC-CNT-C      PIC S9(07) COMP-3 VALUE +0. 01100099
011100     05  PV-RECDIS-INPUT-CNT-C        PIC S9(07) COMP-3 VALUE +0. 01110099
011200     05  PV-NINREC-INPUT-CNT-C        PIC S9(07) COMP-3 VALUE +0. 01120099
011300                                                                  01130099
011400     05  PV-DETAIL-RECV-SEQ-CNT-C     PIC S9(07) COMP-3 VALUE +0. 01140099
011500     05  PV-DETAIL-ENTRY-REC-CNT-C    PIC S9(07) COMP-3 VALUE +0. 01150099
011600     05  PV-DETAIL-IMPRT-REC-CNT-C    PIC S9(07) COMP-3 VALUE +0. 01160099
011700     05  PV-UPDATE-KEYS-REC-CNT-C     PIC S9(07) COMP-3 VALUE +0. 01170099
011800                                                                  01180099
011900 01  PV-RECORD-CNTS.                                              01190099
012000     05  PV-EXTRACT-INPUT-CNT         PIC S9(09) COMP-3 VALUE +0. 01200099
012100     05  PV-RECORDS-WRITTEN           PIC S9(09) COMP-3 VALUE +0. 01210099
012200     05  PV-EXTRACT-COUNT             PIC S9(09) COMP   VALUE +0. 01220099
012300                                                                  01230099
012400 01  PV-WORK-AREA.                                                01240099
012500                                                                  01250099
012600     05  PV-SAVED-PO                  PIC S9(09) COMP VALUE +0.   01260099
012700     05  PV-PO-BEING-PROCESSED        PIC S9(09) COMP VALUE +0.   01270099
012800     05  PV-UNIT-COST-TO-USE          PIC S9(07)V999 COMP-3       01280099
012900                                                   VALUE +0.      01290099
013000     05  PV-CKPT-STAT-CODE            PIC X(01)  VALUE SPACE.     01300099
013100     05  PV-RETRY-COUNT               PIC S9(04) VALUE ZEROS      01310099
013200                                                 COMP.            01320099
013300     05  PV-HOLD-VND-NBR              PIC X(09) VALUE SPACES.     01330099
013400         88 VENDOR-IS-LIFUNG                    VALUE '009206194'.01340099
013500     05  PV-HOLD-PO-NBR               PIC S9(09) VALUE ZEROS      01350099
013600                                                 COMP.            01360099
013700     05  PV-ENT-ID                    PIC S9(09) VALUE ZEROS      01370099
013800                                                 COMP.            01380099
013900     05  PV-NEVER-HOLD-TRANCODES      PIC X(02)  VALUE SPACES.    01390099
014000         88  NEVER-HOLD-TRNCDES                  VALUE '9S',      01400099
014100                                                       '9T'.      01410099
014200                                                                  01420099
014300 01  PV-ENTR-TMST.                                                01430099
014400     05  PV-ENTR-DATE                 PIC X(10)  VALUE SPACES.    01440099
014500     05  PV-ENTR-TIME                 PIC X(16)  VALUE SPACES.    01450099
014600                                                                  01460099
014700 01  PV-ENTER-TIMESTAMP REDEFINES PV-ENTR-TMST PIC X(26).         01470099
014800                                                                  01480099
014900*                                                                 01490099
015000 01  PV-SWITCHES.                                                 01500099
015100     05  END-OF-EXTRACT-CSR-SW        PIC X(01)  VALUE ' '.       01510099
015200         88  NOT-END-OF-EXTRACT-CSR              VALUE ' '.       01520099
015300         88  END-OF-EXTRACT-CSR                  VALUE 'Y'.       01530099
015400     05  CR-CKPT-STAT-CODE            PIC X(01)  VALUE ' '.       01540099
015500         88  NORMAL-RUN                          VALUE '0'.       01550099
015600         88  RESTART-RUN                         VALUE '9'.       01560099
015700     05  PS-COMMITS-SW                PIC X(01)  VALUE ' '.       01570099
015800         88  NO-COMMITS-TAKEN                    VALUE 'N'.       01580099
015900         88  COMMITS-TAKEN                       VALUE 'Y'.       01590099
016000                                                                  01600099
016100 01  CR-CKPT-RESTART-INFO.                                        01610099
016200     05  CR-VND-NBR                   PIC  X(09) VALUE SPACES.    01620099
016300     05  CR-DOC-NBR                   PIC  X(16) VALUE SPACES.    01630099
016400     05  CR-DOC-DTE                   PIC  X(10) VALUE SPACES.    01640099
016500*    05  CR-PO-NBR                    PIC S9(09) VALUE ZEROS.     01650099
016600     05  CR-PO-NBR                    PIC S9(09) VALUE ZEROS COMP.01660099
016700*    05  CR-STR-NBR                   PIC S9(04) VALUE ZEROS.     01670099
016800     05  CR-STR-NBR                   PIC S9(04) VALUE ZEROS COMP.01680099
016900     05  CR-GL-ACCT-NBR               PIC  X(06) VALUE SPACES.    01690099
017000     05  CR-DEPT-NBR                  PIC  X(03) VALUE SPACES.    01700099
017100     05  CR-AP-TRN-CDE                PIC  X(02) VALUE SPACES.    01710099
017200     05  CR-PSTG-TYP-CDE              PIC  X(02) VALUE SPACES.    01720099
017300     05  CR-TRN-TYP-CDE               PIC  X(03) VALUE SPACES.    01730099
017400     05  CR-RECORDS-WRITTEN           PIC  S9(09) COMP-3 VALUE +0.01740099
017500     05  CR-EXTRACT-COUNT             PIC  S9(09) COMP-3 VALUE +0.01750099
017600                                                                  01760099
017700 01  CKPT-RESTART-TMST.                                           01770099
017800     05  CR-CURR-TMST                 PIC X(26)  VALUE SPACES.    01780099
017900     05  CR-NEXT-TMST                 PIC X(26)  VALUE SPACES.    01790099
018000                                                                  01800099
018100 01  FILLER                           PIC X(35)  VALUE            01810099
018200     'BEGINNING OF AP040 OUTPUT FILE   **'.                       01820099
018300     COPY APRD040.                                                01830099
018400                                                                  01840099
018500     COPY DPWS004.                                                01850099
018600                                                                  01860099
018700 01  FILLER                          PIC X(35)  VALUE             01870099
018800     'END OF AP WORK RECORD AREA       **'.                       01880099
018900                                                                  01890099
019000******************************************************************01900099
019100*  COMMUNICATIONS AREA2 FOR DB2                                   01910099
019200******************************************************************01920099
019300     COPY SQLCA2.                                                 01930099
019400                                                                  01940099
019500     EXEC SQL                                                     01950099
019600          INCLUDE SQLCA                                           01960099
019700     END-EXEC.                                                    01970099
019800                                                                  01980099
019900*----------------------------------------------------------------*01990099
020000*      TAPCNTL TABLE LAYOUT                                       02000099
020100*----------------------------------------------------------------*02010099
020200*                                                                 02020099
020300     EXEC SQL                                                     02030099
020400          INCLUDE TAPCNTL                                         02040099
020500     END-EXEC.                                                    02050099
020600                                                                  02060099
020700*----------------------------------------------------------------*02070099
020800*      TADJRNL TABLE LAYOUT                                       02080099
020900*----------------------------------------------------------------*02090099
021000*                                                                 02100099
021100     EXEC SQL                                                     02110099
021200          INCLUDE TADJRNL                                         02120099
021300     END-EXEC.                                                    02130099
021400                                                                  02140099
021500*----------------------------------------------------------------*02150099
021600*      TAJPSINT TABLE LAYOUT                                      02160099
021700*----------------------------------------------------------------*02170099
021800*                                                                 02180099
021900     EXEC SQL                                                     02190099
022000          INCLUDE TAJPSINT                                        02200099
022100     END-EXEC.                                                    02210099
022200                                                                  02220099
022300*----------------------------------------------------------------*02230099
022400*      TTRNCDE TABLE LAYOUT                                       02240099
022500*----------------------------------------------------------------*02250099
022600     EXEC SQL                                                     02260099
022700          INCLUDE TTRNCDE                                         02270099
022800     END-EXEC.                                                    02280099
022900                                                                  02290099
023000*----------------------------------------------------------------*02300099
023100*      TEXTENT TABLE LAYOUT                                       02310099
023200*----------------------------------------------------------------*02320099
023300     EXEC SQL                                                     02330099
023400          INCLUDE TEXTENT                                         02340099
023500     END-EXEC.                                                    02350099
023600                                                                  02360099
023700*----------------------------------------------------------------*02370099
023800*      TENTNME TABLE LAYOUT                                       02380099
023900*----------------------------------------------------------------*02390099
024000     EXEC SQL                                                     02400099
024100          INCLUDE TENTNME                                         02410099
024200     END-EXEC.                                                    02420099
024300                                                                  02430099
024400*----------------------------------------------------------------*02440099
024500*      TOUTAPE TABLE LAYOUT                                       02450099
024600*----------------------------------------------------------------*02460099
024700     EXEC SQL                                                     02470099
024800          INCLUDE TOUTAPE                                         02480099
024900     END-EXEC.                                                    02490099
025000                                                                  02500099
025100*----------------------------------------------------------------*02510099
025200*      TPURCHS TABLE LAYOUT                                       02520099
025300*----------------------------------------------------------------*02530099
025400     EXEC SQL                                                     02540099
025500          INCLUDE TPURCHS                                         02550099
025600     END-EXEC.                                                    02560099
025700*----------------------------------------------------------------*02570099
025800*      TCKRSTCNTL TABLE LAYOUT                                    02580099
025900*----------------------------------------------------------------*02590099
026000         EXEC SQL                                                 02600099
026100             INCLUDE TCKRSTCN                                     02610099
026200         END-EXEC.                                                02620099
026300*----------------------------------------------------------------*02630099
026400*      TCKRSTINF TABLE LAYOUT                                     02640099
026500*----------------------------------------------------------------*02650099
026600         EXEC SQL                                                 02660099
026700             INCLUDE TCKRSTIN                                     02670099
026800         END-EXEC.                                                02680099
026900*----------------------------------------------------------------*02690099
027000* EXTRACT_CSR  GETS ALL ADJUSTMENT TRANSACTIONS                  *02700099
027100*----------------------------------------------------------------*02710099
027200     EXEC SQL                                                     02720099
027300       DECLARE EXTRACT_CSR  CURSOR WITH HOLD FOR                  02730099
027400         SELECT                                                   02740099
027500             AD.VND_NBR                                           02750099
027600           , AD.DOC_NBR                                           02760099
027700           , AD.DOC_DTE                                           02770099
027800           , AD.PO_NBR                                            02780099
027900           , AD.STR_NBR                                           02790099
028000           , AD.GL_ACCT_NBR                                       02800099
028100           , AD.DEPT_NBR                                          02810099
028200           , AD.AP_TRN_CDE                                        02820099
028300           , TR.PSTG_TYP_CDE                                      02830099
028400           , AD.TRN_TYP_CDE                                       02840099
028500           , AD.ENTR_TMST                                         02850099
028600           , AD.ENTR_ID                                           02860099
028700           , AD.ORGN_CDE                                          02870099
028800           , AD.RTL_AMT                                           02880099
028900           , AD.GRO_COST_AMT                                      02890099
029000           , AD.FRGT_AMT                                          02900099
029100           , AD.MISC_CHRG_AMT                                     02910099
029200           , AD.NET_COST_AMT                                      02920099
029300           , AD.TERM_DISC_PCT                                     02930099
029400           , AD.TERM_DISC_AMT                                     02940099
029500           , AD.NW_STR_DISC_PCT                                   02950099
029600           , AD.NW_STR_DISC_AMT                                   02960099
029700           , AD.TRD_DISC_PCT                                      02970099
029800           , AD.TRD_DISC_AMT                                      02980099
029900           , AD.INV_CTOFF_DTE                                     02990099
030000           , AD.BRCDE_NBR                                         03000099
030100           , AD.ENT_ID                                            03010099
030200           , AD.PS_BTCH_NBR                                       03020099
030300           , AD.PSTG_FYR_NBR                                      03030099
030400           , AD.PSTG_FMN_NBR                                      03040099
030500           , AD.PSTG_FWK_NBR                                      03050099
030600           , AD.PS_PSTG_IND                                       03060099
030700           , TR.AP_PSTG_IND                                       03070099
030800           , AD.MOS_DISC_PCT                                      03080099
030900           , AD.MOS_DISC_AMT                                      03090099
031000           , TR.TRN_TYP_CDE                                       03100099
031100         FROM                                                     03110099
031200             TADJRNL AD                                           03120099
031300           , TTRNCDE TR                                           03130099
031400         WHERE                                                    03140099
031500               TR.AP_TRN_CDE       = AD.AP_TRN_CDE                03150099
031600           AND CURRENT DATE  BETWEEN TR.EFF_STRT_DTE AND          03160099
031700                                     TR.EFF_END_DTE               03170099
031800           AND AD.ORGN_CDE         = 'A'                          03180099
031900           AND (DATE(AD.ENTR_TMST) = :APCNTL-BTCH-PRC-DTE         03190099
032000            OR AD.PS_PSTG_IND      = 'N')                         03200099
032100         ORDER BY                                                 03210099
032200             AD.VND_NBR                                           03220099
032300           , AD.DOC_NBR                                           03230099
032400           , AD.DOC_DTE                                           03240099
032500           , AD.AP_TRN_CDE                                        03250099
032600     END-EXEC.                                                    03260099
032700                                                                  03270099
032800*----------------------------------------------------------------*03280099
032900 01  FILLER                        PIC X(38) VALUE                03290099
033000          '<====WORKING STORAGE FOR APKUP135 ENDS'.               03300099
033100                                                                  03310099
033200                                                                  03320099
033300 PROCEDURE DIVISION.                                              03330099
033400                                                                  03340099
033500 A100-MAINLINE.                                                   03350099
033600                                                                  03360099
033700     PERFORM B100-INITIALIZATION.                                 03370099
033800                                                                  03380099
033900     PERFORM B200-PROCESSING                                      03390099
034000        UNTIL END-OF-EXTRACT-CSR.                                 03400099
034100                                                                  03410099
034200                                                                  03420099
034300     PERFORM B300-END-JOB.                                        03430099
034400                                                                  03440099
034500     GOBACK.                                                      03450099
034600        EJECT                                                     03460099
034700                                                                  03470099
034800                                                                  03480099
034900 B100-INITIALIZATION.                                             03490099
035000*                                                                 03500099
035100***************************************************************** 03510099
035200*    INITIALIZATION                                               03520099
035300***************************************************************** 03530099
035400*                                                                 03540099
035500     MOVE 'B100-INITIALIZATION' TO PV-ABEND-PARAGRAPH.            03550099
035600                                                                  03560099
035700     INITIALIZE DCLTAPCNTL                                        03570099
035800                DCLTADJRNL                                        03580099
035900                DCLTAJPSINT                                       03590099
036000                DCLTTRNCDE                                        03600099
036100                DCLTEXTENT                                        03610099
036200                DCLTENTNME.                                       03620099
036300                                                                  03630099
036400***************************************************************** 03640099
036500*   GET BTCH_PRC_DTE                                              03650099
036600***************************************************************** 03660099
036700     EXEC SQL                                                     03670099
036800         SELECT                                                   03680099
036900             BTCH_PRC_DTE                                         03690099
037000         INTO                                                     03700099
037100             :APCNTL-BTCH-PRC-DTE                                 03710099
037200         FROM TAPCNTL                                             03720099
037300     END-EXEC.                                                    03730099
037400                                                                  03740099
037500     EVALUATE TRUE                                                03750099
037600         WHEN SQLCODE = ZERO                                      03760099
037700              CONTINUE                                            03770099
037800                                                                  03780099
037900         WHEN SQLWARN0 = SPACES                                   03790099
038000         WHEN SQLCODE NOT = ZERO                                  03800099
038100           MOVE 'B100-INITIALIZATION' TO PV-ABEND-PARAGRAPH       03810099
038200           MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION       03820099
038300           MOVE 'TAPCNTL'             TO PV-ABEND-STRUCTURE-1     03830099
038400           MOVE SPACES                TO PV-ABEND-STRUCTURE-2     03840099
038500           PERFORM Z999-DB2-ABEND                                 03850099
038600     END-EVALUATE.                                                03860099
038700                                                                  03870099
038800     PERFORM Y100-OPEN-EXTRACT-CSR                                03880099
038900                                                                  03890099
039000     PERFORM R200-GET-CHECKPOINT-CNTL.                            03900099
039100     MOVE PV-CKPT-STAT-CODE TO CR-CKPT-STAT-CODE.                 03910099
039200                                                                  03920099
039300     IF RESTART-RUN                                               03930099
039400        PERFORM H200-CHECKPOINT-RESTART                           03940099
039500     ELSE                                                         03950099
039600        SET NOT-END-OF-EXTRACT-CSR TO TRUE                        03960099
039700        PERFORM R100-FETCH-EXTRACT-CSR                            03970099
039800        IF END-OF-EXTRACT-CSR                                     03980099
039900           DISPLAY 'WARNING:  NO DATA TO EXTRACT'                 03990099
040000        END-IF                                                    04000099
040100     END-IF.                                                      04010099
040200                                                                  04020099
040300                                                                  04030099
040400***************************************************************** 04040099
040500*     PROCESS EACH PO FETCHED FROM CURSOR                         04050099
040600***************************************************************** 04060099
040700 B200-PROCESSING.                                                 04070099
040800                                                                  04080099
040900     MOVE 'B200-PROCESSING  '     TO PV-ABEND-PARAGRAPH.          04090099
041000                                                                  04100099
041100     MOVE ADJRNL-VND-NBR          TO AP040-VND-NBR.               04110099
041200     MOVE ADJRNL-DOC-NBR          TO AP040-DOC-NBR.               04120099
041300     MOVE ADJRNL-DOC-DTE          TO AP040-DOC-DTE.               04130099
041400     MOVE ADJRNL-PO-NBR           TO AP040-PO-NBR.                04140099
041500     MOVE ADJRNL-PO-NBR           TO PV-HOLD-PO-NBR.              04150099
041600     MOVE ADJRNL-STR-NBR          TO AP040-STR-NBR.               04160099
041700     MOVE ADJRNL-GL-ACCT-NBR      TO AP040-GL-ACCT-NBR.           04170099
041800     MOVE ADJRNL-DEPT-NBR         TO AP040-DEPT-NBR.              04180099
041900     MOVE ADJRNL-AP-TRN-CDE       TO AP040-AP-TRN-CDE.            04190099
042000     MOVE TRNCDE-PSTG-TYP-CDE     TO AP040-PSTG-TYP-CDE.          04200099
042100     MOVE ADJRNL-TRN-TYP-CDE      TO AP040-TRN-TYP-CDE.           04210099
042200     MOVE ADJRNL-ENTR-TMST        TO PV-ENTER-TIMESTAMP.          04220099
042300     MOVE PV-ENTR-DATE            TO AP040-ENTR-DTE.              04230099
042400     MOVE PV-ENTR-TIME            TO AP040-ENTR-TME.              04240099
042500     MOVE ADJRNL-ENTR-ID          TO AP040-ENTR-ID.               04250099
042600     MOVE ADJRNL-ORGN-CDE         TO AP040-ORGN-CDE.              04260099
042700     MOVE ADJRNL-RTL-AMT          TO AP040-RETL-AMT.              04270099
042800     MOVE ADJRNL-GRO-COST-AMT     TO AP040-GRO-COST-AMT.          04280099
042900     MOVE ADJRNL-FRGT-AMT         TO AP040-FRGT-AMT.              04290099
043000     MOVE ADJRNL-MISC-CHRG-AMT    TO AP040-MISC-CHRG-AMT.         04300099
043100     MOVE ZERO                    TO AP040-SALES-TAX-AMT.         04310099
043200     MOVE ADJRNL-NET-COST-AMT     TO AP040-NET-COST-AMT.          04320099
043300     MOVE ADJRNL-TERM-DISC-PCT    TO AP040-TERM-DISC-PCT.         04330099
043400     MOVE ADJRNL-TERM-DISC-AMT    TO AP040-TERM-DISC-AMT.         04340099
043500     MOVE ADJRNL-NW-STR-DISC-PCT  TO AP040-NW-STR-DISC-PCT.       04350099
043600     MOVE ADJRNL-NW-STR-DISC-AMT  TO AP040-NW-STR-DISC-AMT.       04360099
043700     MOVE ADJRNL-TRD-DISC-PCT     TO AP040-TRD-DISC-PCT.          04370099
043800     MOVE ADJRNL-TRD-DISC-AMT     TO AP040-TRD-DISC-AMT.          04380099
043900     MOVE ADJRNL-MOS-DISC-PCT     TO AP040-MOS-DISC-PCT.          04390099
044000     MOVE ADJRNL-MOS-DISC-AMT     TO AP040-MOS-DISC-AMT.          04400099
044100     MOVE ZEROES                  TO AP040-ADV-DISC-PCT.          04410099
044200     MOVE ZEROES                  TO AP040-ADV-DISC-AMT.          04420099
044300*                                                                 04430099
044400     MOVE ZEROES                  TO AP040-COOP-DISC-PCT.         04440099
044500     MOVE ZEROES                  TO AP040-ALW-DISC-PCT.          04450099
044600     MOVE ZEROES                  TO AP040-MSC-DISC-PCT.          04460099
044610     MOVE ZEROES                  TO AP040-COOP-DISC-AMT.         04461099
044620     MOVE ZEROES                  TO AP040-ALW-DISC-AMT.          04462099
044630     MOVE ZEROES                  TO AP040-MSC-DISC-AMT.          04463099
044640*                                                                 04464099
044650     MOVE ADJRNL-INV-CTOFF-DTE    TO AP040-INV-CUTOFF-DTE.        04465099
044660     MOVE ADJRNL-BRCDE-NBR        TO AP040-BAR-CDE.               04466099
044670     MOVE ADJRNL-ENT-ID           TO AP040-ENT-ID.                04467099
044680     MOVE TRNCDE-AP-PSTG-IND      TO AP040-AP-PSTG-IND.           04468099
044690                                                                  04469099
044700     IF PV-HOLD-VND-NBR = ADJRNL-VND-NBR                          04470099
044800        MOVE ENTNME-ENT-NAME-DESC TO AP040-ENT-NME-DESC           04480099
044900     ELSE                                                         04490099
045000        MOVE AP040-ENT-ID         TO PV-ENT-ID                    04500099
045100        PERFORM S100-GET-VENDOR-NAME                              04510099
045200        MOVE ENTNME-ENT-NAME-DESC TO AP040-ENT-NME-DESC           04520099
045300     END-IF.                                                      04530099
045400                                                                  04540099
045500     MOVE AP040-VND-NBR           TO PV-HOLD-VND-NBR.             04550099
045600     MOVE ADJRNL-PS-BTCH-NBR      TO AP040-PS-BTCH-NBR.           04560099
045700     MOVE ADJRNL-PSTG-FYR-NBR     TO AP040-PSTG-FYR-NBR.          04570099
045800     MOVE ADJRNL-PSTG-FMN-NBR     TO AP040-PSTG-FMN-NBR.          04580099
045900     MOVE ADJRNL-PSTG-FWK-NBR     TO AP040-PSTG-FWK-NBR.          04590099
046000     MOVE ADJRNL-PS-PSTG-IND      TO AP040-ADJRNL-PS-PSTG-IND.    04600099
046100                                                                  04610099
046200     PERFORM S200-GET-TAJPSINT-TABLE.                             04620099
046300     MOVE AJPSINT-DUE-DTE         TO AP040-PYMT-DUE-DTE.          04630099
046400     MOVE AJPSINT-RSN-1ST-LNE-TXT TO AP040-RSN-1ST-LNE-TXT.       04640099
046500     MOVE AJPSINT-RSN-2ND-LNE-TXT TO AP040-RSN-2ND-LNE-TXT.       04650099
046600                                                                  04660099
046700     IF AJPSINT-DOC-HLD-CDE = 'Y'                                 04670099
046800     OR VENDOR-IS-LIFUNG                                          04680099
046900        MOVE 'D' TO AP040-DOC-HLD-CDE                             04690099
047000     ELSE                                                         04700099
047100        MOVE 'N' TO AP040-DOC-HLD-CDE                             04710099
047200     END-IF.                                                      04720099
047300                                                                  04730099
047400     MOVE ADJRNL-AP-TRN-CDE TO PV-NEVER-HOLD-TRANCODES.           04740099
047500     IF NEVER-HOLD-TRNCDES AND                                    04750099
047600        VENDOR-IS-LIFUNG                                          04760099
047700           MOVE 'N' TO AP040-DOC-HLD-CDE                          04770099
047800     END-IF.                                                      04780099
047900                                                                  04790099
048000     IF AJPSINT-AUTH-NBR = LOW-VALUES                             04800099
048100        MOVE SPACES                  TO AP040-AUTH-NBR            04810099
048200     ELSE                                                         04820099
048300        MOVE AJPSINT-AUTH-NBR        TO AP040-AUTH-NBR            04830099
048310     END-IF.                                                      04831099
048320                                                                  04832099
048330* PC-AP040-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD040. 04833099
048340     MOVE PC-AP040-LEN            TO OUTAPE-PS-TRN-ODR-LEN.       04834099
048350     MOVE AP040-TRANSACTION-FILE  TO OUTAPE-PS-TRN-ODR-TEXT.      04835099
048360     PERFORM U100-INSERT-TRANS-RECORDS.                           04836099
048370     ADD 1 TO PV-RECORDS-WRITTEN.                                 04837099
048380                                                                  04838099
048390     PERFORM H100-CHECKPOINT-COMMIT.                              04839099
048400                                                                  04840099
048500     PERFORM R100-FETCH-EXTRACT-CSR.                              04850099
048600 EJECT                                                            04860099
048700                                                                  04870099
048800                                                                  04880099
048900 B300-END-JOB.                                                    04890099
049000*                                                                 04900099
049100***************************************************************** 04910099
049200*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 04920099
049300***************************************************************** 04930099
049400*                                                                 04940099
049500     MOVE 'B300-END-JOB  ' TO PV-ABEND-PARAGRAPH.                 04950099
049600                                                                  04960099
049700     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              04970099
049800     MOVE ZEROS                TO CR-CKPT-RESTART-INFO.           04980099
049900                                                                  04990099
050000                                                                  05000099
050100     DISPLAY '************************************************'.  05010099
050200     DISPLAY 'TOTAL EXTRACT ROWS FETCHED     = '                  05020099
050300              PV-EXTRACT-COUNT.                                   05030099
050400     DISPLAY '************************************************'.  05040099
050500     DISPLAY 'TOTAL RECORDS WRITTEN          = '                  05050099
050600              PV-RECORDS-WRITTEN.                                 05060099
050700     DISPLAY '************************************************'.  05070099
050800     DISPLAY 'PROGRAM NAME                   = '                  05080099
050900              PC-PROGRAM-NAME.                                    05090099
051000     DISPLAY '************************************************'.  05100099
051100     DISPLAY 'BTCH-PRC-DTE                   = '                  05110099
051200              APCNTL-BTCH-PRC-DTE.                                05120099
051300     DISPLAY '************************************************'.  05130099
051400                                                                  05140099
051500     PERFORM U400-UPDATE-TCKRSTCNTL.                              05150099
051600     PERFORM U500-UPDATE-TCKRSTINF.                               05160099
051700     PERFORM Z100-COMMIT.                                         05170099
051800     PERFORM Y200-CLOSE-EXTRACT-CSR.                              05180099
051900                                                                  05190099
052000                                                                  05200099
052100 EJECT                                                            05210099
052200*----------------------------------------------------------------*05220099
052300*    DO THE CHECKPOINT RESTART AND THE COMMIT.                   *05230099
052400*----------------------------------------------------------------*05240099
052500 H100-CHECKPOINT-COMMIT.                                          05250099
052600                                                                  05260099
052700     MOVE 'H100-CHECKPOINT-COMMIT' TO PV-ABEND-PARAGRAPH.         05270099
052800                                                                  05280099
052900     EXEC SQL                                                     05290099
053000       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      05300099
053100     END-EXEC.                                                    05310099
053200                                                                  05320099
053300     EVALUATE TRUE                                                05330099
053400         WHEN SQLCODE = ZERO                                      05340099
053500              CONTINUE                                            05350099
053600                                                                  05360099
053700        WHEN SQLWARN0 NOT = SPACES                                05370099
053800        WHEN SQLCODE  NOT = ZERO                                  05380099
053900            MOVE 'UNSUCCESSFUL SET TMST'                          05390099
054000                                TO PV-ABEND-OPERATION             05400099
054100            PERFORM Z999-DB2-ABEND                                05410099
054200     END-EVALUATE.                                                05420099
054300                                                                  05430099
054400     IF CR-CURR-TMST > CR-NEXT-TMST                               05440099
054500        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         05450099
054600        PERFORM U400-UPDATE-TCKRSTCNTL                            05460099
054700        PERFORM U500-UPDATE-TCKRSTINF                             05470099
054800        PERFORM Z100-COMMIT                                       05480099
054900                                                                  05490099
055000        EXEC SQL                                                  05500099
055100         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     05510099
055200          INTO :CR-NEXT-TMST                                      05520099
055300          FROM TCKRSTCNTL                                         05530099
055400          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      05540099
055500        END-EXEC                                                  05550099
055600                                                                  05560099
055700          EVALUATE TRUE                                           05570099
055800              WHEN SQLCODE = ZERO                                 05580099
055900                   CONTINUE                                       05590099
056000                                                                  05600099
056100          WHEN SQLWARN0 NOT = SPACES                              05610099
056200          WHEN SQLCODE  NOT = ZERO                                05620099
056300              MOVE 'UNSUCCESSFUL NEXT TMST'                       05630099
056400                                  TO PV-ABEND-OPERATION           05640099
056500              PERFORM Z999-DB2-ABEND                              05650099
056600       END-EVALUATE                                               05660099
056700     END-IF.                                                      05670099
056800                                                                  05680099
056900                                                                  05690099
057000*----------------------------------------------------------------*05700099
057100*    GET THE RESTART INFO.                                       *05710099
057200*----------------------------------------------------------------*05720099
057300 H200-CHECKPOINT-RESTART.                                         05730099
057400                                                                  05740099
057500     MOVE 'H200-CHECKPOINT-RESTART' TO PV-ABEND-PARAGRAPH.        05750099
057600                                                                  05760099
057700     PERFORM R300-GET-CHECKPOINT-INFO.                            05770099
057800     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CR-CKPT-RESTART-INFO.  05780099
057900                                                                  05790099
058000     DISPLAY '***********************************************'.   05800099
058100     DISPLAY '******** APKUP135 CHECKPOINT RESTART **********'    05810099
058200     DISPLAY '** VENDOR NUMBER ON RESTART      = ' CR-VND-NBR.    05820099
058300     DISPLAY '** DOC NUMBER ON RESTART         = ' CR-DOC-NBR.    05830099
058400     DISPLAY '** DOC DATE ON RESTART           = ' CR-DOC-DTE.    05840099
058500     DISPLAY '** PO NUMBER ON RESTART          = ' CR-PO-NBR.     05850099
058600     DISPLAY '** STORE NUMBER ON RESTART       = ' CR-STR-NBR.    05860099
058700     DISPLAY '** GL ACCOUNT NUMBER ON RESTART  = ' CR-GL-ACCT-NBR.05870099
058800     DISPLAY '** DEPT NUMBER ON RESTART        = ' CR-DEPT-NBR.   05880099
058900     DISPLAY '** AP TRAN CODE ON RESTART       = ' CR-AP-TRN-CDE. 05890099
059000     DISPLAY '** PSTG TYP CODE ON RESTART      = '                05900099
059100                                             CR-PSTG-TYP-CDE.     05910099
059200     DISPLAY '** TRN TYP CODE ON RESTART       = ' CR-TRN-TYP-CDE.05920099
059300     DISPLAY '** RECORDS WRITTEN ON RESTART    = '                05930099
059400                                             CR-RECORDS-WRITTEN.  05940099
059500     DISPLAY '** RECORDS FETCHED ON RESTART = '                   05950099
059600                                       CR-EXTRACT-COUNT.          05960099
059700     DISPLAY '***********************************************'.   05970099
059800                                                                  05980099
059900     PERFORM R100-FETCH-EXTRACT-CSR                               05990099
060000        WITH TEST AFTER                                           06000099
060100             UNTIL END-OF-EXTRACT-CSR                             06010099
060200               OR (ADJRNL-VND-NBR      = CR-VND-NBR               06020099
060300              AND  ADJRNL-DOC-NBR      = CR-DOC-NBR               06030099
060400              AND  ADJRNL-DOC-DTE      = CR-DOC-DTE               06040099
060500              AND  ADJRNL-AP-TRN-CDE   = CR-AP-TRN-CDE            06050099
060600              AND  ADJRNL-PO-NBR       = CR-PO-NBR                06060099
060700              AND  ADJRNL-STR-NBR      = CR-STR-NBR               06070099
060800              AND  ADJRNL-GL-ACCT-NBR  = CR-GL-ACCT-NBR           06080099
060900              AND  ADJRNL-DEPT-NBR     = CR-DEPT-NBR              06090099
061000              AND  ADJRNL-AP-TRN-CDE   = CR-AP-TRN-CDE            06100099
061100              AND  TRNCDE-PSTG-TYP-CDE = CR-PSTG-TYP-CDE          06110099
061200              AND  TRNCDE-TRN-TYP-CDE  = CR-TRN-TYP-CDE)          06120099
061300                                                                  06130099
061400     MOVE ZEROS      TO PV-EXTRACT-COUNT.                         06140099
061500     MOVE ZEROS      TO PV-RECORDS-WRITTEN.                       06150099
061600                                                                  06160099
061700     MOVE CR-EXTRACT-COUNT     TO PV-EXTRACT-COUNT.               06170099
061800     MOVE CR-RECORDS-WRITTEN   TO PV-RECORDS-WRITTEN.             06180099
061900                                                                  06190099
062000                                                                  06200099
062100 R100-FETCH-EXTRACT-CSR.                                          06210099
062200*                                                                 06220099
062300***************************************************************** 06230099
062400*     FETCH THE EXTRACT CURSOR                                    06240099
062500***************************************************************** 06250099
062600*                                                                 06260099
062700     MOVE 'R100-EXTRACT-CSR  ' TO PV-ABEND-PARAGRAPH.             06270099
062800                                                                  06280099
062900     EXEC SQL                                                     06290099
063000         FETCH EXTRACT_CSR                                        06300099
063100         INTO                                                     06310099
063200            :ADJRNL-VND-NBR                                       06320099
063300           ,:ADJRNL-DOC-NBR                                       06330099
063400           ,:ADJRNL-DOC-DTE                                       06340099
063500           ,:ADJRNL-PO-NBR                                        06350099
063600           ,:ADJRNL-STR-NBR                                       06360099
063700           ,:ADJRNL-GL-ACCT-NBR                                   06370099
063800           ,:ADJRNL-DEPT-NBR                                      06380099
063900           ,:ADJRNL-AP-TRN-CDE                                    06390099
064000           ,:TRNCDE-PSTG-TYP-CDE                                  06400099
064100           ,:ADJRNL-TRN-TYP-CDE                                   06410099
064200           ,:ADJRNL-ENTR-TMST                                     06420099
064300           ,:ADJRNL-ENTR-ID                                       06430099
064400           ,:ADJRNL-ORGN-CDE                                      06440099
064500           ,:ADJRNL-RTL-AMT                                       06450099
064600           ,:ADJRNL-GRO-COST-AMT                                  06460099
064700           ,:ADJRNL-FRGT-AMT                                      06470099
064800           ,:ADJRNL-MISC-CHRG-AMT                                 06480099
064900           ,:ADJRNL-NET-COST-AMT                                  06490099
065000           ,:ADJRNL-TERM-DISC-PCT                                 06500099
065100           ,:ADJRNL-TERM-DISC-AMT                                 06510099
065200           ,:ADJRNL-NW-STR-DISC-PCT                               06520099
065300           ,:ADJRNL-NW-STR-DISC-AMT                               06530099
065400           ,:ADJRNL-TRD-DISC-PCT                                  06540099
065500           ,:ADJRNL-TRD-DISC-AMT                                  06550099
065600           ,:ADJRNL-INV-CTOFF-DTE                                 06560099
065700           ,:ADJRNL-BRCDE-NBR                                     06570099
065800           ,:ADJRNL-ENT-ID                                        06580099
065900           ,:ADJRNL-PS-BTCH-NBR                                   06590099
066000           ,:ADJRNL-PSTG-FYR-NBR                                  06600099
066100           ,:ADJRNL-PSTG-FMN-NBR                                  06610099
066200           ,:ADJRNL-PSTG-FWK-NBR                                  06620099
066300           ,:ADJRNL-PS-PSTG-IND                                   06630099
066400           ,:TRNCDE-AP-PSTG-IND                                   06640099
066500           ,:ADJRNL-MOS-DISC-PCT                                  06650099
066600           ,:ADJRNL-MOS-DISC-AMT                                  06660099
066700           ,:TRNCDE-TRN-TYP-CDE                                   06670099
066800     END-EXEC.                                                    06680099
066900                                                                  06690099
067000     EVALUATE TRUE                                                06700099
067100         WHEN SQLCODE = ZERO                                      06710099
067200              ADD 1 TO PV-EXTRACT-COUNT                           06720099
067300         WHEN SQLCODE = +100                                      06730099
067400              SET END-OF-EXTRACT-CSR TO TRUE                      06740099
067500         WHEN SQLWARN0 NOT = SPACES                               06750099
067600         WHEN SQLCODE  NOT = ZERO                                 06760099
067700             MOVE 'UNSUCCESSFUL FETCH FOR EXTRACT '               06770099
067800                                 TO PV-ABEND-OPERATION            06780099
067900             MOVE 'TADJRNL'      TO PV-ABEND-STRUCTURE-1          06790099
068000             MOVE 'TAJPSINT'     TO PV-ABEND-STRUCTURE-2          06800099
068100             MOVE 'TTRNCDE'      TO PV-ABEND-STRUCTURE-3          06810099
068200             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          06820099
068300             PERFORM Z999-DB2-ABEND                               06830099
068400     END-EVALUATE.                                                06840099
068500                                                                  06850099
068600                                                                  06860099
068700 EJECT                                                            06870099
068800*----------------------------------------------------------------*06880099
068900*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *06890099
069000*----------------------------------------------------------------*06900099
069100 R200-GET-CHECKPOINT-CNTL.                                        06910099
069200                                                                  06920099
069300     MOVE 'R200-GET-CHECKPOINT-CNTL' TO PV-ABEND-PARAGRAPH.       06930099
069400                                                                  06940099
069500     PERFORM WITH TEST AFTER                                      06950099
069600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   06960099
069700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             06970099
069800                     SQLCODE = ZERO                               06980099
069900                                                                  06990099
070000             EXEC SQL                                             07000099
070100              SELECT CKPT_STAT_CODE                               07010099
070200               INTO :PV-CKPT-STAT-CODE                            07020099
070300               FROM TCKRSTCNTL                                    07030099
070400               WHERE PLAN_NAME = :PC-PROGRAM-NAME                 07040099
070500             END-EXEC                                             07050099
070600                                                                  07060099
070700             EVALUATE TRUE                                        07070099
070800                 WHEN SQLCODE = ZERO                              07080099
070900                 WHEN SQLCODE = -904                              07090099
071000                 WHEN SQLCODE = -913                              07100099
071100                      CONTINUE                                    07110099
071200                                                                  07120099
071300                 WHEN SQLWARN0 NOT = SPACES                       07130099
071400                 WHEN SQLCODE  NOT = ZERO                         07140099
071500                     MOVE PV-ABEND-PARAGRAPH                      07150099
071600                                         TO AA-PARAGRAPH-NAME     07160099
071700                     DISPLAY '******** PLAN_NAME:'                07170099
071800                              PC-PROGRAM-NAME                     07180099
071900                     MOVE 'UNSUCCESSFUL SELECT'                   07190099
072000                                         TO PV-ABEND-OPERATION    07200099
072100                     MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1  07210099
072200                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  07220099
072300                                            PV-ABEND-STRUCTURE-3  07230099
072400                     PERFORM Z999-DB2-ABEND                       07240099
072500             END-EVALUATE                                         07250099
072600     END-PERFORM.                                                 07260099
072700                                                                  07270099
072800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             07280099
072900         MOVE PV-ABEND-PARAGRAPH                                  07290099
073000                             TO AA-PARAGRAPH-NAME                 07300099
073100         DISPLAY '******** PLAN_NAME:'                            07310099
073200                  PC-PROGRAM-NAME                                 07320099
073300         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    07330099
073400                             TO PV-ABEND-OPERATION                07340099
073500         MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1              07350099
073600         PERFORM Z999-DB2-ABEND                                   07360099
073700     END-IF.                                                      07370099
073800                                                                  07380099
073900                                                                  07390099
074000 EJECT                                                            07400099
074100*----------------------------------------------------------------*07410099
074200*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO.  07420099
074300*----------------------------------------------------------------*07430099
074400 R300-GET-CHECKPOINT-INFO.                                        07440099
074500                                                                  07450099
074600     MOVE 'R300-GET-CHECKPOINT-INFO' TO PV-ABEND-PARAGRAPH.       07460099
074700                                                                  07470099
074800     PERFORM WITH TEST AFTER                                      07480099
074900             VARYING PC-RETRY-COUNT FROM 1 BY 1                   07490099
075000             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             07500099
075100                     SQLCODE = ZERO                               07510099
075200                                                                  07520099
075300             EXEC SQL                                             07530099
075400              SELECT WORK_STRG_DESC                               07540099
075500               INTO :TCKRSTINF-WORK-STRG-DESC                     07550099
075600               FROM TCKRSTINF                                     07560099
075700               WHERE PLAN_NAME = :PC-PROGRAM-NAME                 07570099
075800             END-EXEC                                             07580099
075900                                                                  07590099
076000             EVALUATE TRUE                                        07600099
076100                 WHEN SQLCODE = ZERO                              07610099
076200                 WHEN SQLCODE = -904                              07620099
076300                 WHEN SQLCODE = -913                              07630099
076400                      CONTINUE                                    07640099
076500                                                                  07650099
076600                 WHEN SQLWARN0 NOT = SPACES                       07660099
076700                 WHEN SQLCODE  NOT = ZERO                         07670099
076800                     MOVE PV-ABEND-PARAGRAPH                      07680099
076900                                         TO AA-PARAGRAPH-NAME     07690099
077000                     DISPLAY '******** PLAN_NAME:'                07700099
077100                              PC-PROGRAM-NAME                     07710099
077200                     MOVE 'UNSUCCESSFUL SELECT'                   07720099
077300                                         TO PV-ABEND-STRUCTURE-1  07730099
077400                     MOVE 'TCKRSTINF'    TO PV-ABEND-STRUCTURE-2  07740099
077500                     MOVE SPACES         TO PV-ABEND-STRUCTURE-3  07750099
077600                                            PV-ABEND-STRUCTURE-1  07760099
077700                     PERFORM Z999-DB2-ABEND                       07770099
077800             END-EVALUATE                                         07780099
077900     END-PERFORM.                                                 07790099
078000                                                                  07800099
078100     IF PC-RETRY-COUNT > PC-RETRY-MAX                             07810099
078200         MOVE PV-ABEND-PARAGRAPH                                  07820099
078300                             TO AA-PARAGRAPH-NAME                 07830099
078400         DISPLAY '******** PLAN_NAME:'                            07840099
078500                  PC-PROGRAM-NAME                                 07850099
078600         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    07860099
078700                             TO PV-ABEND-OPERATION                07870099
078800         MOVE 'TCKRSTINF'    TO PV-ABEND-STRUCTURE-1              07880099
078900         MOVE SPACES         TO PV-ABEND-STRUCTURE-2              07890099
079000                                PV-ABEND-STRUCTURE-3              07900099
079100         PERFORM Z999-DB2-ABEND                                   07910099
079200     END-IF.                                                      07920099
079300                                                                  07930099
079400                                                                  07940099
079500 S100-GET-VENDOR-NAME.                                            07950099
079600*-----------------------------------------------------------      07960099
079700*  RETRIEVES VENDOR NAME FOR PO BEING PROCESSED.                  07970099
079800*-----------------------------------------------------------      07980099
079900     MOVE 'S100-GET-VENDOR-NAME' TO PV-ABEND-PARAGRAPH.           07990099
080000                                                                  08000099
080100     EXEC SQL                                                     08010099
080200         SELECT  NM.ENT_NAME_DESC                                 08020099
080300         INTO    :ENTNME-ENT-NAME-DESC                            08030099
080400         FROM    TENTNME NM                                       08040099
080500         WHERE   ENT_ID       = :ADJRNL-ENT-ID                    08050099
080600           AND   TYPE_CDE     = '01'                              08060099
080700     END-EXEC.                                                    08070099
080800                                                                  08080099
080900     EVALUATE TRUE                                                08090099
081000         WHEN SQLCODE = ZERO                                      08100099
081100             CONTINUE                                             08110099
081200                                                                  08120099
081300         WHEN SQLCODE = +100                                      08130099
081400             MOVE 'NO VENDOR PRIMARY NAME FOUND  '                08140099
081500                                 TO ENTNME-ENT-NAME-DESC          08150099
081600             MOVE SPACES         TO EXTENT-DUN-NBR                08160099
081700                                                                  08170099
081800         WHEN SQLWARN0 NOT = SPACES                               08180099
081900         WHEN SQLCODE  NOT = ZERO                                 08190099
082000             MOVE 'UNSUCCESSFUL SELECT'                           08200099
082100                                 TO PV-ABEND-OPERATION            08210099
082200             MOVE 'TPURCHS'               TO PV-ABEND-STRUCTURE-1 08220099
082300             MOVE 'TEXTENT'               TO PV-ABEND-STRUCTURE-2 08230099
082400             MOVE 'TENTNME'               TO PV-ABEND-STRUCTURE-3 08240099
082500             MOVE SPACES                  TO PV-ABEND-STRUCTURE-4 08250099
082600             PERFORM Z999-DB2-ABEND                               08260099
082700     END-EVALUATE.                                                08270099
082800                                                                  08280099
082900                                                                  08290099
083000 S200-GET-TAJPSINT-TABLE.                                         08300099
083100*-----------------------------------------------------------      08310099
083200*  RETRIEVES ADJUSTMENT JOURNAL INFORMATION IF IT EXISTS          08320099
083300*-----------------------------------------------------------      08330099
083400     MOVE 'S200-GET-TAJPSINT-TABLE' TO PV-ABEND-PARAGRAPH.        08340099
083500                                                                  08350099
083600     EXEC SQL                                                     08360099
083700         SELECT  DUE_DTE                                          08370099
083800               , RSN_1ST_LNE_TXT                                  08380099
083900               , RSN_2ND_LNE_TXT                                  08390099
084000               , DOC_HLD_CDE                                      08400099
084100               , AUTH_NBR                                         08410099
084200         INTO    :AJPSINT-DUE-DTE                                 08420099
084300               , :AJPSINT-RSN-1ST-LNE-TXT                         08430099
084400               , :AJPSINT-RSN-2ND-LNE-TXT                         08440099
084500               , :AJPSINT-DOC-HLD-CDE                             08450099
084600               , :AJPSINT-AUTH-NBR                                08460099
084700         FROM    TAJPSINT                                         08470099
084800         WHERE   VND_NBR     = :AP040-VND-NBR                     08480099
084900           AND   DOC_NBR     = :AP040-DOC-NBR                     08490099
085000           AND   DOC_DTE     = :AP040-DOC-DTE                     08500099
085100           AND   AP_TRN_CDE  = :AP040-AP-TRN-CDE                  08510099
085200     END-EXEC.                                                    08520099
085300                                                                  08530099
085400     EVALUATE TRUE                                                08540099
085500         WHEN SQLCODE = ZERO                                      08550099
085600             CONTINUE                                             08560099
085700                                                                  08570099
085800         WHEN SQLCODE = +100                                      08580099
085900             INITIALIZE AJPSINT-DUE-DTE                           08590099
086000                        AJPSINT-RSN-1ST-LNE-TXT                   08600099
086100                        AJPSINT-RSN-2ND-LNE-TXT                   08610099
086200                        AJPSINT-DOC-HLD-CDE                       08620099
086300                        AJPSINT-AUTH-NBR                          08630099
086400                                                                  08640099
086500         WHEN SQLWARN0 NOT = SPACES                               08650099
086600         WHEN SQLCODE  NOT = ZERO                                 08660099
086700             MOVE 'UNSUCCESSFUL SELECT'                           08670099
086800                                 TO PV-ABEND-OPERATION            08680099
086900             MOVE 'TAJPSINT'              TO PV-ABEND-STRUCTURE-1 08690099
087000             MOVE SPACES                  TO PV-ABEND-STRUCTURE-2 08700099
087100             MOVE SPACES                  TO PV-ABEND-STRUCTURE-3 08710099
087200             MOVE SPACES                  TO PV-ABEND-STRUCTURE-4 08720099
087300             PERFORM Z999-DB2-ABEND                               08730099
087400     END-EVALUATE.                                                08740099
087500                                                                  08750099
087600                                                                  08760099
087700 EJECT                                                            08770099
087800*---------------------------------------------------------------- 08780099
087900*  INSERT AP TRANSACTION RECORD INTO TOUTAPE                      08790099
088000*---------------------------------------------------------------- 08800099
088100 U100-INSERT-TRANS-RECORDS.                                       08810099
088200     MOVE 'U100-INSERT-TRANS-RECORDS' TO PV-ABEND-PARAGRAPH.      08820099
088300                                                                  08830099
088400* TOUTAPE IS VARCHAR, SO THE LENGTH OF THE DATA BEING MOVED TO    08840099
088500*  OUTAPE-PS-TRAN-ODR MUST BE MOVED TO OUTAPE-PS-TRAN-ODR.        08850099
088600* PC-AP040-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD040. 08860099
088700             EXEC SQL                                             08870099
088800                 INSERT INTO TOUTAPE                              08880099
088900                         (PS_TRN_ODR)                             08890099
089000                 VALUES  (:OUTAPE-PS-TRN-ODR)                     08900099
089100             END-EXEC                                             08910099
089200                                                                  08920099
089300             EVALUATE TRUE                                        08930099
089400                 WHEN SQLCODE = ZERO                              08940099
089500                      CONTINUE                                    08950099
089600                                                                  08960099
089700                 WHEN SQLWARN0 NOT = SPACES                       08970099
089800                 WHEN SQLCODE  NOT = ZERO                         08980099
089900                     MOVE 'UNSUCCESSFUL INSERT'                   08990099
090000                                         TO PV-ABEND-OPERATION    09000099
090100                     MOVE 'TOUTAPE'      TO PV-ABEND-STRUCTURE-1  09010099
090200                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  09020099
090300                                            PV-ABEND-STRUCTURE-3  09030099
090400                                            PV-ABEND-STRUCTURE-4  09040099
090500                     PERFORM Z999-DB2-ABEND                       09050099
090600             END-EVALUATE.                                        09060099
090700                                                                  09070099
090800                                                                  09080099
090900 EJECT                                                            09090099
091000*----------------------------------------------------------------*09100099
091100*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *09110099
091200*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *09120099
091300*----------------------------------------------------------------*09130099
091400 U400-UPDATE-TCKRSTCNTL.                                          09140099
091500                                                                  09150099
091600     MOVE 'U400-UPDATE-TCKRSTCNTL' TO PV-ABEND-PARAGRAPH.         09160099
091700                                                                  09170099
091800     PERFORM WITH TEST AFTER                                      09180099
091900             VARYING PC-RETRY-COUNT FROM 1 BY 1                   09190099
092000             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             09200099
092100                     SQLCODE = ZERO                               09210099
092200                                                                  09220099
092300             EXEC SQL                                             09230099
092400                 UPDATE TCKRSTCNTL                                09240099
092500                 SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE          09250099
092600                 WHERE PLAN_NAME      = :PC-PROGRAM-NAME          09260099
092700             END-EXEC                                             09270099
092800                                                                  09280099
092900             EVALUATE TRUE                                        09290099
093000                 WHEN SQLCODE = ZERO                              09300099
093100                 WHEN SQLCODE = -904                              09310099
093200                 WHEN SQLCODE = -913                              09320099
093300                      CONTINUE                                    09330099
093400                                                                  09340099
093500                 WHEN SQLWARN0 NOT = SPACES                       09350099
093600                 WHEN SQLCODE  NOT = ZERO                         09360099
093700                     MOVE PV-ABEND-PARAGRAPH                      09370099
093800                                         TO AA-PARAGRAPH-NAME     09380099
093900                     DISPLAY '******** PLAN_NAME:'                09390099
094000                              PC-PROGRAM-NAME                     09400099
094100                     MOVE 'UNSUCCESSFUL UPDATE'                   09410099
094200                                         TO PV-ABEND-OPERATION    09420099
094300                     MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1  09430099
094400                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  09440099
094500                                            PV-ABEND-STRUCTURE-3  09450099
094600                     PERFORM Z999-DB2-ABEND                       09460099
094700             END-EVALUATE                                         09470099
094800     END-PERFORM.                                                 09480099
094900                                                                  09490099
095000     IF PC-RETRY-COUNT > PC-RETRY-MAX                             09500099
095100         MOVE PV-ABEND-PARAGRAPH                                  09510099
095200                             TO AA-PARAGRAPH-NAME                 09520099
095300         DISPLAY '******** PLAN_NAME:'                            09530099
095400                  PC-PROGRAM-NAME                                 09540099
095500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    09550099
095600                             TO PV-ABEND-OPERATION                09560099
095700         MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1              09570099
095800         MOVE SPACES         TO PV-ABEND-STRUCTURE-2              09580099
095900                                PV-ABEND-STRUCTURE-3              09590099
096000         PERFORM Z999-DB2-ABEND                                   09600099
096100     END-IF.                                                      09610099
096200                                                                  09620099
096300                                                                  09630099
096400     EJECT                                                        09640099
096500*----------------------------------------------------------------*09650099
096600*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *09660099
096700*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *09670099
096800*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *09680099
096900*----------------------------------------------------------------*09690099
097000 U500-UPDATE-TCKRSTINF.                                           09700099
097100                                                                  09710099
097200     MOVE 'U500-UPDATE-TCKRSTINF' TO PV-ABEND-PARAGRAPH.          09720099
097300                                                                  09730099
097400     MOVE ADJRNL-VND-NBR           TO CR-VND-NBR.                 09740099
097500     MOVE ADJRNL-DOC-NBR           TO CR-DOC-NBR.                 09750099
097600     MOVE ADJRNL-DOC-DTE           TO CR-DOC-DTE.                 09760099
097700     MOVE ADJRNL-PO-NBR            TO CR-PO-NBR.                  09770099
097800     MOVE ADJRNL-STR-NBR           TO CR-STR-NBR.                 09780099
097900     MOVE ADJRNL-GL-ACCT-NBR       TO CR-GL-ACCT-NBR.             09790099
098000     MOVE ADJRNL-DEPT-NBR          TO CR-DEPT-NBR.                09800099
098100     MOVE ADJRNL-AP-TRN-CDE        TO CR-AP-TRN-CDE.              09810099
098200     MOVE TRNCDE-PSTG-TYP-CDE      TO CR-PSTG-TYP-CDE.            09820099
098300     MOVE ADJRNL-TRN-TYP-CDE       TO CR-TRN-TYP-CDE.             09830099
098400     MOVE PV-RECORDS-WRITTEN       TO CR-RECORDS-WRITTEN.         09840099
098500     MOVE PV-EXTRACT-COUNT         TO CR-EXTRACT-COUNT.           09850099
098600     MOVE CR-CKPT-RESTART-INFO  TO TCKRSTINF-WORK-STRG-DESC-TEXT. 09860099
098700     MOVE 4022                  TO TCKRSTINF-WORK-STRG-DESC-LEN.  09870099
098800                                                                  09880099
098900     PERFORM WITH TEST AFTER                                      09890099
099000             VARYING PC-RETRY-COUNT FROM 1 BY 1                   09900099
099100             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             09910099
099200                     SQLCODE = ZERO                               09920099
099300                                                                  09930099
099400             EXEC SQL                                             09940099
099500                 UPDATE TCKRSTINF                                 09950099
099600                 SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC 09960099
099700                 WHERE PLAN_NAME      = :PC-PROGRAM-NAME          09970099
099800             END-EXEC                                             09980099
099900                                                                  09990099
100000             EVALUATE TRUE                                        10000099
100100                 WHEN SQLCODE = ZERO                              10010099
100200                 WHEN SQLCODE = -904                              10020099
100300                 WHEN SQLCODE = -913                              10030099
100400                      CONTINUE                                    10040099
100500                                                                  10050099
100600                 WHEN SQLWARN0 NOT = SPACES                       10060099
100700                 WHEN SQLCODE  NOT = ZERO                         10070099
100800                     MOVE PV-ABEND-PARAGRAPH                      10080099
100900                                         TO AA-PARAGRAPH-NAME     10090099
101000                     DISPLAY '******** PLAN_NAME:'                10100099
101100                              PC-PROGRAM-NAME                     10110099
101200                     MOVE 'UNSUCCESSFUL UPDATE'                   10120099
101300                                         TO PV-ABEND-OPERATION    10130099
101400                     MOVE 'TCKRSTINF'    TO PV-ABEND-STRUCTURE-1  10140099
101500                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  10150099
101600                                            PV-ABEND-STRUCTURE-3  10160099
101700                     PERFORM Z999-DB2-ABEND                       10170099
101800             END-EVALUATE                                         10180099
101900     END-PERFORM.                                                 10190099
102000                                                                  10200099
102100     IF PC-RETRY-COUNT > PC-RETRY-MAX                             10210099
102200         MOVE PV-ABEND-PARAGRAPH                                  10220099
102300                             TO AA-PARAGRAPH-NAME                 10230099
102400         DISPLAY '******** PLAN_NAME:'                            10240099
102500                  PC-PROGRAM-NAME                                 10250099
102600         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    10260099
102700                             TO PV-ABEND-OPERATION                10270099
102800         MOVE 'TCKRSTINF'    TO PV-ABEND-STRUCTURE-1              10280099
102900         MOVE SPACES         TO PV-ABEND-STRUCTURE-2              10290099
103000                                PV-ABEND-STRUCTURE-3              10300099
103100         PERFORM Z999-DB2-ABEND                                   10310099
103200     END-IF.                                                      10320099
103300                                                                  10330099
103400                                                                  10340099
103500*----------------------------------------------------------------*10350099
103600*    OPENS THE EXTRACT CURSROR.                                  *10360099
103700*----------------------------------------------------------------*10370099
103800 Y100-OPEN-EXTRACT-CSR.                                           10380099
103900                                                                  10390099
104000     MOVE 'Y100-OPEN-EXTRACT-CSR' TO PV-ABEND-PARAGRAPH.          10400099
104100                                                                  10410099
104200     EXEC SQL                                                     10420099
104300         OPEN EXTRACT_CSR                                         10430099
104400     END-EXEC.                                                    10440099
104500                                                                  10450099
104600     EVALUATE TRUE                                                10460099
104700         WHEN SQLCODE = ZERO                                      10470099
104800              CONTINUE                                            10480099
104900                                                                  10490099
105000         WHEN SQLWARN0 NOT = SPACES                               10500099
105100         WHEN SQLCODE  NOT = ZERO                                 10510099
105200             MOVE 'UNSUCCESSFUL OPEN ON EXTRACT_CSR'              10520099
105300                                 TO PV-ABEND-OPERATION            10530099
105400             MOVE 'TADJRNL'      TO PV-ABEND-STRUCTURE-1          10540099
105500             MOVE 'TAJSPINT'     TO PV-ABEND-STRUCTURE-2          10550099
105600             MOVE 'TTRNCDE '     TO PV-ABEND-STRUCTURE-3          10560099
105700             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          10570099
105800             PERFORM Z999-DB2-ABEND                               10580099
105900     END-EVALUATE.                                                10590099
106000                                                                  10600099
106100                                                                  10610099
106200*----------------------------------------------------------------*10620099
106300*    CLOSES THE EXTRACT CURSOR.                                   10630099
106400*----------------------------------------------------------------*10640099
106500 Y200-CLOSE-EXTRACT-CSR.                                          10650099
106600                                                                  10660099
106700     MOVE 'Y200-CLOSE-EXTRACT-CSR' TO PV-ABEND-PARAGRAPH.         10670099
106800                                                                  10680099
106900     EXEC SQL                                                     10690099
107000         CLOSE EXTRACT_CSR                                        10700099
107100     END-EXEC.                                                    10710099
107200                                                                  10720099
107300     EVALUATE TRUE                                                10730099
107400         WHEN SQLCODE = ZERO                                      10740099
107500              CONTINUE                                            10750099
107600                                                                  10760099
107700         WHEN SQLWARN0 NOT = SPACES                               10770099
107800         WHEN SQLCODE  NOT = ZERO                                 10780099
107900             MOVE 'UNSUCCESSFUL CLOSE ON EXTRACT_CSR'             10790099
108000                                 TO PV-ABEND-OPERATION            10800099
108100             MOVE 'TADJRNL'      TO PV-ABEND-STRUCTURE-1          10810099
108200             MOVE 'TAJPSINT'     TO PV-ABEND-STRUCTURE-2          10820099
108300             MOVE 'TTRNCDE'      TO PV-ABEND-STRUCTURE-3          10830099
108400             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          10840099
108500             PERFORM Z999-DB2-ABEND                               10850099
108600     END-EVALUATE.                                                10860099
108700                                                                  10870099
108800                                                                  10880099
108900*----------------------------------------------------------------*10890099
109000*    ISSUES AN SQL COMMIT WORK AFTER A LUW HAS BEEN COMPLETED.   *10900099
109100*----------------------------------------------------------------*10910099
109200 Z100-COMMIT.                                                     10920099
109300                                                                  10930099
109400     MOVE 'Z100-COMMIT'    TO PV-ABEND-PARAGRAPH.                 10940099
109500                                                                  10950099
109600     EXEC SQL                                                     10960099
109700         COMMIT                                                   10970099
109800     END-EXEC.                                                    10980099
109900                                                                  10990099
110000     EVALUATE TRUE                                                11000099
110100         WHEN SQLCODE = ZEROS                                     11010099
110200             CONTINUE                                             11020099
110300         WHEN OTHER                                               11030099
110400             MOVE 'UNSUCCESSFUL COMMIT'                           11040099
110500                                 TO PV-ABEND-OPERATION            11050099
110600             MOVE SPACES         TO PV-ABEND-STRUCTURE-1          11060099
110700             PERFORM Z999-DB2-ABEND                               11070099
110800     END-EVALUATE.                                                11080099
110900                                                                  11090099
111000                                                                  11100099
111100 Z999-DB2-ABEND.                                                  11110099
111200*                                                                 11120099
111300***************************************************************** 11130099
111400*     PROCESS DB2 ABENDS                                          11140099
111500***************************************************************** 11150099
111600*                                                                 11160099
111700                                                                  11170099
111800     DISPLAY '*** DB2 ERROR '.                                    11180099
111900     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 11190099
112000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11200099
112100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11210099
112200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11220099
112300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             11230099
112400     DISPLAY '*** VENDOR NUMBER = ' CR-VND-NBR.                   11240099
112500     DISPLAY '*** DOC NUMBER    = ' CR-DOC-NBR.                   11250099
112600     IF PV-ABEND-STRUCTURE-2 > SPACES                             11260099
112700         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         11270099
112800     IF PV-ABEND-STRUCTURE-3 > SPACES                             11280099
112900         DISPLAY '*** TABLE 3   = ' PV-ABEND-STRUCTURE-3.         11290099
113000     IF PV-ABEND-STRUCTURE-4 > SPACES                             11300099
113100         DISPLAY '*** TABLE 4   = ' PV-ABEND-STRUCTURE-4.         11310099
113200                                                                  11320099
113300     COPY DPPD004.                                                11330099
113400                                                                  11340099
113500     MOVE +4013                    TO ABEND-CODE.                 11350099
113600                                                                  11360099
113700     CALL 'ILBOABN0' USING ABEND-CODE.                            11370099
