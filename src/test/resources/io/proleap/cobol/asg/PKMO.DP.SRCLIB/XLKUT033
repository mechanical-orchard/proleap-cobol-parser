000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    XLKUT033.                                         00020002
000300 AUTHOR.        RON KRIER.                                        00030002
000400 INSTALLATION.  KOHLS.                                            00040002
000500 DATE-WRITTEN   MARCH 29, 2003.                                   00050002
000600 DATE-COMPILED.                                                   00060002
000700                                                                  00070002
000800* ************************************************************** *00080002
000900* * XLKUT033.  "PURCHASE ORDER DOMAIN INTEGRITY"               * *00090002
001000* *                                                            * *00100002
001100* * PURPOSE:                                                   * *00110002
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TPURITM.        * *00120002
001300* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE TO PART  * *00130002
001400* * OF THE INTEGRITY PROCESS BETWEEN THE RMS PURCHASE ORDER    * *00140002
001500* * SYSTEM AND THE LOGISTICS DOMAIN PURCHASE ORDER TABLES.     * *00150002
001600* *                                                            * *00160002
001700* * PROCESSING OVERVIEW:                                       * *00170002
001800* *   THIS PROGRAM WILL READ THE INPUT DRIVER FILE AND THEN    * *00180002
001900* *   PERFORM A SELECT ON THE TPURITM TABLE.  DATA RETRIEVED   * *00190002
002000* *   FROM THE SELECT WILL THEN BE WRITTEN TO THE OUTPUT FILE. * *00200002
002010* *                                                            * *00201007
002020* *03/14/2012 G.BANDA AS PART OF THE INNER OUTER PACKAGING     * *00202007
002030* *   PROJECT, TWO FIELDS ADDED TO TPURITM TABLE.                 00203007
002040* *   (INNR_PK_QTY , OUTR_PK_QTY)                              * *00204007
002050* *   PROGRAM CHANGES TO INCREASE FD TO 299 AS WELL            * *00205007
002060* *   AS ADDING FIELDS TO TABLE-CURSOR                     * *    00206007
002100**************************************************************** *00210002
002200 ENVIRONMENT DIVISION.                                            00220002
002300 CONFIGURATION SECTION.                                           00230002
002400 SOURCE-COMPUTER.        IBM-3090.                                00240002
002500 OBJECT-COMPUTER.        IBM-3090.                                00250002
002600                                                                  00260002
002700 INPUT-OUTPUT SECTION.                                            00270002
002800 FILE-CONTROL.                                                    00280002
002900                                                                  00290002
003000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00300002
003100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00310002
003200                                                                  00320002
003300******************************************************************00330002
003400 DATA DIVISION.                                                   00340002
003500 FILE SECTION.                                                    00350002
003600                                                                  00360002
003700 FD  IN-DRIVER-FILE                                               00370002
003800     RECORDING MODE IS F                                          00380002
003900     LABEL RECORDS ARE STANDARD                                   00390002
004000     BLOCK CONTAINS 0 RECORDS.                                    00400002
004100 01  IN-DRIVER-RECORD                PIC  X(030).                 00410002
004200                                                                  00420002
004300**** TPURITM:                                                     00430002
004400 FD  OUT-EXTRACT-FILE                                             00440002
004500     RECORDING MODE IS F                                          00450002
004600     LABEL RECORDS ARE STANDARD                                   00460002
004700     BLOCK CONTAINS 0 RECORDS.                                    00470002
004800 01  OUT-EXTRACT-RECORD              PIC  X(299).                 00480007
004900                                                                  00490002
005000                                                                  00500002
005100                                                                  00510002
005200 WORKING-STORAGE SECTION.                                         00520002
005300                                                                  00530002
005400 01  PC-PROGRAM-CONSTANTS.                                        00540002
005500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'XLKUT033'.  00550002
005600     05  PC-PGM-PROGRESS-DESC.                                    00560002
005700         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00570002
005800         10  PC-CONTINUING           PIC X(10) VALUE              00580002
005900                                               'CONTINUING'.      00590002
006000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00600002
006100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00610002
006200     05  PC-ABEND-INFO.                                           00620002
006300         10  PC-ABEND                PIC X(11) VALUE              00630002
006400                                               '** ABEND **'.     00640002
006500         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00650002
006600                                               '- PARA       : '. 00660002
006700         10  PC-ABEND-MSG-DISPLAY-PARA                            00670002
006800                                     PIC X(15) VALUE              00680002
006900                                               '  CALLED PARA: '. 00690002
007000         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00700002
007100                                               '  FOR ABEND# : '. 00710002
007200         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00720002
007300                                               '- ERROR IS   : '. 00730002
007400         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00740002
007500         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00750002
007600                                               '- ACTION     : '. 00760002
007700     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00770002
007800                                                                  00780002
007900 01  PS-PROGRAM-SWITCHES.                                         00790002
008000     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00800002
008100         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00810002
008200         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00820002
008300     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         00830002
008400         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         00840002
008500         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         00850002
008600     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00860002
008700         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00870002
008800         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00880002
008900                                                                  00890002
009000 01  PV-PROGRAM-VARIABLES.                                        00900002
009100     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      00910002
009200     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           00920002
009300     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           00930002
009400     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           00940002
009500     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           00950002
009600     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           00960002
009700                                                                  00970002
009800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00980002
009900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00990002
010000     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01000002
010100     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01010002
010200     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01020002
010300     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01030002
010400                                                                  01040002
010500     05  PV-TMST                     PIC X(26) VALUE SPACES.      01050002
010600     05  PV-TIMESTAMP-DETAIL                                      01060002
010700         REDEFINES                                                01070002
010800         PV-TMST.                                                 01080002
010900         10  PV-TIMESTAMP-19.                                     01090002
011000             15  PV-TMS-DATE.                                     01100002
011100                 20  PV-TMS-YEAR.                                 01110002
011200                     25  PV-TMS-CC   PIC X(02).                   01120002
011300                     25  PV-TMS-YY   PIC X(02).                   01130002
011400                 20  FILLER          PIC X(01).                   01140002
011500                 20  PV-TMS-MONTH    PIC X(02).                   01150002
011600                 20  FILLER          PIC X(01).                   01160002
011700                 20  PV-TMS-DAY      PIC X(02).                   01170002
011800             15  FILLER              PIC X(01).                   01180002
011900             15  PV-TMS-HOUR         PIC X(02).                   01190002
012000             15  FILLER              PIC X(01).                   01200002
012100             15  PV-TMS-MINUTE       PIC X(02).                   01210002
012200             15  FILLER              PIC X(01).                   01220002
012300             15  PV-TMS-SECOND       PIC X(02).                   01230002
012400         10  FILLER                  PIC X(01).                   01240002
012500         10  PV-TMS-MSECOND          PIC X(06).                   01250002
012600                                                                  01260002
012700 01  DM-DISPLAY-MESSAGE.                                          01270002
012800     05  DM-01-10.                                                01280002
012900         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01290002
013000         10  FILLER                  PIC X(02) VALUE ': '.        01300002
013100     05  DM-11-80.                                                01310002
013200         10  FILLER                  PIC X(37) VALUE              01320002
013300                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01330002
013400         10  FILLER                  PIC X(30) VALUE              01340002
013500                        'CREATING TPURITM EXTRACT FILE.'.         01350002
013600         10  FILLER                  PIC X(01) VALUE SPACE.       01360002
013700         10  FILLER                  PIC X(01) VALUE ALL '*'.     01370002
013800     05  DM-81-120.                                               01380002
013900         10  FILLER                  PIC X(40) VALUE ALL '*'.     01390002
014000                                                                  01400002
014100 01  DP-DISPLAY-PROGRESS-MSG.                                     01410002
014200     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01420002
014300     05  FILLER                      PIC X(02) VALUE SPACE.       01430002
014400     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01440002
014500     05  FILLER                      PIC X(04) VALUE ' AT '.      01450002
014600     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01460002
014700     05  FILLER                      PIC X(03) VALUE '.  '.       01470002
014800     05  FILLER                      PIC X(03) VALUE              01480002
014900                                         'IN:'.                   01490002
015000     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01500002
015100                                               VALUE ZERO.        01510002
015200     05  FILLER                      PIC X(02) VALUE ', '.        01520002
015300*    05  FILLER                      PIC X(16) VALUE              01530002
015400*                                        'DRIVER W/ROW(S):'.      01540002
015500*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01550002
015600*                                              VALUE ZERO.        01560002
015700*    05  FILLER                      PIC X(02) VALUE ', '.        01570002
015800     05  FILLER                      PIC X(14) VALUE              01580002
015900                                         'ROWS SELECTED:'.        01590002
016000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01600002
016100                                               VALUE ZERO.        01610002
016200     05  FILLER                      PIC X(02) VALUE ', '.        01620002
016300     05  FILLER                      PIC X(04) VALUE              01630002
016400                                         'OUT:'.                  01640002
016500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01650002
016600                                               VALUE ZERO.        01660002
016700     05  FILLER                      PIC X(01) VALUE '.'.         01670002
016800                                                                  01680002
016900 01  ABEND-CODE                      PIC S9(04)                   01690002
017000                                               VALUE ZEROES       01700002
017100                                               COMP SYNC.         01710002
017200                                                                  01720002
017300*---------------------------------------------------------------* 01730002
017400*  DB2 FORMATTED MESSAGE AREA                                     01740002
017500*---------------------------------------------------------------* 01750002
017600     COPY DPWS004.                                                01760002
017700                                                                  01770002
017800                                                                  01780002
017900*---------------------------------------------------------------* 01790002
018000*  XLRD013  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01800002
018100*---------------------------------------------------------------* 01810002
018200     COPY XLRD013.                                                01820002
018300                                                                  01830002
018400                                                                  01840002
018500*---------------------------------------------------------------* 01850002
018600*    DB2 AREA FOR TPURITM                                       * 01860002
018700*---------------------------------------------------------------* 01870002
018800     EXEC SQL                                                     01880002
018900          INCLUDE TPURITM                                         01890002
019000     END-EXEC.                                                    01900002
019100                                                                  01910002
019200*---------------------------------------------------------------* 01920002
019300*    DB2 AREA FOR COMMUNICATIONS                                * 01930002
019400*---------------------------------------------------------------* 01940002
019500     EXEC SQL                                                     01950002
019600          INCLUDE SQLCA                                           01960002
019700     END-EXEC.                                                    01970002
019800                                                                  01980002
019900*---------------------------------------------------------------* 01990002
020000*    DEFINE CURSOR FOR TPURITM :                                * 02000002
020100*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02010002
020200*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02020002
020300*---------------------------------------------------------------* 02030002
020400     EXEC SQL                                                     02040002
020500          DECLARE TABLE-CURSOR CURSOR FOR                         02050002
020600           SELECT PO_NBR                                          02060002
020700                 ,VER_NBR                                         02070002
020800                 ,PO_LNE_NBR                                      02080002
020900                 ,VER_STATUS_CDE                                  02090002
021000                 ,SKU_SEQ_NBR                                     02100002
021100                 ,CL_NBR                                          02110002
021200                 ,VEND_STYL_NAME                                  02120002
021300                 ,COLOR_DESC                                      02130002
021400                 ,SIZE_DESC                                       02140002
021500                 ,UM_IND                                          02150002
021600                 ,UNT_QTY                                         02160002
021700                 ,UNT_RTL_PR_AMT                                  02170002
021800                 ,UNT_COST_AMT                                    02180002
021900                 ,TOT_VAL_COST_AMT                                02190002
022000                 ,TOT_VAL_RTL_AMT                                 02200002
022100                 ,MU_PCT                                          02210002
022200                 ,CRE_TMST                                        02220002
022300                 ,LAST_UPD_TMST                                   02230002
022400                 ,ITM_NBR                                         02240002
022500                 ,SKU_DESC                                        02250002
022600                 ,COLOR_CDE                                       02260002
022700                 ,SIZE_CDE                                        02270002
022800                 ,AD_EVNT_DTE                                     02280002
022900                 ,STATUS_CDE                                      02290002
023000                 ,CRE_BY_UID                                      02300002
023100                 ,LAST_UPD_BY_UID                                 02310002
023200                 ,GP_RTL_AMT                                      02320002
023300                 ,GP_QTY                                          02330006
023400                 ,APP_PO_LNE_NBR                                  02340002
023500                 ,PIC_ITM_IND                                     02350002
023600                 ,PIC_PG_NBR                                      02360002
023700                 ,PRD_1ST_COST_AMT                                02370002
023800                 ,STAT_TMST                                       02380002
023900                 ,PO_PREPK_ID                                     02390002
024000                 ,PREPK_RATO_QTY                                  02400002
024100                 ,SHIP_TO_TMP_DC_IND                              02410002
024200                 ,RMS_PO_SKU_NBR                                  02420002
024300                 ,CNCLD_UNT_QTY                                   02430004
024310                 ,INNR_PK_QTY                                     02431007
024320                 ,OUTR_PK_QTY                                     02432007
024400           FROM   TPURITM                                         02440002
024500          WHERE  (PO_NBR        = :PV-PO-NBR-COMP)                02450006
024600            AND  VER_STATUS_CDE = 'A'                             02460002
024610            AND  SKU_SEQ_NBR NOT IN ('000', '999')                02461006
024700            FOR  FETCH ONLY                                       02470002
024800           WITH  UR                                               02480002
024900     END-EXEC.                                                    02490002
025000                                                                  02500002
025100                                                                  02510002
025200 PROCEDURE DIVISION.                                              02520002
025300********************                                              02530002
025400                                                                  02540002
025500 0000-PROGRAM-MAINLINE.                                           02550002
025600                                                                  02560002
025700     PERFORM 1000-INITIALIZE.                                     02570002
025800                                                                  02580002
025900     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02590002
026000     PERFORM 2000-PROCESS-DRIVER-FILE                             02600002
026100         UNTIL PS-IN-DRIVER-EOF.                                  02610002
026200                                                                  02620002
026300     PERFORM 6000-EOJ-ROUTINE.                                    02630002
026400     STOP RUN.                                                    02640002
026500                                                                  02650002
026600                                                                  02660002
026700* ************************************************************** *02670002
026800* * INITIALIZATIONS                                            * *02680002
026900* ************************************************************** *02690002
027000 1000-INITIALIZE.                                                 02700002
027100                                                                  02710002
027200     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02720002
027300     DISPLAY DM-DISPLAY-MESSAGE.                                  02730002
027400                                                                  02740002
027500     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02750002
027600     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02760002
027700                                                                  02770002
027800     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02780002
027900     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02790002
028000                                                                  02800002
028100                                                                  02810002
028200* ************************************************************** *02820002
028300* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02830002
028400* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02840002
028500* *    1B- OPEN TABLE CURSOR                                   * *02850002
028600* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02860002
028700* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02870002
028800* *    2) FOR EACH ROW,                                        * *02880002
028900* *       2A- INCREMENT COUNTS                                 * *02890002
029000* *       2B- WRITE EXTRACT RECORD                             * *02900002
029100* *    1D- CLOSE TABLE CURSOR                                  * *02910002
029200* ************************************************************** *02920002
029300 2000-PROCESS-DRIVER-FILE.                                        02930002
029400                                                                  02940002
029500     PERFORM 9050-READ-IN-DRIVER-FILE.                            02950002
029600     IF PS-IN-DRIVER-EOF                                          02960002
029700         CONTINUE                                                 02970002
029800     ELSE                                                         02980002
029900         MOVE XL013-PO-NBR TO         PV-PO-NBR-COMP              02990002
030000                                      PV-PO-NBR-NUM               03000002
030100         PERFORM 2100-CHECK-PGM-PROGRESS                          03010002
030200         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     03020002
030300         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     03030002
030400         PERFORM 9100-OPEN-TABLE-CURSOR                           03040002
030500         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     03050002
030600             UNTIL PS-TABLE-LOOP-DONE                             03060002
030700         PERFORM 9190-CLOSE-TABLE-CURSOR                          03070002
030800     END-IF.                                                      03080002
030900                                                                  03090002
031000                                                                  03100002
031100* ************************************************************** *03110002
031200* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03120002
031300* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03130002
031400* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03140002
031500* ************************************************************** *03150002
031600 2100-CHECK-PGM-PROGRESS.                                         03160002
031700     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03170002
031800         BY        PC-HOW-OFTEN-TO-DISPLAY                        03180002
031900         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03190002
032000         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03200002
032100                                                                  03210002
032200     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03220002
032300         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03230002
032400         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03240002
032500     END-IF.                                                      03250002
032600                                                                  03260002
032700                                                                  03270002
032800* ************************************************************** *03280002
032900* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03290002
033000* ************************************************************** *03300002
033100 3000-EXTRACT-ROWS-FROM-TABLE.                                    03310002
033200     INITIALIZE DCLTPURITM.                                       03320002
033300     PERFORM 9150-FETCH-TABLE-CURSOR.                             03330002
033400     IF PS-TABLE-LOOP-DONE                                        03340002
033500         CONTINUE                                                 03350002
033600     ELSE                                                         03360002
033700         PERFORM 9750-WRITE-EXTRACT-RECORD                        03370002
033800     END-IF.                                                      03380002
033900                                                                  03390002
034000                                                                  03400002
034100* ************************************************************** *03410002
034200* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03420002
034300* ************************************************************** *03430002
034400 6000-EOJ-ROUTINE.                                                03440002
034500                                                                  03450002
034600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03460002
034700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03470002
034800                                                                  03480002
034900     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03490002
035000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03500002
035100                                                                  03510002
035200                                                                  03520002
035300* ************************************************************** *03530002
035400* * DISPLAY PROGRAM PROGRESS.                                  * *03540002
035500* ************************************************************** *03550002
035600 6200-DISPLAY-PGM-PROGRESS.                                       03560002
035700                                                                  03570002
035800     EXEC SQL                                                     03580002
035900          SET :PV-TMST = CURRENT TIMESTAMP                        03590002
036000     END-EXEC.                                                    03600002
036100                                                                  03610002
036200     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03620002
036300     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03630002
036400     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03640002
036500                                    TO DP-IN-CNT.                 03650002
036600*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03660002
036700     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03670002
036800     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03680002
036900                                                                  03690002
037000     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03700002
037100                                                                  03710002
037200                                                                  03720002
037300* ************************************************************** *03730002
037400* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03740002
037500* * 90XX- INPUT:  DRIVER FILE                                  * *03750002
037600* * 91XX- INPUT:  TABLE CURSOR                                 * *03760002
037700* * 97XX- OUTPUT: TABLE EXTRACT                                * *03770002
037800* ************************************************************** *03780002
037900                                                                  03790002
038000* ************************************************************** *03800002
038100* * OPEN  INPUT DRIVER FILE                                    * *03810002
038200* ************************************************************** *03820002
038300 9000-OPEN-IN-DRIVER-FILE.                                        03830002
038400     OPEN  INPUT  IN-DRIVER-FILE.                                 03840002
038500                                                                  03850002
038600                                                                  03860002
038700* ************************************************************** *03870002
038800* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03880002
038900* ************************************************************** *03890002
039000 9050-READ-IN-DRIVER-FILE.                                        03900002
039100     READ IN-DRIVER-FILE                                          03910002
039200          INTO XL013-DRIVER-RECORD-LAYOUT                         03920002
039300          AT END                                                  03930002
039400              SET PS-IN-DRIVER-EOF TO TRUE.                       03940002
039500                                                                  03950002
039600     IF PS-IN-DRIVER-EOF                                          03960002
039700         CONTINUE                                                 03970002
039800     ELSE                                                         03980002
039900         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03990002
040000     END-IF.                                                      04000002
040100                                                                  04010002
040200                                                                  04020002
040300* ************************************************************** *04030002
040400* * CLOSE INPUT DRIVER FILE                                    * *04040002
040500* ************************************************************** *04050002
040600 9090-CLOSE-IN-DRIVER-FILE.                                       04060002
040700     CLOSE IN-DRIVER-FILE.                                        04070002
040800                                                                  04080002
040900                                                                  04090002
041000* ************************************************************** *04100002
041100* * OPEN  TABLE CURSOR                                         * *04110002
041200* ************************************************************** *04120002
041300 9100-OPEN-TABLE-CURSOR.                                          04130002
041400     EXEC SQL                                                     04140002
041500          OPEN TABLE-CURSOR                                       04150002
041600     END-EXEC.                                                    04160002
041700                                                                  04170002
041800     EVALUATE TRUE                                                04180002
041900         WHEN SQLCODE = ZERO                                      04190002
042000              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04200002
042100              SET PS-CURSOR-HAS-DATA TO TRUE                      04210002
042200         WHEN SQLCODE = +100                                      04220002
042300              SET PS-TABLE-LOOP-DONE TO TRUE                      04230002
042400         WHEN SQLWARN0 NOT EQUAL SPACE                            04240002
042500         WHEN SQLCODE  NOT EQUAL ZERO                             04250002
042600              MOVE '9100-OPEN-TABLE-CURSOR'                       04260002
042700                                 TO PV-PARAGRAPH-NAME             04270002
042800              MOVE 'OPEN TABLE CURSOR'                            04280002
042900                                 TO PV-DB2-OPERATION-MSG-1        04290002
043000              MOVE 'TPURITM'     TO PV-DB2-TABLE-NAME             04300002
043100              PERFORM 9999-DB2-ABEND                              04310002
043200     END-EVALUATE.                                                04320002
043300                                                                  04330002
043400                                                                  04340002
043500* ************************************************************** *04350002
043600* * FETCH TABLE CURSOR                                         * *04360002
043700* ************************************************************** *04370002
043800 9150-FETCH-TABLE-CURSOR.                                         04380002
043900     EXEC SQL                                                     04390002
044000         FETCH TABLE-CURSOR                                       04400002
044100          INTO  :PURITM-PO-NBR                                    04410002
044200               ,:PURITM-VER-NBR                                   04420002
044300               ,:PURITM-PO-LNE-NBR                                04430002
044400               ,:PURITM-VER-STATUS-CDE                            04440002
044500               ,:PURITM-SKU-SEQ-NBR                               04450002
044600               ,:PURITM-CL-NBR                                    04460002
044700               ,:PURITM-VEND-STYL-NAME                            04470002
044800               ,:PURITM-COLOR-DESC                                04480002
044900               ,:PURITM-SIZE-DESC                                 04490002
045000               ,:PURITM-UM-IND                                    04500002
045100               ,:PURITM-UNT-QTY                                   04510002
045200               ,:PURITM-UNT-RTL-PR-AMT                            04520002
045300               ,:PURITM-UNT-COST-AMT                              04530002
045400               ,:PURITM-TOT-VAL-COST-AMT                          04540002
045500               ,:PURITM-TOT-VAL-RTL-AMT                           04550002
045600               ,:PURITM-MU-PCT                                    04560002
045700               ,:PURITM-CRE-TMST                                  04570002
045800               ,:PURITM-LAST-UPD-TMST                             04580002
045900               ,:PURITM-ITM-NBR                                   04590002
046000               ,:PURITM-SKU-DESC                                  04600002
046100               ,:PURITM-COLOR-CDE                                 04610002
046200               ,:PURITM-SIZE-CDE                                  04620002
046300               ,:PURITM-AD-EVNT-DTE                               04630002
046400               ,:PURITM-STATUS-CDE                                04640002
046500               ,:PURITM-CRE-BY-UID                                04650002
046600               ,:PURITM-LAST-UPD-BY-UID                           04660002
046700               ,:PURITM-GP-RTL-AMT                                04670002
046800               ,:PURITM-GP-QTY                                    04680002
046900               ,:PURITM-APP-PO-LNE-NBR                            04690002
047000               ,:PURITM-PIC-ITM-IND                               04700002
047100               ,:PURITM-PIC-PG-NBR                                04710002
047200               ,:PURITM-PRD-1ST-COST-AMT                          04720002
047300               ,:PURITM-STAT-TMST                                 04730002
047400               ,:PURITM-PO-PREPK-ID                               04740002
047500               ,:PURITM-PREPK-RATO-QTY                            04750002
047600               ,:PURITM-SHIP-TO-TMP-DC-IND                        04760002
047700               ,:PURITM-RMS-PO-SKU-NBR                            04770002
047800               ,:PURITM-CNCLD-UNT-QTY                             04780004
047810               ,:PURITM-INNR-PK-QTY                               04781007
047820               ,:PURITM-OUTR-PK-QTY                               04782007
047900     END-EXEC.                                                    04790002
048000                                                                  04800002
048100     EVALUATE TRUE                                                04810002
048200         WHEN SQLCODE = ZERO                                      04820002
048300              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04830002
048400              SET PS-CURSOR-HAS-DATA TO TRUE                      04840002
048500         WHEN SQLCODE = +100                                      04850002
048600              SET PS-TABLE-LOOP-DONE TO TRUE                      04860002
048700         WHEN SQLWARN0 NOT EQUAL SPACE                            04870002
048800         WHEN SQLCODE NOT EQUAL ZERO                              04880002
048900              MOVE '9150-FETCH-TABLE-CURSOR'                      04890002
049000                                 TO PV-PARAGRAPH-NAME             04900002
049100              MOVE 'FETCH TABLE CURSOR'                           04910002
049200                                 TO PV-DB2-OPERATION-MSG-1        04920002
049300              MOVE 'TPURITM'     TO PV-DB2-TABLE-NAME             04930002
049400              PERFORM 9999-DB2-ABEND                              04940002
049500     END-EVALUATE.                                                04950002
049600                                                                  04960002
049700                                                                  04970002
049800* ************************************************************** *04980002
049900* * CLOSE TABLE CURSOR                                         * *04990002
050000* ************************************************************** *05000002
050100 9190-CLOSE-TABLE-CURSOR.                                         05010002
050200     EXEC SQL                                                     05020002
050300          CLOSE TABLE-CURSOR                                      05030002
050400     END-EXEC.                                                    05040002
050500                                                                  05050002
050600     EVALUATE TRUE                                                05060002
050700         WHEN SQLCODE = ZERO                                      05070002
050800              CONTINUE                                            05080002
050900         WHEN SQLWARN0 NOT EQUAL SPACE                            05090002
051000         WHEN SQLCODE NOT EQUAL ZERO                              05100002
051100              MOVE '9190-CLOSE-TABLE-CURSOR'                      05110002
051200                                 TO PV-PARAGRAPH-NAME             05120002
051300              MOVE 'CLOSE TABLE CURSOR'                           05130002
051400                                 TO PV-DB2-OPERATION-MSG-1        05140002
051500              MOVE 'TPURITM'     TO PV-DB2-TABLE-NAME             05150002
051600              PERFORM 9999-DB2-ABEND                              05160002
051700     END-EVALUATE.                                                05170002
051800                                                                  05180002
051900                                                                  05190002
052000* ************************************************************** *05200002
052100* * OPEN OUTPUT EXTRACT FILE                                   * *05210002
052200* ************************************************************** *05220002
052300 9700-OPEN-OUT-EXTRACT-FILE.                                      05230002
052400     OPEN OUTPUT OUT-EXTRACT-FILE.                                05240002
052500                                                                  05250002
052600                                                                  05260002
052700* ************************************************************** *05270002
052800* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05280002
052900* ************************************************************** *05290002
053000 9750-WRITE-EXTRACT-RECORD.                                       05300002
053100     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTPURITM.                 05310002
053200     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05320002
053300                                                                  05330002
053400                                                                  05340002
053500* ************************************************************** *05350002
053600* * CLOSE OUTPUT EXTRACT FILE                                  * *05360002
053700* ************************************************************** *05370002
053800 9790-CLOSE-OUT-EXTRACT-FILE.                                     05380002
053900     CLOSE OUT-EXTRACT-FILE.                                      05390002
054000                                                                  05400002
054100                                                                  05410002
054200* ************************************************************** *05420002
054300* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05430002
054400* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05440002
054500* * SQL ERROR OR WARNING CODE OCCURS.                          * *05450002
054600* ************************************************************** *05460002
054700 9999-DB2-ABEND.                                                  05470002
054800                                                                  05480002
054900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05490002
055000             ' 9999-DB2-ABEND'.                                   05500002
055100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05510002
055200             ' ** ABEND           **'.                            05520002
055300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05530002
055400             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05540002
055500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05550002
055600             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05560002
055700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05570002
055800             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05580002
055900                                                                  05590002
056000     DISPLAY PC-CURRENT-PROGRAM-NAME                              05600002
056100             ' ** SQLCODE         ** = ' SQLCODE.                 05610002
056200     MOVE SQLCODE TO PV-SQLCODE.                                  05620002
056300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05630002
056400             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05640002
056500                                                                  05650002
056600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05660002
056700             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05670002
056800                                                                  05680002
056900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05690003
057000             ' ** PO NUMBER       ** = ' PV-PO-NBR-NUM '.'.       05700003
057100                                                                  05710003
057200                                                                  05720002
057300*----------------------------------------------------------------*05730002
057400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05740002
057500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05750002
057600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05760002
057700* FORMAT.                                                        *05770002
057800*----------------------------------------------------------------*05780002
057900     COPY DPPD004.                                                05790002
058000                                                                  05800002
058100     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05810002
058200     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05820002
058300     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05830002
058400     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05840002
058500                                                                  05850002
058600*----------------------------------------------------------------*05860002
058700* CALL ABEND                                                     *05870002
058800*----------------------------------------------------------------*05880002
058900     MOVE +4013                  TO ABEND-CODE.                   05890002
059000     CALL 'ILBOABN0' USING ABEND-CODE.                            05900002
059100*                                                                 05910002
