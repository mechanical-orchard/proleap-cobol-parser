000100 ID  DIVISION.                                                    00010000
000200 PROGRAM-ID.         MRKUT090.                                    00020000
000300 AUTHOR.             LINDA GRIESBACH.                             00030000
000400 INSTALLATION.       KOHL'S CORPORATION.                          00040000
000500 DATE-WRITTEN.       NOVEMBER 1998.                               00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800***************************************************************** 00080000
000900*       THE PURPOSE OF THIS PROGRAM IS TO CAPTURE INFOREM       * 00090000
001000*       SKU/STORES THAT REACH A ZERO ONHAND ON ANY GIVEN        * 00100000
001100*       DAY WITHIN A WEEK.                                      * 00110000
001200***************************************************************** 00120000
001300*                                                               * 00130004
001400*  CHANGED 03/27/00 BY T BAGWELL                  WR# 99998     * 00140004
001500*    ADDED CHECK FOR ACTIVE STORES (FT_CODE NOT EQUAL 'X')      * 00150004
001600*    TO ACCOMMODATE REGIONAL CLEARANCE PRICING.                 * 00160004
001700***************************************************************** 00170004
001710* 04/24/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         * 00171005
001720* -  TSKXREF ADDED.                                             * 00172005
001730* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00173005
001740*    IN FIELDS.                                                 * 00174005
001750* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       * 00175005
001760*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    * 00176005
001700***************************************************************** 00177016
001710* 06/09/2004 - BOB FORD WR#26363 STORE NUMBER EXPANSION         * 00178016
001720*    CHANGED PGM TO HANDLE 5-DIGIT STORE NUMBERS.  CHANGED ALL  * 00178116
001730*    TABLES TO REFERENCE NUMERIC STORE, CHANGED COPYBOOK MRRD030* 00178216
001740*    TO NUMERIC STORE, CHANGED VSAM DEFINITION.                 * 00178316
001790***************************************************************** 00179005
001800*                                                               * 00180004
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.        IBM-370.                                 00210000
002200 OBJECT-COMPUTER.        IBM-370.                                 00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400 FILE-CONTROL.                                                    00240000
002500     SELECT OUT-OF-INV-FILE                                       00250000
002600         ORGANIZATION IS INDEXED                                  00260000
002700         RECORD KEY IS OUT-OF-INV-KEY                             00270000
002800         ACCESS IS DYNAMIC                                        00280000
002900         FILE STATUS IS VSAM-STATUS                               00290000
003000         ASSIGN TO INOUT01.                                       00300000
003100                                                                  00310000
003200 DATA DIVISION.                                                   00320000
003300 FILE SECTION.                                                    00330000
003400 FD  OUT-OF-INV-FILE.                                             00340000
003500 01  OUT-OF-INV-RECORD.                                           00350000
003600     05  OUT-OF-INV-KEY.                                          00360000
003700         10  OUT-OF-INV-DEPT-NBR    PIC X(3).                     00370000
003800         10  OUT-OF-INV-CLASS-NBR   PIC X(2).                     00380000
003900         10  OUT-OF-INV-VENDOR-STYLE                              00390000
004000                                    PIC X(20).                    00400000
004100         10  OUT-OF-INV-COLOR-DESC  PIC X(20).                    00410000
004200         10  OUT-OF-INV-ITEM-NBR    PIC 9(15).                    00420000
004300         10  OUT-OF-INV-STORE-NBR   PIC S9(5).                    00430014
004400                                                                  00440000
004500 WORKING-STORAGE SECTION.                                         00450000
004600                                                                  00460000
004700 01  SWITCHES.                                                    00470000
004800     05  VSAM-STATUS                PIC X(2).                     00480000
004900         88  SUCCESSFUL                         VALUE '00'.       00490000
005000         88  DUPLICATE-KEY                      VALUE '22'.       00500000
005100     05  OUT-OF-INV-SW              PIC X(1)    VALUE 'N'.        00510000
005200         88  END-OF-OUT-OF-INV                  VALUE 'Y'.        00520000
005300         88  NOT-END-OF-OUT-OF-INV              VALUE 'N'.        00530000
005400     05  DESC-SW                    PIC X(1)    VALUE 'N'.        00540000
005500         88  DESC-FOUND                         VALUE 'Y'.        00550000
005600         88  DESC-NOT-FOUND                     VALUE 'N'.        00560000
005700                                                                  00570000
005800 01  VARIABLES.                                                   00580000
005900     05  SQL-SUB                     PIC S9(4)  VALUE +0          00590000
006000                                                COMP SYNC.        00600000
006100     05  SAVE-ITEM-NMBR             PIC S9(15)  COMP-3.           00610000
006200     05  ABEND-CODE                 PIC S9(4)   VALUE 0           00620000
006300                                                COMP SYNC.        00630000
006400     05  RCDS-WRITTEN               PIC S9(9)   VALUE 0           00640000
006500                                                COMP-3.           00650000
006600     05  DISPLAY-RCDS-WRITTEN       PIC 9(9).                     00660000
006700                                                                  00670000
006800 01  CONSTANTS.                                                   00680000
006900     05  MAX-RETRIES                PIC S9(3)   VALUE +3          00690000
007000                                                COMP-3.           00700000
007100                                                                  00710000
007110*                                                                 00711005
007120* NI SKU WORK FIELDS FOR CHANGING FIELD FORMATS AND LENGTHS       00712005
007130     COPY ISWS006.                                                00713005
007140*                                                                 00714005
007200     COPY MRRD030.                                                00720000
007300                                                                  00730000
007400     EXEC SQL                                                     00740000
007500         INCLUDE TMRITEM                                          00750000
007600     END-EXEC.                                                    00760000
007700                                                                  00770000
007800     EXEC SQL                                                     00780000
007900         INCLUDE TSKST                                            00790000
008000     END-EXEC.                                                    00800000
008100                                                                  00810000
008200     EXEC SQL                                                     00820000
008300         INCLUDE TSK                                              00830007
008400     END-EXEC.                                                    00840000
008500                                                                  00850000
008510     EXEC SQL                                                     00851007
008520         INCLUDE TSKXREF                                          00852007
008530     END-EXEC.                                                    00853007
008540                                                                  00854007
008600     EXEC SQL                                                     00860000
008700         INCLUDE TMRITST                                          00870000
008800     END-EXEC.                                                    00880000
008900                                                                  00890000
009000*   DB2 COMMUNICATION AREA                                        00900000
009100     EXEC SQL                                                     00910000
009200        INCLUDE SQLCA                                             00920000
009300     END-EXEC.                                                    00930000
009400                                                                  00940000
009500*   DB2 COMMUNICATION AREA2                                       00950000
009600     COPY SQLCA2.                                                 00960000
009700                                                                  00970000
009800     EXEC SQL                                                     00980000
009900         DECLARE OUT-OF-INV CURSOR FOR                            00990000
010000         SELECT B.ITEM_NMBR,                                      01000000
010100                B.LOC_NBR                                         01010015
010200         FROM TMRITEM A,                                          01020000
010300              TSKST   B,                                          01030000
010400              TMRITST C                                           01040000
010500         WHERE A.ITEM_NBR  = B.ITEM_NMBR AND                      01050014
010600               B.ITEM_NMBR = C.ITEM_NBR AND                       01060000
010700               B.LOC_NBR   = C.STR_NBR AND                        01070014
010800               ((A.RT_NBR >= 4 AND A.RT_DAY_NBR > 0)              01080000
010900               OR (A.RT_NBR = 4 AND A.RT_DAY_NBR = 0)) AND        01090000
011000               B.LOC_NBR   > 0  AND                               01100014
011100               B.ONHAND_QTY < 1 AND                               01110000
011200               C.FT_CDE    <> 'X'                                 01120014
011300         FOR FETCH ONLY                                           01130000
011400     END-EXEC.                                                    01140000
011500                                                                  01150000
011600 PROCEDURE DIVISION.                                              01160000
011700 M000-MAINLINE.                                                   01170000
011800                                                                  01180000
011900     PERFORM A100-INITIALIZATION.                                 01190000
012000                                                                  01200000
012100     PERFORM B100-COLLECT-OUT-OF-INV-DATA                         01210000
012200        THRU B100-EXIT                                            01220000
012300        UNTIL END-OF-OUT-OF-INV.                                  01230000
012400                                                                  01240000
012500     PERFORM C100-CLOSE-UP.                                       01250000
012600                                                                  01260000
012700 M000-EXIT.                                                       01270000
012800     EXIT.                                                        01280000
012900     STOP RUN.                                                    01290000
013000                                                                  01300000
013100                                                                  01310000
013200 A100-INITIALIZATION.                                             01320000
013300                                                                  01330000
013400     OPEN I-O OUT-OF-INV-FILE.                                    01340000
013500                                                                  01350000
013600     IF SUCCESSFUL                                                01360000
013700         NEXT SENTENCE                                            01370000
013800     ELSE                                                         01380000
013900         OPEN OUTPUT OUT-OF-INV-FILE                              01390000
014000         IF SUCCESSFUL                                            01400000
014100             NEXT SENTENCE                                        01410000
014200         ELSE                                                     01420000
014300             DISPLAY 'OPEN UNSUCCESSFUL FOR VSAM FILE INOUT01'    01430000
014400             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            01440000
014500             DISPLAY 'PROGRAM = MRKUT090'                         01450000
014600             DISPLAY 'PARAGRAPH A100-INITIALIZATION'              01460000
014700             MOVE 4001 TO ABEND-CODE                              01470000
014800             CALL 'ILBOABN0'  USING ABEND-CODE                    01480000
014900         END-IF                                                   01490000
015000     END-IF.                                                      01500000
015100                                                                  01510000
015200     EXEC SQL                                                     01520000
015300         OPEN OUT-OF-INV                                          01530000
015400     END-EXEC.                                                    01540000
015500                                                                  01550000
015600     IF SQLCODE < 0                                               01560000
015700         DISPLAY 'OPEN UNSUCCESSFUL FOR OUT-OF-INV CURSOR'        01570000
015800         PERFORM U998-SQL-ERROR                                   01580000
015900     END-IF.                                                      01590000
016000                                                                  01600000
016100     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01610000
016200           SQLWARN0 = 'W'                                         01620000
016300         DISPLAY 'OPEN WARNING FOR OUT-OF-INV CURSOR'             01630000
016400         PERFORM U999-SQL-WARNING                                 01640000
016500     END-IF.                                                      01650000
016600                                                                  01660000
016700 A100-EXIT.                                                       01670000
016800     EXIT.                                                        01680000
016900                                                                  01690000
017000                                                                  01700000
017100 B100-COLLECT-OUT-OF-INV-DATA.                                    01710000
017200                                                                  01720000
017300     PERFORM B110-FETCH-OUT-OF-INV.                               01730000
017400                                                                  01740000
017500     IF END-OF-OUT-OF-INV                                         01750000
017600         GO TO B100-EXIT                                          01760000
017700     END-IF.                                                      01770000
017800                                                                  01780000
017900     MOVE TSKST-LOC-NBR         TO OUT-OF-INV-STORE-NBR           01790014
018000                                   MR030-STORE-NBR.               01800000
018100     MOVE TSKST-ITEM-NMBR       TO OUT-OF-INV-ITEM-NBR            01810000
018200                                   MR030-ITEM-NBR                 01820000
018300                                   SAVE-ITEM-NMBR.                01830000
018400                                                                  01840000
018500     SET DESC-FOUND TO TRUE.                                      01850000
018600                                                                  01860000
018700     PERFORM B120-SELECT-TSK.                                     01870000
018800                                                                  01880000
018900     IF DESC-NOT-FOUND                                            01890000
019000         GO TO B100-EXIT                                          01900000
019100     END-IF.                                                      01910000
019200                                                                  01920000
019210     MOVE SKXREF-DEPT           TO NI-DEPT-9-3.                   01921005
019300     MOVE NI-DEPT-X-3           TO OUT-OF-INV-DEPT-NBR            01930005
019400                                   MR030-DEPT-NBR.                01940000
019410                                                                  01941005
019420     MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2.              01942005
019500     MOVE NI-SUB-CLASS-X-2      TO OUT-OF-INV-CLASS-NBR           01950005
019600                                   MR030-CLASS-NBR.               01960000
019610                                                                  01961005
019700     MOVE TSK-LONG-VENDOR-STYLE TO OUT-OF-INV-VENDOR-STYLE        01970000
019800                                   MR030-VENDOR-STYLE.            01980000
019900     MOVE TSK-LONG-COLOR-DESC   TO OUT-OF-INV-COLOR-DESC          01990000
020000                                   MR030-COLOR-DESC.              02000000
020100                                                                  02010000
020200     PERFORM B130-WRITE-OUT-OF-INV-RCD.                           02020000
020300                                                                  02030000
020400 B100-EXIT.                                                       02040000
020500     EXIT.                                                        02050000
020600                                                                  02060000
020700                                                                  02070000
020800 B110-FETCH-OUT-OF-INV.                                           02080000
020900                                                                  02090000
021000     PERFORM                                                      02100000
021100         WITH TEST AFTER                                          02110000
021200         VARYING SQL-SUB                                          02120000
021300         FROM 1 BY 1                                              02130000
021400         UNTIL SQL-SUB > MAX-RETRIES                              02140000
021500            OR SQLCODE = ZERO                                     02150000
021600            OR SQLCODE = +100                                     02160000
021700         EXEC SQL                                                 02170000
021800             FETCH OUT-OF-INV                                     02180000
021900                 INTO :TSKST-ITEM-NMBR,                           02190000
022000                      :TSKST-LOC-NBR                              02200014
022100         END-EXEC                                                 02210000
022200         EVALUATE TRUE                                            02220000
022300             WHEN SQLCODE = ZERO                                  02230000
022400             WHEN SQLCODE = -904                                  02240000
022500             WHEN SQLCODE = -913                                  02250000
022600                 CONTINUE                                         02260000
022700             WHEN SQLCODE = +100                                  02270000
022800                 SET END-OF-OUT-OF-INV TO TRUE                    02280000
022900             WHEN SQLWARN0 NOT = SPACES                           02290000
023000             WHEN SQLCODE  NOT = ZERO                             02300000
023100                  PERFORM U998-SQL-ERROR                          02310000
023200         END-EVALUATE                                             02320000
023300     END-PERFORM.                                                 02330000
023400                                                                  02340000
023500 B110-EXIT.                                                       02350000
023600     EXIT.                                                        02360000
023700                                                                  02370000
023800                                                                  02380000
023900 B120-SELECT-TSK.                                                 02390000
024000                                                                  02400000
024010     MOVE SAVE-ITEM-NMBR        TO TSK-ITEM-NMBR.                 02401005
024020                                                                  02402005
024100     PERFORM                                                      02410000
024200         WITH TEST AFTER                                          02420000
024300         VARYING SQL-SUB                                          02430000
024400         FROM 1 BY 1                                              02440000
024500         UNTIL SQL-SUB > MAX-RETRIES                              02450000
024600            OR SQLCODE = ZERO                                     02460000
024700            OR SQLCODE = +100                                     02470000
024800         EXEC SQL                                                 02480000
024900             SELECT B.DEPT,                                       02490005
025000                    B.SUBCLASS,                                   02500005
025100                    LONG_VENDOR_STYLE,                            02510000
025200                    LONG_COLOR_DESC                               02520000
025300             INTO  :SKXREF-DEPT,                                  02530005
025400                   :SKXREF-SUBCLASS,                              02540006
025500                   :TSK-LONG-VENDOR-STYLE,                        02550000
025600                   :TSK-LONG-COLOR-DESC                           02560000
025700             FROM TSK,                                            02570005
025710                  TSKXREF B                                       02571009
025800             WHERE ITEM_NMBR = :TSK-ITEM-NMBR                     02580005
025810              AND  ITEM_NMBR = B.ITM_NBR                          02581005
025900         END-EXEC                                                 02590000
026000         EVALUATE TRUE                                            02600000
026100             WHEN SQLCODE = ZERO                                  02610000
026200             WHEN SQLCODE = -904                                  02620000
026300             WHEN SQLCODE = -913                                  02630000
026400                 CONTINUE                                         02640000
026500             WHEN SQLCODE = +100                                  02650000
026600                 SET DESC-NOT-FOUND TO TRUE                       02660000
026700             WHEN SQLWARN0 NOT = SPACES                           02670000
026800             WHEN SQLCODE  NOT = ZERO                             02680000
026900                  PERFORM U998-SQL-ERROR                          02690000
027000         END-EVALUATE                                             02700000
027100     END-PERFORM.                                                 02710000
027200                                                                  02720000
027300 B120-EXIT.                                                       02730000
027400     EXIT.                                                        02740000
027500                                                                  02750000
027600                                                                  02760000
027700 B130-WRITE-OUT-OF-INV-RCD.                                       02770000
027800                                                                  02780000
027900     WRITE OUT-OF-INV-RECORD FROM MR030-OUT-OF-INV-RECORD.        02790012
027910**   DISPLAY MR030-OUT-OF-INV-RECORD.                             02791012
028000                                                                  02800012
028100     IF SUCCESSFUL                                                02810012
028200         ADD 1 TO RCDS-WRITTEN                                    02820013
028300     ELSE                                                         02830012
028400         IF DUPLICATE-KEY                                         02840012
028500            CONTINUE                                              02850012
028600         ELSE                                                     02860012
028700             DISPLAY 'WRITE UNSUCCESSFUL FOR VSAM FILE INOUT01'   02870012
028800             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            02880012
028900             DISPLAY 'VSAM KEY = ' OUT-OF-INV-KEY                 02890012
029000             DISPLAY 'PROGRAM = MRKUT090'                         02900012
029100             DISPLAY 'PARAGRAPH B130-WRITE-OUT-OF-INV-RCD'        02910012
029200             MOVE 4001 TO ABEND-CODE                              02920014
029300             CALL 'ILBOABN0'  USING ABEND-CODE                    02930012
029400         END-IF                                                   02940012
029500     END-IF.                                                      02950012
029600                                                                  02960000
029700 B130-EXIT.                                                       02970000
029800     EXIT.                                                        02980000
029900                                                                  02990000
030000                                                                  03000000
030100 C100-CLOSE-UP.                                                   03010000
030200                                                                  03020000
030300     CLOSE OUT-OF-INV-FILE.                                       03030000
030400                                                                  03040000
030500     IF SUCCESSFUL                                                03050000
030600         NEXT SENTENCE                                            03060000
030700     ELSE                                                         03070000
030800         DISPLAY 'CLOSE UNSUCCESSFUL FOR VSAM FILE INOUT01'       03080000
030900         DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS                03090000
031000         DISPLAY 'PROGRAM = MRKUT090'                             03100000
031100         DISPLAY 'PARAGRAPH C100-CLOSE-UP'                        03110000
031200         MOVE 4004 TO ABEND-CODE                                  03120000
031300         CALL 'ILBOABN0'  USING ABEND-CODE                        03130000
031400     END-IF.                                                      03140000
031500                                                                  03150000
031600     MOVE RCDS-WRITTEN TO DISPLAY-RCDS-WRITTEN.                   03160000
031700                                                                  03170000
031800     DISPLAY '*******************************************'.       03180000
031900     DISPLAY '*  TOTAL RCDS WRITTEN:  ' DISPLAY-RCDS-WRITTEN.     03190000
032000     DISPLAY '*******************************************'.       03200000
032100                                                                  03210000
032200     EXEC SQL                                                     03220000
032300         CLOSE OUT-OF-INV                                         03230000
032400     END-EXEC.                                                    03240000
032500                                                                  03250000
032600     IF SQLCODE < 0                                               03260000
032700         DISPLAY 'CLOSE UNSUCCESSFUL FOR OUT-OF-INV CURSOR'       03270000
032800         PERFORM U998-SQL-ERROR                                   03280000
032900     END-IF.                                                      03290000
033000                                                                  03300000
033100     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               03310000
033200           SQLWARN0 = 'W'                                         03320000
033300         DISPLAY 'CLOSE WARNING FOR OUT-OF-INV CURSOR'            03330000
033400         PERFORM U999-SQL-WARNING                                 03340000
033500     END-IF.                                                      03350000
033600                                                                  03360000
033700 C100-EXIT.                                                       03370000
033800     EXIT.                                                        03380000
033900                                                                  03390000
034000                                                                  03400000
034100 U998-SQL-ERROR.                                                  03410000
034200                                                                  03420000
034300     MOVE SQLCODE    TO SQLCODE2.                                 03430000
034400     MOVE SQLERRD(3) TO SQLERRD3.                                 03440000
034500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03450000
034600     DISPLAY '** PROGRAM        ** = MRKUT090'.                   03460000
034700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03470000
034800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03480000
034900     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   03490000
035000     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  03500000
035100                                                                  03510000
035200     MOVE 4013 TO ABEND-CODE.                                     03520000
035300     CALL 'ILBOABN0' USING ABEND-CODE.                            03530000
035400                                                                  03540000
035500 U998-EXIT.                                                       03550000
035600     EXIT.                                                        03560000
035700                                                                  03570000
035800                                                                  03580000
035900 U999-SQL-WARNING.                                                03590000
036000                                                                  03600000
036100     MOVE SQLCODE    TO SQLCODE2.                                 03610000
036200     MOVE SQLERRD(3) TO SQLERRD3.                                 03620000
036300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03630000
036400     DISPLAY '** PROGRAM        ** = MRKUT090'.                   03640000
036500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03650000
036600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03660000
036700     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  03670000
036800     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  03680000
036900     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  03690000
037000     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  03700000
037100     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  03710000
037200     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  03720000
037300     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  03730000
037400     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  03740000
037500                                                                  03750000
037600     MOVE 4013 TO ABEND-CODE.                                     03760000
037700     CALL 'ILBOABN0' USING ABEND-CODE.                            03770000
