000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    TRKCS123.                                         00020001
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  11-19-93.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*---------------------------------------------------------------* 00080001
000900*    TRANID      - Y123                                         * 00090001
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100001
001100*    DESCRIPTION - DISPLAY TRAILER/TRIP HISTORY                 * 00110001
001200*    MAPSET      - TRKM123                                      * 00120001
001300*                                                               * 00130001
001400*    THIS PROGRAM WILL SETUP AND MAINTAIN TRAILERS AND/OR TRIPS.* 00140001
001500*                                                               * 00150001
001600*---------------------------------------------------------------* 00160001
273427* CHANGED 08/15/2022    BY BARB SCHULTZ    WR: CHG0273427         00170004
273427* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00171004
273427* MAKING THE CALL DYNAMIC VS STATIC.                              00172004
273427*-----------------------------------------------------------------00173004
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00173105
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00173205
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00173305
CICS  *-----------------------------------------------------------------00173405
001700                                                                  00174003
001800 ENVIRONMENT DIVISION.                                            00180001
001900 DATA DIVISION.                                                   00190001
002000                                                                  00200001
002100/                                                                 00210001
002200 WORKING-STORAGE SECTION.                                         00220001
002300                                                                  00230001
002400 01  DN-NULL-INDICATORS.                                          00240001
002500     05  DN-VEH-NBR                   PIC S9(4) COMP VALUE +0.    00250001
002600     05  DN-SUBAREA-OF-ID             PIC S9(4) COMP VALUE +0.    00260001
002700     05  DN-CURR-TRIP-ID              PIC S9(4) COMP VALUE +0.    00270001
002800     05  DN-SEAL-COND-CDE             PIC S9(4) COMP VALUE +0.    00280001
002900     05  DN-INSPECT-DTE               PIC S9(4) COMP VALUE +0.    00290001
003000     05  DN-INSPECT-TME               PIC S9(4) COMP VALUE +0.    00300001
003100     05  DN-INSPECTOR-NAME            PIC S9(4) COMP VALUE +0.    00310001
003200                                                                  00320001
003300 01  DK-DB2-KEYS.                                                 00330001
003400     05  DK-OPER-UNT-ID               PIC S9(04) VALUE +0         00340001
003500                                                 COMP.            00350001
003600     05  DK-FCLTY-ID                  PIC S9(04) VALUE +0         00360001
003700                                                 COMP.            00370001
003800     05  DK-PLND-TRIP-SEQ             PIC S9(04) VALUE +0         00380001
003900                                                 COMP.            00390001
004000     05  DK-FCLTY-AREA-ID             PIC  X(06) VALUE SPACES.    00400001
004100     05  DK-SUBAREA-OF-ID             PIC  X(06) VALUE SPACES.    00410001
004200     05  DK-VEH-NBR                   PIC  X(10) VALUE SPACES.    00420001
004300     05  DK-OWNER-SCAC-ID             PIC  X(04) VALUE SPACES.    00430001
004400     05  DK-TRIP-ID                   PIC S9(09) VALUE +0         00440001
004500                                                 COMP.            00450001
004600     05  DK-SHIPT-ID                  PIC S9(09) VALUE +0         00460001
004700                                                 COMP.            00470001
004800     05  DK-FCLTY-LOC-TYP-CDE-1       PIC  X(02) VALUE SPACES.    00480001
004900     05  DK-FCLTY-LOC-TYP-CDE-2       PIC  X(02) VALUE SPACES.    00490001
005000     05  DK-TRIP-STATUS-CDE           PIC  X(02) VALUE SPACES.    00500001
005100     05  DK-SEAL-NBR                  PIC  X(15) VALUE SPACES.    00510001
005200     05  DK-ETA-DTE                   PIC  X(10) VALUE SPACES.    00520001
005300     05  DK-ETA-TIME                  PIC  X(08) VALUE SPACES.    00530001
005400     05  DK-STATUS-CDE                PIC  X(02) VALUE SPACES.    00540001
005500                                                                  00550001
005600 01  PC-PROGRAM-CONSTANTS.                                        00560001
005700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00570001
005800                                                    'TR123A  '.   00580001
005900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00590001
006000                                                    'TRKM123 '.   00600001
006100     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00610001
006200                                                    COMP.         00620001
006300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00630001
006400                                                    'TRKCS123'.   00640001
006500     05  PC-RANDNBR-PGM                 PIC X(08)   VALUE         00650001
006600                                                    'DPKUT001'.   00660001
006900     05  PC-DPKUT500-PGM                PIC X(08)   VALUE         00690001
007000                                                    'DPKUT500'.   00700001
007100     05  PC-INTER-APPL-CODES.                                     00710001
007200         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(01)  VALUE '1'.    00720001
007300         10  PC-INTER-APPL-CRIT-ADD     PIC  X(01)  VALUE '2'.    00730001
007400         10  PC-INTER-APPL-UPDATE       PIC  X(01)  VALUE '3'.    00740001
007500         10  PC-INTER-APPL-DELETE       PIC  X(01)  VALUE '4'.    00750001
007600         10  PC-INTER-APPL-PARKING-LIST PIC  X(01)  VALUE '6'.    00760001
007700         10  PC-INTER-APPL-LIST-ADD     PIC  X(01)  VALUE '7'.    00770001
007800         10  PC-INTER-APPL-LIST-HIST    PIC  X(01)  VALUE '8'.    00780001
007900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00790001
008000                                                    COMP-3.       00800001
008100     05  PC-24                          PIC  9(02)  VALUE 24.     00810001
008200     05  PC-59                          PIC  9(02)  VALUE 59.     00820001
008300                                                                  00830001
008400     05  PC-TSYMSG-NUMBERS.                                       00840001
008500         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 00850001
008600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 00860001
008700         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 00870001
008800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 00880001
008900         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 00890001
009000         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. 00900001
009100         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 00910001
009200         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 00920001
009300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 00930001
009400         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 00940001
009500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 00950001
009600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 00960001
009700         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. 00970001
009800         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 00980001
009900         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 00990001
010000         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 01000001
010100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 01010001
010200         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. 01020001
010300         10  PC-TSYMSG-00171            PIC  9(05)  VALUE  00171. 01030001
010400         10  PC-TSYMSG-00646            PIC  9(05)  VALUE  00646. 01040001
010500         10  PC-TSYMSG-00647            PIC  9(05)  VALUE  00647. 01050001
010600         10  PC-TSYMSG-00650            PIC  9(05)  VALUE  00650. 01060001
010700         10  PC-TSYMSG-00651            PIC  9(05)  VALUE  00651. 01070001
010800         10  PC-TSYMSG-00657            PIC  9(05)  VALUE  00657. 01080001
010900         10  PC-TSYMSG-00714            PIC  9(05)  VALUE  00714. 01090001
011000         10  PC-TSYMSG-00715            PIC  9(05)  VALUE  00715. 01100001
011100         10  PC-TSYMSG-00741            PIC  9(05)  VALUE  00741. 01110001
011200         10  PC-TSYMSG-00747            PIC  9(05)  VALUE  00747. 01120001
011300                                                                  01130001
011400 01  PS-PROGRAM-SWITCHES.                                         01140001
011500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01150001
011600         88  PS-NO-ERROR                            VALUE 'Y'.    01160001
011700         88  PS-ERROR                               VALUE 'N'.    01170001
011800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180001
011900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190001
012000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200001
012100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01210001
012200         88  PS-DONE                                VALUE 'Y'.    01220001
012300         88  PS-NOT-DONE                            VALUE 'N'.    01230001
012400     05  PS-SEAL-CURSOR-SW              PIC  X(01)  VALUE 'N'.    01240001
012500         88  PS-NO-MORE-SEALS                       VALUE 'Y'.    01250001
012600     05  PS-SHIPMENT-CURSOR-SW          PIC  X(01)  VALUE 'N'.    01260001
012700         88  PS-NO-MORE-SHIPMENTS                   VALUE 'Y'.    01270001
012800     05  PS-TRIP-SW                     PIC  X(01)  VALUE 'N'.    01280001
012900         88  PS-START-OF-TRIPS                      VALUE 'N'.    01290001
013000         88  PS-END-OF-TRIPS                        VALUE 'Y'.    01300001
013100     05  PS-ETA-TIME-SW                 PIC  X(01)  VALUE 'N'.    01310001
013200         88  PS-ETA-TIME-NOT-VALID                  VALUE 'N'.    01320001
013300         88  PS-ETA-TIME-VALID                      VALUE 'Y'.    01330001
013400     05  PS-ETA-DATE-SW                 PIC  X(01)  VALUE 'N'.    01340001
013500         88  PS-ETA-DATE-VALID                      VALUE 'Y'.    01350001
013600         88  PS-ETA-DATE-NOT-VALID                  VALUE 'N'.    01360001
013700                                                                  01370001
013800 01  PV-PROGRAM-VARIABLES.                                        01380001
013900     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01430001
014400                                                    COMP-3.       01440001
014500     05  PV-ABSTIME                     PIC S9(15)  COMP.         01450001
014600     05  PV-CURRENT-TIME                PIC  9(06).               01460001
014700     05  PV-CURRENT-DATE                PIC  9(06).               01470001
014800     05  PV-SAVE-TRIP-ID                PIC S9(09)  VALUE +0      01480001
014900                                                    COMP.         01490001
015000     05  PV-NEXT-TRIP-ID                PIC S9(09)  VALUE +0      01500001
015100                                                    COMP.         01510001
015200     05  PV-CURR-TRIP-ID                PIC S9(09)  VALUE +0      01520001
015300                                                    COMP.         01530001
015400     05  PV-TRIP-PRTY-CDE               PIC X(02).                01540001
015500     05  PV-TRIP-PRTY-CDE-N REDEFINES                             01550001
015600         PV-TRIP-PRTY-CDE               PIC 9(02).                01560001
015700     05  PV-TRIP-STATUS-CDE             PIC  X(02).               01570001
015800     05  PV-SAVE-PLND-TRIP-SEQ          PIC S9(04) VALUE +0       01580001
015900                                                 COMP.            01590001
016000                                                                  01600001
016100*---------------------------------------------------------------* 01610001
016200*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01620001
016300*---------------------------------------------------------------* 01630001
016400                                                                  01640001
016500     COPY TRWS006.                                                01650001
016600                                                                  01660001
016700/                                                                 01670001
016800*---------------------------------------------------------------* 01680001
016900*    MAP LAYOUT                                                 * 01690001
017000*---------------------------------------------------------------* 01700001
017100                                                                  01710001
017200     COPY TRKM123.                                                01720001
017300                                                                  01730001
017400/                                                                 01740001
017500*---------------------------------------------------------------* 01750001
017600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01760001
017700*---------------------------------------------------------------* 01770001
017800                                                                  01780001
017900     COPY DPWS015.                                                01790001
018000                                                                  01800001
018100*---------------------------------------------------------------* 01810001
018200*    FUNCTION KEYS COPYBOOK.                                    * 01820001
018300*---------------------------------------------------------------* 01830001
018400                                                                  01840001
018500     COPY DPWS016.                                                01850001
018600                                                                  01860001
018700*---------------------------------------------------------------* 01870001
018800*    NUMERIC EDIT LAYOUT.                                       * 01880001
018900*---------------------------------------------------------------* 01890001
019000                                                                  01900001
019100     COPY DPWS010I.                                               01910001
019200                                                                  01920001
019300/                                                                 01930001
019400*---------------------------------------------------------------* 01940001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01950005
019600*---------------------------------------------------------------* 01960001
019700                                                                  01970001
019800     COPY DPWS030.                                                01980001
CICS       COPY DPWS930.                                                01990005
020000/                                                                 02000001
020100*---------------------------------------------------------------* 02010001
020200*    STANDARD COMMAREA.                                         * 02020001
020300*---------------------------------------------------------------* 02030001
020400                                                                  02040001
020500     COPY DPWS020.                                                02050001
020600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02060001
020700                                                                  02070001
020800         10  INTER-APPL-COMM-AREA       PIC X(200).               02080001
020900     COPY TRWS005.                                                02090001
021000     COPY TRWS007.                                                02100001
021100     COPY TRWS008.                                                02110001
021200*---------------------------------------------------------------* 02120001
021300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02130001
021400*---------------------------------------------------------------* 02140001
021500         10  ASC-SPECIFIC-COMMAREA.                               02150001
021600             15  ASC-INT-APPL-FORMAT-IND PIC X(01).               02160001
021700             15  ASC-ACTION-SW          PIC X(03).                02170001
021800                 88  ASC-ADD-PENDING    VALUE 'ADD'.              02180001
021900                 88  ASC-DELETE-PENDING VALUE 'DEL'.              02190001
022000                 88  ASC-UPDATE-PENDING VALUE 'UPD'.              02200001
022100             15  ASC-DELETE-SUCCESSFUL-SW  PIC X(01).             02210001
022200                 88  ASC-DELETE-SUCCESSFUL VALUE 'Y'.             02220001
022300             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            02230001
022400                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            02240001
022500                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            02250001
022600             15  ASC-VEHICLE-SETUP-PREV-SW      PIC X(01).        02260001
022700                 88  ASC-VEHICLE-NOT-SETUP-PREV VALUE 'N'.        02270001
022800                 88  ASC-VEHICLE-NULL-TRIP      VALUE 'L'.        02280001
022900                 88  ASC-VEHICLE-SETUP-PREV     VALUE 'Y'.        02290001
023000             15  ASC-NEW-TRIP-PENDING-SW        PIC X(01).        02300001
023100                 88  ASC-NEW-TRIP-PENDING       VALUE 'Y'.        02310001
023200             15  ASC-TRIP-PRTY-CDE              PIC X(02).        02320001
023300             15  ASC-TRIP-PRTY-CDE-N REDEFINES                    02330001
023400                 ASC-TRIP-PRTY-CDE              PIC 9(02).        02340001
023500             15  ASC-VEHICLE-STATUS-SW          PIC X(02).        02350001
023600                 88  ASC-VEHICLE-ARRIVED        VALUE 'AR'.       02360001
023700                 88  ASC-VEHICLE-BEG-UNLD       VALUE 'UG'.       02370001
023800                 88  ASC-VEHICLE-BEG-LOAD       VALUE 'LG'.       02380001
023900                 88  ASC-VEHICLE-DEPARTED       VALUE 'DP'.       02390001
024000                 88  ASC-VEHICLE-ENROUTE        VALUE 'EN'.       02400001
024100                 88  ASC-VEHICLE-LOADED         VALUE 'LD'.       02410001
024200                 88  ASC-VEHICLE-UNLD           VALUE 'UN'.       02420001
024300             15  ASC-FIELDS-CHANGED-SW          PIC X(01).        02430001
024400                 88  ASC-FIELDS-CHANGED         VALUE 'Y'.        02440001
024500             15  ASC-KEY-FIELDS.                                  02450001
024600                 20  ASC-KEY-OWNER-SCAC-ID    PIC X(04).          02460001
024700                 20  ASC-KEY-VEH-NBR          PIC X(10).          02470001
024800                 20  ASC-CURR-OPER-UNT-ID     PIC X(04).          02480001
024900                 20  ASC-CURR-OPER-UNT-ID-N REDEFINES             02490001
025000                     ASC-CURR-OPER-UNT-ID     PIC 9(04).          02500001
025100                 20  ASC-CURR-FCLTY-ID        PIC X(04).          02510001
025200                 20  ASC-CURR-FCLTY-ID-N REDEFINES                02520001
025300                     ASC-CURR-FCLTY-ID        PIC 9(04).          02530001
025400                 20  ASC-KEY-TRIP-ID          PIC S9(09) COMP.    02540001
025500                 20  ASC-KEY-STATUS-CDE       PIC X(02).          02550001
025600             15  ASC-SCREEN-FIELDS.                               02560001
025700                 20  ASC-OWNER-SCAC-ID-DESC PIC X(25).            02570001
025800                 20  ASC-CURR-FAC-AREA-ID   PIC X(06).            02580001
025900                 20  ASC-CURR-FAC-AREA-ID-DESC                    02590001
026000                                            PIC X(30).            02600001
026100                 20  ASC-CURR-FCLTY-NME     PIC X(24).            02610001
026200                 20  ASC-CURR-SUBAREA-OF-ID PIC X(06).            02620001
026300                 20  ASC-CURR-SUBAREA-OF-ID-DESC                  02630001
026400                                            PIC X(30).            02640001
027100                 20  ASC-TRIP-STATUS-CDE    PIC X(02).            02710001
027200                 20  ASC-TRIP-STATUS-DESC   PIC X(25).            02720001
027300                 20  ASC-DEST-OPER-UNT-ID   PIC X(04).            02730001
027400                 20  ASC-DEST-OPER-UNT-ID-N REDEFINES             02740001
027500                     ASC-DEST-OPER-UNT-ID   PIC 9(04).            02750001
027600                 20  ASC-DEST-FCLTY-ID      PIC X(04).            02760001
027700                 20  ASC-DEST-FCLTY-ID-N REDEFINES                02770001
027800                     ASC-DEST-FCLTY-ID      PIC 9(04).            02780001
027900                 20  ASC-DEST-FCLTY-NME     PIC X(25).            02790001
028000                 20  ASC-DEST-FAC-AREA-ID   PIC X(06).            02800001
028100                 20  ASC-DEST-FAC-AREA-ID-DESC                    02810001
028200                                            PIC X(30).            02820001
028300                 20  ASC-DEST-SUBAREA-OF-ID PIC X(06).            02830001
028400                 20  ASC-DEST-SUBAREA-OF-ID-DESC                  02840001
028500                                            PIC X(30).            02850001
028600                 20  ASC-USAGE-CDE          PIC X(03).            02860001
028700                 20  ASC-LENGTH             PIC X(02).            02870001
028800                 20  ASC-MANIFEST-NBR       PIC X(15).            02880001
028900                 20  ASC-STOP-NBR           PIC 9(02).            02890001
029000                 20  ASC-TOTAL-STOPS        PIC 9(02).            02900001
029100                 20  ASC-SEAL-1             PIC X(15).            02910001
029200                 20  ASC-SEAL-2             PIC X(15).            02920001
029300                 20  ASC-ETA-DTE.                                 02930001
029400                     35  ASC-ETA-DTE-CCYY       PIC X(04).        02940001
029500                     35  FILLER                 PIC X(01).        02950001
029600                     35  ASC-ETA-DTE-MM         PIC X(02).        02960001
029700                     35  FILLER                 PIC X(01).        02970001
029800                     35  ASC-ETA-DTE-DD         PIC X(02).        02980001
029900                 20  ASC-ETA-TIME.                                02990001
030000                     35  ASC-ETA-TIME-HH        PIC X(02).        03000001
030100                     35  ASC-ETA-TIME-HH-N REDEFINES              03010001
030200                         ASC-ETA-TIME-HH        PIC 9(02).        03020001
030300                     35  FILLER                 PIC X(01).        03030001
030400                     35  ASC-ETA-TIME-MM        PIC X(02).        03040001
030500                     35  ASC-ETA-TIME-MM-N REDEFINES              03050001
030600                         ASC-ETA-TIME-MM        PIC 9(02).        03060001
030700                     35  FILLER                 PIC X(01).        03070001
030800                     35  ASC-ETA-TIME-SS        PIC X(02).        03080001
030900             15  ASC-SCREEN-FIELDS-OLD.                           03090001
031000                 20  ASC-CURR-FAC-AREA-ID-OLD   PIC X(06).        03100001
031100                 20  ASC-CURR-SUBAREA-OF-ID-OLD PIC X(06).        03110001
031200                 20  ASC-CURR-OPER-UNT-ID-OLD   PIC X(04).        03120001
031300                 20  ASC-CURR-FCLTY-ID-OLD      PIC X(04).        03130001
031400                 20  ASC-TRIP-STATUS-CDE-OLD    PIC X(02).        03140001
031500                 20  ASC-DEST-FAC-AREA-ID-OLD   PIC X(06).        03150001
031600                 20  ASC-DEST-SUBAREA-OF-ID-OLD PIC X(06).        03160001
031700                 20  ASC-DEST-OPER-UNT-ID-OLD   PIC X(04).        03170001
031800                 20  ASC-DEST-FCLTY-ID-OLD      PIC X(04).        03180001
031900                 20  ASC-USAGE-CDE-OLD          PIC X(03).        03190001
032000                 20  ASC-LENGTH-OLD             PIC X(02).        03200001
032100                 20  ASC-MANIFEST-NBR-OLD       PIC X(15).        03210001
032200                 20  ASC-SEAL-1-OLD             PIC X(15).        03220001
032300                 20  ASC-SEAL-2-OLD             PIC X(15).        03230001
032400                 20  ASC-ETA-DTE-OLD.                             03240001
032500                     35  ASC-ETA-DTE-CCYY-OLD   PIC X(04).        03250001
032600                     35  FILLER                 PIC X(01).        03260001
032700                     35  ASC-ETA-DTE-MM-OLD     PIC X(02).        03270001
032800                     35  FILLER                 PIC X(01).        03280001
032900                     35  ASC-ETA-DTE-DD-OLD     PIC X(02).        03290001
033000                 20  ASC-ETA-TIME-OLD           PIC X(08).        03300001
033100                                                                  03310001
033200             15  ASC-PLND-TRIP-SEQ          PIC S9(04) COMP.      03320001
033300             15  ASC-USE-SELECTION-QUEUE-IND                      03330001
033400                                        PIC  X(01).               03340001
033500                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    03350001
033600             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               03360001
033700             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       03370001
033800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03380001
033900                                        PIC S9(09)  COMP-3.       03390001
034000             15  ASC-SEL-SUB            PIC S9(04)  COMP.         03400001
034100             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         03410001
034200                                                                  03420001
034300/                                                                 03430001
034400*---------------------------------------------------------------* 03440001
034500*    ABEND PROCESSING COPYBOOK.                                 * 03450001
034600*---------------------------------------------------------------* 03460001
034700                                                                  03470001
034800     COPY DPWS013.                                                03480001
034900                                                                  03490001
035000/                                                                 03500001
035100*----------------------------------------------------------------*03510001
035200*  WORK AREA PASSED IN CALL TO DPKUT500                          *03520001
035300*----------------------------------------------------------------*03530001
035400     COPY DPWS500.                                                03540001
035500                                                                  03550001
035600/                                                                 03560001
035700*---------------------------------------------------------------* 03570001
035800*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * 03580001
035900*---------------------------------------------------------------* 03590001
036000     EXEC SQL                                                     03600001
036100          INCLUDE TFLTYPE                                         03610001
036200     END-EXEC.                                                    03620001
036300                                                                  03630001
036400/                                                                 03640001
036500*---------------------------------------------------------------* 03650001
036600*    DB2 AREA FOR THE FACILITY LOCATION TABLE                   * 03660001
036700*---------------------------------------------------------------* 03670001
036800     EXEC SQL                                                     03680001
036900          INCLUDE TFLAREA                                         03690001
037000     END-EXEC.                                                    03700001
037100                                                                  03710001
037200/                                                                 03720001
037300*---------------------------------------------------------------* 03730001
037400*    DB2 AREA FOR THE STORE TABLE                               * 03740001
037500*---------------------------------------------------------------* 03750001
037600     EXEC SQL                                                     03760001
037700          INCLUDE TFACLTY                                         03770001
037800     END-EXEC.                                                    03780001
037900                                                                  03790001
038000/                                                                 03800001
038100*---------------------------------------------------------------* 03810001
038200*    DB2 AREA FOR THE TRIP STATUS CODE TABLE                    * 03820001
038300*---------------------------------------------------------------* 03830001
038400     EXEC SQL                                                     03840001
038500          INCLUDE TTRSTYP                                         03850001
038600     END-EXEC.                                                    03860001
038700                                                                  03870001
038800/                                                                 03880001
038900*---------------------------------------------------------------* 03890001
039000*    DB2 AREA FOR THE SHIPMENT TABLE                            * 03900001
039100*---------------------------------------------------------------* 03910001
039200     EXEC SQL                                                     03920001
039300          INCLUDE TSHIPMT                                         03930001
039400     END-EXEC.                                                    03940001
039500                                                                  03950001
039600/                                                                 03960001
039700*---------------------------------------------------------------* 03970001
039800*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 03980001
039900*---------------------------------------------------------------* 03990001
040000     EXEC SQL                                                     04000001
040100          INCLUDE TEXTENT                                         04010001
040200     END-EXEC.                                                    04020001
040300                                                                  04030001
040400/                                                                 04040001
040500*---------------------------------------------------------------* 04050001
040600*    DB2 AREA FOR THE EXTERNAL ENTERPRISE NAME TABLE            * 04060001
040700*---------------------------------------------------------------* 04070001
040800     EXEC SQL                                                     04080001
040900          INCLUDE TENTNME                                         04090001
041000     END-EXEC.                                                    04100001
041100                                                                  04110001
041200/                                                                 04120001
041300*---------------------------------------------------------------* 04130001
041400*    DB2 AREA FOR THE VEHICLE TABLE                             * 04140001
041500*---------------------------------------------------------------* 04150001
041600     EXEC SQL                                                     04160001
041700          INCLUDE TVEHICL                                         04170001
041800     END-EXEC.                                                    04180001
041900                                                                  04190001
042000/                                                                 04200001
042100*---------------------------------------------------------------* 04210001
042200*    DB2 AREA FOR THE VEHICLE TRIP TABLE                        * 04220001
042300*---------------------------------------------------------------* 04230001
042400     EXEC SQL                                                     04240001
042500          INCLUDE TVHTRIP                                         04250001
042600     END-EXEC.                                                    04260001
042700                                                                  04270001
042800/                                                                 04280001
042900*---------------------------------------------------------------* 04290001
043000*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 04300001
043100*---------------------------------------------------------------* 04310001
043200     EXEC SQL                                                     04320001
043300          INCLUDE TTRIPST                                         04330001
043400     END-EXEC.                                                    04340001
043500                                                                  04350001
043600/                                                                 04360001
043700*---------------------------------------------------------------* 04370001
043800*    DB2 AREA FOR THE SHIPMENT STATUS CODE TABLE                * 04380001
043900*---------------------------------------------------------------* 04390001
044000     EXEC SQL                                                     04400001
044100          INCLUDE TSHSTYP                                         04410001
044200     END-EXEC.                                                    04420001
044300                                                                  04430001
044400/                                                                 04440001
044500*---------------------------------------------------------------* 04450001
044600*    DB2 AREA FOR THE VEICLE SEAL TABLE                         * 04460001
044700*---------------------------------------------------------------* 04470001
044800     EXEC SQL                                                     04480001
044900          INCLUDE TVHSEAL                                         04490001
045000     END-EXEC.                                                    04500001
045100                                                                  04510001
045200/                                                                 04520001
046100*---------------------------------------------------------------* 04610001
046200*    DB2 AREA FOR THE SHIPMENT STATUS TABLE                     * 04620001
046300*---------------------------------------------------------------* 04630001
046400     EXEC SQL                                                     04640001
046500          INCLUDE TSHIPST                                         04650001
046600     END-EXEC.                                                    04660001
046700                                                                  04670001
046800/                                                                 04680001
046900*---------------------------------------------------------------* 04690001
047000*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 04700001
047100*---------------------------------------------------------------* 04710001
047200     EXEC SQL                                                     04720001
047300          INCLUDE TAUVHCL                                         04730001
047400     END-EXEC.                                                    04740001
047500                                                                  04750001
047600/                                                                 04760001
047700*---------------------------------------------------------------* 04770001
047800*    DB2 AREA FOR TRIP AUDIT TABLE                              * 04780001
047900*---------------------------------------------------------------* 04790001
048000     EXEC SQL                                                     04800001
048100          INCLUDE TAUTRIP                                         04810001
048200     END-EXEC.                                                    04820001
048300                                                                  04830001
048400/                                                                 04840001
048500*---------------------------------------------------------------* 04850001
048600*    DB2 AREA FOR COMMUNICATIONS                                * 04860001
048700*---------------------------------------------------------------* 04870001
048800     EXEC SQL                                                     04880001
048900          INCLUDE SQLCA                                           04890001
049000     END-EXEC.                                                    04900001
049100                                                                  04910001
049200/                                                                 04920001
049300*---------------------------------------------------------------* 04930001
049400*  CURSOR TO LIST SEALS FOR A VEHICLE                           * 04940001
049500*---------------------------------------------------------------* 04950001
049600                                                                  04960001
049700     EXEC SQL                                                     04970001
049800          DECLARE SEAL-CSR CURSOR FOR                             04980001
049900           SELECT SEAL_NBR                                        04990001
050000           FROM   TVHSEAL                                         05000001
050100           WHERE  TRIP_ID = :DK-TRIP-ID                           05010001
050200         ORDER BY SEAL_NBR                                        05020001
050300     END-EXEC.                                                    05030001
050400                                                                  05040001
050500/                                                                 05050001
050600*---------------------------------------------------------------* 05060001
050700*  CURSOR TO LIST SHIPMENTS FOR A TRIP                          * 05070001
050800*---------------------------------------------------------------* 05080001
050900                                                                  05090001
051000     EXEC SQL                                                     05100001
051100          DECLARE SHIPMENT-CSR CURSOR FOR                         05110001
051200           SELECT SHIPT_ID                                        05120001
051300            FROM  TSHIPMT                                         05130001
051400           WHERE (TRIP_ID = :DK-TRIP-ID                           05140001
051500             AND  TRIP_ID IS NOT NULL)                            05150001
051600         ORDER BY SHIPT_ID                                        05160001
051700     END-EXEC.                                                    05170001
051800                                                                  05180001
051900/                                                                 05190001
052000 LINKAGE SECTION.                                                 05200001
052100                                                                  05210001
052200 01  DFHCOMMAREA.                                                 05220001
052300     05  FILLER                         OCCURS  1 TO 4072 TIMES   05230001
052400                                        DEPENDING ON EIBCALEN.    05240001
052500         10  FILLER                     PIC X.                    05250001
052600                                                                  05260001
052700/                                                                 05270001
052800 PROCEDURE DIVISION.                                              05280001
052900*---------------------------------------------------------------* 05290001
053000*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05300001
053100*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05310001
053200*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05320001
053300*---------------------------------------------------------------* 05330001
053400 0000-MAIN-MODULE.                                                05340001
053500                                                                  05350001
053600     INITIALIZE DP030-CICS-API-FIELDS.                            05360001
053700                                                                  05370001
053800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05380001
053900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05390001
054000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05400001
054100                                                                  05410001
054200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05420001
054300                                                                  05430001
054400     MOVE LENGTH OF TR123AI        TO DP030-MAP-LENGTH (1).       05440001
054500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05450001
054600                                                                  05460001
054700     PERFORM 0001-CALL-CICS-ARCH-API.                             05470001
054800     PERFORM 1000-CONTROL-PROCESSING                              05480001
054900                                                                  05490001
055000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05500001
055100     PERFORM 0001-CALL-CICS-ARCH-API.                             05510001
055200                                                                  05520001
055300*---------------------------------------------------------------* 05530001
055400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05540001
055500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05550001
055600*---------------------------------------------------------------* 05560001
055700 0001-CALL-CICS-ARCH-API.                                         05570001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05580005
055900                                    DFHCOMMAREA                   05590005
056000                                    DP030-CICS-API-FIELDS         05600005
056100                                    DP020-STANDARD-COMMAREA       05610005
056200                                    TR123AI.                      05620005
056300                                                                  05630001
056400     IF  DP030-RC-CALL-SUCCESSFUL                                 05640001
056500         CONTINUE                                                 05650001
056600     ELSE                                                         05660001
056700         SET DP013-NO-ROLLBACK                                    05670001
056800             DP013-XCTL-DISPLAY-RESTART                           05680001
056900             DP013-CICS-ABEND      TO TRUE                        05690001
057000         MOVE '0001-CALL-CICS-ARCH-API'                           05700001
057100                                   TO DP013-PARAGRAPH             05710001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05720005
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05730005
057400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05740001
057500         PERFORM DP013-0000-PROCESS-ABEND                         05750001
057600     END-IF.                                                      05760001
057700                                                                  05770001
057800*----------------------------------------------------------------*05780001
057900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05790001
058000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05800001
058100*----------------------------------------------------------------*05810001
058200                                                                  05820001
058300 1000-CONTROL-PROCESSING.                                         05830001
058400                                                                  05840001
058500     EVALUATE TRUE                                                05850001
058600         WHEN DP020-NEXT-ACT-INITIAL                              05860001
058700              PERFORM 1100-FIND-OBJECT-KEYS                       05870001
058800              IF  PS-ERROR                                        05880001
058900                  CONTINUE                                        05890001
059000              ELSE                                                05900001
059100                  PERFORM 4000-BUILD-INITIAL-PANEL                05910001
059200                  PERFORM 3200-RESET-ATTRIBUTES                   05920001
059300                  PERFORM 3500-SAVE-SCREEN-FIELDS                 05930001
059400                  IF  SQLCODE = +100                              05940001
059500                  AND NOT ASC-ADD-PENDING                         05950001
059600                      SET DP020-NEXT-ACT-APPL-ERROR               05960001
059700                                     TO TRUE                      05970001
059800                      MOVE PC-TSYMSG-00148                        05980001
059900                                     TO DP020-MSG-NUMBER          05990001
060000                      SET DP020-MSG-INFORMATIONAL                 06000001
060100                                     TO TRUE                      06010001
060200                  ELSE                                            06020001
060300                      IF  ASC-DELETE-PENDING                      06030001
060400                          MOVE PC-TSYMSG-00004                    06040001
060500                                     TO DP020-MSG-NUMBER          06050001
060600                          SET DP020-MSG-INFORMATIONAL             06060001
060700                                     TO TRUE                      06070001
060800                      END-IF                                      06080001
060900                  END-IF                                          06090001
061000              END-IF                                              06100001
061100                                                                  06110001
061200         WHEN DP020-NEXT-ACT-READ-MAP                             06120001
061300             PERFORM 2000-PROCESS-PANEL                           06130001
061400                                                                  06140001
061500         WHEN DP020-NEXT-ACT-RETURN                               06150001
061600                                                                  06160001
061700* IF WE ARE RETURNING FROM THE PARKING LIST PROGRAM, WE WANT      06170001
061800* TO TAKE THE YARD AND SPACE RETURNED AND OVERLAY THE SCREEN      06180001
061900* WITH THAT INFO                                                  06190001
062000                                                                  06200001
062100             IF  DP020-INT-APPL-FORMAT-IND =                      06210001
062200                                      PC-INTER-APPL-PARKING-LIST  06220001
062300                 MOVE TR008-YARD    TO ASC-CURR-FAC-AREA-ID       06230001
062400                                       ACAREAO                    06240001
062500                 MOVE TR008-SPACE   TO ASC-CURR-SUBAREA-OF-ID     06250001
062600                                       ACSUBO                     06260001
062700                 MOVE +6            TO ACAREAL                    06270001
062800                                       ACSUBL                     06280001
062900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06290001
063000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06300001
063100             ELSE                                                 06310001
063200                 PERFORM 4000-BUILD-INITIAL-PANEL                 06320001
063300                 PERFORM 3200-RESET-ATTRIBUTES                    06330001
063400                 PERFORM 3500-SAVE-SCREEN-FIELDS                  06340001
063500             END-IF                                               06350001
063600                                                                  06360001
063700         WHEN OTHER                                               06370001
063800             SET DP013-LOGIC-ABEND TO TRUE                        06380001
063900             SET DP013-NO-ROLLBACK TO TRUE                        06390001
064000             MOVE '1000-CONTROL-PROCESSING'                       06400001
064100                                   TO DP013-PARAGRAPH             06410001
064200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   06420001
064300                                   TO DP013-MESSAGE-TEXT(1)       06430001
064400             MOVE DP020-NEXT-APPL-ACTIVITY                        06440001
064500                                   TO DP013-MESSAGE-TEXT(2)       06450001
064600             PERFORM DP013-0000-PROCESS-ABEND                     06460001
064700     END-EVALUATE.                                                06470001
064800                                                                  06480001
064900/                                                                 06490001
065000*----------------------------------------------------------------*06500001
065100*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *06510001
065200*  INTER-APPLICATION FORMAT CODE.                                *06520001
065300*----------------------------------------------------------------*06530001
065400 1100-FIND-OBJECT-KEYS.                                           06540001
065500                                                                  06550001
065600     INITIALIZE ASC-SPECIFIC-COMMAREA.                            06560001
065700                                                                  06570001
065800     MOVE DP020-INT-APPL-FORMAT-IND                               06580001
065900                                 TO ASC-INT-APPL-FORMAT-IND.      06590001
066000                                                                  06600001
066100     EVALUATE DP020-INT-APPL-FORMAT-IND                           06610001
066200                                                                  06620001
066300         WHEN PC-INTER-APPL-LIST-HIST                             06630001
066400             IF  TR007-NUMBER-OF-SELECTED-ITEMS = ZERO            06640001
066500                 MOVE PC-TSYMSG-00057                             06650001
066600                                 TO DP020-MSG-NUMBER              06660001
066700                 SET DP020-MSG-WARNING                            06670001
066800                     DP020-NEXT-ACT-APPL-ERROR                    06680001
066900                                 TO TRUE                          06690001
067000             ELSE                                                 06700001
067100**               SET ASC-UPDATE-PENDING                           06710001
067200**                               TO TRUE                          06720001
067300                 SET ASC-USE-SELECTION-QUEUE                      06730001
067400                                 TO TRUE                          06740001
067500                 MOVE TR007-NUMBER-OF-SELECTED-ITEMS              06750001
067600                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  06760001
067700                 MOVE TR007-NUMBER-OF-TS-ITEMS                    06770001
067800                                 TO ASC-NUMBER-OF-TS-ITEMS        06780001
067900                 MOVE TR007-SEL-QUEUE-NAME                        06790001
068000                                 TO ASC-SEL-QUEUE-NAME            06800001
068100                 PERFORM 1120-PREPARE-LIST-ENTRY                  06810001
068200             END-IF                                               06820001
068300                                                                  06830001
068400         WHEN OTHER                                               06840001
068500             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             06850001
068600             SET DP020-MSG-FATAL                                  06860001
068700                 DP020-NEXT-ACT-APPL-ERROR                        06870001
068800                 PS-ERROR        TO TRUE                          06880001
068900     END-EVALUATE.                                                06890001
069000                                                                  06900001
069100/                                                                 06910001
069200*----------------------------------------------------------------*06920001
069300* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *06930001
069400* STORAGE QUEUE PASSED FROM THE LIST.                            *06940001
069500*----------------------------------------------------------------*06950001
069600 1120-PREPARE-LIST-ENTRY.                                         06960001
069700                                                                  06970001
069800     MOVE TR006-MAX-ITEMS          TO ASC-SEL-SUB.                06980001
069900     MOVE ZERO                     TO ASC-SEL-ITEM.               06990001
070000     PERFORM 2110-GET-NEXT-RECORD.                                07000001
070100                                                                  07010001
070200/                                                                 07020001
070300*----------------------------------------------------------------*07030001
070400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07040001
070500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07050001
070600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07060001
070700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07070001
070800* FUNCTION KEYS CAN GET THIS FAR.                                *07080001
070900*----------------------------------------------------------------*07090001
071000                                                                  07100001
071100 2000-PROCESS-PANEL.                                              07110001
071200                                                                  07120001
071300     EVALUATE TRUE                                                07130001
071400                                                                  07140001
071500         WHEN DP020-SRC-AID = DP016-CLEAR                         07150001
071600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07160001
071700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07170001
071800                                                                  07180001
071900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07190001
072000             SET DP030-DONT-ERASE                                 07200001
072100                 DP030-SEND-DATAONLY (PC-APPL-MAP)                07210001
072200                               TO TRUE                            07220001
072300             PERFORM 4000-BUILD-INITIAL-PANEL                     07230001
072400             PERFORM 3200-RESET-ATTRIBUTES                        07240001
072500             PERFORM 3500-SAVE-SCREEN-FIELDS                      07250001
072600                                                                  07260001
072700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07270001
072800             IF  ASC-USE-SELECTION-QUEUE                          07280001
072900                 PERFORM 2110-GET-NEXT-RECORD                     07290001
073000                 PERFORM 4000-BUILD-INITIAL-PANEL                 07300001
073100                 PERFORM 3200-RESET-ATTRIBUTES                    07310001
073200             ELSE                                                 07320001
073300*                --- BOTTOM OF LIST ---                           07330001
073400                 MOVE PC-TSYMSG-00070                             07340001
073500                                   TO DP020-MSG-NUMBER            07350001
073600                 SET DP020-MSG-INFORMATIONAL                      07360001
073700                                   TO TRUE                        07370001
073800             END-IF                                               07380001
073900                                                                  07390001
074000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07400001
074100             IF  ASC-USE-SELECTION-QUEUE                          07410001
074200                 PERFORM 2120-GET-PREV-RECORD                     07420001
074300                 PERFORM 4000-BUILD-INITIAL-PANEL                 07430001
074400                 PERFORM 3200-RESET-ATTRIBUTES                    07440001
074500             ELSE                                                 07450001
074600*                --- TOP OF LIST ---                              07460001
074700                 MOVE PC-TSYMSG-00069                             07470001
074800                                   TO DP020-MSG-NUMBER            07480001
074900                 SET DP020-MSG-INFORMATIONAL                      07490001
075000                                   TO TRUE                        07500001
075100             END-IF                                               07510001
075200                                                                  07520001
075300         WHEN OTHER                                               07530001
075400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07540001
075500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07550001
075600             IF  PS-NO-ERROR                                      07560001
075700                 SET DP030-CONTINUE-GO                            07570001
075800                                   TO TRUE                        07580001
075900                 PERFORM 2100-CHECK-FUNCTION-KEY                  07590001
076000             ELSE                                                 07600001
076100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07610001
076200                 SET DP030-OVERRIDE-GO                            07620001
076300                                   TO TRUE                        07630001
076400             END-IF                                               07640001
076500     END-EVALUATE.                                                07650001
076600                                                                  07660001
076700/                                                                 07670001
076800*----------------------------------------------------------------*07680001
076900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07690001
077000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07700001
077100* CICS ARCHITECTURE API.                                         *07710001
077200*----------------------------------------------------------------*07720001
077300 2100-CHECK-FUNCTION-KEY.                                         07730001
077400                                                                  07740001
077500     EVALUATE TRUE                                                07750001
077600         WHEN DP020-SRC-AID = DP016-ENTER                         07760001
077700             CONTINUE                                             07770001
077800                                                                  07780001
077900         WHEN OTHER                                               07790001
078000             SET DP013-NO-ROLLBACK                                07800001
078100                 DP013-XCTL-DISPLAY-RESTART                       07810001
078200                 DP013-CICS-ABEND  TO TRUE                        07820001
078300             MOVE '2100-CHECK-FUNCTION-KEY'                       07830001
078400                                   TO DP013-PARAGRAPH             07840001
078500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07850001
078600                                   TO DP013-MESSAGE-TEXT (1)      07860001
078700             PERFORM DP013-0000-PROCESS-ABEND                     07870001
078800     END-EVALUATE.                                                07880001
078900                                                                  07890001
079000/                                                                 07900001
079100 2110-GET-NEXT-RECORD.                                            07910001
079200                                                                  07920001
079300     ADD +1                        TO ASC-SEL-SUB.                07930001
079400     IF  ASC-SEL-SUB > TR006-MAX-ITEMS                            07940001
079500         ADD +1                    TO ASC-SEL-ITEM                07950001
079600         MOVE +1                   TO ASC-SEL-SUB                 07960001
079700     END-IF.                                                      07970001
079800                                                                  07980001
079900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07990001
080000         IF  ASC-DELETE-PENDING                                   08000001
080100             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            08010001
080200             SET DP020-MSG-INFORMATIONAL                          08020001
080300                                   TO TRUE                        08030001
080400             IF  ASC-DELETE-SUCCESSFUL                            08040001
080500                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    08050001
080600             END-IF                                               08060001
080700         END-IF                                                   08070001
080800         PERFORM 9100-READ-SEL-QUEUE                              08080001
080900         IF  TR006-ITEM (ASC-SEL-SUB) > ZERO                      08090001
081000             MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                 08100001
081100                                   TO ASC-CURR-OPER-UNT-ID        08110001
081200             MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                    08120001
081300                                   TO ASC-CURR-FCLTY-ID           08130001
081400             MOVE TR006-OWNER-SCAC-ID (ASC-SEL-SUB)               08140001
081500                                   TO ASC-KEY-OWNER-SCAC-ID       08150001
081600             MOVE TR006-VEH-NBR (ASC-SEL-SUB)                     08160001
081700                                   TO ASC-KEY-VEH-NBR             08170001
081800             MOVE TR006-TRIP-ID (ASC-SEL-SUB)                     08180001
081900                                   TO ASC-KEY-TRIP-ID             08190001
082000             MOVE TR006-STATUS-CDE (ASC-SEL-SUB)                  08200001
082100                                   TO ASC-KEY-STATUS-CDE          08210001
082200             SET TR006-INQ (ASC-SEL-SUB)                          08220001
082300                                   TO TRUE                        08230001
082400             PERFORM 9200-REWRITE-LIST-QUEUE                      08240001
082500         ELSE                                                     08250001
082600             SUBTRACT +1 FROM ASC-SEL-SUB                         08260001
082700*            --- BOTTOM OF LIST ---                               08270001
082800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08280001
082900             SET DP020-MSG-INFORMATIONAL                          08290001
083000                                   TO TRUE                        08300001
083100         END-IF                                                   08310001
083200     ELSE                                                         08320001
083300         SUBTRACT +1 FROM ASC-SEL-ITEM                            08330001
083400         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 08340001
083500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08350001
083600         SET DP020-MSG-INFORMATIONAL                              08360001
083700                                   TO TRUE                        08370001
083800     END-IF.                                                      08380001
083900                                                                  08390001
084000/                                                                 08400001
084100 2120-GET-PREV-RECORD.                                            08410001
084200                                                                  08420001
084300     SUBTRACT +1 FROM ASC-SEL-SUB.                                08430001
084400     IF  ASC-SEL-SUB < +1                                         08440001
084500         SUBTRACT +1 FROM ASC-SEL-ITEM                            08450001
084600         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 08460001
084700     END-IF.                                                      08470001
084800                                                                  08480001
084900     IF  ASC-SEL-ITEM > ZERO                                      08490001
085000         IF  ASC-DELETE-PENDING                                   08500001
085100             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            08510001
085200             SET DP020-MSG-INFORMATIONAL                          08520001
085300                                   TO TRUE                        08530001
085400             IF  ASC-DELETE-SUCCESSFUL                            08540001
085500                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    08550001
085600             END-IF                                               08560001
085700         END-IF                                                   08570001
085800         PERFORM 9100-READ-SEL-QUEUE                              08580001
085900         MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                     08590001
086000                                   TO ASC-CURR-OPER-UNT-ID        08600001
086100         MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                        08610001
086200                                   TO ASC-CURR-FCLTY-ID           08620001
086300         MOVE TR006-OWNER-SCAC-ID (ASC-SEL-SUB)                   08630001
086400                                   TO ASC-KEY-OWNER-SCAC-ID       08640001
086500         MOVE TR006-VEH-NBR (ASC-SEL-SUB)                         08650001
086600                                   TO ASC-KEY-VEH-NBR             08660001
086700         MOVE TR006-TRIP-ID (ASC-SEL-SUB)                         08670001
086800                                   TO ASC-KEY-TRIP-ID             08680001
086900         MOVE TR006-STATUS-CDE (ASC-SEL-SUB)                      08690001
087000                                   TO ASC-KEY-STATUS-CDE          08700001
087100     ELSE                                                         08710001
087200         MOVE +1                   TO ASC-SEL-ITEM                08720001
087300                                      ASC-SEL-SUB                 08730001
087400*        --- TOP OF LIST ---                                      08740001
087500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08750001
087600         SET DP020-MSG-INFORMATIONAL                              08760001
087700                                   TO TRUE                        08770001
087800     END-IF.                                                      08780001
087900                                                                  08790001
088000/                                                                 08800001
088100*----------------------------------------------------------------*08810001
088200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *08820001
088300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *08830001
088400*----------------------------------------------------------------*08840001
088500 2200-MOVE-SCREEN-TO-COMMAREA.                                    08850001
088600                                                                  08860001
088700     IF  ASCACL > ZERO                                            08870001
088800         MOVE ASCACI             TO ASC-KEY-OWNER-SCAC-ID         08880001
088900     ELSE                                                         08890001
089000         IF  ASCACF = DP015-ERASE-EOF                             08900001
089100             MOVE SPACES         TO ASC-KEY-OWNER-SCAC-ID         08910001
089200         END-IF                                                   08920001
089300     END-IF.                                                      08930001
089400                                                                  08940001
089500     IF  ATRLRL > ZERO                                            08950001
089600         MOVE ATRLRI             TO ASC-KEY-VEH-NBR               08960001
089700     ELSE                                                         08970001
089800         IF  ATRLRF = DP015-ERASE-EOF                             08980001
089900             MOVE SPACES         TO ASC-KEY-VEH-NBR               08990001
090000         END-IF                                                   09000001
090100     END-IF.                                                      09010001
090200                                                                  09020001
090300     IF  AUSEL > ZERO                                             09030001
090400         MOVE AUSEI              TO ASC-USAGE-CDE                 09040001
090500     ELSE                                                         09050001
090600         IF  AUSEF = DP015-ERASE-EOF                              09060001
090700             MOVE SPACES         TO ASC-USAGE-CDE                 09070001
090800         END-IF                                                   09080001
090900     END-IF.                                                      09090001
091000                                                                  09100001
091100     IF  ALGTHL > ZERO                                            09110001
091200         MOVE ALGTHI             TO ASC-LENGTH                    09120001
091300     ELSE                                                         09130001
091400         IF  ALGTHF = DP015-ERASE-EOF                             09140001
091500             MOVE SPACES         TO ASC-LENGTH                    09150001
091600         END-IF                                                   09160001
091700     END-IF.                                                      09170001
091800                                                                  09180001
091900     IF  ACOPERL > ZERO                                           09190001
092000         MOVE ACOPERI            TO ASC-CURR-OPER-UNT-ID          09200001
092100     ELSE                                                         09210001
092200         IF  ACOPERF = DP015-ERASE-EOF                            09220001
092300             MOVE SPACES         TO ASC-CURR-OPER-UNT-ID          09230001
092400         END-IF                                                   09240001
092500     END-IF.                                                      09250001
092600                                                                  09260001
092700     IF  ACFIDL > ZERO                                            09270001
092800         MOVE ACFIDI             TO ASC-CURR-FCLTY-ID             09280001
092900     ELSE                                                         09290001
093000         IF  ACFIDF = DP015-ERASE-EOF                             09300001
093100             MOVE SPACES         TO ASC-CURR-FCLTY-ID             09310001
093200         END-IF                                                   09320001
093300     END-IF.                                                      09330001
093400                                                                  09340001
093500     IF  ACAREAL > ZERO                                           09350001
093600         MOVE ACAREAI            TO ASC-CURR-FAC-AREA-ID          09360001
093700         MOVE SPACES             TO ASC-CURR-FAC-AREA-ID-DESC     09370001
093800                                    ACAREADO                      09380001
093900     ELSE                                                         09390001
094000         IF  ACAREAF = DP015-ERASE-EOF                            09400001
094100             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID          09410001
094200                                    ASC-CURR-FAC-AREA-ID-DESC     09420001
094300                                    ACAREADO                      09430001
094400         END-IF                                                   09440001
094500     END-IF.                                                      09450001
094600                                                                  09460001
094700     IF  ACSUBL > ZERO                                            09470001
094800         MOVE ACSUBI             TO ASC-CURR-SUBAREA-OF-ID        09480001
094900         MOVE SPACES             TO ASC-CURR-SUBAREA-OF-ID-DESC   09490001
095000                                    ACSUBDO                       09500001
095100     ELSE                                                         09510001
095200         IF  ACSUBF = DP015-ERASE-EOF                             09520001
095300             MOVE SPACES         TO ASC-CURR-SUBAREA-OF-ID        09530001
095400                                    ASC-CURR-SUBAREA-OF-ID-DESC   09540001
095500                                    ACSUBDO                       09550001
095600         END-IF                                                   09560001
095700     END-IF.                                                      09570001
095800                                                                  09580001
095900     IF  ADOPERL > ZERO                                           09590001
096000         MOVE ADOPERI            TO ASC-DEST-OPER-UNT-ID          09600001
096100     ELSE                                                         09610001
096200         IF  ADOPERF = DP015-ERASE-EOF                            09620001
096300             MOVE SPACES         TO ASC-DEST-OPER-UNT-ID          09630001
096400         END-IF                                                   09640001
096500     END-IF.                                                      09650001
096600                                                                  09660001
096700     IF  ADFIDL > ZERO                                            09670001
096800         MOVE ADFIDI             TO ASC-DEST-FCLTY-ID             09680001
096900         MOVE SPACES             TO ASC-DEST-FCLTY-NME            09690001
097000                                    ADFIDDO                       09700001
097100     ELSE                                                         09710001
097200         IF  ADFIDF = DP015-ERASE-EOF                             09720001
097300             MOVE SPACES         TO ASC-DEST-FCLTY-ID             09730001
097400                                    ASC-DEST-FCLTY-NME            09740001
097500                                    ADFIDDO                       09750001
097600         END-IF                                                   09760001
097700     END-IF.                                                      09770001
097800                                                                  09780001
097900     IF  ADAREAL > ZERO                                           09790001
098000         MOVE ADAREAI            TO ASC-DEST-FAC-AREA-ID          09800001
098100         MOVE SPACES             TO ASC-DEST-FAC-AREA-ID-DESC     09810001
098200                                    ADAREADO                      09820001
098300     ELSE                                                         09830001
098400         IF  ADAREAF = DP015-ERASE-EOF                            09840001
098500             MOVE SPACES         TO ASC-DEST-FAC-AREA-ID          09850001
098600                                    ASC-DEST-FAC-AREA-ID-DESC     09860001
098700                                    ADAREADO                      09870001
098800         END-IF                                                   09880001
098900     END-IF.                                                      09890001
099000                                                                  09900001
099100     IF  ADSUBL > ZERO                                            09910001
099200         MOVE ADSUBI             TO ASC-DEST-SUBAREA-OF-ID        09920001
099300     ELSE                                                         09930001
099400         IF  ADSUBF = DP015-ERASE-EOF                             09940001
099500             MOVE SPACES         TO ASC-DEST-SUBAREA-OF-ID        09950001
099600                                    ASC-DEST-SUBAREA-OF-ID-DESC   09960001
099700                                    ADSUBDO                       09970001
099800         END-IF                                                   09980001
099900     END-IF.                                                      09990001
100000                                                                  10000001
100100     IF  ATRIPSL > ZERO                                           10010001
100200         MOVE ATRIPSI            TO ASC-TRIP-STATUS-CDE           10020001
100300     ELSE                                                         10030001
100400         IF  ATRIPSF = DP015-ERASE-EOF                            10040001
100500             MOVE SPACES         TO ASC-TRIP-STATUS-CDE           10050001
100600                                    ASC-TRIP-STATUS-DESC          10060001
100700                                    ATRIPSDO                      10070001
100800         END-IF                                                   10080001
100900     END-IF.                                                      10090001
101000                                                                  10100001
101100     IF  AMANL > ZERO                                             10110001
101200         MOVE AMANI              TO ASC-MANIFEST-NBR              10120001
101300     ELSE                                                         10130001
101400         IF  AMANF = DP015-ERASE-EOF                              10140001
101500             MOVE SPACES         TO ASC-MANIFEST-NBR              10150001
101600         END-IF                                                   10160001
101700     END-IF.                                                      10170001
101800                                                                  10180001
101900     IF  ASEAL1L > ZERO                                           10190001
102000         MOVE ASEAL1I            TO ASC-SEAL-1                    10200001
102100     ELSE                                                         10210001
102200         IF  ASEAL1F = DP015-ERASE-EOF                            10220001
102300             MOVE SPACES         TO ASC-SEAL-1                    10230001
102400         END-IF                                                   10240001
102500     END-IF.                                                      10250001
102600                                                                  10260001
102700     IF  ASEAL2L > ZERO                                           10270001
102800         MOVE ASEAL2I            TO ASC-SEAL-2                    10280001
102900     ELSE                                                         10290001
103000         IF  ASEAL2F = DP015-ERASE-EOF                            10300001
103100             MOVE SPACES         TO ASC-SEAL-2                    10310001
103200         END-IF                                                   10320001
103300     END-IF.                                                      10330001
103400                                                                  10340001
103500     IF  AETAMML > ZERO                                           10350001
103600         MOVE AETAMMI             TO ASC-ETA-DTE-MM               10360001
103700     ELSE                                                         10370001
103800         IF  AETAMMF = DP015-ERASE-EOF                            10380001
103900             MOVE SPACE           TO ASC-ETA-DTE-MM               10390001
104000         END-IF                                                   10400001
104100     END-IF.                                                      10410001
104200                                                                  10420001
104300     IF  AETADDL > ZERO                                           10430001
104400         MOVE AETADDI             TO ASC-ETA-DTE-DD               10440001
104500     ELSE                                                         10450001
104600         IF  AETADDF = DP015-ERASE-EOF                            10460001
104700             MOVE SPACE           TO ASC-ETA-DTE-DD               10470001
104800         END-IF                                                   10480001
104900     END-IF.                                                      10490001
105000                                                                  10500001
105100     IF  AETAYYL > ZERO                                           10510001
105200         MOVE AETAYYI             TO ASC-ETA-DTE-CCYY             10520001
105300     ELSE                                                         10530001
105400         IF  AETAYYF = DP015-ERASE-EOF                            10540001
105500             MOVE SPACE           TO ASC-ETA-DTE-CCYY             10550001
105600         END-IF                                                   10560001
105700     END-IF.                                                      10570001
105800                                                                  10580001
105900     IF  AETAHHL > ZERO                                           10590001
106000         MOVE AETAHHI             TO ASC-ETA-TIME-HH              10600001
106100     ELSE                                                         10610001
106200         IF  AETAHHF = DP015-ERASE-EOF                            10620001
106300             MOVE SPACE           TO ASC-ETA-TIME-HH              10630001
106400         END-IF                                                   10640001
106500     END-IF.                                                      10650001
106600                                                                  10660001
106700     IF  AETAMNL > ZERO                                           10670001
106800         MOVE AETAMNI             TO ASC-ETA-TIME-MM              10680001
106900     ELSE                                                         10690001
107000         IF  AETAMNF = DP015-ERASE-EOF                            10700001
107100             MOVE SPACE           TO ASC-ETA-TIME-MM              10710001
107200         END-IF                                                   10720001
107300     END-IF.                                                      10730001
107400                                                                  10740001
107500                                                                  10750001
107600/                                                                 10760001
107700*----------------------------------------------------------------*10770001
107800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *10780001
107900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *10790001
108000*----------------------------------------------------------------*10800001
108100 3000-EDIT-DATA-IN-COMMAREA.                                      10810001
108200                                                                  10820001
108300     PERFORM 3200-RESET-ATTRIBUTES.                               10830001
108400                                                                  10840001
108500     IF  ASC-USAGE-CDE = SPACES                                   10850001
108600         SET PS-ERROR              TO TRUE                        10860001
108700         SET DP020-MSG-FATAL       TO TRUE                        10870001
108800         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            10880001
108900         MOVE DP015-UNP-ALP-BRT-OFF                               10890001
109000                                   TO AUSEA                       10900001
109100         MOVE DP015-RED            TO AUSEC                       10910001
109200         MOVE DP015-REVERSE        TO AUSEH                       10920001
109300         MOVE -1                   TO AUSEL                       10930001
109400         SET DP030-SET-CURSOR-APPL-1                              10940001
109500                                   TO TRUE                        10950001
109600     END-IF.                                                      10960001
109700                                                                  10970001
109800     IF  ASC-ADD-PENDING                                          10980001
109900     AND ASC-DEST-OPER-UNT-ID = (SPACES OR ZEROES)                10990001
110000         SET PS-ERROR                                             11000001
110100             DP020-MSG-FATAL     TO TRUE                          11010001
110200         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              11020001
110300         MOVE DP015-UNP-ALP-BRT-OFF                               11030001
110400                                 TO ADOPERA                       11040001
110500         MOVE DP015-RED          TO ADOPERC                       11050001
110600         MOVE DP015-REVERSE      TO ADOPERH                       11060001
110700         MOVE -1                 TO ADOPERL                       11070001
110800         SET DP030-SET-CURSOR-APPL-1                              11080001
110900                                 TO TRUE                          11090001
111000     END-IF.                                                      11100001
111100                                                                  11110001
111200     IF  PS-NO-ERROR                                              11120001
111300     AND ASC-DEST-OPER-UNT-ID > (SPACES OR ZEROES)                11130001
111400         MOVE ASC-DEST-OPER-UNT-ID TO DP010I-UNEDITED-FIELD       11140001
111500         MOVE LENGTH OF ASC-DEST-OPER-UNT-ID                      11150001
111600                                 TO DP010I-MAXIMUM-DIGITS         11160001
111700         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       11170001
111800         SET DP010I-NEGATIVE-NOT-ALLOWED                          11180001
111900                                 TO TRUE                          11190001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11201004
273427              USING DP010I-NUMERIC-EDIT-AREA                      11202004
112100         IF  DP010I-ERROR-DETECTED                                11210001
112200             SET PS-ERROR                                         11220001
112300                 DP020-MSG-FATAL TO TRUE                          11230001
112400             MOVE PC-TSYMSG-00008                                 11240001
112500                                 TO DP020-MSG-NUMBER              11250001
112600             MOVE DP015-UNP-ALP-BRT-OFF                           11260001
112700                                 TO ADOPERA                       11270001
112800             MOVE DP015-RED      TO ADOPERC                       11280001
112900             MOVE DP015-REVERSE  TO ADOPERH                       11290001
113000             MOVE -1             TO ADOPERL                       11300001
113100             SET DP030-SET-CURSOR-APPL-1                          11310001
113200                                 TO TRUE                          11320001
113300         ELSE                                                     11330001
113400             MOVE DP010I-NUMERIC-FIELD                            11340001
113500                                 TO ASC-DEST-OPER-UNT-ID-N        11350001
113600                                    DK-OPER-UNT-ID                11360001
113700             MOVE ASC-DEST-OPER-UNT-ID                            11370001
113800                                 TO ADOPERO                       11380001
113900         END-IF                                                   11390001
114000     END-IF.                                                      11400001
114100                                                                  11410001
114200     IF  PS-NO-ERROR                                              11420001
114300     AND ASC-DEST-OPER-UNT-ID > (SPACES OR ZEROES)                11430001
114400         PERFORM 3010-VALIDATE-OPER-UNT-ID                        11440001
114500         IF  SQLCODE = +100                                       11450001
114600             SET PS-ERROR                                         11460001
114700                 DP020-MSG-FATAL     TO TRUE                      11470001
114800             MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER          11480001
114900             MOVE DP015-UNP-ALP-BRT-OFF                           11490001
115000                                     TO ADOPERA                   11500001
115100             MOVE DP015-RED          TO ADOPERC                   11510001
115200             MOVE DP015-REVERSE      TO ADOPERH                   11520001
115300             MOVE -1                 TO ADOPERL                   11530001
115400             SET DP030-SET-CURSOR-APPL-1                          11540001
115500                                     TO TRUE                      11550001
115600         END-IF                                                   11560001
115700     END-IF.                                                      11570001
115800                                                                  11580001
115900     IF  PS-NO-ERROR                                              11590001
116000         MOVE ASC-DEST-FCLTY-ID  TO DP010I-UNEDITED-FIELD         11600001
116100         MOVE LENGTH OF ASC-DEST-FCLTY-ID                         11610001
116200                                 TO DP010I-MAXIMUM-DIGITS         11620001
116300         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       11630001
116400         SET DP010I-NEGATIVE-NOT-ALLOWED                          11640001
116500                                 TO TRUE                          11650001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11661004
273427              USING DP010I-NUMERIC-EDIT-AREA                      11662004
116700         IF  DP010I-ERROR-DETECTED                                11670001
116800             SET PS-ERROR                                         11680001
116900                 DP020-MSG-FATAL TO TRUE                          11690001
117000             MOVE PC-TSYMSG-00008                                 11700001
117100                                 TO DP020-MSG-NUMBER              11710001
117200             MOVE DP015-UNP-ALP-BRT-OFF                           11720001
117300                                 TO ADFIDA                        11730001
117400             MOVE DP015-RED      TO ADFIDC                        11740001
117500             MOVE DP015-REVERSE  TO ADFIDH                        11750001
117600             MOVE -1             TO ADFIDL                        11760001
117700             SET DP030-SET-CURSOR-APPL-1                          11770001
117800                                 TO TRUE                          11780001
117900         ELSE                                                     11790001
118000             MOVE DP010I-NUMERIC-FIELD                            11800001
118100                                 TO ASC-DEST-FCLTY-ID-N           11810001
118200                                    DK-FCLTY-ID                   11820001
118300             MOVE ASC-DEST-FCLTY-ID                               11830001
118400                                 TO ADFIDO                        11840001
118500             MOVE ASC-DEST-OPER-UNT-ID                            11850001
118600                                 TO DK-OPER-UNT-ID                11860001
118700             PERFORM 3020-VALIDATE-FCLTY-ID                       11870001
118800             IF  SQLCODE = +100                                   11880001
118900                 SET PS-ERROR                                     11890001
119000                     DP020-MSG-FATAL     TO TRUE                  11900001
119100                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      11910001
119200                 MOVE DP015-UNP-ALP-BRT-OFF                       11920001
119300                                         TO ADFIDA                11930001
119400                 MOVE DP015-RED          TO ADFIDC                11940001
119500                 MOVE DP015-REVERSE      TO ADFIDH                11950001
119600                 MOVE -1                 TO ADFIDL                11960001
119700                 SET DP030-SET-CURSOR-APPL-1                      11970001
119800                                         TO TRUE                  11980001
119900             ELSE                                                 11990001
120000                 MOVE FACLTY-FCLTY-NME   TO ASC-DEST-FCLTY-NME    12000001
120100                                            ADFIDDO               12010001
120200             END-IF                                               12020001
120300         END-IF                                                   12030001
120400     END-IF.                                                      12040001
120500                                                                  12050001
120600     IF  ASC-DEST-FAC-AREA-ID > SPACES                            12060001
120700         MOVE ASC-DEST-FAC-AREA-ID                                12070001
120800                                 TO FLAREA-FCLTY-AREA-ID          12080001
120900         PERFORM 4310-GET-AREA-DESC                               12090001
121000         IF SQLCODE = +0                                          12100001
121100             MOVE FLAREA-FCLTY-AREA-DESC                          12110001
121200                                 TO ASC-DEST-FAC-AREA-ID-DESC     12120001
121300                                    ADAREADO                      12130001
121400         ELSE                                                     12140001
121500             MOVE SPACES         TO ASC-DEST-FAC-AREA-ID-DESC     12150001
121600                                    ADAREADO                      12160001
121700         END-IF                                                   12170001
121800     END-IF.                                                      12180001
121900                                                                  12190001
122000     IF  ASC-DEST-FAC-AREA-ID = SPACES OR LOW-VALUES              12200001
122100         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      12210001
122200             MOVE ASC-DEST-OPER-UNT-ID                            12220001
122300                                 TO DK-OPER-UNT-ID                12230001
122400             MOVE ASC-DEST-FCLTY-ID                               12240001
122500                                 TO DK-FCLTY-ID                   12250001
122600             MOVE ASC-DEST-SUBAREA-OF-ID                          12260001
122700                                 TO DK-FCLTY-AREA-ID              12270001
122800             MOVE 'PS'           TO DK-FCLTY-LOC-TYP-CDE-1        12280001
122900             MOVE 'DD'           TO DK-FCLTY-LOC-TYP-CDE-2        12290001
123000             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  12300001
123100             IF  SQLCODE = +100                                   12310001
123200                 SET PS-ERROR                                     12320001
123300                     DP020-MSG-FATAL  TO TRUE                     12330001
123400                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         12340001
123500                 MOVE DP015-UNP-ALP-BRT-OFF                       12350001
123600                                      TO ADSUBA                   12360001
123700                 MOVE DP015-RED       TO ADSUBC                   12370001
123800                 MOVE DP015-REVERSE   TO ADSUBH                   12380001
123900                 MOVE -1              TO ADSUBL                   12390001
124000                 SET DP030-SET-CURSOR-APPL-1                      12400001
124100                                      TO TRUE                     12410001
124200             ELSE                                                 12420001
124300                 IF  DN-SUBAREA-OF-ID = 0                         12430001
124400                     MOVE FLAREA-SUBAREA-OF-ID                    12440001
124500                                      TO FLAREA-FCLTY-AREA-ID     12450001
124600                                         ASC-DEST-FAC-AREA-ID     12460001
124700                                         ADAREAO                  12470001
124800                     PERFORM 4310-GET-AREA-DESC                   12480001
124900                     MOVE FLAREA-FCLTY-AREA-DESC                  12490001
125000                                      TO ASC-DEST-FAC-AREA-ID-DESC12500001
125100                                         ADAREADO                 12510001
125200                     MOVE ASC-DEST-SUBAREA-OF-ID                  12520001
125300                                      TO FLAREA-FCLTY-AREA-ID     12530001
125400                     PERFORM 4310-GET-AREA-DESC                   12540001
125500                     MOVE FLAREA-FCLTY-AREA-DESC                  12550001
125600                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  12560001
125700                                     ADSUBDO                      12570001
125800                 END-IF                                           12580001
125900             END-IF                                               12590001
126000         END-IF                                                   12600001
126100     ELSE                                                         12610001
126200         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      12620001
126300             MOVE ASC-DEST-OPER-UNT-ID                            12630001
126400                                 TO DK-OPER-UNT-ID                12640001
126500             MOVE ASC-DEST-FCLTY-ID                               12650001
126600                                 TO DK-FCLTY-ID                   12660001
126700             MOVE ASC-DEST-FAC-AREA-ID                            12670001
126800                                 TO DK-SUBAREA-OF-ID              12680001
126900             MOVE ASC-DEST-SUBAREA-OF-ID                          12690001
127000                                 TO DK-FCLTY-AREA-ID              12700001
127100             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  12710001
127200             IF  SQLCODE = +100                                   12720001
127300                 SET PS-ERROR                                     12730001
127400                     DP020-MSG-FATAL  TO TRUE                     12740001
127500                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         12750001
127600                 MOVE DP015-UNP-ALP-BRT-OFF                       12760001
127700                                      TO ADSUBA                   12770001
127800                 MOVE DP015-RED       TO ADSUBC                   12780001
127900                 MOVE DP015-REVERSE   TO ADSUBH                   12790001
128000                 MOVE -1              TO ADSUBL                   12800001
128100                 SET DP030-SET-CURSOR-APPL-1                      12810001
128200                                      TO TRUE                     12820001
128300             ELSE                                                 12830001
128400                 MOVE ASC-DEST-SUBAREA-OF-ID                      12840001
128500                                      TO FLAREA-FCLTY-AREA-ID     12850001
128600                 PERFORM 4310-GET-AREA-DESC                       12860001
128700                 MOVE FLAREA-FCLTY-AREA-DESC                      12870001
128800                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  12880001
128900                                     ADSUBDO                      12890001
129000             END-IF                                               12900001
129100         END-IF                                                   12910001
129200     END-IF.                                                      12920001
129300                                                                  12930001
129400     IF  ASC-DEST-FAC-AREA-ID > SPACES                            12940001
129500         IF  ASC-DEST-SUBAREA-OF-ID = SPACES                      12950001
129600             MOVE ASC-DEST-OPER-UNT-ID                            12960001
129700                                 TO DK-OPER-UNT-ID                12970001
129800             MOVE ASC-DEST-FCLTY-ID                               12980001
129900                                 TO DK-FCLTY-ID                   12990001
130000             MOVE ASC-DEST-FAC-AREA-ID                            13000001
130100                                 TO DK-FCLTY-AREA-ID              13010001
130200             MOVE 'DA'           TO DK-FCLTY-LOC-TYP-CDE-1        13020001
130300             MOVE 'YD'           TO DK-FCLTY-LOC-TYP-CDE-2        13030001
130400             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  13040001
130500             IF  SQLCODE = +100                                   13050001
130600                 SET PS-ERROR                                     13060001
130700                     DP020-MSG-FATAL  TO TRUE                     13070001
130800                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         13080001
130900                 MOVE DP015-UNP-ALP-BRT-OFF                       13090001
131000                                      TO ADAREAA                  13100001
131100                 MOVE DP015-RED       TO ADAREAC                  13110001
131200                 MOVE DP015-REVERSE   TO ADAREAH                  13120001
131300                 MOVE -1              TO ADAREAL                  13130001
131400                 SET DP030-SET-CURSOR-APPL-1                      13140001
131500                                      TO TRUE                     13150001
131600             END-IF                                               13160001
131700         END-IF                                                   13170001
131800     ELSE                                                         13180001
131900         IF  ASC-DEST-SUBAREA-OF-ID > SPACES                      13190001
132000             MOVE ASC-DEST-OPER-UNT-ID                            13200001
132100                                 TO DK-OPER-UNT-ID                13210001
132200             MOVE ASC-DEST-FCLTY-ID                               13220001
132300                                 TO DK-FCLTY-ID                   13230001
132400             MOVE ASC-DEST-FAC-AREA-ID                            13240001
132500                                 TO DK-SUBAREA-OF-ID              13250001
132600             MOVE ASC-DEST-SUBAREA-OF-ID                          13260001
132700                                 TO DK-FCLTY-AREA-ID              13270001
132800             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  13280001
132900             IF  SQLCODE = +100                                   13290001
133000                 SET PS-ERROR                                     13300001
133100                     DP020-MSG-FATAL  TO TRUE                     13310001
133200                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         13320001
133300                 MOVE DP015-UNP-ALP-BRT-OFF                       13330001
133400                                      TO ADAREAA                  13340001
133500                 MOVE DP015-RED       TO ADAREAC                  13350001
133600                 MOVE DP015-REVERSE   TO ADAREAH                  13360001
133700                 MOVE -1              TO ADAREAL                  13370001
133800                 SET DP030-SET-CURSOR-APPL-1                      13380001
133900                                      TO TRUE                     13390001
134000             ELSE                                                 13400001
134100                 MOVE ASC-DEST-SUBAREA-OF-ID                      13410001
134200                                      TO FLAREA-FCLTY-AREA-ID     13420001
134300                 PERFORM 4310-GET-AREA-DESC                       13430001
134400                 MOVE FLAREA-FCLTY-AREA-DESC                      13440001
134500                                  TO ASC-DEST-SUBAREA-OF-ID-DESC  13450001
134600                                     ADSUBDO                      13460001
134700             END-IF                                               13470001
134800         END-IF                                                   13480001
134900     END-IF.                                                      13490001
135000                                                                  13500001
135100     IF  ASC-DEST-FAC-AREA-ID   = ASC-DEST-FAC-AREA-ID-OLD        13510001
135200     AND ASC-DEST-SUBAREA-OF-ID = ASC-DEST-SUBAREA-OF-ID-OLD      13520001
135300         CONTINUE                                                 13530001
135400     ELSE                                                         13540001
135500         MOVE ASC-DEST-OPER-UNT-ID                                13550001
135600                                 TO DK-OPER-UNT-ID                13560001
135700         MOVE ASC-DEST-FCLTY-ID  TO DK-FCLTY-ID                   13570001
135800         MOVE ASC-DEST-FAC-AREA-ID                                13580001
135900                                 TO DK-SUBAREA-OF-ID              13590001
136000         MOVE ASC-DEST-SUBAREA-OF-ID                              13600001
136100                                 TO DK-FCLTY-AREA-ID              13610001
136200         INITIALIZE PV-DB2-COUNT                                  13620001
136300         PERFORM 3050-CHECK-IF-AREA-OPEN                          13630001
136400         IF  PV-DB2-COUNT > +0                                    13640001
136500             SET PS-ERROR                                         13650001
136600                 DP020-MSG-FATAL  TO TRUE                         13660001
136700             MOVE PC-TSYMSG-00714 TO DP020-MSG-NUMBER             13670001
136800             MOVE DP015-UNP-ALP-BRT-OFF                           13680001
136900                                  TO ADAREAA                      13690001
137000                                     ADSUBA                       13700001
137100             MOVE DP015-RED       TO ADAREAC                      13710001
137200                                     ADSUBC                       13720001
137300             MOVE DP015-REVERSE   TO ADAREAH                      13730001
137400                                     ADSUBH                       13740001
137500             MOVE -1              TO ADAREAL                      13750001
137600             SET DP030-SET-CURSOR-APPL-1                          13760001
137700                                  TO TRUE                         13770001
137800         END-IF                                                   13780001
137900     END-IF.                                                      13790001
138000                                                                  13800001
138100     PERFORM 3070-CHECK-STATUS.                                   13810001
138200                                                                  13820001
138300     IF  PS-NO-ERROR                                              13830001
138400         MOVE ASC-CURR-OPER-UNT-ID TO DP010I-UNEDITED-FIELD       13840001
138500         MOVE LENGTH OF ASC-CURR-OPER-UNT-ID                      13850001
138600                                 TO DP010I-MAXIMUM-DIGITS         13860001
138700         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       13870001
138800         SET DP010I-NEGATIVE-NOT-ALLOWED                          13880001
138900                                 TO TRUE                          13890001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13901004
273427              USING DP010I-NUMERIC-EDIT-AREA                      13902004
139100         IF  DP010I-ERROR-DETECTED                                13910001
139200             SET PS-ERROR                                         13920001
139300                 DP020-MSG-FATAL TO TRUE                          13930001
139400             MOVE PC-TSYMSG-00008                                 13940001
139500                                 TO DP020-MSG-NUMBER              13950001
139600             MOVE DP015-UNP-ALP-BRT-OFF                           13960001
139700                                 TO ADOPERA                       13970001
139800             MOVE DP015-RED      TO ADOPERC                       13980001
139900             MOVE DP015-REVERSE  TO ADOPERH                       13990001
140000             MOVE -1             TO ADOPERL                       14000001
140100             SET DP030-SET-CURSOR-APPL-1                          14010001
140200                                 TO TRUE                          14020001
140300         ELSE                                                     14030001
140400             MOVE DP010I-NUMERIC-FIELD                            14040001
140500                                 TO ASC-CURR-OPER-UNT-ID-N        14050001
140600                                    DK-OPER-UNT-ID                14060001
140700             MOVE ASC-CURR-OPER-UNT-ID                            14070001
140800                                 TO ACOPERO                       14080001
140900         END-IF                                                   14090001
141000     END-IF.                                                      14100001
141100                                                                  14110001
141200     IF  PS-NO-ERROR                                              14120001
141300         MOVE ASC-CURR-FCLTY-ID  TO DP010I-UNEDITED-FIELD         14130001
141400         MOVE LENGTH OF ASC-CURR-FCLTY-ID                         14140001
141500                                 TO DP010I-MAXIMUM-DIGITS         14150001
141600         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       14160001
141700         SET DP010I-NEGATIVE-NOT-ALLOWED                          14170001
141800                                 TO TRUE                          14180001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14191004
273427              USING DP010I-NUMERIC-EDIT-AREA                      14192004
142000         IF  DP010I-ERROR-DETECTED                                14200001
142100             SET PS-ERROR                                         14210001
142200                 DP020-MSG-FATAL TO TRUE                          14220001
142300             MOVE PC-TSYMSG-00008                                 14230001
142400                                 TO DP020-MSG-NUMBER              14240001
142500             MOVE DP015-UNP-ALP-BRT-OFF                           14250001
142600                                 TO ACFIDA                        14260001
142700             MOVE DP015-RED      TO ACFIDC                        14270001
142800             MOVE DP015-REVERSE  TO ACFIDH                        14280001
142900             MOVE -1             TO ACFIDL                        14290001
143000             SET DP030-SET-CURSOR-APPL-1                          14300001
143100                                 TO TRUE                          14310001
143200         ELSE                                                     14320001
143300             MOVE DP010I-NUMERIC-FIELD                            14330001
143400                                 TO ASC-CURR-FCLTY-ID-N           14340001
143500                                    DK-FCLTY-ID                   14350001
143600             MOVE ASC-CURR-FCLTY-ID                               14360001
143700                                 TO ACFIDO                        14370001
143800             MOVE ASC-CURR-OPER-UNT-ID                            14380001
143900                                 TO DK-OPER-UNT-ID                14390001
144000             PERFORM 3020-VALIDATE-FCLTY-ID                       14400001
144100             IF  SQLCODE = +100                                   14410001
144200                 SET PS-ERROR                                     14420001
144300                     DP020-MSG-FATAL     TO TRUE                  14430001
144400                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      14440001
144500                 MOVE DP015-UNP-ALP-BRT-OFF                       14450001
144600                                         TO ACFIDA                14460001
144700                 MOVE DP015-RED          TO ACFIDC                14470001
144800                 MOVE DP015-REVERSE      TO ACFIDH                14480001
144900                 MOVE -1                 TO ACFIDL                14490001
145000                 SET DP030-SET-CURSOR-APPL-1                      14500001
145100                                         TO TRUE                  14510001
145200             ELSE                                                 14520001
145300                 MOVE FACLTY-FCLTY-NME   TO ASC-CURR-FCLTY-NME    14530001
145400                                            ACFIDDO               14540001
145500             END-IF                                               14550001
145600         END-IF                                                   14560001
145700     END-IF.                                                      14570001
145800                                                                  14580001
145900     IF  ASC-CURR-FAC-AREA-ID > SPACES                            14590001
146000         MOVE ASC-CURR-FAC-AREA-ID                                14600001
146100                                 TO FLAREA-FCLTY-AREA-ID          14610001
146200         PERFORM 4310-GET-AREA-DESC                               14620001
146300         IF SQLCODE = +0                                          14630001
146400             MOVE FLAREA-FCLTY-AREA-DESC                          14640001
146500                                 TO ASC-CURR-FAC-AREA-ID-DESC     14650001
146600                                    ACAREADO                      14660001
146700         ELSE                                                     14670001
146800             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID-DESC     14680001
146900                                    ACAREADO                      14690001
147000         END-IF                                                   14700001
147100     END-IF.                                                      14710001
147200                                                                  14720001
147300     IF  ASC-CURR-FAC-AREA-ID = SPACES OR LOW-VALUES              14730001
147400         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      14740001
147500             MOVE ASC-CURR-OPER-UNT-ID                            14750001
147600                                 TO DK-OPER-UNT-ID                14760001
147700             MOVE ASC-CURR-FCLTY-ID                               14770001
147800                                 TO DK-FCLTY-ID                   14780001
147900             MOVE ASC-CURR-SUBAREA-OF-ID                          14790001
148000                                 TO DK-FCLTY-AREA-ID              14800001
148100             MOVE 'PS'           TO DK-FCLTY-LOC-TYP-CDE-1        14810001
148200             MOVE 'DD'           TO DK-FCLTY-LOC-TYP-CDE-2        14820001
148300             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  14830001
148400             IF  SQLCODE = +100                                   14840001
148500                 SET PS-ERROR                                     14850001
148600                     DP020-MSG-FATAL  TO TRUE                     14860001
148700                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         14870001
148800                 MOVE DP015-UNP-ALP-BRT-OFF                       14880001
148900                                      TO ACSUBA                   14890001
149000                 MOVE DP015-RED       TO ACSUBC                   14900001
149100                 MOVE DP015-REVERSE   TO ACSUBH                   14910001
149200                 MOVE -1              TO ACSUBL                   14920001
149300                 SET DP030-SET-CURSOR-APPL-1                      14930001
149400                                      TO TRUE                     14940001
149500             ELSE                                                 14950001
149600                 MOVE FLAREA-SUBAREA-OF-ID                        14960001
149700                                      TO FLAREA-FCLTY-AREA-ID     14970001
149800                                         ASC-CURR-FAC-AREA-ID     14980001
149900                                         ACAREAO                  14990001
150000                 PERFORM 4310-GET-AREA-DESC                       15000001
150100                 MOVE FLAREA-FCLTY-AREA-DESC                      15010001
150200                                      TO ASC-CURR-FAC-AREA-ID-DESC15020001
150300                                         ACAREADO                 15030001
150400                 MOVE ASC-CURR-SUBAREA-OF-ID                      15040001
150500                                      TO FLAREA-FCLTY-AREA-ID     15050001
150600                 PERFORM 4310-GET-AREA-DESC                       15060001
150700                 MOVE FLAREA-FCLTY-AREA-DESC                      15070001
150800                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  15080001
150900                                     ACSUBDO                      15090001
151000             END-IF                                               15100001
151100         END-IF                                                   15110001
151200     ELSE                                                         15120001
151300         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      15130001
151400             MOVE ASC-CURR-OPER-UNT-ID                            15140001
151500                                 TO DK-OPER-UNT-ID                15150001
151600             MOVE ASC-CURR-FCLTY-ID                               15160001
151700                                 TO DK-FCLTY-ID                   15170001
151800             MOVE ASC-CURR-FAC-AREA-ID                            15180001
151900                                 TO DK-SUBAREA-OF-ID              15190001
152000             MOVE ASC-CURR-SUBAREA-OF-ID                          15200001
152100                                 TO DK-FCLTY-AREA-ID              15210001
152200             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  15220001
152300             IF  SQLCODE = +100                                   15230001
152400                 SET PS-ERROR                                     15240001
152500                     DP020-MSG-FATAL  TO TRUE                     15250001
152600                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         15260001
152700                 MOVE DP015-UNP-ALP-BRT-OFF                       15270001
152800                                      TO ACSUBA                   15280001
152900                 MOVE DP015-RED       TO ACSUBC                   15290001
153000                 MOVE DP015-REVERSE   TO ACSUBH                   15300001
153100                 MOVE -1              TO ACSUBL                   15310001
153200                 SET DP030-SET-CURSOR-APPL-1                      15320001
153300                                      TO TRUE                     15330001
153400             ELSE                                                 15340001
153500                 MOVE ASC-CURR-SUBAREA-OF-ID                      15350001
153600                                      TO FLAREA-FCLTY-AREA-ID     15360001
153700                 PERFORM 4310-GET-AREA-DESC                       15370001
153800                 MOVE FLAREA-FCLTY-AREA-DESC                      15380001
153900                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  15390001
154000                                     ACSUBDO                      15400001
154100             END-IF                                               15410001
154200         END-IF                                                   15420001
154300     END-IF.                                                      15430001
154400                                                                  15440001
154500     IF  ASC-CURR-FAC-AREA-ID > SPACES                            15450001
154600         IF  ASC-CURR-SUBAREA-OF-ID = SPACES                      15460001
154700             MOVE ASC-CURR-OPER-UNT-ID                            15470001
154800                                 TO DK-OPER-UNT-ID                15480001
154900             MOVE ASC-CURR-FCLTY-ID                               15490001
155000                                 TO DK-FCLTY-ID                   15500001
155100             MOVE ASC-CURR-FAC-AREA-ID                            15510001
155200                                 TO DK-FCLTY-AREA-ID              15520001
155300             MOVE 'DA'           TO DK-FCLTY-LOC-TYP-CDE-1        15530001
155400             MOVE 'YD'           TO DK-FCLTY-LOC-TYP-CDE-2        15540001
155500             PERFORM 3030-VALIDATE-FCLTY-AREA-ID                  15550001
155600             IF  SQLCODE = +100                                   15560001
155700                 SET PS-ERROR                                     15570001
155800                     DP020-MSG-FATAL  TO TRUE                     15580001
155900                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         15590001
156000                 MOVE DP015-UNP-ALP-BRT-OFF                       15600001
156100                                      TO ACAREAA                  15610001
156200                 MOVE DP015-RED       TO ACAREAC                  15620001
156300                 MOVE DP015-REVERSE   TO ACAREAH                  15630001
156400                 MOVE -1              TO ACAREAL                  15640001
156500                 SET DP030-SET-CURSOR-APPL-1                      15650001
156600                                      TO TRUE                     15660001
156700             END-IF                                               15670001
156800         END-IF                                                   15680001
156900     ELSE                                                         15690001
157000         IF  ASC-CURR-SUBAREA-OF-ID > SPACES                      15700001
157100             MOVE ASC-CURR-OPER-UNT-ID                            15710001
157200                                 TO DK-OPER-UNT-ID                15720001
157300             MOVE ASC-CURR-FCLTY-ID                               15730001
157400                                 TO DK-FCLTY-ID                   15740001
157500             MOVE ASC-CURR-FAC-AREA-ID                            15750001
157600                                 TO DK-SUBAREA-OF-ID              15760001
157700             MOVE ASC-CURR-SUBAREA-OF-ID                          15770001
157800                                 TO DK-FCLTY-AREA-ID              15780001
157900             PERFORM 3035-VALIDATE-SUBAREA-OF-ID                  15790001
158000             IF  SQLCODE = +100                                   15800001
158100                 SET PS-ERROR                                     15810001
158200                     DP020-MSG-FATAL  TO TRUE                     15820001
158300                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         15830001
158400                 MOVE DP015-UNP-ALP-BRT-OFF                       15840001
158500                                      TO ACAREAA                  15850001
158600                 MOVE DP015-RED       TO ACAREAC                  15860001
158700                 MOVE DP015-REVERSE   TO ACAREAH                  15870001
158800                 MOVE -1              TO ACAREAL                  15880001
158900                 SET DP030-SET-CURSOR-APPL-1                      15890001
159000                                      TO TRUE                     15900001
159100             ELSE                                                 15910001
159200                 MOVE ASC-CURR-SUBAREA-OF-ID                      15920001
159300                                      TO FLAREA-FCLTY-AREA-ID     15930001
159400                 PERFORM 4310-GET-AREA-DESC                       15940001
159500                 MOVE FLAREA-FCLTY-AREA-DESC                      15950001
159600                                  TO ASC-CURR-SUBAREA-OF-ID-DESC  15960001
159700                                     ACSUBDO                      15970001
159800             END-IF                                               15980001
159900         END-IF                                                   15990001
160000     END-IF.                                                      16000001
160100                                                                  16010001
160200     IF  ASC-CURR-FAC-AREA-ID   = ASC-CURR-FAC-AREA-ID-OLD        16020001
160300     AND ASC-CURR-SUBAREA-OF-ID = ASC-CURR-SUBAREA-OF-ID-OLD      16030001
160400         CONTINUE                                                 16040001
160500     ELSE                                                         16050001
160600         MOVE ASC-CURR-OPER-UNT-ID                                16060001
160700                                 TO DK-OPER-UNT-ID                16070001
160800         MOVE ASC-CURR-FCLTY-ID  TO DK-FCLTY-ID                   16080001
160900         MOVE ASC-CURR-FAC-AREA-ID                                16090001
161000                                 TO DK-SUBAREA-OF-ID              16100001
161100         MOVE ASC-CURR-SUBAREA-OF-ID                              16110001
161200                                 TO DK-FCLTY-AREA-ID              16120001
161300         INITIALIZE PV-DB2-COUNT                                  16130001
161400         PERFORM 3050-CHECK-IF-AREA-OPEN                          16140001
161500         IF  PV-DB2-COUNT > +0                                    16150001
161600             SET PS-ERROR                                         16160001
161700                 DP020-MSG-FATAL  TO TRUE                         16170001
161800             MOVE PC-TSYMSG-00714 TO DP020-MSG-NUMBER             16180001
161900             MOVE DP015-UNP-ALP-BRT-OFF                           16190001
162000                                  TO ACAREAA                      16200001
162100                                     ACSUBA                       16210001
162200             MOVE DP015-RED       TO ACAREAC                      16220001
162300                                     ACSUBC                       16230001
162400             MOVE DP015-REVERSE   TO ACAREAH                      16240001
162500                                     ACSUBH                       16250001
162600             MOVE -1              TO ACAREAL                      16260001
162700             SET DP030-SET-CURSOR-APPL-1                          16270001
162800                                  TO TRUE                         16280001
162900         END-IF                                                   16290001
163000     END-IF.                                                      16300001
163100                                                                  16310001
163200     IF  ASC-ADD-PENDING                                          16320001
163300     AND ASC-KEY-VEH-NBR = SPACES                                 16330001
163400         SET PS-ERROR                                             16340001
163500             DP020-MSG-FATAL     TO TRUE                          16350001
163600         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              16360001
163700         MOVE DP015-UNP-ALP-BRT-OFF                               16370001
163800                                 TO ATRLRA                        16380001
163900         MOVE DP015-RED          TO ATRLRC                        16390001
164000         MOVE DP015-REVERSE      TO ATRLRH                        16400001
164100         MOVE -1                 TO ATRLRL                        16410001
164200         SET DP030-SET-CURSOR-APPL-1                              16420001
164300                                 TO TRUE                          16430001
164400     END-IF.                                                      16440001
164500                                                                  16450001
164600     IF  ASC-ADD-PENDING                                          16460001
164700     AND ASC-KEY-OWNER-SCAC-ID = SPACES                           16470001
164800         SET PS-ERROR                                             16480001
164900             DP020-MSG-FATAL     TO TRUE                          16490001
165000         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              16500001
165100         MOVE DP015-UNP-ALP-BRT-OFF                               16510001
165200                                 TO ASCACA                        16520001
165300         MOVE DP015-RED          TO ASCACC                        16530001
165400         MOVE DP015-REVERSE      TO ASCACH                        16540001
165500         MOVE -1                 TO ASCACL                        16550001
165600         SET DP030-SET-CURSOR-APPL-1                              16560001
165700                                 TO TRUE                          16570001
165800     END-IF.                                                      16580001
165900                                                                  16590001
166000     IF  ASC-KEY-OWNER-SCAC-ID > SPACES                           16600001
166100     AND PS-NO-ERROR                                              16610001
166200         MOVE ASC-KEY-OWNER-SCAC-ID                               16620001
166300                                 TO DK-OWNER-SCAC-ID              16630001
166400         PERFORM 4320-GET-ENT-NAME-DESC                           16640001
166500         IF  SQLCODE = +100                                       16650001
166600             SET PS-ERROR                                         16660001
166700                 DP020-MSG-FATAL     TO TRUE                      16670001
166800             MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER          16680001
166900             MOVE DP015-UNP-ALP-BRT-OFF                           16690001
167000                                     TO ASCACA                    16700001
167100             MOVE DP015-RED          TO ASCACC                    16710001
167200             MOVE DP015-REVERSE      TO ASCACH                    16720001
167300             MOVE -1                 TO ASCACL                    16730001
167400             SET DP030-SET-CURSOR-APPL-1                          16740001
167500                                     TO TRUE                      16750001
167600         ELSE                                                     16760001
167700             MOVE ENTNME-ENT-NAME-DESC                            16770001
167800                                     TO ASC-OWNER-SCAC-ID-DESC    16780001
167900                                        ASCACDO                   16790001
168000         END-IF                                                   16800001
168100     END-IF.                                                      16810001
168200                                                                  16820001
168300     IF  ASC-CURR-OPER-UNT-ID = (SPACES OR ZEROES)                16830001
168400         SET PS-ERROR                                             16840001
168500             DP020-MSG-FATAL     TO TRUE                          16850001
168600         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              16860001
168700         MOVE DP015-UNP-ALP-BRT-OFF                               16870001
168800                                 TO ACOPERA                       16880001
168900         MOVE DP015-RED          TO ACOPERC                       16890001
169000         MOVE DP015-REVERSE      TO ACOPERH                       16900001
169100         MOVE -1                 TO ACOPERL                       16910001
169200         SET DP030-SET-CURSOR-APPL-1                              16920001
169300                                 TO TRUE                          16930001
169400     END-IF.                                                      16940001
169500                                                                  16950001
169600     IF  ASC-CURR-OPER-UNT-ID > (SPACES OR ZEROES)                16960001
169700     AND PS-NO-ERROR                                              16970001
169800         MOVE ASC-CURR-OPER-UNT-ID                                16980001
169900                                 TO DP010I-UNEDITED-FIELD         16990001
170000         MOVE LENGTH OF ASC-CURR-OPER-UNT-ID                      17000001
170100                                 TO DP010I-MAXIMUM-DIGITS         17010001
170200         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       17020001
170300         SET DP010I-NEGATIVE-NOT-ALLOWED                          17030001
170400                                 TO TRUE                          17040001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17051004
273427              USING DP010I-NUMERIC-EDIT-AREA                      17052004
170600         IF  DP010I-ERROR-DETECTED                                17060001
170700             SET PS-ERROR                                         17070001
170800                 DP020-MSG-FATAL TO TRUE                          17080001
170900             MOVE PC-TSYMSG-00008                                 17090001
171000                                 TO DP020-MSG-NUMBER              17100001
171100             MOVE DP015-UNP-ALP-BRT-OFF                           17110001
171200                                 TO ACOPERA                       17120001
171300             MOVE DP015-RED      TO ACOPERC                       17130001
171400             MOVE DP015-REVERSE  TO ACOPERH                       17140001
171500             MOVE -1             TO ACOPERL                       17150001
171600             SET DP030-SET-CURSOR-APPL-1                          17160001
171700                                 TO TRUE                          17170001
171800         ELSE                                                     17180001
171900             MOVE DP010I-NUMERIC-FIELD                            17190001
172000                                 TO ASC-CURR-OPER-UNT-ID-N        17200001
172100                                    DK-OPER-UNT-ID                17210001
172200             MOVE ASC-CURR-OPER-UNT-ID                            17220001
172300                                 TO ACOPERO                       17230001
172400             PERFORM 3010-VALIDATE-OPER-UNT-ID                    17240001
172500             IF  SQLCODE = +100                                   17250001
172600                 SET PS-ERROR                                     17260001
172700                     DP020-MSG-FATAL     TO TRUE                  17270001
172800                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      17280001
172900                 MOVE DP015-UNP-ALP-BRT-OFF                       17290001
173000                                         TO ACOPERA               17300001
173100                 MOVE DP015-RED          TO ACOPERC               17310001
173200                 MOVE DP015-REVERSE      TO ACOPERH               17320001
173300                 MOVE -1                 TO ACOPERL               17330001
173400                 SET DP030-SET-CURSOR-APPL-1                      17340001
173500                                         TO TRUE                  17350001
173600         END-IF                                                   17360001
173700     END-IF.                                                      17370001
173800                                                                  17380001
173900*   SHENG, IS THIS NEEDED?                                        17390001
174000                                                                  17400001
174100     IF  ASC-ADD-PENDING                                          17410001
174200     AND ASC-CURR-OPER-UNT-ID = ASC-CURR-OPER-UNT-ID-OLD          17420001
174300     AND ASC-CURR-FCLTY-ID    = ASC-CURR-FCLTY-ID-OLD             17430001
174400     AND ASC-DEST-OPER-UNT-ID = ASC-DEST-OPER-UNT-ID-OLD          17440001
174500     AND ASC-DEST-FCLTY-ID    = ASC-DEST-FCLTY-ID-OLD             17450001
174600         SET PS-ERROR                                             17460001
174700             DP020-MSG-FATAL     TO TRUE                          17470001
174800         MOVE PC-TSYMSG-00171    TO DP020-MSG-NUMBER              17480001
174900         MOVE DP015-UNP-ALP-BRT-OFF                               17490001
175000                                 TO ACOPERA                       17500001
175100                                    ACFIDA                        17510001
175200                                    ADOPERA                       17520001
175300                                    ADFIDA                        17530001
175400         MOVE DP015-RED          TO ACOPERC                       17540001
175500                                    ACFIDC                        17550001
175600                                    ADOPERC                       17560001
175700                                    ADFIDC                        17570001
175800         MOVE DP015-REVERSE      TO ACOPERH                       17580001
175900                                    ACFIDH                        17590001
176000                                    ADOPERH                       17600001
176100                                    ADFIDH                        17610001
176200         MOVE -1                 TO ACOPERL                       17620001
176300         SET DP030-SET-CURSOR-APPL-1                              17630001
176400                                 TO TRUE                          17640001
176500     ELSE                                                         17650001
176600         SET ASC-NEW-TRIP-PENDING  TO TRUE                        17660001
176700         IF  ASC-MANIFEST-NBR = SPACES                            17670001
176800             SET PS-ERROR                                         17680001
176900                 DP020-MSG-FATAL     TO TRUE                      17690001
177000             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          17700001
177100             MOVE DP015-UNP-ALP-BRT-OFF                           17710001
177200                                     TO AMANA                     17720001
177300             MOVE DP015-RED          TO AMANC                     17730001
177400             MOVE DP015-REVERSE      TO AMANH                     17740001
177500             MOVE -1                 TO AMANL                     17750001
177600             SET DP030-SET-CURSOR-APPL-1                          17760001
177700                                     TO TRUE                      17770001
177800         END-IF                                                   17780001
177900     END-IF.                                                      17790001
178000                                                                  17800001
178100     IF  PS-NO-ERROR                                              17810001
178200         EVALUATE TRUE                                            17820001
178300             WHEN ASC-ADD-PENDING                                 17830001
178400                 MOVE -1           TO ASCACL                      17840001
178500                 SET DP030-SET-CURSOR-APPL-1                      17850001
178600                                   TO TRUE                        17860001
178700             WHEN ASC-UPDATE-PENDING                              17870001
178800             WHEN ASC-NEW-TRIP-PENDING                            17880001
178900                 MOVE -1           TO AUSEL                       17890001
179000                 SET DP030-SET-CURSOR-APPL-1                      17900001
179100                                   TO TRUE                        17910001
179200             WHEN ASC-DELETE-PENDING                              17920001
179300                 SET DP030-SET-CURSOR-TRAILER                     17930001
179400                                   TO TRUE                        17940001
179500         END-EVALUATE                                             17950001
179600     END-IF.                                                      17960001
179700                                                                  17970001
179800*                                                                 17980001
179900     IF  ASC-ETA-DTE-MM > SPACES                                  17990001
180000     OR  ASC-ETA-DTE-DD > SPACES                                  18000001
180100     OR  ASC-ETA-DTE-CCYY > SPACES                                18010001
180200         STRING ASC-ETA-DTE-MM                 DELIMITED BY SIZE  18020001
180300                ASC-ETA-DTE-DD                 DELIMITED BY SIZE  18030001
180400                ASC-ETA-DTE-CCYY(3:2)          DELIMITED BY SIZE  18040001
180500                               INTO DPG52-LK-DATE-INPUT           18050001
180600        INITIALIZE DPG51                                          18060001
180700        SET DPG51-ACTUAL-CALENDAR-ONLY                            18070001
180800            DPG51-DO-NOT-INCR-DECR-DATE                           18080001
180900            DPG52-LK-DTE-GREG    TO TRUE                          18090001
181000        CALL PC-DPKUT500-PGM                                      18100001
181100                        USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56 18110001
181200        IF (DPG54-DATE-INVALID                                    18120001
181300        OR  DPG54-SEVERE-ERROR)                                   18130001
181400            SET PS-ERROR                                          18140001
181500                DP020-MSG-FATAL   TO TRUE                         18150001
181600            MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER             18160001
181700            MOVE DP015-UNP-ALP-BRT-MDT                            18170001
181800                                  TO AETAMMA                      18180001
181900                                     AETADDA                      18190001
182000                                     AETAYYA                      18200001
182100            MOVE DP015-RED        TO AETAMMC                      18210001
182200                                     AETADDC                      18220001
182300                                     AETAYYC                      18230001
182400            MOVE DP015-REVERSE    TO AETAMMH                      18240001
182500                                     AETADDH                      18250001
182600                                     AETAYYH                      18260001
182700            MOVE -1               TO AETAMML                      18270001
182800            SET DP030-SET-CURSOR-APPL-1                           18280001
182900                                  TO TRUE                         18290001
183000        ELSE                                                      18300001
183100            MOVE DPG55-DB2-ISO-DATE-FMT                           18310001
183200                                  TO ASC-ETA-DTE                  18320001
183300            SET PS-ETA-DATE-VALID TO TRUE                         18330001
183400        END-IF                                                    18340001
183500     ELSE                                                         18350001
183600*       MOVE ASC-ETA-DTE-OLD      TO ASC-ETA-DTE                  18360001
183700        IF ASC-ETA-DTE-OLD > SPACES                               18370001
183800*           SET DP020-MSG-INFORMATIONAL                           18380001
183900*                                 TO TRUE                         18390001
184000            MOVE PC-TSYMSG-00715  TO DP020-MSG-NUMBER             18400001
184100            MOVE ASC-ETA-DTE-MM   TO AETAMMO                      18410001
184200            MOVE ASC-ETA-DTE-DD   TO AETADDO                      18420001
184300            MOVE ASC-ETA-DTE-CCYY TO AETAYYO                      18430001
184400        END-IF                                                    18440001
184500     END-IF.                                                      18450001
184600                                                                  18460001
184700                                                                  18470001
184800     IF PS-ETA-DATE-VALID AND                                     18480001
184900        ASC-ETA-TIME-HH = SPACES                                  18490001
185000         SET PS-ERROR              TO TRUE                        18500001
185100         SET DP020-MSG-FATAL       TO TRUE                        18510001
185200         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            18520001
185300         MOVE DP015-UNP-NUM-BRT-OFF                               18530001
185400                                   TO AETAHHA                     18540001
185500         MOVE DP015-RED            TO AETAHHC                     18550001
185600         MOVE DP015-REVERSE        TO AETAHHH                     18560001
185700         MOVE -1                   TO AETAHHL                     18570001
185800         SET DP030-SET-CURSOR-APPL-1                              18580001
185900             PS-ETA-TIME-NOT-VALID TO TRUE.                       18590001
186000                                                                  18600001
186100     IF ASC-ETA-TIME-HH NOT = SPACES                              18610001
186200         MOVE ASC-ETA-TIME-HH      TO DP010I-UNEDITED-FIELD       18620001
186300         MOVE LENGTH OF ASC-ETA-TIME-HH TO DP010I-MAXIMUM-DIGITS  18630001
186400         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     18640001
186500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  18650001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         18661004
273427              USING DP010I-NUMERIC-EDIT-AREA                      18662004
186700         IF  DP010I-ERROR-DETECTED                                18670001
186800             SET PS-ERROR                                         18680001
186900                 DP020-MSG-FATAL   TO TRUE                        18690001
187000             MOVE PC-TSYMSG-00008      TO DP020-MSG-NUMBER        18700001
187100             MOVE DP015-UNP-NUM-BRT-OFF                           18710001
187200                                       TO AETAHHA                 18720001
187300             MOVE DP015-RED            TO AETAHHC                 18730001
187400             MOVE DP015-REVERSE        TO AETAHHH                 18740001
187500             MOVE -1                   TO AETAHHL                 18750001
187600             SET DP030-SET-CURSOR-APPL-1                          18760001
187700                 PS-ETA-TIME-NOT-VALID TO TRUE                    18770001
187800         ELSE                                                     18780001
187900             IF DP010I-NUMERIC-FIELD > PC-24                      18790001
188000                 SET PS-ERROR              TO TRUE                18800001
188100                 SET DP020-MSG-FATAL       TO TRUE                18810001
188200                 MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER    18820001
188300                 MOVE DP015-UNP-NUM-BRT-OFF                       18830001
188400                                           TO AETAHHA             18840001
188500                 MOVE DP015-RED            TO AETAHHC             18850001
188600                 MOVE DP015-REVERSE        TO AETAHHH             18860001
188700                 MOVE -1                   TO AETAHHL             18870001
188800                 SET DP030-SET-CURSOR-APPL-1                      18880001
188900                     PS-ETA-TIME-NOT-VALID TO TRUE                18890001
189000             ELSE                                                 18900001
189100                 SET PS-ETA-TIME-VALID TO TRUE                    18910001
189200                 MOVE DP010I-NUMERIC-FIELD TO ASC-ETA-TIME-HH-N   18920001
189300                 MOVE ASC-ETA-TIME-HH  TO AETAHHO.                18930001
189400                                                                  18940001
189500     IF PS-ETA-DATE-VALID AND                                     18950001
189600        ASC-ETA-TIME-MM = SPACES                                  18960001
189700         IF PS-ETA-TIME-VALID                                     18970001
189800             MOVE '00' TO ASC-ETA-TIME-MM                         18980001
189900                          AETAMNO                                 18990001
190000             SET PS-ETA-TIME-VALID TO TRUE                        19000001
190100         ELSE                                                     19010001
190200             SET PS-ERROR              TO TRUE                    19020001
190300             SET DP020-MSG-FATAL       TO TRUE                    19030001
190400             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        19040001
190500             MOVE DP015-UNP-NUM-BRT-OFF                           19050001
190600                                       TO AETAMNA                 19060001
190700             MOVE DP015-RED            TO AETAMNC                 19070001
190800             MOVE DP015-REVERSE        TO AETAMNH                 19080001
190900             MOVE -1                   TO AETAMNL                 19090001
191000             SET DP030-SET-CURSOR-APPL-1                          19100001
191100                 PS-ETA-TIME-NOT-VALID TO TRUE                    19110001
191200         END-IF                                                   19120001
191300     END-IF.                                                      19130001
191400                                                                  19140001
191500     IF ASC-ETA-TIME-MM NOT = SPACES                              19150001
191600         MOVE ASC-ETA-TIME-MM      TO DP010I-UNEDITED-FIELD       19160001
191700         MOVE LENGTH OF ASC-ETA-TIME-MM TO DP010I-MAXIMUM-DIGITS  19170001
191800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     19180001
191900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  19190001
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19201004
273427              USING DP010I-NUMERIC-EDIT-AREA                      19202004
192100         IF  DP010I-ERROR-DETECTED                                19210001
192200             SET PS-ERROR                                         19220001
192300                 DP020-MSG-FATAL   TO TRUE                        19230001
192400             MOVE PC-TSYMSG-00008      TO DP020-MSG-NUMBER        19240001
192500             MOVE DP015-UNP-NUM-BRT-OFF                           19250001
192600                                       TO AETAMNA                 19260001
192700             MOVE DP015-RED            TO AETAMNC                 19270001
192800             MOVE DP015-REVERSE        TO AETAMNH                 19280001
192900             MOVE -1                   TO AETAMNL                 19290001
193000             SET DP030-SET-CURSOR-APPL-1                          19300001
193100                 PS-ETA-TIME-NOT-VALID TO TRUE                    19310001
193200         ELSE                                                     19320001
193300             IF DP010I-NUMERIC-FIELD > PC-59                      19330001
193400                 SET PS-ERROR              TO TRUE                19340001
193500                 SET DP020-MSG-FATAL       TO TRUE                19350001
193600                 MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER    19360001
193700                 MOVE DP015-UNP-NUM-BRT-OFF                       19370001
193800                                           TO AETAMNA             19380001
193900                 MOVE DP015-RED            TO AETAMNC             19390001
194000                 MOVE DP015-REVERSE        TO AETAMNH             19400001
194100                 MOVE -1                   TO AETAMNL             19410001
194200                 SET DP030-SET-CURSOR-APPL-1                      19420001
194300                     PS-ETA-TIME-NOT-VALID TO TRUE                19430001
194400             ELSE                                                 19440001
194500                 SET PS-ETA-TIME-VALID TO TRUE                    19450001
194600                 MOVE DP010I-NUMERIC-FIELD TO ASC-ETA-TIME-MM-N   19460001
194700                 MOVE ASC-ETA-TIME-MM  TO AETAMNO.                19470001
194800                                                                  19480001
194900     IF  ASC-ETA-DTE-MM = SPACES AND                              19490001
195000         ASC-ETA-DTE-DD = SPACES AND                              19500001
195100         ASC-ETA-DTE-CCYY = SPACES                                19510001
195200         IF PS-ETA-TIME-VALID                                     19520001
195300             SET PS-ERROR              TO TRUE                    19530001
195400             SET DP020-MSG-FATAL       TO TRUE                    19540001
195500             MOVE PC-TSYMSG-00741      TO DP020-MSG-NUMBER        19550001
195600             MOVE DP015-UNP-NUM-BRT-OFF                           19560001
195700                                       TO AETAHHA                 19570001
195800             MOVE DP015-RED            TO AETAHHC                 19580001
195900             MOVE DP015-REVERSE        TO AETAHHH                 19590001
196000             MOVE -1                   TO AETAHHL                 19600001
196100             SET DP030-SET-CURSOR-APPL-1                          19610001
196200                                       TO TRUE                    19620001
196300             MOVE DP015-UNP-NUM-BRT-OFF                           19630001
196400                                       TO AETAMNA                 19640001
196500             MOVE DP015-RED            TO AETAMNC                 19650001
196600             MOVE DP015-REVERSE        TO AETAMNH.                19660001
196700/                                                                 19670001
196800*----------------------------------------------------------------*19680001
196900*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *19690001
197000*  ENTERED ON THE MAP IS VALID.                                  *19700001
197100*----------------------------------------------------------------*19710001
197200                                                                  19720001
197300 3010-VALIDATE-OPER-UNT-ID.                                       19730001
197400                                                                  19740001
197500     PERFORM                                                      19750001
197600         WITH TEST AFTER                                          19760001
197700         VARYING PV-RETRY-COUNTER                                 19770001
197800         FROM 1 BY 1                                              19780001
197900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19790001
198000                   OR (SQLCODE = +0)                              19800001
198100                   OR (SQLCODE = +100)                            19810001
198200                   OR (SQLCODE = -811))                           19820001
198300                                                                  19830001
198400         EXEC SQL                                                 19840001
198500            SELECT  OPER_UNT_ID                                   19850001
198600              INTO :FACLTY-OPER-UNT-ID                            19860001
198700              FROM  TFACLTY                                       19870001
198800             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 19880001
198900         END-EXEC                                                 19890001
199000                                                                  19900001
199100         EVALUATE TRUE                                            19910001
199200             WHEN SQLCODE = +0                                    19920001
199300             WHEN SQLCODE = +100                                  19930001
199400             WHEN SQLCODE = -811                                  19940001
199500             WHEN SQLCODE = -904                                  19950001
199600             WHEN SQLCODE = -913                                  19960001
199700                 CONTINUE                                         19970001
199800                                                                  19980001
199900             WHEN SQLWARN0 NOT = SPACES                           19990001
200000             WHEN SQLCODE < +0                                    20000001
200100             WHEN SQLCODE > +0                                    20010001
200200                 MOVE '3010-VALIDATE-OPER-UNT-ID'                 20020001
200300                                 TO DP013-PARAGRAPH               20030001
200400                 MOVE 'SELECT OPER UNIT'                          20040001
200500                                 TO DP013-MESSAGE-TEXT (1)        20050001
200600                 MOVE SQLCA      TO DP013-SQLCA                   20060001
200700                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      20070001
200800                 SET DP013-DB2-ABEND                              20080001
200900                                 TO TRUE                          20090001
201000                 SET DP013-XCTL-DISPLAY-RESTART                   20100001
201100                                 TO TRUE                          20110001
201200                 PERFORM DP013-0000-PROCESS-ABEND                 20120001
201300         END-EVALUATE                                             20130001
201400     END-PERFORM.                                                 20140001
201500                                                                  20150001
201600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20160001
201700         MOVE '3010-VALIDATE-OPER-UNT-ID'                         20170001
201800                                 TO DP013-PARAGRAPH               20180001
201900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     20190001
202000                                 TO DP013-MESSAGE-TEXT (1)        20200001
202100         MOVE 'OPER UNIT     '   TO DP013-MESSAGE-TEXT (2)        20210001
202200         MOVE SQLCA              TO DP013-SQLCA                   20220001
202300         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      20230001
202400         SET DP013-DB2-ABEND     TO TRUE                          20240001
202500         SET DP013-XCTL-DISPLAY-RESTART                           20250001
202600                                 TO TRUE                          20260001
202700         PERFORM DP013-0000-PROCESS-ABEND                         20270001
202800     END-IF.                                                      20280001
202900                                                                  20290001
203000/                                                                 20300001
203100*----------------------------------------------------------------*20310001
203200*  CHECK THE FACILITY TABLE TO VERIFY THAT THE FACILITY          *20320001
203300*  ENTERED ON THE MAP IS VALID.                                  *20330001
203400*----------------------------------------------------------------*20340001
203500                                                                  20350001
203600 3020-VALIDATE-FCLTY-ID.                                          20360001
203700                                                                  20370001
203800     PERFORM                                                      20380001
203900         WITH TEST AFTER                                          20390001
204000         VARYING PV-RETRY-COUNTER                                 20400001
204100         FROM 1 BY 1                                              20410001
204200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20420001
204300                   OR (SQLCODE = +0)                              20430001
204400                   OR (SQLCODE = +100))                           20440001
204500                                                                  20450001
204600         EXEC SQL                                                 20460001
204700            SELECT  FCLTY_ID                                      20470001
204800                   ,FCLTY_NME                                     20480001
204900              INTO :FACLTY-FCLTY-ID                               20490001
205000                  ,:FACLTY-FCLTY-NME                              20500001
205100              FROM  TFACLTY                                       20510001
205200             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 20520001
205300               AND  FCLTY_ID    = :DK-FCLTY-ID                    20530001
205400         END-EXEC                                                 20540001
205500                                                                  20550001
205600         EVALUATE TRUE                                            20560001
205700             WHEN SQLCODE = +0                                    20570001
205800             WHEN SQLCODE = +100                                  20580001
205900             WHEN SQLCODE = -904                                  20590001
206000             WHEN SQLCODE = -913                                  20600001
206100                 CONTINUE                                         20610001
206200                                                                  20620001
206300             WHEN SQLWARN0 NOT = SPACES                           20630001
206400             WHEN SQLCODE < +0                                    20640001
206500             WHEN SQLCODE > +0                                    20650001
206600                 MOVE '3020-VALIDATE-FCLTY-ID'                    20660001
206700                                 TO DP013-PARAGRAPH               20670001
206800                 MOVE 'SELECT FACILITY ID '                       20680001
206900                                 TO DP013-MESSAGE-TEXT (1)        20690001
207000                 MOVE SQLCA      TO DP013-SQLCA                   20700001
207100                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      20710001
207200                 SET DP013-DB2-ABEND                              20720001
207300                                 TO TRUE                          20730001
207400                 SET DP013-XCTL-DISPLAY-RESTART                   20740001
207500                                 TO TRUE                          20750001
207600                 PERFORM DP013-0000-PROCESS-ABEND                 20760001
207700         END-EVALUATE                                             20770001
207800     END-PERFORM.                                                 20780001
207900                                                                  20790001
208000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20800001
208100         MOVE '3020-VALIDATE-FCLTY-ID'                            20810001
208200                                 TO DP013-PARAGRAPH               20820001
208300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     20830001
208400                                 TO DP013-MESSAGE-TEXT (1)        20840001
208500         MOVE 'FACILITY ID   '   TO DP013-MESSAGE-TEXT (2)        20850001
208600         MOVE SQLCA              TO DP013-SQLCA                   20860001
208700         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      20870001
208800         SET DP013-DB2-ABEND     TO TRUE                          20880001
208900         SET DP013-XCTL-DISPLAY-RESTART                           20890001
209000                                 TO TRUE                          20900001
209100         PERFORM DP013-0000-PROCESS-ABEND                         20910001
209200     END-IF.                                                      20920001
209300                                                                  20930001
209400/                                                                 20940001
209500*----------------------------------------------------------------*20950001
209600*  CHECK THE FACILITY AREA TABLE TO VERIFY THAT THE FACILITY    * 20960001
209700*  AREA ENTERED IS VALID.                                        *20970001
209800*----------------------------------------------------------------*20980001
209900                                                                  20990001
210000 3030-VALIDATE-FCLTY-AREA-ID.                                     21000001
210100                                                                  21010001
210200     PERFORM                                                      21020001
210300         WITH TEST AFTER                                          21030001
210400         VARYING PV-RETRY-COUNTER                                 21040001
210500         FROM 1 BY 1                                              21050001
210600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21060001
210700                   OR (SQLCODE = +0)                              21070001
210800                   OR (SQLCODE = +100))                           21080001
210900                                                                  21090001
211000         EXEC SQL                                                 21100001
211100            SELECT  FCLTY_AREA_ID                                 21110001
211200                 ,  SUBAREA_OF_ID                                 21120001
211300              INTO :FLAREA-FCLTY-AREA-ID                          21130001
211400                 , :FLAREA-SUBAREA-OF-ID                          21140001
211500                     :DN-SUBAREA-OF-ID                            21150001
211600              FROM  TFLAREA                                       21160001
211700             WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID           21170001
211800               AND  FCLTY_ID          = :DK-FCLTY-ID              21180001
211900               AND  FCLTY_AREA_ID     = :DK-FCLTY-AREA-ID         21190001
212000               AND  FCLTY_LOC_TYP_CDE IN                          21200001
212100               (:DK-FCLTY-LOC-TYP-CDE-1,:DK-FCLTY-LOC-TYP-CDE-2)  21210001
212200         END-EXEC                                                 21220001
212300                                                                  21230001
212400         EVALUATE TRUE                                            21240001
212500             WHEN SQLCODE = +0                                    21250001
212600             WHEN SQLCODE = +100                                  21260001
212700             WHEN SQLCODE = -904                                  21270001
212800             WHEN SQLCODE = -913                                  21280001
212900                 CONTINUE                                         21290001
213000                                                                  21300001
213100             WHEN SQLWARN0 NOT = SPACES                           21310001
213200             WHEN SQLCODE < +0                                    21320001
213300             WHEN SQLCODE > +0                                    21330001
213400                 MOVE '3030-VALIDATE-FCLTY-AREA-ID'               21340001
213500                                 TO DP013-PARAGRAPH               21350001
213600                 MOVE 'SELECT FACILITY AREA ID'                   21360001
213700                                 TO DP013-MESSAGE-TEXT (1)        21370001
213800                 MOVE SQLCA      TO DP013-SQLCA                   21380001
213900                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      21390001
214000                 SET DP013-DB2-ABEND                              21400001
214100                                 TO TRUE                          21410001
214200                 SET DP013-XCTL-DISPLAY-RESTART                   21420001
214300                                 TO TRUE                          21430001
214400                 PERFORM DP013-0000-PROCESS-ABEND                 21440001
214500         END-EVALUATE                                             21450001
214600     END-PERFORM.                                                 21460001
214700                                                                  21470001
214800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21480001
214900         MOVE '3030-VALIDATE-FCLTY-AREA-ID'                       21490001
215000                                 TO DP013-PARAGRAPH               21500001
215100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     21510001
215200                                 TO DP013-MESSAGE-TEXT (1)        21520001
215300         MOVE 'FACILITY AREA ID' TO DP013-MESSAGE-TEXT (2)        21530001
215400         MOVE SQLCA              TO DP013-SQLCA                   21540001
215500         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      21550001
215600         SET DP013-DB2-ABEND     TO TRUE                          21560001
215700         SET DP013-XCTL-DISPLAY-RESTART                           21570001
215800                                 TO TRUE                          21580001
215900         PERFORM DP013-0000-PROCESS-ABEND                         21590001
216000     END-IF.                                                      21600001
216100                                                                  21610001
216200/                                                                 21620001
216300*----------------------------------------------------------------*21630001
216400*  CHECK THE FACILITY AREA TABLE TO VERIFY THAT THE FACILITY    * 21640001
216500*  AREA ENTERED IS A VALID SUBAREA ID.                           *21650001
216600*----------------------------------------------------------------*21660001
216700                                                                  21670001
216800 3035-VALIDATE-SUBAREA-OF-ID.                                     21680001
216900                                                                  21690001
217000     PERFORM                                                      21700001
217100         WITH TEST AFTER                                          21710001
217200         VARYING PV-RETRY-COUNTER                                 21720001
217300         FROM 1 BY 1                                              21730001
217400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21740001
217500                   OR (SQLCODE = +0)                              21750001
217600                   OR (SQLCODE = +100))                           21760001
217700                                                                  21770001
217800         EXEC SQL                                                 21780001
217900            SELECT  SUBAREA_OF_ID                                 21790001
218000                 ,  FCLTY_LOC_TYP_CDE                             21800001
218100              INTO :FLAREA-SUBAREA-OF-ID                          21810001
218200                     :DN-SUBAREA-OF-ID                            21820001
218300                 , :FLAREA-FCLTY-LOC-TYP-CDE                      21830001
218400              FROM  TFLAREA                                       21840001
218500             WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID           21850001
218600               AND  FCLTY_ID          = :DK-FCLTY-ID              21860001
218700               AND  FCLTY_AREA_ID     = :DK-FCLTY-AREA-ID         21870001
218800               AND  SUBAREA_OF_ID     = :DK-SUBAREA-OF-ID         21880001
218900         END-EXEC                                                 21890001
219000                                                                  21900001
219100         EVALUATE TRUE                                            21910001
219200             WHEN SQLCODE = +0                                    21920001
219300             WHEN SQLCODE = +100                                  21930001
219400             WHEN SQLCODE = -904                                  21940001
219500             WHEN SQLCODE = -913                                  21950001
219600                 CONTINUE                                         21960001
219700                                                                  21970001
219800             WHEN SQLWARN0 NOT = SPACES                           21980001
219900             WHEN SQLCODE < +0                                    21990001
220000             WHEN SQLCODE > +0                                    22000001
220100                 MOVE '3035-VALIDATE-SUBAREA-OF-ID'               22010001
220200                                 TO DP013-PARAGRAPH               22020001
220300                 MOVE 'SELECT SUBAREA OF ID   '                   22030001
220400                                 TO DP013-MESSAGE-TEXT (1)        22040001
220500                 MOVE SQLCA      TO DP013-SQLCA                   22050001
220600                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      22060001
220700                 SET DP013-DB2-ABEND                              22070001
220800                                 TO TRUE                          22080001
220900                 SET DP013-XCTL-DISPLAY-RESTART                   22090001
221000                                 TO TRUE                          22100001
221100                 PERFORM DP013-0000-PROCESS-ABEND                 22110001
221200         END-EVALUATE                                             22120001
221300     END-PERFORM.                                                 22130001
221400                                                                  22140001
221500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22150001
221600         MOVE '3035-VALIDATE-SUBAREA-OF-ID'                       22160001
221700                                 TO DP013-PARAGRAPH               22170001
221800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     22180001
221900                                 TO DP013-MESSAGE-TEXT (1)        22190001
222000         MOVE 'SUBAREA OF ID   ' TO DP013-MESSAGE-TEXT (2)        22200001
222100         MOVE SQLCA              TO DP013-SQLCA                   22210001
222200         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      22220001
222300         SET DP013-DB2-ABEND     TO TRUE                          22230001
222400         SET DP013-XCTL-DISPLAY-RESTART                           22240001
222500                                 TO TRUE                          22250001
222600         PERFORM DP013-0000-PROCESS-ABEND                         22260001
222700     END-IF.                                                      22270001
222800                                                                  22280001
222900/                                                                 22290001
223000*----------------------------------------------------------------*22300001
223100*  CHECK THE TRIP STATUS CODE TABLE TO VERIFY THE STATUS         *22310001
223200*  ENTERED IS VALID.                                             *22320001
223300*----------------------------------------------------------------*22330001
223400                                                                  22340001
223500 3040-VALIDATE-TRIP-STATUS-CDE.                                   22350001
223600                                                                  22360001
223700     PERFORM                                                      22370001
223800         WITH TEST AFTER                                          22380001
223900         VARYING PV-RETRY-COUNTER                                 22390001
224000         FROM 1 BY 1                                              22400001
224100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22410001
224200                   OR (SQLCODE = +0)                              22420001
224300                   OR (SQLCODE = +100))                           22430001
224400                                                                  22440001
224500         EXEC SQL                                                 22450001
224600            SELECT  TRIP_STATUS_CDE                               22460001
224700                   ,DESC                                          22470001
224800                   ,PRTY_CDE                                      22480001
224900              INTO :TRSTYP-TRIP-STATUS-CDE                        22490001
225000                  ,:TRSTYP-DESC                                   22500001
225100                  ,:TRSTYP-PRTY-CDE                               22510001
225200              FROM  TTRSTYP                                       22520001
225300             WHERE  TRIP_STATUS_CDE = :DK-TRIP-STATUS-CDE         22530001
225400         END-EXEC                                                 22540001
225500                                                                  22550001
225600         EVALUATE TRUE                                            22560001
225700             WHEN SQLCODE = +0                                    22570001
225800             WHEN SQLCODE = +100                                  22580001
225900             WHEN SQLCODE = -904                                  22590001
226000             WHEN SQLCODE = -913                                  22600001
226100                 CONTINUE                                         22610001
226200                                                                  22620001
226300             WHEN SQLWARN0 NOT = SPACES                           22630001
226400             WHEN SQLCODE < +0                                    22640001
226500             WHEN SQLCODE > +0                                    22650001
226600                 MOVE '3040-VALIDATE-TRIP-STATUS-CDE'             22660001
226700                                 TO DP013-PARAGRAPH               22670001
226800                 MOVE 'SELECT TRIP STATUS CODE'                   22680001
226900                                 TO DP013-MESSAGE-TEXT (1)        22690001
227000                 MOVE SQLCA      TO DP013-SQLCA                   22700001
227100                 MOVE 'TTRSTYP'  TO DP013-DB2-TABLE-NAME (1)      22710001
227200                 SET DP013-DB2-ABEND                              22720001
227300                                 TO TRUE                          22730001
227400                 SET DP013-XCTL-DISPLAY-RESTART                   22740001
227500                                 TO TRUE                          22750001
227600                 PERFORM DP013-0000-PROCESS-ABEND                 22760001
227700         END-EVALUATE                                             22770001
227800     END-PERFORM.                                                 22780001
227900                                                                  22790001
228000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22800001
228100         MOVE '3040-VALIDATE-TRIP-STATUS-CDE'                     22810001
228200                                 TO DP013-PARAGRAPH               22820001
228300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     22830001
228400                                 TO DP013-MESSAGE-TEXT (1)        22840001
228500         MOVE 'TRIP STATUS CODE' TO DP013-MESSAGE-TEXT (2)        22850001
228600         MOVE SQLCA              TO DP013-SQLCA                   22860001
228700         MOVE 'TTRSTYP'          TO DP013-DB2-TABLE-NAME (1)      22870001
228800         SET DP013-DB2-ABEND     TO TRUE                          22880001
228900         SET DP013-XCTL-DISPLAY-RESTART                           22890001
229000                                 TO TRUE                          22900001
229100         PERFORM DP013-0000-PROCESS-ABEND                         22910001
229200     END-IF.                                                      22920001
229300                                                                  22930001
229400/                                                                 22940001
229500*----------------------------------------------------------------*22950001
229600*  CHECK TO SEE IF THE AREA AND SUBAREA ENTERED IS OPEN          *22960001
229700*----------------------------------------------------------------*22970001
229800                                                                  22980001
229900 3050-CHECK-IF-AREA-OPEN.                                         22990001
230000                                                                  23000001
230100     PERFORM                                                      23010001
230200         WITH TEST AFTER                                          23020001
230300         VARYING PV-RETRY-COUNTER                                 23030001
230400         FROM 1 BY 1                                              23040001
230500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23050001
230600                   OR (SQLCODE = +0)                              23060001
230700                   OR (SQLCODE = +100))                           23070001
230800                                                                  23080001
230900         EXEC SQL                                                 23090001
231000          SELECT COUNT(*)                                         23100001
231100           INTO :PV-DB2-COUNT                                     23110001
231200           FROM  TFLAREA A                                        23120001
231300          WHERE  A.FCLTY_LOC_TYP_CDE IN ('DD','PS')               23130001
231400            AND  A.OPER_UNT_ID   = :DK-OPER-UNT-ID                23140001
231500            AND  A.FCLTY_ID      = :DK-FCLTY-ID                   23150001
231600            AND  A.SUBAREA_OF_ID = :DK-SUBAREA-OF-ID              23160001
231700            AND  A.FCLTY_AREA_ID IN                               23170001
231800                 (SELECT B.CURR_FAC_AREA_ID                       23180001
231900                  FROM TVEHICL B                                  23190001
232000                  WHERE B.CURR_STATUS_CDE ^= 'DE'                 23200001
232100                    AND A.FCLTY_AREA_ID = :DK-FCLTY-AREA-ID)      23210001
232200         END-EXEC                                                 23220001
232300                                                                  23230001
232400         EVALUATE TRUE                                            23240001
232500             WHEN SQLCODE = +0                                    23250001
232600             WHEN SQLCODE = +100                                  23260001
232700             WHEN SQLCODE = -904                                  23270001
232800             WHEN SQLCODE = -913                                  23280001
232900                 CONTINUE                                         23290001
233000                                                                  23300001
233100             WHEN SQLWARN0 NOT = SPACES                           23310001
233200             WHEN SQLCODE < +0                                    23320001
233300             WHEN SQLCODE > +0                                    23330001
233400                 MOVE '3050-CHECK-IF-AREA-OPEN'                   23340001
233500                                 TO DP013-PARAGRAPH               23350001
233600                 MOVE 'SELECT ON TFLAREA '                        23360001
233700                                 TO DP013-MESSAGE-TEXT (1)        23370001
233800                 MOVE SQLCA      TO DP013-SQLCA                   23380001
233900                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)      23390001
234000                 MOVE 'TVEHICL'  TO DP013-DB2-TABLE-NAME (2)      23400001
234100                 SET DP013-DB2-ABEND                              23410001
234200                                 TO TRUE                          23420001
234300                 SET DP013-XCTL-DISPLAY-RESTART                   23430001
234400                                 TO TRUE                          23440001
234500                 PERFORM DP013-0000-PROCESS-ABEND                 23450001
234600         END-EVALUATE                                             23460001
234700     END-PERFORM.                                                 23470001
234800                                                                  23480001
234900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23490001
235000         MOVE '3050-CHECK-IF-AREA-OPEN'                           23500001
235100                                 TO DP013-PARAGRAPH               23510001
235200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     23520001
235300                                 TO DP013-MESSAGE-TEXT (1)        23530001
235400         MOVE 'TFLAREA         ' TO DP013-MESSAGE-TEXT (2)        23540001
235500         MOVE SQLCA              TO DP013-SQLCA                   23550001
235600         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)      23560001
235700         MOVE 'TVEHICL'          TO DP013-DB2-TABLE-NAME (2)      23570001
235800         SET DP013-DB2-ABEND     TO TRUE                          23580001
235900         SET DP013-XCTL-DISPLAY-RESTART                           23590001
236000                                 TO TRUE                          23600001
236100         PERFORM DP013-0000-PROCESS-ABEND                         23610001
236200     END-IF.                                                      23620001
236300                                                                  23630001
236400/                                                                 23640001
236500*----------------------------------------------------------------*23650001
236600*  DETERMINE IF A SPECIFIC TRIP STATUS EXISTS                    *23660001
236700*----------------------------------------------------------------*23670001
236800 3060-CHECK-PREV-TRIP-STATUS.                                     23680001
236900     IF ASC-TRIP-STATUS-CDE = 'UN'                                23690001
237000         MOVE 'UG' TO PV-TRIP-STATUS-CDE                          23700001
237100     ELSE                                                         23710001
237200         MOVE 'LG' TO PV-TRIP-STATUS-CDE.                         23720001
237300     PERFORM 4380-READ-TRIP-STATUS-TABLE.                         23730001
237400     IF SQLCODE NOT = +0                                          23740001
237500         IF ASC-TRIP-STATUS-CDE = 'UN'                            23750001
237600             MOVE PC-TSYMSG-00651      TO DP020-MSG-NUMBER        23760001
237700         ELSE                                                     23770001
237800             MOVE PC-TSYMSG-00647      TO DP020-MSG-NUMBER.       23780001
237900/                                                                 23790001
238000*----------------------------------------------------------------*23800001
238100*  CHECK THE VALUE IN THE STATUS FIELD, AND COMPARE IT WITH      *23810001
238200*  THE VALUE THAT THE STATUS FIELD HAD PREVIOUSLY.               *23820001
238300*----------------------------------------------------------------*23830001
238400                                                                  23840001
238500 3070-CHECK-STATUS.                                               23850001
238600                                                                  23860001
238700     IF  PS-NO-ERROR                                              23870001
238800     AND ASC-TRIP-STATUS-CDE = SPACES                             23880001
238900         SET PS-ERROR            TO TRUE                          23890001
239000         SET DP020-MSG-FATAL     TO TRUE                          23900001
239100         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              23910001
239200         MOVE DP015-UNP-ALP-BRT-OFF                               23920001
239300                                 TO ATRIPSA                       23930001
239400         MOVE DP015-RED          TO ATRIPSC                       23940001
239500         MOVE DP015-REVERSE      TO ATRIPSH                       23950001
239600         MOVE -1                 TO ATRIPSL                       23960001
239700         SET DP030-SET-CURSOR-APPL-1                              23970001
239800                                 TO TRUE                          23980001
239900     ELSE                                                         23990001
240000         MOVE ASC-TRIP-STATUS-CDE TO DK-TRIP-STATUS-CDE           24000001
240100         PERFORM 3040-VALIDATE-TRIP-STATUS-CDE                    24010001
240200         IF  SQLCODE = +100                                       24020001
240300             SET PS-ERROR              TO TRUE                    24030001
240400             SET DP020-MSG-FATAL       TO TRUE                    24040001
240500             MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        24050001
240600             MOVE DP015-UNP-ALP-BRT-OFF                           24060001
240700                                       TO ATRIPSA                 24070001
240800             MOVE DP015-RED            TO ATRIPSC                 24080001
240900             MOVE DP015-REVERSE        TO ATRIPSH                 24090001
241000             MOVE -1                   TO ATRIPSL                 24100001
241100             SET DP030-SET-CURSOR-APPL-1                          24110001
241200                                       TO TRUE                    24120001
241300         ELSE                                                     24130001
241400             MOVE TRSTYP-DESC          TO ASC-TRIP-STATUS-DESC    24140001
241500                                          ATRIPSDO                24150001
241600             MOVE TRSTYP-PRTY-CDE      TO PV-TRIP-PRTY-CDE        24160001
241700         END-IF                                                   24170001
241800     END-IF.                                                      24180001
241900                                                                  24190001
242000*   CHECK STATUS PRIORITY PROGRESSION                             24200001
242100*                                                                 24210001
242200*    HERE  ANOTHER TRIP TO AN EXISTING TRAILER MUST BE 'EN'       24220001
242300     IF  ASC-VEHICLE-SETUP-PREV                                   24230001
242400     AND PS-NO-ERROR                                              24240001
242500         IF PV-TRIP-PRTY-CDE-N < ASC-TRIP-PRTY-CDE-N              24250001
242600             SET PS-ERROR              TO TRUE                    24260001
242700             SET DP020-MSG-FATAL       TO TRUE                    24270001
242800             MOVE PC-TSYMSG-00646      TO DP020-MSG-NUMBER        24280001
242900             MOVE DP015-UNP-ALP-BRT-OFF                           24290001
243000                                       TO ATRIPSA                 24300001
243100             MOVE DP015-RED            TO ATRIPSC                 24310001
243200             MOVE DP015-REVERSE        TO ATRIPSH                 24320001
243300             MOVE -1                   TO ATRIPSL                 24330001
243400             SET DP030-SET-CURSOR-APPL-1                          24340001
243500                                       TO TRUE                    24350001
243600         ELSE                                                     24360001
243700             IF  (ASC-TRIP-STATUS-CDE = 'DE')                     24370001
243800                     SET PS-ERROR              TO TRUE            24380001
243900                     SET DP020-MSG-FATAL       TO TRUE            24390001
244000                     MOVE PC-TSYMSG-00005                         24400001
244100                                       TO DP020-MSG-NUMBER        24410001
244200                     MOVE DP015-UNP-ALP-BRT-OFF                   24420001
244300                                               TO ATRIPSA         24430001
244400                     MOVE DP015-RED            TO ATRIPSC         24440001
244500                     MOVE DP015-REVERSE        TO ATRIPSH         24450001
244600                     MOVE -1                   TO ATRIPSL         24460001
244700                     SET DP030-SET-CURSOR-APPL-1                  24470001
244800                                               TO TRUE            24480001
244900             ELSE                                                 24490001
245000               IF  (ASC-TRIP-STATUS-CDE = 'UN' AND                24500001
245100                    ASC-TRIP-STATUS-CDE-OLD NOT = 'UN' AND        24510001
245200                    ASC-TRIP-STATUS-CDE-OLD NOT = 'UG') OR        24520001
245300                   (ASC-TRIP-STATUS-CDE = 'LD' AND                24530001
245400                    ASC-TRIP-STATUS-CDE-OLD NOT = 'LD' AND        24540001
245500                    ASC-TRIP-STATUS-CDE-OLD NOT = 'LG')           24550001
245600                   PERFORM 3060-CHECK-PREV-TRIP-STATUS            24560001
245700                   IF SQLCODE NOT = +0                            24570001
245800                       SET PS-ERROR              TO TRUE          24580001
245900                       SET DP020-MSG-FATAL       TO TRUE          24590001
246000                       MOVE DP015-UNP-ALP-BRT-OFF                 24600001
246100                                                 TO ATRIPSA       24610001
246200                       MOVE DP015-RED            TO ATRIPSC       24620001
246300                       MOVE DP015-REVERSE        TO ATRIPSH       24630001
246400                       MOVE -1                   TO ATRIPSL       24640001
246500                       SET DP030-SET-CURSOR-APPL-1                24650001
246600                                                 TO TRUE          24660001
246700                   END-IF                                         24670001
246800               ELSE                                               24680001
246900                   IF  ASC-TRIP-STATUS-CDE         = 'DP'         24690001
247000                       SET ASC-VEHICLE-DEPARTED  TO TRUE          24700001
247100                   END-IF                                         24710001
247200                   IF  ASC-TRIP-STATUS-CDE         = 'EN'         24720001
247300                       SET ASC-VEHICLE-ENROUTE   TO TRUE          24730001
247400                   END-IF                                         24740001
247500                   IF  ASC-TRIP-STATUS-CDE         = 'LD'         24750001
247600                       SET ASC-VEHICLE-LOADED    TO TRUE          24760001
247700                   END-IF                                         24770001
247800                   IF  ASC-TRIP-STATUS-CDE         = 'LG'         24780001
247900                       SET ASC-VEHICLE-BEG-LOAD  TO TRUE          24790001
248000                   END-IF                                         24800001
248100               END-IF                                             24810001
248200             END-IF                                               24820001
248300         END-IF                                                   24830001
248400     END-IF.                                                      24840001
248500                                                                  24850001
248600*  THE EXACT LOCATION OF THE TRAILER NEEDS TO BE ENTERED FOR      24860001
248700*  PRIORITY CODES BETWEEN 50 AND 90.                              24870001
248800                                                                  24880001
248900     IF  ASC-VEHICLE-SETUP-PREV                                   24890001
249000     AND ASC-CURR-SUBAREA-OF-ID = SPACES                          24900001
249100     AND PS-NO-ERROR                                              24910001
249200         IF  (PV-TRIP-PRTY-CDE-N > 49 AND < 99)                   24920001
249300             SET PS-ERROR          TO TRUE                        24930001
249400             SET DP020-MSG-FATAL   TO TRUE                        24940001
249500             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            24950001
249600             MOVE DP015-UNP-ALP-BRT-OFF                           24960001
249700                                   TO ACSUBA                      24970001
249800             MOVE DP015-RED        TO ACSUBC                      24980001
249900             MOVE DP015-REVERSE    TO ACSUBH                      24990001
250000             MOVE -1               TO ACSUBL                      25000001
250100             SET DP030-SET-CURSOR-APPL-1                          25010001
250200                                   TO TRUE                        25020001
250300         END-IF                                                   25030001
250400     END-IF.                                                      25040001
250500                                                                  25050001
250600                                                                  25060001
250700                                                                  25070001
250800/                                                                 25080001
250900*----------------------------------------------------------------*25090001
251000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *25100001
251100*----------------------------------------------------------------*25110001
251200                                                                  25120001
251300 3200-RESET-ATTRIBUTES.                                           25130001
251400                                                                  25140001
251500     MOVE DP015-PRO-NOR-OFF     TO ASCACA                         25150001
251600                                   ATRLRA                         25160001
251700                                   ALGTHA                         25170001
251800                                   ACOPERA                        25180001
251900                                   ACFIDA                         25190001
252000                                   ACAREAA                        25200001
252100                                   ACSUBA                         25210001
252200                                   ATRIPSA                        25220001
252300                                   ADOPERA                        25230001
252400                                   ADFIDA                         25240001
252500                                   ADAREAA                        25250001
252600                                   ADSUBA                         25260001
252700                                   AUSEA                          25270001
252800                                   AMANA                          25280001
252900                                   ASEAL1A                        25290001
253000                                   ASEAL2A                        25300001
253100                                   AETAMMA                        25310001
253200                                   AETADDA                        25320001
253300                                   AETAYYA                        25330001
253400                                   AETAHHA                        25340001
253500                                   AETAMNA.                       25350001
253600     MOVE DP015-BLUE            TO ASCACC                         25360001
253700                                   ATRLRC                         25370001
253800                                   ALGTHC                         25380001
253900                                   ACAREAC                        25390001
254000                                   ACSUBC                         25400001
254100                                   ACOPERC                        25410001
254200                                   ACFIDC                         25420001
254300                                   ATRIPSC                        25430001
254400                                   ADOPERC                        25440001
254500                                   ADFIDC                         25450001
254600                                   ADAREAC                        25460001
254700                                   ADSUBC                         25470001
254800                                   AUSEC                          25480001
254900                                   AMANC                          25490001
255000                                   ASEAL1C                        25500001
255100                                   ASEAL2C                        25510001
255200                                   AETAMMC                        25520001
255300                                   AETADDC                        25530001
255400                                   AETAYYC                        25540001
255500                                   AETAHHC                        25550001
255600                                   AETAMNC.                       25560001
255700     MOVE DP015-HL-OFF          TO ASCACH                         25570001
255800                                   ATRLRH                         25580001
255900                                   ALGTHH                         25590001
256000                                   ACAREAH                        25600001
256100                                   ACSUBH                         25610001
256200                                   ACOPERH                        25620001
256300                                   ACFIDH                         25630001
256400                                   ATRIPSH                        25640001
256500                                   ADAREAH                        25650001
256600                                   ADSUBH                         25660001
256700                                   ADOPERH                        25670001
256800                                   ADFIDH                         25680001
256900                                   AUSEH                          25690001
257000                                   AMANH                          25700001
257100                                   ASEAL1H                        25710001
257200                                   ASEAL2H                        25720001
257300                                   AETAMMH                        25730001
257400                                   AETADDH                        25740001
257500                                   AETAYYH                        25750001
257600                                   AETAHHH                        25760001
257700                                   AETAMNH.                       25770001
257800                                                                  25780001
257900/                                                                 25790001
258000*----------------------------------------------------------------*25800001
258100*    SAVE SCREEN FIELDS FOR LATER COMPARISONS                    *25810001
258200*----------------------------------------------------------------*25820001
258300                                                                  25830001
258400 3500-SAVE-SCREEN-FIELDS.                                         25840001
258500                                                                  25850001
258600     MOVE ASC-CURR-FAC-AREA-ID   TO ASC-CURR-FAC-AREA-ID-OLD.     25860001
258700     MOVE ASC-CURR-SUBAREA-OF-ID TO ASC-CURR-SUBAREA-OF-ID-OLD.   25870001
258800     MOVE ASC-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID-OLD.     25880001
258900     MOVE ASC-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID-OLD.        25890001
259000     MOVE ASC-TRIP-STATUS-CDE    TO ASC-TRIP-STATUS-CDE-OLD.      25900001
259100     MOVE ASC-DEST-FAC-AREA-ID   TO ASC-DEST-FAC-AREA-ID-OLD.     25910001
259200     MOVE ASC-DEST-SUBAREA-OF-ID TO ASC-DEST-SUBAREA-OF-ID-OLD.   25920001
259300     MOVE ASC-DEST-OPER-UNT-ID   TO ASC-DEST-OPER-UNT-ID-OLD.     25930001
259400     MOVE ASC-DEST-FCLTY-ID      TO ASC-DEST-FCLTY-ID-OLD.        25940001
259500     MOVE ASC-USAGE-CDE          TO ASC-USAGE-CDE-OLD.            25950001
259600     MOVE ASC-LENGTH             TO ASC-LENGTH-OLD.               25960001
259700     MOVE ASC-MANIFEST-NBR       TO ASC-MANIFEST-NBR-OLD.         25970001
259800     MOVE ASC-SEAL-1             TO ASC-SEAL-1-OLD.               25980001
259900     MOVE ASC-SEAL-2             TO ASC-SEAL-2-OLD.               25990001
260000*    MOVE ASC-ETA-DTE            TO ASC-ETA-DTE-OLD.              26000001
260100                                                                  26010001
260200/                                                                 26020001
260300*----------------------------------------------------------------*26030001
260400*  CHECK TO SEE IF ANY FIELDS CHANGED.                           *26040001
260500*----------------------------------------------------------------*26050001
260600                                                                  26060001
260700 3600-CHECK-IF-FIELDS-CHANGED.                                    26070001
260800                                                                  26080001
260900     MOVE 'N'                    TO ASC-FIELDS-CHANGED-SW.        26090001
261000                                                                  26100001
261100     IF  ASC-CURR-FAC-AREA-ID   = ASC-CURR-FAC-AREA-ID-OLD        26110001
261200     AND ASC-CURR-SUBAREA-OF-ID = ASC-CURR-SUBAREA-OF-ID-OLD      26120001
261300     AND ASC-CURR-OPER-UNT-ID   = ASC-CURR-OPER-UNT-ID-OLD        26130001
261400     AND ASC-CURR-FCLTY-ID      = ASC-CURR-FCLTY-ID-OLD           26140001
261500     AND ASC-TRIP-STATUS-CDE    = ASC-TRIP-STATUS-CDE-OLD         26150001
261600     AND ASC-DEST-FAC-AREA-ID   = ASC-DEST-FAC-AREA-ID-OLD        26160001
261700     AND ASC-DEST-SUBAREA-OF-ID = ASC-DEST-SUBAREA-OF-ID-OLD      26170001
261800     AND ASC-DEST-OPER-UNT-ID   = ASC-DEST-OPER-UNT-ID-OLD        26180001
261900     AND ASC-DEST-FCLTY-ID      = ASC-DEST-FCLTY-ID-OLD           26190001
262000     AND ASC-USAGE-CDE          = ASC-USAGE-CDE-OLD               26200001
262100     AND ASC-LENGTH             = ASC-LENGTH-OLD                  26210001
262200     AND ASC-MANIFEST-NBR       = ASC-MANIFEST-NBR-OLD            26220001
262300*    AND ASC-SEAL-1             = ASC-SEAL-1-OLD                  26230001
262400*    AND ASC-SEAL-2             = ASC-SEAL-2-OLD                  26240001
262500*    AND ASC-ETA-DTE            = ASC-ETA-DTE-OLD                 26250001
262600         CONTINUE                                                 26260001
262700     ELSE                                                         26270001
262800         SET ASC-FIELDS-CHANGED  TO TRUE                          26280001
262900     END-IF.                                                      26290001
263000                                                                  26300001
263100/                                                                 26310001
263200*----------------------------------------------------------------*26320001
263300*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *26330001
263400*    ENTRY.                                                      *26340001
263500*----------------------------------------------------------------*26350001
263600                                                                  26360001
263700 4000-BUILD-INITIAL-PANEL.                                        26370001
263800                                                                  26380001
264000     INITIALIZE DCLTVEHICL                                        26400002
264100                DCLTVHTRIP                                        26410001
264200                DCLTTRIPST                                        26420001
264300                ASC-SCREEN-FIELDS.                                26430001
264400                                                                  26440001
264500     MOVE ZEROES                 TO ASC-DEST-OPER-UNT-ID-N        26450001
264600                                    ASC-DEST-FCLTY-ID-N.          26460001
264700                                                                  26470001
264800     MOVE ASC-CURR-OPER-UNT-ID     TO DK-OPER-UNT-ID.             26480001
264900     MOVE ASC-CURR-FCLTY-ID        TO DK-FCLTY-ID.                26490001
265000     MOVE ASC-KEY-VEH-NBR          TO DK-VEH-NBR.                 26500001
265100     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           26510001
265200     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 26520001
265300     MOVE ASC-KEY-STATUS-CDE       TO DK-STATUS-CDE.              26530001
265400                                                                  26540001
265500     PERFORM 4200-SELECT-TFACLTY.                                 26550001
265600     MOVE FACLTY-FCLTY-NME       TO ASC-CURR-FCLTY-NME.           26560001
265700                                                                  26570001
265800     PERFORM 4100-SELECT-TAUVHCL.                                 26580001
265900                                                                  26590001
266000     IF  ASC-VEHICLE-SETUP-PREV                                   26600001
266100*    AND TRSTYP-PRTY-CDE <  '89'                                  26610001
266200         PERFORM 4320-GET-ENT-NAME-DESC                           26620001
266300         MOVE ENTNME-ENT-NAME-DESC                                26630001
266400                                 TO ASC-OWNER-SCAC-ID-DESC        26640001
266500         MOVE ASC-CURR-SUBAREA-OF-ID                              26650001
266600                                 TO FLAREA-FCLTY-AREA-ID          26660001
266700         PERFORM 4310-GET-AREA-DESC                               26670001
266800         MOVE FLAREA-FCLTY-AREA-DESC                              26680001
266900                                 TO ASC-CURR-SUBAREA-OF-ID-DESC   26690001
267000         IF  DN-SUBAREA-OF-ID = -1                                26700001
267100             MOVE SPACES         TO ASC-CURR-FAC-AREA-ID          26710001
267200                                    ASC-CURR-FAC-AREA-ID-DESC     26720001
267300         ELSE                                                     26730001
267400             MOVE FLAREA-SUBAREA-OF-ID                            26740001
267500                                 TO ASC-CURR-FAC-AREA-ID          26750001
267600                                    FLAREA-FCLTY-AREA-ID          26760001
267700             PERFORM 4310-GET-AREA-DESC                           26770001
267800             MOVE FLAREA-FCLTY-AREA-DESC                          26780001
267900                                 TO ASC-CURR-FAC-AREA-ID-DESC     26790001
268000         END-IF                                                   26800001
270600         PERFORM 4120-SELECT-TVHTRIP                              27060001
270700         IF  SQLCODE = +0                                         27070001
270800             MOVE ASC-DEST-OPER-UNT-ID                            27080001
270900                                 TO DK-OPER-UNT-ID                27090001
271000             MOVE ASC-DEST-FCLTY-ID                               27100001
271100                                 TO DK-FCLTY-ID                   27110001
271200             PERFORM 4200-SELECT-TFACLTY                          27120001
271300             MOVE FACLTY-FCLTY-NME                                27130001
271400                                 TO ASC-DEST-FCLTY-NME            27140001
271500             MOVE ASC-TRIP-STATUS-CDE                             27150001
271600                                 TO DK-TRIP-STATUS-CDE            27160001
271700             PERFORM 4365-GET-TRIP-STATUS-DESC                    27170001
271800             MOVE TRSTYP-DESC     TO ASC-TRIP-STATUS-DESC         27180001
271900             MOVE TRSTYP-PRTY-CDE TO ASC-TRIP-PRTY-CDE            27190001
272000             MOVE ASC-DEST-SUBAREA-OF-ID                          27200001
272100                                 TO FLAREA-FCLTY-AREA-ID          27210001
272200             PERFORM 4310-GET-AREA-DESC                           27220001
272300             IF  SQLCODE = +0                                     27230001
272400                 MOVE FLAREA-FCLTY-AREA-DESC                      27240001
272500                                 TO ASC-DEST-SUBAREA-OF-ID-DESC   27250001
272600                 IF  DN-SUBAREA-OF-ID = -1                        27260001
272700                     MOVE SPACES TO ASC-DEST-FAC-AREA-ID          27270001
272800                                    ASC-DEST-FAC-AREA-ID-DESC     27280001
272900                 ELSE                                             27290001
273000                     MOVE FLAREA-SUBAREA-OF-ID                    27300001
273100                                 TO ASC-DEST-FAC-AREA-ID          27310001
273200                                    FLAREA-FCLTY-AREA-ID          27320001
273300                     PERFORM 4310-GET-AREA-DESC                   27330001
273400                     MOVE FLAREA-FCLTY-AREA-DESC                  27340001
273500                                 TO ASC-DEST-FAC-AREA-ID-DESC     27350001
273600                 END-IF                                           27360001
273700             END-IF                                               27370001
273800         END-IF                                                   27380001
273900*  DISPLAYING STOPS FOR HISTORY DOES NOT WORK CORRECTLY CURRENTLY 27390001
274000*        INITIALIZE PV-DB2-COUNT                                  27400001
274100*        PERFORM 4125-COUNT-STOPS                                 27410001
274200*        IF  PV-DB2-COUNT = +1                                    27420001
274300*            MOVE +1             TO ASC-STOP-NBR                  27430001
274400*                                   ASC-TOTAL-STOPS               27440001
274500*        ELSE                                                     27450001
274600*            COMPUTE ASC-STOP-NBR = ASC-PLND-TRIP-SEQ + 1         27460001
274700*            MOVE PV-DB2-COUNT   TO ASC-TOTAL-STOPS               27470001
274800*        END-IF                                                   27480001
274900         MOVE 'N'                TO PS-SEAL-CURSOR-SW             27490001
275000         PERFORM 4330-OPEN-SEAL-CSR                               27500001
275100         PERFORM 4340-FETCH-SEAL-CSR                              27510001
275200         IF  SQLCODE = +0                                         27520001
275300             MOVE VHSEAL-SEAL-NBR TO ASC-SEAL-1                   27530001
275400             PERFORM 4340-FETCH-SEAL-CSR                          27540001
275500             IF  SQLCODE = +0                                     27550001
275600                 MOVE VHSEAL-SEAL-NBR                             27560001
275700                                 TO ASC-SEAL-2                    27570001
275800             END-IF                                               27580001
275900         END-IF                                                   27590001
276000         PERFORM 4350-CLOSE-SEAL-CSR                              27600001
276100         PERFORM 4370-RETRIEVE-ETA-DTE                            27610001
276200         IF  ASC-ADD-PENDING                                      27620001
276300         AND (ASC-TRIP-PRTY-CDE-N < 21                            27630001
276400          OR  ASC-TRIP-PRTY-CDE-N > 49)                           27640001
276500             SET ASC-NEW-TRIP-PENDING                             27650001
276600                                 TO TRUE                          27660001
276700             MOVE SPACES         TO ASC-MANIFEST-NBR              27670001
276800                                    ASC-SEAL-1                    27680001
276900                                    ASC-SEAL-2                    27690001
277000                                    ASC-DEST-FCLTY-NME            27700001
277100             MOVE ZEROES         TO ASC-DEST-OPER-UNT-ID-N        27710001
277200                                    ASC-DEST-FCLTY-ID-N           27720001
277300         END-IF                                                   27730001
277400     ELSE                                                         27740001
277500*        CREATE NEW TRIP WITH AN EMPTY OR DEPARTED VEHICLE        27750001
277600         IF  ASC-VEHICLE-SETUP-PREV  AND                          27760001
277700             TRSTYP-PRTY-CDE >= '89'                              27770001
277800             PERFORM 4320-GET-ENT-NAME-DESC                       27780001
277900             MOVE ENTNME-ENT-NAME-DESC                            27790001
278000                                  TO ASC-OWNER-SCAC-ID-DESC       27800001
278100             MOVE ASC-CURR-SUBAREA-OF-ID                          27810001
278200                                 TO FLAREA-FCLTY-AREA-ID          27820001
278300             PERFORM 4310-GET-AREA-DESC                           27830001
278400             MOVE FLAREA-FCLTY-AREA-DESC                          27840001
278500                                 TO ASC-CURR-SUBAREA-OF-ID-DESC   27850001
278600             IF  DN-SUBAREA-OF-ID = -1                            27860001
278700                 MOVE SPACES     TO ASC-CURR-FAC-AREA-ID          27870001
278800                                    ASC-CURR-FAC-AREA-ID-DESC     27880001
278900             ELSE                                                 27890001
279000                 MOVE FLAREA-SUBAREA-OF-ID                        27900001
279100                                 TO ASC-CURR-FAC-AREA-ID          27910001
279200                                    FLAREA-FCLTY-AREA-ID          27920001
279300                 PERFORM 4310-GET-AREA-DESC                       27930001
279400                 MOVE FLAREA-FCLTY-AREA-DESC                      27940001
279500                                 TO ASC-CURR-FAC-AREA-ID-DESC     27950001
279600             END-IF                                               27960001
279700             SET ASC-NEW-TRIP-PENDING  TO TRUE                    27970001
279800         END-IF                                                   27980001
279900     END-IF.                                                      27990001
280000                                                                  28000001
280100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        28010001
280200                                                                  28020001
280300/                                                                 28030001
280400*----------------------------------------------------------------*28040001
280500* SELECT A VEHICLE FORM THE AUDIT TABLE                          *28050001
280600*----------------------------------------------------------------*28060001
280700 4100-SELECT-TAUVHCL.                                             28070001
280800                                                                  28080001
280900     PERFORM                                                      28090001
281000         WITH TEST AFTER                                          28100001
281100         VARYING PV-RETRY-COUNTER                                 28110001
281200         FROM 1 BY 1                                              28120001
281300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28130001
281400            OR (SQLCODE = +0)                                     28140001
281500            OR (SQLCODE = +100))                                  28150001
281600                                                                  28160001
281700         EXEC SQL                                                 28170001
281800          SELECT  DISTINCT                                        28180001
281900                  A.OWNER_SCAC_ID                                 28190001
282000                 ,A.VEH_NBR                                       28200001
282100                 ,A.USAGE_CDE                                     28210001
282200                 ,A.VEH_SIZE_CDE                                  28220001
282300                 ,A.CURR_STATUS_CDE                               28230001
282400                 ,A.CURR_FAC_AREA_ID                              28240001
282500                 ,A.CURR_TRIP_ID                                  28250001
282600                 ,B.DESC                                          28260001
282700                 ,B.PRTY_CDE                                      28270001
282800           INTO  :AUVHCL-OWNER-SCAC-ID                            28280001
282900                ,:AUVHCL-VEH-NBR                                  28290001
283000                ,:AUVHCL-USAGE-CDE                                28300001
283100                ,:AUVHCL-VEH-SIZE-CDE                             28310001
283200                ,:AUVHCL-CURR-STATUS-CDE                          28320001
283300                ,:AUVHCL-CURR-FAC-AREA-ID                         28330001
283400                ,:AUVHCL-CURR-TRIP-ID  :DN-CURR-TRIP-ID           28340001
283500                ,:TRSTYP-DESC                                     28350001
283600                ,:TRSTYP-PRTY-CDE                                 28360001
283700           FROM   TAUVHCL A                                       28370001
283800                , TTRSTYP B                                       28380001
283900           WHERE  A.VEH_NBR       = :DK-VEH-NBR                   28390001
284000             AND  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             28400001
284100             AND  A.CURR_TRIP_ID  = :DK-TRIP-ID                   28410001
284200             AND  A.CURR_STATUS_CDE = :DK-STATUS-CDE              28420001
284300             AND  A.CURR_STATUS_CDE = B.TRIP_STATUS_CDE           28430001
284400             AND  A.CURR_STATUS_DTE =                             28440001
284500                  (SELECT MAX(E.CURR_STATUS_DTE)                  28450001
284600                     FROM TAUVHCL E                               28460001
284700                    WHERE A.CURR_TRIP_ID  = E.CURR_TRIP_ID        28470001
284800                      AND A.CURR_STATUS_CDE = E.CURR_STATUS_CDE   28480001
284900                      AND A.CURR_STATUS_TME =                     28490001
285000                      (SELECT MAX(F.CURR_STATUS_TME)              28500001
285100                         FROM TAUVHCL F                           28510001
285200                        WHERE A.CURR_TRIP_ID  = F.CURR_TRIP_ID    28520001
285300                          AND A.CURR_STATUS_CDE =                 28530001
285400                                        F.CURR_STATUS_CDE))       28540001
285500         END-EXEC                                                 28550001
285600                                                                  28560001
285700         EVALUATE TRUE                                            28570001
285800             WHEN SQLCODE = +0                                    28580001
285900                  IF DN-CURR-TRIP-ID = 0                          28590001
286000                      SET ASC-VEHICLE-SETUP-PREV                  28600001
286100                                     TO TRUE                      28610001
286200                  ELSE                                            28620001
286300                      SET ASC-VEHICLE-NULL-TRIP                   28630001
286400                                     TO TRUE                      28640001
286500                  END-IF                                          28650001
286600                  MOVE AUVHCL-OWNER-SCAC-ID                       28660001
286700                                 TO ASC-KEY-OWNER-SCAC-ID         28670001
286800                  MOVE AUVHCL-VEH-NBR                             28680001
286900                                 TO ASC-KEY-VEH-NBR               28690001
287000                  MOVE AUVHCL-USAGE-CDE                           28700001
287100                                 TO ASC-USAGE-CDE                 28710001
287200                  MOVE AUVHCL-VEH-SIZE-CDE                        28720001
287300                                 TO ASC-LENGTH                    28730001
287400                  MOVE AUVHCL-CURR-FAC-AREA-ID                    28740001
287500                                 TO ASC-CURR-SUBAREA-OF-ID        28750001
287600                  MOVE AUVHCL-CURR-STATUS-CDE                     28760001
287700                                 TO ASC-TRIP-STATUS-CDE           28770001
287800                                                                  28780001
287900             WHEN SQLCODE = +100                                  28790001
288000                  SET ASC-VEHICLE-NOT-SETUP-PREV                  28800001
288100                                 TO TRUE                          28810001
288200                                                                  28820001
288300             WHEN SQLCODE = -904                                  28830001
288400             WHEN SQLCODE = -913                                  28840001
288500                 CONTINUE                                         28850001
288600                                                                  28860001
288700             WHEN SQLWARN0 NOT = SPACES                           28870001
288800             WHEN SQLCODE < ZERO                                  28880001
288900             WHEN SQLCODE > ZERO                                  28890001
289000                 MOVE '4100-SELECT-TAUVHCL'                       28900001
289100                                   TO DP013-PARAGRAPH             28910001
289200                 MOVE 'SELECT ON TAUVHCL'                         28920001
289300                                   TO DP013-MESSAGE-TEXT (1)      28930001
289400                 MOVE SQLCA        TO DP013-SQLCA                 28940001
289500                 MOVE 'TAUVHCL'    TO DP013-DB2-TABLE-NAME (1)    28950001
289600                 SET DP013-DB2-ABEND                              28960001
289700                     DP013-XCTL-DISPLAY-RESTART                   28970001
289800                                   TO TRUE                        28980001
289900                 PERFORM DP013-0000-PROCESS-ABEND                 28990001
290000         END-EVALUATE                                             29000001
290100     END-PERFORM.                                                 29010001
290200                                                                  29020001
290300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29030001
290400         MOVE '4100-SELECT-TAUVHCL'                               29040001
290500                                   TO DP013-PARAGRAPH             29050001
290600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     29060001
290700                                   TO DP013-MESSAGE-TEXT (1)      29070001
290800         MOVE 'A AUVHCLE ROW   '   TO DP013-MESSAGE-TEXT (2)      29080001
290900         MOVE SQLCA                TO DP013-SQLCA                 29090001
291000         MOVE 'TAUVHCL'            TO DP013-DB2-TABLE-NAME (1)    29100001
291100         SET DP013-DB2-ABEND                                      29110001
291200             DP013-XCTL-DISPLAY-RESTART                           29120001
291300                                   TO TRUE                        29130001
291400         PERFORM DP013-0000-PROCESS-ABEND                         29140001
291500     END-IF.                                                      29150001
291600                                                                  29160001
291700/                                                                 29170001
298300*----------------------------------------------------------------*29830001
298400* SELECT THE MOST RECENT TRIP MADE BY A VEHICLE                  *29840001
298500*----------------------------------------------------------------*29850001
298600 4120-SELECT-TVHTRIP.                                             29860001
298700                                                                  29870001
298800     PERFORM                                                      29880001
298900         WITH TEST AFTER                                          29890001
299000         VARYING PV-RETRY-COUNTER                                 29900001
299100         FROM 1 BY 1                                              29910001
299200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29920001
299300            OR (SQLCODE = +0)                                     29930001
299400            OR (SQLCODE = +100))                                  29940001
299500                                                                  29950001
299600         EXEC SQL                                                 29960001
299700           SELECT A.MANIFEST_NBR                                  29970001
299800                 ,A.PLND_TRIP_SEQ                                 29980001
299900                 ,B.TRIP_STATUS_CDE                               29990001
300000                 ,B.OPER_UNT_ID                                   30000001
300100                 ,B.FCLTY_ID                                      30010001
300200                 ,B.FCLTY_AREA_ID                                 30020001
300300           INTO  :VHTRIP-MANIFEST-NBR                             30030001
300400                ,:VHTRIP-PLND-TRIP-SEQ                            30040001
300500                ,:TRIPST-TRIP-STATUS-CDE                          30050001
300600                ,:TRIPST-OPER-UNT-ID                              30060001
300700                ,:TRIPST-FCLTY-ID                                 30070001
300800                ,:TRIPST-FCLTY-AREA-ID                            30080001
300900           FROM   TVHTRIP A                                       30090001
301000                 ,TTRIPST B                                       30100001
301100           WHERE  A.TRIP_ID          = :DK-TRIP-ID                30110001
301200             AND  A.TRIP_ID         = B.TRIP_ID                   30120001
301300             AND  B.TRIP_STATUS_CDE = :DK-STATUS-CDE              30130001
301400         END-EXEC                                                 30140001
301500                                                                  30150001
301600         EVALUATE TRUE                                            30160001
301700             WHEN SQLCODE = +0                                    30170001
301800                  MOVE VHTRIP-MANIFEST-NBR                        30180001
301900                                 TO ASC-MANIFEST-NBR              30190001
302000                  MOVE VHTRIP-PLND-TRIP-SEQ                       30200001
302100                                 TO ASC-PLND-TRIP-SEQ             30210001
302200                  MOVE TRIPST-TRIP-STATUS-CDE                     30220001
302300                                 TO ASC-TRIP-STATUS-CDE           30230001
302400                  MOVE TRIPST-OPER-UNT-ID                         30240001
302500                                 TO ASC-DEST-OPER-UNT-ID          30250001
302600                  MOVE TRIPST-FCLTY-ID                            30260001
302700                                 TO ASC-DEST-FCLTY-ID             30270001
302800                  MOVE TRIPST-FCLTY-AREA-ID                       30280001
302900                                 TO ASC-DEST-SUBAREA-OF-ID        30290001
303000                                                                  30300001
303100             WHEN SQLCODE = +100                                  30310001
303200             WHEN SQLCODE = -904                                  30320001
303300             WHEN SQLCODE = -913                                  30330001
303400                 CONTINUE                                         30340001
303500                                                                  30350001
303600             WHEN SQLWARN0 NOT = SPACES                           30360001
303700             WHEN SQLCODE < ZERO                                  30370001
303800             WHEN SQLCODE > ZERO                                  30380001
303900                 MOVE '4120-SELECT-TVHTRIP'                       30390001
304000                                   TO DP013-PARAGRAPH             30400001
304100                 MOVE 'SELECT TRIP INFO  '                        30410001
304200                                   TO DP013-MESSAGE-TEXT (1)      30420001
304300                 MOVE SQLCA        TO DP013-SQLCA                 30430001
304400                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    30440001
304500                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (2)    30450001
304600                 SET DP013-DB2-ABEND                              30460001
304700                     DP013-XCTL-DISPLAY-RESTART                   30470001
304800                                   TO TRUE                        30480001
304900                 PERFORM DP013-0000-PROCESS-ABEND                 30490001
305000         END-EVALUATE                                             30500001
305100     END-PERFORM.                                                 30510001
305200                                                                  30520001
305300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30530001
305400         MOVE '4120-SELECT-TVHTRIP'                               30540001
305500                                   TO DP013-PARAGRAPH             30550001
305600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     30560001
305700                                   TO DP013-MESSAGE-TEXT (1)      30570001
305800         MOVE 'TRIP INFO       '   TO DP013-MESSAGE-TEXT (2)      30580001
305900         MOVE SQLCA                TO DP013-SQLCA                 30590001
306000         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    30600001
306100         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (2)    30610001
306200         SET DP013-DB2-ABEND                                      30620001
306300             DP013-XCTL-DISPLAY-RESTART                           30630001
306400                                   TO TRUE                        30640001
306500         PERFORM DP013-0000-PROCESS-ABEND                         30650001
306600     END-IF.                                                      30660001
306700                                                                  30670001
306800/                                                                 30680001
306900*----------------------------------------------------------------*30690001
307000* COUNT THE NUMBER OF STOPS FOR A GIVEN VEHICLE                  *30700001
307100*----------------------------------------------------------------*30710001
307200 4125-COUNT-STOPS.                                                30720001
307300                                                                  30730001
307400     PERFORM                                                      30740001
307500         WITH TEST AFTER                                          30750001
307600         VARYING PV-RETRY-COUNTER                                 30760001
307700         FROM 1 BY 1                                              30770001
307800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30780001
307900            OR (SQLCODE = +0)                                     30790001
308000            OR (SQLCODE = +100))                                  30800001
308100                                                                  30810001
308200         EXEC SQL                                                 30820001
308300           SELECT COUNT(*)                                        30830001
308400           INTO  :PV-DB2-COUNT                                    30840001
308500           FROM   TVHTRIP A                                       30850001
308600           WHERE  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID             30860001
308700             AND  A.VEH_NBR       IS NOT NULL                     30870001
308800             AND  A.VEH_NBR       = :DK-VEH-NBR                   30880001
308900             AND  A.TRIP_ID NOT IN                                30890001
309000                  (SELECT B.TRIP_ID                               30900001
309100                     FROM TVHTRIP B                               30910001
309200                         ,TTRIPST C                               30920001
309300                    WHERE A.TRIP_ID          = B.TRIP_ID          30930001
309400                      AND A.TRIP_ID          = C.TRIP_ID          30940001
309500                      AND C.TRIP_STATUS_CDE  = 'DE')              30950001
309600         END-EXEC                                                 30960001
309700                                                                  30970001
309800         EVALUATE TRUE                                            30980001
309900             WHEN SQLCODE = +0                                    30990001
310000             WHEN SQLCODE = +100                                  31000001
310100             WHEN SQLCODE = -904                                  31010001
310200             WHEN SQLCODE = -913                                  31020001
310300                 CONTINUE                                         31030001
310400                                                                  31040001
310500             WHEN SQLWARN0 NOT = SPACES                           31050001
310600             WHEN SQLCODE < ZERO                                  31060001
310700             WHEN SQLCODE > ZERO                                  31070001
310800                 MOVE '4125-COUNT-STOPS   '                       31080001
310900                                   TO DP013-PARAGRAPH             31090001
311000                 MOVE 'SELECT NUMBER OF STOPS '                   31100001
311100                                   TO DP013-MESSAGE-TEXT (1)      31110001
311200                 MOVE SQLCA        TO DP013-SQLCA                 31120001
311300                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    31130001
311400                 SET DP013-DB2-ABEND                              31140001
311500                     DP013-XCTL-DISPLAY-RESTART                   31150001
311600                                   TO TRUE                        31160001
311700                 PERFORM DP013-0000-PROCESS-ABEND                 31170001
311800         END-EVALUATE                                             31180001
311900     END-PERFORM.                                                 31190001
312000                                                                  31200001
312100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31210001
312200         MOVE '4125-COUNT-STOPS   '                               31220001
312300                                   TO DP013-PARAGRAPH             31230001
312400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     31240001
312500                                   TO DP013-MESSAGE-TEXT (1)      31250001
312600         MOVE 'NBR OF STOPS    '   TO DP013-MESSAGE-TEXT (2)      31260001
312700         MOVE SQLCA                TO DP013-SQLCA                 31270001
312800         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    31280001
312900         SET DP013-DB2-ABEND                                      31290001
313000             DP013-XCTL-DISPLAY-RESTART                           31300001
313100                                   TO TRUE                        31310001
313200         PERFORM DP013-0000-PROCESS-ABEND                         31320001
313300     END-IF.                                                      31330001
313400                                                                  31340001
313500/                                                                 31350001
313600*----------------------------------------------------------------*31360001
313700*    GET FACILITY NAME                                           *31370001
313800*----------------------------------------------------------------*31380001
313900                                                                  31390001
314000 4200-SELECT-TFACLTY.                                             31400001
314100                                                                  31410001
314200     PERFORM                                                      31420001
314300         WITH TEST AFTER                                          31430001
314400         VARYING PV-RETRY-COUNTER                                 31440001
314500         FROM 1 BY 1                                              31450001
314600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31460001
314700            OR  (SQLCODE = +100)                                  31470001
314800            OR  (SQLCODE = +0))                                   31480001
314900                                                                  31490001
315000         EXEC SQL                                                 31500001
315100             SELECT  FCLTY_NME                                    31510001
315200               INTO :FACLTY-FCLTY-NME                             31520001
315300              FROM  TFACLTY                                       31530001
315400             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                 31540001
315500               AND  FCLTY_ID    = :DK-FCLTY-ID                    31550001
315600         END-EXEC                                                 31560001
315700                                                                  31570001
315800         EVALUATE TRUE                                            31580001
315900             WHEN SQLCODE = +0                                    31590001
316000             WHEN SQLCODE = +100                                  31600001
316100             WHEN SQLCODE = -904                                  31610001
316200             WHEN SQLCODE = -913                                  31620001
316300                  CONTINUE                                        31630001
316400                                                                  31640001
316500             WHEN SQLWARN0 NOT = SPACE                            31650001
316600             WHEN SQLCODE < +0                                    31660001
316700             WHEN SQLCODE > +0                                    31670001
316800                  MOVE '4200-SELECT-TFACLTY'                      31680001
316900                                   TO DP013-PARAGRAPH             31690001
317000                  MOVE 'SELECT ON TFACLTY'                        31700001
317100                                   TO DP013-MESSAGE-TEXT (1)      31710001
317200                  MOVE SQLCA       TO DP013-SQLCA                 31720001
317300                  MOVE 'TFACLTY'   TO DP013-DB2-TABLE-NAME (1)    31730001
317400                  SET DP013-DB2-ABEND                             31740001
317500                      DP013-XCTL-DISPLAY-RESTART                  31750001
317600                                   TO TRUE                        31760001
317700                  PERFORM DP013-0000-PROCESS-ABEND                31770001
317800         END-EVALUATE                                             31780001
317900     END-PERFORM.                                                 31790001
318000                                                                  31800001
318100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31810001
318200         MOVE '4200-SELECT-TFACLTY'                               31820001
318300                                   TO DP013-PARAGRAPH             31830001
318400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   31840001
318500                                   TO DP013-MESSAGE-TEXT (1)      31850001
318600         MOVE 'ON TABLE TFACLTY '  TO DP013-MESSAGE-TEXT (2)      31860001
318700         MOVE SQLCA                TO DP013-SQLCA                 31870001
318800         SET DP013-DB2-ABEND                                      31880001
318900             DP013-XCTL-DISPLAY-RESTART                           31890001
319000                                   TO TRUE                        31900001
319100         PERFORM DP013-0000-PROCESS-ABEND                         31910001
319200     END-IF.                                                      31920001
319300                                                                  31930001
319400/                                                                 31940001
325400*----------------------------------------------------------------*32540001
325500*    GET THE FACILITY AREA DESC                                  *32550001
325600*----------------------------------------------------------------*32560001
325700 4310-GET-AREA-DESC.                                              32570001
325800                                                                  32580001
325900     PERFORM                                                      32590001
326000         WITH TEST AFTER                                          32600001
326100         VARYING PV-RETRY-COUNTER                                 32610001
326200         FROM 1 BY 1                                              32620001
326300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32630001
326400             OR (SQLCODE = +0)                                    32640001
326500             OR (SQLCODE = +100))                                 32650001
326600                                                                  32660001
326700         EXEC SQL                                                 32670001
326800              SELECT FCLTY_AREA_DESC                              32680001
326900                    ,SUBAREA_OF_ID                                32690001
327000                INTO :FLAREA-FCLTY-AREA-DESC                      32700001
327100                    ,:FLAREA-SUBAREA-OF-ID                        32710001
327200                       :DN-SUBAREA-OF-ID                          32720001
327300                FROM TFLAREA                                      32730001
327400               WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID              32740001
327500                 AND FCLTY_ID      = :DK-FCLTY-ID                 32750001
327600                 AND FCLTY_AREA_ID = :FLAREA-FCLTY-AREA-ID        32760001
327700         END-EXEC                                                 32770001
327800                                                                  32780001
327900         EVALUATE TRUE                                            32790001
328000             WHEN SQLCODE = +0                                    32800001
328100             WHEN SQLCODE = +100                                  32810001
328200             WHEN SQLCODE = -904                                  32820001
328300             WHEN SQLCODE = -913                                  32830001
328400                  CONTINUE                                        32840001
328500                                                                  32850001
328600             WHEN SQLWARN0 NOT = SPACES                           32860001
328700             WHEN SQLCODE < +0                                    32870001
328800             WHEN SQLCODE > +0                                    32880001
328900                  MOVE '4310-GET-AREA-DESC'                       32890001
329000                                  TO DP013-PARAGRAPH              32900001
329100                  MOVE 'UNSUCCESSFUL SELECT ON TFLAREA TABLE'     32910001
329200                                  TO DP013-MESSAGE-TEXT (1)       32920001
329300                  MOVE SQLCA      TO DP013-SQLCA                  32930001
329400                  MOVE 'TFLAREA ' TO DP013-DB2-TABLE-NAME (1)     32940001
329500                  SET DP013-DB2-ABEND                             32950001
329600                      DP013-XCTL-DISPLAY-RESTART                  32960001
329700                                  TO TRUE                         32970001
329800                  PERFORM DP013-0000-PROCESS-ABEND                32980001
329900         END-EVALUATE                                             32990001
330000     END-PERFORM.                                                 33000001
330100                                                                  33010001
330200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        33020001
330300         MOVE '4310-GET-AREA-DESC' TO DP013-PARAGRAPH             33030001
330400         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     33040001
330500                                  TO DP013-MESSAGE-TEXT (1)       33050001
330600         MOVE SQLCA               TO DP013-SQLCA                  33060001
330700         MOVE 'TFLAREA'           TO DP013-DB2-TABLE-NAME (1)     33070001
330800         SET DP013-DB2-ABEND                                      33080001
330900             DP013-XCTL-DISPLAY-RESTART                           33090001
331000                                  TO TRUE                         33100001
331100         PERFORM DP013-0000-PROCESS-ABEND                         33110001
331200     END-IF.                                                      33120001
331300                                                                  33130001
331400/                                                                 33140001
331500*----------------------------------------------------------------*33150001
331600*    GET THE ENTERPRISE NAME DESC                                *33160001
331700*----------------------------------------------------------------*33170001
331800 4320-GET-ENT-NAME-DESC.                                          33180001
331900                                                                  33190001
332000     PERFORM                                                      33200001
332100         WITH TEST AFTER                                          33210001
332200         VARYING PV-RETRY-COUNTER                                 33220001
332300         FROM 1 BY 1                                              33230001
332400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               33240001
332500             OR (SQLCODE = +0)                                    33250001
332600             OR (SQLCODE = +100))                                 33260001
332700                                                                  33270001
332800         EXEC SQL                                                 33280001
332900              SELECT ENT_NAME_DESC                                33290001
333000                INTO :ENTNME-ENT-NAME-DESC                        33300001
333100                FROM TEXTENT A                                    33310001
333200                    ,TENTNME B                                    33320001
333300               WHERE A.SCAC_CDE    = :DK-OWNER-SCAC-ID            33330001
333400                 AND A.CARRIER_IND = 'Y'                          33340001
333500                 AND B.TYPE_CDE    = '01'                         33350001
333600                 AND A.ENT_ID = B.ENT_ID                          33360001
333700         END-EXEC                                                 33370001
333800                                                                  33380001
333900         EVALUATE TRUE                                            33390001
334000             WHEN SQLCODE = +0                                    33400001
334100             WHEN SQLCODE = +100                                  33410001
334200             WHEN SQLCODE = -904                                  33420001
334300             WHEN SQLCODE = -913                                  33430001
334400                  CONTINUE                                        33440001
334500                                                                  33450001
334600             WHEN SQLWARN0 NOT = SPACES                           33460001
334700             WHEN SQLCODE < +0                                    33470001
334800             WHEN SQLCODE > +0                                    33480001
334900                  MOVE '4320-GET-ENT-NAME-DESC'                   33490001
335000                                  TO DP013-PARAGRAPH              33500001
335100                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     33510001
335200                                  TO DP013-MESSAGE-TEXT (1)       33520001
335300                  MOVE SQLCA      TO DP013-SQLCA                  33530001
335400                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)     33540001
335500                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     33550001
335600                  SET DP013-DB2-ABEND                             33560001
335700                      DP013-XCTL-DISPLAY-RESTART                  33570001
335800                                  TO TRUE                         33580001
335900                  PERFORM DP013-0000-PROCESS-ABEND                33590001
336000         END-EVALUATE                                             33600001
336100     END-PERFORM.                                                 33610001
336200                                                                  33620001
336300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        33630001
336400         MOVE '4320-GET-ENT-NAME-DESC'                            33640001
336500                                  TO DP013-PARAGRAPH              33650001
336600         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      33660001
336700                                  TO DP013-MESSAGE-TEXT (1)       33670001
336800         MOVE SQLCA               TO DP013-SQLCA                  33680001
336900         MOVE 'TEXTENT'           TO DP013-DB2-TABLE-NAME (1)     33690001
337000         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     33700001
337100         SET DP013-DB2-ABEND                                      33710001
337200             DP013-XCTL-DISPLAY-RESTART                           33720001
337300                                  TO TRUE                         33730001
337400         PERFORM DP013-0000-PROCESS-ABEND                         33740001
337500     END-IF.                                                      33750001
337600                                                                  33760001
337700/                                                                 33770001
337800*----------------------------------------------------------------*33780001
337900* OPEN THE SEAL CURSOR                                           *33790001
338000*----------------------------------------------------------------*33800001
338100                                                                  33810001
338200 4330-OPEN-SEAL-CSR.                                              33820001
338300                                                                  33830001
338400     PERFORM                                                      33840001
338500         WITH TEST AFTER                                          33850001
338600         VARYING PV-RETRY-COUNTER                                 33860001
338700         FROM 1 BY 1                                              33870001
338800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               33880001
338900            OR (SQLCODE = +0))                                    33890001
339000                                                                  33900001
339100         EXEC SQL                                                 33910001
339200              OPEN SEAL-CSR                                       33920001
339300         END-EXEC                                                 33930001
339400                                                                  33940001
339500         EVALUATE TRUE                                            33950001
339600             WHEN SQLCODE = +0                                    33960001
339700                  CONTINUE                                        33970001
339800             WHEN SQLCODE = -904                                  33980001
339900             WHEN SQLCODE = -913                                  33990001
340000                  CONTINUE                                        34000001
340100             WHEN SQLWARN0 NOT = SPACE                            34010001
340200             WHEN SQLCODE  NOT = +0                               34020001
340300                  MOVE '4330-OPEN-SEAL-CSR'                       34030001
340400                                   TO DP013-PARAGRAPH             34040001
340500                  MOVE 'OPEN SEAL CURSOR'                         34050001
340600                                   TO DP013-MESSAGE-TEXT (1)      34060001
340700                  MOVE SQLCA       TO DP013-SQLCA                 34070001
340800                  MOVE 'TVHSEAL'   TO DP013-DB2-TABLE-NAME (1)    34080001
340900                  SET DP013-DB2-ABEND                             34090001
341000                                   TO TRUE                        34100001
341100                  PERFORM DP013-0000-PROCESS-ABEND                34110001
341200         END-EVALUATE                                             34120001
341300     END-PERFORM.                                                 34130001
341400                                                                  34140001
341500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34150001
341600         MOVE '4330-OPEN-SEAL-CSR' TO DP013-PARAGRAPH             34160001
341700         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SEAL CURSOR'         34170001
341800                                   TO DP013-MESSAGE-TEXT (1)      34180001
341900         MOVE SQLCA                TO DP013-SQLCA                 34190001
342000         SET DP013-DB2-ABEND       TO TRUE                        34200001
342100         PERFORM DP013-0000-PROCESS-ABEND                         34210001
342200     END-IF.                                                      34220001
342300                                                                  34230001
342400/                                                                 34240001
342500*----------------------------------------------------------------*34250001
342600*    FETCH A SEAL ROW                                            *34260001
342700*----------------------------------------------------------------*34270001
342800                                                                  34280001
342900 4340-FETCH-SEAL-CSR.                                             34290001
343000                                                                  34300001
343100     EXEC SQL                                                     34310001
343200          FETCH SEAL-CSR                                          34320001
343300          INTO :VHSEAL-SEAL-NBR                                   34330001
343400     END-EXEC                                                     34340001
343500                                                                  34350001
343600     EVALUATE TRUE                                                34360001
343700         WHEN SQLCODE = +0                                        34370001
343800              CONTINUE                                            34380001
343900                                                                  34390001
344000         WHEN SQLCODE = +100                                      34400001
344100              SET PS-NO-MORE-SEALS TO TRUE                        34410001
344200                                                                  34420001
344300         WHEN SQLWARN0 NOT = SPACE                                34430001
344400         WHEN SQLCODE < +0                                        34440001
344500         WHEN SQLCODE > +0                                        34450001
344600              MOVE '4340-FETCH-SEAL-CSR'                          34460001
344700                                   TO DP013-PARAGRAPH             34470001
344800              MOVE 'FETCH SEAL CURSOR'                            34480001
344900                                   TO DP013-MESSAGE-TEXT (1)      34490001
345000              MOVE SQLCA           TO DP013-SQLCA                 34500001
345100              MOVE 'TVHSEAL'       TO DP013-DB2-TABLE-NAME (1)    34510001
345200              SET DP013-DB2-ABEND  TO TRUE                        34520001
345300              PERFORM DP013-0000-PROCESS-ABEND                    34530001
345400     END-EVALUATE.                                                34540001
345500                                                                  34550001
345600/                                                                 34560001
345700*----------------------------------------------------------------*34570001
345800* CLOSE THE SEAL CURSOR                                          *34580001
345900*----------------------------------------------------------------*34590001
346000                                                                  34600001
346100 4350-CLOSE-SEAL-CSR.                                             34610001
346200                                                                  34620001
346300     EXEC SQL                                                     34630001
346400          CLOSE SEAL-CSR                                          34640001
346500     END-EXEC                                                     34650001
346600                                                                  34660001
346700     EVALUATE TRUE                                                34670001
346800         WHEN SQLCODE = +0                                        34680001
346900              CONTINUE                                            34690001
347000         WHEN SQLWARN0 NOT = SPACE                                34700001
347100         WHEN SQLCODE  NOT = +0                                   34710001
347200              MOVE '4350-CLOSE-SEAL-CSR'                          34720001
347300                                   TO DP013-PARAGRAPH             34730001
347400              MOVE 'CLOSE SEAL CURSOR'                            34740001
347500                                   TO DP013-MESSAGE-TEXT (1)      34750001
347600              MOVE SQLCA           TO DP013-SQLCA                 34760001
347700              MOVE 'TVHSEAL'       TO DP013-DB2-TABLE-NAME (1)    34770001
347800              SET DP013-DB2-ABEND  TO TRUE                        34780001
347900              PERFORM DP013-0000-PROCESS-ABEND                    34790001
348000     END-EVALUATE.                                                34800001
348100                                                                  34810001
348200/                                                                 34820001
348300*----------------------------------------------------------------*34830001
348400*    GET THE TRIP STATUS CODE DESCRIPTION                        *34840001
348500*----------------------------------------------------------------*34850001
348600                                                                  34860001
348700 4365-GET-TRIP-STATUS-DESC.                                       34870001
348800                                                                  34880001
348900     PERFORM                                                      34890001
349000         WITH TEST AFTER                                          34900001
349100         VARYING PV-RETRY-COUNTER                                 34910001
349200         FROM 1 BY 1                                              34920001
349300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               34930001
349400            OR  (SQLCODE = +100)                                  34940001
349500            OR  (SQLCODE = +0))                                   34950001
349600                                                                  34960001
349700         EXEC SQL                                                 34970001
349800             SELECT  DESC                                         34980001
349900                    ,PRTY_CDE                                     34990001
350000              INTO  :TRSTYP-DESC                                  35000001
350100                   ,:TRSTYP-PRTY-CDE                              35010001
350200              FROM  TTRSTYP                                       35020001
350300             WHERE  TRIP_STATUS_CDE = :DK-TRIP-STATUS-CDE         35030001
350400         END-EXEC                                                 35040001
350500                                                                  35050001
350600         EVALUATE TRUE                                            35060001
350700             WHEN SQLCODE = +0                                    35070001
350800             WHEN SQLCODE = +100                                  35080001
350900             WHEN SQLCODE = -904                                  35090001
351000             WHEN SQLCODE = -913                                  35100001
351100                  CONTINUE                                        35110001
351200                                                                  35120001
351300             WHEN SQLWARN0 NOT = SPACE                            35130001
351400             WHEN SQLCODE < +0                                    35140001
351500             WHEN SQLCODE > +0                                    35150001
351600                  MOVE '4365-GET-TRIP-STATUS-DESC'                35160001
351700                                   TO DP013-PARAGRAPH             35170001
351800                  MOVE 'SELECT ON TTRSTYP'                        35180001
351900                                   TO DP013-MESSAGE-TEXT (1)      35190001
352000                  MOVE SQLCA       TO DP013-SQLCA                 35200001
352100                  MOVE 'TTRSTYP'   TO DP013-DB2-TABLE-NAME (1)    35210001
352200                  SET DP013-DB2-ABEND                             35220001
352300                      DP013-XCTL-DISPLAY-RESTART                  35230001
352400                                   TO TRUE                        35240001
352500                  PERFORM DP013-0000-PROCESS-ABEND                35250001
352600         END-EVALUATE                                             35260001
352700     END-PERFORM.                                                 35270001
352800                                                                  35280001
352900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        35290001
353000         MOVE '4365-GET-TRIP-STATUS-DESC'                         35300001
353100                                   TO DP013-PARAGRAPH             35310001
353200         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   35320001
353300                                   TO DP013-MESSAGE-TEXT (1)      35330001
353400         MOVE 'ON TABLE TTRSTYP '  TO DP013-MESSAGE-TEXT (2)      35340001
353500         MOVE SQLCA                TO DP013-SQLCA                 35350001
353600         SET DP013-DB2-ABEND                                      35360001
353700             DP013-XCTL-DISPLAY-RESTART                           35370001
353800                                   TO TRUE                        35380001
353900         PERFORM DP013-0000-PROCESS-ABEND                         35390001
354000     END-IF.                                                      35400001
354100                                                                  35410001
354200/                                                                 35420001
354300*----------------------------------------------------------------*35430001
354400*    GET THE ETA DATE                                            *35440001
354500*----------------------------------------------------------------*35450001
354600                                                                  35460001
354700 4370-RETRIEVE-ETA-DTE.                                           35470001
354800     MOVE 'AG' TO  PV-TRIP-STATUS-CDE.                            35480001
354900     PERFORM 4380-READ-TRIP-STATUS-TABLE.                         35490001
355000     IF SQLCODE = +0                                              35500001
355100         MOVE TRIPST-STATUS-DTE TO ASC-ETA-DTE                    35510001
355200                                   ASC-ETA-DTE-OLD                35520001
355300         MOVE TRIPST-STATUS-TME  TO ASC-ETA-TIME                  35530001
355400                                    ASC-ETA-TIME-OLD              35540001
355500     ELSE                                                         35550001
355600     IF SQLCODE = +100                                            35560001
355700          MOVE +0                TO SQLCODE                       35570001
355800          MOVE SPACES            TO ASC-ETA-DTE                   35580001
355900                                    ASC-ETA-DTE-OLD               35590001
356000                                    ASC-ETA-TIME                  35600001
356100                                    ASC-ETA-TIME-OLD.             35610001
356200/                                                                 35620001
356300*----------------------------------------------------------------*35630001
356400*    READ THE TRIP STATUS TABLE FOR A PARTICULAR STATUS-CDE.     *35640001
356500*----------------------------------------------------------------*35650001
356600                                                                  35660001
356700 4380-READ-TRIP-STATUS-TABLE.                                     35670001
356800     PERFORM                                                      35680001
356900         WITH TEST AFTER                                          35690001
357000         VARYING PV-RETRY-COUNTER                                 35700001
357100         FROM 1 BY 1                                              35710001
357200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               35720001
357300            OR  (SQLCODE = +100)                                  35730001
357400            OR  (SQLCODE = +0))                                   35740001
357500                                                                  35750001
357600         EXEC SQL                                                 35760001
357700           SELECT STATUS_DTE                                      35770001
357800               ,  STATUS_TME                                      35780001
357900           INTO  :TRIPST-STATUS-DTE                               35790001
358000               , :TRIPST-STATUS-TME                               35800001
358100           FROM   TTRIPST                                         35810001
358200           WHERE  TRIP_ID          = :DK-TRIP-ID                  35820001
358300             AND  TRIP_STATUS_CDE  = :PV-TRIP-STATUS-CDE          35830001
358400         END-EXEC                                                 35840001
358500                                                                  35850001
358600         EVALUATE TRUE                                            35860001
358700             WHEN SQLCODE = +0                                    35870001
358800             WHEN SQLCODE = +100                                  35880001
358900             WHEN SQLCODE = -904                                  35890001
359000             WHEN SQLCODE = -913                                  35900001
359100                  CONTINUE                                        35910001
359200                                                                  35920001
359300             WHEN SQLWARN0 NOT = SPACE                            35930001
359400             WHEN SQLCODE < +0                                    35940001
359500             WHEN SQLCODE > +0                                    35950001
359600                  MOVE '4370-RETRIEVE-ETA-DTE   '                 35960001
359700                                   TO DP013-PARAGRAPH             35970001
359800                  MOVE 'SELECT ON TTRIPST'                        35980001
359900                                   TO DP013-MESSAGE-TEXT (1)      35990001
360000                  MOVE SQLCA       TO DP013-SQLCA                 36000001
360100                  MOVE 'TTRIPST'   TO DP013-DB2-TABLE-NAME (1)    36010001
360200                  SET DP013-DB2-ABEND                             36020001
360300                      DP013-XCTL-DISPLAY-RESTART                  36030001
360400                                   TO TRUE                        36040001
360500                  PERFORM DP013-0000-PROCESS-ABEND                36050001
360600         END-EVALUATE                                             36060001
360700     END-PERFORM.                                                 36070001
360800                                                                  36080001
360900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        36090001
361000         MOVE '4365-GET-TRIP-STATUS-DESC'                         36100001
361100                                   TO DP013-PARAGRAPH             36110001
361200         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   36120001
361300                                   TO DP013-MESSAGE-TEXT (1)      36130001
361400         MOVE 'ON TABLE TTRIPST '  TO DP013-MESSAGE-TEXT (2)      36140001
361500         MOVE SQLCA                TO DP013-SQLCA                 36150001
361600         SET DP013-DB2-ABEND                                      36160001
361700             DP013-XCTL-DISPLAY-RESTART                           36170001
361800                                   TO TRUE                        36180001
361900         PERFORM DP013-0000-PROCESS-ABEND                         36190001
362000     END-IF.                                                      36200001
362100                                                                  36210001
362200/                                                                 36220001
362300*----------------------------------------------------------------*36230001
362400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *36240001
362500*----------------------------------------------------------------*36250001
362600                                                                  36260001
362700 4400-MOVE-COMMAREA-TO-SCREEN.                                    36270001
362800                                                                  36280001
362900     MOVE ASC-KEY-OWNER-SCAC-ID    TO ASCACO.                     36290001
363000     MOVE ASC-OWNER-SCAC-ID-DESC   TO ASCACDO.                    36300001
363100     MOVE ASC-KEY-VEH-NBR          TO ATRLRO.                     36310001
363200     MOVE ASC-USAGE-CDE            TO AUSEO.                      36320001
363300     MOVE ASC-LENGTH               TO ALGTHO.                     36330001
363400     MOVE ASC-CURR-OPER-UNT-ID-N   TO ACOPERO.                    36340001
363500     MOVE ASC-CURR-FCLTY-ID-N      TO ACFIDO.                     36350001
363600     MOVE ASC-CURR-FCLTY-NME       TO ACFIDDO.                    36360001
363700     MOVE ASC-CURR-FAC-AREA-ID     TO ACAREAO.                    36370001
363800     MOVE ASC-CURR-FAC-AREA-ID-DESC                               36380001
363900                                   TO ACAREADO.                   36390001
364000     MOVE ASC-CURR-SUBAREA-OF-ID   TO ACSUBO.                     36400001
364100     MOVE ASC-CURR-SUBAREA-OF-ID-DESC                             36410001
364200                                   TO ACSUBDO.                    36420001
364300     MOVE ASC-DEST-OPER-UNT-ID-N   TO ADOPERO.                    36430001
364400     MOVE ASC-DEST-FCLTY-ID-N      TO ADFIDO.                     36440001
364500     MOVE ASC-DEST-FCLTY-NME       TO ADFIDDO.                    36450001
364600     MOVE ASC-DEST-FAC-AREA-ID     TO ADAREAO.                    36460001
364700     MOVE ASC-DEST-FAC-AREA-ID-DESC                               36470001
364800                                   TO ADAREADO.                   36480001
364900     MOVE ASC-DEST-SUBAREA-OF-ID   TO ADSUBO.                     36490001
365000     MOVE ASC-DEST-SUBAREA-OF-ID-DESC                             36500001
365100                                   TO ADSUBDO.                    36510001
365200     MOVE ASC-TRIP-STATUS-CDE      TO ATRIPSO.                    36520001
365300     MOVE ASC-TRIP-STATUS-DESC     TO ATRIPSDO.                   36530001
365400     MOVE ASC-MANIFEST-NBR         TO AMANO.                      36540001
365500     MOVE ASC-STOP-NBR             TO ASTOPO.                     36550001
365600     MOVE ASC-TOTAL-STOPS          TO ATSTOPO.                    36560001
365700     MOVE ASC-SEAL-1               TO ASEAL1O.                    36570001
365800     MOVE ASC-SEAL-2               TO ASEAL2O.                    36580001
365900     MOVE ASC-ETA-DTE-MM           TO AETAMMO.                    36590001
366000     MOVE ASC-ETA-DTE-DD           TO AETADDO.                    36600001
366100     MOVE ASC-ETA-DTE-CCYY         TO AETAYYO.                    36610001
366200     MOVE ASC-ETA-TIME-HH          TO AETAHHO.                    36620001
366300     MOVE ASC-ETA-TIME-MM          TO AETAMNO.                    36630001
367000                                                                  36700001
367100/                                                                 36710001
367200*----------------------------------------------------------------*36720001
367300* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *36730001
367400* OBJECT WAS UPDATED.                                            *36740001
367500*----------------------------------------------------------------*36750001
367600                                                                  36760001
367700 5200-UPDATE-SELECTION-QUEUE.                                     36770001
367800                                                                  36780001
367900     PERFORM 9100-READ-SEL-QUEUE.                                 36790001
368000                                                                  36800001
368100     IF  ASC-DELETE-SUCCESSFUL                                    36810001
368200         SET TR006-DEL (ASC-SEL-SUB)                              36820001
368300                                   TO TRUE                        36830001
368400     ELSE                                                         36840001
368500         SET TR006-UPD (ASC-SEL-SUB)                              36850001
368600                                   TO TRUE                        36860001
368700     END-IF.                                                      36870001
368800                                                                  36880001
368900     PERFORM 9200-REWRITE-LIST-QUEUE.                             36890001
369000/                                                                 36900001
369100*----------------------------------------------------------------*36910001
369200*  GET THE NEXT SEQUENTIAL TRIP IF THERE IS ONE                  *36920001
369300*----------------------------------------------------------------*36930001
369400 6130-GET-NEXT-TRIP.                                              36940001
369500                                                                  36950001
369600     PERFORM                                                      36960001
369700         WITH TEST AFTER                                          36970001
369800         VARYING PV-RETRY-COUNTER                                 36980001
369900         FROM 1 BY 1                                              36990001
370000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               37000001
370100             OR (SQLCODE = +0)                                    37010001
370200             OR (SQLCODE = +100)                                  37020001
370300             OR (SQLCODE = -811))                                 37030001
370400                                                                  37040001
370500         EXEC SQL                                                 37050001
370600             SELECT  TRIP_ID                                      37060001
370700               INTO  :VHTRIP-TRIP-ID                              37070001
370800           FROM   TVHTRIP                                         37080001
370900           WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               37090001
371000             AND  VEH_NBR       IS NOT NULL                       37100001
371100             AND  VEH_NBR       = :DK-VEH-NBR                     37110001
371200             AND  PLND_TRIP_SEQ > :DK-PLND-TRIP-SEQ               37120001
371300             AND  PLND_TRIP_SEQ IN                                37130001
371400            (SELECT MIN(PLND_TRIP_SEQ)                            37140001
371500                   FROM   TVHTRIP A                               37150001
371600                      ,   TTRIPST B                               37160001
371700                      ,   TTRSTYP C                               37170001
371800                   WHERE  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID     37180001
371900                     AND  A.VEH_NBR       IS NOT NULL             37190001
372000                     AND  A.VEH_NBR       = :DK-VEH-NBR           37200001
372100                     AND  A.TRIP_ID       = B.TRIP_ID             37210001
372200                     AND  B.TRIP_STATUS_CDE ^= 'DE'               37220001
372300                     AND  A.PLND_TRIP_SEQ > :DK-PLND-TRIP-SEQ     37230001
372400                     AND  B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE   37240001
372500                     AND  C.PRTY_CDE =                            37250001
372600                          (SELECT MAX(E.PRTY_CDE)                 37260001
372700                             FROM TTRIPST D                       37270001
372800                                 ,TTRSTYP E                       37280001
372900                            WHERE D.TRIP_ID         = A.TRIP_ID   37290001
373000                      AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)) 37300001
373100         END-EXEC                                                 37310001
373200                                                                  37320001
373300         EVALUATE TRUE                                            37330001
373400             WHEN SQLCODE = +0                                    37340001
373500             WHEN SQLCODE = +100                                  37350001
373600             WHEN SQLCODE = -811                                  37360001
373700             WHEN SQLCODE = -904                                  37370001
373800             WHEN SQLCODE = -913                                  37380001
373900                 CONTINUE                                         37390001
374000                                                                  37400001
374100             WHEN SQLWARN0 NOT = SPACES                           37410001
374200             WHEN SQLCODE < +0                                    37420001
374300             WHEN SQLCODE > +0                                    37430001
374400                 MOVE '6130-GET-NEXT-TRIP '                       37440001
374500                                   TO DP013-PARAGRAPH             37450001
374600                 MOVE 'SELECT A TVHTRIP ROW   '                   37460001
374700                                   TO DP013-MESSAGE-TEXT(1)       37470001
374800                 MOVE SQLCA        TO DP013-SQLCA                 37480001
374900                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    37490001
375000                 SET DP013-DB2-ABEND                              37500001
375100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           37510001
375200                 PERFORM DP013-0000-PROCESS-ABEND                 37520001
375300         END-EVALUATE                                             37530001
375400     END-PERFORM.                                                 37540001
375500                                                                  37550001
375600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        37560001
375700         MOVE '6130-GET-NEXT-TRIP '                               37570001
375800                                   TO DP013-PARAGRAPH             37580001
375900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              37590001
376000                                   TO DP013-MESSAGE-TEXT (1)      37600001
376100         MOVE 'TO SELECT A TVHTRIP ROW'                           37610001
376200                                   TO DP013-MESSAGE-TEXT (2)      37620001
376300         MOVE SQLCA                TO DP013-SQLCA                 37630001
376400         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    37640001
376500         SET DP013-DB2-ABEND                                      37650001
376600             DP013-XCTL-DISPLAY-RESTART                           37660001
376700                                   TO TRUE                        37670001
376800         PERFORM DP013-0000-PROCESS-ABEND                         37680001
376900     END-IF.                                                      37690001
377000                                                                  37700001
377100/                                                                 37710001
377200*----------------------------------------------------------------*37720001
377300*  GET THE LATEST TRIP ID                                        *37730001
377400*----------------------------------------------------------------*37740001
377500 6135-GET-MAX-TRIP-SEQ.                                           37750001
377600                                                                  37760001
377700     PERFORM                                                      37770001
377800         WITH TEST AFTER                                          37780001
377900         VARYING PV-RETRY-COUNTER                                 37790001
378000         FROM 1 BY 1                                              37800001
378100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               37810001
378200             OR (SQLCODE = +0)                                    37820001
378300             OR (SQLCODE = -305))                                 37830001
378400                                                                  37840001
378500         EXEC SQL                                                 37850001
378600             SELECT MAX(PLND_TRIP_SEQ)                            37860001
378700               INTO  :VHTRIP-PLND-TRIP-SEQ                        37870001
378800           FROM   TVHTRIP                                         37880001
378900           WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID               37890001
379000             AND  VEH_NBR       IS NOT NULL                       37900001
379100             AND  VEH_NBR       = :DK-VEH-NBR                     37910001
379200         END-EXEC                                                 37920001
379300                                                                  37930001
379400         EVALUATE TRUE                                            37940001
379500             WHEN SQLCODE = +0                                    37950001
379600                 ADD +1            TO VHTRIP-PLND-TRIP-SEQ        37960001
379700                                                                  37970001
379800             WHEN SQLCODE = -305                                  37980001
379900                 MOVE +1           TO VHTRIP-PLND-TRIP-SEQ        37990001
380000                                                                  38000001
380100             WHEN SQLCODE = -904                                  38010001
380200             WHEN SQLCODE = -913                                  38020001
380300                 CONTINUE                                         38030001
380400                                                                  38040001
380500             WHEN SQLWARN0 NOT = SPACES                           38050001
380600             WHEN SQLCODE < +0                                    38060001
380700             WHEN SQLCODE > +0                                    38070001
380800                 MOVE '6135-GET-MAX-TRIP-SEQ'                     38080001
380900                                   TO DP013-PARAGRAPH             38090001
381000                 MOVE 'SELECT A TVHTRIP ROW   '                   38100001
381100                                   TO DP013-MESSAGE-TEXT(1)       38110001
381200                 MOVE SQLCA        TO DP013-SQLCA                 38120001
381300                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    38130001
381400                 SET DP013-DB2-ABEND                              38140001
381500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           38150001
381600                 PERFORM DP013-0000-PROCESS-ABEND                 38160001
381700         END-EVALUATE                                             38170001
381800     END-PERFORM.                                                 38180001
381900                                                                  38190001
382000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        38200001
382100         MOVE '6135-GET-MAX-TRIP-SEQ'                             38210001
382200                                   TO DP013-PARAGRAPH             38220001
382300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              38230001
382400                                   TO DP013-MESSAGE-TEXT (1)      38240001
382500         MOVE 'TO SELECT A TVHTRIP ROW'                           38250001
382600                                   TO DP013-MESSAGE-TEXT (2)      38260001
382700         MOVE SQLCA                TO DP013-SQLCA                 38270001
382800         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    38280001
382900         SET DP013-DB2-ABEND                                      38290001
383000             DP013-XCTL-DISPLAY-RESTART                           38300001
383100                                   TO TRUE                        38310001
383200         PERFORM DP013-0000-PROCESS-ABEND                         38320001
383300     END-IF.                                                      38330001
383400/                                                                 38340001
383500*----------------------------------------------------------------*38350001
383600*  SELECT CURRENT TRIP STATUS ROW                                *38360001
383700*----------------------------------------------------------------*38370001
383800 6150-SELECT-TTRIPST.                                             38380001
383900                                                                  38390001
384000     PERFORM                                                      38400001
384100         WITH TEST AFTER                                          38410001
384200         VARYING PV-RETRY-COUNTER                                 38420001
384300         FROM 1 BY 1                                              38430001
384400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38440001
384500             OR (SQLCODE = +0))                                   38450001
384600                                                                  38460001
384700         EXEC SQL                                                 38470001
384800             SELECT  A.TRIP_ID                                    38480001
384900                    ,A.TRIP_STATUS_CDE                            38490001
385000                    ,A.STATUS_DTE                                 38500001
385100                    ,A.STATUS_TME                                 38510001
385200                    ,A.STATUS_UID                                 38520001
385300                    ,A.OPER_UNT_ID                                38530001
385400                    ,A.FCLTY_ID                                   38540001
385500                    ,A.FCLTY_AREA_ID                              38550001
385600              INTO   :TRIPST-TRIP-ID                              38560001
385700                    ,:TRIPST-TRIP-STATUS-CDE                      38570001
385800                    ,:TRIPST-STATUS-DTE                           38580001
385900                    ,:TRIPST-STATUS-TME                           38590001
386000                    ,:TRIPST-STATUS-UID                           38600001
386100                    ,:TRIPST-OPER-UNT-ID                          38610001
386200                    ,:TRIPST-FCLTY-ID                             38620001
386300                    ,:TRIPST-FCLTY-AREA-ID                        38630001
386400              FROM  TTRIPST A                                     38640001
386500                   ,TTRSTYP B                                     38650001
386600             WHERE  A.TRIP_ID          = :DK-TRIP-ID              38660001
386700               AND  A.TRIP_STATUS_CDE ^= 'DE'                     38670001
386800               AND  B.PRTY_CDE =                                  38680001
386900                  (SELECT MAX(D.PRTY_CDE)                         38690001
387000                     FROM TTRIPST C                               38700001
387100                         ,TTRSTYP D                               38710001
387200                    WHERE C.TRIP_ID         = A.TRIP_ID           38720001
387300                      AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  38730001
387400               AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE         38740001
387500         END-EXEC                                                 38750001
387600                                                                  38760001
387700         EVALUATE TRUE                                            38770001
387800             WHEN SQLCODE = +0                                    38780001
387900             WHEN SQLCODE = -904                                  38790001
388000             WHEN SQLCODE = -913                                  38800001
388100                 CONTINUE                                         38810001
388200                                                                  38820001
388300             WHEN SQLWARN0 NOT = SPACES                           38830001
388400             WHEN SQLCODE < +0                                    38840001
388500             WHEN SQLCODE > +0                                    38850001
388600                 MOVE '6150-SELECT-TTRIPST'                       38860001
388700                                   TO DP013-PARAGRAPH             38870001
388800                 MOVE 'SELECT A ROW ON TTRIPST'                   38880001
388900                                   TO DP013-MESSAGE-TEXT(1)       38890001
389000                 MOVE SQLCA        TO DP013-SQLCA                 38900001
389100                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    38910001
389200                 SET DP013-DB2-ABEND                              38920001
389300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           38930001
389400                 PERFORM DP013-0000-PROCESS-ABEND                 38940001
389500         END-EVALUATE                                             38950001
389600     END-PERFORM.                                                 38960001
389700                                                                  38970001
389800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        38980001
389900         MOVE '6150-INSERT-TTRIPST'                               38990001
390000                                   TO DP013-PARAGRAPH             39000001
390100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              39010001
390200                                   TO DP013-MESSAGE-TEXT (1)      39020001
390300         MOVE 'TO SELECT A TTRIPST ROW'                           39030001
390400                                   TO DP013-MESSAGE-TEXT (2)      39040001
390500         MOVE SQLCA                TO DP013-SQLCA                 39050001
390600         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    39060001
390700         SET DP013-DB2-ABEND                                      39070001
390800             DP013-XCTL-DISPLAY-RESTART                           39080001
390900                                   TO TRUE                        39090001
391000         PERFORM DP013-0000-PROCESS-ABEND                         39100001
391100     END-IF.                                                      39110001
391200                                                                  39120001
391300/                                                                 39130001
391400*----------------------------------------------------------------*39140001
391500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *39150001
391600*----------------------------------------------------------------*39160001
391700                                                                  39170001
391800 9100-READ-SEL-QUEUE.                                             39180001
391900     EXEC CICS                                                    39190001
392000         READQ TS                                                 39200001
392100             QUEUE (ASC-SEL-QUEUE-NAME)                           39210001
392200             INTO  (TR006-DOCK-SCHEDULE-REC)                      39220001
392300             ITEM  (ASC-SEL-ITEM)                                 39230001
392400             RESP  (PV-CICS-RESPONSE)                             39240001
392500     END-EXEC.                                                    39250001
392600                                                                  39260001
392700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   39270001
392800         CONTINUE                                                 39280001
392900     ELSE                                                         39290001
393000         SET DP013-LOGIC-ABEND                                    39300001
393100             DP013-NO-ROLLBACK     TO TRUE                        39310001
393200         MOVE '9100-READ-SEL-QUEUE'                               39320001
393300                                   TO DP013-PARAGRAPH             39330001
393400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   39340001
393500                                   TO DP013-MESSAGE-TEXT (1)      39350001
393600         PERFORM DP013-0000-PROCESS-ABEND                         39360001
393700     END-IF.                                                      39370001
393800                                                                  39380001
393900/                                                                 39390001
394000*----------------------------------------------------------------*39400001
394100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *39410001
394200*----------------------------------------------------------------*39420001
394300 9200-REWRITE-LIST-QUEUE.                                         39430001
394400                                                                  39440001
394500     EXEC CICS                                                    39450001
394600          WRITEQ TS                                               39460001
394700              QUEUE  (ASC-SEL-QUEUE-NAME)                         39470001
394800              FROM   (TR006-DOCK-SCHEDULE-REC)                    39480001
394900              ITEM   (ASC-SEL-ITEM)                               39490001
395000              RESP   (PV-CICS-RESPONSE)                           39500001
395100              REWRITE                                             39510001
395200     END-EXEC.                                                    39520001
395300                                                                  39530001
395400     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               39540001
395500         SET DP013-CICS-ABEND                                     39550001
395600             DP013-NO-ROLLBACK     TO TRUE                        39560001
395700         MOVE '9200-REWRITE-LIST-QUEUE'                           39570001
395800                                   TO DP013-PARAGRAPH             39580001
395900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   39590001
396000                                   TO DP013-MESSAGE-TEXT (1)      39600001
396100         PERFORM DP013-0000-PROCESS-ABEND                         39610001
396200     END-IF.                                                      39620001
396300                                                                  39630001
396400/                                                                 39640001
396500*----------------------------------------------------------------*39650001
396600*    ABEND PROCESSOR MODULE                                      *39660001
396700*----------------------------------------------------------------*39670001
396800                                                                  39680001
396900     COPY DPPD013.                                                39690001
