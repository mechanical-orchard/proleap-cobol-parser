000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - INVALID FAST NUMBER SCREEN'.                00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKRF857.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           JANUARY 2001.                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 DATA DIVISION.                                                   00110000
001200                                                                  00120000
001300 WORKING-STORAGE SECTION.                                         00130000
001400******************************************************************00140000
001500*                                                                 00150000
001600 01  DK-DB2-KEYS.                                                 00160000
001700     05  DK-FR-STR-NBR                PIC  S9(04) COMP            00170000
001800                                           VALUE ZERO.            00180000
001900     05  DK-XFER-SEQ-NBR              PIC  S9(08) COMP            00190000
002000                                           VALUE ZERO.            00200000
002100     05  DK-TRN-NBR                   PIC  S9(08) COMP            00210000
002200                                           VALUE ZERO.            00220000
002300                                                                  00230000
002400 01  PC-PROGRAM-CONSTANTS.                                        00240000
002500     05  PC-TRANID                       PIC  X(04)  VALUE 'E857'.00250000
002600                                                                  00260000
002700     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)  VALUE 'PCKRF857'. 00270000
002800                                                                  00280000
002900* ERROR MESSAGES                                                 *00290000
003000     05  PC-DB2-DATABASE-ERROR-MSG  PIC X(19) VALUE               00300000
003100                                           'DB2 ACCESS ERROR   '. 00310000
003200     05  PC-UNRECOGNIZED-PF-KEY-MSG PIC X(19) VALUE               00320000
003300                                           'UNRECOGNIZED PF KEY'. 00330000
003400     05  PC-ENTER-THROUGH-MENU-MSG  PIC X(19) VALUE               00340000
003500                                           'ENTER THROUGH MENU '. 00350000
003600     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00360000
003700                                           'TRANS NOT AVAILABLE'. 00370000
003800     05  PC-PLS-ENT-FLD-MSG         PIC X(19) VALUE               00380000
003900                                           'PLEASE ENTER FIELD '. 00390000
004000     05  PC-MUST-BE-NUM-MSG         PIC X(19) VALUE               00400000
004100                                           'MUST BE NUMERIC    '. 00410000
004200     05  PC-MUST-BE-GT-0-MSG        PIC X(19) VALUE               00420000
004300                                           'MUST BE > ZERO     '. 00430000
004400     05  PC-FIRST-1-NOT-0-MSG       PIC X(19) VALUE               00440000
004500                                           'FIRST DIGIT NOT 0  '. 00450000
004600     05  PC-TOO-MANY-DIGITS         PIC X(19) VALUE               00460000
004700                                           'TOO MANY DIGITS    '. 00470000
004800     05  PC-CICS-ERR-MSG            PIC X(19) VALUE               00480000
004900                                           'CICS ACCESS ERROR  '. 00490000
005000     05  PC-WRONG-FACILITY          PIC X(19) VALUE               00500000
005100                                           'WRG FCLTY - F2 CONF'. 00510000
005200     05  PC-MORE-DIGITS-REQD        PIC X(19) VALUE               00520000
005300                                           'MORE DIGITS REQUIRD'. 00530000
005400     05  PC-IGNORE-UPDATE-MSG       PIC X(19) VALUE               00540000
005500                                           'UPDATE NOT DONE    '. 00550000
005600                                                                  00560000
005700 01  PS-PROGRAM-SWITCHES.                                         00570000
005800     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.      00580000
005900         88  PS-ERRORS-YES                        VALUE 'Y'.      00590000
006000         88  PS-ERRORS-NO                         VALUE 'N'.      00600000
006100     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.      00610000
006200         88  PS-VALID-INPUT                       VALUE 'Y'.      00620000
006300         88  PS-INVALID-INPUT                     VALUE 'N'.      00630000
006400     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00640000
006500         88  PS-XCTL-E854                         VALUE 'E854'.   00650000
006600         88  PS-XCTL-E857                         VALUE 'E857'.   00660000
006700         88  PS-XCTL-E858                         VALUE 'E858'.   00670000
006800                                                                  00680000
006900*----------------------------------------------------------------*00690000
007000*  PROGRAM VARIABLES                                             *00700000
007100*----------------------------------------------------------------*00710000
007200 01  PV-PROGRAM-VARIABLES.                                        00720000
007300     05  PV-TMST                      PIC X(26).                  00730000
007400     05  PV-SUB                       PIC S9(4) COMP              00740000
007500                                                VALUE ZERO.       00750000
009700                                                                  00760000
009800     05  PV-NULL-IND                     PIC S9(4)   VALUE ZERO   00770000
009900                                                     COMP SYNC.   00780000
010000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00790000
010100                                                     COMP SYNC.   00800000
010200     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00810000
010300     05  PV-CICS-RESPONSE                PIC S9(09)  VALUE ZEROS  00820000
010400                                                     COMP SYNC.   00830000
010500     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00840000
010600 01  PV-LOG-MSG.                                                  00850000
010700     05  FILLER                       PIC X(12) VALUE             00860000
010800         ' E857 ERROR '.                                          00870000
010900     05  FILLER                       PIC X(09) VALUE             00880000
011000         'SQLCODE= '.                                             00890000
011100     05  PV-SQLCODE                   PIC -9(03).                 00900000
011200     05  FILLER                       PIC X(06) VALUE             00910000
011300         ' ERR= '.                                                00920000
011400     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00930000
011500     05  FILLER                       PIC X(07) VALUE             00940000
011600         ' FAST= '.                                               00950000
011700     05  PV-DISPLAY-FAST              PIC X(13) VALUE ZEROES.     00960002
011800     05  FILLER                       PIC X(05) VALUE             00970000
011900         ' PO= '.                                                 00980000
012000     05  PV-DISPLAY-PO                PIC 9(09) VALUE ZEROES.     00990000
012100     05  FILLER                       PIC X(07) VALUE             01000000
012200         ' RCVR= '.                                               01010000
012300     05  PV-DISPLAY-RCVR              PIC 9(04) VALUE ZEROES.     01020000
012400     05  FILLER                       PIC X(07) VALUE             01030000
012500         ' LINE= '.                                               01040000
012600     05  PV-DISPLAY-PO-LNE-NBR        PIC 9(04) VALUE ZEROES.     01050000
012700     05  FILLER                       PIC X(06) VALUE             01060000
012800         ' STR= '.                                                01070000
012900     05  PV-DISPLAY-STORE             PIC 9(04) VALUE ZEROES.     01080000
013000                                                                  01090000
013100 01  PV-EDITING-FIELDS.                                           01100000
013200                                                                  01110000
013300     05  PV-PROGRAM-DATA.                                         01120000
037800** AS PART OF THE PO EXPANSION PROJECT, COMMENTED OUT THE NEXT    01130003
037800** 7 LINES BECAUSE THEY ARE NEVER REFERENCED IN THE PROGRAM.      01140003
013400*        10  PV-PO                       PIC  X(07)  VALUE SPACE. 01150003
013500*        10  PV-PO-N REDEFINES PV-PO     PIC  ZZZZZZ9.            01160003
013600*                                                                 01170000
013700*        10  PV-PO-RCVR.                                          01180003
013800*            15 PV-PO-OUT                PIC  9(07).              01190003
013900*            15 FILLER                   PIC  X(01)  VALUE '-'.   01200003
014000*            15 PV-RCVR-OUT              PIC 9(03).               01210003
014100*                                                                 01220000
014200                                                                  01230000
014300         10  PV-PO-LINE-N                  PIC 9(09).             01240000
014400         10  PV-PO-LINE-X REDEFINES PV-PO-LINE-N.                 01250000
014500             15 FILLER                     PIC X(05).             01260000
014600             15 PV-PO-LINE-OUT             PIC X(04).             01270000
014700                                                                  01280000
014800         10  PV-PO-LINE-LBL.                                      01290000
014900             15  PV-LINE-LBL-1           PIC 9(01).               01300000
015000             15  PV-LINE-LBL-3           PIC 9(03).               01310000
015100                                                                  01320000
015200/                                                                 01330000
015300* COMMAREA FOR PCRF85X SCREENS                                    01340000
015400 01  CA-COMMAREA.                                                 01350000
015500     COPY PCWS033.                                                01360000
015600*  CHECK DIGIT WORK AREA                                          01370000
015700     COPY PCWS037.                                                01380000
015800*  MAP LAYOUT                                                     01390000
015900     COPY PCKM857.                                                01400000
016000                                                                  01410000
016100* HELP SCREEN COMMAREA                                            01420000
016200     COPY PCWS192.                                                01430000
016300* HELP SCREEN WORK AREA                                           01440000
016400     COPY PCWS188.                                                01450000
016500/                                                                 01460000
016600*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01470000
016700     COPY DPWS015.                                                01480000
016800                                                                  01490000
016900*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01500000
017000     COPY DFHAID.                                                 01510000
017100                                                                  01520000
017200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01530000
017300     COPY DPWS013.                                                01540000
017400/                                                                 01550000
017500     EXEC SQL                                                     01560000
017600         INCLUDE SQLCA                                            01570000
017700     END-EXEC.                                                    01580000
017800                                                                  01590000
017900 LINKAGE SECTION.                                                 01600000
018000 01  DFHCOMMAREA.                                                 01610000
018100     05  FILLER                         OCCURS  1 TO 4072 TIMES   01620000
018200                                      DEPENDING ON EIBCALEN.      01630000
018300         10  FILLER                   PIC X.                      01640000
018400/                                                                 01650000
018500 PROCEDURE DIVISION.                                              01660000
018600 0000-PROGRAM-MAINLINE.                                           01670000
018700                                                                  01680000
018800                                                                  01690000
018900     INITIALIZE CA-COMMAREA                                       01700000
019000     MOVE DFHCOMMAREA                 TO CA-COMMAREA.             01710000
019100                                                                  01720000
019200     EVALUATE TRUE                                                01730000
019300         WHEN EIBCALEN = ZERO                                     01740000
019400             MOVE PC-ENTER-THROUGH-MENU-MSG                       01750000
019500                                      TO PV-MESSAGE-AREA          01760000
019600             PERFORM 8110-RETURN                                  01770000
019700                                                                  01780000
019800         WHEN EIBTRNID = 'Z278'                                   01790000
019900             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01800000
020000             MOVE PC192-HOST-SAVE-AREA                            01810000
020100                                      TO CA-COMMAREA              01820000
020200             SET PC033-PROCESS-SCREEN TO TRUE                     01830000
020300             MOVE PC192-HOST-SAVE-MAP TO PC857AO                  01840000
020400             MOVE -1                  TO AFASTL                   01850000
020500             PERFORM 8000-SEND-MAP                                01860000
020600             PERFORM 8100-RETURN-TRANID                           01870000
020700                                                                  01880000
020800         WHEN PC033-INITIALIZE-SCREEN                             01890000
020900         WHEN EIBAID = DFHCLEAR                                   01900000
021000             PERFORM 1000-INITIALIZE                              01910000
021100             SET PC033-PROCESS-SCREEN TO TRUE                     01920000
021200             MOVE PC-CURRENT-PROGRAM-NAME                         01930000
021300                                      TO PC033-LAST-PROGRAM       01940000
021400             MOVE -1                  TO AFASTL                   01950000
021500             PERFORM 8000-SEND-MAP                                01960000
021600             PERFORM 8100-RETURN-TRANID                           01970000
021700                                                                  01980000
021800                                                                  01990000
021900         WHEN EIBAID = DFHPF3                                     02000000
022000             MOVE 'PCKRF853'          TO PV-TRANSFER-PROGRAM      02010000
022100             PERFORM 8200-XCTL                                    02020000
022200                                                                  02030000
022300         WHEN EIBAID = DFHENTER                                   02040000
022400             MOVE 'PCKRF854'          TO PV-TRANSFER-PROGRAM      02050000
022500             PERFORM 8200-XCTL                                    02060000
022600                                                                  02070000
022700                                                                  02080000
022800         WHEN EIBAID = DFHPF1                                     02090000
022900             PERFORM 8020-RECEIVE-MAP                             02100000
023000             MOVE PC857AO             TO PC192-HOST-SAVE-MAP      02110000
023100             PERFORM 1200-HELP-SCREEN                             02120000
023200                                                                  02130000
023300         WHEN OTHER                                               02140000
023400             MOVE -1                  TO AFASTL                   02150000
023500*            MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      02160000
023600*                                     TO AMSGLNO                  02170000
023700             PERFORM 8010-SEND-DATA-ONLY                          02180000
023800             PERFORM 8100-RETURN-TRANID                           02190000
023900     END-EVALUATE.                                                02200000
024000                                                                  02210000
024100     GOBACK.                                                      02220000
024200                                                                  02230000
024300 1000-INITIALIZE.                                                 02240000
024400                                                                  02250000
024500     MOVE PC-TRANID                   TO PC033-TRAN-ID            02260000
024600     PERFORM 1100-FORMAT-FAST-NBR.                                02270000
024700     EXEC SQL                                                     02280000
024800         SET :PV-TMST = CURRENT TIMESTAMP                         02290000
024900     END-EXEC.                                                    02300000
025000                                                                  02310000
025100 1100-FORMAT-FAST-NBR.                                            02320000
025200     IF PC033-FR-STR-NBR = ZERO                                   02330000
025300        AND PC033-XFER-SEQ-NBR = ZERO                             02340000
025400             MOVE 'UNKNOWN'           TO AFASTO                   02350000
025500     ELSE                                                         02360000
025600         MOVE PC033-FR-STR-NBR        TO                          02370000
025700                                         PC037-XFER-FROM-STORE-NBR02380000
025800         MOVE PC033-XFER-SEQ-NBR      TO PC037-XFER-SEQ-NBR       02390000
025900         PERFORM P0300-GET-CHK-DIGIT                              02400000
026000         STRING PC037-XFER-FROM-STORE-NBR '-'                     02410000
026100                        PC037-XFER-SEQ-NBR '-'                    02420000
026200                        PC037-CHK-DIGIT                           02430000
026300                        DELIMITED BY SIZE                         02440000
026400                                          INTO AFASTO             02450000
026500     END-IF.                                                      02460000
026600                                                                  02470000
026700 1200-HELP-SCREEN.                                                02480000
026800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02490000
026900     MOVE 'PCKRF857'                  TO PC192-PROGRAM-NAME       02500000
027000     COPY PCPD188.                                                02510000
027100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02520000
027200     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02530000
027300     PERFORM 8220-XCTL-TO-HELP.                                   02540000
027400                                                                  02550000
027500/                                                                 02560000
027600     COPY PCPD037.                                                02570000
027700/                                                                 02580000
027800 8000-SEND-MAP.                                                   02590000
027900                                                                  02600000
028000     EXEC CICS                                                    02610000
028100         SEND MAP       ('PC857A')                                02620000
028200              MAPSET    ('PCKM857')                               02630000
028300              ERASE                                               02640000
028400              CURSOR                                              02650000
028500              RESP      (PV-CICS-RESPONSE)                        02660000
028600     END-EXEC.                                                    02670000
028700                                                                  02680000
028800     EVALUATE TRUE                                                02690000
028900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02700000
029000             CONTINUE                                             02710000
029100         WHEN OTHER                                               02720000
029200             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          02730000
029300             MOVE 'PCKRF857 - UNABLE TO SEND MAP'                 02740000
029400                                      TO DP013-MESSAGE-TEXT (1)   02750000
029500             SET DP013-CICS-ABEND                                 02760000
029600                 DP013-ROLLBACK       TO TRUE                     02770000
029700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               02780000
029800     END-EVALUATE.                                                02790000
029900                                                                  02800000
030000 8010-SEND-DATA-ONLY.                                             02810000
030100                                                                  02820000
030200     MOVE -1                          TO AFASTL                   02830000
030300     EXEC CICS                                                    02840000
030400         SEND MAP       ('PC857A')                                02850000
030500              MAPSET    ('PCKM857')                               02860000
030600              CURSOR                                              02870000
030700              DATAONLY                                            02880000
030800              RESP      (PV-CICS-RESPONSE)                        02890000
030900     END-EXEC.                                                    02900000
031000                                                                  02910000
031100     EVALUATE TRUE                                                02920000
031200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02930000
031300             CONTINUE                                             02940000
031400         WHEN OTHER                                               02950000
031500             MOVE '8010-SEND-DATA-ONLY'                           02960000
031600                                      TO DP013-PARAGRAPH          02970000
031700             MOVE 'PCKRF857 - UNABLE TO SEND DATA'                02980000
031800                                      TO DP013-MESSAGE-TEXT (1)   02990000
031900             SET DP013-CICS-ABEND                                 03000000
032000                 DP013-ROLLBACK       TO TRUE                     03010000
032100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03020000
032200     END-EVALUATE.                                                03030000
032300                                                                  03040000
032400 8020-RECEIVE-MAP.                                                03050000
032500                                                                  03060000
032600     EXEC CICS                                                    03070000
032700         RECEIVE MAP    ('PC857A')                                03080000
032800                 MAPSET ('PCKM857')                               03090000
032900                 RESP   (PV-CICS-RESPONSE)                        03100000
033000     END-EXEC.                                                    03110000
033100                                                                  03120000
033200     EVALUATE TRUE                                                03130000
033300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03140000
033400             CONTINUE                                             03150000
033500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03160000
033600             CONTINUE                                             03170000
033700         WHEN OTHER                                               03180000
033800            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH       03190000
033900            MOVE 'PCKRF857 - UNABLE TO RECEIVE MAP'               03200000
034000                                         TO DP013-MESSAGE-TEXT (1)03210000
034100            SET DP013-LOGIC-ABEND        TO TRUE                  03220000
034200            SET DP013-ROLLBACK           TO TRUE                  03230000
034300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                03240000
034400     END-EVALUATE.                                                03250000
034500                                                                  03260000
034600 8100-RETURN-TRANID.                                              03270000
034700                                                                  03280000
034800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       03290000
034900     EXEC CICS                                                    03300000
035000         RETURN TRANSID  (PC-TRANID)                              03310000
035100                COMMAREA (CA-COMMAREA)                            03320000
035200                LENGTH   (PV-COMMAREA-LENGTH)                     03330000
035300                RESP     (PV-CICS-RESPONSE)                       03340000
035400     END-EXEC.                                                    03350000
035500                                                                  03360000
035600     EVALUATE TRUE                                                03370000
035700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03380000
035800             CONTINUE                                             03390000
035900         WHEN OTHER                                               03400000
036000             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH        03410000
036100             MOVE 'PCKRF857 - UNABLE TO RETURN TO TRANID'         03420000
036200                 TO DP013-MESSAGE-TEXT (1)                        03430000
036300             SET DP013-CICS-ABEND       TO TRUE                   03440000
036400             SET DP013-ROLLBACK         TO TRUE                   03450000
036500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03460000
036600     END-EVALUATE.                                                03470000
036700                                                                  03480000
036800 8110-RETURN.                                                     03490000
036900                                                                  03500000
037000     EXEC CICS                                                    03510000
037100         SEND FROM (PV-MESSAGE-AREA)                              03520000
037200              LENGTH (19)                                         03530000
037300              ERASE                                               03540000
037400     END-EXEC.                                                    03550000
037500                                                                  03560000
037600     EXEC CICS                                                    03570000
037700         RETURN                                                   03580000
037800     END-EXEC.                                                    03590000
037900                                                                  03600000
038000 8200-XCTL.                                                       03610000
038100     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    03620000
038200     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      03630000
038300     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       03640000
038400                                                                  03650000
038500     EXEC CICS                                                    03660000
038600         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    03670000
038700               COMMAREA  (CA-COMMAREA)                            03680000
038800               LENGTH    (PV-COMMAREA-LENGTH)                     03690000
038900               RESP      (PV-CICS-RESPONSE)                       03700000
039000     END-EXEC.                                                    03710000
039100                                                                  03720000
039200     EVALUATE TRUE                                                03730000
039300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03740000
039400             CONTINUE                                             03750000
039500         WHEN OTHER                                               03760000
039600             MOVE '8200-XCTL'                                     03770000
039700                                      TO DP013-PARAGRAPH          03780000
039800             MOVE 'PCKRF857 - UNABLE TO XCTL TO PROGRAM: '        03790000
039900                                      TO DP013-MESSAGE-TEXT (1)   03800000
040000             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   03810000
040100             SET DP013-CICS-ABEND                                 03820000
040200                 DP013-ROLLBACK       TO TRUE                     03830000
040300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03840000
040400*            MOVE PC-TRANS-UNAVAILABLE-MSG                        03850000
040500*                                     TO AMSGLNO                  03860000
040600             MOVE -1                  TO AFASTL                   03870000
040700             SET PC033-PROCESS-SCREEN TO TRUE                     03880000
040800             MOVE -1                  TO AFASTL                   03890000
040900             PERFORM 8000-SEND-MAP                                03900000
041000             PERFORM 8100-RETURN-TRANID                           03910000
041100     END-EVALUATE.                                                03920000
041200                                                                  03930000
041300*8210-XCTL-ERROR-SCREEN.                                          03940000
041400*    SET PC033-INITIALIZE-SCREEN      TO TRUE.                    03950000
041500*    MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      03960000
041600*    MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       03970000
041700*    MOVE 'PCKRF852'                  TO PV-TRANSFER-PROGRAM      03980000
041800*    IF PC033-PGM-MSG-NBR = ZERO                                  03990000
041900*        MOVE 3                       TO PC033-PGM-MSG-NBR        04000000
042000*    END-IF                                                       04010000
042100*                                                                 04020000
042200*    EXEC CICS                                                    04030000
042300*        XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    04040000
042400*              COMMAREA  (CA-COMMAREA)                            04050000
042500*              LENGTH    (PV-COMMAREA-LENGTH)                     04060000
042600*              RESP      (PV-CICS-RESPONSE)                       04070000
042700*    END-EXEC.                                                    04080000
042800*                                                                 04090000
042900*    EVALUATE TRUE                                                04100000
043000*        WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04110000
043100*            CONTINUE                                             04120000
043200*        WHEN OTHER                                               04130000
043300*            MOVE '8200-XCTL'                                     04140000
043400*                                     TO DP013-PARAGRAPH          04150000
043500*            MOVE 'PCKRF857 - UNABLE TO XCTL TO PROGRAM: '        04160000
043600*                                     TO DP013-MESSAGE-TEXT (1)   04170000
043700*            MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   04180000
043800*            SET DP013-CICS-ABEND                                 04190000
043900*                DP013-ROLLBACK       TO TRUE                     04200000
044000*            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04210000
044100*            MOVE PC-TRANS-UNAVAILABLE-MSG                        04220000
044200*                                     TO AMSGLNO                  04230000
044300*            SET PC033-PROCESS-SCREEN TO TRUE                     04240000
044400*            MOVE -1                  TO AFASTL                   04250000
044500*            PERFORM 8000-SEND-MAP                                04260000
044600*            PERFORM 8100-RETURN-TRANID                           04270000
044700*    END-EVALUATE.                                                04280000
044800                                                                  04290000
044900*                                                                 04300000
045000 8220-XCTL-TO-HELP.                                               04310000
045100                                                                  04320000
045200     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       04330000
045300                                                                  04340000
045400     EXEC CICS                                                    04350000
045500         XCTL                                                     04360000
045600             PROGRAM   (PV-TRANSFER-PROGRAM)                      04370000
045700             COMMAREA  (PC192-COMMAREA)                           04380000
045800             LENGTH    (PV-COMMAREA-LENGTH)                       04390000
045900             RESP      (PV-CICS-RESPONSE)                         04400000
046000     END-EXEC.                                                    04410000
046100                                                                  04420000
046200     EVALUATE TRUE                                                04430000
046300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04440000
046400              CONTINUE                                            04450000
046500         WHEN OTHER                                               04460000
046600             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          04470000
046700             MOVE 'PCKRF857 - UNABLE TO XCTL TO PROGRAM: '        04480000
046800                                      TO DP013-MESSAGE-TEXT (1)   04490000
046900             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   04500000
047000             SET DP013-CICS-ABEND                                 04510000
047100                 DP013-ROLLBACK       TO TRUE                     04520000
047200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04530000
047300*            MOVE PC-TRANS-UNAVAILABLE-MSG                        04540000
047400*                                     TO AMSGLNO                  04550000
047500             SET PC033-PROCESS-SCREEN TO TRUE                     04560000
047600             MOVE -1                  TO AFASTL                   04570000
047700             PERFORM 8000-SEND-MAP                                04580000
047800             PERFORM 8100-RETURN-TRANID                           04590000
047900     END-EVALUATE.                                                04600000
048000*                                                                 04610000
048100 8230-XCTL-TO-E854.                                               04620000
048200                                                                  04630000
048300     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    04640000
048400     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      04650000
048500     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       04660000
048600     MOVE 'PCKRF854'                  TO PV-TRANSFER-PROGRAM      04670000
048700                                                                  04680000
048800     EXEC CICS                                                    04690000
048900         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    04700000
049000               COMMAREA  (CA-COMMAREA)                            04710000
049100               LENGTH    (PV-COMMAREA-LENGTH)                     04720000
049200               RESP      (PV-CICS-RESPONSE)                       04730000
049300     END-EXEC.                                                    04740000
049400                                                                  04750000
049500     EVALUATE TRUE                                                04760000
049600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04770000
049700             CONTINUE                                             04780000
049800         WHEN OTHER                                               04790000
049900             MOVE '8230-XCTL-TO-E854'                             04800000
050000                                      TO DP013-PARAGRAPH          04810000
050100             MOVE 'PCKRF857 - UNABLE TO XCTL TO PROGRAM: '        04820000
050200                                      TO DP013-MESSAGE-TEXT (1)   04830000
050300             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   04840000
050400             SET DP013-CICS-ABEND                                 04850000
050500                 DP013-ROLLBACK       TO TRUE                     04860000
050600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04870000
050700*            MOVE PC-TRANS-UNAVAILABLE-MSG                        04880000
050800*                                     TO AMSGLNO                  04890000
050900             MOVE -1                  TO AFASTL                   04900000
051000             SET PC033-PROCESS-SCREEN TO TRUE                     04910000
051100             PERFORM 8000-SEND-MAP                                04920000
051200             PERFORM 8100-RETURN-TRANID                           04930000
051300     END-EVALUATE.                                                04940000
051400/                                                                 04950000
051500 9000-SOFT-ABORT.                                                 04960000
051600                                                                  04970000
051700     EXEC CICS                                                    04980000
051800         SYNCPOINT ROLLBACK                                       04990000
051900     END-EXEC                                                     05000000
052000                                                                  05010000
052100*    MOVE 'DB2 ACCESS ERROR'          TO AMSGLNO.                 05020000
052200     PERFORM 8010-SEND-DATA-ONLY                                  05030000
052300     PERFORM 8100-RETURN-TRANID.                                  05040000
052400                                                                  05050000
052500 9903-WRITE-CICS-LOG.                                             05060000
052600                                                                  05070000
052700     MOVE SQLCODE                     TO PV-SQLCODE               05080000
052800     STRING PC033-FR-STR-NBR '-'                                  05090000
052900            PC033-XFER-SEQ-NBR '-'                                05100000
053000            PC037-FAST-CHECK-DIGIT DELIMITED BY SIZE              05110000
053100                                      INTO PV-DISPLAY-FAST        05120000
053200     MOVE PC033-PO-NBR                TO PV-DISPLAY-PO            05130000
053300     MOVE PC033-RCVR-SEQ-NBR          TO PV-DISPLAY-RCVR          05140000
053400     MOVE PC033-PO-LINE-NBR           TO PV-DISPLAY-PO-LNE-NBR    05150000
053500     MOVE PC033-STR-NBR               TO PV-DISPLAY-STORE         05160000
053600                                                                  05170000
053700     EXEC CICS                                                    05180000
053800         WRITEQ TD                                                05190000
053900             QUEUE  ('CSSL')                                      05200000
054000             FROM   (PV-LOG-MSG)                                  05210000
054100             RESP   (PV-CICS-RESPONSE)                            05220000
054200     END-EXEC.                                                    05230000
054300                                                                  05240000
054400 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  05250000
054500                                                                  05260000
054600     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           05270000
054700     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          05280000
054800     INITIALIZE DP013-SRC-TASK-NUMBER                             05290000
054900                DP013-STACK.                                      05300000
055000     SET DP013-LINK-RETURN            TO TRUE.                    05310000
055100                                                                  05320000
055200     EXEC CICS                                                    05330000
055300         LINK                                                     05340000
055400             PROGRAM   (DP013-NAME)                               05350000
055500             COMMAREA  (DP013-PARAMETERS)                         05360000
055600             LENGTH    (DP013-LENGTH)                             05370000
055700     END-EXEC.                                                    05380000
055800                                                                  05390000
055900*----------------------------------------------------------------*05400000
056000*    ABEND PROCESSOR MODULE                                      *05410000
056100*----------------------------------------------------------------*05420000
056200                                                                  05430000
056300     COPY DPPD014.                                                05440000
056400                                                                  05450000
