000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS128.                                         00040000
000500 AUTHOR.        RYAN STAUFFACHER.                                 00050004
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  10/01.                                            00070004
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    W128 - IMPORT ORDER TRACKING                                *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO VIEW IMPORT INFORMATION     *00120000
001300*    FOR A PURCHASE ORDER IN INQUIRY ONLY.                       *00130000
001400*----------------------------------------------------------------*00140000
002200* 10/01/01 TKMA609  THIS PROGRAM IS A CLONE OF POKCS088.         *00150000
002300*                   POKCS088 DISPLAYS DC'S 85, 810, AND 830.     *00160000
      *                   THIS PROGRAM DISPLAYS 840, 860, AND 865.     *00170000
002400*                   POKCS107 DISPLAYS DC 870 AND TOTALS.         *00180000
002400*                   TOTALS ARE SHOWN ON POKCS107.                *00190000
002400*                   COPYBOOK POWS017 IS USED TO PASS THE         *00200000
      *                   UNITS VERIFIED TOTALS TO POKCS107 SO THE     *00210000
      *                   TOTAL OF ALL DC'S CAN BE SHOWN.              *00220004
002500******************************************************************00230000
002200* 08/08/02 TKMA609  CHANGED PROGRAM TO DISPLAY DC 855 INSTEAD OF *00240007
002300*                   865.  MOVED DISPLAY OF 865 TO POKCS107       *00250007
002500******************************************************************00260007
C98147* 11/21/14 TKMA394  LINDA FRIESS              - CHG0098147        00270009
C98147*   - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA          00280009
C98147*   - REMOVED UNUSED FIELDS & LOGIC FROM PARAGRAPH 4000           00290009
C98147******************************************************************00300009
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485        00310012
CICS  *                                                                 00311011
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00312011
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00313011
CICS  ******************************************************************00313111
001500                                                                  00314011
001500                                                                  00315011
001600 ENVIRONMENT DIVISION.                                            00320000
001700 DATA DIVISION.                                                   00330000
001800 WORKING-STORAGE SECTION.                                         00340000
001900                                                                  00350000
002000 01  DK-DB2-KEYS.                                                 00360000
002100     05  DK-PO-NBR                PIC S9(09) VALUE +0 COMP.       00370000
002200                                                                  00380000
002300 01  PC-PROGRAM-CONSTANTS.                                        00390000
002310     05  PC-PCT                         PIC  X(01)  VALUE '%'.    00400000
002400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS128'.  00410002
002500     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO128A  '.  00420002
002600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM128 '.  00430002
002700     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00440000
002800                                              COMP.               00450000
002900     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00460000
003000                                              COMP.               00470000
003100     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +1000000      00480000
003200                                              COMP-3.             00490000
003300     05  PC-TSYMSG-NUMBERS.                                       00500000
003410         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.       00510000
003420         10  PC-TSYMSG-00726      PIC  9(05)  VALUE  00726.       00520000
003440 01  PS-PROGRAM-SWITCHES.                                         00530000
003450     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00540000
003460         88  PS-ERROR                         VALUE  'Y'.         00550000
003470         88  PS-NO-ERROR                      VALUE  'N'.         00560000
003471     05  PS-VSORAIR-SW            PIC  X(01)  VALUE  'Y'.         00570000
003473         88  PS-ALL-VSORAIR                   VALUE  'Y'.         00580000
003474         88  PS-NOT-ALL-VSORAIR               VALUE  'N'.         00590000
003480*                                                                 00600000
003490 01  PV-PROGRAM-VARIABLES.                                        00610000
003493     05  PV-TOT-REC-PCT                 PIC S9(03)V99             00620000
003494                                                     COMP-3.      00630000
003495    05  PV-NORMAL-TOTALS.                                         00640000
003501        10  PV-TOTREC1PCT-X.                                      00650000
003502           15 PV-TREC-PCT1                  PIC  ZZ9.             00660000
003503           15 PV-TREC-PCT1-SIGN             PIC  X(01).           00670000
003504        10  FILLER                          PIC X(08).            00680000
003505        10  PV-TOTREC2PCT-X.                                      00690000
003506           15 PV-TREC-PCT2                  PIC  ZZ9.             00700000
003507           15 PV-TREC-PCT2-SIGN             PIC  X(01).           00710000
003508        10  FILLER                          PIC X(08).            00720000
003505        10  PV-TOTREC3PCT-X.                                      00730000
003506           15 PV-TREC-PCT3                  PIC  ZZ9.             00740000
003507           15 PV-TREC-PCT3-SIGN             PIC  X(01).           00750000
003508        10  FILLER                          PIC X(08).            00760000
003513        10  PV-TOTRECPCT-X.                                       00770000
003514           15 PV-TREC-PCT                   PIC  ZZ9.             00780000
003515           15 PV-TREC-PCT-SIGN              PIC  X(01).           00790000
003516     05  PV-DC-REC-QTY                  PIC S9(09)   VALUE +0     00800000
003517                                                     COMP.        00810000
003518     05  PV-QTY-NULL                    PIC S9(04)   VALUE +0     00820000
003519                                                     COMP.        00830000
003530     05  PV-OTB                         PIC X(06)    VALUE SPACES.00840000
003600     05  PV-OTB-RED REDEFINES PV-OTB.                             00850000
003700         10 PV-OTB-CC                   PIC X(02).                00860000
003710         10 PV-OTB-YY                   PIC X(02).                00870000
003800         10 PV-OTB-MM                   PIC X(02).                00880000
003910     05  PV-OTB2                        PIC X(06)    VALUE SPACES.00890000
004000     05  PV-OTB-RED2 REDEFINES PV-OTB2.                           00900000
004100         10 PV-OTB-MM2                  PIC X(02).                00910000
004200         10 PV-OTB-YY2                  PIC X(02).                00920000
004201         10 PV-OTB-CC2                  PIC X(02).                00930000
004206     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00940000
004207                                              COMP SYNC.          00950000
004208     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00960000
004209                                              COMP SYNC.          00970000
004210     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            00980000
004211                                              COMP-3.             00990000
004220     05  PV-OPER-UNT-ID           PIC  S9(4)  COMP.               01000000
004230     05  PV-MAX-STATUS-DTE        PIC  X(10).                     01010000
004240     05  PV-MIN-STATUS-DTE        PIC  X(10).                     01020000
004241     05  PV-MAX-VERIFD-DTE        PIC  X(10).                     01030000
004242     05  PV-MIN-VERIFD-DTE        PIC  X(10).                     01040000
004250     05  PV-SHIPST-ETA-DATE       PIC  X(10).                     01050000
004260     05  PV-DATE-BREAK.                                           01060000
004270         10  FILLER               PIC  X(02).                     01070000
004280         10  PV-DB-YY             PIC  X(02).                     01080000
004290         10  FILLER               PIC  X(01).                     01090000
004300         10  PV-DB-MM             PIC  X(02).                     01100000
004400         10  FILLER               PIC  X(01).                     01110000
004500         10  PV-DB-DD             PIC  X(02).                     01120000
004600     05  PV-DATE-DISPLAY.                                         01130000
004700         10  PV-DD-MM             PIC  X(02).                     01140000
004800         10  FILLER               PIC  X(01) VALUE '/'.           01150000
004900         10  PV-DD-DD             PIC  X(02).                     01160000
005000         10  FILLER               PIC  X(01) VALUE '/'.           01170000
005100         10  PV-DD-YY             PIC  X(02).                     01180000
005200                                                                  01190000
005300*----------------------------------------------------------------*01200000
005400*    MAP LAYOUT                                                  *01210000
005500*----------------------------------------------------------------*01220000
005600     COPY POKM128.                                                01230001
005610 01  MR-OCCURS-LAYOUT                   REDEFINES  PO128AO.       01240002
C98147     05  FILLER                         PIC X(531).               01250010
005633     05  MR-TOTAL-LINEL                 PIC S9(04) COMP.          01260000
005634     05  MR-TOTAL-LINEA                 PIC  X(01).               01270000
005635     05  MR-TOTAL-LINEC                 PIC  X(01).               01280000
005636     05  MR-TOTAL-LINEH                 PIC  X(01).               01290000
005640     05  MR-TOTAL-LINE                  PIC  X(40).               01300000
005720*----------------------------------------------------------------*01310000
005800*    ATTRIBUTE SETTINGS COPYBOOK.                                *01320000
005900*----------------------------------------------------------------*01330000
006000     COPY DPWS015.                                                01340000
006100*----------------------------------------------------------------*01350000
006200*    FUNCTION KEYS COPYBOOK                                      *01360000
006300*----------------------------------------------------------------*01370000
006400                                                                  01380000
006500     COPY DPWS016.                                                01390000
006600 EJECT                                                            01400000
006700                                                                  01410000
006800**--------------------------------------------------------------**01420000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **01430011
007000**--------------------------------------------------------------**01440000
007100     COPY DPWS030.                                                01450000
CICS       COPY DPWS930.                                                01451011
007200 EJECT                                                            01460000
007300                                                                  01470000
007400**--------------------------------------------------------------**01480000
007500*    STANDARD COMMAREA.                                           01490000
007600**--------------------------------------------------------------**01500000
007700                                                                  01510000
007800     COPY DPWS020.                                                01520000
007900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01530000
008000                                                                  01540000
008100***************************************************************** 01550000
008200*    INTER-APPLICATION COMMAREA.                                  01560000
008300***************************************************************** 01570000
008400                                                                  01580000
008500         10  INTER-APPL-COMM-AREA PIC X(200).                     01590000
008600     COPY POWS017.                                                01600000
008610     COPY TRWS105.                                                01610000
008700***************************************************************** 01620000
008800*    SPECIFIC COMMMAREA FOR POKCS128.                             01630002
008900***************************************************************** 01640000
009000         10  ASC-SPECIFIC-COMMAREA.                               01650000
009100           15 ASC-SCREEN-FIELDS.                                  01660000
009200             20  ASC-KEY-PO-NUMBER         PIC S9(09) COMP.       01670000
C98147             20  ASC-PO-NBR                PIC  9(08).            01680009
009400             20  ASC-STRT-FCTRY-DTE        PIC  X(10).            01690000
009500             20  ASC-SHIP-DATE             PIC  X(08).            01700000
009600             20  ASC-OTB                   PIC  X(04).            01710000
009700             20  ASC-LAST-FCTRY-DTE        PIC  X(10).            01720000
009800             20  ASC-CANCEL-DATE           PIC  X(08).            01730000
009900             20  ASC-FOB-POINT             PIC  X(30).            01740000
010000             20  ASC-VENDOR                PIC  X(30).            01750000
010100             20  ASC-DEPT                  PIC  X(03).            01760000
010200             20  ASC-DC1                   PIC  X(10).            01770000
010300             20  ASC-DC2                   PIC  X(10).            01780000
010400             20  ASC-DC3                   PIC  X(10).            01790000
010500             20  ASC-DECON-DATE1           PIC  X(08).            01800000
010600             20  ASC-DECON-DATE2           PIC  X(08).            01810000
010700             20  ASC-DECON-DATE3           PIC  X(08).            01820000
010800             20  ASC-DC-DEL-DATE1          PIC  X(08).            01830000
010900             20  ASC-DC-DEL-DATE2          PIC  X(08).            01840000
011000             20  ASC-DC-DEL-DATE3          PIC  X(08).            01850000
011100             20  ASC-FST-RCPT-DT1          PIC  X(08).            01860000
011200             20  ASC-FST-RCPT-DT2          PIC  X(08).            01870000
011300             20  ASC-FST-RCPT-DT3          PIC  X(08).            01880000
011400             20  ASC-LST-RCPT-DT1          PIC  X(08).            01890000
011500             20  ASC-LST-RCPT-DT2          PIC  X(08).            01900000
011600             20  ASC-LST-RCPT-DT3          PIC  X(08).            01910000
011610             20  ASC-FST-VFD-DT1           PIC  X(08).            01920000
011620             20  ASC-FST-VFD-DT2           PIC  X(08).            01930000
011630             20  ASC-FST-VFD-DT3           PIC  X(08).            01940000
011640             20  ASC-LST-VFD-DT1           PIC  X(08).            01950000
011650             20  ASC-LST-VFD-DT2           PIC  X(08).            01960000
011660             20  ASC-LST-VFD-DT3           PIC  X(08).            01970000
011670             20  ASC-UNT-ORD1              PIC  S9(09) COMP-3.    01980000
011680             20  ASC-UNT-ORD2              PIC  S9(09) COMP-3.    01990000
011690             20  ASC-UNT-ORD3              PIC  S9(09) COMP-3.    02000000
011691             20  ASC-TOT-ORD               PIC  S9(09) COMP-3.    02010000
011692             20  ASC-UNT-VFD1              PIC  S9(09) COMP-3.    02020000
011693             20  ASC-UNT-VFD1-C            PIC  X(1).             02030000
011694             20  ASC-UNT-VFD2              PIC  S9(09) COMP-3.    02040000
011695             20  ASC-UNT-VFD2-C            PIC  X(1).             02050000
011696             20  ASC-UNT-VFD3              PIC  S9(09) COMP-3.    02060000
011697             20  ASC-UNT-VFD3-C            PIC  X(1).             02070000
011698             20  ASC-TOT-VFD               PIC  S9(09) COMP-3.    02080000
                   20  ASC-PREV-DC-TOT-VFD       PIC  S9(09) COMP-3.    02090005
011699             20  ASC-PCT-RCD1              PIC  X(4).             02100000
011700             20  FILLER REDEFINES ASC-PCT-RCD1.                   02110000
011701                 25  ASC-PCT-RCD1-N        PIC  9(03).            02120000
011702                 25  ASC-PCT-RCD1-SIGN     PIC  X(01).            02130000
011703             20  ASC-PCT-RCD2              PIC  X(4).             02140000
011710             20  FILLER REDEFINES ASC-PCT-RCD2.                   02150000
011711                 25  ASC-PCT-RCD2-N        PIC  9(03).            02160000
011712                 25  ASC-PCT-RCD2-SIGN     PIC  X(01).            02170000
011714             20  ASC-PCT-RCD3              PIC  X(4).             02180000
011715             20  FILLER REDEFINES ASC-PCT-RCD3.                   02190000
011716                 25  ASC-PCT-RCD3-N        PIC  9(03).            02200000
011717                 25  ASC-PCT-RCD3-SIGN     PIC  X(01).            02210000
011719             20  ASC-TOT-PCT-RCD           PIC  X(4).             02220000
011720             20  FILLER REDEFINES ASC-TOT-PCT-RCD.                02230000
011721                 25  ASC-TOT-PCT-RCD-N     PIC  9(03).            02240000
011722                 25  ASC-TOT-PCT-RCD-SIGN  PIC  X(01).            02250000
011730                                                                  02260000
011800             15  ASC-ITEMS-LEFT-INDICATOR  PIC  X(01).            02270000
011900                 88 ASC-ITEMS-LEFT-ON-DB    VALUE 'Y'.            02280000
012000                 88 ASC-NO-ITEMS-LEFT-ON-DB VALUE 'N'.            02290000
012100             15  ASC-NUMBER-OF-ITEMS-READ  PIC S9(09)             02300000
012200                                               COMP-3.            02310000
012300                                                                  02320000
012400*----------------------------------------------------------------*02330000
012500*    ABEND PROCESSING COPYBOOK.                                  *02340000
012600*----------------------------------------------------------------*02350000
012700                                                                  02360000
012800     COPY DPWS013.                                                02370000
012900                                                                  02380000
013000*----------------------------------------------------------------*02390000
013100*    DB2 AREA FOR PURCHASE ORDER                                 *02400000
013200*----------------------------------------------------------------*02410000
013300     EXEC SQL                                                     02420000
013400          INCLUDE TPURCHS                                         02430000
013500     END-EXEC.                                                    02440000
013501     EXEC SQL                                                     02450000
013502          INCLUDE TENTNME                                         02460000
013503     END-EXEC.                                                    02470000
013504*----------------------------------------------------------------*02480000
013505*    DB2 AREA FOR PURCHASE LINE ITEM TABLE                       *02490000
013506*----------------------------------------------------------------*02500000
013507     EXEC SQL                                                     02510000
013508          INCLUDE TPURITM                                         02520000
013509     END-EXEC.                                                    02530000
013510*----------------------------------------------------------------*02540000
013511*    DB2 AREA FOR DC SPLIT QUANTITIES TABLE                      *02550000
013512*----------------------------------------------------------------*02560000
013513     EXEC SQL                                                     02570000
013514          INCLUDE TALLPLN                                         02580000
013515     END-EXEC.                                                    02590000
013516*----------------------------------------------------------------*02600000
013520*    DB2 AREA FOR RECEIPTS TABLE                                 *02610000
013530*----------------------------------------------------------------*02620000
013540     EXEC SQL                                                     02630000
013550          INCLUDE TRECEIV                                         02640000
013560     END-EXEC.                                                    02650000
013570     EXEC SQL                                                     02660000
013580          INCLUDE TRECITM                                         02670000
013590     END-EXEC.                                                    02680000
013591     EXEC SQL                                                     02690000
013592          INCLUDE TRECDIS                                         02700000
013593     END-EXEC.                                                    02710000
013600*----------------------------------------------------------------*02720000
013700*    DB2 AREA FOR TRIP STATUS TABLE                              *02730000
013800*----------------------------------------------------------------*02740000
013900     EXEC SQL                                                     02750000
014000          INCLUDE TTRIPST                                         02760000
014100     END-EXEC.                                                    02770000
014200*----------------------------------------------------------------*02780000
014300*    DB2 AREA FOR LOCATION TABLE                                 *02790008
014400*----------------------------------------------------------------*02800000
014500     EXEC SQL                                                     02810000
014600          INCLUDE XMT00001                                        02820008
014700     END-EXEC.                                                    02830000
014800*----------------------------------------------------------------*02840000
014900*    DB2 AREA FOR SHIPMENTS                                      *02850000
015000*----------------------------------------------------------------*02860000
015100     EXEC SQL                                                     02870000
015200          INCLUDE TSHIPMT                                         02880000
015300     END-EXEC.                                                    02890000
015400*----------------------------------------------------------------*02900000
015500*    DB2 AREA FOR SHIPMENTS BY PO                                *02910000
015600*----------------------------------------------------------------*02920000
015700     EXEC SQL                                                     02930000
015800          INCLUDE TSHPTPO                                         02940000
015900     END-EXEC.                                                    02950000
016330*----------------------------------------------------------------*02960000
016340*    DB2 AREA FOR VEHICLES PER TRIP                              *02970000
016350*----------------------------------------------------------------*02980000
016360     EXEC SQL                                                     02990000
016370          INCLUDE TVEHICL                                         03000000
016380     END-EXEC.                                                    03010000
016390*----------------------------------------------------------------*03020000
016400*    DB2 AREA FOR SHIPMENT STATUSES                              *03030000
016401*----------------------------------------------------------------*03040000
016402     EXEC SQL                                                     03050000
016403          INCLUDE TSHIPST                                         03060000
016404     END-EXEC.                                                    03070000
016405*----------------------------------------------------------------*03080000
016406*    DB2 AREA FOR PLANNED SHIPMENTS                              *03090000
016407*----------------------------------------------------------------*03100000
016408     EXEC SQL                                                     03110000
016409          INCLUDE TPLNSHP                                         03120000
016410     END-EXEC.                                                    03130000
016420*----------------------------------------------------------------*03140000
016430*    DB2 AREA FOR THE FREE ON BOARD TABLE                        *03150000
016440*----------------------------------------------------------------*03160000
016450     EXEC SQL                                                     03170000
016460          INCLUDE TIMFOB                                          03180000
016470     END-EXEC.                                                    03190000
016480*----------------------------------------------------------------*03200000
016490*    DB2 AREA FOR COMMUNICATIONS                                 *03210000
016500*----------------------------------------------------------------*03220000
016600     EXEC SQL                                                     03230000
016700          INCLUDE SQLCA                                           03240000
016800     END-EXEC.                                                    03250000
016900                                                                  03260000
017000                                                                  03270000
017100* THIS CURSOR WILL PULL BACK ALL THE SHIPMENTS FOR A GIVEN PO     03280000
017200     EXEC SQL                                                     03290000
017300       DECLARE SHIPMT-CSR CURSOR                                  03300000
017400          FOR SELECT DISTINCT                                     03310000
017500               A.SHIPT_ID,                                        03320000
017600               A.TRIP_ID,                                         03330000
017700               E.OPER_UNT_ID                                      03340000
017800          FROM TSHIPMT A,                                         03350000
017900               TSHPTPO B,                                         03360000
018000               TTRIPST E                                          03370000
018100          WHERE B.PO_NBR   =:ASC-KEY-PO-NUMBER                    03380000
018200            AND A.SHIPT_ID = B.SHIPT_ID                           03390000
018300            AND E.TRIP_ID = A.TRIP_ID                             03400000
018500          ORDER BY E.OPER_UNT_ID                                  03410000
018600          FOR FETCH ONLY                                          03420000
018700     END-EXEC.                                                    03430000
018800                                                                  03440000
018900 LINKAGE SECTION.                                                 03450000
019000                                                                  03460000
019100 01  DFHCOMMAREA.                                                 03470000
019200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03480000
019300                                        DEPENDING ON EIBCALEN.    03490000
019400         10  FILLER                     PIC X.                    03500000
019500                                                                  03510000
019600                                                                  03520000
019700 PROCEDURE DIVISION.                                              03530000
019800***************************************************************** 03540000
019900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03550000
020000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03560000
020100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03570000
020200**                                                             ** 03580000
020300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03590000
020400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03600000
020500***************************************************************** 03610000
020600 0000-MAIN-MODULE.                                                03620000
020700     INITIALIZE DP030-CICS-API-FIELDS.                            03630000
020800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03640000
020900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03650000
021000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03660000
021100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03670000
021200     MOVE LENGTH OF PO128AI        TO DP030-MAP-LENGTH (1).       03680002
021300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03690000
021400     PERFORM 0001-CALL-CICS-ARCH-API.                             03700000
021500     PERFORM 1000-CONTROL-PROCESSING                              03710000
021600*                                                                 03720000
021700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03730000
021800     PERFORM 0001-CALL-CICS-ARCH-API.                             03740000
021900                                                                  03750000
022000 0001-CALL-CICS-ARCH-API.                                         03760000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03770011
022200                                    DFHCOMMAREA                   03780011
022300                                    DP030-CICS-API-FIELDS         03790011
022400                                    DP020-STANDARD-COMMAREA       03800011
022500                                    PO128AI.                      03810011
022600*                                                                 03820000
022700     IF  DP030-RC-CALL-SUCCESSFUL                                 03830000
022800         CONTINUE                                                 03840000
022900     ELSE                                                         03850000
023000         SET DP013-NO-ROLLBACK                                    03860000
023100             DP013-XCTL-DISPLAY-RESTART                           03870000
023200             DP013-CICS-ABEND      TO TRUE                        03880000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           03890011
023400                                   TO DP013-PARAGRAPH             03900000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03910011
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03920011
023700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03930000
023800         PERFORM DP013-0000-PROCESS-ABEND                         03940000
023900     END-IF.                                                      03950000
024000 EJECT                                                            03960000
024100                                                                  03970000
024200*----------------------------------------------------------------*03980000
024300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03990000
024400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04000000
024500*----------------------------------------------------------------*04010000
024600 1000-CONTROL-PROCESSING.                                         04020000
024700                                                                  04030000
024800     EVALUATE TRUE                                                04040000
024900         WHEN DP020-NEXT-ACT-INITIAL                              04050000
025000             PERFORM 1100-FIND-OBJECT-KEYS                        04060000
025100             PERFORM 4120-GET-PO-TYP                              04070000
025311             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04080000
025312             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04090000
025320             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04100000
025330             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04110000
                   MOVE PO017-TOTVFD TO ASC-PREV-DC-TOT-VFD             04120005
025340             IF PS-ALL-VSORAIR                                    04130000
025350                 MOVE DP016-PF14 TO DP020-SRC-AID                 04140000
025360             ELSE                                                 04150000
025500                  PERFORM 2000-PROCESS-PANEL                      04160000
025700                  IF  PS-ERROR                                    04170000
025800                    CONTINUE                                      04180000
025900                  ELSE                                            04190000
026000                     PERFORM 4000-BUILD-INITIAL-PANEL             04200000
026100                  END-IF                                          04210000
026110             END-IF                                               04220000
026120                                                                  04230000
026130         WHEN DP020-NEXT-ACT-READ-MAP                             04240000
026140             PERFORM 2000-PROCESS-PANEL                           04250000
026150                                                                  04260000
026160         WHEN DP020-NEXT-ACT-RETURN                               04270000
026190             MOVE ASC-KEY-PO-NUMBER TO TR105-PO-NBR               04280000
026420             MOVE ASC-PREV-DC-TOT-VFD TO PO017-TOTVFD             04290005
                   MOVE 0 TO ASC-TOT-VFD                                04300003
026430             MOVE 0 TO ASC-TOT-PCT-RCD                            04310000
026440                                                                  04320000
026450             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04330000
026460             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04340000
026470             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04350000
026480             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04360000
026490             IF PS-ALL-VSORAIR                                    04370000
026491                 MOVE DP016-PF3  TO DP020-SRC-AID                 04380000
026492             ELSE                                                 04390000
026500                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              04400000
026600             END-IF                                               04410000
026700                                                                  04420000
026800         WHEN OTHER                                               04430000
                   IF PS-NO-ERROR                                       04440000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  04450000
                   END-IF                                               04460000
027107     END-EVALUATE.                                                04470000
027108 EJECT                                                            04480000
027109                                                                  04490000
027110******************************************************************04500000
027120 1100-FIND-OBJECT-KEYS.                                           04510000
027130     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04520000
027140     MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER.                      04530000
027170 EJECT                                                            04540000
027180                                                                  04550000
027190*----------------------------------------------------------------*04560000
027200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04570000
027300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04580000
027400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04590000
027500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04600000
027600* FUNCTION KEYS CAN GET THIS FAR.                                *04610000
027700*----------------------------------------------------------------*04620000
027800                                                                  04630000
027900 2000-PROCESS-PANEL.                                              04640000
028000     EVALUATE TRUE                                                04650000
028400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04660000
028410             INITIALIZE ASC-SCREEN-FIELDS                         04670000
028420             MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER               04680000
028450             PERFORM 4120-GET-PO-TYP                              04690000
028460             PERFORM 4000-BUILD-INITIAL-PANEL                     04700000
028470                                                                  04710000
028480         WHEN DP020-SRC-AID = DP016-CLEAR                         04720000
028482             MOVE ASC-PREV-DC-TOT-VFD TO PO017-TOTVFD             04730005
                   MOVE 0 TO ASC-TOT-VFD                                04740003
028483             MOVE 0 TO ASC-TOT-PCT-RCD                            04750000
028490             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04760000
028500                                                                  04770000
028600         WHEN OTHER                                               04780000
028820             MOVE ASC-PREV-DC-TOT-VFD TO PO017-TOTVFD             04790005
                   MOVE 0 TO ASC-TOT-VFD                                04800003
028830             MOVE 0 TO ASC-TOT-PCT-RCD                            04810000
028840                                                                  04820000
028850             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04830000
028860             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04840000
028870             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04850000
028880             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04860000
028890             IF PS-ALL-VSORAIR                                    04870000
028891                 MOVE DP016-PF3  TO DP020-SRC-AID                 04880000
028892             ELSE                                                 04890000
028900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04900000
029000             END-IF                                               04910000
029100     END-EVALUATE.                                                04920000
029200                                                                  04930000
029300  EJECT                                                           04940000
029400*----------------------------------------------------------------*04950000
029500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04960000
029600* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04970000
029700* FROM THE CICS ARCHITECTURE API.                                *04980000
029800*----------------------------------------------------------------*04990000
029900                                                                  05000000
030000 2100-CHECK-FUNCTION-KEY.                                         05010000
030410                                                                  05020000
030420     EVALUATE TRUE                                                05030000
030430         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05040000
030440             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05050000
030450                                                                  05060000
030430         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05070000
030440             PERFORM 4401-PREP-INTERAPPL-COMMAREA                 05080000
030450                                                                  05090000
030460         WHEN DP020-SRC-AID = DP016-ENTER                         05100000
030470             CONTINUE                                             05110000
030480                                                                  05120000
030490         WHEN OTHER                                               05130000
030500             SET DP013-NO-ROLLBACK                                05140000
030600                 DP013-XCTL-DISPLAY-RESTART                       05150000
030700                 DP013-CICS-ABEND  TO TRUE                        05160000
030800             MOVE '2100-CHECK-FUNCTION-KEY'                       05170000
030900                                   TO DP013-PARAGRAPH             05180000
031000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05190000
031100                                   TO DP013-MESSAGE-TEXT (1)      05200000
031200             PERFORM DP013-0000-PROCESS-ABEND                     05210000
031300     END-EVALUATE.                                                05220000
031400                                                                  05230000
031500 EJECT                                                            05240000
031600                                                                  05250000
031700*----------------------------------------------------------------*05260000
031800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05270000
031900** INTER-APPLICATION COMMAREA.                                  **05280000
032000*----------------------------------------------------------------*05290000
032100 2110-PREPARE-INTER-APPL-COMM.                                    05300000
032200     MOVE ASC-KEY-PO-NUMBER        TO TR105-PO-NBR.               05310000
032300                                                                  05320000
032400/                                                                 05330000
032500*----------------------------------------------------------------*05340000
032600*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *05350000
032700*    ENTRY.                                                      *05360000
032800*----------------------------------------------------------------*05370000
032900                                                                  05380000
033000 4000-BUILD-INITIAL-PANEL.                                        05390000
033001                                                                  05400000
033002     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            05410000
C98147     MOVE +0 TO ASC-NUMBER-OF-ITEMS-READ.                         05420009
C98147     MOVE ASC-KEY-PO-NUMBER TO ASC-PO-NBR.                        05430009
                                                                        05440009
033015     IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')                05450000
033016        PERFORM 4100-GET-IMPORT                                   05460000
033017     ELSE                                                         05470000
033018        PERFORM 4200-GET-DOMESTIC                                 05480000
033019     END-IF                                                       05490000
033040         IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')            05500000
033050             MOVE PLNSHP-STRT-FCTRY-DTE                           05510000
033060                                   TO ASC-STRT-FCTRY-DTE          05520000
033070             MOVE PLNSHP-LAST-FCTRY-DTE                           05530000
033080                                   TO ASC-LAST-FCTRY-DTE          05540000
033081             MOVE IMFOB-FOB-CTY-NM TO ASC-FOB-POINT               05550000
033082         ELSE                                                     05560000
033083             MOVE SPACES TO ASC-STRT-FCTRY-DTE                    05570000
033084                            ASC-LAST-FCTRY-DTE                    05580000
033085                            ASC-FOB-POINT                         05590000
033086         END-IF                                                   05600000
033087             MOVE ENTNME-ENT-NAME-DESC TO ASC-VENDOR              05610000
033088             MOVE PURCHS-DEPT-NBR TO ASC-DEPT                     05620000
033090             MOVE PURCHS-OTB-PER-NBR TO PV-OTB                    05630000
033100             MOVE PV-OTB-CC TO PV-OTB-CC2                         05640000
033110             MOVE PV-OTB-YY TO PV-OTB-YY2                         05650000
033200             MOVE PV-OTB-MM TO PV-OTB-MM2                         05660000
033310             MOVE PV-OTB2(1:4) TO ASC-OTB                         05670000
033400             MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DATE-BREAK       05680000
033500             MOVE PV-DB-YY TO PV-DD-YY                            05690000
033600             MOVE PV-DB-MM TO PV-DD-MM                            05700000
033700             MOVE PV-DB-DD TO PV-DD-DD                            05710000
033800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05720000
033900                PV-DD-MM = SPACES                                 05730000
034000                  MOVE SPACES TO ASC-SHIP-DATE                    05740000
034100             ELSE                                                 05750000
034200                 MOVE PV-DATE-DISPLAY TO ASC-SHIP-DATE            05760000
034300             END-IF                                               05770000
034400             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-DATE-BREAK      05780000
034500             MOVE PV-DB-YY TO PV-DD-YY                            05790000
034600             MOVE PV-DB-MM TO PV-DD-MM                            05800000
034700             MOVE PV-DB-DD TO PV-DD-DD                            05810000
034800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05820000
034900                PV-DD-MM = SPACES                                 05830000
035000                  MOVE SPACES TO ASC-CANCEL-DATE                  05840000
035100             ELSE                                                 05850000
035200                 MOVE PV-DATE-DISPLAY TO ASC-CANCEL-DATE          05860000
035300             END-IF                                               05870000
035440              MOVE ASC-PREV-DC-TOT-VFD TO PO017-TOTVFD            05880005
                    MOVE 0 TO ASC-TOT-VFD                               05890003
035495              MOVE 0 TO ASC-TOT-PCT-RCD                           05900000
035510             PERFORM 4300-READ-ITEMS-FROM-DB                      05910000
035600             IF ASC-NUMBER-OF-ITEMS-READ = ZERO                   05920000
035700                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             05930000
035800                SET DP020-MSG-FATAL TO TRUE                       05940000
035900                MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER          05950000
036000             ELSE                                                 05960000
036020                 MOVE ASC-PREV-DC-TOT-VFD TO PO017-TOTVFD         05970005
                       MOVE 0 TO ASC-TOT-VFD                            05980003
036030                 MOVE 0 TO ASC-TOT-PCT-RCD                        05990000
036100                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              06000000
036200             END-IF.                                              06010000
036900  EJECT                                                           06020000
037000                                                                  06030000
037100*----------------------------------------------------------------*06040000
037200* OPEN THE SHIPMT-CSR CURSOR.                                    *06050000
037300*----------------------------------------------------------------*06060000
037400                                                                  06070000
037500 4010-OPEN-CURSOR.                                                06080000
037600     PERFORM                                                      06090000
037700         WITH TEST AFTER                                          06100000
037800         VARYING PV-RETRY-COUNTER                                 06110000
037900         FROM 1 BY 1                                              06120000
038000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06130000
038100                   OR (SQLCODE = ZERO))                           06140000
038200                                                                  06150000
038300              EXEC SQL                                            06160000
038400                 OPEN SHIPMT-CSR                                  06170000
038500              END-EXEC                                            06180000
038600                                                                  06190000
038700         EVALUATE TRUE                                            06200000
038800             WHEN SQLCODE = ZERO                                  06210000
038900             WHEN SQLCODE = -904                                  06220000
039000             WHEN SQLCODE = -913                                  06230000
039100                 CONTINUE                                         06240000
039200             WHEN SQLWARN0 NOT = SPACES                           06250000
039300             WHEN SQLCODE < ZERO                                  06260000
039400             WHEN SQLCODE > ZERO                                  06270000
039500                 MOVE '4010-OPEN-CURSOR'                          06280000
039600                                   TO DP013-PARAGRAPH             06290000
039700                 MOVE 'OPEN SHIPMT-CSR CURSOR - '                 06300000
039800                                   TO DP013-MESSAGE-TEXT (1)      06310000
039900                 MOVE SQLCA        TO DP013-SQLCA                 06320000
040000                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    06330000
040100                 SET DP013-DB2-ABEND                              06340000
040200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06350000
040300                 PERFORM DP013-0000-PROCESS-ABEND                 06360000
040400         END-EVALUATE                                             06370000
040500     END-PERFORM.                                                 06380000
040600*                                                                 06390000
040700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06400000
040800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             06410000
040900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   06420000
041000                                   TO DP013-MESSAGE-TEXT (1)      06430000
041100         MOVE SQLCA                TO DP013-SQLCA                 06440000
041200         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    06450000
041300         SET DP013-DB2-ABEND                                      06460000
041310             DP013-XCTL-DISPLAY-RESTART                           06470000
041320                                   TO TRUE                        06480000
041330         PERFORM DP013-0000-PROCESS-ABEND                         06490000
041340     END-IF.                                                      06500000
041341                                                                  06510000
041342 EJECT                                                            06520000
041343                                                                  06530000
041344*----------------------------------------------------------------*06540000
041345* CLOSE THE SHIPMT-CSR CURSOR.                                   *06550000
041346*----------------------------------------------------------------*06560000
041347                                                                  06570000
041348 4020-CLOSE-CURSOR.                                               06580000
041349*                                                                 06590000
041350     EXEC SQL                                                     06600000
041351         CLOSE SHIPMT-CSR                                         06610000
041352     END-EXEC                                                     06620000
041353                                                                  06630000
041354     EVALUATE TRUE                                                06640000
041355         WHEN SQLCODE = ZERO                                      06650000
041356             CONTINUE                                             06660000
041357         WHEN SQLWARN0 NOT = SPACES                               06670000
041358         WHEN SQLCODE < ZERO                                      06680000
041359         WHEN SQLCODE > ZERO                                      06690000
041360             MOVE '4020-CLOSE-CURSOR'                             06700000
041361                               TO DP013-PARAGRAPH                 06710000
041362             MOVE 'CLOSE SHIPMT-CSR CURSOR '                      06720000
041363                               TO DP013-MESSAGE-TEXT (1)          06730000
041364             MOVE SQLCA        TO DP013-SQLCA                     06740000
041365             MOVE 'SHIPMT  '   TO DP013-DB2-TABLE-NAME (1)        06750000
041366             SET DP013-DB2-ABEND                                  06760000
041367                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06770000
041368             PERFORM DP013-0000-PROCESS-ABEND                     06780000
041369     END-EVALUATE.                                                06790000
041370                                                                  06800000
041371  EJECT                                                           06810000
041372                                                                  06820000
041373*----------------------------------------------------------------*06830000
041374* GET IMPORT SCREEN FIELDS                                       *06840000
041375*----------------------------------------------------------------*06850000
041376                                                                  06860000
041377 4100-GET-IMPORT.                                                 06870000
041378     PERFORM                                                      06880000
041379         WITH TEST AFTER                                          06890000
041380         VARYING PV-RETRY-COUNTER                                 06900000
041390         FROM 1 BY 1                                              06910000
041400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06920000
041500             OR (SQLCODE = ZERO)                                  06930000
041600             OR (SQLCODE = +100))                                 06940000
041700             EXEC SQL                                             06950000
041800                 SELECT A.OTB_PER_NBR,                            06960000
041810                        A.PO_TYP_CDE,                             06970000
041820                        A.TOT_UNT_QTY,                            06980000
041900                        B.STRT_FCTRY_DTE,                         06990000
042000                        B.LAST_FCTRY_DTE,                         07000000
042100                        B.DONT_SHIP_BEF_DTE,                      07010000
042200                        B.CAN_IFNOT_SHIP_DTE,                     07020000
042300                        C.FOB_CTY_NM,                             07030000
042310                        A.DEPT_NBR,                               07040000
042320                        D.ENT_NAME_DESC                           07050000
042400                 INTO :PURCHS-OTB-PER-NBR,                        07060000
042410                      :PURCHS-PO-TYP-CDE,                         07070000
042420                      :PURCHS-TOT-UNT-QTY,                        07080000
042500                      :PLNSHP-STRT-FCTRY-DTE,                     07090000
042600                      :PLNSHP-LAST-FCTRY-DTE,                     07100000
042700                      :PLNSHP-DONT-SHIP-BEF-DTE,                  07110000
042800                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 07120000
042900                      :IMFOB-FOB-CTY-NM,                          07130000
042910                      :PURCHS-DEPT-NBR,                           07140000
042920                      :ENTNME-ENT-NAME-DESC                       07150000
043000                 FROM TPURCHS A,                                  07160000
043100                      TPLNSHP B,                                  07170000
043200                      TIMFOB C,                                   07180000
043210                      TENTNME D                                   07190000
043300                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              07200000
043400                   AND A.VER_STATUS_CDE = 'A'                     07210000
043500                   AND B.VER_STATUS_CDE = 'A'                     07220000
043700                   AND B.PO_NBR = A.PO_NBR                        07230000
043800                   AND C.FOB_CDE = B.FOB_CDE                      07240000
043810                   AND A.ENT_ID = D.ENT_ID                        07250000
043820                   AND D.TYPE_CDE = '04'                          07260000
043900             END-EXEC                                             07270000
044000         EVALUATE TRUE                                            07280000
044010             WHEN SQLCODE = +100                                  07290000
044020               PERFORM 4150-GET-QTY-ORDERED                       07300000
044100             WHEN SQLCODE = ZERO                                  07310000
044300             WHEN SQLCODE = -904                                  07320000
044400             WHEN SQLCODE = -913                                  07330000
044500                 CONTINUE                                         07340000
044600             WHEN SQLWARN0 NOT = SPACES                           07350000
044700             WHEN SQLCODE < ZERO                                  07360000
044800             WHEN SQLCODE > ZERO                                  07370000
044900                 MOVE '4100-GET-IMPORT'                           07380000
045000                                   TO DP013-PARAGRAPH             07390000
045100                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           07400000
045200                                   TO DP013-MESSAGE-TEXT (1)      07410000
045300                 MOVE SQLCA        TO DP013-SQLCA                 07420000
045400                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    07430000
045500                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    07440000
045600                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    07450000
045700                 SET DP013-DB2-ABEND                              07460000
045800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07470000
045900                 PERFORM DP013-0000-PROCESS-ABEND                 07480000
046000         END-EVALUATE                                             07490000
046100     END-PERFORM.                                                 07500000
046200*                                                                 07510000
046300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07520000
046400         MOVE '4100-GET-IMPORT'    TO DP013-PARAGRAPH             07530000
046500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  07540000
046600                                   TO DP013-MESSAGE-TEXT (1)      07550000
046700         MOVE SQLCA                TO DP013-SQLCA                 07560000
046800         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            07570000
046900         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            07580000
047000         MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)            07590000
047100         SET DP013-DB2-ABEND                                      07600000
047200             DP013-XCTL-DISPLAY-RESTART                           07610000
047300                                   TO TRUE                        07620000
047400         PERFORM DP013-0000-PROCESS-ABEND                         07630000
047500     END-IF.                                                      07640000
047600                                                                  07650000
047700  EJECT                                                           07660000
047701                                                                  07670000
047702*----------------------------------------------------------------*07680000
047703* GET TOTAL QUANTITY ORDERED FROM TPURCHS                        *07690000
047704*----------------------------------------------------------------*07700000
047705 4150-GET-QTY-ORDERED.                                            07710000
047706     PERFORM                                                      07720000
047707         WITH TEST AFTER                                          07730000
047708         VARYING PV-RETRY-COUNTER                                 07740000
047709         FROM 1 BY 1                                              07750000
047710         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07760000
047711             OR (SQLCODE = ZERO)                                  07770000
047712             OR (SQLCODE = +100))                                 07780000
047713             EXEC SQL                                             07790000
047716                 SELECT TOT_UNT_QTY                               07800000
047724                 INTO :PURCHS-TOT-UNT-QTY                         07810000
047730                 FROM TPURCHS                                     07820000
047733                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                07830000
047734                   AND VER_STATUS_CDE = 'A'                       07840000
047738             END-EXEC                                             07850000
047739         EVALUATE TRUE                                            07860000
047740             WHEN SQLCODE = ZERO                                  07870000
047741             WHEN SQLCODE = +100                                  07880000
047742             WHEN SQLCODE = -904                                  07890000
047743             WHEN SQLCODE = -913                                  07900000
047744                 CONTINUE                                         07910000
047745             WHEN SQLWARN0 NOT = SPACES                           07920000
047746             WHEN SQLCODE < ZERO                                  07930000
047747             WHEN SQLCODE > ZERO                                  07940000
047748                 MOVE '4150-GET-QTY-ORDERED'                      07950000
047749                                   TO DP013-PARAGRAPH             07960000
047750                 MOVE 'SQL ERROR SELECTING QTY ORDERED'           07970000
047751                                   TO DP013-MESSAGE-TEXT (1)      07980000
047752                 MOVE SQLCA        TO DP013-SQLCA                 07990000
047753                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    08000000
047754                 SET DP013-DB2-ABEND                              08010000
047755                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08020000
047756                 PERFORM DP013-0000-PROCESS-ABEND                 08030000
047757         END-EVALUATE                                             08040000
047758     END-PERFORM.                                                 08050000
047759*                                                                 08060000
047760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08070000
047761         MOVE '4150-GET-QTY-ORDERED' TO DP013-PARAGRAPH           08080000
047762         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08090000
047763                                   TO DP013-MESSAGE-TEXT (1)      08100000
047764         MOVE SQLCA                TO DP013-SQLCA                 08110000
047765         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            08120000
047766         SET DP013-DB2-ABEND                                      08130000
047767             DP013-XCTL-DISPLAY-RESTART                           08140000
047768                                   TO TRUE                        08150000
047769         PERFORM DP013-0000-PROCESS-ABEND                         08160000
047770     END-IF.                                                      08170000
047771                                                                  08180000
047772  EJECT                                                           08190000
047773                                                                  08200000
047774                                                                  08210000
047775*----------------------------------------------------------------*08220000
047776* GET IMPORT SCREEN FIELDS FOR DOMESTIC ORDERS                   *08230000
047777*----------------------------------------------------------------*08240000
047778                                                                  08250000
047779 4200-GET-DOMESTIC.                                               08260000
047780     PERFORM                                                      08270000
047781         WITH TEST AFTER                                          08280000
047782         VARYING PV-RETRY-COUNTER                                 08290000
047790         FROM 1 BY 1                                              08300000
047791         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08310000
047792             OR (SQLCODE = ZERO)                                  08320000
047793             OR (SQLCODE = +100))                                 08330000
047794             EXEC SQL                                             08340000
047795                 SELECT A.OTB_PER_NBR,                            08350000
047796                        A.PO_TYP_CDE,                             08360000
047799                        B.DONT_SHIP_BEF_DTE,                      08370000
047800                        B.CAN_IFNOT_SHIP_DTE,                     08380000
047801                        A.TOT_UNT_QTY,                            08390000
047802                        A.DEPT_NBR,                               08400000
047803                        C.ENT_NAME_DESC                           08410000
047804                 INTO :PURCHS-OTB-PER-NBR,                        08420000
047805                      :PURCHS-PO-TYP-CDE,                         08430000
047806                      :PLNSHP-DONT-SHIP-BEF-DTE,                  08440000
047807                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 08450000
047808                      :PURCHS-TOT-UNT-QTY,                        08460000
047809                      :PURCHS-DEPT-NBR,                           08470000
047810                      :ENTNME-ENT-NAME-DESC                       08480000
047811                 FROM TPURCHS A,                                  08490000
047812                      TPLNSHP B,                                  08500000
047813                      TENTNME C                                   08510000
047814                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              08520000
047815                   AND A.VER_STATUS_CDE = 'A'                     08530000
047816                   AND B.VER_STATUS_CDE = 'A'                     08540000
047817                   AND B.PO_NBR = A.PO_NBR                        08550000
047818                   AND A.ENT_ID = C.ENT_ID                        08560000
047819                   AND C.TYPE_CDE = '04'                          08570000
047820             END-EXEC                                             08580000
047821         EVALUATE TRUE                                            08590000
047822             WHEN SQLCODE = ZERO                                  08600000
047823             WHEN SQLCODE = +100                                  08610000
047824             WHEN SQLCODE = -904                                  08620000
047825             WHEN SQLCODE = -913                                  08630000
047826                 CONTINUE                                         08640000
047827             WHEN SQLWARN0 NOT = SPACES                           08650000
047828             WHEN SQLCODE < ZERO                                  08660000
047829             WHEN SQLCODE > ZERO                                  08670000
047830                 MOVE '4200-GET-DOMESTIC'                         08680000
047831                                   TO DP013-PARAGRAPH             08690000
047832                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           08700000
047833                                   TO DP013-MESSAGE-TEXT (1)      08710000
047834                 MOVE SQLCA        TO DP013-SQLCA                 08720000
047835                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    08730000
047836                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    08740000
047837                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    08750000
047838                 SET DP013-DB2-ABEND                              08760000
047839                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08770000
047840                 PERFORM DP013-0000-PROCESS-ABEND                 08780000
047841         END-EVALUATE                                             08790000
047842     END-PERFORM.                                                 08800000
047843*                                                                 08810000
047844     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08820000
047845         MOVE '4200-GET-DOMESTIC'  TO DP013-PARAGRAPH             08830000
047846         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08840000
047847                                   TO DP013-MESSAGE-TEXT (1)      08850000
047848         MOVE SQLCA                TO DP013-SQLCA                 08860000
047849         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            08870000
047850         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            08880000
047851         SET DP013-DB2-ABEND                                      08890000
047852             DP013-XCTL-DISPLAY-RESTART                           08900000
047853                                   TO TRUE                        08910000
047854         PERFORM DP013-0000-PROCESS-ABEND                         08920000
047855     END-IF.                                                      08930000
047856                                                                  08940000
047857  EJECT                                                           08950000
047860                                                                  08960000
047900*----------------------------------------------------------------*08970000
048000* GET DC NAME                                                    *08980000
048100*----------------------------------------------------------------*08990000
048200                                                                  09000000
048300 4110-GET-DC-NAME.                                                09010000
048400     PERFORM                                                      09020000
048500         WITH TEST AFTER                                          09030000
048600         VARYING PV-RETRY-COUNTER                                 09040000
048700         FROM 1 BY 1                                              09050000
048800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09060000
048900             OR (SQLCODE = ZERO)                                  09070000
049000             OR (SQLCODE = +100))                                 09080000
049100             EXEC SQL                                             09090000
049200             SELECT LOC_5_ABBR_NM                                 09100008
049300             INTO :XMT00001-LOC-5-ABBR-NM                         09110008
049400             FROM XMT_LOC                                         09120008
049500             WHERE LOC_NBR = :PV-OPER-UNT-ID                      09130008
049510             END-EXEC                                             09140008
049520         EVALUATE TRUE                                            09150008
049530             WHEN SQLCODE = +100                                  09160008
049540               MOVE SPACES TO XMT00001-LOC-5-ABBR-NM              09170008
049570             WHEN SQLCODE = ZERO                                  09180000
049580             WHEN SQLCODE = -904                                  09190000
049590             WHEN SQLCODE = -913                                  09200000
049600                 CONTINUE                                         09210000
049601             WHEN SQLWARN0 NOT = SPACES                           09220000
049602             WHEN SQLCODE < ZERO                                  09230000
049603             WHEN SQLCODE > ZERO                                  09240000
049604                 MOVE '4110-GET-DC-NAME'                          09250000
049605                                   TO DP013-PARAGRAPH             09260000
049606                 MOVE 'SQL ERROR SELECTING DC NAME'               09270000
049607                                   TO DP013-MESSAGE-TEXT (1)      09280000
049608                 MOVE SQLCA        TO DP013-SQLCA                 09290000
049609                 MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)    09300008
049610                 SET DP013-DB2-ABEND                              09310000
049611                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09320000
049612                 PERFORM DP013-0000-PROCESS-ABEND                 09330000
049613         END-EVALUATE                                             09340000
049614     END-PERFORM.                                                 09350000
049615*                                                                 09360000
049616     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09370000
049617         MOVE '4110-GET-DC NAME'   TO DP013-PARAGRAPH             09380000
049618         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT DC'  09390000
049619                                   TO DP013-MESSAGE-TEXT (1)      09400000
049620         MOVE SQLCA                TO DP013-SQLCA                 09410000
049621         MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)            09420008
049622         SET DP013-DB2-ABEND                                      09430000
049623             DP013-XCTL-DISPLAY-RESTART                           09440000
049624                                   TO TRUE                        09450000
049625         PERFORM DP013-0000-PROCESS-ABEND                         09460000
049626     END-IF.                                                      09470000
049627                                                                  09480000
049628  EJECT                                                           09490000
049629                                                                  09500000
049630*----------------------------------------------------------------*09510000
049631* GET THE PO TYPE CODE                                           *09520000
049632*----------------------------------------------------------------*09530000
049633                                                                  09540000
049634 4120-GET-PO-TYP.                                                 09550000
049635     PERFORM                                                      09560000
049636         WITH TEST AFTER                                          09570000
049637         VARYING PV-RETRY-COUNTER                                 09580000
049638         FROM 1 BY 1                                              09590000
049639         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09600000
049640             OR (SQLCODE = ZERO)                                  09610000
049641             OR (SQLCODE = +100))                                 09620000
049642             EXEC SQL                                             09630000
049643                 SELECT PO_TYP_CDE                                09640000
049644                 INTO :PURCHS-PO-TYP-CDE                          09650000
049645                 FROM TPURCHS                                     09660000
049646                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                09670000
049647                   AND VER_STATUS_CDE = 'A'                       09680000
049648             END-EXEC                                             09690000
049649         EVALUATE TRUE                                            09700000
049651             WHEN SQLCODE = +100                                  09710000
049652                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             09720000
049653                SET DP020-MSG-FATAL TO TRUE                       09730000
049654                MOVE PC-TSYMSG-00726 TO DP020-MSG-NUMBER          09740000
049655             WHEN SQLCODE = ZERO                                  09750000
049656             WHEN SQLCODE = -904                                  09760000
049657             WHEN SQLCODE = -913                                  09770000
049658                 CONTINUE                                         09780000
049659             WHEN SQLWARN0 NOT = SPACES                           09790000
049660             WHEN SQLCODE < ZERO                                  09800000
049661             WHEN SQLCODE > ZERO                                  09810000
049662                 MOVE '4120-GET-PO-TYP'                           09820000
049663                                   TO DP013-PARAGRAPH             09830000
049664                 MOVE 'SQL ERROR SELECTING PO TYP CODE'           09840000
049665                                   TO DP013-MESSAGE-TEXT (1)      09850000
049666                 MOVE SQLCA        TO DP013-SQLCA                 09860000
049667                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    09870000
049668                 SET DP013-DB2-ABEND                              09880000
049669                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09890000
049670                 PERFORM DP013-0000-PROCESS-ABEND                 09900000
049671         END-EVALUATE                                             09910000
049672     END-PERFORM.                                                 09920000
049673*                                                                 09930000
049674     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09940000
049675         MOVE '4120-GET-PO-TYP'    TO DP013-PARAGRAPH             09950000
049676         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO T'09960000
049677                                   TO DP013-MESSAGE-TEXT (1)      09970000
049678         MOVE SQLCA                TO DP013-SQLCA                 09980000
049679         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            09990000
049680         SET DP013-DB2-ABEND                                      10000000
049681             DP013-XCTL-DISPLAY-RESTART                           10010000
049682                                   TO TRUE                        10020000
049683         PERFORM DP013-0000-PROCESS-ABEND                         10030000
049684     END-IF.                                                      10040000
049685                                                                  10050000
049686  EJECT                                                           10060000
049687                                                                  10070000
049688 4220-PRESCAN-ITEMS-FROM-DB.                                      10080000
049689     SET PS-ALL-VSORAIR TO TRUE.                                  10090000
049690     PERFORM 4010-OPEN-CURSOR.                                    10100000
049691     PERFORM                                                      10110000
049692         VARYING PV-READ-COUNT                                    10120000
049693         FROM 1 BY 1                                              10130000
049694         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10140000
049695         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10150000
049696             PERFORM 4310-FETCH                                   10160000
049697               IF ASC-ITEMS-LEFT-ON-DB                            10170000
049698                  ADD +1 TO ASC-NUMBER-OF-ITEMS-READ              10180000
049699                    IF NOT VEHICL-CURR-OPER-UNT-ID = 90           10190000
049700                        SET PS-NOT-ALL-VSORAIR TO TRUE            10200000
049701                    END-IF                                        10210000
049702               END-IF                                             10220000
049703     END-PERFORM.                                                 10230000
049704                                                                  10240000
049705     IF ASC-NUMBER-OF-ITEMS-READ = 0 AND PS-ALL-VSORAIR           10250000
049706       SET PS-NOT-ALL-VSORAIR TO TRUE                             10260000
049707     END-IF.                                                      10270000
049708                                                                  10280000
049709     PERFORM 4020-CLOSE-CURSOR.                                   10290000
049710*----------------------------------------------------------------*10300000
049711*    READ EACH SHIPMENT FROM THE DB                              *10310000
049712*----------------------------------------------------------------*10320000
049713 4300-READ-ITEMS-FROM-DB.                                         10330000
049714     PERFORM 4010-OPEN-CURSOR.                                    10340000
049715     PERFORM                                                      10350000
049716         VARYING PV-READ-COUNT                                    10360000
049717         FROM 1 BY 1                                              10370000
049718         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10380000
049719         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10390000
049720             PERFORM 4310-FETCH                                   10400000
049721               IF ASC-ITEMS-LEFT-ON-DB                            10410000
049722                  ADD +1 TO ASC-NUMBER-OF-ITEMS-READ              10420000
049723                  MOVE VEHICL-CURR-OPER-UNT-ID TO PV-OPER-UNT-ID  10430000
049724                  PERFORM 4110-GET-DC-NAME                        10440000
049725                  PERFORM 5000-RETRIEVE-MAXDATES                  10450000
049726                  PERFORM 5020-RETRIEVE-MAXDATES                  10460000
049727                  PERFORM 5030-RETRIEVE-RCPTDATES                 10470000
049728                  PERFORM 5040-RETRIEVE-VERDATES                  10480000
049729                  PERFORM 5050-RETRIEVE-UNITS-ORD                 10490000
049730                  PERFORM 5060-RETRIEVE-UNITS-VFD                 10500000
049731                  PERFORM 5070-DETERMINE-IN-PROCESS               10510000
049732                                                                  10520000
049733                  IF PV-OPER-UNT-ID = 840                         10530000
049734                     IF SQLCODE = +0                              10540000
049735                        MOVE DP015-YELLOW TO ASC-UNT-VFD1-C       10550000
049736                      ELSE                                        10560000
049737                        MOVE DP015-BLUE TO ASC-UNT-VFD1-C         10570000
049738                     END-IF                                       10580000
049739                     MOVE PV-DC-REC-QTY TO ASC-UNT-VFD1           10590000
049740                     MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD1   10600000
049741                     IF ASC-UNT-VFD1 = 0 OR ASC-UNT-ORD1 = 0      10610000
049742                         MOVE ZEROES TO ASC-PCT-RCD1-N            10620000
049743                         MOVE SPACES TO ASC-PCT-RCD1-SIGN         10630000
049744                     ELSE                                         10640000
049745                         COMPUTE PV-TOT-REC-PCT                   10650000
049746                         ROUNDED =                                10660000
049747                            (ASC-UNT-VFD1 / ASC-UNT-ORD1)         10670000
049748                         COMPUTE PV-TOT-REC-PCT =                 10680000
049749                                  PV-TOT-REC-PCT * 100            10690000
049750                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD1 > 0  10700000
049751                           MOVE 1 TO ASC-PCT-RCD1-N               10710000
049752                           MOVE '%' TO ASC-PCT-RCD1-SIGN          10720000
049753                   ELSE                                           10730000
049754                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD1-N     10740000
049755                        MOVE '%' TO ASC-PCT-RCD1-SIGN             10750000
049756                   END-IF                                         10760000
049757                   END-IF                                         10770000
049758                     MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK      10780000
049759                     MOVE PV-DB-MM          TO PV-DD-MM           10790000
049760                     MOVE PV-DB-DD          TO PV-DD-DD           10800000
049761                     MOVE PV-DB-YY          TO PV-DD-YY           10810000
049762                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   10820000
049763                                       AND    PV-DD-MM = SPACES   10830000
049764                         MOVE SPACES TO ASC-LST-VFD-DT1           10840000
049765                     ELSE                                         10850000
049766                         MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT1  10860000
049767                     END-IF                                       10870000
049768                     MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK      10880000
049769                     MOVE PV-DB-MM          TO PV-DD-MM           10890000
049770                     MOVE PV-DB-DD          TO PV-DD-DD           10900000
049771                     MOVE PV-DB-YY          TO PV-DD-YY           10910000
049772                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   10920000
049773                                       AND    PV-DD-MM = SPACES   10930000
049774                         MOVE SPACES TO ASC-FST-VFD-DT1           10940000
049775                     ELSE                                         10950000
049776                         MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT1  10960000
049777                     END-IF                                       10970000
049778                     IF ASC-LST-VFD-DT1 = ASC-FST-VFD-DT1         10980000
049779                       MOVE SPACES TO ASC-LST-VFD-DT1             10990000
049780                     END-IF                                       11000000
049781                                                                  11010000
049782                     MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC1       11020008
049783                     MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK      11030000
049784                     MOVE PV-DB-MM          TO PV-DD-MM           11040000
049785                     MOVE PV-DB-DD          TO PV-DD-DD           11050000
049786                     MOVE PV-DB-YY          TO PV-DD-YY           11060000
049787                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11070000
049788                        AND    PV-DD-MM = SPACES                  11080000
049789                         MOVE SPACES TO ASC-LST-RCPT-DT1          11090000
049790                     ELSE                                         11100000
049791                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT1 11110000
049792                     END-IF                                       11120000
049793                     MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK      11130000
049794                     MOVE PV-DB-MM          TO PV-DD-MM           11140000
049795                     MOVE PV-DB-DD          TO PV-DD-DD           11150000
049796                     MOVE PV-DB-YY          TO PV-DD-YY           11160000
049797                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11170000
049798                        AND    PV-DD-MM = SPACES                  11180000
049799                         MOVE SPACES TO ASC-FST-RCPT-DT1          11190000
049800                     ELSE                                         11200000
049801                        MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT1  11210000
049802                     END-IF                                       11220000
049803                     IF ASC-LST-RCPT-DT1 = ASC-FST-RCPT-DT1       11230000
049804                       MOVE SPACES TO ASC-LST-RCPT-DT1            11240000
049805                     END-IF                                       11250000
049806                     MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK     11260000
049807                     MOVE PV-DB-MM          TO PV-DD-MM           11270000
049808                     MOVE PV-DB-DD          TO PV-DD-DD           11280000
049809                     MOVE PV-DB-YY          TO PV-DD-YY           11290000
049810                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11300000
049811                        AND PV-DD-MM = SPACES                     11310000
049812                           MOVE SPACES TO ASC-DC-DEL-DATE1        11320000
049813                     ELSE                                         11330000
049814                       MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE1   11340000
049815                     END-IF                                       11350000
049816                     MOVE SHIPST-STATUS-DTE TO PV-DATE-BREAK      11360000
049817                     MOVE PV-DB-MM          TO PV-DD-MM           11370000
049818                     MOVE PV-DB-DD          TO PV-DD-DD           11380000
049819                     MOVE PV-DB-YY          TO PV-DD-YY           11390000
049820                     IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES   11400000
049821                        AND PV-DD-MM = SPACES                     11410000
049822                           MOVE SPACES TO ASC-DECON-DATE1         11420000
049823                     ELSE                                         11430000
049824                          MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE1 11440000
049825                     END-IF                                       11450000
049826                  ELSE                                            11460000
049827                     IF PV-OPER-UNT-ID = 855                      11470006
049828                        IF SQLCODE = +0                           11480000
049829                           MOVE DP015-YELLOW TO ASC-UNT-VFD2-C    11490000
049830                         ELSE                                     11500000
049831                            MOVE DP015-BLUE TO ASC-UNT-VFD2-C     11510000
049832                        END-IF                                    11520000
049833                        MOVE PV-DC-REC-QTY TO ASC-UNT-VFD2        11530000
049834                        MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD211540000
049835                     IF ASC-UNT-VFD2 = 0 OR ASC-UNT-ORD2 = 0      11550000
049836                         MOVE ZEROES TO ASC-PCT-RCD2              11560000
049837                     ELSE                                         11570000
049838                         COMPUTE PV-TOT-REC-PCT                   11580000
049839                         ROUNDED =                                11590000
049840                            (ASC-UNT-VFD2 / ASC-UNT-ORD2)         11600000
049841                         COMPUTE PV-TOT-REC-PCT =                 11610000
049842                                  PV-TOT-REC-PCT * 100            11620000
049843                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD2 > 0  11630000
049844                           MOVE 1 TO ASC-PCT-RCD2-N               11640000
049845                           MOVE '%' TO ASC-PCT-RCD2-SIGN          11650000
049846                   ELSE                                           11660000
049847                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD2-N     11670000
049848                        MOVE '%' TO ASC-PCT-RCD2-SIGN             11680000
049849                   END-IF                                         11690000
049850                   END-IF                                         11700000
049851                        MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK   11710000
049852                        MOVE PV-DB-MM          TO PV-DD-MM        11720000
049853                        MOVE PV-DB-DD          TO PV-DD-DD        11730000
049854                        MOVE PV-DB-YY          TO PV-DD-YY        11740000
049855                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES11750000
049856                                          AND    PV-DD-MM = SPACES11760000
049857                            MOVE SPACES TO ASC-LST-VFD-DT2        11770000
049858                        ELSE                                      11780000
049859                           MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT211790000
049860                        END-IF                                    11800000
049861                        MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK   11810000
049862                        MOVE PV-DB-MM          TO PV-DD-MM        11820000
049863                        MOVE PV-DB-DD          TO PV-DD-DD        11830000
049864                        MOVE PV-DB-YY          TO PV-DD-YY        11840000
049865                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES11850000
049866                                          AND    PV-DD-MM = SPACES11860000
049867                            MOVE SPACES TO ASC-FST-VFD-DT2        11870000
049868                        ELSE                                      11880000
049869                           MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT211890000
049870                        END-IF                                    11900000
049871                        IF ASC-LST-VFD-DT2 = ASC-FST-VFD-DT2      11910000
049872                          MOVE SPACES TO ASC-LST-VFD-DT2          11920000
049873                        END-IF                                    11930000
049874                        MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC2    11940008
049875                        MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK   11950000
049876                        MOVE PV-DB-MM          TO PV-DD-MM        11960000
049877                        MOVE PV-DB-DD          TO PV-DD-DD        11970000
049878                        MOVE PV-DB-YY          TO PV-DD-YY        11980000
049879                        IF PV-DD-DD = SPACES AND PV-DD-YY =       11990000
049880                            SPACES AND    PV-DD-MM = SPACES       12000000
049881                               MOVE SPACES TO ASC-LST-RCPT-DT2    12010000
049882                        ELSE                                      12020000
049883                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT2 12030000
049884                        END-IF                                    12040000
049885                        MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK   12050000
049886                        MOVE PV-DB-MM          TO PV-DD-MM        12060000
049887                        MOVE PV-DB-DD          TO PV-DD-DD        12070000
049888                        MOVE PV-DB-YY          TO PV-DD-YY        12080000
049889                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12090000
049890                            SPACES AND    PV-DD-MM = SPACES       12100000
049891                               MOVE SPACES TO ASC-FST-RCPT-DT2    12110000
049892                        ELSE                                      12120000
049893                          MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT212130000
049894                        END-IF                                    12140000
049895                        IF ASC-LST-RCPT-DT2 = ASC-FST-RCPT-DT2    12150000
049896                          MOVE SPACES TO ASC-LST-RCPT-DT2         12160000
049897                        END-IF                                    12170000
049898                        MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK  12180000
049899                        MOVE PV-DB-MM          TO PV-DD-MM        12190000
049900                        MOVE PV-DB-DD          TO PV-DD-DD        12200000
049901                        MOVE PV-DB-YY          TO PV-DD-YY        12210000
049902                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12220000
049903                            SPACES AND    PV-DD-MM = SPACES       12230000
049904                              MOVE SPACES TO ASC-DC-DEL-DATE2     12240000
049905                        ELSE                                      12250000
049906                          MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE212260000
049907                        END-IF                                    12270000
049908                        MOVE SHIPST-STATUS-DTE TO                 12280000
049909                                                 PV-DATE-BREAK    12290000
049910                        MOVE PV-DB-MM          TO PV-DD-MM        12300000
049911                        MOVE PV-DB-DD          TO PV-DD-DD        12310000
049912                        MOVE PV-DB-YY          TO PV-DD-YY        12320000
049913                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12330000
049914                           SPACES AND PV-DD-MM = SPACES           12340000
049915                              MOVE SPACES TO ASC-DECON-DATE2      12350000
049916                        ELSE                                      12360000
049917                           MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE212370000
049918                        END-IF                                    12380000
049919                     ELSE                                         12390000
049920                       IF PV-OPER-UNT-ID = 860                    12400006
049921                        IF SQLCODE = +0                           12410000
049923                          MOVE DP015-YELLOW TO ASC-UNT-VFD3-C     12420000
049924                         ELSE                                     12430000
049926                          MOVE DP015-BLUE TO ASC-UNT-VFD3-C       12440000
049927                        END-IF                                    12450000
049928                        MOVE PV-DC-REC-QTY TO ASC-UNT-VFD3        12460000
049929                        MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD312470000
049930                     IF ASC-UNT-VFD3 = 0 OR ASC-UNT-ORD3 = 0      12480000
049931                         MOVE ZEROES TO ASC-PCT-RCD3              12490000
049932                     ELSE                                         12500000
049933                         COMPUTE PV-TOT-REC-PCT                   12510000
049934                         ROUNDED =                                12520000
049935                            (ASC-UNT-VFD3 / ASC-UNT-ORD3)         12530000
049936                         COMPUTE PV-TOT-REC-PCT =                 12540000
049937                                  PV-TOT-REC-PCT * 100            12550000
049938                   IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD3 > 0  12560000
049939                           MOVE 1 TO ASC-PCT-RCD3-N               12570000
049940                           MOVE '%' TO ASC-PCT-RCD3-SIGN          12580000
049941                   ELSE                                           12590000
049942                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD3-N     12600000
049943                        MOVE '%' TO ASC-PCT-RCD3-SIGN             12610000
049944                   END-IF                                         12620000
049945                   END-IF                                         12630000
049946                        MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK   12640000
049947                        MOVE PV-DB-MM          TO PV-DD-MM        12650000
049948                        MOVE PV-DB-DD          TO PV-DD-DD        12660000
049949                        MOVE PV-DB-YY          TO PV-DD-YY        12670000
049950                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES12680000
049951                                          AND    PV-DD-MM = SPACES12690000
049952                            MOVE SPACES TO ASC-LST-VFD-DT3        12700000
049953                        ELSE                                      12710000
049954                           MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT312720000
049955                        END-IF                                    12730000
049956                        MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK   12740000
049957                        MOVE PV-DB-MM          TO PV-DD-MM        12750000
049958                        MOVE PV-DB-DD          TO PV-DD-DD        12760000
049959                        MOVE PV-DB-YY          TO PV-DD-YY        12770000
049960                        IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES12780000
049961                                          AND    PV-DD-MM = SPACES12790000
049962                            MOVE SPACES TO ASC-FST-VFD-DT3        12800000
049963                        ELSE                                      12810000
049964                           MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT312820000
049965                        END-IF                                    12830000
049966                        IF ASC-LST-VFD-DT3 = ASC-FST-VFD-DT3      12840000
049967                            MOVE SPACES TO ASC-LST-VFD-DT3        12850000
049968                        END-IF                                    12860000
049969                                                                  12870000
049970                        MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC3    12880008
049971                        MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK   12890000
049972                        MOVE PV-DB-MM          TO PV-DD-MM        12900000
049973                        MOVE PV-DB-DD          TO PV-DD-DD        12910000
049974                        MOVE PV-DB-YY          TO PV-DD-YY        12920000
049975                        IF PV-DD-DD = SPACES AND PV-DD-YY =       12930000
049976                            SPACES AND PV-DD-MM = SPACES          12940000
049977                               MOVE SPACES TO ASC-LST-RCPT-DT3    12950000
049978                        ELSE                                      12960000
049979                         MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT3 12970000
049980                        END-IF                                    12980000
049981                        MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK   12990000
049982                        MOVE PV-DB-MM          TO PV-DD-MM        13000000
049983                        MOVE PV-DB-DD          TO PV-DD-DD        13010000
049984                        MOVE PV-DB-YY          TO PV-DD-YY        13020000
049985                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13030000
049986                            SPACES AND PV-DD-MM = SPACES          13040000
049987                               MOVE SPACES TO ASC-FST-RCPT-DT3    13050000
049988                        ELSE                                      13060000
049989                          MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT313070000
049990                        END-IF                                    13080000
049991                        IF ASC-LST-RCPT-DT3 = ASC-FST-RCPT-DT3    13090000
049992                          MOVE SPACES TO ASC-LST-RCPT-DT3         13100000
049993                        END-IF                                    13110000
049994                        MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK  13120000
049995                        MOVE PV-DB-MM           TO PV-DD-MM       13130000
049996                        MOVE PV-DB-DD           TO PV-DD-DD       13140000
049997                        MOVE PV-DB-YY           TO PV-DD-YY       13150000
049998                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13160000
049999                           SPACES AND PV-DD-MM = SPACES           13170000
050000                               MOVE SPACES TO ASC-DC-DEL-DATE3    13180000
050001                        ELSE                                      13190000
050002                               MOVE PV-DATE-DISPLAY TO            13200000
050003                                                ASC-DC-DEL-DATE3  13210000
050004                        END-IF                                    13220000
050005                        MOVE SHIPST-STATUS-DTE TO                 13230000
050006                                                 PV-DATE-BREAK    13240000
050007                        MOVE PV-DB-MM         TO PV-DD-MM         13250000
050008                        MOVE PV-DB-DD         TO PV-DD-DD         13260000
050009                        MOVE PV-DB-YY         TO PV-DD-YY         13270000
050010                        IF PV-DD-DD = SPACES AND PV-DD-YY =       13280000
050011                           SPACES AND PV-DD-MM = SPACES           13290000
050012                               MOVE SPACES TO ASC-DECON-DATE3     13300000
050013                        ELSE                                      13310000
050014                            MOVE PV-DATE-DISPLAY TO               13320000
050015                                           ASC-DECON-DATE3        13330000
050018                        END-IF                                    13340000
      *END IF FOR DC 860                                                13350006
                          END-IF                                        13360000
      *END IF FOR DC 855                                                13370006
                         END-IF                                         13380000
      *END IF FOR DC 840                                                13390000
050019                 END-IF                                           13400000
050020                  MOVE PURCHS-TOT-UNT-QTY TO ASC-TOT-ORD          13410000
050021               END-IF                                             13420000
      *END IF FOR ASC-ITEMS-LEFT-ON-DB                                  13430000
050022     END-PERFORM.                                                 13440000
050023                                                                  13450000
050024     PERFORM 4020-CLOSE-CURSOR.                                   13460000
050025    EJECT                                                         13470000
050026                                                                  13480000
050027*----------------------------------------------------------------*13490000
050028*    FETCH THE SHIPMT-CSR CURSOR.                                *13500000
050029*----------------------------------------------------------------*13510000
050030                                                                  13520000
050031 4310-FETCH.                                                      13530000
050040     EXEC SQL                                                     13540000
050100        FETCH SHIPMT-CSR                                          13550000
050200          INTO  :SHIPMT-SHIPT-ID                                  13560000
050300               ,:SHIPMT-TRIP-ID                                   13570000
050400               ,:VEHICL-CURR-OPER-UNT-ID                          13580000
050500         END-EXEC.                                                13590000
050600     EVALUATE TRUE                                                13600000
050610         WHEN SQLCODE = ZERO                                      13610000
050620            CONTINUE                                              13620000
050621         WHEN SQLCODE = +100                                      13630000
050622             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  13640000
050623         WHEN SQLWARN0 NOT = SPACE                                13650000
050624         WHEN SQLCODE NOT = ZERO                                  13660000
050625              MOVE '4310-FETCH-CURSOR'                            13670000
050626                               TO DP013-PARAGRAPH                 13680000
050627              MOVE 'FETCH SHIPMT-CSR CURSOR'                      13690000
050628                               TO DP013-MESSAGE-TEXT (1)          13700000
050629              MOVE SQLCA       TO DP013-SQLCA                     13710000
050630              SET DP013-DB2-ABEND                                 13720000
050631                               TO TRUE                            13730000
050632              PERFORM DP013-0000-PROCESS-ABEND                    13740000
050633     END-EVALUATE.                                                13750000
050634  EJECT                                                           13760000
050635                                                                  13770000
050636*----------------------------------------------------------------*13780000
050637*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *13790000
050638*----------------------------------------------------------------*13800000
050639                                                                  13810000
050640 4400-MOVE-COMMAREA-TO-SCREEN.                                    13820000
050650                                                                  13830000
050660     MOVE ASC-PO-NBR               TO APONUMO.                    13840000
050670     MOVE ASC-LAST-FCTRY-DTE       TO PV-DATE-BREAK.              13850000
050680     MOVE PV-DB-MM                 TO PV-DD-MM.                   13860000
050690     MOVE PV-DB-DD                 TO PV-DD-DD.                   13870000
050700     MOVE PV-DB-YY                 TO PV-DD-YY.                   13880000
050800     MOVE PV-DATE-DISPLAY          TO ALASEXTO.                   13890000
050900     MOVE ASC-STRT-FCTRY-DTE       TO PV-DATE-BREAK.              13900000
051000     MOVE PV-DB-MM                 TO PV-DD-MM.                   13910000
051100     MOVE PV-DB-DD                 TO PV-DD-DD.                   13920000
051200     MOVE PV-DB-YY                 TO PV-DD-YY.                   13930000
051300     MOVE PV-DATE-DISPLAY          TO ASTEXTO.                    13940000
051400     MOVE ASC-DC1                  TO ADCNBR1O.                   13950000
051500     MOVE ASC-DC2                  TO ADCNBR2O.                   13960000
051600     MOVE ASC-DC3                  TO ADCNBR3O.                   13970000
051700     MOVE ASC-SHIP-DATE            TO ASHIPDTO.                   13980000
051800     MOVE ASC-OTB                  TO AOTBPERO.                   13990000
051900     MOVE ASC-CANCEL-DATE          TO ACNCLDTO.                   14000000
052000     MOVE ASC-FOB-POINT            TO AFOBNMEO.                   14010000
052100     MOVE ASC-VENDOR               TO AVDRNAMO.                   14020000
052200     MOVE ASC-DEPT                 TO ADEPTNOO.                   14030000
052300     MOVE ASC-DECON-DATE1          TO ADECDT1O.                   14040000
052400     MOVE ASC-DECON-DATE2          TO ADECDT2O.                   14050000
052500     MOVE ASC-DECON-DATE3          TO ADECDT3O.                   14060000
052600     MOVE ASC-DC-DEL-DATE1         TO ADCDEL1O.                   14070000
052700     MOVE ASC-DC-DEL-DATE2         TO ADCDEL2O.                   14080000
052800     MOVE ASC-DC-DEL-DATE3         TO ADCDEL3O.                   14090000
052900     MOVE ASC-FST-RCPT-DT1         TO AFSTRCP1O.                  14100000
053000     MOVE ASC-FST-RCPT-DT2         TO AFSTRCP2O.                  14110000
053100     MOVE ASC-FST-RCPT-DT3         TO AFSTRCP3O.                  14120000
053200     MOVE ASC-LST-RCPT-DT1         TO ALSTRCP1O.                  14130000
053300     MOVE ASC-LST-RCPT-DT2         TO ALSTRCP2O.                  14140000
053400     MOVE ASC-LST-RCPT-DT3         TO ALSTRCP3O.                  14150000
053410     MOVE ASC-FST-VFD-DT1          TO AFSTVFD1O.                  14160000
053420     MOVE ASC-FST-VFD-DT2          TO AFSTVFD2O.                  14170000
053430     MOVE ASC-FST-VFD-DT3          TO AFSTVFD3O.                  14180000
053440     MOVE ASC-LST-VFD-DT1          TO ALSTVFD1O.                  14190000
053450     MOVE ASC-LST-VFD-DT2          TO ALSTVFD2O.                  14200000
053460     MOVE ASC-LST-VFD-DT3          TO ALSTVFD3O.                  14210000
053470     MOVE ASC-UNT-ORD1             TO AUNORD1O.                   14220000
053480     MOVE ASC-UNT-ORD2             TO AUNORD2O.                   14230000
053490     MOVE ASC-UNT-ORD3             TO AUNORD3O.                   14240000
053496     ADD  ASC-UNT-VFD1             TO ASC-TOT-VFD                 14250000
053497     ADD  ASC-UNT-VFD2             TO ASC-TOT-VFD                 14260000
053498     ADD  ASC-UNT-VFD3             TO ASC-TOT-VFD                 14270000
           ADD  ASC-TOT-VFD              TO PO017-TOTVFD.               14280000
053521     MOVE ASC-UNT-VFD1             TO AUNVFD1O.                   14290000
053522     MOVE ASC-UNT-VFD1-C           TO AUNVFD1C.                   14300000
053523     MOVE ASC-UNT-VFD2             TO AUNVFD2O.                   14310000
053524     MOVE ASC-UNT-VFD2-C           TO AUNVFD2C.                   14320000
053525     MOVE ASC-UNT-VFD3             TO AUNVFD3O.                   14330000
053526     MOVE ASC-UNT-VFD3-C           TO AUNVFD3C.                   14340000
053527     MOVE ASC-PCT-RCD1-N           TO PV-TREC-PCT1.               14350000
053531     MOVE ASC-PCT-RCD1-SIGN        TO PV-TREC-PCT1-SIGN.          14360000
053535     MOVE ASC-PCT-RCD2-N           TO PV-TREC-PCT2.               14370000
053536     MOVE ASC-PCT-RCD2-SIGN        TO PV-TREC-PCT2-SIGN.          14380000
053539     MOVE ASC-PCT-RCD3-N           TO PV-TREC-PCT3.               14390000
053540     MOVE ASC-PCT-RCD3-SIGN        TO PV-TREC-PCT3-SIGN.          14400000
053542     MOVE PV-NORMAL-TOTALS         TO MR-TOTAL-LINE.              14410000
053550                                                                  14420000
053600   EJECT                                                          14430000
053700                                                                  14440000
050640 4401-PREP-INTERAPPL-COMMAREA.                                    14450000
050650                                                                  14460000
050660     MOVE ASC-PO-NBR               TO TR105-PO-NBR.               14470000
                                                                        14480000
053800*----------------------------------------------------------------*14490000
053900* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *14500000
054000*----------------------------------------------------------------*14510000
054100 5000-RETRIEVE-MAXDATES.                                          14520000
054200     PERFORM                                                      14530000
054300         WITH TEST AFTER                                          14540000
054400         VARYING PV-RETRY-COUNTER                                 14550000
054500         FROM 1 BY 1                                              14560000
054600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14570000
054700             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              14580000
054800             OR (SQLCODE = -305))                                 14590000
054900           EXEC SQL                                               14600000
055000             SELECT MAX(F.STATUS_DTE)                             14610000
055100             INTO :PV-SHIPST-ETA-DATE                             14620000
055200             FROM TSHIPMT A,                                      14630000
055300                  TSHPTPO B,                                      14640000
055400                  TTRIPST C,                                      14650000
055500                  TSHIPST F                                       14660000
055600             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  14670000
055700               AND A.SHIPT_ID = B.SHIPT_ID                        14680000
055800               AND C.TRIP_ID = A.TRIP_ID                          14690000
055900               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                14700000
056000               AND F.SHIPT_STATUS_CDE = 'AG'                      14710000
056010               AND F.SHIPT_ID = A.SHIPT_ID                        14720000
056100           END-EXEC                                               14730000
056200       EVALUATE TRUE                                              14740000
056300           WHEN SQLCODE = +100                                    14750000
056400           WHEN SQLCODE = -305                                    14760000
056500               MOVE SPACES TO PV-SHIPST-ETA-DATE                  14770000
056600           WHEN SQLCODE = ZERO                                    14780000
056700           WHEN SQLCODE = -904                                    14790000
056710           WHEN SQLCODE = -913                                    14800000
056720               CONTINUE                                           14810000
056730           WHEN SQLWARN0 NOT = SPACES                             14820000
056740           WHEN SQLCODE < ZERO                                    14830000
056750           WHEN SQLCODE > ZERO                                    14840000
056751               MOVE '5000-RETRIEVE-MAXDATES'                      14850000
056752                                 TO DP013-PARAGRAPH               14860000
056753               MOVE 'SQL ERROR GET MAX DATES'                     14870000
056754                                 TO DP013-MESSAGE-TEXT (1)        14880000
056755               MOVE SQLCA        TO DP013-SQLCA                   14890000
056756               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       14900000
056757               SET DP013-DB2-ABEND                                14910000
056758                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14920000
056759               PERFORM DP013-0000-PROCESS-ABEND                   14930000
056760       END-EVALUATE                                               14940000
056761      END-PERFORM.                                                14950000
056762                                                                  14960000
056763      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       14970000
056764       MOVE '5000-RETRIEVE-MAXDATES'                              14980000
056765                                 TO DP013-PARAGRAPH               14990000
056766       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     15000000
056767                                 TO DP013-MESSAGE-TEXT (1)        15010000
056768       MOVE SQLCA                TO DP013-SQLCA                   15020000
056769       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       15030000
056770       SET DP013-DB2-ABEND                                        15040000
056771           DP013-XCTL-DISPLAY-RESTART                             15050000
056772                                 TO TRUE                          15060000
056773       PERFORM DP013-0000-PROCESS-ABEND                           15070000
056774      END-IF.                                                     15080000
056775                                                                  15090000
056845*----------------------------------------------------------------*15100000
056846* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *15110000
056847*----------------------------------------------------------------*15120000
056848 5020-RETRIEVE-MAXDATES.                                          15130000
056849     PERFORM                                                      15140000
056850         WITH TEST AFTER                                          15150000
056851         VARYING PV-RETRY-COUNTER                                 15160000
056852         FROM 1 BY 1                                              15170000
056853         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15180000
056854             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              15190000
056855             OR (SQLCODE = -305))                                 15200000
056856           EXEC SQL                                               15210000
056857             SELECT MAX(F.STATUS_DTE)                             15220000
056858             INTO :SHIPST-STATUS-DTE                              15230000
056859             FROM TSHIPMT A,                                      15240000
056860                  TSHPTPO B,                                      15250000
056861                  TTRIPST C,                                      15260000
056862                  TSHIPST F                                       15270000
056863             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  15280000
056864               AND A.SHIPT_ID = B.SHIPT_ID                        15290000
056865               AND C.TRIP_ID = A.TRIP_ID                          15300000
056866               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                15310000
056867               AND F.SHIPT_STATUS_CDE = 'AM'                      15320000
056868               AND F.SHIPT_ID = A.SHIPT_ID                        15330000
056869           END-EXEC                                               15340000
056870       EVALUATE TRUE                                              15350000
056871           WHEN SQLCODE = +100                                    15360000
056872           WHEN SQLCODE = -305                                    15370000
056873             PERFORM 5025-GET-AF-STATUS-DTE                       15380000
056876           WHEN SQLCODE = ZERO                                    15390000
056877           WHEN SQLCODE = -904                                    15400000
056878           WHEN SQLCODE = -913                                    15410000
056879               CONTINUE                                           15420000
056880           WHEN SQLWARN0 NOT = SPACES                             15430000
056881           WHEN SQLCODE < ZERO                                    15440000
056882           WHEN SQLCODE > ZERO                                    15450000
056883               MOVE '5020-RETRIEVE-MAXDATES'                      15460000
056884                                 TO DP013-PARAGRAPH               15470000
056885               MOVE 'SQL ERROR GET MAX DATES'                     15480000
056886                                 TO DP013-MESSAGE-TEXT (1)        15490000
056887               MOVE SQLCA        TO DP013-SQLCA                   15500000
056888               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       15510000
056889               SET DP013-DB2-ABEND                                15520000
056890                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15530000
056891               PERFORM DP013-0000-PROCESS-ABEND                   15540000
056892       END-EVALUATE                                               15550000
056893      END-PERFORM.                                                15560000
056894                                                                  15570000
056895      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       15580000
056896       MOVE '5020-RETRIEVE-MAXDATES'                              15590000
056897                                 TO DP013-PARAGRAPH               15600000
056898       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     15610000
056899                                 TO DP013-MESSAGE-TEXT (1)        15620000
056900       MOVE SQLCA                TO DP013-SQLCA                   15630000
056901       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       15640000
056902       SET DP013-DB2-ABEND                                        15650000
056903           DP013-XCTL-DISPLAY-RESTART                             15660000
056904                                 TO TRUE                          15670000
056905       PERFORM DP013-0000-PROCESS-ABEND                           15680000
056906      END-IF.                                                     15690000
056907                                                                  15700000
056908  EJECT                                                           15710000
056909                                                                  15720000
056910*----------------------------------------------------------------*15730000
056911* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *15740000
056912*----------------------------------------------------------------*15750000
056913 5025-GET-AF-STATUS-DTE.                                          15760000
056914     PERFORM                                                      15770000
056915         WITH TEST AFTER                                          15780000
056916         VARYING PV-RETRY-COUNTER                                 15790000
056917         FROM 1 BY 1                                              15800000
056918         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15810000
056919             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              15820000
056920             OR (SQLCODE = -305))                                 15830000
056921           EXEC SQL                                               15840000
056922             SELECT MAX(F.STATUS_DTE)                             15850000
056923             INTO :SHIPST-STATUS-DTE                              15860000
056924             FROM TSHIPMT A,                                      15870000
056925                  TSHPTPO B,                                      15880000
056926                  TTRIPST C,                                      15890000
056927                  TSHIPST F                                       15900000
056928             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  15910000
056929               AND A.SHIPT_ID = B.SHIPT_ID                        15920000
056930               AND C.TRIP_ID = A.TRIP_ID                          15930000
056931               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                15940000
056932               AND F.SHIPT_STATUS_CDE = 'AF'                      15950000
056933               AND F.SHIPT_ID = A.SHIPT_ID                        15960000
056934           END-EXEC                                               15970000
056935       EVALUATE TRUE                                              15980000
056936           WHEN SQLCODE = +100                                    15990000
056937           WHEN SQLCODE = -305                                    16000000
056938             MOVE SPACES TO SHIPST-STATUS-DTE                     16010000
056939           WHEN SQLCODE = ZERO                                    16020000
056940           WHEN SQLCODE = -904                                    16030000
056941           WHEN SQLCODE = -913                                    16040000
056942               CONTINUE                                           16050000
056943           WHEN SQLWARN0 NOT = SPACES                             16060000
056944           WHEN SQLCODE < ZERO                                    16070000
056945           WHEN SQLCODE > ZERO                                    16080000
056946               MOVE '5025-GET-AF-STATUS-DTE'                      16090000
056947                                 TO DP013-PARAGRAPH               16100000
056948               MOVE 'SQL ERROR GET MAX DATES'                     16110000
056949                                 TO DP013-MESSAGE-TEXT (1)        16120000
056950               MOVE SQLCA        TO DP013-SQLCA                   16130000
056951               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       16140000
056952               SET DP013-DB2-ABEND                                16150000
056953                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16160000
056954               PERFORM DP013-0000-PROCESS-ABEND                   16170000
056955       END-EVALUATE                                               16180000
056956      END-PERFORM.                                                16190000
056957                                                                  16200000
056958      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16210000
056959       MOVE '5025-GET-AF-STATUS-DTE'                              16220000
056960                                 TO DP013-PARAGRAPH               16230000
056961       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     16240000
056962                                 TO DP013-MESSAGE-TEXT (1)        16250000
056963       MOVE SQLCA                TO DP013-SQLCA                   16260000
056964       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       16270000
056965       SET DP013-DB2-ABEND                                        16280000
056966           DP013-XCTL-DISPLAY-RESTART                             16290000
056967                                 TO TRUE                          16300000
056968       PERFORM DP013-0000-PROCESS-ABEND                           16310000
056969      END-IF.                                                     16320000
056970                                                                  16330000
056971  EJECT                                                           16340000
056972                                                                  16350000
056973*----------------------------------------------------------------*16360000
056974* RETRIEVE THE MAX AND MIN RCPT DATES PER DC                     *16370000
056975*----------------------------------------------------------------*16380000
056976 5030-RETRIEVE-RCPTDATES.                                         16390000
056977     PERFORM                                                      16400000
056978         WITH TEST AFTER                                          16410000
056979         VARYING PV-RETRY-COUNTER                                 16420000
056980         FROM 1 BY 1                                              16430000
056981         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16440000
056982             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              16450000
056983             OR (SQLCODE = -305))                                 16460000
056984           EXEC SQL                                               16470000
056985             SELECT MAX(E.STATUS_DTE),                            16480000
056986                    MIN(E.STATUS_DTE)                             16490000
056987             INTO  :PV-MAX-STATUS-DTE                             16500000
056988                  ,:PV-MIN-STATUS-DTE                             16510000
056989             FROM   TSHIPMT A,                                    16520000
056990                    TSHPTPO B,                                    16530000
056991                    TTRIPST C,                                    16540000
056992                    TSHIPST E                                     16550000
056993             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  16560000
056994               AND A.SHIPT_ID = B.SHIPT_ID                        16570000
056995               AND C.TRIP_ID = A.TRIP_ID                          16580000
056996               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                16590000
056997               AND E.SHIPT_STATUS_CDE = 'AR'                      16600000
056998               AND E.SHIPT_ID = A.SHIPT_ID                        16610000
056999           END-EXEC                                               16620000
057000       EVALUATE TRUE                                              16630000
057001           WHEN SQLCODE = +100                                    16640000
057002           WHEN SQLCODE = -305                                    16650000
057003             MOVE SPACES TO PV-MAX-STATUS-DTE PV-MIN-STATUS-DTE   16660000
057004           WHEN SQLCODE = ZERO                                    16670000
057005           WHEN SQLCODE = -904                                    16680000
057006           WHEN SQLCODE = -913                                    16690000
057007               CONTINUE                                           16700000
057008           WHEN SQLWARN0 NOT = SPACES                             16710000
057009           WHEN SQLCODE < ZERO                                    16720000
057010           WHEN SQLCODE > ZERO                                    16730000
057011               MOVE '5030-RETRIEVE-RCPTDATES'                     16740000
057012                                 TO DP013-PARAGRAPH               16750000
057013               MOVE 'SQL ERROR GET MAX AND MIN RCPT DATES'        16760000
057014                                 TO DP013-MESSAGE-TEXT (1)        16770000
057015               MOVE SQLCA        TO DP013-SQLCA                   16780000
057016               MOVE 'TSHIPST'   TO DP013-DB2-TABLE-NAME (1)       16790000
057017               SET DP013-DB2-ABEND                                16800000
057018                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16810000
057019               PERFORM DP013-0000-PROCESS-ABEND                   16820000
057020       END-EVALUATE                                               16830000
057021      END-PERFORM.                                                16840000
057022                                                                  16850000
057023      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16860000
057024       MOVE '5030-RETRIEVE-RCPTDATES'                             16870000
057025                                 TO DP013-PARAGRAPH               16880000
057026       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCPT DTES'    16890000
057027                                 TO DP013-MESSAGE-TEXT (1)        16900000
057028       MOVE SQLCA                TO DP013-SQLCA                   16910000
057029       MOVE 'TSHIPST'           TO DP013-DB2-TABLE-NAME (1)       16920000
057030       SET DP013-DB2-ABEND                                        16930000
057031           DP013-XCTL-DISPLAY-RESTART                             16940000
057032                                 TO TRUE                          16950000
057033       PERFORM DP013-0000-PROCESS-ABEND                           16960000
057034      END-IF.                                                     16970000
057035                                                                  16980000
057036 EJECT                                                            16990000
057037*----------------------------------------------------------------*17000000
057038* RETRIEVE THE MAX AND MIN VERIFIED DATES PER DC                 *17010000
057039*----------------------------------------------------------------*17020000
057040 5040-RETRIEVE-VERDATES.                                          17030000
057041     PERFORM                                                      17040000
057042         WITH TEST AFTER                                          17050000
057043         VARYING PV-RETRY-COUNTER                                 17060000
057044         FROM 1 BY 1                                              17070000
057045         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17080000
057046             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              17090000
057047             OR (SQLCODE = -305))                                 17100000
057048           EXEC SQL                                               17110000
057049             SELECT MAX(DATE(VERFYD_TMST)),                       17120000
057050                    MIN(DATE(VERFYD_TMST))                        17130000
057051             INTO  :PV-MAX-VERIFD-DTE                             17140000
057052                  ,:PV-MIN-VERIFD-DTE                             17150000
057053             FROM TRECEIV                                         17160000
057057             WHERE ORD_NBR = :ASC-KEY-PO-NUMBER                   17170000
057058               AND VER_STATUS_CDE = 'A'                           17180000
057059               AND STATUS_CDE = 'VE'                              17190000
057060               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  17200000
057063           END-EXEC                                               17210000
057064       EVALUATE TRUE                                              17220000
057065           WHEN SQLCODE = +100                                    17230000
057066           WHEN SQLCODE = -305                                    17240000
057068             MOVE SPACES TO PV-MAX-VERIFD-DTE PV-MIN-VERIFD-DTE   17250000
057069           WHEN SQLCODE = ZERO                                    17260000
057070           WHEN SQLCODE = -904                                    17270000
057071           WHEN SQLCODE = -913                                    17280000
057072               CONTINUE                                           17290000
057073           WHEN SQLWARN0 NOT = SPACES                             17300000
057074           WHEN SQLCODE < ZERO                                    17310000
057075           WHEN SQLCODE > ZERO                                    17320000
057076               MOVE '5040-RETRIEVE-VERDATES'                      17330000
057077                                 TO DP013-PARAGRAPH               17340000
057078               MOVE 'SQL ERROR GET MAX AND MIN VERFD DATES'       17350000
057079                                 TO DP013-MESSAGE-TEXT (1)        17360000
057080               MOVE SQLCA        TO DP013-SQLCA                   17370000
057081               MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)       17380000
057082               SET DP013-DB2-ABEND                                17390000
057083                   DP013-XCTL-DISPLAY-RESTART TO TRUE             17400000
057084               PERFORM DP013-0000-PROCESS-ABEND                   17410000
057085       END-EVALUATE                                               17420000
057086      END-PERFORM.                                                17430000
057087                                                                  17440000
057088      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       17450000
057089       MOVE '5040-RETRIEVE-VERDATES'                              17460000
057090                                 TO DP013-PARAGRAPH               17470000
057091       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET VERFD DTES'   17480000
057092                                 TO DP013-MESSAGE-TEXT (1)        17490000
057093       MOVE SQLCA                TO DP013-SQLCA                   17500000
057094       MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)       17510000
057095       SET DP013-DB2-ABEND                                        17520000
057096           DP013-XCTL-DISPLAY-RESTART                             17530000
057097                                 TO TRUE                          17540000
057098       PERFORM DP013-0000-PROCESS-ABEND                           17550000
057099      END-IF.                                                     17560000
057100                                                                  17570000
057101 EJECT                                                            17580000
057102*----------------------------------------------------------------*17590000
057103* RETRIEVE THE QTY PER DC ORDERED                                *17600000
057104*----------------------------------------------------------------*17610000
057105 5050-RETRIEVE-UNITS-ORD.                                         17620000
057106     PERFORM                                                      17630000
057107         WITH TEST AFTER                                          17640000
057108         VARYING PV-RETRY-COUNTER                                 17650000
057109         FROM 1 BY 1                                              17660000
057110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17670000
057111             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              17680000
057112             OR (SQLCODE = -305))                                 17690000
057113           EXEC SQL                                               17700000
057114             SELECT SUM(CURR_SPLIT_QTY)                           17710000
057116             INTO  :ALLPLN-CURR-SPLIT-QTY:PV-QTY-NULL             17720000
057117             FROM TPURITM A,                                      17730000
057118                  TALLPLN B                                       17740000
057119             WHERE A.PO_NBR   = :ASC-KEY-PO-NUMBER                17750000
057122               AND B.DEST_NBR = :PV-OPER-UNT-ID                   17760000
057129               AND A.VER_STATUS_CDE = 'A'                         17770000
057130               AND A.STATUS_CDE NOT IN ('CA')                     17780000
057131               AND A.PO_NBR         = B.PO_NBR                    17790000
057132               AND A.PO_LNE_NBR     = B.PO_LNE_NBR                17800000
057134           END-EXEC                                               17810000
057135       EVALUATE TRUE                                              17820000
057136           WHEN SQLCODE = +100                                    17830000
057137           WHEN SQLCODE = -305                                    17840000
057138             MOVE 0 TO ALLPLN-CURR-SPLIT-QTY                      17850000
057139           WHEN SQLCODE = ZERO                                    17860000
057140           WHEN SQLCODE = -904                                    17870000
057141           WHEN SQLCODE = -913                                    17880000
057142               CONTINUE                                           17890000
057143           WHEN SQLWARN0 NOT = SPACES                             17900000
057144           WHEN SQLCODE < ZERO                                    17910000
057145           WHEN SQLCODE > ZERO                                    17920000
057146               MOVE '5050-RETRIEVE-UNITS-ORD'                     17930000
057147                                 TO DP013-PARAGRAPH               17940000
057148               MOVE 'SQL ERROR GET UNITS ORDERED'                 17950000
057149                                 TO DP013-MESSAGE-TEXT (1)        17960000
057150               MOVE SQLCA        TO DP013-SQLCA                   17970000
057151               MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)       17980000
057152               MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)       17990000
057153               SET DP013-DB2-ABEND                                18000000
057154                   DP013-XCTL-DISPLAY-RESTART TO TRUE             18010000
057155               PERFORM DP013-0000-PROCESS-ABEND                   18020000
057156       END-EVALUATE                                               18030000
057157      END-PERFORM.                                                18040000
057158                                                                  18050000
057159      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       18060000
057160       MOVE '5050-RETRIEVE-UNITS-ORD'                             18070000
057161                                 TO DP013-PARAGRAPH               18080000
057162       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET UNITS ORDERED'18090000
057163                                 TO DP013-MESSAGE-TEXT (1)        18100000
057164       MOVE SQLCA                TO DP013-SQLCA                   18110000
057165       MOVE 'TALLPLN'           TO DP013-DB2-TABLE-NAME (1)       18120000
057166       MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (2)       18130000
057167       SET DP013-DB2-ABEND                                        18140000
057168           DP013-XCTL-DISPLAY-RESTART                             18150000
057169                                 TO TRUE                          18160000
057170       PERFORM DP013-0000-PROCESS-ABEND                           18170000
057171      END-IF.                                                     18180000
057172                                                                  18190000
057173 EJECT                                                            18200000
057174*----------------------------------------------------------------*18210000
057175* RETRIEVE THE RECEIVED QUANTITY FOR A DC.                       *18220000
057176*----------------------------------------------------------------*18230000
057177 5060-RETRIEVE-UNITS-VFD.                                         18240000
057178                                                                  18250000
057179     MOVE +0                       TO PV-DC-REC-QTY.              18260000
057180                                                                  18270000
057181     PERFORM                                                      18280000
057182         WITH TEST AFTER                                          18290000
057183         VARYING PV-RETRY-COUNTER                                 18300000
057184         FROM 1 BY 1                                              18310000
057185         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18320000
057186                   OR (SQLCODE = ZERO)                            18330000
057187                   OR (SQLCODE = 100))                            18340000
057188         EXEC SQL                                                 18350000
057189             SELECT SUM(AP_VERIFY_ITM_QTY)                        18360000
057190               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    18370000
057191               FROM TRECITM A,                                    18380000
057192                    TRECDIS B                                     18390000
057193              WHERE                                               18400000
057194                    A.ORD_NBR        = :ASC-KEY-PO-NUMBER         18410000
057195                AND A.VER_STATUS_CDE = 'A'                        18420000
057196                AND A.OPER_UNT_ID    = :PV-OPER-UNT-ID            18430000
057197                AND A.STATUS_CDE     = 'VE'                       18440000
057198                AND A.ORD_NBR        = B.ORD_NBR                  18450000
057199                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              18460000
057200                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              18470000
057201                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              18480000
057202                AND A.FCLTY_ID       = B.FCLTY_ID                 18490000
057203                AND B.VER_STATUS_CDE = 'A'                        18500000
057204         END-EXEC                                                 18510000
057205                                                                  18520000
057206         EVALUATE TRUE                                            18530000
057207             WHEN SQLCODE = ZERO                                  18540000
057208                 CONTINUE                                         18550000
057209             WHEN SQLCODE = +100                                  18560000
057210                 CONTINUE                                         18570000
057211             WHEN SQLCODE = -904                                  18580000
057212             WHEN SQLCODE = -913                                  18590000
057213                 CONTINUE                                         18600000
057214             WHEN SQLWARN0 NOT = SPACES                           18610000
057215             WHEN SQLCODE < ZERO                                  18620000
057216             WHEN SQLCODE > ZERO                                  18630000
057217                 MOVE '5060-RETRIEVE-UNITS-VFD'                   18640000
057218                                   TO DP013-PARAGRAPH             18650000
057219                 MOVE 'RETRIEVING RECEIVED QTY'                   18660000
057220                                   TO DP013-MESSAGE-TEXT (1)      18670000
057221                 MOVE SQLCA        TO DP013-SQLCA                 18680000
057222                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    18690000
057223                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    18700000
057224                 SET DP013-DB2-ABEND                              18710000
057225                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18720000
057226                 PERFORM DP013-0000-PROCESS-ABEND                 18730000
057227         END-EVALUATE                                             18740000
057228     END-PERFORM.                                                 18750000
057229*                                                                 18760000
057230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18770000
057231         MOVE '5060-RETRIEVE-UNITS-VFD' TO DP013-PARAGRAPH        18780000
057232         MOVE 'MAXIMUM RETRIES EXCEEDED'                          18790000
057233                                   TO DP013-MESSAGE-TEXT (1)      18800000
057234         MOVE SQLCA                TO DP013-SQLCA                 18810000
057235         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    18820000
057236         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    18830000
057237         SET DP013-DB2-ABEND                                      18840000
057238             DP013-XCTL-DISPLAY-RESTART                           18850000
057239                                   TO TRUE                        18860000
057240         PERFORM DP013-0000-PROCESS-ABEND                         18870000
057241     END-IF.                                                      18880000
057242                                                                  18890000
057243*----------------------------------------------------------------*18900000
057244* FIND OUT IF ANY RECEIVERS ARE STILL IN PROCESS FOR THIS DC     *18910000
057245*----------------------------------------------------------------*18920000
057246 5070-DETERMINE-IN-PROCESS.                                       18930000
057247     PERFORM                                                      18940000
057248         WITH TEST AFTER                                          18950000
057249         VARYING PV-RETRY-COUNTER                                 18960000
057250         FROM 1 BY 1                                              18970000
057251         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18980000
057252             OR (SQLCODE = ZERO) OR (SQLCODE = +100) OR           18990000
057253                (SQLCODE = -305))                                 19000000
057254           EXEC SQL                                               19010000
057261             SELECT MAX(REC_SEQ_NBR)                              19020000
057262             INTO :RECITM-REC-SEQ-NBR                             19030000
057263             FROM TRECITM                                         19040000
057264             WHERE ORD_NBR =: ASC-KEY-PO-NUMBER                   19050000
057265               AND VER_STATUS_CDE = 'A'                           19060000
057266               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  19070000
057267               AND STATUS_CDE = 'IP'                              19080000
057268               AND CRE_TMST IN                                    19090000
057269                       (SELECT MAX(CRE_TMST)                      19100000
057270                        FROM TRECITM                              19110000
057271                        WHERE ORD_NBR = : ASC-KEY-PO-NUMBER       19120000
057272                          AND VER_STATUS_CDE = 'A'                19130000
057273                          AND OPER_UNT_ID = :PV-OPER-UNT-ID       19140000
057274                          AND STATUS_CDE = 'IP')                  19150000
057275           END-EXEC                                               19160000
057276       EVALUATE TRUE                                              19170000
057277           WHEN SQLCODE = ZERO                                    19180000
057278           WHEN SQLCODE = -305                                    19190000
057279           WHEN SQLCODE = +100                                    19200000
057280           WHEN SQLCODE = -904                                    19210000
057281           WHEN SQLCODE = -913                                    19220000
057282               CONTINUE                                           19230000
057283           WHEN SQLWARN0 NOT = SPACES                             19240000
057284           WHEN SQLCODE < ZERO                                    19250000
057285           WHEN SQLCODE > ZERO                                    19260000
057286               MOVE '5070-DETERMINE-IN-PROCESS'                   19270000
057287                                 TO DP013-PARAGRAPH               19280000
057288               MOVE 'SQL ERROR GET RCVR STATUS'                   19290000
057289                                 TO DP013-MESSAGE-TEXT (1)        19300000
057290               MOVE SQLCA        TO DP013-SQLCA                   19310000
057291               MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)       19320000
057292               SET DP013-DB2-ABEND                                19330000
057293                   DP013-XCTL-DISPLAY-RESTART TO TRUE             19340000
057294               PERFORM DP013-0000-PROCESS-ABEND                   19350000
057295       END-EVALUATE                                               19360000
057296      END-PERFORM.                                                19370000
057297                                                                  19380000
057298      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       19390000
057299       MOVE '5070-DETERMINE-IN-PROCESS'                           19400000
057300                                 TO DP013-PARAGRAPH               19410000
057301       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCVR STATUS'  19420000
057302                                 TO DP013-MESSAGE-TEXT (1)        19430000
057303       MOVE SQLCA                TO DP013-SQLCA                   19440000
057304       MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)       19450000
057305       SET DP013-DB2-ABEND                                        19460000
057306           DP013-XCTL-DISPLAY-RESTART                             19470000
057307                                 TO TRUE                          19480000
057308       PERFORM DP013-0000-PROCESS-ABEND                           19490000
057309      END-IF.                                                     19500000
057310                                                                  19510000
057311*----------------------------------------------------------------*19520000
057312*    ABEND PROCESSOR MODULE                                      *19530000
057320*----------------------------------------------------------------*19540000
057400     COPY DPPD013.                                                19550000
