000010 TITLE 'TEMP ASSOCIATE INQUIRY'.                                  00001000
000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    DLKCS403.                                         00020000
000300 AUTHOR.        THERESE RAMSEYER.                                 00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  JANUARY 2004.                                     00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*----------------------------------------------------------------*00080000
000900*                                                                *00090000
001000*    TRANID      - D403                                          *00100000
001100*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2               *00110000
001200*    DESCRIPTION - TEMP ASSOC INQUIRY PROGRAM                    *00120000
001300*    MAPSET      - DLKM403                                       *00130000
001400*                                                                *00140000
001500*    DISPLAYS TEMP ASSOCIATE INFORMATION                         *00150000
001600*                                                                *00160000
001610*    NAVIGATION: THIS SCREEN IS ENETERED FROM THE TEMP ASSOC LIST*00161000
001620*                                                                *00162000
001700*----------------------------------------------------------------*00170000
009461* CHANGED 10/24/2022    BY BOB MCASEY      WR: CHG0279137         00170102
009491* ADD COPYBOOK DPWS930 CHANGE CICS ARCHITECTURE CALL TO           00170202
009491* TO USE CICS ARCHITECTURE CA                                     00170302
001700*----------------------------------------------------------------*00171002
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 DATA DIVISION.                                                   00200000
002100/                                                                 00210000
002200 WORKING-STORAGE SECTION.                                         00220000
002300                                                                  00230000
002400 01  DK-DB2-KEYS.                                                 00240000
002500     05  DK-USER-CODE                 PIC  X(08) VALUE SPACE.     00250000
002510     05  DK-ADDED-BY-DC-NBR           PIC  9(04) VALUE 0.         00251000
002600                                                                  00260000
002700                                                                  00270000
002800 01  PA-PROGRAM-ACCUMULATORS.                                     00280000
002900     05  PA-INVOICED-COUNT            PIC S9(09) VALUE +0         00290000
003000                                                 COMP-3.          00300000
003100     05  PA-AP-VERIFIED-COUNT         PIC S9(09) VALUE +0         00310000
003200                                                 COMP-3.          00320000
003300                                                                  00330000
003400 01  PC-PROGRAM-CONSTANTS.                                        00340000
003500     05  PC-TRANS-ID                  PIC X(04)  VALUE 'D403'.    00350000
003600     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'DLKCS403'.00360000
003700     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'DLK403  '.00370000
003800     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'DLKM403 '.00380000
003900     05  PC-CURRENT-DATE          PIC X(10) VALUE SPACE.          00390000
004000     05  PC-N                         PIC X(01)  VALUE 'N'.       00400000
004100     05  PC-Y                         PIC X(01)  VALUE 'Y'.       00410000
004200     05  PC-APPL-MAP                  PIC S9(04) VALUE  +1        00420000
004300                                                 COMP.            00430000
004400     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00440000
004500                                                 COMP.            00450000
004600     05  PC-INTER-APPL-CODES.                                     00460000
004700         10  PC-INTER-APPL-CRIT-DETAIL PIC X(01) VALUE '1'.       00470000
004800         10  PC-INTER-APPL-LIST        PIC X(01) VALUE '2'.       00480000
004900         10  PC-INTER-APPL-ADD-TEMP    PIC X(01) VALUE '3'.       00490000
005100                                                                  00510000
005200*---------------------------------------------------------------* 00520000
005300* SYSTEM MESSAGES                                               * 00530000
005400*---------------------------------------------------------------* 00540000
005500     05  PC-TSYMSG-NUMBERS.                                       00550000
005600         10  PC-TSYMSG-00005          PIC 9(05)  VALUE 00005.     00560000
005700         10  PC-TSYMSG-00057          PIC 9(05)  VALUE 00057.     00570000
005800         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00580000
005900         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00590000
006000         10  PC-TSYMSG-00083          PIC 9(05)  VALUE 00083.     00600000
006100         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     00610000
006200         10  PC-TSYMSG-00330          PIC 9(05)  VALUE 00330.     00620000
006300         10  PC-TSYMSG-00737          PIC 9(05)  VALUE 00737.     00630000
006400         10  PC-TSYMSG-00789          PIC 9(05)  VALUE 00789.     00640000
006410         10  PC-TSYMSG-00984          PIC 9(05)  VALUE 00984.     00641000
006500         10  PC-TSYMSG-01090          PIC 9(05)  VALUE 01090.     00650000
006600                                                                  00660000
006700 01  PS-PROGRAM-SWITCHES.                                         00670000
006800     05  PS-ERROR-SW                  PIC X(01)   VALUE 'N'.      00680000
006900         88  PS-ERROR                             VALUE 'Y'.      00690000
007000         88  PS-NO-ERROR                          VALUE 'N'.      00700000
007100     05  PS-LIST-END-SW               PIC X(01)   VALUE 'N'.      00710000
007200         88  PS-LIST-END                          VALUE 'Y'.      00720000
007300         88  PS-NO-LIST-END                       VALUE 'N'.      00730000
007310     05  PS-SOFT-ABORT-ERROR-SW       PIC  X(01)  VALUE 'N'.      00731000
007320         88  PS-SOFT-ABORT-ERROR                  VALUE 'Y'.      00732000
007330         88  PS-NO-SOFT-ABORT-ERROR               VALUE 'N'.      00733000
007400                                                                  00740000
007500 01  PV-PROGRAM-VARIABLES.                                        00750000
007600     05  PV-DPKUT038                  PIC X(08)  VALUE 'DPKUT038'.00760000
007700     05  PV-DPKUT038-CA-LENGTH        PIC S9(04) VALUE +1237      00770000
007800                                                 COMP.            00780000
007900     05  PV-CICS-RESP                 PIC S9(04) VALUE +0         00790000
008000                                                 COMP SYNC.       00800000
008100     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00810000
008200                                                 COMP SYNC.       00820000
008300     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         00830000
008400                                                 COMP-3.          00840000
008500     05  PV-CURRENT-DATE              PIC X(06)  VALUE SPACE.     00850000
008510     05  PV-DATE-USA                  PIC X(10)  VALUE SPACE.     00851000
008520     05  PV-TIME-ISO                  PIC X(08)  VALUE SPACE.     00852000
008600     05  PV-DB2-TIMESTAMP             PIC  X(26).                 00860000
008610     05  PV-ADDED-BY-NAME             PIC  X(30).                 00861000
008620     05  PV-ADDED-BY-DC-NAME          PIC  X(30).                 00862000
008700     05  PV-OPER-UNT-ID               PIC 9(04).                  00870000
008800     05  PV-OPER-UNT-ID-X REDEFINES                               00880000
008900         PV-OPER-UNT-ID               PIC X(04).                  00890000
009000     05  PV-NULL-IND                  PIC S9(04)  VALUE +0        00900000
009100                                                  COMP SYNC.      00910000
009200                                                                  00920000
009300     05  PV-SOFT-ABORT-MSG.                                       00930000
009310         10  FILLER            PIC X(12) VALUE ' DLKCS403 - '.    00931000
009320         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       00932000
009330         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    00933000
009340         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    00934000
009350         10  PV-SOFT-PARAGRAPH PIC X(30).                         00935000
009360     05  PV-CICS-MSG-AREA2            PIC  X(100) VALUE SPACE.    00936000
009361     05  PV-COMMAREA-LENGTH           PIC S9(04) COMP VALUE ZERO. 00936100
009370                                                                  00937000
009400/                                                                 00940000
009500*----------------------------------------------------------------*00950000
009600*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *00960000
009700*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *00970000
009800*----------------------------------------------------------------*00980000
009900                                                                  00990000
010000     COPY DLWS008.                                                01000000
010100/                                                                 01010000
010200                                                                  01020000
010300*----------------------------------------------------------------*01030000
010400*    MAP LAYOUT                                                  *01040000
010500*----------------------------------------------------------------*01050000
010600                                                                  01060000
010700     COPY DLKM403.                                                01070000
010800                                                                  01080000
010900/                                                                 01090000
011000*----------------------------------------------------------------*01100000
011100**  ASSOCIATE INFO SUBROUTINE PARAMETERS                          01110000
011200*----------------------------------------------------------------*01120000
011300     COPY XLWS067.                                                01130000
011400                                                                  01140000
011500/                                                                 01150000
011600*----------------------------------------------------------------*01160000
011700*    ATTRIBUTE SETTINGS COPYBOOK.                                *01170000
011800*----------------------------------------------------------------*01180000
011900                                                                  01190000
012000     COPY DPWS015.                                                01200000
012100                                                                  01210000
012200/                                                                 01220000
012300*----------------------------------------------------------------*01230000
012400*    FUNCTION KEYS COPYBOOK                                      *01240000
012500*----------------------------------------------------------------*01250000
012600                                                                  01260000
012700     COPY DPWS016.                                                01270000
012800                                                                  01280000
012900/                                                                 01290000
013000*----------------------------------------------------------------*01300000
013100*    THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHIT.   *01310000
013200*    APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.       *01320000
013300*----------------------------------------------------------------*01330000
013400     COPY DPWS030.                                                01340000
1022RM     COPY DPWS930.                                                01341001
013500                                                                  01350000
013600/                                                                 01360000
013700*----------------------------------------------------------------*01370000
013800*    STANDARD COMMAREA.                                          *01380000
013900*----------------------------------------------------------------*01390000
014000                                                                  01400000
014100     COPY DPWS020.                                                01410000
014200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01420000
014300                                                                  01430000
014400*----------------------------------------------------------------*01440000
014500*    INTER-APPLICATION COMMAREA.                                 *01450000
014600*----------------------------------------------------------------*01460000
014700                                                                  01470000
014800         10  INTER-APPL-COMM-AREA PIC X(200).                     01480000
014900     COPY DLWS002.                                                01490000
015000                                                                  01500000
015100*----------------------------------------------------------------*01510000
015200*    SPECIFIC COMMMAREA FOR RCKCS223.                            *01520000
015300*----------------------------------------------------------------*01530000
015400         10  ASC-SPECIFIC-COMMAREA.                               01540000
015500             15  ASC-INT-APPL-FORMAT-IND   PIC X(01).             01550000
015600             15  ASC-USE-SELECTION-QUEUE-IND                      01560000
015700                                           PIC X(01).             01570000
015800                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        01580000
015900             15  ASC-SEL-QUEUE-NAME        PIC X(08).             01590000
016000             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01600000
016100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01610000
016200                                           PIC S9(09) COMP-3.     01620000
016300             15  ASC-SEL-SUB               PIC S9(04) COMP.       01630000
016400             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01640000
016500             15  ASC-MULT-SHIP-SW          PIC X(01).             01650000
016600                 88  ASC-MULT-SHIP               VALUE 'Y'.       01660000
016700                                                                  01670000
016800             15  ASC-KEY-FIELDS.                                  01680000
016900                 20  ASC-KEY-USER-CODE       PIC  X(08).          01690000
017000                 20  ASC-KEY-ADDED-BY-DC-NBR PIC  9(04).          01700000
017100                                                                  01710000
017200             15  ASC-SCREEN-FIELDS.                               01720000
017300                 20  ASC-FIRST-NAME          PIC X(20).           01730000
017400                 20  ASC-LAST-NAME           PIC X(30).           01740000
017500                 20  ASC-SIGNON-USERID       PIC X(08).           01750000
017600                 20  ASC-MAX-USER-CODE       PIC X(08).           01760000
017610                 20  ASC-ADDED-BY-ID         PIC X(08).           01761000
017700                 20  ASC-ADDED-BY-DC-NAME    PIC X(30).           01770000
017800                 20  ASC-ADDED-BY-NAME       PIC X(30).           01780000
017900                 20  ASC-DATE-ADDED          PIC X(10).           01790000
018000                 20  ASC-TIME-ADDED          PIC X(08).           01800000
018100                 20  ASC-ACTIVE-USER         PIC X(01).           01810000
018200                                                                  01820000
018300/                                                                 01830000
018400*----------------------------------------------------------------*01840000
018500*    ABEND PROCESSING COPYBOOK.                                  *01850000
018600*----------------------------------------------------------------*01860000
018700                                                                  01870000
018800     COPY DPWS013.                                                01880000
018900                                                                  01890000
019000/                                                                 01900000
019100*---------------------------------------------------------------* 01910000
019200*    DB2 AREA FOR COMMUNICATIONS                                * 01920000
019300*---------------------------------------------------------------* 01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE SQLCA                                           01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800/                                                                 01980000
019900*---------------------------------------------------------------* 01990000
020000*    DB2 AREA FOR THE TEMP ASSOCIATE TABLE                      * 02000000
020100*---------------------------------------------------------------* 02010000
020200     EXEC SQL                                                     02020000
020300          INCLUDE DLT00002                                        02030000
020400     END-EXEC.                                                    02040000
020500                                                                  02050000
020600/                                                                 02060000
020700*---------------------------------------------------------------* 02070000
020800*    DB2 AREA FOR THE LOCATION TABLE                            * 02080000
020900*---------------------------------------------------------------* 02090000
021000     EXEC SQL                                                     02100000
021100          INCLUDE XLT00010                                        02110000
021200     END-EXEC.                                                    02120000
021300/                                                                 02130000
021310                                                                  02131000
021400 LINKAGE SECTION.                                                 02140000
021500                                                                  02150000
021600 01  DFHCOMMAREA.                                                 02160000
021700     05  FILLER                       OCCURS  1 TO 4072 TIMES     02170000
021800                                      DEPENDING ON EIBCALEN.      02180000
021900         10  FILLER                   PIC X.                      02190000
022000                                                                  02200000
022100/                                                                 02210000
022200 PROCEDURE DIVISION.                                              02220000
022300                                                                  02230000
022400*----------------------------------------------------------------*02240000
022500*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *02250000
022600*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *02260000
022700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *02270000
022800*                                                                *02280000
022900*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *02290000
023000*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *02300000
023100*----------------------------------------------------------------*02310000
023200 0000-MAIN-MODULE.                                                02320000
023300     INITIALIZE DP030-CICS-API-FIELDS.                            02330000
023400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02340000
023500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02350000
023600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02360000
023700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02370000
023800     MOVE LENGTH OF DLK403I        TO DP030-MAP-LENGTH (1).       02380000
023900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02390000
024000     PERFORM 0001-CALL-CICS-ARCH-API.                             02400000
024100                                                                  02410000
024200     PERFORM 1000-CONTROL-PROCESSING.                             02420000
024300                                                                  02430000
024400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02440000
024500     PERFORM 0001-CALL-CICS-ARCH-API.                             02450000
024600                                                                  02460000
024700/                                                                 02470000
024800 0001-CALL-CICS-ARCH-API.                                         02480000
024900                                                                  02490000
025000     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02500001
025100                                     DFHCOMMAREA                  02510001
025200                                     DP030-CICS-API-FIELDS        02520001
025300                                     DP020-STANDARD-COMMAREA      02530001
025400                                     DLK403I.                     02540001
025500                                                                  02550000
025600     IF  DP030-RC-CALL-SUCCESSFUL                                 02560000
025700         CONTINUE                                                 02570000
025800     ELSE                                                         02580000
025900         SET DP013-NO-ROLLBACK                                    02590000
026000             DP013-XCTL-DISPLAY-RESTART                           02600000
026100             DP013-CICS-ABEND      TO TRUE                        02610000
026200         MOVE 'BEFORE 0000-MAIN-MODULE'                           02620000
026300                                   TO DP013-PARAGRAPH             02630000
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02651001
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02652001
026600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02660000
026700         PERFORM DP013-0000-PROCESS-ABEND                         02670000
026800     END-IF.                                                      02680000
026900                                                                  02690000
027000/                                                                 02700000
027100*----------------------------------------------------------------*02710000
027200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02720000
027300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02730000
027400*----------------------------------------------------------------*02740000
027500                                                                  02750000
027600 1000-CONTROL-PROCESSING.                                         02760000
027700                                                                  02770000
027800     EVALUATE TRUE                                                02780000
027900         WHEN DP020-NEXT-ACT-INITIAL                              02790000
028000              PERFORM 1100-FIND-OBJECT-KEYS                       02800000
028100              IF  PS-ERROR                                        02810000
028200                  CONTINUE                                        02820000
028300              ELSE                                                02830000
028400                  PERFORM 4000-BUILD-INITIAL-PANEL                02840000
028500                  PERFORM 3200-RESET-ATTRIBUTES                   02850000
028600              END-IF                                              02860000
028700                                                                  02870000
028800         WHEN DP020-NEXT-ACT-READ-MAP                             02880000
028900              PERFORM 2000-PROCESS-PANEL                          02890000
029000                                                                  02900000
029100         WHEN DP020-NEXT-ACT-RETURN                               02910000
029200              MOVE ASC-KEY-USER-CODE      TO                      02920000
029300                                      DK-USER-CODE                02930000
029400              MOVE ASC-KEY-ADDED-BY-DC-NBR TO                     02940000
029500                                      DK-ADDED-BY-DC-NBR          02950000
029800              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                02980000
029900              PERFORM 3200-RESET-ATTRIBUTES                       02990000
030000                                                                  03000000
030100         WHEN OTHER                                               03010000
030200              SET DP013-LOGIC-ABEND                               03020000
030300                  DP013-NO-ROLLBACK TO TRUE                       03030000
030400              MOVE '1000-CONTROL-PROCESSING'                      03040000
030500                                    TO DP013-PARAGRAPH            03050000
030600              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  03060000
030700                                    TO DP013-MESSAGE-TEXT(1)      03070000
030800              MOVE DP020-NEXT-APPL-ACTIVITY                       03080000
030900                                    TO DP013-MESSAGE-TEXT(2)      03090000
031000              PERFORM DP013-0000-PROCESS-ABEND                    03100000
031100     END-EVALUATE.                                                03110000
031200                                                                  03120000
031300/                                                                 03130000
031400*----------------------------------------------------------------*03140000
031500*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *03150000
031600*    INTER-APPLICATION FORMAT CODE.                              *03160000
031700*----------------------------------------------------------------*03170000
031800 1100-FIND-OBJECT-KEYS.                                           03180000
031900                                                                  03190000
032000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03200000
032100                                                                  03210000
032200     MOVE DP020-INT-APPL-FORMAT-IND                               03220000
032300                                   TO ASC-INT-APPL-FORMAT-IND.    03230000
032301                                                                  03230100
032500*    EVALUATE DP020-INT-APPL-FORMAT-IND                           03250000
032600*        WHEN PC-INTER-APPL-CRIT-DETAIL                           03260000
037000*        WHEN PC-INTER-APPL-LIST                                  03700000
037100*        WHEN PC-INTER-APPL-ADD-TEMP                              03710000
037300             IF  DL002-NUMBER-OF-SELECTED-ITEMS > ZERO            03730000
037400                 SET ASC-USE-SELECTION-QUEUE                      03740000
037500                                   TO TRUE                        03750000
037600                 MOVE DL002-NUMBER-OF-SELECTED-ITEMS              03760000
037700                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03770000
037800                 MOVE DL002-NUMBER-OF-TS-ITEMS                    03780000
037900                                   TO ASC-NUMBER-OF-TS-ITEMS      03790000
038000                 MOVE DL002-SEL-QUEUE-NAME                        03800000
038100                                   TO ASC-SEL-QUEUE-NAME          03810000
038200                 PERFORM 1120-PREPARE-LIST-ENTRY                  03820000
039000             ELSE                                                 03900000
039100                 SET DP030-OVERRIDE-GO                            03910000
039200                                   TO TRUE                        03920000
039300                 MOVE PC-TSYMSG-00057                             03930000
039400                                   TO DP020-MSG-NUMBER            03940000
039500                 SET DP020-MSG-WARNING                            03950000
039600                     DP020-NEXT-ACT-APPL-ERROR                    03960000
039700                                   TO TRUE                        03970000
039800             END-IF.                                              03980000
039900                                                                  03990000
040000*        WHEN OTHER                                               04000000
040100*            MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            04010000
040200*            SET DP020-MSG-FATAL                                  04020000
040300*                DP020-NEXT-ACT-APPL-ERROR                        04030000
040400*                                  TO TRUE                        04040000
040500*    END-EVALUATE.                                                04050000
040600                                                                  04060000
040700/                                                                 04070000
040800*----------------------------------------------------------------*04080000
040900*    ENTRY IS FROM A LIST.  GET THE RECEIVER NUMBER FROM THE     *04090000
041000*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *04100000
041100*----------------------------------------------------------------*04110000
041200 1120-PREPARE-LIST-ENTRY.                                         04120000
041300                                                                  04130000
041400     MOVE DL008-MAX-ITEMS          TO ASC-SEL-SUB.                04140000
041500     MOVE ZERO                     TO ASC-SEL-ITEM.               04150000
041600     PERFORM 2110-GET-NEXT-RECORD.                                04160000
041700                                                                  04170000
041800/                                                                 04180000
041900*----------------------------------------------------------------*04190000
042000*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*04200000
042100*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*04210000
042200*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *04220000
042300*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *04230000
042400*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *04240000
042500*----------------------------------------------------------------*04250000
042600                                                                  04260000
042700 2000-PROCESS-PANEL.                                              04270000
042800                                                                  04280000
042900     EVALUATE TRUE                                                04290000
043000                                                                  04300000
043100         WHEN DP020-SRC-AID = DP016-CLEAR                         04310000
043200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04320000
043300                                                                  04330000
043400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04340000
043500             PERFORM 4000-BUILD-INITIAL-PANEL                     04350000
043600             PERFORM 3200-RESET-ATTRIBUTES                        04360000
043700                                                                  04370000
043800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04380000
043900             IF  ASC-USE-SELECTION-QUEUE                          04390000
044000                 PERFORM 2110-GET-NEXT-RECORD                     04400000
044100                 IF PS-LIST-END                                   04410000
044200                    SET PS-NO-LIST-END                            04420000
044300                                   TO TRUE                        04430000
044400                 ELSE                                             04440000
044500                    PERFORM 4000-BUILD-INITIAL-PANEL              04450000
044600                    PERFORM 3200-RESET-ATTRIBUTES                 04460000
044700                 END-IF                                           04470000
044800             ELSE                                                 04480000
044900*                --- BOTTOM OF LIST ---                           04490000
045000                 MOVE PC-TSYMSG-00070                             04500000
045100                                   TO DP020-MSG-NUMBER            04510000
045200                 SET DP020-MSG-INFORMATIONAL                      04520000
045300                     PS-LIST-END   TO TRUE                        04530000
045400             END-IF                                               04540000
045500                                                                  04550000
045600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04560000
045700             IF  ASC-USE-SELECTION-QUEUE                          04570000
045800                 PERFORM 2120-GET-PREV-RECORD                     04580000
045900                 IF PS-LIST-END                                   04590000
046000                    SET PS-NO-LIST-END                            04600000
046100                                   TO TRUE                        04610000
046200                 ELSE                                             04620000
046300                    PERFORM 4000-BUILD-INITIAL-PANEL              04630000
046400                    PERFORM 3200-RESET-ATTRIBUTES                 04640000
046500                 END-IF                                           04650000
046600             ELSE                                                 04660000
046700*                --- TOP OF LIST ---                              04670000
046800                 MOVE PC-TSYMSG-00069                             04680000
046900                                   TO DP020-MSG-NUMBER            04690000
047000                 SET DP020-MSG-INFORMATIONAL                      04700000
047100                     PS-LIST-END   TO TRUE                        04710000
047200             END-IF                                               04720000
047300                                                                  04730000
047400         WHEN OTHER                                               04740000
047500             PERFORM 2100-CHECK-FUNCTION-KEY                      04750000
047600     END-EVALUATE.                                                04760000
047700                                                                  04770000
047800/                                                                 04780000
047900*----------------------------------------------------------------*04790000
048000*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *04800000
048100*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*04810000
048200*    FROM THE CICS ARCHITECTURE API.                             *04820000
048300*----------------------------------------------------------------*04830000
048400                                                                  04840000
048500 2100-CHECK-FUNCTION-KEY.                                         04850000
048600                                                                  04860000
048700     EVALUATE TRUE                                                04870000
048800         WHEN DP020-SRC-AID = DP016-ENTER                         04880000
048900             CONTINUE                                             04890000
049000                                                                  04900000
049100         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               04910000
049111              PERFORM 9100-READ-SEL-QUEUE                         04911100
049112              SET DL008-INQ (ASC-SEL-SUB)  TO TRUE                04911200
049113              PERFORM 9200-REWRITE-LIST-QUEUE                     04911300
049120                                                                  04912000
052500                                                                  05250000
052600         WHEN OTHER                                               05260000
052700             SET DP013-NO-ROLLBACK                                05270000
052800                 DP013-XCTL-DISPLAY-RESTART                       05280000
052900                 DP013-CICS-ABEND  TO TRUE                        05290000
053000             MOVE '2100-CHECK-FUNCTION-KEY'                       05300000
053100                                   TO DP013-PARAGRAPH             05310000
053200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05320000
053300                                   TO DP013-MESSAGE-TEXT (1)      05330000
053400             PERFORM DP013-0000-PROCESS-ABEND                     05340000
053500     END-EVALUATE.                                                05350000
053600                                                                  05360000
053700/                                                                 05370000
053800*----------------------------------------------------------------*05380000
053900*    GET THE USER CODE (KEY) OF THE NEXT SELECTED OBJECT         *05390000
054000*    FROM THE SELECTED-ITEMS TEMP STORAGE QUEUE.                 *05400000
054100*----------------------------------------------------------------*05410000
054200 2110-GET-NEXT-RECORD.                                            05420000
054300                                                                  05430000
054400     ADD +1                        TO ASC-SEL-SUB.                05440000
054500     IF  ASC-SEL-SUB > DL008-MAX-ITEMS                            05450000
054600         ADD +1                    TO ASC-SEL-ITEM                05460000
054700         MOVE +1                   TO ASC-SEL-SUB                 05470000
054800     END-IF.                                                      05480000
054900                                                                  05490000
055000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05500000
055100         PERFORM 9100-READ-SEL-QUEUE                              05510000
055200         IF  DL008-ITEM (ASC-SEL-SUB) > ZERO                      05520000
055300             MOVE DL008-USER-CODE (ASC-SEL-SUB)                   05530000
055400                                   TO ASC-KEY-USER-CODE           05540000
055410             MOVE DL008-ADDED-BY-DC-NBR (ASC-SEL-SUB)             05541000
055420                                   TO ASC-KEY-ADDED-BY-DC-NBR     05542000
055500             SET DL008-INQ (ASC-SEL-SUB)                          05550000
055600                                   TO TRUE                        05560000
055700             PERFORM 9200-REWRITE-LIST-QUEUE                      05570000
055800             INITIALIZE ASC-SCREEN-FIELDS                         05580000
055900         ELSE                                                     05590000
056000             SUBTRACT +1 FROM ASC-SEL-SUB                         05600000
056100*            --- BOTTOM OF LIST ---                               05610000
056200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05620000
056300             SET DP020-MSG-INFORMATIONAL                          05630000
056400                 PS-LIST-END                                      05640000
056500                                   TO TRUE                        05650000
056600         END-IF                                                   05660000
056700     ELSE                                                         05670000
056800         SUBTRACT +1 FROM ASC-SEL-ITEM                            05680000
056900         MOVE DL008-MAX-ITEMS      TO ASC-SEL-SUB                 05690000
057000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05700000
057100         SET DP020-MSG-INFORMATIONAL                              05710000
057200             PS-LIST-END                                          05720000
057300                                   TO TRUE                        05730000
057400     END-IF.                                                      05740000
057500                                                                  05750000
057600/                                                                 05760000
057700*----------------------------------------------------------------*05770000
057800*    GET THE USER CODE (KEY) FROM THE PREVIOUS SELECTED          *05780000
057900*    OBJECT FROM THE SELECTED-ITEMS TEMP STORAGE QUEUE.          *05790000
058000*----------------------------------------------------------------*05800000
058100 2120-GET-PREV-RECORD.                                            05810000
058200                                                                  05820000
058300     SUBTRACT +1 FROM ASC-SEL-SUB.                                05830000
058400     IF  ASC-SEL-SUB < +1                                         05840000
058500         SUBTRACT +1 FROM ASC-SEL-ITEM                            05850000
058600         MOVE DL008-MAX-ITEMS      TO ASC-SEL-SUB                 05860000
058700     END-IF.                                                      05870000
058800                                                                  05880000
058900     IF  ASC-SEL-ITEM > ZERO                                      05890000
059000         PERFORM 9100-READ-SEL-QUEUE                              05900000
059100         MOVE DL008-USER-CODE (ASC-SEL-SUB)                       05910000
059200                                   TO ASC-KEY-USER-CODE           05920000
059300                                                                  05930000
059400         INITIALIZE ASC-SCREEN-FIELDS                             05940000
059500     ELSE                                                         05950000
059600         MOVE +1                   TO ASC-SEL-ITEM                05960000
059700                                      ASC-SEL-SUB                 05970000
059800*        --- TOP OF LIST ---                                      05980000
059900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05990000
060000         SET DP020-MSG-INFORMATIONAL                              06000000
060100             PS-LIST-END           TO TRUE                        06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
064600/                                                                 06460000
064700*----------------------------------------------------------------*06470000
064800*    RESET THE ATTRIBUTES OF CERTAIN FIELDS ON THE MAP.          *06480000
064900*----------------------------------------------------------------*06490000
065000                                                                  06500000
065100 3200-RESET-ATTRIBUTES.                                           06510000
065110                                                                  06511000
065200     CONTINUE.                                                    06520000
065400                                                                  06540000
065500/                                                                 06550000
065600*----------------------------------------------------------------*06560000
065700*   - GET THE INFO FROM THE USER CODE THAT WAS PASSED            *06570000
065800*----------------------------------------------------------------*06580000
065900 4000-BUILD-INITIAL-PANEL.                                        06590000
066000                                                                  06600000
066100     SET DP030-SET-CURSOR-TRAILER                                 06610000
066200         PS-NO-ERROR             TO TRUE.                         06620000
066300                                                                  06630000
066400     MOVE ASC-KEY-USER-CODE       TO DK-USER-CODE                 06640000
066410     MOVE ASC-KEY-ADDED-BY-DC-NBR TO DK-ADDED-BY-DC-NBR.          06641000
066500     PERFORM 4100-GET-TEMP-ASSOC-INFO.                            06650000
066600     PERFORM 4105-GET-ADDED-BY-NAME.                              06660000
066700     PERFORM 4110-GET-ADDED-BY-DC-NAME.                           06670000
066800     IF  SQLCODE = +0                                             06680000
066900         PERFORM 4115-LOAD-TEMP-FIELDS                            06690000
067000     END-IF                                                       06700000
067100                                                                  06710000
067200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        06720000
067300                                                                  06730000
067400/                                                                 06740000
067500*----------------------------------------------------------------*06750000
067600*    GET TEMP ASSOC INFO                                         *06760000
067700*----------------------------------------------------------------*06770000
067800 4100-GET-TEMP-ASSOC-INFO.                                        06780000
067900                                                                  06790000
068000     PERFORM                                                      06800000
068100         WITH TEST AFTER                                          06810000
068200         VARYING PV-RETRY-COUNTER                                 06820000
068300         FROM 1 BY 1                                              06830000
068400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06840000
068500            OR (SQLCODE = +0)                                     06850000
068600            OR (SQLCODE = +100))                                  06860000
068700                                                                  06870000
068800         EXEC SQL                                                 06880000
068900            SELECT  DC_NBR                                        06890000
069000                   ,FRST_NM                                       06900000
069100                   ,LAST_NM                                       06910000
069200                   ,CRE_BY_USR_ID                                 06920000
069300                   ,CHAR(DATE(CRE_TMST),USA)                      06930000
069400                   ,CHAR(TIME(CRE_TMST),ISO)                      06940000
069500                   ,ACTV_IND                                      06950000
069600              INTO :DLT00002-DC-NBR                               06960000
069700                  ,:DLT00002-FRST-NM                              06970000
069800                  ,:DLT00002-LAST-NM                              06980000
069900                  ,:DLT00002-CRE-BY-USR-ID                        06990000
070000                  ,:PV-DATE-USA                                   07000000
070100                  ,:PV-TIME-ISO                                   07010000
070200                  ,:DLT00002-ACTV-IND                             07020000
070300              FROM  DLT_TMP_EMP  TMP                              07030000
070400          WHERE TMP.TMP_USR_ID   = :DK-USER-CODE                  07040000
070500         END-EXEC                                                 07050000
070600                                                                  07060000
070700         EVALUATE TRUE                                            07070000
070800             WHEN SQLCODE = +0                                    07080000
070900             WHEN SQLCODE = +100                                  07090000
071000             WHEN SQLCODE = -904                                  07100000
071100             WHEN SQLCODE = -913                                  07110000
071200                 CONTINUE                                         07120000
071300                                                                  07130000
071400             WHEN SQLWARN0 NOT = SPACE                            07140000
071500             WHEN SQLCODE < +0                                    07150000
071600             WHEN SQLCODE > +0                                    07160000
071700                 MOVE '4100-GET-TEMP-ASSOC-INFO'                  07170000
071800                                     TO DP013-PARAGRAPH           07180000
071900                 MOVE 'SELECT ON TEMP USER TABLE'                 07190000
072000                                     TO DP013-MESSAGE-TEXT (1)    07200000
072100                 MOVE SQLCA          TO DP013-SQLCA               07210000
072200                 MOVE 'DLT_TMP_EMP'  TO DP013-DB2-TABLE-NAME (1)  07220000
072300                     SET DP013-DB2-ABEND                          07230000
072400                         DP013-XCTL-DISPLAY-RESTART               07240000
072500                                     TO TRUE                      07250000
072600                 PERFORM DP013-0000-PROCESS-ABEND                 07260000
072700         END-EVALUATE                                             07270000
072800     END-PERFORM.                                                 07280000
072900                                                                  07290000
073000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07300000
073100             AND (SQLCODE = -904 OR -913)                         07310000
073200         MOVE '4100-GET-TEMP-ASSOC-INFO'                          07320000
073300                                  TO DP013-PARAGRAPH              07330000
073400         MOVE 'MAX RETRIES EXCEEDED - SELECT DLT_TMP_EMP'         07340000
073500                                  TO DP013-MESSAGE-TEXT (1)       07350000
073600         MOVE SQLCA               TO DP013-SQLCA                  07360000
073700         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     07370000
073800         SET DP013-DB2-ABEND                                      07380000
073900             DP013-XCTL-DISPLAY-RESTART                           07390000
074000                                  TO TRUE                         07400000
074100         PERFORM DP013-0000-PROCESS-ABEND                         07410000
074200     END-IF.                                                      07420000
074300                                                                  07430000
074400/                                                                 07440000
074500*----------------------------------------------------------------*07450000
074600*  CALL XLKUT067 TO RETRIEVE THE NAME USERID THAT ADDED ASSOC    *07460000
074700*----------------------------------------------------------------*07470000
074800 4105-GET-ADDED-BY-NAME.                                          07480000
074900                                                                  07490000
075000     MOVE DLT00002-CRE-BY-USR-ID      TO XL067-KEY-USER-ID.       07500000
075100                                                                  07510000
075200     SET XL067-BY-USER-ID                                         07520000
075300         XL067-SELECT-BOTH-USERS      TO TRUE.                    07530000
075400                                                                  07540000
075500     CALL XL067-USER-PGM USING DFHEIBLK                           07550000
075600                               XL067-COMMAREA                     07560000
075700                               XL067-USER-COMMAREA.               07570000
075800                                                                  07580000
075900     EVALUATE TRUE                                                07590000
076000         WHEN XL067-SUCCESSFUL                                    07600000
076100             MOVE XL067-COMBINED-NAME-4    TO AADDNMEO            07610000
076210                                              PV-ADDED-BY-NAME    07621000
076300                                                                  07630000
076400         WHEN XL067-SQL-ERROR                                     07640000
076500             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    07650000
076600             MOVE '4105-GET-ADDED-BY-NAME'  TO PV-SOFT-PARAGRAPH  07660000
076700             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  07670000
076800             MOVE LENGTH OF PV-CICS-MSG-AREA2                     07680000
076900               TO PV-COMMAREA-LENGTH                              07690000
077000             EXEC CICS                                            07700000
077100                  WRITEQ TD                                       07710000
077200                   QUEUE  ('CSSL')                                07720000
077300                    FROM  (PV-CICS-MSG-AREA2)                     07730000
077400                  LENGTH  (PV-COMMAREA-LENGTH)                    07740000
077500                    RESP  (PV-CICS-RESP)                          07750000
077600             END-EXEC                                             07760000
077700             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              07770000
077800             PERFORM 9900-SOFT-ABORT                              07780000
077900     END-EVALUATE.                                                07790000
078000                                                                  07800000
078100/                                                                 07810000
078200 4110-GET-ADDED-BY-DC-NAME.                                       07820000
078300                                                                  07830000
078400     MOVE DK-ADDED-BY-DC-NBR          TO XLT00010-LOC-NBR         07840000
078500                                                                  07850000
078600     EXEC SQL                                                     07860000
078700         SELECT  LOC_NM                                           07870000
078800           INTO  :XLT00010-LOC-NM                                 07880000
078900           FROM  XLT_LOC                                          07890000
079000         WHERE LOC_NBR        = :XLT00010-LOC-NBR                 07900000
079100     END-EXEC                                                     07910000
079200                                                                  07920000
079300     EVALUATE TRUE                                                07930000
079400         WHEN SQLCODE = ZERO                                      07940000
079500             MOVE XLT00010-LOC-NM     TO PV-ADDED-BY-DC-NAME      07950000
079600                                                                  07960000
079700         WHEN SQLCODE = +100                                      07970000
079800             MOVE ALL '?'             TO PV-ADDED-BY-DC-NAME      07980000
079900         WHEN SQLCODE = -904                                      07990000
080000         WHEN SQLCODE = -911                                      08000000
080100         WHEN SQLCODE = -913                                      08010000
080200             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    08020000
080300             MOVE '4110-GET-ADDED-BY-DC-NAME' TO PV-SOFT-PARAGRAPH08030000
080400             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  08040000
080500             MOVE LENGTH OF PV-CICS-MSG-AREA2                     08050000
080600               TO PV-COMMAREA-LENGTH                              08060000
080700             EXEC CICS                                            08070000
080800                  WRITEQ TD                                       08080000
080900                   QUEUE  ('CSSL')                                08090000
081000                    FROM  (PV-CICS-MSG-AREA2)                     08100000
081100                  LENGTH  (PV-COMMAREA-LENGTH)                    08110000
081200                    RESP  (PV-CICS-RESP)                          08120000
081300             END-EXEC                                             08130000
081400             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          08140000
081500             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              08150000
081600             PERFORM 9900-SOFT-ABORT                              08160000
081700         WHEN OTHER                                               08170000
081800              MOVE '4110-GET-ADDED-BY-DC-NAME'                    08180000
081900                               TO DP013-PARAGRAPH                 08190000
082000              MOVE 'GET LOCATION DESCRIPTION'                     08200000
082100                               TO DP013-MESSAGE-TEXT (1)          08210000
082200              MOVE SQLCA       TO DP013-SQLCA                     08220000
082300              MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)        08230000
082400              SET DP013-DB2-ABEND                                 08240000
082500                  DP013-XCTL-DISPLAY-RESTART                      08250000
082600                                   TO TRUE                        08260000
082700                  PERFORM DP013-0000-PROCESS-ABEND                08270000
082800     END-EVALUATE.                                                08280000
082900                                                                  08290000
083000*----------------------------------------------------------------*08300000
083100*    MOVE THE TEMP FIELDS INTO THE COMMAREA                      *08310000
083200*----------------------------------------------------------------*08320000
083300 4115-LOAD-TEMP-FIELDS.                                           08330000
083400                                                                  08340000
083500                                                                  08350000
083600     MOVE DLT00002-DC-NBR          TO ASC-KEY-ADDED-BY-DC-NBR.    08360000
083700     MOVE DLT00002-FRST-NM         TO ASC-FIRST-NAME.             08370000
083800     MOVE DLT00002-LAST-NM         TO ASC-LAST-NAME.              08380000
083810     MOVE DLT00002-CRE-BY-USR-ID   TO ASC-ADDED-BY-ID.            08381000
083900     MOVE DP020-USERID             TO ASC-SIGNON-USERID.          08390000
084000     MOVE DK-USER-CODE             TO ASC-MAX-USER-CODE.          08400000
084100     MOVE PV-ADDED-BY-DC-NAME      TO ASC-ADDED-BY-DC-NAME.       08410000
084200     MOVE PV-ADDED-BY-NAME         TO ASC-ADDED-BY-NAME.          08420000
084300     MOVE PV-DATE-USA              TO ASC-DATE-ADDED.             08430000
084400     MOVE PV-TIME-ISO              TO ASC-TIME-ADDED.             08440000
084500     MOVE DLT00002-ACTV-IND        TO ASC-ACTIVE-USER.            08450000
084600                                                                  08460000
084700/                                                                 08470000
084800*----------------------------------------------------------------*08480000
084900*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *08490000
085000*----------------------------------------------------------------*08500000
085100 4400-MOVE-COMMAREA-TO-SCREEN.                                    08510000
085200                                                                  08520000
085210     MOVE DL002-OPER-UNT-ID        TO ADCO.                       08521000
085220     MOVE DL002-OPER-DESC          TO ADCNMEO.                    08522000
085300     MOVE ASC-KEY-ADDED-BY-DC-NBR  TO ABYDCO.                     08530000
085400     MOVE ASC-FIRST-NAME           TO AFNMEO.                     08540000
085500     MOVE ASC-LAST-NAME            TO ALNMEO.                     08550000
085600     MOVE ASC-ADDED-BY-ID          TO AADDBYO.                    08560000
085700     MOVE ASC-MAX-USER-CODE        TO AUSRCDO.                    08570000
085800     MOVE ASC-ADDED-BY-DC-NAME     TO ABYDCNMO.                   08580000
085900     MOVE ASC-ADDED-BY-NAME        TO AADDNMEO.                   08590000
086000     MOVE ASC-DATE-ADDED           TO ADATEO.                     08600000
086100     MOVE ASC-TIME-ADDED           TO ATIMEO.                     08610000
086200     MOVE ASC-ACTIVE-USER          TO AACTUSRO.                   08620000
086300/                                                                 08630000
086400/                                                                 08640000
086500*----------------------------------------------------------------*08650000
086600*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *08660000
086700*----------------------------------------------------------------*08670000
086800                                                                  08680000
086900 9100-READ-SEL-QUEUE.                                             08690000
087000     EXEC CICS                                                    08700000
087100         READQ TS                                                 08710000
087200             QUEUE (ASC-SEL-QUEUE-NAME)                           08720000
087300             INTO  (DL008-TEMP-ASSOC-SELECT-RECORD)               08730000
087400             ITEM  (ASC-SEL-ITEM)                                 08740000
087500             RESP  (PV-CICS-RESP)                                 08750000
087600     END-EXEC.                                                    08760000
087700                                                                  08770000
087800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       08780000
087900         CONTINUE                                                 08790000
088000     ELSE                                                         08800000
088100         SET DP013-LOGIC-ABEND                                    08810000
088200             DP013-NO-ROLLBACK     TO TRUE                        08820000
088300         MOVE '9100-READ-SEL-QUEUE'                               08830000
088400                                   TO DP013-PARAGRAPH             08840000
088500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   08850000
088600                                   TO DP013-MESSAGE-TEXT (1)      08860000
088700         PERFORM DP013-0000-PROCESS-ABEND                         08870000
088800     END-IF.                                                      08880000
088900                                                                  08890000
089000/                                                                 08900000
089100*----------------------------------------------------------------*08910000
089200*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *08920000
089300*----------------------------------------------------------------*08930000
089400 9200-REWRITE-LIST-QUEUE.                                         08940000
089500     EXEC CICS                                                    08950000
089600          WRITEQ TS                                               08960000
089700              QUEUE  (ASC-SEL-QUEUE-NAME)                         08970000
089800              FROM   (DL008-TEMP-ASSOC-SELECT-RECORD)             08980000
089900              ITEM   (ASC-SEL-ITEM)                               08990000
090000              RESP   (PV-CICS-RESP)                               09000000
090100              REWRITE                                             09010000
090200     END-EXEC.                                                    09020000
090300                                                                  09030000
090400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   09040000
090500         SET DP013-CICS-ABEND                                     09050000
090600             DP013-NO-ROLLBACK     TO TRUE                        09060000
090700         MOVE '9200-REWRITE-LIST-QUEUE'                           09070000
090800                                   TO DP013-PARAGRAPH             09080000
090900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   09090000
091000                                   TO DP013-MESSAGE-TEXT (1)      09100000
091100         PERFORM DP013-0000-PROCESS-ABEND                         09110000
091200     END-IF.                                                      09120000
091300                                                                  09130000
091400/                                                                 09140000
091410 9900-SOFT-ABORT.                                                 09141000
091420                                                                  09142000
091430     EXEC CICS SYNCPOINT                                          09143000
091440          ROLLBACK                                                09144000
091450     END-EXEC.                                                    09145000
091460                                                                  09146000
091470     SET  PS-ERROR                                                09147000
091480          PS-SOFT-ABORT-ERROR                                     09148000
091490          DP020-MSG-FATAL       TO  TRUE.                         09149000
091491/                                                                 09149100
093100/                                                                 09310000
093200*----------------------------------------------------------------*09320000
093300*    ABEND PROCESSOR MODULE                                      *09330000
093400*----------------------------------------------------------------*09340000
093500                                                                  09350000
093600     COPY DPPD013.                                                09360000
