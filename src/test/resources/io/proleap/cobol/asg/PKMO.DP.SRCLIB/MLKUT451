       IDENTIFICATION DIVISION.                                         00010003
       PROGRAM-ID.    MLKUT451.                                         00020003
       AUTHOR.        BOB MCASEY                                        00030003
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
       DATE-WRITTEN.  02-01-2000.                                       00050003
       DATE-COMPILED.                                                   00060003
      ******************************************************************00070003
      *                                                                 00080003
      * MLKUT451 - DESCRIPTION.............                             00090003
      *                                                                 00100003
      * THIS PROGRAM WILL CREATE THE DATA INTEGRITY EXTRACT FILE FOR    00110003
      * DB2 TABLE TWKPOSS.                                              00120003
      *                                                                 00130003
      *CHANGE HISTORY:                                                  00131004
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00132004
      * ------- ---------- ----------- -------------------------------- 00133004
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00134004
      ******************************************************************00140003
      *                                                                 00150003
       ENVIRONMENT DIVISION.                                            00160003
      *                                                                 00170003
       CONFIGURATION SECTION.                                           00180003
      *                                                                 00190003
       SOURCE-COMPUTER.        IBM-3090.                                00200003
       OBJECT-COMPUTER.        IBM-3090.                                00210003
      *                                                                 00220003
       INPUT-OUTPUT SECTION.                                            00230003
       FILE-CONTROL.                                                    00240003
                                                                        00250003
           SELECT DATA-INTEGRITY-CTL-FILE                               00260003
               ASSIGN TO INP01.                                         00270003
                                                                        00280003
           SELECT DATA-INTEGRITY-EXTR-FILE                              00290003
               ASSIGN TO OUT01.                                         00300003
                                                                        00310003
      ******************************************************************00320003
       DATA DIVISION.                                                   00330003
      ******************************************************************00340003
                                                                        00350003
       FILE SECTION.                                                    00360003
                                                                        00370003
       FD  DATA-INTEGRITY-CTL-FILE                                      00380003
           LABEL RECORDS ARE STANDARD                                   00390003
           RECORDING MODE IS F                                          00400003
           BLOCK CONTAINS 0 RECORDS.                                    00410003
       01  DATA-INTEGRITY-CTL-REC      PIC X(80).                       00420003
                                                                        00430003
       FD  DATA-INTEGRITY-EXTR-FILE                                     00440003
           RECORDING MODE IS F                                          00450003
           LABEL RECORDS ARE STANDARD                                   00460003
           BLOCK CONTAINS 0 RECORDS.                                    00470003
                                                                        00480003
W26603 01  DATA-INTEGRITY-EXTR-REC     PIC X(120).                      00490004
                                                                        00500003
      *                                                                 00510003
      ******************************************************************00520003
       WORKING-STORAGE SECTION.                                         00530003
      ******************************************************************00540003
                                                                        00550003
       01  PS-PROGRAM-SWITCHES.                                         00560003
           05  PS-TWKPOSS-DONE         PIC X       VALUE 'N'.           00570003
               88  PS-TWKPOSS-IS-DONE              VALUE 'Y'.           00580003
               88  PS-TWKPOSS-IS-NOT-DONE          VALUE 'N'.           00590003
                                                                        00600003
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00610003
           05  PA-TWKPOSS-ROWS-FETCHED PIC S9(13)  VALUE ZERO.          00620003
           05  PA-TDTATTR-ROWS-SELECTED                                 00630003
                                       PIC S9(13)  VALUE ZERO.          00640003
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00650003
                                                                        00660003
       01  PC-PROGRAM-CONSTANTS.                                        00670003
           05  PC-MAX-TBL-ROWS         PIC S9(03)  VALUE +120.          00680003
                                                                        00690003
       01  PV-PROGRAM-VARIABLES.                                        00700003
           05  PV-OPN-MONTH-FIRST-WEEK PIC X(10).                       00710003
           05  PV-FSCL-WK-END-DTE      PIC X(10).                       00720003
           05  PV-FSCL-MN-END-DTE      PIC X(10).                       00730003
           05  PV-FSCL-MN-NBR          PIC X(02).                       00740003
                                                                        00750003
           05  PV-SPLIT-SUB-CL-NBR.                                     00760003
               10  PV-SPLIT-SUB-CL-NBR-1                                00770003
                                       PIC X.                           00780003
               10  FILLER              PIC X.                           00790003
           05  PV-FRMT-MAJ-CL-NBR.                                      00800003
               10  PV-FRMT-MAJ-CL-NBR-1                                 00810003
                                       PIC X.                           00820003
               10  PV-FRMT-MAJ-CL-NBR-2                                 00830003
                                       PIC X.                           00840003
                                                                        00850003
       01  TABLE-FOR-MONTH-DATA.                                        00860003
           05  TABLE-WEEKEND-ENTRIES   OCCURS 120 TIMES                 00870003
                                       INDEXED BY MTH-IDX.              00880003
               10  TBL-WEEKEND-DTE     PIC X(10).                       00890003
               10  TBL-MONTHEND-DTE    PIC X(10).                       00900003
               10  TBL-MONTHEND-NBR    PIC X(02).                       00910003
                                                                        00920003
       01  CD-COUNTER-DISPLAY.                                          00930003
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00940003
                                                                        00950003
       01 ABEND-AREAS.                                                  00960003
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00970003
                                                   COMP SYNC.           00980003
               88  AC-BAD-DATA                     VALUE +4003.         00990003
               88  AC-DB2-ERROR                    VALUE +4013.         01000003
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01010003
                 '*****       ABEND'.                                   01020003
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01030003
                   '*****   PROGRAM: MLKUT451'.                         01040003
           05  AA-PARAGRAPH-LIT.                                        01050003
               10  FILLER              PIC X(17)   VALUE                01060003
                   '***** PARAGRAPH: '.                                 01070003
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01080003
           05  AA-MESSAGE-LINE.                                         01090003
               10  FILLER              PIC X(06)   VALUE '*****'.       01100003
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01110003
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01120003
                   '*****    DB2 ERROR'.                                01130003
           05  AA-DB2-OPERATION-LIT.                                    01140003
               10  FILLER              PIC X(17)   VALUE                01150003
                   '***** OPERATION: '.                                 01160003
               10  AA-DB2-OPERATION.                                    01170003
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01180003
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01190003
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01200003
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01210003
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01220003
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01230003
                                                                        01240003
       EJECT                                                            01250003
                                                                        01260003
      *** DATA INTEGRITY CONTROL CARD                                   01270003
           COPY MLRD110.                                                01280003
                                                                        01290003
                                                                        01300003
      *** DATA INTEGRITY TWKPOSS EXTRACT FILE                           01310003
W26603     COPY MLRD111.                                                01320004
                                                                        01330003
       EJECT                                                            01340003
                                                                        01350003
      ******************************************************************01360003
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01370003
      ******************************************************************01380003
           COPY DPWS004.                                                01390003
                                                                        01400003
      ******************************************************************01410003
      *  DB2 ERRORS                                                     01420003
      ******************************************************************01430003
           COPY SQLCA2.                                                 01440003
                                                                        01450003
      ******************************************************************01460003
      *  DB2 COMMUNICATION AREA                                         01470003
      ******************************************************************01480003
           EXEC SQL                                                     01490003
                INCLUDE SQLCA                                           01500003
           END-EXEC.                                                    01510003
                                                                        01520003
      ******************************************************************01530003
      *  DB2 TWKPOSS TABLE LAYOUT                                       01540003
      ******************************************************************01550003
           EXEC SQL                                                     01560003
                INCLUDE TWKPOSS                                         01570003
           END-EXEC.                                                    01580003
                                                                        01590003
      ******************************************************************01600003
      *  DB2 TDTATTR TABLE LAYOUT                                       01610003
      ******************************************************************01620003
           EXEC SQL                                                     01630003
                INCLUDE TDTATTR                                         01640003
           END-EXEC.                                                    01650003
                                                                        01660003
      ******************************************************************01670003
      *  DB2 TWKPOSS CURSOR                                             01680003
      ******************************************************************01690003
           EXEC SQL                                                     01700003
               DECLARE TWKPOSS_CURSOR CURSOR FOR                        01710003
                SELECT FSCL_WK_END_DTE                                  01720003
                     , DEPT_NBR                                         01730003
                     , SUB_CL_NBR                                       01740003
                     , STR_NBR                                          01750003
                     , PO_TYP_CDE                                       01760003
                     , RCPT_RTL_AMT                                     01810003
                     , RCPT_NET_COST_AMT                                01820003
                  FROM TWKPOSS                                          01860003
WR5701*         WHERE (FSCL_WK_END_DTE >= :ML110-STRT-DTE)              01870003
WR5701           WHERE (FSCL_WK_END_DTE BETWEEN                         01880003
WR5701                                        :PV-OPN-MONTH-FIRST-WEEK  01890003
                                          AND :ML110-END-DTE)           01900003
              ORDER BY FSCL_WK_END_DTE                                  01910003
                     , DEPT_NBR                                         01920003
                     , SUB_CL_NBR                                       01930003
                     , STR_NBR                                          01940003
                     , PO_TYP_CDE                                       01941003
W26603        WITH UR                                                   01942004
           END-EXEC.                                                    01950003
                                                                        01960003
       EJECT                                                            01970003
                                                                        01980003
      ******************************************************************01990003
       PROCEDURE DIVISION.                                              02000003
      ******************************************************************02010003
                                                                        02020003
      ******************************************************************02030003
       0000-MAINLINE-MLKUT451.                                          02040003
      ******************************************************************02050003
      *                                                                 02060003
           PERFORM 1000-INITIALIZATION.                                 02070003
                                                                        02080003
           PERFORM 2000-MAIN-PROCESS.                                   02090003
                                                                        02100003
           PERFORM 8000-EOJ.                                            02110003
                                                                        02120003
           STOP RUN.                                                    02130003
                                                                        02140003
       EJECT                                                            02150003
                                                                        02160003
      ******************************************************************02170003
       1000-INITIALIZATION.                                             02180003
      ******************************************************************02190003
      *                                                                 02200003
           OPEN INPUT  DATA-INTEGRITY-CTL-FILE.                         02210003
           OPEN OUTPUT DATA-INTEGRITY-EXTR-FILE.                        02220003
      *                                                                 02230003
           PERFORM 4000-READ-CONTROL-CARD.                              02240003
                                                                        02250003
           DISPLAY ' '.                                                 02260003
           DISPLAY '*** MLKUT451 INPUT CONTROL CARD VALUES ***'         02270003
           DISPLAY ML110-DATA-INTEGRITY-CC-REC.                         02280003
                                                                        02290003
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                          02300003
           INITIALIZE PV-PROGRAM-VARIABLES.                             02310003
           INITIALIZE TABLE-FOR-MONTH-DATA.                             02320003
      *                                                                 02330003
WR5701     PERFORM 7000-DATE-RANGE-TO-PROCESS.                          02340003
                                                                        02350003
       EJECT                                                            02360003
                                                                        02370003
      ******************************************************************02380003
       2000-MAIN-PROCESS.                                               02390003
      ******************************************************************02400003
      *                                                                 02410003
           PERFORM 7100-OPEN-CURSOR-TWKPOSS.                            02420003
                                                                        02430003
           PERFORM 7200-FETCH-TWKPOSS.                                  02440003
                                                                        02450003
           PERFORM                                                      02460003
             UNTIL PS-TWKPOSS-IS-DONE                                   02470003
               PERFORM 2100-GET-MONTH-DATA                              02480003
               PERFORM 5000-WRITE-EXTRACT                               02490003
               PERFORM 7200-FETCH-TWKPOSS                               02500003
           END-PERFORM.                                                 02510003
                                                                        02520003
           PERFORM 7300-CLOSE-CURSOR-TWKPOSS.                           02530003
                                                                        02540003
       EJECT                                                            02550003
                                                                        02560003
      ******************************************************************02570003
       2100-GET-MONTH-DATA.                                             02580003
      ******************************************************************02590003
      *                                                                 02600003
           SET MTH-IDX                 TO 1.                            02610003
           SEARCH TABLE-WEEKEND-ENTRIES                                 02620003
               AT END                                                   02630003
                   PERFORM 7400-SELECT-TDTATTR                          02640003
                   ADD 1               TO PA-TDTATTR-ROWS-SELECTED      02650003
                   MOVE DTATTR-FSCL-MN-END-DTE                          02660003
                                       TO PV-FSCL-MN-END-DTE            02670003
                   MOVE DTATTR-FSCL-MN-NBR                              02680003
                                       TO PV-FSCL-MN-NBR                02690003
                   IF PA-TDTATTR-ROWS-SELECTED > PC-MAX-TBL-ROWS        02700003
                       CONTINUE                                         02710003
                   ELSE                                                 02720003
                       SET MTH-IDX     TO PA-TDTATTR-ROWS-SELECTED      02730003
                       MOVE WKPOSS-FSCL-WK-END-DTE                      02740003
                                       TO TBL-WEEKEND-DTE (MTH-IDX)     02750003
                       MOVE DTATTR-FSCL-MN-END-DTE                      02760003
                                       TO TBL-MONTHEND-DTE (MTH-IDX)    02770003
                       MOVE DTATTR-FSCL-MN-NBR                          02780003
                                       TO TBL-MONTHEND-NBR (MTH-IDX)    02790003
                   END-IF                                               02800003
               WHEN TBL-WEEKEND-DTE (MTH-IDX) = WKPOSS-FSCL-WK-END-DTE  02810003
                   MOVE TBL-MONTHEND-DTE (MTH-IDX)                      02820003
                                       TO PV-FSCL-MN-END-DTE            02830003
                   MOVE TBL-MONTHEND-NBR (MTH-IDX)                      02840003
                                       TO PV-FSCL-MN-NBR                02850003
           END-SEARCH.                                                  02860003
                                                                        02870003
       EJECT                                                            02880003
                                                                        02890003
      ******************************************************************02900003
       4000-READ-CONTROL-CARD.                                          02910003
      ******************************************************************02920003
      *                                                                 02930003
           READ DATA-INTEGRITY-CTL-FILE                                 02940003
             INTO ML110-DATA-INTEGRITY-CC-REC                           02950003
               AT END                                                   02960003
                   MOVE '4000-READ-CONTROL-CARD'                        02970003
                                       TO AA-PARAGRAPH-NAME             02980003
                   MOVE 'CONTROL CARD IS MISSING'                       02990003
                                       TO AA-MESSAGE                    03000003
                   MOVE +4001          TO ABEND-CODE                    03010003
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    03020003
           END-READ.                                                    03030003
                                                                        03040003
       EJECT                                                            03050003
                                                                        03060003
      ******************************************************************03070003
       5000-WRITE-EXTRACT.                                              03080003
      ******************************************************************03090003
      *                                                                 03100003
           INITIALIZE ML111-DATA-INTEGRITY-EXTR-REC.                    03101003
           MOVE PV-FSCL-MN-END-DTE     TO ML111-FSCL-MN-END-DTE.        03110003
           MOVE PV-FSCL-MN-NBR         TO ML111-FSCL-MN-NBR.            03120003
           MOVE WKPOSS-DEPT-NBR        TO ML111-DEPT-NBR.               03130003
           MOVE WKPOSS-SUB-CL-NBR      TO PV-SPLIT-SUB-CL-NBR.          03140003
           MOVE PV-SPLIT-SUB-CL-NBR-1  TO PV-FRMT-MAJ-CL-NBR-1.         03150003
           MOVE 0                      TO PV-FRMT-MAJ-CL-NBR-2.         03160003
           MOVE PV-FRMT-MAJ-CL-NBR     TO ML111-MAJ-CL-NBR.             03170003
           MOVE WKPOSS-SUB-CL-NBR      TO ML111-SUB-CL-NBR.             03180003
           MOVE WKPOSS-STR-NBR         TO ML111-STR-NBR.                03190003
           MOVE WKPOSS-RCPT-RTL-AMT    TO ML111-RCPT-RTL-AMT.           03260003
           MOVE WKPOSS-RCPT-NET-COST-AMT                                03270003
                                       TO ML111-RCPT-NET-COST-AMT.      03280003
                                                                        03332003
           WRITE DATA-INTEGRITY-EXTR-REC                                03333003
               FROM ML111-DATA-INTEGRITY-EXTR-REC.                      03334003
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       03335003
                                                                        03336003
                                                                        03337003
       EJECT                                                            03338003
                                                                        03339003
      ******************************************************************03340003
       7000-DATE-RANGE-TO-PROCESS.                                      03350003
      ******************************************************************03360003
      *                                                                 03370003
           EXEC SQL                                                     03380003
               SELECT FSCL_MN_BEG_DTE                                   03390003
                 INTO :PV-OPN-MONTH-FIRST-WEEK                          03400003
                 FROM TDTATTR                                           03410003
                WHERE KY_DTE = :ML110-STRT-DTE                          03420003
W26603          WITH UR                                                 03421004
           END-EXEC.                                                    03430003
                                                                        03440003
           EVALUATE TRUE                                                03450003
               WHEN SQLCODE = 0                                         03460003
                   CONTINUE                                             03470003
               WHEN OTHER                                               03480003
                   MOVE '7000-DATE-RANGE-TO-PROCESS'                    03490003
                                       TO AA-PARAGRAPH-NAME             03500003
                   MOVE 'NO TDTATTR MATCH FOUND FOR KY_DTE'             03510003
                                       TO AA-MESSAGE                    03520003
                   MOVE 'SELECT FROM'  TO AA-DB2-OPERATION              03530003
                   PERFORM 9901-SQL-ERROR                               03540003
           END-EVALUATE.                                                03550003
                                                                        03560003
                                                                        03570003
      ******************************************************************03580003
       7100-OPEN-CURSOR-TWKPOSS.                                        03590003
      ******************************************************************03600003
      *                                                                 03610003
           EXEC SQL                                                     03620003
               OPEN TWKPOSS_CURSOR                                      03630003
           END-EXEC.                                                    03640003
                                                                        03650003
           EVALUATE TRUE                                                03660003
               WHEN SQLCODE = 0                                         03670003
                   CONTINUE                                             03680003
               WHEN OTHER                                               03690003
                   MOVE '7100-OPEN-CURSOR-TWKPOSS'                      03700003
                                       TO AA-PARAGRAPH-NAME             03710003
                   MOVE 'TWKPOSS TABLE ERROR'                           03720003
                                       TO AA-MESSAGE                    03730003
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              03740003
                   PERFORM 9901-SQL-ERROR                               03750003
           END-EVALUATE.                                                03760003
                                                                        03770003
       EJECT                                                            03780003
                                                                        03790003
      ******************************************************************03800003
       7200-FETCH-TWKPOSS.                                              03810003
      ******************************************************************03820003
      *                                                                 03830003
           EXEC SQL                                                     03840003
               FETCH TWKPOSS_CURSOR                                     03850003
                INTO :WKPOSS-FSCL-WK-END-DTE                            03860003
                   , :WKPOSS-DEPT-NBR                                   03870003
                   , :WKPOSS-SUB-CL-NBR                                 03880003
                   , :WKPOSS-STR-NBR                                    03890003
                   , :WKPOSS-PO-TYP-CDE                                 03900003
                   , :WKPOSS-RCPT-RTL-AMT                               03950003
                   , :WKPOSS-RCPT-NET-COST-AMT                          03960003
           END-EXEC.                                                    04000003
                                                                        04010003
           EVALUATE TRUE                                                04020003
               WHEN SQLCODE = 0                                         04030003
                   ADD +1              TO PA-TWKPOSS-ROWS-FETCHED       04040003
               WHEN SQLCODE = +100                                      04050003
                   MOVE 'Y'            TO PS-TWKPOSS-DONE               04060003
               WHEN OTHER                                               04070003
                   MOVE '7200-FETCH-TWKPOSS'                            04080003
                                       TO AA-PARAGRAPH-NAME             04090003
                   MOVE 'TWKPOSS TABLE ERROR'                           04100003
                                       TO AA-MESSAGE                    04110003
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              04120003
                   PERFORM 9901-SQL-ERROR                               04130003
           END-EVALUATE.                                                04140003
                                                                        04150003
       EJECT                                                            04160003
                                                                        04170003
      ******************************************************************04180003
       7300-CLOSE-CURSOR-TWKPOSS.                                       04190003
      ******************************************************************04200003
      *                                                                 04210003
           EXEC SQL                                                     04220003
               CLOSE TWKPOSS_CURSOR                                     04230003
           END-EXEC.                                                    04240003
                                                                        04250003
           EVALUATE TRUE                                                04260003
               WHEN SQLCODE = 0                                         04270003
                   CONTINUE                                             04280003
               WHEN OTHER                                               04290003
                   MOVE '7300-CLOSE-CURSOR-TWKPOSS'                     04300003
                                       TO AA-PARAGRAPH-NAME             04310003
                   MOVE 'TWKPOSS TABLE ERROR'                           04320003
                                       TO AA-MESSAGE                    04330003
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              04340003
                   PERFORM 9901-SQL-ERROR                               04350003
           END-EVALUATE.                                                04360003
                                                                        04370003
       EJECT                                                            04380003
                                                                        04390003
      ******************************************************************04400003
       7400-SELECT-TDTATTR.                                             04410003
      ******************************************************************04420003
      *                                                                 04430003
           MOVE WKPOSS-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           04440003
                                                                        04450003
           EXEC SQL                                                     04460003
               SELECT FSCL_MN_NBR,                                      04470003
                      FSCL_MN_END_DTE                                   04480003
               INTO  :DTATTR-FSCL-MN-NBR,                               04490003
                     :DTATTR-FSCL-MN-END-DTE                            04500003
               FROM  TDTATTR                                            04510003
               WHERE (KY_DTE = :PV-FSCL-WK-END-DTE)                     04520003
W26603         WITH UR                                                  04521004
           END-EXEC.                                                    04530003
                                                                        04540003
           EVALUATE TRUE                                                04550003
               WHEN SQLCODE = 0                                         04560003
                   CONTINUE                                             04570003
               WHEN OTHER                                               04580003
                   MOVE '7400-SELECT-TDTATTR'                           04590003
                                       TO AA-PARAGRAPH-NAME             04600003
                   MOVE 'TDTATTR ROW NOT FOUND'                         04610003
                                       TO AA-MESSAGE                    04620003
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              04630003
                   PERFORM 9901-SQL-ERROR                               04640003
           END-EVALUATE.                                                04650003
                                                                        04660003
       EJECT                                                            04670003
                                                                        04680003
      ******************************************************************04690003
       8000-EOJ.                                                        04700003
      ******************************************************************04710003
      *                                                                 04720003
           DISPLAY ' '.                                                 04730003
           DISPLAY '  PROGRAM MLKUT451 PROCESSING SUMMARY'.             04740003
           DISPLAY '  -----------------------------------'.             04750003
           DISPLAY ' '.                                                 04760003
      *                                                                 04770003
           MOVE PA-TWKPOSS-ROWS-FETCHED TO CD-COUNT-HOLD1.              04780003
           DISPLAY 'TWKPOSS ROWS FETCHED =      ' CD-COUNT-HOLD1.       04790003
      *                                                                 04800003
           MOVE PA-TDTATTR-ROWS-SELECTED                                04810003
                                        TO CD-COUNT-HOLD1.              04820003
           DISPLAY 'TDTATTR ROWS SELECTED =     ' CD-COUNT-HOLD1.       04830003
      *                                                                 04840003
           MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               04850003
           DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       04860003
      *                                                                 04870003
           DISPLAY ' '.                                                 04880003
                                                                        04890003
           CLOSE DATA-INTEGRITY-CTL-FILE.                               04900003
           CLOSE DATA-INTEGRITY-EXTR-FILE.                              04910003
                                                                        04920003
       EJECT                                                            04930003
                                                                        04940003
      ******************************************************************04950003
       9900-COMMON-ABEND-ROUTINE.                                       04960003
      ******************************************************************04970003
      *                                                                 04980003
           DISPLAY AA-ABEND-LIT.                                        04990003
           DISPLAY AA-PROGRAM-LIT.                                      05000003
           DISPLAY AA-PARAGRAPH-LIT.                                    05010003
           DISPLAY AA-MESSAGE-LINE.                                     05020003
           DISPLAY ABEND-CODE.                                          05030003
                                                                        05040003
           CALL 'ILBOABN0' USING ABEND-CODE.                            05050003
                                                                        05060003
       EJECT                                                            05070003
                                                                        05080003
      ******************************************************************05090003
       9901-SQL-ERROR.                                                  05100003
      ******************************************************************05110003
      *                                                                 05120003
           CLOSE DATA-INTEGRITY-CTL-FILE                                05130003
                 DATA-INTEGRITY-EXTR-FILE.                              05140003
                                                                        05150003
           DISPLAY AA-ABEND-LIT.                                        05160003
           DISPLAY AA-DB2-ERROR-LIT.                                    05170003
           DISPLAY AA-PROGRAM-LIT.                                      05180003
           DISPLAY AA-PARAGRAPH-LIT.                                    05190003
           DISPLAY AA-MESSAGE-LINE.                                     05200003
           DISPLAY AA-DB2-OPERATION-LIT.                                05210003
           SET AC-DB2-ERROR TO TRUE.                                    05220003
           MOVE +4013                  TO ABEND-CODE.                   05230003
                                                                        05240003
           COPY DPPD004.                                                05250003
           CALL 'ILBOABN0' USING ABEND-CODE.                            05260003
                                                                        05270003
