000200 IDENTIFICATION DIVISION.                                         00020001
000300 PROGRAM-ID.               XSKUT044.                              00030001
000400 AUTHOR.                   JIM LEIKNESS                           00040001
000500 INSTALLATION.             KOHLS DEPARTMENT STORES.               00050001
000600 DATE-WRITTEN.             12-30-2002.                            00060001
000700 DATE-COMPILED.                                                   00070001
000800******************************************************************00080001
000900*     EXTRACT OF XST_REGN AND XST_REGN_TERR TO A FILE             00090001
001000******************************************************************00100001
001200*   PROGRAM WRITES XST_REGN AND XST_REGN_TERR DATA TO A FILE      00120001
001300******************************************************************00130001
001400                                                                  00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600                                                                  00160001
001700                                                                  00170001
001800 CONFIGURATION SECTION.                                           00180001
001900                                                                  00190001
002000 SOURCE-COMPUTER.    IBM-3090.                                    00200001
002100 OBJECT-COMPUTER.    IBM-3090.                                    00210001
002200                                                                  00220001
002300                                                                  00230001
002400 INPUT-OUTPUT SECTION.                                            00240001
002500                                                                  00250001
002600 FILE-CONTROL.                                                    00260001
002700                                                                  00270001
002800     SELECT XST-OUTPUT-FILE            ASSIGN TO OUT01.           00280001
002900     EJECT                                                        00290001
003000                                                                  00300001
003100 DATA DIVISION.                                                   00310001
003200                                                                  00320001
003300 FILE SECTION.                                                    00330001
003400                                                                  00340001
003500 FD  XST-OUTPUT-FILE                                              00350001
003600     RECORDING MODE IS F                                          00360001
003700     BLOCK CONTAINS 0                                             00370001
003800     LABEL RECORDS ARE STANDARD.                                  00380001
003900 01  XST-OUTPUT-RECORD                PIC X(62).                  00390004
004000                                                                  00400001
004100                                                                  00410001
004200 WORKING-STORAGE SECTION.                                         00420001
004300                                                                  00430001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
005100     05  PC-PROGRAM-NUMBER            PIC X(08)      VALUE        00510001
005200         'XSKUT044'.                                              00520001
005300     05  PC-ABEND-MSSG                PIC X(12)      VALUE        00530001
005400         '** ABEND ** '.                                          00540001
005500     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        00550001
005600         'DB2 ERROR'.                                             00560001
005700     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        00570001
005800         'ATTEMPTING TO '.                                        00580001
005900                                                                  00590001
006000 01  PS-PROCESS-SWITCHES.                                         00600001
006100     05  PS-TRANSACTION-DETAIL-SW     PIC X(01)      VALUE 'N'.   00610001
006200         88  PS-NOT-END-OF-TRANS-DETAIL              VALUE 'N'.   00620001
006300         88  PS-END-OF-TRANSACTION-DETAIL            VALUE 'Y'.   00630001
006400                                                                  00640001
006700 01  PV-PROGRAM-VARIABLES.                                        00670001
006800     05  PV-SUB                       PIC S9(04)     COMP.        00680001
006900     05  PV-PARAGRAPH-NAME            PIC X(50)      VALUE SPACES.00690001
007000     05  PV-DB2-ERROR-MSSG            PIC X(50)      VALUE SPACES.00700001
007100                                                                  00710001
007200 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 00720001
007300     88  ABEND-4003-INVALID-CC-DATE                  VALUE +4003. 00730001
007400     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00740001
007500     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00750001
007600     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00760001
007700                                                                  00770001
007800******************************************************************00780001
007900*    STANDARD FILE LAYOUT FOR THE REGION TABLE FILE               00790001
008000******************************************************************00800001
008100     COPY HORD007.                                                00810001
008200                                                                  00820001
008210******************************************************************00821003
008220*  COPYBOOK WITH FIELDS USED TO CALL DSNTIAR                      00822003
008230******************************************************************00823003
008300     COPY DPWS004.                                                00830001
008310                                                                  00831003
008400******************************************************************00840001
008500*  DB2 DCLGEN FOR THE REGION TABLE (XST_REGN)                     00850001
008600******************************************************************00860001
008700     EXEC SQL                                                     00870001
008800         INCLUDE XST00005                                         00880001
008900     END-EXEC.                                                    00890001
008910                                                                  00891003
009000******************************************************************00900001
009100*  DB2 DCLGEN FOR REGION TERRITORY TABLE (XST_REGN_DIST)          00910001
009200******************************************************************00920001
009300     EXEC SQL                                                     00930001
009400         INCLUDE XST00006                                         00940001
009500     END-EXEC.                                                    00950001
009600                                                                  00960001
009700******************************************************************00970001
009800*  DB2 COMMUNICATIONS AREA                                        00980001
009900******************************************************************00990001
010000     EXEC SQL                                                     01000001
010100         INCLUDE SQLCA                                            01010001
010200     END-EXEC.                                                    01020001
010300                                                                  01030001
010400******************************************************************01040001
010500*  DECLARE CURSOR                                                 01050001
010600******************************************************************01060001
010610                                                                  01061002
010700     EXEC SQL                                                     01070001
010800         DECLARE REGN-EXTR-CSR CURSOR FOR                         01080001
010900                                                                  01090001
011000         SELECT  REGN.REGN_NBR                                    01100001
011100              ,  TERR.TERR_NBR                                    01110001
011200              ,  REGN.REGN_NM                                     01120001
011300              ,  REGN.REGN_MGR_NM                                 01130001
011400         FROM XST_REGN REGN,                                      01140006
011500              XST_REGN_TERR TERR                                  01150006
011600         WHERE REGN.REGN_NBR = TERR.REGN_NBR                      01160008
011610           AND TERR.END_DTE IS NULL                               01161008
011800                                                                  01180001
011900     END-EXEC.                                                    01190001
011910                                                                  01191002
012000******************************************************************01200001
012100 PROCEDURE DIVISION.                                              01210001
012200******************************************************************01220001
012300                                                                  01230001
012400     OPEN OUTPUT XST-OUTPUT-FILE.                                 01240001
012500                                                                  01250001
012600     PERFORM 1000-OPEN-REGN-EXTR-CSR.                             01260001
012700                                                                  01270001
012800     INITIALIZE HO007-REGION-DATA.                                01280001
012900                                                                  01290001
013000     PERFORM 1050-FETCH-REGN-EXTR-CSR.                            01300001
013100                                                                  01310001
013200     PERFORM 2000-PROCESS                                         01320001
013300         UNTIL PS-END-OF-TRANSACTION-DETAIL.                      01330001
013400                                                                  01340001
013500     PERFORM 1070-CLOSE-REGN-EXTR-CSR.                            01350001
013600                                                                  01360001
013700     CLOSE XST-OUTPUT-FILE.                                       01370001
013800                                                                  01380001
013900     STOP RUN.                                                    01390002
013910                                                                  01391002
014000******************************************************************01400001
014100*   OPEN THE REGION EXTRACT CURSOR                                01410001
014200******************************************************************01420001
014300 1000-OPEN-REGN-EXTR-CSR.                                         01430001
014400                                                                  01440001
014500     EXEC SQL                                                     01450001
014600         OPEN REGN-EXTR-CSR                                       01460001
014700     END-EXEC.                                                    01470001
014800                                                                  01480001
014900     EVALUATE TRUE                                                01490001
015000       WHEN SQLCODE NOT = 0                                       01500001
015100       WHEN SQLWARN0    = 'W'                                     01510001
015200         MOVE '1000-OPEN-REGN-EXTR-CSR '                          01520001
015300                           TO PV-PARAGRAPH-NAME                   01530001
015400         MOVE 'OPEN REGION EXTRACT CURSOR ERROR.'                 01540001
015500                           TO PV-DB2-ERROR-MSSG                   01550001
015600         PERFORM 9400-DB2-ERROR                                   01560001
015700     END-EVALUATE.                                                01570001
015800                                                                  01580001
015900******************************************************************01590001
016000*   FETCH DATA FROM THE REGION EXTRACT CURSOR                    *01600001
016100******************************************************************01610001
016200 1050-FETCH-REGN-EXTR-CSR.                                        01620001
016300                                                                  01630001
016400     EXEC SQL                                                     01640001
016500         FETCH REGN-EXTR-CSR                                      01650001
016600           INTO :XST00005-REGN-NBR                                01660001
016700              , :XST00006-TERR-NBR                                01670001
016800              , :XST00005-REGN-NM                                 01680001
016900              , :XST00005-REGN-MGR-NM                             01690001
017000     END-EXEC.                                                    01700001
017100                                                                  01710001
017200     EVALUATE TRUE                                                01720001
017300         WHEN SQLCODE = +0                                        01730001
017400           CONTINUE                                               01740001
017500         WHEN SQLCODE = +100                                      01750001
017600           SET PS-END-OF-TRANSACTION-DETAIL TO TRUE               01760001
017700         WHEN OTHER                                               01770001
017800             MOVE '1050-FETCH-REGN-EXTR-CURSOR'                   01780001
017900                               TO PV-PARAGRAPH-NAME               01790001
018000             MOVE 'FETCH FROM REGION EXTRACT CURSOR ERROR.'       01800001
018100                               TO PV-DB2-ERROR-MSSG               01810001
018200             PERFORM 9400-DB2-ERROR                               01820001
018300     END-EVALUATE.                                                01830001
018400                                                                  01840001
018500     MOVE XST00005-REGN-NBR      TO HO007-REGN-NBR.               01850001
018600     MOVE XST00006-TERR-NBR      TO HO007-REGN-TERR-NBR.          01860001
018700     MOVE XST00005-REGN-NM       TO HO007-REGN-NM.                01870001
018800     MOVE XST00005-REGN-MGR-NM   TO HO007-REGN-MGR-NM.            01880001
018900                                                                  01890001
019000******************************************************************01900001
019100*   CLOSE THE REGION EXTRACT CSR                                 *01910001
019200******************************************************************01920001
019300 1070-CLOSE-REGN-EXTR-CSR.                                        01930001
019400     EXEC SQL                                                     01940001
019500       CLOSE REGN-EXTR-CSR                                        01950001
019600     END-EXEC.                                                    01960001
019700                                                                  01970001
019800     EVALUATE TRUE                                                01980001
019900       WHEN SQLCODE NOT = 0                                       01990001
020000       WHEN SQLWARN0    = 'W'                                     02000001
020100           MOVE '1070-CLOSE-REGN-EXTR-CSR'                        02010001
020200                             TO PV-PARAGRAPH-NAME                 02020001
020300           MOVE 'CLOSE FAILED FOR REGION EXTRACT CURSOR'          02030001
020400                             TO PV-DB2-ERROR-MSSG                 02040001
020500           PERFORM 9400-DB2-ERROR                                 02050001
020600     END-EVALUATE.                                                02060001
020700                                                                  02070001
020800******************************************************************02080001
020900* PROCESS  :  FETCH RECORDS AND WRITE TO EXTRACT FILE            *02090001
021000******************************************************************02100001
021100 2000-PROCESS.                                                    02110001
021200                                                                  02120001
021300     PERFORM 3000-WRITE-REGION-FILE.                              02130001
021400                                                                  02140001
021500     INITIALIZE HO007-REGION-DATA.                                02150001
021600                                                                  02160001
021700     PERFORM 1050-FETCH-REGN-EXTR-CSR.                            02170001
021800                                                                  02180001
021900******************************************************************02190001
022000* WRITE-REGION-FILE                                               02200001
022100******************************************************************02210001
022200 3000-WRITE-REGION-FILE.                                          02220001
022300                                                                  02230001
022400     WRITE XST-OUTPUT-RECORD     FROM HORD007-RECORD.             02240001
022600                                                                  02260001
022700******************************************************************02270001
022800*    DB2 ERROR                                                   *02280001
023300******************************************************************02330001
023400 9400-DB2-ERROR.                                                  02340001
023500                                                                  02350001
023600     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    02360001
023700     DISPLAY PC-DB-ERROR-PREFIX                                   02370001
023800     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             02380001
023900     COPY DPPD004.                                                02390001
024000     SET ABEND-4013-DB2-ERROR TO TRUE.                            02400001
024100     CALL 'ILBOABN0' USING ABEND-CODE.                            02410001
024200     EJECT                                                        02420001
