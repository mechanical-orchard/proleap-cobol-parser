       IDENTIFICATION DIVISION.                                         00020044
       PROGRAM-ID.    SUKCS805.                                         00030044
       AUTHOR.        Cognizant.                                        00040044
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050044
       DATE-WRITTEN.  MAY 2016.                                         00060044
       DATE-COMPILED.                                                   00070044
      *---------------------------------------------------------------  00080044
      *    S805 - getManifestDetailsByTimespan WEBSERVICE TRANSACTION   00090044
      *---------------------------------------------------------------  00100044
                                                                        00110044
       ENVIRONMENT DIVISION.                                            00120044
                                                                        00130044
       DATA DIVISION.                                                   00140044
                                                                        00150044
       WORKING-STORAGE SECTION.                                         00160044
         01  DK-DB2-KEYS.                                               00161002
             15  DK-STORE-NBR              PIC S9(04) COMP.             00162009
             15  DK-TRLR-STATUS1           PIC  X(02) VALUE SPACES.     00162136
             15  DK-TRLR-STATUS2           PIC  X(02) VALUE SPACES.     00162236
             15  DK-TRLR-STATUS3           PIC  X(02) VALUE SPACES.     00162336
             15  DK-FROM-TMST              PIC  X(26).                  00163018
             15  DK-TO-TMST                PIC  X(26).                  00164018
         01  PS-PROGRAM-SWITCHES.                                       00170044
           05  PS-EO-TRAILERS-CSR-SW       PIC  X(01) VALUE 'N'.        00170110
               88 PS-EO-TRAILERS-CSR                  VALUE 'Y'.        00170210
               88 PS-NO-EO-TRAILERS-CSR               VALUE 'N'.        00170310
           05  PS-FIRST-READ-SW            PIC  X(01) VALUE 'N'.        00170406
               88 PS-FIRST-READ                       VALUE 'Y'.        00170506
               88 PS-NO-FIRST-READ                    VALUE 'N'.        00170606
         01  PC-PROGRAM-CONSTANTS.                                      00170744
      ******************************************************************00170844
      *    7.  REQUIRED ENTRY                                           00170944
      *  380.  STORE NUMBER MUST BE NUMERIC AND GREATER THAN ZERO       00171044
      * 1044.  RESPONSE SUCCESSFUL                                      00171144
      * 1570.  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK          00171244
      * 3053.  OUTBOUND TRIP ID NOT FOUND                               00171344
      * 3787.  FUNCTION IS CURRENTLY UNAVAILABLE                        00171444
      * 3788.  NO TRAILERS FOUND IN THE PROVIDED TIMESPAN               00171544
      * 3789.  MORE THAN &VAR TRAILERS FOUND, REDUCE THE TIMESPAN TO    00171644
      *        FILTER                                                   00171743
      ******************************************************************00172144
           05  PC-TSYMSG-NUMBERS.                                       00172206
               10  PC-TSYMSG-00007         PIC  9(05) VALUE  00007.     00172329
               10  PC-TSYMSG-00380         PIC  9(05) VALUE  00380.     00172421
               10  PC-TSYMSG-01044         PIC  9(05) VALUE  01044.     00172506
               10  PC-TSYMSG-01570         PIC  9(05) VALUE  01570.     00172606
               10  PC-TSYMSG-03053         PIC  9(05) VALUE  03053.     00172706
               10  PC-TSYMSG-03787         PIC  9(05) VALUE  03787.     00172823
               10  PC-TSYMSG-03788         PIC  9(05) VALUE  03788.     00172927
               10  PC-TSYMSG-03789         PIC  9(05) VALUE  03789.     00173027
           05  PC-MAX-ITEMS                PIC S9(04) VALUE +100        00173127
                                                           COMP SYNC.   00173227
           05  PC-MSG-VAR-IND              PIC  X(04) VALUE '&VAR'.     00173327
         01  PV-PROGRAM-VARIABLES.                                      00173444
           05  PV-TSYMSG-NUMBER            PIC  9(05) VALUE  0.         00174027
           05  PV-SQLCODE                  PIC  9(09) VALUE  0.         00180006
           05  PV-CURR-TIMESTAMP           PIC X(26).                   00190144
           05  PV-CURR-TMST-DATE-HHMM   REDEFINES                       00191044
               PV-CURR-TIMESTAMP.                                       00192044
               10  PV-CURR-YEAR            PIC X(04).                   00192144
               10  FILLER                  PIC X(01).                   00192644
               10  PV-CURR-MONTH           PIC X(02).                   00192744
               10  FILLER                  PIC X(01).                   00192844
               10  PV-CURR-DAY             PIC X(02).                   00192944
               10  FILLER                  PIC X(01).                   00193044
               10  PV-CURR-HOUR            PIC X(02).                   00193144
               10  FILLER                  PIC X(01).                   00193244
               10  PV-CURR-MIN             PIC X(02).                   00193344
               10  FILLER                  PIC X(01).                   00193444
               10  PV-CURR-SEC             PIC X(02).                   00193544
               10  FILLER                  PIC X(07).                   00193644
           05  PV-CSSL-TMST.                                            00193744
               10  PV-CSSL-MONTH           PIC X(02).                   00193844
               10  FILLER                  PIC X(01) VALUE '-'.         00193944
               10  PV-CSSL-DAY             PIC X(02).                   00194044
               10  FILLER                  PIC X(01) VALUE SPACE.       00194144
               10  PV-CSSL-HOUR            PIC X(02).                   00194244
               10  FILLER                  PIC X(01) VALUE ':'.         00194344
               10  PV-CSSL-MIN             PIC X(02).                   00194444
               10  FILLER                  PIC X(01) VALUE ':'.         00194544
               10  PV-CSSL-SEC             PIC X(02).                   00194644
               10  FILLER                  PIC X(01) VALUE SPACE.       00194744
           05  PV-SHIPPED-TMST             PIC X(26).                   00194844
           05  PV-SHIPPED-TMST-DATE-HHMM   REDEFINES                    00194944
               PV-SHIPPED-TMST.                                         00195044
               10  PV-SHIPPED-DT           PIC X(10).                   00195144
               10  FILLER                  PIC X(01).                   00195244
               10  PV-SHIPPED-HH           PIC X(02).                   00195344
               10  FILLER                  PIC X(01).                   00195444
               10  PV-SHIPPED-MM           PIC X(02).                   00195544
               10  FILLER                  PIC X(01).                   00195644
               10  PV-SHIPPED-SS           PIC X(02).                   00195744
               10  FILLER                  PIC X(07).                   00195844
           05  PV-SHIPPED-TMST-OUT         PIC X(19).                   00195936
           05  PV-SHIPPED-TMST-OUT-R       REDEFINES                    00196036
               PV-SHIPPED-TMST-OUT.                                     00196136
               10  PV-SHIPPED-DATE         PIC X(10).                   00196236
               10  PV-T                    PIC X(01).                   00196336
               10  PV-SHIPPED-TIME         PIC X(08).                   00196436
           05  PV-CICS-MSG-AREA.                                        00196536
               10 PV-PROGRAM-NAME          PIC  X(10) VALUE             00196636
                                                     ' SUKCS805 '.      00196736
               10 PV-LOG-TIME              PIC  X(15) VALUE SPACES.     00196836
               10 PV-PARA-NAME             PIC  X(25) VALUE SPACES.     00196936
               10 PV-ERROR-MSG             PIC  X(78) VALUE SPACES.     00197040
           05  PV-COMMAREA-LENGTH          PIC S9(04)  VALUE +0         00197136
                                                           COMP SYNC.   00197236
           05  PV-CICS-RESPONSE            PIC S9(08)  VALUE ZEROS      00197336
                                                           COMP SYNC.   00197436
           05  PV-IDX                      PIC S9(04)  VALUE ZEROS      00197536
                                                           COMP SYNC.   00197636
           05  PV-MSG-VAR-LENGTH           PIC S9(04)  VALUE +0         00197736
                                                           COMP SYNC.   00197836
           05  PV-MSG-VAR-LEAD-SPACE       PIC S9(04)  VALUE +0         00197936
                                                           COMP SYNC.   00198036
           05  PV-CHAR-POS                 PIC S9(04)  VALUE +0         00198136
                                                           COMP SYNC.   00198236
           05  PV-MSG-VAR-SAVE             PIC  X(70)  VALUE SPACE.     00198336
           05  PV-MSG-REMAINDER            PIC  X(70)  VALUE SPACE.     00198436
           05  PV-MSG-VAR-IND              PIC  X(04)  VALUE SPACE.     00198536
           05  PV-MSG-STRING-PTR           PIC S9(04)  VALUE ZERO.      00198636
           05  PV-READ-COUNT               PIC S9(04)  VALUE +0         00198736
                                                           COMP SYNC.   00198836
           05  PV-INP-TMST                 PIC  X(13)  VALUE SPACES.    00198936
           05  PV-INP-TMST-RED             REDEFINES PV-INP-TMST.       00199036
               10  PV-TMST-YEAR            PIC  9(04).                  00199136
               10  PV-TMST-MONTH           PIC  9(02).                  00199236
               10  PV-TMST-DATE            PIC  9(02).                  00199336
               10  PV-FILLER               PIC  X(01).                  00199436
               10  PV-TMST-HOUR            PIC  9(02).                  00199536
               10  PV-TMST-MIN             PIC  9(02).                  00199636
           05  PV-DB2-TMST.                                             00199736
               10  PV-TMST-CCYY            PIC  9(04)  VALUE ZEROES.    00199836
               10  FILLER                  PIC  X(01)  VALUE '-'.       00199936
               10  PV-TMST-MM              PIC  9(02)  VALUE ZEROES.    00200036
               10  FILLER                  PIC  X(01)  VALUE '-'.       00200136
               10  PV-TMST-DD              PIC  9(02)  VALUE ZEROES.    00200236
               10  FILLER                  PIC  X(01)  VALUE '-'.       00200336
               10  PV-TMST-HH              PIC  9(02)  VALUE ZEROES.    00200436
               10  FILLER                  PIC  X(01)  VALUE '.'.       00200536
               10  PV-TMST-MN              PIC  9(02)  VALUE ZEROES.    00200636
               10  FILLER                  PIC  X(01)  VALUE '.'.       00200736
               10  PV-TMST-SS              PIC  9(02)  VALUE ZEROES.    00200836
               10  FILLER                  PIC  X(01)  VALUE '.'.       00200936
               10  PV-TMST-MS              PIC  9(06)  VALUE ZEROES.    00201036
                                                                        00201136
                                                                        00201244
      *INPUT                                                            00201336
            COPY SURD126.                                               00201436
      *OUTPUT                                                           00202000
            COPY SURD127.                                               00210032
                                                                        00220000
            COPY DPRD507I.                                              00230032
                                                                        00240000
           EXEC SQL                                                     01790000
               INCLUDE SQLCA                                            01800000
           END-EXEC.                                                    01810000
                                                                        01811000
           EXEC SQL                                                     01812000
               INCLUDE TKRPRPM                                          01813023
           END-EXEC.                                                    01814000
                                                                        01815000
           EXEC SQL                                                     01815123
               INCLUDE TSUOBTS                                          01815223
           END-EXEC.                                                    01815323
                                                                        01815423
           EXEC SQL                                                     01816000
               INCLUDE TSUOBTR                                          01817009
           END-EXEC.                                                    01818000
                                                                        01818109
           EXEC SQL                                                     01818209
               INCLUDE TCNTRID                                          01818309
           END-EXEC.                                                    01818409
                                                                        01819000
           EXEC SQL                                                     01819144
               DECLARE TRAILERS-CSR CURSOR FOR                          01819244
                SELECT                                                  01819344
                          OBTS.OTBND_TRIP_ID                            01819444
                         ,OBTS.TRLR_SEAL_ID                             01819546
                         ,OBTR.TRLR_SRL_NBR                             01820344
                         ,OBTS.TRIP_STAT_CDE                            01820544
                         ,OBTS.OTBND_STAT_TMST                          01820609
                         ,TRID.SCAC_CDE                                 01820709
                         ,TRID.TRLR_ID                                  01820809
                FROM                                                    01820909
                    TSUOBTS OBTS                                        01821009
                  , TSUOBTR OBTR                                        01821109
                  , TCNTRID TRID                                        01821209
                WHERE                                                   01821309
                      OBTR.DEST_OPER_UNT_ID = :DK-STORE-NBR             01821409
                  AND OBTS.OTBND_TRIP_ID    = OBTR.OTBND_TRIP_ID        01821509
                  AND OBTR.TRLR_SRL_NBR     = TRID.TRLR_SRL_NBR         01821709
                  AND OBTS.OTBND_STAT_TMST  =                           01821809
                          (SELECT  MAX(OBTS1.OTBND_STAT_TMST)           01821909
                                     FROM  TSUOBTS OBTS1                01822009
                    WHERE  OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)    01822109
                                                                        01822209
                  AND OBTS.TRIP_STAT_CDE  IN ( :DK-TRLR-STATUS1         01822336
                                             , :DK-TRLR-STATUS2         01822436
                                             , :DK-TRLR-STATUS3 )       01822536
                  AND OBTS.OTBND_STAT_TMST BETWEEN                      01822618
                      :DK-FROM-TMST AND :DK-TO-TMST                     01822718
                                                                        01822809
                  ORDER BY                                              01822909
                      OBTS.OTBND_STAT_TMST DESC                         01823009
                    WITH UR                                             01823109
           END-EXEC.                                                    01823244
      *----------------------------------------------------------------*01824044
       LINKAGE SECTION.                                                 01830044
                                                                        01840044
       01  DFHCOMMAREA.                                                 01850044
           05  FILLER                         OCCURS  1 TO 30000 TIMES  01860044
                                              DEPENDING ON EIBCALEN.    01890044
               10  FILLER                     PIC X.                    01900044
                                                                        01901006
       PROCEDURE DIVISION.                                              01910044
      ***************************************************************** 01920044
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01930044
      ***************************************************************** 01990044
       0000-MAIN-MODULE.                                                02000044
                                                                        02001000
           PERFORM 1000-INITIALIZE.                                     02002000
           PERFORM 1100-CHECK-WEBSERV-AVAIL.                            02003023
           IF EIBCALEN > 0                                              02040044
                                                                        02050044
              MOVE DFHCOMMAREA(1:32)     TO SU126-GET-MANIFEST-DTL-TMST 02060044
                                                                        02080044
              PERFORM 1500-VALIDATE-INPUT                               02081017
                                                                        02082009
              PERFORM 2000-GET-TRAILERS                                 02110044
                                                                        02120044
           END-IF.                                                      02180044
                                                                        02190044
           PERFORM 9000-RETURN-TRAN                                     02191000
              .                                                         02230044
      *----------------------------------------------------------------*02370044
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02380044
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02390044
      *----------------------------------------------------------------*02400044
                                                                        02410044
       1000-INITIALIZE.                                                 02420044
           INITIALIZE SU126-GET-MANIFEST-DTL-TMST                       02421044
                      SU127-OUT-MANIFEST-DTL-TMST                       02422044
                      DK-TRLR-STATUS1                                   02423036
                      DK-TRLR-STATUS2                                   02423136
                      DK-TRLR-STATUS3.                                  02423236
            EXEC SQL                                                    02423336
              SELECT                                                    02423436
                    CURRENT TIMESTAMP                                   02423536
              INTO                                                      02423636
                   :PV-CURR-TIMESTAMP                                   02423738
              FROM SYSIBM.SYSDUMMY1                                     02423836
            END-EXEC.                                                   02423936
                                                                        02424036
           EVALUATE TRUE                                                02424144
                                                                        02424236
               WHEN SQLCODE = ZERO                                      02424344
                                                                        02424436
                  MOVE  PV-CURR-MONTH    TO PV-CSSL-MONTH               02424536
                  MOVE  PV-CURR-DAY      TO PV-CSSL-DAY                 02424636
                  MOVE  PV-CURR-HOUR     TO PV-CSSL-HOUR                02424836
                  MOVE  PV-CURR-MIN      TO PV-CSSL-MIN                 02425036
                  MOVE  PV-CURR-SEC      TO PV-CSSL-SEC                 02425236
                  MOVE  PV-CSSL-TMST     TO PV-LOG-TIME                 02425336
                                                                        02425444
               WHEN SQLCODE NOT = ZERO                                  02425536
                                                                        02425636
                    MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 02425736
                    MOVE SQLCODE                    TO PV-SQLCODE       02425836
                    MOVE '1000-INITIALIZE '         TO PV-PARA-NAME     02425936
                                                                        02426041
                    STRING 'DB2 IS NOT ACTIVE, SQLCODE:'                02426136
                    PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     02426236
                                                                        02426341
                    PERFORM 9995-CSSL-LOG-RETURN                        02426436
                                                                        02426536
           END-EVALUATE.                                                02426644
       1100-CHECK-WEBSERV-AVAIL.                                        02426744
                                                                        02426823
            EXEC SQL                                                    02426923
              SELECT FUNC_TXT                                           02427023
                INTO :KRPRPM-FUNC-TXT                                   02427123
                FROM TKRPRPM                                            02427223
              WHERE LOC_ID            = 90                              02427323
                AND INTFC_SYS_CDE     = 'KHL'                           02427423
                AND SYS_PRC_FUNC_CDE  = 'STWEB5'                        02427523
                AND FUNC_PRC_STAT_CDE = 'AC'                            02427623
                AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              02427723
                AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              02427823
                AND FUNC_TXT          = 'Y'                             02427923
              WITH UR                                                   02428023
            END-EXEC.                                                   02428123
                                                                        02428223
           EVALUATE TRUE                                                02428344
               WHEN SQLCODE = ZERO                                      02428444
                                                                        02428523
                        CONTINUE                                        02428644
                                                                        02428744
               WHEN SQLCODE = +100                                      02428844
                                                                        02428923
                    MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER  02429023
                    MOVE                                                02429123
               'WEB SERVICE getManifestDetailsByTimespan NOT AVAILABLE' 02429223
                                                     TO PV-ERROR-MSG    02429323
                    MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    02429423
                    PERFORM 9995-CSSL-LOG-RETURN                        02429523
                                                                        02429644
               WHEN SQLCODE NOT = ZERO                                  02429723
                                                                        02429823
                    MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 02429923
                    MOVE SQLCODE                    TO PV-SQLCODE       02430023
                    MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME     02430123
                    STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        02430223
                    PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     02430323
                    PERFORM 9995-CSSL-LOG-RETURN                        02430423
                                                                        02430523
           END-EVALUATE.                                                02430644
       1500-VALIDATE-INPUT.                                             02430744
                                                                        02431044
            IF SU126-STORE-NUMBER GREATER THAN ZERO                     02440044
                                                                        02450044
               MOVE SU126-STORE-NUMBER TO DK-STORE-NBR                  02460044
                                                                        02470044
            ELSE                                                        02480044
               MOVE PC-TSYMSG-00380             TO PV-TSYMSG-NUMBER     02663030
               MOVE 'STORE NUMBER REQUIRED '    TO PV-ERROR-MSG         02664030
               MOVE '1500-VALIDATE-INPUT   '    TO PV-PARA-NAME         02667030
               PERFORM 9995-CSSL-LOG-RETURN                             02670612
                                                                        02671000
            END-IF.                                                     02672010
                                                                        02672118
            IF SU126-TRLR-STATUS  GREATER THAN SPACES                   02672244
                                                                        02672344
               IF SU126-TRLR-STATUS  =  'DS'                            02672636
                  MOVE 'DS'           TO DK-TRLR-STATUS1                02672736
                  MOVE 'SO'           TO DK-TRLR-STATUS2                02672836
                  MOVE 'SU'           TO DK-TRLR-STATUS3                02672936
                                                                        02673036
               ELSE                                                     02673136
                                                                        02673236
                  IF SU126-TRLR-STATUS  =  'SO'                         02673536
                                                                        02673636
                     MOVE 'SO'        TO DK-TRLR-STATUS1                02673736
                     MOVE 'SU'        TO DK-TRLR-STATUS2                02673836
                                                                        02673936
                  ELSE                                                  02674036
                                                                        02674136
                     IF SU126-TRLR-STATUS  =  'SU'                      02674236
                                                                        02674336
                        MOVE 'SU'        TO DK-TRLR-STATUS1             02674436
                                                                        02674744
                     ELSE                                               02674844
                        MOVE PC-TSYMSG-00007       TO PV-TSYMSG-NUMBER  02674936
                        MOVE '1500-VALIDATE-INPUT' TO PV-PARA-NAME      02675036
                        MOVE 'STATUS SHOULD BE EITHER DS OR SO OR SU'   02675136
                                                   TO PV-ERROR-MSG      02675236
                                                                        02675336
                        PERFORM 9995-CSSL-LOG-RETURN                    02675436
                                                                        02675536
                     END-IF                                             02675636
                  END-IF                                                02675736
               END-IF                                                   02675836
            ELSE                                                        02675944
               MOVE PC-TSYMSG-00007             TO PV-TSYMSG-NUMBER     02676036
               MOVE 'TRAILER STATUS REQUIRED '  TO PV-ERROR-MSG         02676136
               MOVE '1500-VALIDATE-INPUT   '    TO PV-PARA-NAME         02676236
               PERFORM 9995-CSSL-LOG-RETURN                             02676336
                                                                        02676436
            END-IF.                                                     02676536
                                                                        02676636
            IF SU126-FROM-TMST    GREATER THAN SPACES                   02676744
                                                                        02676844
               MOVE SU126-FROM-TMST             TO PV-INP-TMST          02676944
               PERFORM 1600-CONVERT-TMST                                02677036
               MOVE PV-DB2-TMST                 TO DK-FROM-TMST         02677136
                                                                        02677244
            ELSE                                                        02677344
                                                                        02677436
               MOVE PC-TSYMSG-00007             TO PV-TSYMSG-NUMBER     02677536
               MOVE 'FROM TIMESTAMP REQUIRED '  TO PV-ERROR-MSG         02677636
               MOVE '1500-VALIDATE-INPUT   '    TO PV-PARA-NAME         02677736
               PERFORM 9995-CSSL-LOG-RETURN                             02677836
                                                                        02677936
            END-IF.                                                     02678036
                                                                        02678136
            IF SU126-TO-TMST      GREATER THAN SPACES                   02678244
                                                                        02678344
               MOVE SU126-TO-TMST               TO PV-INP-TMST          02678444
               PERFORM 1600-CONVERT-TMST                                02678536
               MOVE PV-DB2-TMST                 TO DK-TO-TMST           02678636
                                                                        02678744
            ELSE                                                        02678844
               MOVE PC-TSYMSG-00007             TO PV-TSYMSG-NUMBER     02678936
               MOVE 'TO TIMESTAMP REQUIRED '    TO PV-ERROR-MSG         02679036
               MOVE '1500-VALIDATE-INPUT   '    TO PV-PARA-NAME         02679136
               PERFORM 9995-CSSL-LOG-RETURN                             02679236
                                                                        02679336
            END-IF.                                                     02680033
       1600-CONVERT-TMST.                                               02731018
                                                                        02731118
            MOVE PV-TMST-YEAR          TO PV-TMST-CCYY                  02731218
            MOVE PV-TMST-MONTH         TO PV-TMST-MM                    02731318
            MOVE PV-TMST-DATE          TO PV-TMST-DD                    02731418
            MOVE PV-TMST-HOUR          TO PV-TMST-HH                    02731518
            MOVE PV-TMST-MIN           TO PV-TMST-MN                    02731618
            .                                                           02731718
       2000-GET-TRAILERS.                                               02731918
                                                                        02732018
            PERFORM 2100-OPEN-TRAILERS-CSR.                             02732118
            PERFORM 2200-FETCH-TRAILERS.                                02732218
            PERFORM 2400-CLOSE-TRAILERS-CSR.                            02732318
                                                                        02732418
       2100-OPEN-TRAILERS-CSR.                                          02732518
                                                                        02732618
            EXEC SQL                                                    02732718
                 OPEN TRAILERS-CSR                                      02732818
            END-EXEC.                                                   02732918
                                                                        02733018
            EVALUATE TRUE                                               02733144
               WHEN SQLCODE = ZERO                                      02733244
                                                                        02733318
                  CONTINUE                                              02733444
                                                                        02733518
               WHEN SQLCODE NOT = ZERO                                  02733644
                                                                        02733705
                  MOVE SQLCODE    TO PV-SQLCODE                         02733805
                                                                        02733905
                  MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   02734011
                  STRING 'OPEN TRAILERS-CSR FAILED WITH SQLCODE:'       02734110
                   PV-SQLCODE DELIMITED BY SIZE INTO PV-ERROR-MSG       02734205
                                                                        02734305
                  MOVE ' 2100-OPEN-TRAILERS-CSR ' TO PV-PARA-NAME       02734411
                  PERFORM 9995-CSSL-LOG-RETURN                          02734505
                                                                        02734605
            END-EVALUATE                                                02734744
            .                                                           02734844
       2200-FETCH-TRAILERS.                                             02735010
            SET PS-FIRST-READ TO TRUE                                   02735306
            MOVE +1           TO PV-IDX                                 02735415
            MOVE 'N'          TO PS-EO-TRAILERS-CSR-SW                  02735510
                                                                        02735610
            PERFORM                                                     02735710
                 VARYING PV-READ-COUNT                                  02735810
                 FROM 1 BY 1                                            02735910
                 UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                  02736010
                    OR (PS-EO-TRAILERS-CSR))                            02736110
                                                                        02736206
                 PERFORM 2300-FETCH-TRAILERS-CSR                        02736310
                 ADD +1       TO PV-IDX                                 02736410
                                                                        02736506
            END-PERFORM.                                                02736610
                                                                        02736710
            IF PS-NO-EO-TRAILERS-CSR                                    02736811
                                                                        02736910
               MOVE PC-TSYMSG-03789  TO PV-TSYMSG-NUMBER                02737026
                                                                        02737110
            ELSE                                                        02737211
                                                                        02737311
               MOVE PC-TSYMSG-01044  TO PV-TSYMSG-NUMBER                02737411
                                                                        02737511
            END-IF.                                                     02737610
                                                                        02737710
       2300-FETCH-TRAILERS-CSR.                                         02737810
                                                                        02737906
            EXEC SQL                                                    02738006
                 FETCH TRAILERS-CSR                                     02738110
                  INTO                                                  02738210
                       :SUOBTS-OTBND-TRIP-ID                            02738310
                      ,:SUOBTS-TRLR-SEAL-ID                             02738447
                      ,:SUOBTR-TRLR-SRL-NBR                             02738546
                      ,:SUOBTS-TRIP-STAT-CDE                            02738646
                      ,:SUOBTS-OTBND-STAT-TMST                          02738746
                      ,:CNTRID-SCAC-CDE                                 02738846
                      ,:CNTRID-TRLR-ID                                  02738946
            END-EXEC.                                                   02739046
            EVALUATE TRUE                                               02739146
               WHEN SQLCODE = ZERO                                      02739246
                                                                        02739346
                  SET PS-NO-FIRST-READ TO TRUE                          02739446
                  PERFORM 2350-MOVE-DATA-TO-OUTPUT                      02739546
                                                                        02739646
                  ADD +1               TO SU127-TRAILER-COUNT           02740016
                                                                        02740106
               WHEN SQLCODE = 100                                       02740244
                                                                        02740306
                  IF PS-FIRST-READ                                      02740406
                                                                        02740506
                     MOVE PC-TSYMSG-03788      TO PV-TSYMSG-NUMBER      02740626
                     STRING 'NO TRAILERS FOUND BETWEEN FROM '           02740736
                     SU126-FROM-TMST ' TO ' SU126-TO-TMST               02740836
                     ' STORE#' SU126-STORE-NUMBER                       02740910
                     DELIMITED BY SIZE INTO       PV-ERROR-MSG          02741010
                                                                        02741110
                     MOVE ' 2300-FETCH-TRAILERS-CSR'                    02741210
                                               TO PV-PARA-NAME          02741306
                     PERFORM 2400-CLOSE-TRAILERS-CSR                    02741410
                     PERFORM 9995-CSSL-LOG-RETURN                       02741506
                                                                        02741606
                  END-IF                                                02741706
                                                                        02741806
                  SET PS-EO-TRAILERS-CSR       TO TRUE                  02741910
                                                                        02742006
               WHEN SQLCODE NOT = ZERO                                  02742144
                                                                        02742206
                  MOVE SQLCODE    TO PV-SQLCODE                         02742306
                                                                        02742406
                  MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   02742511
                  STRING 'FETCH TRAILERS-CSR FAILED WITH SQLCODE:'      02742611
                   PV-SQLCODE ' FOR STORE#' SU126-STORE-NUMBER          02742711
                              DELIMITED BY SIZE INTO PV-ERROR-MSG       02742806
                                                                        02742906
                  MOVE '2300-FETCH-TRAILERS-CSR ' TO PV-PARA-NAME       02743011
                  PERFORM 9995-CSSL-LOG-RETURN                          02743106
                                                                        02743206
            END-EVALUATE                                                02743344
            .                                                           02743444
       2350-MOVE-DATA-TO-OUTPUT.                                        02743610
                                                                        02743710
           MOVE SUOBTS-OTBND-TRIP-ID   TO SU127-OUTBND-TRIP-ID(PV-IDX)  02743844
           MOVE SUOBTS-TRLR-SEAL-ID    TO SU127-TRLR-SEAL-ID  (PV-IDX)  02743946
           MOVE SUOBTR-TRLR-SRL-NBR    TO SU127-TRLR-SRL-NBR  (PV-IDX)  02744046
           MOVE SUOBTS-TRIP-STAT-CDE   TO SU127-TRLR-STATUS   (PV-IDX)  02744146
           MOVE CNTRID-TRLR-ID         TO SU127-TRAILER-ID    (PV-IDX)  02744246
           MOVE CNTRID-SCAC-CDE        TO SU127-TRLR-SCAC-CDE (PV-IDX)  02744346
           MOVE SUOBTS-OTBND-STAT-TMST TO PV-SHIPPED-TMST               02744446
           MOVE PV-SHIPPED-DT          TO PV-SHIPPED-DATE               02744546
           MOVE 'T'                    TO PV-T                          02744646
           MOVE PV-SHIPPED-HH          TO PV-SHIPPED-TIME(1:2)          02744746
           MOVE ':'                    TO PV-SHIPPED-TIME(3:1)          02744846
                                          PV-SHIPPED-TIME(6:1)          02744946
           MOVE PV-SHIPPED-MM          TO PV-SHIPPED-TIME(4:2)          02745046
           MOVE PV-SHIPPED-SS          TO PV-SHIPPED-TIME(7:2)          02745146
           MOVE PV-SHIPPED-TMST-OUT    TO SU127-TRLR-TMST     (PV-IDX)  02745246
           .                                                            02745346
       2400-CLOSE-TRAILERS-CSR.                                         02745446
                                                                        02745546
            EXEC SQL                                                    02745646
                 CLOSE TRAILERS-CSR                                     02745746
            END-EXEC.                                                   02745846
                                                                        02745946
            EVALUATE TRUE                                               02746046
               WHEN SQLCODE = ZERO                                      02746146
                                                                        02746246
                  CONTINUE                                              02746346
                                                                        02746446
               WHEN SQLCODE NOT = ZERO                                  02746546
                                                                        02746646
                  MOVE SQLCODE    TO PV-SQLCODE                         02746746
                                                                        02746846
                  MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   02746946
                  STRING 'CLOSE TRAILERS-CSR FAILED WITH SQLCODE:'      02747046
                   PV-SQLCODE DELIMITED BY SIZE INTO PV-ERROR-MSG       02747146
                                                                        02747246
                  MOVE ' 2400-CLOSE-TRAILERS-CSR' TO PV-PARA-NAME       02747346
                  PERFORM 9995-CSSL-LOG-RETURN                          02747446
                                                                        02747546
            END-EVALUATE                                                02747646
            .                                                           02747746
       9990-CSSL-LOG.                                                   02747810
                                                                        02747910
            MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     02748010
                                                                        02748110
            EXEC CICS                                                   02748210
                 WRITEQ TD                                              02748310
                  QUEUE   ('CSSL')                                      02748410
                   FROM   (PV-CICS-MSG-AREA)                            02748510
                 LENGTH   (PV-COMMAREA-LENGTH)                          02748610
                   RESP   (PV-CICS-RESPONSE)                            02748710
            END-EXEC.                                                   02749000
                                                                        02750000
           .                                                            02761000
       9995-CSSL-LOG-RETURN.                                            02762000
                                                                        02763000
           PERFORM 9990-CSSL-LOG.                                       02764000
                                                                        02765000
           PERFORM 9000-RETURN-TRAN.                                    02769544
                                                                        02769600
       9000-RETURN-TRAN.                                                02770000
                                                                        02771000
           MOVE PV-TSYMSG-NUMBER         TO DP507I-MSG-NUMBER           02771106
                                            SU127-MSG-ID.               02771210
                                                                        02771300
           PERFORM 9010-READ-SYSTEM-MESSAGE.                            02772000
           MOVE DP507I-MSG-TEXT             TO SU127-MSG-TEXT           02773010
                                                                        02774027
           IF PV-TSYMSG-NUMBER = 03789                                  02775027
              PERFORM 9312-SUBSTITUTE-MSG-VAR                           02776027
                                                                        02777027
           END-IF.                                                      02778027
           MOVE SU127-OUT-MANIFEST-DTL-TMST TO DFHCOMMAREA.             02780044
                                                                        02790044
           EXEC CICS RETURN END-EXEC                                    02800044
           .                                                            02810000
       9010-READ-SYSTEM-MESSAGE.                                        02820000
           EXEC CICS READ                                               02830044
                     DATASET ('DPSYSMSG')                               02840044
                     RIDFLD  (DP507I-MSG-NUMBER)                        02850044
                     INTO    (DP507I-MESSAGES-INPUT-RECORD)             02860044
                     RESP    (PV-CICS-RESPONSE)                         02870044
           END-EXEC.                                                    02880044
      *                                                                 02890044
           IF  PV-CICS-RESPONSE NOT = 0                                 02900044
               MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 02910044
                                      TO DP507I-MSG-TEXT                02920044
           END-IF.                                                      02930044
                                                                        02940044
       9312-SUBSTITUTE-MSG-VAR.                                         02950044
           MOVE +1               TO PV-MSG-VAR-LEAD-SPACE.              02960044
           MOVE SU127-MSG-TEXT   TO PV-MSG-VAR-SAVE.                    02970044
           INITIALIZE SU127-MSG-TEXT                                    02980044
                      PV-MSG-VAR-IND                                    02990044
                      PV-MSG-STRING-PTR                                 03000044
                      PV-MSG-REMAINDER.                                 03010044
      *                                                                 03020044
           UNSTRING DP507I-MSG-TEXT DELIMITED BY PC-MSG-VAR-IND         03030044
               INTO SU127-MSG-TEXT                                      03040044
                       DELIMITER IN PV-MSG-VAR-IND                      03050044
                       COUNT     IN PV-MSG-STRING-PTR                   03060044
                    PV-MSG-REMAINDER                                    03070044
           END-UNSTRING.                                                03080044
                                                                        03090027
           IF  PV-MSG-STRING-PTR > ZERO                                 03100044
               ADD +1            TO PV-MSG-STRING-PTR                   03110044
           ELSE                                                         03120044
               MOVE +1           TO PV-MSG-STRING-PTR                   03130044
           END-IF.                                                      03140044
           IF  PV-MSG-VAR-SAVE > SPACE                                  03150044
               IF  PV-MSG-VAR-SAVE(1:1) > SPACE                         03160044
                   CONTINUE                                             03170044
               ELSE                                                     03180044
                   INSPECT PV-MSG-VAR-SAVE                              03190044
                       TALLYING PV-MSG-VAR-LEAD-SPACE                   03200044
                       FOR LEADING SPACE                                03210044
               END-IF                                                   03220044
           ELSE                                                         03230044
               MOVE '?'         TO PV-MSG-VAR-SAVE                      03240044
           END-IF.                                                      03250044
      *==> FIND LAST NON-BLANK CHARACTER OF THE MSG VAR.                03260044
           MOVE LENGTH OF PV-MSG-VAR-SAVE                               03270044
                                TO PV-MSG-VAR-LENGTH.                   03280044
           PERFORM                                                      03290044
               VARYING PV-CHAR-POS                                      03300044
               FROM PV-MSG-VAR-LENGTH                                   03310044
               BY -1                                                    03320044
               UNTIL PV-CHAR-POS < 1                                    03330044
                 OR PV-MSG-VAR-SAVE(PV-CHAR-POS:1) > SPACE              03340044
                   CONTINUE                                             03350044
           END-PERFORM.                                                 03360044
           COMPUTE PV-MSG-VAR-LENGTH =                                  03370044
               PV-CHAR-POS - PV-MSG-VAR-LEAD-SPACE + 1.                 03380044
           MOVE PC-MAX-ITEMS TO SU127-MSG-TEXT  (PV-MSG-STRING-PTR:4)   03390028
                                                                        03400027
           ADD +4                TO PV-MSG-STRING-PTR.                  03410044
           IF  PV-MSG-STRING-PTR < LENGTH OF SU127-MSG-TEXT             03420044
               MOVE PV-MSG-REMAINDER                                    03430044
                               TO SU127-MSG-TEXT  (PV-MSG-STRING-PTR:)  03440044
           END-IF.                                                      03450044
      *                                                                 03460044
