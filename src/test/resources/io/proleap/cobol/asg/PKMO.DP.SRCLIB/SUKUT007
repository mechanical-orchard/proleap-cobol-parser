000100******************************************************************00010021
000200 IDENTIFICATION DIVISION.                                         00020021
000300******************************************************************00030021
000400                                                                  00040021
000500 PROGRAM-ID.    SUKUT007.                                         00050021
000600 AUTHOR.        STEPHANIE HERON                                   00060021
000700 INSTALLATION.  KOHLS.                                            00070021
000800 DATE-WRITTEN   JULY, 1997.                                       00080021
000900 DATE-COMPILED.                                                   00090021
001000                                                                  00100021
001100******************************************************************00110021
001200*  THIS PROGRAM WILL INSERT A LOCATION RECORD FOR ALL CARTONS THAT00120021
001300*  HAVE NOT BEEN CHECKED IN, IN OVER 9 MONTHS.  THIS WILL ALLOW   00130021
001400*  THE REST OF THE JOBSTEAM TO PICK UP THE DATA AS USUAL          00140021
001401*                                                                 00140121
001402*  IN MARCH/APRIL, PROGRAM WAS CHANGED TO SHORTEN THE PERIOD      00140222
001403*  OF TIME FROM NON-CHECKED IN CARTONS FROM 9 MONTHS DOWN TO      00140321
001404*  6 MONTHS (180 DAYS).                                           00140425
001405*                                                                 00140541
001406*  MADE CHANGE TO NUMBER OF DAYS IN THE 1100 PARAGRAPH TO         00140640
001407*  CHANGE VALUE OF 70 TO 100, VALUE OF 71 TO 101 AND CHANGE       00140740
001408*  VALUE OF 180 TO 210.                                           00140840
001500******************************************************************00150021
001600                                                                  00160021
001700******************************************************************00170021
001800 ENVIRONMENT DIVISION.                                            00180021
001900******************************************************************00190021
002000                                                                  00200021
002100 CONFIGURATION SECTION.                                           00210021
002200                                                                  00220021
002300 SOURCE-COMPUTER.        IBM-3090.                                00230021
002400 OBJECT-COMPUTER.        IBM-3090.                                00240021
002500                                                                  00250021
002600 INPUT-OUTPUT SECTION.                                            00260021
002700                                                                  00270021
002800 FILE-CONTROL.                                                    00280021
002900                                                                  00290021
003000                                                                  00300021
003100     SELECT TIMESTAMP-FILE                                        00310021
003200         ASSIGN TO OUT01.                                         00320021
003300                                                                  00330021
003400     SELECT INSERT-FILE                                           00340021
003500         ASSIGN TO OUT02.                                         00350021
003600                                                                  00360021
003700******************************************************************00370021
003800 DATA DIVISION.                                                   00380021
003900******************************************************************00390021
004000                                                                  00400021
004100 FILE SECTION.                                                    00410021
004200                                                                  00420021
004300                                                                  00430021
004400 FD  TIMESTAMP-FILE                                               00440021
004500     RECORDING MODE IS F                                          00450021
004600     LABEL RECORDS ARE STANDARD                                   00460021
004700     BLOCK CONTAINS 0 RECORDS.                                    00470021
004800                                                                  00480021
004900 01  TIMESTAMP-RECORD           PIC  X(50).                       00490021
005000                                                                  00500021
005100 FD  INSERT-FILE                                                  00510021
005200     RECORDING MODE IS F                                          00520021
005300     LABEL RECORDS ARE STANDARD                                   00530021
005400     BLOCK CONTAINS 0 RECORDS.                                    00540021
005500                                                                  00550021
005600 01  INSERT-RECORD              PIC  X(100).                      00560021
005700                                                                  00570021
005800*                                                                 00580021
005900*                                                                 00590021
006000******************************************************************00600021
006100 WORKING-STORAGE SECTION.                                         00610021
006200******************************************************************00620021
006300*                                                                 00630021
006400*                                                                 00640021
006500*                                                                 00650021
006600*                                                                 00660021
006700******************************************************************00670021
006800*  RECORD LAYOUT FOR THE TIMESTAMP FILE.                          00680021
006900******************************************************************00690021
007000     COPY RCRD011.                                                00700021
007100*                                                                 00710021
007200******************************************************************00720021
007300*  RECORD LAYOUT FOR THE TIMESTAMP FILE.                          00730021
007400******************************************************************00740021
007500     COPY SURD002.                                                00750021
007600*                                                                 00760021
007700*                                                                 00770021
007800******************************************************************00780021
007900*  DB2 FORMATTED MESSAGE AREA                                     00790021
008000******************************************************************00800021
008100     COPY DPWS004.                                                00810033
008200*                                                                 00820021
008300*                                                                 00830021
008400******************************************************************00840021
008500*  COMMUNICATIONS AREA FOR DB2                                    00850021
008600******************************************************************00860021
008700     EXEC SQL                                                     00870021
008800          INCLUDE SQLCA                                           00880021
008900     END-EXEC.                                                    00890021
009000                                                                  00900021
009100******************************************************************00910021
009200*  WST_INTGRTN_TYP - INTEGRATION PARM                             00920042
009400******************************************************************00940021
009500     EXEC SQL                                                     00950021
009600          INCLUDE WST00008                                        00960042
009700     END-EXEC.                                                    00970021
009710                                                                  00971042
009720******************************************************************00972042
009730*  WST_ATTR_DEFN   - INTEGRATION PARM DEFINITIONS                 00973042
009740******************************************************************00974042
009750     EXEC SQL                                                     00975042
009760          INCLUDE WST00009                                        00976042
009770     END-EXEC.                                                    00977042
009780                                                                  00978042
009790******************************************************************00979042
009791*  WST_ATTR_ELEM   - INTEGRATION PARM ELEMENTS                    00979142
009792******************************************************************00979242
009793     EXEC SQL                                                     00979342
009794          INCLUDE WST00010                                        00979442
009795     END-EXEC.                                                    00979542
009796                                                                  00979642
009800******************************************************************00980021
009900*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00990021
010000*  TABLE                                                          01000021
010100******************************************************************01010021
010200     EXEC SQL                                                     01020021
010300          INCLUDE TSHPUNT                                         01030021
010400     END-EXEC.                                                    01040021
010500******************************************************************01050021
010600*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      01060021
010700*  LOCATION TABLE                                                 01070021
010800******************************************************************01080021
010900     EXEC SQL                                                     01090021
011000          INCLUDE TSHUNLO                                         01100021
011100     END-EXEC.                                                    01110021
011200*                                                                 01120021
011300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01130021
011400                                                   COMP SYNC.     01140021
011500                                                                  01150021
011600 01  PS-PROGRAM-SWITCHES.                                         01160021
011700     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01170021
011800         88  PS-END-OF-CURSOR                      VALUE 'Y'.     01180021
011900         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     01190021
012000                                                                  01200021
012100                                                                  01210021
012200 01  PC-PROGRAM-CONSTANTS.                                        01220021
012300     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01230021
012400                                                   COMP SYNC.     01240021
012500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01250021
012600         'SUKUT007'.                                              01260021
012700     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 020.     01270021
012800     05  PC-INSERT-TIMESTAMP         PIC  X(26)    VALUE SPACES.  01280021
012900     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01290021
013000     05  PC-CURRENT-TIMESTAMP-RDF  REDEFINES PC-CURRENT-TIMESTAMP.01300021
013100         10  PC-CURRENT-DATE         PIC X(10).                   01310021
013200         10  PC-CURRENT-TIME         PIC X(16).                   01320021
013300     05  PC-EXTRACT-DATE             PIC X(10).                   01330021
013400                                                                  01340021
013500 01  PV-PROGRAM-VARIABLES.                                        01350021
013600     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01360021
013700     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01370021
013800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01380021
013900     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01390021
014000                                                   COMP SYNC.     01400021
014100     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01410021
014200                                                   COMP SYNC.     01420021
014300     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01430021
014400                                                   COMP SYNC.     01440021
014500     05  PC-FETCH-COUNT              PIC S9(09)    VALUE ZERO     01450021
014600                                                   COMP SYNC.     01460021
014700     05  PC-WRITE-COUNT              PIC S9(09)    VALUE ZERO     01470021
014800                                                   COMP SYNC.     01480021
014900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01490021
015000     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       01500021
015100                                                   COMP SYNC.     01510021
015200     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    01520021
015300                                                                  01530021
015400     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01540021
015401                                                   COMP-3.        01540143
015402                                                                  01540243
015410     05  PV-PURGE-CURRENT-DAYS       PIC  S9(10)V9(5) COMP-3.     01541044
015420     05  PV-PURGE-INSERT-DAYS        PIC  S9(10)V9(5) COMP-3.     01542044
015430     05  PV-PURGE-EXTRACT-DAYS       PIC  S9(10)V9(5) COMP-3.     01543044
015440     05  PV-DISP-DAYS                PIC  Z,ZZZ,ZZZ,ZZ9-.         01544044
015700                                                                  01570021
015800 01  SD-SYSTEM-DATE.                                              01580021
015900     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  01590021
016000     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  01600021
016100     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  01610021
016200                                                                  01620021
016300                                                                  01630021
016400     EXEC SQL                                                     01640021
016500          DECLARE TSHPUNT_CSR CURSOR FOR                          01650045
016600           SELECT                                                 01660021
016700                A.SHIPT_UNT_ID,                                   01670021
016800                A.ORGN_OPER_UNT_ID,                               01680021
016900                A.ORGN_FCLTY_ID                                   01690021
017000             FROM TSHPUNT A                                       01700021
017100            WHERE A.CRE_DTE       <= :PC-EXTRACT-DATE             01710039
017200              AND NOT EXISTS                                      01720021
017300                (SELECT *                                         01730021
017400                  FROM TSHUNLO B                                  01740021
017500                  WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID           01750028
017511                    AND B.SCN_LOC_ID   IN ('RECV','NSCN','WRCV')  01751140
017520                    AND B.ACTV_CDE         = 'A')                 01752028
017600                                                                  01760021
017700     END-EXEC.                                                    01770021
017800                                                                  01780021
017900                                                                  01790021
018000******************************************************************01800021
018100 PROCEDURE DIVISION.                                              01810021
018200******************************************************************01820021
018300                                                                  01830021
018400 0000-PROGRAM-MAINLINE.                                           01840021
018500******************************************************************01850021
018600* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01860021
018700*      PROGRAM.                                                   01870021
018800******************************************************************01880021
018900                                                                  01890021
019000     PERFORM 1000-INITIALIZE.                                     01900021
019100     IF PS-NOT-END-OF-CURSOR                                      01910021
019200         PERFORM 2000-PROCESS-SHIPMENT-LOCS                       01920021
019300            UNTIL PS-END-OF-CURSOR                                01930021
019400     END-IF.                                                      01940021
019500     PERFORM 9000-EOJ-ROUTINE.                                    01950021
019600                                                                  01960021
019700     STOP RUN.                                                    01970021
019800                                                                  01980021
019900 1000-INITIALIZE.                                                 01990021
020000******************************************************************02000021
020100*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02010021
020200*    -- OPEN INPUT FILE                                           02020021
020300*    -- READ FILE                                                 02030021
020400******************************************************************02040021
020500                                                                  02050021
020600     OPEN OUTPUT TIMESTAMP-FILE                                   02060021
020700                 INSERT-FILE.                                     02070021
020800     PERFORM 1100-CREATE-CONTROL-CARD.                            02080021
020900     PERFORM 7000-OPEN-SHIPMT-UNIT-CURSOR.                        02090021
021000     PERFORM 7100-FETCH-SHIPMT-UNIT-CURSOR.                       02100021
021100                                                                  02110021
021200 1100-CREATE-CONTROL-CARD.                                        02120021
021300******************************************************************02130021
021400*  CREATE THE CONTROL CARD.                                       02140021
021500******************************************************************02150021
021501                                                                  02150142
021510     EXEC SQL                                                     02151042
021520          SELECT C.ATTR_ELEM_NBR                                  02152042
021521               , (CURRENT TIMESTAMP - C.ATTR_ELEM_NBR DAYS)       02152142
021522               , D.ATTR_ELEM_NBR                                  02152242
021523               , (CURRENT TIMESTAMP - D.ATTR_ELEM_NBR DAYS)       02152342
021524               , E.ATTR_ELEM_NBR                                  02152442
021525               , DATE(CURRENT TIMESTAMP                           02152544
021526                                    - E.ATTR_ELEM_NBR DAYS)       02152644
021530            INTO :PV-PURGE-CURRENT-DAYS                           02153042
021531                ,:PC-CURRENT-TIMESTAMP                            02153142
021532                ,:PV-PURGE-INSERT-DAYS                            02153242
021533                ,:PC-INSERT-TIMESTAMP                             02153342
021534                ,:PV-PURGE-EXTRACT-DAYS                           02153442
021535                ,:PC-EXTRACT-DATE                                 02153542
021540            FROM                                                  02154042
021550                  WST_INTGRTN_TYP  A                              02155042
021560               ,  WST_ATTR_DEFN    B                              02156042
021570               ,  WST_ATTR_ELEM    C                              02157042
021580               ,  WST_ATTR_ELEM    D                              02158042
021590               ,  WST_ATTR_ELEM    E                              02159042
021591            WHERE                                                 02159142
021592                  A.INTGRTN_TYP_CDE   = 'INBDCTNPRG'              02159242
021593              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         02159342
021594              AND B.ATTR_DEFN_SEQ_NBR = 1                         02159442
021595              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         02159542
021596              AND C.ATTR_DEFN_SEQ_NBR = 1                         02159642
021597              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         02159742
021598              AND D.ATTR_DEFN_SEQ_NBR = 2                         02159842
021599              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         02159942
021600              AND E.ATTR_DEFN_SEQ_NBR = 3                         02160042
021601              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       02160142
021602              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       02160242
021605     END-EXEC.                                                    02160542
021610                                                                  02161042
023000     EVALUATE TRUE                                                02300042
023100         WHEN SQLCODE = ZERO                                      02310042
023110                                                                  02311042
023111              DISPLAY ' SUKUT007 - PARM INBDCRTNPRG'              02311142
023112              DISPLAY ' '                                         02311242
023113                                                                  02311342
023120              MOVE  PV-PURGE-CURRENT-DAYS TO PV-DISP-DAYS         02312043
023130              DISPLAY ' DAYS:'               PV-DISP-DAYS  '  '   02313043
023140                      ' CURRENT TIMESTAMP: ' PC-CURRENT-TIMESTAMP 02314042
023150                                                                  02315042
023160              MOVE  PV-PURGE-INSERT-DAYS  TO PV-DISP-DAYS         02316043
023170              DISPLAY ' DAYS:'               PV-DISP-DAYS '  '    02317043
023180                      ' INSERT TIMESTAMP:  ' PC-INSERT-TIMESTAMP  02318042
023190                                                                  02319042
023191              MOVE  PV-PURGE-EXTRACT-DAYS TO PV-DISP-DAYS         02319143
023192              DISPLAY ' DAYS:'               PV-DISP-DAYS  '  '   02319243
023193                      ' PURGE EXTRACT TMST:' PC-EXTRACT-DATE      02319342
023194              DISPLAY ' '                                         02319442
023200                                                                  02320042
023300         WHEN SQLWARN0 NOT = SPACES                               02330042
023400         WHEN SQLCODE < ZERO                                      02340042
023500         WHEN SQLCODE > ZERO                                      02350042
023600             MOVE '1100-CREATE CONTROL CARD'                      02360042
023700                                 TO PV-PARAGRAPH-NAME             02370042
023800             MOVE 'SELECT PURGE TMST FROM WST PARM TABLE'         02380042
024000                                 TO PV-DB2-OPERATION-ATTEMPTED    02400042
024100             PERFORM 9100-SQL-ABEND                               02410042
024200     END-EVALUATE.                                                02420042
024210                                                                  02421042
024300     INITIALIZE RC011-CONTROL-RECORD.                             02430021
024400     INITIALIZE TIMESTAMP-RECORD.                                 02440021
024410                                                                  02441042
024500     MOVE PC-CURRENT-TIMESTAMP TO RC011-CONTROL-RECORD.           02450021
024600     DISPLAY 'SUKUT007 CONTROL CARD -- ' RC011-CONTROL-TMST.      02460046
024700     PERFORM 8100-WRITE-TIMESTAMP-RECORD.                         02470021
024900                                                                  02490021
025000                                                                  02500021
025100 2000-PROCESS-SHIPMENT-LOCS.                                      02510021
025200******************************************************************02520021
025300*  PROCESS THE SHIPPING UNIT RECORDS                              02530021
025400******************************************************************02540021
025500                                                                  02550021
025600     PERFORM 8000-WRITE-LOCATION-RECS.                            02560021
025700                                                                  02570021
025800     PERFORM 7100-FETCH-SHIPMT-UNIT-CURSOR.                       02580021
025900                                                                  02590021
026000*                                                                 02600021
026100 7000-OPEN-SHIPMT-UNIT-CURSOR.                                    02610021
026200******************************************************************02620021
026300*  OPEN THE CURSOR.                                               02630021
026400******************************************************************02640021
026500                                                                  02650021
026600      EXEC SQL                                                    02660021
026700           OPEN TSHPUNT_CSR                                       02670045
026800      END-EXEC.                                                   02680021
026900                                                                  02690021
027000      EVALUATE TRUE                                               02700021
027100          WHEN SQLCODE = -904                                     02710021
027200          WHEN SQLCODE = -911                                     02720021
027300              CONTINUE                                            02730021
027400          WHEN SQLWARN0 NOT = SPACES                              02740021
027500          WHEN SQLCODE < ZERO                                     02750021
027600          WHEN SQLCODE > ZERO                                     02760021
027700              MOVE '7000-OPEN-SHIPMT-UNIT-CURSOR    '             02770021
027800                              TO PV-PARAGRAPH-NAME                02780021
027900              MOVE 'OPEN THE TSHPUNT_CSR    '                     02790045
028000                              TO PV-DB2-OPERATION-ATTEMPTED       02800021
028100              PERFORM 9100-SQL-ABEND                              02810021
028200          WHEN SQLCODE = ZERO                                     02820021
028300              CONTINUE                                            02830021
028400      END-EVALUATE.                                               02840021
028500                                                                  02850021
028600 7100-FETCH-SHIPMT-UNIT-CURSOR.                                   02860021
028700******************************************************************02870021
028800*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         02880021
028900******************************************************************02890021
029000                                                                  02900021
029100     EXEC SQL                                                     02910021
029200          FETCH TSHPUNT_CSR                                       02920045
029300           INTO :SHPUNT-SHIPT-UNT-ID,                             02930021
029400                :SHPUNT-ORGN-OPER-UNT-ID,                         02940021
029500                :SHPUNT-ORGN-FCLTY-ID                             02950021
029600     END-EXEC.                                                    02960021
029700                                                                  02970021
029800     EVALUATE TRUE                                                02980021
029900         WHEN SQLCODE = ZERO                                      02990021
030000             ADD +1 TO PC-FETCH-COUNT                             03000021
030100         WHEN SQLCODE = +100                                      03010021
030200             SET  PS-END-OF-CURSOR                                03020021
030300                                 TO TRUE                          03030021
030400         WHEN SQLWARN0 NOT = SPACES                               03040021
030500         WHEN SQLCODE < ZERO                                      03050021
030600         WHEN SQLCODE > ZERO                                      03060021
030700             MOVE '7100-FETCH-SHIPMT-UNIT-CURSOR  '               03070021
030800                                 TO PV-PARAGRAPH-NAME             03080021
030900             MOVE 'FETCH THE SHIPMT-UNIT-CURSOR   '               03090021
031000                                 TO PV-DB2-OPERATION-ATTEMPTED    03100021
031100             PERFORM 9100-SQL-ABEND                               03110021
031200     END-EVALUATE.                                                03120021
031300                                                                  03130021
031400 7200-CLOSE-CURSOR.                                               03140021
031500******************************************************************03150021
031600*  CLOSE THE CURSOR.                                              03160021
031700******************************************************************03170021
031800      EXEC SQL                                                    03180021
031900          CLOSE TSHPUNT_CSR                                       03190045
032000      END-EXEC.                                                   03200021
032100                                                                  03210021
032200      EVALUATE TRUE                                               03220021
032300          WHEN SQLCODE = -904                                     03230021
032400          WHEN SQLCODE = -911                                     03240021
032500              CONTINUE                                            03250021
032600          WHEN SQLWARN0 NOT = SPACES                              03260021
032700          WHEN SQLCODE < ZERO                                     03270021
032800          WHEN SQLCODE > ZERO                                     03280021
032900              MOVE '7200-CLOSE-CURSOR '                           03290021
033000                              TO PV-PARAGRAPH-NAME                03300021
033100              MOVE 'CLOSE THE TSHPUNT_CSR   '                     03310045
033200                              TO PV-DB2-OPERATION-ATTEMPTED       03320021
033300              PERFORM 9100-SQL-ABEND                              03330021
033400          WHEN SQLCODE = ZERO                                     03340021
033500              CONTINUE                                            03350021
033600      END-EVALUATE.                                               03360021
033700                                                                  03370021
033800 8000-WRITE-LOCATION-RECS.                                        03380021
033900******************************************************************03390021
034000*  WRITE THE NEW LOCATION RECORD                                  03400021
034100******************************************************************03410021
034200                                                                  03420021
034300     INITIALIZE  SU002-EXTRACT-RECORD.                            03430021
034400                                                                  03440021
034500     MOVE SHPUNT-SHIPT-UNT-ID         TO SU002-SHIPT-UNT-ID.      03450021
034600     MOVE SHPUNT-ORGN-OPER-UNT-ID     TO SU002-OPER-UNT-ID.       03460021
034700     MOVE SHPUNT-ORGN-FCLTY-ID        TO SU002-FCLTY-ID.          03470021
034800     MOVE 'NSCN'                      TO SU002-SCN-LOC-ID.        03480021
034900     MOVE PC-CURRENT-PROGRAM-NAME     TO SU002-CRE-USR-ID.        03490021
035000     MOVE PC-INSERT-TIMESTAMP         TO SU002-CRE-TMST.          03500021
035100     MOVE SHUNLO-TRIP-ID              TO SU002-TRIP-ID.           03510021
035200                                                                  03520021
035300     WRITE INSERT-RECORD                                          03530021
035400         FROM SU002-EXTRACT-RECORD.                               03540021
035500                                                                  03550021
035600     ADD +1 TO PC-WRITE-COUNT.                                    03560021
035700                                                                  03570021
035800 8100-WRITE-TIMESTAMP-RECORD.                                     03580021
035900******************************************************************03590021
036000*  WRITE THE TIMESTAMP RECORD                                     03600021
036100******************************************************************03610021
036200     WRITE TIMESTAMP-RECORD                                       03620021
036300         FROM RC011-CONTROL-RECORD.                               03630021
036400                                                                  03640021
036500 9000-EOJ-ROUTINE.                                                03650021
036600******************************************************************03660021
036700*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          03670021
036800******************************************************************03680021
036900     CLOSE TIMESTAMP-FILE.                                        03690021
037000     PERFORM 7200-CLOSE-CURSOR.                                   03700021
037100                                                                  03710021
037200     MOVE PC-FETCH-COUNT   TO PV-DISPLAY-COUNT.                   03720021
037300     DISPLAY 'TOTAL RECORDS EXTRACTED: ' PV-DISPLAY-COUNT.        03730046
037400     MOVE PC-WRITE-COUNT  TO PV-DISPLAY-COUNT.                    03740021
037500     DISPLAY 'TOTAL RECORDS WRITTEN:   ' PV-DISPLAY-COUNT.        03750046
037510     DISPLAY ' '.                                                 03751047
037600                                                                  03760021
037700                                                                  03770021
037800 9100-SQL-ABEND.                                                  03780021
037900******************************************************************03790021
038000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03800021
038100*  ERROR OR WARNING CODE OCCURS.                                  03810021
038200******************************************************************03820021
038300     DISPLAY '9100-SQL-ABEND'.                                    03830021
038400     DISPLAY '** ABEND     **'.                                   03840021
038500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03850021
038600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03860021
038700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     03870021
038800                                                                  03880021
038900******************************************************************03890021
039000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    03900021
039100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         03910021
039200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     03920021
039300* FORMAT.                                                         03930021
039400******************************************************************03940021
039500     COPY DPPD004.                                                03950021
039600                                                                  03960021
039700     MOVE +4013                  TO ABEND-CODE.                   03970021
039800     CALL 'ILBOABN0' USING ABEND-CODE.                            03980021
