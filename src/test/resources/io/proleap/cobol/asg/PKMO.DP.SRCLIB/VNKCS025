000100* ------------------------------------------------------------- * 00010042
000200 IDENTIFICATION DIVISION.                                         00020042
000300* ------------------------------------------------------------- * 00030042
000400 PROGRAM-ID.      VNKCS025.                                       00040099
000500 AUTHOR.          ROBIN BERNOSKI.                                 00050046
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060042
000700 DATE-WRITTEN.    FEB 2001.                                       00070050
000800                                                                  00080042
000900***************************************************************** 00090042
001000* FORMAT MQSERIES MESSAGES FOR RMS PAYMENT TERMS INTERFACE      * 00100091
001100* PROGRAM.                                                      * 00110091
001200*                                                               * 00120091
001300* THIS PROGRAM WILL TAKE THE PAYMENT TERMS INFORMATION FROM     * 00130099
001400* A LINKAGE SECTION AND PERFORM THE NECESSARY FUNCTIONS         * 00140091
001500* TO PLACE THE MESSAGE IN AN MQSERIES QUEUE FOR THE RMS         * 00150091
001600* PROCESS TO RETRIEVE.                                          * 00160091
001700*                                                               * 00170091
001700* DATE  08/26/2003                                              * 00180099
001700*     CHANGE MADE: CHANGE QUEUE MANAGER NAME TO THE NEW SERVER, * 00190099
001700*     ISWMQ04P.                                                 * 00200099
001700*     MADE BY: KEVIN CATLIN            WR/IR #: WR25644         * 00210099
001700*                                                               * 00220099
C81355* DATE  07/09/2014                                                00230099
C81355*     CHANGE MADE: CHANGE QMGR FOR RMS13.                         00240099
C81355*     MADE BY: JOHN SELWITSCHKA        WR/IR #: CHG0081355        00250099
C81355*                                                                 00260099
209972* DATE  10/08/2018                                                00270099
209972*     CHANGE MADE: MAINFRAME REFACTORING - CALL WSV_PRVDR_QUE TO  00280099
209972*                  GET MQ PARMS FOR REFACTORED CODE.              00290099
209972*                  ALSO HAD TO ADD COPYBOOKS DPWS013, DPWS020     00300099
209972*                  AND ISWS002 BECAUSE DB2 WAS ADDED TO THE       00310099
209972*                  PROGRAM.                                       00320099
209972*     MADE BY: JIM HUNTER              WR/IR #: CHG0209972        00330099
209972*                                                                 00340099
218056* DATE  02/20/2019                                                00350099
218056*     CHANGE MADE: MAINFRAME REFACTORING - CHANGE                 00360099
218056*                  MQPMO-SYNCPOINT TO MQPMO-NO-SYNCPOINT.         00370099
218056*                  THE REFACTORED CODE WILL NOT WORK IF           00380099
218056*                  MQPMO-SYNCPOINT IS USED AND EXPLICIT COMMITS   00390099
218056*                  ARE NOT PERFORMED.                             00400099
218056*     MADE BY: JIM HUNTER              WR/IR #: CHG0218056        00410099
218056*                                                                 00420099
220045* DATE  03/20/2019                                                00430099
220045*     CHANGE MADE: MAINFRAME REFACTORING - TEAM HAS REQUESTED     00440099
220045*                  THAT WE BACK OUT PREVIOUS MONTH'S CHANGE       00450099
220045*                  BECAUSE IT COULD CAUSE PROBLEMS IN FUTURE.     00460099
220045*                  SET MQPMO-SYNCPOINT INSTEAD OF                 00470099
220045*                  MQPMO-NO-SYNCPOINT.                            00480099
220045*     MADE BY: JIM HUNTER              WR/IR #: CHG0220045        00490099
220045*                                                                 00500099
001800***************************************************************** 00510042
001900* ------------------------------------------------------------- * 00520042
002000 ENVIRONMENT DIVISION.                                            00530042
002100* ------------------------------------------------------------- * 00540042
002200                                                                  00550042
002300 CONFIGURATION SECTION.                                           00560042
002400                                                                  00570042
002500 SOURCE-COMPUTER.       IBM-3090.                                 00580042
002600 OBJECT-COMPUTER.       IBM-3090.                                 00590042
002700                                                                  00600042
002800*INPUT-OUTPUT SECTION.                                            00610099
002900                                                                  00620042
003000*FILE-CONTROL.                                                    00630099
003100                                                                  00640042
003200* ------------------------------------------------------------- * 00650042
003300 DATA DIVISION.                                                   00660042
003400                                                                  00670042
003500* ------------------------------------------------------------- * 00680042
003600*FILE SECTION.                                                    00690099
003700                                                                  00700042
003800* ------------------------------------------------------------- * 00710042
003900 WORKING-STORAGE SECTION.                                         00720042
004000* ------------------------------------------------------------- * 00730042
004100                                                                  00740042
004200 01  MQ-WORKING-STORAGE.                                          00750065
004300     05  WS-MQCONN              PIC X(8)  VALUE 'CSQCCONN'.       00760088
004400     05  WS-MQOPEN              PIC X(8)  VALUE 'CSQCOPEN'.       00770088
004500     05  WS-MQPUT               PIC X(8)  VALUE 'CSQCPUT '.       00780088
004600     05  WS-MQCMIT              PIC X(8)  VALUE 'CSQCCOMM'.       00790088
004700     05  WS-MQBACK              PIC X(8)  VALUE 'CSQCBACK'.       00800088
004800     05  WS-MQCLOSE             PIC X(8)  VALUE 'CSQCCLOS'.       00810088
004900     05  WS-MQDISC              PIC X(8)  VALUE 'CSQCDISC'.       00820088
005000     05  WS-MQCHECK             PIC X(8)  VALUE 'MQR2C   '.       00830071
005200 01  WS-DB-DATE.                                                  00840042
005300     05  WS-DB-DATE-CC       PIC X(2).                            00850042
005400     05  WS-DB-DATE-YY       PIC X(2).                            00860042
005500     05  FILLER              PIC X(1).                            00870042
005600     05  WS-DB-DATE-MM       PIC X(2).                            00880042
005700     05  FILLER              PIC X(1).                            00890042
005800     05  WS-DB-DATE-DD       PIC X(2).                            00900042
005900                                                                  00910042
209972     COPY DPWS013.                                                00920099
209972                                                                  00930099
209972     COPY DPWS020.                                                00940099
209972                                                                  00950099
006000*----------------------------------------------------------------*00960042
006100*    CONTROL CARD                                                 00970042
006200*----------------------------------------------------------------*00980042
006300                                                                  00990042
006400 01  PC-PROGRAM-CONSTANTS.                                        01000042
209972     05  PC-CURRENT-PROGRAM-NAME PIC X(09)    VALUE 'VNKCS025 '.  01010099
006600     05  PC-FIFTY-STARS          PIC X(50)    VALUE ALL '*'.      01020099
006700     05  PC-SUCCESSFUL-SQLCODE   PIC S9(09)   VALUE ZEROS         01030099
006800                                                  COMP SYNC.      01040076
006900     05  PC-MAX-RETRIES          PIC S9(04)   VALUE 10 COMP.      01050099
007300     05  PC-QNAME                PIC X(48)    VALUE               01060099
007400                               'RS.SUPPLIER.PARTNER.LOAD.Q'.      01070099
007500     05  PC-QMGR-NAME            PIC X(48)    VALUE SPACES.       01080099
007600**********************************                     QKSP       01090099
C81355*        88  PC-PROD-QMGR-NAME                VALUE 'ISWMQ04P'.   01100099
209972**       88  PC-PROD-QMGR-NAME                VALUE 'ISWMQ189P'.  01110099
007700**       88  PC-PROD-QMGR-NAME                VALUE 'KSP32017'.   01120099
007800*        88  PC-PROD-QMGR-NAME                VALUE 'QKSP    '.   01130099
007900**********************************                     QKST       01140099
C81355*        88  PC-TEST-QMGR-NAME                VALUE 'ISWMQ04T'.   01150099
209972**       88  PC-TEST-QMGR-NAME                VALUE 'ISWMQ78T'.   01160099
008000**       88  PC-TEST-QMGR-NAME                VALUE 'KSP31009'.   01170099
008100*        88  PC-TEST-QMGR-NAME                VALUE 'QKST    '.   01180099
008200**********************************                     QKSQ       01190099
C81355*        88  PC-QA-QMGR-NAME                  VALUE 'ISWMQ04Q'.   01200099
209972**       88  PC-QA-QMGR-NAME                  VALUE 'ISWMQ77Q'.   01210099
008300**       88  PC-QA-QMGR-NAME                  VALUE 'KSP31011'.   01220099
008400*        88  PC-QA-QMGR-NAME                  VALUE 'QKSQ    '.   01230099
209972**   05  PC-SYS-ID                       PIC X(48).               01240099
209972**       88  PC-PV-KOHLS-TEST-SYSTEM          VALUE 'CIT1'.       01250099
209972**       88  PC-PV-KOHLS-ACC-TEST-SYSTEM      VALUE 'CIQA',       01260099
209972**                                                  'CIQT',       01270099
209972**                                                  'CILA',       01280099
209972**                                                  'CILT'.       01290099
209972**       88  PC-PV-KOHLS-QA-SYSTEM            VALUE 'CIQA',       01300099
209972**                                                  'CIQT'.       01310099
209972**       88  PC-PV-KOHLS-LEARNING-SYSTEM      VALUE 'CILA',       01320099
209972**                                                  'CILT'.       01330099
209972**       88  PC-PV-KOHLS-PROD-SYSTEM          VALUE 'CIPS',       01340099
209972**                                                  'CIP1',       01350099
209972**                                                  'CIP3',       01360099
209972**                                                  'CIP4',       01370099
209972**                                                  'CIP6'.       01380099
010000                                                                  01390042
010100*----------------------------------------------------------------*01400042
010200*    PROGRAM SWITCHES                                             01410042
010300*----------------------------------------------------------------*01420042
010400                                                                  01430042
010500 01  PC-PROGRAM-SWITCHES.                                         01440077
010600     05  PS-MQPUT-SUCCESSFUL-SW    PIC X(01)  VALUE SPACES.       01450077
010700         88  PS-MQPUT-SUCCESSFUL              VALUE 'Y'.          01460077
010800                                                                  01470077
010900 01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         01480042
011000                                              COMP SYNC.          01490042
011100     88  AC-DB2-ERROR                         VALUE +4013.        01500042
011200                                                                  01510042
011300*    GENERAL WORK FIELDS                                          01520099
011400                                                                  01530042
011500 01  NUMPUTS                 PIC S9(9) BINARY VALUE 0.            01540042
011600 01  ERROR-MESSAGE           PIC X(48) VALUE SPACES.              01550042
011700*                                                                 01560042
011800*   PARAMETER VARIABLES                                           01570099
011900*                                                                 01580042
012000 01  QM-NAME               PIC X(48).                             01590042
012100 01  QNAME                 PIC X(48).                             01600042
012200 01  PADCHAR               PIC X(1) VALUE '*'.                    01610042
012300 01  MSGBUFFER.                                                   01620042
012400   02  MSGBUFFER-ARRAY     PIC X(1) OCCURS 65535 TIMES.           01630042
012500 01  NUMMSGS-CHAR          PIC X(4) VALUE SPACES.                 01640042
012600 01  MSGLENGTH-CHAR        PIC X(4) VALUE SPACES.                 01650042
012700 01  MSGLENGTH             PIC S9(9) BINARY VALUE 150.            01660087
012800*                                                                 01670042
012900*    API FIELDS                                                   01680099
013000*                                                                 01690042
013100 01  PV-PROGRAM-VARIABLES.                                        01700065
013200     05  PV-PARAGRAPH             PIC X(48) VALUE SPACES.         01710072
013300     05  PV-ERROR.                                                01720065
013400         10  PV-ERROR-LITERAL     PIC X(14) VALUE SPACES.         01730072
013500         10  PV-ERROR-VARIABLE    PIC X(34) VALUE SPACES.         01740072
013600     05  PV-ERROR-MESSAGE         PIC X(48) VALUE SPACES.         01750072
013700     05  PV-ERROR-MESSAGE2        PIC X(48) VALUE SPACES.         01760072
013800     05  PV-MSGBUFFER             PIC X(391) VALUE SPACES.        01770072
013900     05  PV-OUT-MSGLENGTH         PIC S9(9) BINARY VALUE +58.     01780099
014000     05  PV-HCONN                 PIC S9(9) BINARY VALUE 0.       01790072
014100     05  PQ-HANDLE                PIC S9(9) BINARY VALUE 0.       01800072
014200     05  PV-OPEN-OPTIONS          PIC S9(9) BINARY.               01810072
014300     05  PV-COMPLETION-CODE       PIC S9(9) BINARY.               01820072
014400     05  PV-REASON                PIC S9(9) BINARY.               01830072
014500     05  PV-CON-REASON            PIC S9(9) BINARY.               01840072
014600     05  PV-PQ-HANDLE             PIC S9(9) BINARY VALUE 0.       01850072
014700     05  PV-MQ-REASON-TEXT        PIC X(30) VALUE SPACES.         01860072
014800     05  PV-MQPUT-RETRY-COUNTER   PIC S9(4)  VALUE ZERO COMP.     01870072
014900     05  PV-SAVE-PARAGRAPH        PIC X(48) VALUE SPACES.         01880074
015000     05  PV-SAVE-COMPLETION-CODE  PIC S9(9) BINARY.               01890075
015100     05  PV-SAVE-REASON           PIC S9(9) BINARY.               01900075
015200     05  PV-REASON-NONBIN         PIC S9(9).                      01910099
015300     05  PV-CURRENT-SYSID         PIC X(4)  VALUE SPACES.         01920099
015400     05  PV-CURRENT-NETNAME                                       01930099
015500                                  PIC X(8)  VALUE SPACES.         01940099
015600*                                                                 01950042
015700*    API CONTROL BLOCKS                                           01960099
015800*                                                                 01970042
015900 01  MQM-OBJECT-DESCRIPTOR.                                       01980042
016000     COPY CMQODV.                                                 01990042
016100 01  MQM-MESSAGE-DESCRIPTOR.                                      02000042
016200     COPY CMQMDV.                                                 02010042
016300 01  MQM-PUT-MESSAGE-OPTIONS.                                     02020042
016400     COPY CMQPMOV.                                                02030042
016500*                                                                 02040042
016600*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   02050099
016700*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          02060099
016800                                                                  02070042
016900 01  MQM-CONSTANTS.                                               02080042
017000     COPY CMQV.                                                   02090042
017100                                                                  02100042
209972     COPY ISWS002.                                                02110099
209972                                                                  02120099
027200*************************************************************     02130099
027200*    DB2 VIEW DECLARATION - WSV_PRVDR_QUE                         02140099
027200*************************************************************     02150099
027200     EXEC SQL                                                     02160099
027200          INCLUDE WSV00005                                        02170099
027200     END-EXEC.                                                    02180099
027200                                                                  02190099
027200                                                                  02200099
027200     EXEC SQL                                                     02210099
027200         INCLUDE SQLCA                                            02220099
027200     END-EXEC.                                                    02230099
027200                                                                  02240099
027200                                                                  02250099
017200 LINKAGE SECTION.                                                 02260051
017300                                                                  02270051
017400 01  DFHCOMMAREA.                                                 02280099
017500                                                                  02290099
017600     COPY VNRD004.                                                02300051
017700                                                                  02310051
017800* 01 PC-QNAME                 PIC X(48)   VALUE SPACES.           02320099
017900                                                                  02330061
018000* ------------------------------------------------------------- * 02340042
018100 PROCEDURE DIVISION.                                              02350099
018200* ------------------------------------------------------------- * 02360051
018300                                                                  02370042
018400 0000-MAINLINE.                                                   02380065
018500                                                                  02390065
018600     PERFORM B100-MQ-SETUP.                                       02400065
018700                                                                  02410065
018800     PERFORM C100-MQPUT-MSG.                                      02420065
018900                                                                  02430067
019000     PERFORM Y100-CLOSE-MQ-QUEUE.                                 02440067
019100                                                                  02450065
019200     EXEC CICS RETURN                                             02460099
019300               END-EXEC.                                          02470099
019400                                                                  02480065
019500 B100-MQ-SETUP.                                                   02490064
019600* ------------------------------------------------------------- * 02500064
019700*    CONNECT TO THE QUEUE MANAGER                                 02510064
019800* ------------------------------------------------------------- * 02520064
209972**   EXEC CICS                                                    02530099
209972**       ASSIGN                                                   02540099
209972**           SYSID   (PV-CURRENT-SYSID)                           02550099
209972**   END-EXEC.                                                    02560099
209972**                                                                02570099
209972**   MOVE PV-CURRENT-SYSID TO PC-SYS-ID.                          02580099
209972**                                                                02590099
209972**   IF PC-PV-KOHLS-PROD-SYSTEM                                   02600099
209972**       SET PC-PROD-QMGR-NAME     TO TRUE                        02610099
209972**   ELSE                                                         02620099
209972**        IF PC-PV-KOHLS-QA-SYSTEM                                02630099
209972**            SET PC-QA-QMGR-NAME  TO TRUE                        02640099
209972**        ELSE                                                    02650099
209972**            SET PC-TEST-QMGR-NAME                               02660099
209972**                                 TO TRUE                        02670099
209972**        END-IF                                                  02680099
209972**   END-IF.                                                      02690099
209972* ------------------------------------------------------------- * 02700099
209972*    SELECT  WSV_PRVDR_QUE TABLE                                  02710099
209972* ------------------------------------------------------------- * 02720099
209972*SELECT  QUEUE MANAGER AND QUEUE NAME                             02730099
209972                                                                  02740099
209972       INITIALIZE DCLWSV00005.                                    02750099
209972       MOVE 'QUEUE'       TO WSV00005-APPL-FUNC-DESC.             02760099
209972       MOVE 'VNSUPLOAD'   TO WSV00005-INTGRTN-TYP-CDE.            02770099
209972                                                                  02780099
209972       EXEC SQL                                                   02790099
209972           SELECT                                                 02800099
209972                 LCL_QUE_MGR                                      02810099
209972                ,RMT_QUE_MGR                                      02820099
209972                ,QUE_NM                                           02830099
209972           INTO                                                   02840099
209972                :WSV00005-LCL-QUE-MGR                             02850099
209972               ,:WSV00005-RMT-QUE-MGR                             02860099
209972               ,:WSV00005-QUE-NM                                  02870099
209972           FROM  WSV_PRVDR_QUE                                    02880099
209972          WHERE  APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC       02890099
209972            AND  INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE      02900099
209972       END-EXEC.                                                  02910099
209972                                                                  02920099
209972       EVALUATE TRUE                                              02930099
209972           WHEN SQLCODE = +0                                      02940099
209972              INITIALIZE PC-QMGR-NAME                             02950099
209972              MOVE WSV00005-RMT-QUE-MGR-TEXT  TO PC-QMGR-NAME     02960099
209972              INITIALIZE PC-QNAME                                 02970099
209972              MOVE WSV00005-QUE-NM-TEXT       TO PC-QNAME         02980099
209972              DISPLAY 'VNKCS025 PC-QMGR-NAME = ' PC-QMGR-NAME     02990099
209972              DISPLAY 'VNKCS025 PC-NAME      = ' PC-QNAME         03000099
209972           WHEN SQLCODE = +100                                    03010099
209972           WHEN SQLWARN0 NOT = SPACES                             03020099
209972           WHEN SQLCODE  NOT = ZERO                               03030099
209972              MOVE 'B100-MQ-SETUP'                                03040099
209972                               TO DP013-PARAGRAPH                 03050099
209972              MOVE 'SELECT QUEUE NAME FROM WSV-PRVDR-QUE'         03060099
209972                               TO DP013-MESSAGE-TEXT (1)          03070099
209972              MOVE SQLCA       TO DP013-SQLCA                     03080099
209972              SET DP013-DB2-ABEND                                 03090099
209972                               TO TRUE                            03100099
209972              PERFORM DP013-0000-PROCESS-ABEND                    03110099
209972       END-EVALUATE.                                              03120099
209972                                                                  03130099
021700                                                                  03140064
021800* ------------------------------------------------------------- * 03150064
021900*    OPEN THE UNIX SUPPLIER/PARTNER LOAD QUEUE FOR OUTPUT         03160064
022000* ------------------------------------------------------------- * 03170064
022100                                                                  03180064
022200     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      03190064
022300                               MQOO-FAIL-IF-QUIESCING.            03200064
022400     MOVE PC-QNAME                  TO MQOD-OBJECTNAME.           03210064
022500     MOVE PC-QMGR-NAME              TO MQOD-OBJECTQMGRNAME.       03220099
022600*                                                                 03230064
022700     CALL WS-MQOPEN USING PV-HCONN                                03240064
022800                          MQM-OBJECT-DESCRIPTOR                   03250064
022900                          PV-OPEN-OPTIONS                         03260064
023000                          PV-PQ-HANDLE                            03270064
023100                          PV-COMPLETION-CODE                      03280064
023200                          PV-REASON.                              03290064
023300*                                                                 03300064
023400*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    03310064
023500*    AND EXIT.                                                    03320064
023600*                                                                 03330064
023700     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   03340066
023800        MOVE 'MQOPEN ERROR:'    TO PV-ERROR-LITERAL               03350064
023900        MOVE PC-QMGR-NAME       TO PV-ERROR-VARIABLE              03360099
024000        MOVE PV-ERROR           TO PV-ERROR-MESSAGE               03370064
024100        MOVE SPACES             TO PV-ERROR-LITERAL               03380064
024200        MOVE PC-QNAME           TO PV-ERROR-VARIABLE              03390064
024300        MOVE PV-ERROR           TO PV-ERROR-MESSAGE2              03400064
024400        MOVE 'B100-MQ-SETUP' TO PV-PARAGRAPH                      03410064
024500        PERFORM Z900-DISPLAY-MQ-ERROR                             03420069
024600     END-IF.                                                      03430064
024700                                                                  03440084
024800* ------------------------------------------------------------- * 03450042
024900* PUT MESSAGE ON LOCAL QUEUE TO END THE DATA COLLECT PROCESS      03460042
025000* ------------------------------------------------------------- * 03470042
025100 C100-MQPUT-MSG.                                                  03480065
025200                                                                  03490042
025300*    SET PUT VALUES                                               03500099
025400                                                                  03510042
025500     MOVE SPACES             TO MQOD-OBJECTQMGRNAME.              03520042
025600**************** OBTAINED FROM CICS PROGRAM ********************* 03530084
025700     MOVE PC-QMGR-NAME       TO MQOD-OBJECTQMGRNAME.              03540099
025800     MOVE PC-QNAME           TO MQOD-OBJECTNAME.                  03550058
025900     MOVE MQMI-NONE          TO MQMD-MSGID.                       03560042
026000     MOVE MQCI-NONE          TO MQMD-CORRELID.                    03570042
026100     MOVE MQFMT-STRING       TO MQMD-FORMAT.                      03580042
026200     MOVE VN004-SENDING-FIELDS       TO PV-MSGBUFFER.             03590099
026300     MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 03600042
220045     COMPUTE MQPMO-OPTIONS      = MQPMO-SYNCPOINT.                03610099
220045*    COMPUTE MQPMO-OPTIONS      = MQPMO-NO-SYNCPOINT.             03620099
026500*                                                                 03630054
026600     CALL WS-MQPUT USING PV-HCONN                                 03640065
026700                         PV-PQ-HANDLE                             03650071
026800                         MQM-MESSAGE-DESCRIPTOR                   03660071
026900                         MQM-PUT-MESSAGE-OPTIONS                  03670071
027000                         PV-OUT-MSGLENGTH                         03680071
027100                         PV-MSGBUFFER                             03690071
027200                         PV-COMPLETION-CODE                       03700071
027300                         PV-REASON.                               03710071
027400                                                                  03720054
027500*        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 03730071
027600*        AND BREAK OUT OF LOOP                                    03740071
027700                                                                  03750071
027800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        03760071
027900         ADD 1 TO PV-MQPUT-RETRY-COUNTER                          03770071
028000         IF PV-MQPUT-RETRY-COUNTER > PC-MAX-RETRIES               03780071
028100             MOVE PV-PARAGRAPH         TO PV-SAVE-PARAGRAPH       03790071
028200             MOVE PV-COMPLETION-CODE   TO PV-SAVE-COMPLETION-CODE 03800071
028300             MOVE PV-REASON            TO PV-SAVE-REASON          03810071
028400             PERFORM Y100-CLOSE-MQ-QUEUE                          03820075
028500             MOVE PV-SAVE-PARAGRAPH    TO PV-PARAGRAPH            03830071
028600             MOVE PV-SAVE-COMPLETION-CODE TO PV-COMPLETION-CODE   03840071
028700             MOVE PV-SAVE-REASON       TO PV-REASON               03850071
028800             PERFORM Z900-DISPLAY-MQ-ERROR                        03860071
028900         ELSE                                                     03870071
029000**------->   WAIT FOR 5 SECONDS AND TRY AGAIN                     03880071
021100             EXEC CICS DELAY FOR SECONDS(5)                       03890099
021200             END-EXEC                                             03900099
029200         END-IF                                                   03910071
029300     ELSE                                                         03920071
029400         SET PS-MQPUT-SUCCESSFUL TO TRUE                          03930071
029500     END-IF.                                                      03940071
029600                                                                  03950054
029700*----------------------------------------------------------------*03960071
029800* CLOSE THE OUTPUT MESSAGE QUEUE.                                *03970071
029900*----------------------------------------------------------------*03980071
030000 Y100-CLOSE-MQ-QUEUE.                                             03990065
030100                                                                  04000065
030200     CALL WS-MQCLOSE USING PV-HCONN                               04010065
030300                           PV-PQ-HANDLE                           04020065
030400                           MQCO-NONE                              04030065
030500                           PV-COMPLETION-CODE                     04040065
030600                           PV-REASON.                             04050065
030700                                                                  04060065
030800     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   04070065
030900        MOVE 'MQCLOSE ERROR OF OUTPUT QUEUE'                      04080065
031000             TO PV-ERROR-MESSAGE                                  04090065
031100        MOVE SPACES             TO PV-ERROR-MESSAGE2              04100065
031200        MOVE 'Y100-CLOSE-MQ-QUEUE' TO PV-PARAGRAPH                04110065
031300        PERFORM Z900-DISPLAY-MQ-ERROR                             04120069
031400     ELSE                                                         04130065
031500********************************************************          04140099
031600        NEXT SENTENCE                                             04150099
031700*       DISPLAY 'SUCCESSFUL CLOSE FOR OUTPUT QUEUE'               04160099
031800********************************************************          04170099
031900     END-IF.                                                      04180065
032000                                                                  04190065
032100* ------------------------------------------------------------- * 04200054
032200* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   04210054
032300* ------------------------------------------------------------- * 04220054
032400 Z900-DISPLAY-MQ-ERROR.                                           04230069
032500* ------------------------------------------------------------- * 04240054
032600*                                                                 04250054
032700     IF PV-COMPLETION-CODE NOT = MQCC-OK                          04260071
032800        CALL WS-MQCHECK USING PV-REASON PV-MQ-REASON-TEXT         04270071
032900     END-IF.                                                      04280071
033000                                                                  04290071
033100     SET VN004-MQ-ERROR            TO TRUE.                       04300099
209972     MOVE PC-CURRENT-PROGRAM-NAME  TO VN004-PROGRAM-NAME.         04310099
033300     MOVE PV-PARAGRAPH             TO VN004-PARAGRAPH-NAME.       04320099
033400     MOVE PV-MQ-REASON-TEXT        TO VN004-MESSAGE.              04330099
033500     MOVE PV-REASON                TO PV-REASON-NONBIN.           04340099
033600     MOVE PV-REASON-NONBIN         TO VN004-REASON-CODE.          04350099
033700                                                                  04360099
033800                                                                  04370099
033900     EXEC CICS RETURN                                             04380099
034000               END-EXEC.                                          04390099
209972                                                                  04400099
209972*----------------------------------------------------------------*04410099
209972*    ABEND PROCESSOR MODULE                                      *04420099
209972*----------------------------------------------------------------*04430099
209972                                                                  04440099
209972     COPY DPPD013.                                                04450099
209972                                                                  04460099
