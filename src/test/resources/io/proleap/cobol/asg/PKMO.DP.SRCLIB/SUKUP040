000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.    SUKUP040.                                         00040001
000500 AUTHOR.        GERMAN BANDA.                                     00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   JULY, 2023.                                       00070001
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000* THIS PROGRAM WILL READ THE OUTBOUND TRIP ID FILE CREATED BY     00100001
001100* SUKUT209.                                                       00110001
001110* FIRST CHECK THE FILE TRIP STATUS AND COMPARE AGAINST            00111051
001120* THE CURRENT STATUS ON THE TABLE, TO ENSURE THAT THE STATUS HAS  00112051
001130* NOT CHANGED. ANY CHANGED TRIPS WILL BE BYPASSED.                00113051
001300* 1) FOR "DS" DC SHIPPED RECORDS INSERT 'SO' - STORE OPEN         00130051
001301*    AND 'SU' - STORE UNLOAD ROWS TO TSUOBTS                      00130151
001302*    USE SUOBTR-DEST-OPER-UNT-ID  AS THE STORE                    00130251
001303* 2) FOR "SO" STORE OPEN RECORDS INSERT 'SU' - STORE UNLOAD ROW   00130351
001304*                   TO TSUOBTS                                    00130451
001305*    USE SUOBTS-STAT-OPER-UNT-ID  AS THE STORE                    00130551
001306* 3) FOR EACH ROW INSERTED TO TSUOBTS INSERT AN ASSOCIATED ROW    00130651
001307*        TO SUT_TRIP_WRKR_AUD                                     00130751
001308* 4) FOR EACH TRIP CREATE PARAMTER ENTRIES FOR "ASMRECFORC"       00130851
001309*        TO SUT_TRIP_WRKR_AUD                                     00130951
001400******************************************************************00140001
001500******************************************************************00150001
001600* CHANGE LOG                                                      00160001
001700* DATE        CHANGED BY    DESC                                  00170001
001800* ---------- -------------  --------------------------------------00180001
002600******************************************************************00260001
002700 ENVIRONMENT DIVISION.                                            00270001
002800 CONFIGURATION SECTION.                                           00280001
002900                                                                  00290001
003000 SOURCE-COMPUTER.        IBM-3090.                                00300001
003100 OBJECT-COMPUTER.        IBM-3090.                                00310001
003200                                                                  00320001
003300 INPUT-OUTPUT SECTION.                                            00330001
003400 FILE-CONTROL.                                                    00340001
003500                                                                  00350001
003600     SELECT OUTBOUND-TRIP-FILE-IN                                 00360001
003700         ASSIGN TO INP01.                                         00370048
003800                                                                  00380001
003900******************************************************************00390001
004000 DATA DIVISION.                                                   00400001
004100 FILE SECTION.                                                    00410001
004200                                                                  00420001
004300 FD OUTBOUND-TRIP-FILE-IN                                         00430001
004400     RECORDING MODE IS F                                          00440001
004500     LABEL RECORDS ARE STANDARD                                   00450001
004600     BLOCK CONTAINS 0 RECORDS.                                    00460001
004700                                                                  00470001
004800 01 OUTBOUND-TRIP-RECORD-IN         PIC X(100).                   00480001
004900*                                                                 00490001
005000*                                                                 00500001
005100******************************************************************00510001
005200 WORKING-STORAGE SECTION.                                         00520001
005300******************************************************************00530001
005400******************************************************************00540001
005500* ASSUMPTIVE RECORD INPUT FILE LAYOUT                             00550001
005600******************************************************************00560001
005700     COPY SURD175.                                                00570001
005800                                                                  00580001
005900******************************************************************00590001
006000******************************************************************00600001
006100* DB2 FORMATTED MESSAGE AREA                                      00610001
006200******************************************************************00620001
006300     COPY DPWS004.                                                00630001
006400                                                                  00640001
006500******************************************************************00650001
006600* COMMUNICATIONS AREA FOR DB2                                     00660001
006700******************************************************************00670001
006800     EXEC SQL                                                     00680001
006900          INCLUDE SQLCA                                           00690001
007000     END-EXEC.                                                    00700001
007100                                                                  00710001
007200*---------------------------------------------------------------* 00720001
007300*---------------------------------------------------------------* 00730001
007400*    TSUOBTR - OUTBOUND TRAILER TRIP                            * 00740001
007500*---------------------------------------------------------------* 00750001
007600     EXEC SQL                                                     00760001
007700          INCLUDE TSUOBTR                                         00770001
007800     END-EXEC.                                                    00780001
007900                                                                  00790001
008000*---------------------------------------------------------------* 00800001
008100*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     * 00810001
008200*---------------------------------------------------------------* 00820001
008300     EXEC SQL                                                     00830001
008400          INCLUDE TSUOBTS                                         00840001
008500     END-EXEC.                                                    00850001
008600                                                                  00860001
008700*---------------------------------------------------------------* 00870001
008800*    TCNTRID - TRAILIER ID TABLE                                  00880001
008900*---------------------------------------------------------------* 00890001
009000     EXEC SQL                                                     00900001
009100          INCLUDE TCNTRID                                         00910001
009200     END-EXEC.                                                    00920001
009300                                                                  00930001
009400*---------------------------------------------------------------* 00940001
009500*    WST_ATTR_ELEM TABLE                                          00950005
009600*---------------------------------------------------------------* 00960001
009700     EXEC SQL                                                     00970001
009800          INCLUDE WST00010                                        00980005
009900     END-EXEC.                                                    00990001
010000                                                                  01000001
010010*---------------------------------------------------------------* 01001007
010020*    SUT_TRIP_WRKR_AUD                                            01002007
010030*---------------------------------------------------------------* 01003007
010040     EXEC SQL                                                     01004007
010050          INCLUDE SUT00006                                        01005007
010060     END-EXEC.                                                    01006007
010070                                                                  01007007
010100*---------------------------------------------------------------* 01010001
010200*---------------------------------------------------------------* 01020049
010300*    TCOCNTL - COMPANY CONTROL                                    01030049
010400*---------------------------------------------------------------* 01040049
010500     EXEC SQL                                                     01050049
010600          INCLUDE TCOCNTL                                         01060049
010700     END-EXEC.                                                    01070049
010800                                                                  01080049
010900*---------------------------------------------------------------* 01090049
013600******************************************************************01360001
013700 01 ABEND-CODE                       PIC S9(04)    VALUE +0       01370001
013800                                                   COMP SYNC.     01380001
013900                                                                  01390001
014000 01 PS-PROGRAM-SWITCHES.                                          01400001
014010     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     01401019
014020         88  PS-END-OF-CONTROL                     VALUE 'Y'.     01402019
014030         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     01403019
014100     05  PS-END-OF-FILE-SW             PIC  X(01)  VALUE 'N'.     01410001
014200         88  PS-END-OF-FILE                        VALUE 'Y'.     01420001
014300         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01430001
014400     05  PS-END-OF-NOSCAN-CTN-CSR-SW   PIC  X(01)  VALUE 'N'.     01440001
014500         88  PS-END-OF-NOSCAN-CTN-CSR              VALUE 'Y'.     01450001
014600         88  PS-NOT-END-OF-NOSCAN-CTN-CSR          VALUE 'N'.     01460001
014700     05  PS-END-OF-INSERTS-SW         PIC X(01)    VALUE 'N'.     01470007
014800         88  PS-END-OF-INSERTS                     VALUE 'Y'.     01480001
014900         88  PS-END-OF-INSERTS-NO                  VALUE 'N'.     01490001
014910     05  PS-TRIP-STATUS-MATCH-SW      PIC X(01) VALUE 'N'.        01491001
014920         88  PS-TRIP-STATUS-MATCH               VALUE 'Y'.        01492001
014930         88  PS-TRIP-STATUS-MATCH-NO            VALUE 'N'.        01493001
014940     05  PS-STR-OPEN-STR-UNLOAD-SW    PIC X(01) VALUE 'N'.        01494040
014950         88  PS-STR-UNLOAD-ONLY                 VALUE 'N'.        01495040
014960         88  PS-STR-OPEN-AND-STR-UNLD           VALUE 'Y'.        01496040
014970     05 PS-TRIP-AGING-SW              PIC  X(01).                 01497042
014980        88 PS-SET-SO-AGING                 VALUE 'A'.             01498042
014990        88 PS-SET-SU-AGING                 VALUE 'B'.             01499042
014991        88 PS-SET-SO-FOR-PRIOR             VALUE 'C'.             01499142
014992        88 PS-SET-SU-FOR-PRIOR             VALUE 'D'.             01499242
015000                                                                  01500001
015100 01 PC-PROGRAM-CONSTANTS.                                         01510001
015200     05  PC-A                        PIC  X(01)    VALUE 'A'.     01520001
015300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUP040'. 01530001
015400     05  PC-CRTN-STATUS-PGM          PIC  X(08) VALUE 'PCKUT713'. 01540001
015500     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01550001
015600     05  PC-DS                       PIC  X(02)    VALUE 'DS'.    01560001
015700     05  PC-SO                       PIC  X(02)    VALUE 'SO'.    01570001
015800     05  PC-SU                       PIC  X(02)    VALUE 'SU'.    01580001
015900     05  PC-DEFAULT-TMST           PIC  X(26)  VALUE              01590001
016000                                  '9999-09-09-09.09.09.999999'.   01600001
016010     05  PC-DEFAULT-HHMMSSMM         PIC  X(16)                   01601027
016020                                  VALUE '-23.59.59.999999'.       01602026
016100                                                                  01610001
016210 01  PV-INPUT-FILE.                                               01621019
016211     05  PIF-RUN-DATE                PIC  X(10)    VALUE SPACES.  01621119
016212     05  FILLER                      PIC  X(70)    VALUE SPACES.  01621219
016213                                                                  01621319
016214 01 PV-PROGRAM-VARIABLES.                                         01621419
016300     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01630001
016400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01640001
016500     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01650001
016600     05  PV-ATTR-ELEM-SEQ-NBR        PIC  S9(9) COMP.             01660015
016700     05  PV-SHIPPED-TMST             PIC  X(26) VALUE SPACE.      01670001
016800     05  PV-OTBND-STAT-TMST-1        PIC  X(26) VALUE SPACE.      01680001
016900     05  PV-TMST-ON-TRLR             PIC  X(26) VALUE SPACE.      01690001
017000     05  PV-TRLR-SRL-NBR             PIC  S9(9) COMP VALUE ZERO.  01700001
017100     05  PV-TRLR-SRL-NBR-DISP        PIC  9(9)  VALUE ZEROES.     01710001
017200     05  PV-SHIPT-UNT-ID             PIC S9(18) COMP VALUE ZERO.  01720001
017300     05  PV-PREV-SHIPT-UNT-ID        PIC S9(18) COMP VALUE ZERO.  01730001
017310     05  PV-TRIP-STAT-CDE-MATCH      PIC  X(02) VALUE SPACES.     01731001
017400                                                                  01740001
017410     05  PV-DB2-TIMESTAMP                PIC  X(26).              01741020
017420     05  PV-DB2-TIMESTAMP-R REDEFINES PV-DB2-TIMESTAMP.           01742020
017430         10  PV-DB2-TMST-DATE            PIC  X(10).              01743020
017440         10  PV-DB2-TMST-16              PIC  X(16).              01744029
017450                                                                  01745029
017500     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01750001
017600                                                    COMP.         01760001
017700     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01770001
017800                                                    COMP.         01780001
017900     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      01790001
018000                                                    COMP.         01800001
018100      05 PV-TEXT-LEN                    PIC S9(04) VALUE +0       01810001
018200                                                   COMP.          01820001
018300     05  PV-DISPLAY-CARTON           PIC  9(20).                  01830001
018400     05  PV-DISPLAY-SQLCODE          PIC -999.                    01840001
018500                                                                  01850001
018600  01 DB2-KEYS.                                                    01860001
018700     05  DK-CARTON-ID             PIC S9(18)V COMP-3.             01870001
018800                                                                  01880001
018900 01 COUNTERS.                                                     01890001
019000     05  PV-READ-COUNTER             PIC  S9(9) COMP-3.           01900001
019100     05  PV-TRIP-SO-WRITE-COUNT      PIC  S9(9) COMP-3.           01910044
019110     05  PV-TRIP-SU-WRITE-COUNT      PIC  S9(9) COMP-3.           01911044
019120     05  PV-WRKR-AUD-WRITE-COUNT     PIC  S9(9) COMP-3.           01912044
019200     05  PV-INTG-PARM-WRITE-COUNT    PIC  S9(9) COMP-3.           01920044
019400                                                                  01940001
019500*---------------------------------------------------------------* 01950001
019600                                                                  01960001
019700******************************************************************01970001
019800 PROCEDURE DIVISION.                                              01980001
019900******************************************************************01990001
020000******************************************************************02000001
020100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02010001
020200*      PROGRAM.                                                   02020001
020300******************************************************************02030001
020400 0000-PROGRAM-MAINLINE.                                           02040001
020500                                                                  02050001
020600     DISPLAY '***** SUKUP040 STARTED *****'.                      02060001
020700                                                                  02070001
020800     PERFORM 1000-INITIALIZE.                                     02080001
020900     IF PS-NOT-END-OF-FILE                                        02090001
021000         PERFORM 2000-PROCESS-TRIP-FILE-IN                        02100001
021100            UNTIL PS-END-OF-FILE                                  02110001
021200     END-IF.                                                      02120001
021500     PERFORM 9000-EOJ-ROUTINE.                                    02150001
021600                                                                  02160001
021700     STOP RUN.                                                    02170001
021800                                                                  02180001
021900******************************************************************02190001
022000* DO FIRST TIME PROGRAM INITIALIZATION TASKS.                     02200001
022100*    -- OPEN INPUT FILE                                           02210001
022300*    -- GET CURRENT TIMESTAMP FOR THE OUTPUT INTRANSIT RECORD     02230001
022400*    -- READ INPUT FILE                                           02240001
022500******************************************************************02250001
022600 1000-INITIALIZE.                                                 02260001
022700                                                                  02270001
022800     INITIALIZE COUNTERS.                                         02280001
022910     OPEN INPUT  OUTBOUND-TRIP-FILE-IN.                           02291048
023000                                                                  02300001
023100                                                                  02310001
023210     PERFORM 7000-READ-OTBND-TRIP-FILE-IN.                        02321019
023300                                                                  02330001
023310******************************************************************02331019
023410******************************************************************02341001
023500* FILE PROCESSING                                                 02350003
023600******************************************************************02360001
023700 2000-PROCESS-TRIP-FILE-IN.                                       02370001
023800                                                                  02380001
023900                                                                  02390001
024000     DISPLAY 'TRIP ID BEING PROCESSED IS ' SU175-OTBND-TRIP-ID.   02400001
024010                                                                  02401001
024100     PERFORM 2005-CHECK-TRIP-STATUS.                              02410001
024110     IF PS-TRIP-STATUS-MATCH                                      02411001
024120        MOVE SU175-TRIP-AGING-SW  TO PS-TRIP-AGING-SW             02412047
024200        IF SU175-TRIP-STAT-CDE  = PC-DS                           02420001
024300           INITIALIZE DCLTSUOBTS                                  02430001
024400                      DCLSUT00006                                 02440008
024500           MOVE PC-SO TO SUOBTS-TRIP-STAT-CDE                     02450001
024600           PERFORM 2200-PREPARE-TSUOBTS-INSERT                    02460001
024700        END-IF                                                    02470001
024800                                                                  02480001
024900        INITIALIZE DCLTSUOBTS                                     02490001
025000                   DCLSUT00006                                    02500008
025100        MOVE PC-SU TO SUOBTS-TRIP-STAT-CDE                        02510001
025200        PERFORM 2200-PREPARE-TSUOBTS-INSERT                       02520001
025300                                                                  02530001
025400        PERFORM 3000-PREP-INTG-ASMRECFORC                         02540001
025410        PERFORM 7100-COMMIT                                       02541008
025500     ELSE                                                         02550001
025501        DISPLAY 'TRIP STATUS HAS CHANGED - TRIP BYPASSED'         02550101
025502        DISPLAY 'FILE TRIP  STATUS: ' SU175-TRIP-STAT-CDE         02550201
025503        DISPLAY 'TABLE TRIP STATUS: ' PV-TRIP-STAT-CDE-MATCH      02550301
025510     END-IF                                                       02551001
025600     PERFORM 7000-READ-OTBND-TRIP-FILE-IN.                        02560001
025700                                                                  02570001
025710*---------------------------------------------------------------* 02571001
025720* CHECK IF THE TRIP STATUS MATCHES WHAT IS ON THE EXTRACT       * 02572003
025730*---------------------------------------------------------------* 02573001
025740 2005-CHECK-TRIP-STATUS.                                          02574001
025741                                                                  02574101
025750     MOVE SPACES TO PV-TRIP-STAT-CDE-MATCH.                       02575001
025760     SET  PS-TRIP-STATUS-MATCH-NO  TO  TRUE.                      02576001
025770                                                                  02577001
025780     EXEC SQL                                                     02578001
025790          SELECT  A.TRIP_STAT_CDE                                 02579001
025792            INTO :PV-TRIP-STAT-CDE-MATCH                          02579201
025794            FROM  TSUOBTS A                                       02579401
025795            WHERE A.OTBND_TRIP_ID  = :SU175-OTBND-TRIP-ID         02579501
025796              AND A.OTBND_STAT_TMST IN                            02579601
025797                  (SELECT MAX(B.OTBND_STAT_TMST)                  02579701
025798                     FROM TSUOBTS  B                              02579801
025799                    WHERE A.OTBND_TRIP_ID  =  B.OTBND_TRIP_ID)    02579901
025800             WITH UR                                              02580001
025801     END-EXEC.                                                    02580101
025803                                                                  02580301
025804     EVALUATE TRUE                                                02580401
025805         WHEN SQLCODE = ZERO                                      02580501
025806           IF PV-TRIP-STAT-CDE-MATCH =  SU175-TRIP-STAT-CDE       02580601
025807              SET PS-TRIP-STATUS-MATCH  TO TRUE                   02580701
025808           ELSE                                                   02580801
025809             SET PS-TRIP-STATUS-MATCH-NO TO TRUE                  02580901
025810           END-IF                                                 02581001
025811         WHEN SQLCODE = +100                                      02581101
025812             SET PS-TRIP-STATUS-MATCH-NO TO TRUE                  02581201
025813         WHEN SQLWARN0 NOT = SPACES                               02581301
025814         WHEN SQLCODE < ZERO                                      02581401
025815         WHEN SQLCODE > ZERO                                      02581501
025816             MOVE '2005-CHECK-TRIP-STATUS'                        02581601
025817                                          TO PV-PARAGRAPH-NAME    02581701
025818             MOVE 'SELECT STATUS  ' TO PV-DB2-OPERATION-ATTEMPTED 02581801
025819             DISPLAY 'TRIP ID = ' SU175-OTBND-TRIP-ID             02581901
025820             DISPLAY 'SQLCODE = ' SQLCODE                         02582001
025821             PERFORM 9100-SQL-ABEND                               02582101
025822     END-EVALUATE.                                                02582201
025830                                                                  02583001
025900 2200-PREPARE-TSUOBTS-INSERT.                                     02590001
026000     MOVE SU175-OTBND-TRIP-ID      TO SUOBTS-OTBND-TRIP-ID.       02600001
026010     IF PS-SET-SO-AGING OR PS-SET-SO-FOR-PRIOR                    02601042
026011        MOVE SU175-DEST-OPER-UNT-ID TO SUOBTS-STAT-OPER-UNT-ID    02601150
026012        MOVE 'SO-FORCE'          TO SUOBTS-OTBND-STAT-USR-ID      02601241
026020     ELSE                                                         02602035
026030        MOVE SU175-STAT-OPER-UNT-ID TO SUOBTS-STAT-OPER-UNT-ID    02603050
026101        MOVE 'SU-FORCE'             TO SUOBTS-OTBND-STAT-USR-ID   02610138
026110     END-IF.                                                      02611035
026120                                                                  02612038
026300     MOVE SU175-DOOR-ID            TO SUOBTS-DOOR-ID.             02630001
026400     MOVE SU175-TRLR-SEAL-ID       TO SUOBTS-TRLR-SEAL-ID.        02640001
026500     MOVE SU175-SHIP-SCAC-CDE      TO SUOBTS-SHIP-SCAC-CDE.       02650001
026600                                                                  02660001
026700     MOVE SPACES                   TO SUOBTS-SHIP-DRV-LAST-NM     02670001
026800                                      SUOBTS-SHIP-DRV-FRST-NM     02680003
026900                                      SUOBTS-SHIP-DRV-ID          02690003
027000                                      SUOBTS-TRLR-PRKG-LOC-DESC   02700003
027100                                      SUOBTS-TRLR-PRKG-SLOT-NBR.  02710003
027200     MOVE ZEROES                   TO SUOBTS-CPCTY-PCT            02720001
027300                                      SUOBTS-UNUSD-PLLT-QTY       02730001
027400                                      SUOBTS-UNUSD-PLLT-QTY.      02740001
027500     MOVE 'N'                      TO SUOBTS-RPT-GEND-IND.        02750001
027600     PERFORM 2300-INSERT-TSUOBTS.                                 02760001
027700     PERFORM 2400-INSERT-WRKR-AUD.                                02770001
027800                                                                  02780001
027900******************************************************************02790001
028000******************************************************************02800001
028100 2300-INSERT-TSUOBTS.                                             02810001
028200                                                                  02820001
028300     EXEC SQL                                                     02830001
028400       INSERT INTO TSUOBTS                                        02840001
028500           ( OTBND_TRIP_ID                                        02850001
028600            ,OTBND_STAT_TMST                                      02860001
028700            ,TRIP_STAT_CDE                                        02870001
028800            ,STAT_OPER_UNT_ID                                     02880001
028900            ,OTBND_STAT_USR_ID                                    02890001
029000            ,DOOR_ID                                              02900001
029100            ,TRLR_SEAL_ID                                         02910001
029200            ,SHIP_SCAC_CDE                                        02920001
029300            ,SHIP_DRV_LAST_NM                                     02930001
029400            ,SHIP_DRV_FRST_NM                                     02940001
029500            ,SHIP_DRV_ID                                          02950001
029600            ,TRLR_PRKG_LOC_DESC                                   02960001
029700            ,TRLR_PRKG_SLOT_NBR                                   02970001
029800            ,FINCL_POST_TMST                                      02980001
029900            ,CPCTY_PCT                                            02990001
030000            ,UNUSD_PLLT_QTY                                       03000001
030100            ,LOD_BR_QTY                                           03010001
030200           )                                                      03020001
030300       VALUES                                                     03030001
030400         (                                                        03040001
030500             :SUOBTS-OTBND-TRIP-ID                                03050001
030600         ,   CURRENT TIMESTAMP                                    03060001
030700         ,   :SUOBTS-TRIP-STAT-CDE                                03070001
030800         ,   :SUOBTS-STAT-OPER-UNT-ID                             03080001
030900         ,   :SUOBTS-OTBND-STAT-USR-ID                            03090001
031000         ,   :SUOBTS-DOOR-ID                                      03100001
031100         ,   :SUOBTS-TRLR-SEAL-ID                                 03110001
031200         ,   :SUOBTS-SHIP-SCAC-CDE                                03120001
031300         ,   :SUOBTS-SHIP-DRV-LAST-NM                             03130001
031400         ,   :SUOBTS-SHIP-DRV-FRST-NM                             03140001
031500         ,   :SUOBTS-SHIP-DRV-ID                                  03150001
031600         ,   :SUOBTS-TRLR-PRKG-LOC-DESC                           03160001
031700         ,   :SUOBTS-TRLR-PRKG-SLOT-NBR                           03170001
031800         ,   :PC-DEFAULT-TMST                                     03180001
031900         ,   :SUOBTS-CPCTY-PCT                                    03190001
032000         ,   :SUOBTS-UNUSD-PLLT-QTY                               03200001
032100         ,   :SUOBTS-LOD-BR-QTY                                   03210001
032200         )                                                        03220001
032300     END-EXEC.                                                    03230001
032400                                                                  03240001
032500     EVALUATE TRUE                                                03250001
032600         WHEN SQLCODE = ZERO                                      03260044
032601         WHEN SQLCODE = -803                                      03260103
032602             IF SUOBTS-TRIP-STAT-CDE = PC-SO                      03260244
032603                ADD +1 TO PV-TRIP-SO-WRITE-COUNT                  03260344
032604             ELSE                                                 03260444
032605                ADD +1 TO PV-TRIP-SU-WRITE-COUNT                  03260544
032606             END-IF                                               03260644
033000         WHEN SQLCODE = +100                                      03300001
033010             CONTINUE                                             03301003
033200         WHEN SQLWARN0 NOT = SPACES                               03320001
033300         WHEN SQLCODE < ZERO                                      03330001
033400         WHEN SQLCODE > ZERO                                      03340001
033500             MOVE '2300-INSERT-TSUOBTS  '                         03350003
033600                                          TO PV-PARAGRAPH-NAME    03360001
033700             MOVE 'INSERT-TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 03370003
033800             DISPLAY 'TRIP ID = ' SU175-OTBND-TRIP-ID             03380001
034000             PERFORM 9100-SQL-ABEND                               03400001
034100     END-EVALUATE.                                                03410001
034200                                                                  03420001
034300                                                                  03430001
034400                                                                  03440001
034500 2400-INSERT-WRKR-AUD.                                            03450001
034600                                                                  03460001
034700     MOVE SUOBTS-OTBND-TRIP-ID TO SUT00006-OTBND-TRIP-ID          03470004
034701     EVALUATE TRUE                                                03470142
034702       WHEN PS-SET-SO-AGING                                       03470242
034712         MOVE 'SUKU040A'  TO  SUT00006-CRE-BY-PGM-NM              03471242
034713         SET PS-SET-SU-AGING  TO TRUE                             03471342
034714       WHEN PS-SET-SU-AGING                                       03471442
034715         MOVE 'SUKU040B'  TO  SUT00006-CRE-BY-PGM-NM              03471542
034716       WHEN PS-SET-SO-FOR-PRIOR                                   03471642
034717         MOVE 'SUKU040C'  TO  SUT00006-CRE-BY-PGM-NM              03471742
034718         SET PS-SET-SU-FOR-PRIOR TO TRUE                          03471842
034719       WHEN PS-SET-SU-FOR-PRIOR                                   03471942
034720         MOVE 'SUKU040D'  TO  SUT00006-CRE-BY-PGM-NM              03472042
034795     END-EVALUATE                                                 03479542
034796                                                                  03479642
034800     IF  SUOBTS-TRIP-STAT-CDE   =  'SO'                           03480003
034910         MOVE 'SO-FORCE'  TO  SUT00006-USR-ID                     03491038
035000     ELSE                                                         03500001
035110         MOVE 'SU-FORCE'  TO  SUT00006-USR-ID                     03511038
035200     END-IF.                                                      03520001
035300                                                                  03530001
035400     EXEC SQL                                                     03540001
035500         INSERT INTO SUT_TRIP_WRKR_AUD                            03550001
035600             (                                                    03560001
035700               OTBND_TRIP_ID                                      03570001
035800             , USR_ID                                             03580001
035900             , CRE_TMST                                           03590001
036000             , CRE_BY_PGM_NM                                      03600001
036100                 )                                                03610001
036200                                                                  03620001
036300             VALUES                                               03630001
036400                                                                  03640001
036500                 (                                                03650001
036600                 :SUT00006-OTBND-TRIP-ID                          03660001
036700             ,   :SUT00006-USR-ID                                 03670004
036800             ,   CURRENT TIMESTAMP                                03680001
036900             ,   :SUT00006-CRE-BY-PGM-NM                          03690003
037000                 )                                                03700001
037100     END-EXEC.                                                    03710001
037200                                                                  03720001
037300     EVALUATE TRUE                                                03730001
037400         WHEN SQLCODE = ZERO                                      03740001
037410              ADD +1 TO PV-WRKR-AUD-WRITE-COUNT                   03741044
037600         WHEN SQLCODE = -904                                      03760001
037700         WHEN SQLCODE = -911                                      03770001
037800         WHEN SQLCODE = -913                                      03780001
037900             CONTINUE                                             03790010
038000         WHEN SQLWARN0 NOT = SPACE                                03800001
038100         WHEN SQLCODE NOT = ZERO                                  03810001
038101             MOVE '2400-INSERT-WRKR-AUD'                          03810109
038120                                      TO PV-PARAGRAPH-NAME        03812009
038150             MOVE 'INSERT SUT_TRIP_WRKR_AUD'                      03815009
038151                            TO PV-DB2-OPERATION-ATTEMPTED         03815109
038160             PERFORM 9100-SQL-ABEND                               03816009
039000     END-EVALUATE.                                                03900001
039100                                                                  03910001
039200******************************************************************03920001
039300 3000-PREP-INTG-ASMRECFORC.                                       03930001
039400      PERFORM 3200-SELECT-MAX-SEQ                                 03940001
039410      PERFORM 3300-SELECT-TIMESTAMP                               03941048
039500      MOVE 'ASMRECFORC'     TO WST00010-INTGRTN-TYP-CDE.          03950001
039600      MOVE PV-ATTR-ELEM-SEQ-NBR TO WST00010-ATTR-ELEM-SEQ-NBR     03960001
039700      MOVE +1       TO WST00010-ATTR-DEFN-SEQ-NBR                 03970001
039800      SET PS-END-OF-INSERTS-NO TO TRUE                            03980001
039900                                                                  03990001
040000      PERFORM 3100-INTG-PARM-INS-PROCESSING  UNTIL                04000001
040100             PS-END-OF-INSERTS.                                   04010001
040200                                                                  04020001
040300 3100-INTG-PARM-INS-PROCESSING.                                   04030005
040310                                                                  04031032
040330      INITIALIZE WST00010-ATTR-ELEM-TXT                           04033032
040360                 WST00010-ATTR-ELEM-TMST                          04036032
040361                 WST00010-ATTR-ELEM-NBR.                          04036132
040370                                                                  04037032
040400      EVALUATE WST00010-ATTR-DEFN-SEQ-NBR                         04040002
040500        WHEN 1                                                    04050001
040600          MOVE  -1  TO  PV-NULL-IND-1                             04060030
040700                        PV-NULL-IND-2                             04070030
040710          MOVE   0  TO  PV-NULL-IND-3                             04071030
040900          MOVE SUOBTS-OTBND-TRIP-ID TO WST00010-ATTR-ELEM-NBR     04090001
041000        WHEN 2                                                    04100001
041100          MOVE  -1  TO  PV-NULL-IND-1                             04110030
041200                        PV-NULL-IND-2                             04120030
041300          MOVE   0  TO  PV-NULL-IND-3                             04130030
041400          MOVE SU175-DEST-OPER-UNT-ID  TO WST00010-ATTR-ELEM-NBR  04140019
041500        WHEN 3                                                    04150001
041700          MOVE  -1  TO  PV-NULL-IND-1                             04170030
041710                        PV-NULL-IND-3                             04171030
041800          MOVE   0  TO  PV-NULL-IND-2                             04180030
041810          MOVE   PV-DB2-TIMESTAMP      TO WST00010-ATTR-ELEM-TMST 04181020
041900        WHEN 4                                                    04190001
042000          MOVE 'Y'  TO WST00010-ATTR-ELEM-TXT-TEXT                04200034
042100          MOVE  1   TO WST00010-ATTR-ELEM-TXT-LEN                 04210001
042200          MOVE  -1  TO  PV-NULL-IND-2                             04220020
042300                        PV-NULL-IND-3                             04230010
042400          MOVE   0  TO  PV-NULL-IND-1                             04240020
042500        WHEN 5                                                    04250001
042600          MOVE  -1  TO  PV-NULL-IND-2                             04260020
042700                        PV-NULL-IND-3                             04270010
042800          MOVE   0  TO  PV-NULL-IND-1                             04280031
043000          MOVE 'SUKUP040'    TO WST00010-ATTR-ELEM-TXT-TEXT       04300034
043010          MOVE   8  TO WST00010-ATTR-ELEM-TXT-LEN                 04301034
043100        WHEN 6                                                    04310001
043200          MOVE  -1  TO  PV-NULL-IND-2                             04320030
043300                        PV-NULL-IND-3                             04330030
043400          MOVE   0  TO  PV-NULL-IND-1                             04340020
043500          MOVE  26  TO WST00010-ATTR-ELEM-TXT-LEN                 04350036
043600          MOVE 'BATCH PROCESS-STATUS AGING'                       04360038
043610                                  TO WST00010-ATTR-ELEM-TXT-TEXT  04361036
043700          SET PS-END-OF-INSERTS TO TRUE                           04370001
043800      END-EVALUATE.                                               04380001
043900                                                                  04390001
044000      PERFORM 4000-INSERT-ATTR-ELEM.                              04400001
044100      ADD +1   TO WST00010-ATTR-DEFN-SEQ-NBR.                     04410002
044200******************************************************************04420001
044300******************************************************************04430001
044400 3200-SELECT-MAX-SEQ.                                             04440001
044500                                                                  04450001
044600                                                                  04460001
044700     EXEC SQL                                                     04470001
044800         SELECT  MAX(ATTR_ELEM_SEQ_NBR)                           04480001
044900          INTO  :PV-ATTR-ELEM-SEQ-NBR                             04490001
045000          FROM  WST_ATTR_ELEM A                                   04500001
045100         WHERE  A.INTGRTN_TYP_CDE  = 'ASMRECFORC'                 04510001
045200     END-EXEC.                                                    04520001
045300                                                                  04530001
045400     EVALUATE TRUE                                                04540001
045500         WHEN SQLCODE = ZERO                                      04550001
045600           COMPUTE PV-ATTR-ELEM-SEQ-NBR =                         04560001
045700                     PV-ATTR-ELEM-SEQ-NBR + 1                     04570001
045800         WHEN SQLWARN0 NOT = SPACES                               04580001
045900         WHEN SQLCODE < ZERO                                      04590001
046000         WHEN SQLCODE > ZERO                                      04600001
046100           MOVE '3200-SELECT-MAX-SEQ '                            04610001
046200                                      TO PV-PARAGRAPH-NAME        04620001
046300           MOVE 'SELECT WST_ATTR_EL' TO PV-DB2-OPERATION-ATTEMPTED04630001
046400             PERFORM 9100-SQL-ABEND                               04640001
046500     END-EVALUATE.                                                04650001
046600                                                                  04660001
046700                                                                  04670001
046710******************************************************************04671048
046720 3300-SELECT-TIMESTAMP.                                           04672048
046730                                                                  04673048
046740                                                                  04674048
046750     EXEC SQL                                                     04675048
046760         SELECT  CURRENT TIMESTAMP                                04676048
046770          INTO  :PV-DB2-TIMESTAMP                                 04677048
046780          FROM  TCOCNTL                                           04678048
046790         WHERE  OPER_UNT_ID = 090                                 04679048
046791     END-EXEC.                                                    04679148
046792                                                                  04679248
046793     EVALUATE TRUE                                                04679348
046794         WHEN SQLCODE = ZERO                                      04679448
046795           CONTINUE                                               04679548
046797         WHEN SQLWARN0 NOT = SPACES                               04679748
046798         WHEN SQLCODE < ZERO                                      04679848
046799         WHEN SQLCODE > ZERO                                      04679948
046800           MOVE '3300-SELECT-TIMESTAMP '                          04680048
046801                                      TO PV-PARAGRAPH-NAME        04680148
046802           MOVE 'SELECT TCOCNTL' TO PV-DB2-OPERATION-ATTEMPTED    04680248
046803             PERFORM 9100-SQL-ABEND                               04680348
046804     END-EVALUATE.                                                04680448
046805                                                                  04680548
046806                                                                  04680648
046810                                                                  04681048
046900                                                                  04690001
047000 4000-INSERT-ATTR-ELEM.                                           04700001
047001                                                                  04700118
047200     EXEC SQL                                                     04720001
047300         INSERT INTO WST_ATTR_ELEM                                04730014
047400               ( INTGRTN_TYP_CDE                                  04740014
047500               ,ATTR_DEFN_SEQ_NBR                                 04750014
047600               ,ATTR_ELEM_SEQ_NBR                                 04760014
047700               ,ATTR_ELEM_TXT                                     04770014
047800               ,ATTR_ELEM_TMST                                    04780014
047900               ,ATTR_ELEM_NBR                                     04790014
048000               )                                                  04800014
048100         VALUES (:WST00010-INTGRTN-TYP-CDE                        04810014
048200                ,:WST00010-ATTR-DEFN-SEQ-NBR                      04820014
048300                ,:WST00010-ATTR-ELEM-SEQ-NBR                      04830014
048400                ,:WST00010-ATTR-ELEM-TXT                          04840014
048500                     :PV-NULL-IND-1                               04850030
048600                ,:WST00010-ATTR-ELEM-TMST                         04860014
048700                     :PV-NULL-IND-2                               04870014
048800                ,:WST00010-ATTR-ELEM-NBR                          04880014
048900                     :PV-NULL-IND-3                               04890014
049000                )                                                 04900014
049200     END-EXEC.                                                    04920001
049300                                                                  04930001
049400     EVALUATE TRUE                                                04940001
049500         WHEN SQLCODE = ZERO                                      04950001
049600             IF WST00010-ATTR-DEFN-SEQ-NBR  = 6                   04960044
049610                ADD +1 TO PV-INTG-PARM-WRITE-COUNT                04961044
049620             END-IF                                               04962044
049700         WHEN SQLWARN0 NOT = SPACES                               04970001
049800         WHEN SQLCODE < ZERO                                      04980001
049900         WHEN SQLCODE > ZERO                                      04990001
050000             MOVE '4000-INSERT-ATTR-ELEM'                         05000017
050100                                        TO PV-PARAGRAPH-NAME      05010001
050200             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 05020001
050300             PERFORM 9100-SQL-ABEND                               05030001
050400     END-EVALUATE.                                                05040001
050500                                                                  05050001
050600                                                                  05060001
050700******************************************************************05070001
069500******************************************************************06950001
069600* READ INPUT FILE.                                                06960001
069700******************************************************************06970001
069800 7000-READ-OTBND-TRIP-FILE-IN.                                    06980001
069900                                                                  06990001
070000      INITIALIZE SU175-AGING-TRIP-REC.                            07000013
070100                                                                  07010001
070200      READ OUTBOUND-TRIP-FILE-IN INTO                             07020001
070300           SU175-AGING-TRIP-REC                                   07030013
070400            AT END SET PS-END-OF-FILE TO TRUE.                    07040001
070500                                                                  07050001
070600      IF PS-END-OF-FILE                                           07060001
070700         CONTINUE                                                 07070001
070800      ELSE                                                        07080001
070900         ADD +1 TO PV-READ-COUNTER                                07090001
071000      END-IF.                                                     07100001
071100                                                                  07110001
071110*---------------------------------------------------------------* 07111001
071120* DB2 COOMMIT                                                   * 07112001
071130*---------------------------------------------------------------* 07113001
071140 7100-COMMIT.                                                     07114001
071150                                                                  07115001
071160     EXEC SQL                                                     07116001
071170         COMMIT                                                   07117001
071180     END-EXEC.                                                    07118001
071190                                                                  07119001
071200******************************************************************07120001
084000******************************************************************08400001
084100* CLOSE FILES.   DISPLAY COUNTERS.                                08410001
084200******************************************************************08420001
084300 9000-EOJ-ROUTINE.                                                08430001
084400     CLOSE OUTBOUND-TRIP-FILE-IN.                                 08440048
084500                                                                  08450001
084600     MOVE PV-READ-COUNTER          TO PV-DISPLAY-COUNT.           08460001
084700     DISPLAY 'TOTAL RECORDS READ.: '  PV-DISPLAY-COUNT.           08470001
084710*                                                                 08471046
084800     MOVE PV-TRIP-SO-WRITE-COUNT   TO PV-DISPLAY-COUNT.           08480044
084810     DISPLAY 'SO TSUOBTS WRITTEN.: '  PV-DISPLAY-COUNT.           08481044
084811*                                                                 08481146
084820     MOVE PV-TRIP-SU-WRITE-COUNT   TO PV-DISPLAY-COUNT.           08482044
084830     DISPLAY 'SU TSUOBTS WRITTEN.: '  PV-DISPLAY-COUNT.           08483044
084831*                                                                 08483146
084860     MOVE PV-WRKR-AUD-WRITE-COUNT  TO PV-DISPLAY-COUNT.           08486044
084870     DISPLAY 'WRKR_AUD WRITTEN...: '  PV-DISPLAY-COUNT.           08487044
084871*                                                                 08487146
084880     MOVE PV-INTG-PARM-WRITE-COUNT TO PV-DISPLAY-COUNT.           08488044
084890     DISPLAY 'ASMRECFORC WRITTEN.: '  PV-DISPLAY-COUNT.           08489044
084900                                                                  08490044
085000     DISPLAY '*****  SUKUP040 ENDED  *****'.                      08500001
085100                                                                  08510001
085200******************************************************************08520001
085300* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL     08530001
085400* ERROR OR WARNING CODE OCCURS.                                   08540001
085500******************************************************************08550001
085600 9100-SQL-ABEND.                                                  08560001
085700     DISPLAY '9100-SQL-ABEND'.                                    08570001
085800     DISPLAY '** ABEND     **'.                                   08580001
085900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08590001
086000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08600001
086100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08610001
086200     DISPLAY '** TRIP ID   ** = ' SU175-OTBND-TRIP-ID.            08620001
086300                                                                  08630001
086400******************************************************************08640001
086500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    08650001
086600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         08660001
086700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08670001
086800* FORMAT.                                                         08680001
086900******************************************************************08690001
087000     COPY DPPD004.                                                08700001
087100                                                                  08710001
087200     MOVE +4013                  TO ABEND-CODE.                   08720001
087300     CALL 'ILBOABN0' USING ABEND-CODE.                            08730001
087400                                                                  08740001
