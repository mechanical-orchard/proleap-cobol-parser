000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    CNKCS221.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  NOVEMBER,2000.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y221 - PRINTER MAINTENANCE     - STOCK TYPE LIST           * 00110001
001200*---------------------------------------------------------------* 00120000
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00121002
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00122002
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00123002
263455*----------------------------------------------------------------*00124002
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00125003
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00126003
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00127003
CICS  *-----------------------------------------------------------------00128003
001300 ENVIRONMENT DIVISION.                                            00130000
001400 DATA DIVISION.                                                   00140000
001500                                                                  00150000
001600 WORKING-STORAGE SECTION.                                         00160000
001700                                                                  00170000
001800 01  PC-PROGRAM-CONSTANTS.                                        00180000
001900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK221  '.  00190000
002000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM221 '.  00200000
002100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS221'.  00210000
002200     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE 'DPKCS060'.  00220000
002300     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00230000
002400     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00240000
002500     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00250000
002600     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00260000
002700                                               COMP SYNC.         00270000
002800     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00280000
002900                                               COMP SYNC.         00290000
003000     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00300000
003100                                               COMP-3.            00310000
003200     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00320000
003300                                               COMP SYNC.         00330000
003400     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00340000
003500                                               COMP-3.            00350000
003600     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00360000
003700     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00370000
003800     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00380000
003900     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00390000
004000                                                                  00400000
004100*----------------------------------------------------------------*00410000
004200*  SYSTEM MESSAGES                                               *00420000
004300*----------------------------------------------------------------*00430000
004400*   00005 = INVALID VALUE                                        *00440000
004500*   00008 = MUST BE NUMERIC                                      *00450000
004600*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00460000
004700*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00470000
004800*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00480000
004900*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00490000
005000*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00500000
005100*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00510000
005200*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00520000
005300*   00069 - TOP OF LIST                                          *00530000
005400*   00070 - BOTTOM OF LIST                                       *00540000
005500*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00550000
005600*   00279 - MORE ITEMS TO DISPLAY                                *00560000
005700*----------------------------------------------------------------*00570000
005800     05  PC-TSYMSG-NUMBERS.                                       00580000
005900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00590000
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00600000
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00610000
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00620000
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00630000
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00640000
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00650000
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00660000
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00670000
006800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00680000
006900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00690000
007000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00700000
007100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00710000
007200*                                                                 00720000
007300 01  PS-PROGRAM-SWITCHES.                                         00730000
007400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00740000
007500         88  PS-NO-ERROR                            VALUE 'Y'.    00750000
007600         88  PS-ERROR                               VALUE 'N'.    00760000
007700     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00770000
007800         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00780000
007900         88  PS-BLOCK-ERROR                         VALUE 'N'.    00790000
008000     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00800000
008100         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00810000
008200         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00820000
008300     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00830000
008400         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00840000
008500         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00850000
008600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00860000
008700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00870000
008800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00880000
008900     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00890000
009000         88  PS-LIST-END                            VALUE 'Y'.    00900000
009100         88  PS-NO-LIST-END                         VALUE 'N'.    00910000
009200*                                                                 00920000
009300 01  PV-PROGRAM-VARIABLES.                                        00930000
009400     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  00940000
009500                                        COMP SYNC.                00950000
009600     05  PV-SUB                         PIC S9(04)  VALUE +0      00960000
009700                                                    COMP SYNC.    00970000
009800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00980000
009900                                                    COMP SYNC.    00990000
010000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01000000
010100                                                    COMP-3.       01010000
010200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01020000
010300                                                    COMP-3.       01030000
010400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01040000
010500                                                    COMP-3.       01050000
010600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01060000
010700                                                    COMP-3.       01070000
010800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01080000
010900                                                    COMP-3.       01090000
011000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01100000
011100                                                    COMP-3.       01110000
011200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01120000
011300                                                    COMP-3.       01130000
011400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01220000
012300                                                    COMP SYNC.    01230000
012400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01240000
012500                                                    COMP SYNC.    01250000
012600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01260000
012700                                                    COMP SYNC.    01270000
012800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01280000
012900                                                    COMP SYNC.    01290000
013000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01340000
013500                                                    COMP SYNC.    01350000
013600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01400000
014100                                                    COMP SYNC.    01410000
014200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01420000
014300                                                    COMP SYNC.    01430000
014400     05  PV-SOFT-ABORT-MSG.                                       01440000
014500         10  FILLER            PIC X(12) VALUE ' CNKCS221 - '.    01450000
014600         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01460000
014700         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01470000
014800         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01480000
014900         10  PV-SOFT-PARAGRAPH PIC X(30).                         01490000
015000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01500000
015100                                                     COMP SYNC.   01510000
015200     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01520000
015300                                                     COMP SYNC.   01530000
015400     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01540000
015500     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01550000
015600                                                                  01560000
015700******************************************************************01570000
015800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01580000
015900**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01590000
016000**  APPLICATION-SPECIFIC COMMAREA.                              **01600000
016100******************************************************************01610000
016200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01620000
016300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01630000
016400     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01640000
016500                                        INDEXED BY LQW-IDX.       01650000
016600         10  LQW-STK-TYP-CDE            PIC  X(08).               01660000
016700         10  LQW-STK-TYP-DESC           PIC  X(50).               01670000
016800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01680000
016900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01690000
017000         10  LQW-SELECTED-SW            PIC  X(01).               01700000
017100             88  LQW-SELECT                         VALUE 'S'.    01710000
017200             88  LQW-DESELECT                       VALUE ' '.    01720000
017300         10  LQW-ACTION                 PIC  X(03).               01730000
017400             88  LQW-DEL                            VALUE 'DEL'.  01740000
017500             88  LQW-INQ                            VALUE 'INQ'.  01750000
017600             88  LQW-UPD                            VALUE 'UPD'.  01760000
017700             88  LQW-ERR                            VALUE 'ERR'.  01770000
017800             88  LQW-PRT                            VALUE 'PRT'.  01780000
017900                                                                  01790000
018000*---------------------------------------------------------------* 01800000
018100* SELECTON QUEUE LAYOUT                                         * 01810000
018200*---------------------------------------------------------------* 01820000
018300     COPY CNWS163.                                                01830000
018400                                                                  01840000
018500*---------------------------------------------------------------* 01850000
018600*    MAP LAYOUT                                                 * 01860000
018700*---------------------------------------------------------------* 01870000
018800     COPY CNKM221.                                                01880000
018900*                                                                 01890000
019000 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK221O.       01900000
019100     05  FILLER                         PIC X(42).                01910000
019200     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01920000
019300*        10  MR-SELECTL                 PIC S9(04) COMP.          01930000
019400*        10  MR-SELECTA                 PIC  X(01).               01940000
019500*        10  MR-SELECTC                 PIC  X(01).               01950000
019600*        10  MR-SELECTH                 PIC  X(01).               01960000
019700*        10  MR-SELECTI                 PIC  X(01).               01970000
019800                                                                  01980000
019900*        10  MR-ACTIONL                 PIC S9(04) COMP.          01990000
020000*        10  MR-ACTIONA                 PIC  X(01).               02000000
020100*        10  MR-ACTIONC                 PIC  X(01).               02010000
020200*        10  MR-ACTIONH                 PIC  X(01).               02020000
020300*        10  MR-ACTION                  PIC  X(03).               02030000
020400                                                                  02040000
020500         10  MR-STK-TYP-CDEL           PIC S9(04) COMP.           02050000
020600         10  MR-STK-TYP-CDEA           PIC  X(01).                02060000
020700         10  MR-STK-TYP-CDEC           PIC  X(01).                02070000
020800         10  MR-STK-TYP-CDEH           PIC  X(01).                02080000
020900         10  MR-STK-TYP-CDE            PIC  X(08).                02090000
021000                                                                  02100000
021100         10  MR-STK-TYP-DESCL          PIC S9(04) COMP.           02110000
021200         10  MR-STK-TYP-DESCA          PIC  X(01).                02120000
021300         10  MR-STK-TYP-DESCC          PIC  X(01).                02130000
021400         10  MR-STK-TYP-DESCH          PIC  X(01).                02140000
021500         10  MR-STK-TYP-DESC           PIC  X(50).                02150000
021600                                                                  02160000
021700     05  FILLER                         PIC  X(12).               02170000
021800                                                                  02180000
021900*----------------------------------------------------------------*02190000
022000**  SECURITY SUBROUTINE PARAMETERS                                02200000
022100*----------------------------------------------------------------*02210000
022200     COPY DPWS008.                                                02220000
022300                                                                  02230000
022400*---------------------------------------------------------------* 02240000
022500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02250000
022600*---------------------------------------------------------------* 02260000
022700     COPY DPWS015.                                                02270000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000*    FUNCTION KEYS COPYBOOK.                                    * 02300000
023100*---------------------------------------------------------------* 02310000
023200     COPY DPWS016.                                                02320000
023300                                                                  02330000
023400*---------------------------------------------------------------* 02340000
023500*    NUMERIC EDIT LAYOUT.                                       * 02350000
023600*---------------------------------------------------------------* 02360000
023700     COPY DPWS010I.                                               02370000
023800                                                                  02380000
023900*---------------------------------------------------------------* 02390000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02400003
024100*---------------------------------------------------------------* 02410000
024200     COPY DPWS030.                                                02420000
CICS       COPY DPWS930.                                                02421003
024300                                                                  02430000
024400*---------------------------------------------------------------* 02440000
024500*    STANDARD COMMAREA.                                         * 02450000
024600*---------------------------------------------------------------* 02460000
024700     COPY DPWS020.                                                02470000
024800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02480000
024900                                                                  02490000
025000*---------------------------------------------------------------* 02500000
025100* INTER-APPLICATION COMMAREA.                                   * 02510000
025200*   PCWS162 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02520000
025300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02530000
025400*---------------------------------------------------------------* 02540000
025500         10  INTER-APPL-COMM-AREA       PIC X(200).               02550000
025600     COPY CNWS162.                                                02560000
025700                                                                  02570000
025800*---------------------------------------------------------------* 02580000
025900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02590000
026000*---------------------------------------------------------------* 02600000
026100         10  ASC-SPECIFIC-COMMAREA.                               02610000
026200             15  ASC-BLK-SUB                  PIC S9(04) COMP     02620000
026300                                                         SYNC.    02630000
026400             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02640000
026500                                                         SYNC.    02650000
026600             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02660000
026700             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02670000
026800             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02680000
026900             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02690000
027000             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02700000
027100             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02710000
027200                                                         SYNC.    02720000
027300             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02730000
027400             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02740000
027500             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02750000
027600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     02760000
027700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     02770000
027800             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         02780000
027900                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     02790000
028000                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     02800000
028100             15  ASC-LIST-QUEUE-NAME.                             02810000
028200                 20  ASC-LIST-TERM-ID         PIC  X(04).         02820000
028300                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  02830000
028400                 20  ASC-LIST-SEQ             PIC  9(01).         02840000
028500                                                                  02850000
028600             15  ASC-START-ITEM-REQUEST.                          02860000
028700                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         02870000
028800                                                                  02880000
028900             15  ASC-SEL-SUB                  PIC S9(4) COMP.     02890000
029000             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     02900000
029100             15  ASC-CURSOR-SW                PIC  X(02).         02910000
029200                 88  ASC-NO-CURSOR                   VALUE 'Z '.  02920000
029300                 88  ASC-CLUSTER-CURSOR              VALUE 'A '.  02930000
029400                 88  ASC-PRINTER-CURSOR              VALUE 'B '.  02940000
029500*                                                                 02950000
029600             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          02960000
029700                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02970000
029800             15  ASC-SEL-QUEUE-NAME.                              02980000
029900                 20  ASC-SEL-TERM-ID          PIC  X(04).         02990000
030000                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03000000
030100                 20  ASC-SEL-SEQ              PIC  9(01).         03010000
030200             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03020000
030300                                                                  03030000
030400*-----------------------------------------------------------------03040000
030500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03050000
030600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03060000
030700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03070000
030800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03080000
030900                                                                  03090000
031000                 20  ASC-ITEM-ARRAY.                              03100000
031100                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03110000
031200                         30  ASC-STK-TYP-CDE         PIC  X(08).  03120000
031300                         30  ASC-STK-TYP-DESC        PIC  X(50).  03130000
031400                         30  ASC-LIST-ITEM-NUMBER                 03140000
031500                                                     PIC S9(09)   03150000
031600                                                     COMP-3.      03160000
031700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03170000
031800                             88  ASC-VALID-SELECT    VALUE ' '    03180000
031900                                                           'S'    03190000
032000                                                           'B'    03200000
032100                                                           'E'.   03210000
032200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03220000
032300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03230000
032400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03240000
032500                             88  ASC-TEMP-END        VALUE 'E'.   03250000
032600                         30  ASC-SELECTED-SW         PIC  X(01).  03260000
032700                             88  ASC-NO-SELECT       VALUE ' '.   03270000
032800                             88  ASC-SELECT          VALUE 'S'.   03280000
032900                             88  ASC-BEGIN           VALUE 'B'.   03290000
033000                             88  ASC-END             VALUE 'E'.   03300000
033100                         30  ASC-ACTION              PIC  X(03).  03310000
033200                                                                  03320000
033300*---------------------------------------------------------------* 03330000
033400*    ABEND PROCESSING COPYBOOK.                                 * 03340000
033500*---------------------------------------------------------------* 03350000
033600     COPY DPWS013.                                                03360000
033700                                                                  03370000
033800*****DB2 AREA FOR TSYMSG  (SYSTEM MESSAGE - SHORT MESSAGE)        03380000
033900     EXEC SQL                                                     03390000
034000          INCLUDE TSYMSG                                          03400000
034100     END-EXEC.                                                    03410000
034200                                                                  03420000
034300*---------------------------------------------------------------* 03430000
034400*    TSTKTYP -  STOCK TYPE TABLE                                * 03440000
034500*---------------------------------------------------------------* 03450000
034600     EXEC SQL                                                     03460000
034700          INCLUDE TSTKTYP                                         03470000
034800     END-EXEC.                                                    03480000
034900*                                                                 03490000
035000*---------------------------------------------------------------* 03500000
035100*    DB2 AREA FOR COMMUNICATIONS                                * 03510000
035200*---------------------------------------------------------------* 03520000
035300     EXEC SQL                                                     03530000
035400          INCLUDE SQLCA                                           03540000
035500     END-EXEC.                                                    03550000
035600                                                                  03560000
035700*---------------------------------------------------------------* 03570000
035800*    STOCK TYPE CURSOR                                            03580000
035900*---------------------------------------------------------------* 03590000
036000     EXEC SQL                                                     03600000
036100        DECLARE STOCK-TYPE-CSR CURSOR FOR                         03610000
036200           SELECT STK_TYP_CDE                                     03620000
036300                 ,STK_TYP_DESC                                    03630000
036400           FROM  TSTKTYP                                          03640000
036500     END-EXEC.                                                    03650000
036600                                                                  03660000
036700 LINKAGE SECTION.                                                 03670000
036800                                                                  03680000
036900 01  DFHCOMMAREA.                                                 03690000
037000     05  FILLER                         OCCURS  1 TO 4072 TIMES   03700000
037100                                        DEPENDING ON EIBCALEN.    03710000
037200         10  FILLER                     PIC X.                    03720000
037300                                                                  03730000
037400                                                                  03740000
037500 PROCEDURE DIVISION.                                              03750000
037600******************************************************************03760000
037700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03770000
037800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03780000
037900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03790000
038000******************************************************************03800000
038100 0000-MAIN-MODULE.                                                03810000
038200     INITIALIZE DP030-CICS-API-FIELDS.                            03820000
038300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03830000
038400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03840000
038500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03850000
038600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03860000
038700     MOVE LENGTH OF CNK221I        TO DP030-MAP-LENGTH (1).       03870000
038800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03880000
038900     PERFORM 0001-CALL-CICS-ARCH-API.                             03890000
039000*                                                                 03900000
039100     PERFORM 1000-CONTROL-PROCESSING                              03910000
039200*                                                                 03920000
039300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03930000
039400     PERFORM 0001-CALL-CICS-ARCH-API.                             03940000
039500                                                                  03950000
039600******************************************************************03960000
039700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03970000
039800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03980000
039900******************************************************************03990000
040000 0001-CALL-CICS-ARCH-API.                                         04000000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04010003
040200                                    DFHCOMMAREA                   04020003
040300                                    DP030-CICS-API-FIELDS         04030003
040400                                    DP020-STANDARD-COMMAREA       04040003
040500                                    CNK221I.                      04050003
040600*                                                                 04060000
040700     IF  DP030-RC-CALL-SUCCESSFUL                                 04070000
040800         CONTINUE                                                 04080000
040900     ELSE                                                         04090000
041000         SET DP013-NO-ROLLBACK                                    04100000
041100             DP013-XCTL-DISPLAY-RESTART                           04110000
041200             DP013-CICS-ABEND      TO TRUE                        04120000
041300         MOVE '0001-CALL-CICS-ARCH-API'                           04130000
041400                                   TO DP013-PARAGRAPH             04140000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04141003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04142003
041700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04170000
041800         PERFORM DP013-0000-PROCESS-ABEND                         04180000
041900     END-IF.                                                      04190000
042000                                                                  04200000
042100*----------------------------------------------------------------*04210000
042200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04220000
042300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04230000
042400*                                                                *04240000
042500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04250000
042600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04260000
042700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04270000
042800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04280000
042900*----------------------------------------------------------------*04290000
043000 1000-CONTROL-PROCESSING.                                         04300000
043100     EVALUATE TRUE                                                04310000
043200         WHEN DP020-NEXT-ACT-INITIAL                              04320000
043300             INITIALIZE ASC-SPECIFIC-COMMAREA                     04330000
043400             MOVE EIBTRMID          TO ASC-LIST-TERM-ID           04340000
043500                                       ASC-SEL-TERM-ID            04350000
043600             MOVE DP020-SRC-TASK-NUMBER                           04360000
043700                                    TO ASC-LIST-TASK-NUMBER       04370000
043800                                       ASC-SEL-TASK-NUMBER        04380000
043900             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04390000
044000             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04400000
044100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04410000
044200                                                                  04420000
044300***-----$TEMPLATE NOTE$-------------------------------------------04430000
044400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04440000
044500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04450000
044600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04460000
044700***---------------------------------------------------------------04470000
044800             IF  PS-COMMAREA-NOT-VALID                            04480000
044900                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            04490000
045000             ELSE                                                 04500000
045100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04510000
045200             END-IF                                               04520000
045300                                                                  04530000
045400         WHEN DP020-NEXT-ACT-READ-MAP                             04540000
045500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04550000
045600             PERFORM 2000-PROCESS-PANEL                           04560000
045700                                                                  04570000
045800         WHEN DP020-NEXT-ACT-RETURN                               04580000
045900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04590000
046000             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                04600000
046100             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04610000
046200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04620000
046300                                                                  04630000
046400         WHEN OTHER                                               04640000
046500             SET DP013-LOGIC-ABEND TO TRUE                        04650000
046600             SET DP013-NO-ROLLBACK TO TRUE                        04660000
046700             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    04670000
046800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04680000
046900                                   TO DP013-MESSAGE-TEXT(1)       04690000
047000             PERFORM DP013-0000-PROCESS-ABEND                     04700000
047100     END-EVALUATE.                                                04710000
047200                                                                  04720000
047300*----------------------------------------------------------------*04730000
047400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04740000
047500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04750000
047600*----------------------------------------------------------------*04760000
047700 1100-PROCESS-INTER-APPL-COMM.                                    04770000
047800                                                                  04780000
047900     SET PS-COMMAREA-VALID         TO TRUE.                       04790000
048000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04800000
048100                                                                  04810000
048200     IF  DP020-INT-APPL-FORMAT-IND = PC-DETAIL-SCREEN             04820000
048300         CONTINUE                                                 04830000
048400     ELSE                                                         04840000
048500         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           04850000
048600         SET  PS-COMMAREA-NOT-VALID TO TRUE                       04860000
048700       END-IF.                                                    04870000
048800                                                                  04880000
048900*----------------------------------------------------------------*04890000
049000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04900000
049100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04910000
049200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04920000
049300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04930000
049400* FUNCTION KEYS CAN GET THIS FAR.                                *04940000
049500*----------------------------------------------------------------*04950000
049600 2000-PROCESS-PANEL.                                              04960000
049700     EVALUATE TRUE                                                04970000
049800         WHEN DP020-SRC-AID = DP016-CLEAR                         04980000
049900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04990000
050000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05000000
050100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05010000
050200                                                                  05020000
050300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05030000
050400             PERFORM 2050-DELETE-LIST-QUEUE                       05040000
050500             PERFORM 4000-BUILD-INITIAL-PANEL                     05050000
050600                                                                  05060000
050700*        WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05070000
050800*            PERFORM 2140-DESELECT-ALL-ITEMS                      05080000
050900*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05090000
051000                                                                  05100000
051100*        WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05110000
051200*            PERFORM 2150-SELECT-ALL-ITEMS                        05120000
051300*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05130000
051400                                                                  05140000
051500         WHEN OTHER                                               05150000
051600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05160000
051700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05170000
051800             IF  PS-NO-ERROR                                      05180000
051900                 SET DP030-CONTINUE-GO TO TRUE                    05190000
052000                 PERFORM 2100-CHECK-FUNCTION-KEY                  05200000
052100             ELSE                                                 05210000
052200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05220000
052300                 SET DP030-OVERRIDE-GO TO TRUE                    05230000
052400             END-IF                                               05240000
052500     END-EVALUATE.                                                05250000
052600                                                                  05260000
052700*----------------------------------------------------------------*05270000
052800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05280000
052900*----------------------------------------------------------------*05290000
053000 2050-DELETE-LIST-QUEUE.                                          05300000
053100                                                                  05310000
053200     EXEC CICS                                                    05320000
053300         DELETEQ TS                                               05330000
053400             QUEUE (ASC-LIST-QUEUE-NAME)                          05340000
053500             RESP  (PV-CICS-RESP)                                 05350000
053600     END-EXEC.                                                    05360000
053700                                                                  05370000
053800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05380000
053900        (PV-CICS-RESP = DFHRESP(QIDERR))                          05390000
054000         CONTINUE                                                 05400000
054100     ELSE                                                         05410000
054200         SET DP013-CICS-ABEND      TO TRUE                        05420000
054300         SET DP013-NO-ROLLBACK     TO TRUE                        05430000
054400                                                                  05440000
054500         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         05450000
054600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05460000
054700                                   TO DP013-MESSAGE-TEXT (1)      05470000
054800         PERFORM DP013-0000-PROCESS-ABEND                         05480000
054900     END-IF.                                                      05490000
055000                                                                  05500000
055100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05510000
055200                                                                  05520000
055300*----------------------------------------------------------------*05530000
055400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05540000
055500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05550000
055600* CICS ARCHITECTURE API.                                         *05560000
055700*----------------------------------------------------------------*05570000
055800 2100-CHECK-FUNCTION-KEY.                                         05580000
055900                                                                  05590000
056000     EVALUATE TRUE                                                05600000
056100                                                                  05610000
056200* F13 - PRINTER ADD   (LOCAL-FUNC-01)                             05620000
056300*        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05630000
056400*                INITIALIZE CN162-INTER-APPL-COMMAREA             05640001
056500*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05650000
056600*                               TO CN162-NUMBER-OF-SELECTED-ITEMS 05660001
056700*                MOVE ASC-STK-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  05670000
056800*                                     TO CN162-STK-TYP-CDE        05680001
056900*                MOVE ASC-STK-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  05690000
057000*                                     TO CN162-STK-TYP-DESC       05700001
057100*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05710000
057200                                                                  05720000
057300* F15 - PRINTER UPDATE  (LOCAL-FUNC-02)                           05730000
057400*        WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05740000
057500*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05750000
057600*                INITIALIZE CN162-INTER-APPL-COMMAREA             05760001
057700*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05770000
057800*                               TO CN162-NUMBER-OF-SELECTED-ITEMS 05780001
057900*                MOVE ASC-OPER-UNT-ID TO CN162-OPER-UNT-ID        05790001
058000*                MOVE ASC-FCLTY-ID TO CN162-FCLTY-ID              05800001
058100*                MOVE ASC-FCLTY-NME  TO CN162-FCLTY-NME           05810001
058200*                PERFORM 5000-PREPARE-SEL-QUEUE                   05820000
058300*            ELSE                                                 05830000
058400*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05840000
058500*                SET DP030-OVERRIDE-GO TO TRUE                    05850000
058600*                MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         05860000
058700*                SET DP020-MSG-WARNING TO TRUE                    05870000
058800*            END-IF                                               05880000
058900                                                                  05890000
059000* F6 - FIRST PAGE                                                 05900000
059100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05910000
059200             MOVE +1               TO PV-TOP-ITEM                 05920000
059300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05930000
059400                                                                  05940000
059500* F7 - PREVIOUS PAGE                                              05950000
059600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05960000
059700             PERFORM 2110-BROWSE-BACKWARD                         05970000
059800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05980000
059900                                                                  05990000
060000* F8 - NEXT PAGE                                                  06000000
060100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06010000
060200             PERFORM 2120-BROWSE-FORWARD                          06020000
060300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06030000
060400                                                                  06040000
060500* ENTER KEY                                                       06050000
060600         WHEN DP020-SRC-AID = DP016-ENTER                         06060000
060700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06070000
060800             IF  PS-ERROR                                         06080000
060900                 CONTINUE                                         06090000
061000             ELSE                                                 06100000
061100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06110000
061200             END-IF                                               06120000
061300                                                                  06130000
061400         WHEN OTHER                                               06140000
061500             SET DP013-NO-ROLLBACK                                06150000
061600                 DP013-XCTL-DISPLAY-RESTART                       06160000
061700                 DP013-CICS-ABEND  TO TRUE                        06170000
061800             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06180000
061900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06190000
062000                                   TO DP013-MESSAGE-TEXT (1)      06200000
062100             PERFORM DP013-0000-PROCESS-ABEND                     06210000
062200     END-EVALUATE.                                                06220000
062300                                                                  06230000
062400*----------------------------------------------------------------*06240000
062500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06250000
062600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06260000
062700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06270000
062800*    MESSAGE.                                                    *06280000
062900*----------------------------------------------------------------*06290000
063000 2110-BROWSE-BACKWARD.                                            06300000
063100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06310000
063200         GIVING PV-TOP-ITEM.                                      06320000
063300*                                                                 06330000
063400     IF  ((PV-TOP-ITEM < +1)                                      06340000
063500       OR (PV-TOP-ITEM = +1))                                     06350000
063600         MOVE +1                   TO PV-TOP-ITEM                 06360000
063700*        -- TOP OF LIST --                                        06370000
063800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06380000
063900         SET DP020-MSG-INFORMATIONAL TO TRUE                      06390000
064000     END-IF.                                                      06400000
064100                                                                  06410000
064200*----------------------------------------------------------------*06420000
064300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06430000
064400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06440000
064500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06450000
064600*----------------------------------------------------------------*06460000
064700 2120-BROWSE-FORWARD.                                             06470000
064800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06480000
064900         GIVING PV-TOP-ITEM.                                      06490000
065000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06500000
065100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06510000
065200*        -- BOTTOM OF LIST --                                     06520000
065300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06530000
065400         SET DP020-MSG-INFORMATIONAL TO TRUE                      06540000
065500     ELSE                                                         06550000
065600         COMPUTE PV-BOTTOM-ITEM =                                 06560000
065700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06570000
065800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06580000
065900*            -- BOTTOM OF LIST --                                 06590000
066000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06600000
066100             SET DP020-MSG-INFORMATIONAL TO TRUE                  06610000
066200         END-IF                                                   06620000
066300     END-IF.                                                      06630000
066400                                                                  06640000
066500*----------------------------------------------------------------*06650000
066600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06660000
066700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06670000
066800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06680000
066900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06690000
067000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06700000
067100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06710000
067200*----------------------------------------------------------------*06720000
067300 2130-CHECK-FOR-JUMP-BROWSE.                                      06730000
067400     SET PS-NO-ERROR               TO TRUE.                       06740000
067500     IF (ASC-START-ITEM-REQUEST = SPACE)                          06750000
067600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06760000
067700     ELSE                                                         06770000
067800         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     06780000
067900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06790000
068000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06800000
068100         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06810000
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06821002
263455              USING DP010I-NUMERIC-EDIT-AREA                      06822002
068300                                                                  06830000
068400         IF  NOT DP010I-ERROR-DETECTED                            06840000
068500             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N06850000
068600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06860000
068700                 IF  ASC-START-ITEM-REQUEST-N >                   06870000
068800                                          ASC-NUMBER-OF-ITEMS-READ06880000
068900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06890000
069000                     COMPUTE PV-TOP-ITEM =                        06900000
069100                             ASC-NUMBER-OF-ITEMS-READ             06910000
069200                             - PC-ITEMS-PER-PANEL + 1             06920000
069300                     IF  PV-TOP-ITEM < +1                         06930000
069400                         MOVE +1   TO PV-TOP-ITEM                 06940000
069500                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 06950000
069600                         SET DP020-MSG-INFORMATIONAL TO TRUE      06960000
069700                     END-IF                                       06970000
069800                 ELSE                                             06980000
069900                     MOVE ASC-START-ITEM-REQUEST-N                06990000
070000                                   TO PV-TOP-ITEM                 07000000
070100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07010000
070200                     COMPUTE PV-BOTTOM-ITEM =                     07020000
070300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07030000
070400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07040000
070500*                        -- BOTTOM OF LIST --                     07050000
070600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07060000
070700                         SET DP020-MSG-INFORMATIONAL TO TRUE      07070000
070800                     END-IF                                       07080000
070900                 END-IF                                           07090000
071000             ELSE                                                 07100000
071100*                --- VALUE OUT OF RANGE ----                      07110000
071200                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07120000
071300                 MOVE -1              TO ASTRTITL                 07130000
071400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07140000
071500                 MOVE DP015-REVERSE   TO ASTRTITH                 07150000
071600                 MOVE DP015-RED       TO ASTRTITC                 07160000
071700                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07170000
071800                 SET DP020-MSG-FATAL  TO TRUE                     07180000
071900                 SET PS-ERROR         TO TRUE                     07190000
072000             END-IF                                               07200000
072100         ELSE                                                     07210000
072200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07220000
072300             MOVE -1               TO ASTRTITL                    07230000
072400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07240000
072500             MOVE DP015-REVERSE    TO ASTRTITH                    07250000
072600             MOVE DP015-RED        TO ASTRTITC                    07260000
072700             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07270000
072800             SET DP020-MSG-FATAL   TO TRUE                        07280000
072900             SET PS-ERROR          TO TRUE                        07290000
073000         END-IF                                                   07300000
073100     END-IF.                                                      07310000
073200                                                                  07320000
073300*----------------------------------------------------------------*07330000
073400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07340000
073500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07350000
073600*----------------------------------------------------------------*07360000
073700 2140-DESELECT-ALL-ITEMS.                                         07370000
073800     MOVE +1                       TO ASC-BLK-SUB.                07380000
073900                                                                  07390000
074000     PERFORM 2141-CLEAR-SELECTED-INDS                             07400000
074100         VARYING ASC-ITEM-SUB                                     07410000
074200         FROM 1 BY 1                                              07420000
074300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07430000
074400                                                                  07440000
074500     ADD +1                        TO ASC-BLK-SUB.                07450000
074600                                                                  07460000
074700     PERFORM 2141-CLEAR-SELECTED-INDS                             07470000
074800         VARYING ASC-ITEM-SUB                                     07480000
074900         FROM 1 BY 1                                              07490000
075000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07500000
075100                                                                  07510000
075200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07520000
075300                                   TO PV-LIST-ITEM-NUMBER.        07530000
075400                                                                  07540000
075500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07550000
075600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07560000
075700                                                                  07570000
075800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07580000
075900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07590000
076000         MOVE +1                   TO ASC-BLK-SUB                 07600000
076100                                                                  07610000
076200         PERFORM 5100-WRITE-TEMP-STORAGE                          07620000
076300                                                                  07630000
076400         MOVE +1                   TO PV-BLOCK-NUMBER             07640000
076500                                                                  07650000
076600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07660000
076700             PV-FIRST-BLOCK-IN-ARRAY - 1                          07670000
076800                                                                  07680000
076900         PERFORM                                                  07690000
077000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07700000
077100                                                                  07710000
077200             PERFORM 4410-READ-TEMP-STORAGE                       07720000
077300                                                                  07730000
077400             PERFORM 2141-CLEAR-SELECTED-INDS                     07740000
077500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07750000
077600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07760000
077700                                                                  07770000
077800             PERFORM 5100-WRITE-TEMP-STORAGE                      07780000
077900                                                                  07790000
078000             ADD +1                TO PV-BLOCK-NUMBER             07800000
078100                                                                  07810000
078200         END-PERFORM                                              07820000
078300                                                                  07830000
078400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07840000
078500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07850000
078600                                                                  07860000
078700         PERFORM                                                  07870000
078800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07880000
078900                   ASC-HIGHEST-BLOCK-WRITTEN                      07890000
079000                                                                  07900000
079100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07910000
079200                                   TO PV-BLOCK-NUMBER             07920000
079300                                                                  07930000
079400             PERFORM 4410-READ-TEMP-STORAGE                       07940000
079500                                                                  07950000
079600             PERFORM 2141-CLEAR-SELECTED-INDS                     07960000
079700                 VARYING ASC-ITEM-SUB                             07970000
079800                 FROM 1 BY 1                                      07980000
079900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07990000
080000                                                                  08000000
080100             PERFORM 5100-WRITE-TEMP-STORAGE                      08010000
080200                                                                  08020000
080300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08030000
080400                                                                  08040000
080500         END-PERFORM                                              08050000
080600                                                                  08060000
080700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08070000
080800                                   TO PV-BLOCK-NUMBER             08080000
080900                                                                  08090000
081000         PERFORM 4410-READ-TEMP-STORAGE                           08100000
081100     END-IF.                                                      08110000
081200                                                                  08120000
081300                                                                  08130000
081400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08140000
081500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08150000
081600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08160000
081700                                                                  08170000
081800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08180000
081900                                                                  08190000
082000*----------------------------------------------------------------*08200000
082100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08210000
082200*----------------------------------------------------------------*08220000
082300 2141-CLEAR-SELECTED-INDS.                                        08230000
082400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08240000
082500             NOT EQUAL ZERO                                       08250000
082600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08260000
082700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08270000
082800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08280000
082900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08290000
083000                                   TO TRUE                        08300000
083100         END-IF                                                   08310000
083200     END-IF.                                                      08320000
083300                                                                  08330000
083400*----------------------------------------------------------------*08340000
083500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *08350000
083600*  FOR ALL ITEMS.                                                *08360000
083700*----------------------------------------------------------------*08370000
083800 2150-SELECT-ALL-ITEMS.                                           08380000
083900     MOVE +1                       TO ASC-BLK-SUB.                08390000
084000                                                                  08400000
084100     PERFORM 2151-SET-SELECTED-INDS                               08410000
084200         VARYING ASC-ITEM-SUB                                     08420000
084300         FROM 1 BY 1                                              08430000
084400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08440000
084500                                                                  08450000
084600     ADD +1                        TO ASC-BLK-SUB.                08460000
084700                                                                  08470000
084800     PERFORM 2151-SET-SELECTED-INDS                               08480000
084900         VARYING ASC-ITEM-SUB                                     08490000
085000         FROM 1 BY 1                                              08500000
085100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08510000
085200                                                                  08520000
085300     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      08530000
085400                                                                  08540000
085500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08550000
085600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08560000
085700                                                                  08570000
085800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08580000
085900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08590000
086000         MOVE +1                   TO ASC-BLK-SUB                 08600000
086100                                                                  08610000
086200         PERFORM 5100-WRITE-TEMP-STORAGE                          08620000
086300                                                                  08630000
086400         MOVE +1                   TO PV-BLOCK-NUMBER             08640000
086500                                                                  08650000
086600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08660000
086700             PV-FIRST-BLOCK-IN-ARRAY - 1                          08670000
086800                                                                  08680000
086900         PERFORM                                                  08690000
087000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08700000
087100                                                                  08710000
087200             PERFORM 4410-READ-TEMP-STORAGE                       08720000
087300                                                                  08730000
087400             PERFORM 2151-SET-SELECTED-INDS                       08740000
087500                 VARYING ASC-ITEM-SUB                             08750000
087600                 FROM 1 BY 1                                      08760000
087700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08770000
087800                                                                  08780000
087900             PERFORM 5100-WRITE-TEMP-STORAGE                      08790000
088000                                                                  08800000
088100             ADD +1                TO PV-BLOCK-NUMBER             08810000
088200                                                                  08820000
088300         END-PERFORM                                              08830000
088400                                                                  08840000
088500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08850000
088600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08860000
088700                                                                  08870000
088800         PERFORM                                                  08880000
088900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08890000
089000                   ASC-HIGHEST-BLOCK-WRITTEN                      08900000
089100                                                                  08910000
089200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08920000
089300                                   TO PV-BLOCK-NUMBER             08930000
089400                                                                  08940000
089500             PERFORM 4410-READ-TEMP-STORAGE                       08950000
089600                                                                  08960000
089700             PERFORM 2151-SET-SELECTED-INDS                       08970000
089800                 VARYING ASC-ITEM-SUB                             08980000
089900                 FROM 1 BY 1                                      08990000
090000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09000000
090100                                                                  09010000
090200             PERFORM 5100-WRITE-TEMP-STORAGE                      09020000
090300                                                                  09030000
090400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09040000
090500                                                                  09050000
090600         END-PERFORM                                              09060000
090700                                                                  09070000
090800         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         09080000
090900                                                                  09090000
091000         PERFORM 4410-READ-TEMP-STORAGE                           09100000
091100     END-IF.                                                      09110000
091200                                                                  09120000
091300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09130000
091400                       ASC-NUMBER-OF-SELECTED-ITEMS.              09140000
091500                                                                  09150000
091600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09160000
091700                                                                  09170000
091800*----------------------------------------------------------------*09180000
091900*    MARK EACH ITEM AS BEING SELECTED.                           *09190000
092000*----------------------------------------------------------------*09200000
092100 2151-SET-SELECTED-INDS.                                          09210000
092200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09220000
092300             NOT EQUAL ZERO                                       09230000
092400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09240000
092500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09250000
092600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09260000
092700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09270000
092800                               TO  TRUE                           09280000
092900         END-IF                                                   09290000
093000     END-IF.                                                      09300000
093100                                                                  09310000
093200******************************************************************09320000
093300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09330000
093400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09340000
093500******************************************************************09350000
093600 2200-MOVE-SCREEN-TO-COMMAREA.                                    09360000
093700                                                                  09370000
093800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09380000
093900     MOVE +1                       TO PV-SUB.                     09390000
094000*                                                                 09400000
094100     PERFORM 3100-SET-SUBSCRIPTS.                                 09410000
094200     IF  ASTRTITL > ZERO                                          09420000
094300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09430000
094400     ELSE                                                         09440000
094500         IF  ASTRTITF = DP015-ERASE-EOF                           09450000
094600             INITIALIZE ASC-START-ITEM-REQUEST                    09460000
094700         END-IF                                                   09470000
094800     END-IF.                                                      09480000
094900                                                                  09490000
095000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09500000
095100         VARYING PV-SUB                                           09510000
095200         FROM 1 BY 1                                              09520000
095300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09530000
095400                                                                  09540000
095500******************************************************************09550000
095600** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09560000
095700******************************************************************09570000
095800 2210-MOVE-LINES-TO-COMMAREA.                                     09580000
095900*    IF  MR-SELECTL (PV-SUB) > ZERO                               09590000
096000*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09600000
096100*        MOVE MR-SELECTI (PV-SUB)                                 09610000
096200*                                  TO ASC-TEMP-SELECTED-SW        09620000
096300*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      09630000
096400*    ELSE                                                         09640000
096500*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09650000
096600*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09660000
096700*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09670000
096800*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      09680000
096900*        END-IF                                                   09690000
097000*    END-IF.                                                      09700000
097100                                                                  09710000
097200     ADD +1                        TO ASC-ITEM-SUB.               09720000
097300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09730000
097400         ADD +1                    TO ASC-BLK-SUB                 09740000
097500         MOVE +1                   TO ASC-ITEM-SUB                09750000
097600     END-IF.                                                      09760000
097700                                                                  09770000
097800******************************************************************09780000
097900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09790000
098000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09800000
098100******************************************************************09810000
098200 3000-EDIT-DATA-IN-COMMAREA.                                      09820000
098300     SET PS-NO-ERROR               TO TRUE.                       09830000
098400     PERFORM 3200-RESET-ATTRIBUTES.                               09840000
098500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09850000
098600                                                                  09860000
098700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09870000
098800* EDITTING IS DONE FROM THE BOTTOM UP.                            09880000
098900**                                                                09890000
099000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09900000
099100         ASC-ITEMS-DISPLAYED - 1.                                 09910000
099200     PERFORM 3100-SET-SUBSCRIPTS.                                 09920000
099300                                                                  09930000
099400      IF  PS-NO-ERROR                                             09940000
099500          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       09950000
099600      END-IF.                                                     09960000
099700*                                                                 09970000
099800     IF  PS-NO-ERROR                                              09980000
099900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09990000
100000     END-IF.                                                      10000000
100100*                                                                 10010000
100200     IF  ((PS-NO-ERROR)                                           10020000
100300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10030000
100400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10040000
100500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10050000
100600     END-IF.                                                      10060000
100700                                                                  10070000
100800*----------------------------------------------------------------*10080000
100900* 3005-EDIT-COMMAREA-BLOCKS                                      *10090000
101000*----------------------------------------------------------------*10100000
101100 3005-EDIT-COMMAREA-BLOCKS.                                       10110000
101200     MOVE +1                       TO PV-BLOCK-NUMBER.            10120000
101300     MOVE +1                       TO ASC-BLK-SUB.                10130000
101400     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               10140000
101500                                                                  10150000
101600     COMPUTE PV-BLOCK-NUMBER  =                                   10160000
101700             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            10170000
101800             PC-ITEMS-PER-PANEL.                                  10180000
101900                                                                  10190000
102000     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          10200000
102100                                                                  10210000
102200     PERFORM                                                      10220000
102300        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         10230000
102400           OR PS-ERROR                                            10240000
102500           OR PS-BLOCK-ERROR                                      10250000
102600                                                                  10260000
102700              COMPUTE PV-ITEMS-HOLD  =                            10270000
102800                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       10280000
102900                      PC-ITEMS-PER-PANEL - 1                      10290000
103000                                                                  10300000
103100               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     10310000
103200                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             10320000
103300                       FROM  PV-ITEMS-HOLD                        10330000
103400                     GIVING  PV-ITEMS-DIFF                        10340000
103500                   SUBTRACT  PV-ITEMS-DIFF                        10350000
103600                       FROM  PC-ITEMS-PER-PANEL                   10360000
103700                     GIVING  PV-ITEMS-HOLD                        10370000
103800                       MOVE  PV-ITEMS-HOLD TO PV-SUB              10380000
103900                                              ASC-ITEM-SUB        10390000
104000                                              ASC-ITEMS-DISPLAYED 10400000
104100                                                                  10410000
104200               ELSE                                               10420000
104300                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            10430000
104400                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      10440000
104500               END-IF                                             10450000
104600                                                                  10460000
104700               PERFORM 3300-EDIT-SELECTIONS                       10470000
104800                       VARYING PV-SUB                             10480000
104900                          FROM PV-SUB BY -1                       10490000
105000                          UNTIL PV-SUB < +1                       10500000
105100                                                                  10510000
105200                                                                  10520000
105300               MOVE +1               TO ASC-BLK-SUB               10530000
105400                                                                  10540000
105500               PERFORM 5105-REWRITE-ASC-LISTQ                     10550000
105600                                                                  10560000
105700               MOVE +1                TO ASC-BLK-SUB              10570000
105800                                                                  10580000
105900               IF  PS-BLOCK-ERROR                                 10590000
106000                   SET  PS-ERROR     TO TRUE                      10600000
106100                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      10610000
106200                                     TO PV-TOP-ITEM               10620000
106300               ELSE                                               10630000
106400                   ADD  +1           TO PV-BLOCK-NUMBER           10640000
106500                   IF  PV-BLOCK-NUMBER >                          10650000
106600                       ASC-HIGHEST-BLOCK-WRITTEN                  10660000
106700                       MOVE +2       TO ASC-BLK-SUB               10670000
106800                       PERFORM 4410-READ-TEMP-STORAGE             10680000
106900                       MOVE +1       TO ASC-BLK-SUB               10690000
107000                   ELSE                                           10700000
107100                       PERFORM 4410-READ-TEMP-STORAGE             10710000
107200                       ADD  +1        TO PV-BLOCK-NUMBER          10720000
107300                       MOVE +2        TO ASC-BLK-SUB              10730000
107400                       PERFORM 4410-READ-TEMP-STORAGE             10740000
107500                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          10750000
107600                       MOVE +1        TO ASC-BLK-SUB              10760000
107700               END-IF                                             10770000
107800           END-IF                                                 10780000
107900     END-PERFORM.                                                 10790000
108000                                                                  10800000
108100     IF  PV-ORIGINAL-BLOCK  = +1    OR                            10810000
108200         PS-ERROR                   OR                            10820000
108300         PS-BLOCK-ERROR                                           10830000
108400             CONTINUE                                             10840000
108500     ELSE                                                         10850000
108600         MOVE +1                 TO PV-BLOCK-NUMBER               10860000
108700         MOVE +1                 TO ASC-BLK-SUB                   10870000
108800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  10880000
108900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           10890000
109000         PERFORM 4410-READ-TEMP-STORAGE                           10900000
109100                                                                  10910000
109200         PERFORM                                                  10920000
109300            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             10930000
109400               OR PS-ERROR                                        10940000
109500               OR PS-BLOCK-ERROR                                  10950000
109600                                                                  10960000
109700                  COMPUTE PV-ITEMS-HOLD  =                        10970000
109800                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   10980000
109900                          PC-ITEMS-PER-PANEL - 1                  10990000
110000                                                                  11000000
110100                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11010000
110200                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          11020000
110300                          FROM  PV-ITEMS-HOLD                     11030000
110400                        GIVING  PV-ITEMS-DIFF                     11040000
110500                      SUBTRACT  PV-ITEMS-DIFF                     11050000
110600                          FROM  PC-ITEMS-PER-PANEL                11060000
110700                        GIVING  PV-ITEMS-HOLD                     11070000
110800                          MOVE  PV-ITEMS-HOLD TO PV-SUB           11080000
110900                                                 ASC-ITEM-SUB     11090000
111000                                              ASC-ITEMS-DISPLAYED 11100000
111100                  ELSE                                            11110000
111200                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         11120000
111300                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   11130000
111400                  END-IF                                          11140000
111500                                                                  11150000
111600                  PERFORM 3300-EDIT-SELECTIONS                    11160000
111700                          VARYING PV-SUB                          11170000
111800                             FROM PV-SUB BY -1                    11180000
111900                            UNTIL PV-SUB < +1                     11190000
112000                                                                  11200000
112100                                                                  11210000
112200                  MOVE +1               TO ASC-BLK-SUB            11220000
112300                                                                  11230000
112400                  PERFORM 5105-REWRITE-ASC-LISTQ                  11240000
112500                                                                  11250000
112600                  MOVE +1                TO ASC-BLK-SUB           11260000
112700                                                                  11270000
112800                  IF  PS-BLOCK-ERROR                              11280000
112900                      SET  PS-ERROR     TO TRUE                   11290000
113000                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   11300000
113100                                        TO PV-TOP-ITEM            11310000
113200                  ELSE                                            11320000
113300                      ADD  +1            TO PV-BLOCK-NUMBER       11330000
113400                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     11340000
113500                          MOVE +2        TO ASC-BLK-SUB           11350000
113600                          PERFORM 4410-READ-TEMP-STORAGE          11360000
113700                          MOVE +1        TO ASC-BLK-SUB           11370000
113800                      ELSE                                        11380000
113900                          PERFORM 4410-READ-TEMP-STORAGE          11390000
114000                          ADD  +1        TO PV-BLOCK-NUMBER       11400000
114100                          MOVE +2        TO ASC-BLK-SUB           11410000
114200                          PERFORM 4410-READ-TEMP-STORAGE          11420000
114300                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       11430000
114400                          MOVE +1        TO ASC-BLK-SUB           11440000
114500                      END-IF                                      11450000
114600                  END-IF                                          11460000
114700     END-PERFORM.                                                 11470000
114800                                                                  11480000
114900*----------------------------------------------------------------*11490000
115000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11500000
115100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11510000
115200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11520000
115300*                                                                *11530000
115400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11540000
115500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11550000
115600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11560000
115700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11570000
115800*----------------------------------------------------------------*11580000
115900 3100-SET-SUBSCRIPTS.                                             11590000
116000     COMPUTE ASC-ITEM-SUB =                                       11600000
116100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11610000
116200                                                                  11620000
116300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11630000
116400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11640000
116500                                                                  11650000
116600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11660000
116700     ELSE                                                         11670000
116800         MOVE +1                     TO ASC-BLK-SUB               11680000
116900     END-IF.                                                      11690000
117000                                                                  11700000
117100******************************************************************11710000
117200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11720000
117300******************************************************************11730000
117400 3200-RESET-ATTRIBUTES.                                           11740000
117500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11750000
117600     MOVE DP015-GREEN              TO ASTRTITC.                   11760000
117700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11770000
117800*                                                                 11780000
117900*    PERFORM                                                      11790000
118000*        VARYING PV-SUB                                           11800000
118100*        FROM 1 BY 1                                              11810000
118200*        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11820000
118300*        MOVE DP015-UNP-ALP-NOR-OFF                               11830000
118400*                                  TO MR-SELECTA (PV-SUB)         11840000
118500*        MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11850000
118600*        MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11860000
118700*    END-PERFORM.                                                 11870000
118800                                                                  11880000
118900******************************************************************11890000
119000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11900000
119100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11910000
119200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11920000
119300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11930000
119400******************************************************************11940000
119500 3300-EDIT-SELECTIONS.                                            11950000
119600     EVALUATE TRUE                                                11960000
119700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11970000
119800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11980000
119900                 CONTINUE                                         11990000
120000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12000000
120100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12010000
120200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12020000
120300                 MOVE ASC-TEMP-SELECTED-SW                        12030000
120400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12040000
120500                                TO ASC-SELECTED-SW                12050000
120600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12060000
120700             END-IF                                               12070000
120800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12080000
120900                 = SPACE                                          12090000
121000             EVALUATE TRUE                                        12100000
121100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12110000
121200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12120000
121300                     MOVE SPACE TO ASC-SELECTED-SW                12130000
121400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12140000
121500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12150000
121600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12160000
121700                     MOVE SPACE TO ASC-SELECTED-SW                12170000
121800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12180000
121900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12190000
122000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12200000
122100                     MOVE SPACE TO ASC-SELECTED-SW                12210000
122200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12220000
122300             END-EVALUATE                                         12230000
122400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12240000
122500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12250000
122600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12260000
122700             END-IF                                               12270000
122800             PERFORM 3310-EDIT-RANGE                              12280000
122900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12290000
123000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12300000
123100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12310000
123200             END-IF                                               12320000
123300             PERFORM 3310-EDIT-RANGE                              12330000
123400         WHEN OTHER                                               12340000
123500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12350000
123600             SET DP020-MSG-FATAL    TO TRUE                       12360000
123700*            MOVE -1                TO MR-SELECTL (PV-SUB)        12370000
123800             MOVE -1                TO ASTRTITL                   12380000
123900             SET DP030-SET-CURSOR-APPL-1                          12390000
124000                                    TO TRUE                       12400000
124100*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12410000
124200*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12420000
124300             SET PS-ERROR TO TRUE                                 12430000
124400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12440000
124500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12450000
124600                 MOVE SPACE         TO ASC-SELECTED-SW            12460000
124700                                        (ASC-BLK-SUB ASC-ITEM-SUB)12470000
124800             END-IF                                               12480000
124900     END-EVALUATE.                                                12490000
125000                                                                  12500000
125100     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12510000
125200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12520000
125300     IF  ASC-ITEM-SUB < 1                                         12530000
125400         SUBTRACT +1 FROM ASC-BLK-SUB                             12540000
125500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12550000
125600     END-IF.                                                      12560000
125700                                                                  12570000
125800******************************************************************12580000
125900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12590000
126000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12600000
126100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12610000
126200** THE ENDING.                                                  **12620000
126300******************************************************************12630000
126400 3310-EDIT-RANGE.                                                 12640000
126500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12650000
126600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12660000
126700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12670000
126800                                   TO ASC-SELECTED-SW             12680000
126900                                        (ASC-BLK-SUB ASC-ITEM-SUB)12690000
127000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12700000
127100         ELSE                                                     12710000
127200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12720000
127300                 CONTINUE                                         12730000
127400             ELSE                                                 12740000
127500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12750000
127600                 MOVE PC-TSYMSG-00054                             12760000
127700                                   TO DP020-MSG-NUMBER            12770000
127800                 SET DP020-MSG-FATAL                              12780000
127900                                   TO TRUE                        12790000
128000*                MOVE -1           TO MR-SELECTL (PV-SUB)         12800000
128100                 MOVE -1           TO ASTRTITL                    12810000
128200                 SET DP030-SET-CURSOR-APPL-1                      12820000
128300                                   TO TRUE                        12830000
128400*                MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12840000
128500*                MOVE DP015-UNDERLINE                             12850000
128600*                                  TO MR-SELECTH (PV-SUB)         12860000
128700                 SET PS-ERROR      TO TRUE                        12870000
128800             END-IF                                               12880000
128900         END-IF                                                   12890000
129000     ELSE                                                         12900000
129100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12910000
129200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12920000
129300                                   TO ASC-SELECTED-SW             12930000
129400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12940000
129500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12950000
129600         ELSE                                                     12960000
129700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12970000
129800                 CONTINUE                                         12980000
129900             ELSE                                                 12990000
130000*                -- ONLY ONE END-OF-RANGE ALLOWED --              13000000
130100                 MOVE PC-TSYMSG-00055                             13010000
130200                                   TO DP020-MSG-NUMBER            13020000
130300                 SET DP020-MSG-FATAL                              13030000
130400                                   TO TRUE                        13040000
130500*                MOVE -1           TO MR-SELECTL (PV-SUB)         13050000
130600                 MOVE -1           TO ASTRTITL                    13060000
130700                 SET DP030-SET-CURSOR-APPL-1                      13070000
130800                                   TO TRUE                        13080000
130900                 SET PS-ERROR      TO TRUE                        13090000
131000             END-IF                                               13100000
131100         END-IF                                                   13110000
131200     END-IF.                                                      13120000
131300*                                                                 13130000
131400******************************************************************13140000
131500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13150000
131600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13160000
131700******************************************************************13170000
131800 3400-CHECK-RANGE-SEQUENCE.                                       13180000
131900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13190000
132000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13200000
132100       AND  ASC-START-OF-SELECTED-RANGE >                         13210000
132200                                         ASC-END-OF-SELECTED-RANGE13220000
132300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13230000
132400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13240000
132500         SET DP020-MSG-FATAL TO TRUE                              13250000
132600         SET PS-ERROR TO TRUE                                     13260000
132700         PERFORM 3410-POSITION-AT-ERROR                           13270000
132800     END-IF.                                                      13280000
132900                                                                  13290000
133000******************************************************************13300000
133100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13310000
133200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13320000
133300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13330000
133400******************************************************************13340000
133500 3410-POSITION-AT-ERROR.                                          13350000
133600     SET DP030-SET-CURSOR-APPL-1                                  13360000
133700                                   TO TRUE.                       13370000
133800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13380000
133900                    - PV-TOP-ITEM + 1.                            13390000
134000*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13400000
134100*        CONTINUE                                                 13410000
134200*    ELSE                                                         13420000
134300*        MOVE -1                   TO MR-SELECTL (PV-SUB)         13430000
134400*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13440000
134500*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13450000
134600*    END-IF.                                                      13460000
134700*                                                                 13470000
134800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13480000
134900                    - PV-TOP-ITEM + 1.                            13490000
135000*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13500000
135100*        CONTINUE                                                 13510000
135200*    ELSE                                                         13520000
135300*        MOVE -1                   TO MR-SELECTL (PV-SUB)         13530000
135400*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13540000
135500*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13550000
135600*    END-IF.                                                      13560000
135700                                                                  13570000
135800*----------------------------------------------------------------*13580000
135900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13590000
136000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13600000
136100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13610000
136200*----------------------------------------------------------------*13620000
136300 3500-MARK-RANGE-AS-SELECTED.                                     13630000
136400     MOVE +1                       TO  ASC-BLK-SUB.               13640000
136500     PERFORM 3510-MARK-SELECTED-INDS                              13650000
136600         VARYING ASC-ITEM-SUB                                     13660000
136700         FROM 1 BY 1                                              13670000
136800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13680000
136900                                                                  13690000
137000     ADD +1                        TO ASC-BLK-SUB.                13700000
137100     PERFORM 3510-MARK-SELECTED-INDS                              13710000
137200         VARYING ASC-ITEM-SUB                                     13720000
137300         FROM 1 BY 1                                              13730000
137400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13740000
137500                                                                  13750000
137600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13760000
137700                                   TO  PV-LIST-ITEM-NUMBER.       13770000
137800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13780000
137900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13790000
138000               PC-ITEMS-PER-PANEL).                               13800000
138100                                                                  13810000
138200     MOVE ASC-START-OF-SELECTED-RANGE                             13820000
138300                                   TO PV-START-OF-SELECTED-RANGE. 13830000
138400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13840000
138500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13850000
138600               PC-ITEMS-PER-PANEL).                               13860000
138700                                                                  13870000
138800     MOVE ASC-END-OF-SELECTED-RANGE                               13880000
138900                                   TO  PV-END-OF-SELECTED-RANGE.  13890000
139000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13900000
139100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13910000
139200               PC-ITEMS-PER-PANEL).                               13920000
139300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13930000
139400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13940000
139500                                                                  13950000
139600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13960000
139700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13970000
139800         MOVE +1                   TO ASC-BLK-SUB                 13980000
139900         PERFORM 5100-WRITE-TEMP-STORAGE                          13990000
140000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14000000
140100             PV-FIRST-BLOCK-IN-ARRAY - 1                          14010000
140200                                                                  14020000
140300         PERFORM                                                  14030000
140400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14040000
140500                   PV-PREV-BLOCK-IN-ARRAY                         14050000
140600             MOVE PV-FIRST-BLOCK-IN-RANGE                         14060000
140700                                   TO PV-BLOCK-NUMBER             14070000
140800             PERFORM 4410-READ-TEMP-STORAGE                       14080000
140900             PERFORM 3510-MARK-SELECTED-INDS                      14090000
141000                 VARYING ASC-ITEM-SUB                             14100000
141100                 FROM 1 BY 1                                      14110000
141200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14120000
141300             PERFORM 5100-WRITE-TEMP-STORAGE                      14130000
141400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14140000
141500         END-PERFORM                                              14150000
141600                                                                  14160000
141700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14170000
141800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14180000
141900         PERFORM                                                  14190000
142000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14200000
142100                   PV-LAST-BLOCK-IN-RANGE                         14210000
142200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14220000
142300                                   TO PV-BLOCK-NUMBER             14230000
142400             PERFORM 4410-READ-TEMP-STORAGE                       14240000
142500             PERFORM 3510-MARK-SELECTED-INDS                      14250000
142600                 VARYING ASC-ITEM-SUB                             14260000
142700                 FROM 1 BY 1                                      14270000
142800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14280000
142900             PERFORM 5100-WRITE-TEMP-STORAGE                      14290000
143000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14300000
143100         END-PERFORM                                              14310000
143200                                                                  14320000
143300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14330000
143400                                   TO PV-BLOCK-NUMBER             14340000
143500         PERFORM 4410-READ-TEMP-STORAGE                           14350000
143600     END-IF.                                                      14360000
143700                                                                  14370000
143800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14380000
143900                                      ASC-END-OF-SELECTED-RANGE.  14390000
144000                                                                  14400000
144100*----------------------------------------------------------------*14410000
144200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14420000
144300*----------------------------------------------------------------*14430000
144400 3510-MARK-SELECTED-INDS.                                         14440000
144500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14450000
144600                                ASC-ITEM-SUB) >                   14460000
144700         ASC-START-OF-SELECTED-RANGE)                             14470000
144800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14480000
144900                                ASC-ITEM-SUB) =                   14490000
145000         ASC-START-OF-SELECTED-RANGE)                             14500000
145100                                                                  14510000
145200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14520000
145300                                    ASC-ITEM-SUB) <               14530000
145400             ASC-END-OF-SELECTED-RANGE)                           14540000
145500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14550000
145600                                    ASC-ITEM-SUB) =               14560000
145700             ASC-END-OF-SELECTED-RANGE)                           14570000
145800                                                                  14580000
145900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14590000
146000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14600000
146100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14610000
146200                               TO TRUE                            14620000
146300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14630000
146400                               TO TRUE                            14640000
146500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14650000
146600             END-IF                                               14660000
146700         END-IF                                                   14670000
146800     END-IF.                                                      14680000
146900                                                                  14690000
147000*----------------------------------------------------------------*14700000
147100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14710000
147200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14720000
147300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14730000
147400*    DISPLAY THE PANEL TO USER.                                  *14740000
147500*----------------------------------------------------------------*14750000
147600 4000-BUILD-INITIAL-PANEL.                                        14760000
147700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14770000
147800                                 ASC-BLOCK-ENTRIES (2).           14780000
147900     MOVE +1                 TO ASC-BLK-SUB.                      14790000
148000     SET ASC-ITEMS-LEFT-ON-DB                                     14800000
148100                             TO TRUE.                             14810000
148200                                                                  14820000
148300     MOVE +0                 TO ASC-ITEM-SUB                      14830000
148400                                ASC-NUMBER-OF-ITEMS-READ          14840000
148500                                ASC-NUMBER-OF-SELECTED-ITEMS      14850000
148600                                ASC-HIGHEST-BLOCK-WRITTEN         14860000
148700                                ASC-START-OF-SELECTED-RANGE       14870000
148800                                ASC-END-OF-SELECTED-RANGE         14880000
148900                                ASC-ITEM-AT-TOP-OF-PANEL.         14890000
149000                                                                  14900000
149100     PERFORM 4010-OPEN-CURSOR.                                    14910000
149200                                                                  14920000
149300     PERFORM 4300-READ-ITEMS-FROM-DB.                             14930000
149400                                                                  14940000
149500     PERFORM 4020-CLOSE-CURSOR.                                   14950000
149600                                                                  14960000
149700     MOVE +1                   TO  PV-TOP-ITEM.                   14970000
149800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14980000
149900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14990000
150000         SET DP020-MSG-FATAL   TO  TRUE                           15000000
150100         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15010000
150200     ELSE                                                         15020000
150300*        MOVE -1               TO MR-SELECTL (1)                  15030000
150400         MOVE -1               TO ASTRTITL                        15040000
150500         SET DP030-SET-CURSOR-APPL-1                              15050000
150600                               TO TRUE                            15060000
150700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15070000
150800     END-IF.                                                      15080000
150900                                                                  15090000
151000*----------------------------------------------------------------*15100000
151100* OPEN THE CURSOR.                                               *15110000
151200*----------------------------------------------------------------*15120000
151300 4010-OPEN-CURSOR.                                                15130000
151400     PERFORM                                                      15140000
151500         WITH TEST AFTER                                          15150000
151600         VARYING PV-RETRY-COUNTER                                 15160000
151700         FROM 1 BY 1                                              15170000
151800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15180000
151900                   OR (SQLCODE = ZERO))                           15190000
152000                                                                  15200000
152100          EXEC SQL                                                15210000
152200               OPEN STOCK-TYPE-CSR                                15220000
152300          END-EXEC                                                15230000
152400                                                                  15240000
152500         EVALUATE TRUE                                            15250000
152600             WHEN SQLCODE = ZERO                                  15260000
152700             WHEN SQLCODE = -904                                  15270000
152800             WHEN SQLCODE = -913                                  15280000
152900                 CONTINUE                                         15290000
153000             WHEN SQLWARN0 NOT = SPACES                           15300000
153100             WHEN SQLCODE < ZERO                                  15310000
153200             WHEN SQLCODE > ZERO                                  15320000
153300                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       15330000
153400                 MOVE 'OPEN STOCK TYPE CURSOR - '                 15340000
153500                                   TO DP013-MESSAGE-TEXT (1)      15350000
153600                 MOVE SQLCA        TO DP013-SQLCA                 15360000
153700                 MOVE 'TSTKTYP '   TO DP013-DB2-TABLE-NAME (1)    15370000
153800                 SET DP013-DB2-ABEND                              15380000
153900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15390000
154000                 PERFORM DP013-0000-PROCESS-ABEND                 15400000
154100         END-EVALUATE                                             15410000
154200     END-PERFORM.                                                 15420000
154300*                                                                 15430000
154400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15440000
154500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15450000
154600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15460000
154700                                   TO DP013-MESSAGE-TEXT (1)      15470000
154800         MOVE SQLCA                TO DP013-SQLCA                 15480000
154900         MOVE 'TSTKTYP '           TO DP013-DB2-TABLE-NAME (1)    15490000
155000         SET DP013-DB2-ABEND                                      15500000
155100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15510000
155200         PERFORM DP013-0000-PROCESS-ABEND                         15520000
155300     END-IF.                                                      15530000
155400                                                                  15540000
155500*----------------------------------------------------------------*15550000
155600* CLOSE THE CURSOR                                               *15560000
155700*----------------------------------------------------------------*15570000
155800 4020-CLOSE-CURSOR.                                               15580000
155900      EXEC SQL                                                    15590000
156000           CLOSE STOCK-TYPE-CSR                                   15600000
156100      END-EXEC                                                    15610000
156200*                                                                 15620000
156300     EVALUATE TRUE                                                15630000
156400         WHEN SQLCODE = ZERO                                      15640000
156500             CONTINUE                                             15650000
156600         WHEN SQLWARN0 NOT = SPACES                               15660000
156700         WHEN SQLCODE < ZERO                                      15670000
156800         WHEN SQLCODE > ZERO                                      15680000
156900             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          15690000
157000             MOVE 'CLOSE STOCK TYPE CURSOR '                      15700000
157100                               TO DP013-MESSAGE-TEXT (1)          15710000
157200             MOVE SQLCA        TO DP013-SQLCA                     15720000
157300             MOVE 'TSTKTYP '   TO DP013-DB2-TABLE-NAME (1)        15730000
157400             SET DP013-DB2-ABEND                                  15740000
157500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15750000
157600             PERFORM DP013-0000-PROCESS-ABEND                     15760000
157700     END-EVALUATE.                                                15770000
157800                                                                  15780000
157900                                                                  15790000
158000*----------------------------------------------------------------*15800000
158100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15810000
158200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15820000
158300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15830000
158400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15840000
158500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15850000
158600*                                                                *15860000
158700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15870000
158800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15880000
158900*    UPON INITIALIZATION.                                        *15890000
159000*----------------------------------------------------------------*15900000
159100 4300-READ-ITEMS-FROM-DB.                                         15910000
159200     PERFORM                                                      15920000
159300         VARYING PV-READ-COUNT                                    15930000
159400         FROM 1 BY 1                                              15940000
159500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15950000
159600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15960000
159700                                                                  15970000
159800         PERFORM 4310-FETCH                                       15980000
159900                                                                  15990000
160000         IF  ASC-ITEMS-LEFT-ON-DB                                 16000000
160100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16010000
160200                 ADD +1            TO ASC-ITEM-SUB                16020000
160300             ELSE                                                 16030000
160400                 ADD +1            TO ASC-BLK-SUB                 16040000
160500                 MOVE +1           TO ASC-ITEM-SUB                16050000
160600                                                                  16060000
160700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16070000
160800                     MOVE +1       TO ASC-BLK-SUB                 16080000
160900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16090000
161000                     PERFORM 5100-WRITE-TEMP-STORAGE              16100000
161100                     MOVE ASC-BLOCK-ENTRIES                       16110000
161200                               (PC-MAX-BLOCKS-IN-ARRAY)           16120000
161300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16130000
161400                     ADD +1        TO ASC-BLK-SUB                 16140000
161500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16150000
161600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16160000
161700                                   TO TRUE                        16170000
161800                 END-IF                                           16180000
161900             END-IF                                               16190000
162000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16200000
162100             MOVE ASC-NUMBER-OF-ITEMS-READ                        16210000
162200                                   TO ASC-LIST-ITEM-NUMBER        16220000
162300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16230000
162400             MOVE SPACES           TO  ASC-ACTION                 16240000
162500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16250000
162600             MOVE STKTYP-STK-TYP-CDE                              16260000
162700                              TO  ASC-STK-TYP-CDE                 16270000
162800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16280000
162900             MOVE STKTYP-STK-TYP-DESC                             16290000
163000                              TO  ASC-STK-TYP-DESC                16300000
163100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16310000
163200         END-IF                                                   16320000
163300     END-PERFORM.                                                 16330000
163400                                                                  16340000
163500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16350000
163600         MOVE +1               TO ASC-BLK-SUB                     16360000
163700         PERFORM 5100-WRITE-TEMP-STORAGE                          16370000
163800         ADD +1                TO ASC-BLK-SUB                     16380000
163900         PERFORM 5100-WRITE-TEMP-STORAGE                          16390000
164000                                                                  16400000
164100         MOVE 1                TO ASC-BLK-SUB                     16410000
164200                                  PV-BLOCK-NUMBER                 16420000
164300         PERFORM 4410-READ-TEMP-STORAGE                           16430000
164400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16440000
164500             MOVE 2            TO ASC-BLK-SUB                     16450000
164600                                  PV-BLOCK-NUMBER                 16460000
164700             PERFORM 4410-READ-TEMP-STORAGE                       16470000
164800         END-IF                                                   16480000
164900     END-IF.                                                      16490000
165000                                                                  16500000
165100*----------------------------------------------------------------*16510000
165200*    FETCH THE STOCK TYPE LIST ITEMS                             *16520000
165300*----------------------------------------------------------------*16530000
165400                                                                  16540000
165500 4310-FETCH.                                                      16550000
165600       EXEC SQL                                                   16560000
165700            FETCH STOCK-TYPE-CSR                                  16570000
165800             INTO  :STKTYP-STK-TYP-CDE                            16580000
165900                 , :STKTYP-STK-TYP-DESC                           16590000
166000       END-EXEC                                                   16600000
166100                                                                  16610000
166200     EVALUATE TRUE                                                16620000
166300         WHEN SQLCODE = ZERO                                      16630000
166400         WHEN SQLCODE = +100                                      16640000
166500              CONTINUE                                            16650000
166600         WHEN SQLWARN0 NOT = SPACE                                16660000
166700         WHEN SQLCODE NOT = ZERO                                  16670000
166800              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         16680000
166900              MOVE 'FETCH MESSAGE CURSOR'                         16690000
167000                               TO DP013-MESSAGE-TEXT (1)          16700000
167100              MOVE SQLCA       TO DP013-SQLCA                     16710000
167200              SET DP013-DB2-ABEND TO TRUE                         16720000
167300              PERFORM DP013-0000-PROCESS-ABEND                    16730000
167400     END-EVALUATE.                                                16740000
167500                                                                  16750000
167600     IF  SQLCODE EQUAL +100                                       16760000
167700         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      16770000
167800     END-IF.                                                      16780000
167900                                                                  16790000
168000*----------------------------------------------------------------*16800000
168100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16810000
168200*----------------------------------------------------------------*16820000
168300 4400-MOVE-COMMAREA-TO-SCREEN.                                    16830000
168400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16840000
168500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16850000
168600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16860000
168700             MOVE +1    TO ASC-BLK-SUB                            16870000
168800             PERFORM 5100-WRITE-TEMP-STORAGE                      16880000
168900             ADD +1     TO ASC-BLK-SUB                            16890000
169000             PERFORM 5100-WRITE-TEMP-STORAGE                      16900000
169100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16910000
169200                 GIVING PV-BLOCK-NUMBER                           16920000
169300                 REMAINDER PV-REMAINDER                           16930000
169400             IF  PV-REMAINDER > ZERO                              16940000
169500                 ADD +1 TO PV-BLOCK-NUMBER                        16950000
169600             END-IF                                               16960000
169700             MOVE +1    TO ASC-BLK-SUB                            16970000
169800             PERFORM 4410-READ-TEMP-STORAGE                       16980000
169900             ADD +1     TO ASC-BLK-SUB                            16990000
170000                           PV-BLOCK-NUMBER                        17000000
170100             PERFORM 4410-READ-TEMP-STORAGE                       17010000
170200     END-IF.                                                      17020000
170300     MOVE +1            TO ASC-BLK-SUB.                           17030000
170400     COMPUTE ASC-ITEM-SUB =                                       17040000
170500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17050000
170600         + PC-ITEMS-PER-PANEL).                                   17060000
170700*                                                                 17070000
170800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17080000
170900         ADD +1         TO ASC-BLK-SUB                            17090000
171000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17100000
171100     END-IF.                                                      17110000
171200*                                                                 17120000
171300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17130000
171400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17140000
171500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17150000
171600     PERFORM 4420-FORMAT-LIST-LINES                               17160000
171700         VARYING PV-SUB                                           17170000
171800         FROM PC-ITEMS-PER-PANEL BY -1                            17180000
171900         UNTIL PV-SUB < +1.                                       17190000
172000*                                                                 17200000
172100     COMPUTE ASC-ITEMS-DISPLAYED =                                17210000
172200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17220000
172300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17230000
172400                                      ASTRTITO.                   17240000
172500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17250000
172600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17260000
172700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17270000
172800                                   TO ASELITO.                    17280000
172900                                                                  17290000
173000     IF  DP020-MSG-NUMBER-X = SPACE                               17300000
173100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17310000
173200*            --- MORE ITEMS TO DISPLAY ----                       17320000
173300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17330000
173400             SET DP020-MSG-INFORMATIONAL TO TRUE                  17340000
173500         END-IF                                                   17350000
173600     END-IF.                                                      17360000
173700                                                                  17370000
173800*----------------------------------------------------------------*17380000
173900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17390000
174000*----------------------------------------------------------------*17400000
174100 4410-READ-TEMP-STORAGE.                                          17410000
174200     EXEC CICS                                                    17420000
174300         READQ TS                                                 17430000
174400             QUEUE (ASC-LIST-QUEUE-NAME)                          17440000
174500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17450000
174600             ITEM  (PV-BLOCK-NUMBER)                              17460000
174700             RESP  (PV-CICS-RESP)                                 17470000
174800     END-EXEC.                                                    17480000
174900                                                                  17490000
175000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17500000
175100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17510000
175200         CONTINUE                                                 17520000
175300     ELSE                                                         17530000
175400         SET DP013-CICS-ABEND     TO TRUE                         17540000
175500         SET DP013-NO-ROLLBACK    TO TRUE                         17550000
175600         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         17560000
175700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17570000
175800                                  TO DP013-MESSAGE-TEXT(1)        17580000
175900         PERFORM DP013-0000-PROCESS-ABEND                         17590000
176000     END-IF.                                                      17600000
176100                                                                  17610000
176200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17620000
176300*                                                                 17630000
176400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17640000
176500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17650000
176600     END-IF.                                                      17660000
176700                                                                  17670000
176800*----------------------------------------------------------------*17680000
176900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17690000
177000*----------------------------------------------------------------*17700000
177100 4420-FORMAT-LIST-LINES.                                          17710000
177200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17720000
177300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17730000
177400*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17740000
177500*        MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17750000
177600*        MOVE SPACE              TO MR-SELECTI (PV-SUB)           17760000
177700*                                   MR-ACTION (PV-SUB)            17770000
177800         MOVE SPACE TO              MR-STK-TYP-CDE (PV-SUB)       17780000
177900                                    MR-STK-TYP-DESC (PV-SUB)      17790000
178000     ELSE                                                         17800000
178100*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17810000
178200*                                                  > SPACE        17820000
178300*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17830000
178400*                                TO MR-SELECTI (PV-SUB)           17840000
178500*        ELSE                                                     17850000
178600*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17860000
178700*                                TO MR-SELECTI (PV-SUB)           17870000
178800*        END-IF                                                   17880000
178900*                                                                 17890000
179000         IF  DP030-SET-CURSOR-TRAILER                             17900000
179100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)17910000
179200                 > SPACE)                                         17920000
179300               OR (PV-SUB = 1))                                   17930000
179400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               17940000
179500*               MOVE -1          TO MR-SELECTL (PV-SUB)           17950000
179600                MOVE -1          TO ASTRTITL                      17960000
179700             END-IF                                               17970000
179800         END-IF                                                   17980000
179900*                                                                 17990000
180000*        MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               18000000
180100*                                TO MR-ACTION (PV-SUB)            18010000
180200         MOVE ASC-STK-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)          18020000
180300                                 TO MR-STK-TYP-CDE (PV-SUB)       18030000
180400         MOVE ASC-STK-TYP-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         18040000
180500                                 TO MR-STK-TYP-DESC (PV-SUB)      18050000
180600     END-IF.                                                      18060000
180700     SUBTRACT +1 FROM ASC-ITEM-SUB                                18070000
180800     IF  ASC-ITEM-SUB < + 1                                       18080000
180900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18090000
181000         MOVE +1                 TO ASC-BLK-SUB                   18100000
181100     END-IF.                                                      18110000
181200                                                                  18120000
181300******************************************************************18130000
181400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18140000
181500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18150000
181600** ISSUE A WARNING.                                             **18160000
181700******************************************************************18170000
181800 4430-CHECK-FOR-BEGIN-AND-END.                                    18180000
181900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18190000
182000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18200000
182100*            -- NO END-OF-RANGE SPECFIED ---                      18210000
182200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18220000
182300             SET DP020-MSG-WARNING TO TRUE                        18230000
182400             PERFORM 4431-POSITION-AT-WARNING                     18240000
182500         END-IF                                                   18250000
182600     ELSE                                                         18260000
182700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18270000
182800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18280000
182900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18290000
183000             SET DP020-MSG-WARNING TO TRUE                        18300000
183100             PERFORM 4431-POSITION-AT-WARNING                     18310000
183200         END-IF                                                   18320000
183300     END-IF.                                                      18330000
183400                                                                  18340000
183500******************************************************************18350000
183600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18360000
183700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18370000
183800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18380000
183900** POSITION THE CURSOR THERE.                                   **18390000
184000******************************************************************18400000
184100 4431-POSITION-AT-WARNING.                                        18410000
184200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18420000
184300                    - PV-TOP-ITEM + 1.                            18430000
184400*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18440000
184500*        CONTINUE                                                 18450000
184600*    ELSE                                                         18460000
184700*        SET DP030-SET-CURSOR-APPL-1                              18470000
184800*                                  TO TRUE                        18480000
184900*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18490000
185000*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18500000
185100*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18510000
185200*    END-IF.                                                      18520000
185300*                                                                 18530000
185400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18540000
185500                    - PV-TOP-ITEM + 1.                            18550000
185600*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18560000
185700*        CONTINUE                                                 18570000
185800*    ELSE                                                         18580000
185900*        SET DP030-SET-CURSOR-APPL-1                              18590000
186000*                                  TO TRUE                        18600000
186100*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18610000
186200*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18620000
186300*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18630000
186400*    END-IF.                                                      18640000
186500                                                                  18650000
186600*----------------------------------------------------------------*18660000
186700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18670000
186800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18680000
186900* FOR THE SELECTED ITEMS QUEUE.                                  *18690000
187000*                                                                *18700000
187100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18710000
187200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18720000
187300* THE ARRAY IS FULL.                                             *18730000
187400*----------------------------------------------------------------*18740000
187500 5000-PREPARE-SEL-QUEUE.                                          18750000
187600     MOVE +1                   TO  ASC-BLK-SUB.                   18760000
187700     PERFORM 5100-WRITE-TEMP-STORAGE.                             18770000
187800     ADD +1                    TO  ASC-BLK-SUB.                   18780000
187900     PERFORM 5100-WRITE-TEMP-STORAGE.                             18790000
188000                                                                  18800000
188100     MOVE ASC-SEL-QUEUE-NAME   TO  CN162-SEL-QUEUE-NAME.          18810001
188200     PERFORM 6010-DELETE-SEL-QUEUE.                               18820000
188300                                                                  18830000
188400     SET ASC-UPDATE-TSQ        TO  TRUE.                          18840000
188500                                                                  18850000
188600     SET CN163-IDX             TO  1.                             18860001
188700     MOVE ZERO                 TO CN162-NUMBER-OF-TS-ITEMS.       18870001
188800     INITIALIZE CN163-SELECTED-ITEM-ARRAY.                        18880001
188900                                                                  18890000
189000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18900000
189100             VARYING PV-ITEM                                      18910000
189200             FROM 1 BY 1                                          18920000
189300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18930000
189400                                                                  18940000
189500     IF  CN163-IDX > 1                                            18950001
189600         PERFORM 5205-WRITE-SEL-QUEUE                             18960000
189700         ADD +1                TO CN162-NUMBER-OF-TS-ITEMS        18970001
189800     END-IF.                                                      18980000
189900                                                                  18990000
190000*----------------------------------------------------------------*19000000
190100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19010000
190200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19020000
190300*----------------------------------------------------------------*19030000
190400 5100-WRITE-TEMP-STORAGE.                                         19040000
190500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19050000
190600                                   TO PV-LIST-ITEM-NUMBER.        19060000
190700     COMPUTE PV-BLOCK-NUMBER =                                    19070000
190800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19080000
190900                                                                  19090000
191000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19100000
191100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19110000
191200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19120000
191300             PERFORM 5105-REWRITE-ASC-LISTQ                       19130000
191400         END-IF                                                   19140000
191500     ELSE                                                         19150000
191600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19160000
191700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19170000
191800         PERFORM 5110-WRITE-ASC-LISTQ                             19180000
191900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19190000
192000     END-IF.                                                      19200000
192100                                                                  19210000
192200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19220000
192300                                                                  19230000
192400******************************************************************19240000
192500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19250000
192600** SPECIFIC COMMAREA.                                           **19260000
192700******************************************************************19270000
192800 5105-REWRITE-ASC-LISTQ.                                          19280000
192900     EXEC CICS                                                    19290000
193000         WRITEQ TS                                                19300000
193100             QUEUE (ASC-LIST-QUEUE-NAME)                          19310000
193200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19320000
193300             ITEM  (PV-BLOCK-NUMBER)                              19330000
193400             REWRITE                                              19340000
193500             RESP  (PV-CICS-RESP)                                 19350000
193600     END-EXEC.                                                    19360000
193700                                                                  19370000
193800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19380000
193900         CONTINUE                                                 19390000
194000     ELSE                                                         19400000
194100         SET DP013-CICS-ABEND            TO TRUE                  19410000
194200         SET DP013-NO-ROLLBACK           TO TRUE                  19420000
194300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19430000
194400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19440000
194500                                         TO DP013-MESSAGE-TEXT(1) 19450000
194600         PERFORM DP013-0000-PROCESS-ABEND                         19460000
194700     END-IF.                                                      19470000
194800                                                                  19480000
194900******************************************************************19490000
195000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19500000
195100** SPECIFIC COMMAREA.                                           **19510000
195200******************************************************************19520000
195300 5110-WRITE-ASC-LISTQ.                                            19530000
195400     EXEC CICS                                                    19540000
195500         WRITEQ TS                                                19550000
195600             QUEUE (ASC-LIST-QUEUE-NAME)                          19560000
195700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19570000
195800             ITEM  (PV-BLOCK-NUMBER)                              19580000
195900             RESP  (PV-CICS-RESP)                                 19590000
196000     END-EXEC.                                                    19600000
196100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19610000
196200         SET DP013-CICS-ABEND      TO TRUE                        19620000
196300         SET DP013-NO-ROLLBACK     TO TRUE                        19630000
196400         MOVE '5110-WRITE-ASC-LISTQ'                              19640000
196500                                   TO DP013-PARAGRAPH             19650000
196600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19660000
196700                                   TO DP013-MESSAGE-TEXT(1)       19670000
196800         PERFORM DP013-0000-PROCESS-ABEND                         19680000
196900     END-IF.                                                      19690000
197000                                                                  19700000
197100*----------------------------------------------------------------*19710000
197200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19720000
197300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19730000
197400*----------------------------------------------------------------*19740000
197500 5200-FILL-SEL-QUEUE-RECORD.                                      19750000
197600     PERFORM 6112-READ-LIST-QUEUE.                                19760000
197700                                                                  19770000
197800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19780000
197900         PERFORM                                                  19790000
198000         VARYING LQW-IDX                                          19800000
198100         FROM 1 BY 1                                              19810000
198200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19820000
198300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19830000
198400                                                                  19840000
198500             IF  LQW-SELECT (LQW-IDX)                             19850000
198600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              19860000
198700                                  TO CN163-ITEM (CN163-IDX)       19870001
198800                 MOVE SPACE       TO CN163-ACTION-SW (CN163-IDX)  19880001
198900                                                                  19890000
199000                 MOVE LQW-STK-TYP-CDE (LQW-IDX)                   19900000
199100                                  TO CN163-STK-TYP-CDE            19910001
199200                                      (CN163-IDX)                 19920001
199300                 MOVE LQW-STK-TYP-DESC (LQW-IDX)                  19930000
199400                                  TO  CN163-STK-TYP-DESC          19940001
199500                                       (CN163-IDX)                19950001
199600                                                                  19960000
199700                 SET CN163-IDX UP BY 1                            19970001
199800                 IF  CN163-IDX > CN163-MAX-ITEMS                  19980001
199900                     PERFORM 5205-WRITE-SEL-QUEUE                 19990000
200000                     ADD +1        TO CN162-NUMBER-OF-TS-ITEMS    20000001
200100                     INITIALIZE CN163-SELECTED-ITEM-ARRAY         20010001
200200                     SET CN163-IDX TO  1                          20020001
200300                 END-IF                                           20030000
200400             END-IF                                               20040000
200500         END-PERFORM                                              20050000
200600     END-IF.                                                      20060000
200700                                                                  20070000
200800*----------------------------------------------------------------*20080000
200900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20090000
201000*----------------------------------------------------------------*20100000
201100 5205-WRITE-SEL-QUEUE.                                            20110000
201200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN163-SELECTED-ITEMS.   20120001
201300                                                                  20130000
201400     EXEC CICS                                                    20140000
201500          WRITEQ TS                                               20150000
201600              QUEUE (ASC-SEL-QUEUE-NAME)                          20160000
201700              FROM  (CN163-SELECT-RECORD)                         20170001
201800              ITEM  (PV-SEL-QUEUE-ITEM)                           20180000
201900              RESP  (PV-CICS-RESP)                                20190000
202000     END-EXEC.                                                    20200000
202100                                                                  20210000
202200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20220000
202300         CONTINUE                                                 20230000
202400     ELSE                                                         20240000
202500         SET DP013-CICS-ABEND      TO TRUE                        20250000
202600         SET DP013-NO-ROLLBACK     TO TRUE                        20260000
202700         MOVE '5205-WRITE-SEL-QUEUE'                              20270000
202800                                   TO DP013-PARAGRAPH             20280000
202900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20290000
203000                                   TO DP013-MESSAGE-TEXT(1)       20300000
203100         PERFORM DP013-0000-PROCESS-ABEND                         20310000
203200     END-IF.                                                      20320000
203300                                                                  20330000
203400******************************************************************20340000
203500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20350000
203600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20360000
203700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20370000
203800** THE USER.                                                    **20380000
203900******************************************************************20390000
204000 6000-REFRESH-PANEL-FROM-TEMP.                                    20400000
204100     IF  ASC-UPDATE-TSQ                                           20410000
204200         SET ASC-NO-TSQ-UPDATE TO TRUE                            20420000
204300         MOVE ZERO                 TO PV-SAVE-ITEM                20430000
204400                                      PV-SEL-QUEUE-ITEM           20440000
204500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20450000
204600                                   TO PV-HOLD-SELECTED-ITEMS      20460000
204700         MOVE +1                   TO PV-ITEMS-PROCESSED          20470000
204800         PERFORM 6100-UPDATE-TSQ                                  20480000
204900             UNTIL PV-ITEMS-PROCESSED >                           20490000
205000                                     PV-HOLD-SELECTED-ITEMS       20500000
205100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20510000
205200                    ASC-BLOCK-ENTRIES (2)                         20520000
205300     END-IF.                                                      20530000
205400                                                                  20540000
205500*----------------------------------------------------------------*20550000
205600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20560000
205700*----------------------------------------------------------------*20570000
205800 6010-DELETE-SEL-QUEUE.                                           20580000
205900                                                                  20590000
206000     EXEC CICS                                                    20600000
206100         DELETEQ TS                                               20610000
206200             QUEUE (ASC-SEL-QUEUE-NAME)                           20620000
206300             RESP  (PV-CICS-RESP)                                 20630000
206400     END-EXEC.                                                    20640000
206500*                                                                 20650000
206600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20660000
206700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20670000
206800         CONTINUE                                                 20680000
206900     ELSE                                                         20690000
207000         SET DP013-CICS-ABEND TO TRUE                             20700000
207100         SET DP013-NO-ROLLBACK TO TRUE                            20710000
207200         MOVE '6010-DELETE-SEL-QUEUE'                             20720000
207300                        TO DP013-PARAGRAPH                        20730000
207400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20740000
207500                        TO DP013-MESSAGE-TEXT (1)                 20750000
207600         PERFORM DP013-0000-PROCESS-ABEND                         20760000
207700     END-IF.                                                      20770000
207800                                                                  20780000
207900*----------------------------------------------------------------*20790000
208000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20800000
208100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20810000
208200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20820000
208300*    THE TEMP QUEUE.                                             *20830000
208400*----------------------------------------------------------------*20840000
208500 6100-UPDATE-TSQ.                                                 20850000
208600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             20860000
208700     PERFORM 6105-READ-SEL-QUEUE.                                 20870000
208800     PERFORM                                                      20880000
208900         VARYING CN163-IDX                                        20890001
209000         FROM 1 BY 1                                              20900000
209100         UNTIL ((PV-ITEMS-PROCESSED >                             20910000
209200                              PV-HOLD-SELECTED-ITEMS)             20920000
209300         OR (CN163-IDX GREATER THAN CN163-MAX-ITEMS))             20930001
209400         IF  CN163-ACTION-SW (CN163-IDX) > SPACE                  20940001
209500             PERFORM 6110-PROCESS-ITEMS                           20950000
209600         END-IF                                                   20960000
209700         ADD +1                TO PV-ITEMS-PROCESSED              20970000
209800     END-PERFORM.                                                 20980000
209900     PERFORM 6111-WRITE-LIST-QUEUE.                               20990000
210000                                                                  21000000
210100*----------------------------------------------------------------*21010000
210200*    READ THE LIST QUEUE RECORD.                                 *21020000
210300*----------------------------------------------------------------*21030000
210400 6105-READ-SEL-QUEUE.                                             21040000
210500                                                                  21050000
210600     EXEC CICS                                                    21060000
210700          READQ TS                                                21070000
210800              QUEUE (ASC-SEL-QUEUE-NAME)                          21080000
210900              INTO  (CN163-SELECT-RECORD)                         21090001
211000              ITEM  (PV-SEL-QUEUE-ITEM)                           21100000
211100              RESP  (PV-CICS-RESP)                                21110000
211200     END-EXEC.                                                    21120000
211300*                                                                 21130000
211400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21140000
211500         CONTINUE                                                 21150000
211600     ELSE                                                         21160000
211700         SET DP013-CICS-ABEND      TO  TRUE                       21170000
211800         SET DP013-NO-ROLLBACK     TO  TRUE                       21180000
211900         MOVE '6105-READ-SEL-QUEUE'                               21190000
212000                                   TO  DP013-PARAGRAPH            21200000
212100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21210000
212200                                   TO  DP013-MESSAGE-TEXT(1)      21220000
212300         PERFORM DP013-0000-PROCESS-ABEND                         21230000
212400     END-IF.                                                      21240000
212500                                                                  21250000
212600*----------------------------------------------------------------*21260000
212700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21270000
212800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21280000
212900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21290000
213000*----------------------------------------------------------------*21300000
213100 6110-PROCESS-ITEMS.                                              21310000
213200                                                                  21320000
213300     COMPUTE PV-ITEM = 1 + ((CN163-ITEM (CN163-IDX) - 1)          21330001
213400                     / PC-ITEMS-PER-PANEL).                       21340000
213500                                                                  21350000
213600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21360000
213700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21370000
213800             PERFORM 6111-WRITE-LIST-QUEUE                        21380000
213900         END-IF                                                   21390000
214000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21400000
214100                                                                  21410000
214200         PERFORM 6112-READ-LIST-QUEUE                             21420000
214300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21430000
214400             CONTINUE                                             21440000
214500         END-IF                                                   21450000
214600     END-IF.                                                      21460000
214700                                                                  21470000
214800     COMPUTE PV-SUB = (CN163-ITEM (CN163-IDX)                     21480001
214900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21490000
215000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21500000
215100     MOVE LQW-SELECTED-SW (PV-SUB)                                21510000
215200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21520000
215300     EVALUATE TRUE                                                21530000
215400         WHEN CN163-INQ (CN163-IDX)                               21540001
215500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             21550000
215600                                                                  21560000
215700         WHEN CN163-UPD (CN163-IDX)                               21570001
215800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             21580000
215900                                                                  21590000
216000         WHEN CN163-DEL (CN163-IDX)                               21600001
216100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21610000
216200                                                                  21620000
216300         WHEN CN163-ERR (CN163-IDX)                               21630001
216400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21640000
216500     END-EVALUATE.                                                21650000
216600                                                                  21660000
216700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21670000
216800                                                                  21680000
216900*----------------------------------------------------------------*21690000
217000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21700000
217100*----------------------------------------------------------------*21710000
217200 6111-WRITE-LIST-QUEUE.                                           21720000
217300     EXEC CICS                                                    21730000
217400         WRITEQ TS                                                21740000
217500             QUEUE (ASC-LIST-QUEUE-NAME)                          21750000
217600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21760000
217700             ITEM  (PV-SAVE-ITEM)                                 21770000
217800             REWRITE                                              21780000
217900             RESP  (PV-CICS-RESP)                                 21790000
218000     END-EXEC.                                                    21800000
218100*                                                                 21810000
218200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21820000
218300         CONTINUE                                                 21830000
218400     ELSE                                                         21840000
218500         SET DP013-CICS-ABEND  TO  TRUE                           21850000
218600         SET DP013-NO-ROLLBACK TO  TRUE                           21860000
218700         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         21870000
218800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21880000
218900                               TO  DP013-MESSAGE-TEXT(1)          21890000
219000         PERFORM DP013-0000-PROCESS-ABEND                         21900000
219100     END-IF.                                                      21910000
219200                                                                  21920000
219300*----------------------------------------------------------------*21930000
219400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*21940000
219500*----------------------------------------------------------------*21950000
219600 6112-READ-LIST-QUEUE.                                            21960000
219700     EXEC CICS                                                    21970000
219800         READQ TS                                                 21980000
219900             QUEUE (ASC-LIST-QUEUE-NAME)                          21990000
220000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22000000
220100             ITEM  (PV-ITEM)                                      22010000
220200             RESP  (PV-CICS-RESP)                                 22020000
220300     END-EXEC.                                                    22030000
220400*                                                                 22040000
220500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22050000
220600         CONTINUE                                                 22060000
220700     ELSE                                                         22070000
220800         SET DP013-CICS-ABEND        TO TRUE                      22080000
220900         SET DP013-NO-ROLLBACK       TO TRUE                      22090000
221000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22100000
221100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22110000
221200                                     TO DP013-MESSAGE-TEXT(1)     22120000
221300         PERFORM DP013-0000-PROCESS-ABEND                         22130000
221400     END-IF.                                                      22140000
221500                                                                  22150000
221600                                                                  22160000
221700*----------------------------------------------------------------*22170000
221800*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *22180000
221900*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *22190000
222000*----------------------------------------------------------------*22200000
222100 9900-SOFT-ABORT.                                                 22210000
222200     EXEC CICS SYNCPOINT                                          22220000
222300          ROLLBACK                                                22230000
222400     END-EXEC.                                                    22240000
222500                                                                  22250000
222600     SET  PS-ERROR                                                22260000
222700          PS-SOFT-ABORT-ERROR                                     22270000
222800          DP020-MSG-FATAL       TO  TRUE.                         22280000
222900                                                                  22290000
223000*----------------------------------------------------------------*22300000
223100*    ABEND PROCESSOR MODULE                                      *22310000
223200*----------------------------------------------------------------*22320000
223300     COPY DPPD013.                                                22330000
