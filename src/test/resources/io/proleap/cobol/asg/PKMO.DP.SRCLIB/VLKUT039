000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.             VLKUT039.                                00030015
000400 AUTHOR.                 DAN HINTZ.                               00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           MARCH 2005.                              00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*                                                                 00090000
001000*  PROGRAM NARRATIVE:                                             00100000
001010*                                                                 00110066
001100*  THIS PROGRAM WILL CREATE TWO FILES OF ASN DATA.  ONE FILE WILL 00120000
001200*  CONTAIN ASN HEADER DATA.  THE OTHER FILE WILL CONTAIN ASN      00130000
001210*  DETAIL DATA.                                                   00140067
001220*                                                                 00150067
001400*                                                                 00160000
ST3504***************************************************************** 00170097
ST3504* CHANGE LOG:                                                     00180097
ST3504*                                                                 00190097
ST3504* DATE  12/01/2023                                                00200097
ST3504*    CHANGE MADE:BUSINESS HAS REQUESTED TO INCLUDE SCAC CODE      00210097
ST3504*    VALUE IN THE FILE THAT WE SEND TO TRAVERSE SYSTEM.           00220097
ST3504*    HENCE MOVING THE ACTUAL CARR_ID_CDE(SCAC) VALUE FROM TASNHDR 00230097
ST3504*    TO VL040-SCAC INSTEAD OF SPACES.                             00240097
ST3504*                                                                 00250097
ST3504*    CODING TAG: ST3504                                           00251097
ST3504*    MADE BY: SARVESWARAN KANNAN      WR/IR #: CHG0297605         00260098
ST3504***************************************************************** 00270097
001500 ENVIRONMENT DIVISION.                                            00280067
001600                                                                  00290067
001700 CONFIGURATION SECTION.                                           00300067
001800                                                                  00310067
001900 SOURCE-COMPUTER.                        IBM-3090.                00320067
002000 OBJECT-COMPUTER.                        IBM-3090.                00330067
002100                                                                  00340067
002200 INPUT-OUTPUT SECTION.                                            00350067
002300                                                                  00360067
002400 FILE-CONTROL.                                                    00370067
002500                                                                  00380067
002600     SELECT  VL-ASN-EXT-FILE                                      00390067
002700         ASSIGN TO INP01.                                         00400067
002800                                                                  00410087
002801     SELECT  VL-ASN-HDR-FILE                                      00420088
002802         ASSIGN TO OUT01.                                         00430088
002803                                                                  00440088
002804     SELECT  VL-ASN-DTL-FILE                                      00450088
002805         ASSIGN TO OUT02.                                         00460088
002806                                                                  00470088
002807     SELECT  VL-MARKER-FILE                                       00480088
002808         ASSIGN TO OUT03.                                         00490088
002809                                                                  00500088
002810******************************************************************00510088
002820 DATA DIVISION.                                                   00520067
002830******************************************************************00530067
002840                                                                  00540067
002850 FILE SECTION.                                                    00550067
002860*                                                                 00560067
002870 FD  VL-ASN-EXT-FILE                                              00570067
002880     RECORDING MODE IS F                                          00580067
002890     LABEL RECORDS ARE STANDARD                                   00590067
002900     BLOCK CONTAINS 0 RECORDS.                                    00600067
003000 01  VL-ASN-EXT-RECORD                PIC  X(225).                00610088
003100*                                                                 00620067
003200*                                                                 00630067
003300 FD  VL-ASN-HDR-FILE                                              00640067
003400     RECORDING MODE IS F                                          00650067
003500     LABEL RECORDS ARE STANDARD                                   00660067
003600     BLOCK CONTAINS 0 RECORDS.                                    00670067
003700 01  VL-ASN-HDR-RECORD                PIC  X(243).                00680088
003800*                                                                 00690067
003900*                                                                 00700067
004000 FD  VL-ASN-DTL-FILE                                              00710067
004100     RECORDING MODE IS F                                          00720067
004110     LABEL RECORDS ARE STANDARD                                   00730067
004120     BLOCK CONTAINS 0 RECORDS.                                    00740067
004130 01  VL-ASN-DTL-RECORD                PIC  X(205).                00750067
004140*                                                                 00760067
004150 FD  VL-MARKER-FILE                                               00770067
004160     RECORDING MODE IS F                                          00780067
004161     LABEL RECORDS ARE STANDARD                                   00790067
004162     BLOCK CONTAINS 0 RECORDS.                                    00800067
004163 01  VL-MARKER-RECORD                 PIC  X(078).                00810067
004164*                                                                 00820067
004165*                                                                 00830067
004166 WORKING-STORAGE SECTION.                                         00840067
004167***************************************************************** 00850067
004168*    CONTROL CARD INPUT                                           00860067
004169***************************************************************** 00870067
004170 01  CC-DATECARD.                                                 00880067
004180     05  CC-ASN-EXTRACT-RUN-DATE      PIC  X(08) VALUE SPACES.    00890067
004190                                                                  00900067
004200***************************************************************** 00910067
004300*    PROGRAM CONSTANTS                                            00920067
004400***************************************************************** 00930067
004500 01  PC-CONSTANTS.                                                00940067
004600     05  PC-CURRENT-PGM-VLKUT039      PIC  X(08) VALUE 'VLKUT039'.00950067
004700     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00960067
004800                                                 COMP SYNC.       00970067
004900***************************************************************** 00980067
005000*    PROGRAM SWITCHES                                             00990067
005100***************************************************************** 01000067
005200 01  PS-SWITCHES.                                                 01010067
005300     05  PS-END-EXT-FILE-SWITCH       PIC  X(01) VALUE 'N'.       01020067
005400         88  PS-END-EXT-FILE                     VALUE 'Y'.       01030067
005500         88  PS-NOT-END-EXT-FILE                 VALUE 'N'.       01040067
005600     05  PS-END-DTL-CURSOR-SWITCH     PIC  X(01) VALUE 'N'.       01050067
005700         88  PS-END-DTL-CSR                      VALUE 'Y'.       01060067
005701         88  PS-NOT-END-DTL-CSR                  VALUE 'N'.       01070067
005702     05  PS-ERROR-FOUND-SWITCH        PIC  X(01) VALUE 'N'.       01080067
005703         88  PS-ERROR-FOUND                      VALUE 'Y'.       01090067
005704         88  PS-NO-ERROR-FOUND                   VALUE 'N'.       01100067
005705     05  PS-SEND-EMAIL-SWITCH         PIC  X(01) VALUE 'N'.       01110067
005706         88  PS-SEND-EMAIL                       VALUE 'Y'.       01120067
005707         88  PS-DO-NOT-SEND-EMAIL                VALUE 'N'.       01130067
005708     05  PS-WRITE-HEADER-SWITCH       PIC  X(01) VALUE 'N'.       01140067
005709         88  PS-WRITE-HEADER                     VALUE 'Y'.       01150067
005710         88  PS-DO-NOT-WRITE-HEADER              VALUE 'N'.       01160067
005720                                                                  01170067
005730***************************************************************** 01180067
005740*    PROGRAM VARIABLES                                            01190067
005750***************************************************************** 01200067
005760 01  PV-VARIABLES.                                                01210067
005770     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         01220067
005780                                                 COMP SYNC.       01230067
005790     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01240067
005800                                                 COMP SYNC.       01250067
005900     05  PV-KEY-PO-NBR                PIC S9(09) VALUE ZERO       01260067
006000                                                 COMP.            01270067
006100     05  PV-CART-SHIP-QTY             PIC S9(09) VALUE ZERO       01280067
006200                                                 COMP.            01290067
006300     05  PV-ASN-PO-COUNT              PIC S9(09) VALUE ZERO       01300067
006400                                                 COMP.            01310067
006500     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    01320067
006600     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    01330067
006700     05  PV-ABEND-TABLE-1             PIC  X(20) VALUE SPACES.    01340067
006800     05  PV-ABEND-TABLE-2             PIC  X(20) VALUE SPACES.    01350067
006900     05  PV-ABEND-TABLE-3             PIC  X(20) VALUE SPACES.    01360067
007000     05  PV-ABEND-TABLE-4             PIC  X(20) VALUE SPACES.    01370067
007100     05  PV-ABEND-TABLE-5             PIC  X(20) VALUE SPACES.    01380067
007110     05  PV-CURRENT-TIMESTAMP         PIC  X(26) VALUE SPACES.    01390067
007120     05  PV-COMMIT-TIMESTAMP          PIC  X(26) VALUE SPACES.    01400067
007130     05  PV-ERROR-MSG-1               PIC  X(60) VALUE SPACES.    01410067
007140     05  PV-ERROR-MSG-2               PIC  X(60) VALUE SPACES.    01420067
007150     05  PV-ERROR-MSG-3               PIC  X(60) VALUE SPACES.    01430067
007160     05  PV-ASTERISK-LINE             PIC  X(80) VALUE ALL '*'.   01440067
007170     05  PV-ASN-HDR-RECS-READ         PIC  9(09) VALUE ZERO.      01450067
007180     05  PV-ASN-HDR-RECS-WRITTEN      PIC  9(09) VALUE ZERO.      01460067
007190     05  PV-ASN-DTL-RECS-WRITTEN      PIC  9(09) VALUE ZERO.      01470067
007200     05  PV-ASNHDR-NBR-HOLD           PIC  X(30) VALUE SPACES.    01480067
007300     05  PV-PO-NBR-HOLD               PIC  X(22) VALUE SPACES.    01490067
007400     05  PV-PO-NBR-X                  PIC  X(08) VALUE SPACES.    01500067
007500     05  PV-PO-NBR-N                  PIC  9(08) VALUE ZEROS.     01510067
007501     05  PV-UPC-NBR-X.                                            01520067
007502         10  PV-UPC-NBR               PIC  9(15) VALUE ZERO.      01530067
007503     05  PV-ENT-ID-X.                                             01540067
007504         10  PV-ENT-ID                PIC  9(09) VALUE ZERO.      01550067
007505     05  PV-SKU-NBR-X.                                            01560067
007506         10  PV-SKU-NBR               PIC  9(08) VALUE ZERO.      01570067
007507     05  PV-LOC-NBR-X.                                            01580067
007508         10  PV-LOC-NBR               PIC  9(04) VALUE ZERO.      01590086
007509     05  PV-ASNHDR-ID-X.                                          01600088
007510         10  PV-ASNHDR-ID             PIC  9(09) VALUE ZERO.      01610088
007511     05  PV-ISA-TIMESTAMP             PIC  X(26) VALUE SPACES.    01620067
007512     05  PV-ISA-TIMESTAMP-R           REDEFINES                   01630067
007520         PV-ISA-TIMESTAMP.                                        01640067
007530         10  PV-ISA-DATE-CCYY         PIC  X(04).                 01650067
007540         10  FILLER                   PIC  X(01).                 01660067
007550         10  PV-ISA-DATE-MM           PIC  X(02).                 01670067
007551         10  FILLER                   PIC  X(01).                 01680067
007552         10  PV-ISA-DATE-DD           PIC  X(02).                 01690067
007553         10  FILLER                   PIC  X(01).                 01700067
007554         10  PV-ISA-TIME-HH           PIC  X(02).                 01710067
007555         10  FILLER                   PIC  X(01).                 01720067
007556         10  PV-ISA-TIME-MM           PIC  X(02).                 01730067
007557         10  FILLER                   PIC  X(01).                 01740067
007558         10  PV-ISA-TIME-SS           PIC  X(02).                 01750067
007559         10  FILLER                   PIC  X(07).                 01760067
007560     05  PV-RECEIVED-DATE-CN.                                     01770067
007570         10  PV-RECEIVED-DATE-CCYY-CN PIC  X(04) VALUE SPACES.    01780067
007580         10  PV-RECEIVED-DATE-MM-CN   PIC  X(02) VALUE SPACES.    01790067
007581         10  PV-RECEIVED-DATE-DD-CN   PIC  X(02) VALUE SPACES.    01800067
007582     05  PV-RECEIVED-TIME-CN.                                     01810067
007583         10  PV-RECEIVED-TIME-HH-CN   PIC  X(02) VALUE SPACES.    01820067
007584         10  PV-RECEIVED-TIME-MM-CN   PIC  X(02) VALUE SPACES.    01830067
007585         10  PV-RECEIVED-TIME-SS-CN   PIC  X(02) VALUE SPACES.    01840067
007586     05  PV-SHIP-DTE                  PIC  X(10) VALUE SPACES.    01850067
007587     05  PV-SHIP-DTE-R                REDEFINES                   01860067
007588         PV-SHIP-DTE.                                             01870067
007589         10  PV-SHIP-DTE-CCYY         PIC  X(04).                 01880067
007590         10  FILLER                   PIC  X(01).                 01890067
007591         10  PV-SHIP-DTE-MM           PIC  X(02).                 01900067
007592         10  FILLER                   PIC  X(01).                 01910067
007593         10  PV-SHIP-DTE-DD           PIC  X(02).                 01920067
007594     05  PV-PICKUP-DATE-CN.                                       01930067
007595         10  PV-PICKUP-DATE-CCYY-CN   PIC  X(04) VALUE SPACES.    01940067
007596         10  PV-PICKUP-DATE-MM-CN     PIC  X(02) VALUE SPACES.    01950067
007597         10  PV-PICKUP-DATE-DD-CN     PIC  X(02) VALUE SPACES.    01960067
007598     05  PV-RUN-DATE-CN               PIC  X(08) VALUE SPACES.    01970067
007599     05  PV-RUN-TIME-CN               PIC  X(06) VALUE SPACES.    01980067
007600***** FILE NAME CONSISTS OF RUN-DATE-CN_ASNHDR.DAT                01990067
007610*****     EXAMPLE: 20050317_ASNHDR.DAT  OR ASNDETL                02000067
007620     05  PV-FILE-NAME.                                            02010067
007621         10  PV-CREATE-DATE           PIC  X(08) VALUE SPACES.    02020067
007622         10  PV-UNDERSCORE            PIC  X(01) VALUE '_'.       02030067
007623         10  PV-ASN-DAT               PIC  X(11) VALUE SPACES.    02040067
007624                                                                  02050067
007626***************************************************************** 02060067
007627*    PROGRAM NULL INDICATORS                                      02070067
007628***************************************************************** 02080067
007629 01  PV-NULL-INDICATORS.                                          02090067
007630     05  PV-PKG-QTY-NULL             PIC S9(04)    VALUE +0       02100067
007631                                                   COMP SYNC.     02110069
007632     05  PV-PRO-NBR-NULL             PIC S9(04)    VALUE +0       02120087
007633                                                   COMP SYNC.     02130087
007635                                                                  02140069
007636***  MARKER FILE LAYOUT                                           02150069
007637     COPY VLRD029.                                                02160069
007638                                                                  02170069
007639***  ASN HEADER FILE LAYOUT                                       02180069
007640     COPY VLRD040.                                                02190069
007641                                                                  02200069
007642***  ASN DETAIL FILE LAYOUT                                       02210069
007643     COPY VLRD041.                                                02220069
007644                                                                  02230069
007645***  ASN INPUT EXTRACT FILE LAYOUT                                02240069
007646     COPY VLRD043.                                                02250069
007647                                                                  02260069
007648**--------------------------------------------------------------**02270069
007649** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **02280069
007650** SUB-ROUTINE (DPKUT100).                                      **02290069
007651**--------------------------------------------------------------**02300069
007652     COPY DPWS010I.                                               02310069
007653                                                                  02320069
007654***  DATE ROUTINE COPYBOOK                                        02330069
007655     COPY DPWS500.                                                02340069
007656                                                                  02350069
007660***  DB2 ABEND COPYBOOK                                           02360005
007700     COPY DPWS004.                                                02370000
007800                                                                  02380000
007900     EXEC SQL                                                     02390000
008000         INCLUDE SQLCA                                            02400000
008100     END-EXEC.                                                    02410000
008200                                                                  02420000
008300     COPY SQLCA2.                                                 02430000
008400                                                                  02440000
010080*---------------------------------------------------------------* 02450001
010090*    DCLGEN FOR THE ASN ORDER TABLE                             * 02460061
010091*---------------------------------------------------------------* 02470001
010092     EXEC SQL                                                     02480001
010093         INCLUDE TASNORD                                          02490061
010094     END-EXEC.                                                    02500001
010095                                                                  02510001
010096*---------------------------------------------------------------* 02520061
010097*    DCLGEN FOR THE ASN DETAIL TABLE                            * 02530061
010098*---------------------------------------------------------------* 02540061
010099     EXEC SQL                                                     02550061
010100         INCLUDE TASNDTL                                          02560061
010101     END-EXEC.                                                    02570061
010102                                                                  02580061
010103*---------------------------------------------------------------* 02590061
010104*    DCLGEN FOR THE ASN DETAIL / CARTON ASSOCIATOR TABLE        * 02600061
010105*---------------------------------------------------------------* 02610061
010106     EXEC SQL                                                     02620061
010107         INCLUDE TASCRIT                                          02630061
010108     END-EXEC.                                                    02640061
010109                                                                  02650067
010110*---------------------------------------------------------------* 02660067
010111*    DCLGEN FOR THE ASN CARTON TABLE                            * 02670067
010112*---------------------------------------------------------------* 02680067
010113     EXEC SQL                                                     02690067
010114         INCLUDE TASNCAR                                          02700067
010115     END-EXEC.                                                    02710067
010116                                                                  02720067
010117*---------------------------------------------------------------* 02730067
010118*    DCLGEN FOR THE PURCHASE ORDER TABLE                        * 02740067
010119*---------------------------------------------------------------* 02750067
010120     EXEC SQL                                                     02760067
010121         INCLUDE TPURCHS                                          02770067
010122     END-EXEC.                                                    02780067
010123                                                                  02790067
010130*---------------------------------------------------------------* 02800067
010200*    DCLGEN FOR VENDOR LOGISTICS DOMAIN SKU TABLE               * 02810001
010300*    (XLT_SKU)                                                  * 02820001
010400*---------------------------------------------------------------* 02830000
010500     EXEC SQL                                                     02840000
010600         INCLUDE XLT00003                                         02850001
010700     END-EXEC.                                                    02860000
010800                                                                  02870000
010810*---------------------------------------------------------------* 02880001
010820*    DCLGEN FOR VENDOR LOGISTICS DOMAIN UPC TABLE               * 02890001
010830*    (XLT_UPC)                                                  * 02900001
010840*---------------------------------------------------------------* 02910001
010850     EXEC SQL                                                     02920001
010860         INCLUDE XLT00006                                         02930001
010870     END-EXEC.                                                    02940001
010880                                                                  02950001
010890*---------------------------------------------------------------* 02960005
010900*    DCLGEN FOR VENDOR LOGISTICS DOMAIN DC LOCATION ASSOCIATION * 02970005
011000*    TABLE (XLT_DC_LOC_ASGMT)                                   * 02980005
011100*---------------------------------------------------------------* 02990005
011200     EXEC SQL                                                     03000005
011300         INCLUDE XLT00014                                         03010005
011310     END-EXEC.                                                    03020005
011320                                                                  03030005
011348*---------------------------------------------------------------* 03040087
012121***  EXTRACT CURSOR FOR THE ASN DETAIL ROWS ASSOCIATED WITH A     03050003
012122***  ASNHDR ID NUMBER, PO NUMBER AND LOCATION NUMBER.             03060003
012123     EXEC SQL                                                     03070003
012124         DECLARE DTL-EXTRACT-CSR CURSOR FOR                       03080003
012127         SELECT A.UPC_NBR                                         03090003
012128              , A.SHIPT_QTY                                       03100003
012132              , A.LOC_NBR                                         03110003
012133              , B.ASNCAR_NBR                                      03120003
012134              , C.PKG_QTY                                         03130067
012135           FROM TASNDTL A                                         03140008
012136              , TASCRIT B                                         03150008
012137              , TASNCAR C                                         03160067
012138          WHERE A.ASNHDR_ID   = :VL043-ASNHDR-ID                  03170060
012139            AND A.PO_NBR      = :VL043-PO-NBR                     03180060
012140            AND A.LOC_NBR     = :VL043-LOC-NBR                    03190060
012141            AND A.ASNHDR_ID   = B.ASNHDR_ID                       03200003
012142            AND A.ASNDTL_NBR  = B.ASNDTL_NBR                      03210003
012143            AND C.ASNHDR_ID   = B.ASNHDR_ID                       03220067
012144            AND C.ASNCAR_NBR  = B.ASNCAR_NBR                      03230067
012145       ORDER BY A.LOC_NBR                                         03240003
012146              , B.ASNCAR_NBR                                      03250003
012147           WITH UR                                                03260090
012160     END-EXEC.                                                    03270003
012161                                                                  03280003
012162 LINKAGE SECTION.                                                 03290003
012163                                                                  03300003
012164 PROCEDURE DIVISION.                                              03310000
012165***************************************************************** 03320000
012170*  MAINLINE LOGIC FOR PROGRAM                                     03330000
012180***************************************************************** 03340000
012190 0000-MAINLINE.                                                   03350000
012191     DISPLAY '* START - VLKUT039'.                                03360091
012192     DISPLAY '*'.                                                 03370091
012193                                                                  03380091
012200     PERFORM 1000-INITIALIZE.                                     03390000
012300                                                                  03400000
012400     PERFORM 2000-PROCESS-ASN-HDR                                 03410002
012500         UNTIL PS-END-EXT-FILE.                                   03420060
012600                                                                  03430000
012700     PERFORM 9000-EOJ.                                            03440000
012800                                                                  03450000
012900     STOP RUN.                                                    03460000
013000                                                                  03470000
013100***************************************************************** 03480000
013200*  INITIALIZATION PARAGRAPH                                       03490000
013300***************************************************************** 03500000
013400 1000-INITIALIZE.                                                 03510000
013500     OPEN INPUT  VL-ASN-EXT-FILE                                  03520060
013502          OUTPUT VL-ASN-HDR-FILE                                  03530069
013510                 VL-ASN-DTL-FILE                                  03540003
013520                 VL-MARKER-FILE.                                  03550004
013600                                                                  03560000
013601* DATECARD IS GENERATED BY ENTERPRISE JOB SCHEDULER WHEN THE      03570033
013602* JOB IS SCHEDULED.                                               03580033
013604     ACCEPT CC-DATECARD FROM SYSIN                                03590076
013606                                                                  03600071
013607     DISPLAY 'CONTROL CARD ====>  ' CC-DATECARD.                  03610071
013608                                                                  03620071
013609     PERFORM 1100-VALIDATE-CONTROL-CARD.                          03630071
013610                                                                  03640077
013620******* TIME IS CONTAINED CURRENT-DATE IN POSITION 9 FOR 8        03650071
013621     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME-CN.           03660071
013622                                                                  03670071
013623     DISPLAY '******  RUN TIME  => '  PV-RUN-TIME-CN.             03680071
013624     DISPLAY '*'.                                                 03690091
013630                                                                  03700071
013705     SET PS-NO-ERROR-FOUND                                        03710007
013706         PS-NOT-END-EXT-FILE TO TRUE.                             03720060
013707                                                                  03730007
013708     PERFORM 7000-READ-ASN-EXT-INPUT.                             03740072
013900                                                                  03750000
013901                                                                  03760007
013902******************************************************************03770065
013903**  VALIDATE THE DATE FROM THE SCHEDULE                           03780065
013904******************************************************************03790065
013905 1100-VALIDATE-CONTROL-CARD.                                      03800065
013906     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03810065
013907     SET DPG51-FISCAL-454-CALENDAR                                03820065
013908         DPG51-DO-NOT-INCR-DECR-DATE                              03830065
013909         DPG52-LK-DTE-ISO          TO TRUE.                       03840065
013910                                                                  03850065
013912     MOVE CC-ASN-EXTRACT-RUN-DATE  TO DPG52-LK-DATE-INPUT.        03860065
013913                                                                  03870065
013914     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      03880065
013915             DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 03890065
013916                                                                  03900065
013917     IF DPG54-NO-ERROR                                            03910065
013918         MOVE CC-ASN-EXTRACT-RUN-DATE                             03920065
013919                                   TO PV-RUN-DATE-CN              03930065
013920     ELSE                                                         03940065
013921         DISPLAY '** ABEND **'                                    03950065
013922         DISPLAY '** PROGRAM = VLKUT039 -- CALLED MODULE '        03960065
013923                  'DPKUT500 **'                                   03970065
013924         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD **'   03980065
013925         DISPLAY '** INVALID SCHEDULE DATE: '                     03990066
013926                  CC-ASN-EXTRACT-RUN-DATE                         04000066
013927         DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '        04010065
013928         DISPLAY DPG54-ERROR-MESSAGE                              04020065
013929         MOVE +4003 TO PV-ABEND-CODE                              04030065
013930         CALL 'ILBOABN0' USING PV-ABEND-CODE                      04040065
013931     END-IF.                                                      04050065
013932                                                                  04060065
013933                                                                  04070065
014040***************************************************************** 04080000
014100* PROCESS DATA FROM ASN HEADER CURSOR AND WRITE THE OUTPUT RECORD 04090003
014200***************************************************************** 04100000
014300 2000-PROCESS-ASN-HDR.                                            04110002
014301     IF  VL043-ASNHDR-NBR NOT = PV-ASNHDR-NBR-HOLD                04120060
014302         MOVE VL043-ASNHDR-NBR    TO PV-ASNHDR-NBR-HOLD           04130060
014303         MOVE VL043-PO-NBR        TO PV-PO-NBR-HOLD               04140060
014305         SET PS-WRITE-HEADER      TO TRUE                         04150048
014306     ELSE                                                         04160048
014307         IF  VL043-PO-NBR NOT = PV-PO-NBR-HOLD                    04170060
014308             MOVE VL043-PO-NBR    TO PV-PO-NBR-HOLD               04180060
014310             SET PS-WRITE-HEADER  TO TRUE                         04190048
014312         END-IF                                                   04200048
014313     END-IF.                                                      04210048
014314                                                                  04220048
014315     MOVE 'A'                     TO VL040-ACD-INDICATOR.         04230048
014316     MOVE VL043-PO-NBR            TO VL040-PO-NBR.                04240060
014317     MOVE VL043-ASNHDR-NBR        TO VL040-SEQ-NBR.               04250060
014318                                                                  04260048
014319******************************************************************04270048
014320*  CALL THE NUMERIC EDIT ROUTINE TO CONVERT THE PO NUMBER FROM   *04280048
014321*  AN ALPHANUMERIC FORMAT (WHICH IS THE WAY IT IS STORED ON THE  *04290048
014322*  ASN TABLES) TO A NUMERIC FORMAT (WHICH IS NEEDED FOR TO LOOK  *04300048
014323*  UP INFORMATION ON THE TPURCHS TABLE).  I RAN INTO A SITUATION *04310048
014324*  THAT IF THE PO NUMBER IS LESS THAN 8 DIGITS, WHEN MOVING IT   *04320048
014325*  TO A NUMERIC FIELD, ZEROS WERE GETTING PLACED AT THE END.     *04330048
014326******************************************************************04340048
014327     MOVE VL043-PO-NBR            TO PV-PO-NBR-X.                 04350060
014328     MOVE PV-PO-NBR-X             TO DP010I-UNEDITED-FIELD        04360048
014329     MOVE 8                       TO DP010I-MAXIMUM-DIGITS        04370048
014330     MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS      04380048
014331     SET DP010I-NEGATIVE-NOT-ALLOWED                              04390048
014332                                  TO TRUE                         04400048
014333     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04410048
014334                               USING DP010I-NUMERIC-EDIT-AREA     04420048
014335                                                                  04430048
014336     IF  DP010I-NO-ERROR-DETECTED                                 04440048
014337         MOVE DP010I-NUMERIC-FIELD   TO PV-PO-NBR-N               04450048
014338         MOVE PV-PO-NBR-N            TO PV-KEY-PO-NBR             04460048
014339         PERFORM 2100-GET-ENT-ID-FROM-PO                          04470048
014340     ELSE                                                         04480048
014341         SET PS-ERROR-FOUND                                       04490048
014342             PS-SEND-EMAIL           TO TRUE                      04500048
014343         DISPLAY PV-ASTERISK-LINE                                 04510048
014344         DISPLAY '** ERROR CONVERTING PO NUMBER TO NUMERIC **'    04520048
014345         DISPLAY '** ASN NUMBER = ' VL043-ASNHDR-NBR              04530060
014346                 '  PO NUMBER = ' VL043-PO-NBR                    04540060
014347                 '  **'                                           04550048
014348         DISPLAY '** LOC NUMBER = ' VL043-LOC-NBR                 04560060
014349                 '  **'                                           04570048
014350     END-IF.                                                      04580048
014351                                                                  04590048
014352     IF  PS-NO-ERROR-FOUND                                        04600048
014353         MOVE PURCHS-ENT-ID       TO PV-ENT-ID                    04610048
014354         MOVE PV-ENT-ID-X         TO VL040-ENT-ID                 04620048
014355         MOVE VL043-EDIISA-CNTL-TMST                              04630060
014356                                  TO PV-ISA-TIMESTAMP             04640048
014357         MOVE PV-ISA-DATE-CCYY    TO PV-RECEIVED-DATE-CCYY-CN     04650048
014358         MOVE PV-ISA-DATE-MM      TO PV-RECEIVED-DATE-MM-CN       04660048
014359         MOVE PV-ISA-DATE-DD      TO PV-RECEIVED-DATE-DD-CN       04670048
014360         MOVE PV-ISA-TIME-HH      TO PV-RECEIVED-TIME-HH-CN       04680048
014361         MOVE PV-ISA-TIME-MM      TO PV-RECEIVED-TIME-MM-CN       04690048
014362         MOVE PV-ISA-TIME-SS      TO PV-RECEIVED-TIME-SS-CN       04700048
014363         STRING PV-RECEIVED-DATE-CN  DELIMITED BY SIZE            04710084
014364                '.'                  DELIMITED BY SIZE            04720084
014365                PV-RECEIVED-TIME-CN  DELIMITED BY SIZE            04730084
014366                                INTO VL040-RECEIVED-DATE          04740084
ST3504         MOVE VL043-CARR-ID-CDE   TO VL040-SCAC                   04750097
014372                                                                  04760093
014374         MOVE VL043-BOL-NBR       TO VL040-BOL-NBR                04770088
014375         MOVE VL043-PRO-NBR       TO VL040-FREIGHT-BILL-NBR       04780088
014376         MOVE VL043-CARR-AUTH-ID  TO VL040-CARR-AUTH-ID           04790088
014377                                                                  04800093
014378         MOVE VL043-SHIP-DTE      TO PV-SHIP-DTE                  04810093
014379         MOVE PV-SHIP-DTE-CCYY    TO PV-PICKUP-DATE-CCYY-CN       04820093
014380         MOVE PV-SHIP-DTE-MM      TO PV-PICKUP-DATE-MM-CN         04830093
014381         MOVE PV-SHIP-DTE-DD      TO PV-PICKUP-DATE-DD-CN         04840093
014382         MOVE PV-PICKUP-DATE-CN   TO VL040-PICKUP-DATE            04850093
014383         MOVE SPACES              TO VL040-CART-CNT-SIGN          04860093
014384         MOVE VL043-CART-SHIP-QTY                                 04870093
014385                                  TO VL040-CART-CNT               04880093
014386         MOVE SPACES              TO VL040-ORIGIN-ZIP-CDE         04890093
014387                                     VL040-PO-UNIQUE-ADDENDA      04900093
014388                                                                  04910093
014389         PERFORM 2200-FETCH-DROP-LOC                              04920093
014390         MOVE XLT00014-DC-NBR     TO PV-LOC-NBR                   04930093
014391         MOVE PV-LOC-NBR-X        TO VL040-DROP-LOC               04940093
014392                                                                  04950093
014393*  WE NEED TO CHECK IF THERE ARE OTHER STORES FOR THE SPECIFIED  *04960093
014394*  ASN# AND PO COMBINATION.  THIS IS A VALID SCENARIO IN OUR ASN *04970093
014395*  SYSTEM THAT CANNOT BE HANDLED BY COMPLIANCE NETWORKS. IN THIS *04980093
014396*  CASE, WE NEED TO ROLL UP THESE MULTIPLE EXTRACT ROWS INTO A   *04990093
014397*  SINGLE HEADER RECORD WITH THE ASSOCIATED DC NUMBER AS THE     *05000093
014398*  LOCATION NUMBER. THE REMAINING HEADER RECORDS FOR THE ASN/PO  *05010093
014399*  WILL BE READ, BUT WILL NOT BE WRITTEN TO THE EXTRACT FILE.    *05020093
014400*  DETAIL ROWS WILL STILL BE WRITTEN FOR THESE BYPASSED HEADER   *05030093
014401*  ROWS.                                                         *05040093
014402         PERFORM 2300-SUM-CARTON-SHIP-QTY                         05050093
014403                                                                  05060093
014404         IF  PV-ASN-PO-COUNT > 1                                  05070093
014405             MOVE XLT00014-DC-NBR TO PV-LOC-NBR                   05080093
014406             MOVE PV-LOC-NBR-X    TO VL040-DESTINATION-NBR        05090093
014407             MOVE PV-CART-SHIP-QTY                                05100093
014408                                  TO VL040-CART-CNT               05110093
014409         ELSE                                                     05120093
014410             MOVE VL043-LOC-NBR   TO PV-LOC-NBR                   05130093
014411             MOVE PV-LOC-NBR-X    TO VL040-DESTINATION-NBR        05140093
014412             MOVE VL043-CART-SHIP-QTY                             05150093
014413                                  TO VL040-CART-CNT               05160093
014414         END-IF                                                   05170093
014415                                                                  05180093
014416         MOVE 'X'                 TO VL040-ANCHOR-CONSTANT        05190093
014417                                                                  05200093
014418         IF  PS-WRITE-HEADER                                      05210093
014419             PERFORM 8000-WRITE-ASN-HDR-OUTPUT                    05220093
014420             IF  PV-ASN-PO-COUNT > 1                              05230093
014421                 SET PS-DO-NOT-WRITE-HEADER                       05240093
014422                                  TO TRUE                         05250093
014423             END-IF                                               05260093
014424         END-IF                                                   05270093
014425                                                                  05280093
014426         SET PS-NOT-END-DTL-CSR   TO TRUE                         05290093
014427                                                                  05300093
014428         PERFORM 7300-OPEN-DTL-EXTRACT-CURSOR                     05310093
014429         PERFORM 7500-FETCH-DTL-EXTRACT-CURSOR                    05320093
014430                                                                  05330093
014431         PERFORM 3000-PROCESS-ASN-DTL                             05340093
014432             UNTIL PS-END-DTL-CSR                                 05350093
014433                                                                  05360093
014434         PERFORM 7400-CLOSE-DTL-EXTRACT-CURSOR                    05370093
014435     END-IF.                                                      05380093
014436                                                                  05390093
014437     EXEC SQL                                                     05400093
014438         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            05410093
014439     END-EXEC.                                                    05420093
014440*                                                                 05430093
014500     IF  SQLCODE = +0                                             05440007
014600         CONTINUE                                                 05450089
015100     ELSE                                                         05460007
015710         DISPLAY '** ABEND **'                                    05470007
015720         DISPLAY '** PROGRAM = VLKUT039 **'                       05480007
015740         DISPLAY '** PARAGRAPH =  2000-PROCESS-ASN-HDR **'        05490007
015750         MOVE 'ERROR FETCHING CURRENT TIMESTAMP'                  05500007
015760                                 TO PV-ERROR-MSG-1                05510048
015770         MOVE SPACES             TO PV-ABEND-TABLE-1              05520007
015780         PERFORM 9200-SQL-ERROR                                   05530007
015800     END-IF.                                                      05540007
015900                                                                  05550007
017619     SET PS-NO-ERROR-FOUND        TO TRUE.                        05560007
017620                                                                  05570007
017621     PERFORM 7000-READ-ASN-EXT-INPUT.                             05580060
017622                                                                  05590007
017630                                                                  05600000
017640******************************************************************05610000
017650* FETCH THE ENT-ID INFORMATION FROM THE PURCHASE ORDER TABLE      05620005
017660******************************************************************05630000
017670 2100-GET-ENT-ID-FROM-PO.                                         05640005
017680     INITIALIZE DCLTPURCHS.                                       05650005
017690                                                                  05660000
017691     PERFORM                                                      05670005
017692         WITH TEST AFTER                                          05680005
017693         VARYING PV-RETRY-COUNTER                                 05690005
017694         FROM 1 BY 1                                              05700005
017695         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05710005
017696                   OR (SQLCODE = ZERO)                            05720005
017697                   OR (SQLCODE = +100))                           05730005
017700         EXEC SQL                                                 05740005
017800             SELECT ENT_ID                                        05750005
018100               INTO :PURCHS-ENT-ID                                05760008
018500               FROM TPURCHS                                       05770005
018700              WHERE PO_NBR         = :PV-KEY-PO-NBR               05780005
018800                AND VER_STATUS_CDE = 'A'                          05790005
019000         END-EXEC                                                 05800005
019010         EVALUATE TRUE                                            05810005
019020             WHEN SQLCODE = +0                                    05820005
019030             WHEN SQLCODE = -904                                  05830005
019040             WHEN SQLCODE = -911                                  05840005
019050             WHEN SQLCODE = -913                                  05850005
019060                 CONTINUE                                         05860005
019061             WHEN SQLCODE = +100                                  05870006
019062                 SET PS-ERROR-FOUND                               05880034
019063                     PS-SEND-EMAIL    TO TRUE                     05890034
019064                 DISPLAY PV-ASTERISK-LINE                         05900044
019065                 DISPLAY '** PO NOT FOUND **'                     05910027
019066                 DISPLAY '** ASN NUMBER = ' VL043-ASNHDR-NBR      05920060
019067                         '  PO NUMBER = ' VL043-PO-NBR            05930060
019071                         '  **'                                   05940027
019072                 DISPLAY '** LOC NUMBER = ' VL043-LOC-NBR         05950060
019073                         '  **'                                   05960027
019076             WHEN SQLWARN0 NOT EQUAL SPACE                        05970027
019080             WHEN SQLCODE NOT EQUAL ZERO                          05980005
019090                 DISPLAY '** ABEND **'                            05990005
019091                 DISPLAY '** PROGRAM = VLKUT039 **'               06000005
019092                 DISPLAY '** PARAGRAPH = '                        06010005
019093                         '2100-GET-ENT-ID-FROM-PO **'             06020005
019094                 MOVE 'ERROR FETCHING ENT-ID FROM TPURCHS'        06030005
019095                                      TO PV-ERROR-MSG-1           06040048
019096                 MOVE VL043-LOC-NBR   TO PV-LOC-NBR               06050060
019097                 STRING 'ASN NBR: '        DELIMITED BY SIZE      06060048
019098                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      06070060
019099                                    INTO PV-ERROR-MSG-2           06080048
019100                 STRING 'PO NBR: '         DELIMITED BY SIZE      06090048
019101                        VL043-PO-NBR       DELIMITED BY SIZE      06100060
019102                        '  LOC NBR: '      DELIMITED BY SIZE      06110048
019103                        PV-LOC-NBR-X       DELIMITED BY SIZE      06120048
019104                                    INTO PV-ERROR-MSG-3           06130048
019114                 MOVE 'TPURCHS'       TO PV-ABEND-TABLE-1         06140005
019115                 PERFORM 9200-SQL-ERROR                           06150005
019116         END-EVALUATE                                             06160005
019117     END-PERFORM.                                                 06170005
019118                                                                  06180005
019119     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06190005
019120         DISPLAY '** ABEND **'                                    06200005
019121         DISPLAY '** PROGRAM = VLKUT039 **'                       06210005
019122         DISPLAY '** PARAGRAPH =  2100-GET-ENT-ID-FROM-PO **'     06220005
019123         MOVE 'FETCH ENT ID FROM PO MAX RETRIES ENCOUNTERED'      06230005
019124                                      TO PV-ERROR-MSG-1           06240048
019125         MOVE VL043-LOC-NBR           TO PV-LOC-NBR               06250060
019126         STRING 'ASN NBR: '              DELIMITED BY SIZE        06260048
019127                VL043-ASNHDR-NBR         DELIMITED BY SIZE        06270060
019128                                    INTO PV-ERROR-MSG-2           06280048
019129         STRING 'PO NBR: '               DELIMITED BY SIZE        06290048
019130                VL043-PO-NBR             DELIMITED BY SIZE        06300060
019131                '  LOC NBR: '            DELIMITED BY SIZE        06310048
019132                PV-LOC-NBR-X             DELIMITED BY SIZE        06320048
019133                                    INTO PV-ERROR-MSG-3           06330048
019134         MOVE 'TPURCHS'               TO PV-ABEND-TABLE-1         06340005
019135         PERFORM 9200-SQL-ERROR                                   06350005
019136     END-IF.                                                      06360005
019140                                                                  06370000
020869******************************************************************06380069
020870* FETCH THE NUMBER OF THE DC THAT IS ASSOCIATED DESTINATION STORE.06390069
020871******************************************************************06400069
020872 2200-FETCH-DROP-LOC.                                             06410069
020873     INITIALIZE DCLXLT00014.                                      06420069
020874                                                                  06430069
020875     PERFORM                                                      06440069
020876         WITH TEST AFTER                                          06450069
020877         VARYING PV-RETRY-COUNTER                                 06460069
020878         FROM 1 BY 1                                              06470069
020879         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06480069
020880                   OR (SQLCODE = ZERO)                            06490069
020881                   OR (SQLCODE = +100))                           06500069
020882         EXEC SQL                                                 06510069
020883             SELECT A.DC_NBR                                      06520069
020884               INTO :XLT00014-DC-NBR                              06530069
020885               FROM XLT_DC_LOC_ASGMT A                            06540069
020886              WHERE A.LOC_NBR     = :VL043-LOC-NBR                06550069
020887                AND A.EFF_BEG_DTE =                               06560069
020888                    (SELECT MAX(EFF_BEG_DTE)                      06570069
020889                       FROM XLT_DC_LOC_ASGMT B                    06580069
020890                      WHERE B.LOC_NBR = :VL043-LOC-NBR            06590069
020891                        AND DATE(EFF_BEG_DTE) <= CURRENT DATE)    06600069
020892                                                                  06610069
020893         END-EXEC                                                 06620069
020894         EVALUATE TRUE                                            06630069
020895             WHEN SQLCODE = +0                                    06640069
020896             WHEN SQLCODE = -904                                  06650069
020897             WHEN SQLCODE = -911                                  06660069
020898             WHEN SQLCODE = -913                                  06670069
020899                 CONTINUE                                         06680069
020900             WHEN SQLCODE = +100                                  06690069
020901                 SET PS-ERROR-FOUND                               06700069
020902                     PS-SEND-EMAIL    TO TRUE                     06710069
020903                 DISPLAY PV-ASTERISK-LINE                         06720069
020904                 DISPLAY '** ASSOC DC NOT FOUND FOR LOC NBR **'   06730069
020905                 DISPLAY '** ASN NUMBER = ' VL043-ASNHDR-NBR      06740069
020906                         '  ** PO NUMBER  = ' VL043-PO-NBR        06750069
020907                 DISPLAY '** LOC NUMBER = ' VL043-LOC-NBR         06760069
020908                         '  **'                                   06770069
020909             WHEN SQLWARN0 NOT EQUAL SPACE                        06780069
020910             WHEN SQLCODE NOT EQUAL ZERO                          06790069
020911                 DISPLAY '** ABEND **'                            06800069
020912                 DISPLAY '** PROGRAM = VLKUT039 **'               06810069
020913                 DISPLAY '** PARAGRAPH = '                        06820069
020914                         '2200-FETCH-DROP-LOC **'                 06830069
020915                 MOVE 'ERROR FETCHING ASSOCATION DC NBR'          06840069
020916                                      TO PV-ERROR-MSG-1           06850069
020917                 MOVE VL043-LOC-NBR   TO PV-LOC-NBR               06860069
020918                 STRING 'ASN NBR: '        DELIMITED BY SIZE      06870069
020919                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      06880069
020920                                    INTO PV-ERROR-MSG-2           06890069
020921                 STRING 'PO NBR: '         DELIMITED BY SIZE      06900069
020922                        VL043-PO-NBR       DELIMITED BY SIZE      06910069
020923                        '  LOC NBR: '      DELIMITED BY SIZE      06920069
020924                        PV-LOC-NBR-X       DELIMITED BY SIZE      06930069
020925                                    INTO PV-ERROR-MSG-3           06940069
020926                 MOVE 'XLT_DC_LOC_ASGMT'                          06950069
020927                                      TO PV-ABEND-TABLE-1         06960069
020928                 PERFORM 9200-SQL-ERROR                           06970069
020929         END-EVALUATE                                             06980069
020930     END-PERFORM.                                                 06990069
020931                                                                  07000069
020932     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07010069
020933         DISPLAY '** ABEND **'                                    07020069
020934         DISPLAY '** PROGRAM = VLKUT039 **'                       07030069
020935         DISPLAY '** PARAGRAPH =  2200-FETCH-DROP-LOC **'         07040069
020936         MOVE 'FETCH ASSOCIATION DC NBR MAX RETRIES ENCOUNTERED'  07050069
020937                                      TO PV-ERROR-MSG-1           07060069
020938         MOVE 'XLT_DC_LOC_ASGMT'      TO PV-ABEND-TABLE-1         07070069
020939         MOVE VL043-LOC-NBR           TO PV-LOC-NBR               07080069
020940         STRING 'ASN NBR: '              DELIMITED BY SIZE        07090069
020941                VL043-ASNHDR-NBR         DELIMITED BY SIZE        07100069
020942                                    INTO PV-ERROR-MSG-2           07110069
020943         STRING 'PO NBR: '               DELIMITED BY SIZE        07120069
020944                VL043-PO-NBR             DELIMITED BY SIZE        07130069
020945                '  LOC NBR: '            DELIMITED BY SIZE        07140069
020946                PV-LOC-NBR-X             DELIMITED BY SIZE        07150069
020947                                    INTO PV-ERROR-MSG-3           07160069
020948         PERFORM 9200-SQL-ERROR                                   07170069
020949     END-IF.                                                      07180069
020950                                                                  07190069
020951                                                                  07200069
020952******************************************************************07210069
020953* SUM THE CARTON QUANTITY AND COUNT THE NUMBER OF ROWS FOR A      07220069
020954* SPECIFIED ASN NUMBER AND PO NUMBER COMBINATION.                 07230069
020955******************************************************************07240069
020956 2300-SUM-CARTON-SHIP-QTY.                                        07250069
020957     INITIALIZE PV-CART-SHIP-QTY                                  07260069
020958                PV-ASN-PO-COUNT.                                  07270069
020959                                                                  07280069
020960     PERFORM                                                      07290069
020961         WITH TEST AFTER                                          07300069
020962         VARYING PV-RETRY-COUNTER                                 07310069
020963         FROM 1 BY 1                                              07320069
020964         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07330069
020965                   OR (SQLCODE = ZERO))                           07340069
020966         EXEC SQL                                                 07350069
020967             SELECT SUM(CART_SHIP_QTY)                            07360069
020968                  , COUNT(*)                                      07370069
020969               INTO :PV-CART-SHIP-QTY                             07380069
020970                  , :PV-ASN-PO-COUNT                              07390087
020971               FROM TASNORD                                       07400069
020972              WHERE ASNHDR_ID = :VL043-ASNHDR-ID                  07410069
020973                AND PO_NBR    = :VL043-PO-NBR                     07420069
020974         END-EXEC                                                 07430069
020975         EVALUATE TRUE                                            07440069
020976             WHEN SQLCODE = +0                                    07450069
020977             WHEN SQLCODE = -904                                  07460069
020978             WHEN SQLCODE = -911                                  07470069
020979             WHEN SQLCODE = -913                                  07480069
020980                 CONTINUE                                         07490069
020981             WHEN SQLWARN0 NOT EQUAL SPACE                        07500069
020982             WHEN SQLCODE NOT EQUAL ZERO                          07510069
020983                 DISPLAY '** ABEND **'                            07520069
020984                 DISPLAY '** PROGRAM = VLKUT039 **'               07530069
020985                 DISPLAY '** PARAGRAPH = '                        07540069
020986                         '2300-SUM-CARTON-SHIP-QTY **'            07550069
020987                 MOVE 'ERROR ON SUM OF CARTON SHIP QTY'           07560069
020988                                      TO PV-ERROR-MSG-1           07570069
020989                 STRING 'ASN NBR: '       DELIMITED BY SIZE       07580069
020990                        VL043-ASNHDR-NBR DELIMITED BY SIZE        07590069
020991                                    INTO PV-ERROR-MSG-2           07600069
020992                 STRING 'PO NBR: '        DELIMITED BY SIZE       07610069
020993                        VL043-PO-NBR      DELIMITED BY SIZE       07620069
020994                                    INTO PV-ERROR-MSG-3           07630069
020995                 MOVE 'TASNORD'       TO PV-ABEND-TABLE-1         07640069
020996                 PERFORM 9200-SQL-ERROR                           07650069
020997         END-EVALUATE                                             07660069
020998     END-PERFORM.                                                 07670069
020999                                                                  07680069
021000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07690069
021001         DISPLAY '** ABEND **'                                    07700069
021002         DISPLAY '** PROGRAM = VLKUT039 **'                       07710069
021003         DISPLAY '** PARAGRAPH =  2200-FETCH-DROP-LOC **'         07720069
021004         MOVE 'SUM OF CARTON COUNT MAX RETRIES ENCOUNTERED'       07730069
021005                                      TO PV-ERROR-MSG-1           07740069
021006         STRING 'ASN NBR: '              DELIMITED BY SIZE        07750069
021007                VL043-ASNHDR-NBR         DELIMITED BY SIZE        07760069
021008                                    INTO PV-ERROR-MSG-2           07770069
021009         STRING 'PO NBR: '               DELIMITED BY SIZE        07780069
021010                VL043-PO-NBR             DELIMITED BY SIZE        07790069
021011                                    INTO PV-ERROR-MSG-3           07800069
021012         MOVE 'TASNORD'               TO PV-ABEND-TABLE-1         07810069
021013         PERFORM 9200-SQL-ERROR                                   07820069
021014     END-IF.                                                      07830069
021015                                                                  07840069
021016                                                                  07850069
021017***************************************************************** 07860069
021018* PROCESS DATA FROM ASN DETAIL CURSOR AND WRITE THE OUTPUT RECORD 07870069
021019***************************************************************** 07880069
021020 3000-PROCESS-ASN-DTL.                                            07890069
021021     MOVE 'A'                     TO VL041-ACD-INDICATOR.         07900069
021022     MOVE VL043-PO-NBR            TO VL041-PO-NBR.                07910069
021023     MOVE VL043-ASNHDR-NBR        TO VL041-SEQ-NBR.               07920069
021024     MOVE PURCHS-ENT-ID           TO PV-ENT-ID.                   07930069
021025     MOVE PV-ENT-ID-X             TO VL041-ENT-ID.                07940069
021026                                                                  07950069
021027     PERFORM 3100-FETCH-SKU-INFO.                                 07960069
021028                                                                  07970069
021029     MOVE XLT00003-SKU-NBR        TO PV-SKU-NBR.                  07980069
021030     MOVE PV-SKU-NBR-X            TO VL041-SKU-NBR.               07990069
021031     MOVE ASCRIT-ASNCAR-NBR       TO VL041-UCC128-CART-NBR.       08000069
021032     MOVE ASNDTL-LOC-NBR          TO PV-LOC-NBR.                  08010069
021033     MOVE PV-LOC-NBR-X            TO VL041-STORE-NBR.             08020069
021034     MOVE ASNDTL-UPC-NBR          TO PV-UPC-NBR.                  08030069
021035     MOVE PV-UPC-NBR-X            TO VL041-UPC-NBR.               08040069
021036     MOVE SPACES                  TO VL041-CART-QTY-SIGN          08050069
021037                                     VL041-UNIT-COST-SIGN         08060069
021038                                     VL041-UNIT-RTL-SIGN.         08070069
021039     IF  PV-PKG-QTY-NULL = 0                                      08080069
021040         MOVE ASNCAR-PKG-QTY      TO VL041-CART-QTY               08090069
021041     ELSE                                                         08100069
021042         MOVE ASNDTL-SHIPT-QTY    TO VL041-CART-QTY               08110069
021043     END-IF.                                                      08120069
021044     MOVE ZEROS                   TO VL041-UNIT-COST              08130069
021045                                     VL041-UNIT-RTL.              08140069
021046     MOVE SPACES                  TO VL041-PACK-SIZE-SIGN.        08150069
021047     MOVE XLT00003-INNR-PK-QTY    TO VL041-PACK-SIZE.             08160069
021048                                                                  08170069
021049     IF  XLT00003-INNR-PK-QTY > 1                                 08180069
021050         MOVE 'PK'                TO VL041-UNIT-MEASURE           08190069
021051     ELSE                                                         08200069
021052         MOVE 'EA'                TO VL041-UNIT-MEASURE           08210069
021053     END-IF.                                                      08220069
021054                                                                  08230069
021055     MOVE SPACES                  TO VL041-PO-UNIQUE-ADDENDA.     08240069
021056     MOVE 'X'                     TO VL041-ANCHOR-CONSTANT.       08250069
021057                                                                  08260069
021058     PERFORM 8100-WRITE-ASN-DTL-OUTPUT.                           08270069
021059                                                                  08280069
021060     PERFORM 7500-FETCH-DTL-EXTRACT-CURSOR.                       08290069
021061                                                                  08300069
021062                                                                  08310069
021063******************************************************************08320069
021064* FETCH THE ENT-ID INFORMATION FROM THE PURCHASE ORDER TABLE      08330069
021065******************************************************************08340069
021066 3100-FETCH-SKU-INFO.                                             08350069
021067     INITIALIZE DCLXLT00003.                                      08360069
021068                                                                  08370069
021069     PERFORM                                                      08380069
021070         WITH TEST AFTER                                          08390069
021071         VARYING PV-RETRY-COUNTER                                 08400069
021072         FROM 1 BY 1                                              08410069
021073         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08420069
021074                   OR (SQLCODE = ZERO)                            08430069
021075                   OR (SQLCODE = +100))                           08440069
021076         EXEC SQL                                                 08450069
021077             SELECT B.SKU_NBR                                     08460069
021078                  , B.INNR_PK_QTY                                 08470069
021079               INTO :XLT00003-SKU-NBR                             08480069
021080                  , :XLT00003-INNR-PK-QTY                         08490069
021081               FROM XLT_UPC A                                     08500069
021082                  , XLT_SKU B                                     08510069
021083              WHERE UPC_NBR       = :ASNDTL-UPC-NBR               08520069
021084                AND A.INTR_UPC_ID = B.INTR_UPC_ID                 08530069
021085         END-EXEC                                                 08540069
021086         EVALUATE TRUE                                            08550069
021087             WHEN SQLCODE = +0                                    08560069
021088             WHEN SQLCODE = -904                                  08570069
021089             WHEN SQLCODE = -911                                  08580069
021090             WHEN SQLCODE = -913                                  08590069
021091                 CONTINUE                                         08600069
021092             WHEN SQLCODE = +100                                  08610069
021093                 SET PS-SEND-EMAIL    TO TRUE                     08620069
021094                 DISPLAY PV-ASTERISK-LINE                         08630069
021095                 DISPLAY '** SKU NOT FOUND FOR UPC **'            08640069
021096                 DISPLAY '** ASN NUMBER = ' VL043-ASNHDR-NBR      08650069
021097                         '  ** PO NUMBER  = ' VL043-PO-NBR        08660069
021098                 DISPLAY '** CONTAINER = ' ASCRIT-ASNCAR-NBR      08670069
021099                         '  **'                                   08680069
021100                 DISPLAY '** UPC NUMBER = ' ASNDTL-UPC-NBR        08690069
021101                         '  ** LOC NUMBER = ' ASNDTL-LOC-NBR      08700069
021102                         '  **'                                   08710069
021103             WHEN SQLWARN0 NOT EQUAL SPACE                        08720069
021104             WHEN SQLCODE NOT EQUAL ZERO                          08730069
021105                 DISPLAY '** ABEND **'                            08740069
021106                 DISPLAY '** PROGRAM = VLKUT039 **'               08750069
021107                 DISPLAY '** PARAGRAPH = '                        08760069
021108                         '3100-FETCH-SKU-INFO **'                 08770069
021109                 MOVE 'ERROR FETCHING ENT-ID FROM TPURCHS'        08780069
021110                                      TO PV-ERROR-MSG-1           08790069
021111                 MOVE ASNDTL-UPC-NBR  TO PV-UPC-NBR               08800069
021112                 STRING 'ASN NBR: '        DELIMITED BY SIZE      08810069
021113                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      08820069
021114                                    INTO PV-ERROR-MSG-2           08830069
021115                 STRING 'PO NBR: '         DELIMITED BY SIZE      08840069
021116                        VL043-PO-NBR       DELIMITED BY SIZE      08850069
021117                        '  UPC NBR: '      DELIMITED BY SIZE      08860069
021118                        PV-UPC-NBR-X       DELIMITED BY SIZE      08870069
021119                                    INTO PV-ERROR-MSG-3           08880069
021120                 MOVE 'XLT_UPC'       TO PV-ABEND-TABLE-1         08890069
021121                 MOVE 'XLT_SKU'       TO PV-ABEND-TABLE-2         08900069
021122                 PERFORM 9200-SQL-ERROR                           08910069
021123         END-EVALUATE                                             08920069
021124     END-PERFORM.                                                 08930069
021125                                                                  08940069
021126     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08950069
021127         DISPLAY '** ABEND **'                                    08960069
021128         DISPLAY '** PROGRAM = VLKUT039 **'                       08970069
021129         DISPLAY '** PARAGRAPH =  3100-FETCH-SKU-INFO **'         08980069
021130         MOVE 'FETCH ENT ID FROM PO MAX RETRIES ENCOUNTERED'      08990069
021131                                      TO PV-ERROR-MSG-1           09000069
021132         MOVE ASNDTL-UPC-NBR          TO PV-UPC-NBR               09010069
021133         STRING 'ASN NBR: '              DELIMITED BY SIZE        09020069
021134                VL043-ASNHDR-NBR         DELIMITED BY SIZE        09030069
021135                                    INTO PV-ERROR-MSG-2           09040069
021136         STRING 'PO NBR: '               DELIMITED BY SIZE        09050069
021137                VL043-PO-NBR             DELIMITED BY SIZE        09060069
021138                '  UPC NBR: '            DELIMITED BY SIZE        09070069
021139                PV-UPC-NBR-X             DELIMITED BY SIZE        09080069
021140                                    INTO PV-ERROR-MSG-3           09090069
021141         MOVE 'XLT_UPC'               TO PV-ABEND-TABLE-1         09100069
021142         MOVE 'XLT_SKU'               TO PV-ABEND-TABLE-2         09110069
021143         PERFORM 9200-SQL-ERROR                                   09120069
021144     END-IF.                                                      09130069
021145                                                                  09140069
021146                                                                  09150069
021147***************************************************************** 09160069
021148*  WRITE ASN HEADER OUTPUT FILE                                   09170069
021149***************************************************************** 09180069
021150 7000-READ-ASN-EXT-INPUT.                                         09190069
021151     READ VL-ASN-EXT-FILE                                         09200069
021152         INTO VL043-ASN-EXT-RECORD                                09210069
021153            AT END                                                09220069
021154               SET PS-END-EXT-FILE                                09230069
021155                          TO TRUE.                                09240069
021156                                                                  09250069
021157     IF  PS-NOT-END-EXT-FILE                                      09260069
021158         ADD 1            TO PV-ASN-HDR-RECS-READ                 09270069
021159     END-IF.                                                      09280069
021160                                                                  09290069
021170                                                                  09300060
029710******************************************************************09310005
029720* OPEN ASN DETAIL EXTRACT CURSOR                                  09320005
029730******************************************************************09330005
029740 7300-OPEN-DTL-EXTRACT-CURSOR.                                    09340005
029750     PERFORM                                                      09350005
029760         WITH TEST AFTER                                          09360005
029770         VARYING PV-RETRY-COUNTER                                 09370005
029780         FROM 1 BY 1                                              09380005
029790         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09390005
029791                   OR (SQLCODE = ZERO))                           09400005
029792         EXEC SQL                                                 09410005
029793             OPEN DTL-EXTRACT-CSR                                 09420005
029794         END-EXEC                                                 09430005
029795                                                                  09440005
029796         EVALUATE TRUE                                            09450005
029797             WHEN SQLCODE = +0                                    09460005
029798             WHEN SQLCODE = -904                                  09470005
029799             WHEN SQLCODE = -911                                  09480005
029800             WHEN SQLCODE = -913                                  09490005
029801                 CONTINUE                                         09500005
029802             WHEN SQLWARN0 NOT EQUAL SPACE                        09510005
029803             WHEN SQLCODE NOT EQUAL ZERO                          09520005
029804                 DISPLAY '** ABEND **'                            09530005
029805                 DISPLAY '** PROGRAM = VLKUT039 **'               09540005
029806                 DISPLAY '** PARAGRAPH = '                        09550005
029807                         '7300-OPEN-DTL-EXTRACT-CURSOR **'        09560005
029808                 MOVE 'OPEN CURSOR'   TO PV-ERROR-MSG-1           09570048
029809                 MOVE VL043-LOC-NBR   TO PV-LOC-NBR               09580060
029810                 STRING 'ASN NBR: '        DELIMITED BY SIZE      09590048
029811                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      09600060
029812                                    INTO PV-ERROR-MSG-2           09610048
029813                 STRING 'PO NBR: '         DELIMITED BY SIZE      09620048
029814                        VL043-PO-NBR       DELIMITED BY SIZE      09630060
029815                        '  LOC NBR: '      DELIMITED BY SIZE      09640048
029816                        PV-LOC-NBR-X       DELIMITED BY SIZE      09650048
029817                                    INTO PV-ERROR-MSG-3           09660048
029827                 MOVE 'TASNDTL'       TO PV-ABEND-TABLE-1         09670005
029828                 MOVE 'TASCRIT'       TO PV-ABEND-TABLE-2         09680005
029829                 PERFORM 9200-SQL-ERROR                           09690005
029830         END-EVALUATE                                             09700005
029831     END-PERFORM.                                                 09710005
029832                                                                  09720005
029833     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09730005
029834         DISPLAY '** ABEND **'                                    09740005
029835         DISPLAY '** PROGRAM = VLKUT039 **'                       09750005
029836         DISPLAY '** PARAGRAPH =  7300-OPEN-DTL-EXTRACT-CURSOR **'09760005
029837         MOVE 'OPEN CURSOR MAX RETRIES'                           09770005
029838                                      TO PV-ERROR-MSG-1           09780048
029839         MOVE VL043-LOC-NBR           TO PV-LOC-NBR               09790060
029840         STRING 'ASN NBR: '              DELIMITED BY SIZE        09800048
029841                VL043-ASNHDR-NBR         DELIMITED BY SIZE        09810060
029842                                    INTO PV-ERROR-MSG-2           09820048
029843         STRING 'PO NBR: '               DELIMITED BY SIZE        09830048
029844                VL043-PO-NBR             DELIMITED BY SIZE        09840060
029845                '  LOC NBR: '            DELIMITED BY SIZE        09850048
029846                PV-LOC-NBR-X             DELIMITED BY SIZE        09860048
029847                                    INTO PV-ERROR-MSG-3           09870048
029848         MOVE 'TASNDTL'               TO PV-ABEND-TABLE-1         09880005
029849         MOVE 'TASCRIT'               TO PV-ABEND-TABLE-2         09890005
029850         PERFORM 9200-SQL-ERROR                                   09900005
029851     END-IF.                                                      09910005
029852                                                                  09920005
029853                                                                  09930005
029854******************************************************************09940005
029855* CLOSE ASN DETAIL CURSOR                                         09950005
029856******************************************************************09960005
029857 7400-CLOSE-DTL-EXTRACT-CURSOR.                                   09970005
029858     PERFORM                                                      09980005
029859         WITH TEST AFTER                                          09990005
029860         VARYING PV-RETRY-COUNTER                                 10000005
029861         FROM 1 BY 1                                              10010005
029862         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10020005
029863                   OR (SQLCODE = ZERO))                           10030005
029864         EXEC SQL                                                 10040005
029865             CLOSE DTL-EXTRACT-CSR                                10050005
029866         END-EXEC                                                 10060005
029867                                                                  10070005
029868         EVALUATE TRUE                                            10080005
029869             WHEN SQLCODE = +0                                    10090005
029870             WHEN SQLCODE = -904                                  10100005
029871             WHEN SQLCODE = -911                                  10110005
029872             WHEN SQLCODE = -913                                  10120005
029873                 CONTINUE                                         10130005
029874             WHEN SQLWARN0 NOT EQUAL SPACE                        10140005
029875             WHEN SQLCODE NOT EQUAL ZERO                          10150005
029876                 DISPLAY '** ABEND **'                            10160005
029877                 DISPLAY '** PROGRAM = VLKUT039 **'               10170005
029878                 DISPLAY '** PARAGRAPH = '                        10180005
029879                         '7400-CLOSE-DTL-EXTRACT-CURSOR **'       10190005
029880                 MOVE 'CLOSE CURSOR'  TO PV-ERROR-MSG-1           10200048
029881                 MOVE VL043-LOC-NBR   TO PV-LOC-NBR               10210060
029882                 STRING 'ASN NBR: '        DELIMITED BY SIZE      10220048
029883                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      10230060
029884                                    INTO PV-ERROR-MSG-2           10240048
029885                 STRING 'PO NBR: '         DELIMITED BY SIZE      10250048
029886                        VL043-PO-NBR       DELIMITED BY SIZE      10260060
029887                        '  LOC NBR: '      DELIMITED BY SIZE      10270048
029888                        PV-LOC-NBR-X       DELIMITED BY SIZE      10280048
029889                                    INTO PV-ERROR-MSG-3           10290048
029899                 MOVE 'TASNDTL'       TO PV-ABEND-TABLE-1         10300005
029900                 MOVE 'TASCRIT'       TO PV-ABEND-TABLE-2         10310005
029901                 PERFORM 9200-SQL-ERROR                           10320005
029902         END-EVALUATE                                             10330005
029903     END-PERFORM.                                                 10340005
029904                                                                  10350005
029905     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10360005
029906         DISPLAY '** ABEND **'                                    10370005
029907         DISPLAY '** PROGRAM = VLKUT039 **'                       10380005
029908         DISPLAY '** PARAGRAPH = 7400-CLOSE-DTL-EXTRACT-CURSOR **'10390005
029909         MOVE 'CLOSE CURSOR MAX RETRIES'                          10400005
029910                                      TO PV-ERROR-MSG-1           10410048
029911         MOVE VL043-LOC-NBR           TO PV-LOC-NBR               10420060
029912         STRING 'ASN NBR: '              DELIMITED BY SIZE        10430048
029913                VL043-ASNHDR-NBR         DELIMITED BY SIZE        10440060
029914                                    INTO PV-ERROR-MSG-2           10450048
029915         STRING 'PO NBR: '               DELIMITED BY SIZE        10460048
029916                VL043-PO-NBR             DELIMITED BY SIZE        10470060
029917                '  LOC NBR: '            DELIMITED BY SIZE        10480048
029918                PV-LOC-NBR-X             DELIMITED BY SIZE        10490048
029919                                    INTO PV-ERROR-MSG-3           10500048
029920         MOVE 'TASNDTL'               TO PV-ABEND-TABLE-1         10510005
029921         MOVE 'TASCRIT'               TO PV-ABEND-TABLE-2         10520005
029922         PERFORM 9200-SQL-ERROR                                   10530005
029923     END-IF.                                                      10540005
029924                                                                  10550005
029925                                                                  10560005
029926******************************************************************10570005
029927*  FETCH CURSOR                                                   10580005
029928******************************************************************10590005
029929 7500-FETCH-DTL-EXTRACT-CURSOR.                                   10600005
029930     INITIALIZE DCLTASNDTL                                        10610005
029931                DCLTASCRIT.                                       10620005
029932                                                                  10630005
029933     PERFORM                                                      10640005
029934         WITH TEST AFTER                                          10650005
029935         VARYING PV-RETRY-COUNTER                                 10660005
029936         FROM 1 BY 1                                              10670005
029937         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10680005
029938                   OR (SQLCODE = ZERO)                            10690014
029939                   OR (SQLCODE = +100))                           10700014
029940         EXEC SQL                                                 10710005
029941              FETCH DTL-EXTRACT-CSR                               10720005
029942              INTO  :ASNDTL-UPC-NBR                               10730008
029943                  , :ASNDTL-SHIPT-QTY                             10740008
029944                  , :ASNDTL-LOC-NBR                               10750008
029945                  , :ASCRIT-ASNCAR-NBR                            10760008
029946                  , :ASNCAR-PKG-QTY:PV-PKG-QTY-NULL               10770067
029947         END-EXEC                                                 10780005
029948                                                                  10790005
029949         EVALUATE TRUE                                            10800005
029950             WHEN SQLCODE = ZERO                                  10810005
029951             WHEN SQLCODE = -904                                  10820005
029952             WHEN SQLCODE = -911                                  10830005
029953             WHEN SQLCODE = -913                                  10840005
029954                 CONTINUE                                         10850005
029955             WHEN SQLCODE = +100                                  10860005
029956                 SET PS-END-DTL-CSR   TO TRUE                     10870007
029957             WHEN SQLWARN0 NOT EQUAL SPACE                        10880005
029958             WHEN SQLCODE NOT EQUAL ZERO                          10890005
029959                 DISPLAY '** ABEND **'                            10900005
029960                 DISPLAY '** PROGRAM = VLKUT039 **'               10910005
029961                 DISPLAY '** PARAGRAPH = '                        10920005
029962                         '7500-FETCH-DTL-EXTRACT-CURSOR **'       10930005
029963                 MOVE 'FETCH CURSOR'  TO PV-ERROR-MSG-1           10940048
029964                 MOVE VL043-LOC-NBR   TO PV-LOC-NBR               10950060
029965                 STRING 'ASN NBR: '        DELIMITED BY SIZE      10960048
029966                        VL043-ASNHDR-NBR   DELIMITED BY SIZE      10970060
029967                                    INTO PV-ERROR-MSG-2           10980048
029968                 STRING 'PO NBR: '         DELIMITED BY SIZE      10990048
029969                        VL043-PO-NBR       DELIMITED BY SIZE      11000060
029970                        '  LOC NBR: '      DELIMITED BY SIZE      11010048
029971                        PV-LOC-NBR-X       DELIMITED BY SIZE      11020048
029972                                    INTO PV-ERROR-MSG-3           11030048
029973                 MOVE 'TASNDTL'       TO PV-ABEND-TABLE-1         11040005
029974                 MOVE 'TASCRIT'       TO PV-ABEND-TABLE-2         11050005
029975                 PERFORM 9200-SQL-ERROR                           11060005
029993         END-EVALUATE                                             11070005
029994     END-PERFORM.                                                 11080005
029995                                                                  11090005
029996     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11100005
029997         DISPLAY '** ABEND **'                                    11110005
029998         DISPLAY '** PROGRAM = VLKUT039 **'                       11120005
029999         DISPLAY '** PARAGRAPH = 7500-FETCH-DTL-EXTRACT-CURSOR **'11130005
030000         MOVE 'FETCH CURSOR MAX RETRIES'                          11140005
030001                                      TO PV-ERROR-MSG-1           11150048
030002         MOVE VL043-LOC-NBR           TO PV-LOC-NBR               11160060
030004         STRING 'ASN NBR: '              DELIMITED BY SIZE        11170048
030005                VL043-ASNHDR-NBR         DELIMITED BY SIZE        11180060
030006                                    INTO PV-ERROR-MSG-2           11190048
030007         STRING 'PO NBR: '               DELIMITED BY SIZE        11200048
030008                VL043-PO-NBR             DELIMITED BY SIZE        11210060
030009                '  LOC NBR: '            DELIMITED BY SIZE        11220048
030010                PV-LOC-NBR-X             DELIMITED BY SIZE        11230048
030011                                    INTO PV-ERROR-MSG-3           11240048
030012         MOVE 'TASNDTL'               TO PV-ABEND-TABLE-1         11250005
030013         MOVE 'TASCRIT'               TO PV-ABEND-TABLE-2         11260005
030014         PERFORM 9200-SQL-ERROR                                   11270005
030015     END-IF.                                                      11280005
030016                                                                  11290005
030017                                                                  11300005
030051***************************************************************** 11310063
030052*  WRITE ASN HEADER OUTPUT FILE                                   11320063
030060***************************************************************** 11330063
030100 8000-WRITE-ASN-HDR-OUTPUT.                                       11340003
030200     WRITE VL-ASN-HDR-RECORD                                      11350003
030210         FROM VL040-ASN-HDR-RECORD.                               11360003
030300                                                                  11370000
030400     ADD 1                TO PV-ASN-HDR-RECS-WRITTEN.             11380003
030500                                                                  11390000
030501                                                                  11400005
030502***************************************************************** 11410005
030503*  WRITE ASN DETAIL OUTPUT FILE                                   11420005
030504***************************************************************** 11430005
030505 8100-WRITE-ASN-DTL-OUTPUT.                                       11440005
030506     WRITE VL-ASN-DTL-RECORD                                      11450005
030507         FROM VL041-ASN-DTL-RECORD.                               11460005
030508                                                                  11470005
030509     ADD 1                TO PV-ASN-DTL-RECS-WRITTEN.             11480005
030510                                                                  11490005
030511                                                                  11500005
030512***************************************************************** 11510005
030520*  CREATE MARKER FILE - BECAUSE 2 FILES ARE CREATED - 2 MARKER    11520004
030521*     RECORDS NEED TO BE WRITTEN                                  11530004
030530***************************************************************** 11540004
030540 8500-CREATE-MARKER.                                              11550004
030560     MOVE 'ASNHDR.DAT '   TO PV-ASN-DAT.                          11560004
030570     MOVE PV-FILE-NAME    TO VL029-FILE-NAME.                     11570004
030580     MOVE PV-ASN-HDR-RECS-WRITTEN  TO VL029-RECORD-COUNT.         11580004
030593                                                                  11590004
030594     WRITE VL-MARKER-RECORD FROM VL029-MARKER-RECORD.             11600004
030595                                                                  11610004
030597     MOVE 'ASNDETL.DAT'   TO PV-ASN-DAT.                          11620004
030598     MOVE PV-FILE-NAME    TO VL029-FILE-NAME.                     11630004
030599     MOVE PV-ASN-DTL-RECS-WRITTEN TO VL029-RECORD-COUNT.          11640004
030603                                                                  11650004
030604     WRITE VL-MARKER-RECORD FROM VL029-MARKER-RECORD.             11660004
030605                                                                  11670004
030610***************************************************************** 11680004
030700*  END OF JOB PROCESSING                                          11690000
030800***************************************************************** 11700000
030900 9000-EOJ.                                                        11710000
031002***** FILL IN COMMON FIELDS FOR MARKER FILE  *************        11720004
031003     MOVE PV-RUN-DATE-CN  TO PV-CREATE-DATE.                      11730004
031004     MOVE PV-RUN-DATE-CN  TO VL029-BUILD-DATE.                    11740004
031005     MOVE PV-RUN-TIME-CN  TO VL029-BUILD-TIME.                    11750004
031006     MOVE 'X'             TO VL029-ANCHOR-CONSTANT.               11760004
031007     PERFORM 8500-CREATE-MARKER.                                  11770004
031008                                                                  11780004
031110     DISPLAY PV-ASTERISK-LINE                                     11790044
031200     DISPLAY 'ASN HEADER RECORDS READ    ===>  '                  11800017
031201              PV-ASN-HDR-RECS-READ.                               11810017
031202     DISPLAY 'ASN HEADER RECORDS WRITTEN ===>  '                  11820017
031203              PV-ASN-HDR-RECS-WRITTEN.                            11830017
031210     DISPLAY 'ASN DETAIL RECORDS WRITTEN ===>  '                  11840003
031220              PV-ASN-DTL-RECS-WRITTEN.                            11850003
031300                                                                  11860000
031400     CLOSE VL-ASN-HDR-FILE                                        11870003
031410           VL-ASN-DTL-FILE                                        11880004
031420           VL-MARKER-FILE.                                        11890004
031421                                                                  11900034
031430*    SET RETURN CODE IF E-MAIL SWITCH IS TRUE.                    11910034
031440***  IF PS-SEND-EMAIL                                             11920092
031450***      MOVE 4095 TO RETURN-CODE                                 11930092
031460***  END-IF.                                                      11940092
031500                                                                  11950000
031600                                                                  11960000
031700***************************************************************** 11970000
031800*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             11980000
031900***************************************************************** 11990000
032000 9200-SQL-ERROR.                                                  12000000
032100     CLOSE VL-ASN-HDR-FILE                                        12010003
032110           VL-ASN-DTL-FILE                                        12020004
032120           VL-MARKER-FILE.                                        12030004
032200                                                                  12040000
032300     MOVE SQLCODE                     TO SQLCODE2.                12050000
032400     MOVE SQLERRD(3)                  TO SQLERRD3.                12060000
032500                                                                  12070000
032600     DISPLAY '** ABEND **         ** = SQLERROR'.                 12080000
032700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PGM-VLKUT039.        12090009
032800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   12100000
032900     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                12110000
033000     DISPLAY '**           ** = ' PV-ABEND-TABLE-1.               12120000
033100     DISPLAY '**           ** = ' PV-ABEND-TABLE-2.               12130000
033200     DISPLAY '**           ** = ' PV-ABEND-TABLE-3.               12140000
033210     DISPLAY '**           ** = ' PV-ABEND-TABLE-4.               12150007
033220     DISPLAY '**           ** = ' PV-ABEND-TABLE-5.               12160007
033300     DISPLAY '**           ** = ' PV-ERROR-MSG-1                  12170048
033310     DISPLAY '**           ** = ' PV-ERROR-MSG-2                  12180048
033320     DISPLAY '**           ** = ' PV-ERROR-MSG-3                  12190048
033400                                                                  12200000
033500     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                12210000
033600     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                12220000
033700     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 12230000
033800     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                12240000
033900                                                                  12250000
034000     COPY DPPD004.                                                12260000
034100                                                                  12270000
034200     MOVE +4013                       TO PV-ABEND-CODE.           12280000
034300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12290000
034400                                                                  12300000
034500*************  END OF VLKUT039  ********************************  12310001
