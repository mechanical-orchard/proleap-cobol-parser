000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKRP009.                                    00020000
000300 AUTHOR.             DAVID COLOMBO - COMPUWARE.                   00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       MARCH 2000.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900* THIS PROGRAM WILL PRODUCE THE STORED VALUE GIFTCARD LISTING BY *00090000
001000*   CONTROL NUMBER.                                              *00100000
001100*                                                                *00110000
001200* THE PURPOSE OF THIS REPORT IS TO SHOW THE ACTIVITY OF EACH     *00120000
001300* AUTHORIZER THAT WAS INVOLVED IN VOIDING, ISSUING OR TENDERING  *00130000
001400* A GIFTCARD. THE REPORT WILL BE IN CONTROL NUMBER ORDER BY EACH *00140000
001500* AUTHORIZER.                                                    *00150000
001600*                                                                *00160000
001700* ALL TRANSACTIONS WITH A TRN-VOID-IND OF 'Y' AND A TRN-RVRSL-CDE*00170000
001800* OF '0' WILL NOT BE INDICATED AS A VOID ON THE REPORT.          *00180000
001900******************************************************************00190000
002000**  REVISIONS:                                                  **00200000
002100* 03/31/02 - JACK WICZEK                                         *00210000
002200*   MAKE CHANGES APPROPRIATE DUE TO DATABASE CHANGES FOR         *00220000
002300*   MULTI-CHANNEL GIFT CARD PROJECT.                             *00230000
002310* 06/08/09 - ROLF NOHE                                           *00231000
002320*   PROJECT 2317 - GIFT CARD NUMBERING TO 30 DIGITS.             *00232000
002330*   RECOMPILE TO PICK UP CHANGES TO SVWS004.                     *00233000
002400******************************************************************00234002
W3540C* REQUIREMENT   : PAYMENT RELATED CHANGES FOR FSH PROJECT        *00236000
W3540C* PROJECT ID    : W3540C                                         *00237000
W3540C* AUTHOR        : COGNIZANT                                      *00238000
W3540C* DATES CHANGED : 15-OCT-2012                                    *00239000
W3540C* CHANGES MADE  : THE CR-CONTROL-RECORD FORMAT IS CHANGED TO     *00240000
W3540C* TIMESTAMP FORMAT CCYY-MM-DD-HH.MM.SS.TTTTTT                    *00241017
W3540C* CCYY-MM-DD-HH.MM.SS.TTTTTT R, WHERE R IS THE RESTART VARIABLE  *00241117
W3540C* PASSED TO THE PROGRAM AND THE CORRESPONDING CHANGES ARE DONE   *00241217
W3540C* TO PV-TODAYS-TIMESTAMP,PV-TOMORROWS-TIMESTAMP                  *00242017
W3540C* AND REPORT-SUBTITLE-LINE RECORD.                               *00244017
W3540C*                                                                *00245017
W3540C* THE CONTROL CARD SVCC106 HAS RESTART VARIABLE AT COL 55.       *00245117
W3540C*                                                                *00245217
W3540C* NORMAL BATCH:                                                  *00245317
W3540C* IF THE RESTART VARIABLE NOT 'R', THE PROGRAM WILL USE THE      *00245417
W3540C* TIMESTAMP FROM SVCC106. THE CONTROL CARD TIMESTAMP IS MOVED TO *00245517
W3540C* THE TODAY'S TIMESTAMP AND THE CURRENT SYSTEM TIMESTAMP IS MOVED*00245617
W3540C* TO TOMORROW'S TIMESTAMP AT END OF PROCESS.  DATES IN CONTROL   *00245717
W3540C* CARD SVCC106 ARE UPDATED FOR NEXT BATCH RUN.                   *00245817
W3540C*                                                                *00246017
W3540C* RERUN:                                                         *00246117
W3540C* IF THE RESTART VARIABLE IS 'R', THEN THE END DATE FROM THE     *00246217
W3540C* CONTROL CARD IS MOVED TO TOMORROW'S TIMESTAMP.                 *00246317
W3540C* THIS TIMESTAMP IS USED IN KMRC-CSR CURSOR.  DATES IN           *00246417
W3540C* CONTROL CARD SVCC106 ARE NOT UPDATED.                          *00246517
W3540C******************************************************************00246600
002500 ENVIRONMENT DIVISION.                                            00247000
002600******************************************************************00248000
002700 CONFIGURATION SECTION.                                           00249000
002800                                                                  00250000
002900 SOURCE-COMPUTER.    IBM-3090.                                    00260000
003000 OBJECT-COMPUTER.    IBM-3090.                                    00270000
003100                                                                  00280000
003200 INPUT-OUTPUT SECTION.                                            00290000
003300                                                                  00300000
003400 FILE-CONTROL.                                                    00310000
003500                                                                  00320000
003600     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00330000
003700     SELECT REPORT-FILE               ASSIGN TO RPT01.            00340000
003800                                                                  00350000
003900******************************************************************00360000
004000 DATA DIVISION.                                                   00370000
004100******************************************************************00380000
004200                                                                  00390000
004300 FILE SECTION.                                                    00400000
004400                                                                  00410000
004500                                                                  00420000
004600 FD  CONTROL-DATE-FILE                                            00430000
004700     RECORDING MODE IS F                                          00440000
004800     BLOCK CONTAINS 0 RECORDS                                     00450000
004900     LABEL RECORDS ARE OMITTED.                                   00460000
005000                                                                  00470000
005100 01  CONTROL-DATE-RECORD              PIC X(80).                  00480000
005200                                                                  00490000
005300 FD  REPORT-FILE                                                  00500000
005400     RECORDING MODE IS F                                          00510000
005500     BLOCK CONTAINS 0 RECORDS                                     00520000
005600     LABEL RECORDS ARE OMITTED.                                   00530000
005700                                                                  00540000
005800 01  REPORT-RECORD                    PIC X(132).                 00550000
005900                                                                  00560000
006000                                                                  00570000
006100 WORKING-STORAGE SECTION.                                         00580000
006200                                                                  00590000
006300 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.00600000
006400                                                                  00610000
006500******************************************************************00620000
W3540C*    CR-CONTROL RECORD   DATE IN CCYY-MM-DD-HH.MM.SS.TTTTTT      *00630006
006700******************************************************************00640000
006800 01  CR-CONTROL-RECORD.                                           00650000
W3540C     05  CR-CONTROL-BEG-DATE.                                     00660008
W3540C         10  CR-BEG-CC                PIC  X(02)    VALUE SPACES. 00670008
W3540C         10  CR-BEG-YY                PIC  X(02)    VALUE SPACES. 00680008
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00690008
W3540C         10  CR-BEG-MM                PIC  X(02)    VALUE SPACES. 00700008
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00710008
W3540C         10  CR-BEG-DD                PIC  X(02)    VALUE SPACES. 00720008
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00730000
W3540C         10  CR-BEG-HH                PIC  X(02)    VALUE SPACES. 00740000
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00750000
W3540C         10  CR-BEG-MIN               PIC  X(02)    VALUE SPACES. 00751009
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00752000
W3540C         10  CR-BEG-SS                PIC  X(02)    VALUE SPACES. 00753000
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00754000
W3540C         10  CR-BEG-TTTTTT            PIC  X(06)    VALUE SPACES. 00755000
W3540C     05  FILLER                       PIC  X(01)    VALUE SPACES. 00756008
W3540C     05  CR-CONTROL-END-DATE.                                     00757008
W3540C         10  CR-END-CC                PIC  X(02)    VALUE SPACES. 00757108
W3540C         10  CR-END-YY                PIC  X(02)    VALUE SPACES. 00757208
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00757308
W3540C         10  CR-END-MM                PIC  X(02)    VALUE SPACES. 00757408
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00757508
W3540C         10  CR-END-DD                PIC  X(02)    VALUE SPACES. 00757608
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00757708
W3540C         10  CR-END-HH                PIC  X(02)    VALUE SPACES. 00757808
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00757908
W3540C         10  CR-END-MM                PIC  X(02)    VALUE SPACES. 00758008
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00758108
W3540C         10  CR-END-SS                PIC  X(02)    VALUE SPACES. 00758208
W3540C         10  FILLER                   PIC  X(01)    VALUE SPACES. 00758308
W3540C         10  CR-END-TTTTTT            PIC  X(06)    VALUE SPACES. 00758408
W3540C     05  FILLER                       PIC  X(01)    VALUE SPACES. 00758508
W3540C     05  CR-RESTART-IND               PIC  X(01)    VALUE SPACES. 00758608
W3540C     05  FILLER                       PIC  X(25)    VALUE SPACES. 00758708
007700                                                                  00758808
007800******************************************************************00759000
007900*    PC-PROGRAM CONSTANTS                                        *00760000
008000******************************************************************00770000
008100 01  PC-PROGRAM-CONSTANTS.                                        00780000
008200     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        00790000
008300                                                      'SVKRP009'. 00800000
008400     05  PC-CALENDAR-PGM              PIC  X(08)     VALUE        00810000
008500                                                    'DPKUT500'.   00820000
008600     05  PC-HYPHEN                    PIC  X(01)     VALUE '-'.   00830000
008700     05  PC-ONE                       PIC  9(01)     VALUE 1.     00840000
008800     05  PC-TWO                       PIC  9(01)     VALUE 2.     00850000
008900     05  PC-HEADER-LINE-COUNT         PIC S9(03)     VALUE +9     00860000
009000                                                     COMP.        00870000
009100     05  PC-MAX-LINES-PER-PAGE        PIC S9(03)     VALUE +60    00880000
009200                                                     COMP.        00890000
009300     05  PC-DAYS-TO-INCREMENT         PIC 9(04)      VALUE 1.     00900000
009400                                                                  00910000
009500******************************************************************00920000
009600*    RESPROGRAM VARIABLES                                        *00930000
009700******************************************************************00940000
009800 01  PV-PROGRAM-VARIABLES.                                        00950000
009900     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00960000
010000     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.00970000
010100                                                                  00980000
010200     05  PV-CURRENT-DATE.                                         00990000
010300         10  PV-CURRENT-YEAR          PIC  9(04)     VALUE ZERO.  01000000
010400         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01010000
010500         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01020000
010600     05  PV-CURRENT-TIME.                                         01030000
010700         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01040000
010800         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01050000
010900         10  FILLER                   PIC  9(04)     VALUE ZERO.  01060000
011000     05  PV-TODAYS-TIMESTAMP-DETAIL.                              01070000
011100         10  PV-TODAYS-CC             PIC  X(02).                 01080000
011200         10  PV-TODAYS-YY             PIC  X(02).                 01090000
011300         10  FILLER                   PIC  X(01)     VALUE '-'.   01100000
011400         10  PV-TODAYS-MM             PIC  X(02).                 01110000
011500         10  FILLER                   PIC  X(01)     VALUE '-'.   01120000
011600         10  PV-TODAYS-DD             PIC  X(02).                 01130000
011700         10  FILLER                   PIC  X(01)     VALUE '-'.   01140000
W3540C         10  PV-TODAYS-BEG-HH         PIC  X(02)     VALUE SPACES.01160000
011900         10  FILLER                   PIC  X(01)     VALUE '.'.   01170000
W3540C         10  PV-TODAYS-BEG-MM         PIC  X(02)     VALUE SPACES.01190000
012100         10  FILLER                   PIC  X(01)     VALUE '.'.   01200000
W3540C         10  PV-TODAYS-BEG-SS         PIC  X(02)     VALUE SPACES.01220000
012300         10  FILLER                   PIC  X(01)     VALUE '.'.   01230000
012400         10  PV-TODAYS-BEG-TTTTTT     PIC  X(06)     VALUE        01240000
W3540C                                                     SPACES.      01251000
012600     05  PV-TODAYS-TIMESTAMP REDEFINES PV-TODAYS-TIMESTAMP-DETAIL 01252000
012700                                      PIC  X(26).                 01253000
012800                                                                  01254000
012900     05  PV-TOMORROWS-TIMESTAMP-DTL.                              01255000
013000         10  PV-TOMORROWS-YYYY        PIC  X(04).                 01256000
013100         10  FILLER                   PIC  X(01)     VALUE '-'.   01257000
013200         10  PV-TOMORROWS-MM          PIC  X(02).                 01258000
013300         10  FILLER                   PIC  X(01)     VALUE '-'.   01259000
013400         10  PV-TOMORROWS-DD          PIC  X(02).                 01260000
013500         10  FILLER                   PIC  X(01)     VALUE '-'.   01270000
W3540C         10  PV-TOMORROWS-BEG-HH      PIC  X(02)     VALUE SPACES.01290000
013700         10  FILLER                   PIC  X(01)     VALUE '.'.   01300000
W3540C         10  PV-TOMORROWS-BEG-MM      PIC  X(02)     VALUE SPACES.01320000
013900         10  FILLER                   PIC  X(01)     VALUE '.'.   01330000
W3540C         10  PV-TOMORROWS-BEG-SS      PIC  X(02)     VALUE SPACES.01350000
014100         10  FILLER                   PIC  X(01)     VALUE '.'.   01360000
014200         10  PV-TOMORROWS-BEG-TTTTTT  PIC  X(06)     VALUE        01370000
W3540C                                                     SPACES.      01390000
014400     05  PV-TOMORROWS-TIMESTAMP REDEFINES                         01400000
014500         PV-TOMORROWS-TIMESTAMP-DTL   PIC  X(26).                 01410000
014600                                                                  01420000
W3540C     05  PV-CURRENT-TIMESTAMP         PIC  X(26)     VALUE SPACES.01421001
015200                                                                  01480000
015300     05  PV-DATE-RETURNED-FROM-ROUTINE.                           01490000
015400         10  PV-DATE-RETURNED-CCYY    PIC  X(04)     VALUE ZERO.  01500000
015500         10  FILLER                   PIC  X(01)     VALUE '-'.   01510000
015600         10  PV-DATE-RETURNED-MM      PIC  X(02)     VALUE ZERO.  01520000
015700         10  FILLER                   PIC  X(01)     VALUE '-'.   01530000
015800         10  PV-DATE-RETURNED-DD      PIC  X(02)     VALUE ZERO.  01540000
015900                                                                  01550000
016000     05  PV-TRN-AUTH-TMST.                                        01560000
016100         10  PV-AUTH-DATE.                                        01570000
016200             15  PV-AUTH-DATE-CC      PIC  X(02).                 01580000
016300             15  PV-AUTH-DATE-YY      PIC  X(02).                 01590000
016400             15  FILLER               PIC  X(01).                 01600000
016500             15  PV-AUTH-DATE-MM      PIC  X(02).                 01610000
016600             15  FILLER               PIC  X(01).                 01620000
016700             15  PV-AUTH-DATE-DD      PIC  X(02).                 01630000
016800         10  FILLER                   PIC  X(01).                 01640000
016900         10  PV-AUTH-TIME             PIC  X(08).                 01650000
017000         10  FILLER                   PIC  X(07).                 01660000
017100                                                                  01670000
017200     05  PV-ISSUE-DATE-TMST-DTL.                                  01680000
017300         10  PV-ISSUE-DATE.                                       01690000
017400             15  PV-ISSUE-DATE-CC     PIC  X(02).                 01700000
017500             15  PV-ISSUE-DATE-YY     PIC  X(02).                 01710000
017600             15  FILLER               PIC  X(01)     VALUE '-'.   01720000
017700             15  PV-ISSUE-DATE-MM     PIC  X(02).                 01730000
017800             15  FILLER               PIC  X(01)     VALUE '-'.   01740000
017900             15  PV-ISSUE-DATE-DD     PIC  X(02).                 01750000
018000         10  FILLER                   PIC  X(16).                 01760000
018100     05  PV-ISSUE-DATE-TMST     REDEFINES                         01770000
018200         PV-ISSUE-DATE-TMST-DTL       PIC  X(26).                 01780000
018300                                                                  01790000
018400     05  PV-HOLD-APVL-USR-ID          PIC  X(08)     VALUE SPACES.01800000
018500     05  PV-CRD-NBR                   PIC  S9(12)    COMP-3.      01810000
018600                                                                  01820000
018700******************************************************************01830000
018800*    PS-PROGRAM SWITCHES                                         *01840000
018900******************************************************************01850000
019000 01  PS-PROGRAM-SWITCHES.                                         01860000
019100     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   01870000
019200         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   01880000
019300     05  PS-END-OF-KMRC-CSR-SW        PIC  X(01)     VALUE 'N'.   01890000
019400         88  PS-END-OF-KMRC-CSR                      VALUE 'Y'.   01900000
019500         88  PS-NOT-END-OF-KMRC-CSR                  VALUE 'N'.   01910000
019600     05  PS-FIRST-FETCH-SW            PIC  X(01)     VALUE 'N'.   01920000
019700         88  PS-FIRST-FETCH                          VALUE 'Y'.   01930000
019800         88  PS-NOT-FIRST-FETCH                      VALUE 'N'.   01940000
019900     05  PS-VALID-AUTH-SW             PIC  X(01)     VALUE 'N'.   01950000
020000         88  PS-NOT-VALID-AUTH                       VALUE 'N'.   01960000
020100         88  PS-VALID-AUTH                           VALUE 'Y'.   01970000
020200     05  PS-TOTALS-SW                 PIC  X(01)     VALUE 'N'.   01980000
020300         88  PS-TOTALS                               VALUE 'Y'.   01990000
020400                                                                  02000000
020500******************************************************************02010000
020600*    PA-PROGRAM ACCUMULATORS                                     *02020000
020700******************************************************************02030000
020800 01  PA-PROGRAM-ACCUMULATORS.                                     02040000
020900     05  PA-TOTAL-AUTHORIZERS         PIC S9(11)     COMP-3       02050000
021000                                                     VALUE ZEROES.02060000
021100     05  PA-GRAND-AUTH-NUM            PIC S9(11)     COMP-3       02070000
021200                                                     VALUE ZEROES.02080000
021300     05  PA-AUTH-TOTAL-ISSUES         PIC S9(6)V99   COMP-3       02090000
021400                                                     VALUE ZEROES.02100000
021500     05  PA-AUTH-TOTAL-ISSUE-VOIDS    PIC S9(6)V99   COMP-3       02110000
021600                                                     VALUE ZEROES.02120000
021700     05  PA-AUTH-TOTAL-TENDERS        PIC S9(6)V99   COMP-3       02130000
021800                                                     VALUE ZEROES.02140000
021900     05  PA-AUTH-TOTAL-TENDER-VOIDS   PIC S9(6)V99   COMP-3       02150000
022000                                                     VALUE ZEROES.02160000
022100     05  PA-AUTH-TOTAL-FEE-VOIDS      PIC S9(6)V99   COMP-3       02170000
022200                                                     VALUE ZEROES.02180000
022300     05  PA-TRANS-TOTAL-ISSUES        PIC S9(6)V99   COMP-3       02190000
022400                                                     VALUE ZEROES.02200000
022500     05  PA-TRANS-TOTAL-ISSUE-VOIDS   PIC S9(6)V99   COMP-3       02210000
022600                                                     VALUE ZEROES.02220000
022700     05  PA-TRANS-TOTAL-TENDERS       PIC S9(6)V99   COMP-3       02230000
022800                                                     VALUE ZEROES.02240000
022900     05  PA-TRANS-TOTAL-TENDER-VOIDS  PIC S9(6)V99   COMP-3       02250000
023000                                                     VALUE ZEROES.02260000
023100     05  PA-AUTH-NUM-ISSUES           PIC S9(11)     COMP-3       02270000
023200                                                     VALUE ZEROES.02280000
023300     05  PA-AUTH-NUM-ISSUE-VOIDS      PIC S9(11)     COMP-3       02290000
023400                                                     VALUE ZEROES.02300000
023500     05  PA-AUTH-NUM-TENDERS          PIC S9(11)     COMP-3       02310000
023600                                                     VALUE ZEROES.02320000
023700     05  PA-AUTH-NUM-TENDER-VOIDS     PIC S9(11)     COMP-3       02330000
023800                                                     VALUE ZEROES.02340000
023900     05  PA-AUTH-NUM-FEE-VOIDS        PIC S9(11)     COMP-3       02350000
024000                                                     VALUE ZEROES.02360000
024100     05  PA-TRANS-NUM-ISSUES          PIC S9(11)     COMP-3       02370000
024200                                                     VALUE ZEROES.02380000
024300     05  PA-TRANS-NUM-ISSUE-VOIDS     PIC S9(11)     COMP-3       02390000
024400                                                     VALUE ZEROES.02400000
024500     05  PA-TRANS-NUM-TENDER          PIC S9(11)     COMP-3       02410000
024600                                                     VALUE ZEROES.02420000
024700     05  PA-TRANS-NUM-TENDER-VOIDS    PIC S9(11)     COMP-3       02430000
024800                                                     VALUE ZEROES.02440000
024900     05  PA-TRANS-NUM-FEE-VOIDS       PIC S9(11)     COMP-3       02450000
025000                                                     VALUE ZEROES.02460000
025100     05  PA-GFT-CRD-RECS-READ         PIC S9(11)     COMP-3       02470000
025200                                                     VALUE ZEROES.02480000
025300     05  PA-LINE-COUNTER-GFT-CRD      PIC S9(11)     COMP-3       02490000
025400                                                     VALUE ZEROES.02500000
025500     05  PA-PAGE-COUNTER-GFT-CRD      PIC S9(11)     COMP-3       02510000
025600                                                     VALUE ZEROES.02520000
025700******************************************************************02530000
025800*    STANDARD HEADER FOR 132 COLUMN REPORT                       *02540000
025900******************************************************************02550000
026000     COPY DPWS132.                                                02560000
026100                                                                  02570000
026200 01  REPORT-TITLE-LINE.                                           02580000
026300     05  FILLER                         PIC  X(43)   VALUE SPACES.02590000
026400     05  FILLER                         PIC  X(48)   VALUE        02600000
026500         'STORED VALUE GIFTCARD LISTING BY CONTROL NUMBER'.       02610000
026600     05  FILLER                         PIC  X(41)   VALUE SPACES.02620000
026700                                                                  02630000
026800 01  REPORT-SUBTITLE-LINE.                                        02640000
W3540C     05  FILLER                         PIC  X(32)   VALUE SPACES.02651002
027000     05  FILLER                         PIC  X(12)   VALUE        02660000
027100         'SALE DATE:  '.                                          02670000
W3540C     05  RSL-SALE-BEG-DATE-MM           PIC  X(02)   VALUE SPACES.02740000
W3540C     05  FILLER                         PIC  X(01)   VALUE '/'.   02750000
W3540C     05  RSL-SALE-BEG-DATE-DD           PIC  X(02)   VALUE SPACES.02760000
W3540C     05  FILLER                         PIC  X(01)   VALUE '/'.   02770000
W3540C     05  RSL-SALE-BEG-DATE-CC           PIC  X(02)   VALUE SPACES.02771000
W3540C     05  RSL-SALE-BEG-DATE-YY           PIC  X(02)   VALUE SPACES.02772000
W3540C     05  FILLER                         PIC  X(01)   VALUE '-'.   02773000
W3540C     05  RSL-SALE-BEG-TIME-HH           PIC  X(02)   VALUE SPACES.02774000
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02775000
W3540C     05  RSL-SALE-BEG-TIME-MM           PIC  X(02)   VALUE SPACES.02776000
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02777000
W3540C     05  RSL-SALE-BEG-TIME-SS           PIC  X(02)   VALUE SPACES.02778000
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02778100
W3540C     05  RSL-SALE-BEG-TIME-TTTTTT       PIC  X(06)   VALUE SPACES.02778200
W3540C     05  FILLER                         PIC  X(05)   VALUE        02778300
W3540C                                                     ' TO: '.     02778400
W3540C     05  RSL-SALE-END-DATE-MM           PIC  X(02)   VALUE SPACES.02778500
W3540C     05  FILLER                         PIC  X(01)   VALUE '/'.   02778600
W3540C     05  RSL-SALE-END-DATE-DD           PIC  X(02)   VALUE SPACES.02778700
W3540C     05  FILLER                         PIC  X(01)   VALUE '/'.   02778800
W3540C     05  RSL-SALE-END-DATE-CC           PIC  X(02)   VALUE SPACES.02778900
W3540C     05  RSL-SALE-END-DATE-YY           PIC  X(02)   VALUE SPACES.02779000
W3540C     05  FILLER                         PIC  X(01)   VALUE '-'.   02779100
W3540C     05  RSL-SALE-END-TIME-HH           PIC  X(02)   VALUE SPACES.02779200
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02779300
W3540C     05  RSL-SALE-END-TIME-MM           PIC  X(02)   VALUE SPACES.02779400
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02779500
W3540C     05  RSL-SALE-END-TIME-SS           PIC  X(02)   VALUE SPACES.02779600
W3540C     05  FILLER                         PIC  X(01)   VALUE '.'.   02779700
W3540C     05  RSL-SALE-END-TIME-TTTTTT       PIC  X(06)   VALUE SPACES.02779800
W3540C     05  FILLER                         PIC  X(31)   VALUE SPACES.02780002
027900                                                                  02781002
028000 01  REPORT-AUTH-HEADER-LINE.                                     02790000
028100     05  FILLER                         PIC  X(02)   VALUE SPACES.02800000
028200     05  RAHL-AUTHORIZER-NUMBER         PIC  X(08)   VALUE SPACES.02810000
028300     05  FILLER                         PIC  X(01)   VALUE SPACES.02820000
028400     05  RAHL-HYPHEN                    PIC  X(01)   VALUE SPACES.02830000
028500     05  FILLER                         PIC  X(01)   VALUE SPACES.02840000
028600     05  RAHL-NAME                      PIC  X(25)   VALUE SPACES.02850000
028700     05  FILLER                         PIC  X(94)   VALUE SPACES.02860000
028800******************************************************************02870000
028900*    HEADERS                                                     *02880000
029000******************************************************************02890000
029100 01  REPORT-DETAIL-HEADER-1.                                      02900000
029200     05  FILLER                         PIC  X(05)   VALUE SPACES.02910000
029300     05  FILLER                         PIC  X(07)   VALUE        02920000
029400         'CONTROL'.                                               02930000
029500     05  FILLER                         PIC  X(37)   VALUE SPACES.02940000
029510     05  FILLER                         PIC  X(11)   VALUE        02950000
029511         'MOST RECENT'.                                           02951000
029520     05  FILLER                         PIC  X(51)   VALUE SPACES.02952000
029600     05  FILLER                         PIC  X(08)   VALUE        02953000
029700         'ACTIVITY'.                                              02954000
029800     05  FILLER                         PIC  X(13)   VALUE SPACES.02955000
029900                                                                  02956000
030000 01  REPORT-DETAIL-HEADER-2.                                      02957000
030100     05  FILLER                         PIC  X(05)   VALUE SPACES.02958000
030200     05  FILLER                         PIC  X(06)   VALUE        02959000
030300         'NUMBER'.                                                02960000
030400     05  FILLER                         PIC  X(13)   VALUE SPACES.02970000
030500     05  FILLER                         PIC  X(07)   VALUE        02980000
030600         'CARD ID'.                                               02990000
030700     05  FILLER                         PIC  X(05)   VALUE SPACES.03000000
030800     05  FILLER                         PIC  X(09)   VALUE        03010000
030900         'CARD TYPE'.                                             03020000
031000     05  FILLER                         PIC  X(04)   VALUE SPACES.03030000
031100     05  FILLER                         PIC  X(10)   VALUE        03040000
031200         'ISSUE DATE'.                                            03050000
031300     05  FILLER                         PIC  X(04)   VALUE SPACES.03060000
031400     05  FILLER                         PIC  X(05)   VALUE        03070000
031500         'STORE'.                                                 03080000
031600     05  FILLER                         PIC  X(03)   VALUE SPACES.03090000
031700     05  FILLER                         PIC  X(08)   VALUE        03100000
031800         'TERMINAL'.                                              03110000
031900     05  FILLER                         PIC  X(03)   VALUE SPACES.03120000
032000     05  FILLER                         PIC  X(11)   VALUE        03130000
032100         'TRANSACTION'.                                           03140000
032200     05  FILLER                         PIC  X(06)   VALUE SPACES.03150000
032300     05  FILLER                         PIC  X(06)   VALUE        03160000
032400         'AMOUNT'.                                                03170000
032500     05  FILLER                         PIC  X(08)   VALUE SPACES.03180000
032600     05  FILLER                         PIC  X(04)   VALUE        03190000
032700         'TYPE'.                                                  03200000
032800     05  FILLER                         PIC  X(06)   VALUE SPACES.03210000
032900     05  FILLER                         PIC  X(04)   VALUE        03220000
033000         'VOID'.                                                  03230000
033100     05  FILLER                         PIC  X(05)   VALUE SPACES.03240000
033200                                                                  03250000
033300******************************************************************03260000
033400*    AUTHORIZED TRANSACTION DETAIL LINE                          *03270000
033500******************************************************************03280000
033600 01  REPORT-DETAIL-LINE.                                          03290000
033700     05  FILLER                         PIC  X(05)   VALUE SPACES.03300000
033800     05  RDL-CRD-PROD-YR                PIC  9(04)   VALUE ZEROS. 03310000
033900     05  RDL-SHIPT-REQ-NBR              PIC  9(04)   VALUE ZEROS. 03320000
034000     05  RDL-CNTL-NBR                   PIC  9(06)   VALUE ZEROS. 03330000
034100     05  FILLER                         PIC  X(03)   VALUE SPACES.03340000
034200     05  RDL-CRD-NBR                    PIC  ZZ9(10) VALUE ZEROS. 03350000
034300     05  FILLER                         PIC  X(03)   VALUE SPACES.03360000
034400     05  RDL-STOCK-ID                   PIC  X(08)   VALUE ZEROS. 03370000
034500     05  FILLER                         PIC  X(04)   VALUE SPACES.03380000
034600     05  RDL-AUTH-DATE.                                           03390000
034700         10  RDL-AUTH-DATE-MM           PIC  X(2)    VALUE SPACES.03400000
034800         10  RDL-AUTH-SLASH1            PIC  X       VALUE '/'.   03410000
034900         10  RDL-AUTH-DATE-DD           PIC  X(2)    VALUE SPACES.03420000
035000         10  RDL-AUTH-SLASH2            PIC  X       VALUE '/'.   03430000
035100         10  RDL-AUTH-DATE-CC           PIC  X(2)    VALUE SPACES.03440000
035200         10  RDL-AUTH-DATE-YY           PIC  X(2)    VALUE SPACES.03450000
035300     05  FILLER                         PIC  X(04)   VALUE SPACES.03460000
035400     05  RDL-STR-NBR                    PIC  9(04)   VALUE ZEROS. 03470000
035500     05  FILLER                         PIC  X(06)   VALUE SPACES.03480000
035600     05  RDL-POS-TRMNL-NBR              PIC  9(04)   VALUE ZEROS. 03490000
035700     05  FILLER                         PIC  X(09)   VALUE SPACES.03500000
035800     05  RDL-POS-TRN-NBR                PIC  9(04)   VALUE ZEROS. 03510000
035900     05  FILLER                         PIC  X(07)   VALUE SPACES.03520000
036000     05  RDL-APP-AUTH-AMT               PIC  ZZZ,ZZZ.99-          03530000
036100                                                     VALUE ZEROS. 03540000
036200     05  FILLER                         PIC  X(04)   VALUE SPACES.03550000
036300     05  RDL-ACTVY-TYP-DESC             PIC  X(07)   VALUE SPACES.03560000
036400     05  FILLER                         PIC  X(04)   VALUE SPACES.03570000
036500     05  RDL-VOID-IND                   PIC  X(04)   VALUE SPACES.03580000
036600     05  FILLER                         PIC  X(05)   VALUE SPACES.03590000
036700                                                                  03600000
036800******************************************************************03610000
036900*    TOTAL LINES                                                 *03620000
037000******************************************************************03630000
037100 01  REPORT-TOTAL-TRANS-LINE.                                     03640000
037200     05  FILLER                         PIC  X(31)   VALUE SPACES.03650000
037300     05  FILLER                         PIC  X(08)   VALUE        03660000
037400         'ISSUES: '.                                              03670000
037500     05  RTTL-NUM-ISSUES                PIC  ZZZ9.                03680000
037600     05  FILLER                         PIC  X(02)   VALUE SPACES.03690000
037700     05  FILLER                         PIC  X(13)   VALUE        03700000
037800         'ISSUE VOIDS: '.                                         03710000
037900     05  RTTL-NUM-ISSUE-VOIDS           PIC  ZZZ9.                03720000
038000     05  FILLER                         PIC  X(02)   VALUE SPACES.03730000
038100     05  FILLER                         PIC  X(09)   VALUE        03740000
038200         'TENDERS: '.                                             03750000
038300     05  RTTL-NUM-TENDERS               PIC  ZZZ9.                03760000
038400     05  FILLER                         PIC  X(02)   VALUE SPACES.03770000
038500     05  FILLER                         PIC  X(14)   VALUE        03780000
038600         'TENDER VOIDS: '.                                        03790000
038700     05  RTTL-NUM-TENDER-VOIDS          PIC  ZZZ9.                03800000
038800     05  FILLER                         PIC  X(02)   VALUE SPACES.03810000
038900     05  FILLER                         PIC  X(11)   VALUE        03820000
039000         'FEE VOIDS: '.                                           03830000
039100     05  RTTL-NUM-FEE-VOIDS             PIC  ZZZ9.                03840000
039200     05  FILLER                         PIC  X(18)   VALUE SPACES.03850000
039300                                                                  03860000
039400 01  REPORT-TOTAL-AUTHORIZERS-LINE.                               03870000
039500     05  FILLER                         PIC  X(03)   VALUE SPACES.03880000
039600     05  FILLER                         PIC  X(19)   VALUE        03890000
039700         'TOTAL AUTHORIZERS: '.                                   03900000
039800     05  FILLER                         PIC  X(02)   VALUE SPACES.03910000
039900     05  RTAL-TOTAL-AUTHORIZERS         PIC  ZZ9.                 03920000
040000     05  FILLER                         PIC  X(105)  VALUE SPACES.03930000
040100                                                                  03940000
040200 01  REPORT-TOTAL-ISSUES-LINE.                                    03950000
040300     05  FILLER                         PIC  X(10)   VALUE SPACES.03960000
040400     05  FILLER                         PIC  X(14)   VALUE        03970000
040500         'ISSUES:       '.                                        03980000
040600     05  FILLER                         PIC  X(01)   VALUE SPACES.03990000
040700     05  RTIL-AUTH-NUM-ISSUES           PIC  Z,Z99                04000000
040800                                                     VALUE ZEROS. 04010000
040900     05  FILLER                         PIC  X(02)   VALUE SPACES.04020000
041000     05  RTIL-AUTH-TOTAL-ISSUES         PIC  $ZZZ,ZZZ.99-         04030000
041100                                                     VALUE ZEROS. 04040000
041200     05  FILLER                         PIC  X(88)   VALUE SPACES.04050000
041300                                                                  04060000
041400 01  REPORT-TOTAL-ISSUE-VOIDS-LINE.                               04070000
041500     05  FILLER                         PIC  X(10)   VALUE SPACES.04080000
041600     05  FILLER                         PIC  X(14)   VALUE        04090000
041700         'ISSUE VOIDS:  '.                                        04100000
041800     05  FILLER                         PIC  X(01)   VALUE SPACES.04110000
041900     05  RTIVL-AUTH-NUM-ISSUE-VOIDS     PIC  Z,Z99                04120000
042000                                                     VALUE ZEROS. 04130000
042100     05  FILLER                         PIC  X(02)   VALUE SPACES.04140000
042200     05  RTIVL-AUTH-TOTAL-ISSUE-VOIDS   PIC  $ZZZ,ZZZ.99-         04150000
042300                                                     VALUE ZEROS. 04160000
042400     05  FILLER                         PIC  X(88)   VALUE SPACES.04170000
042500                                                                  04180000
042600 01  REPORT-TOTAL-TENDERS-LINE.                                   04190000
042700     05  FILLER                         PIC  X(10)   VALUE SPACES.04200000
042800     05  FILLER                         PIC  X(14)   VALUE        04210000
042900         'TENDERS:      '.                                        04220000
043000     05  FILLER                         PIC  X(01)   VALUE SPACES.04230000
043100     05  RTTL-AUTH-NUM-TENDERS          PIC  Z,Z99                04240000
043200                                                     VALUE ZEROS. 04250000
043300     05  FILLER                         PIC  X(02)   VALUE SPACES.04260000
043400     05  RTTL-AUTH-TOTAL-TENDERS        PIC  $ZZZ,ZZZ.99-         04270000
043500                                                     VALUE ZEROS. 04280000
043600     05  FILLER                         PIC  X(88)   VALUE SPACES.04290000
043700                                                                  04300000
043800 01  REPORT-TOTAL-TENDER-VOIDS-LINE.                              04310000
043900     05  FILLER                         PIC  X(10)   VALUE SPACES.04320000
044000     05  FILLER                         PIC  X(14)   VALUE        04330000
044100         'TENDER VOIDS: '.                                        04340000
044200     05  FILLER                         PIC  X(01)   VALUE SPACES.04350000
044300     05  RTTVL-AUTH-NUM-TENDER-VOIDS    PIC  Z,Z99                04360000
044400                                                     VALUE ZEROS. 04370000
044500     05  FILLER                         PIC  X(02)   VALUE SPACES.04380000
044600     05  RTTVL-AUTH-TOTAL-TENDER-VOIDS  PIC  $ZZZ,ZZZ.99-         04390000
044700                                                     VALUE ZEROS. 04400000
044800     05  FILLER                         PIC  X(88)   VALUE SPACES.04410000
044900                                                                  04420000
045000 01  REPORT-TOTAL-FEE-VOIDS-LINE.                                 04430000
045100     05  FILLER                         PIC  X(10)   VALUE SPACES.04440000
045200     05  FILLER                         PIC  X(14)   VALUE        04450000
045300         'FEE VOIDS:    '.                                        04460000
045400     05  FILLER                         PIC  X(01)   VALUE SPACES.04470000
045500     05  RTTVL-AUTH-NUM-FEE-VOIDS       PIC  Z,Z99                04480000
045600                                                     VALUE ZEROS. 04490000
045700     05  FILLER                         PIC  X(02)   VALUE SPACES.04500000
045800     05  RTTVL-AUTH-TOTAL-FEE-VOIDS     PIC  $ZZZ,ZZZ.99-         04510000
045900                                                     VALUE ZEROS. 04520000
046000     05  FILLER                         PIC  X(88)   VALUE SPACES.04530000
046100                                                                  04540000
046200 01  REPORT-TOTAL-TOTAL-AUTHS-LINE.                               04550000
046300     05  FILLER                         PIC  X(10)   VALUE SPACES.04560000
046400     05  FILLER                         PIC  X(14)   VALUE        04570000
046500         'GRAND TOTAL: '.                                         04580000
046600     05  FILLER                         PIC  X(01)   VALUE SPACES.04590000
046700     05  RTTAL-GRAND-NUM-TOTAL          PIC  Z,Z99                04600000
046800                                                     VALUE ZEROS. 04610000
046900     05  FILLER                         PIC  X(02)   VALUE SPACES.04620000
047000     05  FILLER                         PIC  X(100)  VALUE SPACES.04630000
047100                                                                  04640000
047200 01  REPORT-TOTAL-DASH-LINE.                                      04650000
047300     05  FILLER                         PIC  X(10)   VALUE SPACES.04660000
047400     05  FILLER                         PIC  X(14)   VALUE SPACES.04670000
047500     05  FILLER                         PIC  X(01)   VALUE SPACES.04680000
047600     05  FILLER                         PIC  X(05)   VALUE        04690000
047700         '-----'.                                                 04700000
047800     05  FILLER                         PIC  X(02)   VALUE SPACES.04710000
047900     05  FILLER                         PIC  X(100)  VALUE SPACES.04720000
048000                                                                  04730000
048100 01  REPORT-BLANK-LINE.                                           04740000
048200     05  FILLER                         PIC  X(132)  VALUE SPACES.04750000
W3540C******************************************************************04751008
W3540C*    CONTROL CARD LAYOUT                                         *04752008
W3540C******************************************************************04760008
W3540C 01  WRITE-CONTROL-CARD.                                          04760110
W3540C     05  CONTROL-CARD-BEG-DATE          PIC  X(26)   VALUE SPACES.04760208
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.04760308
W3540C     05  CONTROL-CARD-END-DATE          PIC  X(26)   VALUE SPACES.04760408
W3540C     05  FILLER                         PIC  X(01)   VALUE SPACES.04760508
W3540C     05  RESTART-INDICATOR              PIC  X(01)   VALUE SPACES.04760608
W3540C     05  FILLER                         PIC  X(25)   VALUE SPACES.04760713
W3540C                                                                  04760808
048300******************************************************************04761008
048400*    KMRC CONSTANTS                                              *04770000
048500******************************************************************04780000
048600     COPY SVWS004.                                                04790000
048700                                                                  04800000
048800******************************************************************04810000
048900*  WORKING STORAGE AREA FOR NAME REFORMAT DPPD024                *04820000
049000******************************************************************04830000
049100     COPY DPWS024.                                                04840000
049200                                                                  04850000
049300******************************************************************04860000
049400*    DATE ROUTINE COPY MEMBERS                                   *04870000
049500******************************************************************04880000
049600     COPY DPWS500.                                                04890000
049700                                                                  04900000
049800******************************************************************04910000
049900*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *04920000
050000******************************************************************04930000
050100     COPY DPWS004.                                                04940000
050200                                                                  04950000
050300******************************************************************04960000
050400*    DP-CICS ARCH USER TABLE                                     *04970000
050500******************************************************************04980000
050600     EXEC SQL                                                     04990000
050700         INCLUDE TUSER                                            05000000
050800     END-EXEC.                                                    05010000
050900                                                                  05020000
051000******************************************************************05030000
051100*    DB2 AREA FOR SVT_CRD_PROD                                   *05040000
051200*    SV-KOHL'S CONTROL NUMBER INFORMATION TABLE                  *05050000
051300******************************************************************05060000
051400     EXEC SQL                                                     05070000
051500         INCLUDE SVT00000                                         05080000
051600     END-EXEC.                                                    05090000
051700******************************************************************05100000
051800*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                              *05110000
051900*    SV-KOHL'S MERCHANDISE CARD ACTIVITY TABLE                   *05120000
052000******************************************************************05130000
052100     EXEC SQL                                                     05140000
052200         INCLUDE SVT00002                                         05150000
052300     END-EXEC.                                                    05160000
052400******************************************************************05170000
052500*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                             *05180000
052600*    SV-KOHL'S MERCHANDISE CARD TABLE                            *05190000
052700******************************************************************05200000
052800     EXEC SQL                                                     05210000
052900         INCLUDE SVT00001                                         05220000
053000     END-EXEC.                                                    05230000
053100******************************************************************05240000
053200*    CURSOR TO ACCESS ISSUED GIFTCARDS                           *05250000
053300******************************************************************05260000
053400     EXEC SQL                                                     05270000
053500       DECLARE KMRC-CSR CURSOR FOR                                05280000
053600           SELECT  A.APVL_USR_ID                                  05290000
053700                  ,A.CRD_NBR                                      05300000
053800                  ,A.TRN_AUTH_TMST                                05310000
053900                  ,A.STR_NBR                                      05320000
054000                  ,A.POS_TRMNL_NBR                                05330000
054100                  ,A.POS_TRN_NBR                                  05340000
054200                  ,A.APP_AUTH_AMT                                 05350000
054300                  ,A.ACTVY_TYP_CDE                                05360000
054400                  ,A.TRN_VOID_IND                                 05370000
054500                  ,A.TRN_RVRSL_CDE                                05380000
054600                  ,T.CRD_PROD_YR                                  05390000
054700                  ,T.SHIPT_REQ_NBR                                05400000
054800                  ,T.CNTL_NBR                                     05410000
054900                  ,C.CRD_STK_TYP_ID                               05420000
055000             FROM SVT_KOHLS_CRD_ACCT T                            05430000
055100                 ,SVT_KOHLS_CRD_TXN A                             05440000
055200                 ,SVT_CRD_PROD C                                  05450000
055300            WHERE  A.CRD_NBR             = T.CRD_NBR              05460000
W3540C              AND  A.TRN_AUTH_TMST >   :PV-TODAYS-TIMESTAMP       05490000
W3540C              AND  A.TRN_AUTH_TMST <=  :PV-TOMORROWS-TIMESTAMP    05500000
055600              AND  A.APVL_USR_ID         > '        '             05510000
055700              AND  A.APVL_USR_ID NOT IN (:SV004-APVL-USR-ID-SYSTEM05520000
055800                                 ,:SV004-APVL-USR-ID-SVKUP001)    05530000
055900              AND  T.CRD_TYP_CDE         = :SV004-GIFT-CRD-TYP    05540000
056000              AND  C.CRD_PROD_YR = T.CRD_PROD_YR                  05550000
056100              AND  C.SHIPT_REQ_NBR = T.SHIPT_REQ_NBR              05560000
056200         ORDER BY  A.APVL_USR_ID ,C.CRD_STK_TYP_ID ,T.CRD_PROD_YR 05570000
056300                  ,T.SHIPT_REQ_NBR ,T.CNTL_NBR                    05580000
056400          WITH UR                                                 05590000
056500     END-EXEC.                                                    05600000
056600                                                                  05610000
056700     EXEC SQL                                                     05620000
056800       DECLARE KMRC-ISS-DT-CSR CURSOR FOR                         05630000
056900           SELECT  TRN_AUTH_TMST                                  05640000
057000             FROM  SVT_KOHLS_CRD_TXN A                            05650000
057100            WHERE  CRD_NBR       = :PV-CRD-NBR AND                05660000
057200                   ACTVY_TYP_CDE IN (:SV004-ISSUE-KMRC-ACT-TYP-N  05670000
057300                                ,:SV004-ISSUE-GIFT-CRD-ACT-TYP-N) 05680000
057400              AND  TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL          05690000
057500         ORDER BY  TRN_AUTH_TMST DESC                             05700000
057600          WITH UR                                                 05710000
057700     END-EXEC.                                                    05720000
057800                                                                  05730000
057900******************************************************************05740000
058000*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *05750000
058100******************************************************************05760000
058200     EXEC SQL                                                     05770000
058300         INCLUDE SQLCA                                            05780000
058400     END-EXEC.                                                    05790000
058500                                                                  05800000
058600     COPY SQLCA2.                                                 05810000
058700                                                                  05820000
058800 PROCEDURE DIVISION.                                              05830000
058900                                                                  05840000
059000 A100-MAINLINE.                                                   05850000
059100                                                                  05860000
059200     PERFORM B100-INITIALIZE.                                     05870000
059300                                                                  05880000
059400     PERFORM B200-PROCESS-AUTHS                                   05890000
059500         UNTIL PS-END-OF-KMRC-CSR.                                05900000
059600                                                                  05910000
059700     PERFORM F300-PRINT-TOTAL-LINE.                               05920000
059800                                                                  05930000
059900     PERFORM B900-EOJ-ROUTINE.                                    05940000
060000                                                                  05950000
060100     GOBACK.                                                      05960000
060200                                                                  05970000
060300******************************************************************05980000
060400*     B100-INITIALIZE                                            *05990000
060500* ==> PROCESSES:                                                 *06000000
060600*     - READS CONTROL DATE FROM CONTROL RECORD                   *06010000
060700*     - ACCEPTS THE CURRENT DATE AND TIME FOR THE REPORT HEADING *06020000
060800*     - OPENS KMRC-CSR (CURSOR).                                 *06030000
060900*     - READS FIRST GIFT CARD CONTROL NUMBER. IF ONE IS          *06040000
061000*       NOT FOUND, ISSUE MESSAGE.                                *06050000
061100******************************************************************06060000
061200 B100-INITIALIZE.                                                 06070000
061300                                                                  06080000
061400     OPEN INPUT CONTROL-DATE-FILE.                                06090015
061500     OPEN OUTPUT REPORT-FILE.                                     06110000
061600                                                                  06120000
061700     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                06130000
061800         AT END                                                   06140000
061900             SET PS-END-OF-CONTROL-FILE TO TRUE.                  06150000
062000                                                                  06160000
062100     IF PS-END-OF-CONTROL-FILE                                    06170000
062200         DISPLAY ' '                                              06180000
062300         DISPLAY '** ABEND     **'                                06190000
062400         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06200000
062500         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '       06210000
062600         DISPLAY '** CONTROL DATE FILE IS EMPTY  '                06220000
062700         DISPLAY ' '                                              06230000
062800         MOVE +4002 TO ABEND-CODE                                 06240000
062900         CALL 'ILBOABN0' USING ABEND-CODE                         06250000
063000     ELSE                                                         06260000
063100         DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '               06270000
W3540C                 CR-CONTROL-RECORD                                06280015
063300     END-IF.                                                      06290000
063400                                                                  06300000
W3540C     CLOSE CONTROL-DATE-FILE.                                     06301003
W3540C                                                                  06302003
063500     INITIALIZE DPG51 DPG52 DPG53                                 06310000
063600                DPG54 DPG55 DPG56.                                06320000
063700     SET DPG51-ACTUAL-CALENDAR-ONLY                               06330000
063800                                   TO TRUE.                       06340000
063900     SET DPG51-DO-NOT-INCR-DECR-DATE                              06350000
064000                                   TO TRUE.                       06360000
064100     MOVE ZEROES                   TO DPG51-INCR-DECR-DAYS-9      06370000
064200                                      DPG51-INCR-DECR-BUS-DAYS-9. 06380000
W3540C     MOVE CR-CONTROL-BEG-DATE(1:10) TO DPG52-LK-DATE-INPUT.       06391008
064400     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       06400000
064500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06410000
064600                                       DPG54 DPG55 DPG56.         06420000
064700                                                                  06430000
064800     EVALUATE TRUE                                                06440000
064900         WHEN DPG54-SEVERE-ERROR                                  06450000
065000         WHEN DPG54-WARNING-ERROR                                 06460000
065100             DISPLAY ' '                                          06470000
065200             DISPLAY '** ABEND     **'                            06480000
065300             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        06490000
065400             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         06500000
065500             DISPLAY '** BAD CALL TO CALENDAR MODULE '            06510000
065600                     PC-CALENDAR-PGM                              06520000
065700             DISPLAY '** DETERMINE VALID DATE **'                 06530000
W3540C             DISPLAY 'CR-CONTROL-BEG-DATE = ' CR-CONTROL-BEG-DATE 06540008
065900             DISPLAY DPG54-ERROR-MESSAGE                          06550000
066000             DISPLAY ' '                                          06560000
066100             MOVE +4019            TO ABEND-CODE                  06570000
066200             CALL 'ILBOABN0' USING ABEND-CODE                     06580000
066300     END-EVALUATE.                                                06590000
066400                                                                  06600000
W3540C     IF CR-RESTART-IND = 'R'                                      06610008
W3540C      INITIALIZE DPG51 DPG52 DPG53                                06620008
W3540C                 DPG54 DPG55 DPG56                                06630013
W3540C      SET DPG51-ACTUAL-CALENDAR-ONLY                              06640008
W3540C                                   TO TRUE                        06650013
W3540C      SET DPG51-DO-NOT-INCR-DECR-DATE                             06660008
W3540C                                   TO TRUE                        06670013
W3540C      MOVE ZEROES                   TO DPG51-INCR-DECR-DAYS-9     06680008
W3540C                                       DPG51-INCR-DECR-BUS-DAYS-9 06690013
W3540C      MOVE CR-CONTROL-END-DATE(1:10) TO DPG52-LK-DATE-INPUT       06700013
W3540C      SET DPG52-LK-DTE-ISO-FMT      TO TRUE                       06710013
W3540C      CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53   06711008
W3540C                                        DPG54 DPG55 DPG56         06712013
W3540C                                                                  06713008
W3540C      EVALUATE TRUE                                               06714008
W3540C          WHEN DPG54-SEVERE-ERROR                                 06715008
W3540C          WHEN DPG54-WARNING-ERROR                                06716008
W3540C             DISPLAY ' '                                          06717008
W3540C             DISPLAY '** ABEND     **'                            06718008
W3540C             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        06719008
W3540C             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         06719108
W3540C             DISPLAY '** BAD CALL TO CALENDAR MODULE '            06719208
W3540C                     PC-CALENDAR-PGM                              06719308
W3540C             DISPLAY '** DETERMINE VALID DATE **'                 06719408
W3540C             DISPLAY 'CR-CONTROL-END-DATE = ' CR-CONTROL-END-DATE 06719508
W3540C             DISPLAY DPG54-ERROR-MESSAGE                          06719608
W3540C             DISPLAY ' '                                          06719708
W3540C             MOVE +4019            TO ABEND-CODE                  06719808
W3540C             CALL 'ILBOABN0' USING ABEND-CODE                     06719908
W3540C      END-EVALUATE                                                06720013
W3540C                                                                  06720108
W3540C     END-IF.                                                      06720213
W3540C                                                                  06720315
W3540C     MOVE CR-CONTROL-BEG-DATE      TO PV-TODAYS-TIMESTAMP-DETAIL. 06721008
W3540C                                                                  06730000
W3540C     MOVE CR-BEG-CC                TO RSL-SALE-BEG-DATE-CC.       06740008
W3540C     MOVE CR-BEG-YY                TO RSL-SALE-BEG-DATE-YY.       06750008
W3540C     MOVE CR-BEG-MM                TO RSL-SALE-BEG-DATE-MM.       06752008
W3540C     MOVE CR-BEG-DD                TO RSL-SALE-BEG-DATE-DD.       06754008
W3540C                                                                  06756000
W3540C     MOVE CR-BEG-HH                TO RSL-SALE-BEG-TIME-HH.       06757000
W3540C     MOVE CR-BEG-MIN               TO RSL-SALE-BEG-TIME-MM.       06758009
W3540C     MOVE CR-BEG-SS                TO RSL-SALE-BEG-TIME-SS.       06759000
W3540C     MOVE CR-BEG-TTTTTT            TO RSL-SALE-BEG-TIME-TTTTTT.   06760000
W3540C                                                                  06761008
W3540C     IF CR-RESTART-IND = 'R'                                      07101008
W3540C       MOVE CR-CONTROL-END-DATE TO PV-TOMORROWS-TIMESTAMP-DTL     07101108
W3540C                                                                  07101314
W3540C     ELSE                                                         07101408
W3540C       EXEC SQL                                                   07110008
W3540C       SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP              07120008
W3540C       END-EXEC                                                   07130012
W3540C                                                                  07131001
W3540C       EVALUATE TRUE                                              07140008
W3540C         WHEN SQLCODE = 0                                         07150000
W3540C             MOVE PV-CURRENT-TIMESTAMP                            07151002
W3540C                                   TO PV-TOMORROWS-TIMESTAMP-DTL  07152002
W3540C         WHEN OTHER                                               07170000
W3540C             DISPLAY ' '                                          07180000
W3540C             MOVE 'B100-INITIALIZE               '                07181000
W3540C                                   TO PV-PARAGRAPH-NAME           07182000
W3540C             MOVE 'CURRENT TIMESTAMP FROM SYSTEM TABLE'           07183000
W3540C                                   TO PV-DB2-OPERATION-ATTEMPTED  07183100
W3540C             PERFORM Z900-SQL-ABEND                               07183200
W3540C       END-EVALUATE                                               07183308
W3540C     END-IF.                                                      07183408
W3540C                                                                  07183508
W3540C     DISPLAY ' PV-TOMORROWS-TIMESTAMP = ' PV-TOMORROWS-TIMESTAMP. 07183615
W3540C     MOVE PV-TOMORROWS-MM          TO RSL-SALE-END-DATE-MM.       07183700
W3540C     MOVE PV-TOMORROWS-DD          TO RSL-SALE-END-DATE-DD.       07183800
W3540C     MOVE PV-TOMORROWS-YYYY(1:2)   TO RSL-SALE-END-DATE-CC.       07183900
W3540C     MOVE PV-TOMORROWS-YYYY(3:2)   TO RSL-SALE-END-DATE-YY.       07184000
W3540C     MOVE PV-TOMORROWS-BEG-HH      TO RSL-SALE-END-TIME-HH.       07184100
W3540C     MOVE PV-TOMORROWS-BEG-MM      TO RSL-SALE-END-TIME-MM.       07184200
W3540C     MOVE PV-TOMORROWS-BEG-SS      TO RSL-SALE-END-TIME-SS.       07185000
W3540C     MOVE PV-TOMORROWS-BEG-TTTTTT  TO RSL-SALE-END-TIME-TTTTTT.   07185100
W3540C                                                                  07185200
071900     MOVE FUNCTION CURRENT-DATE (1:8)                             07185300
072000                                   TO PV-CURRENT-DATE.            07185400
072100     MOVE PV-CURRENT-YEAR          TO DP132-RUN-YEAR.             07185500
072200     MOVE PV-CURRENT-MONTH         TO DP132-RUN-MONTH.            07185600
072300     MOVE PV-CURRENT-DAY           TO DP132-RUN-DAY.              07185700
072400                                                                  07185800
072500     ACCEPT PV-CURRENT-TIME      FROM TIME.                       07185900
072600     MOVE PV-CURRENT-HOUR          TO DP132-RUN-HOUR.             07186000
072700     MOVE PV-CURRENT-MINUTE        TO DP132-RUN-MINUTE.           07187000
072800                                                                  07188000
072900     MOVE PC-PROGRAM-NAME          TO DP132-PROGRAM-NAME.         07189000
073000                                                                  07190000
073100     EXEC SQL                                                     07200000
073200         OPEN KMRC-CSR                                            07210000
073300     END-EXEC.                                                    07220000
073400     EVALUATE TRUE                                                07230000
073500         WHEN SQLCODE = 0                                         07240000
073600             CONTINUE                                             07250000
073700         WHEN OTHER                                               07260000
073800             DISPLAY ' '                                          07270000
073900             MOVE 'B100-INITIALIZE               '                07280000
074000                                   TO PV-PARAGRAPH-NAME           07290000
074100             MOVE 'OPEN CURSOR TO SVT_KOHLS_CRD_TXN TABLE  '      07300000
074200                                   TO PV-DB2-OPERATION-ATTEMPTED  07310000
074300             PERFORM Z900-SQL-ABEND                               07320000
074400     END-EVALUATE.                                                07330000
074500                                                                  07340000
074600     SET PS-FIRST-FETCH TO TRUE.                                  07350000
074700     PERFORM D100-FETCH-KMRC-CURSOR.                              07360000
074800     IF PS-END-OF-KMRC-CSR                                        07370000
074900         DISPLAY ' '                                              07380000
075000         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07390000
075100         DISPLAY '** FIRST FETCH FOUND NO GIFT CARD'              07400000
075200         DISPLAY ' '                                              07410000
075300     ELSE                                                         07420000
075400         MOVE SVT00002-APVL-USR-ID TO PV-HOLD-APVL-USR-ID         07430000
075500         PERFORM D300-GET-USER-NAME                               07440000
075600         PERFORM F100-PROCESS-PAGE-BREAK                          07450000
075700         ADD +1                    TO PA-TOTAL-AUTHORIZERS        07460000
075800         PERFORM D200-TOTAL-TRANS                                 07470000
075900         IF PS-VALID-AUTH AND PS-FIRST-FETCH                      07480000
076000            PERFORM E100-PRINT-DETAIL                             07490000
076100            SET PS-NOT-FIRST-FETCH TO TRUE                        07500000
076200         END-IF                                                   07510000
076300     END-IF.                                                      07520000
076400                                                                  07530000
W3540C     MOVE PV-TOMORROWS-TIMESTAMP-DTL TO CONTROL-CARD-BEG-DATE.    07531008
W3540C     MOVE CR-CONTROL-END-DATE        TO CONTROL-CARD-END-DATE.    07532008
W3540C     MOVE CR-RESTART-IND             TO RESTART-INDICATOR.        07533008
W3540C                                                                  07534015
076500******************************************************************07540000
076600*     B200-PROCESS-AUTHS                                         *07550000
076700* ==> PROCESSES:                                                 *07560000
076800*     - PROCESSES AUTHORIZATIONS FOR A GIVEN DAY.                *07570000
076900******************************************************************07580000
077000 B200-PROCESS-AUTHS.                                              07590000
077100                                                                  07600000
077200     PERFORM B300-PROCESS-TRANS                                   07610000
077300         UNTIL PS-END-OF-KMRC-CSR                                 07620000
077400            OR SVT00002-APVL-USR-ID NOT = PV-HOLD-APVL-USR-ID.    07630000
077500                                                                  07640000
077600     IF PS-END-OF-KMRC-CSR                                        07650000
077700         PERFORM F200-PRINT-TOTAL-TRANS-LINE                      07660000
077800     ELSE                                                         07670000
077900         PERFORM F200-PRINT-TOTAL-TRANS-LINE                      07680000
078000         INITIALIZE PA-TRANS-NUM-ISSUES                           07690000
078100                    PA-TRANS-NUM-ISSUE-VOIDS                      07700000
078200                    PA-TRANS-NUM-TENDER                           07710000
078300                    PA-TRANS-NUM-TENDER-VOIDS                     07720000
078400                    PA-TRANS-NUM-FEE-VOIDS                        07730000
078500         MOVE SVT00002-APVL-USR-ID TO PV-HOLD-APVL-USR-ID         07740000
078600         PERFORM D300-GET-USER-NAME                               07750000
078700         PERFORM F100-PROCESS-PAGE-BREAK                          07760000
078800         ADD +1                    TO PA-TOTAL-AUTHORIZERS        07770000
078900         PERFORM D200-TOTAL-TRANS                                 07780000
079000         IF PS-VALID-AUTH AND PS-NOT-FIRST-FETCH                  07790000
079100            PERFORM E100-PRINT-DETAIL.                            07800000
079200                                                                  07810000
079300******************************************************************07820000
079400*     B300-PROCESS-TRANS                                         *07830000
079500* ==> PROCESSES:                                                 *07840000
079600*     - PROCESSES EACH AUTHORIZATION TRAN FOR A GIVEN AUTHORIZER.*07850000
079700******************************************************************07860000
079800 B300-PROCESS-TRANS.                                              07870000
079900                                                                  07880000
080000     PERFORM D100-FETCH-KMRC-CURSOR.                              07890000
080100                                                                  07900000
080200     IF PS-END-OF-KMRC-CSR                                        07910000
080300         CONTINUE                                                 07920000
080400     ELSE                                                         07930000
080500         IF SVT00002-APVL-USR-ID NOT = PV-HOLD-APVL-USR-ID        07940000
080600             CONTINUE                                             07950000
080700         ELSE                                                     07960000
080800             PERFORM D200-TOTAL-TRANS                             07970000
080900             IF PS-VALID-AUTH AND PS-NOT-FIRST-FETCH              07980000
081000                 PERFORM E100-PRINT-DETAIL                        07990000
081100             END-IF                                               08000000
081200         END-IF                                                   08010000
081300     END-IF.                                                      08020000
081400                                                                  08030000
081500******************************************************************08040000
081600*     B900-EOJ-ROUTINE                                           *08050000
081700* ==> PROCESSES:                                                 *08060000
081800*     - WRITES AN END OF REPORT LINE TO THE REPORT               *08070000
081900*     - CLOSES THE FILES                                         *08080000
082000*     - DISPLAYS THE NUMBER OF RECORDS READ                      *08090000
082100******************************************************************08100000
082200 B900-EOJ-ROUTINE.                                                08110000
082300                                                                  08120000
W3540C     IF CR-RESTART-IND NOT = 'R'                                  08120115
W3540C                                                                  08120216
W3540C          OPEN OUTPUT CONTROL-DATE-FILE                           08121011
W3540C                                                                  08122003
W3540C          WRITE CONTROL-DATE-RECORD                               08130008
W3540C                             FROM WRITE-CONTROL-CARD              08140011
W3540C                                                                  08150008
W3540C          CLOSE CONTROL-DATE-FILE                                 08160008
W3540C                                                                  08180008
W3540C     END-IF.                                                      08180108
W3540C                                                                  08180216
W3540C     CLOSE REPORT-FILE.                                           08181008
W3540C                                                                  08182008
082700     EXEC SQL                                                     08190000
082800        CLOSE KMRC-CSR                                            08200000
082900     END-EXEC.                                                    08210000
083000     EVALUATE TRUE                                                08220000
083100         WHEN SQLCODE = 0                                         08230000
083200             CONTINUE                                             08240000
083300         WHEN OTHER                                               08250000
083400             DISPLAY ' '                                          08260000
083500             MOVE 'B900-EOJ-ROUTINE              '                08270000
083600                                   TO PV-PARAGRAPH-NAME           08280000
083700             MOVE 'CLOSE CURSOR TO SVT_KOHLS_CRD_TXN TABLE '      08290000
083800                                   TO PV-DB2-OPERATION-ATTEMPTED  08300000
083900             PERFORM Z900-SQL-ABEND                               08310000
084000     END-EVALUATE.                                                08320000
084100                                                                  08330000
084200     DISPLAY ' '.                                                 08340000
084300     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             08350000
084400     DISPLAY 'NUMBER OF GIFT CARD RECORDS READ:  '                08360000
084500         PA-GFT-CRD-RECS-READ.                                    08370000
084600     DISPLAY ' '.                                                 08380000
084700                                                                  08390000
084800******************************************************************08400000
084900*     D100-FETCH-KMRC-CURSOR                                     *08410000
085000* ==> PROCESSES:                                                 *08420000
085100*     - READS ACTIVITY FROM THE SVT_KOHLS_CRD_TXN                *08430000
085200******************************************************************08440000
085300 D100-FETCH-KMRC-CURSOR.                                          08450000
085400                                                                  08460000
085500     EXEC SQL                                                     08470000
085600         FETCH  KMRC-CSR                                          08480000
085700          INTO :SVT00002-APVL-USR-ID                              08490000
085800              ,:SVT00002-CRD-NBR                                  08500000
085900              ,:SVT00002-TRN-AUTH-TMST                            08510000
086000              ,:SVT00002-STR-NBR                                  08520000
086100              ,:SVT00002-POS-TRMNL-NBR                            08530000
086200              ,:SVT00002-POS-TRN-NBR                              08540000
086300              ,:SVT00002-APP-AUTH-AMT                             08550000
086400              ,:SVT00002-ACTVY-TYP-CDE                            08560000
086500              ,:SVT00002-TRN-VOID-IND                             08570000
086600              ,:SVT00002-TRN-RVRSL-CDE                            08580000
086700              ,:SVT00001-CRD-PROD-YR                              08590000
086800              ,:SVT00001-SHIPT-REQ-NBR                            08600000
086900              ,:SVT00001-CNTL-NBR                                 08610000
087000              ,:SVT00000-CRD-STK-TYP-ID                           08620000
087100     END-EXEC.                                                    08630000
087200                                                                  08640000
087300     EVALUATE TRUE                                                08650000
087400         WHEN SQLCODE = +0                                        08660000
087500             ADD +1                TO PA-GFT-CRD-RECS-READ        08670000
087600             INITIALIZE PS-VALID-AUTH-SW                          08680000
087700         WHEN SQLCODE = +100                                      08690000
087800             SET PS-END-OF-KMRC-CSR                               08700000
087900                                   TO TRUE                        08710000
088000         WHEN OTHER                                               08720000
088100             DISPLAY ' '                                          08730000
088200             MOVE 'D100-FETCH-KMRC-CURSOR        '                08740000
088300                                   TO PV-PARAGRAPH-NAME           08750000
088400             MOVE 'FETCH ROW FROM SVT_KOHLS_CRD_TXN CURSOR '      08760000
088500                                   TO PV-DB2-OPERATION-ATTEMPTED  08770000
088600             PERFORM Z900-SQL-ABEND                               08780000
088700     END-EVALUATE.                                                08790000
088800                                                                  08800000
088900******************************************************************08810000
089000*     D200-TOTAL-TRANS.                                          *08820000
089100* ==> PROCESSES:                                                 *08830000
089200*     - TOTALS THE AUTHORIZATION TYPE TRANSACTIONS.              *08840000
089300******************************************************************08850000
089400 D200-TOTAL-TRANS.                                                08860000
089500                                                                  08870000
089600     IF SVT00002-ACTVY-TYP-CDE = SV004-ISSUE-KMRC-ACT-TYP-N OR    08880000
089700        SVT00002-ACTVY-TYP-CDE = SV004-ISSUE-GIFT-CRD-ACT-TYP-N   08890000
089800        IF SVT00002-TRN-VOID-IND = SV004-VOID-TRANS               08900000
089900           AND SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL    08910000
090000           ADD +1                  TO PA-AUTH-NUM-ISSUE-VOIDS     08920000
090100                                      PA-TRANS-NUM-ISSUE-VOIDS    08930000
090200           ADD SVT00002-APP-AUTH-AMT TO PA-AUTH-TOTAL-ISSUE-VOIDS 08940000
090300           SET PS-VALID-AUTH       TO TRUE                        08950000
090400        ELSE                                                      08960000
090500           ADD +1                  TO PA-AUTH-NUM-ISSUES          08970000
090600                                      PA-TRANS-NUM-ISSUES         08980000
090700           ADD SVT00002-APP-AUTH-AMT TO PA-AUTH-TOTAL-ISSUES      08990000
090800           SET PS-VALID-AUTH       TO TRUE                        09000000
090900        END-IF                                                    09010000
091000     ELSE                                                         09020000
091100     IF SVT00002-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP-N           09030000
091200        IF SVT00002-TRN-VOID-IND = SV004-VOID-TRANS               09040000
091300           AND SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL    09050000
091400           ADD +1                  TO PA-AUTH-NUM-TENDER-VOIDS    09060000
091500                                      PA-TRANS-NUM-TENDER-VOIDS   09070000
091600           ADD SVT00002-APP-AUTH-AMT TO PA-AUTH-TOTAL-TENDER-VOIDS09080000
091700           SET PS-VALID-AUTH       TO TRUE                        09090000
091800        ELSE                                                      09100000
091900           ADD +1                  TO PA-AUTH-NUM-TENDERS         09110000
092000                                      PA-TRANS-NUM-TENDER         09120000
092100           ADD SVT00002-APP-AUTH-AMT TO PA-AUTH-TOTAL-TENDERS     09130000
092200           SET PS-VALID-AUTH       TO TRUE                        09140000
092300        END-IF                                                    09150000
092400     ELSE                                                         09160000
092500     IF SVT00002-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N          09170000
092600        IF SVT00002-TRN-VOID-IND = SV004-VOID-TRANS               09180000
092700           AND SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL    09190000
092800           ADD +1                  TO PA-AUTH-NUM-FEE-VOIDS       09200000
092900                                      PA-TRANS-NUM-FEE-VOIDS      09210000
093000           ADD SVT00002-APP-AUTH-AMT TO PA-AUTH-TOTAL-FEE-VOIDS   09220000
093100           SET PS-VALID-AUTH       TO TRUE                        09230000
093200        END-IF                                                    09240000
093300     END-IF                                                       09250000
093400     END-IF.                                                      09260000
093500                                                                  09270000
093600     IF PS-VALID-AUTH                                             09280000
093700        ADD +1                     TO PA-GRAND-AUTH-NUM.          09290000
093800                                                                  09300000
093900******************************************************************09310000
094000*     D300-GET-USER-NAME                                         *09320000
094100* ==> PROCESSES:                                                 *09330000
094200*     - GET THE USER NAME USING THE APPROVAL USER ID             *09340000
094300******************************************************************09350000
094400 D300-GET-USER-NAME.                                              09360000
094500                                                                  09370000
094600     EXEC SQL                                                     09380000
094700         SELECT USR_LAST_NM                                       09390000
094800               ,USR_1ST_NM                                        09400000
094900           INTO :USER-USR-LAST-NM                                 09410000
095000               ,:USER-USR-1ST-NM                                  09420000
095100           FROM  TUSER                                            09430000
095200          WHERE USER_CODE     = :SVT00002-APVL-USR-ID             09440000
095300     END-EXEC.                                                    09450000
095400                                                                  09460000
095500     EVALUATE TRUE                                                09470000
095600         WHEN SQLCODE = 0                                         09480000
095700             MOVE 25               TO DP024-FLNAME-LENGTH         09490000
095800             MOVE USER-USR-LAST-NM TO DP024-LNAME                 09500000
095900             MOVE USER-USR-1ST-NM  TO DP024-FNAME                 09510000
096000             PERFORM DP024-0000-FORMAT-NAME                       09520000
096100             MOVE PV-HOLD-APVL-USR-ID                             09530000
096200                                   TO RAHL-AUTHORIZER-NUMBER      09540000
096300             MOVE PC-HYPHEN        TO RAHL-HYPHEN                 09550000
096400             MOVE DP024-FLNAME     TO RAHL-NAME                   09560000
096500         WHEN SQLCODE = +100                                      09570000
096600             MOVE PV-HOLD-APVL-USR-ID                             09580000
096700                                   TO RAHL-AUTHORIZER-NUMBER      09590000
096800             MOVE SPACES           TO RAHL-HYPHEN                 09600000
096900                                      RAHL-NAME                   09610000
097000         WHEN OTHER                                               09620000
097100             DISPLAY ' '                                          09630000
097200             DISPLAY 'USER ID = ' SVT00002-APVL-USR-ID            09640000
097300             MOVE 'D300-GET-USER-NAME         '                   09650000
097400                                   TO PV-PARAGRAPH-NAME           09660000
097500             MOVE 'SELECT USER NAME FROM TUSER   '                09670000
097600                                   TO PV-DB2-OPERATION-ATTEMPTED  09680000
097700             PERFORM Z900-SQL-ABEND                               09690000
097800     END-EVALUATE.                                                09700000
097900                                                                  09710000
098000******************************************************************09720000
098100*     E100-PRINT-DETAIL.                                         *09730000
098200* ==> PROCESSES:                                                 *09740000
098300*     - WRITES THE SINGLE TRANSACTION DETAIL LINES.              *09750000
098400******************************************************************09760000
098500 E100-PRINT-DETAIL.                                               09770000
098600                                                                  09780000
098700     MOVE SVT00002-TRN-AUTH-TMST   TO PV-TRN-AUTH-TMST.           09790000
098800     PERFORM E110-FIND-ISSUE-DATE.                                09800000
098900                                                                  09810000
099000     MOVE SVT00001-CRD-PROD-YR     TO RDL-CRD-PROD-YR.            09820000
099100     MOVE SVT00001-SHIPT-REQ-NBR   TO RDL-SHIPT-REQ-NBR.          09830000
099200     MOVE SVT00001-CNTL-NBR        TO RDL-CNTL-NBR.               09840000
099300     MOVE SVT00002-CRD-NBR         TO RDL-CRD-NBR.                09850000
099400     MOVE SVT00000-CRD-STK-TYP-ID  TO RDL-STOCK-ID.               09860000
099500     MOVE SVT00002-STR-NBR         TO RDL-STR-NBR.                09870000
099600     MOVE SVT00002-POS-TRMNL-NBR   TO RDL-POS-TRMNL-NBR.          09880000
099700     MOVE SVT00002-POS-TRN-NBR     TO RDL-POS-TRN-NBR.            09890000
099800     MOVE SVT00002-APP-AUTH-AMT    TO RDL-APP-AUTH-AMT.           09900000
099900                                                                  09910000
100000     EVALUATE TRUE                                                09920000
100100       WHEN SVT00002-ACTVY-TYP-CDE = SV004-ISSUE-KMRC-ACT-TYP-N   09930000
100200           MOVE SV004-ISSUE-KMRC-SHRT-DESC                        09940000
100300                                   TO RDL-ACTVY-TYP-DESC          09950000
100400       WHEN SVT00002-ACTVY-TYP-CDE =                              09960000
100500                                   SV004-ISSUE-GIFT-CRD-ACT-TYP-N 09970000
100600           MOVE SV004-ISSUE-GIFT-CRD-SHRT-DESC                    09980000
100700                                   TO RDL-ACTVY-TYP-DESC          09990000
100800       WHEN SVT00002-ACTVY-TYP-CDE =                              10000000
100900                                   SV004-TENDER-ACT-TYP-N         10010000
101000           MOVE SV004-TENDER-SHRT-DESC                            10020000
101100                                   TO RDL-ACTVY-TYP-DESC          10030000
101200       WHEN SVT00002-ACTVY-TYP-CDE =                              10040000
101300                                   SV004-SRV-FEE-ACT-TYP-N        10050000
101400           MOVE SV004-SRV-FEE-SHRT-DESC                           10060000
101500                                   TO RDL-ACTVY-TYP-DESC          10070000
101600       WHEN OTHER                                                 10080000
101700           MOVE SPACES             TO RDL-ACTVY-TYP-DESC          10090000
101800     END-EVALUATE.                                                10100000
101900                                                                  10110000
102000     IF (SVT00002-TRN-VOID-IND = SV004-VOID-TRANS)                10120000
102100        AND (SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL)     10130000
102200         MOVE SV004-VOID-LONG-DESC TO RDL-VOID-IND                10140000
102300     ELSE                                                         10150000
102400         MOVE SPACES               TO RDL-VOID-IND.               10160000
102500                                                                  10170000
102600     IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE           10180000
102700         PERFORM F100-PROCESS-PAGE-BREAK                          10190000
102800     END-IF.                                                      10200000
102900                                                                  10210000
103000     WRITE REPORT-RECORD FROM REPORT-DETAIL-LINE                  10220000
103100         AFTER ADVANCING 1 LINE.                                  10230000
103200                                                                  10240000
103300     ADD PC-ONE                    TO PA-LINE-COUNTER-GFT-CRD.    10250000
103400                                                                  10260000
103500******************************************************************10270000
103600*     E110-FIND-ISSUE-DATE.                                      *10280000
103700* ==> PROCESSES:                                                 *10290000
103800*     - LOCATES THE ISSUE DATE.                                  *10300000
103900******************************************************************10310000
104000 E110-FIND-ISSUE-DATE.                                            10320000
104100                                                                  10330000
104200     IF SVT00002-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP-N OR        10340000
104300        SVT00002-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N OR       10350000
104400        SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL           10360000
104500        MOVE SVT00002-CRD-NBR      TO PV-CRD-NBR                  10370000
104600                                                                  10380000
104700        EXEC SQL                                                  10390000
104800            OPEN KMRC-ISS-DT-CSR                                  10400000
104900        END-EXEC                                                  10410000
105000        EVALUATE TRUE                                             10420000
105100            WHEN SQLCODE = 0                                      10430000
105200                CONTINUE                                          10440000
105300            WHEN OTHER                                            10450000
105400                DISPLAY ' '                                       10460000
105500                DISPLAY 'CARD NUMBER = ' PV-CRD-NBR               10470000
105600                MOVE 'E110-FIND-ISSUE-DATE          '             10480000
105700                                   TO PV-PARAGRAPH-NAME           10490000
105800                MOVE 'FETCH ROW FROM ISSUE DATE CSR '             10500000
105900                                   TO PV-DB2-OPERATION-ATTEMPTED  10510000
106000                PERFORM Z900-SQL-ABEND                            10520000
106100        END-EVALUATE                                              10530000
106200                                                                  10540000
106300        EXEC SQL                                                  10550000
106400            FETCH   KMRC-ISS-DT-CSR                               10560000
106500             INTO  :PV-ISSUE-DATE-TMST                            10570000
106600        END-EXEC                                                  10580000
106700        EVALUATE TRUE                                             10590000
106800            WHEN SQLCODE = 0                                      10600000
106900                CONTINUE                                          10610000
106910            WHEN SQLCODE = +100                                   10620000
106920                MOVE PV-AUTH-DATE          TO PV-ISSUE-DATE       10630000
107000            WHEN OTHER                                            10640000
107100                DISPLAY ' '                                       10650000
107200                DISPLAY 'CARD NUMBER = ' PV-CRD-NBR               10660000
107300                MOVE 'E110-FIND-ISSUE-DATE          '             10670000
107400                                   TO PV-PARAGRAPH-NAME           10680000
107500                MOVE 'CLOSE ISSUE DATE CURSOR       '             10690000
107600                                   TO PV-DB2-OPERATION-ATTEMPTED  10700000
107700                PERFORM Z900-SQL-ABEND                            10710000
107800        END-EVALUATE                                              10720000
107900                                                                  10730000
108000        EXEC SQL                                                  10740000
108100           CLOSE KMRC-ISS-DT-CSR                                  10750000
108200        END-EXEC                                                  10760000
108300        EVALUATE TRUE                                             10770000
108400            WHEN SQLCODE = 0                                      10780000
108500                CONTINUE                                          10790000
108600            WHEN OTHER                                            10800000
108700                DISPLAY '** ABEND     **'                         10810000
108800                DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME     10820000
108900                DISPLAY '** CLOSE CURSOR FOR ISSUE DATE'          10830000
109000                PERFORM Z900-SQL-ABEND                            10840000
109100        END-EVALUATE                                              10850000
109200                                                                  10860000
109300     ELSE                                                         10870000
109400        MOVE PV-AUTH-DATE          TO PV-ISSUE-DATE               10880000
109500     END-IF.                                                      10890000
109600                                                                  10900000
109700     IF PV-TODAYS-CC = PV-ISSUE-DATE-CC AND                       10910000
109800        PV-TODAYS-YY = PV-ISSUE-DATE-YY AND                       10920000
109900        PV-TODAYS-MM = PV-ISSUE-DATE-MM AND                       10930000
110000        PV-TODAYS-DD = PV-ISSUE-DATE-DD                           10940000
110100           MOVE SPACES             TO RDL-AUTH-DATE-MM            10950000
110200                                      RDL-AUTH-DATE-DD            10960000
110300                                      RDL-AUTH-DATE-CC            10970000
110400                                      RDL-AUTH-DATE-YY            10980000
110500                                      RDL-AUTH-SLASH1             10990000
110600                                      RDL-AUTH-SLASH2             11000000
110700     ELSE                                                         11010000
110800           MOVE PV-ISSUE-DATE-CC   TO RDL-AUTH-DATE-CC            11020000
110900           MOVE PV-ISSUE-DATE-YY   TO RDL-AUTH-DATE-YY            11030000
111000           MOVE PV-ISSUE-DATE-MM   TO RDL-AUTH-DATE-MM            11040000
111100           MOVE PV-ISSUE-DATE-DD   TO RDL-AUTH-DATE-DD            11050000
111200           MOVE '/'                TO RDL-AUTH-SLASH1             11060000
111300           MOVE '/'                TO RDL-AUTH-SLASH2             11070000
111400     END-IF.                                                      11080000
111500                                                                  11090000
111600******************************************************************11100000
111700*     F100-PROCESS-PAGE-BREAK.                                   *11110000
111800* ==> PROCESSES:                                                 *11120000
111900*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *11130000
112000******************************************************************11140000
112100 F100-PROCESS-PAGE-BREAK.                                         11150000
112200                                                                  11160000
112300     MOVE PC-ONE                   TO DP132-REPORT-NUMBER.        11170000
112400     ADD PC-ONE                    TO PA-PAGE-COUNTER-GFT-CRD.    11180000
112500     MOVE PA-PAGE-COUNTER-GFT-CRD  TO DP132-PAGE-NUMBER.          11190000
112600                                                                  11200000
112700     MOVE PC-HEADER-LINE-COUNT     TO PA-LINE-COUNTER-GFT-CRD.    11210000
112800                                                                  11220000
112900     WRITE REPORT-RECORD FROM DP132-STANDRD-HEADER-132-COLS       11230000
113000         AFTER ADVANCING PAGE.                                    11240000
113100                                                                  11250000
113200     INITIALIZE DP132-LASER-NEW-PAGE-INDICATR                     11260000
113300                                                                  11270000
113400     WRITE REPORT-RECORD FROM REPORT-TITLE-LINE                   11280000
113500         AFTER ADVANCING 1 LINE.                                  11290000
113600                                                                  11300000
113700     WRITE REPORT-RECORD FROM REPORT-SUBTITLE-LINE                11310000
113800         AFTER ADVANCING 1 LINE.                                  11320000
113900                                                                  11330000
114000     WRITE REPORT-RECORD FROM REPORT-AUTH-HEADER-LINE             11340000
114100         AFTER ADVANCING 2 LINES.                                 11350000
114200                                                                  11360000
114300     IF PS-TOTALS                                                 11370000
114400         CONTINUE                                                 11380000
114500     ELSE                                                         11390000
114600         WRITE REPORT-RECORD FROM REPORT-DETAIL-HEADER-1          11400000
114700             AFTER ADVANCING 2 LINES                              11410000
114800                                                                  11420000
114900         WRITE REPORT-RECORD FROM REPORT-DETAIL-HEADER-2          11430000
115000             AFTER ADVANCING 1 LINES                              11440000
115100     END-IF.                                                      11450000
115200                                                                  11460000
115300     WRITE REPORT-RECORD FROM REPORT-BLANK-LINE                   11470000
115400         AFTER ADVANCING 1 LINES.                                 11480000
115500                                                                  11490000
115600******************************************************************11500000
115700*     F200-PRINT-TOTAL-TRANS-LINE.                               *11510000
115800* ==> PROCESSES:                                                 *11520000
115900*     - WRITES TOTAL TRANSACTION LINE FOR A GIVEN AUTHORIZER.    *11530000
116000******************************************************************11540000
116100 F200-PRINT-TOTAL-TRANS-LINE.                                     11550000
116200                                                                  11560000
116300     MOVE PA-TRANS-NUM-ISSUES      TO RTTL-NUM-ISSUES.            11570000
116400     MOVE PA-TRANS-NUM-ISSUE-VOIDS TO RTTL-NUM-ISSUE-VOIDS.       11580000
116500     MOVE PA-TRANS-NUM-TENDER      TO RTTL-NUM-TENDERS.           11590000
116600     MOVE PA-TRANS-NUM-TENDER-VOIDS                               11600000
116700                                   TO RTTL-NUM-TENDER-VOIDS.      11610000
116800     MOVE PA-TRANS-NUM-FEE-VOIDS   TO RTTL-NUM-FEE-VOIDS.         11620000
116900                                                                  11630000
117000     IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE           11640000
117100         PERFORM F100-PROCESS-PAGE-BREAK                          11650000
117200     END-IF.                                                      11660000
117300                                                                  11670000
117400     WRITE REPORT-RECORD FROM REPORT-TOTAL-TRANS-LINE             11680000
117500         AFTER ADVANCING 2 LINES.                                 11690000
117600                                                                  11700000
117700     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    11710000
117800                                                                  11720000
117900******************************************************************11730000
118000*     F300-PRINT-TOTAL-LINE.                                     *11740000
118100* ==> PROCESSES:                                                 *11750000
118200*     - WRITES THE TOTAL SECTION OF THE REPORT.                  *11760000
118300******************************************************************11770000
118400 F300-PRINT-TOTAL-LINE.                                           11780000
118500                                                                  11790000
118600     MOVE 'TOTALS  '               TO RAHL-AUTHORIZER-NUMBER      11800000
118700     MOVE SPACES                   TO RAHL-HYPHEN                 11810000
118800                                      RAHL-NAME.                  11820000
118900     SET PS-TOTALS                 TO TRUE.                       11830000
119000     PERFORM F100-PROCESS-PAGE-BREAK.                             11840000
119100                                                                  11850000
119200     MOVE PA-TOTAL-AUTHORIZERS     TO RTAL-TOTAL-AUTHORIZERS.     11860000
119300     WRITE REPORT-RECORD FROM REPORT-TOTAL-AUTHORIZERS-LINE       11870000
119400         AFTER ADVANCING 2 LINES.                                 11880000
119500     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    11890000
119600                                                                  11900000
119700     MOVE PA-AUTH-TOTAL-ISSUES     TO RTIL-AUTH-TOTAL-ISSUES.     11910000
119800     MOVE PA-AUTH-NUM-ISSUES       TO RTIL-AUTH-NUM-ISSUES.       11920000
119900     WRITE REPORT-RECORD FROM REPORT-TOTAL-ISSUES-LINE            11930000
120000         AFTER ADVANCING 2 LINES.                                 11940000
120100     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    11950000
120200                                                                  11960000
120300     MOVE PA-AUTH-TOTAL-ISSUE-VOIDS                               11970000
120400                                   TO RTIVL-AUTH-TOTAL-ISSUE-VOIDS11980000
120500     MOVE PA-AUTH-NUM-ISSUE-VOIDS  TO RTIVL-AUTH-NUM-ISSUE-VOIDS. 11990000
120600     WRITE REPORT-RECORD FROM REPORT-TOTAL-ISSUE-VOIDS-LINE       12000000
120700         AFTER ADVANCING 2 LINES.                                 12010000
120800     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    12020000
120900                                                                  12030000
121000     MOVE PA-AUTH-TOTAL-TENDERS    TO RTTL-AUTH-TOTAL-TENDERS.    12040000
121100     MOVE PA-AUTH-NUM-TENDERS      TO RTTL-AUTH-NUM-TENDERS.      12050000
121200     WRITE REPORT-RECORD FROM REPORT-TOTAL-TENDERS-LINE           12060000
121300         AFTER ADVANCING 2 LINES.                                 12070000
121400     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    12080000
121500                                                                  12090000
121600     MOVE PA-AUTH-TOTAL-TENDER-VOIDS                              12100000
121700                                TO RTTVL-AUTH-TOTAL-TENDER-VOIDS. 12110000
121800     MOVE PA-AUTH-NUM-TENDER-VOIDS                                12120000
121900                                   TO RTTVL-AUTH-NUM-TENDER-VOIDS.12130000
122000     WRITE REPORT-RECORD FROM REPORT-TOTAL-TENDER-VOIDS-LINE      12140000
122100         AFTER ADVANCING 2 LINES.                                 12150000
122200     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    12160000
122300                                                                  12170000
122400     MOVE PA-AUTH-TOTAL-FEE-VOIDS                                 12180000
122500                                   TO RTTVL-AUTH-TOTAL-FEE-VOIDS. 12190000
122600     MOVE PA-AUTH-NUM-FEE-VOIDS                                   12200000
122700                                   TO RTTVL-AUTH-NUM-FEE-VOIDS.   12210000
122800     WRITE REPORT-RECORD FROM REPORT-TOTAL-FEE-VOIDS-LINE         12220000
122900         AFTER ADVANCING 2 LINES.                                 12230000
123000     ADD PC-TWO                    TO PA-LINE-COUNTER-GFT-CRD.    12240000
123100                                                                  12250000
123200     WRITE REPORT-RECORD FROM REPORT-TOTAL-DASH-LINE              12260000
123300         AFTER ADVANCING 2 LINES.                                 12270000
123400     ADD PC-TWO TO PA-LINE-COUNTER-GFT-CRD                        12280000
123500                                                                  12290000
123600     MOVE PA-GRAND-AUTH-NUM        TO RTTAL-GRAND-NUM-TOTAL.      12300000
123700     WRITE REPORT-RECORD FROM REPORT-TOTAL-TOTAL-AUTHS-LINE       12310000
123800         AFTER ADVANCING 1 LINE.                                  12320000
123900                                                                  12330000
124000     ADD PC-ONE                    TO PA-LINE-COUNTER-GFT-CRD.    12340000
124100                                                                  12350000
124200******************************************************************12360000
124300*    NAME REFORMATOR MODULE                                      *12370000
124400******************************************************************12380000
124500     COPY DPPD024.                                                12390000
124600                                                                  12400000
124700******************************************************************12410000
124800*     Z900-SQL-ABEND                                             *12420000
124900* ==> PROCESSES:                                                 *12430000
125000*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *12440000
125100******************************************************************12450000
125200 Z900-SQL-ABEND.                                                  12460000
125300                                                                  12470000
125400     DISPLAY 'Z900-SQL-ABEND'.                                    12480000
125500     DISPLAY '**  ABEND     **'.                                  12490000
125600     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               12500000
125700     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             12510000
125800     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    12520000
125900                                                                  12530000
126000******************************************************************12540000
126100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *12550000
126200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *12560000
126300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *12570000
126400* FORMAT.                                                        *12580000
126500******************************************************************12590000
126600     COPY DPPD004.                                                12600000
126700                                                                  12610000
126800     MOVE +4013 TO ABEND-CODE.                                    12620000
126900     CALL 'ILBOABN0' USING ABEND-CODE.                            12630000
