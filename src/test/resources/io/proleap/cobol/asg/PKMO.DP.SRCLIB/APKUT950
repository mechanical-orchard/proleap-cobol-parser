000100 IDENTIFICATION DIVISION.                                         00010014
000200                                                                  00020015
000300 PROGRAM-ID.    APKUT950.                                         00030015
000400                                                                  00040015
000500 AUTHOR.        WILLIAM A EHMKE.                                  00050015
000600                                                                  00060015
000700 DATE-WRITTEN.  DEC      1995.                                    00070015
000800                                                                  00080015
000900 DATE-COMPILED.                                                   00090015
001000****************************************************************  00100015
001100*                    APKUT950                                     00110015
001200*                                                                 00120015
001300*  THIS PROGRAM HAS BEEN WRITTEN TO SELECTIVELY STRIP RECORDS     00130015
001400*  FROM AN EXISTING MAINFRAME FLAT FILE. EDIT THEN AND WRITE THE  00140015
001500*  EDITED RECORDS TO A FLAT FILE.                                 00150015
001600*                                                                 00160015
001700*  THIS PROGRAM WILL USE AS INPUT AN EXCEL SPREAD SHEET FILE THAT 00170015
001800*  HAS BEEN 'FTP'ED TO A FLAT FILE ON THE MAIN FRAME.             00180015
001900*                                                                 00190015
002000*  THE FILE WILL CONTAIN ACCOUNT NUMBERS FOR PEOPLESOFT           00200017
002100*  PEOPLESOFT ACCOUNTS IN ONE COLUMN, STORE NUMBERS IN            00210017
002200*  A SECOND COLUMN AND DEPTIDS IN A THIRD.                        00220017
002300*                                                                 00230015
002400*  THE FILE IS PROCESSED LINE BY LINE.                            00240015
002500*  IF THERE IS A VALID PEOPLE SOFT ACCOUNT NUMBER, A SORT CONTROL 00250017
002600*  CARD IS CONSTRUCTED FOR IT. IF THE STORE FIELD IS VALID, THEN  00260017
002800*  A SORT CONTROL RECORD IS WRITTEN FOR THE STORE NUMBER.  IF THE 00280017
002900*  DEPTID IS VALID, THEN A SEQUENTIAL INPUT FILE IS WRITTEN.      00290017
003000*                                                                 00300015
003100*  AS PART OF INITIALILZATION THE BASIC SORT CONTROL RECORDS ARE  00310015
003200*  WRITTEN OUT.                                                   00320015
003300*                                                                 00330015
003400*                                                                 00340015
003500*---------------------------------------------------------------* 00350015
003600* CHANGE LOG:                                                   * 00360015
004200*   DATE  02/25/2003                                            * 00420015
004300*       CHANGE MADE: MOVED TO PRODUCTION.                       * 00430015
004400*       MADE BY: KEVIN CATLIN              WR/IR #: WR24481     * 00440015
004500*                                                               * 00450015
004600*   DATE  04/22/2004                                            * 00460016
004700*       CHANGE MADE: INCREASED THE LENGTH OF VARIOUS W/S STORE  * 00470016
004800*       FIELDS FROM 3 TO 4 CHARACTERS AS PART OF THE STORE      * 00480016
004900*       CONSTRAINTS PROJECT.                                    * 00490016
005000*       MADE BY: MIKE BESKE                WR/IR #: WR25805     * 00500016
005100*                                                               * 00510016
005110*   DATE  06/14/2013                                            * 00511029
005120*       CHANGE MADE: REPLACED STORE FILE WITH DEPTID FILE       * 00512020
005121*       AND ADDED NEW LOGIC TO PROCESS DEPTIDS DIRECTLY WITHOUT * 00512120
005130*       STORE NUMBERS. MODIFIED THE LAYOUT OF THE INPUT CARDS   * 00513029
005140*       TO REMOVE THE MSA ACCOUNT AND ADD ACTIVITY ID.  CONTROL * 00514029
005150*       CARDS FOR ACCOUNT NUMBERS WERE MODIFIED TO ALLOW FOR    * 00515029
005151*       AN ACCOUNT NUMBER ALONE, OR A COMBINATION OF ACCOUNT    * 00515129
005152*       AND ACTIVITY ID.                                        * 00515229
005153*       MADE BY: NANCY EILBES              WR/IR #: WR41542     * 00515329
005160*                                                               * 00516019
005200*---------------------------------------------------------------* 00520016
005300                                                                  00530016
005400     EJECT                                                        00540016
005500                                                                  00550016
005600 ENVIRONMENT DIVISION.                                            00560016
005700                                                                  00570016
005800 CONFIGURATION SECTION.                                           00580016
005900                                                                  00590016
006000 OBJECT-COMPUTER.        IBM-3090.                                00600016
006100                                                                  00610016
006200 SOURCE-COMPUTER.        IBM-3090.                                00620016
006300                                                                  00630016
006400 INPUT-OUTPUT SECTION.                                            00640016
006500                                                                  00650016
006600 FILE-CONTROL.                                                    00660016
006700                                                                  00670016
006800     SELECT EXCEL-INPUT-FILE       ASSIGN TO INP01.               00680016
006900                                                                  00690016
007000     SELECT SORT-CNTL-ACCT-FILE    ASSIGN TO OUT01.               00700016
007220     SELECT SEQ-INPUT-DEPTID-FILE  ASSIGN TO OUT02.               00722020
007300                                                                  00730016
007400     EJECT                                                        00740016
007500                                                                  00750016
007600 DATA DIVISION.                                                   00760016
007700                                                                  00770016
007800 FILE SECTION.                                                    00780016
007900                                                                  00790016
008000 FD  EXCEL-INPUT-FILE                                             00800016
008100     RECORDING MODE IS F                                          00810016
008200     LABEL RECORDS ARE STANDARD                                   00820016
008300     RECORD CONTAINS 80  CHARACTERS                               00830016
008400     BLOCK CONTAINS 0 RECORDS                                     00840016
008500     DATA RECORD IS EXCEL-INPUT-RECORD.                           00850016
008600                                                                  00860016
008700 01  EXCEL-INPUT-RECORD          PIC X(80).                       00870016
008800                                                                  00880016
008900                                                                  00890016
009000 FD  SORT-CNTL-ACCT-FILE                                          00900016
009100     RECORDING MODE IS F                                          00910016
009200     LABEL RECORDS ARE STANDARD                                   00920016
009300     RECORD CONTAINS  80 CHARACTERS                               00930016
009400     BLOCK CONTAINS 0 RECORDS                                     00940016
009500     DATA RECORD IS SORT-CNTL-ACCT-RECORD.                        00950016
009600                                                                  00960016
009700 01  SORT-CNTL-ACCT-RECORD       PIC X(80).                       00970016
010710                                                                  01071017
010720                                                                  01072017
010730 FD  SEQ-INPUT-DEPTID-FILE                                        01073017
010740     RECORDING MODE IS F                                          01074017
010750     LABEL RECORDS ARE STANDARD                                   01075017
010760     RECORD CONTAINS  80 CHARACTERS                               01076017
010770     BLOCK CONTAINS 0 RECORDS                                     01077017
010780     DATA RECORD IS SEQ-INPUT-DEPTID-RECORD.                      01078017
010790                                                                  01079017
010791 01  SEQ-INPUT-DEPTID-RECORD     PIC X(80).                       01079117
010800                                                                  01080016
010900                                                                  01090016
011000     EJECT                                                        01100016
011100                                                                  01110016
011200 WORKING-STORAGE SECTION.                                         01120016
011300                                                                  01130016
011400*                                                                 01140016
011500***************************************************************** 01150016
011600*                                                                 01160016
011700* THIS IS A WORKING STORAGE LAYOUT FOR ABEND CODE VALUES.         01170016
011800*     USE THE SET COMMAND TO PROVIDE VALUES TO ABEND-CODE.        01180016
011900*     IE SET AE-DB2-ERR TO TRUE:  CALL USING ABEND-CODE.          01190016
012000*                                                                 01200016
012100***************************************************************** 01210016
012200*                                                                 01220016
012300                                                                  01230016
012400 01  ABEND-CODE                  PIC S9(04)   VALUE +0            01240016
012500                                              COMP                01250016
012600                                              SYNC.               01260016
012700                                                                  01270016
012800     88  AC-INVALID-KEY-WRITE                 VALUE +4001.        01280016
012900     88  AC-INVALID-KEY-READ                  VALUE +4002.        01290016
013000     88  AC-INVALID-CONTROL-CARD              VALUE +4003.        01300016
013100     88  AC-TABLE-OVERFLOW                    VALUE +4004.        01310016
013200     88  AC-OPEN-FILE-ERROR                   VALUE +4005.        01320016
013300     88  AC-CLOSE-FILE-ERROR                  VALUE +4006.        01330016
013400     88  AC-SEQUENCE-ERROR                    VALUE +4007.        01340016
013500     88  AC-INVALID-DATA                      VALUE +4008.        01350016
013600     88  AC-INVALID-KEYPUNCH                  VALUE +4009.        01360016
013700     88  AC-INTERNAL-SORT-ERROR               VALUE +4012.        01370016
013800     88  AC-DB2-ERROR                         VALUE +4013.        01380016
013900     88  AC-DPWS500-DATE-ERROR                VALUE +4019.        01390016
014000                                                                  01400016
014100     EJECT                                                        01410016
014200                                                                  01420016
014300 01  WS-INTERMEDIATE-WORKAREAS.                                   01430016
014400                                                                  01440016
014500     05  WS-RUN-DATE.                                             01450016
014600         10  WS-RUN-YEAR         PIC X(02)      VALUE SPACES.     01460016
014700         10  WS-RUN-MONTH        PIC X(02)      VALUE SPACES.     01470016
014800         10  WS-RUN-DAY          PIC X(02)      VALUE SPACES.     01480016
014900                                                                  01490016
015000     05  WS-RUN-TIME.                                             01500016
015100         10  WS-RUN-HOUR         PIC X(02)      VALUE SPACES.     01510016
015200         10  WS-RUN-MINUTE       PIC X(02)      VALUE SPACES.     01520016
015210                                                                  01521017
015220     05  WS-DEPTID-RECORD.                                        01522017
015230         10  WS-DEPTID           PIC X(05)      VALUE SPACES.     01523017
015240         10  FILLER              PIC X(75)      VALUE SPACES.     01524017
015300                                                                  01530016
015400                                                                  01540016
015500 01  PROGRAM-SWITCHES.                                            01550016
015700     05  PS-EOF-EXCEL-FILE-SWT          PIC X(01)  VALUE SPACE.   01570020
015800         88  PS-EOF-EXCEL-FILE-YES           VALUE 'Y'.           01580016
015900         88  PS-EOF-EXCEL-FILE-NO            VALUE 'N'.           01590016
016600     05  PS-FIRST-ACCT-READ-SWT         PIC X(01)  VALUE SPACE.   01660020
016800         88  PS-FIRST-ACCT-READ-YES          VALUE 'Y'.           01680016
016900         88  PS-FIRST-ACCT-READ-NO           VALUE 'N'.           01690016
017100     05  PS-FIRST-ACCT-MAINLINE-SWT     PIC X(01) VALUE SPACE.    01710020
017300         88  PS-FIRST-ACCT-MAINLINE-YES      VALUE 'Y'.           01730016
017400         88  PS-FIRST-ACCT-MAINLINE-NO       VALUE 'N'.           01740016
017500     05  PS-SAVED-ACTIVITY-SW           PIC X(01) VALUE SPACE.    01750025
017600         88  PS-SAVED-ACTIVITY               VALUE 'Y'.           01760025
017700         88  PS-NO-SAVED-ACTIVITY            VALUE 'N'.           01770025
018000                                                                  01800016
018900 01  PROGRAM-VARIABLES.                                           01890016
019100     05  PV-IN-REC-CNT                  PIC 9(07) VALUE ZEROES.   01910020
019300     05  PV-DEPT-ID-CNTL-REC-CNT        PIC 9(07) VALUE ZEROES.   01930020
019500     05  PV-PS-ACCT-CNTL-REC-CNT        PIC 9(07) VALUE ZEROES.   01950020
019600     05  PV-ACCT-CONST-REC-CNT          PIC 9(07) VALUE ZEROES.   01960020
019800                                                                  01980016
019900     EJECT                                                        01990016
020000                                                                  02000016
022300 01  SORT-ACCOUNT-RECORDS.                                        02230025
022500     05  SA-ACCOUNT-REC           PIC X(80)    VALUE SPACES.      02250025
022900     EJECT                                                        02290016
023200***************************************************************** 02320016
023300*        INPUT EXCEL RECORD WORK AREA.                            02330016
023400***************************************************************** 02340016
023600 01  EXCEL-CONTROL-RECORD.                                        02360016
024200     05  EC-PS-ACCT-NBR          PIC X(05)    VALUE SPACES.       02420016
024300     05  FILLER                  PIC X(01)    VALUE SPACES.       02430022
024400     05  EC-PS-ACTIVITY-ID       PIC X(06)    VALUE SPACES.       02440022
024500     05  FILLER                  PIC X(01)    VALUE SPACES.       02450022
024600     05  EC-PS-DEPT-ID           PIC X(05)    VALUE SPACES.       02460017
024700     05  FILLER                  PIC X(60)    VALUE SPACES.       02470020
024800                                                                  02480016
024900     EJECT                                                        02490016
025300**********************************************************        02530016
025400*                      DETAIL                                     02540016
025500*            OUTPUT SORT CONTROL RECORD                           02550016
025600*               PEOPLE SOFT ACCT NBR.                             02560017
025700*                     COMMON                                      02570016
025800**********************************************************        02580016
025900*                                                                 02590016
026010 01  SORT-CNTL-RECDTYPE-LINE.                                     02601025
026020     05  FILLER                  PIC X(03)     VALUE SPACES.      02602025
026030     05  FILLER                  PIC X(23)     VALUE              02603025
026040             'RECORD TYPE=F,LENGTH=80'.                           02604025
026050     05  FILLER                  PIC X(54)     VALUE SPACES.      02605025
026060                                                                  02606025
026070 01  SORT-CNTL-FIELDS-LINE.                                       02607025
026080     05  FILLER                  PIC X(03)     VALUE SPACES.      02608025
026090     05  FILLER                  PIC X(16)     VALUE              02609025
026091             'SORT FIELDS=COPY'.                                  02609125
026092     05  FILLER                  PIC X(61)     VALUE SPACES.      02609225
026093                                                                  02609325
026100 01  SORT-CNTL-ACCT-REC-DETAIL.                                   02610016
026200     05  FILLER                  PIC X(17)     VALUE SPACES.      02620016
026300     05  FILLER                  PIC X(14)     VALUE              02630023
026400             '(41,05,CH,EQ,C'.                                    02640025
026500     05  FILLER                  PIC X(01)     VALUE QUOTE.       02650016
026600     05  SCARD-ACCOUNT-DETL      PIC X(05)     VALUE SPACES.      02660027
026700     05  FILLER                  PIC X(01)     VALUE QUOTE.       02670016
026800     05  FILLER                  PIC X(05)     VALUE '),OR,'.     02680025
026900     05  FILLER                  PIC X(37)     VALUE SPACES.      02690016
027000                                                                  02700016
027100 01  SORT-CNTL-ACCT-ACTV-DETAIL.                                  02710025
027200     05  FILLER                  PIC X(17)     VALUE SPACES.      02720025
027210     05  FILLER                  PIC X(14)     VALUE              02721025
027220             '(41,05,CH,EQ,C'.                                    02722025
027230     05  FILLER                  PIC X(01)     VALUE QUOTE.       02723025
027240     05  SCAAD-ACCOUNT-DETL      PIC X(05)     VALUE SPACES.      02724027
027250     05  FILLER                  PIC X(01)     VALUE QUOTE.       02725025
027251     05  FILLER                  PIC X(05)     VALUE ',AND,'.     02725126
027252     05  FILLER                  PIC X(13)     VALUE              02725225
027253             '48,06,CH,EQ,C'.                                     02725325
027254     05  FILLER                  PIC X(01)     VALUE QUOTE.       02725427
027255     05  SCAAD-ACTIVITY-ID       PIC X(06)     VALUE SPACES.      02725527
027256     05  FILLER                  PIC X(01)     VALUE QUOTE.       02725625
027260     05  FILLER                  PIC X(05)     VALUE '),OR,'.     02726025
027270     05  FILLER                  PIC X(37)     VALUE SPACES.      02727025
028600                                                                  02860016
028700 01  SORT-CNTL-ACCT-INCLUDE-LINE.                                 02870025
028800     05  FILLER                  PIC X(03)     VALUE SPACES.      02880016
028900     05  FILLER                  PIC X(28)     VALUE              02890023
029000             'INCLUDE COND=((41,05,CH,EQ,C'.                      02900025
029100     05  FILLER                  PIC X(01)     VALUE QUOTE.       02910016
029200     05  SCAIL-ACCOUNT           PIC X(05)     VALUE SPACES.      02920025
029300     05  FILLER                  PIC X(01)     VALUE QUOTE.       02930016
029400     05  FILLER                  PIC X(05)     VALUE '),OR,'.     02940028
029500     05  FILLER                  PIC X(37)     VALUE SPACES.      02950016
029600                                                                  02960016
029610 01  SORT-CNTL-ACCT-ACTV-INCL-LINE.                               02961026
029620     05  FILLER                  PIC X(03)     VALUE SPACES.      02962025
029630     05  FILLER                  PIC X(28)     VALUE              02963025
029640             'INCLUDE COND=((41,05,CH,EQ,C'.                      02964025
029650     05  FILLER                  PIC X(01)     VALUE QUOTE.       02965025
029660     05  SCAAIL-ACCOUNT          PIC X(05)     VALUE SPACES.      02966025
029670     05  FILLER                  PIC X(01)     VALUE QUOTE.       02967025
029680     05  FILLER                  PIC X(05)     VALUE ',AND,'.     02968026
029681     05  FILLER                  PIC X(13)     VALUE              02968125
029682             '48,06,CH,EQ,C'.                                     02968225
029683     05  FILLER                  PIC X(01)     VALUE QUOTE.       02968327
029684     05  SCAAIL-ACTIVITY-ID      PIC X(06)     VALUE SPACES.      02968427
029685     05  FILLER                  PIC X(01)     VALUE QUOTE.       02968525
029686     05  FILLER                  PIC X(05)     VALUE '),OR,'.     02968626
029690     05  FILLER                  PIC X(37)     VALUE SPACES.      02969025
029691                                                                  02969125
029700 01  SORT-CNTL-ACCT-ACTV-LAST-LINE.                               02970025
029800     05  FILLER                  PIC X(17)     VALUE SPACES.      02980016
029900     05  FILLER                  PIC X(14)     VALUE              02990023
030000             '(41,05,CH,EQ,C'.                                    03000025
030100     05  FILLER                  PIC X(01)     VALUE QUOTE.       03010016
030200     05  SCAALL-ACCOUNT          PIC X(05)     VALUE SPACES.      03020027
030300     05  FILLER                  PIC X(01)     VALUE QUOTE.       03030016
030310     05  FILLER                  PIC X(05)     VALUE ',AND,'.     03031026
030320     05  FILLER                  PIC X(13)     VALUE              03032025
030330             '48,06,CH,EQ,C'.                                     03033025
030331     05  FILLER                  PIC X(01)     VALUE QUOTE.       03033127
030340     05  SCAALL-ACTIVITY-ID      PIC X(06)     VALUE SPACES.      03034027
030350     05  FILLER                  PIC X(01)     VALUE QUOTE.       03035025
030400     05  FILLER                  PIC X(02)     VALUE '))'.        03040025
030500     05  FILLER                  PIC X(40)     VALUE SPACES.      03050016
030600                                                                  03060016
030610 01  SORT-CNTL-ACCT-LAST-LINE.                                    03061025
030620     05  FILLER                  PIC X(17)     VALUE SPACES.      03062025
030630     05  FILLER                  PIC X(14)     VALUE              03063025
030640             '(41,05,CH,EQ,C'.                                    03064025
030650     05  FILLER                  PIC X(01)     VALUE QUOTE.       03065025
030660     05  SCALL-ACCOUNT           PIC X(05)     VALUE SPACES.      03066027
030670     05  FILLER                  PIC X(01)     VALUE QUOTE.       03067025
030680     05  FILLER                  PIC X(02)     VALUE '))'.        03068025
030690     05  FILLER                  PIC X(40)     VALUE SPACES.      03069026
030691                                                                  03069125
030700 01  SORT-CNTL-END-LINE.                                          03070025
030800     05  FILLER                  PIC X(03)     VALUE SPACES.      03080016
030900     05  FILLER                  PIC X(03)     VALUE 'END'.       03090016
031000     05  FILLER                  PIC X(74)     VALUE SPACES.      03100016
031100                                                                  03110016
038500     EJECT                                                        03850016
038700 01  ABEND-AREAS.                                                 03870016
038800     05  AA-ABEND-LIT          PIC  X(40)  VALUE                  03880016
038900             '*****       ABEND'.                                 03890016
039000     05  AA-PROGRAM-LIT        PIC  X(40)  VALUE                  03900016
039100             '*****   PROGRAM: APKUT950'.                         03910016
039200     05  AA-PARAGRAPH-LIT.                                        03920016
039300         10  FILLER            PIC X(17)   VALUE                  03930016
039400             '***** PARAGRAPH: '.                                 03940016
039500         10  AA-PARAGRAPH-NAME PIC  X(35)  VALUE SPACES.          03950016
039600     05  AA-MESSAGE-LINE.                                         03960016
039700         10  FILLER            PIC  X(06)  VALUE '*****'.         03970016
039800         10  AA-MESSAGE        PIC  X(127) VALUE SPACES.          03980016
039900         10  FILLER REDEFINES AA-MESSAGE.                         03990016
040000             15 AA-MESSAGE-1   PIC  X(45).                        04000016
040100             15 AA-MESSAGE-2   PIC  X(45).                        04010016
040200             15 AA-MESSAGE-3   PIC  X(37).                        04020016
040400     EJECT                                                        04040016
040500                                                                  04050016
040600 PROCEDURE DIVISION.                                              04060016
040800 A000-MAINLINE.                                                   04080016
040900                                                                  04090016
042200     PERFORM B100-INITIALIZATION.                                 04220017
042400     PERFORM B200-PROCESS-EXCEL-FLAT-FILE                         04240016
042500         UNTIL PS-EOF-EXCEL-FILE-YES.                             04250016
042520     PERFORM B300-END-OF-PROGRAM.                                 04252017
042600                                                                  04260016
045900     GOBACK.                                                      04590016
046000                                                                  04600016
046100     EJECT                                                        04610016
046200                                                                  04620016
046300***************************************************************** 04630016
046400* B100 - INITIALIZATION                                           04640020
046500*       INITIALIZE FIELDS                                         04650016
046700*       DO INITIAL READ.                                          04670016
046800*       BUILD ACCT AND DEPTID VALUES                              04680021
046900***************************************************************** 04690016
047000                                                                  04700016
047100 B100-INITIALIZATION.                                             04710017
047200                                                                  04720016
047210     DISPLAY '*************************************************'. 04721020
047220     DISPLAY '*           START RUN PGM APKUT950              *'. 04722020
047230     DISPLAY '*************************************************'. 04723020
047240                                                                  04724020
047250     OPEN INPUT  EXCEL-INPUT-FILE                                 04725020
047260         OUTPUT  SORT-CNTL-ACCT-FILE                              04726020
047270                 SEQ-INPUT-DEPTID-FILE.                           04727020
047280                                                                  04728020
047300     INITIALIZE PROGRAM-VARIABLES.                                04730016
047400                                                                  04740016
047500     SET PS-EOF-EXCEL-FILE-NO          TO TRUE.                   04750016
047600     SET PS-FIRST-ACCT-READ-YES        TO TRUE.                   04760016
047700     SET PS-FIRST-ACCT-MAINLINE-YES    TO TRUE.                   04770016
048000                                                                  04800016
048100     ACCEPT WS-RUN-DATE        FROM DATE.                         04810016
048300     ACCEPT WS-RUN-TIME        FROM TIME.                         04830016
048400                                                                  04840016
048500     PERFORM R100-READ-EXCEL-FILE-RTN.                            04850016
048600                                                                  04860016
052210     IF PS-EOF-EXCEL-FILE-NO                                      05221017
052220         IF EC-PS-DEPT-ID NOT = SPACE                             05222017
052230             MOVE EC-PS-DEPT-ID TO WS-DEPTID                      05223017
052260         ELSE                                                     05226017
052270             MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME      05227020
052290             MOVE 'DEPTID MISSING ON FIRST RECORD '               05229020
052291                 TO AA-MESSAGE-1                                  05229120
052293             SET AC-INVALID-DATA TO TRUE                          05229320
052295             PERFORM Z999-ABEND                                   05229520
052296         END-IF                                                   05229617
052297     END-IF.                                                      05229717
052298                                                                  05229817
052300     EJECT                                                        05230016
052400                                                                  05240016
052500***************************************************************** 05250016
052600* B200-PROCESS-EXCEL-FLAT-FILE                                    05260020
052700*       THIS RTN WILL PROCESS THE ACCOUNT AND DEPTID FIELDS FROM  05270020
052800*       THE FTP'ED EXCEL FILE AND GENERATE THE APPROPRATE SORT    05280016
052900*       CONTROL RECORDS.                                          05290016
053000*                                                                 05300016
053100*       ON THE FIRST PASS IT WILL GENERATE THE BEGINNING          05310016
053200*       SORT CONTROL CONSTANT RECORDS.                            05320016
053300*                                                                 05330016
053400*       ON THE PASS FOR END OF FILE IT WILL GENERATE THE          05340016
053500*       CLOSING SORT CONTROL CONSTANT RECORDS                     05350016
053600*                                                                 05360016
053700***************************************************************** 05370016
053900 B200-PROCESS-EXCEL-FLAT-FILE.                                    05390016
054000                                                                  05400016
054100     IF  PS-FIRST-ACCT-READ-YES                                   05410025
054200         SET PS-FIRST-ACCT-READ-NO TO TRUE                        05420016
054300         PERFORM C100-FIRST-ACCT-CNTL-GEN                         05430016
054400     ELSE                                                         05440016
054600         PERFORM D200-PS-DETAIL-ACCT-CNTL-GEN                     05460016
054700     END-IF.                                                      05470016
054800                                                                  05480016
055510     IF  WS-DEPTID = SPACES                                       05551017
055520         CONTINUE                                                 05552017
055530     ELSE                                                         05553017
055540         PERFORM W200-WRITE-DEPTID-RECORD                         05554020
055550     END-IF.                                                      05555017
055560                                                                  05556017
055600     PERFORM R100-READ-EXCEL-FILE-RTN.                            05560016
057600                                                                  05760016
058710     IF PS-EOF-EXCEL-FILE-NO                                      05871017
058720         IF EC-PS-DEPT-ID NOT = SPACES                            05872017
058730             MOVE EC-PS-DEPT-ID   TO WS-DEPTID                    05873017
058760         ELSE                                                     05876017
058770             MOVE SPACES          TO WS-DEPTID                    05877017
058790         END-IF                                                   05879017
058791     END-IF.                                                      05879117
058792                                                                  05879217
058800     IF PS-EOF-EXCEL-FILE-YES                                     05880016
058900         PERFORM E100-END-ACCT-SORT-CNTL-RTN                      05890016
059100     END-IF.                                                      05910016
059200                                                                  05920016
059300                                                                  05930016
059400     EJECT                                                        05940016
059410***************************************************************** 05941017
059420* B300 -  END OF PROGRAM                                          05942017
059430*       DISPLAY COUNTS, CLOSE FILES.                              05943017
059470***************************************************************** 05947017
059480                                                                  05948017
059490 B300-END-OF-PROGRAM.                                             05949017
059500                                                                  05950016
059510     DISPLAY ' '.                                                 05951017
059520     DISPLAY '************************************************'.  05952017
059540     DISPLAY ' PV-IN-REC-CNT             = ' PV-IN-REC-CNT.       05954017
059590     DISPLAY ' PV-DEPT-ID-CNTL-REC-CNT  = '                       05959017
059591                                        PV-DEPT-ID-CNTL-REC-CNT.  05959117
059593     DISPLAY ' PV-PS-ACCT-CNTL-REC-CNT   = '                      05959317
059594                                        PV-PS-ACCT-CNTL-REC-CNT.  05959417
059596     DISPLAY ' PV-ACCT-CONST-REC-CNT     = '                      05959617
059597                                        PV-ACCT-CONST-REC-CNT.    05959717
059602     DISPLAY '************************************************'.  05960217
059605                                                                  05960517
059606     CLOSE EXCEL-INPUT-FILE                                       05960617
059607           SORT-CNTL-ACCT-FILE                                    05960717
059609           SEQ-INPUT-DEPTID-FILE.                                 05960917
059610                                                                  05961017
059611     DISPLAY '*************************************************'. 05961117
059612     DISPLAY '*           STOP  RUN PGM APKUT950              *'. 05961217
059613     DISPLAY '*************************************************'. 05961317
059614 EJECT                                                            05961420
059620***************************************************************** 05962016
059700* C100-FIRST-ACCT-CNTL-GEN                                        05970020
059800*  THIS RTN WILL GENERATE THE CONTROL CONSTANT AND FIRST DETAIL   05980020
059900*  SORT CONTROL RECORDS FOR THE ACCOUNT NUMBERS.                  05990020
060200***************************************************************** 06020016
060400 C100-FIRST-ACCT-CNTL-GEN.                                        06040016
060500                                                                  06050016
060600     IF  EC-PS-ACCT-NBR = SPACES                                  06060025
060800         MOVE 'C100-FIRST-ACCT-CNTL-GEN' TO AA-PARAGRAPH-NAME     06080016
060900         MOVE 'ON FIRST READ PEOPLESOFT ACCTS = ' TO AA-MESSAGE-1 06090017
061100         MOVE 'SPACES' TO AA-MESSAGE-2                            06110016
061300         SET AC-INVALID-DATA TO TRUE                              06130016
061500         PERFORM Z999-ABEND                                       06150016
061600     END-IF.                                                      06160016
061700                                                                  06170016
061800     MOVE SORT-CNTL-RECDTYPE-LINE TO SA-ACCOUNT-REC.              06180025
061900                                                                  06190016
062000     ADD 1 TO PV-ACCT-CONST-REC-CNT.                              06200016
062100                                                                  06210016
062200     PERFORM W100-WRITE-ACCT-CNTL-RTN.                            06220016
062300                                                                  06230016
062400     MOVE SORT-CNTL-FIELDS-LINE TO SA-ACCOUNT-REC.                06240025
062500                                                                  06250016
062600     ADD 1 TO PV-ACCT-CONST-REC-CNT.                              06260016
062700                                                                  06270016
062800     PERFORM W100-WRITE-ACCT-CNTL-RTN.                            06280016
062900                                                                  06290016
063000     IF  EC-PS-ACTIVITY-ID = SPACES                               06300025
063100         MOVE EC-PS-ACCT-NBR TO SCAIL-ACCOUNT                     06310025
063200         MOVE SORT-CNTL-ACCT-INCLUDE-LINE TO SA-ACCOUNT-REC       06320025
063210     ELSE                                                         06321025
063220         MOVE EC-PS-ACCT-NBR TO SCAAIL-ACCOUNT                    06322025
063221         MOVE EC-PS-ACTIVITY-ID TO SCAAIL-ACTIVITY-ID             06322126
063230         MOVE SORT-CNTL-ACCT-ACTV-INCL-LINE TO SA-ACCOUNT-REC     06323026
063240     END-IF.                                                      06324025
063250                                                                  06325025
063300     ADD 1 TO PV-ACCT-CONST-REC-CNT                               06330017
063400              PV-PS-ACCT-CNTL-REC-CNT.                            06340017
063500     PERFORM W100-WRITE-ACCT-CNTL-RTN.                            06350017
063700                                                                  06370016
065900     EJECT                                                        06590016
071400***************************************************************** 07140016
071500* D200-PS-DETAIL-ACCT-CNTL-GEN                                    07150020
071600*  THIS RTN WILL GENERATE THE DETAIL SORT ACCT  CONTROL RECORD.   07160020
071900***************************************************************** 07190016
072100 D200-PS-DETAIL-ACCT-CNTL-GEN.                                    07210016
072200                                                                  07220016
072300     IF EC-PS-ACCT-NBR = SPACES                                   07230025
072400         CONTINUE                                                 07240016
072500     ELSE                                                         07250016
072600         IF PS-FIRST-ACCT-MAINLINE-YES                            07260016
072700             SET PS-FIRST-ACCT-MAINLINE-NO  TO TRUE               07270016
072710             IF  EC-PS-ACTIVITY-ID = SPACES                       07271026
072720                 SET PS-NO-SAVED-ACTIVITY TO TRUE                 07272025
072800                 MOVE EC-PS-ACCT-NBR TO SCARD-ACCOUNT-DETL        07280025
072801             ELSE                                                 07280125
072802                 SET PS-SAVED-ACTIVITY TO TRUE                    07280225
072810                 MOVE EC-PS-ACCT-NBR TO SCAAD-ACCOUNT-DETL        07281025
072820                 MOVE EC-PS-ACTIVITY-ID TO SCAAD-ACTIVITY-ID      07282025
072900         ELSE                                                     07290016
072910             IF  PS-SAVED-ACTIVITY                                07291025
073000                 MOVE SORT-CNTL-ACCT-ACTV-DETAIL TO SA-ACCOUNT-REC07300025
073001             ELSE                                                 07300125
073010                 MOVE SORT-CNTL-ACCT-REC-DETAIL TO SA-ACCOUNT-REC 07301025
073020             END-IF                                               07302025
073100             PERFORM W100-WRITE-ACCT-CNTL-RTN                     07310016
073101             ADD 1 TO PV-PS-ACCT-CNTL-REC-CNT                     07310125
073110             IF  EC-PS-ACTIVITY-ID = SPACES                       07311026
073111                 SET PS-NO-SAVED-ACTIVITY TO TRUE                 07311125
073120                 MOVE EC-PS-ACCT-NBR TO SCARD-ACCOUNT-DETL        07312025
073130             ELSE                                                 07313025
073131                 SET PS-SAVED-ACTIVITY TO TRUE                    07313125
073140                 MOVE EC-PS-ACCT-NBR TO SCAAD-ACCOUNT-DETL        07314025
073150                 MOVE EC-PS-ACTIVITY-ID TO SCAAD-ACTIVITY-ID      07315025
073400         END-IF                                                   07340016
073500     END-IF.                                                      07350016
073800     EJECT                                                        07380016
079200***************************************************************** 07920016
079300* E100-END-ACCT-SORT-CNTL-RTN.                                    07930020
079400*   THIS RTN WILL GENERATE THE CLOSING SORT ACCT CONTROL RECORDS. 07940020
079600*                                                                 07960016
079700*   EOF HAS BEEN REACHED AND NOW GO BACK AND USE THE LAST RECORD  07970020
079800*   READ TO CLOSE OFF THE RUN.                                    07980020
080000***************************************************************** 08000016
080200 E100-END-ACCT-SORT-CNTL-RTN.                                     08020016
080300                                                                  08030016
080310     IF  PS-SAVED-ACTIVITY                                        08031025
080320         MOVE SCAAD-ACTIVITY-ID TO SCAALL-ACTIVITY-ID             08032026
080400         MOVE SCAAD-ACCOUNT-DETL TO SCAALL-ACCOUNT                08040026
080600         MOVE SORT-CNTL-ACCT-ACTV-LAST-LINE TO SA-ACCOUNT-REC     08060026
080601     ELSE                                                         08060125
080610         MOVE SCARD-ACCOUNT-DETL TO SCALL-ACCOUNT                 08061026
080620         MOVE SORT-CNTL-ACCT-LAST-LINE TO SA-ACCOUNT-REC          08062025
080630     END-IF.                                                      08063025
080700                                                                  08070016
080800     PERFORM W100-WRITE-ACCT-CNTL-RTN.                            08080016
080900                                                                  08090016
081000     ADD 1 TO PV-ACCT-CONST-REC-CNT.                              08100016
081100                                                                  08110016
081200     MOVE SORT-CNTL-END-LINE        TO SA-ACCOUNT-REC.            08120025
081300                                                                  08130016
081400     PERFORM W100-WRITE-ACCT-CNTL-RTN.                            08140016
081500                                                                  08150016
081600     ADD 1 TO PV-ACCT-CONST-REC-CNT.                              08160016
081700                                                                  08170016
081800     EJECT                                                        08180016
081900                                                                  08190016
085600***************************************************************** 08560016
085700* R100-READ-EXCEL-FILE-RTN                                        08570020
085800*       THIS RTN WILL READ THE EXCEL FLAT FILE.                   08580016
086000***************************************************************** 08600016
086200 R100-READ-EXCEL-FILE-RTN.                                        08620016
086300                                                                  08630016
086400     READ EXCEL-INPUT-FILE INTO EXCEL-CONTROL-RECORD              08640020
086600       AT END SET PS-EOF-EXCEL-FILE-YES TO TRUE.                  08660020
086800                                                                  08680016
086900     IF PS-EOF-EXCEL-FILE-NO                                      08690016
087000         ADD 1 TO PV-IN-REC-CNT                                   08700016
087100     END-IF.                                                      08710016
087200                                                                  08720016
087300     EJECT                                                        08730016
087400                                                                  08740016
087500***************************************************************** 08750016
087600* W100-WRITE-ACCT-CNTL-RTN                                        08760020
087700*       WRITE THE SORT CONTROL ACCOUNT RECORD OUT.                08770016
087900***************************************************************** 08790016
088100 W100-WRITE-ACCT-CNTL-RTN.                                        08810016
088200                                                                  08820016
088300     WRITE SORT-CNTL-ACCT-RECORD FROM SA-ACCOUNT-REC.             08830025
088600                                                                  08860016
088700     EJECT                                                        08870016
088800                                                                  08880016
090210***************************************************************** 09021017
090220* W200-WRITE-DEPTID-RECORD                                        09022020
090230*       WRITE THE SEQUENTIAL DEPTID FILE RECORD OUT.              09023017
090250***************************************************************** 09025017
090270 W200-WRITE-DEPTID-RECORD.                                        09027020
090280                                                                  09028017
090290     WRITE SEQ-INPUT-DEPTID-RECORD FROM WS-DEPTID-RECORD.         09029020
090293                                                                  09029317
090294     ADD +1 TO PV-DEPT-ID-CNTL-REC-CNT.                           09029417
090295                                                                  09029517
090296     EJECT                                                        09029617
090300                                                                  09030016
090400****************************************************************A 09040016
090500*  Z999 - ABEND                                                   09050016
090600*         ABEND ROUTINE.                                          09060016
090700****************************************************************A 09070016
090800                                                                  09080016
090900 Z999-ABEND.                                                      09090016
091000                                                                  09100016
091100     DISPLAY AA-ABEND-LIT.                                        09110016
091200     DISPLAY AA-PROGRAM-LIT.                                      09120016
091300     DISPLAY AA-PARAGRAPH-LIT.                                    09130016
091400     DISPLAY AA-MESSAGE-LINE.                                     09140016
091500                                                                  09150016
091600     CALL 'ILBOABN0' USING ABEND-CODE.                            09160016
091700                                                                  09170016
091800                                                                  09180016
091900*                                                                 09190016
092000***************************************************************** 09200016
