000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKUT242.                                         00020000
000300 AUTHOR.        NANCY EILBES.                                     00030000
000400 DATE-WRITTEN.  JULY 2004.                                        00040000
000500                                                                  00050000
000600*---------------------------------------------------------------* 00060000
000700*  COBOL 2 WITH PEOPLESOFT SQL                                  * 00070000
000800*                                                               * 00080000
000900*  BUILD CONTROL CARDS TO EXTRACT NEW STORES FROM TMESTDS       * 00090000
001000*                                                               * 00100000
001100*  THE PURPOSE OF THIS PROGRAM IS TO SELECT A LIST OF THE STORE * 00110000
001200*  NUMBERS FROM THE    XFT_LOC TABLE THAT QUALIFY AS CURRENT    * 00120000
001300*  'NEW' STORES.  THE CRITERIA IS BASED ON THE NUMBER OF DAYS   * 00130000
001400*  BEFORE AND AFTER THE GRAND OPENING DATE FOR EACH STORE.  THE * 00140000
001500*  CONTROL CARD WILL BE USED IN AN IBM UNLOAD UTILITY ON TABLE  * 00150000
001600*  TMESTDS.  THE CONTROL CARD IS CREATED SO THAT THE 254        * 00160000
001700*  PARTITIONS ARE UNLOADED IN PARALLEL, AND THEN THE 254 UNLOAD * 00170000
001800*  FILES WILL BE MERGED FOR SUBSEQUENT PROCESSING.              * 00180000
001900*                                                               * 00190000
002000*---------------------------------------------------------------* 00200000
002100*                                                               * 00210000
002200* DB2 TABLES:                                                   * 00220000
002300*  1. FI LOCATION TABLE                (XFT00017)               * 00230000
002400*                                                               * 00240000
002500* OUTPUT:                                                       * 00250000
002600*  1. CONTROL CARD FILE.                                        * 00260000
002700*                                                               * 00270000
002800*---------------------------------------------------------------* 00280000
002900*  CHANGES:                                                     * 00290000
003000*                                                               * 00300000
003100*  DATE  07/06/2004                                             * 00310000
003200*      CHANGE MADE: INITIAL VERSION                             * 00320000
003300*      MADE BY: NANCY EILBES            WR/IR #: WR26679        * 00330000
003400*                                                               * 00340000
003500*  DATE  06/08/2006                                             * 00350000
003600*      CHANGE MADE: ADDED LOGIC TO PARAGRAPHS B100- AND B300-   * 00360000
003700*      TO ISSUE THE RETURN CODE +4050 WHEN NO NEW STORES ARE    * 00370000
003800*      FOUND BY THE NEW_STR_CSR CURSOR.                         * 00380000
003900*      MADE BY: KRYSTEN LEARY           WR/IR #: P000888355     * 00390000
004000*                                                               * 00400000
004100*  DATE  03/27/2007                                             * 00410000
004200*      CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE    * 00420000
004300*      CHANGES TO    XFT_LOC TABLE FOR STORE DEMOGRAPHICS.      * 00430000
004400*      MADE BY: KEVIN CATLIN            WR/IR #: WR31452        * 00440000
004500*                                                               * 00450000
004600*  DATE  10/10/2008                                             * 00460000
004700*      CHANGE MADE: MODIFIED THE CODE TO CREATE ONLY ONE OUTPUT * 00470000
004800*      FILE INSTEAD OF FOUR.  ALSO CHANGED THE HARDCODED VALUES * 00480000
004900*      FOR THE CONTROL CARD OUTPUT FILE TO ALLOW THE IBM UTILITY* 00490000
005000*      TO UNLOAD TMESTDS 254 PARTITIONS IN PARALLEL.  THIS IS   * 00500000
005100*      BEING DONE BECAUSE THE BMC UNLOAD IS BEING DISCONTINUED  * 00510000
005200*      IN FEB 2009.                                             * 00520000
005300*      MADE BY: MIKE BESKE              WR/IR #: WR35173        * 00530000
005400*                                                               * 00540000
005410*  DATE  03/23/2009                                             * 00541000
005420*      CHANGE MADE: MODIFIED THE HARDCODED UNLOAD DSN NAME TO   * 00542000
005430*      PKMT INSTEAD OF PKMO.  THIS WILL STOP THE HSM UTILITY    * 00543000
005440*      FROM TRYING TO MIGRATE THE UNLOAD DATASET THAT WAS THE   * 00544000
005450*      CAUSE OF APK016 CONTENTION ABEND.                        * 00545000
005460*      MADE BY: MIKE BESKE              WR/IR #: INC000000750352* 00546000
005470*                                                               * 00547000
005471* DATE  09/22/2011                                              * 00547100
005472*   CHANGE MADE: PROGRAM WAS MODIFIED FOR DB2 RE-PLATFORM       * 00547200
005473*   TO ORACLE AS PART OF THE PEOPLESOFT FINANCIAL UPGRADE TO    * 00547300
005474*   VERSION 9.1.                                                * 00547400
005475*   - DB2 TABLE NAME WILL BE CHANGED FROM PS_XFT_LOC TO         * 00547500
005476*     XFT_LOC.                                                  * 00547600
005477*     ITS DCLGEN CHANGED FROM XFT00003 TO XFT00017.             * 00547700
005478*   - CHANGES DONE IN PARA B100-,C100-,R200-,X100-,Y100-        * 00547800
005479*     MADE BY: WARNER                  WR/IR #: WR37038         * 00547900
005480*                                                               * 00548000
005481*---------------------------------------------------------------* 00548100
005490                                                                  00548200
005500 ENVIRONMENT DIVISION.                                            00548300
005600 CONFIGURATION SECTION.                                           00548400
005700 SOURCE-COMPUTER. IBM-3090.                                       00548500
005800 OBJECT-COMPUTER. IBM-3090.                                       00548600
005900                                                                  00548700
006000 INPUT-OUTPUT SECTION.                                            00548800
006100 FILE-CONTROL.                                                    00548900
006200                                                                  00549000
006300     SELECT CONTROL-CARD-A-FILE ASSIGN TO UT-S-OUT01.             00550000
006400                                                                  00560000
006500 DATA DIVISION.                                                   00570000
006600 FILE SECTION.                                                    00580000
006700                                                                  00590000
006800 FD  CONTROL-CARD-A-FILE                                          00600000
006900     RECORDING MODE IS F                                          00610000
007000     BLOCK CONTAINS 0 CHARACTERS                                  00620000
007100     LABEL RECORDS ARE STANDARD                                   00630000
007200     DATA RECORD IS CONTROL-CARD-RECORD.                          00640000
007300                                                                  00650000
007400 01  CONTROL-CARD-RECORD.                                         00660000
007500     05  CONTROL-CARD-REC-A       PIC X(70).                      00670000
007600     05  CONTROL-CARD-REC-B       PIC X(01).                      00680000
007700     05  CONTROL-CARD-REC-C       PIC X(09).                      00690000
007800                                                                  00700000
007900 WORKING-STORAGE SECTION.                                         00710000
008000                                                                  00720000
008100 01  PC-PROGRAM-CONSTANTS.                                        00730000
008200     05  PC-WS-PROGRAM           PIC X(40) VALUE                  00740000
008300         '**** WORKING STORAGE ** APKUT242 ****'.                 00750000
008400     05  PC-COMMA                PIC X(01) VALUE ','.             00760000
008500     05  PC-CLOSE-PAREN          PIC X(01) VALUE ')'.             00770000
008600     05  PC-BLANK-LINE           PIC X(80) VALUE SPACE.           00780000
008700     05  PC-TEMPLATE-LINE.                                        00790000
008800         10  FILLER              PIC X(02) VALUE SPACE.           00800000
008900         10  FILLER              PIC X(53) VALUE                  00810000
009000         'TEMPLATE TMP1 DSN PKMT.AP.WORK.UNLOAD.SMESTDS.P&PART.'. 00820000
009100         10  FILLER              PIC X(11) VALUE                  00830000
009200         ' UNIT SYSDA'.                                           00840000
009300         10  FILLER              PIC X(14) VALUE SPACE.           00850000
009400     05  PC-SPACE-LINE.                                           00860000
009500         10  FILLER              PIC X(21) VALUE                  00870000
009600         '   SPACE (100,50) CYL'.                                 00880000
009700         10  FILLER              PIC X(59) VALUE SPACE.           00890000
009800     05  PC-UNLOAD-LINE.                                          00900000
009900         10  FILLER              PIC X(50) VALUE                  00910000
010000         '  UNLOAD TABLESPACE DPOKAPL0.SMESTDS   UNLDDN TMP1'.    00920000
010100         10  FILLER              PIC X(30) VALUE SPACE.           00930000
010200     05  PC-FROM-LINE.                                            00940000
010300         10  FILLER              PIC X(30) VALUE                  00950000
010400         '    FROM TABLE DB2PDBA.TMESTDS'.                        00960000
010500         10  FILLER              PIC X(50) VALUE SPACE.           00970000
010600     05  PC-HEADER-LINE.                                          00980000
010700         10  FILLER              PIC X(15) VALUE                  00990000
010800         '    HEADER NONE'.                                       01000000
010900         10  FILLER              PIC X(65) VALUE SPACE.           01010000
011000     05  PC-PO-LINE.                                              01020000
011100         10  FILLER              PIC X(23) VALUE                  01030000
011200         '      (PO_NBR, STR_NBR)'.                               01040000
011300         10  FILLER              PIC X(57) VALUE SPACE.           01050000
011400     05  PC-WHEN-LINE.                                            01060000
011500         10  FILLER              PIC X(12) VALUE                  01070000
011600         '        WHEN'.                                          01080000
011700         10  FILLER              PIC X(68) VALUE SPACE.           01090000
011800     05  PC-NOPAD-LINE.                                           01100000
011900         10  FILLER              PIC X(09) VALUE                  01110000
012000         '    NOPAD'.                                             01120000
012100         10  FILLER              PIC X(71) VALUE SPACE.           01130000
012200     05  PC-SHRLEVEL-LINE.                                        01140000
012300         10  FILLER              PIC X(32) VALUE                  01150000
012400         '    SHRLEVEL CHANGE ISOLATION UR'.                      01160000
012500         10  FILLER              PIC X(48) VALUE SPACE.           01170000
012600                                                                  01180000
012700                                                                  01190000
012800 01  PV-PROGRAM-VARIABLES.                                        01200000
012900     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      01210000
013000     05  PV-NULL-IND             PIC S9(4)     VALUE ZERO         01220000
013100                                               COMP SYNC.         01230000
013200     05  PV-NEW-STR-COUNT        PIC S9(9)     VALUE ZEROS        01240000
013300                                               COMP.              01250000
013400     05  PV-WHERE-A.                                              01260000
013500         10  FILLER                PIC X(20)   VALUE              01270000
013600         '       (STR_NBR IN ('.                                  01280000
013700         10  PV-LIST-A             PIC X(50)   VALUE SPACES.      01290000
013800         10  FILLER                PIC X(10)   VALUE SPACES.      01300000
013900                                                                  01310000
014000     05  PV-WHERE-B.                                              01320000
014100         10  FILLER                PIC X(20)   VALUE SPACES.      01330000
014200         10  PV-LIST-B             PIC X(50)   VALUE SPACES.      01340000
014300         10  FILLER                PIC X(10)   VALUE SPACES.      01350000
014400                                                                  01360000
014500     05  PV-WHERE-LIST.                                           01370000
014600         10  PV-WHERE-TBL OCCURS 10 TIMES INDEXED BY WHERE-COUNT. 01380000
014700             15  PV-STR-NBR        PIC X(04).                     01390000
014800             15  PV-COMMA          PIC X(01).                     01400000
014900                                                                  01410000
015000                                                                  01420000
015100 01  PS-PROGRAM-SWITCHES.                                         01430000
015200     05  PS-NEW-STR-SW             PIC X(01) VALUE ' '.           01440000
015300         88  PS-END-NEW-STR                  VALUE 'Y'.           01450000
015400         88  PS-MORE-NEW-STR                 VALUE ' '.           01460000
015500     05  NEW-STORES-FOUND-SW       PIC X(01) VALUE ' '.           01470000
015600         88  NEW-STORES-FOUND                VALUE 'Y'.           01480000
015700         88  NO-NEW-STORES-FOUND             VALUE 'N'.           01490000
015800                                                                  01500000
015900 01  RUN-DATE                     PIC X(6).                       01510000
016000 01  RUN-TIME                     PIC 9(8).                       01520000
016100                                                                  01530000
016200*----------------------------------------------------------------*01540000
016300*    FI LOCATION DCLGEN                                           01550000
016400*----------------------------------------------------------------*01560000
016500     EXEC SQL                                                     01570000
016600         INCLUDE XFT00017                                         01580000
016700     END-EXEC.                                                    01590000
016800*----------------------------------------------------------------*01600000
016900*    SQL COMMUNICATIONS AREA DCLGEN                               01610000
017000*----------------------------------------------------------------*01620000
017100     EXEC SQL                                                     01630000
017200         INCLUDE SQLCA                                            01640000
017300     END-EXEC.                                                    01650000
017400*----------------------------------------------------------------*01660000
017500*   NEW_STR_CSR RETRIEVES ALL STORE NUMBERS THAT HAVE GRAND      *01670000
017600*   OPENING DATES THAT FALL IN THE DATE RANGE SPECIFIED.         *01680000
017700*----------------------------------------------------------------*01690000
017800*** THE GRND_OPN_DTE > '2004-08-30' IS ONLY REQUIRED FOR START UP 01700000
017900*** SO THAT THE AUGUST 2004 STORES WON'T BE LOADED - THIS PROCESS 01710000
018000*** IS BEGINNING WITH THE OCT 2004 STORES.  AFTER 10/30/04, THAT  01720000
018100*** CRITERIA AND THIS COMMENT CAN BE REMOVED.                     01730000
018200     EXEC SQL                                                     01740000
018300       DECLARE NEW_STR_CSR CURSOR FOR                             01750000
018400         SELECT LOC_NBR                                           01760000
018500           FROM XFT_LOC                                           01770000
018600          WHERE LOC_TYP_CDE = 'DS'                                01780000
018700            AND GRND_OPN_DTE > '2004-08-30'                       01790000
018800            AND CURRENT DATE BETWEEN (GRND_OPN_DTE - 90 DAYS)     01800000
018900                                 AND (GRND_OPN_DTE + 60 DAYS)     01810000
019000          ORDER BY LOC_NBR                                        01820000
019100     END-EXEC.                                                    01830000
019200                                                                  01840000
019300*---------------------------------------------------------------- 01850000
019400*  ABEND DATA AREAS                                               01860000
019500*---------------------------------------------------------------- 01870000
019600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01880000
019700                                             COMP SYNC.           01890000
019800     88  AC-BAD-DATA                         VALUE +4003.         01900000
019900     88  AC-DB2-ERROR                        VALUE +4013.         01910000
020000     88  AC-NO-ROWS-FOUND                    VALUE +4050.         01920000
020100                                                                  01930000
020200 01  ABEND-AREAS.                                                 01940000
020300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01950000
020400             '*****       ABEND'.                                 01960000
020500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01970000
020600             '*****   PROGRAM: APKUT242'.                         01980000
020700     05  AA-PARAGRAPH-LIT.                                        01990000
020800         10  FILLER              PIC  X(17)  VALUE                02000000
020900             '***** PARAGRAPH: '.                                 02010000
021000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02020000
021100     05  AA-MESSAGE-LINE.                                         02030000
021200         10  FILLER              PIC  X(06)  VALUE '*****'.       02040000
021300         10  AA-MESSAGE.                                          02050000
021400             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        02060000
021500             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        02070000
021600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02080000
021700             '*****    DB2 ERROR'.                                02090000
021800     05  AA-DB2-OPERATION-LIT.                                    02100000
021900         10  FILLER              PIC  X(17)  VALUE                02110000
022000             '***** OPERATION: '.                                 02120000
022100         10  AA-DB2-OPERATION.                                    02130000
022200             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02140000
022300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02150000
022400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02160000
022500                                                                  02170000
022600*---------------------------------------------------------------- 02180000
022700*  SQLCA FORMATTED MESSAGE AREA                                   02190000
022800*---------------------------------------------------------------- 02200000
022900     COPY DPWS004.                                                02210000
023000                                                                  02220000
023100 01  FILLER                      PIC  X(35)  VALUE                02230000
023200     '**** END OF W/S ** APKUT242 ****'.                          02240000
023300                                                                  02250000
023400 PROCEDURE DIVISION.                                              02260000
023500                                                                  02270000
023600     PERFORM A100-MAINLINE.                                       02280000
023700     GOBACK.                                                      02290000
023800                                                                  02300000
023900                                                                  02310000
024000 A100-MAINLINE.                                                   02320000
024100                                                                  02330000
024200     PERFORM B100-INITIALIZE.                                     02340000
024300                                                                  02350000
024400     PERFORM B200-PROCESS-EXTRACT-FILE                            02360000
024500         UNTIL PS-END-NEW-STR.                                    02370000
024600                                                                  02380000
024700     PERFORM B300-END-OF-PROGRAM.                                 02390000
024800                                                                  02400000
024900*---------------------------------------------------------------- 02410000
025000*    INITIALIZATION PROCESSING.                                   02420000
025100*---------------------------------------------------------------- 02430000
025200 B100-INITIALIZE.                                                 02440000
025300                                                                  02450000
025400     ACCEPT RUN-TIME FROM TIME.                                   02460000
025500     ACCEPT RUN-DATE FROM DATE.                                   02470000
025600                                                                  02480000
025700     DISPLAY ' RUN-DATE = ' RUN-DATE '   RUN-TIME = ' RUN-TIME.   02490000
025800                                                                  02500000
025900     OPEN OUTPUT CONTROL-CARD-A-FILE.                             02510000
026000                                                                  02520000
026100     INITIALIZE DCLXFT00017.                                      02530000
026200                                                                  02540000
026300     SET PS-MORE-NEW-STR TO TRUE.                                 02550000
026400                                                                  02560000
026500     PERFORM X100-OPEN-NEW-STORE-CSR.                             02570000
026600                                                                  02580000
026700     PERFORM R200-FETCH-NEW-STR.                                  02590000
026800                                                                  02600000
026900     IF PS-END-NEW-STR                                            02610000
027000        DISPLAY 'B100-INITIALIZE'                                 02620000
027100        DISPLAY 'NO STORE NUMBERS FOR BUILDING CNTL CARDS'        02630000
027200        SET NO-NEW-STORES-FOUND   TO TRUE                         02640000
027300     ELSE                                                         02650000
027400        PERFORM C200-CREATE-1ST-CARDS                             02660000
027500        PERFORM VARYING WHERE-COUNT FROM 1 BY 1                   02670000
027600          UNTIL WHERE-COUNT > 10                                  02680000
027700             MOVE SPACES TO PV-STR-NBR (WHERE-COUNT)              02690000
027800             MOVE SPACES TO PV-COMMA (WHERE-COUNT)                02700000
027900        END-PERFORM                                               02710000
028000     END-IF.                                                      02720000
028100                                                                  02730000
028200*---------------------------------------------------------------- 02740000
028300*    CONTROLS THE PROCESSING OF THE GL ACCOUNT NUMBERS THAT ARE   02750000
028400*    MARKED FOR REPORTING PURPOSES.  FOR EVERY ACCOUNT NUMBER     02760000
028500*    THAT IS FETCHED, TWO DIFFERENT SORT CONTROL CARDS ARE        02770000
028600*    FORMATTED.  ONE WILL BE USED FOR FILES IN THE APRD045 LAYOUT 02780000
028700*    AND THE OTHER WILL BE USED FOR FILES IN THE APRD063 LAYOUT.  02790000
028800*---------------------------------------------------------------- 02800000
028900 B200-PROCESS-EXTRACT-FILE.                                       02810000
029000                                                                  02820000
029100     PERFORM VARYING WHERE-COUNT FROM 1 BY 1                      02830000
029200       UNTIL PS-END-NEW-STR OR WHERE-COUNT > 10                   02840000
029300          PERFORM C100-CREATE-WHERE-LIST                          02850000
029400     END-PERFORM.                                                 02860000
029500                                                                  02870000
029600     MOVE PV-WHERE-LIST TO PV-LIST-A.                             02880000
029700     MOVE PV-WHERE-A    TO CONTROL-CARD-REC-A.                    02890000
029800                                                                  02900000
029900     PERFORM W100-WRITE-CONTROL-CARDS.                            02910000
030000                                                                  02920000
030100     PERFORM VARYING WHERE-COUNT FROM 1 BY 1                      02930000
030200       UNTIL WHERE-COUNT > 10                                     02940000
030300          MOVE SPACES TO PV-STR-NBR (WHERE-COUNT)                 02950000
030400          MOVE SPACES TO PV-COMMA (WHERE-COUNT)                   02960000
030500     END-PERFORM.                                                 02970000
030600                                                                  02980000
030700     IF  PS-END-NEW-STR                                           02990000
030800         CONTINUE                                                 03000000
030900     ELSE                                                         03010000
031000         PERFORM UNTIL PS-END-NEW-STR                             03020000
031100             PERFORM VARYING WHERE-COUNT FROM 1 BY 1              03030000
031200               UNTIL PS-END-NEW-STR OR WHERE-COUNT > 10           03040000
031300                  PERFORM C100-CREATE-WHERE-LIST                  03050000
031400             END-PERFORM                                          03060000
031500                                                                  03070000
031600             MOVE PV-WHERE-LIST TO PV-LIST-B                      03080000
031700             MOVE PV-WHERE-B    TO CONTROL-CARD-REC-A             03090000
031800                                                                  03100000
031900             PERFORM W100-WRITE-CONTROL-CARDS                     03110000
032000                                                                  03120000
032100             PERFORM VARYING WHERE-COUNT FROM 1 BY 1              03130000
032200               UNTIL WHERE-COUNT > 10                             03140000
032300                  MOVE SPACES TO PV-STR-NBR (WHERE-COUNT)         03150000
032400                  MOVE SPACES TO PV-COMMA (WHERE-COUNT)           03160000
032500             END-PERFORM                                          03170000
032600         END-PERFORM                                              03180000
032700     END-IF.                                                      03190000
032800                                                                  03200000
032900*---------------------------------------------------------------- 03210000
033000*    END OF PROGRAM.                                              03220000
033100*---------------------------------------------------------------- 03230000
033200 B300-END-OF-PROGRAM.                                             03240000
033300                                                                  03250000
033400     PERFORM C300-CREATE-2ND-CARDS.                               03260000
033500                                                                  03270000
033600     DISPLAY '** COUNTS FOR APKUT242 **'.                         03280000
033700     DISPLAY 'NBR OF LOCATIONS FETCHED    = ' PV-NEW-STR-COUNT.   03290000
033800     DISPLAY '** PROGRAM APKUT242 ENDS NORMALLY **'.              03300000
033900                                                                  03310000
034000     PERFORM Y100-CLOSE-NEW-STR-CSR.                              03320000
034100                                                                  03330000
034200     IF NO-NEW-STORES-FOUND                                       03340000
034300        MOVE 4050                  TO RETURN-CODE                 03350000
034400     END-IF.                                                      03360000
034500                                                                  03370000
034600     CLOSE CONTROL-CARD-A-FILE.                                   03380000
034700                                                                  03390000
034800*---------------------------------------------------------------- 03400000
034900*   MOVES STORE NUMBERS INTO WHERE LIST ARRAY.                    03410000
035000*---------------------------------------------------------------- 03420000
035100 C100-CREATE-WHERE-LIST.                                          03430000
035200                                                                  03440000
035300     MOVE XFT00017-LOC-NBR         TO PV-STR-NBR (WHERE-COUNT).   03450000
035400                                                                  03460000
035500     PERFORM R200-FETCH-NEW-STR.                                  03470000
035600                                                                  03480000
035700     IF PS-END-NEW-STR                                            03490000
035800        MOVE PC-CLOSE-PAREN TO PV-COMMA (WHERE-COUNT)             03500000
035900     ELSE                                                         03510000
036000        MOVE PC-COMMA       TO PV-COMMA (WHERE-COUNT)             03520000
036100     END-IF.                                                      03530000
036200                                                                  03540000
036300*---------------------------------------------------------------- 03550000
036400*   CREATES THE FIRST GROUP OF COMMON CONTROL CARDS ON ALL FOUR   03560000
036500*   CONTROL FILES.                                                03570000
036600*---------------------------------------------------------------- 03580000
036700 C200-CREATE-1ST-CARDS.                                           03590000
036800                                                                  03600000
036900     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03610000
037000                                                                  03620000
037100     MOVE PC-TEMPLATE-LINE        TO CONTROL-CARD-REC-A.          03630000
037200                                                                  03640000
037300     PERFORM W100-WRITE-CONTROL-CARDS.                            03650000
037400                                                                  03660000
037500     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03670000
037600                                                                  03680000
037700     MOVE PC-SPACE-LINE           TO CONTROL-CARD-REC-A.          03690000
037800                                                                  03700000
037900     PERFORM W100-WRITE-CONTROL-CARDS.                            03710000
038000                                                                  03720000
038100     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03730000
038200                                                                  03740000
038300     MOVE PC-BLANK-LINE           TO CONTROL-CARD-REC-A.          03750000
038400                                                                  03760000
038500     PERFORM W100-WRITE-CONTROL-CARDS.                            03770000
038600                                                                  03780000
038700     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03790000
038800                                                                  03800000
038900     MOVE PC-UNLOAD-LINE          TO CONTROL-CARD-REC-A.          03810000
039000                                                                  03820000
039100     PERFORM W100-WRITE-CONTROL-CARDS.                            03830000
039200                                                                  03840000
039300     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03850000
039400                                                                  03860000
039500     MOVE PC-FROM-LINE            TO CONTROL-CARD-REC-A.          03870000
039600                                                                  03880000
039700     PERFORM W100-WRITE-CONTROL-CARDS.                            03890000
039800                                                                  03900000
039900     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03910000
040000                                                                  03920000
040100     MOVE PC-HEADER-LINE          TO CONTROL-CARD-REC-A.          03930000
040200                                                                  03940000
040300     PERFORM W100-WRITE-CONTROL-CARDS.                            03950000
040400                                                                  03960000
040500     MOVE SPACES                  TO CONTROL-CARD-RECORD.         03970000
040600                                                                  03980000
040700     MOVE PC-PO-LINE              TO CONTROL-CARD-REC-A.          03990000
040800                                                                  04000000
040900     PERFORM W100-WRITE-CONTROL-CARDS.                            04010000
041000                                                                  04020000
041100     MOVE SPACES                  TO CONTROL-CARD-RECORD.         04030000
041200                                                                  04040000
041300     MOVE PC-WHEN-LINE            TO CONTROL-CARD-REC-A.          04050000
041400                                                                  04060000
041500     PERFORM W100-WRITE-CONTROL-CARDS.                            04070000
041600                                                                  04080000
041700     MOVE SPACES                  TO CONTROL-CARD-RECORD.         04090000
041800                                                                  04100000
041900*---------------------------------------------------------------- 04110000
042000*   CREATES THE SECOND GROUP OF COMMON CONTROL CARDS ON ALL FOUR  04120000
042100*   CONTROL FILES.                                                04130000
042200*---------------------------------------------------------------- 04140000
042300 C300-CREATE-2ND-CARDS.                                           04150000
042400                                                                  04160000
042500     MOVE SPACES                  TO CONTROL-CARD-RECORD          04170000
042600                                     PC-CLOSE-PAREN.              04180000
042700                                                                  04190000
042800     MOVE PC-NOPAD-LINE           TO CONTROL-CARD-REC-A.          04200000
042900                                                                  04210000
043000     PERFORM W100-WRITE-CONTROL-CARDS.                            04220000
043100                                                                  04230000
043200     MOVE SPACES                  TO CONTROL-CARD-RECORD.         04240000
043300                                                                  04250000
043400     MOVE PC-SHRLEVEL-LINE        TO CONTROL-CARD-REC-A.          04260000
043500                                                                  04270000
043600     PERFORM W100-WRITE-CONTROL-CARDS.                            04280000
043700                                                                  04290000
043800     MOVE SPACES                  TO CONTROL-CARD-RECORD.         04300000
043900                                                                  04310000
044000*---------------------------------------------------------------- 04320000
044100*    RETRIEVES THE LOCATION NUMBER FROM THE NEW STORE CURSOR.     04330000
044200*---------------------------------------------------------------- 04340000
044300 R200-FETCH-NEW-STR.                                              04350000
044400                                                                  04360000
044500     EXEC SQL                                                     04370000
044600         FETCH NEW_STR_CSR                                        04380000
044700         INTO  :XFT00017-LOC-NBR                                  04390000
044800     END-EXEC.                                                    04400000
044900                                                                  04410000
045000     EVALUATE TRUE                                                04420000
045100         WHEN SQLCODE = ZERO                                      04430000
045200              ADD 1 TO PV-NEW-STR-COUNT                           04440000
045300         WHEN SQLCODE = +100                                      04450000
045400              SET PS-END-NEW-STR TO TRUE                          04460000
045500         WHEN SQLWARN0 NOT = SPACES                               04470000
045600         WHEN SQLCODE  NOT = ZERO                                 04480000
045700             MOVE 'R200-FETCH-NEW-STR' TO AA-PARAGRAPH-NAME       04490000
045800             MOVE 'UNSUCCESSFUL FETCH' TO AA-DB2-OPERATION        04500000
045900             MOVE 'XFT00017'           TO AA-DB2-TABLE-1          04510000
046000             PERFORM Z998-DB2-ABEND                               04520000
046100     END-EVALUATE.                                                04530000
046200                                                                  04540000
046300*---------------------------------------------------------------- 04550000
046400*    WRITES THE CONTROL CARDS TO ALL FOUR CONTROL FILES.          04560000
046500*    ALL FOUR FILES GET THE SAME CONTROL CARDS EXCEPT FOR THE     04570000
046600*    LIST OF PARTITION NUMBERS.                                   04580000
046700*---------------------------------------------------------------- 04590000
046800 W100-WRITE-CONTROL-CARDS.                                        04600000
046900                                                                  04610000
047000     IF PS-END-NEW-STR                                            04620000
047100        MOVE PC-CLOSE-PAREN TO CONTROL-CARD-REC-B                 04630000
047200     ELSE                                                         04640000
047300        MOVE SPACE          TO CONTROL-CARD-REC-B                 04650000
047400     END-IF.                                                      04660000
047500                                                                  04670000
047600     MOVE SPACE             TO CONTROL-CARD-REC-C.                04680000
047700                                                                  04690000
047800     WRITE CONTROL-CARD-RECORD.                                   04700000
047900                                                                  04710000
048000*---------------------------------------------------------------- 04720000
048100*    OPENS THE NEW STORE CURSOR.                                  04730000
048200*---------------------------------------------------------------- 04740000
048300 X100-OPEN-NEW-STORE-CSR.                                         04750000
048400                                                                  04760000
048500     EXEC SQL                                                     04770000
048600         OPEN NEW_STR_CSR                                         04780000
048700     END-EXEC.                                                    04790000
048800                                                                  04800000
048900     EVALUATE TRUE                                                04810000
049000         WHEN SQLCODE = ZERO                                      04820000
049100              CONTINUE                                            04830000
049200                                                                  04840000
049300         WHEN SQLWARN0 NOT = SPACES                               04850000
049400         WHEN SQLCODE  NOT = ZERO                                 04860000
049500             MOVE 'X100-OPEN-NEW-STORE-CSR'  TO AA-PARAGRAPH-NAME 04870000
049600             MOVE 'UNSUCCESSFUL OPEN CURSOR' TO AA-DB2-OPERATION  04880000
049700             MOVE 'XFT00017'                 TO AA-DB2-TABLE-1    04890000
049800             PERFORM Z998-DB2-ABEND                               04900000
049900     END-EVALUATE.                                                04910000
050000                                                                  04920000
050100*---------------------------------------------------------------- 04930000
050200*    CLOSES THE ACCOUNT TYPE CURSOR.                              04940000
050300*---------------------------------------------------------------- 04950000
050400 Y100-CLOSE-NEW-STR-CSR.                                          04960000
050500                                                                  04970000
050600     EXEC SQL                                                     04980000
050700         CLOSE NEW_STR_CSR                                        04990000
050800     END-EXEC.                                                    05000000
050900                                                                  05010000
051000     EVALUATE TRUE                                                05020000
051100         WHEN SQLCODE = ZERO                                      05030000
051200              CONTINUE                                            05040000
051300                                                                  05050000
051400         WHEN SQLWARN0 NOT = SPACES                               05060000
051500         WHEN SQLCODE  NOT = ZERO                                 05070000
051600             MOVE 'Y100-CLOSE-NEW-STORE-CSR'  TO AA-PARAGRAPH-NAME05080000
051700             MOVE 'UNSUCCESSFUL CLOSE CURSOR' TO AA-DB2-OPERATION 05090000
051800             MOVE 'XFT00017'                  TO AA-DB2-TABLE-1   05100000
051900             PERFORM Z998-DB2-ABEND                               05110000
052000     END-EVALUATE.                                                05120000
052100                                                                  05130000
052200*---------------------------------------------------------------- 05140000
052300*    ABEND ROUTINE FOR DB2 ERRORS.                                05150000
052400*---------------------------------------------------------------- 05160000
052500 Z998-DB2-ABEND.                                                  05170000
052600                                                                  05180000
052700     CLOSE CONTROL-CARD-A-FILE.                                   05190000
052800                                                                  05200000
052900     DISPLAY AA-ABEND-LIT.                                        05210000
053000     DISPLAY AA-MESSAGE-LINE.                                     05220000
053100     DISPLAY AA-DB2-ERROR-LIT.                                    05230000
053200     DISPLAY AA-PROGRAM-LIT.                                      05240000
053300     DISPLAY AA-PARAGRAPH-LIT.                                    05250000
053400     DISPLAY AA-DB2-OPERATION-LIT.                                05260000
053500     DISPLAY AA-DB2-TABLE-1.                                      05270000
053600     SET AC-DB2-ERROR TO TRUE.                                    05280000
053700                                                                  05290000
053800     COPY DPPD004.                                                05300000
053900                                                                  05310000
054000     CALL 'ILBOABN0' USING ABEND-CODE.                            05320000
054100                                                                  05330000
054200*----------------------------------------------------------------*05340000
054300*    ABEND ROUTINE.                                              *05350000
054400*----------------------------------------------------------------*05360000
054500 Z999-ABEND.                                                      05370000
054600                                                                  05380000
054700     CLOSE CONTROL-CARD-A-FILE.                                   05390000
054800                                                                  05400000
054900     DISPLAY AA-ABEND-LIT.                                        05410000
055000     DISPLAY AA-PROGRAM-LIT.                                      05420000
055100     DISPLAY AA-PARAGRAPH-LIT.                                    05430000
055200     DISPLAY AA-MESSAGE-LINE.                                     05440000
055300     CALL 'ILBOABN0' USING ABEND-CODE.                            05450000
