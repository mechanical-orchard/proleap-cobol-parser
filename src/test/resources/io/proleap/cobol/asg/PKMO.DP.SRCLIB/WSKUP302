000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    WSKUP302.                                         00020000
000300 AUTHOR.        JEAN KURKOWSKI.                                   00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   MAY 2007.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080000
000810* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00081000
000811* THIS PROGRAM USES MQSERIES.                                     00081100
000811*                                                                 00081200
000811* THIS PROGRAM IS THE BATCH VERSION OF WSKCS302.                  00081300
000811* CHECK TO SEE IF WSKUP302 NEEDS TO BE CHANGED WHEN MAKING        00081400
000811* CHANGES TO THIS PROGRAM.                                        00081500
000812******************************************************************00081600
000813*               ASN TRANSMISSION MODULE                           00081700
000814*               -----------------------                           00081800
000816*                                                                 00081900
000817* THIS PROGRAM WILL READ THE TEMP TABLE WST_ASN_DWNLD             00082000
000818* AND MAP INCOMING ROWS TO XML RECORD TYPES FOR PROCESSING        00082100
000819* BY THE XML GENERATOR.  THE MAPPING SUMMARY IS;                  00082200
000820*                                                                 00082300
000821* RECID 'CH' = CASE HEADER --> ASNCase (CH-SUB)                   00082400
000822* RECID 'CD' = CASE DETAIL --> ASNCaseDetail (CH-SUB CD-SUB)      00082500
000830* RECID 'AH' = ASN HEADER  --> InboundASN                         00082600
000840* RECID 'CD' = ASN DETAIL  --> ASNDeail (AD-SUB)                  00082700
000850* RECID 'AP' = APPOINTMENT --> ApptScheduleBridge                 00082800
000860*                                                                 00082900
000870******************************************************************00083007
002700* 06/22/2017 CHERI PARMLEY                                        00083107
002800*            CHANGE in 1150-GET-INPUT-QUEUE-INFO TO MOVE THE DC   00083207
002900*            # BEFORE THE SELECT AND THEN CHECK FOR IT IT THE     00083307
003000*            WHERE CLAUSE. THIS WAS NEEDED WHEN Efc5 IS USING A   00083407
003100*            DIFFERENT QUEUE THAN THE OTHER eFCs/LFC's.           00083507
003200*                                                                 00083607
003300*            WST_ATTR_ELEM was changed to include all the eFC's   00083707
003400*            and LFC's. Included on the table are 'SH' these are  00083807
003500*            Stores for the eFC's and LFC's. RC uses 'DC' loc.    00083907
000870******************************************************************00084006
218265* 02/25/2019 Jim Arendt                    CHG0218265             00084242
218265*  CHANGE MADE: Change made to populate new XML field AltCaseNbr. 00084342
218265******************************************************************00084442
000880 ENVIRONMENT DIVISION.                                            00084500
000890******************************************************************00084600
000900 CONFIGURATION SECTION.                                           00084700
001000 SOURCE-COMPUTER.        IBM-3090.                                00084800
001100 OBJECT-COMPUTER.        IBM-3090.                                00084900
001200                                                                  00085000
001300*INPUT-OUTPUT SECTION.                                            00085100
001400*FILE-CONTROL.                                                    00085200
001500                                                                  00085300
002500******************************************************************00085400
002600 DATA DIVISION.                                                   00085500
002700*FILE SECTION.                                                    00086000
002800*                                                                 00087000
004004 WORKING-STORAGE SECTION.                                         00088000
004010 01  PV-XML                          PIC X(5500000)  VALUE SPACES.00089040
004020 01  PV-XML2 REDEFINES PV-XML.                                    00090000
004030     05 PV-XML2-CHAR OCCURS  5500000 INDEXED BY X1 PIC X(01).     00100040
004040                                                                  00110000
004050 01  PV-PROGRAM-VARIABLES.                                        00120000
004060     05  PV-FETCH1                   PIC S9(07) COMP VALUE +0.    00130000
004070     05  PV-XML-WRITE                PIC S9(07) COMP VALUE +0.    00140000
004080     05  PV-CH-CNT                   PIC S9(07) COMP VALUE +0.    00150000
004090     05  PV-CD-CNT                   PIC S9(07) COMP VALUE +0.    00160000
004100     05  PV-AD-CNT                   PIC S9(07) COMP VALUE +0.    00170000
004200     05  PV-AP-CNT                   PIC S9(07) COMP VALUE +0.    00180000
004300     05  PV-AH-CNT                   PIC S9(07) COMP VALUE +0.    00190000
004400     05  PV-OT-CNT                   PIC S9(07) COMP VALUE +0.    00200000
004500     05  PV-CH-XML                   PIC S9(07) COMP VALUE +0.    00210000
004600     05  PV-AH-XML                   PIC S9(07) COMP VALUE +0.    00220000
004700     05  PV-AD-XML                   PIC S9(07) COMP VALUE +0.    00230000
004800     05  PV-AP-XML                   PIC S9(07) COMP VALUE +0.    00240000
004900     05  PV-MQ-MESSAGES              PIC S9(07) COMP VALUE +0.    00250000
005000     05  PV-XML-OUT                  PIC S9(07) COMP VALUE +0.    00260000
005100     05  PV-CONVERT-NUM              PIC 99999999.9999.           00270000
005200     05  PV-LAST-CSE-DTL-NBR         PIC S9(04) COMP VALUE 0.     00280000
005300     05  PV-SHIP-CNT                 PIC 9(05)  COMP VALUE 0.     00290000
005400     05  PV-SHIP-CNT-AD              PIC 9(05)  COMP VALUE 0.     00300000
005500     05  XML-LENGTH                  PIC 9(7)   COMP VALUE 0.     00310000
005700     05  PV-DISP-SQLCODE             PIC -999.                    00320000
005720     05  PV-DISP-NUM                 PIC 9(09)  VALUE 0.          00330000
005730     05  PV-DISP-PRC-GP-ID           PIC 9(09)  VALUE 0.          00340000
005800     05  PV-REC-CNT                  PIC 9(05)  COMP VALUE 0.     00350000
005900     05  PV-REC-OVER                 PIC 9(05)  COMP VALUE 0.     00360000
006000     05  PV-BYTES-REM                PIC 9(05)  COMP VALUE 0.     00370000
006200     05  PV-MIN-RECSIZE              PIC 9(05)  COMP VALUE 80.    00380000
006300     05  PV-REC-LEN                  PIC 9(05)  COMP VALUE 0.     00390000
006400     05  PV-REC-START                PIC 9(05)  COMP VALUE 1.     00400000
006500     05  PV-REC-FOR                  PIC 9(05)  COMP VALUE 1.     00410000
006600     05  PV-XML-CHAR                 PIC 9(05)  COMP VALUE 0.     00420000
006700     05  PV-BEFORE                   PIC X(99999).                00430000
006800     05  PV-AFTER                    PIC X(99999).                00440000
006900     05  PV-BEFORE-CNT               PIC 9(09)       VALUE 0.     00450000
007000     05  PV-AFTER-CNT                PIC 9(09)       VALUE 0.     00460000
007100     05  PV-HDR-LENGTH               PIC 9(05)  COMP VALUE 0.     00470000
007200     05  PV-DTL-LENGTH               PIC 9(05)  COMP VALUE 0.     00480000
007300     05  PV-MAX-BYTES                PIC 9(05)  COMP VALUE 0.     00490000
007400     05  PV-MAX-CASES                PIC 9(05)  COMP VALUE 0.     00500000
007500     05  PV-MAX-ASN                  PIC 9(05)  COMP VALUE 0.     00510000
007600     05  PV-ASN-LENGTH               PIC 9(05)  COMP VALUE 0.     00520000
007700     05  PV-MAX-XML-LENGTH           PIC 9(07)  COMP VALUE 0.     00530000
007800     05  PV-STATUS-CODE              PIC X(02)  VALUE SPACES.     00540000
008010     05  PV-CONVERT-DATE             PIC X(20)  VALUE SPACES.     00550000
008020     05  PV-USERID                   PIC X(08)  VALUE SPACES.     00560000
218265     05  PV-CASE-SSCC                PIC X(20).                   00561242
218265     05  FILLER   REDEFINES   PV-CASE-SSCC.                       00562042
218265         10  PV-ZERO-VALUE           PIC X(02).                   00563042
218265         10  PV-CASE-SML             PIC 9(18).                   00564042
218265     05  PV-CASE-SML-COMP            PIC S9(18)V COMP-3.          00565042
218265                                                                  00566042
218265     05  PV-XML-CASE-EXPAND          PIC X(20).                   00567042
008100                                                                  00570000
010700 01  PC-PROGRAM-CONSTANTS.                                        00580000
010800     05  PC-PROGRAM-NAME             PIC X(08) VALUE 'WSKUP302'.  00590000
218265     05  PC-XML-ZEROES               PIC X(20) VALUE              00591042
218265                                     '00000000000000000000'.      00592042
010810                                                                  00600000
010900* NOTE;                                                           00610000
010901*      IF YOU CHANGE PC-XML-BANNER LENGTH YOU MUST CHANGE         00620000
010902*      THE INDEX VALUE (X1) IN PARA 2400-.  COBOL DOES NOT        00630000
010903*      ALLOW USING "LENGTH OF" FOR AN INDEX OR SUBSCRIPT.         00640000
010904*                                                                 00650000
010910     05  PC-XML-BANNER               PIC X(38) VALUE              00660000
011000         '<?xml version="1.0" encoding="UTF-8"?>'.                00670000
011100                                                                  00680000
011600 01  PS-PROGRAM-SWITCHES.                                         00690000
011700     05  PS-TBL-IN-SW                PIC X(01) VALUE 'N'.         00700000
011800         88  PS-TBL-IN-EOF                     VALUE 'Y'.         00710000
011900         88  PS-TBL-IN-NOT-EOF                 VALUE 'N'.         00720000
011910     05  PS-LOG-SWITCH-IND           PIC X(01) VALUE 'N'.         00730000
011911         88 PS-LOG-SWITCH-YES                  VALUE 'Y'.         00740000
011920         88 PS-LOG-SWITCH-NO                   VALUE 'N'.         00750000
011930     05  PS-WRITE-MQ-SW        PIC X(01) VALUE 'Y'.               00760000
011941         88 PS-WRITE-MQ-YES                    VALUE 'Y'.         00770000
011950         88 PS-WRITE-MQ-NO                     VALUE 'N'.         00780000
011930* JAK 06/2007 - ADD SWITCH                                        00790000
011930     05  PS-UPDATE-HDR-SW      PIC X(01) VALUE 'N'.               00800000
011941         88 PS-UPDATE-HDR-X                    VALUE 'Y'.         00810000
011950         88 PS-UPDATE-HDR-NO                   VALUE 'N'.         00820000
012100                                                                  00830000
012200 01  PV-ABEND-FIELDS.                                             00840000
012300     05  PV-ABEND-CODE                 PIC S9(4) VALUE +0         00850000
012400                                                       COMP SYNC. 00860000
012500     05  PV-ABEND-PROGRAM              PIC X(08) VALUE 'WSKUP302'.00870000
012600     05  PV-ABEND-PARAGRAPH            PIC X(25) VALUE SPACES.    00880000
012700     05  PV-ABEND-OPERATION            PIC X(20) VALUE SPACES.    00890000
012800     05  PV-ABEND-STRUCTURE-1          PIC X(50) VALUE SPACES.    00900000
012900     05  PV-ABEND-STRUCTURE-2          PIC X(50) VALUE SPACES.    00910000
013000     05  PV-ABEND-STATUS               PIC XX    VALUE SPACES.    00920000
013100     05  PV-DB2-OPERATION-MESSAGE-1    PIC X(79) VALUE SPACES.    00930000
013200     05  PV-DB2-OPERATION-MESSAGE-2    PIC X(79) VALUE SPACES.    00940000
013210     05  PV-PARAGRAPH                  PIC X(25) VALUE SPACES.    00950000
013300     05  PV-RETRY-COUNTER              PIC S9(04) VALUE +0        00960000
013301                                                      COMP SYNC.  00970000
013310     05  PV-HOLD-COMPLETION-CODE       PIC S9(9) BINARY.          00980000
013320     05  PV-HOLD-REASON                PIC S9(9) BINARY.          00990000
013361     05  PV-MSG-AREA                   PIC X(100) VALUE SPACE.    01000000
013364                                                                  01010000
013372****************************************************************  01020000
013380*    INPUT RECORD COPYBOOKS                                       01030000
013391****************************************************************  01040000
013392                                                                  01050000
013393****************************************************************  01060000
013394*    RECORD PURPOSE: ASN HEADER - TRAILER INTO WMOS               01070000
013395****************************************************************  01080000
013400     COPY WSRD004.                                                01090000
013410                                                                  01100000
013420************************************************************      01110000
013430*    RECORD PURPOSE: ASN DETAIL - TRAILER INTO WMOS               01120000
013450************************************************************      01130000
013500     COPY WSRD005.                                                01140000
013510                                                                  01150000
013520************************************************************      01160000
013530*    RECORD PURPOSE: CASE HEADER - INTO WMOS                      01170000
013550************************************************************      01180000
013600     COPY WSRD006.                                                01190000
013610                                                                  01200000
013620************************************************************      01210000
013630*    RECORD PURPOSE: CASE DETAIL - INTO WMOS                      01220000
013631************************************************************      01230000
013700     COPY WSRD007.                                                01240000
013710                                                                  01250000
013720************************************************************      01260000
013730*    RECORD PURPOSE: APPOINTMENT - TRAILER INTO WMOS              01270000
013750************************************************************      01280000
013800     COPY WSRD008.                                                01290000
013900                                                                  01300000
013910****************************************************************  01310000
013920*    OUTPUT RECORD COPYBOOKS (XML FORMAT)                         01320000
013930****************************************************************  01330000
013931                                                                  01340000
013932***************************************************************** 01350000
013933*    RECORD: Case Header/detail     (for XML conversion)          01360000
013934***************************************************************** 01370000
013940     COPY WSRD023.                                                01380000
013950                                                                  01390000
013960***************************************************************** 01391000
013980*    RECORD: asn detail             (for XML conversion)          01392000
013990***************************************************************** 01393000
014000     COPY WSRD024.                                                01394000
014010                                                                  01395000
014020***************************************************************** 01396000
014040*    RECORD: ASN Header             (for XML conversion)          01397000
014050***************************************************************** 01398000
014100     COPY WSRD025.                                                01399000
014110                                                                  01400000
014120***************************************************************** 01410000
014140*    RECORD: Appointment            (for XML conversion)          01411000
014150***************************************************************** 01412000
014200     COPY WSRD026.                                                01413000
014300                                                                  01414000
014400****************************************************************  01415000
014410*      M Q   S E R I E S    W O R K I N G   S T O R A G E         01416000
014420*                   M  Q    C O P Y B O O K S                     01417000
014430****************************************************************  01418000
014440 01  MQM-OBJECT-DESCRIPTOR.                                       01419000
014450     COPY CMQODV.                                                 01420000
014460                                                                  01430000
014470 01  MQM-MESSAGE-DESCRIPTOR.                                      01440000
014480     COPY CMQMDV.                                                 01441000
014490                                                                  01442000
014491 01  MQM-GET-MESSAGE-OPTIONS.                                     01443000
014492     COPY CMQGMOV.                                                01444000
014493                                                                  01445000
014494 01  MQM-PUT-MESSAGE-OPTIONS.                                     01446000
014495     COPY CMQPMOV.                                                01447000
014496                                                                  01448000
014497 01  MQM-CONSTANTS.                                               01449000
014498     COPY CMQV.                                                   01449100
014511                                                                  01449200
014512     COPY ISWS002.                                                01449300
014531                                                                  01449400
014532****************************************************************  01449500
014533*  MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND        01449600
014534*  OPEN, CONNECT, DISCONNECT. (BATCH PARMS)                       01449700
014535****************************************************************  01449800
014537 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQBCONN'.      01449900
014538 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQBOPEN'.      01450000
014539 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQBINQ'.       01451000
014540 01  PC-MQGET                    PIC X(8)  VALUE 'CSQBGET'.       01452000
014541 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQBPUT'.       01453000
014542 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQBCLOS'.      01454000
014543 01  PC-MQCOMM                   PIC X(8)  VALUE 'CSQBCOMM'.      01454100
014544 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQBDISC'.      01454200
014545 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQBBACK'.      01454300
014547                                                                  01454400
014548 01  MQ-WORKING-STORAGE.                                          01454500
014556     05  PC-QMGR-NAME                 PIC X(4)  VALUE SPACES.     01454600
014557         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     01454700
014558         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     01454800
014559         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     01454900
014560     05  PC-RESPONSE-QNAME            PIC X(30) VALUE SPACES.     01455000
014561     05  PC-WAIT-15-SECS              PIC S9(9) VALUE 15000.      01455100
014562     05  PC-WAIT-6-SECS               PIC S9(9) VALUE 6000.       01455200
014563     05  PC-DELAY-INTERVAL.                                       01455300
014564         10  FILLER                   PIC X(2)  VALUE SPACES.     01455400
014565         10  PC-DELAY-TIME            PIC 9(8)  VALUE 1500.       01455500
014566****************************************************************  01455600
014568*  QUEUE HANDLES                                                  01455700
014569****************************************************************  01455800
014570 01  PV-MQ-PROGRAM-VARIABLES.                                     01455900
014571     05  PV-QM-NAME              PIC X(48).                       01456000
014572     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01456100
014573     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                01456200
014574     05  PV-HANDLE               PIC S9(9) BINARY VALUE 0.        01456300
014575     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                01456400
014576     05  PV-REASON               PIC S9(9) BINARY.                01456500
014577     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          01456600
014578     05  PV-CON-REASON           PIC S9(9) BINARY.                01456700
014582     05  PV-MSG-LENGTH           PIC S9(9) BINARY.                01456800
014583     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01456900
014584     05  PV-REASON-TEXT          PIC X(30) VALUE SPACES.          01457000
014585     05  PV-ACTION               PIC X(60)        VALUE SPACES.   01458000
014586     05  PV-INTRGTN-TYP-CDE      PIC X(10) VALUE SPACES.          01458100
014587     05  PV-APPL-FUNC-DESCE      PIC X(10) VALUE SPACES.          01458200
014591***************************************************************** 01458300
014592*    PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         01458400
014593***************************************************************** 01458500
014594 01  PV-Q-MANAGER-VARIABLES.                                      01458600
014595     05  PV-QMGR-NAME                 PIC X(48).                  01458700
014596     05  PV-QUE-NAME                  PIC X(48).                  01458800
014597     05  PV-HANDLE-XXX           PIC S9(9) BINARY VALUE 0.        01458900
014598     05  PV-QMGR-NAME-PUTAWY          PIC X(48).                  01459000
014599     05  PV-QUE-NAME-PUTAWY           PIC X(48).                  01459100
014600     05  PV-HANDLE-PUTAWY        PIC S9(9) BINARY VALUE 0.        01459200
014601     05  PV-QMGR-NAME-ERROR           PIC X(48).                  01459300
014602     05  PV-QUE-NAME-ERROR            PIC X(48).                  01459400
014610     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        01459500
014611 01  DK-DATA-KEYS.                                                01459600
014612     05  DK-TRIP-ID                   PIC  S9(09) COMP VALUE +0.  01459700
014613     05  DK-EXT-SHP-ID                PIC  X(20)  VALUE SPACE.    01459800
014614     05  DK-CRE-TMST                  PIC  X(26)  VALUE SPACE.    01459900
014615 01  PV-CASE                          PIC  X(1)   VALUE SPACE.    01460000
014619                                                                  01461000
014710***************************************************************** 01461100
014720*    DB2 FORMATTED MESSAGE AREA                                   01461200
014730***************************************************************** 01461300
014800     COPY DPWS004.                                                01461400
015000     COPY ISWS007.                                                01461500
015100     COPY ISWS008.                                                01461600
015200     COPY ISWS009.                                                01461700
015300     COPY ISWS012.                                                01461800
015400                                                                  01461900
015401******************************************************************01462000
015402*  DB2 TABLE DECLARATION - WST_SHPMT_XREF_DTL                     01463000
015404******************************************************************01464000
015405     EXEC SQL                                                     01465000
015406          INCLUDE WST00002                                        01466000
015407     END-EXEC.                                                    01467000
015408                                                                  01468000
015410***************************************************************** 01469000
015420*    DB2 VIEW DECLARATION - WSV_PRVDR_QUE                         01470000
015440***************************************************************** 01480000
015450     EXEC SQL                                                     01490000
015460          INCLUDE WSV00005                                        01500000
015470     END-EXEC.                                                    01510000
015490                                                                  01520000
015491******************************************************************01530000
015492*  DB2 TABLE DECLARATION - WST_SHPMT_XREF_HDR                     01540000
015494******************************************************************01541000
015500     EXEC SQL                                                     01542000
015600          INCLUDE WST00001                                        01543000
015700     END-EXEC.                                                    01544000
015800                                                                  01545000
015801******************************************************************01546000
015802*  DB2 TABLE DECLARATION - WST_ASN_DWNLD                          01547000
015803******************************************************************01548000
015810     EXEC SQL                                                     01549000
015820          INCLUDE WST00011                                        01550000
015830     END-EXEC.                                                    01560000
015840                                                                  01570000
015850******************************************************************01580000
015860*  DB2 TABLE DECLARATION - WST_DAT_CNTL                           01581000
015870******************************************************************01582000
015900     EXEC SQL                                                     01583000
016000          INCLUDE WST00003                                        01584000
016100     END-EXEC.                                                    01585000
016200                                                                  01586000
016210******************************************************************01587000
016220*  DB2 TABLE DECLARATION - WST_INTGRTN_TYP                        01588000
016230******************************************************************01589000
016300     EXEC SQL                                                     01590000
016400          INCLUDE WST00008                                        01600000
016500     END-EXEC.                                                    01610000
016600                                                                  01620000
016610******************************************************************01630000
016620*  DB2 TABLE DECLARATION - WST_ATTR_DEFN                          01640000
016630******************************************************************01650000
016700     EXEC SQL                                                     01660000
016800          INCLUDE WST00009                                        01661000
016900     END-EXEC.                                                    01662000
017000                                                                  01663000
017010******************************************************************01664000
017020*  DB2 TABLE DECLARATION - WST_ATTR_ELEM                          01665000
017030******************************************************************01666000
017100     EXEC SQL                                                     01667000
017200          INCLUDE WST00010                                        01668000
017300     END-EXEC.                                                    01669000
017400                                                                  01670000
218265******************************************************************01671042
218265*  DB2 TABLE DECLARATION - SUT_OTBND_CART                         01671142
218265******************************************************************01673042
218265     EXEC SQL                                                     01674042
218265         INCLUDE SUT00024                                         01675042
218265     END-EXEC.                                                    01676042
218265                                                                  01677042
017510******************************************************************01680000
017600*    STORAGE AREA TO RETREIVE XML LENGTHS FROM DB2                01690000
017700******************************************************************01700000
017800 01  WMLENGTH.                                                    01710000
017900     05 WMLENGTH-MAX-XML-LENGTH       PIC   X(10).                01720000
018000     05 WMLENGTH-CASE-HDR-LENGTH      PIC   X(10).                01730000
018100     05 WMLENGTH-CASE-DTL-LENGTH      PIC   X(10).                01740000
018200     05 WMLENGTH-ASN-DTL-LENGTH       PIC   X(10).                01750000
018300     05 WMLENGTH-ASN-HEADER-LENGTH    PIC   X(10).                01760000
018400     05 WMLENGTH-APPT-LENGTH          PIC   X(10).                01770000
018500                                                                  01780000
018600***************************************************************** 01790000
018700*    DB2 AREA FOR COMMUNICATIONS                                  01800000
018800***************************************************************** 01810000
018900     EXEC SQL                                                     01820000
019000          INCLUDE SQLCA                                           01830000
019100     END-EXEC.                                                    01840000
019200                                                                  01850000
019300***************************************************************** 01860000
019400*    DECLARE CURSOR FOR TEMP WSTT_ASN_DWNLD TABLE               * 01870000
019500***************************************************************** 01880000
019600     EXEC SQL                                                     01890000
019700        DECLARE ASN-CSR CURSOR FOR                                01900000
019800         SELECT EXT_SHP_ID                                        01910000
019900               ,CRE_TMST                                          01920000
020000               ,ROW_NBR                                           01930000
020100               ,REC_TYP_GP_NBR                                    01940000
020200               ,CASE                                              01950000
020300                   WHEN REC_TYP_CDE = 'CH' THEN '1'               01960000
020400                   WHEN REC_TYP_CDE = 'CD' THEN '2'               01970000
020500                   WHEN REC_TYP_CDE = 'AD' THEN '3'               01980000
020600                   WHEN REC_TYP_CDE = 'AH' THEN '4'               01990000
020700                   WHEN REC_TYP_CDE = 'AP' THEN '5'               02000000
020800                   ELSE '9'                                       02010000
020900                END                                               02020000
021000               ,REC_TYP_CDE                                       02030000
021100               ,CSE_DTL_NBR                                       02040000
021200               ,REC_TYP_DESC                                      02050000
021300          FROM  WST_ASN_DWNLD                                     02060000
021400         WHERE  EXT_SHP_ID      = :DK-EXT-SHP-ID                  02070000
021500           AND  CRE_TMST        = :DK-CRE-TMST                    02080000
021600         ORDER  BY EXT_SHP_ID                                     02090000
021700                  ,CRE_TMST                                       02100000
021800                  ,CSE_DTL_NBR     ASC                            02110000
021900                  ,REC_TYP_GP_NBR  DESC                           02120000
022000                  ,5               ASC                            02130000
022100                  ,REC_TYP_DESC    DESC                           02140000
022200                  ,ROW_NBR         DESC                           02150000
022300     END-EXEC.                                                    02160000
022301                                                                  02170000
022304****************************************************************  02180000
022305*    LINKAGE SECTION                                              02190000
022306****************************************************************  02200000
022307 LINKAGE SECTION.                                                 02210000
022308                                                                  02220000
013365****************************************************************  02230000
013367*    COMMAREA - CALL THE ASN TRANSMISSION MODULE                  02230100
013369****************************************************************  02230200
013370     COPY WSWS006.                                                02230300
022313                                                                  02230400
022314****************************************************************  02230500
022315*    PROCEDURE DIVISION                                           02230600
022316****************************************************************  02230700
022317 PROCEDURE DIVISION USING WS006-TRANS-COMMAREA.                   02230800
022318                                                                  02230900
022400 0000-PROGRAM-MAINLINE.                                           02231000
022500                                                                  02231100
023100     PERFORM 0100-INITIALIZE.                                     02231200
023313     PERFORM 1100-PROCESS-TABLE                                   02231300
023320                  UNTIL PS-TBL-IN-EOF.                            02231400
023400                                                                  02231500
023500     IF CH-SUB > 0                                                02231600
023700        PERFORM 3010-GENERATE-XML-CH                              02231700
023800     END-IF.                                                      02231800
023900                                                                  02231900
024000     IF AD-SUB > 0                                                02232000
024200        PERFORM 3070-GENERATE-XML-AD                              02233000
024300     END-IF.                                                      02234000
024400                                                                  02235000
024600     PERFORM 8990-EOJ-ROUTINE.                                    02236000
024710     PERFORM 8995-RETURN.                                         02237000
024800                                                                  02238000
024900****************************************************************  02239000
025000*   INITIALIZATIONS                                            *  02240000
025100****************************************************************  02250000
025200 0100-INITIALIZE.                                                 02260000
025400                                                                  02270000
025402     MOVE  0                 TO  PV-DISP-SQLCODE.                 02280000
025403                                                                  02290000
025404     INITIALIZE PV-MSG-AREA.                                      02300000
025405     STRING   ' ' WS006-SRC-TASK-NUMBER                           02310000
025406              ' WSKUP302-STRT:'                                   02320000
025407              ' ' WS006-OPER-UNT-ID                               02330000
025408              ' ' WS006-EXT-SHP-ID (1:15)                         02340000
025409              ' ' WS006-USERID                                    02350000
025410              ' SQLCODE=' PV-DISP-SQLCODE                         02360000
025411              ' WSKUP302 STARTED        '                         02370000
025412                DELIMITED BY SIZE                                 02380000
025413                  INTO PV-MSG-AREA.                               02390000
025414     PERFORM 9900-WRITE-TO-LOG.                                   02400000
025415                                                                  02410000
025420     PERFORM 0500-CHECK-LOGGING.                                  02420000
025430                                                                  02430000
025500     IF PS-LOG-SWITCH-YES                                         02440000
025510        INITIALIZE PV-MSG-AREA                                    02450000
025520        STRING   ' ' WS006-SRC-TASK-NUMBER                        02460000
025530                 ' WSKUP302-0100:'                                02470000
025531                 ' ' WS006-OPER-UNT-ID                            02480000
025532                 ' ' WS006-EXT-SHP-ID (1:15)                      02490000
025550                 ' ' WS006-USERID                                 02500000
025560                 ' SQLCODE=' PV-DISP-SQLCODE                      02510000
025570                 ' 0100-INITIALIZE         '                      02520000
025580                   DELIMITED BY SIZE                              02530000
025590                      INTO PV-MSG-AREA                            02540000
025591        PERFORM 9900-WRITE-TO-LOG                                 02550000
025592     END-IF.                                                      02551000
025593                                                                  02552000
025594     PERFORM 0600-CHK-MQPROCESS-ALL.                              02553000
025595                                                                  02554000
025600     INITIALIZE ASN-DTL-COUNT                                     02555000
025700                AD-SUB                                            02556000
025800                CH-SUB                                            02557000
025900                CD-SUB                                            02558000
026000                CH-count                                          02559000
026100                CD-count.                                         02559100
026110                                                                  02559200
026116     IF WS006-EXT-SHP-ID  = SPACES                                02559300
026117        MOVE '1000-INITIALIZE   ' TO WS006-SQL-ERROR-PARA         02559400
026118        MOVE +0000                TO SQLCODE                      02559500
026119        MOVE '1'                  TO WS006-SUCCESS-IND            02559600
026120        MOVE 'SHIPPING ID IS MISSING ' TO WS006-CRA-RET-MSG       02559700
026123           INITIALIZE PV-MSG-AREA                                 02559800
026125           STRING   ' ' WS006-SRC-TASK-NUMBER                     02559900
026126                    ' WSKUP302-0100:'                             02560000
026127                    ' ' WS006-OPER-UNT-ID                         02570000
026128                    ' ' WS006-EXT-SHP-ID (1:15)                   02580000
026130                    ' ' WS006-USERID                              02590000
026131                    ' SQLCODE=' PV-DISP-SQLCODE                   02600000
026132                      DELIMITED BY SIZE                           02610000
026133                        INTO PV-MSG-AREA                          02611000
026134                 PERFORM 9900-WRITE-TO-LOG                        02612000
026136       PERFORM 8995-RETURN                                        02612100
026138     END-IF.                                                      02612200
026139                                                                  02612300
026140     IF WS006-DWNLD-TMST  = SPACES                                02612400
026141        MOVE '1000-INITIALIZE   ' TO WS006-SQL-ERROR-PARA         02612500
026142        MOVE +0000                TO SQLCODE                      02612600
026143        MOVE '1'                  TO WS006-SUCCESS-IND            02612700
026144        MOVE 'TIMESTAMP IS MISSING   ' TO WS006-CRA-RET-MSG       02612800
026146           INITIALIZE PV-MSG-AREA                                 02612900
026148           STRING   ' ' WS006-SRC-TASK-NUMBER                     02613000
026149                    ' WSKUP302-0100:'                             02614000
026150                    ' ' WS006-OPER-UNT-ID                         02614100
026151                    ' ' WS006-EXT-SHP-ID (1:15)                   02614200
026153                    ' ' WS006-USERID                              02614300
026154                    ' SQLCODE=' PV-DISP-SQLCODE                   02614400
026155                      DELIMITED BY SIZE                           02614500
026156                        INTO PV-MSG-AREA                          02614600
026157                 PERFORM 9900-WRITE-TO-LOG                        02614700
026159       PERFORM 8995-RETURN                                        02614800
026160     END-IF.                                                      02614900
026161                                                                  02615000
026162     PERFORM 1150-GET-INPUT-QUEUE-INFO.                           02615100
026163     PERFORM 1200-MQSERIES-CONNECT.                               02615200
026164     PERFORM 1300-MQSERIES-OPEN.                                  02615300
026165                                                                  02615400
026170     MOVE WS006-EXT-SHP-ID       TO DK-EXT-SHP-ID.                02615500
026180     MOVE WS006-DWNLD-TMST       TO DK-CRE-TMST.                  02615600
026190                                                                  02615700
026350     PERFORM 8100-OPEN-FETCH-CURSOR.                              02615800
026400     MOVE WST00011-CSE-DTL-NBR TO CD-COUNT                        02615900
026500                                  PV-LAST-CSE-DTL-NBR.            02616000
026600     PERFORM 7700-RETEIVE-XML-LENGTHS.                            02617000
026700     PERFORM 2200-CALCULATE-MAX-CASE.                             02618000
026710                                                                  02619000
026720****************************************************************  02620000
026730*   LOGGING                                               *       02630000
026740****************************************************************  02640000
026750                                                                  02650000
026800 0500-CHECK-LOGGING.                                              02660000
026820     EXEC SQL                                                     02670000
026821         SELECT D.ATTR_ELEM_TXT                                   02671000
026822         INTO  :PS-LOG-SWITCH-IND                                 02672000
026823         FROM   WST_INTGRTN_TYP A                                 02673000
026824              , WST_ATTR_DEFN   B                                 02674000
026825              , WST_ATTR_ELEM   C                                 02675000
026826              , WST_ATTR_ELEM   D                                 02676000
026827         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   02677000
026828           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           02678000
026829           AND  B.ATTR_DEFN_SEQ_NBR = 1                           02679000
026830           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           02680000
026831           AND  C.ATTR_DEFN_SEQ_NBR = 1                           02681000
026832           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           02682000
026833           AND  D.ATTR_DEFN_SEQ_NBR = 2                           02682100
026834           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         02682200
026835           AND  C.ATTR_ELEM_TXT     = 'WSKUP302'                  02682300
026836     END-EXEC.                                                    02682400
026837                                                                  02682500
026851     EVALUATE TRUE                                                02682600
026852         WHEN SQLCODE = ZERO                                      02682700
026853         WHEN SQLCODE = -904                                      02682800
026854         WHEN SQLCODE = -913                                      02682900
026855         WHEN SQLCODE = -911                                      02683000
026856         WHEN SQLCODE = -803                                      02684000
026857             IF PS-LOG-SWITCH-YES                                 02685000
026858                 MOVE SQLCODE    TO PV-DISP-SQLCODE               02685100
026859                 INITIALIZE PV-MSG-AREA                           02685200
026860                 STRING   ' ' WS006-SRC-TASK-NUMBER               02685300
026861                          ' WSKUP302-0500:'                       02685400
026862                          ' ' WS006-OPER-UNT-ID                   02685500
026863                          ' ' WS006-EXT-SHP-ID (1:15)             02685600
026864                          ' ' WS006-USERID                        02685700
026865                          ' SQLCODE=' PV-DISP-SQLCODE             02685800
026866                          ' LOGGING TURNED ON  '                  02685900
026867                          DELIMITED BY SIZE                       02686000
026868                          INTO PV-MSG-AREA                        02686100
026869                 PERFORM 9900-WRITE-TO-LOG                        02686200
026870             END-IF                                               02686300
026871         WHEN SQLWARN0 NOT = SPACES                               02686400
026872         WHEN SQLCODE NOT = ZERO                                  02686500
026873             MOVE '2'                 TO WS006-SUCCESS-IND        02686600
026874             MOVE SQLCODE             TO PV-DISP-SQLCODE          02686700
026875                                         WS006-SQLCODE            02686800
026876             MOVE '0500-CHECK-LOGGING'                            02686900
026877                                      TO WS006-SQL-ERROR-PARA     02687000
026878                 INITIALIZE PV-MSG-AREA                           02687100
026879                 MOVE SQLCODE         TO PV-DISP-SQLCODE          02687200
026880                 STRING   ' ' WS006-SRC-TASK-NUMBER               02687300
026881                          ' WSKUP302-0500:'                       02687400
026882                          ' ' WS006-OPER-UNT-ID                   02687500
026883                          ' ' WS006-EXT-SHP-ID (1:15)             02687600
026884                          ' ' WS006-USERID                        02687700
026885                          ' SQLCODE=' PV-DISP-SQLCODE             02687800
026886                          DELIMITED BY SIZE                       02687900
026887                          INTO PV-MSG-AREA                        02688000
026888             PERFORM 9900-WRITE-TO-LOG                            02688100
026889           PERFORM 8995-RETURN                                    02688200
026890     END-EVALUATE.                                                02688300
026891                                                                  02688400
026892     IF PS-LOG-SWITCH-YES                                         02688500
026893        INITIALIZE PV-MSG-AREA                                    02688600
026894        STRING   ' ' WS006-SRC-TASK-NUMBER                        02688700
026895                 ' WSKUP302-0500:'                                02688800
026896                 ' ' WS006-OPER-UNT-ID                            02688900
026897                 ' ' WS006-EXT-SHP-ID (1:15)                      02689000
026898                 ' ' WS006-USERID                                 02689100
026899                 ' SQLCODE=' PV-DISP-SQLCODE                      02689200
026900                 ' 0500-CHECK-LOGGING       '                     02689300
026901                   DELIMITED BY SIZE                              02689400
026902                      INTO PV-MSG-AREA                            02689500
026903        PERFORM 9900-WRITE-TO-LOG                                 02689600
026904     END-IF.                                                      02689700
026905                                                                  02689800
026906****************************************************************  02689900
026907*   CHECK MQ PROCESSING FOR ALL USERS                             02690000
026908****************************************************************  02690100
026909 0600-CHK-MQPROCESS-ALL.                                          02690200
026912                                                                  02690300
026913     IF PS-LOG-SWITCH-YES                                         02690400
026914        INITIALIZE PV-MSG-AREA                                    02690500
026915        STRING   ' ' WS006-SRC-TASK-NUMBER                        02690600
026916                 ' WSKUP302-0600:'                                02690700
026917                 ' ' WS006-OPER-UNT-ID                            02690800
026918                 ' ' WS006-EXT-SHP-ID (1:15)                      02690900
026919                 ' ' WS006-USERID                                 02691000
026920                 ' SQLCODE=' PV-DISP-SQLCODE                      02691100
026921                 ' 0600-CHK-MQPROCESS-ALL  '                      02691200
026922                   DELIMITED BY SIZE                              02691300
026923                      INTO PV-MSG-AREA                            02691400
026924        PERFORM 9900-WRITE-TO-LOG                                 02691500
026925     END-IF.                                                      02691600
026926                                                                  02691700
026927     EXEC SQL                                                     02691800
026928         SELECT  C.ATTR_ELEM_TXT                                  02691900
026929           INTO :PV-USERID                                        02692000
026930           FROM  WST_INTGRTN_TYP  A                               02692100
026931                ,WST_ATTR_DEFN    B                               02692200
026932                ,WST_ATTR_ELEM    C                               02692300
026933           WHERE A.INTGRTN_TYP_CDE    =  'ASNTOQUE'               02692400
026934             AND C.ATTR_ELEM_TXT      =  'ALL'                    02692500
026935             AND A.INTGRTN_TYP_CDE    =   B.INTGRTN_TYP_CDE       02692600
026936             AND B.ATTR_DEFN_SEQ_NBR  =   1                       02692700
026937             AND B.INTGRTN_TYP_CDE    =   C.INTGRTN_TYP_CDE       02692800
026938             AND C.ATTR_DEFN_SEQ_NBR  =   1                       02692900
026939     END-EXEC.                                                    02693000
026940                                                                  02693100
026941     EVALUATE TRUE                                                02693200
026942       WHEN SQLCODE = ZERO                                        02693300
026943            SET PS-WRITE-MQ-NO TO TRUE                            02693400
026944               INITIALIZE PV-MSG-AREA                             02693500
026945               MOVE SQLCODE      TO PV-DISP-SQLCODE               02693600
026946               STRING   ' ' WS006-SRC-TASK-NUMBER                 02693700
026947                        ' WSKUP302-0600:'                         02693800
026948                        ' ' WS006-OPER-UNT-ID                     02693900
026949                        ' ' WS006-EXT-SHP-ID (1:15)               02694000
026950                        ' ' WS006-USERID                          02694100
026951                        ' SQLCODE=' PV-DISP-SQLCODE               02694200
026952                          ' MQPUTS ARE OFF FOR ALL '              02694300
026953                        DELIMITED BY SIZE                         02694400
026954                        INTO PV-MSG-AREA                          02694500
026955              PERFORM 9900-WRITE-TO-LOG                           02694600
026956       WHEN SQLCODE = +100                                        02694700
026957            PERFORM 0700-CHK-MQPROCESS-USER                       02694800
026958       WHEN SQLCODE NOT EQUAL ZERO                                02694900
026959            MOVE '0600-CHK-MQPROCESS-ALL' TO                      02695000
026960                                          WS006-SQL-ERROR-PARA    02695100
026961            MOVE '2'                   TO WS006-SUCCESS-IND       02695200
026962            MOVE SQLCODE               TO WS006-SQLCODE           02695300
026963               INITIALIZE PV-MSG-AREA                             02695400
026964               MOVE SQLCODE      TO PV-DISP-SQLCODE               02695500
026965               STRING   ' ' WS006-SRC-TASK-NUMBER                 02695600
026966                        ' WSKUP302-0600:'                         02695700
026967                        ' ' WS006-OPER-UNT-ID                     02695800
026968                        ' ' WS006-EXT-SHP-ID (1:15)               02695900
026969                        ' ' WS006-USERID                          02696000
026970                        ' SQLCODE=' PV-DISP-SQLCODE               02696100
026971                        DELIMITED BY SIZE                         02696200
026972                        INTO PV-MSG-AREA                          02696300
026973              PERFORM 9900-WRITE-TO-LOG                           02696400
026974            PERFORM 8995-RETURN                                   02696500
026975     END-EVALUATE.                                                02696600
026976                                                                  02696700
026977****************************************************************  02696800
026978*   CHECK MQ PROCESSING BY USER                                   02696900
026979****************************************************************  02697000
026980 0700-CHK-MQPROCESS-USER.                                         02697100
026981                                                                  02697200
026982     IF PS-LOG-SWITCH-YES                                         02697300
026983        INITIALIZE PV-MSG-AREA                                    02697400
026984        STRING   ' ' WS006-SRC-TASK-NUMBER                        02697500
026985                 ' WSKUP302-0700:'                                02697600
026986                 ' ' WS006-OPER-UNT-ID                            02697700
026987                 ' ' WS006-EXT-SHP-ID (1:15)                      02697800
026988                 ' ' WS006-USERID                                 02697900
026989                 ' SQLCODE=' PV-DISP-SQLCODE                      02698000
026990                 ' 0700-CHK-MQPROCESS-USER '                      02698100
026991                   DELIMITED BY SIZE                              02698200
026992                      INTO PV-MSG-AREA                            02698300
026993        PERFORM 9900-WRITE-TO-LOG                                 02698400
026994     END-IF.                                                      02698500
026995                                                                  02698600
026996     EXEC SQL                                                     02698700
026997         SELECT  C.ATTR_ELEM_TXT                                  02698800
026998           INTO :PV-USERID                                        02698900
026999           FROM  WST_INTGRTN_TYP  A                               02699000
027000                ,WST_ATTR_DEFN    B                               02699100
027001                ,WST_ATTR_ELEM    C                               02699200
027002           WHERE A.INTGRTN_TYP_CDE    =  'ASNTOQUE'               02699300
027003             AND C.ATTR_ELEM_TXT      =  :WS006-USERID            02699400
027004             AND A.INTGRTN_TYP_CDE    =   B.INTGRTN_TYP_CDE       02699500
027005             AND B.ATTR_DEFN_SEQ_NBR  =   1                       02699600
027006             AND B.INTGRTN_TYP_CDE    =   C.INTGRTN_TYP_CDE       02699700
027007             AND C.ATTR_DEFN_SEQ_NBR  =   1                       02699800
027008     END-EXEC.                                                    02699900
027015                                                                  02700000
027016     EVALUATE TRUE                                                02700100
027017       WHEN SQLCODE = ZERO                                        02700200
027018            SET PS-WRITE-MQ-NO TO TRUE                            02700300
027019               INITIALIZE PV-MSG-AREA                             02700400
027020               MOVE SQLCODE      TO PV-DISP-SQLCODE               02700500
027021               STRING   ' ' WS006-SRC-TASK-NUMBER                 02700600
027022                        ' WSKUP302-0700:'                         02700700
027023                        ' ' WS006-OPER-UNT-ID                     02700800
027024                        ' ' WS006-EXT-SHP-ID (1:15)               02700900
027025                        ' ' WS006-USERID                          02701000
027026                        ' SQLCODE=' PV-DISP-SQLCODE               02702000
027027                          ' MQPUTS ARE OFF FOR '                  02702100
027028                            PV-USERID                             02702200
027029                        DELIMITED BY SIZE                         02702300
027030                        INTO PV-MSG-AREA                          02702400
027031              PERFORM 9900-WRITE-TO-LOG                           02702500
027032       WHEN SQLCODE = +100                                        02702600
027033            CONTINUE                                              02702700
027034       WHEN SQLCODE NOT EQUAL ZERO                                02702800
027035            MOVE '0700-CHK-MQPROCESS-USER' TO                     02702900
027036                                          WS006-SQL-ERROR-PARA    02703000
027037            MOVE '2'                   TO WS006-SUCCESS-IND       02703100
027038            MOVE SQLCODE               TO WS006-SQLCODE           02703200
027039               INITIALIZE PV-MSG-AREA                             02703300
027040               MOVE SQLCODE            TO PV-DISP-SQLCODE         02703400
027041               STRING   ' ' WS006-SRC-TASK-NUMBER                 02703500
027042                        ' WSKUP302-0700:'                         02703600
027043                        ' ' WS006-OPER-UNT-ID                     02703700
027044                        ' ' WS006-EXT-SHP-ID (1:15)               02703800
027045                        ' ' WS006-USERID                          02703900
027046                        ' SQLCODE=' PV-DISP-SQLCODE               02704000
027047                        DELIMITED BY SIZE                         02704100
027048                        INTO PV-MSG-AREA                          02704200
027049              PERFORM 9900-WRITE-TO-LOG                           02704300
027050            PERFORM 8995-RETURN                                   02704400
027051     END-EVALUATE.                                                02704500
027052                                                                  02704600
027053****************************************************************  02704700
027054*   PROCESS THE TABLE                                             02704800
027055****************************************************************  02704900
027060 1100-PROCESS-TABLE.                                              02705000
027100                                                                  02705100
027120     IF PS-LOG-SWITCH-YES                                         02705212
027130        INITIALIZE PV-MSG-AREA                                    02705300
027140        STRING   ' ' WS006-SRC-TASK-NUMBER                        02705400
027150                 ' WSKUP302-1100:'                                02705500
027151                 ' ' WS006-OPER-UNT-ID                            02705600
027152                 ' ' WS006-EXT-SHP-ID (1:15)                      02705700
027170                 ' ' WS006-USERID                                 02705800
027180                 ' SQLCODE=' PV-DISP-SQLCODE                      02705900
027190                 ' 1100-PROCESS-TABLE      '                      02706000
027191                   DELIMITED BY SIZE                              02707000
027192                      INTO PV-MSG-AREA                            02708000
027193        PERFORM 9900-WRITE-TO-LOG                                 02709000
027194     END-IF.                                                      02710012
027195                                                                  02711000
027200     EVALUATE WST00011-REC-TYP-CDE                                02712000
027300         WHEN 'CH'                                                02713000
027400              PERFORM 3000-RECORD-TYPE-CH                         02714000
027500         WHEN 'CD'                                                02715000
027600              PERFORM 3020-RECORD-TYPE-CD                         02716000
027700         WHEN 'AH'                                                02717000
027800              PERFORM 3040-RECORD-TYPE-AH                         02718000
027900         WHEN 'AD'                                                02719000
028000              PERFORM 3060-RECORD-TYPE-AD                         02720000
028100         WHEN 'AP'                                                02730000
028200              PERFORM 3080-RECORD-TYPE-AP                         02740000
028300         WHEN OTHER                                               02750000
028900              MOVE '1100-PROCESS-TABLE' TO WS006-SQL-ERROR-PARA   02760000
029220              MOVE +9999                TO SQLCODE                02770000
029230              MOVE '1'                  TO WS006-SUCCESS-IND      02780000
029232                 INITIALIZE PV-MSG-AREA                           02790000
029234                 MOVE SQLCODE   TO PV-DISP-SQLCODE                02800000
029235                 STRING   ' ' WS006-SRC-TASK-NUMBER               02810000
029236                          ' WSKUP302-1100:'                       02820000
029237                          ' ' WS006-OPER-UNT-ID                   02830000
029238                          ' ' WS006-EXT-SHP-ID (1:15)             02840000
029240                          ' ' WS006-USERID                        02850000
029241                          ' SQLCODE=' PV-DISP-SQLCODE             02860000
029242                          DELIMITED BY SIZE                       02870000
029243                          INTO PV-MSG-AREA                        02880000
029244              PERFORM 9900-WRITE-TO-LOG                           02890000
029250            PERFORM 8995-RETURN                                   02900000
029300     END-EVALUATE.                                                02910000
029400                                                                  02920000
029500     PERFORM 8200-FETCH-CURSOR.                                   02921000
029600                                                                  02922000
029810***************************************************************** 02923000
029820 1150-GET-INPUT-QUEUE-INFO.                                       02924000
029830***************************************************************** 02925000
029840                                                                  02926000
029850*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       02927000
029861                                                                  02928000
029862     IF PS-LOG-SWITCH-YES                                         02929000
029863        INITIALIZE PV-MSG-AREA                                    02930000
029865        STRING   ' ' WS006-SRC-TASK-NUMBER                        02940000
029866                 ' WSKUP302-1150:'                                02950000
029867                 ' ' WS006-OPER-UNT-ID                            02960000
029868                 ' ' WS006-EXT-SHP-ID (1:15)                      02970000
029870                 ' ' WS006-USERID                                 02980000
029871                 ' SQLCODE=' PV-DISP-SQLCODE                      02981000
029872                 ' 1150-GET-INPUT-QUEUE-INFO   '                  02982000
029873                   DELIMITED BY SIZE                              02983000
029874                      INTO PV-MSG-AREA                            02984000
029875        PERFORM 9900-WRITE-TO-LOG                                 02985000
029876     END-IF.                                                      02986000
029877                                                                  02987000
029878       INITIALIZE DCLWSV00005.                                    02987100
029879       MOVE 'LEGCYINBDQ'  TO WSV00005-APPL-FUNC-DESC.             02987200
029880       MOVE 'ASNQ'        TO WSV00005-INTGRTN-TYP-CDE.            02987300
089100*clp 06/22/2017 - Added Move for DC and check for it in WHERE     02987407
089200       MOVE WS006-OPER-UNT-ID TO WSV00005-DC-NBR.                 02987507
029881                                                                  02987600
029890       EXEC SQL                                                   02987700
029891           SELECT                                                 02987800
029892                 LCL_QUE_MGR                                      02987900
029893                ,RMT_QUE_MGR                                      02988000
029894                ,QUE_NM                                           02988100
029895           INTO                                                   02988200
029896                :WSV00005-LCL-QUE-MGR                             02989000
029897               ,:WSV00005-RMT-QUE-MGR                             02989100
029898               ,:WSV00005-QUE-NM                                  02989200
029899           FROM  WSV_PRVDR_QUE                                    02989300
029900          WHERE  APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC       02989400
029901            AND  INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE      02989500
090700            AND           DC_NBR = :WSV00005-DC-NBR               02989607
029902       END-EXEC                                                   02989700
029903                                                                  02989800
029910       EVALUATE TRUE                                              02989900
029911           WHEN SQLCODE = +0                                      02990000
029917               INITIALIZE PV-QMGR-NAME                            02990100
029918               MOVE WSV00005-LCL-QUE-MGR-TEXT  TO PV-QMGR-NAME    02990200
029920               INITIALIZE PV-QUE-NAME                             02990300
029921               MOVE WSV00005-QUE-NM-TEXT       TO PV-QUE-NAME     02990400
029922           WHEN SQLCODE = +100                                    02990500
029923           WHEN SQLWARN0 NOT = SPACES                             02990600
029924           WHEN SQLCODE  NOT = ZERO                               02990700
029925             MOVE '1150-GET-INPUT-QUEUE-INFO '                    02990800
029926                                       TO WS006-SQL-ERROR-PARA    02990900
029927             MOVE '2'                  TO WS006-SUCCESS-IND       02991000
029929                INITIALIZE PV-MSG-AREA                            02991100
029931                MOVE SQLCODE   TO PV-DISP-SQLCODE                 02992000
029932                STRING   ' ' WS006-SRC-TASK-NUMBER                02992100
029933                         ' WSKUP302-1150:'                        02992200
029935                         ' ' WS006-OPER-UNT-ID                    02992300
029936                         ' ' WS006-EXT-SHP-ID (1:15)              02992400
029937                         ' ' WS006-USERID                         02992500
029938                         ' SQLCODE=' PV-DISP-SQLCODE              02992600
029939                         DELIMITED BY SIZE                        02992700
029940                         INTO PV-MSG-AREA                         02992800
029941             PERFORM 9900-WRITE-TO-LOG                            02992900
029943           PERFORM 8995-RETURN                                    02993000
029944       END-EVALUATE.                                              02993100
029945                                                                  02993200
029946******************************************************************02993300
029947* CONNECT TO XXX QUEUE MANAGER.                                   02993400
029948******************************************************************02993500
029949 1200-MQSERIES-CONNECT.                                           02993600
029950                                                                  02993700
029951     MOVE '1200-MQSERIES-CONNECT '   TO PV-PARAGRAPH.             02993800
029952                                                                  02993900
029953     IF PS-LOG-SWITCH-YES                                         02994000
029954        INITIALIZE PV-MSG-AREA                                    02994100
029956        STRING   ' ' WS006-SRC-TASK-NUMBER                        02994200
029957                 ' WSKUP302-1200:'                                02994300
029959                 ' ' WS006-OPER-UNT-ID                            02994400
029960                 ' ' WS006-EXT-SHP-ID (1:15)                      02994500
029961                 ' ' WS006-USERID                                 02994600
029962                 ' SQLCODE=' PV-DISP-SQLCODE                      02994700
029963                 ' 1200-MQSERIES-CONNECT   '                      02994800
029964                   DELIMITED BY SIZE                              02994900
029965                      INTO PV-MSG-AREA                            02995000
029966        PERFORM 9900-WRITE-TO-LOG                                 02996000
029967     END-IF.                                                      02996100
029968                                                                  02996200
029969     CALL PC-MQCONN USING PV-QMGR-NAME                            02996400
029970                          PV-HCONN                                02996500
029971                          PV-COMPLETION-CODE                      02996600
029972                          PV-REASON.                              02996700
029973                                                                  02996800
029974                                                                  02997000
029975*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              02997100
029976*    AND EXIT                                                     02997200
029978                                                                  02997300
029979     MOVE PV-REASON TO PV-CON-REASON.                             02997400
029980     IF PV-COMPLETION-CODE = MQCC-OK THEN                         02997500
029981         CONTINUE                                                 02997600
029982     ELSE                                                         02997700
029983             MOVE '1200-MQSERIES-CONNECT     '                    02997800
029984                                       TO WS006-SQL-ERROR-PARA    02997900
029985             MOVE '1'                  TO WS006-SUCCESS-IND       02998000
029987                INITIALIZE PV-MSG-AREA                            02998100
029989                STRING   ' ' WS006-SRC-TASK-NUMBER                02998200
029990                         ' WSKUP302-1200:'                        02998300
029992                         ' ' WS006-OPER-UNT-ID                    02998400
029993                         ' ' WS006-EXT-SHP-ID (1:15)              02998500
029994                         ' ' WS006-USERID                         02998600
029995                         ' SQLCODE=' PV-DISP-SQLCODE              02998700
029996                         DELIMITED BY SIZE                        02998800
029997                         INTO PV-MSG-AREA                         02998900
029998             PERFORM 9900-WRITE-TO-LOG                            02999000
029999             PERFORM 8995-RETURN                                  03000307
030000     END-IF.                                                      03000407
030001***************************************************************** 03000507
030002*** OPEN THE ITEM QUEUE FOR GETS (300 PIX TRANSACTIONS).          03000607
030003***************************************************************** 03000707
030004 1300-MQSERIES-OPEN.                                              03000807
030005                                                                  03000907
030006     MOVE '1300-MQSERIES-OPEN   '    TO PV-PARAGRAPH.             03001007
030007                                                                  03001107
030008     IF PS-LOG-SWITCH-YES                                         03001207
030009        INITIALIZE PV-MSG-AREA                                    03001307
030011        STRING   ' ' WS006-SRC-TASK-NUMBER                        03001407
030012                 ' WSKUP302-1300:'                                03001507
030014                 ' ' WS006-OPER-UNT-ID                            03001607
030015                 ' ' WS006-EXT-SHP-ID (1:15)                      03001707
030016                 ' ' WS006-USERID                                 03001807
030017                 ' SQLCODE=' PV-DISP-SQLCODE                      03001907
030018                 ' 1300-MQSERIES-OPEN      '                      03002007
030019                   DELIMITED BY SIZE                              03002107
030020                      INTO PV-MSG-AREA                            03002207
030021        PERFORM 9900-WRITE-TO-LOG                                 03002307
030022     END-IF.                                                      03002407
030023                                                                  03002507
030024                                                                  03002607
030025     INITIALIZE PV-QMGR-NAME.                                     03002707
030026     MOVE WSV00005-RMT-QUE-MGR-TEXT  TO PV-QMGR-NAME              03002807
030027                                                                  03002907
030028     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 03003007
030029                                    + MQOO-SET-IDENTITY-CONTEXT   03003107
030030                                    + MQOO-FAIL-IF-QUIESCING.     03003207
030031                                                                  03003307
030032                                                                  03003407
030033                                                                  03003507
030034     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            03003607
030035     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        03003707
030036     MOVE PV-QUE-NAME              TO MQOD-OBJECTNAME.            03003807
030041                                                                  03003907
030042     CALL PC-MQOPEN USING PV-HCONN                                03004107
030043                          MQM-OBJECT-DESCRIPTOR                   03004207
030044                          PV-OPEN-OPTIONS                         03004307
030045                          PV-HANDLE                               03004407
030046                          PV-COMPLETION-CODE                      03004507
030047                          PV-REASON.                              03004607
030048                                                                  03004707
030049                                                                  03004907
030050*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          03005007
030051                                                                  03005107
030052     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03005207
030053         CONTINUE                                                 03005307
030054     ELSE                                                         03005407
030055         MOVE '1300-MQSERIES-OPEN        '                        03005507
030056                                   TO WS006-SQL-ERROR-PARA        03005607
030057         MOVE '1'                  TO WS006-SUCCESS-IND           03005707
030059              INITIALIZE PV-MSG-AREA                              03005807
030061              STRING   ' ' WS006-SRC-TASK-NUMBER                  03005907
030062                       ' WSKUP302-1300:'                          03006007
030064                       ' ' WS006-OPER-UNT-ID                      03006107
030065                       ' ' WS006-EXT-SHP-ID (1:15)                03006207
030066                       ' ' WS006-USERID                           03006307
030067                       ' SQLCODE=' PV-DISP-SQLCODE                03006407
030068                       DELIMITED BY SIZE                          03006507
030069                       INTO PV-MSG-AREA                           03006607
030070             PERFORM 9900-WRITE-TO-LOG                            03006707
030072         PERFORM 8995-RETURN                                      03008013
030073      END-IF.                                                     03008107
030074                                                                  03008207
030075***************************************************************** 03008307
030076* PUT THE OUTGOING XML MQ MESSAGE ON QUEUE                        03008407
030077***************************************************************** 03008507
030078 1400-PUT-MQ-MESG-ON-QUEUE.                                       03008607
030079                                                                  03008740
030080     IF PS-LOG-SWITCH-YES                                         03009419
030081        INITIALIZE PV-MSG-AREA                                    03009519
030083        STRING   ' ' WS006-SRC-TASK-NUMBER                        03009619
030084                 ' WSKUP302-1400:'                                03009719
030086                 ' ' WS006-OPER-UNT-ID                            03009819
030087                 ' ' WS006-EXT-SHP-ID (1:15)                      03009919
030088                 ' ' WS006-USERID                                 03010019
030089                 ' SQLCODE=' PV-DISP-SQLCODE                      03010119
030090                 ' 1400-PUT-MQ-MESG-ON-QUEUE  '                   03010219
030091                   DELIMITED BY SIZE                              03010319
030092                      INTO PV-MSG-AREA                            03010419
030093        PERFORM 9900-WRITE-TO-LOG                                 03010519
030094                                                                  03010619
030095        INITIALIZE PV-MSG-AREA                                    03010719
030097        STRING  ' ' PV-QMGR-NAME                                  03010819
030098                ' ' PV-QUE-NAME                                   03010919
030099                   DELIMITED BY SIZE                              03011019
030100                      INTO PV-MSG-AREA                            03011119
030101        PERFORM 9900-WRITE-TO-LOG                                 03011219
030102                                                                  03011319
030103     END-IF.                                                      03011419
030104                                                                  03011519
030105*SET OPTIONS.                                                     03011619
030106     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        03011719
030107     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   03011819
030108     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  03011919
030109                               MQPMO-SET-IDENTITY-CONTEXT.        03012019
030110                                                                  03012119
030111*THE MSG LENGTH FOR THE TRANSACTION IS XML-LENGTH                 03012219
030112     MOVE XML-LENGTH     TO PV-MSG-LENGTH.                        03012319
030113                                                                  03012419
030114*PUT MSG.                                                         03012519
030115     CALL PC-MQPUT USING PV-HCONN                                 03012719
030116                         PV-HANDLE                                03012819
030117                         MQM-MESSAGE-DESCRIPTOR                   03012919
030118                         MQM-PUT-MESSAGE-OPTIONS                  03013019
030119                         PV-MSG-LENGTH                            03013119
030120                         PV-XML (1:XML-LENGTH)                    03013219
030121                         PV-COMPLETION-CODE                       03013319
030122                         PV-REASON.                               03013419
030123                                                                  03013519
030124                                                                  03013719
030125*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         03013819
030126*AND BREAK OUT OF LOOP                                            03013919
030127     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        03014019
030128         MOVE '1400-PUT-MQ-MESG-ON-QUEUE '                        03014119
030129                                   TO WS006-SQL-ERROR-PARA        03014219
030130         MOVE '1'                  TO WS006-SUCCESS-IND           03014319
030131              INITIALIZE PV-MSG-AREA                              03014419
030132              STRING   ' ' WS006-SRC-TASK-NUMBER                  03014519
030133                       ' WSKUP302-1400:'                          03014619
030134                       ' ' WS006-OPER-UNT-ID                      03014719
030135                       ' ' WS006-EXT-SHP-ID (1:15)                03014819
030136                       ' ' WS006-USERID                           03014919
030137                       ' SQLCODE=' PV-DISP-SQLCODE                03015019
030138                       DELIMITED BY SIZE                          03015119
030139                       INTO PV-MSG-AREA                           03015219
030140             PERFORM 9900-WRITE-TO-LOG                            03015319
030141         PERFORM 8995-RETURN                                      03016013
030142     ELSE                                                         03016107
030143         ADD 1 TO PV-MQ-MESSAGES                                  03016207
030144     END-IF.                                                      03016307
030145                                                                  03016407
030146                                                                  03016507
030147***************************************************************** 03016607
030148* MQ SERIES CLOSE QUEUE FOR THE xxx TRANSACTIONS.                 03016707
030149***************************************************************** 03016807
030150 1500-MQ-CLOSE-QUEUE.                                             03016907
030151     MOVE '1500-MQ-CLOSE-QUEUE '     TO PV-PARAGRAPH.             03017007
030152                                                                  03017107
030153     IF PS-LOG-SWITCH-YES                                         03017207
030154        INITIALIZE PV-MSG-AREA                                    03017307
030155        STRING   ' ' WS006-SRC-TASK-NUMBER                        03017407
030156                 ' WSKUP302-1500:'                                03017507
030157                 ' ' WS006-OPER-UNT-ID                            03017607
030158                 ' ' WS006-EXT-SHP-ID (1:15)                      03017707
030159                 ' ' WS006-USERID                                 03017807
030160                 ' SQLCODE=' PV-DISP-SQLCODE                      03017907
030161                 ' 1500-MQ-CLOSE-QUEUE     '                      03018007
030162                   DELIMITED BY SIZE                              03018107
030163                      INTO PV-MSG-AREA                            03018207
030164        PERFORM 9900-WRITE-TO-LOG                                 03018307
030165     END-IF.                                                      03018407
030166                                                                  03018507
030167                                                                  03018607
030168     MOVE PV-QUE-NAME               TO MQOD-OBJECTNAME.           03018707
030169     MOVE PV-QMGR-NAME              TO MQOD-OBJECTQMGRNAME.       03018807
030170                                                                  03018907
030171     CALL PC-MQCLOSE USING PV-HCONN                               03019107
030172                           PV-HANDLE                              03019207
030173                           MQCO-NONE                              03019307
030174                           PV-COMPLETION-CODE                     03019407
030175                           PV-REASON.                             03019507
030176                                                                  03019607
030177*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                03019807
030178*    AND EXIT                                                     03019907
030179                                                                  03020007
030180     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03020107
030181         CONTINUE                                                 03020207
030182     ELSE                                                         03020307
030183         MOVE '1500-MQ-CLOSE-QUEUE       '                        03020407
030184                                   TO WS006-SQL-ERROR-PARA        03020507
030185         MOVE '1'                  TO WS006-SUCCESS-IND           03020607
030186              INITIALIZE PV-MSG-AREA                              03020707
030188              STRING   ' ' WS006-SRC-TASK-NUMBER                  03020807
030189                       ' WSKUP302-1500:'                          03020907
030191                       ' ' WS006-OPER-UNT-ID                      03021007
030192                       ' ' WS006-EXT-SHP-ID (1:15)                03021107
030193                       ' ' WS006-USERID                           03021207
030194                       ' SQLCODE=' PV-DISP-SQLCODE                03021307
030195                       DELIMITED BY SIZE                          03021407
030196                       INTO PV-MSG-AREA                           03021507
030197             PERFORM 9900-WRITE-TO-LOG                            03021600
030199         PERFORM 8995-RETURN                                      03022913
030200     END-IF.                                                      03023000
030201                                                                  03023100
030202***************************************************************** 03023200
030203* DISCONNECT FROM QUEUE MANAGER.                                  03023300
030204***************************************************************** 03023400
030205 1800-MQ-DISCONNECT.                                              03023500
030206                                                                  03023600
030207     MOVE '1800-MQ-DISCONNECT'    TO PV-PARAGRAPH.                03023700
030208                                                                  03023800
030209     IF PS-LOG-SWITCH-YES                                         03023900
030210        INITIALIZE PV-MSG-AREA                                    03024000
030212        STRING   ' ' WS006-SRC-TASK-NUMBER                        03024100
030213                 ' WSKUP302-1800:'                                03024200
030215                 ' ' WS006-OPER-UNT-ID                            03024300
030216                 ' ' WS006-EXT-SHP-ID (1:15)                      03024400
030217                 ' ' WS006-USERID                                 03024500
030218                 ' SQLCODE=' PV-DISP-SQLCODE                      03024600
030219                 ' 1800-MQ-DISCONNECT      '                      03024700
030220                   DELIMITED BY SIZE                              03024800
030221                      INTO PV-MSG-AREA                            03024900
030222        PERFORM 9900-WRITE-TO-LOG                                 03025000
030223     END-IF.                                                      03025100
030224                                                                  03025200
030225     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                03025300
030226         CALL PC-MQDISC USING PV-HCONN                            03025500
030227                              PV-COMPLETION-CODE                  03025600
030228                              PV-REASON.                          03025739
030229                                                                  03025900
030230*    IF MQ DISCONNECT FAILED THEN DISPLAY ERROR MESSAGE           03026000
030231*    AND EXIT                                                     03026100
030232                                                                  03026200
030233     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03026300
030234         CONTINUE                                                 03026400
030235     ELSE                                                         03026500
030236         MOVE '1800-MQ-DISCONNECT        '                        03026600
030237                                   TO WS006-SQL-ERROR-PARA        03026700
030238         MOVE '1'                  TO WS006-SUCCESS-IND           03026800
030240              INITIALIZE PV-MSG-AREA                              03026900
030242              STRING   ' ' WS006-SRC-TASK-NUMBER                  03027000
030243                       ' WSKUP302-1800:'                          03027100
030245                       ' ' WS006-OPER-UNT-ID                      03027200
030246                       ' ' WS006-EXT-SHP-ID (1:15)                03027300
030247                       ' ' WS006-USERID                           03027400
030248                       ' SQLCODE=' PV-DISP-SQLCODE                03027500
030249                       DELIMITED BY SIZE                          03027600
030250                       INTO PV-MSG-AREA                           03027700
030251             PERFORM 9900-WRITE-TO-LOG                            03027800
030253         PERFORM 8995-RETURN                                      03029113
030254     END-IF.                                                      03029200
030255                                                                  03029300
030256****************************************************************  03029400
030257*   BUILD CASE HEADER INFO                                        03029500
030258****************************************************************  03029600
030259 2100-BUILD-CASEINFO-XML.                                         03029700
030260                                                                  03029800
030261     IF PS-LOG-SWITCH-YES                                         03029900
030262        INITIALIZE PV-MSG-AREA                                    03030000
030264        STRING   ' ' WS006-SRC-TASK-NUMBER                        03030100
030265                 ' WSKUP302-2100:'                                03030200
030267                 ' ' WS006-OPER-UNT-ID                            03030300
030268                 ' ' WS006-EXT-SHP-ID (1:15)                      03030400
030269                 ' ' WS006-USERID                                 03030500
030270                 ' SQLCODE=' PV-DISP-SQLCODE                      03030600
030271                 ' 2100-BUILD-CASEINFO-XML '                      03030700
030272                   DELIMITED BY SIZE                              03030800
030273                      INTO PV-MSG-AREA                            03030900
030274        PERFORM 9900-WRITE-TO-LOG                                 03031000
030275     END-IF.                                                      03031100
030276                                                                  03031200
030280     IF WST00011-EXT-SHP-ID        NOT = ShipmentNbr              03031300
030300        ADD 1                         TO PV-SHIP-CNT              03031400
030310     END-IF.                                                      03031500
030320                                                                  03031600
030400     MOVE WST00011-EXT-SHP-ID         TO ShipmentNbr              03031700
030600     MOVE WS006-CH-WHSE               TO ToLocation.              03031800
030610     MOVE WS006-CH-ORGN-TYPE          TO AsnType.                 03031900
030700     MOVE WS006-CH-HOST-INPT-ID       TO BatchCtlNbr.             03032000
030800                                                                  03032100
030801****************************************************************  03032200
030810*  CALCULATE MAX NUMBER OF CASES PER MESSAGE                      03032300
030820****************************************************************  03032400
030900 2200-CALCULATE-MAX-CASE.                                         03033000
031100                                                                  03040000
031110     IF PS-LOG-SWITCH-YES                                         03050000
031120        INITIALIZE PV-MSG-AREA                                    03060000
031130        STRING   ' ' WS006-SRC-TASK-NUMBER                        03070000
031140                 ' WSKUP302-2200:'                                03080000
031150                 ' ' WS006-OPER-UNT-ID                            03090000
031151                 ' ' WS006-EXT-SHP-ID (1:15)                      03100000
031160                 ' ' WS006-USERID                                 03110000
031170                 ' SQLCODE=' PV-DISP-SQLCODE                      03111000
031180                 ' 2200-CALCULATE-MAX-CASE '                      03112000
031190                   DELIMITED BY SIZE                              03113000
031191                      INTO PV-MSG-AREA                            03114000
031192        PERFORM 9900-WRITE-TO-LOG                                 03115000
031193     END-IF.                                                      03116000
031194                                                                  03117000
031200     MOVE WMLENGTH-CASE-HDR-LENGTH  TO PV-HDR-LENGTH.             03118000
031300     MOVE WMLENGTH-CASE-DTL-LENGTH  TO PV-DTL-LENGTH.             03119000
031400     MOVE WMLENGTH-MAX-XML-LENGTH   TO PV-MAX-XML-LENGTH.         03119100
031500                                                                  03119200
031600     COMPUTE PV-MAX-BYTES  =                                      03119300
031700             PV-HDR-LENGTH +                                      03119400
031800            (PV-DTL-LENGTH * WST00011-CSE-DTL-NBR).               03119500
031900                                                                  03119600
032000     COMPUTE PV-MAX-CASES  =                                      03119700
032100            (PV-MAX-XML-LENGTH / PV-MAX-BYTES).                   03119800
032200                                                                  03119900
032510****************************************************************  03120000
032520*   CALCULATE MAX NUMBER OF ASN MESSAGES                          03130000
032530****************************************************************  03140000
032600 2300-CALCULATE-MAX-ASN.                                          03150000
032800                                                                  03160000
032810     IF PS-LOG-SWITCH-YES                                         03170000
032820        INITIALIZE PV-MSG-AREA                                    03180000
032830        STRING   ' ' WS006-SRC-TASK-NUMBER                        03190000
032840                 ' WSKUP302-2300:'                                03200000
032850                 ' ' WS006-OPER-UNT-ID                            03210000
032851                 ' ' WS006-EXT-SHP-ID (1:15)                      03220000
032860                 ' ' WS006-USERID                                 03230000
032870                 ' SQLCODE=' PV-DISP-SQLCODE                      03240000
032880                 ' 2300-CALCULATE-MAX-ASN  '                      03250000
032890                   DELIMITED BY SIZE                              03260000
032891                      INTO PV-MSG-AREA                            03270000
032892        PERFORM 9900-WRITE-TO-LOG                                 03280000
032893     END-IF.                                                      03281000
032894                                                                  03282000
032900     MOVE WMLENGTH-ASN-DTL-LENGTH  TO PV-ASN-LENGTH.              03283000
033000     MOVE WMLENGTH-MAX-XML-LENGTH  TO PV-MAX-XML-LENGTH.          03284000
033100                                                                  03285000
033200     COMPUTE PV-MAX-ASN =                                         03286000
033300            (PV-MAX-XML-LENGTH / PV-ASN-LENGTH).                  03287000
033400                                                                  03288000
033601****************************************************************  03289000
033602*   CREATE XML BANNER                                             03290000
033603****************************************************************  03300000
033610 2400-CREATE-XML-BANNER.                                          03310000
033700                                                                  03320000
033701     IF PS-LOG-SWITCH-YES                                         03330000
033702        INITIALIZE PV-MSG-AREA                                    03340000
033704        STRING   ' ' WS006-SRC-TASK-NUMBER                        03350000
033705                 ' WSKUP302-2400:'                                03360000
033707                 ' ' WS006-OPER-UNT-ID                            03361000
033708                 ' ' WS006-EXT-SHP-ID (1:15)                      03362000
033709                 ' ' WS006-USERID                                 03363000
033710                 ' SQLCODE=' PV-DISP-SQLCODE                      03364000
033711                 ' 2400-CREATE-XML-BANNER  '                      03365000
033712                   DELIMITED BY SIZE                              03366000
033713                      INTO PV-MSG-AREA                            03367000
033714        PERFORM 9900-WRITE-TO-LOG                                 03368000
033715     END-IF.                                                      03369000
033716                                                                  03370000
033717     SET X1 TO XML-LENGTH.                                        03371000
033718     PERFORM UNTIL X1 = 0                                         03371100
033719       MOVE PV-XML2-CHAR (X1) TO PV-XML2-CHAR (X1 + 38)           03371200
033720       MOVE SPACE TO PV-XML2-CHAR (X1)                            03371300
033721       SET X1 DOWN BY 1                                           03371400
033722     END-PERFORM.                                                 03371500
033723                                                                  03371600
033724     MOVE PC-XML-BANNER TO                                        03371700
033725          PV-XML (1:LENGTH OF PC-XML-BANNER).                     03371800
033726                                                                  03371900
033727     ADD LENGTH OF PC-XML-BANNER TO XML-LENGTH.                   03372000
033730                                                                  03372100
033760****************************************************************  03372200
033770*   BUILD CASE HEADER XML (RECORD TYPE 'CH')                   *  03372300
033780****************************************************************  03372400
033800 3000-RECORD-TYPE-CH.                                             03372500
034292                                                                  03372600
034300     IF CH-SUB                   = PV-MAX-CASES   OR              03372700
034400        CH-SUB                   = WS023-MAX-CRTN-PER-MSG         03372800
034810        PERFORM 3010-GENERATE-XML-CH                              03372900
034900        MOVE WST00011-CSE-DTL-NBR TO CD-count                     03373000
035100        PERFORM 2200-CALCULATE-MAX-CASE                           03374000
035200     END-IF.                                                      03375000
035300                                                                  03376000
035400     IF WST00011-CSE-DTL-NBR NOT = PV-LAST-CSE-DTL-NBR            03377000
035800        PERFORM 3010-GENERATE-XML-CH                              03378000
035900        MOVE WST00011-CSE-DTL-NBR TO CD-count                     03379000
036000                                     PV-LAST-CSE-DTL-NBR          03380000
036100        PERFORM 2200-CALCULATE-MAX-CASE                           03390000
036200     END-IF.                                                      03400000
037190                                                                  03410000
037191     ADD +1 TO PV-CH-CNT.                                         03420000
037200     MOVE WST00011-REC-TYP-DESC-TEXT TO WS006-CASE-HDR-REC.       03430000
038120                                                                  03440000
038130     IF PS-LOG-SWITCH-YES                                         03450000
038140        INITIALIZE PV-MSG-AREA                                    03460000
038150        STRING   ' ' WS006-SRC-TASK-NUMBER                        03470000
038160                 ' WSKUP302-3000:'                                03480000
038170                 ' ' WS006-OPER-UNT-ID                            03490000
038180                 ' ' WS006-EXT-SHP-ID (1:15)                      03500000
038191                 ' ' WS006-USERID                                 03510000
038192                 ' SQLCODE=' PV-DISP-SQLCODE                      03520000
038193                 ' ' WS006-CH-CASE-NBR                            03530000
038194                 ' 3000-RECORD-TYPE-CH  '                         03540000
038195                   DELIMITED BY SIZE                              03550000
038196                      INTO PV-MSG-AREA                            03560000
038197        PERFORM 9900-WRITE-TO-LOG                                 03570000
038198                                                                  03580000
038199     END-IF.                                                      03590000
038200     ADD  1     TO CH-SUB.                                        03600000
038300     MOVE ZEROS TO CD-SUB.                                        03610000
038400                                                                  03620000
039300     IF CH-SUB = 1                                                03630000
039400        PERFORM 2100-BUILD-CASEINFO-XML                           03640000
039500     END-IF.                                                      03650000
039600                                                                  03660000
039700* Case - Build Header                                             03670000
039710                                                                  03680000
039800     MOVE WS006-CH-CASE-NBR       TO  CaseNbr                     03690000
039900                                      OF ASNCase (CH-SUB).        03700000
040300                                                                  03711400
218265     IF WS006-CH-FINDLAY-SHIPMT                                   03712442
218265        MOVE WS006-CH-CASE-NBR     TO PV-CASE-SSCC                03712642
218265        MOVE PV-CASE-SML           TO PV-CASE-SML-COMP            03713042
218265        PERFORM 8350-RETRIEVE-SSCC                                03714042
218265        MOVE PV-XML-CASE-EXPAND    TO AltCaseNbr                  03715042
218265                                      OF ASNCase (CH-SUB)         03716042
218265     ELSE                                                         03716242
218265        MOVE PC-XML-ZEROES         TO PV-XML-CASE-EXPAND          03716342
218265        MOVE PV-XML-CASE-EXPAND    TO AltCaseNbr                  03716442
218265                                      OF ASNCase (CH-SUB)         03716542
218265     END-IF.                                                      03717042
218265                                                                  03718042
040400     MOVE WS006-CH-WHSE           TO  Warehouse                   03720000
040500                                      OF ASNCase (CH-SUB).        03730000
041400     MOVE '01'                    TO  Compan1                     03740000
041500                                      OF ASNCase (CH-SUB).        03750000
041600     MOVE '01'                    TO  Divisio1                    03760000
041700                                      OF ASNCase (CH-SUB).        03770000
041800     MOVE WS006-CH-ORIG-SHPMT-NBR TO  ReceivedShipmentNbr         03780000
041900                                      OF ASNCase (CH-SUB).        03790000
042000     MOVE WS006-CH-ORIG-SHPMT-NBR TO  OriginalShipmentNbr         03800000
042100                                      OF ASNCase (CH-SUB).        03810000
042200     MOVE WS006-CH-RCVR-SEQ-NBR   TO  DcOrderNbr                  03820000
042300                                      OF ASNCase (CH-SUB).        03830000
042400     MOVE WS006-CH-TRIP-ID        TO  WorkOrderNbr                03840000
042500                                      OF ASNCase (CH-SUB).        03850000
042600     MOVE 'Y'                     TO  ProcessImmdNeeds            03860000
042700                                      OF ASNCase (CH-SUB).        03870000
RG1950     MOVE WS006-CH-SHPD-UNT-VOL   TO  Volume                      03880005
042900                                      OF ASNCase (CH-SUB).        03890000
043000     MOVE WS006-CH-EST-WEIGHT     TO  PV-CONVERT-NUM.             03900000
043100     MOVE PV-CONVERT-NUM          TO  EstimatedWeight             03910000
043200                                      OF ASNCase (CH-SUB).        03920000
043300     MOVE WS006-CH-PO-NBR         TO  PONbr                       03930000
043400                                      OF ASNCase (CH-SUB).        03940000
043500     MOVE WS006-CH-SCAC           TO  ShipVia                     03950000
043600                                      OF ASNCase (CH-SUB).        03960000
043700     MOVE WS006-CH-TRLR-ID        TO  TrailerNumber               03970000
043800                                      OF ASNCase (CH-SUB).        03980000
043810                                                                  03990000
043900     MOVE '2007-01-27T13:47:00'   TO  StatusDateTime              04000000
044000                                      OF ASNCase (CH-SUB).        04010000
044010                                                                  04020000
044060                                                                  04030000
044070     MOVE WS006-CH-CREATE-TMST (1:4)  TO PV-CONVERT-DATE (1:4).   04040000
044080     MOVE '-'                         TO PV-CONVERT-DATE (5:1)    04050000
044090                                         PV-CONVERT-DATE (8:1).   04060000
044092     MOVE WS006-CH-CREATE-TMST (6:2)  TO PV-CONVERT-DATE (6:2).   04070000
044094     MOVE WS006-CH-CREATE-TMST (9:2)  TO PV-CONVERT-DATE (9:2).   04080000
044096     MOVE 'T'                         TO PV-CONVERT-DATE (11:1).  04090000
044098     MOVE WS006-CH-CREATE-TMST (12:2) TO PV-CONVERT-DATE (12:2).  04100000
044100     MOVE ':'                         TO PV-CONVERT-DATE (14:1)   04110000
044101                                         PV-CONVERT-DATE (17:1).  04120000
044103     MOVE WS006-CH-CREATE-TMST (15:2) TO PV-CONVERT-DATE (15:2).  04130000
044105     MOVE WS006-CH-CREATE-TMST (18:2) TO PV-CONVERT-DATE (18:2).  04140000
044106                                                                  04150000
044107     MOVE PV-CONVERT-DATE         TO  StatusDateTime              04160000
044108                                      OF ASNCase (CH-SUB).        04170000
044110     MOVE WS006-CH-SNGL-SKU-CASE  TO  SingleSkuCase               04180000
044200                                      OF ASNCase (CH-SUB).        04190000
044300     MOVE WS006-CH-VENDOR-ID      TO  VendorId                    04200000
044400                                      OF ASNCase (CH-SUB).        04210000
044500     MOVE 'C'                     TO  PhysicalEntityCode          04220000
044600                                      OF ASNCase (CH-SUB).        04230000
044900                                                                  04240000
045000     ADD 1 TO CH-count.                                           04250000
045100                                                                  04260000
045110****************************************************************  04270000
045120*   GENERATE XML HEADER AND DETAIL                                04280000
045130****************************************************************  04290000
045200 3010-GENERATE-XML-CH.                                            04300000
045400                                                                  04310000
045410     IF PS-LOG-SWITCH-YES                                         04320000
045420        INITIALIZE PV-MSG-AREA                                    04330000
045430        STRING   ' ' WS006-SRC-TASK-NUMBER                        04340000
045440                 ' WSKUP302-3010:'                                04350000
045450                 ' ' WS006-OPER-UNT-ID                            04360000
045451                 ' ' WS006-EXT-SHP-ID (1:15)                      04370000
045460                 ' ' WS006-USERID                                 04380000
045470                 ' SQLCODE=' PV-DISP-SQLCODE                      04390000
045480                 ' 3010-GENERATE-XML-CH    '                      04400000
045490                   DELIMITED BY SIZE                              04410000
045491                      INTO PV-MSG-AREA                            04420000
045492        PERFORM 9900-WRITE-TO-LOG                                 04430000
045493     END-IF.                                                      04440000
045494                                                                  04450000
045500     MOVE SPACES TO PV-XML.                                       04460000
045600                                                                  04470000
045900     XML GENERATE PV-XML                                          04480000
046000         FROM InboundASNBridge                                    04490000
046100         COUNT IN XML-LENGTH                                      04500000
046200         ON EXCEPTION                                             04510000
046300             PERFORM 8500-XML-ERROR                               04520000
046400         NOT ON EXCEPTION                                         04530000
046500             ADD +1 TO PV-XML-OUT                                 04540000
046600             PERFORM 8600-REPLACE-XML                             04550000
046800             PERFORM 8700-XML-SUCCESS                             04560000
046900     END-XML.                                                     04570000
047400                                                                  04580000
047410     MOVE CH-SUB TO CH-COUNT.                                     04590000
047500     PERFORM WITH TEST AFTER VARYING CH-SUB FROM 1 BY 1           04600000
047510             UNTIL CH-SUB = CH-COUNT                              04610000
047511                OR CH-SUB > CH-COUNT                              04620000
047600             MOVE SPACES TO ASNCase (CH-SUB)                      04630000
047700     END-PERFORM.                                                 04640000
047800                                                                  04650000
048850     MOVE ZEROS TO CH-SUB                                         04660000
048860                   CH-count                                       04670000
048900                   CD-SUB                                         04680000
049000                   CD-count.                                      04690000
049270                                                                  04700000
049280     PERFORM 2400-CREATE-XML-BANNER.                              04710000
049301     ADD 1 TO PV-CH-XML.                                          04720000
049500                                                                  04730000
049501     IF PS-WRITE-MQ-YES                                           04740000
049510        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         04750000
049511     END-IF.                                                      04760000
049512                                                                  04770000
050010****************************************************************  04780000
050020*   BUILD CASE DETAIL XML  (RECORD TYPE 'CD')                  *  04790000
050030****************************************************************  04800000
050100 3020-RECORD-TYPE-CD.                                             04810000
050394                                                                  04820000
050400     ADD +1 TO PV-CD-CNT.                                         04830000
051400                                                                  04840000
052200     MOVE WST00011-REC-TYP-DESC-TEXT TO WS007-CASE-DTL-REC.       04850000
052201                                                                  04860000
052210     IF PS-LOG-SWITCH-YES                                         04870000
052220        INITIALIZE PV-MSG-AREA                                    04880000
052230        STRING   ' ' WS006-SRC-TASK-NUMBER                        04890000
052240                 ' WSKUP302-3020:'                                04900000
052250                 ' ' WS006-OPER-UNT-ID                            04910000
052260                 ' ' WS006-EXT-SHP-ID (1:15)                      04920000
052280                 ' ' WS006-USERID                                 04930000
052290                 ' SQLCODE=' PV-DISP-SQLCODE                      04940000
052291                 ' ' WS007-CD-CASE-NBR                            04950000
052292                 ' 3020-RECORD-TYPE-CD  '                         04960000
052293                   DELIMITED BY SIZE                              04970000
052294                      INTO PV-MSG-AREA                            04980000
052295        PERFORM 9900-WRITE-TO-LOG                                 04990000
052296     END-IF.                                                      05000000
052300                                                                  05010000
052900     ADD  1 TO CD-SUB.                                            05020000
052920                                                                  05030000
054000* Build Case Contents (Details)                                   05040000
054100                                                                  05050000
054200     MOVE WS007-CD-CASE-NBR       TO  CaseNbr (CH-SUB).           05060000
054300     MOVE PV-SHIP-CNT             TO  SkuSequenceNbr              05070000
054400                                      (CH-SUB CD-SUB).            05080000
054500     MOVE '01'                    TO  Compan2                     05090000
054600                                      OF SKUDefinition            05100000
054700                                      (CH-SUB CD-SUB).            05110000
054800     MOVE '01'                    TO  Divisio2                    05120000
054900                                      OF SKUDefinition            05130000
055000                                      (CH-SUB CD-SUB).            05140000
055100     MOVE WS007-CD-SKU-NBR        TO  StyleSuffix                 05150000
055200                                      OF SKUDefinition            05160000
055300                                      (CH-SUB CD-SUB).            05170000
055400     MOVE 'F'                     TO  InventoryType               05180000
055500                                      OF SubSKUFields             05190000
055600                                      (CH-SUB CD-SUB).            05200000
055610                                                                  05210000
055700     MOVE WS007-CD-SKU-ID         TO  SkuId                       05220000
055800                                      OF SKUDefinition            05230000
055900                                      (CH-SUB CD-SUB).            05240000
055910                                                                  05250000
056000     MOVE WS007-CD-SHIPD-UNT-QTY  TO  ShippedAsnQuantity          05260000
056100                                      (CH-SUB CD-SUB).            05270000
056200     MOVE WS007-CD-PACK-SKU       TO  AssortmentNbr               05280000
056300                                      (CH-SUB CD-SUB).            05290000
056700     MOVE WST00011-EXT-SHP-ID     TO  ShipmentNb2                 05300000
056800                                      (CH-SUB CD-SUB).            05310000
056810     MOVE WS007-CD-PO-LINE-NBR    TO  CutNbr                      05320000
056830                                      (CH-SUB CD-SUB).            05330000
056900                                                                  05340000
057000****************************************************************  05350000
057100*   BUILD ASN HEADER XML (RECORD TYPE 'AH')                    *  05360000
057200****************************************************************  05370000
057300 3040-RECORD-TYPE-AH.                                             05380000
057500                                                                  05390000
057510     IF PS-LOG-SWITCH-YES                                         05400000
057520        INITIALIZE PV-MSG-AREA                                    05410000
057530        STRING   ' ' WS006-SRC-TASK-NUMBER                        05420000
057540                 ' WSKUP302-3040:'                                05430000
057550                 ' ' WS006-OPER-UNT-ID                            05440000
057551                 ' ' WS006-EXT-SHP-ID (1:15)                      05450000
057560                 ' ' WS006-USERID                                 05460000
057570                 ' SQLCODE=' PV-DISP-SQLCODE                      05470000
057580                 ' 3040-RECORD-TYPE-AH     '                      05480000
057590                   DELIMITED BY SIZE                              05490000
057591                      INTO PV-MSG-AREA                            05500000
057592        PERFORM 9900-WRITE-TO-LOG                                 05510000
057593     END-IF.                                                      05520000
057594                                                                  05530000
057600     IF CH-SUB > ZEROS                                            05540000
057700        PERFORM 3010-GENERATE-XML-CH                              05550000
057710     END-IF.                                                      05560000
057800                                                                  05570000
058000     IF AD-SUB > 0                                                05580000
058110        PERFORM 3070-GENERATE-XML-AD                              05590000
058120     END-IF.                                                      05600000
058130                                                                  05610000
058300     MOVE WST00011-CSE-DTL-NBR TO PV-LAST-CSE-DTL-NBR.            05620000
058400                                                                  05630000
058500     ADD +1 TO PV-AH-CNT.                                         05640000
058600     PERFORM 2300-CALCULATE-MAX-ASN.                              05650000
058700                                                                  05660000
058800     MOVE WST00011-REC-TYP-DESC-TEXT  TO  WS004-ASN-REC.          05670000
058900     MOVE WS004-AH-SHIPMT-NBR         TO  ShipmentNb4.            05680000
059000     MOVE WS004-AH-WHSE               TO  ToLocatio4.             05690000
059110*dmh MOVE WS004-AH-ORGN-TYPE          TO  AsnTyp4.                05700000
059300                                                                  05710000
059400** REMOVE PER DENICE 3/5/2007                                     05720000
059500**   MOVE WS004-AH-BOL-NBR            TO  BillOfLading.           05730000
059600     MOVE WS004-AH-CARRIER-SHIP-VIA   TO  ShipVi4.                05740000
059700     MOVE WS004-AH-TRLR-NBR           TO  TrailerNumbe4.          05750000
059800     MOVE WS004-AH-TRIP-ID            TO  ContractorLocation.     05760000
059900                                                                  05770000
060000** REMOVE PER DENICE 3/5/2007                                     05780000
060100**   MOVE WS004-AH-PRO-NBR            TO  ProNbr.                 05790000
060215                                                                  05800000
060220     MOVE WS004-AH-SHIP-DATE(1:4)     TO  ShippedDate (1:4).      05810000
060221     MOVE '-'                         TO  ShippedDate (5:1)       05820000
060230                                          ShippedDate (8:1).      05830000
060231     MOVE WS004-AH-SHIP-DATE(5:2)     TO  ShippedDate (6:2).      05840000
060232     MOVE WS004-AH-SHIP-DATE(7:2)     TO  ShippedDate (9:2).      05850000
060233                                                                  05860000
060234     MOVE 'T'                         TO  ShippedDate (11:1).     05870000
060235     MOVE WS004-AH-SHIP-DATE(9:2)     TO  ShippedDate (12:2).     05880000
060236     MOVE ':'                         TO  ShippedDate (14:1)      05890000
060237                                          ShippedDate (17:1).     05900000
060238     MOVE WS004-AH-SHIP-DATE(11:2)    TO  ShippedDate (15:2).     05910000
060240     MOVE WS004-AH-SHIP-DATE(13:2)    TO  ShippedDate (18:2).     05920000
060241                                                                  05930000
060310     MOVE WS004-AH-EXPT-START-DATE (1:4)  TO                      05940000
060311                                      SchedStartRcvDate (1:4).    05950000
060320     MOVE '-'                         TO                          05960000
060331                                      SchedStartRcvDate (5:1)     05970000
060332                                      SchedStartRcvDate (8:1).    05980000
060333     MOVE WS004-AH-EXPT-START-DATE (5:2)  TO                      05990000
060334                                      SchedStartRcvDate (6:2).    06000000
060350     MOVE WS004-AH-EXPT-START-DATE (7:2)  TO                      06010000
060352                                      SchedStartRcvDate (9:2).    06020000
060360     MOVE 'T'                         TO                          06030000
060361                                      SchedStartRcvDate (11:1).   06031000
060370     MOVE WS004-AH-EXPT-START-DATE (9:2) TO                       06032000
060371                                      SchedStartRcvDate (12:2).   06033000
060380     MOVE ':'                         TO                          06034000
060391                                      SchedStartRcvDate (14:1)    06035000
060392                                      SchedStartRcvDate (17:1).   06036000
060393     MOVE WS004-AH-EXPT-START-DATE (11:2) TO                      06036100
060394                                      SchedStartRcvDate (15:2).   06036200
060395     MOVE WS004-AH-EXPT-START-DATE (13:2) TO                      06036300
060396                                      SchedStartRcvDate (18:2).   06036400
060400                                                                  06036500
060700     MOVE '0'                         TO  StatusCode.             06036600
060800     MOVE WS004-AH-MISC-INSTR-1       TO  MiscInstrCode1.         06036700
060900     MOVE WS004-AH-HOST-INPT-ID       TO  BatchCtlNb4.            06036800
060910     MOVE WS004-AH-ORGN-TYPE          TO  ASNOriginalType.        06036900
061000                                                                  06037000
061000* JAK 06/2007 - ADD SWITCH FOR UPDATE OF XREF_HDR DWNLD_CDE       06038000
061000     IF WS004-AH-CANCEL                                           06039000
061000         SET PS-UPDATE-HDR-X          TO TRUE                     06040000
061000     END-IF.                                                      06050000
061000                                                                  06060000
061100     PERFORM 3050-GENERATE-XML-AH.                                06070000
061200                                                                  06080000
061210****************************************************************  06090000
061220*   GENERATE XML ASN HEADER                                       06100000
061230****************************************************************  06110000
061300 3050-GENERATE-XML-AH.                                            06120000
061400                                                                  06130000
061410     IF PS-LOG-SWITCH-YES                                         06140000
061420        INITIALIZE PV-MSG-AREA                                    06141000
061430        STRING   ' ' WS006-SRC-TASK-NUMBER                        06142000
061440                 ' WSKUP302-3050:'                                06143000
061450                 ' ' WS006-OPER-UNT-ID                            06144000
061451                 ' ' WS006-EXT-SHP-ID (1:15)                      06145000
061460                 ' ' WS006-USERID                                 06145100
061470                 ' SQLCODE=' PV-DISP-SQLCODE                      06145200
061480                 ' 3050-GENERATE-XML-AH    '                      06145300
061490                   DELIMITED BY SIZE                              06145400
061491                      INTO PV-MSG-AREA                            06145500
061492        PERFORM 9900-WRITE-TO-LOG                                 06145600
061493     END-IF.                                                      06145700
061494                                                                  06145800
061500     MOVE SPACES TO PV-XML.                                       06145900
061600                                                                  06146000
061700     XML GENERATE PV-XML                                          06147000
061800         FROM InboundASNBridg4                                    06148000
061900         COUNT IN XML-LENGTH                                      06149000
062000         ON EXCEPTION                                             06150000
062100             PERFORM 8500-XML-ERROR                               06160000
062200         NOT ON EXCEPTION                                         06170000
062300             ADD +1 TO PV-XML-OUT                                 06180000
062400             PERFORM 8600-REPLACE-XML                             06190000
062600             PERFORM 8700-XML-SUCCESS                             06200000
062700     END-XML.                                                     06210000
062800                                                                  06220000
062810     PERFORM 2400-CREATE-XML-BANNER.                              06230000
062910     ADD 1 TO PV-AH-XML.                                          06240000
063010                                                                  06250000
063021     IF PS-WRITE-MQ-YES                                           06260000
063022        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         06270000
063023     END-IF.                                                      06280000
063024                                                                  06290000
063800****************************************************************  06300000
063900*   BUILD ASN DETAIL XML (RECORD TYPE 'AD')                    *  06310000
064000****************************************************************  06320000
064100 3060-RECORD-TYPE-AD.                                             06330000
064300                                                                  06340000
064310     IF PS-LOG-SWITCH-YES                                         06350000
064320        INITIALIZE PV-MSG-AREA                                    06360000
064330        STRING   ' ' WS006-SRC-TASK-NUMBER                        06370000
064340                 ' WSKUP302-3060:'                                06380000
064350                 ' ' WS006-OPER-UNT-ID                            06390000
064351                 ' ' WS006-EXT-SHP-ID (1:15)                      06400000
064360                 ' ' WS006-USERID                                 06410000
064370                 ' SQLCODE=' PV-DISP-SQLCODE                      06420000
064380                 ' 3060-RECORD-TYPE-AD     '                      06430000
064390                   DELIMITED BY SIZE                              06431000
064391                      INTO PV-MSG-AREA                            06432000
064392        PERFORM 9900-WRITE-TO-LOG                                 06433000
064393     END-IF.                                                      06434000
064394                                                                  06435000
064400     IF CH-SUB > ZEROS                                            06436000
064500        PERFORM 3010-GENERATE-XML-CH                              06437000
064510        MOVE WST00011-CSE-DTL-NBR TO PV-LAST-CSE-DTL-NBR          06438000
064600     END-IF.                                                      06439000
064700                                                                  06440000
065200     IF PV-AH-CNT = ZEROS                                         06450000
065300        PERFORM 2300-CALCULATE-MAX-ASN                            06460000
065400     END-IF.                                                      06470000
065500                                                                  06480000
065600     ADD +1 TO PV-AD-CNT.                                         06490000
065700                                                                  06500000
065800     IF AD-SUB    = PV-MAX-ASN                                    06510000
065900        PERFORM 3070-GENERATE-XML-AD                              06520000
066000     END-IF.                                                      06530000
066100                                                                  06540000
066200**   IF WST00011-CSE-DTL-NBR     NOT = PV-LAST-CSE-DTL-NBR        06550000
066600**      PERFORM 3070-GENERATE-XML-AD                              06560000
066800**      MOVE WST00011-CSE-DTL-NBR   TO PV-LAST-CSE-DTL-NBR        06570000
066900**   END-IF.                                                      06580000
067000                                                                  06590000
067100     ADD 1 TO AD-SUB.                                             06600000
067102                                                                  06610000
068100     MOVE WST00011-REC-TYP-DESC-TEXT  TO  WS005-ASN-DTL-REC.      06620000
068204                                                                  06630000
068210     IF WS005-AD-SHIPMT-NBR            =  ShipmentNb3             06640000
068220        CONTINUE                                                  06650000
068230     ELSE                                                         06660000
068240        MOVE WS005-AD-SHIPMT-NBR      TO  ShipmentNb3             06670000
068250        ADD 1                         TO PV-SHIP-CNT-AD           06680000
068260     END-IF.                                                      06690000
068270                                                                  06700000
068300     MOVE WS005-AD-WHSE               TO  ToLocatio3.             06710000
068400     MOVE WS005-AD-ORGN-TYPE          TO  AsnTyp3.                06720000
068700                                                                  06730000
068800     MOVE '01'                        TO  Compan3(AD-SUB).        06740000
068900     MOVE '01'                        TO  Divisio3(AD-SUB).       06750000
069000     MOVE WS005-AD-SKU-NBR            TO  StyleSuffi3(AD-SUB).    06760000
069001                                                                  06770000
069100     MOVE WS005-AD-SKU-ID             TO  SkuI3(AD-SUB).          06780000
069200     MOVE PV-SHIP-CNT-AD              TO  SequenceNbr(AD-SUB).    06790000
069300     MOVE WS005-AD-UNITS-SHIPPED      TO  UnitsShipped(AD-SUB).   06800000
069400     MOVE 'F'                         TO  InventoryTyp3(AD-SUB).  06810000
069500     MOVE WS005-AD-PO-NBR             TO  PONb3(AD-SUB).          06820000
069600     MOVE WS005-AS-IMMED-NEEDS        TO  ProcessImmdNeed3        06830000
069700                                          (AD-SUB).               06840000
069800     MOVE 'N'                         TO  QcHoldUponReceipt       06850000
069900                                          (AD-SUB).               06860000
070000     MOVE WS005-AD-ACTION-CODE        TO  ActionCode(AD-SUB).     06870000
070100     MOVE WS005-AD-PO-LINE-NBR        TO  POLineNbr(AD-SUB).      06880000
070200     MOVE WS005-AD-TRIP-ID            TO  PrePackGroupCode        06890000
070300                                          (AD-SUB).               06900000
070400     MOVE WS005-AD-VENDOR-ID          TO  VendorI3(AD-SUB).       06910000
070500     MOVE WS005-AD-RCVR-SEQ-NBR       TO  TotalUnloadTime(AD-SUB).06920000
070600     MOVE WS005-AD-HOST-INPT-ID       TO  BatchCtlNb3.            06930000
070700                                                                  06940000
070800     ADD 1 TO ASN-DTL-COUNT.                                      06950000
070900                                                                  06960000
070910****************************************************************  06970000
070920*   GENERATE XML ASN DETAIL                                       06980000
070930****************************************************************  06990000
071000 3070-GENERATE-XML-AD.                                            07000000
071100                                                                  07010000
071110     IF PS-LOG-SWITCH-YES                                         07020000
071120        INITIALIZE PV-MSG-AREA                                    07030000
071130        STRING   ' ' WS006-SRC-TASK-NUMBER                        07040000
071140                 ' WSKUP302-3070:'                                07050000
071150                 ' ' WS006-OPER-UNT-ID                            07060000
071151                 ' ' WS006-EXT-SHP-ID (1:15)                      07070000
071160                 ' ' WS006-USERID                                 07080000
071170                 ' SQLCODE=' PV-DISP-SQLCODE                      07090000
071180                 ' 3070-GENERATE-XML-AD    '                      07100000
071190                   DELIMITED BY SIZE                              07110000
071191                      INTO PV-MSG-AREA                            07111000
071192        PERFORM 9900-WRITE-TO-LOG                                 07112000
071193     END-IF.                                                      07113000
071194                                                                  07114000
071200     MOVE SPACES TO PV-XML.                                       07115000
071300                                                                  07116000
071400     XML GENERATE PV-XML                                          07117000
071500         FROM InboundASNBridg3                                    07118000
071600         COUNT IN XML-LENGTH                                      07119000
071700         ON EXCEPTION                                             07120000
071800             PERFORM 8500-XML-ERROR                               07130000
071900         NOT ON EXCEPTION                                         07140000
072000             ADD +1 TO PV-XML-OUT                                 07150000
072100             PERFORM 8600-REPLACE-XML                             07160000
072300             PERFORM 8700-XML-SUCCESS                             07170000
072400     END-XML.                                                     07180000
072500                                                                  07190000
072510     MOVE AD-SUB TO ASN-DTL-COUNT.                                07200000
072520     PERFORM WITH TEST AFTER VARYING AD-SUB FROM 1 BY 1           07210000
072530             UNTIL AD-SUB = ASN-DTL-COUNT                         07220000
072540                OR AD-SUB > ASN-DTL-COUNT                         07230000
072560             MOVE SPACES TO ASNDetail (AD-SUB)                    07240000
072580     END-PERFORM.                                                 07250000
072590                                                                  07251000
072600     MOVE ZEROS TO AD-SUB                                         07252000
072700                   ASN-DTL-COUNT.                                 07253000
072800                                                                  07254000
072810     PERFORM 2400-CREATE-XML-BANNER.                              07255000
072910     ADD 1 TO PV-AD-XML.                                          07256000
073100                                                                  07257000
073111     IF PS-WRITE-MQ-YES                                           07258000
073112        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         07259000
073113     END-IF.                                                      07260000
073115                                                                  07270000
073700****************************************************************  07280000
073800*   BUILD APPOINTMENT XML (RECORD TYPE 'AP')                   *  07290000
073900****************************************************************  07300000
074000 3080-RECORD-TYPE-AP.                                             07310000
074110                                                                  07320000
074120     IF PS-LOG-SWITCH-YES                                         07330000
074130        INITIALIZE PV-MSG-AREA                                    07340000
074140        STRING   ' ' WS006-SRC-TASK-NUMBER                        07350000
074150                 ' WSKUP302-3080:'                                07360000
074160                 ' ' WS006-OPER-UNT-ID                            07370000
074161                 ' ' WS006-EXT-SHP-ID (1:15)                      07380000
074170                 ' ' WS006-USERID                                 07390000
074180                 ' SQLCODE=' PV-DISP-SQLCODE                      07400000
074190                 ' 3080-RECORD-TYPE-AP     '                      07410000
074200                   DELIMITED BY SIZE                              07411000
074300                      INTO PV-MSG-AREA                            07412000
074310        PERFORM 9900-WRITE-TO-LOG                                 07413000
074320     END-IF.                                                      07414000
074330                                                                  07415000
074400     IF CH-SUB > ZEROS                                            07416000
074500        PERFORM 3010-GENERATE-XML-CH                              07417000
074600     END-IF.                                                      07418000
074700                                                                  07419000
075200     IF AD-SUB > ZEROS                                            07420000
075300        PERFORM 3070-GENERATE-XML-AD                              07430000
075400     END-IF.                                                      07440000
075550                                                                  07450000
075600     ADD +1 TO PV-AP-CNT.                                         07460000
075700     MOVE WST00011-REC-TYP-DESC-TEXT  TO WS008-APPOINTMENT-REC.   07470000
075800                                                                  07480000
076000     MOVE 'I'                         TO  ShipmentType.           07490000
076100     MOVE WS008-AP-SHIPMT-NBR         TO  ShipmentNb5.            07500000
076200     MOVE WS008-AP-WHSE               TO  Warehous5.              07510000
076300     MOVE '40'                        TO  FirmApptIndic.          07520000
076605                                                                  07530000
076606     MOVE WS008-AP-EXPCT-STRT-DT-TM (1:4)                         07540000
076607                                      TO ExpectStartDate(1:4).    07550000
076608     MOVE '-'                         TO ExpectStartDate(5:1)     07560000
076609                                         ExpectStartDate(8:1).    07570000
076610     MOVE WS008-AP-EXPCT-STRT-DT-TM (5:2)                         07580000
076611                                      TO ExpectStartDate(6:2).    07590000
076612     MOVE WS008-AP-EXPCT-STRT-DT-TM (7:2)                         07600000
076613                                      TO ExpectStartDate(9:2).    07610000
076614                                                                  07620000
076615     MOVE 'T'                         TO ExpectStartDate(11:1).   07630000
076616     MOVE WS008-AP-EXPCT-STRT-DT-TM (9:2)                         07640000
076617                                      TO ExpectStartDate(12:2).   07650000
076618     MOVE ':'                         TO ExpectStartDate(14:1)    07660000
076619                                         ExpectStartDate(17:1).   07661000
076620     MOVE WS008-AP-EXPCT-STRT-DT-TM (11:2)                        07661100
076621                                      TO ExpectStartDate(15:2).   07661200
076622     MOVE WS008-AP-EXPCT-STRT-DT-TM (13:2)                        07661300
076623                                      TO ExpectStartDate(18:2).   07661400
076624                                                                  07661500
076630     MOVE WS008-AP-APPT-PRTY          TO  ApptPriority.           07661600
076710     MOVE WS008-AP-TRLR-NBR           TO  TrailerNb5.             07661700
076800** REMOVE PER DENICE 3/5/2007                                     07661800
076900**   MOVE WS008-AP-BOL                TO  BOL.                    07661900
077000** REMOVE PER DENICE 3/5/2007                                     07662000
077100**   MOVE WS008-AP-PRO-NBR            TO  ProNb5.                 07663000
077200     MOVE WS008-AP-STATUS-CODE        TO  StatusCod5.             07664000
077300     MOVE '0'                         TO  MaxSitDrn.              07665000
077400     MOVE WS008-AP-SCAC               TO  ShipVi5.                07666000
077500     MOVE WS008-AP-SEAL-NBR           TO  PromptSealNbr.          07667000
077750                                                                  07668000
077769     MOVE WS008-AP-CREATE-TMST (1:4)  TO  DateCreated (1:4).      07669000
077770     MOVE '-'                         TO  DateCreated (5:1)       07670000
077771                                          DateCreated (8:1).      07680000
077772     MOVE WS008-AP-CREATE-TMST (6:2)  TO  DateCreated (6:2).      07690000
077773     MOVE WS008-AP-CREATE-TMST (9:2)  TO  DateCreated (9:2).      07700000
077774     MOVE 'T'                         TO  DateCreated (11:1).     07710000
077775     MOVE WS008-AP-CREATE-TMST (12:2) TO  DateCreated (12:2).     07720000
077776     MOVE ':'                         TO  DateCreated (14:1)      07730000
077777                                          DateCreated (17:1).     07740000
077778     MOVE WS008-AP-CREATE-TMST (15:2) TO  DateCreated (15:2).     07750000
077779     MOVE WS008-AP-CREATE-TMST (18:2) TO  DateCreated (18:2).     07760000
077780     MOVE SPACE                       TO  DateCreated (20:1).     07770000
077790                                                                  07771000
077800     PERFORM 3090-GENERATE-XML-AP.                                07772000
077900                                                                  07773000
077910****************************************************************  07774000
077920*   GENERATE XML APPOINTMENT                                      07775000
077930****************************************************************  07776000
078000 3090-GENERATE-XML-AP.                                            07777000
078100                                                                  07778000
078110     IF PS-LOG-SWITCH-YES                                         07779000
078120        INITIALIZE PV-MSG-AREA                                    07780000
078130        STRING   ' ' WS006-SRC-TASK-NUMBER                        07790000
078140                 ' WSKUP302-3090:'                                07800000
078150                 ' ' WS006-OPER-UNT-ID                            07810000
078151                 ' ' WS006-EXT-SHP-ID (1:15)                      07811000
078160                 ' ' WS006-USERID                                 07812000
078170                 ' SQLCODE=' PV-DISP-SQLCODE                      07813000
078180                 ' 3090-GENERATE-XML-AP    '                      07814000
078190                   DELIMITED BY SIZE                              07815000
078191                      INTO PV-MSG-AREA                            07816000
078192        PERFORM 9900-WRITE-TO-LOG                                 07817000
078193     END-IF.                                                      07818000
078194                                                                  07819000
078200     MOVE SPACES TO PV-XML.                                       07819100
078300                                                                  07819200
078400     XML GENERATE PV-XML                                          07819300
078500         FROM ApptScheduleBridge                                  07819400
078600         COUNT IN XML-LENGTH                                      07819500
078700         ON EXCEPTION                                             07819600
078800             PERFORM 8500-XML-ERROR                               07819700
078900         NOT ON EXCEPTION                                         07819800
079000             ADD +1 TO PV-XML-OUT                                 07819900
079100             PERFORM 8600-REPLACE-XML                             07820000
079300             PERFORM 8700-XML-SUCCESS                             07830000
079400     END-XML.                                                     07840000
079500                                                                  07850000
079510     PERFORM 2400-CREATE-XML-BANNER.                              07860000
079610     ADD   1  TO PV-AP-XML.                                       07870000
079701                                                                  07880000
079711     IF PS-WRITE-MQ-YES                                           07890000
079712        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         07900000
079713     END-IF.                                                      07910000
079715                                                                  07920000
084808****************************************************************  07930000
084810*   UPDATE CONTROL TABLE                                       *  07940000
084900****************************************************************  07950000
085000 7500-UPDATE-CONTROL.                                             07960000
085100                                                                  07970000
085110     IF PS-LOG-SWITCH-YES                                         07980000
085120        INITIALIZE PV-MSG-AREA                                    07990000
085130        STRING   ' ' WS006-SRC-TASK-NUMBER                        08000000
085140                 ' WSKUP302-7500:'                                08010000
085150                 ' ' WS006-OPER-UNT-ID                            08020000
085151                 ' ' WS006-EXT-SHP-ID (1:15)                      08030000
085160                 ' ' WS006-USERID                                 08040000
085170                 ' SQLCODE=' PV-DISP-SQLCODE                      08050000
085180                 ' 7500-UPDATE-CONTROL     '                      08060000
085190                   DELIMITED BY SIZE                              08070000
085191                      INTO PV-MSG-AREA                            08080000
085192        PERFORM 9900-WRITE-TO-LOG                                 08090000
085193     END-IF.                                                      08100000
085194                                                                  08110000
085200     INITIALIZE DCLWST00003.                                      08120000
085320     MOVE WS006-TRN-TYP-CDE     TO WST00003-TRN-TYP-CDE.          08130000
085330     MOVE WS006-PRC-GP-ID       TO WST00003-PRC-GP-ID.            08140000
085494                                                                  08150000
085500     EXEC SQL                                                     08160000
085600          UPDATE WST_DAT_CNTL                                     08170000
085700          SET    STAT_CDE        = 'CMPLTD'                       08180000
085800                ,END_PRC_TMST    =  CURRENT TIMESTAMP             08190000
085900          WHERE  TRN_TYP_CDE     = :WST00003-TRN-TYP-CDE          08200000
085910            AND  PRC_GP_ID       = :WST00003-PRC-GP-ID            08210000
086000     END-EXEC.                                                    08220000
086100                                                                  08230000
086200     EVALUATE TRUE                                                08240000
086300       WHEN SQLCODE = ZERO                                        08250000
086300       WHEN SQLCODE = +100                                        08260000
086400            CONTINUE                                              08270000
086500       WHEN SQLCODE NOT EQUAL ZERO                                08280000
086600            MOVE '7500-UPDATE-CONTROL' TO WS006-SQL-ERROR-PARA    08290000
086920            MOVE '2'                   TO WS006-SUCCESS-IND       08300000
086930            MOVE SQLCODE               TO WS006-SQLCODE           08310000
086932               INITIALIZE PV-MSG-AREA                             08320000
086934               MOVE SQLCODE   TO PV-DISP-SQLCODE                  08330000
086935               STRING   ' ' WS006-SRC-TASK-NUMBER                 08340000
086936                        ' WSKUP302-7500:'                         08350000
086938                        ' ' WS006-OPER-UNT-ID                     08360000
086939                        ' ' WS006-EXT-SHP-ID (1:15)               08370000
086940                        ' ' WS006-USERID                          08380000
086941                        ' SQLCODE=' PV-DISP-SQLCODE               08390000
086942                        DELIMITED BY SIZE                         08400000
086943                        INTO PV-MSG-AREA                          08410000
086944              PERFORM 9900-WRITE-TO-LOG                           08420000
086945               MOVE WS006-PRC-GP-ID TO PV-DISP-PRC-GP-ID          08430000
086946               STRING   ' ' WS006-SRC-TASK-NUMBER                 08440000
086947                        ' WSKUP302-7500:'                         08450000
086948                        ' WS006-TRN-TYP-CDE'                      08460000
086949                        ' ' WS006-TRN-TYP-CDE                     08470000
086950                        ' WS006-PRC-GP-ID'                        08480000
086951                        ' ' PV-DISP-PRC-GP-ID                     08490000
086952                        DELIMITED BY SIZE                         08500000
086953                        INTO PV-MSG-AREA                          08510000
086954              PERFORM 9900-WRITE-TO-LOG                           08520000
086960          PERFORM 8995-RETURN                                     08530000
087000     END-EVALUATE.                                                08540000
087100                                                                  08550000
087110****************************************************************  08560000
087120*   UPDATE HEADER TABLE                                           08570000
087130****************************************************************  08580000
087140 7600-UPDATE-HEADER.                                              08590000
087160                                                                  08600000
087161     IF PS-LOG-SWITCH-YES                                         08610000
087162        INITIALIZE PV-MSG-AREA                                    08620000
087164        STRING   ' ' WS006-SRC-TASK-NUMBER                        08630000
087165                 ' WSKUP302-7600:'                                08640000
087167                 ' ' WS006-OPER-UNT-ID                            08650000
087168                 ' ' WS006-EXT-SHP-ID (1:15)                      08660000
087169                 ' ' WS006-USERID                                 08670000
087170                 ' SQLCODE=' PV-DISP-SQLCODE                      08680000
087171                 ' 7600-UPDATE-HEADER      '                      08690000
087172                   DELIMITED BY SIZE                              08700000
087173                      INTO PV-MSG-AREA                            08710000
087174        PERFORM 9900-WRITE-TO-LOG                                 08711000
087175     END-IF.                                                      08712000
087176                                                                  08713000
087177     INITIALIZE DCLWST00001.                                      08714000
087178                                                                  08715000
087179     MOVE WS006-EXT-SHP-ID        TO WST00001-EXT-SHP-ID.         08716000
087180                                                                  08717000
087181     EXEC SQL                                                     08718000
087182          SELECT DWNLD_TMST                                       08718100
087190                ,DWNLD_CDE                                        08718200
087191                ,SOR_CDE                                          08718300
087193          INTO   :WST00001-DWNLD-TMST                             08718400
087194                ,:WST00001-DWNLD-CDE                              08718500
087195                ,:WST00001-SOR-CDE                                08718600
087197          FROM   WST_SHPMT_XREF_HDR                               08718700
087198          WHERE  EXT_SHP_ID   = :WST00001-EXT-SHP-ID              08718800
087199     END-EXEC.                                                    08718900
087200                                                                  08719000
087202     EVALUATE TRUE                                                08720000
087203       WHEN SQLCODE = ZERO                                        08720100
087204            CONTINUE                                              08720200
087205       WHEN SQLCODE NOT EQUAL ZERO                                08720300
087206            MOVE '7600-UPDATE-HEADER ' TO WS006-SQL-ERROR-PARA    08720400
087208            MOVE '2'                   TO WS006-SUCCESS-IND       08720500
087209            MOVE SQLCODE               TO WS006-SQLCODE           08720600
087211               INITIALIZE PV-MSG-AREA                             08720700
087213               MOVE SQLCODE            TO PV-DISP-SQLCODE         08720800
087214               STRING   ' ' WS006-SRC-TASK-NUMBER                 08720900
087215                        ' WSKUP302-7600:'                         08721000
087217                        ' ' WS006-OPER-UNT-ID                     08721100
087218                        ' ' WS006-EXT-SHP-ID (1:15)               08721200
087219                        ' ' WS006-USERID                          08721300
087220                        ' SQLCODE=' PV-DISP-SQLCODE               08721400
087221                        DELIMITED BY SIZE                         08721500
087222                        INTO PV-MSG-AREA                          08721600
087223              PERFORM 9900-WRITE-TO-LOG                           08721700
087225            PERFORM 8995-RETURN                                   08721800
087226     END-EVALUATE.                                                08721900
087227                                                                  08722000
087228     EVALUATE WST00001-DWNLD-CDE                                  08722100
087229        WHEN 'N'                                                  08722200
087240           MOVE 'C' TO WST00001-DWNLD-CDE                         08722300
087241        WHEN 'P'                                                  08722400
087242              IF WS006-TROUBLE-SHPMT                              08722500
087243                 CONTINUE                                         08722600
087244              ELSE                                                08722700
087245                 MOVE 'C' TO WST00001-DWNLD-CDE                   08722800
087246              END-IF                                              08722900
087250        WHEN OTHER                                                08723000
087260           CONTINUE                                               08724000
087261     END-EVALUATE.                                                08725000
087262                                                                  08726000
087262* JAK 06/2007 - IF THE TRANSACTION IS A CANCEL TRAN, THEN         08726100
087262*               CHG THE DWNLD_CDE ON XREF_HDR TO X                08726200
087244     IF PS-UPDATE-HDR-X                                           08726300
087245        MOVE 'X' TO WST00001-DWNLD-CDE                            08726400
087246     END-IF.                                                      08726500
087262                                                                  08726600
087263     EXEC SQL                                                     08726700
087264          UPDATE WST_SHPMT_XREF_HDR                               08726800
087265          SET    DWNLD_TMST    =  CURRENT TIMESTAMP               08726900
087266                ,DWNLD_CDE     = :WST00001-DWNLD-CDE              08727000
087267          WHERE  EXT_SHP_ID    = :WST00001-EXT-SHP-ID             08727100
087268     END-EXEC.                                                    08727200
087269                                                                  08727300
087270     EVALUATE TRUE                                                08727400
087271       WHEN SQLCODE = ZERO                                        08727500
087272            CONTINUE                                              08727600
087273       WHEN SQLCODE NOT EQUAL ZERO                                08727700
087274            MOVE '7600-UPDATE-HEADER ' TO WS006-SQL-ERROR-PARA    08727800
087275            MOVE '2'                   TO WS006-SUCCESS-IND       08727900
087276            MOVE SQLCODE               TO WS006-SQLCODE           08728000
087277               INITIALIZE PV-MSG-AREA                             08728100
087279               MOVE SQLCODE         TO PV-DISP-SQLCODE            08728200
087280               STRING   ' ' WS006-SRC-TASK-NUMBER                 08728300
087281                        ' WSKUP302-7600:'                         08728400
087282                        ' ' WS006-OPER-UNT-ID                     08728500
087283                        ' ' WS006-EXT-SHP-ID (1:15)               08728600
087284                        ' ' WS006-USERID                          08728700
087285                        ' SQLCODE=' PV-DISP-SQLCODE               08728800
087286                        DELIMITED BY SIZE                         08728900
087287                        INTO PV-MSG-AREA                          08729000
087288               PERFORM 9900-WRITE-TO-LOG                          08729100
087289          PERFORM 8995-RETURN                                     08729200
087290     END-EVALUATE.                                                08729300
087291                                                                  08729400
087292****************************************************************  08729500
087293*   UPDATE DETAIL TABLE                                           08729600
087294****************************************************************  08729700
087295 7650-UPDATE-DETAIL.                                              08729800
087296                                                                  08729900
087297     IF PS-LOG-SWITCH-YES                                         08730000
087298        INITIALIZE PV-MSG-AREA                                    08730100
087300        STRING   ' ' WS006-SRC-TASK-NUMBER                        08730200
087301                 ' WSKUP302-7650:'                                08730300
087302                 ' ' WS006-OPER-UNT-ID                            08730400
087303                 ' ' WS006-EXT-SHP-ID (1:15)                      08730500
087304                 ' ' WS006-USERID                                 08730600
087305                 ' SQLCODE=' PV-DISP-SQLCODE                      08730700
087306                 ' 7650-UPDATE-DETAIL      '                      08730800
087307                   DELIMITED BY SIZE                              08730900
087308                      INTO PV-MSG-AREA                            08731000
087309        PERFORM 9900-WRITE-TO-LOG                                 08731100
087310     END-IF.                                                      08731200
087311                                                                  08731300
087312*    INITIALIZE DCLWST00002.                                      08731400
087313                                                                  08731500
087314     EXEC SQL                                                     08731600
087315          UPDATE WST_SHPMT_XREF_DTL                               08731700
087316             SET DWNLD_CDE      =  'D'                            08731800
087317           WHERE EXT_SHP_ID     = :WST00001-EXT-SHP-ID            08731900
087318             AND DWNLD_CDE NOT IN ('T')                           08732000
087319             AND ACTV_CDE       =  'A'                            08732100
087320     END-EXEC                                                     08732200
087321                                                                  08732300
087322     EVALUATE TRUE                                                08732400
087323       WHEN SQLCODE = ZERO                                        08732500
087323       WHEN SQLCODE = +100                                        08732600
087324            CONTINUE                                              08732700
087325       WHEN SQLCODE NOT EQUAL ZERO                                08732800
087326             MOVE '2'                 TO WS006-SUCCESS-IND        08732900
087327             MOVE '7650-UPDATE-DETAIL  '                          08733000
087328                                      TO WS006-SQL-ERROR-PARA     08733100
087329             MOVE SQLCODE             TO WS006-SQLCODE            08733200
087330                 INITIALIZE PV-MSG-AREA                           08733300
087332                 MOVE SQLCODE         TO PV-DISP-SQLCODE          08733400
087333                 STRING   ' ' WS006-SRC-TASK-NUMBER               08733500
087334                          ' WSKUP302-7650:'                       08733600
087335                          ' ' WS006-OPER-UNT-ID                   08733700
087336                          ' ' WS006-EXT-SHP-ID (1:15)             08733800
087337                          ' ' WS006-USERID                        08733900
087338                          ' SQLCODE=' PV-DISP-SQLCODE             08734000
087339                          DELIMITED BY SIZE                       08734100
087340                          INTO PV-MSG-AREA                        08734200
087341                 PERFORM 9900-WRITE-TO-LOG                        08734300
087342     END-EVALUATE.                                                08734400
087343                                                                  08734500
087344****************************************************************  08734600
087345*   RETREIVE XML LENGTHS                                          08734700
087400****************************************************************  08734800
087500 7700-RETEIVE-XML-LENGTHS.                                        08734900
087700                                                                  08735000
087710     IF PS-LOG-SWITCH-YES                                         08736000
087720        INITIALIZE PV-MSG-AREA                                    08737000
087730        STRING   ' ' WS006-SRC-TASK-NUMBER                        08738000
087740                 ' WSKUP302-7700:'                                08739000
087750                 ' ' WS006-OPER-UNT-ID                            08740000
087751                 ' ' WS006-EXT-SHP-ID (1:15)                      08750000
087760                 ' ' WS006-USERID                                 08760000
087770                 ' SQLCODE=' PV-DISP-SQLCODE                      08770000
087780                 ' 7700-RETEIVE-XML-LENGTHS'                      08771000
087790                   DELIMITED BY SIZE                              08772000
087791                      INTO PV-MSG-AREA                            08773000
087792        PERFORM 9900-WRITE-TO-LOG                                 08774000
087793     END-IF.                                                      08775000
087794                                                                  08776000
087800* BRINGS BACK THE LENGTHS NEEDED TO BUILD ASN XML                 08777000
087900                                                                  08778000
088000     EXEC SQL                                                     08779000
088100        SELECT A.INTGRTN_TYP_CDE, A.INTGRTN_TYP_DESC              08780000
088200              ,B.ATTR_DEFN_SEQ_NBR, B.ATTR_DEFN_DESC              08790000
088300              ,DIGITS(INT(C.ATTR_ELEM_NBR))  AS MAX_XML_LENGTH    08800000
088400              ,DIGITS(INT(D.ATTR_ELEM_NBR))  AS CASE_HDR_LENGTH   08810000
088500              ,DIGITS(INT(E.ATTR_ELEM_NBR))  AS CASE_DTL_LENGTH   08820000
088600              ,DIGITS(INT(F.ATTR_ELEM_NBR))  AS ASN_DTL_LENGTH    08830000
088700              ,DIGITS(INT(G.ATTR_ELEM_NBR))  AS ASN_HDR_LENGTH    08840000
088800              ,DIGITS(INT(H.ATTR_ELEM_NBR))  AS APPT_LENGTH       08850000
088900        INTO   :WST00008-INTGRTN-TYP-CDE                          08860000
089000              ,:WST00008-INTGRTN-TYP-DESC                         08870000
089100              ,:WST00009-ATTR-DEFN-SEQ-NBR                        08880000
089200              ,:WST00009-ATTR-DEFN-DESC                           08890000
089300              ,:WMLENGTH-MAX-XML-LENGTH                           08900000
089400              ,:WMLENGTH-CASE-HDR-LENGTH                          08910000
089500              ,:WMLENGTH-CASE-DTL-LENGTH                          08920000
089600              ,:WMLENGTH-ASN-DTL-LENGTH                           08930000
089700              ,:WMLENGTH-ASN-HEADER-LENGTH                        08940000
089800              ,:WMLENGTH-APPT-LENGTH                              08950000
089900        FROM    WST_INTGRTN_TYP A                                 08960000
090000               ,WST_ATTR_DEFN   B                                 08970000
090100               ,WST_ATTR_ELEM   C                                 08980000
090200               ,WST_ATTR_ELEM   D                                 08990000
090300               ,WST_ATTR_ELEM   E                                 09000000
090400               ,WST_ATTR_ELEM   F                                 09010000
090500               ,WST_ATTR_ELEM   G                                 09020000
090600               ,WST_ATTR_ELEM   H                                 09030000
090700       WHERE A.INTGRTN_TYP_CDE    =  'XMLLENGTH'                  09040000
090800         AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE            09050000
090900         AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE            09060000
091000         AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE            09070000
091100         AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE            09080000
091200         AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE            09090000
091300         AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE            09100000
091400         AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE            09110000
091500         AND B.ATTR_DEFN_SEQ_NBR  =  1                            09120000
091600         AND C.ATTR_DEFN_SEQ_NBR  =  1                            09130000
091700         AND D.ATTR_DEFN_SEQ_NBR  =  2                            09140000
091800         AND E.ATTR_DEFN_SEQ_NBR  =  3                            09150000
091900         AND F.ATTR_DEFN_SEQ_NBR  =  4                            09160000
092000         AND G.ATTR_DEFN_SEQ_NBR  =  5                            09170000
092100         AND H.ATTR_DEFN_SEQ_NBR  =  6                            09180000
092200         AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR          09190000
092300         AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR          09200000
092400         AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR          09210000
092500         AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR          09220000
092600         AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR          09230000
092700     END-EXEC.                                                    09240000
092800                                                                  09250000
092900     EVALUATE TRUE                                                09260000
093000       WHEN SQLCODE = ZERO                                        09270000
093100            CONTINUE                                              09280000
093200       WHEN SQLCODE NOT EQUAL ZERO                                09290000
093300            MOVE '7700-RETEIVE-XML-LENGTHS'                       09300000
093400                                       TO WS006-SQL-ERROR-PARA    09310000
093720            MOVE '2'                   TO WS006-SUCCESS-IND       09320000
093730            MOVE SQLCODE               TO WS006-SQLCODE           09330000
093732               INITIALIZE PV-MSG-AREA                             09340000
093734               MOVE SQLCODE         TO PV-DISP-SQLCODE            09350000
093735               STRING   ' ' WS006-SRC-TASK-NUMBER                 09360000
093736                        ' WSKUP302-7700:'                         09370000
093738                        ' ' WS006-OPER-UNT-ID                     09371000
093739                        ' ' WS006-EXT-SHP-ID (1:15)               09372000
093740                        ' ' WS006-USERID                          09373000
093741                        ' SQLCODE=' PV-DISP-SQLCODE               09373100
093742                        DELIMITED BY SIZE                         09373200
093743                        INTO PV-MSG-AREA                          09373300
093744              PERFORM 9900-WRITE-TO-LOG                           09373400
093750           PERFORM 8995-RETURN                                    09373500
093800     END-EVALUATE.                                                09373600
094000                                                                  09373700
095300                                                                  09373800
095500****************************************************************  09373900
095600*   OPEN  TABLE CURSOR                                         *  09374000
095700****************************************************************  09375000
095800 8100-OPEN-FETCH-CURSOR.                                          09376000
095801                                                                  09377000
095810     IF PS-LOG-SWITCH-YES                                         09378000
095820        INITIALIZE PV-MSG-AREA                                    09379000
095830        STRING   ' ' WS006-SRC-TASK-NUMBER                        09380000
095840                 ' WSKUP302-8100:'                                09390000
095850                 ' ' WS006-OPER-UNT-ID                            09400000
095851                 ' ' WS006-EXT-SHP-ID (1:15)                      09410000
095860                 ' ' WS006-USERID                                 09420000
095870                 ' SQLCODE=' PV-DISP-SQLCODE                      09430000
095880                 ' 8100-OPEN-FETCH-CURSOR  '                      09440000
095890                   DELIMITED BY SIZE                              09450000
095891                      INTO PV-MSG-AREA                            09460000
095892        PERFORM 9900-WRITE-TO-LOG                                 09470000
095893     END-IF.                                                      09480000
095894                                                                  09490000
095900     EXEC SQL                                                     09500000
096000          OPEN ASN-CSR                                            09510000
096100     END-EXEC.                                                    09520000
096200                                                                  09530000
096300     EVALUATE TRUE                                                09540000
096400         WHEN SQLCODE = ZERO                                      09550000
096500              CONTINUE                                            09560000
096600         WHEN SQLCODE = +100                                      09570000
096700              SET PS-TBL-IN-EOF       TO TRUE                     09580000
096800         WHEN SQLWARN0 NOT EQUAL SPACE                            09590000
096900         WHEN SQLCODE  NOT EQUAL ZERO                             09600000
097000              MOVE '8100-OPEN-CURSOR' TO WS006-SQL-ERROR-PARA     09610000
097320              MOVE '2'                TO WS006-SUCCESS-IND        09620000
097330              MOVE SQLCODE            TO WS006-SQLCODE            09630000
097332               INITIALIZE PV-MSG-AREA                             09640000
097334               MOVE SQLCODE         TO PV-DISP-SQLCODE            09650000
097335               STRING   ' ' WS006-SRC-TASK-NUMBER                 09660000
097336                        ' WSKUP302-8100:'                         09670000
097338                        ' ' WS006-OPER-UNT-ID                     09680000
097339                        ' ' WS006-EXT-SHP-ID (1:15)               09690000
097340                        ' ' WS006-USERID                          09700000
097341                        ' SQLCODE=' PV-DISP-SQLCODE               09710000
097342                        DELIMITED BY SIZE                         09720000
097343                        INTO PV-MSG-AREA                          09730000
097344               PERFORM 9900-WRITE-TO-LOG                          09731000
097350          PERFORM 8995-RETURN                                     09732000
097400     END-EVALUATE.                                                09733000
097500                                                                  09734000
097600     PERFORM 8200-FETCH-CURSOR.                                   09735000
097700                                                                  09736000
097800****************************************************************  09737000
097900*   FETCH TABLE CURSOR                                         *  09738000
098000****************************************************************  09739000
098100 8200-FETCH-CURSOR.                                               09740000
098200                                                                  09750000
098210     IF PS-LOG-SWITCH-YES                                         09760000
098220        INITIALIZE PV-MSG-AREA                                    09770000
098230        STRING   ' ' WS006-SRC-TASK-NUMBER                        09780000
098240                 ' WSKUP302-8200:'                                09790000
098250                 ' ' WS006-OPER-UNT-ID                            09800000
098251                 ' ' WS006-EXT-SHP-ID (1:15)                      09810000
098260                 ' ' WS006-USERID                                 09820000
098270                 ' SQLCODE=' PV-DISP-SQLCODE                      09821000
098280                 ' 8200-FETCH-CURSOR       '                      09822000
098290                   DELIMITED BY SIZE                              09823000
098291                      INTO PV-MSG-AREA                            09824000
098292        PERFORM 9900-WRITE-TO-LOG                                 09825000
098293     END-IF.                                                      09826000
098294                                                                  09827000
098300     INITIALIZE DCLWST00011                                       09828000
098400                WS004-ASN-REC                                     09829000
098401                PV-CASE                                           09830000
098410                WS005-ASN-DTL-REC                                 09840000
098420                WS006-CASE-HDR-REC                                09840100
098430                WS007-CASE-DTL-REC.                               09840200
098440                                                                  09840300
098500     EXEC SQL                                                     09840400
098600         FETCH ASN-CSR                                            09840500
098700          INTO  :WST00011-EXT-SHP-ID                              09840600
098800               ,:WST00011-CRE-TMST                                09840700
098810               ,:WST00011-ROW-NBR                                 09840800
098900               ,:WST00011-REC-TYP-GP-NBR                          09840900
098910               ,:PV-CASE                                          09841000
099000               ,:WST00011-REC-TYP-CDE                             09842000
099100               ,:WST00011-CSE-DTL-NBR                             09843000
099200               ,:WST00011-REC-TYP-DESC                            09844000
099300     END-EXEC.                                                    09845000
100692                                                                  09846000
100700     EVALUATE TRUE                                                09847000
100800         WHEN SQLCODE = ZERO                                      09848000
100900              ADD +1                   TO PV-FETCH1               09849000
101000         WHEN SQLCODE = +100                                      09850000
101100              SET PS-TBL-IN-EOF        TO TRUE                    09860000
101500         WHEN SQLWARN0 NOT EQUAL SPACE                            09870000
101600         WHEN SQLCODE NOT EQUAL ZERO                              09880000
101700              MOVE '8200-FETCH-CURSOR' TO WS006-SQL-ERROR-PARA    09890000
102020              MOVE '2'                 TO WS006-SUCCESS-IND       09900000
102030              MOVE SQLCODE             TO WS006-SQLCODE           09910000
102032                 INITIALIZE PV-MSG-AREA                           09920000
102034                 MOVE SQLCODE         TO PV-DISP-SQLCODE          09930000
102035                 STRING   ' ' WS006-SRC-TASK-NUMBER               09940000
102036                          ' WSKUP302-8200:'                       09950000
102038                          ' ' WS006-OPER-UNT-ID                   09960000
102039                          ' ' WS006-EXT-SHP-ID (1:15)             09970000
102040                          ' ' WS006-USERID                        09980000
102041                          ' SQLCODE=' PV-DISP-SQLCODE             09990000
102042                          ' WS006-SUCCESS-IND: '                  10000000
102043                          WS006-SUCCESS-IND                       10010000
102044                          DELIMITED BY SIZE                       10020000
102045                          INTO PV-MSG-AREA                        10030000
102046              PERFORM 9900-WRITE-TO-LOG                           10040000
102047              PERFORM 8995-RETURN                                 10050000
102100     END-EVALUATE.                                                10060000
102200                                                                  10070000
102300                                                                  10080000
102400****************************************************************  10090000
102500*   CLOSE TABLE CURSOR                                         *  10100000
102600****************************************************************  10110000
102700 8300-CLOSE-CURSOR.                                               10120000
102701                                                                  10130000
102710     IF PS-LOG-SWITCH-YES                                         10140000
102720        INITIALIZE PV-MSG-AREA                                    10150000
102730        STRING   ' ' WS006-SRC-TASK-NUMBER                        10160000
102740                 ' WSKUP302-8300:'                                10170000
102750                 ' ' WS006-OPER-UNT-ID                            10180000
102751                 ' ' WS006-EXT-SHP-ID (1:15)                      10190000
102760                 ' ' WS006-USERID                                 10200000
102770                 ' SQLCODE=' PV-DISP-SQLCODE                      10210000
102780                 ' 8300-CLOSE-CURSOR       '                      10220000
102790                   DELIMITED BY SIZE                              10230000
102791                      INTO PV-MSG-AREA                            10240000
102792        PERFORM 9900-WRITE-TO-LOG                                 10250000
102793     END-IF.                                                      10260000
102794                                                                  10270000
102800     EXEC SQL                                                     10271000
102900          CLOSE ASN-CSR                                           10272000
103000     END-EXEC.                                                    10273000
103100                                                                  10274000
103200     EVALUATE TRUE                                                10275000
103300         WHEN SQLCODE = ZERO                                      10276000
103400              CONTINUE                                            10277000
103500         WHEN SQLWARN0 NOT EQUAL SPACE                            10278000
103600         WHEN SQLCODE NOT EQUAL ZERO                              10279000
103700              MOVE '8300-CLOSE-CURSOR' TO WS006-SQL-ERROR-PARA    10280000
104020              MOVE '2'                 TO WS006-SUCCESS-IND       10290000
104030              MOVE SQLCODE             TO WS006-SQLCODE           10300000
104032                 INITIALIZE PV-MSG-AREA                           10310000
104034                 MOVE SQLCODE         TO PV-DISP-SQLCODE          10320000
104035                 STRING   ' ' WS006-SRC-TASK-NUMBER               10330000
104036                          ' WSKUP302-8300:'                       10340000
104038                          ' ' WS006-OPER-UNT-ID                   10350000
104039                          ' ' WS006-EXT-SHP-ID (1:15)             10360000
104040                          ' ' WS006-USERID                        10370000
104041                          ' SQLCODE=' PV-DISP-SQLCODE             10380000
104042                          DELIMITED BY SIZE                       10390000
104043                          INTO PV-MSG-AREA                        10400000
104044              PERFORM 9900-WRITE-TO-LOG                           10401000
104050              PERFORM 8995-RETURN                                 10402000
104100     END-EVALUATE.                                                10403000
104200                                                                  10404000
218265****************************************************************  10404142
218265*   USING THE HEADER CASE NUMBER RETRIEVE THE SSCC NUMBER         10404242
218265****************************************************************  10404342
218265 8350-RETRIEVE-SSCC.                                              10404442
218265                                                                  10404542
218265     EXEC SQL                                                     10404642
218265        SELECT ORIG_CART_ID                                       10404742
218265          INTO :SUT00024-ORIG-CART-ID                             10404842
218265          FROM SUT_OTBND_CART                                     10404942
218265         WHERE SHIPT_UNT_ID  = :PV-CASE-SML-COMP                  10405042
218265     END-EXEC.                                                    10405142
218265                                                                  10405242
218265     EVALUATE TRUE                                                10406242
218265       WHEN SQLCODE = ZERO                                        10406342
218265           MOVE '00'                  TO PV-XML-CASE-EXPAND (1:2) 10406442
218265           MOVE SUT00024-ORIG-CART-ID TO PV-XML-CASE-EXPAND (3:18)10406542
218265                                                                  10406642
218265       WHEN SQLCODE = +100                                        10406742
218265           MOVE PC-XML-ZEROES         TO PV-XML-CASE-EXPAND       10406842
218265                                                                  10407042
218265       WHEN SQLCODE NOT EQUAL ZERO                                10407142
218265            MOVE '8350-RETRIEVE-SSCC' TO WS006-SQL-ERROR-PARA     10407242
218265            MOVE '2'                  TO WS006-SUCCESS-IND        10407342
218265            MOVE SQLCODE              TO WS006-SQLCODE            10407442
218265            INITIALIZE PV-MSG-AREA                                10407542
218265            MOVE SQLCODE            TO PV-DISP-SQLCODE            10407642
218265            STRING   ' ' WS006-SRC-TASK-NUMBER                    10407742
218265                     ' WSKUP302-8350:'                            10407842
218265                     ' ' WS006-OPER-UNT-ID                        10407942
218265                     ' ' WS006-EXT-SHP-ID (1:15)                  10408042
218265                     ' ' WS006-USERID                             10408142
218265                     ' SQLCODE=' PV-DISP-SQLCODE                  10408342
218265                         DELIMITED BY SIZE                        10408442
218265                         INTO PV-MSG-AREA                         10408542
218265            PERFORM 9900-WRITE-TO-LOG                             10408642
218265            PERFORM 8995-RETURN                                   10408742
218265     END-EVALUATE.                                                10410342
218265                                                                  10412142
104291******************************************************************10412200
104292* BACK OUT PROCESSING                                             10412300
104293******************************************************************10412400
104294 8400-BACK-OUT.                                                   10412500
104295                                                                  10412600
104296     IF PS-LOG-SWITCH-YES                                         10413000
104297        INITIALIZE PV-MSG-AREA                                    10420000
104298        STRING   ' ' WS006-SRC-TASK-NUMBER                        10421000
104299                 ' WSKUP302-8400:'                                10422000
104300                 ' ' WS006-OPER-UNT-ID                            10423000
104301                 ' ' WS006-EXT-SHP-ID (1:15)                      10424000
104302                 ' ' WS006-USERID                                 10425000
104303                 ' SQLCODE=' PV-DISP-SQLCODE                      10426000
104304                 ' 8400-BACK-OUT 1    '                           10427000
104305                   DELIMITED BY SIZE                              10428000
104306                      INTO PV-MSG-AREA                            10429000
104307        PERFORM 9900-WRITE-TO-LOG                                 10430000
104308     END-IF.                                                      10430100
104309                                                                  10430200
104310     EXEC SQL                                                     10430300
104311         ROLLBACK                                                 10430400
104312     END-EXEC.                                                    10430500
104313                                                                  10430600
104315     STRING   ' ' WS006-SRC-TASK-NUMBER                           10430700
104316              ' WSKUP302-8400:'                                   10430800
104317              ' ' WS006-OPER-UNT-ID                               10430900
104318              ' ' WS006-EXT-SHP-ID (1:15)                         10431000
104320              ' ' WS006-USERID                                    10431100
104330              ' SQLCODE=' PV-DISP-SQLCODE                         10431200
104331              ' 8400-BACK-OUT 2    '                              10431300
104332                DELIMITED BY SIZE                                 10431400
104333                   INTO PV-MSG-AREA.                              10431500
104334     PERFORM 9900-WRITE-TO-LOG.                                   10431600
104346     INITIALIZE PV-MSG-AREA.                                      10431700
104347     STRING   ' ' WS006-SRC-TASK-NUMBER                           10431800
104348              ' WSKUP302-FAIL:'                                   10431900
104349              ' ' WS006-OPER-UNT-ID                               10432000
104350              ' ' WS006-EXT-SHP-ID (1:15)                         10433000
104351              ' ' WS006-USERID                                    10434000
104352              ' SQLCODE=' PV-DISP-SQLCODE                         10434100
104353              ' WSKUP302 FAILED!!!      '                         10434200
104354                DELIMITED BY SIZE                                 10434300
104355                  INTO PV-MSG-AREA                                10434400
104356              PERFORM 9900-WRITE-TO-LOG.                          10434500
104357                                                                  10434600
104358****************************************************************  10434700
104359*   XML ERROR                                                  *  10434800
104360****************************************************************  10434900
104400 8500-XML-ERROR.                                                  10435000
104700                                                                  10435100
104710     IF PS-LOG-SWITCH-YES                                         10435200
104720        INITIALIZE PV-MSG-AREA                                    10435300
104730        STRING   ' ' WS006-SRC-TASK-NUMBER                        10435400
104740                 ' WSKUP302-8500:'                                10435500
104750                 ' ' WS006-OPER-UNT-ID                            10435600
104751                 ' ' WS006-EXT-SHP-ID (1:15)                      10435700
104760                 ' ' WS006-USERID                                 10435800
104770                 ' SQLCODE=' PV-DISP-SQLCODE                      10435900
104780                 ' 8500-XML-ERROR          '                      10436000
104790                   DELIMITED BY SIZE                              10437000
104791                      INTO PV-MSG-AREA                            10438000
104792        PERFORM 9900-WRITE-TO-LOG                                 10439000
104793     END-IF.                                                      10440000
104794                                                                  10450000
104800*    PERFORM 9000-EXPLAIN-XML-RESPONSE                            10460000
104900*    PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    10470000
105000*               UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           10471000
105200*    END-PERFORM.                                                 10472000
105201                                                                  10473000
105206     MOVE '8500-XML-ERROR   '  TO WS006-SQL-ERROR-PARA.           10474000
105207     MOVE +999                 TO SQLCODE                         10475000
105208                                  PV-DISP-SQLCODE.                10476000
105209     MOVE '1'                  TO WS006-SUCCESS-IND.              10477000
105211     INITIALIZE PV-MSG-AREA                                       10478000
105213     STRING   ' ' WS006-SRC-TASK-NUMBER                           10479000
105214              ' WSKUP302-8500:'                                   10480000
105216              ' ' WS006-OPER-UNT-ID                               10490000
105217              ' ' WS006-EXT-SHP-ID (1:15)                         10500000
105218              ' ' WS006-USERID                                    10510000
105219              ' SQLCODE=' PV-DISP-SQLCODE                         10520000
105220              ' 8500-XML-ERROR <--------'                         10521000
105221                DELIMITED BY SIZE                                 10521100
105222                  INTO PV-MSG-AREA                                10521200
105223        PERFORM 9900-WRITE-TO-LOG                                 10521300
105230     PERFORM 8995-RETURN.                                         10521400
105600                                                                  10521500
105700****************************************************************  10521600
105710*   REPLACE XML CHARACTERS                                     *  10521700
105720****************************************************************  10521800
105800 8600-REPLACE-XML.                                                10521900
105900                                                                  10522000
106000     IF PS-LOG-SWITCH-YES                                         10523000
106100        INITIALIZE PV-MSG-AREA                                    10524000
106200        STRING   ' ' WS006-SRC-TASK-NUMBER                        10525000
106300                 ' WSKUP302-8600:'                                10526000
106400                 ' ' WS006-OPER-UNT-ID                            10527000
106401                 ' ' WS006-EXT-SHP-ID (1:15)                      10528000
106410                 ' ' WS006-USERID                                 10529000
106420                 ' SQLCODE=' PV-DISP-SQLCODE                      10530000
106430                 ' 8600-REPLACE-XML        '                      10540000
106440                   DELIMITED BY SIZE                              10550000
106450                      INTO PV-MSG-AREA                            10560000
106460        PERFORM 9900-WRITE-TO-LOG                                 10570000
106470     END-IF.                                                      10580000
106480                                                                  10590000
106500*  INSPECT ... REPLACING command to change the tag.               10600000
106600     INSPECT PV-XML REPLACING ALL 'Divisio1' BY 'Division'.       10610000
106700     INSPECT PV-XML REPLACING ALL 'Divisio2' BY 'Division'.       10620000
106800     INSPECT PV-XML REPLACING ALL 'Divisio3' BY 'Division'.       10630000
106900     INSPECT PV-XML REPLACING ALL 'Compan1'  BY 'Company'.        10640000
107000     INSPECT PV-XML REPLACING ALL 'Compan2'  BY 'Company'.        10641000
107100     INSPECT PV-XML REPLACING ALL 'Compan3'  BY 'Company'.        10642000
107200     INSPECT PV-XML REPLACING ALL 'ShipmentNb2'                   10643000
107300                               BY 'ShipmentNbr'.                  10644000
107400     INSPECT PV-XML REPLACING ALL 'ShipmentNb3'                   10645000
107500                               BY 'ShipmentNbr'.                  10646000
107600     INSPECT PV-XML REPLACING ALL 'ShipmentNb4'                   10647000
107700                               BY 'ShipmentNbr'.                  10648000
107800     INSPECT PV-XML REPLACING ALL 'ShipmentNb5'                   10649000
107900                               BY 'ShipmentNbr'.                  10650000
108000     INSPECT PV-XML REPLACING ALL 'ToLocatio3'                    10660000
108100                               BY 'ToLocation'.                   10670000
108200     INSPECT PV-XML REPLACING ALL 'ToLocatio4'                    10680000
108300                               BY 'ToLocation'.                   10690000
108400     INSPECT PV-XML REPLACING ALL 'InboundASNBridg3'              10700000
108500                               BY 'InboundASNBridge'.             10710000
108600     INSPECT PV-XML REPLACING ALL 'AsnTyp3'                       10720000
108700                               BY 'AsnType'.                      10730000
108800     INSPECT PV-XML REPLACING ALL 'BatchCtlNb3'                   10740000
108900                               BY 'BatchCtlNbr'.                  10750000
109000     INSPECT PV-XML REPLACING ALL 'StyleSuffi3'                   10760000
109100                               BY 'StyleSuffix'.                  10770000
109200     INSPECT PV-XML REPLACING ALL 'SkuI3'                         10780000
109300                               BY 'SkuID'.                        10790000
109400     INSPECT PV-XML REPLACING ALL 'SubSKUField3'                  10800000
109500                               BY 'SubSKUFields'.                 10810000
109600     INSPECT PV-XML REPLACING ALL 'InventoryTyp3'                 10820000
109700                               BY 'InventoryType'.                10830000
109800     INSPECT PV-XML REPLACING ALL 'PONb3'                         10840000
109900                               BY 'PONbr'.                        10850000
110000     INSPECT PV-XML REPLACING ALL 'VendorI3'                      10860000
110100                               BY 'VendorID'.                     10870000
110200     INSPECT PV-XML REPLACING ALL 'InboundASNBridg4'              10880000
110300                               BY 'InboundASNBridge'.             10890000
110400     INSPECT PV-XML REPLACING ALL 'InboundAS4'                    10900000
110500                               BY 'InboundASN'.                   10910000
110600     INSPECT PV-XML REPLACING ALL 'AsnTyp4'                       10920000
110700                               BY 'AsnType'.                      10930000
110800     INSPECT PV-XML REPLACING ALL 'BatchCtlNb4'                   10940000
110900                               BY 'BatchCtlNbr'.                  10950000
111000     INSPECT PV-XML REPLACING ALL 'ShipVi4'                       10960000
111100                               BY 'ShipVia'.                      10970000
111200     INSPECT PV-XML REPLACING ALL 'BatchCtlNb4'                   10980000
111300                               BY 'BatchCtlNbr'.                  10990000
111400     INSPECT PV-XML REPLACING ALL 'TrailerNumbe4'                 11000000
111500                               BY 'TrailerNumber'.                11010000
111600     INSPECT PV-XML REPLACING ALL 'TrailerNb5'                    11020000
111700                               BY 'TrailerNbr'.                   11030000
111800     INSPECT PV-XML REPLACING ALL 'ProNb5'                        11040000
111900                               BY 'ProNbr'.                       11050000
112000     INSPECT PV-XML REPLACING ALL 'StatusCod5'                    11060000
112100                               BY 'StatusCode'.                   11070000
112200     INSPECT PV-XML REPLACING ALL 'ShipVi5'                       11080000
112300                               BY 'ShipVia'.                      11090000
112310     INSPECT PV-XML REPLACING ALL 'Warehous5'                     11100000
112320                               BY 'Warehouse'.                    11110000
112330     INSPECT PV-XML REPLACING ALL 'SKUDefinitio3'                 11120000
112340                               BY 'SKUDefinition'.                11130000
112350     INSPECT PV-XML REPLACING ALL 'ProcessImmdNeed3'              11140000
112360                               BY 'ProcessImmdNeeds'.             11150000
112400                                                                  11160000
112410****************************************************************  11170000
112420*   XML SUCCESS                                                *  11180000
112430****************************************************************  11190000
112500 8700-XML-SUCCESS.                                                11200000
112600*    CONTINUE.                                                    11210000
112601                                                                  11220000
112610     IF PS-LOG-SWITCH-YES                                         11230000
112620        INITIALIZE PV-MSG-AREA                                    11240000
112630        STRING   ' ' WS006-SRC-TASK-NUMBER                        11241000
112640                 ' WSKUP302-8700:'                                11242000
112650                 ' ' WS006-OPER-UNT-ID                            11243000
112651                 ' ' WS006-EXT-SHP-ID (1:15)                      11244000
112660                 ' ' WS006-USERID                                 11245000
112670                 ' SQLCODE=' PV-DISP-SQLCODE                      11246000
112680                 ' 8700-XML-SUCCESS        '                      11247000
112690                   DELIMITED BY SIZE                              11248000
112691                      INTO PV-MSG-AREA                            11249000
112692        PERFORM 9900-WRITE-TO-LOG                                 11250000
112693     END-IF.                                                      11260000
112694                                                                  11261000
112700* This code makes the CR-MI field optional.                       11262000
112800* The XML Generator will create a tag even if the field is blank. 11263000
112900* This will strip it out.                                         11264000
113000*    UNSTRING PV-XML(1:XML-LENGTH)                                11265000
113100*      DELIMITED BY '<CR-MI> </CR-MI>'                            11266000
113200*              INTO PV-BEFORE COUNT PV-BEFORE-CNT                 11267000
113300*                   PV-AFTER  COUNT PV-AFTER-CNT.                 11268000
113400*    STRING PV-BEFORE(1:PV-BEFORE-CNT) PV-AFTER                   11269000
113500*      DELIMITED BY SIZE INTO PV-XML.                             11270000
113600*    COMPUTE XML-LENGTH = PV-BEFORE-CNT + PV-AFTER-CNT.           11280000
113700*                                                                 11290000
113800*    DISPLAY 'XML document was successfully generated'.           11300000
113900*    DISPLAY ' '.                                                 11310000
114000*    DISPLAY 'The generated XML is ' XML-LENGTH                   11320000
114100*            ' characters long.'.                                 11330000
114200*    DISPLAY ' '.                                                 11340000
114300*    DISPLAY PV-XML(1:XML-LENGTH).                                11350000
114400*                                                                 11360000
114500*    DISPLAY ' '.                                                 11370000
114600*    DISPLAY 'FORMATTED:'.                                        11380000
114700*    MOVE PV-XML(1:XML-LENGTH) TO XML-UNFORMATTED-MSG             11390000
114710*                                                                 11400000
114800*    PERFORM 9554-DISPLAY-FORMATTED-XML.                          11410000
114900*                                                                 11420000
115000****************************************************************  11430000
115100*   EOJ ROUTINE                                                *  11440000
115200****************************************************************  11450000
121200 8990-EOJ-ROUTINE.                                                11460000
122631                                                                  11470000
122632     IF PS-LOG-SWITCH-YES                                         11480000
122633        INITIALIZE PV-MSG-AREA                                    11490000
122635        STRING   ' ' WS006-SRC-TASK-NUMBER                        11500000
122636                 ' WSKUP302-8990:'                                11510000
122638                 ' ' WS006-OPER-UNT-ID                            11520000
122639                 ' ' WS006-EXT-SHP-ID (1:15)                      11530000
122640                 ' ' WS006-USERID                                 11540000
122641                 ' SQLCODE=' PV-DISP-SQLCODE                      11550000
122642                 ' 8990-EOJ-ROUTINE        '                      11560000
122643                   DELIMITED BY SIZE                              11570000
122644                      INTO PV-MSG-AREA                            11580000
122645        PERFORM 9900-WRITE-TO-LOG                                 11590000
122646     END-IF.                                                      11600000
122647                                                                  11610000
122648     PERFORM 8300-CLOSE-CURSOR.                                   11620000
122649     PERFORM 1500-MQ-CLOSE-QUEUE.                                 11630000
122650     PERFORM 1800-MQ-DISCONNECT.                                  11640000
122653     PERFORM 7500-UPDATE-CONTROL.                                 11650000
122656     PERFORM 7600-UPDATE-HEADER.                                  11660000
122657                                                                  11670000
122658     IF WST00001-SOR-CDE = 'RC'                                   11680000
122659        PERFORM 7650-UPDATE-DETAIL                                11690000
122660     ELSE                                                         11700000
122661     IF PV-AD-CNT    NOT =  0                                     11710000
122662        PERFORM 7650-UPDATE-DETAIL                                11720000
122663     END-IF.                                                      11730000
122665                                                                  11740000
122666     INITIALIZE PV-MSG-AREA.                                      11750000
122667     IF WS006-SUCCESS-IND = ' '                                   11760000
122670        STRING   ' ' WS006-SRC-TASK-NUMBER                        11770000
122680                 ' WSKUP302-EOJ :'                                11780000
122690                 ' ' WS006-OPER-UNT-ID                            11790000
122700                 ' ' WS006-EXT-SHP-ID (1:15)                      11800000
122800                 ' ' WS006-USERID                                 11810000
122900                 ' SQLCODE=' PV-DISP-SQLCODE                      11820000
122901                 ' WSKUP302 SUCCESSFUL     '                      11830000
122902                   DELIMITED BY SIZE                              11840000
122903                     INTO PV-MSG-AREA                             11850000
122904                 PERFORM 9900-WRITE-TO-LOG                        11860000
122905     ELSE                                                         11870000
122906        PERFORM 8400-BACK-OUT                                     11880000
122941     END-IF.                                                      11890000
122942                                                                  11900000
122943****************************************************************  11910000
122944*    ADDITIONAL PARAGRAPHS                                     *  11920000
122945****************************************************************  11930000
122946                                                                  11940000
122947     COPY ISPD009.                                                11950000
122950     COPY ISPD002.                                                11960000
123000     COPY ISPD007.                                                11970000
123100     COPY ISPD008.                                                11980000
123210     COPY ISPD012.                                                11990000
128401                                                                  12000000
128403 8995-RETURN.                                                     12010000
128406                                                                  12020000
128416     IF WS006-SUCCESS-IND NOT            = SPACE                  12030000
128418        PERFORM 8400-BACK-OUT                                     12040000
128419     END-IF.                                                      12050000
128420                                                                  12060000
128421* TESTING                                                         12070000
128422     IF PS-LOG-SWITCH-YES                                         12080000
128424        INITIALIZE PV-MSG-AREA                                    12090000
128425        STRING   ' ' WS006-SRC-TASK-NUMBER                        12100000
128426                 ' WSKUP302-8995:'                                12110000
128427                 ' ' WS006-OPER-UNT-ID                            12120000
128428                 ' ' WS006-EXT-SHP-ID (1:15)                      12130000
128431                 ' SQLCODE=' PV-DISP-SQLCODE                      12140000
128432                 ' 8995-RETURN             '                      12150000
128433                   DELIMITED BY SIZE                              12160000
128434                      INTO PV-MSG-AREA                            12170000
128435        PERFORM 9900-WRITE-TO-LOG                                 12180000
128440     END-IF.                                                      12190000
128442                                                                  12200000
128462     GOBACK.                                                      12210000
128465                                                                  12220000
128474****************************************************************  12230000
128475*   WRITE TO LOG                                          *       12240000
128476****************************************************************  12250000
128477 9900-WRITE-TO-LOG.                                               12260000
128478                                                                  12270000
128479     MOVE SQLCODE               TO WS006-SQLCODE.                 12280000
128480     IF SQLCODE              NOT = 0                              12290000
128481        MOVE SQLCA              TO WS006-SQLCA.                   12300000
128482                                                                  12310000
128495     DISPLAY PV-MSG-AREA.                                         12320000
128496     MOVE SPACES TO PV-MSG-AREA.                                  12330000
128497                                                                  12340000
128520******************************************************************12350000
128600*   END PGM WSKUP302                                              12360000
128700******************************************************************12370000
