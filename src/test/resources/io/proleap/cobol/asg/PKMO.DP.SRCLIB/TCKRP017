000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TCKRP017.                                00050000
000600 AUTHOR.                 COGNIZANT.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           MARCH 2014.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM CREATES THE MISSING TRANSACTION REPORT FOR        00120000
001300*  TC AND AR MISSING TRANSACTIONS.                                00130000
001400******************************************************************00140000
001500*  03/13/2014 COGNIZANT - INITAL IMPLEMENTATION.                 *00150060
001600******************************************************************00160060
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 CONFIGURATION SECTION.                                           00210000
002200                                                                  00220000
002300 SOURCE-COMPUTER.    IBM-3090.                                    00230000
002400 OBJECT-COMPUTER.    IBM-3090.                                    00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700                                                                  00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT CONTROL-CARD-FILE                                     00300047
003100         ASSIGN TO INP01.                                         00310047
003200                                                                  00320047
003300     SELECT TRANSACTION-FILE                                      00330049
003400         ASSIGN TO INP02.                                         00340000
003500                                                                  00350000
003600     SELECT MISSING-REPORT                                        00360049
003700         ASSIGN TO RPT01.                                         00370000
003800                                                                  00380007
003900******************************************************************00390007
004000 DATA DIVISION.                                                   00400007
004100******************************************************************00410007
004200                                                                  00420007
004300 FILE SECTION.                                                    00430007
004400                                                                  00440007
004500 FD  CONTROL-CARD-FILE                                            00450047
004600     RECORDING MODE IS F                                          00460047
004700     BLOCK CONTAINS 0 RECORDS                                     00470047
004800     LABEL RECORDS ARE STANDARD.                                  00480047
004900                                                                  00490047
005000 01  CONTROL-CARD-RECORD              PIC X(80).                  00500050
005100                                                                  00510047
005200 FD  TRANSACTION-FILE                                             00520007
005300     RECORDING MODE IS F                                          00530007
005400     BLOCK CONTAINS 0 RECORDS                                     00540007
005500     LABEL RECORDS ARE STANDARD.                                  00550007
005600                                                                  00560007
005700 01  TRANSACTION-RECORD               PIC X(90).                  00570050
005800                                                                  00580007
005900 FD  MISSING-REPORT                                               00590007
006000     RECORDING MODE IS F                                          00600007
006100     LABEL RECORDS ARE STANDARD                                   00610007
006200     BLOCK CONTAINS 0 RECORDS                                     00620007
006300     RECORD CONTAINS 132 CHARACTERS.                              00630007
006400                                                                  00640007
006500 01  MISSING-REPORT-RECORD            PIC X(132).                 00650050
006600                                                                  00660007
006700******************************************************************00670007
006800 WORKING-STORAGE SECTION.                                         00680007
006900******************************************************************00690007
007000                                                                  00700007
007100******************************************************************00710047
007200*   PROGRAM SWITCHES                                             *00720047
007300******************************************************************00730047
007400 01 PS-PROGRAM-SWITCHES.                                          00740000
007500                                                                  00750000
007600     05  PS-END-OF-TRAN-FILE-SW       PIC X(01)    VALUE 'N'.     00760050
007700         88  PS-END-OF-TRANS-FILE                  VALUE 'Y'.     00770050
007800         88  PS-NOT-END-OF-TRANS-FILE              VALUE 'N'.     00780050
007900     05  PS-END-OF-CONTROL-FILE-SW    PIC X(01)    VALUE 'N'.     00790050
008000         88  PS-END-OF-CONTROL-FILE                VALUE 'Y'.     00800050
008100         88  PS-NOT-END-OF-CONTROL-FILE            VALUE 'N'.     00810050
008200                                                                  00820047
008300******************************************************************00830047
008400*   PROGRAM CONSTANTS                                            *00840047
008500******************************************************************00850047
008600 01  PC-PROGRAM-CONSTANTS.                                        00860007
008700     05  PC-LINE-LIMIT                PIC S9(04)   VALUE +60.     00870050
008800     05  PC-DEBIT-ADJUSTMENT          PIC 9(04)    VALUE 8135.    00880050
008900     05  PC-PAYMENT                   PIC 9(04)    VALUE 8125.    00890050
009000     05  PC-LATE-VOID                 PIC 9(04)    VALUE 8120.    00900050
009100     05  PC-PYMT-CRDT-ADJSMNT         PIC 9(04)    VALUE 8137.    00910050
009200     05  PC-PROGRAM-NAME              PIC X(08)    VALUE          00920050
009300                                                   'TCKRP017'.    00930007
009400     05  PC-REPORT-NBR-1              PIC 9(01)    VALUE 1.       00940056
009500     05  PC-REPORT-NBR-2              PIC 9(01)    VALUE 2.       00950063
009600                                                                  00960000
009700******************************************************************00970047
009800*   PROGRAM ACCUMULATERS.                                        *00980047
009900******************************************************************00990047
010000 01 PA-PROGRAM-ACCUMULATORS.                                      01000007
010100     05  PA-PAGE-CNT                  PIC S9(05)   VALUE ZERO.    01010050
010200     05  PA-LINE-CNT                  PIC S9(03)   VALUE ZERO.    01020050
010300                                                                  01030007
010400******************************************************************01040047
010500*   PROGRAM VARIABLES.                                           *01050047
010600******************************************************************01060047
010700 01 PV-PROGRAM-VARIABLES.                                         01070000
010800                                                                  01080000
010900     05  PV-PARAGRAPH-NAME            PIC X(30)    VALUE SPACES.  01090050
011000     05  PV-OPERATION-MSG-1           PIC X(40)    VALUE SPACES.  01100050
011100     05  PV-CCYY-MM-DD.                                           01110000
011200         10 PV-MM                     PIC X(02)    VALUE SPACES.  01120050
011300         10 FILLER                    PIC X(01)    VALUE '/'.     01130050
011400         10 PV-DD                     PIC X(02)    VALUE SPACES.  01140050
011500         10 FILLER                    PIC X(01)    VALUE '/'.     01150050
011600         10 PV-CCYY                   PIC X(04)    VALUE SPACES.  01160050
011700     05  PV-DATA-EXIST                PIC X(01)    VALUE 'N'.     01170050
011800     05  PV-MISSING-COUNT             PIC S9(09)   COMP           01180050
011900                                                   VALUE ZERO.    01190056
012000     05  PV-RECORD-COUNT              PIC S9(09)   COMP           01200050
012100                                                   VALUE ZERO.    01210056
012200     05  PV-TOT-SLS-AMT               PIC S9(09)V99  COMP-3       01220055
012300                                                   VALUE ZERO.    01230056
012400     05  PV-TOT-RFND-AMT              PIC S9(09)V99  COMP-3       01240055
012500                                                   VALUE ZERO.    01250056
012600     05  PV-TOT-PAYACC-AMT            PIC S9(09)V99  COMP-3       01260055
012700                                                   VALUE ZERO.    01270056
012800                                                                  01280049
012900******************************************************************01290049
013000* ABEND CODE DECLARATION                                         *01300049
013100******************************************************************01310049
013200 01  AC-ABEND-CODE                    PIC S9(04)   VALUE ZERO     01320050
013300                                                   COMP SYNC.     01330050
013400     88  AC-CONTROL-CARD-ERROR                     VALUE +4003.   01340050
013500     88  AC-DB2-ERROR                              VALUE +4013.   01350050
013600     88  AC-CALENDAR-ROUTINE-ERROR                 VALUE +4019.   01360050
013700                                                                  01370049
013800******************************************************************01380047
013900* RECORD LAYOUT FOR INPUT CONTROL CARD                           *01390047
014000******************************************************************01400047
014100 01  CC-CONTROL-CARD.                                             01410047
014200     05  CC-DATE-MMDDCCYY.                                        01420047
014300         10 CC-DATE-MM                PIC 9(02)    VALUE ZEROES.  01430050
014400         10 CC-DATE-DD                PIC 9(02)    VALUE ZEROES.  01440050
014500         10 CC-DATE-CCYY              PIC 9(04)    VALUE ZEROES.  01450050
014600     05  CC-PROCESS-SYSTEM            PIC X(03)    VALUE ZEROES.  01460050
014700     05  FILLER                       PIC X(69)    VALUE SPACE.   01470050
014800                                                                  01480049
014900******************************************************************01490047
015000*   DATE AND TIME FIELDS.                                        *01500047
015100******************************************************************01510047
015200 01  PV-DATE-AND-TIME-FIELDS.                                     01520047
015300     05  PV-CURR-DATE-CCYYMMDD.                                   01530047
015400         10  PV-CURR-DATE-CCYY        PIC 9(04).                  01540051
015500         10  PV-CURR-DATE-MM          PIC 9(02).                  01550051
015600         10  PV-CURR-DATE-DD          PIC 9(02).                  01560051
015700     05  PV-CURR-TIME.                                            01570047
015800         10  PV-CURR-TIME-HH          PIC 9(02)    VALUE ZERO.    01580051
015900         10  PV-CURR-TIME-MM          PIC 9(02)    VALUE ZERO.    01590051
016000         10  PV-CURR-TIME-SSHH        PIC 9(04)    VALUE ZERO.    01600051
016100                                                                  01610050
016200******************************************************************01620050
016300*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT. *01630001
016400******************************************************************01640050
016500     COPY DPWS132.                                                01650001
016600                                                                  01660001
016700******************************************************************01670050
016800*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          01680047
016900******************************************************************01690050
017000     COPY DPWS500.                                                01700047
017100                                                                  01710047
017200******************************************************************01720050
017300*  VARIABLES TO FORMAT SQLCA                                      01730047
017400******************************************************************01740050
017500     COPY DPWS004.                                                01750047
017600                                                                  01760047
017700******************************************************************01770050
017800*  INPUT RECONCILIATION FILE                                      01780001
017900******************************************************************01790050
018000     COPY TCRD022.                                                01800001
018100                                                                  01810001
018200******************************************************************01820050
018300*  CREDIT TENDER TABLE (TEPCRD)                                  *01830050
018400******************************************************************01840050
018500     EXEC SQL                                                     01850047
018600         INCLUDE TEPCRD                                           01860047
018700     END-EXEC.                                                    01870047
018800                                                                  01880047
018900******************************************************************01890050
019000*  KOHLS PAYMENT TABLE (TEPPAY)                                  *01900050
019100******************************************************************01910050
019200     EXEC SQL                                                     01920047
019300         INCLUDE TEPPAY                                           01930047
019400     END-EXEC.                                                    01940047
019500                                                                  01950047
019600******************************************************************01960050
019700*  KOHLS PARTITION TABLE (TEPPART)                               *01970050
019800******************************************************************01980050
019900     EXEC SQL                                                     01990047
020000         INCLUDE TEPPART                                          02000047
020100     END-EXEC.                                                    02010047
020200                                                                  02020047
020300******************************************************************02030050
020400*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02040047
020500******************************************************************02050050
020600     EXEC SQL                                                     02060047
020700         INCLUDE SQLCA                                            02070047
020800     END-EXEC.                                                    02080047
020900                                                                  02090047
021000******************************************************************02100001
021100*  H1 TITLE FOR REPORT                                           *02110001
021200******************************************************************02120001
021300 01  H1-TITLE-LINE-1.                                             02130004
021400     05  FILLER                       PIC X(39)    VALUE SPACES.  02140051
021500     05  T1-TITLE.                                                02150001
021600         10  FILLER                   PIC X(08)    VALUE          02160051
021700         'SETTLED '.                                              02170004
021800         10  T1-TRANS-NAME            PIC X(03)    VALUE SPACES.  02180051
021900         10  FILLER                   PIC X(41)    VALUE          02190051
022000         ' TRANSACTIONS MISSING IN COSA REPORT FOR '.             02200004
022100     05  T1-PROCESS-DTE               PIC X(10).                  02210051
022200     05  FILLER                       PIC X(31)    VALUE SPACES.  02220051
022300                                                                  02230001
022400******************************************************************02240002
022500*  H2 COLUMN HEADINGS FOR REPORT                                 *02250002
022600******************************************************************02260002
022700 01  H2-DETAIL-HEADING.                                           02270004
022800     05  FILLER                       PIC X(03)    VALUE SPACES.  02280051
022900     05  FILLER                       PIC X(07)    VALUE          02290051
023000         'PARTN #'.                                               02300002
023100     05  FILLER                       PIC X(01)    VALUE SPACES.  02310051
023200     05  FILLER                       PIC X(07)    VALUE          02320051
023300         'STORE #'.                                               02330002
023400     05  FILLER                       PIC X(01)    VALUE SPACES.  02340051
023500     05  FILLER                       PIC X(05)    VALUE          02350051
023600         'REG #'.                                                 02360002
023700     05  FILLER                       PIC X(01)    VALUE SPACES.  02370051
023800     05  FILLER                       PIC X(06)    VALUE          02380051
023900         'TRAN #'.                                                02390002
024000     05  FILLER                       PIC X(01)    VALUE SPACES.  02400051
024100     05  FILLER                       PIC X(07)    VALUE          02410051
024200         'STRT TM'.                                               02420002
024300     05  FILLER                       PIC X(03)    VALUE SPACES.  02430051
024400     05  FILLER                       PIC X(09)    VALUE          02440051
024500         'TRAN DATE'.                                             02450002
024600     05  FILLER                       PIC X(03)    VALUE SPACES.  02460051
024700     05  FILLER                       PIC X(09)    VALUE          02470051
024800         'SALE DATE'.                                             02480002
024900     05  FILLER                       PIC X(03)    VALUE SPACES.  02490051
025000     05  FILLER                       PIC X(08)    VALUE          02500051
025100         'AUTH CDE'.                                              02510002
025200     05  FILLER                       PIC X(01)    VALUE SPACES.  02520051
025300     05  FILLER                       PIC X(10)    VALUE          02530051
025400         'TRANS TYPE'.                                            02540002
025500     05  FILLER                       PIC X(05)    VALUE SPACES.  02550051
025600     05  FILLER                       PIC X(09)    VALUE          02560051
025700         'SALES AMT'.                                             02570002
025800     05  FILLER                       PIC X(06)    VALUE SPACES.  02580051
025900     05  FILLER                       PIC X(10)    VALUE          02590051
026000         'REFUND AMT'.                                            02600002
026100     05  FILLER                       PIC X(06)    VALUE SPACES.  02610051
026200     05  H2-PAYACC-AMT                PIC X(10)    VALUE          02620051
026300         'PAYACC AMT'.                                            02630051
026400     05  FILLER                       PIC X(01)    VALUE SPACES.  02640051
026500******************************************************************02650002
026600*  H3 COLUMN LINES FOR REPORT                                    *02660002
026700******************************************************************02670002
026800 01  H3-DETAIL-HEADING-LINE.                                      02680049
026900     05  FILLER                       PIC X(03)    VALUE SPACES.  02690051
027000     05  FILLER                       PIC X(07)    VALUE          02700051
027100         '-------'.                                               02710002
027200     05  FILLER                       PIC X(01)    VALUE SPACES.  02720051
027300     05  FILLER                       PIC X(07)    VALUE          02730051
027400         '-------'.                                               02740002
027500     05  FILLER                       PIC X(01)    VALUE SPACES.  02750051
027600     05  FILLER                       PIC X(05)    VALUE          02760051
027700         '-----'.                                                 02770002
027800     05  FILLER                       PIC X(01)    VALUE SPACES.  02780051
027900     05  FILLER                       PIC X(06)    VALUE          02790051
028000         '------'.                                                02800002
028100     05  FILLER                       PIC X(01)    VALUE SPACES.  02810051
028200     05  FILLER                       PIC X(07)    VALUE          02820051
028300         '-------'.                                               02830002
028400     05  FILLER                       PIC X(03)    VALUE SPACES.  02840051
028500     05  FILLER                       PIC X(09)    VALUE          02850051
028600         '---------'.                                             02860002
028700     05  FILLER                       PIC X(03)    VALUE SPACES.  02870051
028800     05  FILLER                       PIC X(09)    VALUE          02880051
028900         '---------'.                                             02890002
029000     05  FILLER                       PIC X(03)    VALUE SPACES.  02900051
029100     05  FILLER                       PIC X(08)    VALUE          02910051
029200         '--------'.                                              02920002
029300     05  FILLER                       PIC X(01)    VALUE SPACES.  02930051
029400     05  FILLER                       PIC X(10)    VALUE          02940051
029500         '----------'.                                            02950002
029600     05  FILLER                       PIC X(05)    VALUE SPACES.  02960051
029700     05  FILLER                       PIC X(09)    VALUE          02970051
029800         '---------'.                                             02980002
029900     05  FILLER                       PIC X(06)    VALUE SPACES.  02990051
030000     05  FILLER                       PIC X(10)    VALUE          03000051
030100         '----------'.                                            03010002
030200     05  FILLER                       PIC X(06)    VALUE SPACES.  03020051
030300     05  H3-PAYACC-AMT-LN             PIC X(10)    VALUE          03030051
030400         '----------'.                                            03040051
030500     05  FILLER                       PIC X(01)    VALUE SPACES.  03050051
030600******************************************************************03060002
030700*  D1 DETAIL LINE FOR REPORT                                      03070002
030800******************************************************************03080002
030900 01  D1-DETAIL-LINE-1.                                            03090002
031000     05  FILLER                       PIC X(03)    VALUE SPACES.  03100051
031100     05  D1-PARTN-NBR                 PIC X(04).                  03110051
031200     05  FILLER                       PIC X(04)    VALUE SPACES.  03120051
031300     05  D1-STORE-NBR                 PIC X(04).                  03130051
031400     05  FILLER                       PIC X(04)    VALUE SPACES.  03140051
031500     05  D1-RGST-ID                   PIC X(04).                  03150051
031600     05  FILLER                       PIC X(02)    VALUE SPACES.  03160051
031700     05  D1-TRAN-NBR                  PIC X(04).                  03170051
031800     05  FILLER                       PIC X(03)    VALUE SPACES.  03180051
031900     05  D1-STRT-TME                  PIC X(08).                  03190051
032000     05  FILLER                       PIC X(02)    VALUE SPACES.  03200051
032100     05  D1-TRAN-DTE                  PIC X(10).                  03210051
032200     05  FILLER                       PIC X(02)    VALUE SPACES.  03220051
032300     05  D1-SALE-DTE                  PIC X(10).                  03230051
032400     05  FILLER                       PIC X(02)    VALUE SPACES.  03240051
032500     05  D1-AUTH-CODE                 PIC X(06).                  03250051
032600     05  FILLER                       PIC X(03)    VALUE SPACES.  03260051
032700     05  D1-TRANS-TYPE                PIC X(10).                  03270051
032800     05  FILLER                       PIC X(02)    VALUE SPACES.  03280051
032900     05  D1-SLS-AMNT                  PIC Z,ZZZ,ZZZ.99-.          03290051
033000     05  FILLER                       PIC X(03)    VALUE SPACES.  03300051
033100     05  D1-REFND-AMNT                PIC Z,ZZZ,ZZZ.99-.          03310051
033200     05  FILLER                       PIC X(03)    VALUE SPACES.  03320051
033300     05  D1-PAYACC-AMT                PIC X(13).                  03330051
033400     05  D1-PAYACC-AMT-1              REDEFINES D1-PAYACC-AMT.    03340051
033500         10 D1-PAYACC-AMT-VAL         PIC Z,ZZZ,ZZZ.99-.          03350051
033600                                                                  03360002
033700******************************************************************03370005
033800*  D2 DETAIL TOTAL AMOUNT IN REPORT                              *03380005
033900******************************************************************03390005
034000 01  D2-TOTAL-HEADING.                                            03400005
034100     05  FILLER                       PIC X(02)    VALUE SPACES.  03410051
034200     05  FILLER                       PIC X(46)    VALUE          03420051
034300         ' TOTALS OF ALL MISSING SETTLED TRANSACTIONS - '.        03430005
034400     05  FILLER                       PIC X(37)    VALUE SPACES.  03440051
034500     05  T1-TOT-SLS-AMNT              PIC ZZZ,ZZZ,ZZZ.99-.        03450051
034600     05  FILLER                       PIC X(01)    VALUE SPACES.  03460051
034700     05  T1-TOT-RFND-AMNT             PIC ZZZ,ZZZ,ZZZ.99-.        03470051
034800     05  FILLER                       PIC X(01)    VALUE SPACES.  03480051
034900     05  T1-TOT-PYACNT-AMNT           PIC X(15).                  03490051
035000     05  T1-TOT-PYACNT-AMNT-1        REDEFINES T1-TOT-PYACNT-AMNT.03500005
035100         10  T1-TOT-PYACNT-AMTVAL     PIC ZZZ,ZZZ,ZZZ.99-.        03510051
035200                                                                  03520002
035300******************************************************************03530047
035400*  NO MISSING RECORDS IN REPORT                                  *03540005
035500******************************************************************03550005
035600 01  NO-MISSING-RECORD.                                           03560002
035700     05  FILLER                       PIC X(46)    VALUE SPACES.  03570051
035800     05  FILLER                       PIC X(03)    VALUE          03580051
035900         'NO '.                                                   03590002
036000     05  T1-TRANS-NAME1               PIC X(03).                  03600051
036100     05  FILLER                       PIC X(29)    VALUE          03610051
036200          ' MISSING TRANSACTIONS IN COSA'.                        03620005
036300     05  FILLER                       PIC X(51)    VALUE SPACES.  03630051
036400                                                                  03640002
036500 PROCEDURE DIVISION.                                              03650002
036600                                                                  03660002
036700******************************************************************03670002
036800* 0000-MAINLINE-PARAGRAPH                                         03680002
036900******************************************************************03690002
037000 0000-MAINLINE-PARAGRAPH.                                         03700002
037100                                                                  03710002
037200     PERFORM 1000-INITIALIZE.                                     03720004
037300                                                                  03730002
037400     PERFORM 2000-PROCESS-TRANSACTION.                            03740066
037500                                                                  03750004
037600     IF PV-MISSING-COUNT > 0                                      03760051
037700        PERFORM 5200-WRITE-TOTAL-RPT                              03770051
037800     ELSE                                                         03780051
037900        PERFORM 5300-WRITE-NO-MISSING-RPT                         03790051
038000     END-IF.                                                      03800051
038100                                                                  03810047
038200     PERFORM 9000-EOJ-ROUTINE.                                    03820004
038300                                                                  03830004
038400     GOBACK.                                                      03840004
038500                                                                  03850004
038600******************************************************************03860003
038700*  1000-INITIALIZE                                               *03870003
038800*  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES, FILLING   *03880047
038900*  THE FIELDS OF THE STANDARD REPORT HEADER, INITIALIZING        *03890003
039000*  NECESSARY VARIABLES, AND READING THE FIRST PROCESSABLE RECORD *03900003
039100*  FROM THE INPUT FILE.                                          *03910003
039200******************************************************************03920003
039300 1000-INITIALIZE.                                                 03930003
039400                                                                  03940003
039500     OPEN INPUT  CONTROL-CARD-FILE                                03950003
039600                 TRANSACTION-FILE                                 03960047
039700          OUTPUT MISSING-REPORT.                                  03970003
039800                                                                  03980003
039900     PERFORM 1100-PROCESS-CONTROL-CARD.                           03990005
040000                                                                  04000047
040100     PERFORM 1200-FORMAT-HEADINGS.                                04010005
040200                                                                  04020047
040300     PERFORM 3000-READ-TRANSACTION-FILE.                          04030062
040400                                                                  04040051
040500     PERFORM 5000-WRITE-RPT-HEADER.                               04050051
040600                                                                  04060047
040700******************************************************************04070003
040800* 1100-PROCESS-CONTROL-CARD                                      *04080047
040900*     READ CONTROL CARD TO GET POS DATE IN MMDDCCYY FORMAT AND   *04090050
041000*     TRANSACTION FILE TYPE (KCC / TC).                          *04100050
041100*     CONVERT DATE INTO MM/DD/CCYY FORMAT.                       *04110050
041200******************************************************************04120003
041300 1100-PROCESS-CONTROL-CARD.                                       04130047
041400                                                                  04140047
041500     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  04150047
041600       AT END                                                     04160051
041700           SET PS-END-OF-CONTROL-FILE     TO TRUE                 04170051
041800     END-READ.                                                    04180050
041900                                                                  04190047
042000     DISPLAY 'TCKRP017 CONTROL CARD: ' CC-CONTROL-CARD.           04200047
042100                                                                  04210047
042200     CLOSE CONTROL-CARD-FILE.                                     04220047
042300                                                                  04230047
042400     IF PS-END-OF-CONTROL-FILE                                    04240047
042500        SET AC-CONTROL-CARD-ERROR         TO TRUE                 04250051
042600        MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME    04260051
042700        MOVE 'DATE CARD MISSING      '    TO PV-OPERATION-MSG-1   04270051
042800        PERFORM 9999-ABEND                                        04280051
042900     ELSE                                                         04290047
043000        MOVE CC-DATE-MM                   TO PV-MM                04300051
043100        MOVE CC-DATE-DD                   TO PV-DD                04310051
043200        MOVE CC-DATE-CCYY                 TO PV-CCYY              04320051
043300        MOVE PV-CCYY-MM-DD                TO T1-PROCESS-DTE       04330051
043400        MOVE CC-PROCESS-SYSTEM            TO T1-TRANS-NAME        04340051
043500        DISPLAY CC-PROCESS-SYSTEM ' FILE PROCESSING.'             04350051
043600     END-IF.                                                      04360047
043700                                                                  04370047
043800******************************************************************04380003
043900*  1200-FORMAT-HEADINGS                                          *04390047
044000*       GET CURRENT DATE AND TIME FROM SYSTEM.                   *04400047
044100*       FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.       *04410047
044200*       FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.           *04420047
044300******************************************************************04430003
044400 1200-FORMAT-HEADINGS.                                            04440047
044500                                                                  04450047
044600     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   04460047
044700     ACCEPT PV-CURR-TIME FROM TIME.                               04470047
044800                                                                  04480047
044900     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          04490003
045000     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         04500003
045100     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           04510003
045200                                                                  04520003
045300     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          04530047
045400     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        04540047
045500     MOVE PC-PROGRAM-NAME             TO DP132-PROGRAM-NAME.      04550050
045600                                                                  04560047
068000     IF CC-PROCESS-SYSTEM = 'KCC'                                 04561064
068100       MOVE PC-REPORT-NBR-1           TO DP132-REPORT-NUMBER      04562064
068200     ELSE                                                         04563064
068300       MOVE PC-REPORT-NBR-2           TO DP132-REPORT-NUMBER      04564064
068400     END-IF.                                                      04565064
045600                                                                  04566064
045700******************************************************************04570004
045800*  2000-PROCESS-TRANSACTION                                      *04580005
045900*  PROCESS TRANSACTIONS BASED ON VALUE KCC OR TC TRANSACTIONS    *04590051
046000*  FROM INPUT CONTROL CARD.                                      *04600051
046100******************************************************************04610004
046200 2000-PROCESS-TRANSACTION.                                        04620005
046300                                                                  04630004
046400     IF CC-PROCESS-SYSTEM = 'TC'                                  04640004
046500        PERFORM 2100-TC-FILE-PROCESS                              04650051
046600           UNTIL PS-END-OF-TRANS-FILE                             04660051
046700     ELSE                                                         04670047
046800        PERFORM 2200-AR-FILE-PROCESS                              04680051
046900           UNTIL PS-END-OF-TRANS-FILE                             04690051
047000     END-IF.                                                      04700047
047100                                                                  04710005
047200******************************************************************04720004
047300* 2100-TC-FILE-PROCESS                                           *04730050
047400* PROCESS THE RECORD IN TC FILE AND CREATES MISSING TRANSACTION  *04740005
047500* REPORT BASED ON THE EXISTANCE OF RECORD IN TEPCRD TABLE.       *04750005
047600******************************************************************04760004
047700 2100-TC-FILE-PROCESS.                                            04770050
047800                                                                  04780005
047900     IF TC022-PARTITION-NBR = ZEROES                              04790047
048000        PERFORM 4000-GET-PARTNBR                                  04800051
048100     END-IF.                                                      04810047
048200                                                                  04820047
048300     PERFORM 4200-SELECT-TEPCRD.                                  04830066
048400     MOVE SPACES TO D1-PAYACC-AMT.                                04840050
048500     PERFORM 2300-DETAIL-REC-PROCESS.                             04850062
048600                                                                  04860005
048700******************************************************************04870063
048800* 2200-AR-FILE-PROCESS                                           *04880063
048900* PROCESS THE RECORD IN AR FILE AND CREATES MISSING TRANSACTION  *04890063
049000* REPORT BASED ON THE EXISTANCE OF RECORD IN TEPPAY OR TEPCRD    *04900063
049100* TABLE.                                                         *04910063
049200******************************************************************04920063
049300 2200-AR-FILE-PROCESS.                                            04930063
049400                                                                  04940063
049500     IF TC022-PARTITION-NBR = ZEROES                              04950063
049600         PERFORM 4000-GET-PARTNBR                                 04960063
049700     END-IF.                                                      04970063
049800                                                                  04980063
049900     MOVE ZEROES                      TO D1-PAYACC-AMT-VAL.       04990063
050000                                                                  05000063
050100     IF TC022-TRANS-TYPE = PC-DEBIT-ADJUSTMENT OR                 05010063
050200                           PC-PAYMENT          OR                 05020063
050300                           PC-LATE-VOID        OR                 05030063
050400                           PC-PYMT-CRDT-ADJSMNT                   05040063
050500        PERFORM 4100-SELECT-TEPPAY                                05050066
050600     ELSE                                                         05060063
050700        PERFORM 4200-SELECT-TEPCRD                                05070066
050800     END-IF.                                                      05080063
050900     PERFORM 2300-DETAIL-REC-PROCESS.                             05090063
051000                                                                  05100063
051100******************************************************************05110051
051200* 2300-DETAIL-REC-PROCESS                                        *05120062
051300* WRITES THE MISSING TRANSACTION RECORDS IN REPORT.              *05130051
051400******************************************************************05140051
051500 2300-DETAIL-REC-PROCESS.                                         05150062
051600                                                                  05160051
051700     IF PV-DATA-EXIST = 'N'                                       05170051
051800                                                                  05180051
051900        ADD  +1                       TO PV-MISSING-COUNT         05190051
052000        MOVE TC022-PARTITION-NBR      TO D1-PARTN-NBR             05200051
052100        MOVE TC022-ORIG-STR-NBR       TO D1-STORE-NBR             05210051
052200        MOVE TC022-RGST-ID            TO D1-RGST-ID               05220051
052300        MOVE TC022-TRN-NBR            TO D1-TRAN-NBR              05230051
052400        MOVE TC022-STRT-TM            TO D1-STRT-TME              05240051
052500        MOVE TC022-TRAN-DATE          TO D1-TRAN-DTE              05250051
052600        MOVE TC022-SLS-DATE           TO D1-SALE-DTE              05260051
052700        MOVE TC022-AUTH-CDE           TO D1-AUTH-CODE             05270051
052700                                                                  05270168
053100        IF TC022-TRANSACTN-TYPE = 'SaleAdjustment'                05271068
052800            MOVE 'SaleAdjust'         TO D1-TRANS-TYPE            05280068
053100        ELSE                                                      05281068
053100           IF TC022-TRANSACTN-TYPE = 'RefundAdjustment'           05282068
052800               MOVE 'RefAdjust'         TO D1-TRANS-TYPE          05283068
052800           ELSE                                                   05284068
052800               MOVE TC022-TRANSACTN-TYPE  tO D1-TRANS-TYPE        05285068
052800           END-IF                                                 05286068
052800        END-IF                                                    05287068
052900                                                                  05290051
053000        EVALUATE TC022-TRANSACTN-TYPE                             05300051
053100          WHEN 'Sale'                                             05310069
053100          WHEN 'SaleAdjustment'                                   05311069
053200             MOVE TC022-TRANS-AMT     TO D1-SLS-AMNT              05320051
053300             MOVE ZEROES              TO D1-REFND-AMNT            05330051
053400             COMPUTE PV-TOT-SLS-AMT = PV-TOT-SLS-AMT +            05340051
053500                                      TC022-TRANS-AMT             05350051
053600          WHEN 'Refund'                                           05360069
053600          WHEN 'RefundAdjustment'                                 05361069
053700             MOVE TC022-TRANS-AMT     TO D1-REFND-AMNT            05370051
053800             MOVE ZEROES              TO D1-SLS-AMNT              05380051
053900             COMPUTE PV-TOT-RFND-AMT = PV-TOT-RFND-AMT +          05390051
054000                                      TC022-TRANS-AMT             05400051
054100          WHEN 'PayAccount'                                       05410060
054200             MOVE TC022-TRANS-AMT     TO D1-PAYACC-AMT-VAL        05420051
054300             MOVE ZEROES              TO D1-SLS-AMNT              05430051
054400             MOVE ZEROES              TO D1-REFND-AMNT            05440051
054500             COMPUTE PV-TOT-PAYACC-AMT = PV-TOT-PAYACC-AMT +      05450051
054600                                      TC022-TRANS-AMT             05460051
054700        END-EVALUATE                                              05470051
054800                                                                  05480051
054900        PERFORM 5100-WRITE-DETAIL-RPT                             05490051
055000     END-IF.                                                      05500051
055100                                                                  05510051
055200     PERFORM 3000-READ-TRANSACTION-FILE.                          05520062
055300                                                                  05530051
055400******************************************************************05540062
055500*  3000-READ-TRANSACTION-FILE                                    *05550062
055600*  READ THE INPUT TRANSCATION FILE IN TO TCRD022 COPYBOOK LAYOUT *05560062
055700******************************************************************05570062
055800                                                                  05580062
055900 3000-READ-TRANSACTION-FILE.                                      05590062
056000                                                                  05600062
056100     READ  TRANSACTION-FILE                                       05610062
056200         INTO TC022-RECON-RECORD                                  05620062
056300         AT END                                                   05630062
056400             SET PS-END-OF-TRANS-FILE TO TRUE                     05640062
056500     END-READ.                                                    05650062
056600                                                                  05660062
056700     IF PS-NOT-END-OF-TRANS-FILE                                  05670062
056800        ADD +1 TO PV-RECORD-COUNT                                 05680062
056900     END-IF.                                                      05690062
057000                                                                  05700062
057100******************************************************************05710005
057200*  4000-GET-PARTNBR                                               05720051
057300*  SELECT PARTITION NUMBER FROM TEPPART TABLE                     05730005
057400******************************************************************05740005
057500 4000-GET-PARTNBR.                                                05750051
057600                                                                  05760005
057700     EXEC SQL                                                     05770005
057800             SELECT PARTN_NBR                                     05780005
057900             INTO :EPPART-PARTN-NBR                               05790005
058000             FROM TEPPART                                         05800005
058100             WHERE SLS_DTE        = :TC022-SLS-DATE               05810005
058200     END-EXEC.                                                    05820005
058300                                                                  05830005
058400     EVALUATE TRUE                                                05840005
058500         WHEN SQLCODE = ZERO                                      05850005
058600             MOVE EPPART-PARTN-NBR    TO TC022-PARTITION-NBR      05860051
058700         WHEN OTHER                                               05870005
058800             MOVE '4000-GET-PARTNBR              '                05880051
058900                                      TO PV-PARAGRAPH-NAME        05890051
059000             MOVE 'PROBLEM READING TEPPART TABLE '                05900047
059100                                      TO PV-OPERATION-MSG-1       05910051
059200             PERFORM 9100-DB2-ERROR                               05920005
059300     END-EVALUATE.                                                05930005
059400                                                                  05940005
063400******************************************************************06340004
063500*  4100-SELECT-TEPPAY                                             06350066
063600*  CHECK TEPPAY TABLE FOR EXISTANCE OF TRANSACTION                06360047
063700******************************************************************06370004
063800 4100-SELECT-TEPPAY.                                              06380066
063900                                                                  06390004
064000     MOVE TC022-PARTITION-NBR         TO EPPAY-PARTN-NBR.         06400052
064100     MOVE TC022-ORIG-STR-NBR          TO EPPAY-STR-NBR.           06410051
064200     MOVE TC022-RGST-ID               TO EPPAY-RGST-ID.           06420051
064300     MOVE TC022-TRN-NBR               TO EPPAY-TRN-NBR.           06430051
064400     MOVE TC022-STRT-TM               TO EPPAY-STRT-TM.           06440051
064500                                                                  06450004
064600     EXEC SQL                                                     06460004
064700             SELECT 'Y'                                           06470005
064800             INTO :PV-DATA-EXIST                                  06480005
064900             FROM TEPPAY                                          06490005
065000             WHERE PARTN_NBR      = :EPPAY-PARTN-NBR              06500004
065100               AND STR_NBR        = :EPPAY-STR-NBR                06510004
065200               AND RGST_ID        = :EPPAY-RGST-ID                06520004
065300               AND TRN_NBR        = :EPPAY-TRN-NBR                06530004
065400               AND STRT_TM        = :EPPAY-STRT-TM                06540051
065500     END-EXEC.                                                    06550004
065600                                                                  06560004
065700     EVALUATE TRUE                                                06570004
065800         WHEN SQLCODE = ZERO                                      06580004
065900         WHEN SQLCODE = -811                                      06590047
066000             CONTINUE                                             06600004
066100         WHEN SQLCODE = 100                                       06610004
066200             MOVE 'N'                 TO  PV-DATA-EXIST           06620051
050100             IF TC022-TRANS-TYPE = PC-LATE-VOID                   06621065
050300                PERFORM 4200-SELECT-TEPCRD                        06623066
050400             END-IF                                               06624065
066300         WHEN OTHER                                               06630005
066400             MOVE '4100-SELECT-TEPPAY            '                06640066
066500                                      TO PV-PARAGRAPH-NAME        06650051
066600             MOVE 'PROBLEM READING TEPPAY TABLE '                 06660047
066700                                      TO PV-OPERATION-MSG-1       06670051
066800             PERFORM 9100-DB2-ERROR                               06680004
066900     END-EVALUATE.                                                06690004
067000                                                                  06700004
059500******************************************************************06701066
059600*  4200-SELECT-TEPCRD                                             06702066
059700*  CHECK TEPCRD TABLE FOR EXISTANCE OF TRANSACTION                06703066
059800******************************************************************06704066
059900 4200-SELECT-TEPCRD.                                              06705066
060000                                                                  06706066
060100     MOVE TC022-PARTITION-NBR         TO EPCRD-PARTN-NBR.         06707066
060200     MOVE TC022-ORIG-STR-NBR          TO EPCRD-STR-NBR.           06708066
060300     MOVE TC022-RGST-ID               TO EPCRD-RGST-ID.           06709066
060400     MOVE TC022-TRN-NBR               TO EPCRD-TRN-NBR.           06709166
060500     MOVE TC022-STRT-TM               TO EPCRD-STRT-TM.           06709266
060600     MOVE TC022-TNDR-SEQ-NBR          TO EPCRD-TNDR-SEQ-NBR.      06709366
060700                                                                  06709466
060800     EXEC SQL                                                     06709566
060900             SELECT 'Y'                                           06709666
061000             INTO :PV-DATA-EXIST                                  06709766
061100             FROM TEPCRD                                          06709866
061200             WHERE PARTN_NBR      = :EPCRD-PARTN-NBR              06709966
061300               AND STR_NBR        = :EPCRD-STR-NBR                06710066
061400               AND RGST_ID        = :EPCRD-RGST-ID                06710166
061500               AND TRN_NBR        = :EPCRD-TRN-NBR                06710266
061600               AND STRT_TM        = :EPCRD-STRT-TM                06710366
061700               AND TNDR_SEQ_NBR   = :EPCRD-TNDR-SEQ-NBR           06710466
061800     END-EXEC.                                                    06710566
061900                                                                  06710666
062000     EVALUATE TRUE                                                06710766
062100         WHEN SQLCODE = ZERO                                      06710866
062200         WHEN SQLCODE = -811                                      06710966
062300             CONTINUE                                             06711066
062400         WHEN SQLCODE = 100                                       06711166
062500             MOVE 'N'                 TO  PV-DATA-EXIST           06711266
062600         WHEN OTHER                                               06711366
062700             MOVE '4200-SELECT-TEPCRD            '                06711466
062800                                      TO PV-PARAGRAPH-NAME        06711566
062900             MOVE 'PROBLEM READING TEPCRD TABLE '                 06711666
063000                                      TO PV-OPERATION-MSG-1       06711766
063100             PERFORM 9100-DB2-ERROR                               06711866
063200     END-EVALUATE.                                                06711966
063300                                                                  06712066
067100******************************************************************06713047
067200*  5000-WRITE-RPT-HEADER                                          06720051
067300*  WRITE REPORT HEADER                                            06730050
067400******************************************************************06740007
067500 5000-WRITE-RPT-HEADER.                                           06750051
067600                                                                  06760004
067700     ADD  +1                          TO PA-PAGE-CNT.             06770051
067800     MOVE 0                           TO PA-LINE-CNT.             06780058
067900     MOVE PA-PAGE-CNT                 TO DP132-PAGE-NUMBER.       06790060
068500                                                                  06850050
068600     WRITE MISSING-REPORT-RECORD  FROM                            06860004
068700              DP132-STANDRD-HEADER-132-COLS                       06870050
068800              AFTER ADVANCING PAGE.                               06880004
068900     WRITE MISSING-REPORT-RECORD  FROM H1-TITLE-LINE-1            06890004
069000              AFTER ADVANCING 2 LINES.                            06900004
069100     IF CC-PROCESS-SYSTEM = 'TC'                                  06910004
069200        MOVE SPACES                   TO H2-PAYACC-AMT            06920051
069300                                         H3-PAYACC-AMT-LN         06930051
069400     END-IF.                                                      06940005
069500     WRITE MISSING-REPORT-RECORD  FROM H2-DETAIL-HEADING          06950007
069600              AFTER ADVANCING 2 LINES.                            06960007
069700     WRITE MISSING-REPORT-RECORD  FROM H3-DETAIL-HEADING-LINE.    06970050
069800     ADD  +6                          TO PA-LINE-CNT.             06980051
069900                                                                  06990004
070000******************************************************************07000051
070100*  5100-WRITE-DETAIL-RPT                                          07010051
070200*  WRITE DETAIL RECORD IN REPORT                                  07020051
070300******************************************************************07030051
070400 5100-WRITE-DETAIL-RPT.                                           07040051
070500                                                                  07050051
070600     IF PA-LINE-CNT  > PC-LINE-LIMIT                              07060051
070700        PERFORM 5000-WRITE-RPT-HEADER                             07070051
070800     END-IF.                                                      07080051
070900                                                                  07090051
071000     WRITE MISSING-REPORT-RECORD  FROM D1-DETAIL-LINE-1           07100051
071100              AFTER ADVANCING 1 LINES.                            07110051
071200     ADD  +1                          TO PA-LINE-CNT.             07120051
071300                                                                  07130051
071400******************************************************************07140051
071500*  5200-WRITE-TOTAL-RPT                                           07150051
071600*  WRITES TOTALS OF ALL MISSED TRANSACTION AMOUNT                 07160051
071700******************************************************************07170051
071800 5200-WRITE-TOTAL-RPT.                                            07180051
071900                                                                  07190051
072000     MOVE  PV-TOT-SLS-AMT             TO T1-TOT-SLS-AMNT.         07200051
072100     MOVE  PV-TOT-RFND-AMT            TO T1-TOT-RFND-AMNT.        07210051
072200     IF CC-PROCESS-SYSTEM = 'KCC'                                 07220051
072300        MOVE  PV-TOT-PAYACC-AMT       TO T1-TOT-PYACNT-AMTVAL     07230051
072400     ELSE                                                         07240060
072500        MOVE  SPACES                  TO T1-TOT-PYACNT-AMNT       07250059
072600     END-IF.                                                      07260051
072700                                                                  07270051
072800     IF PA-LINE-CNT  > PC-LINE-LIMIT                              07280051
072900        PERFORM 5000-WRITE-RPT-HEADER                             07290051
073000     END-IF.                                                      07300051
073100     WRITE MISSING-REPORT-RECORD  FROM D2-TOTAL-HEADING           07310051
073200              AFTER ADVANCING 2 LINES.                            07320051
073300     ADD +2                           TO PA-LINE-CNT.             07330051
073400                                                                  07340051
073500******************************************************************07350051
073600*  5300-WRITE-NO-MISSING-RPT                                      07360051
073700*  WRITE NO MISSING TRANSACTION MESSAGE TO THE REPORT.           *07370051
073800******************************************************************07380005
073900 5300-WRITE-NO-MISSING-RPT.                                       07390051
074000                                                                  07400005
074100     MOVE  CC-PROCESS-SYSTEM          TO T1-TRANS-NAME1.          07410051
074200     WRITE MISSING-REPORT-RECORD  FROM NO-MISSING-RECORD          07420051
074300             AFTER ADVANCING 1 LINES.                             07430051
074400     ADD +1                           TO PA-LINE-CNT.             07440051
074500                                                                  07450005
074600******************************************************************07460047
074700*  9000-EOJ-ROUTINE                                              *07470047
074800*  CLOSE ALL FILES AND DISPLAY PROCESSING COUNTS.                *07480047
074900******************************************************************07490047
075000 9000-EOJ-ROUTINE.                                                07500047
075100                                                                  07510047
075200     CLOSE   TRANSACTION-FILE                                     07520049
075300             MISSING-REPORT.                                      07530049
075400                                                                  07540047
075700     DISPLAY 'RECORDS READ '  PV-RECORD-COUNT.                    07570047
075800     DISPLAY 'NUMBER OF MISSED RECORDS' PV-MISSING-COUNT.         07580047
075900                                                                  07590047
076000******************************************************************07600047
076100*  9100-DB2-ERROR                                                *07610047
076200*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *07620047
076300******************************************************************07630047
076400 9100-DB2-ERROR.                                                  07640047
076500     DISPLAY '** ABEND **'.                                       07650047
076600     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               07660050
076700     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             07670047
076800     DISPLAY '**  OPERATION ** = ' PV-OPERATION-MSG-1.            07680047
076900*                                                                 07690047
077000*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     07700047
077100*  THE CALLED MODULE DSNTIAR.                                     07710047
077200*                                                                 07720047
077300     COPY DPPD004.                                                07730047
077400                                                                  07740047
077500     SET AC-DB2-ERROR TO TRUE.                                    07750047
077600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07760047
077700                                                                  07770051
077800******************************************************************07780047
077900*  9999-ABEND                                                    *07790047
078000*       ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.               *07800047
078100******************************************************************07810047
078200 9999-ABEND.                                                      07820047
078300     DISPLAY '** ABEND           **'.                             07830047
078400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          07840050
078500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07850047
078600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07860047
078700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07870047
