000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKUT058.                                         00020000
000300 AUTHOR.        DENISE HAHN.                                      00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  3/26/98.                                          00050000
000600****************************************************************  00060000
000700*  THIS PROGRAM WILL UPDATE THE EXTRACT FILE CREATED BY        *  00070000
000800*  RCKUT056, WITH THE DIVISION NUMBER & NAME, AND THE BUYER    *  00080000
000900*  NUMBER & NAME FROM THE MBS TABLES.  THIS PROGRAM WILL USE   *  00090000
001000*  SUBROUTINE "DPKUT039"                                       *  00100000
001100****************************************************************  00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 INPUT-OUTPUT SECTION.                                            00130000
001400                                                                  00140000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700     SELECT EXTRACT-FILE-IN    ASSIGN TO UT-S-INP01.              00170000
001800     SELECT EXTRACT-FILE-OUT   ASSIGN TO UT-S-OUT01.              00180000
001900                                                                  00190000
002000 DATA DIVISION.                                                   00200000
002100                                                                  00210000
002200 FILE SECTION.                                                    00220000
002300*                                                                 00230000
002400 FD  EXTRACT-FILE-IN                                              00240000
002500     RECORDING MODE IS F                                          00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     RECORD CONTAINS 250                                          00270000
002800     BLOCK CONTAINS 0 RECORDS                                     00280000
002900     DATA RECORD IS EXTRACT-RECORD-IN.                            00290000
003000 01  EXTRACT-RECORD-IN           PIC X(250).                      00300000
003100*                                                                 00310000
003200 FD  EXTRACT-FILE-OUT                                             00320000
003300     RECORDING MODE IS F                                          00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     RECORD CONTAINS 250                                          00350000
003600     BLOCK CONTAINS 0 RECORDS                                     00360000
003700     DATA RECORD IS EXTRACT-RECORD-OUT.                           00370000
003800 01  EXTRACT-RECORD-OUT          PIC X(250).                      00380000
003900*                                                                 00390000
004000/                                                                 00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200                                                                  00420000
004700*                                                                 00470000
004800 01  PS-PROGRAM-SWITCHES.                                         00480000
004900     05  PS-INPUT-FILE-SW             PIC X(01)     VALUE 'N'.    00490003
005000         88  PS-EOF-INPUT-FILE                      VALUE 'Y'.    00500003
005100                                                                  00510000
005200 01  PV-PROGRAM-VARIABLES.                                        00520000
005201     05  PV-ABEND-CODE                PIC S9(04)    VALUE +0      00520103
005203                                                    COMP  SYNC.   00520304
005204     05 PV-DIVISION-NUMBER-HOLD       PIC X(02)     VALUE SPACE.  00520415
005205     05 PV-DIVISION-NAME-HOLD         PIC X(32)     VALUE SPACE.  00520503
005210     05 PV-BUYER-NUMBER-HOLD          PIC X(03)     VALUE SPACE.  00521003
005211     05 PV-BUYER-NAME-HOLD            PIC X(32)     VALUE SPACE.  00521103
005220                                                                  00522003
006300     05 PV-CURRENT-DB2-DATE-ONE       PIC  X(10).                 00630001
006400     05 PV-CURRENT-DB2-DATE           PIC  X(10).                 00640001
006500     05 PV-CURR-DATE.                                             00650002
006600         10 PV-CURRENT-DB2-CC          PIC  9(02)    VALUE 0.     00660002
006700         10 PV-CURRENT-DB2-YY          PIC  9(02)    VALUE 0.     00670002
006800         10 FILLER                     PIC  X(01)    VALUE '-'.   00680002
006900         10 PV-CURRENT-DB2-MM          PIC  9(02)    VALUE 0.     00690002
007000         10 FILLER                     PIC  X(01)    VALUE '-'.   00700002
007100         10 PV-CURRENT-DB2-DD          PIC  9(02)    VALUE 0.     00710002
007200     05 PV-CURRENT-DATE.                                          00720002
007300         10 PV-CURRENT-CC              PIC  9(02)    VALUE 0.     00730002
007400         10 PV-CURRENT-YY              PIC  9(02)    VALUE 0.     00740002
007500         10 PV-CURRENT-MM              PIC  9(02)    VALUE 0.     00750002
007600         10 PV-CURRENT-DD              PIC  9(02)    VALUE 0.     00760002
007700     05 PV-CURRENT-YYMMDD-DATE.                                   00770002
007800         10 PV-CURRENT-YYMMDD-YY       PIC  9(02)    VALUE 0.     00780002
007900         10 PV-CURRENT-YYMMDD-MM       PIC  9(02)    VALUE 0.     00790002
008000         10 PV-CURRENT-YYMMDD-DD       PIC  9(02)    VALUE 0.     00800002
013000     05  PV-INPUT-COUNT               PIC S9(09) VALUE ZERO       01300002
013100                                                 COMP SYNC.       01310002
013110     05  PV-OUTPUT-COUNT              PIC S9(09) VALUE ZERO       01311002
013120                                                 COMP SYNC.       01312002
013200     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            01320002
018600     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   01860002
018700     05  PV-ERROR-MESSAGE-1           PIC  X(60)  VALUE SPACES.   01870003
018800     05  PV-ERROR-MESSAGE-2           PIC  X(60)  VALUE SPACES.   01880003
018900     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       01890003
021000                                                                  02100000
021100 01  PC-PROGRAM-CONSTANTS.                                        02110000
021200     05 PC-PROGRAM-NAME               PIC X(08) VALUE 'RCKUT058'. 02120000
021300     05 PC-DATE-MODULE                PIC X(08) VALUE 'DPKUT500'. 02130000
023600     05  PC-MPS-PROGRAM-NAME         PIC  X(08)    VALUE          02360002
023700         'DPKUT039'.                                              02370002
023800     05  PC-CURRENT-OPERATING-COMPANY                             02380002
023900                                     PIC  X(02)    VALUE '03'.    02390002
024000     05  PC-SYSTEM-CODE              PIC  X(02)    VALUE 'MP'.    02400002
024100     05  PC-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    02410002
025200                                                                  02520000
025300                                                                  02530000
025400 01  PV-ABEND-FIELDS.                                             02540000
025500     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT058'.02550003
025600     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    02560002
025700     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    02570003
025800     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    02580003
025900     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    02590003
026000     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    02600003
026100     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    02610002
026200     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    02620002
026300     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    02630002
026400     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    02640002
026500     05  PV-DB2-TABLE-NAME            PIC  X(8)  VALUE SPACES.    02650002
026600                                                                  02660000
026700 01  WS-WORKING-STORAGE-HOLD-FIELDS.                              02670000
026800                                                                  02680002
026900     05  WS-PREVIOUS-DEPT             PIC  X(03) VALUE SPACES.    02690002
029500*                                                                 02950000
029600*                                                                 02960000
029700******************************************************************02970000
029800*  USED FOR DB2 ERROR MESSAGE BUILDING                            02980000
029900******************************************************************02990000
030000     COPY DPWS004.                                                03000017
030100                                                                  03010003
030200                                                                  03020002
030300******************************************************************03030000
030400*   DB2 SQL COMMUNICATION AREA                                    03040000
030500******************************************************************03050000
030600     EXEC SQL                                                     03060002
030700          INCLUDE SQLCA                                           03070002
030800     END-EXEC.                                                    03080002
030900                                                                  03090002
031000******************************************************************03100000
031100*   DB2 DCLGEN FOR TENTNME TABLE                                  03110000
031200******************************************************************03120000
031300*    EXEC SQL                                                     03130000
031400*         INCLUDE TENTNME                                         03140000
031500*    END-EXEC.                                                    03150000
031600*                                                                 03160000
031700*                                                                 03170000
031800*                                                                 03180000
031900***********************************************************       03190000
032000*  COPYBOOK USED BY MBS SYSTEM                            *       03200000
032100***********************************************************       03210000
032200     COPY DPWS003.                                                03220017
032300*                                                                 03230000
032400***********************************************************       03240000
032500*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       03250000
032600***********************************************************       03260000
032700     COPY RCRD035.                                                03270017
032800*                                                                 03280000
032900/                                                                 03290000
033000 PROCEDURE DIVISION.                                              03300000
033100                                                                  03310000
033200     PERFORM 1000-INITIALIZATION.                                 03320000
033300                                                                  03330000
033400     PERFORM 2000-PROCESS-EXTRACTS                                03340000
033500         UNTIL PS-EOF-INPUT-FILE.                                 03350000
033600                                                                  03360000
033700     CLOSE EXTRACT-FILE-IN                                        03370000
033800           EXTRACT-FILE-OUT.                                      03380000
033900                                                                  03390000
034000     MOVE PV-INPUT-COUNT     TO PV-DISPLAY-COUNT                  03400000
034100     DISPLAY 'NUMBER OF EXTRACT RECORDS READ    '                 03410000
034200                                  PV-DISPLAY-COUNT.               03420000
034300     MOVE PV-OUTPUT-COUNT    TO PV-DISPLAY-COUNT                  03430003
034400     DISPLAY 'NUMBER OF EXTRACT RECORDS WRITTEN '                 03440000
034500                                  PV-DISPLAY-COUNT.               03450000
034600     DISPLAY '                                      '.            03460000
034700     DISPLAY '--------------------------------------'.            03470000
034800                                                                  03480000
034900     GOBACK.                                                      03490000
035000                                                                  03500000
035100/                                                                 03510000
035200 1000-INITIALIZATION.                                             03520000
035300     MOVE '1000-INITIALIZATION     '   TO PV-ABEND-PARAGRAPH.     03530000
035400     MOVE '1000-INITIALIZATION     '   TO PV-PARAGRAPH-NAME.      03540000
035500                                                                  03550000
035600     OPEN INPUT  EXTRACT-FILE-IN                                  03560000
035700          OUTPUT EXTRACT-FILE-OUT.                                03570000
035800                                                                  03580000
035900     ACCEPT PC-SYSTEM-DATE FROM DATE.                             03590000
036000                                                                  03600000
036100     EXEC SQL                                                     03610000
036200         SELECT (CURRENT DATE - 1 DAY)                            03620000
036300               , CURRENT DATE                                     03630000
036400           INTO  :PV-CURRENT-DB2-DATE-ONE                         03640000
036500               , :PV-CURRENT-DB2-DATE                             03650000
036600           FROM  TCOCNTL                                          03660000
036700          WHERE  OPER_UNT_ID = 90                                 03670000
036800     END-EXEC.                                                    03680000
036900                                                                  03690000
037000     EVALUATE TRUE                                                03700000
037100         WHEN SQLCODE = ZERO                                      03710000
037200             MOVE PV-CURRENT-DB2-DATE    TO PV-CURR-DATE          03720000
037300             MOVE PV-CURRENT-DB2-CC      TO PV-CURRENT-CC         03730000
037400             MOVE PV-CURRENT-DB2-YY      TO PV-CURRENT-YY         03740000
037500                                            PV-CURRENT-YYMMDD-YY  03750000
037600             MOVE PV-CURRENT-DB2-MM      TO PV-CURRENT-MM         03760000
037700                                            PV-CURRENT-YYMMDD-MM  03770000
037800             MOVE PV-CURRENT-DB2-DD      TO PV-CURRENT-DD         03780000
037900                                            PV-CURRENT-YYMMDD-DD  03790000
038000         WHEN OTHER                                               03800000
038100              MOVE '1100-INITIALIZATION'      TO                  03810000
038200                   PV-ABEND-PARAGRAPH                             03820000
038300              MOVE 'SET DATE   '  TO PV-DB2-OPERATION-MESSAGE-1   03830000
038400              MOVE 'NONE   '      TO PV-DB2-TABLE-NAME            03840000
038500              PERFORM 9900-DB2-ABEND                              03850000
038600      END-EVALUATE.                                               03860000
038700                                                                  03870000
038800     DISPLAY '--------------------------------------'.            03880000
038900     DISPLAY '-        PROGRAM - RCKUT058          -'.            03890000
039000     DISPLAY '--------------------------------------'.            03900000
039100     DISPLAY '                                      '.            03910000
039200                                                                  03920000
039300     PERFORM 7000-READ-INPUT.                                     03930000
039400                                                                  03940000
039500 2000-PROCESS-EXTRACTS.                                           03950000
039510                                                                  03951010
039520     ADD  1   TO  PV-INPUT-COUNT.                                 03952010
039530                                                                  03953010
039600*-----------------------------------------------------------------03960000
039700* FOR EACH UNIQUE DEPARTMENT NUMBER RETRIEVE THE DIVISION NUMBER, 03970000
039800* DIVISION NAME, BUYERS NUMBER AND NAME FROM THE MBS SYSTEM.      03980000
039900*-----------------------------------------------------------------03990000
040000     IF  RC035-DEPT-NBR  =  WS-PREVIOUS-DEPT                      04000000
040100         NEXT SENTENCE                                            04010000
040200     ELSE                                                         04020000
040300         PERFORM 3100-GET-DIVISION-NMBR                           04030000
040400         PERFORM 3200-GET-BUYER-NMBR                              04040000
040500         MOVE  RC035-DEPT-NBR  TO  WS-PREVIOUS-DEPT               04050000
040600     END-IF.                                                      04060000
040700                                                                  04070000
040800*-----------------------------------------------------------------04080000
040900* POPULATE EXTRACT RECORD FIELDS                                  04090000
041000*-----------------------------------------------------------------04100000
041100     MOVE PV-DIVISION-NUMBER-HOLD    TO  RC035-DMM-NMBR.          04110000
041200     MOVE PV-DIVISION-NAME-HOLD      TO  RC035-DMM-NAME.          04120000
041300     MOVE PV-BUYER-NUMBER-HOLD       TO  RC035-BYR-NMBR.          04130000
041400     MOVE PV-BUYER-NAME-HOLD         TO  RC035-BYR-NAME.          04140000
041500                                                                  04150000
041600     WRITE EXTRACT-RECORD-OUT FROM RC035-RCVR-EXTRACT-RECORD.     04160000
041700                                                                  04170000
041800     ADD  1                          TO  PV-OUTPUT-COUNT.         04180005
042000                                                                  04200000
042010     PERFORM 7000-READ-INPUT.                                     04201006
042020                                                                  04202006
042100                                                                  04210000
042200 3100-GET-DIVISION-NMBR.                                          04220000
042300*-----------------------------------------------------------------04230000
042400*  GET THE DIVISION NAME AND NUMBER INFORMATION FROM THE MBS      04240000
042500*  TABLES USING SUBROUTINE 'DPKUT039'.                            04250000
042600*-----------------------------------------------------------------04260000
042700     MOVE '3100-GET-DIVISION-NMBR  '   TO PV-ABEND-PARAGRAPH.     04270000
042800     MOVE '3100-GET-DIVISION-NMBR  '   TO PV-PARAGRAPH-NAME.      04280000
042900                                                                  04290000
043000     SET DP003-DMM-LOOKUP-NAME         TO TRUE.                   04300000
043010     MOVE SPACE                        TO DP003-BYR-LOOKUP-IND.   04301009
043100     MOVE RC035-DEPT-NBR               TO DP003-DPT-INPUT.        04310002
043200     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      04320000
043300     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       04330000
043400     MOVE PC-SYSTEM-DATE               TO DP003-CURRENT-DATE      04340000
043500                                          DP003-EFF-DATE.         04350000
043510     INITIALIZE                           DP003-RETURN-MSG.       04351008
043600*                                                                 04360000
043700     CALL PC-MPS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.04370000
043800*                                                                 04380000
043900     EVALUATE TRUE                                                04390000
044000        WHEN DP003-SUCCESSFUL                                     04400000
044100           MOVE DP003-DMM-NMBR   TO PV-DIVISION-NUMBER-HOLD       04410015
044500           MOVE DP003-DMM-NAME   TO PV-DIVISION-NAME-HOLD         04450000
044600        WHEN DP003-DMM-NMBR-NOT-FOUND                             04460000
044700           INITIALIZE  PV-DIVISION-NUMBER-HOLD                    04470000
044800           INITIALIZE  PV-DIVISION-NAME-HOLD                      04480000
044810           MOVE 'DMM NMBR NOT FOUND' TO  PV-DIVISION-NAME-HOLD    04481013
044900        WHEN DP003-DMM-NAME-NOT-FOUND                             04490000
045000           INITIALIZE  PV-DIVISION-NUMBER-HOLD                    04500000
045100           INITIALIZE  PV-DIVISION-NAME-HOLD                      04510000
045110           MOVE 'DMM NAME NOT FOUND' TO  PV-DIVISION-NAME-HOLD    04511013
045200        WHEN DP003-DMM-NMBR-DB2-ERROR                             04520000
045300           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          04530000
045400           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         04540000
045500                                 TO PV-ABEND-STRUCTURE-2          04550000
045600           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          04560000
045700           MOVE DP003-SQLCA      TO SQLCA                         04570000
045800           PERFORM 9900-DB2-ABEND                                 04580000
045900        WHEN DP003-DMM-NAME-DB2-ERROR                             04590000
046000           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          04600000
046100           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         04610000
046200                                 TO PV-ABEND-STRUCTURE-2          04620000
046300           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          04630000
046400           MOVE DP003-SQLCA      TO SQLCA                         04640000
046500           PERFORM 9900-DB2-ABEND                                 04650000
046600        WHEN DP003-DMM-NMBR-MAX-RETRIES                           04660000
046700           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          04670000
046800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         04680000
046900                                 TO PV-ABEND-STRUCTURE-2          04690000
047000           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          04700000
047100           MOVE DP003-SQLCA      TO SQLCA                         04710000
047200           PERFORM 9900-DB2-ABEND                                 04720000
047300        WHEN DP003-DMM-NAME-MAX-RETRIES                           04730000
047400           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          04740000
047500           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         04750000
047600                                 TO PV-ABEND-STRUCTURE-2          04760000
047700           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          04770000
047800           MOVE DP003-SQLCA      TO SQLCA                         04780000
047900           PERFORM 9900-DB2-ABEND                                 04790000
048000        WHEN DP003-NO-INPUT-SELECTION                             04800000
048100           MOVE 'CURRENT INPUT FIELDS ARE: '                      04810000
048200                                 TO PV-ERROR-MESSAGE-1            04820000
048300           MOVE DP003-INPUT-FIELDS                                04830000
048400                                 TO PV-ERROR-MESSAGE-2            04840000
048500           PERFORM 9200-ABEND                                     04850000
048600        WHEN DP003-SYSTEM-CODE-ERROR                              04860000
048700           MOVE 'THE SYSTEM CODE IS: '                            04870000
048800                                 TO PV-ERROR-MESSAGE-1            04880000
048900           MOVE DP003-SYSTEM-CODE                                 04890000
049000                                 TO PV-ERROR-MESSAGE-2            04900000
049100           PERFORM 9200-ABEND                                     04910000
049200        WHEN DP003-CURRENT-DATE-ERROR                             04920000
049300           MOVE 'THE CURRENT DATE USED IS:'                       04930000
049400                                 TO PV-ERROR-MESSAGE-1            04940000
049500           MOVE DP003-CURRENT-DATE                                04950000
049600                                 TO PV-ERROR-MESSAGE-2            04960000
049700           PERFORM 9200-ABEND                                     04970000
049800        WHEN DP003-EFF-DATE-ERROR                                 04980000
049900           MOVE 'THE EFFECTIVE DATE USED IS:'                     04990000
050000                                 TO PV-ERROR-MESSAGE-1            05000000
050100           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            05010000
050200           PERFORM 9200-ABEND                                     05020000
050300        WHEN DP003-DPT-MUST-BE-NUMERIC                            05030000
050400           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05040000
050500                                 TO PV-ERROR-MESSAGE-1            05050000
050600           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            05060000
050700           PERFORM 9200-ABEND                                     05070000
050800        WHEN OTHER                                                05080000
050900           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '05090000
051000                                 TO PV-ERROR-MESSAGE-1            05100000
051100           MOVE DP003-INPUT-FIELDS                                05110000
051200                                 TO PV-ERROR-MESSAGE-2            05120000
051300           PERFORM 9200-ABEND                                     05130000
051400     END-EVALUATE.                                                05140000
051500/                                                                 05150000
051600 3200-GET-BUYER-NMBR.                                             05160000
051700*-----------------------------------------------------------------05170000
051800*  GET THE VENDOR NAME AND NUMBER INFORMATION FROM THE MBS        05180000
051900*  TABLES USING SUBROUTINE 'DPKUT039'.                            05190000
052000*-----------------------------------------------------------------05200000
052100     MOVE '3200-GET-BUYER-NMBR     '   TO PV-ABEND-PARAGRAPH.     05210000
052200     MOVE '3200-GET-BUYER-NMBR     '   TO PV-PARAGRAPH-NAME.      05220000
052300                                                                  05230000
052400     SET DP003-BYR-LOOKUP-NAME         TO TRUE.                   05240000
052410     MOVE SPACE                        TO DP003-DMM-LOOKUP-IND.   05241009
052500     MOVE RC035-DEPT-NBR               TO DP003-DPT-INPUT.        05250002
052600     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      05260000
052700     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       05270000
052800     MOVE PC-SYSTEM-DATE               TO DP003-CURRENT-DATE      05280000
052900                                          DP003-EFF-DATE.         05290000
052910     INITIALIZE                           DP003-RETURN-MSG.       05291008
053000*                                                                 05300000
053100     CALL PC-MPS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.05310000
053200*                                                                 05320000
053300     EVALUATE TRUE                                                05330000
053400        WHEN DP003-SUCCESSFUL                                     05340000
053700           MOVE DP003-BYR-NMBR   TO PV-BUYER-NUMBER-HOLD          05370016
053900           MOVE DP003-BYR-NAME   TO PV-BUYER-NAME-HOLD            05390011
054000        WHEN DP003-BYR-NMBR-NOT-FOUND                             05400000
054100           INITIALIZE  PV-BUYER-NUMBER-HOLD                       05410000
054200           INITIALIZE  PV-BUYER-NAME-HOLD                         05420000
054210           MOVE 'BUYER NMBR NOT FOUND' TO PV-BUYER-NAME-HOLD      05421013
054300        WHEN DP003-BYR-NAME-NOT-FOUND                             05430000
054400           INITIALIZE  PV-BUYER-NUMBER-HOLD                       05440000
054500           INITIALIZE  PV-BUYER-NAME-HOLD                         05450000
054510           MOVE 'BUYER NAME NOT FOUND' TO PV-BUYER-NAME-HOLD      05451013
054600        WHEN DP003-BYR-NMBR-DB2-ERROR                             05460000
054700           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          05470000
054800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05480000
054900                                 TO PV-ABEND-STRUCTURE-2          05490000
055000           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          05500000
055100           MOVE DP003-SQLCA      TO SQLCA                         05510000
055200           PERFORM 9900-DB2-ABEND                                 05520000
055300        WHEN DP003-BYR-NAME-DB2-ERROR                             05530000
055400           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          05540000
055500           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05550000
055600                                 TO PV-ABEND-STRUCTURE-2          05560000
055700           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          05570000
055800           MOVE DP003-SQLCA      TO SQLCA                         05580000
055900           PERFORM 9900-DB2-ABEND                                 05590000
056000        WHEN DP003-BYR-NMBR-MAX-RETRIES                           05600000
056100           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          05610000
056200           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05620000
056300                                 TO PV-ABEND-STRUCTURE-2          05630000
056400           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          05640000
056500           MOVE DP003-SQLCA      TO SQLCA                         05650000
056600           PERFORM 9900-DB2-ABEND                                 05660000
056700        WHEN DP003-BYR-NAME-MAX-RETRIES                           05670000
056800           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          05680000
056900           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05690000
057000                                 TO PV-ABEND-STRUCTURE-2          05700000
057100           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          05710000
057200           MOVE DP003-SQLCA      TO SQLCA                         05720000
057300           PERFORM 9900-DB2-ABEND                                 05730000
057400        WHEN DP003-NO-INPUT-SELECTION                             05740000
057500           MOVE 'CURRENT INPUT FIELDS ARE: '                      05750000
057600                                 TO PV-ERROR-MESSAGE-1            05760000
057700           MOVE DP003-INPUT-FIELDS                                05770000
057800                                 TO PV-ERROR-MESSAGE-2            05780000
057900           PERFORM 9200-ABEND                                     05790000
058000        WHEN DP003-SYSTEM-CODE-ERROR                              05800000
058100           MOVE 'THE SYSTEM CODE IS: '                            05810000
058200                                 TO PV-ERROR-MESSAGE-1            05820000
058300           MOVE DP003-SYSTEM-CODE                                 05830000
058400                                 TO PV-ERROR-MESSAGE-2            05840000
058500           PERFORM 9200-ABEND                                     05850000
058600        WHEN DP003-CURRENT-DATE-ERROR                             05860000
058700           MOVE 'THE CURRENT DATE USED IS:'                       05870000
058800                                 TO PV-ERROR-MESSAGE-1            05880000
058900           MOVE DP003-CURRENT-DATE                                05890000
059000                                 TO PV-ERROR-MESSAGE-2            05900000
059100           PERFORM 9200-ABEND                                     05910000
059200        WHEN DP003-EFF-DATE-ERROR                                 05920000
059300           MOVE 'THE EFFECTIVE DATE USED IS:'                     05930000
059400                                 TO PV-ERROR-MESSAGE-1            05940000
059500           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            05950000
059600           PERFORM 9200-ABEND                                     05960000
059700        WHEN DP003-DPT-MUST-BE-NUMERIC                            05970000
059800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         05980000
059900                                 TO PV-ERROR-MESSAGE-1            05990000
060000           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            06000000
060100           PERFORM 9200-ABEND                                     06010000
060200        WHEN OTHER                                                06020000
060300           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '06030000
060400                                 TO PV-ERROR-MESSAGE-1            06040000
060500           MOVE DP003-INPUT-FIELDS                                06050000
060600                                 TO PV-ERROR-MESSAGE-2            06060000
060700           PERFORM 9200-ABEND                                     06070000
060800     END-EVALUATE.                                                06080000
060900                                                                  06090000
061000                                                                  06100000
061100                                                                  06110000
061200 7000-READ-INPUT.                                                 06120000
061300                                                                  06130000
061400     MOVE '7000-READ-INPUT'   TO PV-ABEND-PARAGRAPH.              06140000
061500                                                                  06150000
061600     READ EXTRACT-FILE-IN  INTO  RC035-RCVR-EXTRACT-RECORD        06160003
061700         AT END                                                   06170000
061800             SET PS-EOF-INPUT-FILE TO TRUE.                       06180003
061900                                                                  06190000
062000*                                                                 06200000
062100 9200-ABEND.                                                      06210000
062200******************************************************************06220000
062300*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       06230000
062400******************************************************************06240000
062500     DISPLAY '***************************'.                       06250000
062600     DISPLAY '**       ABEND           **'.                       06260000
062700     DISPLAY '**  IN PROGRAM RCKUT058  **'.                       06270000
062800     DISPLAY '***************************'.                       06280000
062900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06290000
063000     DISPLAY '**   ERROR         ** = ' DP003-RETURN-MSG.         06300000
063100     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       06310000
063200     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       06320000
063210     DISPLAY '**  RC035-DEPT-NBR ** = ' RC035-DEPT-NBR.           06321007
063300                                                                  06330000
063400     MOVE +4014                  TO PV-ABEND-CODE.                06340000
063500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06350000
063600*                                                                 06360000
063700 9900-DB2-ABEND.                                                  06370000
063800                                                                  06380000
063900     MOVE SQLCODE TO PV-SQLCODE.                                  06390000
064000     DISPLAY '*** DB2 ERROR '.                                    06400000
064100     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       06410000
064200     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06420000
064300     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06430000
064400     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06440000
064500     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       06450000
064600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       06460000
064700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       06470000
064800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06480000
064900                                                                  06490000
065000     IF PV-ABEND-STRUCTURE-2 > SPACES                             06500000
065100         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          06510000
065200     END-IF.                                                      06520000
065300                                                                  06530000
065400                                                                  06540000
065500     COPY DPPD004.                                                06550017
065600                                                                  06560000
065700                                                                  06570000
065800     MOVE +4013                  TO PV-ABEND-CODE.                06580000
065900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06590000
