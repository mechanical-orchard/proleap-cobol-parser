000100******************************************************************00010058
000200 IDENTIFICATION DIVISION.                                         00020058
000300******************************************************************00030058
000400                                                                  00040058
000500 PROGRAM-ID.   PCKUT109.                                          00050058
000600 AUTHOR.       SUBASH T.                                          00060058
000700 INSTALLATION. KOHLS DEPARTMENT STORES.           ¦ ¦    ¦  ¦ ¦   00070058
000800 DATE-WRITTEN. AUGUST, 2013.                    ¦¦¦¦¦   ¦¦¦¦ ¦¦¦¦ 00080058
000900 DATE-COMPILED.                                 ¦     ¦  ¦  ¦ ¦   00090058
001000                                               ¦       ¦ ¦¦¦¦ ¦¦¦¦00100058
001100******************************************************************00110058
001200* THIS PROGRAM WILL EXECUTE THE PO-SET QUERY FOR THE SET CODE    *00120058
001300* AND YEAR PASSED IN SYSIN AND WRITES THE EXTRACT RECORD         *00130058
001400******************************************************************00140058
001500 ENVIRONMENT DIVISION.                                            00150058
001600******************************************************************00160058
001700                                                                  00170058
001800 CONFIGURATION SECTION.                                           00180058
001900                                                                  00190058
002000 SOURCE-COMPUTER.        IBM-3090.                                00200058
002100 OBJECT-COMPUTER.        IBM-3090.                                00210058
002200                                                                  00220058
002300 INPUT-OUTPUT SECTION.                                            00230058
002400                                                                  00240058
002500 FILE-CONTROL.                                                    00250058
002600                                                                  00260058
002700     SELECT SET-DAT-EXT                                           00270058
002800         ASSIGN TO OUT01.                                         00280058
002900                                                                  00290058
003000     SELECT TK-SET-DET                                            00300058
003100         ASSIGN TO OUT02.                                         00310058
003200                                                                  00320058
003300******************************************************************00330058
003400 DATA DIVISION.                                                   00340058
003500******************************************************************00350058
003600                                                                  00360058
003700 FILE SECTION.                                                    00370058
003800                                                                  00380058
003900 FD  SET-DAT-EXT                                                  00390058
004000     RECORDING MODE IS F                                          00400058
004100     LABEL RECORDS ARE STANDARD                                   00410058
004200     BLOCK CONTAINS 0 RECORDS.                                    00420058
004300                                                                  00430058
004400 01  SET-DAT-EXT-RECORD            PIC  X(200).                   00440058
004500                                                                  00450058
004600 FD  TK-SET-DET                                                   00460058
004700     RECORDING MODE IS F                                          00470058
004800     LABEL RECORDS ARE STANDARD                                   00480058
004900     BLOCK CONTAINS 0 RECORDS.                                    00490058
005000                                                                  00500058
005100 01  TK-SET-DET-RECORD             PIC  X(30).                    00510058
005200                                                                  00520058
005300******************************************************************00530058
005400 WORKING-STORAGE SECTION.                                         00540058
005500******************************************************************00550058
005600 01  PA-PROGRAM-ACCUMULATORS.                                     00560058
005700     05  PA-TOTALS.                                               00570058
005800         10 PA-INPUT-COUNT         PIC S9(13) VALUE +0 COMP-3.    00580058
005900         10 PA-OUT01-COUNT         PIC S9(13) VALUE +0 COMP-3.    00590058
006000         10 PA-OUT02-COUNT         PIC S9(13) VALUE +0 COMP-3.    00600058
006100                                                                  00610058
006200 01 PV-PROGRAM-VARIABLES.                                         00620058
006300     05  PV-INPUT-COUNT            PIC Z(12)9.                    00630058
006400     05  PV-OUTPUT-COUNT           PIC Z(12)9.                    00640058
006500     05  PV-ABEND-PARAGRAPH        PIC X(30).                     00650058
006600     05  PV-SQLCODE                PIC Z(08)9-.                   00660058
006700     05  WS-REC-TYP                PIC X(01).                     00670058
006800     05  WS-B-TYP-PO-NUMBER        PIC S9(9) COMP.                00680058
006900     05  WS-TYP-B-QTY              PIC S9(9) COMP.                00690058
007000     05  WS-M-TYP-PO-NUMBER        PIC S9(9) COMP.                00700058
007100     05  WS-PREPK-TYP-CDE          PIC X(01).                     00710058
007200     05  WS-TYP-M-QTY              PIC S9(9) COMP.                00720058
007300     05  WS-P2L-AND-XDOC-QTY       PIC S9(09).                    00730058
007400     05  WS-P2L-QTY                PIC S9(09).                    00740058
007500     05  WS-XDOC-QTY               PIC S9(09).                    00750058
007600     05  WS-TOT-QTY                PIC S9(09).                    00760058
007700                                                                  00770058
007800     COPY PCRD074.                                                00780058
007900     COPY PCRD075.                                                00790058
008000                                                                  00800058
008100 01 WS-SET-CDE-SYSIN-REC.                                         00810058
008200     05  WS-TK-YEAR.                                              00820058
008300         10  WS-TK-ID              PIC X(7).                      00830058
008400         10  WS-SET-CDE-YEAR       PIC X(4).                      00840058
008500     05  WS-SET-CDE-ALL            PIC X(50).                     00850058
008600     05  WS-SET-CDE-TABLE REDEFINES WS-SET-CDE-ALL.               00860058
008700         10  WS-SET-CDE-TBL        PIC X(5) OCCURS 10 TIMES       00870058
008800                                       INDEXED BY SETCDE-IND.     00880058
008900     05  FILLER                    PIC X(19).                     00890058
009000                                                                  00900058
009100 01  PS-PROGRAM-SWITCHES.                                         00910058
009200     05  PS-END-OF-DB-SW           PIC X(01)  VALUE SPACE.        00920058
009300         88  PS-NO-ITEMS-LEFT-ON-DB           VALUE 'Y'.          00930058
009400         88  PS-ITEMS-LEFT-ON-DB              VALUE 'N'.          00940058
009500                                                                  00950058
009600     05  PS-SET-CDE-DATA-SW        PIC X(01)  VALUE SPACE.        00960058
009700         88  PS-NO-SET-CDE-DATA               VALUE 'N'.          00970058
009800         88  PS-YES-SET-CDE-DATA              VALUE 'Y'.          00980058
009900                                                                  00990058
010000     05  PS-TYP-B-CURSOR-SW        PIC X(01)  VALUE SPACE.        01000058
010100         88  PS-END-OF-TYP-B-CURSOR           VALUE 'Y'.          01010058
010200         88  PS-NOT-END-OF-TYP-B-CURSOR       VALUE 'N'.          01020058
010300                                                                  01030058
010400     05  PS-TYP-M-CURSOR-SW        PIC X(01)  VALUE SPACE.        01040058
010500         88  PS-END-OF-TYP-M-CURSOR           VALUE 'Y'.          01050058
010600         88  PS-NOT-END-OF-TYP-M-CURSOR       VALUE 'N'.          01060058
010700                                                                  01070058
010800 01  ABEND-CODE                    PIC S9(04)  COMP VALUE 0.      01080058
010900                                                                  01090058
011000******************************************************************01100058
011100*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                     *01110058
011200******************************************************************01120058
011300     COPY DPWS004.                                                01130058
011400                                                                  01140058
011500 01 PC-PROGRAM-CONSTANT.                                          01150058
011600     05  PC-PGM-NAME               PIC X(08) VALUE 'PCKUT109'.    01160058
011700******************************************************************01170058
011800*  COMMUNICATIONS AREA FOR DB2 *                                  01180058
011900******************************************************************01190058
012000     EXEC SQL                                                     01200058
012100          INCLUDE SQLCA                                           01210058
012200     END-EXEC.                                                    01220058
012300                                                                  01230058
012400******************************************************************01240058
012500*    DB2 AREA FOR PURCHASE ORDER MASTER                          *01250058
012600******************************************************************01260058
012700     EXEC SQL                                                     01270058
012800          INCLUDE TPURCHS                                         01280058
012900     END-EXEC.                                                    01290058
013000                                                                  01300058
013100******************************************************************01310058
013200*    DB2 AREA FOR PLANNED SHIPMENT TABLE                         *01320058
013300******************************************************************01330058
013400     EXEC SQL                                                     01340058
013500          INCLUDE TPLNSHP                                         01350058
013600     END-EXEC.                                                    01360058
013700                                                                  01370058
013800******************************************************************01380058
013900*    DB2 AREA FOR ENTERPRISE NAME TABLE                          *01390058
014000******************************************************************01400058
014100     EXEC SQL                                                     01410058
014200          INCLUDE TENTNME                                         01420058
014300     END-EXEC.                                                    01430058
014400                                                                  01440058
014500******************************************************************01450058
014600*    DB2 AREA FOR PO AGREEMENT TABLE                             *01460058
014700******************************************************************01470058
014800     EXEC SQL                                                     01480058
014900          INCLUDE TPOAGMT                                         01490058
015000     END-EXEC.                                                    01500058
015100                                                                  01510058
015200******************************************************************01520058
015300*    DB2 AREA FOR SEASONAL SET MASTER                            *01530058
015400******************************************************************01540058
015500     EXEC SQL                                                     01550058
015600          INCLUDE TSEASET                                         01560058
015700     END-EXEC.                                                    01570058
015800                                                                  01580058
015900******************************************************************01590058
016000*    DB2 AREA FOR PURCHASE ORDER ITEM                            *01600058
016100******************************************************************01610058
016200     EXEC SQL                                                     01620058
016300          INCLUDE TPURITM                                         01630058
016400     END-EXEC.                                                    01640058
016500                                                                  01650058
016600******************************************************************01660058
016700*    DB2 AREA FOR PURCHASE ORDER PREPACK                         *01670058
016800******************************************************************01680058
016900     EXEC SQL                                                     01690058
017000          INCLUDE TPOPRPK                                         01700058
017100     END-EXEC.                                                    01710058
017200                                                                  01720058
017300******************************************************************01730058
017400*    MAIN PO-SET LIST CURSOR.                                    *01740058
017500******************************************************************01750058
017600                                                                  01760058
017700     EXEC SQL                                                     01770058
017800        DECLARE PO_SET_CUR CURSOR                                 01780058
017900          FOR SELECT DISTINCT                                     01790058
018000                PART1.PO_NBR                                      01800058
018100               ,PART1.ENT_NAME_DESC                               01810058
018200               ,PART1.PO_TYP_CDE                                  01820058
018300               ,PART1.DEPT_NBR                                    01830058
018400               ,PART1.DONT_SHIP_BEF_DTE                           01840058
018500               ,PART1.CAN_IFNOT_SHIP_DTE                          01850058
018510               ,PART1.EXT_CAN_DTE                                 01851059
018600               ,PART1.OTB_PER_NBR                                 01860058
018700               ,PART1.PKGNG_CDE                                   01870058
018800               ,PART1.NEW_STR_PO_IND                              01880058
018900               ,PART1.TOT_UNT_QTY                                 01890058
019000               ,(CASE WHEN CHAR(PART2.AGRMT_TYP_ID) = '4'         01900058
019100                 THEN 'Y'                                         01910058
019200                 ELSE 'N' END)                                    01920058
019300               ,PART1.SEASET_SHRT_NM                              01930058
019400          FROM                                                    01940058
019500              (SELECT DISTINCT                                    01950058
019600                      A.PO_NBR                                    01960058
019700                     ,C.ENT_NAME_DESC                             01970058
019800                     ,A.PO_TYP_CDE                                01980058
019900                     ,A.DEPT_NBR                                  01990058
020000                     ,B.DONT_SHIP_BEF_DTE                         02000058
020100                     ,B.CAN_IFNOT_SHIP_DTE                        02010058
020110                     ,B.EXT_CAN_DTE                               02011059
020200                     ,A.OTB_PER_NBR                               02020058
020300                     ,A.PKGNG_CDE                                 02030058
020400                     ,A.NEW_STR_PO_IND                            02040058
020500                     ,A.TOT_UNT_QTY                               02050058
020600                     ,A.SEASET_SHRT_NM                            02060058
020700                FROM  TPURCHS A                                   02070058
020800                     ,TPLNSHP B                                   02080058
020900                     ,TENTNME C                                   02090058
021000                WHERE A.SEASET_YR = :PC075-SET-CDE-YEAR           02100058
021100                  AND A.SEASET_SHRT_NM = :PC075-SET-CDE           02110058
021200                  AND A.VER_STATUS_CDE = 'A'                      02120058
021300                  AND B.PO_NBR = A.PO_NBR                         02130058
021400                  AND B.VER_STATUS_CDE = 'A'                      02140058
021500                  AND C.ENT_ID = A.ENT_ID                         02150058
021600                  AND C.TYPE_CDE = '01')                          02160058
021700          AS PART1                                                02170058
021800          LEFT OUTER JOIN                                         02180058
021900              (SELECT E.PO_NBR                                    02190058
022000                     ,E.AGRMT_TYP_ID                              02200058
022100               FROM   TPOAGMT E                                   02210058
022200               WHERE  E.AGRMT_TYP_ID = '4'                        02220058
022300                 AND  E.TYP_CDE = 1                               02230058
022400                 AND  E.VER_STATUS_CDE = 'A')                     02240058
022500          AS PART2                                                02250058
022600          ON PART1.PO_NBR = PART2.PO_NBR                          02260058
022700          ORDER BY  12,1                                          02270058
022800     END-EXEC.                                                    02280058
022900                                                                  02290058
023000******************************************************************02300058
023100*    PKGNG TYP B CURSOR                                           02310058
023200******************************************************************02320058
023300                                                                  02330058
023400     EXEC SQL                                                     02340058
023500        DECLARE TYP_B_CUR CURSOR                                  02350058
023600          FOR SELECT 'A', PO_NBR , SUM(UNT_QTY)                   02360058
023700              FROM TPURITM                                        02370058
023800              WHERE PO_NBR = : PC074-PO-NBR                       02380058
023900                AND VER_STATUS_CDE = 'A'                          02390058
024000                AND UNT_QTY > 0                                   02400058
024100                AND INNR_PK_QTY = OUTR_PK_QTY                     02410058
024200              GROUP BY PO_NBR                                     02420058
024300              UNION ALL                                           02430058
024400              SELECT 'B' , PO_NBR , SUM(UNT_QTY)                  02440058
024500              FROM TPURITM                                        02450058
024600              WHERE PO_NBR = : PC074-PO-NBR                       02460058
024700                AND VER_STATUS_CDE = 'A'                          02470058
024800                AND UNT_QTY > 0                                   02480058
024900                AND NOT INNR_PK_QTY = OUTR_PK_QTY                 02490058
025000              GROUP BY PO_NBR                                     02500058
025100     END-EXEC.                                                    02510058
025200                                                                  02520058
025300******************************************************************02530058
025400*    PKGNG TYP M CURSOR                                           02540058
025500******************************************************************02550058
025600                                                                  02560058
025700     EXEC SQL                                                     02570058
025800        DECLARE TYP_M_CUR CURSOR                                  02580058
025900          FOR SELECT A.PO_NBR, B.PREPK_TYP_CDE , SUM(A.UNT_QTY)   02590058
026000           FROM TPURITM A                                         02600058
026100              , TPOPRPK B                                         02610058
026200          WHERE A. PO_NBR = : PC074-PO-NBR                        02620058
026300            AND B.PO_NBR = A.PO_NBR                               02630058
026400            AND B.PO_PREPK_ID = A.PO_PREPK_ID                     02640058
026500            AND A.UNT_QTY > 0                                     02650058
026600            AND A.VER_STATUS_CDE = 'A'                            02660058
026700          GROUP BY A.PO_NBR, B.PREPK_TYP_CDE                      02670058
026800     END-EXEC.                                                    02680058
026900                                                                  02690058
027000 LINKAGE SECTION.                                                 02700058
027100 PROCEDURE DIVISION.                                              02710058
027200******************************************************************02720058
027300*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *02730058
027400******************************************************************02740058
027500 0000-PROGRAM-MAINLINE.                                           02750058
027600                                                                  02760058
027700     PERFORM 1000-INITIALIZE.                                     02770058
027800     PERFORM 2000-MAIN-PROCESS UNTIL SETCDE-IND  > 10             02780058
027900                         OR WS-SET-CDE-TBL(SETCDE-IND) = SPACES   02790058
028000     PERFORM 9000-EOJ-ROUTINE.                                    02800058
028100                                                                  02810058
028200     STOP RUN.                                                    02820058
028300                                                                  02830058
028400******************************************************************02840058
028500*  OPENS OUTPUT FILES AND PERFORMS OTHER BEGINNING OF JOB        *02850058
028600*                  PROCESSES.                                    *02860058
028700******************************************************************02870058
028800 1000-INITIALIZE.                                                 02880058
028900                                                                  02890058
029000     OPEN OUTPUT SET-DAT-EXT                                      02900058
029100                 TK-SET-DET.                                      02910058
029200     INITIALIZE PV-PROGRAM-VARIABLES                              02920058
029300                PA-PROGRAM-ACCUMULATORS                           02930058
029400                PS-PROGRAM-SWITCHES                               02940058
029500                PC074-SET-CDE-EXT-REC                             02950058
029600                PC075-SET-CDE-DET-REC                             02960058
029700                PC075-SET-CDE-TK-YEAR-REC                         02970058
029800                SET-DAT-EXT-RECORD                                02980058
029900                TK-SET-DET-RECORD.                                02990058
030000     DISPLAY 'START OF PROGRAM : ' PC-PGM-NAME.                   03000058
030100     ACCEPT WS-SET-CDE-SYSIN-REC FROM SYSIN.                      03010058
030200     MOVE WS-TK-ID                   TO PC075-TK-ID.              03020058
030300     MOVE WS-SET-CDE-YEAR            TO PC075-SET-CDE-YEAR.       03030058
030400     PERFORM 7000-WRITE-TK-YEAR-REC.                              03040058
030500     SET SETCDE-IND                  TO 1.                        03050058
030600                                                                  03060058
030700******************************************************************03070058
030800* MAIN PROCESS                                                   *03080058
030900******************************************************************03090058
031000 2000-MAIN-PROCESS.                                               03100058
031100                                                                  03110058
031200     MOVE WS-SET-CDE-TBL(SETCDE-IND) TO PC075-SET-CDE.            03120058
031300     SET PS-NO-SET-CDE-DATA          TO TRUE.                     03130058
031400     PERFORM 3000-OPEN-PO-SET-CURSOR.                             03140058
031500     PERFORM 3100-FETCH-PO-SET-CURSOR UNTIL                       03150058
031600             PS-NO-ITEMS-LEFT-ON-DB.                              03160058
031700     PERFORM 3200-CLOSE-PO-SET-CURSOR.                            03170058
031800     PERFORM 3300-GET-SET-CDE-NAME.                               03180058
031900     SET SETCDE-IND UP BY 1.                                      03190058
032000                                                                  03200058
032100******************************************************************03210058
032200*   OPEN PO-SET CURSOR                                           *03220058
032300******************************************************************03230058
032400 3000-OPEN-PO-SET-CURSOR.                                         03240058
032500                                                                  03250058
032600            EXEC SQL                                              03260058
032700               OPEN PO_SET_CUR                                    03270058
032800            END-EXEC.                                             03280058
032900                                                                  03290058
033000         EVALUATE TRUE                                            03300058
033100             WHEN SQLCODE = ZERO                                  03310058
033200                 CONTINUE                                         03320058
033300             WHEN OTHER                                           03330058
033400                 MOVE '3000-OPEN-PO-SET-CURSOR'                   03340058
033500                                     TO PV-ABEND-PARAGRAPH        03350058
033600                 PERFORM 9100-SQL-ABEND                           03360058
033700         END-EVALUATE.                                            03370058
033800                                                                  03380058
033900******************************************************************03390058
034000*    FETCH THE PO-SET CURSOR.                                    *03400058
034100******************************************************************03410058
034200 3100-FETCH-PO-SET-CURSOR.                                        03420058
034300                                                                  03430058
034400     EXEC SQL                                                     03440058
034500         FETCH PO_SET_CUR                                         03450058
034600         INTO  :PC074-PO-NBR                                      03460058
034700             , :PC074-ENT-NAME-DESC                               03470058
034800             , :PC074-PO-TYP-CDE                                  03480058
034900             , :PC074-DEPT-NBR                                    03490058
035000             , :PC074-DONT-SHIP-BEF-DTE                           03500058
035100             , :PC074-CAN-IFNOT-SHIP-DTE                          03510058
035110             , :PC074-EXT-CAN-DTE                                 03511059
035200             , :PC074-OTB-PER-NBR                                 03520058
035300             , :PC074-PKGNG-CDE                                   03530058
035400             , :PC074-NEW-STR-PO-IND                              03540058
035500             , :PC074-TOT-UNT-QTY                                 03550058
035600             , :PC074-AGRMT-TYP-ID                                03560058
035700             , :PC074-SEASET-SHRT-NM                              03570058
035800     END-EXEC.                                                    03580058
035900                                                                  03590058
036000     EVALUATE TRUE                                                03600058
036100         WHEN SQLCODE = ZERO                                      03610058
036200              PERFORM 8000-CALC-P2L-XDOCK                         03620058
036300              PERFORM 7200-WRITE-SET-EXT-REC                      03630058
036400              SET PS-YES-SET-CDE-DATA                             03640058
036500                                     TO TRUE                      03650058
036600              ADD 1                  TO PA-OUT01-COUNT            03660058
036700         WHEN SQLCODE = +100                                      03670058
036800              SET PS-NO-ITEMS-LEFT-ON-DB                          03680058
036900                                     TO TRUE                      03690058
037000              IF PS-NO-SET-CDE-DATA                               03700058
037100                 MOVE PC075-SET-CDE     TO PC074-SEASET-SHRT-NM   03710058
037200                 PERFORM 7200-WRITE-SET-EXT-REC                   03720058
037300              END-IF                                              03730058
037400         WHEN OTHER                                               03740058
037500                 MOVE '3100-FETCH-PO-SET-CURSOR'                  03750058
037600                                     TO PV-ABEND-PARAGRAPH        03760058
037700              PERFORM 9100-SQL-ABEND                              03770058
037800     END-EVALUATE.                                                03780058
037900                                                                  03790058
038000******************************************************************03800058
038100*   CLOSE PO-SET CURSOR.                                         *03810058
038200******************************************************************03820058
038300 3200-CLOSE-PO-SET-CURSOR.                                        03830058
038400                                                                  03840058
038500     EXEC SQL                                                     03850058
038600        CLOSE PO_SET_CUR                                          03860058
038700     END-EXEC.                                                    03870058
038800                                                                  03880058
038900     EVALUATE TRUE                                                03890058
039000         WHEN SQLCODE = ZERO                                      03900058
039100              CONTINUE                                            03910058
039200         WHEN OTHER                                               03920058
039300              MOVE '3200-CLOSE-PO-SET-CURSOR'                     03930058
039400                                     TO PV-ABEND-PARAGRAPH        03940058
039500              PERFORM 9100-SQL-ABEND                              03950058
039600     END-EVALUATE.                                                03960058
039700                                                                  03970058
039800     SET PS-ITEMS-LEFT-ON-DB         TO TRUE.                     03980058
039900                                                                  03990058
040000******************************************************************04000058
040100*   GETS THE SET NAME FOR FOR THE GIVEN SET CODE AND YEAR        *04010058
040200******************************************************************04020058
040300 3300-GET-SET-CDE-NAME.                                           04030058
040400                                                                  04040058
040500     EXEC SQL                                                     04050058
040600        SELECT A.SEASET_NM                                        04060058
040700        INTO :PC075-SET-CDE-NAME                                  04070058
040800        FROM TSEASET A                                            04080058
040900       WHERE A.SEASET_YR = :PC075-SET-CDE-YEAR                    04090058
041000         AND A.SEASET_SHRT_NM = :PC075-SET-CDE                    04100058
041100     END-EXEC.                                                    04110058
041200                                                                  04120058
041300     EVALUATE TRUE                                                04130058
041400         WHEN SQLCODE = ZERO                                      04140058
041500         WHEN SQLCODE = +100                                      04150058
041600              PERFORM 7100-WRITE-SET-DET-REC                      04160058
041700         WHEN OTHER                                               04170058
041800              MOVE '3300-GET-SET-CDE-NAME'                        04180058
041900                                     TO PV-ABEND-PARAGRAPH        04190058
042000              PERFORM 9100-SQL-ABEND                              04200058
042100     END-EVALUATE.                                                04210058
042200                                                                  04220058
042300     ADD 1                           TO PA-INPUT-COUNT.           04230058
042400                                                                  04240058
042500******************************************************************04250058
042600* WRITES THE TK ID AND SET YEAR IN THE OUT02 FILE                *04260058
042700******************************************************************04270058
042800 7000-WRITE-TK-YEAR-REC.                                          04280058
042900                                                                  04290058
043000     WRITE TK-SET-DET-RECORD FROM PC075-SET-CDE-TK-YEAR-REC.      04300058
043100     INITIALIZE TK-SET-DET-RECORD.                                04310058
043200     ADD 1                           TO PA-OUT02-COUNT.           04320058
043300                                                                  04330058
043400******************************************************************04340058
043500* WRITES THE SET CODE AND SED CODE NAME IN THE OUT02 FILE        *04350058
043600******************************************************************04360058
043700 7100-WRITE-SET-DET-REC.                                          04370058
043800                                                                  04380058
043900     WRITE TK-SET-DET-RECORD FROM PC075-SET-CDE-DET-REC.          04390058
044000     ADD 1                           TO PA-OUT02-COUNT.           04400058
044100     INITIALIZE TK-SET-DET-RECORD                                 04410058
044200                PC075-SET-CDE-DET-REC.                            04420058
044300                                                                  04430058
044400******************************************************************04440058
044500* WRITES PO-SET EXTRACT RECORD TO  OUT01 FILE                    *04450058
044600******************************************************************04460058
044700 7200-WRITE-SET-EXT-REC.                                          04470058
044800                                                                  04480058
044900     MOVE +0                      TO WS-P2L-AND-XDOC-QTY          04490058
045000                                     WS-P2L-QTY                   04500058
045100                                     WS-XDOC-QTY                  04510058
045200                                     WS-TOT-QTY.                  04520058
045300     MOVE PC074-TOT-UNT-QTY       TO WS-TOT-QTY.                  04530058
045400     MOVE PC074-PACK-TO-LIGHT-QTY TO WS-P2L-QTY.                  04540058
045500     MOVE PC074-CROSS-DOCK-QTY    TO WS-XDOC-QTY.                 04550058
045600                                                                  04560058
045700     COMPUTE WS-P2L-AND-XDOC-QTY = (WS-P2L-QTY + WS-XDOC-QTY).    04570058
045800                                                                  04580058
045900     IF WS-TOT-QTY NOT EQUAL WS-P2L-AND-XDOC-QTY                  04590058
046000         DISPLAY 'QUANTITY MISMATCH FOR PO - ' PC074-PO-NBR       04600058
046100         DISPLAY 'TOTAL UNIT QTY = ' WS-TOT-QTY                   04610058
046200         DISPLAY 'PACK TO LIGHT QTY = ' WS-P2L-QTY                04620058
046300         DISPLAY 'CROSS DOCK QTY = ' WS-XDOC-QTY                  04630058
046400         MOVE WS-P2L-AND-XDOC-QTY TO PC074-TOT-UNT-QTY            04640058
046500     END-IF.                                                      04650058
046600                                                                  04660058
046700     WRITE SET-DAT-EXT-RECORD FROM PC074-SET-CDE-EXT-REC.         04670058
046800     INITIALIZE PC074-SET-CDE-EXT-REC                             04680058
046900                SET-DAT-EXT-RECORD.                               04690058
047000                                                                  04700058
047100******************************************************************04710058
047200* DETERMINES PACK TO LIGHT AND CROSS DOCK QTYS FOR PKGNG TYPES    04720058
047300******************************************************************04730058
047400 8000-CALC-P2L-XDOCK.                                             04740058
047500     SET PS-NOT-END-OF-TYP-B-CURSOR  TO TRUE.                     04750058
047600     SET PS-NOT-END-OF-TYP-M-CURSOR  TO TRUE.                     04760058
047700                                                                  04770058
047800     IF PC074-PKGNG-CDE = 'I'                                     04780058
047900       MOVE PC074-TOT-UNT-QTY TO PC074-PACK-TO-LIGHT-QTY          04790058
048000     ELSE                                                         04800058
048100     IF PC074-PKGNG-CDE = 'C' OR ' '                              04810058
048200       MOVE PC074-TOT-UNT-QTY TO PC074-CROSS-DOCK-QTY             04820058
048300     ELSE                                                         04830058
048400     IF PC074-PKGNG-CDE = 'B'                                     04840058
048500         PERFORM 8100-OPEN-TYP-B-CURSOR                           04850058
048600         PERFORM 8200-FETCH-TYP-B-CURSOR UNTIL                    04860058
048700                 PS-END-OF-TYP-B-CURSOR                           04870058
048800         PERFORM 8300-CLOSE-TYP-B-CURSOR                          04880058
048900     ELSE                                                         04890058
049000     IF PC074-PKGNG-CDE = 'M'                                     04900058
049100         PERFORM 8400-OPEN-TYP-M-CURSOR                           04910058
049200         PERFORM 8500-FETCH-TYP-M-CURSOR UNTIL                    04920058
049300                 PS-END-OF-TYP-M-CURSOR                           04930058
049400         PERFORM 8600-CLOSE-TYP-M-CURSOR                          04940058
049500     END-IF.                                                      04950058
049600                                                                  04960058
049700******************************************************************04970058
049800*   OPEN TYP B  CURSOR                                           *04980058
049900******************************************************************04990058
050000 8100-OPEN-TYP-B-CURSOR.                                          05000058
050100                                                                  05010058
050200        EXEC SQL                                                  05020058
050300               OPEN TYP_B_CUR                                     05030058
050400        END-EXEC.                                                 05040058
050500                                                                  05050058
050600         EVALUATE TRUE                                            05060058
050700             WHEN SQLCODE = ZERO                                  05070058
050800                 CONTINUE                                         05080058
050900             WHEN OTHER                                           05090058
051000                 MOVE '8100-OPEN-TYP-B-CURSOR'                    05100058
051100                                     TO PV-ABEND-PARAGRAPH        05110058
051200                 PERFORM 9100-SQL-ABEND                           05120058
051300         END-EVALUATE.                                            05130058
051400                                                                  05140058
051500******************************************************************05150058
051600*    FETCH TYP B CURSOR                                           05160058
051700******************************************************************05170058
051800 8200-FETCH-TYP-B-CURSOR.                                         05180058
051900                                                                  05190058
052000     EXEC SQL                                                     05200058
052100         FETCH TYP_B_CUR                                          05210058
052200         INTO  :WS-REC-TYP                                        05220058
052300             , :WS-B-TYP-PO-NUMBER                                05230058
052400             , :WS-TYP-B-QTY                                      05240058
052500     END-EXEC.                                                    05250058
052600                                                                  05260058
052700     EVALUATE TRUE                                                05270058
052800         WHEN SQLCODE = ZERO                                      05280058
052900              IF WS-REC-TYP = 'A'                                 05290058
053000                  MOVE WS-TYP-B-QTY TO PC074-CROSS-DOCK-QTY       05300058
053100              ELSE                                                05310058
053200                  MOVE WS-TYP-B-QTY TO PC074-PACK-TO-LIGHT-QTY    05320058
053300              END-IF                                              05330058
053400         WHEN SQLCODE = +100                                      05340058
053500              SET PS-END-OF-TYP-B-CURSOR                          05350058
053600                                     TO TRUE                      05360058
053700         WHEN OTHER                                               05370058
053800                 MOVE '8200-FETCH-TYP-B-CURSOR'                   05380058
053900                                     TO PV-ABEND-PARAGRAPH        05390058
054000              PERFORM 9100-SQL-ABEND                              05400058
054100     END-EVALUATE.                                                05410058
054200                                                                  05420058
054300******************************************************************05430058
054400*   CLOSE PO-SET CURSOR.                                         *05440058
054500******************************************************************05450058
054600 8300-CLOSE-TYP-B-CURSOR.                                         05460058
054700                                                                  05470058
054800     EXEC SQL                                                     05480058
054900        CLOSE TYP_B_CUR                                           05490058
055000     END-EXEC.                                                    05500058
055100                                                                  05510058
055200     EVALUATE TRUE                                                05520058
055300         WHEN SQLCODE = ZERO                                      05530058
055400              CONTINUE                                            05540058
055500         WHEN OTHER                                               05550058
055600              MOVE '8300-CLOSE-TYP-B-CURSOR'                      05560058
055700                                     TO PV-ABEND-PARAGRAPH        05570058
055800              PERFORM 9100-SQL-ABEND                              05580058
055900     END-EVALUATE.                                                05590058
056000                                                                  05600058
056100******************************************************************05610058
056200*   OPEN TYP M  CURSOR                                           *05620058
056300******************************************************************05630058
056400 8400-OPEN-TYP-M-CURSOR.                                          05640058
056500                                                                  05650058
056600        EXEC SQL                                                  05660058
056700               OPEN TYP_M_CUR                                     05670058
056800        END-EXEC.                                                 05680058
056900                                                                  05690058
057000         EVALUATE TRUE                                            05700058
057100             WHEN SQLCODE = ZERO                                  05710058
057200                 CONTINUE                                         05720058
057300             WHEN OTHER                                           05730058
057400                 MOVE '8400-OPEN-TYP-M-CURSOR'                    05740058
057500                                     TO PV-ABEND-PARAGRAPH        05750058
057600                 PERFORM 9100-SQL-ABEND                           05760058
057700         END-EVALUATE.                                            05770058
057800                                                                  05780058
057900******************************************************************05790058
058000*    FETCH TYP M CURSOR                                           05800058
058100******************************************************************05810058
058200 8500-FETCH-TYP-M-CURSOR.                                         05820058
058300                                                                  05830058
058400     EXEC SQL                                                     05840058
058500         FETCH TYP_M_CUR                                          05850058
058600         INTO  :WS-M-TYP-PO-NUMBER                                05860058
058700             , :WS-PREPK-TYP-CDE                                  05870058
058800             , :WS-TYP-M-QTY                                      05880058
058900     END-EXEC.                                                    05890058
059000                                                                  05900058
059100     EVALUATE TRUE                                                05910058
059200         WHEN SQLCODE = ZERO                                      05920058
059300              IF WS-PREPK-TYP-CDE = 'I'                           05930058
059400                  MOVE WS-TYP-M-QTY TO PC074-PACK-TO-LIGHT-QTY    05940058
059500              ELSE                                                05950058
059600                  MOVE WS-TYP-M-QTY TO PC074-CROSS-DOCK-QTY       05960058
059700              END-IF                                              05970058
059800         WHEN SQLCODE = +100                                      05980058
059900              SET PS-END-OF-TYP-M-CURSOR                          05990058
060000                                     TO TRUE                      06000058
060100         WHEN OTHER                                               06010058
060200                 MOVE '8500-FETCH-TYP-M-CURSOR'                   06020058
060300                                     TO PV-ABEND-PARAGRAPH        06030058
060400              PERFORM 9100-SQL-ABEND                              06040058
060500     END-EVALUATE.                                                06050058
060600                                                                  06060058
060700******************************************************************06070058
060800*   CLOSE PO-SET CURSOR.                                         *06080058
060900******************************************************************06090058
061000 8600-CLOSE-TYP-M-CURSOR.                                         06100058
061100                                                                  06110058
061200     EXEC SQL                                                     06120058
061300        CLOSE TYP_M_CUR                                           06130058
061400     END-EXEC.                                                    06140058
061500                                                                  06150058
061600     EVALUATE TRUE                                                06160058
061700         WHEN SQLCODE = ZERO                                      06170058
061800              CONTINUE                                            06180058
061900         WHEN OTHER                                               06190058
062000              MOVE '8600-CLOSE-TYP-M-CURSOR'                      06200058
062100                                     TO PV-ABEND-PARAGRAPH        06210058
062200              PERFORM 9100-SQL-ABEND                              06220058
062300     END-EVALUATE.                                                06230058
062400                                                                  06240058
062500******************************************************************06250058
062600* CLOSES THE INPUT/OUTPUT FILE AND DISPLAYS PROGRAM STATISTICS   *06260058
062700******************************************************************06270058
062800 9000-EOJ-ROUTINE.                                                06280058
062900                                                                  06290058
063000     CLOSE SET-DAT-EXT                                            06300058
063100           TK-SET-DET.                                            06310058
063200                                                                  06320058
063300     MOVE PA-INPUT-COUNT             TO PV-INPUT-COUNT.           06330058
063400     MOVE PA-OUT02-COUNT             TO PV-OUTPUT-COUNT.          06340058
063500     DISPLAY '*************************************************'. 06350058
063600     DISPLAY '**               PCKUT109 SUMMARY             **'.  06360058
063700     DISPLAY '*************************************************'. 06370058
063800     DISPLAY 'TOTAL SET CODE IN SYSIN = ' PV-INPUT-COUNT.         06380058
063900     DISPLAY 'TOTAL RECORDS WRITTEN'.                             06390058
064000     DISPLAY '    IN SET NAME/TK FILE = ' PV-OUTPUT-COUNT.        06400058
064100     MOVE PA-OUT01-COUNT             TO PV-OUTPUT-COUNT.          06410058
064200     DISPLAY 'TOTAL RECORDS EXTRACTED = ' PV-OUTPUT-COUNT.        06420058
064300     DISPLAY '*************************************************'. 06430058
064400     DISPLAY 'END OF PROGRAM   : ' PC-PGM-NAME.                   06440058
064500                                                                  06450058
064600******************************************************************06460058
064700* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *06470058
064800* ERROR OR WARNING CODE OCCURS.                                  *06480058
064900******************************************************************06490058
065000 9100-SQL-ABEND.                                                  06500058
065100                                                                  06510058
065200     MOVE SQLCODE                    TO PV-SQLCODE.               06520058
065300     DISPLAY '**************************************************'.06530058
065400     DISPLAY '                  ABEND                           '.06540058
065500     DISPLAY '**************************************************'.06550058
065600     DISPLAY 'PV-ABEND-PARAGRAPH : ' PV-ABEND-PARAGRAPH.          06560058
065700     DISPLAY 'PV-SQLCODE         : ' PV-SQLCODE.                  06570058
065800     DISPLAY '**************************************************'.06580058
065900     COPY DPPD004.                                                06590058
066000     MOVE +4013 TO ABEND-CODE.                                    06600058
066100     CALL 'ILBOABN0' USING ABEND-CODE.                            06610058
