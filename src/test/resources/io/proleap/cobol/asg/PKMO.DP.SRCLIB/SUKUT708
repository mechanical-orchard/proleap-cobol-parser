000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.             SUKUT708.                                00040001
000500 AUTHOR.                 GERMAN BANDA.                            00050001
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060001
000700 DATE-WRITTEN            NOVEMBER, 2003.                          00070015
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000* THIS MODULE WILL UPDATE TSHPSUM CARTON COMBINATIONS FOR PREPACK 00100001
001100* ORDERS (M OR I). WHEN A CARTON IS BEING MOVED FROM ONE PACKSLIP 00110001
001200* TO ANOTHER, THE TSHPSUM TABLE MUST BE UPDATED TO CORRESPOND TO  00120001
001300* THE CHANGE.                                                     00130001
001400******************************************************************00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600 DATA DIVISION.                                                   00160001
001700******************************************************************00170001
001800 WORKING-STORAGE SECTION.                                         00180001
001900                                                                  00190001
002000 01  DK-DB2-KEYS.                                                 00200001
002100     05  DK-PO-NBR                PIC S9(09)  COMP.               00210001
002200     05  DK-PO-LINE-NBR           PIC S9(09)  COMP.               00220013
002300     05  DK-DECREASE-COMB         PIC S9(04)  COMP.               00230013
002400     05  DK-INCREASE-COMB         PIC S9(04)  COMP.               00240013
002500     05  DK-OTPK-QTY              PIC S9(04)  COMP.               00250013
002600     05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00260013
002700     05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00270001
002800     05  DK-SHIPT-UNT-ID          PIC S9(18)V COMP-3.             00280001
002900     05  DK-PKSL-SEQ-NBR          PIC S9(4)   COMP.               00290012
003000                                                                  00300001
003100 01  DN-DB2-NULL-INDICATORS.                                      00310001
003200     05  DN-SUM-NULL                PIC S9(04) COMP VALUE ZEROES. 00320001
003300     05  DN-CART-COMB-NULL          PIC S9(04) COMP VALUE ZEROES. 00330048
003400*                                                                 00340001
003500*----------------------------------------------------------------*00350001
003600* COMMAREA USED WHEN LINKING FROM HANDLER PROGRAM                 00360001
003700*----------------------------------------------------------------*00370001
003800     COPY SUWS044.                                                00380001
003900                                                                  00390001
004000******************************************************************00400001
004100*  RANDOM NUMBER AREA.                                            00410001
004200******************************************************************00420001
004300     COPY DPWS902.                                                00430001
004400                                                                  00440001
004500******************************************************************00450001
004600*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00460001
004700******************************************************************00470001
004800     COPY DPWS013.                                                00480001
004900                                                                  00490001
005000*----------------------------------------------------------------*00500001
005100*  PROGRAM CONSTANTS                                             *00510001
005200*----------------------------------------------------------------*00520001
005300 01  PC-PROGRAM-CONSTANTS.                                        00530001
005400     05  PC-A                      PIC  X(01)  VALUE 'A'.         00540032
005500     05  PC-I                      PIC  X(01)  VALUE 'I'.         00550032
005600     05  PC-DEFAULT-DATE           PIC  X(26)  VALUE              00560032
005700                                   '9999-09-09-09.09.09.999999'.  00570032
005800     05  PC-RECEIVER-CREATE        PIC  X(08)  VALUE 'SUKUT703'.  00580032
005900     05  PC-PKSLIP-CRE-DETACH      PIC  X(08)  VALUE 'SUKUT704'.  00590032
006000     05  PC-LOG-QUEUE              PIC  X(04)  VALUE 'CSSL'.      00600032
006100     05  PC-MSG-TABLE-SIZE         PIC S9(03) COMP-3 VALUE 200.   00610032
006200     05  PC-100                    PIC  9(03)V99     VALUE 100.   00620032
006300     05  PC-LOGON-TRAN-ID          PIC  X(04)  VALUE 'Z028'.      00630032
006400     05  PC-MAX-EXPTED-TBL-ENTRY   PIC S9(04)  VALUE  +1500       00640032
006500                                                  COMP SYNC.      00650032
006600                                                                  00660001
006700*----------------------------------------------------------------*00670001
006800*  PROGRAM SWITCHES                                              *00680001
006900*----------------------------------------------------------------*00690001
007000 01  PS-PROGRAM-SWITCHES.                                         00700001
007100     05  PS-CARTON-ALREADY-EXISTS-SW     PIC  X(01)  VALUE 'N'.   00710001
007200         88  PS-CARTON-ALREADY-EXISTS                VALUE 'Y'.   00720001
007300         88  PS-CARTON-DOESNT-EXIST                  VALUE 'N'.   00730001
007400     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00740001
007500         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00750001
007600         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00760001
007700     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00770001
007800         88  PS-ERROR                                VALUE 'Y'.   00780001
007900         88  PS-ERROR-NO                             VALUE 'N'.   00790001
007910     05  PS-CURSOR-ERROR-SW              PIC  X(01)  VALUE 'N'.   00791079
007920         88  PS-CURSOR-ERROR                         VALUE 'Y'.   00792079
007930         88  PS-CURSOR-ERROR-NO                      VALUE 'N'.   00793079
008000     05  PS-DUMP-TO-LOG-SW               PIC X(01)   VALUE 'N'.   00800001
008100         88  PS-DONT-DUMP-TO-LOG                     VALUE 'N'.   00810001
008200         88  PS-DUMP-TO-LOG                          VALUE 'Y'.   00820001
008300     05  PS-SHUUPC-LINES-CSR-SW          PIC X(01)   VALUE 'N'.   00830003
008400         88  PS-END-OF-SHUUPC-CSR                    VALUE 'Y'.   00840003
008500         88  PS-NOT-END-OF-SHUUPC-CSR                VALUE 'N'.   00850003
008600     05  PS-CARTON-COMB-CSR-SW           PIC X(01)   VALUE 'N'.   00860007
008700         88  PS-END-OF-CARTON-COMB-CSR               VALUE 'Y'.   00870005
008800         88  PS-NOT-END-OF-CARTON-COMB-CSR           VALUE 'N'.   00880005
008900     05  PS-BEST-CASE-COMB-SW            PIC X(01)   VALUE ' '.   00890007
009000         88  PS-BEST-CASE-COMB-YES                   VALUE 'Y'.   00900006
009100         88  PS-BEST-CASE-COMB-NO                    VALUE 'N'.   00910006
009200     05  PS-NEW-BEST-CASE-COMB-SW        PIC X(01)   VALUE ' '.   00920026
009300         88  PS-NEW-BEST-CASE-COMB-YES               VALUE 'Y'.   00930026
009400         88  PS-NEW-BEST-CASE-COMB-NO                VALUE 'N'.   00940026
009500     05  PS-MATCH-COMB-SW                PIC X(01)   VALUE ' '.   00950026
009600         88  PS-MATCH-COMB                           VALUE 'Y'.   00960026
009700         88  PS-MATCH-COMB-NO                        VALUE 'N'.   00970026
009800     05  PS-NEW-MATCH-COMB-SW            PIC X(01)   VALUE ' '.   00980026
009900         88  PS-NEW-MATCH-COMB                       VALUE 'Y'.   00990026
010000         88  PS-NEW-MATCH-COMB-NO                    VALUE 'N'.   01000026
010100     05  PS-NO-NEW-MATCH-COMB-SW         PIC X(01)   VALUE ' '.   01010012
010200         88  PS-NO-NEW-MATCH-COMB                    VALUE 'Y'.   01020012
010300         88  PS-NO-NEW-MATCH-COMB-NO                 VALUE 'N'.   01030012
010400     05  PS-PACKSLIP-HAS-COMB-SW         PIC X(01)   VALUE ' '.   01040027
010500         88  PS-NEW-PACKSLIP-HAS-COMB                VALUE 'Y'.   01050027
010600         88  PS-NO-NEW-PACKSLIP-COMB                 VALUE 'N'.   01060027
010700                                                                  01070001
010800*----------------------------------------------------------------*01080001
010900*  PROGRAM VARIABLES                                             *01090001
011000*----------------------------------------------------------------*01100001
011100 01  PV-PROGRAM-VARIABLES.                                        01110001
011200                                                                  01120001
011300     05  PV-CART-COMB-TABLE-ENTIES       PIC 9(03).               01130058
011400     05  PV-DISPLAY-CARTON               PIC 9(18).               01140058
011500     05  PV-DISPLAY-PO-NBR               PIC 9(09).               01150001
011600     05  PV-DISPLAY-PO-LINE-NBR          PIC 9(04).               01160066
011700     05  PV-DISPLAY-PREPK-ID             PIC 9(04).               01170001
011800     05  PV-DISPLAY-OPER-UNT-ID          PIC 9(04).               01180001
011900     05  PV-DISPLAY-INBND-TRIP-ID        PIC 9(09).               01190001
012000     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 9(09).               01200001
012100     05  PV-DISPLAY-SHIPT-UNT-ID         PIC 9(18).               01210001
012200     05  PV-DISPLAY-ENT-ID               PIC 9(09).               01220001
012300     05  PV-DISPLAY-DEPT-NBR             PIC 9(04).               01230001
012400     05  PV-DISPLAY-CK-AFT-DAY-QTY       PIC 9(04).               01240001
012500     05  PV-DISPLAY-LIMIT-DAYS           PIC 9(09).               01250001
012600     05  PV-DISPLAY-TASK                 PIC 9(07).               01260001
012700     05  PV-DISPLAY-MSG-NBR              PIC 9(03).               01270001
012800     05  PV-DISPLAY-SQLCODE              PIC 9(04)-.              01280062
012900     05  PV-DISPLAY-COMB                 PIC 9(04).               01290062
013000     05  PV-DISPLAY-DECREASE             PIC 9(04).               01300075
013100     05  PV-DISPLAY-INCREASE             PIC 9(04).               01310075
013200     05  PV-DISPLAY-NEW-SEQ              PIC 9(04).               01320063
013300     05  PV-DISPLAY-OLD-SEQ              PIC 9(04).               01330066
013400     05  PV-DISPLAY-OTPK                 PIC 9(09).               01340066
013500     05  PV-DISPLAY-CRTN-CNT             PIC 9(09).               01350072
013600                                                                  01360001
013700     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACES.01370001
013800                                                                  01380001
013900     05  PV-COMB-FOR-PO-SEQ              PIC S9(4)  COMP.         01390047
014000     05  PV-PREV-CART-COMB-NBR           PIC S9(4)  COMP.         01400047
014100     05  PV-NEW-PREV-CART-COMB-NBR       PIC S9(4)  COMP.         01410047
014200     05  PV-COMB-TO-DECREASE             PIC S9(4)  COMP.         01420007
014300     05  PV-COMB-TO-INCREASE             PIC S9(4)  COMP.         01430007
014400     05  PV-DB2-CART-COMB-CNT            PIC S9(4)  VALUE +0      01440010
014500                                                    COMP.         01450010
014600     05  PV-NEW-CART-COMB-NBR            PIC S9(4)  COMP.         01460013
014700     05  PV-SHUUPC-FETCH-COUNT           PIC S9(9)  VALUE +0      01470007
014800                                                    COMP.         01480007
014900     05  PV-SHUUPC-OTPK-QTY              PIC S9(9)V COMP-3.       01490002
015000     05  PV-CICS-MSG-AREA                PIC  X(80) VALUE SPACE.  01500001
015100     05  PV-CICS-RESPONSE                PIC S9(08) VALUE ZEROS   01510001
015200                                                    COMP SYNC.    01520001
015300     05  PV-EIBTASKN                     PIC Z(06)9.              01530001
015400     05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        01540001
015500                                                     VALUE ZERO.  01550001
015600     05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        01560001
015700                                                     VALUE ZERO.  01570001
015800     05  PV-UNT-QTY                      PIC  9(05)V99.           01580001
015900     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01590001
016000     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01600001
016100                                                     COMP.        01610001
016200     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01620001
016300                                                     COMP SYNC.   01630001
016400/                                                                 01640001
016500 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  01650001
016600     05  TS-INFO-QUEUE-NAME.                                      01660001
016700         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 01670001
016800         10  FILLER                      PIC  X(04)  VALUE 'INFO'.01680001
016900                                                                  01690001
017000/                                                                 01700001
017100 01  PT-MSG-TABLE.                                                01710001
017200     05  PT-MSG-LINES OCCURS 200 TIMES                            01720001
017300                              INDEXED BY PT-MSG-IDX.              01730001
017400         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       01740001
017500         10  PT-MSG-LINE                 PIC X(69).               01750001
017600                                                                  01760001
017700     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         01770001
017800                                                     VALUE ZERO.  01780001
017900     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  01790001
018000                                                     COMP SYNC.   01800001
018100                                                                  01810001
018200 01  PT-PO-LNE-COMB-MTCH-TABLE.                                   01820002
018300     05  PT-PO-MTCH-COMB  OCCURS 200 TIMES                        01830002
018400                              INDEXED BY PT-MTCH-IDX              01840012
018500                                         PT-MTCH-IDX-2.           01850012
018600         10  PT-MTCH-PO-NBR              PIC S9(09) COMP.         01860002
018700         10  PT-MTCH-LINE                PIC S9(04) COMP.         01870002
018800         10  PT-MTCH-OTPK                PIC S9(04) COMP.         01880002
018900         10  PT-MTCH-DECR-COMB           PIC S9(04) COMP.         01890002
019000         10  PT-MTCH-INCR-COMB           PIC S9(04) COMP.         01900002
019100                                                                  01910002
019500*---------------------------------------------------------------* 01950001
019600*    DB2 AREA FOR THE SHIPPING UPC TABLE                        * 01960001
019700*---------------------------------------------------------------* 01970001
019800     EXEC SQL                                                     01980001
019900          INCLUDE TSHUUPC                                         01990001
020000     END-EXEC.                                                    02000001
020100*---------------------------------------------------------------* 02010020
020200*    DB2 AREA FOR THE CARTON SUMMARY TABLE                      * 02020020
020300*---------------------------------------------------------------* 02030020
020400     EXEC SQL                                                     02040020
020500         INCLUDE TSHPSUM                                          02050020
020600     END-EXEC.                                                    02060020
020700*---------------------------------------------------------------* 02070052
020800*    DB2 AREA FOR THE PARAMETER TABLE                           * 02080052
020900*---------------------------------------------------------------* 02090052
021000     EXEC SQL                                                     02100052
021100         INCLUDE TKRPRPM                                          02110052
021200     END-EXEC.                                                    02120052
021300*----------------------------------------------------------------*02130001
021400*  COMMUNICATIONS AREA FOR DB2                                   *02140001
021500*----------------------------------------------------------------*02150001
021600     EXEC SQL                                                     02160001
021700         INCLUDE SQLCA                                            02170001
021800     END-EXEC.                                                    02180001
021900                                                                  02190001
022000                                                                  02200001
022100*-----------------------------------------------------------------02210001
022200*  VERIFICATION PROCESSING                                        02220001
022300*  CURSOR TO DETERMINE CARTONS ATTACHED TO PO/RCVR THAT ARE NOT   02230001
022400*  CHECKED IN (NON PACK-BY-STORE)                                 02240001
022500*-----------------------------------------------------------------02250001
022600     EXEC SQL                                                     02260001
022700       DECLARE SHUUPC-LNE-QTY-CSR CURSOR FOR                      02270019
022800         SELECT DISTINCT                                          02280002
022900                A.TRN_NBR                                         02290001
023000              , A.TRN_LNE_NBR                                     02300001
023100              , SUM(SHPD_QTY)                                     02310033
023200          FROM  TSHUUPC A                                         02320001
023300          WHERE  A.SHIPT_UNT_ID    = :SU044-SHIPT-UNT-ID          02330001
023400            AND TRN_NBR            = :SU044-PO                    02340001
023500          GROUP BY A.TRN_NBR                                      02350001
023600                 , A.TRN_LNE_NBR                                  02360021
023700          ORDER BY A.TRN_NBR                                      02370001
023800                 , A.TRN_LNE_NBR                                  02380021
023900     END-EXEC.                                                    02390001
024000*-----------------------------------------------------------------02400004
024100*  CURSOR TO DETERMINE PO PACKSLIP COMBINATIONS FOR PREPACKS      02410004
024200*-----------------------------------------------------------------02420004
024300                                                                  02430001
024400     EXEC SQL                                                     02440004
024500       DECLARE CARTON-COMB-CSR CURSOR FOR                         02450019
024600        SELECT C.PO_NBR                                           02460004
024700              ,C.PKSL_SEQ_NBR                                     02470004
024800              ,C.CART_COMB_NBR                                    02480004
024900              ,C.PO_LNE_NBR                                       02490004
025000              ,C.TOT_CART_CNT                                     02500004
025100              ,C.OTPK_UNT_QTY                                     02510004
025200        FROM  TSHPSUM C                                           02520004
025300        WHERE C.PO_NBR        = :SU044-PO                         02530004
025400          AND C.PKSL_SEQ_NBR  = :DK-PKSL-SEQ-NBR                  02540012
025500          AND C.CART_COMB_NBR  IN                                 02550004
025600             (SELECT DISTINCT (B.CART_COMB_NBR)                   02560004
025700                 FROM  TSHUUPC A                                  02570004
025800                     , TSHPSUM B                                  02580004
025900                 WHERE  A.SHIPT_UNT_ID = :SU044-SHIPT-UNT-ID      02590004
026000                   AND  A.TRN_NBR      = :SU044-PO                02600004
026100                   AND  A.TRN_NBR      =  B.PO_NBR                02610004
026200                   AND  B.PKSL_SEQ_NBR = :DK-PKSL-SEQ-NBR         02620012
026300                   AND  A.SHPD_QTY     = B.OTPK_UNT_QTY           02630051
026400                   AND  A.TRN_LNE_NBR  = B.PO_LNE_NBR)            02640004
026500       ORDER BY C.PO_NBR, C.CART_COMB_NBR, C.PO_LNE_NBR           02650004
026600     END-EXEC.                                                    02660004
026700                                                                  02670001
026800******************************************************************02680001
026900 LINKAGE SECTION.                                                 02690001
027000******************************************************************02700001
027100 01  DFHCOMMAREA.                                                 02710001
027200     05  FILLER                         OCCURS  1 TO 4072 TIMES   02720001
027300                                      DEPENDING ON EIBCALEN.      02730001
027400         10  FILLER                   PIC X.                      02740001
027500                                                                  02750001
027600******************************************************************02760001
027700 PROCEDURE DIVISION.                                              02770001
027800******************************************************************02780001
027900 0000-PROGRAM-MAINLINE.                                           02790001
028000     MOVE EIBTASKN                 TO  PV-EIBTASKN.               02800001
028100     INITIALIZE                        SU044-COMM-AREA.           02810001
028200     MOVE DFHCOMMAREA              TO  SU044-COMM-AREA.           02820001
028300                                                                  02830001
028400     MOVE SPACES                   TO PV-CICS-MSG-AREA.           02840001
028500     INITIALIZE PT-MSG-TABLE.                                     02850001
028600     MOVE 1                        TO PT-MSG-SEQ (PT-MSG-IDX).    02860001
028700                                                                  02870001
028800     PERFORM 8000-CHECK-FOR-LOGGING                               02880050
028900                                                                  02890050
029000     MOVE SU044-PO                 TO DK-PO-NBR.                  02900001
029100     MOVE SU044-ORIG-REC-SEQ-NBR   TO DK-RCVR-SEQ-NBR.            02910001
029200     MOVE SU044-OPER-UNT-ID        TO DK-OPER-UNT-ID.             02920001
029300                                                                  02930001
029400     SET SU044-SUCCESSFUL          TO TRUE.                       02940001
029500                                                                  02950002
029600     PERFORM 1100-BUILD-SHUUPC-LNE-TBLE                           02960003
029700                                                                  02970031
029800     IF SU044-SUCCESSFUL                                          02980031
029900        PERFORM 2000-CARTON-COMB-TO-DECREASE                      02990031
030000     END-IF                                                       03000031
030100                                                                  03010031
030200     IF SU044-SUCCESSFUL                                          03020031
030300        PERFORM 2800-CHK-NEW-PKSLIP-COMB-LNE                      03030047
030400     END-IF                                                       03040031
030500                                                                  03050031
030600     IF SU044-SUCCESSFUL                                          03060031
030700        IF PS-NO-NEW-PACKSLIP-COMB                                03070031
030800           MOVE +1 TO PV-COMB-TO-INCREASE                         03080031
030900           PERFORM 3600-SELECT-NEW-COMB-NBR                       03090048
031000        ELSE                                                      03100031
031100           PERFORM 3000-CARTON-COMB-TO-INCREASE                   03110031
031200        END-IF                                                    03120031
031300     END-IF                                                       03130031
031400                                                                  03140031
031500     IF SU044-SUCCESSFUL                                          03150031
031600        IF PV-COMB-TO-INCREASE > 0                                03160031
031700           CONTINUE                                               03170031
031800        ELSE                                                      03180031
031900          IF PS-NEW-BEST-CASE-COMB-NO                             03190031
032000             IF PS-NEW-PACKSLIP-HAS-COMB                          03200031
032100                PERFORM 3600-SELECT-NEW-COMB-NBR                  03210031
032200             ELSE                                                 03220031
032300                MOVE +1 TO PV-COMB-TO-INCREASE                    03230031
032400             END-IF                                               03240031
032500          END-IF                                                  03250040
032600        END-IF                                                    03260031
032700     END-IF                                                       03270031
032800                                                                  03280013
032900     IF SU044-SUCCESSFUL                                          03290031
033000        PERFORM 4000-PROCESS-TABLE-ADJUSTMENTS                    03300031
033100     END-IF                                                       03310031
033200                                                                  03320013
033300                                                                  03330013
033400     MOVE SU044-COMM-AREA               TO DFHCOMMAREA.           03340001
033500     GOBACK.                                                      03350001
033600                                                                  03360001
033700******************************************************************03370002
033800 1100-BUILD-SHUUPC-LNE-TBLE.                                      03380003
033900******************************************************************03390002
034000     STRING ' 1100-BUILD-SHUUPC-LNE-TBLE'                         03400003
034100         DELIMITED BY SIZE                                        03410001
034200         INTO PV-CICS-MSG-AREA.                                   03420001
034300     PERFORM 9990-WRITE-CICS.                                     03430001
034400     SET SU044-SUCCESSFUL     TO TRUE.                            03440001
034500                                                                  03450004
034600     INITIALIZE  PT-PO-LNE-COMB-MTCH-TABLE.                       03460003
034700     SET PS-NOT-END-OF-SHUUPC-CSR  TO TRUE.                       03470003
034800                                                                  03480004
034900     PERFORM 1200-OPEN-SHUUPC-LNE-QTY-CSR                         03490002
035000     PERFORM 1300-FETCH-SHUUPC-LNE-QTY-CSR                        03500002
035100     PERFORM                                                      03510003
035200         VARYING PT-MTCH-IDX                                      03520003
035300            FROM 1 BY 1                                           03530003
035400           UNTIL PS-END-OF-SHUUPC-CSR OR                          03540003
035500                 PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY            03550003
035600                                                                  03560003
035700            MOVE SHUUPC-TRN-NBR         TO  PT-MTCH-PO-NBR        03570004
035800                                            (PT-MTCH-IDX)         03580004
035900            MOVE SHUUPC-TRN-LNE-NBR     TO  PT-MTCH-LINE          03590004
036000                                            (PT-MTCH-IDX)         03600004
036100            MOVE PV-SHUUPC-OTPK-QTY     TO  PT-MTCH-OTPK          03610004
036200                                            (PT-MTCH-IDX)         03620004
036300            MOVE ZEROES                 TO  PT-MTCH-DECR-COMB     03630004
036400                                            (PT-MTCH-IDX)         03640004
036500            MOVE ZEROES                 TO  PT-MTCH-INCR-COMB     03650004
036600                                            (PT-MTCH-IDX)         03660004
036700            ADD  1  TO  PV-CART-COMB-TABLE-ENTIES                 03670058
036800            PERFORM 1300-FETCH-SHUUPC-LNE-QTY-CSR                 03680025
036900                                                                  03690001
037000     END-PERFORM.                                                 03700004
037100                                                                  03710004
037200     PERFORM 1400-CLOSE-SHUUPC-QTY-CSR.                           03720004
037300                                                                  03730026
037400 1200-OPEN-SHUUPC-LNE-QTY-CSR.                                    03740002
037500     STRING ' 1200-OPEN-SHUUPC-LNE-QTY-CSR'                       03750002
037600         DELIMITED BY SIZE                                        03760001
037700         INTO PV-CICS-MSG-AREA.                                   03770001
037800     PERFORM 9990-WRITE-CICS.                                     03780001
037900                                                                  03790001
038000     EXEC SQL                                                     03800001
038100          OPEN SHUUPC-LNE-QTY-CSR                                 03810002
038200     END-EXEC.                                                    03820001
038300                                                                  03830001
038400     EVALUATE TRUE                                                03840001
038500         WHEN SQLCODE = ZERO                                      03850001
038600              CONTINUE                                            03860001
038700         WHEN SQLWARN0 NOT = SPACES                               03870001
038800         WHEN SQLCODE  < ZERO                                     03880001
038900         WHEN SQLCODE  > ZERO                                     03890001
039000             MOVE '1200-OPEN-SHUUPC-LNE-QTY-CSR'                  03900002
039100                             TO DP013-PARAGRAPH                   03910001
039200             MOVE 'SUKUT708 - OPEN-SHUUPC-LNE-QTY-CSR'            03920002
039300                             TO DP013-MESSAGE-TEXT(1)             03930001
039400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 03940001
039500             STRING 'PO NBR: '         DELIMITED BY SIZE          03950001
039600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          03960001
039700                           INTO DP013-MESSAGE-TEXT(2)             03970001
039800             MOVE SQLCA      TO DP013-SQLCA                       03980001
039900             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           03990032
040000             SET DP013-DB2-ABEND                                  04000001
040100                             TO TRUE                              04010001
040200             SET DP013-NO-ROLLBACK                                04020001
040300                             TO TRUE                              04030001
040400             PERFORM 9999-WRITE-CICS-LOG-MSG                      04040001
040500             SET PS-DUMP-TO-LOG       TO TRUE                     04050001
040600             SET SU044-INVALID-SQL TO TRUE                        04060001
040700             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 04070061
040800             STRING 'SUKUT708-1200-SQLCODE='                      04080061
040900                     PV-DISPLAY-SQLCODE                           04090061
041000                    '  PO-'  PV-DISPLAY-PO-NBR                    04100061
041100                             DELIMITED BY SIZE                    04110061
041200                        INTO SU044-CRA-RET-MSG                    04120061
041300     END-EVALUATE.                                                04130001
041400                                                                  04140001
041500 EJECT                                                            04150001
041600                                                                  04160001
041700                                                                  04170001
041800 1300-FETCH-SHUUPC-LNE-QTY-CSR.                                   04180002
041900     MOVE SU044-SHIPT-UNT-ID  TO PV-DISPLAY-CARTON                04190069
042000     MOVE SU044-PO            TO PV-DISPLAY-PO-NBR                04200071
042100     STRING ' 1300-FETCH-SHUUPC-LNE-QTY-CSR'                      04210002
042200            '  '                                                  04220068
042300            PV-DISPLAY-CARTON      ' - '                          04230069
042400            PV-DISPLAY-PO-NBR                                     04240070
042500         DELIMITED BY SIZE                                        04250001
042600         INTO PV-CICS-MSG-AREA.                                   04260001
042700     PERFORM 9990-WRITE-CICS.                                     04270001
042800                                                                  04280001
042900     EXEC SQL                                                     04290001
043000          FETCH SHUUPC-LNE-QTY-CSR                                04300002
043100           INTO :SHUUPC-TRN-NBR                                   04310002
043200             ,  :SHUUPC-TRN-LNE-NBR                               04320002
043300             ,  :PV-SHUUPC-OTPK-QTY                               04330002
043400     END-EXEC.                                                    04340001
043500                                                                  04350001
043600     EVALUATE TRUE                                                04360001
043700         WHEN SQLCODE = ZERO                                      04370001
043800              ADD +1 TO PV-SHUUPC-FETCH-COUNT                     04380007
043900         WHEN SQLCODE = +100                                      04390001
044000              SET PS-END-OF-SHUUPC-CSR  TO TRUE                   04400034
044100         WHEN SQLCODE = -904                                      04410027
044200         WHEN SQLCODE = -911                                      04420001
044300             MOVE '1300-FETCH-SHUUPC-LNE-QTY-CSR'                 04430002
044400                             TO DP013-PARAGRAPH                   04440001
044500             MOVE 'SUKUT708 -FETCH-SHUUPC-LNE-QTY-CSR'            04450002
044600                             TO DP013-MESSAGE-TEXT(1)             04460001
044700             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 04470001
044800             STRING 'PO NBR: '         DELIMITED BY SIZE          04480001
044900                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          04490001
045000                           INTO DP013-MESSAGE-TEXT(2)             04500001
045100             MOVE SQLCA      TO DP013-SQLCA                       04510001
045200             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           04520032
045300             SET DP013-DB2-ABEND                                  04530001
045400                             TO TRUE                              04540001
045500             SET DP013-NO-ROLLBACK                                04550001
045600                             TO TRUE                              04560001
045700             PERFORM 9999-WRITE-CICS-LOG-MSG                      04570001
045800             SET PS-DUMP-TO-LOG       TO TRUE                     04580001
045900             SET SU044-DATABASE-BUSY TO TRUE                      04590001
046000             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 04600061
046100             STRING 'SUKUT708-1300-SQLCODE='                      04610061
046200                     PV-DISPLAY-SQLCODE                           04620061
046300                    '  PO-'  PV-DISPLAY-PO-NBR                    04630061
046400                             DELIMITED BY SIZE                    04640061
046500                        INTO SU044-CRA-RET-MSG                    04650061
046600         WHEN SQLWARN0 NOT = SPACES                               04660001
046700         WHEN SQLCODE NOT EQUAL ZERO                              04670001
046800             MOVE '1300-FETCH-SHUUPC-LNE-QTY-CSR'                 04680002
046900                             TO DP013-PARAGRAPH                   04690001
047000             MOVE 'SUKUT708 -FETCH-SHUUPC-LNE-QTY-CSR'            04700002
047100                             TO DP013-MESSAGE-TEXT(1)             04710001
047200             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 04720001
047300             STRING 'PO NBR: '         DELIMITED BY SIZE          04730001
047400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          04740001
047500                           INTO DP013-MESSAGE-TEXT(2)             04750001
047600             MOVE SQLCA      TO DP013-SQLCA                       04760001
047700             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           04770032
047800             SET DP013-DB2-ABEND                                  04780001
047900                             TO TRUE                              04790001
048000             SET DP013-NO-ROLLBACK                                04800001
048100                             TO TRUE                              04810001
048200             PERFORM 9999-WRITE-CICS-LOG-MSG                      04820001
048300             SET PS-DUMP-TO-LOG       TO TRUE                     04830001
048400             SET SU044-INVALID-SQL    TO TRUE                     04840001
048500             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 04850061
048600             STRING 'SUKUT708-1300-SQLCODE='                      04860061
048700                     PV-DISPLAY-SQLCODE                           04870061
048800                    '  PO-'  PV-DISPLAY-PO-NBR                    04880061
048900                             DELIMITED BY SIZE                    04890061
049000                        INTO SU044-CRA-RET-MSG                    04900061
049100     END-EVALUATE.                                                04910001
049200                                                                  04920001
049300*----------------------------------------------------------------*04930001
049400* CLOSE THE LINE STORE CURSOR                                  *  04940001
049500*----------------------------------------------------------------*04950001
049600 1400-CLOSE-SHUUPC-QTY-CSR.                                       04960026
049700     STRING ' 1400-CLOSE-SHUUPC-QTY-CSR '                         04970026
049800         DELIMITED BY SIZE                                        04980001
049900         INTO PV-CICS-MSG-AREA.                                   04990001
050000     PERFORM 9990-WRITE-CICS.                                     05000001
050100                                                                  05010001
050200     EXEC SQL                                                     05020001
050300          CLOSE SHUUPC-LNE-QTY-CSR                                05030002
050400     END-EXEC.                                                    05040001
050500                                                                  05050001
050600     EVALUATE TRUE                                                05060001
050700         WHEN SQLCODE = ZERO                                      05070001
050800              CONTINUE                                            05080001
050900         WHEN SQLWARN0 NOT = SPACES                               05090001
051000         WHEN SQLCODE  < ZERO                                     05100001
051100         WHEN SQLCODE  > ZERO                                     05110001
051200             MOVE '1400-CLOSE-SHUUPC-QTY-CSR '                    05120026
051300                             TO DP013-PARAGRAPH                   05130001
051400             MOVE 'SUKUT708 -CLOSE-SHUUPC-LNE-QTY-CSR'            05140002
051500                             TO DP013-MESSAGE-TEXT(1)             05150001
051600             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 05160001
051700             STRING 'PO NBR: '         DELIMITED BY SIZE          05170001
051800                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          05180001
051900                           INTO DP013-MESSAGE-TEXT(2)             05190001
052000             MOVE SQLCA      TO DP013-SQLCA                       05200001
052100             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           05210032
052200             SET DP013-DB2-ABEND                                  05220001
052300                             TO TRUE                              05230001
052400             SET DP013-NO-ROLLBACK                                05240001
052500                             TO TRUE                              05250001
052600             PERFORM 9999-WRITE-CICS-LOG-MSG                      05260001
052700             SET PS-DUMP-TO-LOG       TO TRUE                     05270001
052800             SET SU044-INVALID-SQL TO TRUE                        05280001
052900             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 05290061
053000             STRING 'SUKUT708-1400-SQLCODE='                      05300061
053100                     PV-DISPLAY-SQLCODE                           05310061
053200                    '  PO-'  PV-DISPLAY-PO-NBR                    05320061
053300                             DELIMITED BY SIZE                    05330061
053400                        INTO SU044-CRA-RET-MSG                    05340061
053500     END-EVALUATE.                                                05350001
053600                                                                  05360001
053700                                                                  05370001
053800 2000-CARTON-COMB-TO-DECREASE.                                    05380008
053900     STRING ' 2000-CARTON-COMB-TO-DECREASE'                       05390008
054000         DELIMITED BY SIZE                                        05400001
054100         INTO PV-CICS-MSG-AREA.                                   05410001
054200     PERFORM 9990-WRITE-CICS.                                     05420001
054300     SET SU044-SUCCESSFUL     TO TRUE.                            05430001
054400                                                                  05440001
054500     MOVE SU044-ORIG-PKSL-SEQ-NBR TO DK-PKSL-SEQ-NBR              05450012
054600     SET PS-NOT-END-OF-CARTON-COMB-CSR TO TRUE.                   05460005
054700                                                                  05470005
054710*                                                                 05471079
054720*** DMH - 2/20/13                                                 05472079
054730     SET  PS-CURSOR-ERROR-NO   TO  TRUE                           05473079
054740*                                                                 05474079
054800     PERFORM 2100-OPEN-CARTON-COMB-CSR                            05480082
054802                                                                  05480283
054810     IF  PS-CURSOR-ERROR-NO                                       05481079
054900         PERFORM 2200-FETCH-CARTON-COMB-CSR                       05490079
054910     END-IF                                                       05491079
054920                                                                  05492079
055000     MOVE SHPSUM-CART-COMB-NBR  TO PV-PREV-CART-COMB-NBR          05500005
055100     PERFORM                                                      05510005
055200         VARYING PT-MTCH-IDX                                      05520005
055300            FROM 1 BY 1                                           05530005
055400           UNTIL PS-END-OF-CARTON-COMB-CSR OR                     05540005
055500                 PS-MATCH-COMB  OR                                05550007
055600                 PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY  OR        05560073
055700*DMH 10/08/2004 BEGIN                                             05570059
055800                  PS-BEST-CASE-COMB-NO  OR                        05580080
055900*DMH 10/08/2004 END                                               05590059
055910*DMH 02/20/2013 BEGIN                                             05591079
055911                  PS-CURSOR-ERROR                                 05591179
055920*DMH 02/20/2003 END                                               05592079
056000            IF SHPSUM-CART-COMB-NBR NOT = PV-PREV-CART-COMB-NBR   05600030
056100                 PERFORM 2500-MATCH-COMB-CHECK                    05610007
056200*DMH 11/13/2004 BEGIN                                             05620075
056300                 IF  PS-BEST-CASE-COMB-NO  AND                    05630075
056400                     PS-NOT-END-OF-CARTON-COMB-CSR                05640075
056500                     MOVE  SPACE  TO  PS-BEST-CASE-COMB-SW        05650075
056600                     MOVE SHPSUM-CART-COMB-NBR                    05660075
056700                       TO PV-PREV-CART-COMB-NBR                   05670075
056800                     PERFORM                                      05680075
056900                     VARYING PT-MTCH-IDX                          05690075
057000                        FROM 1 BY 1                               05700075
057100                       UNTIL PS-END-OF-CARTON-COMB-CSR OR         05710075
057200                         PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY OR 05720075
057300                         PT-MTCH-IDX > PV-SHUUPC-FETCH-COUNT      05730075
057400                       MOVE ZEROES TO PT-MTCH-DECR-COMB           05740075
057500                                            (PT-MTCH-IDX)         05750075
057600                       MOVE ZEROES TO PT-MTCH-INCR-COMB           05760075
057700                                            (PT-MTCH-IDX)         05770075
057800                     END-PERFORM                                  05780075
057900                     SET PT-MTCH-IDX TO +1                        05790075
058000                     IF PT-MTCH-PO-NBR (PT-MTCH-IDX) =            05800075
058100                            SHPSUM-PO-NBR  AND                    05810075
058200                        PT-MTCH-LINE (PT-MTCH-IDX)  =             05820075
058300                            SHPSUM-PO-LNE-NBR  AND                05830075
058400                        PT-MTCH-OTPK (PT-MTCH-IDX) =              05840075
058500                            SHPSUM-OTPK-UNT-QTY                   05850075
058600                        MOVE SHPSUM-CART-COMB-NBR                 05860075
058700                          TO PT-MTCH-DECR-COMB (PT-MTCH-IDX)      05870075
058800                        MOVE SHPSUM-CART-COMB-NBR                 05880075
058900                          TO PV-PREV-CART-COMB-NBR                05890075
059000                        PERFORM 2200-FETCH-CARTON-COMB-CSR        05900075
059100                     END-IF                                       05910075
059200                 END-IF                                           05920075
059300                                                                  05930075
059400*DMH 11/13/2004 END                                               05940075
059500            ELSE                                                  05950007
059600              IF PT-MTCH-PO-NBR (PT-MTCH-IDX) = SHPSUM-PO-NBR     05960007
059700                  AND                                             05970007
059800                 PT-MTCH-LINE (PT-MTCH-IDX) = SHPSUM-PO-LNE-NBR   05980007
059900                  AND                                             05990007
060000                 PT-MTCH-OTPK (PT-MTCH-IDX) = SHPSUM-OTPK-UNT-QTY 06000007
060100                 MOVE SHPSUM-CART-COMB-NBR  TO  PT-MTCH-DECR-COMB 06010005
060200                                            (PT-MTCH-IDX)         06020005
060300                 MOVE SHPSUM-CART-COMB-NBR TO                     06030005
060400                                        PV-PREV-CART-COMB-NBR     06040005
060500                                                                  06050005
060600                 PERFORM 2200-FETCH-CARTON-COMB-CSR               06060005
060700              ELSE                                                06070005
060800                 PERFORM 2200-FETCH-CARTON-COMB-CSR               06080005
060900                 UNTIL SHPSUM-CART-COMB-NBR NOT =                 06090030
061000                            PV-PREV-CART-COMB-NBR OR              06100006
061100                       PS-END-OF-CARTON-COMB-CSR                  06110006
061200                 PERFORM                                          06120007
061300                     VARYING PT-MTCH-IDX                          06130007
061400                        FROM 1 BY 1                               06140007
061500                       UNTIL PS-END-OF-CARTON-COMB-CSR OR         06150007
061600                         PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY OR 06160007
061700                         PT-MTCH-IDX > PV-SHUUPC-FETCH-COUNT      06170007
061800                       MOVE ZEROES TO PT-MTCH-DECR-COMB           06180012
061900                                            (PT-MTCH-IDX)         06190007
062000                       MOVE ZEROES TO PT-MTCH-INCR-COMB           06200012
062100                                            (PT-MTCH-IDX)         06210007
062200                 END-PERFORM                                      06220007
062300                 SET PT-MTCH-IDX TO +1                            06230007
062400              END-IF                                              06240007
062500            END-IF                                                06250007
062600     END-PERFORM.                                                 06260007
062700                                                                  06270007
062800     PERFORM 2300-CLOSE-CARTON-COMB-CSR.                          06280005
062900                                                                  06290001
063000 2100-OPEN-CARTON-COMB-CSR.                                       06300005
063100     MOVE  SU044-PO            TO  PV-DISPLAY-PO-NBR              06310072
063200     MOVE  DK-PKSL-SEQ-NBR     TO  PV-DISPLAY-OLD-SEQ             06320072
063300     MOVE  SU044-SHIPT-UNT-ID  TO  PV-DISPLAY-CARTON              06330072
063400     STRING ' 2100-OPEN-CARTON-COMB-CSR'                          06340005
063500            '  '                                                  06350072
063600             PV-DISPLAY-PO-NBR   ' - '                            06360072
063700             PV-DISPLAY-OLD-SEQ  ' - '                            06370072
063800             PV-DISPLAY-CARTON                                    06380072
063900             DELIMITED BY SIZE                                    06390072
064000         INTO PV-CICS-MSG-AREA.                                   06400001
064100     PERFORM 9990-WRITE-CICS.                                     06410001
064200                                                                  06420001
064300     EXEC SQL                                                     06430001
064400          OPEN CARTON-COMB-CSR                                    06440005
064500     END-EXEC.                                                    06450001
064600                                                                  06460001
064700     EVALUATE TRUE                                                06470001
064800         WHEN SQLCODE = ZERO                                      06480001
064900              CONTINUE                                            06490001
065000         WHEN SQLWARN0 NOT = SPACES                               06500001
065100         WHEN SQLCODE  < ZERO                                     06510001
065200         WHEN SQLCODE  > ZERO                                     06520001
065210             SET  PS-CURSOR-ERROR  TO  TRUE                       06521079
065300             MOVE '2100-OPEN-CARTON-COMB-CSR'                     06530005
065400                             TO DP013-PARAGRAPH                   06540001
065500             MOVE 'SUKUT708 - OPEN-CARTON-COMB-CSR'               06550005
065600                             TO DP013-MESSAGE-TEXT(1)             06560001
065700             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 06570001
065800             STRING 'PO NBR: '         DELIMITED BY SIZE          06580001
065900                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          06590001
066000                           INTO DP013-MESSAGE-TEXT(2)             06600001
066100             MOVE SQLCA      TO DP013-SQLCA                       06610001
066200             MOVE 'TSHPSUM'  TO DP013-DB2-TABLE-NAME(1)           06620032
066300             SET DP013-DB2-ABEND                                  06630001
066400                             TO TRUE                              06640001
066500             SET DP013-NO-ROLLBACK                                06650001
066600                             TO TRUE                              06660001
066700             PERFORM 9999-WRITE-CICS-LOG-MSG                      06670001
066800             SET PS-DUMP-TO-LOG       TO TRUE                     06680001
066900             SET SU044-INVALID-SQL TO TRUE                        06690001
067000             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 06700061
067100             STRING 'SUKUT708-2100-SQLCODE='                      06710061
067200                     PV-DISPLAY-SQLCODE                           06720061
067300                    '  PO-'  PV-DISPLAY-PO-NBR                    06730061
067400                             DELIMITED BY SIZE                    06740061
067500                        INTO SU044-CRA-RET-MSG                    06750061
067600     END-EVALUATE.                                                06760001
067700                                                                  06770001
067800 EJECT                                                            06780001
067900                                                                  06790001
068000                                                                  06800001
068100 2200-FETCH-CARTON-COMB-CSR.                                      06810005
068200     STRING ' 2200-FETCH-CARTON-COMB-CSR'                         06820005
068300         DELIMITED BY SIZE                                        06830001
068400         INTO PV-CICS-MSG-AREA.                                   06840001
068500     PERFORM 9990-WRITE-CICS.                                     06850001
068600                                                                  06860001
068700     EXEC SQL                                                     06870001
068800          FETCH CARTON-COMB-CSR                                   06880005
068900           INTO :SHPSUM-PO-NBR                                    06890005
069000             ,  :SHPSUM-PKSL-SEQ-NBR                              06900005
069100             ,  :SHPSUM-CART-COMB-NBR                             06910005
069200             ,  :SHPSUM-PO-LNE-NBR                                06920005
069300             ,  :SHPSUM-TOT-CART-CNT                              06930005
069400             ,  :SHPSUM-OTPK-UNT-QTY                              06940005
069500     END-EXEC.                                                    06950001
069600                                                                  06960001
069700     EVALUATE TRUE                                                06970001
069800         WHEN SQLCODE = ZERO                                      06980001
069900              CONTINUE                                            06990057
070000         WHEN SQLCODE = +100                                      07000001
070100              SET PS-END-OF-CARTON-COMB-CSR TO TRUE               07010005
070200         WHEN SQLCODE = -904                                      07020001
070300         WHEN SQLCODE = -911                                      07030001
070310             SET  PS-CURSOR-ERROR  TO  TRUE                       07031079
070400             MOVE '2200-FETCH-CARTON-COMB-CSR'                    07040005
070500                             TO DP013-PARAGRAPH                   07050001
070600             MOVE 'SUKUT708 -FETCH-CARTON-COMB-CSR'               07060005
070700                             TO DP013-MESSAGE-TEXT(1)             07070001
070800             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 07080001
070900             STRING 'PO NBR: '         DELIMITED BY SIZE          07090001
071000                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          07100001
071100                           INTO DP013-MESSAGE-TEXT(2)             07110001
071200             MOVE SQLCA      TO DP013-SQLCA                       07120001
071300             MOVE 'TSHPSUM'  TO DP013-DB2-TABLE-NAME(1)           07130032
071400             SET DP013-DB2-ABEND                                  07140001
071500                             TO TRUE                              07150001
071600             SET DP013-NO-ROLLBACK                                07160001
071700                             TO TRUE                              07170001
071800             PERFORM 9999-WRITE-CICS-LOG-MSG                      07180001
071900             SET PS-DUMP-TO-LOG       TO TRUE                     07190001
072000             SET SU044-DATABASE-BUSY TO TRUE                      07200001
072100             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 07210061
072200             STRING 'SUKUT708-2200-SQLCODE='                      07220061
072300                     PV-DISPLAY-SQLCODE                           07230061
072400                    '  PO-'  PV-DISPLAY-PO-NBR                    07240061
072500                             DELIMITED BY SIZE                    07250061
072600                        INTO SU044-CRA-RET-MSG                    07260061
072700         WHEN SQLWARN0 NOT = SPACES                               07270001
072800         WHEN SQLCODE NOT EQUAL ZERO                              07280001
072810             SET  PS-CURSOR-ERROR  TO  TRUE                       07281079
072900             MOVE '2200-FETCH-CARTON-COMB-CSR'                    07290005
073000                             TO DP013-PARAGRAPH                   07300001
073100             MOVE 'SUKUT708 -FETCH-CARTON-COMB-CSR'               07310005
073200                             TO DP013-MESSAGE-TEXT(1)             07320001
073300             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 07330001
073400             STRING 'PO NBR: '         DELIMITED BY SIZE          07340001
073500                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          07350001
073600                           INTO DP013-MESSAGE-TEXT(2)             07360001
073700             MOVE SQLCA      TO DP013-SQLCA                       07370001
073800             MOVE 'TSHPSUM'  TO DP013-DB2-TABLE-NAME(1)           07380032
073900             SET DP013-DB2-ABEND                                  07390001
074000                             TO TRUE                              07400001
074100             SET DP013-NO-ROLLBACK                                07410001
074200                             TO TRUE                              07420001
074300             PERFORM 9999-WRITE-CICS-LOG-MSG                      07430001
074400             SET PS-DUMP-TO-LOG       TO TRUE                     07440001
074500             SET SU044-INVALID-SQL    TO TRUE                     07450001
074600             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 07460061
074700             STRING 'SUKUT708-2200-SQLCODE='                      07470061
074800                     PV-DISPLAY-SQLCODE                           07480061
074900                    '  PO-'  PV-DISPLAY-PO-NBR                    07490061
075000                             DELIMITED BY SIZE                    07500061
075100                        INTO SU044-CRA-RET-MSG                    07510061
075200     END-EVALUATE.                                                07520001
075300                                                                  07530001
075400     MOVE  SHPSUM-PO-NBR          TO  PV-DISPLAY-PO-NBR           07540072
075500     MOVE  SHPSUM-PKSL-SEQ-NBR    TO  PV-DISPLAY-OLD-SEQ          07550072
075600     MOVE  SHPSUM-CART-COMB-NBR   TO  PV-DISPLAY-COMB             07560072
075700     MOVE  SHPSUM-PO-LNE-NBR      TO  PV-DISPLAY-PO-LINE-NBR      07570072
075800     MOVE  SHPSUM-TOT-CART-CNT    TO  PV-DISPLAY-CRTN-CNT         07580072
075900     MOVE  SHPSUM-OTPK-UNT-QTY    TO  PV-DISPLAY-OTPK             07590072
076000     STRING ' 2200-  '                                            07600072
076100             PV-DISPLAY-PO-NBR      ' - '                         07610072
076200             PV-DISPLAY-OLD-SEQ     ' - '                         07620072
076300             PV-DISPLAY-COMB        ' - '                         07630072
076400             PV-DISPLAY-PO-LINE-NBR ' - '                         07640072
076500             PV-DISPLAY-CRTN-CNT    ' - '                         07650072
076600             PV-DISPLAY-OTPK                                      07660072
076700         DELIMITED BY SIZE                                        07670072
076800         INTO PV-CICS-MSG-AREA.                                   07680072
076900     PERFORM 9990-WRITE-CICS.                                     07690072
077000                                                                  07700072
077100*----------------------------------------------------------------*07710001
077200* CLOSE THE LINE STORE CURSOR                                  *  07720001
077300*----------------------------------------------------------------*07730001
077400 2300-CLOSE-CARTON-COMB-CSR.                                      07740005
077500     STRING ' 2300-CLOSE-CARTON-COMB-CSR'                         07750005
077600         DELIMITED BY SIZE                                        07760001
077700         INTO PV-CICS-MSG-AREA.                                   07770001
077800     PERFORM 9990-WRITE-CICS.                                     07780001
077900                                                                  07790001
078000     EXEC SQL                                                     07800001
078100          CLOSE CARTON-COMB-CSR                                   07810005
078200     END-EXEC.                                                    07820001
078300                                                                  07830001
078400     EVALUATE TRUE                                                07840001
078500         WHEN SQLCODE = ZERO                                      07850001
078600              CONTINUE                                            07860001
078700         WHEN SQLWARN0 NOT = SPACES                               07870001
078800         WHEN SQLCODE  < ZERO                                     07880001
078900         WHEN SQLCODE  > ZERO                                     07890001
079000             MOVE '2300-CLOSE-CARTON-COMB-CSR'                    07900005
079100                             TO DP013-PARAGRAPH                   07910001
079200             MOVE 'SUKUT708 -CLOSE-CARTON-COMB-CSR'               07920005
079300                             TO DP013-MESSAGE-TEXT(1)             07930001
079400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 07940001
079500             STRING 'PO NBR: '         DELIMITED BY SIZE          07950001
079600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          07960001
079700                           INTO DP013-MESSAGE-TEXT(2)             07970001
079800             MOVE SQLCA      TO DP013-SQLCA                       07980001
079900             MOVE 'TSHPSUM'  TO DP013-DB2-TABLE-NAME(1)           07990032
080000             SET DP013-DB2-ABEND                                  08000001
080100                             TO TRUE                              08010001
080200             SET DP013-NO-ROLLBACK                                08020001
080300                             TO TRUE                              08030001
080400             PERFORM 9999-WRITE-CICS-LOG-MSG                      08040001
080500             SET PS-DUMP-TO-LOG       TO TRUE                     08050001
080600             SET SU044-INVALID-SQL TO TRUE                        08060001
080700             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 08070061
080800             STRING 'SUKUT708-2300-SQLCODE='                      08080061
080900                     PV-DISPLAY-SQLCODE                           08090061
081000                    '  PO-'  PV-DISPLAY-PO-NBR                    08100061
081100                             DELIMITED BY SIZE                    08110061
081200                        INTO SU044-CRA-RET-MSG                    08120061
081300     END-EVALUATE.                                                08130001
081400                                                                  08140001
081500                                                                  08150001
081600 2500-MATCH-COMB-CHECK.                                           08160007
081700     STRING ' 2500-MATCH-COMB-CHECK'                              08170065
081800         DELIMITED BY SIZE                                        08180065
081900         INTO PV-CICS-MSG-AREA.                                   08190065
082000     PERFORM 9990-WRITE-CICS.                                     08200065
082100                                                                  08210007
082200     PERFORM                                                      08220007
082300         VARYING PT-MTCH-IDX                                      08230007
082400            FROM 1 BY 1                                           08240007
082500           UNTIL PS-MATCH-COMB-NO OR                              08250028
082600                 PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY  OR        08260058
082700*DMH 10/08/2004 BEGIN                                             08270060
082800                 PT-MTCH-IDX > PV-CART-COMB-TABLE-ENTIES          08280058
082900*DMH 10/08/2004 END                                               08290060
083000           IF PT-MTCH-DECR-COMB (PT-MTCH-IDX)  =                  08300058
083100                                  PV-PREV-CART-COMB-NBR           08310058
083200              SET PS-MATCH-COMB TO TRUE                           08320007
083300           ELSE                                                   08330007
083400              SET PS-MATCH-COMB-NO  TO TRUE                       08340028
083500           END-IF                                                 08350007
083600                                                                  08360007
083700     END-PERFORM.                                                 08370024
083800                                                                  08380007
083900     IF PS-MATCH-COMB-NO                                          08390028
084000        SET PS-BEST-CASE-COMB-NO TO TRUE                          08400007
084100     ELSE                                                         08410007
084200        SET PS-BEST-CASE-COMB-YES TO TRUE                         08420007
084300        MOVE PV-PREV-CART-COMB-NBR TO PV-COMB-TO-DECREASE         08430007
084400     END-IF.                                                      08440007
084500                                                                  08450007
084600 2800-CHK-NEW-PKSLIP-COMB-LNE.                                    08460047
084700     STRING ' 2800-CHK-NEW-PKSLIP-COMB-LNE'                       08470065
084800         DELIMITED BY SIZE                                        08480065
084900         INTO PV-CICS-MSG-AREA.                                   08490065
085000     PERFORM 9990-WRITE-CICS.                                     08500065
085100                                                                  08510007
085200     EXEC SQL                                                     08520008
085300        SELECT COUNT(DISTINCT(C.CART_COMB_NBR))                   08530010
085400          INTO :PV-DB2-CART-COMB-CNT                              08540010
085500          FROM TSHPSUM C                                          08550022
085600         WHERE C.PO_NBR       = :SU044-PO                         08560010
085700           AND C.PKSL_SEQ_NBR = :SU044-NEW-PKSL-SEQ-NBR           08570010
085800           AND C.CART_COMB_NBR IN                                 08580010
085900               (SELECT  DISTINCT(B.CART_COMB_NBR)                 08590010
086000                FROM    TSHUUPC A                                 08600010
086100                      , TSHPSUM B                                 08610010
086200                WHERE   A.SHIPT_UNT_ID = :SU044-SHIPT-UNT-ID      08620010
086300                  AND   A.TRN_NBR      = :SU044-PO                08630010
086400                  AND   A.TRN_NBR      = B.PO_NBR                 08640010
086500                  AND   B.PKSL_SEQ_NBR = :SU044-NEW-PKSL-SEQ-NBR  08650010
086600                  AND   A.SHPD_QTY     = B.OTPK_UNT_QTY           08660055
086700                  AND   A.TRN_LNE_NBR  = B.PO_LNE_NBR)            08670055
086800     END-EXEC                                                     08680055
086900                                                                  08690055
087000     EVALUATE TRUE                                                08700055
087100         WHEN SQLCODE = ZERO                                      08710055
087200             IF PV-DB2-CART-COMB-CNT > 0                          08720055
087300                SET PS-NEW-PACKSLIP-HAS-COMB TO TRUE              08730055
087400             ELSE                                                 08740055
087500                SET PS-NO-NEW-PACKSLIP-COMB TO TRUE               08750055
087600             END-IF                                               08760055
087700         WHEN SQLCODE = +100                                      08770055
087800         WHEN SQLWARN0 NOT = SPACES                               08780055
087900         WHEN SQLCODE  NOT = ZERO                                 08790055
088000             SET SU044-INVALID-SQL                                08800055
088100                 PS-ERROR              TO TRUE                    08810055
088200             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           08820055
088300             MOVE SU044-NEW-REC-SEQ-NBR                           08830055
088400                                      TO PV-DISPLAY-RCVR-SEQ-NBR  08840055
088500             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   08850055
088600             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   08860055
088700             STRING   ' SUKUT708-2800-'                           08870055
088800                      ' CALLED BY-'                               08880055
088900                      SU044-PROGRAM-NAME                          08890055
089000                      ' PO='                                      08900055
089100                      PV-DISPLAY-PO-NBR                           08910055
089200                      ' RCVR='                                    08920055
089300                      PV-DISPLAY-RCVR-SEQ-NBR                     08930055
089400                      ' OPER='                                    08940055
089500                      PV-DISPLAY-OPER-UNT-ID                      08950055
089600                      DELIMITED BY SIZE                           08960055
089700                                      INTO PV-CICS-MSG-AREA       08970055
089800             PERFORM 9999-WRITE-TO-CSSL                           08980055
089900             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      08990055
090000             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 09000061
090100             STRING 'SUKUT708-2800-SQLCODE='                      09010061
090200                     PV-DISPLAY-SQLCODE                           09020061
090300                    '  PO-'  PV-DISPLAY-PO-NBR                    09030061
090400                             DELIMITED BY SIZE                    09040061
090500                        INTO SU044-CRA-RET-MSG                    09050061
090600     END-EVALUATE.                                                09060055
090700                                                                  09070055
090800 3000-CARTON-COMB-TO-INCREASE.                                    09080055
090900     STRING ' 3000-CARTON-COMB-TO-INCREASE'                       09090055
091000         DELIMITED BY SIZE                                        09100055
091100         INTO PV-CICS-MSG-AREA.                                   09110055
091200     PERFORM 9990-WRITE-CICS.                                     09120055
091300     SET SU044-SUCCESSFUL     TO TRUE.                            09130055
091400                                                                  09140055
091500     MOVE SU044-NEW-PKSL-SEQ-NBR TO DK-PKSL-SEQ-NBR               09150055
091600     SET PS-NOT-END-OF-CARTON-COMB-CSR TO TRUE.                   09160055
091700     MOVE SPACE  TO  PS-NEW-MATCH-COMB-SW.                        09170075
091800                                                                  09180039
091810*                                                                 09181079
091820*** DMH - 2/20/13                                                 09182079
091830     SET  PS-CURSOR-ERROR-NO   TO  TRUE                           09183079
091840*                                                                 09184079
091900     PERFORM 2100-OPEN-CARTON-COMB-CSR                            09190082
091920                                                                  09192083
092000     PERFORM 2200-FETCH-CARTON-COMB-CSR                           09200039
092100                                                                  09210054
092200     MOVE SHPSUM-CART-COMB-NBR  TO PV-NEW-PREV-CART-COMB-NBR      09220039
092300                                                                  09230045
092400     PERFORM                                                      09240039
092500         VARYING PT-MTCH-IDX-2                                    09250039
092600            FROM 1 BY 1                                           09260039
092700           UNTIL PS-END-OF-CARTON-COMB-CSR OR                     09270039
092800                 PS-NEW-MATCH-COMB  OR                            09280039
092900                 PT-MTCH-IDX-2 > PC-MAX-EXPTED-TBL-ENTRY  OR      09290075
093000*DMH 10/08/2004 BEGIN                                             09300075
093100                  PS-NEW-BEST-CASE-COMB-NO  OR                    09310080
093200*DMH 10/08/2004 END                                               09320075
093210*DMH 02/20/2013 BEGIN                                             09321079
093220                  PS-CURSOR-ERROR                                 09322079
093230*DMH 02/20/2003 END                                               09323079
093300            IF SHPSUM-CART-COMB-NBR NOT =                         09330039
093400                                        PV-NEW-PREV-CART-COMB-NBR 09340039
093500                 PERFORM 3500-MATCH-COMB-CHECK-INCR               09350039
093600*DMH 11/13/2004 BEGIN                                             09360075
093700                 IF  PS-NEW-BEST-CASE-COMB-NO  AND                09370075
093800                     PS-NOT-END-OF-CARTON-COMB-CSR                09380075
093900                     MOVE  SPACE  TO  PS-NEW-BEST-CASE-COMB-SW    09390075
094000                     MOVE SHPSUM-CART-COMB-NBR                    09400075
094100                       TO PV-NEW-PREV-CART-COMB-NBR               09410075
094200                     PERFORM                                      09420075
094300                     VARYING PT-MTCH-IDX-2                        09430075
094400                        FROM 1 BY 1                               09440075
094500                       UNTIL PS-END-OF-CARTON-COMB-CSR OR         09450075
094600                         PT-MTCH-IDX-2 >                          09460075
094700                                       PC-MAX-EXPTED-TBL-ENTRY OR 09470075
094800                         PT-MTCH-IDX-2 >                          09480075
094900                                       PV-SHUUPC-FETCH-COUNT      09490075
095000                       MOVE ZEROES TO PT-MTCH-DECR-COMB           09500075
095100                                            (PT-MTCH-IDX-2)       09510075
095200                       MOVE ZEROES TO PT-MTCH-INCR-COMB           09520075
095300                                            (PT-MTCH-IDX-2)       09530075
095400                     END-PERFORM                                  09540075
095500                     SET PT-MTCH-IDX-2 TO +1                      09550075
095600                     IF PT-MTCH-PO-NBR (PT-MTCH-IDX-2) =          09560075
095700                            SHPSUM-PO-NBR  AND                    09570075
095800                        PT-MTCH-LINE (PT-MTCH-IDX-2)  =           09580075
095900                            SHPSUM-PO-LNE-NBR  AND                09590075
096000                        PT-MTCH-OTPK (PT-MTCH-IDX-2) =            09600075
096100                            SHPSUM-OTPK-UNT-QTY                   09610075
096200                        MOVE SHPSUM-CART-COMB-NBR                 09620075
096300                          TO PT-MTCH-DECR-COMB (PT-MTCH-IDX-2)    09630075
096400                        MOVE SHPSUM-CART-COMB-NBR                 09640075
096500                          TO PV-NEW-PREV-CART-COMB-NBR            09650075
096600                        PERFORM 2200-FETCH-CARTON-COMB-CSR        09660075
096700                     END-IF                                       09670075
096800                 END-IF                                           09680075
096900                                                                  09690075
097000*DMH 11/13/2004 END                                               09700075
097100            ELSE                                                  09710039
097200              IF PT-MTCH-PO-NBR (PT-MTCH-IDX-2) = SHPSUM-PO-NBR   09720039
097300                  AND                                             09730039
097400                 PT-MTCH-LINE (PT-MTCH-IDX-2) = SHPSUM-PO-LNE-NBR 09740039
097500                  AND                                             09750039
097600                 PT-MTCH-OTPK (PT-MTCH-IDX-2)                     09760039
097700                      = SHPSUM-OTPK-UNT-QTY                       09770039
097800                 MOVE SHPSUM-CART-COMB-NBR  TO  PT-MTCH-INCR-COMB 09780045
097900                                            (PT-MTCH-IDX-2)       09790039
098000                 MOVE SHPSUM-CART-COMB-NBR TO                     09800039
098100                                     PV-NEW-PREV-CART-COMB-NBR    09810039
098200                                                                  09820039
098300                 PERFORM 2200-FETCH-CARTON-COMB-CSR               09830039
098400              ELSE                                                09840039
098500                 PERFORM 2200-FETCH-CARTON-COMB-CSR               09850039
098600                 UNTIL SHPSUM-CART-COMB-NBR NOT =                 09860039
098700                            PV-NEW-PREV-CART-COMB-NBR OR          09870039
098800                       PS-END-OF-CARTON-COMB-CSR                  09880039
098900                 PERFORM                                          09890039
099000                     VARYING PT-MTCH-IDX-2                        09900039
099100                        FROM 1 BY 1                               09910039
099200                       UNTIL PS-END-OF-CARTON-COMB-CSR OR         09920039
099300                         PT-MTCH-IDX-2 >                          09930039
099400                                 PC-MAX-EXPTED-TBL-ENTRY OR       09940039
099500                         PT-MTCH-IDX-2 > PV-SHUUPC-FETCH-COUNT    09950039
099600                       MOVE ZEROES TO PT-MTCH-DECR-COMB           09960039
099700                                            (PT-MTCH-IDX-2)       09970039
099800                       MOVE ZEROES TO PT-MTCH-INCR-COMB           09980039
099900                                            (PT-MTCH-IDX-2)       09990039
100000                 END-PERFORM                                      10000039
100100                 SET PT-MTCH-IDX-2 TO +1                          10010039
100200              END-IF                                              10020039
100300            END-IF                                                10030039
100400     END-PERFORM.                                                 10040039
100401                                                                  10040177
100402*DMH 11/12/2004 BEGIN                                             10040277
100410     IF  PS-END-OF-CARTON-COMB-CSR                                10041077
100411         PERFORM 3500-MATCH-COMB-CHECK-INCR                       10041177
100412         IF  PS-NEW-BEST-CASE-COMB-NO                             10041277
100413             MOVE +1 TO PV-COMB-TO-INCREASE                       10041377
100414             PERFORM 3600-SELECT-NEW-COMB-NBR                     10041477
100415         END-IF                                                   10041577
100416     END-IF.                                                      10041677
100420*DMH 11/12/2004 END                                               10042077
100500                                                                  10050039
100600     PERFORM 2300-CLOSE-CARTON-COMB-CSR.                          10060039
100700                                                                  10070042
100800                                                                  10080046
100900 3500-MATCH-COMB-CHECK-INCR.                                      10090042
101000     STRING ' 3500-MATCH-COMB-CHECK-INCRN'                        10100065
101100         DELIMITED BY SIZE                                        10110065
101200         INTO PV-CICS-MSG-AREA.                                   10120065
101300     PERFORM 9990-WRITE-CICS.                                     10130065
101400                                                                  10140042
101500     PERFORM                                                      10150042
101600         VARYING PT-MTCH-IDX-2                                    10160042
101700            FROM 1 BY 1                                           10170042
101800           UNTIL PS-NO-NEW-MATCH-COMB OR                          10180042
101900                 PT-MTCH-IDX-2 > PC-MAX-EXPTED-TBL-ENTRY  OR      10190075
102000*DMH 11/12/04 BEGIN                                               10200075
102100                 PT-MTCH-IDX-2 > PV-CART-COMB-TABLE-ENTIES        10210075
102200*DMH 11/12/04 BEGIN                                               10220075
102300           IF PT-MTCH-INCR-COMB (PT-MTCH-IDX-2) =                 10230042
102400                                  PV-NEW-PREV-CART-COMB-NBR       10240042
102500              SET PS-NEW-MATCH-COMB TO TRUE                       10250042
102600           ELSE                                                   10260042
102700              SET PS-NO-NEW-MATCH-COMB  TO TRUE                   10270042
102800           END-IF                                                 10280042
102900                                                                  10290042
103000     END-PERFORM.                                                 10300042
103100                                                                  10310042
103200     IF PS-NO-NEW-MATCH-COMB                                      10320042
103300        SET PS-NEW-BEST-CASE-COMB-NO TO TRUE                      10330042
103400     ELSE                                                         10340042
103500        SET PS-NEW-BEST-CASE-COMB-YES TO TRUE                     10350042
103600        MOVE PV-NEW-PREV-CART-COMB-NBR TO PV-COMB-TO-INCREASE     10360042
103700     END-IF.                                                      10370042
103800                                                                  10380042
103900 3550-CHECK-NEW-COMB-EXISTS.                                      10390047
104000     STRING ' 3550-CHECK-NEW-COMB-EXISTS'                         10400065
104100         DELIMITED BY SIZE                                        10410065
104200         INTO PV-CICS-MSG-AREA.                                   10420065
104300     PERFORM 9990-WRITE-CICS.                                     10430065
104400                                                                  10440042
104500     EXEC SQL                                                     10450042
104600         SELECT MAX(CART_COMB_NBR)                                10460048
104700          INTO :PV-COMB-FOR-PO-SEQ                                10470047
104800         FROM   TSHPSUM                                           10480042
104900         WHERE  PO_NBR         = :SU044-PO                        10490042
105000           AND  PKSL_SEQ_NBR   = :SU044-NEW-PKSL-SEQ-NBR          10500042
105100     END-EXEC                                                     10510013
105200                                                                  10520013
105300     EVALUATE TRUE                                                10530013
105400         WHEN SQLCODE = ZERO                                      10540013
105500         WHEN SQLCODE = -811                                      10550047
105600             SET PS-NEW-PACKSLIP-HAS-COMB TO TRUE                 10560047
105700         WHEN SQLCODE = +100                                      10570013
105800             SET PS-NO-NEW-PACKSLIP-COMB  TO TRUE                 10580047
105900         WHEN SQLWARN0 NOT = SPACES                               10590013
106000         WHEN SQLCODE  NOT = ZERO                                 10600013
106100             SET SU044-INVALID-SQL                                10610013
106200                 PS-ERROR              TO TRUE                    10620013
106300             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           10630024
106400             MOVE SU044-NEW-REC-SEQ-NBR                           10640027
106500                                      TO PV-DISPLAY-RCVR-SEQ-NBR  10650026
106600             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   10660026
106700             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   10670024
106800             STRING   ' SUKUT708-3550-'                           10680047
106900                      ' CALLED BY-'                               10690013
107000                      SU044-PROGRAM-NAME                          10700013
107100                      ' PO='                                      10710013
107200                      PV-DISPLAY-PO-NBR                           10720024
107300                      ' RCVR='                                    10730013
107400                      PV-DISPLAY-RCVR-SEQ-NBR                     10740026
107500                      ' OPER='                                    10750013
107600                      PV-DISPLAY-OPER-UNT-ID                      10760024
107700                      DELIMITED BY SIZE                           10770013
107800                                      INTO PV-CICS-MSG-AREA       10780013
107900             PERFORM 9999-WRITE-TO-CSSL                           10790013
108000             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      10800013
108100             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 10810061
108200             STRING 'SUKUT708-3550-SQLCODE='                      10820061
108300                     PV-DISPLAY-SQLCODE                           10830061
108400                    '  PO-'  PV-DISPLAY-PO-NBR                    10840061
108500                             DELIMITED BY SIZE                    10850061
108600                        INTO SU044-CRA-RET-MSG                    10860061
108700     END-EVALUATE.                                                10870013
108800                                                                  10880013
108900 3600-SELECT-NEW-COMB-NBR.                                        10890047
109000     STRING ' 3600-SELECT-NEW-COMB-NBR'                           10900065
109100         DELIMITED BY SIZE                                        10910065
109200         INTO PV-CICS-MSG-AREA.                                   10920065
109300     PERFORM 9990-WRITE-CICS.                                     10930065
109400                                                                  10940047
109500     EXEC SQL                                                     10950047
109600         SELECT  MAX(CART_COMB_NBR + 1)                           10960047
109700          INTO :PV-NEW-CART-COMB-NBR :DN-CART-COMB-NULL           10970048
109800         FROM   TSHPSUM                                           10980047
109900         WHERE  PO_NBR         = :SU044-PO                        10990047
110000           AND  PKSL_SEQ_NBR   = :SU044-NEW-PKSL-SEQ-NBR          11000047
110100     END-EXEC                                                     11010047
110200                                                                  11020047
110300     EVALUATE TRUE                                                11030047
110400         WHEN SQLCODE = ZERO                                      11040047
110500             IF DN-CART-COMB-NULL = -1                            11050048
110600                CONTINUE                                          11060048
110700             ELSE                                                 11070048
110800                MOVE PV-NEW-CART-COMB-NBR  TO PV-COMB-TO-INCREASE 11080048
110900             END-IF                                               11090049
111000         WHEN SQLCODE = +100                                      11100047
111100         WHEN SQLWARN0 NOT = SPACES                               11110047
111200         WHEN SQLCODE  NOT = ZERO                                 11120047
111300             SET SU044-INVALID-SQL                                11130047
111400                 PS-ERROR              TO TRUE                    11140047
111500             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           11150047
111600             MOVE SU044-NEW-REC-SEQ-NBR                           11160047
111700                                      TO PV-DISPLAY-RCVR-SEQ-NBR  11170047
111800             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   11180047
111900             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   11190047
112000             STRING   ' SUKUT708-3600-'                           11200047
112100                      ' CALLED BY-'                               11210047
112200                      SU044-PROGRAM-NAME                          11220047
112300                      ' PO='                                      11230047
112400                      PV-DISPLAY-PO-NBR                           11240047
112500                      ' RCVR='                                    11250047
112600                      PV-DISPLAY-RCVR-SEQ-NBR                     11260047
112700                      ' OPER='                                    11270047
112800                      PV-DISPLAY-OPER-UNT-ID                      11280047
112900                      DELIMITED BY SIZE                           11290047
113000                                      INTO PV-CICS-MSG-AREA       11300047
113100             PERFORM 9999-WRITE-TO-CSSL                           11310047
113200             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      11320047
113300             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 11330061
113400             STRING 'SUKUT708-3600-SQLCODE='                      11340061
113500                     PV-DISPLAY-SQLCODE                           11350061
113600                    '  PO-'  PV-DISPLAY-PO-NBR                    11360061
113700                             DELIMITED BY SIZE                    11370061
113800                        INTO SU044-CRA-RET-MSG                    11380061
113900     END-EVALUATE.                                                11390047
114000                                                                  11400047
114100 4000-PROCESS-TABLE-ADJUSTMENTS.                                  11410047
114200     STRING ' 4000-PROCESS-TABLE-ADJUSTMENTS'                     11420065
114300         DELIMITED BY SIZE                                        11430065
114400         INTO PV-CICS-MSG-AREA.                                   11440065
114500     PERFORM 9990-WRITE-CICS.                                     11450065
114600                                                                  11460047
114700     PERFORM                                                      11470047
114800         VARYING PT-MTCH-IDX                                      11480047
114900            FROM 1 BY 1                                           11490047
115000          UNTIL  PT-MTCH-IDX > PC-MAX-EXPTED-TBL-ENTRY OR         11500047
115100                    PT-MTCH-IDX > PV-SHUUPC-FETCH-COUNT           11510047
115200              MOVE PT-MTCH-PO-NBR (PT-MTCH-IDX) TO DK-PO-NBR      11520047
115300              MOVE PT-MTCH-LINE (PT-MTCH-IDX) TO DK-PO-LINE-NBR   11530047
115400              MOVE PT-MTCH-OTPK (PT-MTCH-IDX) TO DK-OTPK-QTY      11540047
115500              MOVE PT-MTCH-DECR-COMB (PT-MTCH-IDX) TO             11550047
115600                                              DK-DECREASE-COMB    11560047
115700              MOVE PT-MTCH-INCR-COMB (PT-MTCH-IDX) TO             11570047
115800                                              DK-INCREASE-COMB    11580047
115900                                                                  11590075
116000              MOVE DK-DECREASE-COMB  TO  PV-DISPLAY-DECREASE      11600075
116100              MOVE DK-INCREASE-COMB  TO  PV-DISPLAY-INCREASE      11610075
116200              STRING ' 4000 -    '                                11620075
116300                      PV-DISPLAY-INCREASE '  -  '                 11630075
116400                      PV-DISPLAY-DECREASE                         11640075
116500                  DELIMITED BY SIZE                               11650075
116600                  INTO PV-CICS-MSG-AREA                           11660075
116700              PERFORM 9990-WRITE-CICS                             11670075
116800                                                                  11680075
116900              PERFORM 4100-UPDATE-TSHPSUM                         11690047
117000     END-PERFORM.                                                 11700047
117100                                                                  11710047
117200                                                                  11720047
117300 4100-UPDATE-TSHPSUM.                                             11730047
117400     STRING ' 4100-UPDATE-TSHPSUM'                                11740065
117500         DELIMITED BY SIZE                                        11750065
117600         INTO PV-CICS-MSG-AREA.                                   11760065
117700     PERFORM 9990-WRITE-CICS.                                     11770065
117800                                                                  11780065
117900      PERFORM 4200-DECREASE-TSHPSUM                               11790047
118000      PERFORM 4300-INCREASE-TSHPSUM                               11800047
118100      IF SQLCODE = +100                                           11810047
118200         PERFORM 4400-INSERT-TSHPSUM                              11820047
118300      END-IF.                                                     11830047
118400                                                                  11840065
118500                                                                  11850065
118600 4200-DECREASE-TSHPSUM.                                           11860047
118700     MOVE DK-PO-NBR               TO PV-DISPLAY-PO-NBR            11870066
118800     MOVE SU044-ORIG-PKSL-SEQ-NBR TO PV-DISPLAY-OLD-SEQ           11880066
118900     MOVE DK-DECREASE-COMB        TO PV-DISPLAY-COMB              11890066
119000     MOVE DK-PO-LINE-NBR          TO PV-DISPLAY-PO-LINE-NBR       11900066
119100     MOVE DK-OTPK-QTY             TO PV-DISPLAY-OTPK              11910066
119200     STRING ' 4200-DECREASE-TSHPSUM'                              11920066
119300            '  '                                                  11930066
119400            PV-DISPLAY-PO-NBR '-'                                 11940066
119500            PV-DISPLAY-OLD-SEQ '-'                                11950066
119600            PV-DISPLAY-COMB '-'                                   11960066
119700            PV-DISPLAY-PO-LINE-NBR '-'                            11970066
119800            PV-DISPLAY-OTPK                                       11980066
119900              DELIMITED BY SIZE                                   11990066
120000         INTO PV-CICS-MSG-AREA.                                   12000065
120100     PERFORM 9990-WRITE-CICS.                                     12010065
120200                                                                  12020047
120300     EXEC SQL                                                     12030047
120400       UPDATE TSHPSUM                                             12040047
120500         SET TOT_CART_CNT     = (TOT_CART_CNT - 1)                12050047
120600         WHERE PO_NBR         = :DK-PO-NBR                        12060047
120700           AND PKSL_SEQ_NBR   = :SU044-ORIG-PKSL-SEQ-NBR          12070047
120800           AND CART_COMB_NBR  = :DK-DECREASE-COMB                 12080047
120900           AND PO_LNE_NBR     = :DK-PO-LINE-NBR                   12090047
121000           AND OTPK_UNT_QTY   = :DK-OTPK-QTY                      12100047
121100           AND TOT_CART_CNT   > 0                                 12110047
121200     END-EXEC                                                     12120047
121300                                                                  12130047
121400     EVALUATE TRUE                                                12140047
121500         WHEN SQLCODE = ZERO                                      12150047
121600         WHEN SQLCODE = +100                                      12160047
121700             CONTINUE                                             12170047
121800         WHEN SQLWARN0 NOT = SPACES                               12180047
121900         WHEN SQLCODE  NOT = ZERO                                 12190047
122000             SET SU044-INVALID-SQL                                12200047
122100                 PS-ERROR              TO TRUE                    12210047
122200             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           12220047
122300             MOVE SU044-NEW-REC-SEQ-NBR                           12230047
122400                                      TO PV-DISPLAY-RCVR-SEQ-NBR  12240047
122500             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   12250047
122600             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   12260047
122700             STRING   ' SUKUT708-4200-'                           12270047
122800                      ' CALLED BY-'                               12280047
122900                      SU044-PROGRAM-NAME                          12290047
123000                      ' PO='                                      12300047
123100                      PV-DISPLAY-PO-NBR                           12310047
123200                      ' RCVR='                                    12320047
123300                      PV-DISPLAY-RCVR-SEQ-NBR                     12330047
123400                      ' OPER='                                    12340047
123500                      PV-DISPLAY-OPER-UNT-ID                      12350047
123600                      DELIMITED BY SIZE                           12360047
123700                                      INTO PV-CICS-MSG-AREA       12370047
123800             PERFORM 9999-WRITE-TO-CSSL                           12380047
123900             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      12390047
124000             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 12400061
124100             STRING 'SUKUT708-4200-SQLCODE='                      12410061
124200                     PV-DISPLAY-SQLCODE                           12420061
124300                    '  PO-'  PV-DISPLAY-PO-NBR                    12430061
124400                             DELIMITED BY SIZE                    12440061
124500                        INTO SU044-CRA-RET-MSG                    12450061
124600     END-EVALUATE.                                                12460047
124700                                                                  12470047
124800 4300-INCREASE-TSHPSUM.                                           12480047
124900     IF  DK-INCREASE-COMB  =  ZERO                                12490067
125000         MOVE PV-COMB-TO-INCREASE  TO  DK-INCREASE-COMB           12500067
125100     END-IF.                                                      12510067
125200                                                                  12520067
125300     MOVE DK-PO-NBR               TO PV-DISPLAY-PO-NBR            12530066
125400     MOVE SU044-NEW-PKSL-SEQ-NBR  TO PV-DISPLAY-NEW-SEQ           12540066
125500     MOVE DK-INCREASE-COMB        TO PV-DISPLAY-COMB              12550066
125600     MOVE DK-PO-LINE-NBR          TO PV-DISPLAY-PO-LINE-NBR       12560066
125700     MOVE DK-OTPK-QTY             TO PV-DISPLAY-OTPK              12570066
125800     STRING ' 4300-INCREASE-TSHPSUM'                              12580067
125900            '  '                                                  12590066
126000            PV-DISPLAY-PO-NBR '-'                                 12600066
126100            PV-DISPLAY-NEW-SEQ '-'                                12610066
126200            PV-DISPLAY-COMB '-'                                   12620066
126300            PV-DISPLAY-PO-LINE-NBR '-'                            12630066
126400            PV-DISPLAY-OTPK                                       12640066
126500              DELIMITED BY SIZE                                   12650066
126600         INTO PV-CICS-MSG-AREA.                                   12660065
126700     PERFORM 9990-WRITE-CICS.                                     12670065
126800                                                                  12680047
126900     EXEC SQL                                                     12690047
127000       UPDATE TSHPSUM                                             12700047
127100         SET TOT_CART_CNT     = (TOT_CART_CNT + 1)                12710047
127200         WHERE PO_NBR         = :DK-PO-NBR                        12720047
127300           AND PKSL_SEQ_NBR   = :SU044-NEW-PKSL-SEQ-NBR           12730047
127400           AND CART_COMB_NBR  = :DK-INCREASE-COMB                 12740047
127500           AND PO_LNE_NBR     = :DK-PO-LINE-NBR                   12750047
127600           AND OTPK_UNT_QTY   = :DK-OTPK-QTY                      12760047
127700     END-EXEC                                                     12770047
127800                                                                  12780047
127900     EVALUATE TRUE                                                12790047
128000         WHEN SQLCODE = ZERO                                      12800047
128100         WHEN SQLCODE = +100                                      12810047
128200             CONTINUE                                             12820047
128300         WHEN SQLWARN0 NOT = SPACES                               12830047
128400         WHEN SQLCODE  NOT = ZERO                                 12840047
128500             SET SU044-INVALID-SQL                                12850047
128600                 PS-ERROR              TO TRUE                    12860047
128700             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           12870047
128800             MOVE SU044-NEW-REC-SEQ-NBR                           12880047
128900                                      TO PV-DISPLAY-RCVR-SEQ-NBR  12890047
129000             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   12900047
129100             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   12910047
129200             STRING   ' SUKUT708-4300-'                           12920047
129300                      ' CALLED BY-'                               12930047
129400                      SU044-PROGRAM-NAME                          12940047
129500                      ' PO='                                      12950047
129600                      PV-DISPLAY-PO-NBR                           12960047
129700                      ' RCVR='                                    12970047
129800                      PV-DISPLAY-RCVR-SEQ-NBR                     12980047
129900                      ' OPER='                                    12990047
130000                      PV-DISPLAY-OPER-UNT-ID                      13000047
130100                      DELIMITED BY SIZE                           13010047
130200                                      INTO PV-CICS-MSG-AREA       13020047
130300             PERFORM 9999-WRITE-TO-CSSL                           13030047
130400             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      13040047
130500             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 13050061
130600             STRING 'SUKUT708-4300-SQLCODE='                      13060061
130700                     PV-DISPLAY-SQLCODE                           13070061
130800                    '  PO-'  PV-DISPLAY-PO-NBR                    13080061
130900                             DELIMITED BY SIZE                    13090061
131000                        INTO SU044-CRA-RET-MSG                    13100061
131100     END-EVALUATE.                                                13110047
131200                                                                  13120047
131300 4400-INSERT-TSHPSUM.                                             13130047
131400     MOVE DK-PO-NBR              TO PV-DISPLAY-PO-NBR             13140066
131500     MOVE SU044-NEW-PKSL-SEQ-NBR TO PV-DISPLAY-NEW-SEQ            13150066
131600     MOVE PV-COMB-TO-INCREASE    TO PV-DISPLAY-COMB               13160066
131700     MOVE DK-PO-LINE-NBR         TO PV-DISPLAY-PO-LINE-NBR        13170066
131800     MOVE DK-OTPK-QTY            TO PV-DISPLAY-OTPK               13180066
131900     STRING ' 4400-INSERT-TSHPSUM  '                              13190067
132000            '  '                                                  13200066
132100            PV-DISPLAY-PO-NBR '-'                                 13210066
132200            PV-DISPLAY-NEW-SEQ '-'                                13220066
132300            PV-DISPLAY-COMB '-'                                   13230066
132400            PV-DISPLAY-PO-LINE-NBR '-'                            13240066
132500            PV-DISPLAY-OTPK                                       13250066
132600              DELIMITED BY SIZE                                   13260066
132700         INTO PV-CICS-MSG-AREA.                                   13270065
132800     PERFORM 9990-WRITE-CICS.                                     13280065
132900                                                                  13290047
133000     EXEC SQL                                                     13300047
133100       INSERT INTO TSHPSUM                                        13310047
133200           ( PO_NBR                                               13320047
133300            ,PKSL_SEQ_NBR                                         13330047
133400            ,CART_COMB_NBR                                        13340047
133500            ,PO_LNE_NBR                                           13350047
133600            ,TOT_CART_CNT                                         13360047
133700            ,OTPK_UNT_QTY                                         13370047
133800            ,CRE_TMST )                                           13380047
133900         VALUES                                                   13390047
134000           ( :DK-PO-NBR                                           13400047
134100            ,:SU044-NEW-PKSL-SEQ-NBR                              13410047
134200            ,:PV-COMB-TO-INCREASE                                 13420047
134300            ,:DK-PO-LINE-NBR                                      13430047
134400            , 1                                                   13440047
134500            ,:DK-OTPK-QTY                                         13450047
134600            , CURRENT TIMESTAMP )                                 13460047
134700     END-EXEC                                                     13470047
134800                                                                  13480047
134900     EVALUATE TRUE                                                13490047
135000         WHEN SQLCODE = ZERO                                      13500047
135100         WHEN SQLCODE = +100                                      13510047
135200             CONTINUE                                             13520047
135300         WHEN SQLWARN0 NOT = SPACES                               13530047
135400         WHEN SQLCODE  NOT = ZERO                                 13540047
135500             SET SU044-INVALID-SQL                                13550047
135600                 PS-ERROR              TO TRUE                    13560047
135700             MOVE SU044-PO        TO  PV-DISPLAY-PO-NBR           13570047
135800             MOVE SU044-NEW-REC-SEQ-NBR                           13580047
135900                                      TO PV-DISPLAY-RCVR-SEQ-NBR  13590047
136000             MOVE SHUUPC-TRN-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR   13600047
136100             MOVE DK-OPER-UNT-ID      TO PV-DISPLAY-OPER-UNT-ID   13610047
136200             MOVE PV-COMB-TO-INCREASE TO PV-DISPLAY-COMB          13620062
136300             MOVE SU044-NEW-PKSL-SEQ-NBR TO PV-DISPLAY-NEW-SEQ    13630063
136400             STRING   ' SUKUT708-4400-'                           13640063
136500                      ' PO='                                      13650062
136600                      PV-DISPLAY-PO-NBR                           13660062
136700                      ' RCVR='                                    13670062
136800                      PV-DISPLAY-RCVR-SEQ-NBR                     13680062
136900                      ' OPER='                                    13690062
137000                      PV-DISPLAY-OPER-UNT-ID                      13700062
137100                      DELIMITED BY SIZE                           13710062
137200                                      INTO PV-CICS-MSG-AREA       13720062
137300             PERFORM 9999-WRITE-TO-CSSL                           13730062
137400             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      13740062
137500             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 13750062
137600             STRING   ' SUKUT708-4400-'                           13760063
137700                      ' PO='                                      13770062
137800                       PV-DISPLAY-OPER-UNT-ID '-'                 13780062
137900                       PV-DISPLAY-PO-NBR      '-'                 13790062
138000                       PV-DISPLAY-RCVR-SEQ-NBR '-'                13800062
138100                       PV-DISPLAY-PO-LINE-NBR                     13810062
138200                      '  COMB-'                                   13820062
138300                       PV-DISPLAY-COMB                            13830062
138400                      '  SEQ-'                                    13840063
138500                       PV-DISPLAY-NEW-SEQ                         13850064
138600                      '  SQLCODE='                                13860062
138700                       PV-DISPLAY-SQLCODE                         13870062
138800                             DELIMITED BY SIZE                    13880061
138900                        INTO SU044-CRA-RET-MSG                    13890061
139000     END-EVALUATE.                                                13900047
139100                                                                  13910047
139200                                                                  13920050
139300 8000-CHECK-FOR-LOGGING.                                          13930050
139400                                                                  13940050
139500     EXEC SQL                                                     13950050
139600          SELECT FUNC_TXT                                         13960050
139700            INTO :KRPRPM-FUNC-TXT                                 13970050
139800            FROM TKRPRPM                                          13980050
139900           WHERE LOC_ID            = 90                           13990050
140000             AND INTFC_SYS_CDE    = 'KHL'                         14000050
140100             AND SYS_PRC_FUNC_CDE = 'CSSLFA'                      14010050
140200             AND FUNC_PRC_STAT_CDE = 'AC'                         14020050
140300     END-EXEC.                                                    14030050
140400                                                                  14040050
140500     EVALUATE TRUE                                                14050050
140600         WHEN SQLCODE = ZERO                                      14060050
140700             IF KRPRPM-FUNC-TXT = 'Y'                             14070050
140800                 SET PS-SHOW-DEBUG-INFO  TO TRUE                  14080050
140900             ELSE                                                 14090050
141000                 SET PS-DONT-SHOW-DEBUG-INFO TO TRUE              14100050
141100             END-IF                                               14110050
141200         WHEN SQLCODE = +100                                      14120050
141300             SET PS-DONT-SHOW-DEBUG-INFO TO TRUE                  14130050
141400         WHEN SQLWARN0 NOT = SPACES                               14140050
141500         WHEN SQLCODE NOT EQUAL ZERO                              14150050
141600             SET PS-ERROR                                         14160050
141700                 SU044-INVALID-SQL    TO TRUE                     14170050
141800             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       14180050
141900             STRING   ' SUKUT708-8000-'                           14190050
142000                      ' CALLED BY-'                               14200050
142100                      SU044-PROGRAM-NAME                          14210050
142200                      '  SQLCODE='                                14220050
142300                      PV-DISPLAY-SQLCODE                          14230050
142400                      ' '                                         14240050
142500                      DELIMITED BY SIZE                           14250050
142600                                      INTO PV-CICS-MSG-AREA       14260050
142700             PERFORM 9999-WRITE-TO-CSSL                           14270050
142800             MOVE '8000-'                TO SU044-CRA-REQ-ID      14280050
142900             MOVE PV-CICS-MSG-AREA      TO SU044-CRA-RET-MSG      14290050
143000             SET SU044-INVALID-SQL TO TRUE                        14300050
143100             MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                 14310061
143200             STRING 'SUKUT708-8000-SQLCODE='                      14320061
143300                     PV-DISPLAY-SQLCODE                           14330061
143400                    '  PO-'  PV-DISPLAY-PO-NBR                    14340061
143500                             DELIMITED BY SIZE                    14350061
143600                        INTO SU044-CRA-RET-MSG                    14360061
143700             PERFORM 9998-RETURN                                  14370050
143800     END-EVALUATE.                                                14380050
143900                                                                  14390050
144000                                                                  14400050
144100 9990-WRITE-CICS.                                                 14410047
144200                                                                  14420047
144300* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  14430047
144400* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       14440047
144500* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 14450047
144600* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     14460001
144700* WRAPPED AROUND.                                                 14470001
144800                                                                  14480001
144900     EVALUATE TRUE                                                14490001
145000     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          14500001
145100         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 14510001
145200         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         14520001
145300         SET PT-MSG-IDX UP BY 1                                   14530001
145400     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          14540001
145500         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 14550001
145600         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         14560001
145700         SET PT-MSG-IDX               TO 1                        14570001
145800     END-EVALUATE                                                 14580001
145900                                                                  14590001
146000     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1              14600001
146100     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX)  14610001
146200                                                                  14620001
146300                                                                  14630001
146400*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    14640001
146500*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    14650001
146600*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              14660001
146700*                                                                 14670001
146800     IF PS-SHOW-DEBUG-INFO                                        14680001
146900         PERFORM 9991-WRITEQ                                      14690001
147000     END-IF                                                       14700001
147100     MOVE SPACES                      TO PV-CICS-MSG-AREA.        14710001
147200                                                                  14720001
147300                                                                  14730001
147400 9991-WRITEQ.                                                     14740001
147500     EXEC CICS                                                    14750001
147600         WRITEQ TD                                                14760001
147700         QUEUE(PC-LOG-QUEUE)                                      14770001
147800         FROM(PV-CICS-MSG-AREA)                                   14780001
147900         RESP(PV-CICS-RESPONSE)                                   14790001
148000     END-EXEC.                                                    14800001
148100                                                                  14810001
148200*-----------------------------------------------------------------14820001
148300*  RETURN TO CALLING PROGRAM                                      14830001
148400*-----------------------------------------------------------------14840001
148500 9998-RETURN.                                                     14850001
148600                                                                  14860001
148700     STRING ' 9998-RETURN'                                        14870001
148800         DELIMITED BY SIZE                                        14880001
148900         INTO PV-CICS-MSG-AREA.                                   14890001
149000     PERFORM 9990-WRITE-CICS.                                     14900001
149100     MOVE SU044-COMM-AREA               TO DFHCOMMAREA.           14910001
149200                                                                  14920001
149300     EXEC CICS                                                    14930001
149400          RETURN                                                  14940001
149500     END-EXEC.                                                    14950001
149600                                                                  14960001
149700                                                                  14970001
149800 9999-WRITE-TO-CSSL.                                              14980001
149900     STRING ' 9999-WRITE-TO-CSSL'                                 14990001
150000         DELIMITED BY SIZE                                        15000001
150100         INTO PV-CICS-MSG-AREA.                                   15010001
150200     PERFORM 9990-WRITE-CICS.                                     15020001
150300     MOVE LENGTH OF PV-CICS-MSG-AREA2                             15030001
150400       TO PV-COMMAREA-LENGTH                                      15040001
150500     EXEC CICS                                                    15050001
150600          WRITEQ TD                                               15060001
150700           QUEUE   ('CSSL')                                       15070001
150800            FROM   (PV-CICS-MSG-AREA2)                            15080001
150900          LENGTH   (PV-COMMAREA-LENGTH)                           15090001
151000            RESP   (PV-CICS-RESP)                                 15100001
151100     END-EXEC.                                                    15110001
151200                                                                  15120001
151300*                                                                 15130001
151400 9999-WRITE-CICS-LOG-MSG.                                         15140001
151500     STRING ' 9999-WRITE-CICS-LOG-MSG'                            15150001
151600         DELIMITED BY SIZE                                        15160001
151700         INTO PV-CICS-MSG-AREA.                                   15170001
151800     PERFORM 9990-WRITE-CICS.                                     15180001
151900     MOVE 'SUKUT708'                 TO DP013-PROGRAM.            15190001
152000     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           15200001
152100     INITIALIZE DP013-SRC-TASK-NUMBER                             15210001
152200                DP013-STACK.                                      15220001
152300     SET DP013-LINK-RETURN           TO TRUE.                     15230001
152400                                                                  15240001
152500     EXEC CICS                                                    15250001
152600         LINK                                                     15260001
152700             PROGRAM   (DP013-NAME)                               15270001
152800             COMMAREA  (DP013-PARAMETERS)                         15280001
152900             LENGTH    (DP013-LENGTH)                             15290001
153000     END-EXEC.                                                    15300001
153100                                                                  15310001
153200                                                                  15320001
153300 9999-FINAL-DUMP.                                                 15330001
153400*  IF AN ERROR HAS OCCURRED, DUMP THE MESSAGE TABLE WHICH WILL    15340001
153500*  CONTAIN THE LAST 200 TRACE DISPLAYS.  IF THE TABLE EVER        15350001
153600*  OVERFLOW, YOU WILL SEE THE SEQUENCE NUMBERS WRAP.  UNUSED      15360001
153700*  OCCRENCES ARE NOT DISPLAYED.                                   15370001
153800*                                                                 15380001
153900                                                                  15390001
154000     STRING ' 9999-FINAL-DUMP'                                    15400001
154100         DELIMITED BY SIZE                                        15410001
154200         INTO PV-CICS-MSG-AREA                                    15420001
154300     PERFORM 9990-WRITE-CICS.                                     15430001
154400                                                                  15440001
154500     EXEC CICS ENQ                                                15450001
154600         RESOURCE(PC-LOG-QUEUE)                                   15460001
154700     END-EXEC                                                     15470001
154800                                                                  15480001
154900     MOVE PV-EIBTASKN             TO PV-DISPLAY-TASK.             15490001
155000     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 15500001
155100                     PT-MSG-IDX > PC-MSG-TABLE-SIZE               15510001
155200         IF PT-MSG-SEQ (PT-MSG-IDX) > ZERO                        15520001
155300             MOVE PT-MSG-SEQ (PT-MSG-IDX)                         15530001
155400                                  TO PV-DISPLAY-MSG-NBR           15540001
155500             STRING ' ' PV-DISPLAY-TASK ' '                       15550001
155600                  PV-DISPLAY-MSG-NBR ' '                          15560001
155700                  PT-MSG-LINE (PT-MSG-IDX)                        15570001
155800                  DELIMITED BY SIZE                               15580001
155900                                INTO PV-CICS-MSG-AREA             15590001
156000             PERFORM 9991-WRITEQ                                  15600001
156100         END-IF                                                   15610001
156200     END-PERFORM.                                                 15620001
156300                                                                  15630001
156400     SET PT-MSG-IDX               TO 1.                           15640001
156500     SET PS-DONT-DUMP-TO-LOG      TO TRUE.                        15650001
156600                                                                  15660001
156700     EXEC CICS DEQ                                                15670001
156800         RESOURCE(PC-LOG-QUEUE)                                   15680001
156900     END-EXEC.                                                    15690001
157000                                                                  15700001
