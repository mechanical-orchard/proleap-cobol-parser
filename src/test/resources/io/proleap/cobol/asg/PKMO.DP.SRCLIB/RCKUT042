000100 IDENTIFICATION DIVISION.                                         00010018
000300 PROGRAM-ID.         RCKUT042.                                    00030018
000400 AUTHOR.             LARRY SCHLEICHER - STRATAGEM                 00040018
000500 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00050018
000600 DATE-WRITTEN.       05-28-96.                                    00060018
000700 DATE-COMPILED.                                                   00070018
000800                                                                  00080018
000900******************************************************************00090018
001000*  THIS PROGRAM PREPARES THE ASN TRANSCRIPTION FILE              *00100018
001100*  TO BE PROCESSED BY RCKUP006 UNDER THE DB2 CHECKPOINT RESTART  *00110018
001200*  SYSTEM.                                                       *00120018
001300*                                                                *00130018
001400*  THE PROGRAM READS AN ASN TRANSCRIPTION FILE AND PASSES IT TO  *00140018
001500*  THE TRANSACTION PREPARATION MODULE (DPKUT900) WHICH DOES SOME *00150018
001600*  MORE PROCESSING ON THE RECORDS AND WRITES THE REFORMATTED     *00160018
001700*  RECORD OUT TO A SEQUENTIAL FILE.                              *00170018
001800*                                                                *00180018
001900*  THE JOB NAME AND PLAN NAME USED TO IDENTIFY THE CHECKPOINT    *00190018
002000*  CONTROL RECORD TO BE USED ARE SUPPLIED THROUGH THE 'PARM'     *00200018
002100*  STATEMENT ON THE EXEC CARD IN THE JCL.                        *00210018
002200*                                                                *00220018
002300*  THE PROGRAM COMMUNICATES WITH THE TRANSACTION PREPARATION     *00230018
002400*  MODULE USING FUNCTION CODES (OPEN, WRITE & CLOSE) AND CHECKS  *00240018
002500*  THE RETURN CODE AFTER EACH REQUEST.  IF AN INVALID RETURN     *00250018
002600*  CODE IS RECEIVED ANY INFORMATION THAT MAYBE HELPFUL IN RESOL- *00260018
002700*  VING THE BAD RETURN CODE IS DISPLAYED ON SYSOUT AND THE PRO-  *00270018
002800*  GRAM ABENDS.                                                  *00280018
002900*                                                                *00290018
003000*  DB2 TABLES:                                                   *00300018
003100*    - N/A                                                       *00310018
003200*                                                                *00320018
003300*  INPUT FILES:                                                  *00330018
003400*    - ASN TRANSCRIPTION FILE                  DDNAME = INP01    *00340018
003500*                                                                *00350018
003600*  OUTPUT FILES:                                                 *00360018
003700*    - N/A                                                       *00370018
003800******************************************************************00380018
003900*  CHANGES:                                                      *00390018
004000*                                                                *00400022
260107* CHG0260107 - 08-19-21  -  JIM HUNTER                            00401022
260107*              ADD COPYBOOK DPWS990 TO MAKE DPKUT900 CALL DYNAMIC 00402022
004100******************************************************************00410018
004200 EJECT                                                            00420018
004300 ENVIRONMENT DIVISION.                                            00430018
004400*                                                                 00440018
004500 CONFIGURATION SECTION.                                           00450018
004600                                                                  00460018
004700 SOURCE-COMPUTER.    IBM-3090.                                    00470018
004800 OBJECT-COMPUTER.    IBM-3090.                                    00480018
004900                                                                  00490018
005000 INPUT-OUTPUT SECTION.                                            00500018
005100                                                                  00510018
005200 FILE-CONTROL.                                                    00520018
005300                                                                  00530018
005400     SELECT ASN-TRANSCRIPTION-FILE       ASSIGN TO INP01.         00540018
005500                                                                  00550018
005600 EJECT                                                            00560018
005700 DATA DIVISION.                                                   00570018
005800*                                                                 00580018
005900 FILE SECTION.                                                    00590018
006000                                                                  00600018
006100 FD  ASN-TRANSCRIPTION-FILE                                       00610018
006200     LABEL RECORDS ARE STANDARD                                   00620018
006300     RECORDING MODE IS F                                          00630018
006400     BLOCK CONTAINS 0 RECORDS                                     00640018
006500     RECORD CONTAINS 600 CHARACTERS                               00650021
006600     DATA RECORD IS ASN-TRANSCRIPTION-RECORD.                     00660018
006700 01  ASN-TRANSCRIPTION-RECORD    PIC  X(600).                     00670021
006800                                                                  00680018
006900  EJECT                                                           00690018
007000*                                                                 00700018
007100*                                                                 00710018
007200 WORKING-STORAGE SECTION.                                         00720018
007300                                                                  00730018
007400 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00740018
007500                                                                  00750018
007600 01  PROGRAM-CONSTANTS.                                           00760018
007700     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'RCKUT042'. 00770018
007800     05  PC-TRAN-PREP-FUNC-CODES.                                 00780018
007900         10  PC-TRAN-PREP-FUNC-OPEN                               00790018
008000                                 PIC X(05)      VALUE 'OPEN '.    00800018
008100         10  PC-TRAN-PREP-FUNC-WRITE                              00810018
008200                                 PIC X(05)      VALUE 'WRITE'.    00820018
008300         10  PC-TRAN-PREP-FUNC-CLOSE                              00830018
008400                                 PIC X(05)      VALUE 'CLOSE'.    00840018
008500     05  PC-TRANS-RECORD-LENGTH  PIC S9(04)     VALUE +600 COMP.  00850021
008600     05  PC-JOB-NAME             PIC X(08)      VALUE 'RCK010  '. 00860018
008700     05  PC-PLAN-NAME            PIC X(08)      VALUE 'RCKUP006'. 00870018
008800 EJECT                                                            00880018
008900                                                                  00890018
009000 01  PROGRAM-VARIABLES.                                           00900018
009100     05  PV-CHECKPOINT-TYPE      PIC X(01)      VALUE SPACE.      00910018
009200         88  CONTROL-BREAK                      VALUE 'C'.        00920018
009300         88  LOGICAL-TRANSACTION                VALUE 'L'.        00930018
009400         88  TIME-INTERVAL                      VALUE 'T'.        00940018
009500         88  REQUESTED-BY-PROGRAM               VALUE 'R'.        00950018
009600     05  PV-ASN-TRANS-EOF-SW     PIC X(01)      VALUE 'N'.        00960018
009700         88  ASN-TRANS-EOF                      VALUE 'Y'.        00970018
009800     05  PV-FIRST-TRANS-READ-SW  PIC X(01)      VALUE 'Y'.        00980018
009900         88  FIRST-TRANS-READ                   VALUE 'Y'.        00990018
010000     05  PV-SKIP-CLOSE-SW        PIC X(01)      VALUE 'N'.        01000018
010100         88  SKIP-CLOSE                         VALUE 'Y'.        01010018
010200     05  PV-CURRENT-DATE              PIC X(10).                  01020018
010300 EJECT                                                            01030018
010400*                                                                 01040018
010500*     ASN TRANSCRIPTION RECORD LAYOUTS.                           01050018
010600*                                                                 01060018
010700     COPY RCRD001.                                                01070018
010800 EJECT                                                            01080018
010900*                                                                 01090018
011000*     TRANSACTION PREPARATION MODULE LINKAGE SECTION.             01100018
011100*                                                                 01110018
260107     COPY DPWS990.                                                01120022
011200                                                                  01121022
011200     COPY DPLS000.                                                01122022
011300 EJECT                                                            01130018
011400*                                                                 01140018
011500*     SQL COMMUNICATIONS WORK AREA.                               01150018
011600*                                                                 01160018
011700     EXEC SQL                                                     01170018
011800         INCLUDE SQLCA                                            01180018
011900     END-EXEC.                                                    01190018
012000     COPY SQLCA2.                                                 01200018
012100 EJECT                                                            01210018
012200 PROCEDURE DIVISION.                                              01220018
012300                                                                  01230018
012400                                                                  01240018
012500******************************************************************01250018
012600* A100-MAINLINE-PROCESSING                                       *01260018
012700*      CONTROLS FLOW OF THE PROGRAM.                             *01270018
012800******************************************************************01280018
012900                                                                  01290018
013000 A100-MAINLINE-PROCESSING.                                        01300018
013100                                                                  01310018
013200     OPEN INPUT ASN-TRANSCRIPTION-FILE.                           01320018
013300                                                                  01330018
013400     ACCEPT PC-JOB-NAME FROM SYSIN.                               01340018
013500                                                                  01350018
013600     EXEC SQL                                                     01360018
013700          SET :PV-CURRENT-DATE = CURRENT DATE                     01370018
013800     END-EXEC.                                                    01380018
013900                                                                  01390018
014000                                                                  01400018
014100     MOVE 'Y' TO PV-FIRST-TRANS-READ-SW.                          01410018
014200                                                                  01420018
014300     PERFORM B200-READ-ASN-TRANS-FILE.                            01430018
014400                                                                  01440018
014500     IF ASN-TRANS-EOF                                             01450018
014600        SET SKIP-CLOSE TO TRUE                                    01460018
014700        MOVE +1 TO RETURN-CODE                                    01470018
014800     ELSE                                                         01480018
014900        PERFORM B100-ISSUE-OPEN-REQUEST                           01490018
015000     END-IF.                                                      01500018
015100                                                                  01510018
015200     PERFORM UNTIL ASN-TRANS-EOF                                  01520018
015300         IF ASN-TRANS-EOF                                         01530018
015400             CONTINUE                                             01540018
015500         ELSE                                                     01550018
015600             IF FIRST-TRANS-READ                                  01560018
015700                 MOVE 'N' TO PV-FIRST-TRANS-READ-SW               01570018
015800             ELSE                                                 01580018
015900                 CONTINUE                                         01590018
016000             END-IF                                               01600018
016100             PERFORM C100-MOVE-TRANS-DATA                         01610018
016200         END-IF                                                   01620018
016300         PERFORM B200-READ-ASN-TRANS-FILE                         01630018
016400     END-PERFORM.                                                 01640018
016500                                                                  01650018
016600     CLOSE ASN-TRANSCRIPTION-FILE.                                01660018
016700                                                                  01670018
016800     IF SKIP-CLOSE                                                01680018
016900        NEXT SENTENCE                                             01690018
017000     ELSE                                                         01700018
017100        PERFORM B300-ISSUE-CLOSE-REQUEST                          01710018
017200     END-IF.                                                      01720018
017300                                                                  01730018
017400     GOBACK.                                                      01740018
017500 EJECT                                                            01750018
017600******************************************************************01760018
017700* B100-ISSUE-OPEN-REQUEST.                                       *01770018
017800*      ISSUE AN 'OPEN' REQUEST TO THE TRANSACTION PREPARATION    *01780018
017900*      MODULE.                                                   *01790018
018000*                                                                *01800018
018100*      PERFORMED BY A100-MAINLINE-PROCESSING.                    *01810018
018200******************************************************************01820018
018300                                                                  01830018
018400 B100-ISSUE-OPEN-REQUEST.                                         01840018
018500                                                                  01850018
018600     MOVE PC-TRAN-PREP-FUNC-OPEN TO DP000-FUNC-CODE.              01860018
018700     MOVE PC-JOB-NAME TO DP000-JOB-NAME.                          01870018
018800     MOVE PC-PLAN-NAME TO DP000-PLAN-NAME.                        01880018
018900                                                                  01890018
019000     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         01900018
019100                                                                  01910018
019200     MOVE DP000-CKPT-TYPE-CODE TO PV-CHECKPOINT-TYPE.             01920018
019300 EJECT                                                            01930018
019400******************************************************************01940018
019500* B200-READ-ASN-TRANS-FILE.                                      *01950018
019600*      READ A ASN TRANSACTION.  IF END-OF-FILE STOP PROCESSING;  *01960018
019700*      IF A RECORD IS READ GATHER WHATEVER OTHER DATA IS         *01970018
019800*      NECESSARY TO TAKE CHECKPOINTS BASED ON THE TYPE OF CHECK- *01980018
019900*      POINTS BEING TAKEN BY THE MAINTENANCE PROGRAM AND ISSUE   *01990018
020000*      A WRITE REQUEST TO THE TRANSACTION PREPARATION MODULE.    *02000018
020100*                                                                *02010018
020200*      PERFORMED BY A100-MAINLINE-PROCESSING.                    *02020018
020300******************************************************************02030018
020400                                                                  02040018
020500 B200-READ-ASN-TRANS-FILE.                                        02050018
020600                                                                  02060018
020700     READ ASN-TRANSCRIPTION-FILE INTO                             02070018
020800                                 RC001-ASN-TRANSCRIPTION-RECORD   02080018
020900         AT END                                                   02090018
021000           MOVE 'Y' TO PV-ASN-TRANS-EOF-SW.                       02100018
021100                                                                  02110018
021200 EJECT                                                            02120018
021300******************************************************************02130018
021400* B300-ISSUE-CLOSE-REQUEST.                                      *02140018
021500*      ISSUE A 'CLOSE' REQUEST TO THE TRANSACTION PREPARATION    *02150018
021600*      MODULE.                                                   *02160018
021700*                                                                *02170018
021800*      PERFORMED BY A100-MAINLINE-PROCESSING.                    *02180018
021900******************************************************************02190018
022000                                                                  02200018
022100 B300-ISSUE-CLOSE-REQUEST.                                        02210018
022200                                                                  02220018
022300     MOVE PC-TRAN-PREP-FUNC-CLOSE TO DP000-FUNC-CODE.             02230018
022400     MOVE PC-JOB-NAME TO DP000-JOB-NAME.                          02240018
022500     MOVE PC-PLAN-NAME TO DP000-PLAN-NAME.                        02250018
022600                                                                  02260018
022700     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02270018
022800 EJECT                                                            02280018
022900******************************************************************02290018
023000* C100-MOVE-TRANS-DATA.                                          *02300018
023100*      THIS ROUTINE BUILDS THE TRANSACTION RECORD AND ISSUES A   *02310018
023200*      WRITE REQUEST TO THE TRANSACTION PREPARATION MODULE.      *02320018
023300*                                                                *02330018
023400*      PERFORMED BY B200-READ-ASN-TRANS-FILE                     *02340018
023500******************************************************************02350018
023600                                                                  02360018
023700 C100-MOVE-TRANS-DATA.                                            02370018
023800                                                                  02380018
023900     IF RC001-PO-LINE-NBR-HDR                                     02390018
024000         MOVE 'Y' TO DP000-CHECKPOINT-IND                         02400018
024100     ELSE                                                         02410018
024200         MOVE ' ' TO DP000-CHECKPOINT-IND                         02420018
024300     END-IF.                                                      02430018
024400                                                                  02440018
024500     MOVE PC-TRANS-RECORD-LENGTH TO DP000-TRANS-REC-LENGTH.       02450018
024600                                                                  02460018
024700     MOVE RC001-ASN-TRANSCRIPTION-RECORD TO DP000-TRANS-REC.      02470018
024800                                                                  02480018
024900     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02490018
025000     MOVE PC-JOB-NAME TO DP000-JOB-NAME.                          02500018
025100     MOVE PC-PLAN-NAME TO DP000-PLAN-NAME.                        02510018
025200                                                                  02520018
025300     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02530018
025400 EJECT                                                            02540018
025500*                                                                 02550018
025600*     TRANSACTION PREPARATION MODULE CALL AND ERROR ROUTINES.     02560018
025700*                                                                 02570018
025800 EJECT                                                            02580018
025900     COPY DPPD000.                                                02590018
