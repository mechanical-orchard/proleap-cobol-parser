000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.      XSKRP010.                                       00020064
000300 AUTHOR.          DOUG JONES.                                     00030003
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040003
000500 DATE-WRITTEN.    01/17/2003.                                     00050003
000600 DATE-COMPILED.                                                   00060003
000700******************************************************************00070003
000800**XS DOMAIN TABLE INTEGRITY PROCESS - FOR TABLE XST_VND_DEPT      00080052
000900******************************************************************00090003
001000**THIS PROGRAM VALIDATES THE DATA IN THE XS DOMAIN IS THE SAME    00100003
001100**AS THE DATA IN THE SOR                                          00110003
001200******************************************************************00120003
001300 ENVIRONMENT DIVISION.                                            00130003
001400 CONFIGURATION SECTION.                                           00140003
001500 SOURCE-COMPUTER.        IBM-3090.                                00150003
001600 OBJECT-COMPUTER.        IBM-3090.                                00160003
001700 INPUT-OUTPUT SECTION.                                            00170003
001800 FILE-CONTROL.                                                    00180003
001900                                                                  00190003
002000     SELECT SKIP-RECD-CNTL-FILE                                   00200005
002100            ASSIGN TO INP01.                                      00210003
002400     SELECT SOR-VNDDPT-EXTRACT-FILE                               00240052
002500            ASSIGN TO INP02.                                      00250092
002600     SELECT XS-VNDDPT-EXTRACT-FILE                                00260052
002700            ASSIGN TO INP03.                                      00270092
002800     SELECT XS-VNDDPT-INTEG-RPT-FILE                              00280052
002900            ASSIGN TO RPT01.                                      00290006
003000                                                                  00300003
003100 DATA DIVISION.                                                   00310003
003200 FILE SECTION.                                                    00320003
003300                                                                  00330003
003400 FD  SKIP-RECD-CNTL-FILE                                          00340005
003500     RECORDING MODE F                                             00350003
003600     BLOCK CONTAINS 0 RECORDS                                     00360003
003700     LABEL RECORDS ARE OMITTED                                    00370003
003800     DATA RECORD IS SKIP-RECD-CNTL-RECORD.                        00380005
003900 01  SKIP-RECD-CNTL-RECORD            PIC X(080).                 00390034
004700                                                                  00470005
004800 FD  SOR-VNDDPT-EXTRACT-FILE                                      00480052
004900     RECORDING MODE F                                             00490003
005000     BLOCK CONTAINS 0 RECORDS                                     00500003
005100     LABEL RECORDS ARE OMITTED                                    00510003
005200     DATA RECORD IS SOR-VNDDPT-EXTRACT-RECORD.                    00520052
005300 01  SOR-VNDDPT-EXTRACT-RECORD       PIC X(100).                  00530062
005400                                                                  00540034
005500 FD  XS-VNDDPT-EXTRACT-FILE                                       00550052
005600     RECORDING MODE F                                             00560003
005700     BLOCK CONTAINS 0 RECORDS                                     00570003
005800     LABEL RECORDS ARE OMITTED                                    00580003
005900     DATA RECORD IS XS-VNDDPT-EXTRACT-RECORD.                     00590052
006000 01  XS-VNDDPT-EXTRACT-RECORD        PIC X(009).                  00600062
006100                                                                  00610003
006200 FD  XS-VNDDPT-INTEG-RPT-FILE                                     00620052
006300     RECORDING MODE IS F                                          00630006
006400     BLOCK CONTAINS 0  RECORDS.                                   00640006
006500 01  XS-VNDDPT-INTEG-RPT-RECORD      PIC  X(132).                 00650065
006600                                                                  00660006
006700 WORKING-STORAGE SECTION.                                         00670003
006800                                                                  00680003
006900 01  FILLER                              PIC X(41)                00690034
007000     VALUE 'WORKING STORAGE STARTS HERE FOR XSKRP010'.            00700064
007100                                                                  00710003
007200 01  PS-PROGRAM-SWITCHES.                                         00720003
007300     05  PS-END-SKIP-RECD-FILE-SW        PIC X(01) VALUE 'N'.     00730005
007400         88  PS-END-SKIP-RECD-FILE                 VALUE 'Y'.     00740005
007500         88  PS-NOT-END-SKIP-RECD-FILE             VALUE 'N'.     00750005
007900     05  PS-END-OF-SOR-VNDDPT-EXTRCT-SW  PIC X(01) VALUE 'N'.     00790056
008000         88  PS-END-OF-SOR-VNDDPT-EXTRACT          VALUE 'Y'.     00800052
008100         88  PS-NOT-END-SOR-VNDDPT-EXTRACT         VALUE 'N'.     00810056
008200     05  PS-END-OF-XS-VNDDPT-EXRACT-SW   PIC X(01) VALUE 'N'.     00820052
008300         88  PS-END-OF-XS-VNDDPT-EXRACT            VALUE 'Y'.     00830052
008400         88  PS-NOT-END-OF-XS-VNDDPT-EXRACT        VALUE 'N'.     00840052
008500     05  PS-VNDDPT-DC-RET-CDE-ERROR-SW   PIC X(01) VALUE 'N'.     00850054
008600         88  PS-VNDDPT-DC-RET-CDE-ERROR            VALUE 'Y'.     00860054
008700         88  PS-NO-VNDDPT-DC-RET-CDE-ERROR         VALUE 'N'.     00870054
008800                                                                  00880003
008900 01  CC-SKIP-RECD-CNTL-FILE-LAYOUT.                               00890006
009000     05  CC-START-POINT                  PIC 9(05) VALUE ZEROS.   00900003
009100     05  FILLER                          PIC X(01) VALUE SPACES.  00910003
009200     05  CC-READ-FREQUENCY               PIC 9(05) VALUE ZEROS.   00920003
009300     05  FILLER                          PIC X(69) VALUE SPACES.  00930003
009800                                                                  00980006
009900 01  PC-PROGRAM-CONSTANTS.                                        00990003
010000     05  PC-CURRENT-PROGRAM-NAME         PIC X(08)  VALUE         01000007
010100                                                    'XSKRP010'.   01010064
010200     05  PC-REPORT-NBR-1                 PIC  9(01) VALUE 1.      01020007
010300     05  PC-ONE                          PIC  9(01) VALUE 1.      01030046
010400     05  PC-MAX-REPORT-LINES             PIC S9(05) VALUE +65     01040070
010500                                                    COMP-3.       01050034
010600     05  PC-NO-ERROR-MESSAGE             PIC  X(200) VALUE        01060036
010700         'NO ERRORS'.                                             01070036
010800                                                                  01080083
010900     05  PC-MISMATCHED-VNDR-DC-RET-CDE   PIC  X(45) VALUE         01090055
011000         'VENDOR DEPT DC RET CODES ARE NOT IN SYNCH    '.         01100087
011100                                                                  01110035
011200     05  PC-RCRD-MISSING-FRM-SOR-VNDDPT  PIC  X(45) VALUE         01120057
011300         'MATCHING DATA NOT FOUND ON THE SOR VNDDPT EXT'.         01130055
011400                                                                  01140021
011500     05  PC-RCRD-MISSING-FRM-XS-VNDDPT   PIC  X(45) VALUE         01150067
011600         'MATCHING DATA NOT FOUND ON THE XS VNDDPT EXT '.         01160087
011700                                                                  01170007
011800 01  PV-MISCELANEOUS.                                             01180007
011900     05  PV-PRINT-RECORD                 PIC X(133) VALUE SPACE.  01190063
012000     05  PV-LINE-SPACING                 PIC S9(04) VALUE ZEROES  01200034
012100                                                    COMP SYNC.    01210015
012200     05  PV-DC-RET-CDE                   PIC  X(02) VALUE SPACES. 01220055
012300                                                                  01230088
012400     05  PV-SOR-SAVED-KEY.                                        01240055
012500         10 PV-SOR-SAVED-KEY-ENT-ID      PIC  9(09) VALUE ZEROES. 01250066
012600         10 PV-SOR-SAVED-KEY-DEPT-NBR    PIC  9(04) VALUE ZEROES. 01260085
012700                                                                  01270054
012800     05  PV-SOR-CURRENT-KEY.                                      01280055
012900         10 PV-SOR-CURRENT-KEY-ENT-ID    PIC  9(09) VALUE ZEROES. 01290066
013000         10 PV-SOR-CURRENT-KEY-DEPT-NBR  PIC  9(04) VALUE ZEROES. 01300086
013100         10 FILLER REDEFINES                                      01310088
013200              PV-SOR-CURRENT-KEY-DEPT-NBR.                        01320088
013300          15 FILLER                       PIC  9(01).             01330086
013400          15 PV-SOR-CURRENT-KEY-DEPT-NBR3 PIC  9(03).             01340086
013500                                                                  01350066
013600     05  PV-XS-CURRENT-KEY.                                       01360066
013700         10 PV-XS-CURRENT-KEY-ENT-ID     PIC  9(09) VALUE ZEROES. 01370088
013800         10 PV-XS-CURRENT-KEY-DEPT-NBR   PIC  9(04) VALUE ZEROES. 01380088
013900                                                                  01390066
014000     05  PV-CURR-TIME.                                            01400066
014100         10 PV-CURR-TIME-HH              PIC  9(02) VALUE ZEROES. 01410088
014200         10 PV-CURR-TIME-MM              PIC  9(02) VALUE ZEROES. 01420088
014300         10 PV-CURR-TIME-SSHH            PIC  9(04) VALUE ZEROES. 01430088
014400                                                                  01440025
014500     05  PV-CURR-DATE-CCYYMMDD.                                   01450025
014600          10 PV-CURR-DATE-CCYY           PIC  9(04) VALUE ZEROES. 01460088
014700          10 PV-CURR-DATE-MM             PIC  9(02) VALUE ZEROES. 01470088
014800          10 PV-CURR-DATE-DD             PIC  9(02) VALUE ZEROES. 01480088
014900                                                                  01490003
015000 01  PV-PROGRAM-COUNTER.                                          01500007
015100     05  PV-PAGE-CNT                     PIC  9(05) VALUE ZEROS.  01510040
015200     05  PV-LINE-CNT                     PIC S9(07) VALUE ZEROS.  01520010
015300     05  PV-SOR-VNDDPT-RECS-READ-CNT     PIC  9(07) VALUE ZEROS.  01530052
015400     05  PV-SOR-VNDDPT-EXT-READ-SKP-CNT  PIC  9(09) VALUE ZEROS.  01540058
015500     05  PV-XS-EXTRACT-REC-READ-CNT      PIC  9(07) VALUE ZEROS.  01550039
015600     05  PV-ERROR-RECORD-WRITTEN-CNT     PIC  9(07) VALUE ZEROS.  01560039
015700     05  PV-VALID-MATCH-CNT              PIC  9(07) VALUE ZEROS.  01570076
015800                                                                  01580007
015900 01  PV-MISC-ABEND-FIELDS.                                        01590003
016000     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACE.  01600040
016100     05  PV-OPERATION-MSG-1              PIC  X(40) VALUE SPACE.  01610040
016200     05  PV-OPERATION-MSG-2              PIC  X(40) VALUE SPACE.  01620040
016300     05  PV-DB2-OPERATION                PIC  X(30) VALUE SPACE.  01630040
016400                                                                  01640003
016500 01  PV-ABEND-CODE   COMP  SYNC          PIC S9(04) VALUE +0000.  01650007
016600     88  PV-ABEND-4008-DATA-ERROR                   VALUE +4008.  01660009
016700     88  PV-ABEND-4009-CARD-ERROR                   VALUE +4009.  01670007
016900     88  PV-ABEND-4013-DB2-ERROR                    VALUE +4013.  01690007
017000                                                                  01700003
017100******************************************************************01710007
017200*  TOP OF PAGE HEADING LINE FOR PRINTING A 133 CHARACTER REPORT.  01720054
017300******************************************************************01730007
017400     COPY DPWS133.                                                01740054
017500                                                                  01750007
017600 01  HL2-HEADING-LINE-2.                                          01760007
017700     05  FILLER                  PIC X(47)   VALUE SPACES.        01770053
017800     05  FILLER                  PIC X(36)   VALUE                01780053
017900         'XS VENDOR DEPT DATA INTEGRITY ERRORS'.                  01790053
018000     05  FILLER                  PIC X(50)   VALUE SPACES.        01800053
018100                                                                  01810007
018200 01  HL3-HEADING-LINE-3.                                          01820010
018300     05  FILLER                  PIC X(01)   VALUE SPACES.        01830009
018400     05  FILLER                  PIC X(15)   VALUE                01840053
018500         '----- KEY -----'.                                       01850053
018600     05  FILLER                  PIC X(05)   VALUE SPACES.        01860007
018700     05  FILLER                  PIC X(29)   VALUE                01870053
018800         '---SYSTEM OF RECORD VALUE ---'.                         01880053
018900     05  FILLER                  PIC X(05)   VALUE SPACES.        01890007
019000     05  FILLER                  PIC X(23)   VALUE                01900053
019100         '--- XS DOMAIN VALUE ---'.                               01910053
019200     05  FILLER                  PIC X(05)   VALUE SPACES.        01920007
019300     05  FILLER                  PIC X(30)   VALUE                01930053
019400         '--------------- ERROR MESSAGE '.                        01940053
019500     05  FILLER                  PIC X(15)   VALUE                01950054
019600         '---------------'.                                       01960054
019700     05  FILLER                  PIC X(05)   VALUE SPACES.        01970054
019800                                                                  01980007
019900******************************************************************01990034
020000*  DETAIL LINE LAYOUT FOR THE ERROR REPORT.                       02000034
020100******************************************************************02010034
020200 01  DL1-DETAIL-LINE-1.                                           02020010
020300     05  FILLER                    PIC X(01)     VALUE SPACES.    02030054
020400     05  DL1-VNDDPT-ENT-ID-KEY     PIC ZZZZZZZZ9 VALUE ZEROES.    02040054
020500     05  FILLER                    PIC X(02)     VALUE SPACES.    02050054
020600     05  DL1-VNDDPT-DEPT-NBR       PIC ZZZ9      VALUE ZEROES.    02060054
020700     05  FILLER                    PIC X(32)     VALUE SPACES.    02070054
020800     05  DL1-SOR-VNDDPT-DC-RET-CDE PIC X(02)     VALUE SPACES.    02080054
020900     05  FILLER                    PIC X(26)     VALUE SPACES.    02090054
021000     05  DL1-XS-VNDDPT-DC-RET-CDE  PIC X(02)     VALUE SPACES.    02100054
021100     05  FILLER                    PIC X(05)     VALUE SPACES.    02110054
021200     05  DL1-ERROR-MESSAGE         PIC X(45)     VALUE SPACES.    02120055
021300     05  FILLER                    PIC X(05)     VALUE SPACES.    02130055
021400                                                                  02140010
021500******************************************************************02150034
021600*  TRAILER LAYOUT FOR THE ERROR REPORT.                           02160034
021700******************************************************************02170034
021800 01  TR1-TRAILER-LINE-1.                                          02180007
021900     05  FILLER                    PIC X(25)   VALUE              02190088
022000         ' TOTAL NUMBER OF ERRORS: '.                             02200010
022100     05  TR1-TOTAL-ERROR-CNT       PIC Z(09)   VALUE ZEROS.       02210088
022200     05  FILLER                    PIC X(166)  VALUE SPACES.      02220088
022300                                                                  02230007
022400******************************************************************02240007
022500**COPYBOOKS                                                       02250003
022600******************************************************************02260003
022700                                                                  02270003
022800***VND DEPT EXTRACT FILE LAYOUT                                   02280054
022900     COPY VNRD101.                                                02290054
023000                                                                  02300003
023100***XS EXTRACT FILE LAYOUT                                         02310003
023200     COPY XSRD027.                                                02320054
023300                                                                  02330003
023400***************************************************************** 02340007
023500 PROCEDURE DIVISION.                                              02350003
023600***************************************************************** 02360003
023700 0000-MAINLINE.                                                   02370007
023800                                                                  02380003
023900     PERFORM 1000-INITIALIZATION.                                 02390003
024000                                                                  02400040
024100     PERFORM 2000-PROCESS-RECORDS                                 02410003
024200             UNTIL PS-END-OF-SOR-VNDDPT-EXTRACT                   02420052
024300                OR PS-END-OF-XS-VNDDPT-EXRACT.                    02430052
024400                                                                  02440040
024500     PERFORM 2500-PROCESS-EXTRA-RECORDS                           02450069
024600             UNTIL PS-END-OF-SOR-VNDDPT-EXTRACT                   02460052
024700               AND PS-END-OF-XS-VNDDPT-EXRACT.                    02470052
024800                                                                  02480003
024900     IF PV-ERROR-RECORD-WRITTEN-CNT = 0                           02490036
025000         MOVE PC-NO-ERROR-MESSAGE TO DL1-DETAIL-LINE-1            02500036
025100         MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD              02510036
025200         PERFORM 8900-WRITE-REPORT-LINE                           02520035
025300     ELSE                                                         02530079
025400         MOVE PV-ERROR-RECORD-WRITTEN-CNT TO                      02540079
025500                TR1-TOTAL-ERROR-CNT                               02550079
025600         MOVE TR1-TRAILER-LINE-1  TO PV-PRINT-RECORD              02560079
025700         PERFORM 8900-WRITE-REPORT-LINE                           02570079
025800     END-IF.                                                      02580035
025900                                                                  02590035
026000     PERFORM 9000-END-OF-PGM.                                     02600003
026100                                                                  02610003
026200     GOBACK.                                                      02620003
026300                                                                  02630003
026400******************************************************************02640003
026500*1000-INITIALIZATION.                                             02650017
026600* INITIALIZATION AREA                                             02660017
026700******************************************************************02670003
026800 1000-INITIALIZATION.                                             02680003
026900                                                                  02690003
027000     INITIALIZE PV-PROGRAM-COUNTER.                               02700007
027100                                                                  02710003
027200     OPEN INPUT  SKIP-RECD-CNTL-FILE                              02720005
027400                 SOR-VNDDPT-EXTRACT-FILE                          02740052
027500                 XS-VNDDPT-EXTRACT-FILE.                          02750052
027600                                                                  02760009
027700     OPEN OUTPUT XS-VNDDPT-INTEG-RPT-FILE.                        02770052
027800                                                                  02780003
027900     READ SKIP-RECD-CNTL-FILE INTO CC-SKIP-RECD-CNTL-FILE-LAYOUT  02790007
028000        AT END                                                    02800005
028100           SET PS-END-SKIP-RECD-FILE TO TRUE.                     02810005
028200                                                                  02820005
028300     IF PS-END-SKIP-RECD-FILE                                     02830005
028400         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              02840005
028500         MOVE 'NO SKIP RECD CNTL FILE DATA' TO PV-OPERATION-MSG-1 02850005
028600         SET PV-ABEND-4009-CARD-ERROR TO TRUE                     02860005
028700         PERFORM 9999-ABEND                                       02870005
028800     END-IF.                                                      02880005
028900                                                                  02890006
029000     CLOSE SKIP-RECD-CNTL-FILE.                                   02900006
029100                                                                  02910005
030500     PERFORM 7000-READ-SOR-VNDDPT-EXTRACT                         03050091
030600        UNTIL PV-SOR-VNDDPT-EXT-READ-SKP-CNT = CC-START-POINT     03060058
030700                OR PS-END-OF-SOR-VNDDPT-EXTRACT.                  03070052
030800                                                                  03080005
030900     IF PS-END-OF-SOR-VNDDPT-EXTRACT                              03090052
031000         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              03100009
031100         MOVE 'END OF SOR VND FILE HIT' TO PV-OPERATION-MSG-1     03110009
031200         SET PV-ABEND-4008-DATA-ERROR TO TRUE                     03120009
031300         PERFORM 9999-ABEND                                       03130009
031400     END-IF.                                                      03140009
031500                                                                  03150009
031600     IF CC-READ-FREQUENCY = PC-ONE                                03160046
031700        PERFORM 7100-READ-XS-VNDDPT-EXTRACT CC-START-POINT TIMES  03170052
031800     ELSE                                                         03180046
031900        PERFORM 7100-READ-XS-VNDDPT-EXTRACT UNTIL                 03190052
032000                 PV-XS-CURRENT-KEY >= PV-SOR-CURRENT-KEY          03200059
032100     END-IF.                                                      03210046
032200                                                                  03220044
032300     ACCEPT PV-CURR-TIME FROM TIME.                               03230025
032400     MOVE PV-CURR-TIME-HH          TO DP133-RUN-HOUR.             03240054
032500     MOVE PV-CURR-TIME-MM          TO DP133-RUN-MINUTE.           03250054
032600                                                                  03260025
032700     MOVE FUNCTION CURRENT-DATE (1:8)                             03270025
032800                                   TO PV-CURR-DATE-CCYYMMDD.      03280025
032900                                                                  03290025
033000     MOVE PV-CURR-DATE-MM          TO DP133-RUN-MONTH.            03300054
033100     MOVE PV-CURR-DATE-DD          TO DP133-RUN-DAY.              03310054
033200     MOVE PV-CURR-DATE-CCYY        TO DP133-RUN-YEAR.             03320054
033300                                                                  03330025
033400     MOVE PC-CURRENT-PROGRAM-NAME  TO DP133-PROGRAM-NAME.         03340054
033500                                                                  03350026
033600     PERFORM 8700-REPORT-HEADER-ROUTINE.                          03360022
033700                                                                  03370003
033800******************************************************************03380003
033900*2000-PROCESS-RECORDS.                                            03390017
034000* THIS SECTION COMPARES RECORDS ON THE SOR VENDOR FILE AND XS     03400035
034100* DOMAIN VENDOR EXTRACT FILE.  IF THE KEYS MATCH, THE PROGRAM     03410035
034200* WILL DO A FIELD COMPARE.  ANY DIFFERENCES WILL CAUSE            03420088
034300* A MESSAGE TO BE WRITTEN TO THE ERROR FILE, ALONG WITH THE DATA  03430035
034400* ON THE CORRESPONDING FILES.                                     03440035
034500******************************************************************03450003
034600 2000-PROCESS-RECORDS.                                            03460003
034700                                                                  03470003
034800     INITIALIZE DL1-DETAIL-LINE-1.                                03480012
034900     MOVE ZEROS TO PV-SOR-VNDDPT-EXT-READ-SKP-CNT.                03490058
035000                                                                  03500003
035100     EVALUATE TRUE                                                03510003
035200        WHEN PV-SOR-CURRENT-KEY  = PV-XS-CURRENT-KEY              03520055
035300             PERFORM 2100-COMPARE-FIELDS                          03530003
035400             PERFORM 7000-READ-SOR-VNDDPT-EXTRACT                 03540052
035500                UNTIL PV-SOR-VNDDPT-EXT-READ-SKP-CNT =            03550058
035600                       CC-READ-FREQUENCY OR                       03560044
035700                       PS-END-OF-SOR-VNDDPT-EXTRACT               03570052
035800             IF CC-READ-FREQUENCY = PC-ONE                        03580046
035900                PERFORM 7100-READ-XS-VNDDPT-EXTRACT               03590052
036000                   CC-START-POINT TIMES                           03600046
036100             ELSE                                                 03610046
036200                PERFORM 7100-READ-XS-VNDDPT-EXTRACT UNTIL         03620052
036300                     PV-XS-CURRENT-KEY >= PV-SOR-CURRENT-KEY      03630059
036400             END-IF                                               03640046
036500        WHEN PV-SOR-CURRENT-KEY < PV-XS-CURRENT-KEY               03650055
C97114            IF  VN101-VEND-TYP-IND NOT EQUAL  'M'                 03651097
C97114            AND VN101-VND-DEPT-STAT-CD NOT EQUAL  'I'             03652097
036600                PERFORM 2200-DET-SOR-DC-RET-CDE                   03660096
036700                PERFORM 2600-CHECK-IF-NEW-PG-NEEDED               03670096
036800                PERFORM 2700-MOVE-SOR-VALUES                      03680096
036900                MOVE PC-RCRD-MISSING-FRM-XS-VNDDPT                03690096
037000                     TO DL1-ERROR-MESSAGE                         03700096
037100                MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD         03710096
037200                ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT             03720096
037300                PERFORM 8900-WRITE-REPORT-LINE                    03730096
C97114            END-IF                                                03731097
037400             PERFORM 7000-READ-SOR-VNDDPT-EXTRACT                 03740052
037500        WHEN PV-SOR-CURRENT-KEY > PV-XS-CURRENT-KEY               03750055
037600             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03760024
037700             PERFORM 2800-MOVE-XS-VALUES                          03770020
037800             MOVE PC-RCRD-MISSING-FRM-SOR-VNDDPT                  03780057
037900                TO DL1-ERROR-MESSAGE                              03790032
038000             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03800022
038100             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03810022
038200             PERFORM 8900-WRITE-REPORT-LINE                       03820022
038300             PERFORM 7100-READ-XS-VNDDPT-EXTRACT                  03830052
038400     END-EVALUATE.                                                03840003
038500                                                                  03850003
038600******************************************************************03860003
038700*2100-COMPARE-FIELDS.                                             03870017
038800* COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   03880017
038900******************************************************************03890003
039000 2100-COMPARE-FIELDS.                                             03900003
039100                                                                  03910018
039200     SET PS-NO-VNDDPT-DC-RET-CDE-ERROR   TO TRUE.                 03920055
039300                                                                  03930003
039400     PERFORM 2200-DET-SOR-DC-RET-CDE                              03940055
039500                                                                  03950055
039600     IF  PV-DC-RET-CDE NOT EQUAL XS027-DC-RET-CDE                 03960088
039700         SET PS-VNDDPT-DC-RET-CDE-ERROR TO TRUE                   03970055
039800     END-IF.                                                      03980003
039900                                                                  03990003
040000     IF  PS-VNDDPT-DC-RET-CDE-ERROR                               04000055
040100         PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                      04010023
040200         PERFORM 2700-MOVE-SOR-VALUES                             04020010
040300         PERFORM 2800-MOVE-XS-VALUES                              04030010
040400         MOVE PC-MISMATCHED-VNDR-DC-RET-CDE TO DL1-ERROR-MESSAGE  04040060
040500         MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD                04050010
040600         ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                    04060016
040700         PERFORM 8900-WRITE-REPORT-LINE                           04070022
040800     ELSE                                                         04080076
040900         ADD +1 TO PV-VALID-MATCH-CNT                             04090076
041000     END-IF.                                                      04100003
041100                                                                  04110003
041200     MOVE ZEROS TO PV-SOR-VNDDPT-EXT-READ-SKP-CNT.                04120058
041300                                                                  04130018
041400******************************************************************04140055
041500*2200-DET-SOR-DC-RET-CDE                                          04150055
041600* DETERMINES THE DC RET CODE BASED ON RULES APPLIED TO INCIATORS  04160055
041700* SET ON THE SOR EXTRACT FILE.                                    04170055
041800******************************************************************04180055
041900 2200-DET-SOR-DC-RET-CDE.                                         04190055
042000                                                                  04200055
042100     EVALUATE TRUE                                                04210055
042200        WHEN VN101-RTV-RA-REQD-IND     = 'Y'                      04220055
042300           MOVE 'RA'                  TO PV-DC-RET-CDE            04230055
042400        WHEN VN101-RTV-NO-RA-REQD-IND  = 'Y'                      04240055
042500           MOVE 'RV'                  TO PV-DC-RET-CDE            04250055
042600        WHEN VN101-DEBIT-DESTROY-IND   = 'Y'                      04260055
042700           MOVE 'DD'                  TO PV-DC-RET-CDE            04270055
042800        WHEN VN101-MARKOUT-IND         = 'Y'                      04280055
042900           MOVE 'MO'                  TO PV-DC-RET-CDE            04290055
043000        WHEN OTHER                                                04300055
043100           MOVE 'NA'                  TO PV-DC-RET-CDE            04310055
043200     END-EVALUATE.                                                04320055
043300                                                                  04330055
043400******************************************************************04340069
043500**COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   04350069
043600******************************************************************04360069
043700 2500-PROCESS-EXTRA-RECORDS.                                      04370069
043800                                                                  04380069
043900     INITIALIZE DL1-DETAIL-LINE-1.                                04390069
044000     MOVE ZEROS TO PV-SOR-VNDDPT-EXT-READ-SKP-CNT.                04400069
044100                                                                  04410069
044200     IF  PS-NOT-END-SOR-VNDDPT-EXTRACT                            04420069
044300         IF PV-SOR-CURRENT-KEY NOT = PV-XS-CURRENT-KEY            04430069
C97114         AND VN101-VEND-TYP-IND NOT EQUAL  'M'                    04431097
C97114         AND VN101-VND-DEPT-STAT-CD NOT EQUAL  'I'                04432097
044400            PERFORM 2200-DET-SOR-DC-RET-CDE                       04440069
044500            PERFORM 2700-MOVE-SOR-VALUES                          04450069
044600            MOVE PC-RCRD-MISSING-FRM-XS-VNDDPT                    04460069
044700               TO DL1-ERROR-MESSAGE                               04470069
044800            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           04480069
044810            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 04481093
044900            PERFORM 8900-WRITE-REPORT-LINE                        04490069
045000         END-IF                                                   04500069
045100         PERFORM 7000-READ-SOR-VNDDPT-EXTRACT                     04510069
045200     END-IF.                                                      04520069
045300                                                                  04530069
045400     IF  PS-NOT-END-OF-XS-VNDDPT-EXRACT                           04540069
045500         IF PV-SOR-CURRENT-KEY NOT = PV-XS-CURRENT-KEY            04550069
045600            PERFORM 2800-MOVE-XS-VALUES                           04560069
045700            MOVE PC-RCRD-MISSING-FRM-SOR-VNDDPT                   04570069
045800                TO DL1-ERROR-MESSAGE                              04580069
045900            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           04590069
045910            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 04591093
046000            PERFORM 8900-WRITE-REPORT-LINE                        04600069
046100         END-IF                                                   04610069
046200         PERFORM 7100-READ-XS-VNDDPT-EXTRACT                      04620069
046300     END-IF.                                                      04630069
046400                                                                  04640069
046500******************************************************************04650017
046600* 2600-CHECK-IF-NEW-PG-NEEDED.                                    04660023
046700*     CHECKS TO SEE IF A NEW PAGE IS NEEDED.                      04670023
046800***************************************************************** 04680017
046900 2600-CHECK-IF-NEW-PG-NEEDED.                                     04690023
047000                                                                  04700017
047100     IF PV-LINE-CNT > PC-MAX-REPORT-LINES                         04710023
047200        PERFORM 8700-REPORT-HEADER-ROUTINE                        04720023
047300     END-IF.                                                      04730023
047400                                                                  04740017
047500******************************************************************04750023
047600* 2700-MOVE-SOR-VALUES.                                           04760023
047700*     MOVES THE SOR VENDOR VALUES TO THE ERROR RECORD.            04770023
047800***************************************************************** 04780023
047900 2700-MOVE-SOR-VALUES.                                            04790023
048000                                                                  04800023
048100     MOVE PV-SOR-CURRENT-KEY-ENT-ID   TO DL1-VNDDPT-ENT-ID-KEY.   04810055
048200     MOVE PV-SOR-CURRENT-KEY-DEPT-NBR TO DL1-VNDDPT-DEPT-NBR.     04820055
048300     MOVE PV-DC-RET-CDE              TO DL1-SOR-VNDDPT-DC-RET-CDE.04830060
048400                                                                  04840055
048500******************************************************************04850023
048600* 2800-MOVE-XS-VALUES.                                            04860023
048700*     MOVES THE XS VENDOR VALUES TO THE ERROR RECORD.             04870023
048800***************************************************************** 04880023
048900 2800-MOVE-XS-VALUES.                                             04890023
049000                                                                  04900023
049100     MOVE PV-XS-CURRENT-KEY-ENT-ID   TO DL1-VNDDPT-ENT-ID-KEY.    04910055
049200     MOVE PV-XS-CURRENT-KEY-DEPT-NBR TO DL1-VNDDPT-DEPT-NBR.      04920055
049300     MOVE XS027-DC-RET-CDE           TO DL1-XS-VNDDPT-DC-RET-CDE. 04930055
049400                                                                  04940023
049500***************************************************************** 04950003
049600*7000-READ-SOR-VNDDPT-EXTRACT.                                    04960052
049700*  READ SOR VND EXTRACT FILE                                      04970017
049800*  READS THE VND EXTRACT FILE, SKIPPING THE NUMBER OF RECORDS     04980017
049900*  SPECIFIED IN THE START/SKIP RECORD CONTROL CARD.  THIS WILL    04990017
050000*  DEPEND ON WHERE THE READ IS PERFORMED FROM.  IN ADDITION, THE  05000088
050010*  READ IS SET UP TO BYPASS DUPLICATE ENTITY ID / DEPARTMENT      05001088
050020*  COMBINATIONS AS ONLY THE FIRST OF EACH SHOULD BE CONSIDERED.   05002088
050030*  THE OTHERS ARE EFFICTIVELY 'IGNORED'.                          05003088
050100***************************************************************** 05010003
050200 7000-READ-SOR-VNDDPT-EXTRACT.                                    05020052
050300                                                                  05030003
050400     PERFORM UNTIL PS-END-OF-SOR-VNDDPT-EXTRACT OR                05040072
050500             PV-SOR-CURRENT-KEY NOT EQUAL PV-SOR-SAVED-KEY        05050071
050600                                                                  05060071
050700           READ SOR-VNDDPT-EXTRACT-FILE INTO                      05070071
050800                                 VN101-VENDOR-DEPT-EXTR           05080071
050900              AT END                                              05090073
051000                 SET PS-END-OF-SOR-VNDDPT-EXTRACT TO TRUE         05100073
051100           END-READ                                               05110073
051200                                                                  05120071
051300           IF NOT PS-END-OF-SOR-VNDDPT-EXTRACT                    05130078
051400              ADD +1 TO PV-SOR-VNDDPT-RECS-READ-CNT               05140078
051500              MOVE VN101-ENT-ID    TO  PV-SOR-CURRENT-KEY-ENT-ID  05150078
051600              MOVE VN101-DEPT-NBR  TO PV-SOR-CURRENT-KEY-DEPT-NBR305160078
051700           END-IF                                                 05170078
051800     END-PERFORM.                                                 05180071
051900                                                                  05190003
052000     IF  PS-NOT-END-SOR-VNDDPT-EXTRACT                            05200074
052100         MOVE PV-SOR-CURRENT-KEY TO PV-SOR-SAVED-KEY              05210074
052500         ADD +1 TO PV-SOR-VNDDPT-EXT-READ-SKP-CNT                 05250090
052700     END-IF.                                                      05270074
052800                                                                  05280074
052900***************************************************************** 05290003
053000*7100-READ-XS-VNDDPT-EXTRACT.                                     05300052
053100* READ XS EXTRACT FILE                                            05310017
053200***************************************************************** 05320003
053300 7100-READ-XS-VNDDPT-EXTRACT.                                     05330052
053400                                                                  05340003
053500     IF  PS-NOT-END-OF-XS-VNDDPT-EXRACT                           05350052
053600         READ XS-VNDDPT-EXTRACT-FILE INTO XS027-VND-DEPT-UNLOAD   05360060
053700              AT END                                              05370003
053800                 SET PS-END-OF-XS-VNDDPT-EXRACT TO TRUE           05380052
053900         END-READ                                                 05390003
054000     END-IF.                                                      05400003
054100                                                                  05410003
054200     IF  PS-NOT-END-OF-XS-VNDDPT-EXRACT                           05420052
054300         ADD +1                   TO PV-XS-EXTRACT-REC-READ-CNT   05430013
054400         MOVE XS027-ENT-ID        TO PV-XS-CURRENT-KEY-ENT-ID     05440055
054500         MOVE XS027-DEPT-NBR      TO PV-XS-CURRENT-KEY-DEPT-NBR   05450055
054600     END-IF.                                                      05460003
054700                                                                  05470003
054800******************************************************************05480007
054900* 8700-REPORT-HEADER-ROUTINE.                                     05490022
055000*     PRINT THE HEADINGS FOR THE REPORT.                          05500007
055100******************************************************************05510007
055200 8700-REPORT-HEADER-ROUTINE.                                      05520022
055300                                                                  05530007
055400     MOVE ZEROS                  TO PV-LINE-CNT.                  05540023
055500     ADD +1                      TO PV-PAGE-CNT.                  05550007
055600     MOVE PV-PAGE-CNT            TO DP133-PAGE-NUMBER.            05560054
055700                                                                  05570007
055800     MOVE PC-REPORT-NBR-1        TO DP133-REPORT-NUMBER.          05580054
055900     MOVE DP133-STANDRD-HEADER-133-COLS                           05590060
056000                                 TO PV-PRINT-RECORD.              05600007
056100                                                                  05610007
056200     PERFORM 8800-WRITE-RPT-TOP-OF-PAGE.                          05620022
056300                                                                  05630007
056400     MOVE HL2-HEADING-LINE-2     TO PV-PRINT-RECORD.              05640010
056500     MOVE +2                     TO PV-LINE-SPACING.              05650010
056600     PERFORM 8900-WRITE-REPORT-LINE.                              05660022
056700                                                                  05670007
056800     MOVE HL3-HEADING-LINE-3     TO PV-PRINT-RECORD.              05680010
056900     MOVE +3                     TO PV-LINE-SPACING.              05690010
057000     PERFORM 8900-WRITE-REPORT-LINE.                              05700022
057100                                                                  05710007
057200******************************************************************05720022
057300* 8800-WRITE-RPT-TOP-OF-PAGE                                      05730022
057400*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   05740022
057500******************************************************************05750022
057600 8800-WRITE-RPT-TOP-OF-PAGE.                                      05760022
057700                                                                  05770022
057800     WRITE XS-VNDDPT-INTEG-RPT-RECORD                             05780052
057900       FROM PV-PRINT-RECORD                                       05790022
058000         AFTER ADVANCING PAGE.                                    05800022
058100                                                                  05810022
058200     MOVE +1 TO PV-LINE-CNT.                                      05820022
058300                                                                  05830022
058400******************************************************************05840010
058500* 8900-WRITE-REPORT-LINE                                          05850022
058600*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             05860010
058700******************************************************************05870010
058800 8900-WRITE-REPORT-LINE.                                          05880022
058900                                                                  05890010
059000     WRITE XS-VNDDPT-INTEG-RPT-RECORD                             05900052
059100       FROM PV-PRINT-RECORD                                       05910010
059200         AFTER ADVANCING PV-LINE-SPACING.                         05920010
059300                                                                  05930010
059400     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          05940010
059500                                                                  05950023
059600****************************************************************  05960003
059620* 9000-END-OF-PGM.                                                05962088
059630*     CLOSES FILES AND DISPLAYS PROGRAM TOTALS.                   05963088
059631*     SETS THE RETURN CODE TO 04 IF ANY ERROR RECORDS WRITTEN.    05963188
059640***************************************************************** 05964088
059900 9000-END-OF-PGM.                                                 05990003
060000                                                                  06000003
060100     CLOSE SOR-VNDDPT-EXTRACT-FILE                                06010052
060200           XS-VNDDPT-EXTRACT-FILE                                 06020052
060300           XS-VNDDPT-INTEG-RPT-FILE.                              06030052
060400                                                                  06040035
060500     DISPLAY '******** COUNTS **************************'.        06050051
060600     DISPLAY '   SOR REC READ CNT= ' PV-SOR-VNDDPT-RECS-READ-CNT. 06060052
060700     DISPLAY '    XS EXT READ CNT= ' PV-XS-EXTRACT-REC-READ-CNT.  06070054
060800     DISPLAY ' ERROR RECS WRITTEN= ' PV-ERROR-RECORD-WRITTEN-CNT. 06080042
060900     DISPLAY '  VALID MATCH COUNT= ' PV-VALID-MATCH-CNT.          06090076
061000     DISPLAY '                              '.                    06100076
061100     DISPLAY '    START RECORD POINT= ' CC-START-POINT.           06110076
061200     DISPLAY 'SKIP  RECORD FREQUENCY= ' CC-READ-FREQUENCY.        06120076
061400     DISPLAY '******************************************'.        06140051
061500                                                                  06150003
061600     IF  PV-ERROR-RECORD-WRITTEN-CNT > 0                          06160016
061700         MOVE 04               TO RETURN-CODE                     06170003
061800     END-IF.                                                      06180003
061900                                                                  06190003
062000******************************************************************06200006
062100*     9999-ABEND                                                 *06210006
062200* ==> PROCESSES:                                                 *06220006
062300*     -PERFORMS ABEND PROCESSING FOR NON-SQL-ERRORS.             *06230006
062400******************************************************************06240006
062500 9999-ABEND.                                                      06250006
062600                                                                  06260006
062700     DISPLAY '9999-ABEND'.                                        06270006
062800     DISPLAY '**  ABEND     **'.                                  06280006
062900     DISPLAY '**  PARAGRAPH ** ' PV-PARAGRAPH-NAME.               06290006
063000     DISPLAY '**  OPERATION ** ' PV-OPERATION-MSG-1.              06300006
063100     DISPLAY '**            ** ' PV-OPERATION-MSG-2.              06310006
063200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06320006
