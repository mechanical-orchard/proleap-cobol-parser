000100******************************************************************00010065
000200******************************************************************00020065
000300**         I D E N T I F I C A T I O N   D I V I S I O N        **00030065
000400******************************************************************00040065
000500******************************************************************00050065
000600 IDENTIFICATION DIVISION.                                         00060065
000700 PROGRAM-ID.    SUKUT134.                                         00070065
000800 AUTHOR.        DAVID MEDICI.                                     00080065
000900 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00090065
001000 DATE-WRITTEN.  NOVEMBER, 2008.                                   00100065
001100 DATE-COMPILED.                                                   00110065
001200                                                                  00120065
001300******************************************************************00130065
001400*  THIS PROGRAM WILL BE USED TO RESEND DIRECTIVES FROM THE CAR-  *00140065
001500*  TON DIRECTIVE TRACKING TABLE (SUT_CART_DIRV_TRKG).            *00150065
001600*                                                                *00160065
001700*  A CONTROL FILE WILL CONTAIN A DC NUMBER AND BEGIN AND END     *00170065
001800*  DATE RANGE DESCRIBING THE DIRECTIVES TO BE RESENT.            *00180065
001900*                                                                *00190065
002000*  FOR EACH CONTROL RECORD, A CURSOR WILL BE OPENED THAT WILL    *00200065
002100*  GATHER ALL DIRECTIVES TO BE RESENT. FOR EACH ROW IN THE       *00210065
002200*  CURSOR THE DIRECTIVE GENERATOR COMMUNICATION AREA WILL BE     *00220065
002300*  POPULATED AND A CALL TO THE DIRECTIVE GENERATOR WILL BE MADE  *00230065
002400*  TO REQUEST THE ISSUANCE OF A DIRECTIVE.                       *00240065
002500******************************************************************00250065
002600 EJECT                                                            00260065
002700******************************************************************00270065
002800******************************************************************00280065
002900**            E N V I R O N M E N T   D I V I S I O N           **00290065
003000******************************************************************00300065
003100******************************************************************00310065
003200 ENVIRONMENT DIVISION.                                            00320065
003300                                                                  00330065
003400 CONFIGURATION SECTION.                                           00340065
003500                                                                  00350065
003600 SOURCE-COMPUTER.  IBM-3090.                                      00360065
003700 OBJECT-COMPUTER.  IBM-3090.                                      00370065
003800                                                                  00380065
003900 INPUT-OUTPUT SECTION.                                            00390065
004000                                                                  00400065
004100 FILE-CONTROL.                                                    00410065
004200                                                                  00420065
004300     SELECT         SURD029-CONTROL-FILE                          00430065
004400     ASSIGN      TO INP01                                         00440065
004500     FILE STATUS IS WS-SURD029-STATUS.                            00450065
004600                                                                  00460065
004700 EJECT                                                            00470065
004800******************************************************************00480065
004900******************************************************************00490065
005000**                   D A T A   D I V I S I O N                  **00500065
005100******************************************************************00510065
005200******************************************************************00520065
005300 DATA DIVISION.                                                   00530065
005400                                                                  00540065
005500 FILE SECTION.                                                    00550065
005600                                                                  00560065
005700 FD  SURD029-CONTROL-FILE                                         00570065
005800     RECORDING MODE IS F                                          00580065
005900     LABEL RECORDS ARE STANDARD                                   00590065
006000     BLOCK CONTAINS 0 RECORDS.                                    00600065
006100                                                                  00610065
006200 01  SURD029-CONTROL-RECORD         PIC X(80).                    00620066
006300                                                                  00630065
006400*----------------------------------------------------------------*00640065
006500*                         WORKING STORAGE                        *00650065
006600*----------------------------------------------------------------*00660065
006700 WORKING-STORAGE SECTION.                                         00670065
006800                                                                  00680065
006900 01  WS-FILE-STATUSES.                                            00690065
007000     05  WS-SURD029-STATUS         PIC X(02)  VALUE SPACES.       00700065
007100         88  SURD029-OK                       VALUE '00'.         00710065
007200         88  SURD029-AT-END                   VALUE '10'.         00720065
007300                                                                  00730065
007400 01  WS-ABEND-FIELDS.                                             00740065
007500     05  WS-AC-ABEND-CODE          PIC S9(04) VALUE ZEROES.       00750065
007600     05  WS-ABEND-CODE             PIC S9(04) VALUE +0            00760065
007700                                              COMP SYNC.          00770065
007800 01  WS-PROGRAM-ACCUMULATORS.                                     00780065
007900     05  WS-CNTRL-RECS-READ        PIC 9(13)  VALUE 0.            00790065
008000         88  NO-CONTROL-CARDS                 VALUE 0.            00800065
008100     05  WS-DIRECTIVES-FETCHED     PIC 9(13)  VALUE 0.            00810065
008200     05  WS-DG-CALLS               PIC 9(13)  VALUE 0.            00820065
008300                                                                  00830065
008400 01  WS-PROGRAM-SWITCHES.                                         00840065
008500     05  WS-END-OF-CURSOR          PIC X(01)  VALUE 'N'.          00850065
008600         88  CURSOR-AT-END                    VALUE 'Y'.          00860065
008700         88  CURSOR-NOT-AT-END                VALUE 'N'.          00870065
008800                                                                  00880065
008900 01  WS-PROGRAM-CONSTANTS.                                        00890065
009000     05  WS-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'SUKUT134'.   00900065
009000     05  WS-RESEND                 PIC X(08)  VALUE 'RESEND  '.   00901067
009100                                                                  00910065
009200 01  WS-CONSTANTS.                                                00920065
009300     05  WS-LIT-ADD                PIC X(06)  VALUE 'ADD   '.     00930065
009400     05  WS-LIT-DELETE             PIC X(06)  VALUE 'DELETE'.     00940065
009500     05  WS-LIT-MODIFY             PIC X(06)  VALUE 'MODIFY'.     00950065
009600                                                                  00960065
009700 01  WS-MISCELLANEOUS.                                            00970065
009800     05  WS-TIMESTAMP              PIC X(26)  VALUE SPACES.       00980065
009900     05  WS-BEGIN-TIMESTAMP        PIC X(26)  VALUE SPACES.       00990065
010000     05  WS-END-TIMESTAMP          PIC X(26)  VALUE SPACES.       01000065
010100     05  WS-PARAGRAPH-NAME         PIC X(31)  VALUE SPACES.       01010065
010200                                                                  01020065
010300*----------------------------------------------------------------*01030065
010400*  INPUT DUAL FEED CONTROL LAYOUT                                *01040065
010500*----------------------------------------------------------------*01050065
010600     COPY SURD029.                                                01060065
010700 EJECT                                                            01070065
010800*----------------------------------------------------------------*01080065
010900*  DIRECTIVE GENERATOR COMMUNICATION AREA                        *01090065
011000*----------------------------------------------------------------*01100065
011100     COPY SUWS090.                                                01110065
011200 EJECT                                                            01120065
011300*----------------------------------------------------------------*01130065
011400*  DB2 FORMATTED MESSAGE AREA                                    *01140065
011500*----------------------------------------------------------------*01150065
011600     COPY DPWS004.                                                01160065
011700 EJECT                                                            01170065
011800*----------------------------------------------------------------*01180065
011900*  COMMUNICATIONS AREA FOR DB2                                   *01190065
012000*----------------------------------------------------------------*01200065
012100     EXEC SQL INCLUDE SQLCA END-EXEC.                             01210065
012200 EJECT                                                            01220065
012300*----------------------------------------------------------------*01230065
012400*  DB2 DECLARATION - SHIPPING UNIT - CARTON DIRECTIVE TRACKING   *01240065
012500*      TABLE (SUT_CART_DIRV_TRKG)                                *01250065
012600*----------------------------------------------------------------*01260065
012700     EXEC SQL INCLUDE SUT00102 END-EXEC.                          01270065
012800 EJECT                                                            01280065
012900*----------------------------------------------------------------*01290065
013000*  DB2 TABLE DECLARATION -  XLT_LOC  TABLE.                      *01300065
013100*      (XLT_LOC)                                                 *01310065
013200*----------------------------------------------------------------*01320065
013300     EXEC SQL INCLUDE XLT00010 END-EXEC.                          01330065
013400 EJECT                                                            01340065
013500*----------------------------------------------------------------*01350065
013600*  RESEND DIRECTIVES CURSOR                                      *01360065
013700*                                                                *01370065
013800*  THIS CURSOR WILL GATHER THE DIRECTIVES WITHIN A DATE RANGE    *01380065
013900*  FOR A PARTICULAR DC. THESE ARE THE DIRECTIVES TO BE RESENT    *01390065
014000*  VIA CALLS TO THE DIRECTIVE GENERATOR. DIRECTIVES PREVIOUSLY   *01400065
014100*  RESENT ARE EXCLUDED.                                          *01410065
014200*                                                                *01420065
014300*  THE CURSOR READS AS FOLLOWS: SELECT THE DIRECTIVES FOR A      *01430065
014400*  PARTICULAR DC WHERE (1) THE DIRECTIVES WERE NORMAL DIRECTIVES *01440065
014500*  ISSUED DURING A CERTAIN DATE RANGE, AND (2) THE DIRECTIVES DID*01450065
014600*  NOT HAVE NORMAL DIRECTIVES ISSUED AFTER THE DATE RANGE, AND   *01460065
014700*  (3) A DELETE DIRECTIVE IS NOT FOLLOWED BY AN ADD DIRECTIVE    *01470065
014800*  FOR THE SAME BARCODE ISSUED BY THE SAME REQUESTOR PROGRAM     *01480065
014900*  (HENCE, ASSUMING THE DELETE WAS THE PRODUCT OF THE SINGLE     *01490065
015000*  ADD DIRECTIVE REQUEST).                                       *01500065
015100*                                                                *01510065
015200*  A NORMAL DIRECTIVE IS A DIRECTIVE THAT IS NOT A DIRECTIVE     *01520065
015300*  RESENT BY THIS APPLICATION. THAT IS, IT IS A DIRECTIVE SENT   *01530065
015400*  DURING THE NORMAL COURSE OF DC PROCESSING.                    *01540065
015500*                                                                *01550065
015600*  PART (3) IS REQUIRED TO PREVENT RESENDING A DELETE DIRECTIVE  *01560065
015700*  THAT WILL BE AUTOMATICALLY GENERATED BY THE DIRECTIVE GEN-    *01570065
015800*  ERATOR WHEN IT PROCESSES AN ADD DIRECTIVE.                    *01580065
015900*----------------------------------------------------------------*01590065
016000     EXEC SQL                                                     01600065
016100        DECLARE RESEND_DIRECTIVES_CSR CURSOR WITH HOLD FOR        01610065
016200        SELECT A.BRCDE_NBR                                        01620065
016300              ,A.OPER_UNT_ID                                      01630065
016400              ,A.DIRV_RSN_CDE                                     01640065
016500              ,A.AUD_CNTL_NBR                                     01650065
016600              ,A.SHIPT_UNT_ID                                     01660065
016700              ,A.AUD_STAT_CDE                                     01670065
016800              ,A.PO_NBR                                           01680065
016900              ,A.RCVR_SEQ_NBR                                     01690065
017000              ,A.PO_LNE_NBR                                       01700065
017100              ,A.PREPK_ID                                         01710065
017200              ,A.STR_NBR                                          01720065
017300              ,A.CASI_CDE                                         01730065
017400              ,A.CART_STAT_CDE                                    01740065
017500              ,A.AUD_FALR_RSN_NM                                  01750065
017600              ,A.STR_ZN_ID                                        01760065
017700              ,A.SEASET_YR                                        01770065
017800              ,A.SEASET_SHRT_NM                                   01780065
017900              ,A.CRE_BY_USR_ID                                    01790065
018000              ,A.CNVYR_PRC_ACTN_NM                                01800065
018100        FROM   SUT_CART_DIRV_TRKG A                               01810065
018200        WHERE  A.OPER_UNT_ID       = :SUT00102-OPER-UNT-ID        01820065
018300          AND  A.CRE_TMST    BETWEEN :WS-BEGIN-TIMESTAMP          01830065
018400                                 AND :WS-END-TIMESTAMP            01840065
018500          AND  A.CRE_PGM_NM       <> :SUT00102-CRE-PGM-NM         01850065
018600          AND  NOT EXISTS                                         01860065
018700               (                                                  01870065
018800                SELECT *                                          01880065
018900                FROM   SUT_CART_DIRV_TRKG B                       01890065
019000                WHERE  B.BRCDE_NBR   = A.BRCDE_NBR                01900065
019100                  AND  B.CRE_TMST    > :WS-END-TIMESTAMP          01910065
019200                  AND  B.CRE_PGM_NM <> :SUT00102-CRE-PGM-NM       01920065
019300               )                                                  01930065
019400          AND  NOT                                                01940065
019500               (                                                  01950065
019600                    A.CNVYR_PRC_ACTN_NM = 'DELETE'                01960065
019700                AND EXISTS                                        01970065
019800                    (                                             01980065
019900                      SELECT *                                    01990065
020000                      FROM   SUT_CART_DIRV_TRKG C                 02000065
020100                      WHERE  C.BRCDE_NBR = A.BRCDE_NBR            02010065
020200                        AND  C.CRE_TMST  =                        02020065
020300                             (                                    02030065
020400                              SELECT MIN(D.CRE_TMST)              02040065
020500                              FROM   SUT_CART_DIRV_TRKG D         02050065
020600                              WHERE  D.BRCDE_NBR  = A.BRCDE_NBR   02060065
020700                                AND  D.CRE_TMST   > A.CRE_TMST    02070065
020800                                AND  D.CRE_PGM_NM = A.CRE_PGM_NM  02080065
020900                             )                                    02090065
021000                        AND  C.CNVYR_PRC_ACTN_NM = 'ADD'          02100065
021100                    )                                             02110065
021200               )                                                  02120065
021300        ORDER BY CRE_TMST                                         02130065
021400        FOR READ ONLY                                             02140065
021500     END-EXEC.                                                    02150065
021600 EJECT                                                            02160065
021700******************************************************************02170065
021800******************************************************************02180065
021900**             P R O C E D U R E   D I V I S I O N              **02190065
022000******************************************************************02200065
022100******************************************************************02210065
022200 PROCEDURE DIVISION.                                              02220065
022300                                                                  02230065
022400*----------------------------------------------------------------*02240065
022500*  MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.       *02250065
022600*----------------------------------------------------------------*02260065
022700 0000-MAINLINE.                                                   02270065
022800                                                                  02280065
022900**** PERFORM PROGRAM INITIALIZATION.                              02290065
023000                                                                  02300065
023100     PERFORM 1000-INITIALIZE        THRU 1000-EXIT.               02310065
023200                                                                  02320065
023300**** FOR EACH CONTROL CARD, RESEND THE DIRECTIVES CHARACTERIZED   02330065
023400**** BY THE PARAMETERS.                                           02340065
023500                                                                  02350065
023600     PERFORM 2000-RESEND-DIRECTIVES THRU 2000-EXIT                02360065
023700       UNTIL SURD029-AT-END.                                      02370065
023800                                                                  02380065
023900**** PERFORM PROGRAM TERMINATION.                                 02390065
024000                                                                  02400065
024100     PERFORM 3000-TERMINATE         THRU 3000-EXIT.               02410065
024200                                                                  02420065
024300 0000-EXIT.                                                       02430065
024400     STOP RUN.                                                    02440065
024500 EJECT                                                            02450065
024600*----------------------------------------------------------------*02460065
024700*  PROGRAM INITIALIZATION                                        *02470065
024800*----------------------------------------------------------------*02480065
024900 1000-INITIALIZE.                                                 02490065
025000                                                                  02500065
025100**** NOTIFY OF PROGRAM STARTUP.                                   02510065
025200                                                                  02520065
025300     DISPLAY '**************************************************'.02530065
025400     DISPLAY '* PROGRAM '                                         02540065
025500             WS-CURRENT-PROGRAM-NAME                              02550065
025600                               ' BEGINS '                         02560065
025700             FUNCTION CURRENT-DATE                                02570065
025800                                                            '  *'.02580065
025900     DISPLAY '* COMPILED: '                                       02590065
026000             FUNCTION WHEN-COMPILED                               02600065
026100                                              '                *'.02610065
026200     DISPLAY '**************************************************'.02620065
026300     DISPLAY ' '.                                                 02630065
026400                                                                  02640065
026500**** OPEN THE CONTROL FILE. THIS FILE CONTAINS A LIST OF          02650065
026600**** PARAMETERS THAT DEFINE THE DIRECTIVES TO RESEND.             02660065
026700                                                                  02670065
026800     OPEN INPUT SURD029-CONTROL-FILE.                             02680065
026900                                                                  02690065
027000     EVALUATE TRUE                                                02700065
027100        WHEN NOT SURD029-OK                                       02710065
027200           DISPLAY '*!*!*!*!*! ABEND 01 !*!*!*!*!*!*!*'           02720065
027300           DISPLAY '*! CONTROL FILE FAILED TO OPEN  !*'           02730065
027400           DISPLAY '*! FILE STATUS: '                             02740065
027500                   WS-SURD029-STATUS '              !*'           02750065
027600           DISPLAY '*!*!*!*!*! ABEND 01 !*!*!*!*!*!*!*'           02760065
027700           MOVE '1000-INITIALIZE' TO WS-PARAGRAPH-NAME            02770065
027800           PERFORM 9999-ABEND THRU 9999-EXIT                      02780065
027900     END-EVALUATE.                                                02790065
028000                                                                  02800065
028100 1000-EXIT.                                                       02810065
028200     EXIT.                                                        02820065
028300 EJECT                                                            02830065
028400*----------------------------------------------------------------*02840065
028500*  SEND THE DIRECTIVES SPECIFIED BY THE CONTROL FILE PARAMETERS  *02850065
028600*----------------------------------------------------------------*02860065
028700 2000-RESEND-DIRECTIVES.                                          02870065
028800                                                                  02880065
028900**** READ THE CONTROL CARD. DROP OUT WHEN THERE ARE NO MORE       02890065
029000**** CONTROL CARDS.                                               02900065
029100                                                                  02910065
029200     PERFORM 2100-READ-CONTROL-CARD      THRU 2100-EXIT.          02920065
029300                                                                  02930065
029400     IF SURD029-AT-END                                            02940065
029500        GO TO 2000-EXIT                                           02950065
029600     END-IF.                                                      02960065
029700                                                                  02970065
029800**** VALIDATE THE CONTROL CARD.                                   02980065
029900                                                                  02990065
030000     PERFORM 2200-VALIDATE-PARMS         THRU 2200-EXIT.          03000065
030100                                                                  03010065
030200**** OPEN THE DIRECTIVES CURSOR. THESE ARE THE DIRECTIVES TO      03020065
030300**** RESEND AS CHARACTERIZED BY THE CONTROL CARD.                 03030065
030400                                                                  03040065
030500     PERFORM 2300-OPEN-DIRECTIVE-CURSOR  THRU 2300-EXIT.          03050065
030600                                                                  03060065
030700**** FOR EACH ROW ON THE CURSOR, CALL THE DIRECTIVE GENERATOR     03070065
030800**** TO ISSUE A DIRECTIVE.                                        03080065
030900                                                                  03090065
031000     PERFORM 2400-RESEND-DIRECTIVES      THRU 2400-EXIT           03100065
031100       UNTIL CURSOR-AT-END.                                       03110065
031200                                                                  03120065
031300**** CLOSE THE DIRECTIVES CURSOR.                                 03130065
031400                                                                  03140065
031500     PERFORM 2500-CLOSE-DIRECTIVE-CURSOR THRU 2500-EXIT.          03150065
031600                                                                  03160065
031700 2000-EXIT.                                                       03170065
031800     EXIT.                                                        03180065
031900 EJECT                                                            03190065
032000*----------------------------------------------------------------*03200065
032100*  READ THE CONTROL FILE                                         *03210065
032200*----------------------------------------------------------------*03220065
032300 2100-READ-CONTROL-CARD.                                          03230065
032400                                                                  03240065
032500     READ SURD029-CONTROL-FILE INTO SURD029-RECORD END-READ.      03250065
032600                                                                  03260065
032700     EVALUATE TRUE                                                03270065
032800        WHEN SURD029-OK                                           03280065
032900           ADD 1 TO WS-CNTRL-RECS-READ                            03290065
033000        WHEN SURD029-AT-END                                       03300065
033100           IF NO-CONTROL-CARDS                                    03310065
033200              DISPLAY '*!*!*!*!*! ABEND 02 !*!*!*!*!*!*'          03320065
033300              DISPLAY '*! NO RECORDS ON CONTROL FILE.!*'          03330065
033400              DISPLAY '*!*!*!*!*! ABEND 02 !*!*!*!*!*!*'          03340065
033500              MOVE '2100-READ-CONTROL-CARD' TO WS-PARAGRAPH-NAME  03350065
033600              PERFORM 9999-ABEND THRU 9999-EXIT                   03360065
033700           END-IF                                                 03370065
033800        WHEN OTHER                                                03380065
033900           DISPLAY '*!*!*!*!*! ABEND 03 !*!*!*!*!*!*!*'           03390065
034000           DISPLAY '*! READ FAILED ON CONTROL FILE. !*'           03400065
034100           DISPLAY '*! FILE STATUS: '                             03410065
034200                   WS-SURD029-STATUS '              !*'           03420065
034300           DISPLAY '*!*!*!*!*! ABEND 03 !*!*!*!*!*!*!*'           03430065
034400           MOVE '2100-READ-CONTROL-CARD' TO WS-PARAGRAPH-NAME     03440065
034500           PERFORM 9999-ABEND THRU 9999-EXIT                      03450065
034600     END-EVALUATE.                                                03460065
034700                                                                  03470065
034800 2100-EXIT.                                                       03480065
034900     EXIT.                                                        03490065
035000 EJECT                                                            03500065
035100*----------------------------------------------------------------*03510065
035200*  VALIDATE THE CONTROL CARD PARAMETERS                          *03520065
035300*----------------------------------------------------------------*03530065
035400 2200-VALIDATE-PARMS.                                             03540065
035500                                                                  03550065
035600**** VALIDATE THE DC NUMBER                                       03560065
035700                                                                  03570065
035800     PERFORM 2210-VALIDATE-DC    THRU 2210-EXIT.                  03580065
035900                                                                  03590065
036000**** VALIDATE THE DATE RANGE                                      03600065
036100                                                                  03610065
036200     PERFORM 2220-VALIDATE-DATES THRU 2220-EXIT.                  03620065
036300                                                                  03630065
036400 2200-EXIT.                                                       03640065
036500     EXIT.                                                        03650065
036600 EJECT                                                            03660065
036700*----------------------------------------------------------------*03670065
036800*  VALIDATE THE DC NUMBER                                        *03680065
036900*----------------------------------------------------------------*03690065
037000 2210-VALIDATE-DC.                                                03700065
037100                                                                  03710065
037200     MOVE SU029-OPER-UNT-ID TO XLT00010-LOC-NBR.                  03720065
037300                                                                  03730065
037400     EXEC SQL                                                     03740065
037500        SELECT LOC_TYP_CDE                                        03750065
037600        INTO   :XLT00010-LOC-TYP-CDE                              03760065
037700        FROM   XLT_LOC                                            03770065
037800        WHERE  LOC_NBR     = :XLT00010-LOC-NBR                    03780065
037900          AND  LOC_TYP_CDE = 'DC'                                 03790065
038000     END-EXEC.                                                    03800065
038100                                                                  03810065
038200     EVALUATE TRUE                                                03820065
038300        WHEN SQLCODE = +0                                         03830065
038400           CONTINUE                                               03840065
038500        WHEN SQLCODE = +100                                       03850065
038600           DISPLAY '*!*!*!*!*! ABEND 04 !*!*!*!*!*!*!*!*!*!*'     03860065
038700           DISPLAY '*! INVALID DC NUMBER ON CONTROL FILE. !*'     03870065
038800           DISPLAY '*! DC NUMBER: '                               03880065
038900                   SU029-OPER-UNT-ID                              03890065
039000                                     '                    !*'     03900065
039100           DISPLAY '*!*!*!*!*! ABEND 04 !*!*!*!*!*!*!*!*!*!*'     03910065
039200           MOVE '2210-VALIDATE-DC' TO WS-PARAGRAPH-NAME           03920065
039300           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  03930065
039400        WHEN SQLCODE  > 0                                         03940065
039500        WHEN SQLWARN0 = 'W'                                       03950065
039600           DISPLAY '*!*!*!*!*! ABEND 05 !*!*!*!*!*!*!*!*!*!*!*'   03960065
039700           DISPLAY '*! WARNING ISSUED ON SELECT OF XLT_LOC  !*'   03970065
039800           DISPLAY '*! LOCATION: '                                03980065
039900                   XLT00010-LOC-NBR '                       !*'   03990065
040000           DISPLAY '*!*!*!*!*! ABEND 05 !*!*!*!*!*!*!*!*!*!*!*'   04000065
040100           MOVE '2210-VALIDATE-DC' TO WS-PARAGRAPH-NAME           04010065
040200           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  04020065
040300        WHEN SQLCODE < 0                                          04030065
040400           DISPLAY '*!*!*!*!*! ABEND 06 !*!*!*!*!*!*!*!*!*!*!*'   04040065
040500           DISPLAY '*! ERROR ISSUED ON SELECT OF XLT_LOC'         04050065
040600           DISPLAY '*! LOCATION: '                                04060065
040700                   XLT00010-LOC-NBR '                       !*'   04070065
040800           DISPLAY '*!*!*!*!*! ABEND 06 !*!*!*!*!*!*!*!*!*!*!*'   04080065
040900           MOVE '2210-VALIDATE-DC' TO WS-PARAGRAPH-NAME           04090065
041000           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  04100065
041100     END-EVALUATE.                                                04110065
041200                                                                  04120065
041300 2210-EXIT.                                                       04130065
041400     EXIT.                                                        04140065
041500 EJECT                                                            04150065
041600*----------------------------------------------------------------*04160065
041700*  VALIDATE THE DATE RANGE                                       *04170065
041800*----------------------------------------------------------------*04180065
041900 2220-VALIDATE-DATES.                                             04190065
042000                                                                  04200065
042100**** VALIDATE THE BEGIN TIMESTAMP                                 04210065
042200                                                                  04220065
042300     MOVE SU029-TMST-BEGIN TO WS-TIMESTAMP.                       04230065
042400                                                                  04240065
042500     PERFORM 2221-VALIDATE-TIMESTAMP THRU 2221-EXIT.              04250065
042600                                                                  04260065
042700**** VALIDATE THE END TIMESTAMP                                   04270065
042800                                                                  04280065
042900     MOVE SU029-TMST-END   TO WS-TIMESTAMP.                       04290065
043000                                                                  04300065
043100     PERFORM 2221-VALIDATE-TIMESTAMP THRU 2221-EXIT.              04310065
043200                                                                  04320065
043300 2220-EXIT.                                                       04330065
043400     EXIT.                                                        04340065
043500 EJECT                                                            04350065
043600*----------------------------------------------------------------*04360065
043700*  VALDIATE A TIMESTAMP                                          *04370065
043800*----------------------------------------------------------------*04380065
043900 2221-VALIDATE-TIMESTAMP.                                         04390065
044000                                                                  04400065
044100**** VALIDATE THE TENDERED TIMESTAMP                              04410065
044200                                                                  04420065
044300     EXEC SQL                                                     04430065
044400        SET :WS-TIMESTAMP = TIMESTAMP(:WS-TIMESTAMP)              04440065
044500     END-EXEC.                                                    04450065
044600                                                                  04460065
044700     EVALUATE TRUE                                                04470065
044800        WHEN SQLCODE = +0                                         04480065
044900           CONTINUE                                               04490065
045000        WHEN OTHER                                                04500065
045100           DISPLAY '*!*!*!*!*! ABEND 07 !*!*!*!*!*!*'             04510065
045200           DISPLAY '*! PARAMETER DATE IN ERROR.   !*'             04520065
045300           DISPLAY '*! '                                          04530065
045400                   WS-TIMESTAMP                 ' !*'             04540065
045500           DISPLAY '*!*!*!*!*! ABEND 07 !*!*!*!*!*!*'             04550065
045600           MOVE '2221-VALIDATE-TIMESTAMP' TO WS-PARAGRAPH-NAME    04560065
045700           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  04570065
045800     END-EVALUATE.                                                04580065
045900                                                                  04590065
046000 2221-EXIT.                                                       04600065
046100     EXIT.                                                        04610065
046200 EJECT                                                            04620065
046300*----------------------------------------------------------------*04630065
046400*  OPEN THE CURSOR THAT WILL GATHER ALL THE DIRECTIVES TO BE     *04640065
046500*  RESENT.                                                       *04650065
046600*----------------------------------------------------------------*04660065
046700 2300-OPEN-DIRECTIVE-CURSOR.                                      04670065
046800                                                                  04680065
046900**** SETUP THE KEYS. WE WANT TO EXCLUDE DIRECTIVES SENT BY THE    04690065
047000**** THIS PROGRAM BECAUSE WE DO NOT WANT TO RESEND RESENT DIREC-  04700065
047100**** TIVES.                                                       04710065
047200                                                                  04720065
047300     MOVE SU029-OPER-UNT-ID       TO SUT00102-OPER-UNT-ID.        04730065
047400     MOVE SU029-TMST-BEGIN        TO WS-BEGIN-TIMESTAMP.          04740065
047500     MOVE SU029-TMST-END          TO WS-END-TIMESTAMP.            04750065
047600     MOVE WS-RESEND               TO SUT00102-CRE-PGM-NM.         04760067
047700                                                                  04770065
047800**** OPEN THE CURSOR.                                             04780065
047900                                                                  04790065
048000     EXEC SQL                                                     04800065
048100        OPEN RESEND_DIRECTIVES_CSR                                04810065
048200     END-EXEC.                                                    04820065
048300                                                                  04830065
048400     EVALUATE TRUE                                                04840065
048500        WHEN SQLCODE = +0                                         04850065
048600           SET CURSOR-NOT-AT-END     TO TRUE                      04860065
048700           INITIALIZE WS-DIRECTIVES-FETCHED                       04870065
048800        WHEN OTHER                                                04880065
048900           DISPLAY '*!*!*!*!*! ABEND 08 !*!*!*!*!*!*!*!*!*'       04890065
049000           DISPLAY '*! ERROR OPENING DIRECTIVES CURSOR. !*'       04900065
049100           DISPLAY '*!*!*!*!*! ABEND 08 !*!*!*!*!*!*!*!*!*'       04910065
049200           MOVE '2300-OPEN-DIRECTIVE-CURSOR' TO WS-PARAGRAPH-NAME 04920065
049300           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  04930065
049400     END-EVALUATE.                                                04940065
049500                                                                  04950065
049600 2300-EXIT.                                                       04960065
049700     EXIT.                                                        04970065
049800 EJECT                                                            04980065
049900*----------------------------------------------------------------*04990065
050000*  RESEND THE DIRECTIVES GATHERED IN THE DIRECTIVES CURSOR BY    *05000065
050100*  REPEATEDLY CALLING THE DIRECTIVE GENERATOR.                   *05010065
050200*----------------------------------------------------------------*05020065
050300 2400-RESEND-DIRECTIVES.                                          05030065
050400                                                                  05040065
050500**** FETCH A DIRECTIVE                                            05050065
050600                                                                  05060065
050700     PERFORM 2410-FETCH-DIRECTIVE    THRU 2410-EXIT.              05070065
050800                                                                  05080065
050900     IF CURSOR-AT-END                                             05090065
051000        GO TO 2400-EXIT                                           05100065
051100     END-IF.                                                      05110065
051200                                                                  05120065
051300**** FORMAT THE DIRECTIVE GENERATOR COMMUNICATION AREA            05130065
051400                                                                  05140065
051500     PERFORM 2420-FORMAT-DG-COMMAREA THRU 2420-EXIT.              05150065
051600                                                                  05160065
051700**** CALL THE DIRECTIVE GENERATOR TO ISSUE A DIRECTIVE            05170065
051800                                                                  05180065
051900     PERFORM 2430-REQUEST-DIRECTIVE  THRU 2430-EXIT.              05190065
052000                                                                  05200065
052100 2400-EXIT.                                                       05210065
052200     EXIT.                                                        05220065
052300 EJECT                                                            05230065
052400*----------------------------------------------------------------*05240065
052500*  FETCH A DIRECTIVE TO BE RESENT                                *05250065
052600*----------------------------------------------------------------*05260065
052700 2410-FETCH-DIRECTIVE.                                            05270065
052800                                                                  05280065
052900     EXEC SQL                                                     05290065
053000        FETCH RESEND_DIRECTIVES_CSR                               05300065
053100        INTO  :SUT00102-BRCDE-NBR                                 05310065
053200             ,:SUT00102-OPER-UNT-ID                               05320065
053300             ,:SUT00102-DIRV-RSN-CDE                              05330065
053400             ,:SUT00102-AUD-CNTL-NBR                              05340065
053500             ,:SUT00102-SHIPT-UNT-ID                              05350065
053600             ,:SUT00102-AUD-STAT-CDE                              05360065
053700             ,:SUT00102-PO-NBR                                    05370065
053800             ,:SUT00102-RCVR-SEQ-NBR                              05380065
053900             ,:SUT00102-PO-LNE-NBR                                05390065
054000             ,:SUT00102-PREPK-ID                                  05400065
054100             ,:SUT00102-STR-NBR                                   05410065
054200             ,:SUT00102-CASI-CDE                                  05420065
054300             ,:SUT00102-CART-STAT-CDE                             05430065
054400             ,:SUT00102-AUD-FALR-RSN-NM                           05440065
054500             ,:SUT00102-STR-ZN-ID                                 05450065
054600             ,:SUT00102-SEASET-YR                                 05460065
054700             ,:SUT00102-SEASET-SHRT-NM                            05470065
054800             ,:SUT00102-CRE-BY-USR-ID                             05480065
054900             ,:SUT00102-CNVYR-PRC-ACTN-NM                         05490065
055000     END-EXEC.                                                    05500065
055100                                                                  05510065
055200     EVALUATE TRUE                                                05520065
055300        WHEN SQLCODE = +0                                         05530065
055400           ADD 1 TO WS-DIRECTIVES-FETCHED                         05540065
055500        WHEN SQLCODE = +100                                       05550065
055600           SET CURSOR-AT-END TO TRUE                              05560065
055700        WHEN OTHER                                                05570065
055800           DISPLAY '*!*!*!*!*! ABEND 09 !*!*!*!*!*!*!*!*!*'       05580065
055900           DISPLAY '*! ERROR FETCHING DIRECTIVES CURSOR.!*'       05590065
056000           DISPLAY '*!*!*!*!*! ABEND 09 !*!*!*!*!*!*!*!*!*'       05600065
056100           MOVE '2300-OPEN-DIRECTIVE-CURSOR' TO WS-PARAGRAPH-NAME 05610065
056200           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  05620065
056300     END-EVALUATE.                                                05630065
056400                                                                  05640065
056500 2410-EXIT.                                                       05650065
056600     EXIT.                                                        05660065
056700 EJECT                                                            05670065
056800*----------------------------------------------------------------*05680065
056900*  FORMAT THE DIRECTIVE GENERATOR COMMUNICATION AREA             *05690065
057000*----------------------------------------------------------------*05700065
057100 2420-FORMAT-DG-COMMAREA.                                         05710065
057200                                                                  05720065
057300**** INITIALIZE THE DIRECTIVE GENERATOR COMMUNICATION AREA        05730065
057400                                                                  05740065
057500     INITIALIZE SU090-DG-REQUEST-COMMAREA.                        05750065
057600                                                                  05760065
057700**** SET UP SOME CONSTANT AREAS                                   05770065
057800                                                                  05780065
057900     SET SU090-BATCH            TO TRUE.                          05790065
058000     SET SU090-CARTON-DIRECTIVE TO TRUE.                          05800065
058100                                                                  05810065
058200**** DETERMINE THE KIND OF DIRECTIVE TO REQUEST                   05820065
058300                                                                  05830065
058400     EVALUATE SUT00102-CNVYR-PRC-ACTN-NM                          05840065
058500        WHEN WS-LIT-ADD                                           05850065
058600           SET SU090-ADD-ACTION    TO TRUE                        05860065
058700        WHEN WS-LIT-DELETE                                        05870065
058800           SET SU090-DELETE-ACTION TO TRUE                        05880065
058900        WHEN WS-LIT-MODIFY                                        05890065
059000           SET SU090-MODIFY-ACTION TO TRUE                        05900065
059100     END-EVALUATE.                                                05910065
059200                                                                  05920065
059300**** DETERMINE THE KIND OF BARCODE THAT IS BEING SENT             05930065
059400                                                                  05940065
059500     IF SUT00102-SHIPT-UNT-ID = 0                                 05950065
059600        SET SU090-P2L-BARCODE TO TRUE                             05960065
059700     ELSE                                                         05970065
059800        SET SU090-SML-BARCODE TO TRUE                             05980065
059900     END-IF.                                                      05990065
060000                                                                  06000065
060100**** SETUP THE REST OF THE DIRECTIVE GENEATOR COMMUNICATION AREA  06010065
060200                                                                  06020065
060300     MOVE WS-RESEND                TO SU090-CALLING-PGM.          06030068
060400     MOVE SUT00102-BRCDE-NBR       TO SU090-P2L-BRCDE-NBR.        06040065
060500     MOVE SUT00102-OPER-UNT-ID     TO SU090-OPER-UNT-ID.          06050065
060600     MOVE SUT00102-DIRV-RSN-CDE    TO SU090-DIRV-RSN-CDE.         06060065
060700     MOVE SUT00102-AUD-CNTL-NBR    TO SU090-AUD-CNTL-NBR.         06070065
060800     MOVE SUT00102-SHIPT-UNT-ID    TO SU090-SML-BRCDE-NBR.        06080065
060900     MOVE SUT00102-AUD-STAT-CDE    TO SU090-AUD-STAT-CDE.         06090065
061000     MOVE SUT00102-PO-NBR          TO SU090-PO-NBR.               06100065
061100     MOVE SUT00102-RCVR-SEQ-NBR    TO SU090-RCVR-SEQ-NBR.         06110065
061200     MOVE SUT00102-PO-LNE-NBR      TO SU090-PO-LNE-NBR.           06120065
061300     MOVE SUT00102-PREPK-ID        TO SU090-PO-PREPK-ID.          06130065
061400     MOVE SUT00102-STR-NBR         TO SU090-STR-NBR.              06140065
061500     MOVE SUT00102-CASI-CDE        TO SU090-CASI-CDE.             06150065
061600     MOVE SUT00102-CART-STAT-CDE   TO SU090-CART-STAT-CDE.        06160065
061700     MOVE SUT00102-AUD-FALR-RSN-NM TO SU090-AUD-FAIL-RSN.         06170065
061800     MOVE SUT00102-STR-ZN-ID       TO SU090-STR-ZN.               06180065
061900     MOVE SUT00102-SEASET-YR       TO SU090-SEASET-YR.            06190065
062000     MOVE SUT00102-SEASET-SHRT-NM  TO SU090-SEASET-CDE.           06200065
062100     MOVE SUT00102-CRE-BY-USR-ID   TO SU090-ASSOC-ID.             06210065
062200                                                                  06220065
062300 2420-EXIT.                                                       06230065
062400     EXIT.                                                        06240065
062500 EJECT                                                            06250065
062600*----------------------------------------------------------------*06260065
062700*  CALL THE DIRECTIVE GENERATOR TO REQUEST THE ISSUANCE OF A     *06270065
062800*  DIRECTIVE.                                                    *06280065
062900*----------------------------------------------------------------*06290065
063000 2430-REQUEST-DIRECTIVE.                                          06300065
063001                                                                  06300165
063002     CALL SU090-DIRV-GEN-PGM USING SU090-DG-REQUEST-COMMAREA.     06300215
063003                                                                  06300315
063004     EVALUATE TRUE                                                06300415
063005        WHEN SU090-SUCCESS                                        06300515
063006           ADD 1 TO WS-DG-CALLS                                   06300615
063007        WHEN OTHER                                                06300715
063008            DISPLAY '*!*!*!*!*! ABEND 10 !*!*!*!*!*!*'            06300865
063009            DISPLAY '*! DIRECTIVE GENERATOR FAILED.!*'            06300965
063010            DISPLAY '*!*!*!*!*! ABEND 10 !*!*!*!*!*!*'            06301065
063020            PERFORM 2431-DG-ERROR-DISPLAY THRU 2431-EXIT          06302065
063030            MOVE '2430-REQUEST-DIRECTIVE' TO WS-PARAGRAPH-NAME    06303065
063031            PERFORM 9999-ABEND THRU 9999-EXIT                     06303165
063032     END-EVALUATE.                                                06303215
063033                                                                  06303365
063034 2430-EXIT.                                                       06303465
063035     EXIT.                                                        06303565
063036 EJECT                                                            06303665
063037*----------------------------------------------------------------*06303765
063038*  DISPLAY THE NECESSARY ERROR FIELDS WHEN THE DIRECTIVE GENER-  *06303865
063039*  ATOR DOES NOT SUCCESSFULLY ISSUE A DIRECTIVE.                 *06303965
063040*----------------------------------------------------------------*06304065
063050 2431-DG-ERROR-DISPLAY.                                           06305065
063060                                                                  06306065
063070     EVALUATE TRUE                                                06307065
063080        WHEN SU090-PARAMETER-ERROR                                06308065
063090           DISPLAY 'DG FAILED WITH PARAMETER ERROR'               06309065
063100        WHEN SU090-DB2-ERROR                                      06310065
063200           DISPLAY 'DG FAILED WITH DB2 ERROR'                     06320065
063300        WHEN SU090-MQ-ERROR                                       06330065
063400           DISPLAY 'DG FAILED WITH MQ ERROR'                      06340065
063500        WHEN SU090-OTHER-ERROR                                    06350065
063600           DISPLAY 'DG FAILED WITH UNKNOWN ERROR'                 06360065
063700     END-EVALUATE.                                                06370065
063800                                                                  06380065
063900     DISPLAY ' '.                                                 06390065
064000     DISPLAY 'SU090-ERR-PROGRAM   = ' SU090-ERR-PROGRAM.          06400065
064100     DISPLAY 'SU090-ERR-PARAGRAPH = ' SU090-ERR-PARAGRAPH.        06410065
064200                                                                  06420065
064300     DISPLAY ' '.                                                 06430065
064400     DISPLAY 'DG COMMUNICATION AREA FIELDS'.                      06440065
064401     DISPLAY '----------------------------'.                      06440165
064402     DISPLAY 'SU090-CALLING-PGM       = ' SU090-CALLING-PGM.      06440215
064403     DISPLAY 'SU090-BATCH-ONLINE-IND  = ' SU090-BATCH-ONLINE-IND. 06440316
064404     DISPLAY 'SU090-OPER-UNT-ID       = ' SU090-OPER-UNT-ID.      06440418
064405     DISPLAY 'SU090-ACTN-CDE          = ' SU090-ACTN-CDE.         06440515
064406     DISPLAY 'SU090-DIRECTIVE-LVL-CDE = ' SU090-DIRECTIVE-LVL-CDE.06440615
064407     DISPLAY 'SU090-DIRV-RSN-CDE      = ' SU090-DIRV-RSN-CDE.     06440715
064408     DISPLAY 'SU090-BRCDE-TYP-CDE     = ' SU090-BRCDE-TYP-CDE.    06440815
064409     DISPLAY 'SU090-SML-BRCDE-NBR     = ' SU090-SML-BRCDE-NBR.    06440915
064410     DISPLAY 'SU090-P2L-BRCDE-NBR     = ' SU090-P2L-BRCDE-NBR.    06441015
064411     DISPLAY 'SU090-PO-NBR            = ' SU090-PO-NBR.           06441115
064412     DISPLAY 'SU090-PO-LNE-NBR        = ' SU090-PO-LNE-NBR.       06441215
064413     DISPLAY 'SU090-PO-PREPK-ID       = ' SU090-PO-PREPK-ID.      06441315
064414     DISPLAY 'SU090-RCVR-SEQ-NBR      = ' SU090-RCVR-SEQ-NBR.     06441415
064415     DISPLAY 'SU090-CASI-CDE          = ' SU090-CASI-CDE.         06441515
064416     DISPLAY 'SU090-CART-STAT-CDE     = ' SU090-CART-STAT-CDE.    06441615
064417     DISPLAY 'SU090-AUD-CNTL-NBR      = ' SU090-AUD-CNTL-NBR.     06441715
064418     DISPLAY 'SU090-AUD-STAT-CDE      = ' SU090-AUD-STAT-CDE.     06441815
064419     DISPLAY 'SU090-AUD-FAIL-RSN      = ' SU090-AUD-FAIL-RSN.     06441915
064420     DISPLAY 'SU090-STR-ZN            = ' SU090-STR-ZN.           06442015
064421     DISPLAY 'SU090-SEASET-YR         = ' SU090-SEASET-YR.        06442115
064422     DISPLAY 'SU090-SEASET-CDE        = ' SU090-SEASET-CDE.       06442215
064423     DISPLAY 'SU090-STR-NBR           = ' SU090-STR-NBR.          06442315
064424     DISPLAY 'SU090-ASSOC-ID          = ' SU090-ASSOC-ID.         06442415
064425                                                                  06442565
064426     EVALUATE TRUE                                                06442665
064427        WHEN SU090-DB2-ERROR                                      06442765
064428           DISPLAY 'SU090-SQLCODE = ' SU090-SQLCODE               06442865
064429           DISPLAY 'SU090-SQLCA   = ' SU090-SQLCA                 06442965
064430        WHEN SU090-MQ-ERROR                                       06443065
064440           DISPLAY 'SU090-MQ-COND-CODE = ' SU090-MQ-COND-CODE     06444065
064450           DISPLAY 'SU090-MQ-REAS-CODE = ' SU090-MQ-REAS-CODE     06445065
064460           DISPLAY 'SU090-MQ-REAS-TXT  = ' SU090-MQ-REAS-TXT      06446065
064470     END-EVALUATE.                                                06447065
064480                                                                  06448065
064490 2431-EXIT.                                                       06449065
064500     EXIT.                                                        06450065
064600 EJECT                                                            06460065
064700*----------------------------------------------------------------*06470065
064800*  CLOSE THE CURSOR TAHT GATHERS ALL THE DIRECTIVES TO BE        *06480065
064900*  RESENT.                                                       *06490065
065000*----------------------------------------------------------------*06500065
065100 2500-CLOSE-DIRECTIVE-CURSOR.                                     06510065
065200                                                                  06520065
065300     EXEC SQL                                                     06530065
065400        CLOSE RESEND_DIRECTIVES_CSR                               06540065
065500     END-EXEC.                                                    06550065
065600                                                                  06560065
065700     EVALUATE TRUE                                                06570065
065800        WHEN SQLCODE = +0                                         06580065
065900           SET CURSOR-NOT-AT-END TO TRUE                          06590065
066000        WHEN OTHER                                                06600065
066100           DISPLAY '*!*!*!*!*! ABEND 11 !*!*!*!*!*!*!*!*!*'       06610065
066200           DISPLAY '*! ERROR CLOSING DIRECTIVES CURSOR. !*'       06620065
066300           DISPLAY '*!*!*!*!*! ABEND 11 !*!*!*!*!*!*!*!*!*'       06630065
066400           MOVE '2500-CLOSE-DIRECTIVE-CURSOR' TO WS-PARAGRAPH-NAME06640065
066500           PERFORM 9100-SQL-ABEND THRU 9100-EXIT                  06650065
066600     END-EVALUATE.                                                06660065
066700                                                                  06670065
066800**** DISPLAY RUN STATS FOR THIS PARAMETER RECORD                  06680065
066900                                                                  06690065
067000     DISPLAY WS-DIRECTIVES-FETCHED                                06700065
067100             ' DIRECTIVES RESENT FOR DC '                         06710065
067200             SU029-OPER-UNT-ID                                    06720065
067300             ' BETWEEN '                                          06730065
067400             SU029-TMST-BEGIN                                     06740065
067500             ' AND '                                              06750065
067600             SU029-TMST-END.                                      06760065
067700                                                                  06770065
067800 2500-EXIT.                                                       06780065
067900     EXIT.                                                        06790065
068000 EJECT                                                            06800065
068100*----------------------------------------------------------------*06810065
068200*  PROGRAM TERMINATION                                           *06820065
068300*----------------------------------------------------------------*06830065
068400 3000-TERMINATE.                                                  06840065
068500                                                                  06850065
068600**** CLOSE THE CONTROL FILE                                       06860065
068700                                                                  06870065
068800     CLOSE SURD029-CONTROL-FILE.                                  06880065
068900                                                                  06890065
069000     EVALUATE TRUE                                                06900065
069100        WHEN NOT SURD029-OK                                       06910065
069200           DISPLAY '*!*!*!*!*! ABEND 12 !*!*!*!*!*!*!*'           06920065
069300           DISPLAY '*! CONTROL FILE FAILED TO CLOSE !*'           06930065
069400           DISPLAY '*! FILE STATUS: '                             06940065
069500                   WS-SURD029-STATUS '              !*'           06950065
069600           DISPLAY '*!*!*!*!*! ABEND 12 !*!*!*!*!*!*!*'           06960065
069700           MOVE '3000-TERMINATE' TO WS-PARAGRAPH-NAME             06970065
069800           PERFORM 9999-ABEND THRU 9999-EXIT                      06980065
069900     END-EVALUATE.                                                06990065
070000                                                                  07000065
070100**** DISPLAY RUN STATS                                            07010065
070200                                                                  07020065
070300     PERFORM 3100-DISPLAY-RUN-STATS THRU 3100-EXIT.               07030065
070400                                                                  07040065
070500**** NOTIFY OF PROGRAM SHUTDOWN.                                  07050065
070600                                                                  07060065
070700     DISPLAY ' '.                                                 07070065
070800     DISPLAY '**************************************************'.07080065
070900     DISPLAY '* PROGRAM '                                         07090065
071000             WS-CURRENT-PROGRAM-NAME                              07100065
071100                               ' ENDS '                           07110065
071200             FUNCTION CURRENT-DATE                                07120065
071300                                                          '    *'.07130065
071400     DISPLAY '**************************************************'.07140065
071500                                                                  07150065
071600 3000-EXIT.                                                       07160065
071700     EXIT.                                                        07170065
071800 EJECT                                                            07180065
071900******************************************************************07190065
072000* DISPLAY THE RUNSTATS                                           *07200065
072100******************************************************************07210065
072200 3100-DISPLAY-RUN-STATS.                                          07220065
072300                                                                  07230065
072400     DISPLAY ' '.                                                 07240065
072500     DISPLAY 'CONTROL CARDS READ: ' WS-CNTRL-RECS-READ.           07250065
072600     DISPLAY 'DG CALLS          : ' WS-DG-CALLS.                  07260065
072700                                                                  07270065
072800 3100-EXIT.                                                       07280065
072900     EXIT.                                                        07290065
073000 EJECT                                                            07300065
073100******************************************************************07310065
073200* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *07320065
073300* ERROR OR WARNING CODE OCCURS.                                  *07330065
073400******************************************************************07340065
073500******************************************************************07350065
073600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07360065
073700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07370065
073800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07380065
073900* FORMAT.                                                        *07390065
074000******************************************************************07400065
074100 9100-SQL-ABEND.                                                  07410065
074200                                                                  07420065
074300     PERFORM 3100-DISPLAY-RUN-STATS THRU 3100-EXIT.               07430065
074400                                                                  07440065
074500     COPY DPPD004.                                                07450065
074600                                                                  07460065
074700     MOVE +4013 TO WS-ABEND-CODE.                                 07470065
074800     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         07480065
074900                                                                  07490065
075000 9100-EXIT.                                                       07500065
075100     EXIT.                                                        07510065
075200 EJECT                                                            07520065
075300******************************************************************07530065
075400* 9999-ABEND                                                      07540065
075500*     ABEND PROGRAM WHEN AN ERROR OCCURS.                         07550065
075600******************************************************************07560065
075700 9999-ABEND.                                                      07570065
075800                                                                  07580065
075900     PERFORM 3100-DISPLAY-RUN-STATS THRU 3100-EXIT.               07590065
076000                                                                  07600065
076100     DISPLAY '** ABEND           **'.                             07610065
076200     DISPLAY '** PROGRAM         ** = ' WS-CURRENT-PROGRAM-NAME.  07620065
076300     DISPLAY '** PARAGRAPH       ** = ' WS-PARAGRAPH-NAME.        07630065
076400                                                                  07640065
076500     CALL 'ILBOABN0' USING WS-AC-ABEND-CODE.                      07650065
076600                                                                  07660065
076700 9999-EXIT.                                                       07670065
076800     EXIT.                                                        07680065
