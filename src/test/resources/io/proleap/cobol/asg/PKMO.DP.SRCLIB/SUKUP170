000200***************************************************************** 00020000
000300 IDENTIFICATION DIVISION.                                         00030000
000400***************************************************************** 00040000
000500*                                                                 00050000
000600 PROGRAM-ID.             SUKUP170.                                00060001
000700 AUTHOR.                 AYAN (COGNIZANT).                        00070001
000800 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00080000
000900 DATE-WRITTEN.           MAY 2014.                                00090001
001000 DATE-COMPILED.                                                   00100000
001100*                                                                 00110000
001200***************************************************************** 00120000
001300* THIS PROGRAM PURGES THE RECORDS FROM SUT_FINCL_ADJ TABLE.       00130001
001400* RECORDS THOSE ARE IDENTIFIED OLD USING PARM VALUE WILL BE       00140001
001410* DELETED. THIS PROGRAMS READS THE FILE CREATED FROM SUKUT170     00141001
001420* PROGRAM AND DELETES RECORDS BASED ON FINCL_ADJ_ID VALUE.        00142001
001500***************************************************************** 00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001610***************************************************************** 00161001
001800 CONFIGURATION SECTION.                                           00180000
001900 SOURCE-COMPUTER.                        IBM-3090.                00190000
002000 OBJECT-COMPUTER.                        IBM-3090.                00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200 FILE-CONTROL.                                                    00220000
002300                                                                  00230000
002400     SELECT EXTRACT-FILE                                          00240000
002500         ASSIGN TO INP01.                                         00250000
002600/                                                                 00260000
002710***************************************************************** 00271001
002800 DATA DIVISION.                                                   00280000
002810***************************************************************** 00281001
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
003200 FD  EXTRACT-FILE                                                 00320000
003300     RECORDING MODE IS F                                          00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     BLOCK CONTAINS 0 RECORDS.                                    00350000
003600 01  EXTRACT-RECORD                   PIC X(393).                 00360005
003700/                                                                 00370000
003800***************************************************************** 00380000
003900 WORKING-STORAGE SECTION.                                         00390000
004000***************************************************************** 00400000
004100                                                                  00410000
004200 01  PS-SWITCHES.                                                 00420000
004300     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00430000
004400         88  PS-END-OF-INPUT                    VALUE 'Y'.        00440000
004500         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00450000
004600                                                                  00460000
004700 01  PV-PROGRAM-VARIABLES.                                        00470001
004900     05  PV-READ-COUNT                PIC  9(09) VALUE ZERO.      00490000
004910     05  PV-COMMIT-COUNT              PIC  9(09) VALUE ZERO.      00491003
005000     05  PV-DELETE-COUNT              PIC  9(09) VALUE ZERO.      00500000
005100     05  PV-TOTAL-DELETE-COUNT        PIC  9(09) VALUE ZERO.      00510004
005300     05  PV-NOT-FOUND-COUNT           PIC  9(09) VALUE ZERO.      00530000
005600     05  PV-DISPLAY-COUNT             PIC  Z(08)9.                00560003
005700                                                                  00570000
005800******************************************************************00580000
005900 01  PV-ABEND-FIELDS.                                             00590000
006000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00600000
006100                                                 COMP SYNC.       00610000
006300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00630000
006500     05  PV-CURRENT-RECORD            PIC  X(09) VALUE SPACES.    00650009
007100     05  PV-DB2-FUNCTION              PIC  X(50) VALUE SPACES.    00710000
007200/                                                                 00720000
007300 01  PC-CONSTANTS.                                                00730000
007400     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUP170'. 00740001
007700     05  PC-COMMIT-HOLD               PIC 9(03) VALUE 300.        00770008
007900/                                                                 00790000
008000******************************************************************00800001
008100*  DB2 FORMATTED MESSAGE AREA                                     00810001
008200******************************************************************00820001
008300     COPY DPWS004.                                                00830001
008400                                                                  00840001
008600******************************************************************00860000
008700*   DB2 SQL COMMUNICATION AREA                                    00870000
008800******************************************************************00880000
008900     EXEC SQL                                                     00890000
009000         INCLUDE SQLCA                                            00900000
009100     END-EXEC.                                                    00910000
009200                                                                  00920001
009210******************************************************************00921001
009220*   DB2 SQL COMMUNICATION AREA2                                   00922001
009230******************************************************************00923001
009300     COPY SQLCA2.                                                 00930000
009400                                                                  00940001
009410******************************************************************00941000
009420*   FINALCIAL ADJUSTMENT TABLE - SUT_FINCL_ADJ                    00942001
009430******************************************************************00943000
009440     EXEC SQL                                                     00944000
009450          INCLUDE SUT00030                                        00945001
009460     END-EXEC.                                                    00946000
009470                                                                  00947000
010300******************************************************************01030000
010400 PROCEDURE DIVISION.                                              01040000
010500******************************************************************01050000
010600 0000-MAINLINE.                                                   01060000
010700                                                                  01070000
010800     PERFORM 1000-INITIALIZE.                                     01080000
010900                                                                  01090000
011000     PERFORM 2000-PROCESS-EXTRACT                                 01100000
011100         UNTIL PS-END-OF-INPUT.                                   01110000
011200                                                                  01120000
011300     PERFORM 9000-EOJ.                                            01130000
011400                                                                  01140000
011500     STOP RUN.                                                    01150001
011600                                                                  01160000
012100******************************************************************01210001
012200 1000-INITIALIZE.                                                 01220001
012210******************************************************************01221001
012300                                                                  01230001
012400     OPEN INPUT  EXTRACT-FILE.                                    01240001
012500                                                                  01250001
012600     PERFORM 2100-READ-EXTRACT.                                   01260001
012700                                                                  01270001
012810******************************************************************01281001
012900 2000-PROCESS-EXTRACT.                                            01290001
012910******************************************************************01291001
013000                                                                  01300001
013100     PERFORM 7000-DELETE-FINCL-ADJ                                01310001
013200                                                                  01320001
013300     IF PV-DELETE-COUNT = PC-COMMIT-HOLD                          01330001
013400        PERFORM 7500-TAKE-COMMIT                                  01340001
013500     END-IF                                                       01350001
013600                                                                  01360001
013700     PERFORM 2100-READ-EXTRACT.                                   01370001
013800                                                                  01380001
013810******************************************************************01381001
013900 2100-READ-EXTRACT.                                               01390001
013910******************************************************************01391001
014000                                                                  01400001
014100     READ EXTRACT-FILE INTO DCLSUT00030                           01410001
014200        AT END                                                    01420001
014300           SET PS-END-OF-INPUT       TO TRUE                      01430009
014400        NOT AT END                                                01440001
014500           ADD +1                    TO PV-READ-COUNT             01450009
014700     END-READ.                                                    01470001
014800                                                                  01480001
014810******************************************************************01481001
014900 7000-DELETE-FINCL-ADJ.                                           01490001
014910******************************************************************01491001
015110                                                                  01511001
015200     EXEC SQL                                                     01520001
015300         DELETE                                                   01530001
015400           FROM SUT_FINCL_ADJ                                     01540001
015500          WHERE FINCL_ADJ_ID = :SUT00030-FINCL-ADJ-ID             01550001
015800     END-EXEC.                                                    01580001
015900                                                                  01590001
016000     EVALUATE TRUE                                                01600001
016100         WHEN SQLCODE = 0                                         01610001
016200             ADD +1                  TO PV-DELETE-COUNT           01620009
016210                                        PV-TOTAL-DELETE-COUNT     01621009
016300         WHEN SQLCODE = +100                                      01630001
016400             ADD +1                  TO PV-NOT-FOUND-COUNT        01640009
016500         WHEN SQLCODE < 0                                         01650001
016600         WHEN SQLCODE > 0                                         01660001
016700         WHEN SQLWARN0 NOT = SPACES                               01670003
016800             MOVE '7000-DELETE-FINCL-ADJ'                         01680009
016900                                     TO PV-ABEND-PARAGRAPH        01690009
017000             MOVE 'DELETE FROM SUT_FINCL_ADJ'                     01700001
017100                                     TO PV-DB2-FUNCTION           01710009
017110             MOVE SUT00030-FINCL-ADJ-ID                           01711001
017120                                     TO PV-CURRENT-RECORD         01712009
017200             PERFORM 9200-SQL-ABEND                               01720001
017300     END-EVALUATE.                                                01730001
017500                                                                  01750001
017510******************************************************************01751003
017600 7500-TAKE-COMMIT.                                                01760003
017610******************************************************************01761003
017702                                                                  01770203
017710     EXEC SQL                                                     01771003
017720        COMMIT                                                    01772003
017730     END-EXEC.                                                    01773003
017740                                                                  01774003
017741     EVALUATE TRUE                                                01774103
017742         WHEN SQLCODE = 0                                         01774203
017743             ADD +1                  TO PV-COMMIT-COUNT           01774309
017744             MOVE 0                  TO PV-DELETE-COUNT           01774409
017746         WHEN SQLCODE < 0                                         01774603
017747         WHEN SQLCODE > 0                                         01774703
017748         WHEN SQLWARN0 NOT = SPACES                               01774803
017749             MOVE '7500-TAKE-COMMIT' TO PV-ABEND-PARAGRAPH        01774909
017750             MOVE 'COMMIT'           TO PV-DB2-FUNCTION           01775009
017753             PERFORM 9200-SQL-ABEND                               01775303
017754     END-EVALUATE.                                                01775404
017760                                                                  01776003
017800******************************************************************01780001
017900 9000-EOJ.                                                        01790001
017910******************************************************************01791001
018100     CLOSE EXTRACT-FILE.                                          01810001
018110                                                                  01811004
018120     IF PV-DELETE-COUNT > 0                                       01812004
018130        PERFORM 7500-TAKE-COMMIT                                  01813004
018140     END-IF                                                       01814004
018200                                                                  01820001
018210     DISPLAY '** ' PC-CURRENT-PROGRAM-NAME ' SUMMARY **'          01821003
018300     MOVE PV-READ-COUNT              TO PV-DISPLAY-COUNT.         01830009
018400     DISPLAY '** TOTAL RECORDS READ    : '  PV-DISPLAY-COUNT.     01840006
018500     MOVE PV-TOTAL-DELETE-COUNT      TO PV-DISPLAY-COUNT.         01850009
018501     DISPLAY '** TOTAL ROWS DELETED    : '  PV-DISPLAY-COUNT.     01850106
018700     MOVE PV-NOT-FOUND-COUNT         TO PV-DISPLAY-COUNT.         01870009
018710     DISPLAY '** TOTAL ROWS NOT FOUND  : '  PV-DISPLAY-COUNT.     01871006
018720     MOVE PV-COMMIT-COUNT            TO PV-DISPLAY-COUNT.         01872009
018730     DISPLAY '** NUMBER OF COMMITS     : '  PV-DISPLAY-COUNT.     01873006
018900                                                                  01890001
019000/                                                                 01900001
019100******************************************************************01910001
019200 9200-SQL-ABEND.                                                  01920001
019300******************************************************************01930001
019400                                                                  01940001
019500     MOVE SQLCODE                    TO SQLCODE2.                 01950009
019700                                                                  01970001
019800     DISPLAY '** ABEND **          ** = SQLERROR'.                01980001
019900     DISPLAY '** PROGRAM           ** = ' PC-CURRENT-PROGRAM-NAME.01990001
020000     DISPLAY '** PARAGRAPH         ** = ' PV-ABEND-PARAGRAPH.     02000001
020100     DISPLAY '** OPERATION         ** = ' PV-DB2-FUNCTION.        02010001
020200     DISPLAY '** PROCESSING RECORD ** = ' PV-CURRENT-RECORD.      02020001
020600     DISPLAY '** SQLCODE           ** = ' SQLCODE2.               02060001
020910                                                                  02091001
020920************************************************************      02092002
020930* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STAT      02093002
020940* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02094002
020950* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABL      02095002
020960* FORMAT.                                                         02096002
020970************************************************************      02097002
021000     COPY DPPD004.                                                02100001
021100                                                                  02110001
021200     MOVE +4013                      TO PV-ABEND-CODE.            02120009
021300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02130001
021400                                                                  02140001
