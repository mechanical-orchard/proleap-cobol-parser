000100 IDENTIFICATION DIVISION.                                         00010068
000200 PROGRAM-ID.    RCKUP824.                                         00020073
000300 AUTHOR.        JOE LAROSA.                                       00030068
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040068
000500 DATE-WRITTEN.  FEBRUARY, 2003.                                   00050068
000600 DATE-COMPILED.                                                   00060068
001200                                                                  00061097
000700******************************************************************00070068
000800*  BATCH PRORATION CALLED FROM RCKUP821 USING RCWS824 COMMAREA  * 00080093
      *  COPIED FROM RCKCS824                                           00081093
      *    IF EITHER THIS PROGRAM OR RCKCS824 CHANGE, THE OTHER SHOULD  00082094
      *    BE CHECKED TO SEE IF THE SAME CHANGE SHOULD BE MADE          00083094
000900*                                                                *00090068
001000*     IF RECEIVED QTY GREATER THAN 'OPEN-TO-RECEIVE' (OVERAGE)   *00100068
001100*     - PARAGRAGH 2000 PRORATES USING SALES RANKING OF STORES    *00110068
001200*     - PARAGRAGH 3000 PRORATES USING FILL-IN METHOD             *00120068
001300*     - PARAGRAGH 4000 PRORATES USING STORE SALES PERCENTAGES    *00130068
001400*                                                                *00140068
001500*     IF RECEIVED QTY LESS THAN 'OPEN-TO-RECEIVE' (SHORTAGE)     *00150068
001600*     - PARAGRAGH 5000 PRORATES USING SALES RANKING OF STORES    *00160068
001700*     - PARAGRAGH 6000 PRORATES USING FILL-IN METHOD             *00170068
001800*     - PARAGRAGH 7000 PRORATES USING STORE SALES PERCENTAGES    *00180068
001900******************************************************************00190068
002000 ENVIRONMENT DIVISION.                                            00200068
002100 CONFIGURATION SECTION.                                           00210068
002200 SOURCE-COMPUTER.        IBM-3090.                                00220068
002300 OBJECT-COMPUTER.        IBM-3090.                                00230068
002400                                                                  00240068
002500 DATA DIVISION.                                                   00250068
002600******************************************************************00260068
002700 WORKING-STORAGE SECTION.                                         00270068
002800******************************************************************00280068
002900 01  PS-PROGRAM-SWITCHES.                                         00290068
003000     05  PS-DONE-SW                   PIC X(01) VALUE 'N'.        00300068
003100         88  PS-DONE-NO                         VALUE 'N'.        00310068
003200         88  PS-DONE-YES                        VALUE 'Y'.        00320068
003300     05  PS-END-OF-OVRG-CSR-SW        PIC X(01) VALUE 'N'.        00330068
003400         88  PS-END-OF-OVRG-CSR-YES             VALUE 'Y'.        00340068
003500         88  PS-END-OF-OVRG-CSR-NO              VALUE 'N'.        00350068
003600     05  PS-RANDOM-STR-MATCH-SW       PIC X(01) VALUE 'N'.        00360068
003700         88  PS-RANDOM-STR-MATCH-YES            VALUE 'Y'.        00370068
003800         88  PS-RANDOM-STR-MATCH-NO             VALUE 'N'.        00380068
003900                                                                  00390068
004000 01  PC-PROGRAM-CONSTANTS.                                        00400068
004100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKUP824'. 00410073
004100     05  PC-RCKUT825                  PIC X(08) VALUE 'RCKUT825'. 00420099
 04300     05  PC-1811                      PIC S9(4) COMP VALUE +1811. 00430099
004400     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00440068
004500                                                COMP SYNC.        00450068
004600     05  PC-DEFAULT-DATE              PIC X(26) VALUE             00460068
004700                                     '9999-09-09-00.00.00.000000'.00470068
004800                                                                  00480068
004900 01  DK-DATABASE-KEYS.                                            00490068
005000     05  DK-GEN-KEY                   PIC X(10).                  00500068
005100     05  DK-RULE-SEQ                  PIC S9(4).                  00510068
005200     05  DK-RULE-RESULT               PIC X(01).                  00520068
005300                                                                  00530068
005400 01  PV-PROGRAM-VARIABLES.                                        00540068
005500     05  PV-QUEUE-NAME.                                           00550068
005600         10  PV-TERM-ID               PIC X(4).                   00560068
005700         10  PV-TASK-NUMBER           PIC S9(5) COMP-3.           00570068
005800         10  PV-SEQ                   PIC 9.                      00580068
005900                                                                  00590068
006000     05  A                            PIC S9(4) COMP SYNC.        00600068
006100     05  B                            PIC S9(4) COMP SYNC.        00610068
006200     05  L                            PIC S9(4) COMP SYNC.        00620068
006300     05  M                            PIC S9(4) COMP SYNC.        00630068
006400     05  DL                           PIC S9(4) COMP SYNC.        00640068
006500     05  PV-ITEM                      PIC S9(4) VALUE ZERO        00650068
006600                                                COMP SYNC.        00660068
006900     05  PV-RETRY-COUNTER             PIC S9(4) VALUE +0 COMP.    00690068
007000                                                                  00700068
007100     05  PV-MAX-STORES                PIC 9(05).                  00710068
007200     05  PV-MAX-ITEMS                 PIC 9(05).                  00720068
007300     05  PV-DISPERSAL-QTY             PIC 9(07).                  00730070
007400     05  PV-PCT-QTY                   PIC 9(06)V9999.             00740070
007500     05  PV-PCT-QTY-N REDEFINES PV-PCT-QTY.                       00750068
007600         10  PV-PCT-QTY-NBR           PIC 9(06).                  00760070
007700         10  PV-PCT-QTY-FRACTION      PIC 9(04).                  00770068
007800     05  PV-TEMP-OTR-QTY              PIC 9(07).                  00780070
007900     05  PV-ALLOC-QTY                 PIC 9(07).                  00790070
008000     05  PV-ALLOC-QTY-ACCUM           PIC 9(07).                  00800068
008100     05  PV-REMAINDER                 PIC 9(5)V9999.              00810068
008200     05  PV-REMAINDER-PCT             PIC 9(3)V9999.              00820068
008300     05  PV-ALLOC-QTY-TIER            PIC 9(07).                  00830070
008400     05  PV-UNITS-NEEDED              PIC 9(07).                  00840070
008500     05  PV-RG-STR-OTR                PIC S9(9).                  00850068
008600     05  PV-CS-STR-OTR                PIC S9(9).                  00860068
008700     05  PV-NW-STR-OTR                PIC S9(9).                  00870068
008800     05  PV-WK-STR-OTR                PIC S9(9).                  00880068
008900     05  PV-WORK-OTR-RG               PIC S9(9).                  00890068
009000     05  PV-WORK-OTR-NW               PIC S9(9).                  00900068
009100     05  PV-WORK-OTR-CS               PIC S9(9).                  00910068
009200     05  PV-TOT-STR-OTR               PIC S9(9).                  00920068
009300     05  PV-RG-STR-CNT                PIC 9(06).                  00930070
009400     05  PV-CS-STR-CNT                PIC 9(06).                  00940070
009500     05  PV-NW-STR-CNT                PIC 9(06).                  00950070
009600     05  PV-WK-STR-CNT                PIC 9(06).                  00960070
009700     05  PV-TOT-PLAN-QTY              PIC S9(7).                  00970068
009800     05  PV-RG-PLAN-QTY               PIC S9(7).                  00980068
009900     05  PV-NW-PLAN-QTY               PIC S9(7).                  00990068
010000     05  PV-CS-PLAN-QTY               PIC S9(7).                  01000068
010100     05  PV-NO-PACK-STR-CNT           PIC 9(06).                  01010070
010200                                                                  01020068
010300     05  PV-LEFT-TO-ALLOC             PIC S9(9).                  01030068
010400     05  PV-LEFT-TO-ALLOC-DISP        PIC ZZZZ,ZZ9-.              01040070
010500     05  PV-DISPLAY-QTY               PIC ZZZZ,ZZ9-.              01050070
010600     05  PV-HOLD-QTY                  PIC 9(09).                  01060068
010700     05  PV-OVERAGE-QTY               PIC S9(9).                  01070068
010800     05  PV-SHORTAGE-QTY              PIC S9(9).                  01080068
010900                                                                  01090068
011000     05  PV-RANDOM-STR-SEL-CNT        PIC 9(05)V9999.             01100070
011100     05  PV-RANDOM-STR-SEL-CNT-X REDEFINES                        01110068
011200         PV-RANDOM-STR-SEL-CNT.                                   01120068
011300         10 PV-RANDOM-STR-SEL-QTY     PIC 9(05).                  01130070
011400         10 PV-RANDOM-STR-SEL-REM     PIC 9(04).                  01140068
011500     05  PV-ALLOC-OUTR-PK-QTY         PIC S9(7) COMP-3.           01150068
011600     05  PV-ALLOC-OUTR-PACKS          PIC S9(7) COMP-3.           01160068
011700     05  PV-ALLOC-OUTR-UNITS          PIC S9(7) COMP-3.           01170068
011800     05  PV-HIGH-TIER-PCT             PIC 999.                    01180068
011900     05  PV-HIGH-PCT-TIER             PIC 99.                     01190068
012000     05  PV-DIFFERENCE                PIC 9(06).                  01200068
012100     05  PV-ACCUM-TIER-STORES         PIC 9(06).                  01210070
012200     05  PV-ACCUM-ALLOC-USED          PIC 9(06).                  01220068
012300     05  PV-TIER-COUNT                PIC 9(06).                  01230071
012400     05  PV-NBR-STR-TO-ASSIGN         PIC 9(06).                  01240071
012500     05  PV-STR-TIER-COUNT            PIC 9(06).                  01250071
012600     05  PV-STR-TIER-QTY              PIC 9(07).                  01260068
012700     05  PV-COMPARE-TIER              PIC 9(06).                  01270071
012800     05  PV-PK-SIZE-RND-CDE           PIC X(01)  VALUE SPACE.     01280068
012900         88  PV-VALID-PK-SIZE-RND-CDE     VALUES ARE              01290068
013000             '1'  '2'  '3'  '4'  '5'  '6'  '7'  '8'  '9'          01300068
013100             'R'  'U'.                                            01310068
013200                                                                  01320068
013300 01  WS-STORE-TABLE-REG.                                          01330068
013400     05  RG-STORE-ENTRY OCCURS 200 TIMES.                         01340068
013500         10  RG-STR-NBR               PIC 9(04).                  01350068
013600         10  RG-ALLOC-LNE-NBR         PIC 9(04).                  01360068
013700         10  RG-EXISTING-STORE-CDE    PIC X(01).                  01370068
013800         10  RG-ST-TYPE-CODE          PIC  X(2).                  01380068
013900         10  RG-STR-PLAN-QTY          PIC S9(9).                  01390068
014000         10  RG-STR-PLAN-PK           PIC S9(9).                  01400068
014100         10  RG-STR-PLAN-OTR-QTY      PIC S9(9).                  01410068
014200         10  RG-STR-PLAN-OTR-PK       PIC S9(9).                  01420068
014300         10  RG-STR-OTR-PK            PIC S9(9).                  01430068
014400         10  RG-STR-OTR-QTY           PIC S9(9).                  01440068
014500         10  RG-STR-OTR-QTY-ORIG      PIC S9(9).                  01450068
014600         10  RG-RNK-SEQ-NBR           PIC 9(04).                  01460068
014700         10  RG-STR-TIER              PIC 9(04).                  01470068
014800         10  RG-ALLOC-UNITS           PIC S9(9).                  01480071
014900         10  RG-STR-ALLOC-PCT         PIC S99V9(5).               01490068
015000                                                                  01500068
015100 01  WS-STORE-TABLE-CS.                                           01510068
015200     05  CS-STORE-ENTRY OCCURS 200 TIMES.                         01520068
015300         10  CS-STR-NBR               PIC 9(04).                  01530068
015400         10  CS-ALLOC-LNE-NBR         PIC 9(04).                  01540068
015500         10  CS-EXISTING-STORE-CDE    PIC X(01).                  01550068
015600         10  CS-ST-TYPE-CODE          PIC  X(2).                  01560068
015700         10  CS-STR-PLAN-QTY          PIC S9(9).                  01570068
015800         10  CS-STR-PLAN-PK           PIC S9(9).                  01580068
015900         10  CS-STR-PLAN-OTR-QTY      PIC S9(9).                  01590068
016000         10  CS-STR-PLAN-OTR-PK       PIC S9(9).                  01600068
016100         10  CS-STR-OTR-PK            PIC S9(9).                  01610068
016200         10  CS-STR-OTR-QTY           PIC S9(9).                  01620068
016300         10  CS-STR-OTR-QTY-ORIG      PIC S9(9).                  01630068
016400         10  CS-RNK-SEQ-NBR           PIC 9(04).                  01640068
016500         10  CS-STR-TIER              PIC 9(04).                  01650068
016600         10  CS-ALLOC-UNITS           PIC S9(9).                  01660071
016700         10  CS-STR-ALLOC-PCT         PIC S99V9(5).               01670068
016800                                                                  01680068
016900 01  WS-STORE-TABLE-NEW.                                          01690068
017000     05  NW-STORE-ENTRY OCCURS 200 TIMES.                         01700068
017100         10  NW-STR-NBR               PIC 9(04).                  01710068
017200         10  NW-ALLOC-LNE-NBR         PIC 9(04).                  01720068
017300         10  NW-EXISTING-STORE-CDE    PIC X(01).                  01730068
017400         10  NW-ST-TYPE-CODE          PIC  X(2).                  01740068
017500         10  NW-STR-PLAN-QTY          PIC S9(9).                  01750068
017600         10  NW-STR-PLAN-PK           PIC S9(9).                  01760068
017700         10  NW-STR-PLAN-OTR-QTY      PIC S9(9).                  01770068
017800         10  NW-STR-PLAN-OTR-PK       PIC S9(9).                  01780068
017900         10  NW-STR-OTR-PK            PIC S9(9).                  01790068
018000         10  NW-STR-OTR-QTY           PIC S9(9).                  01800068
018100         10  NW-STR-OTR-QTY-ORIG      PIC S9(9).                  01810068
018200         10  NW-RNK-SEQ-NBR           PIC 9(04).                  01820068
018300         10  NW-STR-TIER              PIC 9(04).                  01830068
018400         10  NW-ALLOC-UNITS           PIC S9(9).                  01840071
018500         10  NW-STR-ALLOC-PCT         PIC S99V9(5).               01850068
018600                                                                  01860068
018700 01  WS-STORE-TABLE-WRK.                                          01870068
018800     05  WK-STORE-ENTRY OCCURS 200 TIMES.                         01880068
018900         10  WK-STR-NBR               PIC 9(04).                  01890068
019000         10  WK-ALLOC-LNE-NBR         PIC 9(04).                  01900068
019100         10  WK-EXISTING-STORE-CDE    PIC X(01).                  01910068
019200         10  WK-ST-TYPE-CODE          PIC  X(2).                  01920068
019300         10  WK-STR-PLAN-QTY          PIC S9(9).                  01930068
019400         10  WK-STR-PLAN-PK           PIC S9(9).                  01940068
019500         10  WK-STR-PLAN-OTR-QTY      PIC S9(9).                  01950068
019600         10  WK-STR-PLAN-OTR-PK       PIC S9(9).                  01960068
019700         10  WK-STR-OTR-PK            PIC S9(9).                  01970068
019800         10  WK-STR-OTR-QTY           PIC S9(9).                  01980068
019900         10  WK-STR-OTR-QTY-ORIG      PIC S9(9).                  01990068
020000         10  WK-RNK-SEQ-NBR           PIC 9(04).                  02000068
020100         10  WK-STR-TIER              PIC 9(04).                  02010068
020200         10  WK-ALLOC-UNITS           PIC S9(9).                  02020071
020300         10  WK-STR-ALLOC-PCT         PIC S99V9(5).               02030068
020400                                                                  02040068
020500 01  WS-HOLD-STORE-TABLE.                                         02050068
020600     05  WS-H-STR-NBR                 PIC 9(04).                  02060068
020700     05  WS-H-ALLOC-LNE-NBR           PIC 9(04).                  02070068
020800     05  WS-H-EXISTING-STORE-CDE      PIC X(01).                  02080068
020900     05  WS-H-ST-TYPE-CODE            PIC  X(2).                  02090068
021000     05  WS-H-STR-PLAN-QTY            PIC S9(9).                  02100068
021100     05  WS-H-STR-PLAN-PK             PIC S9(9).                  02110068
021200     05  WS-H-STR-PLAN-OTR-QTY        PIC S9(9).                  02120068
021300     05  WS-H-STR-PLAN-OTR-PK         PIC S9(9).                  02130068
021400     05  WS-H-STR-OTR-PK              PIC S9(9).                  02140068
021500     05  WS-H-STR-OTR-QTY             PIC S9(9).                  02150068
021600     05  WK-H-STR-OTR-QTY-ORIG        PIC S9(9).                  02160068
021700     05  WS-H-RNK-SEQ-NBR             PIC 9(04).                  02170068
021800     05  WS-H-STR-TIER                PIC 9(04).                  02180068
021900     05  WS-H-ALLOC-UNITS             PIC S9(9).                  02190071
022000     05  WS-H-STR-ALLOC-PCT           PIC S99V9(5).               02200068
022100                                                                  02210068
022200 01  WS-OVERAGE-TABLE.                                            02220068
022300     05  WS-OVRG-ENTRY OCCURS 10 TIMES.                           02230068
022400         10  WS-OVRG-TIER             PIC 99.                     02240068
022500         10  WS-OVRG-TIER-PCT         PIC 9(03).                  02250068
022600         10  WS-OVRG-PCT-PRRTN        PIC 9(03).                  02260068
022700         10  WS-OVRG-NBR-STR          PIC 9(04).                  02270068
022800         10  WS-OVRG-QTY-STR          PIC 9(09).                  02280071
022900                                                                  02290068
023000 01  RC001-WORK-FIELDS.                                           02300068
023200     05  RC001-LOG-LINE               PIC X(80) VALUE SPACES.     02320068
023400     05  RC001-SAVE-SQLCODE           PIC S9(8) COMP VALUE ZERO.  02340068
023500                                                                  02350068
023600 01  RC001-ERROR-MESSAGE-LINES.                                   02360068
023700     05  RC001-LINE-01.                                           02370068
023800         10  FILLER                   PIC X(46) VALUE             02380068
023900             '****** RCKUP824 - PRORATION EDIT ERROR ****** '.    02390073
024000         10  FILLER                   PIC X(01) VALUE SPACES.     02400071
024100         10  FILLER                   PIC X(08) VALUE             02410068
024200                                                'USERID= '.       02420068
024300         10  RC001-USERID             PIC X(07) VALUE SPACES.     02430068
024400         10  FILLER                   PIC X(02) VALUE SPACES.     02440071
024500         10  RC001-PRO-PATH           PIC X(05) VALUE SPACES.     02450071
024600         10  FILLER                   PIC X(11) VALUE SPACES.     02460071
024700     05  RC001-LINE-02.                                           02470068
024800         10  RC001-DATE               PIC X(10) VALUE SPACES.     02480068
024900         10  FILLER                   PIC X(02) VALUE SPACES.     02490068
025000         10  RC001-TIME               PIC X(08) VALUE SPACES.     02500068
025100         10  FILLER                   PIC X(02) VALUE SPACES.     02510068
025200         10  FILLER                   PIC X(11) VALUE             02520068
025300                                                'PARAGRAPH= '.    02530068
025400         10  RC001-PARAGRAPH          PIC X(30) VALUE ZEROES.     02540068
025500         10  FILLER                   PIC X(02) VALUE SPACES.     02550068
025600         10  FILLER                   PIC X(10) VALUE             02560068
025700                                                ' SQLCODE= '.     02570068
025800         10  RC001-SQLCODE            PIC -999.                   02580068
025900         10  FILLER                   PIC X(01) VALUE SPACES.     02590068
026000     05  RC001-LINE-03.                                           02600068
026100         10  FILLER                   PIC X(14) VALUE             02610068
026200                                                'PO/RCVR/LINE= '. 02620068
026300         10  RC001-PO.                                            02630068
026400             15  RC001-PO-NBR         PIC 9(08) VALUE ZEROES.     02640068
026500         10  FILLER                   PIC X(01) VALUE '/'.        02650068
026600         10  RC001-RCVR.                                          02660068
026700             15  RC001-REC-SEQ-NBR    PIC 9(03) VALUE ZEROES.     02670068
026800         10  FILLER                   PIC X(01) VALUE '/'.        02680068
026900         10  RC001-LINE.                                          02690068
027000             15 RC001-PO-LNE-NBR      PIC 9(03) VALUE ZEROES.     02700068
027100         10  FILLER                   PIC X(03) VALUE SPACES.     02710068
027200         10  FILLER                   PIC X(12) VALUE             02720068
027300                                                'OPER/FCLTY= '.   02730068
027500         10  RC001-OPER-UNT-ID        PIC 9(04) VALUE ZEROES.     02750072
027600         10  FILLER                   PIC X(01) VALUE '/'.        02760068
027700         10  RC001-FCLTY.                                         02770068
027800             15  RC001-FCLTY-ID       PIC 9(01) VALUE ZEROES.     02780068
027900         10  FILLER                   PIC X(03) VALUE SPACES.     02790068
028000         10  FILLER                   PIC X(06) VALUE             02800068
028100                                                'PACK= '.         02810068
028200         10  RC001-PREPK-ID           PIC 9(04) VALUE ZEROES.     02820068
028300         10  FILLER                   PIC X(03) VALUE SPACES.     02830068
028400         10  FILLER                   PIC X(07) VALUE             02840068
028500                                                'STORE= '.        02850068
028600         10  RC001-STORE-NBR.                                     02860068
028700             15  RC001-STORE-NBR-N    PIC 9(04) VALUE ZEROES.     02870068
028800         10  FILLER                   PIC X(03) VALUE SPACES.     02880068
028900     05  RC001-LINE-04.                                           02890068
029000         10  RC001-SPECIAL-1          PIC X(40) VALUE SPACES.     02900068
029100         10  RC001-SPECIAL-2          PIC X(40) VALUE SPACES.     02910068
029200     05  RC001-LINE-05.                                           02920068
029300         10  FILLER                   PIC X(46) VALUE             02930068
029400             '****** RCKUP824 - PRORATION EDIT ERROR ****** '.    02940073
029500         10  FILLER                   PIC X(34) VALUE SPACES.     02950068
029600                                                                  02960068
029700******************************************************************02970068
029800* COPYBOOK AREAS                                                  02980068
029900******************************************************************02990068
030000* INPUT PASSED FROM RCKCS821                                      03000068
030100     COPY RCWS824.                                                03010068
030200                                                                  03020068
030300* TEMP STORAGE AREA.                                              03030068
030400     COPY RCWS821.                                                03040068
030500                                                                  03050068
030600* OUTPUT PASSED TO RANDOM ROUTINE.                                03060068
030700     COPY RCWS825.                                                03070099
030800                                                                  03080068
030900* OUTPUT PASSED TO TROUBLE.                                       03090068
031000     COPY TMWS500.                                                03100068
031100                                                                  03110068
031200* OUTPUT PASSED PASSED BACK TO CALLING PROGRAM.                   03120068
031300     COPY TMWS501.                                                03130068
031400                                                                  03140068
031200* ERROR DATA PASSED BACK UPSTREAM.                                03141099
031300     COPY TMRD007.                                                03142099
031400                                                                  03143099
031500******************************************************************03150068
031600* DB2 SQL COMMUNICATION AREA                                      03160068
031700******************************************************************03170068
031800     EXEC SQL                                                     03180068
031900         INCLUDE SQLCA                                            03190068
032000     END-EXEC.                                                    03200068
032100                                                                  03210068
032200******************************************************************03220068
032300* DB2 DCLGENS                                                     03230068
032400******************************************************************03240068
032500*COMPANY CONTROL TABLE                                            03250068
032600     EXEC SQL                                                     03260068
032700         INCLUDE TCOCNTL                                          03270068
032800     END-EXEC.                                                    03280068
032900                                                                  03290068
033000*PRORATION RULE TABLE                                             03300068
033100     EXEC SQL                                                     03310068
033200         INCLUDE RCT00004                                         03320068
033300     END-EXEC.                                                    03330068
033400                                                                  03340068
033500*RECEIPT DISTRIBUTION TABLE                                       03350068
033600     EXEC SQL                                                     03360068
033700         INCLUDE TRECDIS                                          03370068
033800     END-EXEC.                                                    03380068
033900                                                                  03390068
034000******************************************************************03400068
034100* OVERAGE SCHEDULE (DB2 TABLE) CURSOR                             03410068
034200******************************************************************03420068
034300     EXEC SQL                                                     03430068
034400         DECLARE OVRG-CSR CURSOR FOR                              03440068
034500           SELECT LOC_GP_RNK_NBR                                  03450068
034600                , LOC_QTY_PCT                                     03460068
034700                , OVRG_PCT                                        03470068
034800             FROM RCT_OVRG_LOC_RNK                                03480068
034900         ORDER BY LOC_GP_RNK_NBR                                  03490068
035000     END-EXEC.                                                    03500068
035100                                                                  03510068
035200******************************************************************03520068
      * *  OLD LENGTHS                                                  03520199
043800*01  LINK-PO-RECEIVER-CONTENTS       PIC X(179).                  03521099
043900*01  LINK-STORE-COMPONENTS           PIC X(34800).                03522099
044000*01  LINK-ITEM-ARRAY-ALL             PIC X(15600).                03523099
035300******************************************************************03530068
035400 LINKAGE SECTION.                                                 03540068
035500                                                                  03550068
035600 01  LINK-COMMAREA                   PIC X(628).                  03560074
043800 01  LINK-PO-RECEIVER-CONTENTS       PIC X(162).                  03570099
043900 01  LINK-STORE-COMPONENTS           PIC X(18800).                03580099
044000 01  LINK-ITEM-ARRAY-ALL             PIC X(13600).                03590099
044000 01  LINK-TMRD007                    PIC X(800).                  03590199
044100                                                                  03591074
044200/*****************************************************************03592074
044300 PROCEDURE DIVISION USING LINK-COMMAREA                           03593090
044400                          LINK-PO-RECEIVER-CONTENTS               03594074
044500                          LINK-STORE-COMPONENTS                   03595074
044600                          LINK-ITEM-ARRAY-ALL                     03596099
044600                          LINK-TMRD007.                           03597099
036000                                                                  03600068
036300******************************************************************03630068
036400 0000-MAIN-MODULE.                                                03640068
036500     MOVE '0000-MAIN-MODULE              ' TO RC001-PARAGRAPH.    03650068
045000     DISPLAY '**********************'.                            03651075
045100     DISPLAY '*** RCKUP824 START ***'.                            03652096
045200     DISPLAY '**********************'.                            03653075
045300     DISPLAY ' '.                                                 03654075
036600                                                                  03660068
036700*LOAD PASSED DATA.                                                03670068
036800     INITIALIZE RC824-COMMAREA.                                   03680068
036900     MOVE LINK-COMMAREA         TO RC824-COMMAREA.                03690074
037000     MOVE RC824-TM500-FIELDS    TO TM500-FIELDS.                  03700068
037100     SET PS-DONE-NO             TO TRUE.                          03710068
                                                                        03710178
047000*RC821-PO-RECEIVER-CONTENTS                                       03711075
047100     MOVE LINK-PO-RECEIVER-CONTENTS TO RC821-PO-RECEIVER-CONTENTS.03712075
047200                                                                  03713075
047300*RC821-STORE-COMPONENTS                                           03714075
047400     MOVE LINK-STORE-COMPONENTS   TO RC821-STORE-COMPONENTS.      03715075
047500                                                                  03716075
047600*RC821-ITEM-ARRAY-ALL.                                            03717075
047700     MOVE LINK-ITEM-ARRAY-ALL     TO RC821-ITEM-ARRAY-ALL.        03718099
048400                                                                  03719675
047600*RC821-ITEM-ARRAY-ALL.                                            03719799
047700     MOVE LINK-TMRD007            TO TM007-COMMUNICATIONS-AREA.   03719899
           MOVE PC-CURRENT-PROGRAM-NAME TO TM007-CALLED-MODULE          03719999
048400                                                                  03720099
037300*TOTAL UNITS TO DISTRIBUTE                                        03730068
037400     MOVE TM500-UNITS-TO-ALLOC  TO PV-LEFT-TO-ALLOC.              03740068
037500                                                                  03752099
037600*MAXIMUM NUMBER OF STORES.                                        03760068
037700     MOVE RC821-MAX-STR-COUNT   TO PV-MAX-STORES.                 03770075
037800                                                                  03780068
037900*MAXIMUM NUMBER OF ITEMS.                                         03790068
038000     MOVE RC821-MAX-ITEM-COUNT  TO PV-MAX-ITEMS.                  03800068
038100                                                                  03810068
038700*SET DRIVER LINE OCCURRENCE.                                      03870068
038800     MOVE 1 TO DL.                                                03880068
038900     PERFORM                                                      03890068
039000       VARYING RC821-ITEM-IDX FROM 1 BY 1                         03900068
039100         UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0             03910068
039200            OR RC821-ITEM-IDX > PV-MAX-ITEMS                      03920068
039300                                                                  03930068
039400         IF (RC821-REC-LNE-NBR (RC821-ITEM-IDX) > ZEROES)         03940068
039500           AND (RC821-REC-LNE-NBR (RC821-ITEM-IDX) =              03950068
039600                RC821-REC-DRV-LNE-NBR)                            03960068
039700             SET DL TO RC821-ITEM-IDX                             03970068
039800         END-IF                                                   03980068
039900     END-PERFORM.                                                 03990068
040000                                                                  04000068
040100*ROUNDING CODE FOR PACKS.                                         04010068
040200     MOVE RC821-PK-SIZE-RND-CDE TO PV-PK-SIZE-RND-CDE.            04020068
040300                                                                  04030068
040400*SET DISTRIBUTION QTY PER UNIT (DISPERSAL QUANTITY).              04040068
040500*IF NO QTY FOUND, ERROR.                                          04050068
040600     IF RC821-PKGNG-CDE = 'I' OR 'M'                              04060068
040700         MOVE RC821-REC-PACK-RATO-QTY (DL)  TO PV-DISPERSAL-QTY   04070068
040800     ELSE                                                         04080068
040900         MOVE RC821-REC-INNER-PACK-QTY (DL) TO PV-DISPERSAL-QTY   04090068
041000     END-IF.                                                      04100068
041100     IF PV-DISPERSAL-QTY NOT > ZEROES                             04110068
041200         SET PS-DONE-YES   TO TRUE                                04120068
041300         MOVE SPACES       TO TM501-TM500-RETURN-MSG              04130068
041400         MOVE '0000'       TO TM501-PARA                          04140068
                                    TM007-RETURNED-PARA                 04141099
041500         MOVE '824'        TO TM501-PGM                           04150068
041600         MOVE SQLCODE      TO TM500-SQLCODE                       04160068
                                    TM007-SQLCODE                       04161099
041700         MOVE SQLCA        TO TM500-SQLCA                         04170068
                                    TM007-SQLCA                         04171099
041800         MOVE 101          TO TM501-PRORATION-ERROR-NBR           04180068
041900         PERFORM TM501-SET-TM500-RETURN-MSG                       04190068
               MOVE TM500-RETURN-DATA                                   04201099
                                 TO TM007-RETURN-DATA                   04202099
042000         PERFORM RC001-RETURN-MSG                                 04203099
042100     END-IF.                                                      04210068
042200                                                                  04220068
042300************************                                          04230068
042400*LOAD INPUT STORE DATA *                                          04240068
042500************************                                          04250068
042600     MOVE ZEROES TO PV-RG-STR-OTR                                 04260068
042700                    PV-RG-STR-CNT                                 04270068
042800                    PV-RG-PLAN-QTY                                04280068
042900                    PV-CS-STR-OTR                                 04290068
043000                    PV-CS-STR-CNT                                 04300068
043100                    PV-CS-PLAN-QTY                                04310068
043200                    PV-NW-STR-OTR                                 04320068
043300                    PV-NW-STR-CNT                                 04330068
043400                    PV-NW-PLAN-QTY                                04340068
043500                    PV-WK-STR-OTR                                 04350068
043600                    PV-WK-STR-CNT                                 04360068
043700                    PV-TOT-PLAN-QTY                               04370068
043800                    PV-TOT-STR-OTR.                               04380068
043900     PERFORM 0500-LOAD-STORE-TABLES.                              04390068
044000                                                                  04400068
044100************************************************                  04410068
044200*DETERMINE ALLOCATION BASED ON PRORATION METHOD*                  04420068
044300************************************************                  04430068
044400     IF PS-DONE-NO                                                04440068
044500*EQUAL (UNITS TO ALLOCATE = OPEN TO RECEIVE)                      04450068
044600         IF PV-LEFT-TO-ALLOC = PV-TOT-STR-OTR                     04460068
044700             PERFORM                                              04470068
044800               VARYING L FROM 1 BY 1                              04480068
044900                 UNTIL L > PV-MAX-STORES                          04490068
045000                                                                  04500068
045100                 MOVE RG-STR-OTR-QTY (L) TO RG-ALLOC-UNITS (L)    04510068
045200                 SUBTRACT RG-STR-OTR-QTY (L)                      04520068
045300                     FROM PV-LEFT-TO-ALLOC                        04530068
045400                 MOVE NW-STR-OTR-QTY (L) TO NW-ALLOC-UNITS (L)    04540068
045500                 SUBTRACT NW-STR-OTR-QTY (L)                      04550068
045600                     FROM PV-LEFT-TO-ALLOC                        04560068
045700                 MOVE CS-STR-OTR-QTY (L) TO CS-ALLOC-UNITS (L)    04570068
045800                 SUBTRACT CS-STR-OTR-QTY (L)                      04580068
045900                     FROM PV-LEFT-TO-ALLOC                        04590068
046000                 MOVE ZEROES TO RG-STR-OTR-QTY (L)                04600068
046100                                NW-STR-OTR-QTY (L)                04610068
046200                                CS-STR-OTR-QTY (L)                04620068
046300             END-PERFORM                                          04630068
046400         ELSE                                                     04640068
046500*PRORATE (UNITS TO ALLOCATE NOT = OPEN TO RECEIVE)                04650068
046600             PERFORM 0300-SELECT-PRORATION-METHOD                 04660068
046700         END-IF                                                   04670068
046800     END-IF.                                                      04680068
046900                                                                  04690068
047000********************                                              04700068
047100*PERFORM ALLOCATION*                                              04710068
047200********************                                              04720068
047300     PERFORM 8000-CREATE-ALLOCATION.                              04730068
047400                                                                  04740068
047500*CHECK THAT ALL UNITS ALLOCATED.                                  04750068
047600     IF PV-LEFT-TO-ALLOC NOT = ZEROES                             04760068
047700         MOVE '> MISMATCH WHEN ATTEMPTING ALLOCATION - '          04770068
047800                                      TO RC001-SPECIAL-1          04780068
047900         MOVE PV-LEFT-TO-ALLOC TO PV-LEFT-TO-ALLOC-DISP           04790068
048000         STRING ' ==> '               DELIMITED BY SIZE           04800068
048100                'PV-LEFT-TO-ALLOC = ' DELIMITED BY SIZE           04810068
048200                PV-LEFT-TO-ALLOC-DISP DELIMITED BY SIZE           04820068
048300                ' <=='                DELIMITED BY SIZE           04830068
048400                                    INTO RC001-SPECIAL-2          04840068
048500         SET PS-DONE-YES   TO TRUE                                04850068
048600         MOVE SPACES       TO TM501-TM500-RETURN-MSG              04860068
048700         MOVE '0000'       TO TM501-PARA                          04870068
048700                              TM007-RETURNED-PARA                 04871099
048800         MOVE '824'        TO TM501-PGM                           04880068
048900         MOVE SQLCODE      TO TM500-SQLCODE                       04890068
049000         MOVE SQLCA        TO TM500-SQLCA                         04900068
049000                              TM007-SQLCA                         04901099
049100         MOVE 102          TO TM501-PRORATION-ERROR-NBR           04910068
049200         PERFORM TM501-SET-TM500-RETURN-MSG                       04920068
               MOVE TM500-RETURN-DATA                                   04931099
                                 TO TM007-RETURN-DATA                   04932099
049300         PERFORM RC001-RETURN-MSG                                 04933099
049400     END-IF.                                                      04940068
049500                                                                  04950068
049600*RETURN TO CALLING PROGRAM.                                       04960068
049700     PERFORM 9999-GOBACK.                                         04970099
049800                                                                  04980099
050800                                                                  05080068
062500******************************************************************06250079
062600* THIS PARAGRAPH DETERMINES THE METHOD OF PRORATION TO BE USED.  *06260068
062700*                                                                *06270068
062800*     IF RECEIVED QTY GREATER THAN 'OPEN-TO-RECEIVE' (OVERAGE)   *06280068
062900*     - PARAGRAGH 2000 PRORATES USING SALES RANKING OF STORES    *06290068
063000*     - PARAGRAGH 3000 PRORATES USING FILL-IN METHOD             *06300068
063100*     - PARAGRAGH 4000 PRORATES USING STORE SALES PERCENTAGES    *06310068
063200*                                                                *06320068
063300*     IF RECEIVED QTY LESS THAN 'OPEN-TO-RECEIVE' (SHORTAGE)     *06330068
063400*     - PARAGRAGH 5000 PRORATES USING SALES RANKING OF STORES    *06340068
063500*     - PARAGRAGH 6000 PRORATES USING FILL-IN METHOD             *06350068
063600*     - PARAGRAGH 7000 PRORATES USING STORE SALES PERCENTAGES    *06360068
063700*                                                                *06370068
063800******************************************************************06380068
063900 0300-SELECT-PRORATION-METHOD.                                    06390068
064000     MOVE '0300-SELECT-PRORATION-METHOD  ' TO RC001-PARAGRAPH.    06400068
064100                                                                  06410068
064200*OVERAGE - (SALES-RANK) / (FILL-IN) / (SALES)                     06420068
064300     IF PV-TOT-STR-OTR < PV-LEFT-TO-ALLOC                         06430068
064400         COMPUTE PV-OVERAGE-QTY = PV-LEFT-TO-ALLOC                06440068
064500                                - PV-TOT-STR-OTR                  06450068
064600         IF RC821-OVER-PRORATE-CDE = 'R'                          06460068
064700             MOVE '2000-' TO RC001-PRO-PATH                       06470071
064800             PERFORM 2000-SALES-RANK-OVER                         06480068
064900         END-IF                                                   06490068
065000         IF RC821-OVER-PRORATE-CDE = 'F'                          06500068
065100             MOVE '3000-' TO RC001-PRO-PATH                       06510071
065200             PERFORM 3000-FILL-IN-OVER                            06520068
065300         END-IF                                                   06530068
065400         IF RC821-OVER-PRORATE-CDE = 'S'                          06540068
065500             MOVE '4000-' TO RC001-PRO-PATH                       06550071
065600             PERFORM 4000-SALES-OVER                              06560068
065700         END-IF                                                   06570068
065800     END-IF.                                                      06580068
065900                                                                  06590068
066000*SHORTAGE - (R=SALES-RANK, F=FILL-IN, S=SALES).                   06600068
066100     IF PV-TOT-STR-OTR > PV-LEFT-TO-ALLOC                         06610068
066200         COMPUTE PV-SHORTAGE-QTY = PV-TOT-STR-OTR                 06620068
066300                                 - PV-LEFT-TO-ALLOC               06630068
066400         IF RC821-SHORT-PRORATE-CDE = 'R'                         06640068
066500             MOVE '5000-' TO RC001-PRO-PATH                       06650071
066600             PERFORM 5000-SALES-RANK-SHORT                        06660068
066700         END-IF                                                   06670068
066800         IF RC821-SHORT-PRORATE-CDE = 'F'                         06680068
066900             MOVE '6000-' TO RC001-PRO-PATH                       06690071
067000             PERFORM 6000-FILL-IN-SHORT                           06700068
067100         END-IF                                                   06710068
067200         IF RC821-SHORT-PRORATE-CDE = 'S'                         06720068
067300             MOVE '7000-' TO RC001-PRO-PATH                       06730071
067400             PERFORM 7000-SALES-SHORT                             06740068
067500         END-IF                                                   06750068
067600     END-IF.                                                      06760068
067700                                                                  06770068
067800******************************************************************06780068
068000*                                                                *06800068
068100*     LOAD STORES TO ONE OF THREE WORKING-STORAGE TABLES         *06810068
068200*     - FOR AN 'EXISTING' STORE, USE REGULAR(RG) TABLE           *06820068
068300*     - FOR A 'CENTRAL STOCK' STORE, USE CENTRAL STOCK(CS) TABLE *06830068
068400*     - FOR A 'NEW' STORE, USE NEW(NW) TABLE                     *06840068
068500*                                                                *06850068
068600*     ACCUMULATE 'OPEN-TO-RECEIVE' BY TABLE & TOTAL.             *06860068
068700*     ACCUMULATE 'ORIGINAL PLAN QTY' BY TABLE & TOTAL.           *06870068
068800*     COUNT NUMBER OF STORES BY TABLE.                           *06880068
068900******************************************************************06890068
069000 0500-LOAD-STORE-TABLES.                                          06900068
069100     MOVE '0500-LOAD-STORE-TABLES        ' TO RC001-PARAGRAPH.    06910068
069200                                                                  06920068
069300*LOAD REGULAR (EXISTING) STORES TABLE.                            06930068
069400     INITIALIZE WS-STORE-TABLE-REG.                               06940068
069500                                                                  06950068
069600     MOVE 1 TO L.                                                 06960068
069700     PERFORM                                                      06970068
069800       VARYING RC821-STORE-IDX FROM 1 BY 1                        06980068
069900         UNTIL RC821-STORE-IDX > PV-MAX-STORES                    06990068
070000            OR RC821-STR-NBR (RC821-STORE-IDX) NOT > ZEROES       07000068
070100                                                                  07010068
070200         IF (RC821-ST-TYPE-CODE (RC821-STORE-IDX) NOT = 'CS')     07020068
070300           AND (RC821-EXISTING-STORE-CDE (RC821-STORE-IDX) = '1') 07030068
070400             MOVE RC821-STR-NBR (RC821-STORE-IDX)                 07040068
070500               TO RG-STR-NBR (L)                                  07050068
070600             MOVE RC821-ALLOC-LNE-NBR (RC821-STORE-IDX)           07060068
070700               TO RG-ALLOC-LNE-NBR (L)                            07070068
070800             MOVE RC821-EXISTING-STORE-CDE (RC821-STORE-IDX)      07080068
070900               TO RG-EXISTING-STORE-CDE (L)                       07090068
071000             MOVE RC821-ST-TYPE-CODE (RC821-STORE-IDX)            07100068
071100               TO RG-ST-TYPE-CODE (L)                             07110068
071200             MOVE RC821-STR-DISTRO-QTY (RC821-STORE-IDX)          07120068
071300               TO RG-STR-PLAN-QTY (L)                             07130068
071400             MOVE RC821-STR-DISTRO-PK (RC821-STORE-IDX)           07140068
071500               TO RG-STR-PLAN-PK (L)                              07150068
071600             MOVE RC821-STR-DISTRO-OTR-QTY (RC821-STORE-IDX)      07160068
071700               TO RG-STR-PLAN-OTR-QTY (L)                         07170068
071800             MOVE RC821-STR-DISTRO-OTR-PK (RC821-STORE-IDX)       07180068
071900               TO RG-STR-PLAN-OTR-PK (L)                          07190068
072000             MOVE RC821-STR-OTR-PK (RC821-STORE-IDX)              07200068
072100               TO RG-STR-OTR-PK (L)                               07210068
072200             MOVE RC821-STR-OTR-QTY (RC821-STORE-IDX)             07220068
072300               TO RG-STR-OTR-QTY (L)                              07230068
072400                  RG-STR-OTR-QTY-ORIG (L)                         07240068
072500             IF RC821-PKGNG-CDE = 'I' OR 'M'                      07250068
072600                 COMPUTE RG-STR-OTR-QTY (L) =                     07260068
072700                         RC821-STR-OTR-PK (RC821-STORE-IDX)       07270068
072800                       * PV-DISPERSAL-QTY                         07280068
072900             END-IF                                               07290068
073000             MOVE RC821-RNK-SEQ-NBR (RC821-STORE-IDX)             07300068
073100               TO RG-RNK-SEQ-NBR (L)                              07310068
073200             MOVE ZEROES TO RG-STR-TIER (L)                       07320068
073300                            RG-ALLOC-UNITS (L)                    07330068
073400                            RG-STR-ALLOC-PCT (L)                  07340068
073500                                                                  07350068
073600             COMPUTE PV-RG-STR-OTR   = PV-RG-STR-OTR              07360068
073700                                     + RG-STR-OTR-QTY (L)         07370068
073800             COMPUTE PV-TOT-STR-OTR  = PV-TOT-STR-OTR             07380068
073900                                     + RG-STR-OTR-QTY (L)         07390068
074000             COMPUTE PV-RG-PLAN-QTY  = PV-RG-PLAN-QTY             07400068
074100                                     + RG-STR-PLAN-QTY (L)        07410068
074200             COMPUTE PV-TOT-PLAN-QTY = PV-TOT-PLAN-QTY            07420068
074300                                     + RG-STR-PLAN-QTY (L)        07430068
074400                                                                  07440068
074500             ADD 1 TO PV-RG-STR-CNT                               07450068
074600             ADD 1 TO L                                           07460068
074700         END-IF                                                   07470068
074800     END-PERFORM.                                                 07480068
074900                                                                  07490068
075000*LOAD 'CENTRAL STOCK' STORES TABLE.                               07500068
075100     INITIALIZE WS-STORE-TABLE-CS.                                07510068
075200                                                                  07520068
075300     MOVE 1 TO L.                                                 07530068
075400     PERFORM                                                      07540068
075500       VARYING RC821-STORE-IDX FROM 1 BY 1                        07550068
075600         UNTIL RC821-STORE-IDX > PV-MAX-STORES                    07560068
075700            OR RC821-STR-NBR (RC821-STORE-IDX) NOT > ZEROES       07570068
075800                                                                  07580068
075900         IF RC821-ST-TYPE-CODE (RC821-STORE-IDX) = 'CS'           07590068
076000             MOVE RC821-STR-NBR (RC821-STORE-IDX)                 07600068
076100               TO CS-STR-NBR (L)                                  07610068
076200             MOVE RC821-ALLOC-LNE-NBR (RC821-STORE-IDX)           07620068
076300               TO CS-ALLOC-LNE-NBR (L)                            07630068
076400             MOVE RC821-EXISTING-STORE-CDE (RC821-STORE-IDX)      07640068
076500               TO CS-EXISTING-STORE-CDE (L)                       07650068
076600             MOVE RC821-ST-TYPE-CODE (RC821-STORE-IDX)            07660068
076700               TO CS-ST-TYPE-CODE (L)                             07670068
076800             MOVE RC821-STR-DISTRO-QTY (RC821-STORE-IDX)          07680068
076900               TO CS-STR-PLAN-QTY (L)                             07690068
077000             MOVE RC821-STR-DISTRO-PK (RC821-STORE-IDX)           07700068
077100               TO CS-STR-PLAN-PK (L)                              07710068
077200             MOVE RC821-STR-DISTRO-OTR-QTY (RC821-STORE-IDX)      07720068
077300               TO CS-STR-PLAN-OTR-QTY (L)                         07730068
077400             MOVE RC821-STR-DISTRO-OTR-PK (RC821-STORE-IDX)       07740068
077500               TO CS-STR-PLAN-OTR-PK (L)                          07750068
077600             MOVE RC821-STR-OTR-PK (RC821-STORE-IDX)              07760068
077700               TO CS-STR-OTR-PK (L)                               07770068
077800             MOVE RC821-STR-OTR-QTY (RC821-STORE-IDX)             07780068
077900               TO CS-STR-OTR-QTY (L)                              07790068
078000                  CS-STR-OTR-QTY-ORIG (L)                         07800068
078100             IF RC821-PKGNG-CDE = 'I' OR 'M'                      07810068
078200                 COMPUTE CS-STR-OTR-QTY (L) =                     07820068
078300                         RC821-STR-OTR-PK (RC821-STORE-IDX)       07830068
078400                       * PV-DISPERSAL-QTY                         07840068
078500             END-IF                                               07850068
078600             MOVE RC821-RNK-SEQ-NBR (RC821-STORE-IDX)             07860068
078700               TO CS-RNK-SEQ-NBR (L)                              07870068
078800             MOVE ZEROES TO CS-STR-TIER (L)                       07880068
078900                            CS-ALLOC-UNITS (L)                    07890068
079000                            CS-STR-ALLOC-PCT (L)                  07900068
079100                                                                  07910068
079200             COMPUTE PV-CS-STR-OTR   = PV-CS-STR-OTR              07920068
079300                                     + CS-STR-OTR-QTY (L)         07930068
079400             COMPUTE PV-TOT-STR-OTR  = PV-TOT-STR-OTR             07940068
079500                                     + CS-STR-OTR-QTY (L)         07950068
079600             ADD 1 TO PV-CS-STR-CNT                               07960068
079700             ADD 1 TO L                                           07970068
079800         END-IF                                                   07980068
079900     END-PERFORM.                                                 07990068
080000                                                                  08000068
080100*LOAD NEW STORES TABLE.                                           08010068
080200     INITIALIZE WS-STORE-TABLE-NEW.                               08020068
080300                                                                  08030068
080400     MOVE 1 TO L.                                                 08040068
080500     PERFORM                                                      08050068
080600       VARYING RC821-STORE-IDX FROM 1 BY 1                        08060068
080700         UNTIL RC821-STORE-IDX > PV-MAX-STORES                    08070068
080800            OR RC821-STR-NBR (RC821-STORE-IDX) NOT > ZEROES       08080068
080900                                                                  08090068
081000         IF (RC821-ST-TYPE-CODE (RC821-STORE-IDX) NOT = 'CS')     08100068
081100           AND (RC821-EXISTING-STORE-CDE (RC821-STORE-IDX) = '0') 08110068
081200             MOVE RC821-STR-NBR (RC821-STORE-IDX)                 08120068
081300               TO NW-STR-NBR (L)                                  08130068
081400             MOVE RC821-ALLOC-LNE-NBR (RC821-STORE-IDX)           08140068
081500               TO NW-ALLOC-LNE-NBR (L)                            08150068
081600             MOVE RC821-EXISTING-STORE-CDE (RC821-STORE-IDX)      08160068
081700               TO NW-EXISTING-STORE-CDE (L)                       08170068
081800             MOVE RC821-ST-TYPE-CODE (RC821-STORE-IDX)            08180068
081900               TO NW-ST-TYPE-CODE (L)                             08190068
082000             MOVE RC821-STR-DISTRO-QTY (RC821-STORE-IDX)          08200068
082100               TO NW-STR-PLAN-QTY (L)                             08210068
082200             MOVE RC821-STR-DISTRO-PK (RC821-STORE-IDX)           08220068
082300               TO NW-STR-PLAN-PK (L)                              08230068
082400             MOVE RC821-STR-DISTRO-OTR-QTY (RC821-STORE-IDX)      08240068
082500               TO NW-STR-PLAN-OTR-QTY (L)                         08250068
082600             MOVE RC821-STR-DISTRO-OTR-PK (RC821-STORE-IDX)       08260068
082700               TO NW-STR-PLAN-OTR-PK (L)                          08270068
082800             MOVE RC821-STR-OTR-PK (RC821-STORE-IDX)              08280068
082900               TO NW-STR-OTR-PK (L)                               08290068
083000             MOVE RC821-STR-OTR-QTY (RC821-STORE-IDX)             08300068
083100               TO NW-STR-OTR-QTY (L)                              08310068
083200                  NW-STR-OTR-QTY-ORIG (L)                         08320068
083300             IF RC821-PKGNG-CDE = 'I' OR 'M'                      08330068
083400                 COMPUTE NW-STR-OTR-QTY (L) =                     08340068
083500                         RC821-STR-OTR-PK (RC821-STORE-IDX)       08350068
083600                       * PV-DISPERSAL-QTY                         08360068
083700             END-IF                                               08370068
083800             MOVE RC821-RNK-SEQ-NBR (RC821-STORE-IDX)             08380068
083900               TO NW-RNK-SEQ-NBR (L)                              08390068
084000             MOVE ZEROES TO NW-STR-TIER (L)                       08400068
084100                            NW-ALLOC-UNITS (L)                    08410068
084200                            NW-STR-ALLOC-PCT (L)                  08420068
084300                                                                  08430068
084400             COMPUTE PV-NW-STR-OTR   = PV-NW-STR-OTR              08440068
084500                                     + NW-STR-OTR-QTY (L)         08450068
084600             COMPUTE PV-TOT-STR-OTR  = PV-TOT-STR-OTR             08460068
084700                                     + NW-STR-OTR-QTY (L)         08470068
084800             COMPUTE PV-NW-PLAN-QTY  = PV-NW-PLAN-QTY             08480068
084900                                     + NW-STR-PLAN-QTY (L)        08490068
085000             COMPUTE PV-TOT-PLAN-QTY = PV-TOT-PLAN-QTY            08500068
085100                                     + NW-STR-PLAN-QTY (L)        08510068
085200             ADD 1 TO PV-NW-STR-CNT                               08520068
085300             ADD 1 TO L                                           08530068
085400         END-IF                                                   08540068
085500     END-PERFORM.                                                 08550068
085600                                                                  08560068
085700******************************************************************08570068
085800*                                                                *08580068
085900*          O V E R A G E   -   S A L E S   R A N K               *08590068
086000*                                                                *08600068
086100*    FILL NEW STORES UP TO 'OPEN-TO-RECEIVE'.                    *08610068
086200*    FILL EXISTING STORES UP TO 'OPEN-TO-RECEIVE'.               *08620068
086300*    FILL CENTRAL STOCK STORES UP TO 'OPEN-TO-RECEIVE'.          *08630068
086400*                                                                *08640068
086500*    OVERAGE QTY DISPERSED TO EXISTING STORES.                   *08650068
086600*    IF NO EXISTING STORES, OVERAGE QTY DISPERSED TO NEW STORES. *08660068
086700*    IF NO NEW OR EXISTING STORES, OVERAGE QTY GOES TO C-S.      *08670068
086800*                                                                *08680068
086900*    SORT STORES                                                 *08690068
087000*      - BEST TO WORST BASED ON SALES                            *08700068
087100*                                                                *08710068
087200*    PRORATION                                                   *08720068
087300*      - BASED ON SALES RANK, USE THE OVERAGE SCHEDULE TABLE,    *08730068
087400*        RCT_OVRG_LOC_RNK, CONTAINING STORE AND OVERAGE PCTS.    *08740068
087500*        EXAMPLE - TOP 11% OF STORES GET 20% OF OVERAGE QTY.     *08750068
087600*      - DISTRIBUTE IN 'DISPERSAL QTYS'                          *08760068
087700*      - ALWAYS ROUND UP                                         *08770068
087800*      - ALLOCATE UNTIL UNITS RUN OUT                            *08780068
087900*      - IF ONLY NEW OR C-S STORES, USE FILL-IN METHOD           *08790068
088000*        (ALLOCATING A 'DISPERSAL QTY' PER STORE UNTIL GONE)     *08800068
088100*                                                                *08810068
088200******************************************************************08820068
088300 2000-SALES-RANK-OVER.                                            08830068
088400     MOVE '2000-SALES-RANK-OVER          ' TO RC001-PARAGRAPH.    08840068
088500                                                                  08850068
088600************                                                      08860068
088700*NEW STORES*                                                      08870068
088800*IF NEW STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       08880068
088900************                                                      08890068
089000     IF PV-NW-STR-OTR > ZEROES                                    08900068
089100         PERFORM                                                  08910068
089200           VARYING L FROM 1 BY 1                                  08920068
089300             UNTIL L > PV-MAX-STORES                              08930068
089400                                                                  08940068
089500             IF NW-STR-OTR-QTY (L) > ZEROES                       08950068
089600*ROUND STORE OTR UP TO THE NEXT PACK                              08960068
089700                 DIVIDE NW-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    08970068
089800                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    08980068
089900                 IF PV-REMAINDER > 0                              08990068
090000                     ADD 1 TO PV-TEMP-OTR-QTY                     09000068
090100                 END-IF                                           09010068
090200                                                                  09020068
090300                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        09030068
090400                                         * PV-DISPERSAL-QTY       09040068
090500                                                                  09050068
090600*CALC OVERAGE QUANTITY.                                           09060068
090700                 IF PV-TEMP-OTR-QTY > NW-STR-OTR-QTY (L)          09070068
090800                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    09080068
090900                                              - PV-TEMP-OTR-QTY   09090068
091000                                              + NW-STR-OTR-QTY (L)09100068
091100                 END-IF                                           09110068
091200                                                                  09120068
091300                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        09130068
091400                     MOVE PV-TEMP-OTR-QTY    TO NW-ALLOC-UNITS (L)09140068
091500                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  09150068
091600                                              - PV-TEMP-OTR-QTY   09160068
091700                     MOVE ZEROES             TO NW-STR-OTR-QTY (L)09170068
091800                 ELSE                                             09180068
091900                     MOVE PV-LEFT-TO-ALLOC   TO NW-ALLOC-UNITS (L)09190068
092000                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  09200068
092100                                                NW-STR-OTR-QTY (L)09210068
092200                 END-IF                                           09220068
092300             END-IF                                               09230068
092400         END-PERFORM                                              09240068
092500                                                                  09250068
092600         MOVE ZEROES TO PV-NW-STR-OTR                             09260068
092700     END-IF.                                                      09270068
092800                                                                  09280068
092900**********************                                            09290068
093000*CENTRAL STOCK STORES*                                            09300068
093100*IF C-S STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       09310068
093200**********************                                            09320068
093300     IF PV-CS-STR-OTR > ZEROES                                    09330068
093400         PERFORM                                                  09340068
093500           VARYING L FROM 1 BY 1                                  09350068
093600             UNTIL L > PV-MAX-STORES                              09360068
093700                                                                  09370068
093800             IF CS-STR-OTR-QTY (L) > ZEROES                       09380068
093900*ROUND STORE OTR UP TO THE NEXT PACK                              09390068
094000                 DIVIDE CS-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    09400068
094100                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    09410068
094200                 IF PV-REMAINDER > 0                              09420068
094300                     ADD 1 TO PV-TEMP-OTR-QTY                     09430068
094400                 END-IF                                           09440068
094500                                                                  09450068
094600                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        09460068
094700                                         * PV-DISPERSAL-QTY       09470068
094800                                                                  09480068
094900*CALC OVERAGE QUANTITY.                                           09490068
095000                 IF PV-TEMP-OTR-QTY > CS-STR-OTR-QTY (L)          09500068
095100                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    09510068
095200                                              - PV-TEMP-OTR-QTY   09520068
095300                                              + CS-STR-OTR-QTY (L)09530068
095400                 END-IF                                           09540068
095500                                                                  09550068
095600                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        09560068
095700                     MOVE PV-TEMP-OTR-QTY    TO CS-ALLOC-UNITS (L)09570068
095800                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  09580068
095900                                              - PV-TEMP-OTR-QTY   09590068
096000                     MOVE ZEROES             TO CS-STR-OTR-QTY (L)09600068
096100                 ELSE                                             09610068
096200                     MOVE PV-LEFT-TO-ALLOC   TO CS-ALLOC-UNITS (L)09620068
096300                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  09630068
096400                                                CS-STR-OTR-QTY (L)09640068
096500                 END-IF                                           09650068
096600             END-IF                                               09660068
096700         END-PERFORM                                              09670068
096800                                                                  09680068
096900         MOVE ZEROES TO PV-CS-STR-OTR                             09690068
097000     END-IF.                                                      09700068
097100                                                                  09710068
097200*****************                                                 09720068
097300*EXISTING STORES*                                                 09730068
097400*IF EXISTING STORES EXIST, FILL TO OTR (THEN PRORATE OVERAGE).    09740068
097500*****************                                                 09750068
097600     IF PV-RG-STR-OTR > ZEROES                                    09760068
097700         PERFORM                                                  09770068
097800           VARYING L FROM 1 BY 1                                  09780068
097900             UNTIL L > PV-MAX-STORES                              09790068
098000                                                                  09800068
098100             IF RG-STR-OTR-QTY (L) > ZEROES                       09810068
098200*ROUND STORE OTR UP TO THE NEXT PACK                              09820068
098300                 DIVIDE RG-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    09830068
098400                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    09840068
098500                 IF PV-REMAINDER > 0                              09850068
098600                     ADD 1 TO PV-TEMP-OTR-QTY                     09860068
098700                 END-IF                                           09870068
098800                                                                  09880068
098900                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        09890068
099000                                         * PV-DISPERSAL-QTY       09900068
099100                                                                  09910068
099200*CALC OVERAGE QUANTITY.                                           09920068
099300                 IF PV-TEMP-OTR-QTY > RG-STR-OTR-QTY (L)          09930068
099400                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    09940068
099500                                              - PV-TEMP-OTR-QTY   09950068
099600                                              + RG-STR-OTR-QTY (L)09960068
099700                 END-IF                                           09970068
099800                                                                  09980068
099900                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        09990068
100000                     MOVE PV-TEMP-OTR-QTY    TO RG-ALLOC-UNITS (L)10000068
100100                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  10010068
100200                                              - PV-TEMP-OTR-QTY   10020068
100300                     MOVE ZEROES             TO RG-STR-OTR-QTY (L)10030068
100400                 ELSE                                             10040068
100500                     MOVE PV-LEFT-TO-ALLOC   TO RG-ALLOC-UNITS (L)10050068
100600                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  10060068
100700                                                RG-STR-OTR-QTY (L)10070068
100800                 END-IF                                           10080068
100900             END-IF                                               10090068
101000         END-PERFORM                                              10100068
101100                                                                  10110068
101200         MOVE ZEROES TO PV-RG-STR-OTR                             10120068
101300     END-IF.                                                      10130068
101400                                                                  10140068
101500*************                                                     10150068
101600*OVERAGE QTY*                                                     10160068
101700*************                                                     10170068
101800*IF EXISTING STORES, LOAD 'OVERAGE SCHEDULE' TABLE.               10180068
101900*LOAD EXISTING STORES, SORT, PRORATE & RESET STORE TABLES.        10190068
102000     IF PV-RG-STR-CNT > ZEROES                                    10200068
102100       AND PV-LEFT-TO-ALLOC > ZEROES                              10210068
102200         INITIALIZE WS-OVERAGE-TABLE                              10220068
102300         PERFORM 2200-LOAD-OVERAGE-TABLE                          10230068
102400         PERFORM 5400-LOAD-RG-TO-WK                               10240068
102500         PERFORM 2100-SORT-BY-SALES                               10250068
102600         PERFORM 2300-ASSIGN-TIER-SR                              10260068
102700         PERFORM 2500-ALLOC-OVRG-SR                               10270068
102800         PERFORM 5500-LOAD-WK-TO-RG                               10280068
102900     END-IF.                                                      10290068
103000                                                                  10300068
103100*IF NEW STORES EXIST & NO EXISTING STORES EXIST,                  10310068
103200*DISPERSE OVERAGE (ONE UNIT AT A TIME) UNTIL ALL GONE.            10320068
103300     IF PV-NW-STR-CNT > ZEROES                                    10330068
103400       AND PV-RG-STR-CNT NOT > ZEROES                             10340068
103500       AND PV-LEFT-TO-ALLOC > ZEROES                              10350068
103600                                                                  10360068
103700         PERFORM 5100-LOAD-NW-TO-WK                               10370068
103800                                                                  10380068
103900         PERFORM                                                  10390068
104000           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    10400068
104100             PERFORM 2400-ALLOC-OVRG-TO-NW                        10410068
104200         END-PERFORM                                              10420068
104300                                                                  10430068
104400         PERFORM 5300-LOAD-WK-TO-NW                               10440068
104500     END-IF.                                                      10450068
104600                                                                  10460068
104700*IF CENTRAL-STOCK STORES EXIST & NO NEW OR EXISTING STORES EXIST, 10470068
104800*DISPERSE OVERAGE (ONE UNIT AT A TIME) UNTIL ALL GONE.            10480068
104900     IF PV-CS-STR-CNT > ZEROES                                    10490068
105000       AND PV-RG-STR-CNT NOT > ZEROES                             10500068
105100       AND PV-LEFT-TO-ALLOC > ZEROES                              10510068
105200                                                                  10520068
105300         PERFORM 5600-LOAD-CS-TO-WK                               10530068
105500         PERFORM                                                  10550068
105600           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    10560068
105700             PERFORM 2600-ALLOC-OVRG-TO-CS                        10570068
105800         END-PERFORM                                              10580068
105900                                                                  10590068
106000         PERFORM 5700-LOAD-WK-TO-CS                               10600068
106100     END-IF.                                                      10610068
106200                                                                  10620068
106300******************************************************************10630068
106400 2100-SORT-BY-SALES.                                              10640068
106500     MOVE '2100-SORT-BY-SALES            ' TO RC001-PARAGRAPH.    10650068
106600                                                                  10660068
106700*SORT STORE TABLE (SMALLEST TO LARGEST - SALES RANK).             10670068
106800     MOVE 1 TO A.                                                 10680068
106900     PERFORM                                                      10690068
107000       UNTIL A > PV-MAX-STORES                                    10700068
107100          OR WK-STR-NBR (A) = ZEROES                              10710068
107200                                                                  10720068
107300         COMPUTE B = A + 1                                        10730068
107400         PERFORM 2110-SORT-BY-RANK                                10740068
107500           UNTIL B > PV-MAX-STORES                                10750068
107600              OR WK-STR-NBR (B) = ZEROES                          10760068
107700                                                                  10770068
107800         ADD 1 TO A                                               10780068
107900                                                                  10790068
108000     END-PERFORM.                                                 10800068
108100                                                                  10810068
108200******************************************************************10820068
108300 2110-SORT-BY-RANK.                                               10830068
108400     MOVE '2110-SORT-BY-RANK             ' TO RC001-PARAGRAPH.    10840068
108500                                                                  10850068
108600     IF WK-RNK-SEQ-NBR (A) > WK-RNK-SEQ-NBR (B)                   10860068
108700         MOVE WK-STORE-ENTRY (A)  TO WS-HOLD-STORE-TABLE          10870068
108800         MOVE WK-STORE-ENTRY (B)  TO WK-STORE-ENTRY (A)           10880068
108900         MOVE WS-HOLD-STORE-TABLE TO WK-STORE-ENTRY (B)           10890068
109000     END-IF.                                                      10900068
109100                                                                  10910068
109200     ADD 1 TO B.                                                  10920068
109300                                                                  10930068
109400******************************************************************10940068
109500 2200-LOAD-OVERAGE-TABLE.                                         10950068
109600     MOVE '2200-LOAD-OVERAGE-TABLE       ' TO RC001-PARAGRAPH.    10960068
109700                                                                  10970068
109800*OPEN OVERAGE TABLE.                                              10980068
109900     PERFORM 2210-OPEN-OVRG-CSR.                                  10990068
110000                                                                  11000068
110100*FETCH OVERAGE ROWS.                                              11010068
110200     PERFORM 2220-FETCH-OVRG-ROW                                  11020068
110300       VARYING L FROM 1 BY 1                                      11030068
110400         UNTIL L > 10                                             11040068
110500            OR PS-END-OF-OVRG-CSR-YES.                            11050068
110600                                                                  11060068
110700*CLOSE OVERAGE TABLE.                                             11070068
110800     PERFORM 2230-CLOSE-OVRG-CSR.                                 11080068
110900                                                                  11090068
111000******************************************************************11100068
111100 2210-OPEN-OVRG-CSR.                                              11110068
111200     MOVE '2210-OPEN-OVRG-CSR            ' TO RC001-PARAGRAPH.    11120068
111300                                                                  11130068
111400     EXEC SQL                                                     11140068
111500         OPEN OVRG-CSR                                            11150068
111600     END-EXEC.                                                    11160068
111700                                                                  11170068
111800     EVALUATE TRUE                                                11180068
111900       WHEN SQLCODE = ZERO                                        11190068
112000           SET PS-END-OF-OVRG-CSR-NO TO TRUE                      11200068
112100                                                                  11210068
112200       WHEN OTHER                                                 11220068
112300         SET PS-DONE-YES   TO TRUE                                11230068
112400         MOVE SPACES       TO TM501-TM500-RETURN-MSG              11240068
112500         MOVE '2210'       TO TM501-PARA                          11250068
                                    TM007-RETURNED-PARA                 11251099
112600         MOVE '824'        TO TM501-PGM                           11260068
112700         MOVE SQLCODE      TO TM500-SQLCODE                       11270068
112700                              TM007-SQLCODE                       11271099
112800         MOVE SQLCA        TO TM500-SQLCA                         11280068
112800                              TM007-SQLCA                         11281099
112900         MOVE 77           TO TM501-PRORATION-ERROR-NBR           11290068
113000         PERFORM TM501-SET-TM500-RETURN-MSG                       11300068
               MOVE TM500-RETURN-DATA                                   11311099
                                 TO TM007-RETURN-DATA                   11312099
113100         PERFORM RC001-RETURN-MSG                                 11313099
113200     END-EVALUATE.                                                11320068
113300                                                                  11330068
113400******************************************************************11340068
113500 2220-FETCH-OVRG-ROW.                                             11350068
113600     MOVE '2220-FETCH-OVRG-ROW           ' TO RC001-PARAGRAPH.    11360068
113700                                                                  11370068
113800     EXEC SQL                                                     11380068
113900         FETCH OVRG-CSR                                           11390068
114000          INTO :RCT00004-LOC-GP-RNK-NBR                           11400068
114100             , :RCT00004-LOC-QTY-PCT                              11410068
114200             , :RCT00004-OVRG-PCT                                 11420068
114300     END-EXEC.                                                    11430068
114400                                                                  11440068
114500     EVALUATE TRUE                                                11450068
114600       WHEN SQLCODE = ZERO                                        11460068
114700           MOVE RCT00004-LOC-GP-RNK-NBR TO WS-OVRG-TIER (L)       11470068
114800           MOVE RCT00004-LOC-QTY-PCT TO WS-OVRG-TIER-PCT (L)      11480068
114900           MOVE RCT00004-OVRG-PCT TO WS-OVRG-PCT-PRRTN (L)        11490068
115000           MOVE ZEROES            TO WS-OVRG-NBR-STR (L)          11500068
115100                                                                  11510068
115200       WHEN SQLCODE = +100                                        11520068
115300           SET PS-END-OF-OVRG-CSR-YES TO TRUE                     11530068
115400           MOVE ZEROES TO WS-OVRG-TIER (L)                        11540068
115500           MOVE ZEROES TO WS-OVRG-TIER-PCT (L)                    11550068
115600           MOVE ZEROES TO WS-OVRG-PCT-PRRTN (L)                   11560068
115700           MOVE ZEROES TO WS-OVRG-NBR-STR (L)                     11570068
115800                                                                  11580068
115900       WHEN OTHER                                                 11590068
116000           SET PS-DONE-YES   TO TRUE                              11600068
116100           MOVE SPACES       TO TM501-TM500-RETURN-MSG            11610068
116200           MOVE '2220'       TO TM501-PARA                        11620068
                                      TM007-RETURNED-PARA               11621099
116300           MOVE '824'        TO TM501-PGM                         11630068
116400           MOVE SQLCODE      TO TM500-SQLCODE                     11640068
116400                                TM007-SQLCODE                     11641099
116500           MOVE SQLCA        TO TM500-SQLCA                       11650068
116500                                TM007-SQLCA                       11651099
116600           MOVE 78           TO TM501-PRORATION-ERROR-NBR         11660068
116700           PERFORM TM501-SET-TM500-RETURN-MSG                     11670068
                 MOVE TM500-RETURN-DATA                                 11681099
                                   TO TM007-RETURN-DATA                 11682099
116800           PERFORM RC001-RETURN-MSG                               11683099
116900     END-EVALUATE.                                                11690068
117000                                                                  11700068
117100******************************************************************11710068
117200 2230-CLOSE-OVRG-CSR.                                             11720068
117300     MOVE '2230-CLOSE-OVRG-CSR           ' TO RC001-PARAGRAPH.    11730068
117400                                                                  11740068
117500     EXEC SQL                                                     11750068
117600         CLOSE OVRG-CSR                                           11760068
117700     END-EXEC.                                                    11770068
117800                                                                  11780068
117900     EVALUATE TRUE                                                11790068
118000       WHEN SQLCODE = ZERO                                        11800068
118100           CONTINUE                                               11810068
118200                                                                  11820068
118300       WHEN OTHER                                                 11830068
118400           SET PS-DONE-YES   TO TRUE                              11840068
118500           MOVE SPACES       TO TM501-TM500-RETURN-MSG            11850068
118600           MOVE '2230'       TO TM501-PARA                        11860068
                                      TM007-RETURNED-PARA               11861099
118700           MOVE '824'        TO TM501-PGM                         11870068
118800           MOVE SQLCODE      TO TM500-SQLCODE                     11880068
118800                                TM007-SQLCODE                     11881099
118900           MOVE SQLCA        TO TM500-SQLCA                       11890068
118900                                TM007-SQLCA                       11891099
119000           MOVE 79           TO TM501-PRORATION-ERROR-NBR         11900068
119100           PERFORM TM501-SET-TM500-RETURN-MSG                     11910068
                 MOVE TM500-RETURN-DATA                                 11921099
                                   TO TM007-RETURN-DATA                 11922099
119200           PERFORM RC001-RETURN-MSG                               11923099
119300     END-EVALUATE.                                                11930068
119400                                                                  11940068
119500******************************************************************11950068
119600 2300-ASSIGN-TIER-SR.                                             11960068
119700     MOVE '2300-ASSIGN-TIER-SR           ' TO RC001-PARAGRAPH.    11970068
119800                                                                  11980068
119900*COUNT TIERS & COMPARE TO NUMBER OF STORES.  IF TIERS > STORES,   11990068
120000*ASSIGN ONE STORE PER TIER UNTIL GONE & ZERO OUT REMAINING TIERS. 12000068
120100     MOVE ZEROES TO PV-TIER-COUNT.                                12010068
120200     PERFORM                                                      12020068
120300       VARYING L FROM 1 BY 1 UNTIL L > 10                         12030068
120400         IF WS-OVRG-TIER-PCT (L) > ZEROES                         12040068
120500             ADD 1 TO PV-TIER-COUNT                               12050068
120600         END-IF                                                   12060068
120700     END-PERFORM.                                                 12070068
120800                                                                  12080068
120900*IF NUMBER OF TIERS WITH/PERCENT GREATER THAN NUMBER OF STORES,   12090068
121000*ASSIGN ONE STORE PER TIER UNTIL GONE & ZERO OUT REMAINING TIERS. 12100068
121100     IF PV-TIER-COUNT > PV-RG-STR-CNT                             12110068
121200         MOVE PV-RG-STR-CNT TO PV-NBR-STR-TO-ASSIGN               12120068
121300         PERFORM                                                  12130068
121400           VARYING L FROM 1 BY 1 UNTIL L > 10                     12140068
121500                                                                  12150068
121600             IF PV-NBR-STR-TO-ASSIGN > ZERO                       12160068
121700                 MOVE     1  TO  WS-OVRG-NBR-STR (L)              12170068
121800                 SUBTRACT 1 FROM PV-NBR-STR-TO-ASSIGN             12180068
121900                 COMPUTE WS-OVRG-PCT-PRRTN (L) ROUNDED = 100      12190068
122000                                             / PV-RG-STR-CNT      12200068
122100             ELSE                                                 12210068
122200                 MOVE ZEROES TO WS-OVRG-TIER-PCT (L)              12220068
122300                                WS-OVRG-PCT-PRRTN (L)             12230068
122400             END-IF                                               12240068
122500         END-PERFORM                                              12250068
122600         MOVE PV-RG-STR-CNT TO PV-STR-TIER-COUNT                  12260068
122700     END-IF.                                                      12270068
122800                                                                  12280068
122900*CALCULATE THE NUMBER OF STORES TO ASSIGN EACH TIER PCT.          12290068
123000     IF PV-TIER-COUNT NOT > PV-RG-STR-CNT                         12300068
123100         MOVE ZEROES TO PV-STR-TIER-COUNT                         12310068
123200         PERFORM                                                  12320068
123300           VARYING L FROM 1 BY 1 UNTIL L > 10                     12330068
123400                                                                  12340068
123500             COMPUTE WS-OVRG-NBR-STR (L) ROUNDED =                12350068
123600                 WS-OVRG-TIER-PCT (L) * PV-RG-STR-CNT / 100       12360068
123700                                                                  12370068
123800*VERIFY EACH TIER HAS AT LEAST ONE STORE ASSIGNED.                12380068
123900             IF WS-OVRG-TIER-PCT (L)   > ZEROES                   12390068
124000               AND PV-RG-STR-CNT       > ZEROES                   12400068
124100               AND WS-OVRG-NBR-STR (L) = ZEROES                   12410068
124200                 MOVE 1 TO WS-OVRG-NBR-STR (L)                    12420068
124300             END-IF                                               12430068
124400                                                                  12440068
124500             COMPUTE PV-STR-TIER-COUNT = PV-STR-TIER-COUNT        12450068
124600                                       + WS-OVRG-NBR-STR (L)      12460068
124700                                                                  12470068
124800         END-PERFORM                                              12480068
124900     END-IF.                                                      12490068
125000                                                                  12500068
125100*VERIFY ALL STORES ACCOUNTED FOR (ROUNDING MISMATCH).             12510068
125200*ADJUST TIER WITH HIGHEST PERCENTAGE OF OVERAGE.                  12520068
125300     IF PV-STR-TIER-COUNT NOT = PV-RG-STR-CNT                     12530068
125400                                                                  12540068
125500         MOVE ZEROES TO PV-HIGH-TIER-PCT                          12550068
125600                        PV-HIGH-PCT-TIER                          12560068
125700         PERFORM                                                  12570068
125800           VARYING L FROM 1 BY 1                                  12580068
125900             UNTIL L > 10                                         12590068
126000                                                                  12600068
126100             IF WS-OVRG-TIER-PCT (L) > PV-HIGH-TIER-PCT           12610068
126200                 MOVE WS-OVRG-TIER (L)     TO PV-HIGH-PCT-TIER    12620068
126300                 MOVE WS-OVRG-TIER-PCT (L) TO PV-HIGH-TIER-PCT    12630068
126400             END-IF                                               12640068
126500         END-PERFORM                                              12650068
126600                                                                  12660068
126700         IF PV-STR-TIER-COUNT > PV-RG-STR-CNT                     12670068
126800             PERFORM 2310-DECREASE-TIER-COUNT                     12680068
126900         END-IF                                                   12690068
127000                                                                  12700068
127100         IF PV-STR-TIER-COUNT < PV-RG-STR-CNT                     12710068
127200             PERFORM 2320-INCREASE-TIER-COUNT                     12720068
127300         END-IF                                                   12730068
127400     END-IF.                                                      12740068
127500                                                                  12750068
127600     IF PV-STR-TIER-COUNT NOT = PV-RG-STR-CNT                     12760068
127700         MOVE 'PV-STR-TIER-COUNT NOT = PV-RG-STR-CNT'             12770068
127800                                     TO RC001-SPECIAL-1           12780068
127900         STRING ' ==> '            DELIMITED BY SIZE              12790068
128000                PV-STR-TIER-COUNT  DELIMITED BY SIZE              12800068
128100                ' NOT = '          DELIMITED BY SIZE              12810068
128200                PV-RG-STR-CNT      DELIMITED BY SIZE              12820068
128300                ' <=='             DELIMITED BY SIZE              12830068
128400                                   INTO RC001-SPECIAL-2           12840068
128500         SET PS-DONE-YES TO TRUE                                  12850068
128600         MOVE SPACES     TO TM501-TM500-RETURN-MSG                12860068
128700         MOVE '2300'     TO TM501-PARA                            12870068
                                  TM007-RETURNED-PARA                   12871099
128800         MOVE '824'      TO TM501-PGM                             12880068
128900         MOVE SQLCODE    TO TM500-SQLCODE                         12890068
128900                            TM007-SQLCODE                         12891099
129000         MOVE SQLCA      TO TM500-SQLCA                           12900068
129000                            TM007-SQLCA                           12901099
129100         MOVE 95         TO TM501-PRORATION-ERROR-NBR             12910068
129200         PERFORM TM501-SET-TM500-RETURN-MSG                       12920068
               MOVE TM500-RETURN-DATA                                   12931099
                               TO TM007-RETURN-DATA                     12932099
129300         PERFORM RC001-RETURN-MSG                                 12933099
129400     END-IF.                                                      12940068
129500                                                                  12950068
129600*ASSIGN A SALES TIER TO EACH STORE.                               12960068
129700     PERFORM 2330-ASSIGN-STR-TIERS.                               12970068
129800                                                                  12980068
129900******************************************************************12990068
130000 2310-DECREASE-TIER-COUNT.                                        13000068
130100     MOVE '2310-DECREASE-TIER-COUNT      ' TO RC001-PARAGRAPH.    13010068
130200                                                                  13020068
130300     COMPUTE PV-DIFFERENCE = PV-STR-TIER-COUNT                    13030068
130400                           - PV-RG-STR-CNT.                       13040068
130500                                                                  13050068
130600     PERFORM                                                      13060068
130700       VARYING L FROM 1 BY 1 UNTIL L > 10                         13070068
130800                                                                  13080068
130900         IF WS-OVRG-TIER-PCT (L) = PV-HIGH-TIER-PCT               13090068
131000             SUBTRACT PV-DIFFERENCE FROM WS-OVRG-NBR-STR (L)      13100068
131100                                         PV-STR-TIER-COUNT        13110068
131200         END-IF                                                   13120068
131300                                                                  13130068
131400     END-PERFORM.                                                 13140068
131500                                                                  13150068
131600******************************************************************13160068
131700 2320-INCREASE-TIER-COUNT.                                        13170068
131800     MOVE '2320-INCREASE-TIER-COUNT      ' TO RC001-PARAGRAPH.    13180068
131900                                                                  13190068
132000     COMPUTE PV-DIFFERENCE = PV-RG-STR-CNT                        13200068
132100                           - PV-STR-TIER-COUNT.                   13210068
132200                                                                  13220068
132300     PERFORM                                                      13230068
132400       VARYING L FROM 1 BY 1 UNTIL L > 10                         13240068
132500                                                                  13250068
132600         IF WS-OVRG-TIER-PCT (L) = PV-HIGH-TIER-PCT               13260068
132700             ADD PV-DIFFERENCE TO WS-OVRG-NBR-STR (L)             13270068
132800                                  PV-STR-TIER-COUNT               13280068
132900         END-IF                                                   13290068
133000                                                                  13300068
133100     END-PERFORM.                                                 13310068
133200                                                                  13320068
133300******************************************************************13330068
133400 2330-ASSIGN-STR-TIERS.                                           13340068
133500     MOVE '2330-ASSIGN-STR-TIERS         ' TO RC001-PARAGRAPH.    13350068
133600                                                                  13360068
133700     PERFORM                                                      13370068
133800       VARYING L FROM 1 BY 1 UNTIL L > 10                         13380068
133900                                                                  13390068
134000         MOVE WS-OVRG-NBR-STR (L) TO PV-STR-TIER-COUNT            13400068
134100         IF WS-OVRG-NBR-STR (L) > ZEROES                          13410068
134200                                                                  13420068
134300             PERFORM                                              13430068
134400               VARYING M FROM 1 BY 1                              13440068
134500                 UNTIL PV-STR-TIER-COUNT = ZEROES                 13450068
134600                    OR M > PV-MAX-STORES                          13460068
134700                                                                  13470068
134800                 IF WK-STR-NBR (M) > ZEROES                       13480068
134900                   AND WK-STR-TIER (M) = ZEROES                   13490068
135000                     MOVE WS-OVRG-TIER (L) TO WK-STR-TIER (M)     13500068
135100                     SUBTRACT 1 FROM PV-STR-TIER-COUNT            13510068
135200                 END-IF                                           13520068
135300             END-PERFORM                                          13530068
135400         END-IF                                                   13540068
135500     END-PERFORM.                                                 13550068
135600                                                                  13560068
135700******************************************************************13570068
135800 2400-ALLOC-OVRG-TO-NW.                                           13580068
135900     MOVE '2400-ALLOC-OVRG-TO-NW         ' TO RC001-PARAGRAPH.    13590068
136000                                                                  13600068
136100     PERFORM                                                      13610068
136200       VARYING L FROM 1 BY 1                                      13620068
136300         UNTIL (WK-STR-NBR (L) = ZEROES)                          13630068
136400            OR (L > PV-MAX-STORES)                                13640068
136500            OR (PV-LEFT-TO-ALLOC NOT > ZEROES)                    13650068
136600                                                                  13660068
136700         IF WK-STR-NBR (L) > ZEROES                               13670068
136800             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               13680068
136900                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)13690068
137000                 SUBTRACT PV-LEFT-TO-ALLOC FROM PV-LEFT-TO-ALLOC  13700068
137100             ELSE                                                 13710068
137200                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (L)13720068
137300                 SUBTRACT PV-DISPERSAL-QTY FROM PV-LEFT-TO-ALLOC  13730068
137400             END-IF                                               13740068
137500         END-IF                                                   13750068
137600                                                                  13760068
137700     END-PERFORM.                                                 13770068
137800                                                                  13780068
137900******************************************************************13790068
138000 2500-ALLOC-OVRG-SR.                                              13800068
138100     MOVE '2500-ALLOC-OVRG-SR            ' TO RC001-PARAGRAPH.    13810068
138200                                                                  13820068
138300*CALCULATE OVERAGE QTY TO ASSIGN EACH TIER.                       13830068
138400     MOVE ZEROES TO PV-STR-TIER-QTY.                              13840068
138500     PERFORM                                                      13850068
138600       VARYING L FROM 1 BY 1 UNTIL L > 10                         13860068
138700                                                                  13870068
138800         COMPUTE PV-PCT-QTY ROUNDED = (WS-OVRG-PCT-PRRTN (L)      13880068
138900                                    * PV-OVERAGE-QTY) / 100       13890068
139000                                                                  13900068
139100         DIVIDE PV-PCT-QTY BY PV-DISPERSAL-QTY                    13910068
139200         GIVING PV-ALLOC-QTY REMAINDER PV-REMAINDER               13920068
139300                                                                  13930068
139400*10/9/03 - ALWAYS ROUND UP PER RICH.                              13940068
139500         IF PV-REMAINDER > 0                                      13950068
139600             ADD 1 TO PV-ALLOC-QTY                                13960068
139700         END-IF                                                   13970068
139800                                                                  13980068
139900         MULTIPLY PV-ALLOC-QTY BY PV-DISPERSAL-QTY                13990068
140000         GIVING PV-ALLOC-QTY-TIER                                 14000068
140100                                                                  14010068
140200         MOVE PV-ALLOC-QTY-TIER TO WS-OVRG-QTY-STR (L)            14020068
140300                                                                  14030068
140400*COUNT TOTAL QTY ASSIGNED TO TIERS.                               14040068
140500         COMPUTE PV-STR-TIER-QTY = PV-STR-TIER-QTY                14050068
140600                                 + WS-OVRG-QTY-STR (L)            14060068
140700     END-PERFORM.                                                 14070068
140800                                                                  14080068
140900*VERIFY OVRG QTY ACCOUNTED FOR (ROUNDING MISMATCH).               14090068
141000     IF PV-STR-TIER-QTY NOT = PV-OVERAGE-QTY                      14100068
141100                                                                  14110068
141200*REDUCE TIER(S) FROM BOTTOM TO TOP.                               14120068
141300         IF PV-STR-TIER-QTY > PV-OVERAGE-QTY                      14130068
141400             PERFORM 2510-DECREASE-TIER-QTY                       14140068
141500         ELSE                                                     14150068
141600*ADD TO TIER WITH HIGHEST PERCENTAGE OF OVERAGE.                  14160068
141700             MOVE ZEROES TO PV-HIGH-TIER-PCT                      14170068
141800                            PV-HIGH-PCT-TIER                      14180068
141900             PERFORM                                              14190068
142000               VARYING L FROM 1 BY 1                              14200068
142100                 UNTIL L > 10                                     14210068
142200                                                                  14220068
142300                 IF WS-OVRG-TIER-PCT (L) > PV-HIGH-TIER-PCT       14230068
142400                     MOVE WS-OVRG-TIER (L)     TO PV-HIGH-PCT-TIER14240068
142500                     MOVE WS-OVRG-TIER-PCT (L) TO PV-HIGH-TIER-PCT14250068
142600                 END-IF                                           14260068
142700             END-PERFORM                                          14270068
142800                                                                  14280068
142900             PERFORM 2520-INCREASE-TIER-QTY                       14290068
143000                                                                  14300068
143100     END-IF.                                                      14310068
143200                                                                  14320068
143300     IF PV-STR-TIER-QTY NOT = PV-OVERAGE-QTY                      14330068
143400         MOVE PV-OVERAGE-QTY TO PV-DISPLAY-QTY                    14340068
143500         MOVE 'PV-STR-TIER-QTY NOT = PV-OVERAGE-QTY'              14350068
143600                                     TO RC001-SPECIAL-1           14360068
143700         STRING ' ==> '            DELIMITED BY SIZE              14370068
143800                PV-STR-TIER-QTY    DELIMITED BY SIZE              14380068
143900                ' NOT = '          DELIMITED BY SIZE              14390068
144000                PV-DISPLAY-QTY     DELIMITED BY SIZE              14400068
144100                ' <=='             DELIMITED BY SIZE              14410068
144200                                   INTO RC001-SPECIAL-2           14420068
144300         SET PS-DONE-YES TO TRUE                                  14430068
144400         MOVE SPACES     TO TM501-TM500-RETURN-MSG                14440068
144500         MOVE '2500'     TO TM501-PARA                            14450068
                                  TM007-RETURNED-PARA                   14451099
144600         MOVE '824'      TO TM501-PGM                             14460068
144700         MOVE SQLCODE    TO TM500-SQLCODE                         14470068
144700                            TM007-SQLCODE                         14471099
144800         MOVE SQLCA      TO TM500-SQLCA                           14480068
144800                            TM007-SQLCA                           14481099
144900         MOVE 96         TO TM501-PRORATION-ERROR-NBR             14490068
145000         PERFORM TM501-SET-TM500-RETURN-MSG                       14500068
               MOVE TM500-RETURN-DATA                                   14511099
                               TO TM007-RETURN-DATA                     14512099
145100         PERFORM RC001-RETURN-MSG                                 14513099
145200     END-IF.                                                      14520068
145300                                                                  14530068
145400*ASSIGN OVRG QTY TO STORES BY TIER.                               14540068
145500     PERFORM 2530-ASSIGN-OVERAGE.                                 14550068
145600                                                                  14560068
145700******************************************************************14570068
145800 2510-DECREASE-TIER-QTY.                                          14580068
145900     MOVE '2510-DECREASE-TIER-QTY        ' TO RC001-PARAGRAPH.    14590068
146000                                                                  14600068
146100     COMPUTE PV-DIFFERENCE = PV-STR-TIER-QTY                      14610068
146200                           - PV-OVERAGE-QTY.                      14620068
146300     PERFORM                                                      14630068
146400       VARYING L FROM 10 BY -1                                    14640068
146500         UNTIL L = ZEROES                                         14650068
146600            OR PV-STR-TIER-QTY = PV-OVERAGE-QTY                   14660068
146700                                                                  14670068
146800         IF WS-OVRG-TIER (L) > ZEROES                             14680068
146900           AND WS-OVRG-PCT-PRRTN (L) > ZEROES                     14690068
147000           AND WS-OVRG-QTY-STR   (L) > ZEROES                     14700068
147100             IF PV-DIFFERENCE NOT > WS-OVRG-QTY-STR (L)           14710068
147200                 SUBTRACT PV-DIFFERENCE FROM WS-OVRG-QTY-STR (L)  14720068
147300                                             PV-STR-TIER-QTY      14730068
147400             ELSE                                                 14740068
147500                 SUBTRACT WS-OVRG-QTY-STR (L) FROM                14750068
147600                                             PV-DIFFERENCE        14760068
147700                                             PV-STR-TIER-QTY      14770068
147800                 MOVE ZEROES TO WS-OVRG-QTY-STR (L)               14780068
147900             END-IF                                               14790068
148000         END-IF                                                   14800068
148100                                                                  14810068
148200     END-PERFORM.                                                 14820068
148300                                                                  14830068
148400******************************************************************14840068
148500 2520-INCREASE-TIER-QTY.                                          14850068
148600     MOVE '2520-INCREASE-TIER-QTY        ' TO RC001-PARAGRAPH.    14860068
148700                                                                  14870068
148800     COMPUTE PV-DIFFERENCE = PV-OVERAGE-QTY                       14880068
148900                           - PV-STR-TIER-QTY.                     14890068
149000                                                                  14900068
149100     PERFORM                                                      14910068
149200       VARYING L FROM 1 BY 1 UNTIL L > 10                         14920068
149300                                                                  14930068
149400         IF WS-OVRG-TIER-PCT (L) = PV-HIGH-TIER-PCT               14940068
149500             ADD PV-DIFFERENCE TO WS-OVRG-QTY-STR (L)             14950068
149600                                  PV-STR-TIER-QTY                 14960068
149700         END-IF                                                   14970068
149800                                                                  14980068
149900     END-PERFORM.                                                 14990068
150000                                                                  15000068
150100******************************************************************15010068
150200* ALLOCATE OVERAGE TIER QUANTITIES BY DISTRIBUTING ONE UNIT       15020068
150300* TO EACH STORE UNTIL OVERAGE UNITS GONE FOR THAT TIER.           15030068
150400******************************************************************15040068
150500 2530-ASSIGN-OVERAGE.                                             15050068
150600     MOVE '2530-ASSIGN-OVERAGE           ' TO RC001-PARAGRAPH.    15060068
150700                                                                  15070068
150800     PERFORM                                                      15080068
150900       VARYING L FROM 1 BY 1 UNTIL L > 10                         15090068
151000                                                                  15100068
151100         MOVE WS-OVRG-QTY-STR (L) TO PV-STR-TIER-QTY              15110068
151200                                                                  15120068
151300         IF WS-OVRG-QTY-STR (L) > ZEROES                          15130068
151400             MOVE 1 TO M                                          15140068
151500             PERFORM                                              15150068
151600               UNTIL PV-STR-TIER-QTY NOT > ZEROES                 15160068
151700                  OR WK-STR-NBR (M) = ZEROES                      15170068
151800                                                                  15180068
151900                 IF WK-STR-TIER (M) = WS-OVRG-TIER (L)            15190068
152000                     IF PV-DISPERSAL-QTY > PV-STR-TIER-QTY        15200068
152100                         ADD PV-STR-TIER-QTY TO WK-ALLOC-UNITS(M) 15210068
152200                         SUBTRACT PV-STR-TIER-QTY                 15220068
152300                                           FROM PV-STR-TIER-QTY   15230068
152400                                                PV-LEFT-TO-ALLOC  15240068
152500                         ADD 1 TO M                               15250068
152600                         IF WK-STR-NBR (M) NOT > ZEROES           15260068
152700                             MOVE 1 TO M                          15270068
152800                         END-IF                                   15280068
152900                     ELSE                                         15290068
153000                         ADD PV-DISPERSAL-QTY TO WK-ALLOC-UNITS(M)15300068
153100                         SUBTRACT PV-DISPERSAL-QTY                15310068
153200                                            FROM PV-STR-TIER-QTY  15320068
153300                                                 PV-LEFT-TO-ALLOC 15330068
153400                         ADD 1 TO M                               15340068
153500                         IF WK-STR-NBR (M) NOT > ZEROES           15350068
153600                             MOVE 1 TO M                          15360068
153700                         END-IF                                   15370068
153800                     END-IF                                       15380068
153900                 ELSE                                             15390068
154000                     ADD 1 TO M                                   15400068
154100                     IF WK-STR-NBR (M) NOT > ZEROES               15410068
154200                         MOVE 1 TO M                              15420068
154300                     END-IF                                       15430068
154400                 END-IF                                           15440068
154500             END-PERFORM                                          15450068
154600         END-IF                                                   15460068
154700     END-PERFORM.                                                 15470068
154800                                                                  15480068
154900******************************************************************15490068
155000 2600-ALLOC-OVRG-TO-CS.                                           15500068
155100     MOVE '2600-ALLOC-OVRG-TO-CS         ' TO RC001-PARAGRAPH.    15510068
155200                                                                  15520068
155300     PERFORM                                                      15530068
155400       VARYING L FROM 1 BY 1                                      15540068
155500         UNTIL (WK-STR-NBR (L) = ZEROES)                          15550068
155600            OR (L > PV-MAX-STORES)                                15560068
155700            OR (PV-LEFT-TO-ALLOC NOT > ZEROES)                    15570068
155800                                                                  15580068
155900         IF WK-STR-NBR (L) > ZEROES                               15590068
156000             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               15600068
156100                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)15610068
156200                 SUBTRACT PV-LEFT-TO-ALLOC FROM PV-LEFT-TO-ALLOC  15620068
156300             ELSE                                                 15630068
156400                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (L)15640068
156500                 SUBTRACT PV-DISPERSAL-QTY FROM PV-LEFT-TO-ALLOC  15650068
156600             END-IF                                               15660068
156700         END-IF                                                   15670068
156800                                                                  15680068
156900     END-PERFORM.                                                 15690068
157000                                                                  15700068
157100******************************************************************15710068
157200*                                                                *15720068
157300*          O V E R A G E   -   O T R   F I L L - I N             *15730068
157400*                                                                *15740068
157500*    FILL NEW STORES UP TO 'OPEN-TO-RECEIVE'.                    *15750068
157600*    FILL EXISTING STORES UP TO 'OPEN-TO-RECEIVE'.               *15760068
157700*    FILL CENTRAL STOCK STORES UP TO 'OPEN-TO-RECEIVE'.          *15770068
157800*                                                                *15780068
157900*    OVERAGE QTY DISPERSED TO EXISTING STORES.                   *15790068
158000*    IF NO EXISTING STORES, OVERAGE QTY DISPERSED TO NEW STORES. *15800068
158100*    IF NO NEW OR EXISTING STORES, OVERAGE QTY GOES TO C-S.      *15810068
158200*                                                                *15820068
158300*    SORT STORES                                                 *15830068
158400*      - MOST OTR TO LEAST OTR QTY (BASED ON PLAN)               *15840068
158500*      - BEST TO WORST BASED ON SALES (SECONDARY SORT)           *15850068
158600*                                                                *15860068
158700*    PRORATION W/RANDOMIZATION                                   *15870068
158800*      - BASED ON OTR TIER, GIVE EACH STORE A 'DISPERSAL QTY'    *15880068
158900*        ELSE RANDOMIZE(CALL RANDOM ROUTINE TO SELECT STORES) IF *15890068
159000*        NOT ENOUGH OVERAGE TO GIVE EACH TIER STORE A DISPERSAL. *15900068
159100*      - ALWAYS ROUND UP                                         *15910068
159200*      - IF ONLY NEW OR C-S STORES, USE FILL-IN METHOD           *15920068
159300*        (ALLOCATING A 'DISPERSAL QTY' PER STORE UNTIL GONE)     *15930068
159400*                                                                *15940068
159500******************************************************************15950068
159600 3000-FILL-IN-OVER.                                               15960068
159700     MOVE '3000-FILL-IN-OVER             ' TO RC001-PARAGRAPH.    15970068
159800                                                                  15980068
159900************                                                      15990068
160000*NEW STORES*                                                      16000068
160100*IF NEW STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       16010068
160200************                                                      16020068
160300     IF PV-NW-STR-OTR > ZEROES                                    16030068
160400         PERFORM                                                  16040068
160500           VARYING L FROM 1 BY 1                                  16050068
160600             UNTIL L > PV-MAX-STORES                              16060068
160700                                                                  16070068
160800             IF NW-STR-OTR-QTY (L) > ZEROES                       16080068
160900*ROUND STORE OTR UP TO THE NEXT PACK                              16090068
161000                 DIVIDE NW-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    16100068
161100                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    16110068
161200                 IF PV-REMAINDER > 0                              16120068
161300                     ADD 1 TO PV-TEMP-OTR-QTY                     16130068
161400                 END-IF                                           16140068
161500                                                                  16150068
161600                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        16160068
161700                                         * PV-DISPERSAL-QTY       16170068
161800                                                                  16180068
161900*CALC OVERAGE QUANTITY.                                           16190068
162000                 IF PV-TEMP-OTR-QTY > NW-STR-OTR-QTY (L)          16200068
162100                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    16210068
162200                                              - PV-TEMP-OTR-QTY   16220068
162300                                              + NW-STR-OTR-QTY (L)16230068
162400                 END-IF                                           16240068
162500                                                                  16250068
162600                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        16260068
162700                     MOVE PV-TEMP-OTR-QTY    TO NW-ALLOC-UNITS (L)16270068
162800                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  16280068
162900                                              - PV-TEMP-OTR-QTY   16290068
163000                     MOVE ZEROES             TO NW-STR-OTR-QTY (L)16300068
163100                 ELSE                                             16310068
163200                     MOVE PV-LEFT-TO-ALLOC   TO NW-ALLOC-UNITS (L)16320068
163300                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  16330068
163400                                                NW-STR-OTR-QTY (L)16340068
163500                 END-IF                                           16350068
163600             END-IF                                               16360068
163700         END-PERFORM                                              16370068
163800                                                                  16380068
163900         MOVE ZEROES TO PV-NW-STR-OTR                             16390068
164000     END-IF.                                                      16400068
164100                                                                  16410068
164200**********************                                            16420068
164300*CENTRAL STOCK STORES*                                            16430068
164400*IF C-S STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       16440068
164500**********************                                            16450068
164600     IF PV-CS-STR-OTR > ZEROES                                    16460068
164700         PERFORM                                                  16470068
164800           VARYING L FROM 1 BY 1                                  16480068
164900             UNTIL L > PV-MAX-STORES                              16490068
165000                                                                  16500068
165100             IF CS-STR-OTR-QTY (L) > ZEROES                       16510068
165200*ROUND STORE OTR UP TO THE NEXT PACK                              16520068
165300                 DIVIDE CS-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    16530068
165400                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    16540068
165500                 IF PV-REMAINDER > 0                              16550068
165600                     ADD 1 TO PV-TEMP-OTR-QTY                     16560068
165700                 END-IF                                           16570068
165800                                                                  16580068
165900                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        16590068
166000                                         * PV-DISPERSAL-QTY       16600068
166100                                                                  16610068
166200*CALC OVERAGE QUANTITY.                                           16620068
166300                 IF PV-TEMP-OTR-QTY > CS-STR-OTR-QTY (L)          16630068
166400                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    16640068
166500                                              - PV-TEMP-OTR-QTY   16650068
166600                                              + CS-STR-OTR-QTY (L)16660068
166700                 END-IF                                           16670068
166800                                                                  16680068
166900                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        16690068
167000                     MOVE PV-TEMP-OTR-QTY    TO CS-ALLOC-UNITS (L)16700068
167100                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  16710068
167200                                              - PV-TEMP-OTR-QTY   16720068
167300                     MOVE ZEROES             TO CS-STR-OTR-QTY (L)16730068
167400                 ELSE                                             16740068
167500                     MOVE PV-LEFT-TO-ALLOC   TO CS-ALLOC-UNITS (L)16750068
167600                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  16760068
167700                                                CS-STR-OTR-QTY (L)16770068
167800                 END-IF                                           16780068
167900             END-IF                                               16790068
168000         END-PERFORM                                              16800068
168100                                                                  16810068
168200         MOVE ZEROES TO PV-CS-STR-OTR                             16820068
168300     END-IF.                                                      16830068
168400                                                                  16840068
168500*****************                                                 16850068
168600*EXISTING STORES*                                                 16860068
168700*IF EXISTING STORES EXIST, FILL TO OTR (THEN PRORATE OVERAGE).    16870068
168800*****************                                                 16880068
168900     IF PV-RG-STR-CNT > ZEROES                                    16890068
169000       AND PV-LEFT-TO-ALLOC > ZEROES                              16900068
169100         PERFORM                                                  16910068
169200           VARYING L FROM 1 BY 1                                  16920068
169300             UNTIL L > PV-MAX-STORES                              16930068
169400                                                                  16940068
169500             IF RG-STR-OTR-QTY (L) > ZEROES                       16950068
169600*ROUND STORE OTR UP TO THE NEXT PACK                              16960068
169700                 DIVIDE RG-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    16970068
169800                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    16980068
169900                 IF PV-REMAINDER > 0                              16990068
170000                     ADD 1 TO PV-TEMP-OTR-QTY                     17000068
170100                 END-IF                                           17010068
170200                                                                  17020068
170300                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        17030068
170400                                         * PV-DISPERSAL-QTY       17040068
170500                                                                  17050068
170600*CALC OVERAGE QUANTITY.                                           17060068
170700                 IF PV-TEMP-OTR-QTY > RG-STR-OTR-QTY (L)          17070068
170800                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    17080068
170900                                              - PV-TEMP-OTR-QTY   17090068
171000                                              + RG-STR-OTR-QTY (L)17100068
171100                 END-IF                                           17110068
171200                                                                  17120068
171300                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        17130068
171400                     MOVE PV-TEMP-OTR-QTY    TO RG-ALLOC-UNITS (L)17140068
171500                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  17150068
171600                                              - PV-TEMP-OTR-QTY   17160068
171700                     MOVE ZEROES             TO RG-STR-OTR-QTY (L)17170068
171800                 ELSE                                             17180068
171900                     MOVE PV-LEFT-TO-ALLOC   TO RG-ALLOC-UNITS (L)17190068
172000                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  17200068
172100                                                RG-STR-OTR-QTY (L)17210068
172200                 END-IF                                           17220068
172300             END-IF                                               17230068
172400         END-PERFORM                                              17240068
172500                                                                  17250068
172600         MOVE ZEROES TO PV-RG-STR-OTR                             17260068
172700     END-IF.                                                      17270068
172800                                                                  17280068
172900*************                                                     17290068
173000*OVERAGE QTY*                                                     17300068
173100*************                                                     17310068
173200*LOAD EXISTING STORES, SORT, PRORATE & RESET STORE TABLES.        17320068
173300     IF PV-RG-STR-CNT > ZEROES                                    17330068
173400       AND PV-LEFT-TO-ALLOC > ZEROES                              17340068
173500         PERFORM 5400-LOAD-RG-TO-WK                               17350068
173600*JPL     PERFORM 2100-SORT-BY-SALES                               17360069
173700         PERFORM 6400-SORT-BY-PLAN                                17370068
173800         PERFORM 3200-ASSIGN-TIER-OTR                             17380068
173900         PERFORM 3300-ALLOC-OVRG-FI                               17390068
174000         PERFORM 5500-LOAD-WK-TO-RG                               17400068
174100     END-IF.                                                      17410068
174200                                                                  17420068
174300*IF NEW STORES EXIST & NO EXISTING STORES EXIST,                  17430068
174400*DISPERSE OVERAGE UNTIL ALL GONE.                                 17440068
174500     IF PV-NW-STR-CNT > ZEROES                                    17450068
174600       AND PV-RG-STR-CNT NOT > ZEROES                             17460068
174700       AND PV-LEFT-TO-ALLOC > ZEROES                              17470068
174800                                                                  17480068
174900         PERFORM 5100-LOAD-NW-TO-WK                               17490068
175000                                                                  17500068
175100         PERFORM                                                  17510068
175200           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    17520068
175300             PERFORM 2400-ALLOC-OVRG-TO-NW                        17530068
175400         END-PERFORM                                              17540068
175500                                                                  17550068
175600         PERFORM 5300-LOAD-WK-TO-NW                               17560068
175700     END-IF.                                                      17570068
175800                                                                  17580068
175900*IF CENTRAL-STOCK STORES EXIST & NO NEW OR EXISTING STORES EXIST, 17590068
176000*DISPERSE OVERAGE UNTIL ALL GONE.                                 17600068
176100     IF PV-CS-STR-CNT > ZEROES                                    17610068
176200       AND PV-RG-STR-CNT NOT > ZEROES                             17620068
176300       AND PV-LEFT-TO-ALLOC > ZEROES                              17630068
176400                                                                  17640068
176500         PERFORM 5600-LOAD-CS-TO-WK                               17650068
176600                                                                  17660068
176700         PERFORM                                                  17670068
176800           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    17680068
176900             PERFORM 2600-ALLOC-OVRG-TO-CS                        17690068
177000         END-PERFORM                                              17700068
177100                                                                  17710068
177200         PERFORM 5700-LOAD-WK-TO-CS                               17720068
177300     END-IF.                                                      17730068
177400                                                                  17740068
177500******************************************************************17750068
177600 3100-SORT-BY-OTR.                                                17760068
177700     MOVE '3100-SORT-BY-OTR              ' TO RC001-PARAGRAPH.    17770068
177800                                                                  17780068
177900*SORT STORE TABLE (LARGEST TO SMALLEST - ALLOC QTY).              17790068
178000     MOVE 1 TO A.                                                 17800068
178100     PERFORM                                                      17810068
178200       UNTIL A > PV-MAX-STORES                                    17820068
178300          OR WK-STR-NBR (A) = ZEROES                              17830068
178400                                                                  17840068
178500         COMPUTE B = A + 1                                        17850068
178600         PERFORM 3110-SORT-BY-ALLOC                               17860068
178700           UNTIL B > PV-MAX-STORES                                17870068
178800              OR WK-STR-NBR (B) = ZEROES                          17880068
178900         ADD 1 TO A                                               17890068
179000                                                                  17900068
179100     END-PERFORM.                                                 17910068
179200                                                                  17920068
179300*SORT STORE TABLE (WITHIN OTR BY STORE RANK).                     17930068
179400     MOVE 1 TO A.                                                 17940068
179500     PERFORM                                                      17950068
179600       UNTIL A > PV-MAX-STORES                                    17960068
179700          OR WK-STR-NBR (A) = ZEROES                              17970068
179800                                                                  17980068
179900         COMPUTE B = A + 1                                        17990068
180000         PERFORM 3120-SORT-BY-RANK                                18000068
180100           UNTIL B > PV-MAX-STORES                                18010068
180200              OR WK-STR-NBR (B) = ZEROES                          18020068
180300         ADD 1 TO A                                               18030068
180400                                                                  18040068
180500     END-PERFORM.                                                 18050068
180600                                                                  18060068
180700******************************************************************18070068
180800 3110-SORT-BY-ALLOC.                                              18080068
180900     MOVE '3110-SORT-BY-ALLOC            ' TO RC001-PARAGRAPH.    18090068
181000                                                                  18100068
181100     IF WK-STR-OTR-QTY (A) < WK-STR-OTR-QTY (B)                   18110068
181200         MOVE WK-STORE-ENTRY (A)  TO WS-HOLD-STORE-TABLE          18120068
181300         MOVE WK-STORE-ENTRY (B)  TO WK-STORE-ENTRY (A)           18130068
181400         MOVE WS-HOLD-STORE-TABLE TO WK-STORE-ENTRY (B)           18140068
181500     END-IF.                                                      18150068
181600                                                                  18160068
181700     ADD 1 TO B.                                                  18170068
181800                                                                  18180068
181900******************************************************************18190068
182000 3120-SORT-BY-RANK.                                               18200068
182100     MOVE '3120-SORT-BY-RANK             ' TO RC001-PARAGRAPH.    18210068
182200                                                                  18220068
182300     IF WK-STR-OTR-QTY (A) = WK-STR-OTR-QTY (B)                   18230068
182400       AND WK-RNK-SEQ-NBR (A) > WK-RNK-SEQ-NBR (B)                18240068
182500         MOVE WK-STORE-ENTRY (A)  TO WS-HOLD-STORE-TABLE          18250068
182600         MOVE WK-STORE-ENTRY (B)  TO WK-STORE-ENTRY (A)           18260068
182700         MOVE WS-HOLD-STORE-TABLE TO WK-STORE-ENTRY (B)           18270068
182800     END-IF.                                                      18280068
182900                                                                  18290068
183000     ADD 1 TO B.                                                  18300068
183100                                                                  18310068
183200******************************************************************18320068
183300 3200-ASSIGN-TIER-OTR.                                            18330068
183400     MOVE '3200-ASSIGN-TIER-OTR          ' TO RC001-PARAGRAPH.    18340068
183500                                                                  18350068
183600     MOVE 1 TO WK-STR-TIER (1)                                    18360068
183700               PV-STR-TIER-COUNT.                                 18370068
183800                                                                  18380068
183900     PERFORM                                                      18390068
184000       VARYING L FROM 2 BY 1                                      18400068
184100         UNTIL WK-STR-NBR (L) NOT > ZEROES                        18410068
184200            OR L > PV-MAX-STORES                                  18420068
184300                                                                  18430068
184400         COMPUTE A = L - 1                                        18440068
184500         IF WK-STR-PLAN-QTY (L) = WK-STR-PLAN-QTY (A)             18450068
184600             MOVE PV-STR-TIER-COUNT TO WK-STR-TIER (L)            18460068
184700         ELSE                                                     18470068
184800             ADD 1 TO PV-STR-TIER-COUNT                           18480068
184900             MOVE PV-STR-TIER-COUNT TO WK-STR-TIER (L)            18490068
185000         END-IF                                                   18500068
185100                                                                  18510068
185200     END-PERFORM.                                                 18520068
185300                                                                  18530068
185400******************************************************************18540068
185500*COMPARE OVRG QTY TO NBR OF STORES IN OTR TIER.                   18550068
185600*IF OVRG QTY NOT < NBR OF TIER STORES, GIVE ONE TO EACH.          18560068
185700*IF OVRG QTY < NBR OF TIER STORES, CALL RANDOM ROUTINE.           18570068
185800******************************************************************18580068
185900 3300-ALLOC-OVRG-FI.                                              18590068
186000     MOVE '3300-ALLOC-OVRG-FI            ' TO RC001-PARAGRAPH.    18600068
186100                                                                  18610068
186200     MOVE WK-STR-TIER (1) TO PV-COMPARE-TIER.                     18620068
186300                                                                  18630068
186400     PERFORM                                                      18640068
186500       UNTIL PV-OVERAGE-QTY NOT > ZEROES                          18650068
186600                                                                  18660068
186700         PERFORM 3310-ACCUM-TIER-INFO                             18670068
186800                                                                  18680068
186900         IF PV-DISPERSAL-QTY > 1                                  18690068
187000             COMPUTE PV-UNITS-NEEDED = PV-ACCUM-TIER-STORES       18700068
187100                                     * PV-DISPERSAL-QTY           18710068
187200         ELSE                                                     18720068
187300             MOVE PV-ACCUM-TIER-STORES TO PV-UNITS-NEEDED         18730068
187400         END-IF                                                   18740068
187500                                                                  18750068
187600         IF PV-OVERAGE-QTY < PV-UNITS-NEEDED                      18760068
187700             PERFORM 3330-ALLOC-OVRG-TIER-PARTIAL                 18770068
187800         ELSE                                                     18780068
187900             PERFORM 3320-ALLOC-OVRG-TIER                         18790068
188000             COMPUTE PV-COMPARE-TIER = PV-COMPARE-TIER + 1        18800068
188100             IF PV-COMPARE-TIER > PV-STR-TIER-COUNT               18810068
188200                 MOVE 1 TO PV-COMPARE-TIER                        18820068
188300             END-IF                                               18830068
188400         END-IF                                                   18840068
188500                                                                  18850068
188600     END-PERFORM.                                                 18860068
188700                                                                  18870068
188800******************************************************************18880068
188900 3310-ACCUM-TIER-INFO.                                            18890068
189000     MOVE '3310-ACCUM-TIER-INFO          ' TO RC001-PARAGRAPH.    18900068
189100                                                                  18910068
189200     MOVE ZEROES TO PV-ACCUM-TIER-STORES.                         18920068
189300                                                                  18930068
189400     PERFORM                                                      18940068
189500       VARYING L FROM 1 BY 1                                      18950068
189600         UNTIL L > PV-MAX-STORES                                  18960068
189700            OR WK-STR-NBR (L) NOT > ZEROES                        18970068
189800                                                                  18980068
189900*ONLY ACCUM FOR SAME TIER STORES (NEVER CENTRAL STOCK)            18990068
190000         IF WK-STR-NBR (L) > ZEROES                               19000068
190100           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  19010068
190200           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     19020068
190300             ADD 1 TO PV-ACCUM-TIER-STORES                        19030068
190400         END-IF                                                   19040068
190500                                                                  19050068
190600     END-PERFORM.                                                 19060068
190700                                                                  19070068
190800******************************************************************19080068
190900 3320-ALLOC-OVRG-TIER.                                            19090068
191000     MOVE '3320-ALLOC-OVRG-TIER          ' TO RC001-PARAGRAPH.    19100068
191100                                                                  19110068
191200     PERFORM                                                      19120068
191300       VARYING L FROM 1 BY 1                                      19130068
191400         UNTIL L > PV-MAX-STORES                                  19140068
191500            OR WK-STR-NBR (L) NOT > ZEROES                        19150068
191600                                                                  19160068
191700*ONLY ACCUM FOR SAME TIER STORES (NEVER CENTRAL STOCK)            19170068
191800         IF WK-STR-NBR (L) > ZEROES                               19180068
191900           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  19190068
192000           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     19200068
192100                                                                  19210068
192200             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               19220068
192300                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)19230068
192400                 SUBTRACT PV-LEFT-TO-ALLOC FROM PV-OVERAGE-QTY    19240068
192500                                                PV-LEFT-TO-ALLOC  19250068
192600             ELSE                                                 19260068
192700                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (L)19270068
192800                 SUBTRACT PV-DISPERSAL-QTY FROM PV-OVERAGE-QTY    19280068
192900                                                PV-LEFT-TO-ALLOC  19290068
193000             END-IF                                               19300068
193100         END-IF                                                   19310068
193200                                                                  19320068
193300     END-PERFORM.                                                 19330068
193400                                                                  19340068
193500******************************************************************19350068
193600 3330-ALLOC-OVRG-TIER-PARTIAL.                                    19360068
193700     MOVE '3330-ALLOC-OVRG-TIER-PARTIAL  ' TO RC001-PARAGRAPH.    19370068
193800                                                                  19380068
193900     MOVE ZEROES TO RC825-RANDOM-STR-SEL-CNT                      19390099
194000                    RC825-RANDOM-SEL-MAX.                         19400099
194100                                                                  19410068
194200     PERFORM 3340-LOAD-TIER-STORES.                               19420068
194300                                                                  19430068
194400     COMPUTE PV-RANDOM-STR-SEL-CNT = PV-OVERAGE-QTY               19440068
194500                                   / PV-DISPERSAL-QTY             19450068
194600     IF PV-RANDOM-STR-SEL-REM > ZERO                              19460068
194700         ADD 1 TO PV-RANDOM-STR-SEL-QTY                           19470068
194800     END-IF.                                                      19480068
194900     MOVE PV-RANDOM-STR-SEL-QTY TO RC825-RANDOM-STR-SEL-CNT.      19490099
195000                                                                  19500068
195100     PERFORM 9000-CALL-RANDOM.                                    19510068
195200                                                                  19520068
195300     IF RC825-NO-ERRORS                                           19530099
195400         PERFORM 3350-ALLOC-RANDOM-STORES                         19540068
195500     ELSE                                                         19550068
195600         SET PS-DONE-YES   TO TRUE                                19560068
195700         MOVE SPACES       TO TM501-TM500-RETURN-MSG              19570068
195800         MOVE '3330'       TO TM501-PARA                          19580068
                                    TM007-RETURNED-PARA                 19581099
195900         MOVE '824'        TO TM501-PGM                           19590068
196000         MOVE SQLCODE      TO TM500-SQLCODE                       19600068
196000                              TM007-SQLCODE                       19601099
196100         MOVE SQLCA        TO TM500-SQLCA                         19610068
196100                              TM007-SQLCA                         19611099
196200         MOVE 80           TO TM501-PRORATION-ERROR-NBR           19620068
196300         PERFORM TM501-SET-TM500-RETURN-MSG                       19630068
               MOVE TM500-RETURN-DATA                                   19641099
                                 TO TM007-RETURN-DATA                   19642099
196400         PERFORM RC001-RETURN-MSG                                 19643099
196500     END-IF.                                                      19650068
196600                                                                  19660068
196700******************************************************************19670068
196800 3340-LOAD-TIER-STORES.                                           19680068
196900     MOVE '3340-LOAD-TIER-STORES         ' TO RC001-PARAGRAPH.    19690068
197000                                                                  19700068
197100     MOVE 1 TO M.                                                 19710068
197200     PERFORM                                                      19720068
197300       VARYING L FROM 1 BY 1                                      19730068
197400***      UNTIL WK-STR-NBR (L) NOT > ZEROES                        19740068
197500         UNTIL L > PV-MAX-STORES                                  19750068
197600                                                                  19760068
197700         INITIALIZE RC825-STORE-TABLE (M)                         19770099
197800                                                                  19780068
197900         IF WK-STR-NBR (L) > ZEROES                               19790068
198000           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  19800068
198100           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     19810068
198200                                                                  19820068
198300             MOVE WK-STR-NBR (L) TO RC825-STORE-NUMBER (M)        19830099
198400             MOVE 'N'            TO RC825-STORE-RANDOM-IND (M)    19840099
198500                                                                  19850068
198600             ADD 1 TO RC825-RANDOM-SEL-MAX                        19860099
198700             ADD 1 TO M                                           19870068
198800         END-IF                                                   19880068
198900                                                                  19890068
199000     END-PERFORM.                                                 19900068
199100                                                                  19910068
199200******************************************************************19920068
199300 3350-ALLOC-RANDOM-STORES.                                        19930068
199400     MOVE '3350-ALLOC-RANDOM-STORES      ' TO RC001-PARAGRAPH.    19940068
199500                                                                  19950068
199600*LOOP THRU RC825-RANDOM-STORE-NBR                                 19960099
199700     PERFORM                                                      19970068
199800       VARYING L FROM 1 BY 1                                      19980068
199900         UNTIL L > PV-MAX-STORES                                  19990068
200000                                                                  20000068
200100         IF RC825-RANDOM-STORE-NBR (L) > ZEROES                   20010099
200200             PERFORM 3355-MATCH-STORE                             20020068
200300         END-IF                                                   20030068
200400     END-PERFORM.                                                 20040068
200500                                                                  20050068
200600******************************************************************20060068
200700 3355-MATCH-STORE.                                                20070068
200800     MOVE '3355-MATCH-STORE              ' TO RC001-PARAGRAPH.    20080068
200900                                                                  20090068
201000     SET PS-RANDOM-STR-MATCH-NO TO TRUE.                          20100068
201100*MATCH RC825-RANDOM-STORE-NBR (L) TO WK-STR-NBR (M)               20110099
201200     PERFORM                                                      20120068
201300       VARYING M FROM 1 BY 1                                      20130068
201400         UNTIL M > PV-MAX-STORES                                  20140068
201500            OR PS-RANDOM-STR-MATCH-YES                            20150068
201600                                                                  20160068
201700         IF RC825-RANDOM-STORE-NBR (L) = WK-STR-NBR (M)           20170099
201800             PERFORM 3356-ALLOC-MATCH-STORE                       20180068
201900         END-IF                                                   20190068
202000                                                                  20200068
202100         IF M = PV-MAX-STORES                                     20210068
202200             MOVE '  ==> RANDOM STORE NOT FOUND IN TIER - '       20220068
202300                                             TO RC001-SPECIAL-1   20230068
202400             MOVE RC825-RANDOM-STORE-NBR (L) TO RC001-SPECIAL-2   20240099
202500             SET PS-DONE-YES TO TRUE                              20250068
202600             MOVE SPACES     TO TM501-TM500-RETURN-MSG            20260068
202700             MOVE '3355'     TO TM501-PARA                        20270068
                                      TM007-RETURNED-PARA               20271099
202800             MOVE '824'      TO TM501-PGM                         20280068
202900             MOVE SQLCODE    TO TM500-SQLCODE                     20290068
202900                                TM007-SQLCODE                     20291099
203000             MOVE SQLCA      TO TM500-SQLCA                       20300068
203000                                TM007-SQLCA                       20301099
203100             MOVE 97         TO TM501-PRORATION-ERROR-NBR         20310068
203200             PERFORM TM501-SET-TM500-RETURN-MSG                   20320068
                   MOVE TM500-RETURN-DATA                               20331099
                                   TO TM007-RETURN-DATA                 20332099
203300             PERFORM RC001-RETURN-MSG                             20333099
203400         END-IF                                                   20340068
203500     END-PERFORM.                                                 20350068
203600                                                                  20360068
203700******************************************************************20370068
203800 3356-ALLOC-MATCH-STORE.                                          20380068
203900     MOVE '3356-ALLOC-MATCH-STORE        ' TO RC001-PARAGRAPH.    20390068
204000                                                                  20400068
204100*ALLOCATE 1 UNIT TO WK-STR-NBR (M)                                20410068
204200     IF PV-OVERAGE-QTY > ZEROES                                   20420068
204300         IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY                   20430068
204400             ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (M)    20440068
204500             SUBTRACT PV-LEFT-TO-ALLOC FROM PV-OVERAGE-QTY        20450068
204600                                            PV-LEFT-TO-ALLOC      20460068
204700         ELSE                                                     20470068
204800             ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (M)    20480068
204900             SUBTRACT PV-DISPERSAL-QTY FROM PV-OVERAGE-QTY        20490068
205000                                            PV-LEFT-TO-ALLOC      20500068
205100         END-IF                                                   20510068
205200     END-IF.                                                      20520068
205300                                                                  20530068
205400     SET PS-RANDOM-STR-MATCH-YES TO TRUE.                         20540068
205500                                                                  20550068
205600******************************************************************20560068
205700*                                                                *20570068
205800*          O V E R A G E   -   O T R   S A L E S                 *20580068
205900*                                                                *20590068
206000*    FILL NEW STORES UP TO 'OPEN-TO-RECEIVE'.                    *20600068
206100*    FILL EXISTING STORES UP TO 'OPEN-TO-RECEIVE'.               *20610068
206200*    FILL CENTRAL STOCK STORES UP TO 'OPEN-TO-RECEIVE'.          *20620068
206300*                                                                *20630068
206400*    OVERAGE QTY DISPERSED TO EXISTING STORES.                   *20640068
206500*    IF NO EXISTING STORES, OVERAGE QTY DISPERSED TO NEW STORES. *20650068
206600*    IF NO NEW OR EXISTING STORES, OVERAGE QTY GOES TO C-S.      *20660068
206700*                                                                *20670068
206800*    SORT STORES                                                 *20680068
206900*      - MOST OTR TO LEAST OTR QTY (BASED ON PLAN)               *20690068
207000*      - BEST TO WORST BASED ON SALES (SECONDARY SORT)           *20700068
207100*                                                                *20710068
207200*    PRORATION W/RANDOMIZATION                                   *20720068
207300*      - BASED ON OTR TIER, DETERMINE ALLOCATION PERCENTAGE      *20730068
207400*        (EXAMPLE - A STORE THAT HAS A 3% ALLOCATION OF THE      *20740068
207500*                   ORDER QTY, RECEIVES 3% OF THE OVERAGE QTY)   *20750068
207600*      - DISTRIBUTE IN 'DISPERSAL QTYS'                          *20760068
207700*      - ALWAYS ROUND UP                                         *20770068
207800*      - IF THERE ARE NOT ENOUGH OVERAGE UNITS TO FILL ENTIRE    *20780068
207900*        TIER, RANDOMIZE (CALL RANDOM ROUTINE TO SELECT STORES)  *20790068
208000*      - IF ONLY NEW OR C-S STORES, USE FILL-IN METHOD           *20800068
208100*        (ALLOCATING A 'DISPERSAL QTY' PER STORE UNTIL GONE)     *20810068
208200*                                                                *20820068
208300******************************************************************20830068
208400 4000-SALES-OVER.                                                 20840068
208500     MOVE '4000-SALES-OVER               ' TO RC001-PARAGRAPH.    20850068
208600                                                                  20860068
208700************                                                      20870068
208800*NEW STORES*                                                      20880068
208900*IF NEW STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       20890068
209000************                                                      20900068
209100     IF PV-NW-STR-OTR > ZEROES                                    20910068
209200         PERFORM                                                  20920068
209300           VARYING L FROM 1 BY 1                                  20930068
209400             UNTIL L > PV-MAX-STORES                              20940068
209500                                                                  20950068
209600             IF NW-STR-OTR-QTY (L) > ZEROES                       20960068
209700*ROUND STORE OTR UP TO THE NEXT PACK                              20970068
209800                 DIVIDE NW-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    20980068
209900                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    20990068
210000                 IF PV-REMAINDER > 0                              21000068
210100                     ADD 1 TO PV-TEMP-OTR-QTY                     21010068
210200                 END-IF                                           21020068
210300                                                                  21030068
210400                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        21040068
210500                                         * PV-DISPERSAL-QTY       21050068
210600                                                                  21060068
210700*CALC OVERAGE QUANTITY.                                           21070068
210800                 IF PV-TEMP-OTR-QTY > NW-STR-OTR-QTY (L)          21080068
210900                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    21090068
211000                                              - PV-TEMP-OTR-QTY   21100068
211100                                              + NW-STR-OTR-QTY (L)21110068
211200                 END-IF                                           21120068
211300                                                                  21130068
211400                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        21140068
211500                     MOVE PV-TEMP-OTR-QTY    TO NW-ALLOC-UNITS (L)21150068
211600                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  21160068
211700                                              - PV-TEMP-OTR-QTY   21170068
211800                     MOVE ZEROES             TO NW-STR-OTR-QTY (L)21180068
211900                 ELSE                                             21190068
212000                     MOVE PV-LEFT-TO-ALLOC   TO NW-ALLOC-UNITS (L)21200068
212100                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  21210068
212200                                                NW-STR-OTR-QTY (L)21220068
212300                 END-IF                                           21230068
212400             END-IF                                               21240068
212500         END-PERFORM                                              21250068
212600                                                                  21260068
212700         MOVE ZEROES TO PV-NW-STR-OTR                             21270068
212800     END-IF.                                                      21280068
212900                                                                  21290068
213000**********************                                            21300068
213100*CENTRAL STOCK STORES*                                            21310068
213200*IF C-S STORES EXIST, FILL TO OTR (DO NOT GIVE ANY OVERAGE)       21320068
213300**********************                                            21330068
213400     IF PV-CS-STR-OTR > ZEROES                                    21340068
213500         PERFORM                                                  21350068
213600           VARYING L FROM 1 BY 1                                  21360068
213700             UNTIL L > PV-MAX-STORES                              21370068
213800                                                                  21380068
213900             IF CS-STR-OTR-QTY (L) > ZEROES                       21390068
214000*ROUND STORE OTR UP TO THE NEXT PACK                              21400068
214100                 DIVIDE CS-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    21410068
214200                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    21420068
214300                 IF PV-REMAINDER > 0                              21430068
214400                     ADD 1 TO PV-TEMP-OTR-QTY                     21440068
214500                 END-IF                                           21450068
214600                                                                  21460068
214700                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        21470068
214800                                         * PV-DISPERSAL-QTY       21480068
214900                                                                  21490068
215000*CALC OVERAGE QUANTITY.                                           21500068
215100                 IF PV-TEMP-OTR-QTY > CS-STR-OTR-QTY (L)          21510068
215200                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    21520068
215300                                              - PV-TEMP-OTR-QTY   21530068
215400                                              + CS-STR-OTR-QTY (L)21540068
215500                 END-IF                                           21550068
215600                                                                  21560068
215700                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        21570068
215800                     MOVE PV-TEMP-OTR-QTY    TO CS-ALLOC-UNITS (L)21580068
215900                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  21590068
216000                                              - PV-TEMP-OTR-QTY   21600068
216100                     MOVE ZEROES             TO CS-STR-OTR-QTY (L)21610068
216200                 ELSE                                             21620068
216300                     MOVE PV-LEFT-TO-ALLOC   TO CS-ALLOC-UNITS (L)21630068
216400                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  21640068
216500                                                CS-STR-OTR-QTY (L)21650068
216600                 END-IF                                           21660068
216700             END-IF                                               21670068
216800         END-PERFORM                                              21680068
216900                                                                  21690068
217000         MOVE ZEROES TO PV-CS-STR-OTR                             21700068
217100     END-IF.                                                      21710068
217200                                                                  21720068
217300*****************                                                 21730068
217400*EXISTING STORES*                                                 21740068
217500*IF EXISTING STORES EXIST, FILL TO OTR (THEN PRORATE OVERAGE).    21750068
217600*****************                                                 21760068
217700     IF PV-RG-STR-OTR > ZEROES                                    21770068
217800         PERFORM                                                  21780068
217900           VARYING L FROM 1 BY 1                                  21790068
218000             UNTIL L > PV-MAX-STORES                              21800068
218100                                                                  21810068
218200             IF RG-STR-OTR-QTY (L) > ZEROES                       21820068
218300*ROUND STORE OTR UP TO THE NEXT PACK                              21830068
218400                 DIVIDE RG-STR-OTR-QTY (L) BY PV-DISPERSAL-QTY    21840068
218500                 GIVING PV-TEMP-OTR-QTY REMAINDER PV-REMAINDER    21850068
218600                 IF PV-REMAINDER > 0                              21860068
218700                     ADD 1 TO PV-TEMP-OTR-QTY                     21870068
218800                 END-IF                                           21880068
218900                                                                  21890068
219000                 COMPUTE PV-TEMP-OTR-QTY = PV-TEMP-OTR-QTY        21900068
219100                                         * PV-DISPERSAL-QTY       21910068
219200                                                                  21920068
219300*CALC OVERAGE QUANTITY.                                           21930068
219400                 IF PV-TEMP-OTR-QTY > RG-STR-OTR-QTY (L)          21940068
219500                     COMPUTE PV-OVERAGE-QTY   = PV-OVERAGE-QTY    21950068
219600                                              - PV-TEMP-OTR-QTY   21960068
219700                                              + RG-STR-OTR-QTY (L)21970068
219800                 END-IF                                           21980068
219900                                                                  21990068
220000                 IF PV-TEMP-OTR-QTY NOT > PV-LEFT-TO-ALLOC        22000068
220100                     MOVE PV-TEMP-OTR-QTY    TO RG-ALLOC-UNITS (L)22010068
220200                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  22020068
220300                                              - PV-TEMP-OTR-QTY   22030068
220400                     MOVE ZEROES             TO RG-STR-OTR-QTY (L)22040068
220500                 ELSE                                             22050068
220600                     MOVE PV-LEFT-TO-ALLOC   TO RG-ALLOC-UNITS (L)22060068
220700                     MOVE ZEROES             TO PV-LEFT-TO-ALLOC  22070068
220800                                                RG-STR-OTR-QTY (L)22080068
220900                 END-IF                                           22090068
221000             END-IF                                               22100068
221100         END-PERFORM                                              22110068
221200                                                                  22120068
221300         MOVE ZEROES TO PV-RG-STR-OTR                             22130068
221400     END-IF.                                                      22140068
221500                                                                  22150068
221600*************                                                     22160068
221700*OVERAGE QTY*                                                     22170068
221800*************                                                     22180068
221900*LOAD EXISTING STORES, SORT, PRORATE & RESET STORE TABLES.        22190068
222000     IF PV-RG-STR-CNT > ZEROES                                    22200068
222100       AND PV-LEFT-TO-ALLOC > ZEROES                              22210068
222200         PERFORM 5400-LOAD-RG-TO-WK                               22220068
222300*JPL     PERFORM 2100-SORT-BY-SALES                               22230069
222400         PERFORM 6400-SORT-BY-PLAN                                22240068
222500         PERFORM 3200-ASSIGN-TIER-OTR                             22250068
222600         PERFORM 4100-CALC-ALLOC-PCT                              22260068
222700         PERFORM 4200-ALLOC-OVRG-PCT                              22270068
222800         PERFORM 5500-LOAD-WK-TO-RG                               22280068
222900     END-IF.                                                      22290068
223000                                                                  22300068
223100*IF NEW STORES EXIST & NO EXISTING STORES EXIST,                  22310068
223200*DISPERSE OVERAGE UNTIL ALL GONE.                                 22320068
223300     IF PV-NW-STR-CNT > ZEROES                                    22330068
223400       AND PV-RG-STR-CNT NOT > ZEROES                             22340068
223500       AND PV-LEFT-TO-ALLOC > ZEROES                              22350068
223600                                                                  22360068
223700         PERFORM 5100-LOAD-NW-TO-WK                               22370068
223800                                                                  22380068
223900         PERFORM                                                  22390068
224000           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    22400068
224100             PERFORM 2400-ALLOC-OVRG-TO-NW                        22410068
224200         END-PERFORM                                              22420068
224300                                                                  22430068
224400         PERFORM 5300-LOAD-WK-TO-NW                               22440068
224500     END-IF.                                                      22450068
224600                                                                  22460068
224700*IF CENTRAL-STOCK STORES EXIST & NO NEW OR EXISTING STORES EXIST, 22470068
224800*DISPERSE OVERAGE UNTIL ALL GONE.                                 22480068
224900     IF PV-CS-STR-CNT > ZEROES                                    22490068
225000       AND PV-RG-STR-CNT NOT > ZEROES                             22500068
225100       AND PV-LEFT-TO-ALLOC > ZEROES                              22510068
225200                                                                  22520068
225300         PERFORM 5600-LOAD-CS-TO-WK                               22530068
225400                                                                  22540068
225500         PERFORM                                                  22550068
225600           UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                    22560068
225700             PERFORM 2600-ALLOC-OVRG-TO-CS                        22570068
225800         END-PERFORM                                              22580068
225900                                                                  22590068
226000         PERFORM 5700-LOAD-WK-TO-CS                               22600068
226100     END-IF.                                                      22610068
226200                                                                  22620068
226300******************************************************************22630068
226400 4100-CALC-ALLOC-PCT.                                             22640068
226500     MOVE '4100-CALC-ALLOC-PCT           ' TO RC001-PARAGRAPH.    22650068
226600                                                                  22660068
226700*CALC PERCENTAGE OF ORIGINAL ALLOCATION (OF EXISTING STORES ONLY).22670068
226800     PERFORM                                                      22680068
226900       VARYING L FROM 1 BY 1                                      22690068
227000         UNTIL WK-STR-NBR (L) NOT > ZEROES                        22700068
227100                                                                  22710068
227200         IF WK-STR-PLAN-QTY (L) > ZEROES                          22720068
227300             COMPUTE WK-STR-ALLOC-PCT (L) = (WK-STR-PLAN-QTY (L)  22730068
227400                                          / PV-TOT-PLAN-QTY)      22740068
227500                                          * 100                   22750068
227600         ELSE                                                     22760068
227700             MOVE ZEROES TO WK-STR-ALLOC-PCT (L)                  22770068
227800         END-IF                                                   22780068
227900                                                                  22790068
228000     END-PERFORM.                                                 22800068
228100                                                                  22810068
228200******************************************************************22820068
228300* COMPARE OVRG QTY TO NBR OF STORES IN OTR TIER.                  22830068
228400* IF OVRG QTY NOT < NBR OF TIER STORES, ALLOC ON PCT.             22840068
228500* IF OVRG QTY < NBR OF TIER STORES, CALL RANDOM ROUTINE.          22850068
228600******************************************************************22860068
228700 4200-ALLOC-OVRG-PCT.                                             22870068
228800     MOVE '4200-ALLOC-OVRG-PCT           ' TO RC001-PARAGRAPH.    22880068
228900                                                                  22890068
229000     MOVE WK-STR-TIER (1) TO PV-COMPARE-TIER.                     22900068
229100     MOVE PV-OVERAGE-QTY TO PV-ALLOC-QTY-ACCUM.                   22910068
229200                                                                  22920068
229300*LOOP THROUGH STORE TIERS ASSIGNING OVRG QTY BASED ON PCT.        22930068
229400     PERFORM                                                      22940068
229500       UNTIL PV-OVERAGE-QTY NOT > ZEROES                          22950068
229600                                                                  22960068
229700         PERFORM 4210-ACCUM-TIER-QTY                              22970068
229800                                                                  22980068
229900         IF PV-DISPERSAL-QTY > 1                                  22990068
230000             COMPUTE PV-UNITS-NEEDED = PV-ACCUM-TIER-STORES       23000068
230100                                     * PV-DISPERSAL-QTY           23010068
230200         ELSE                                                     23020068
230300             MOVE PV-ACCUM-TIER-STORES TO PV-UNITS-NEEDED         23030068
230400         END-IF                                                   23040068
230500                                                                  23050068
230600         IF PV-OVERAGE-QTY < PV-UNITS-NEEDED                      23060068
230700             PERFORM 4230-ALLOC-OVRG-TIER-PARTIAL                 23070068
230800         ELSE                                                     23080068
230900             PERFORM 4220-ALLOC-OVRG-TIER                         23090068
231000             COMPUTE PV-COMPARE-TIER = PV-COMPARE-TIER + 1        23100068
231100             IF PV-COMPARE-TIER > PV-STR-TIER-COUNT               23110068
231200                 MOVE 1 TO PV-COMPARE-TIER                        23120068
231300             END-IF                                               23130068
231400         END-IF                                                   23140068
231500     END-PERFORM.                                                 23150068
231600                                                                  23160068
231700******************************************************************23170068
231800 4210-ACCUM-TIER-QTY.                                             23180068
231900     MOVE '4210-ACCUM-TIER-QTY           ' TO RC001-PARAGRAPH.    23190068
232000                                                                  23200068
232100     MOVE ZEROES TO PV-ACCUM-TIER-STORES.                         23210068
232200                                                                  23220068
232300     PERFORM                                                      23230068
232400       VARYING L FROM 1 BY 1                                      23240068
232500         UNTIL L > PV-MAX-STORES                                  23250068
232600            OR WK-STR-NBR (L) NOT > ZEROES                        23260068
232700                                                                  23270068
232800*ONLY ACCUM FOR SAME TIER STORES (NEVER CENTRAL STOCK)            23280068
232900         IF WK-STR-NBR (L) > ZEROES                               23290068
233000           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  23300068
233100           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     23310068
233200                                                                  23320068
233300*CALC PCT-QTY = (ALLOC-PCT * TOT-OVRG) / 100                      23330068
233400             COMPUTE PV-PCT-QTY ROUNDED =                         23340068
233500                     (WK-STR-ALLOC-PCT (L)                        23350068
233600                   * PV-ALLOC-QTY-ACCUM) / 100                    23360068
233700                                                                  23370068
233800*DIVIDE PCT-QTY BY DISPERSAL QTY.                                 23380068
233900             DIVIDE PV-PCT-QTY BY PV-DISPERSAL-QTY                23390068
234000             GIVING PV-ALLOC-QTY                                  23400068
234100             REMAINDER PV-REMAINDER                               23410068
234200                                                                  23420068
234300*ROUND ALLOCATION QTY.                                            23430068
234400             IF PV-ALLOC-QTY > ZEROES                             23440068
234500                 PERFORM 7225-ROUND-ALLOC-PCT                     23450068
234600             END-IF                                               23460068
234700                                                                  23470068
234800*PRORATE AT LEAST ONE UNIT                                        23480068
234900             IF PV-ALLOC-QTY NOT > ZEROES                         23490068
235000                 MOVE 1 TO PV-ALLOC-QTY                           23500068
235100             END-IF                                               23510068
235200                                                                  23520068
235300             ADD PV-ALLOC-QTY TO PV-ACCUM-TIER-STORES             23530068
235400         END-IF                                                   23540068
235500     END-PERFORM.                                                 23550068
235600                                                                  23560068
235700******************************************************************23570068
235800 4220-ALLOC-OVRG-TIER.                                            23580068
235900     MOVE '4220-ALLOC-OVRG-TIER          ' TO RC001-PARAGRAPH.    23590068
236000                                                                  23600068
236100     PERFORM                                                      23610068
236200       VARYING L FROM 1 BY 1                                      23620068
236300         UNTIL L > PV-MAX-STORES                                  23630068
236400            OR WK-STR-NBR (L) NOT > ZEROES                        23640068
236500                                                                  23650068
236600*ONLY ACCUM FOR SAME TIER STORES (NEVER CENTRAL STOCK)            23660068
236700         IF WK-STR-NBR (L) > ZEROES                               23670068
236800           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  23680068
236900           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     23690068
237000                                                                  23700068
237100*CALC PCT-QTY = (ALLOC-PCT * TOT-OVRG) / 100                      23710068
237200             COMPUTE PV-PCT-QTY ROUNDED =                         23720068
237300                     (WK-STR-ALLOC-PCT (L)                        23730068
237400                   * PV-ALLOC-QTY-ACCUM) / 100                    23740068
237500                                                                  23750068
237600*DIVIDE PCT-QTY BY DISPERSAL QTY                                  23760068
237700             DIVIDE PV-PCT-QTY BY PV-DISPERSAL-QTY                23770068
237800             GIVING PV-ALLOC-QTY                                  23780068
237900             REMAINDER PV-REMAINDER                               23790068
238000                                                                  23800068
238100*ROUND ALLOCATION QTY.                                            23810068
238200             IF PV-ALLOC-QTY > ZEROES                             23820068
238300                 PERFORM 7225-ROUND-ALLOC-PCT                     23830068
238400             END-IF                                               23840068
238500                                                                  23850068
238600*PRORATE AT LEAST ONE UNIT.                                       23860068
238700             IF PV-ALLOC-QTY NOT > ZEROES                         23870068
238800                 MOVE 1 TO PV-ALLOC-QTY                           23880068
238900             END-IF                                               23890068
239000                                                                  23900068
239100*PRORATE IN MULTIPLES OF THE DISPERSAL QTY.                       23910068
239200             MULTIPLY PV-ALLOC-QTY BY PV-DISPERSAL-QTY            23920068
239300             GIVING PV-ALLOC-QTY                                  23930068
239400                                                                  23940068
239500*ALLOCATE OVERAGE QTY BASED ON PERCENTAGE OF ORIGINAL ALLOCATION. 23950068
239600             IF PV-ALLOC-QTY > ZEROES                             23960068
239700                 ADD      PV-ALLOC-QTY   TO WK-ALLOC-UNITS (L)    23970068
239800                 SUBTRACT PV-ALLOC-QTY FROM PV-LEFT-TO-ALLOC      23980068
239900                                            PV-OVERAGE-QTY        23990068
240000             END-IF                                               24000068
240100         END-IF                                                   24010068
240200     END-PERFORM.                                                 24020068
240300                                                                  24030068
240400******************************************************************24040068
240500 4230-ALLOC-OVRG-TIER-PARTIAL.                                    24050068
240600     MOVE '4230-ALLOC-OVRG-TIER-PARTIAL  ' TO RC001-PARAGRAPH.    24060068
240700                                                                  24070068
240800     MOVE ZEROES TO RC825-RANDOM-STR-SEL-CNT                      24080099
240900                    RC825-RANDOM-SEL-MAX.                         24090099
241000                                                                  24100068
241100     PERFORM 4240-LOAD-TIER-STORES.                               24110068
241200                                                                  24120068
241300*ROUND UP STORES TO BE RANDOM PICKED IF FRACTION.                 24130068
241400     COMPUTE PV-RANDOM-STR-SEL-CNT = (PV-OVERAGE-QTY              24140068
241500                                   / PV-DISPERSAL-QTY)            24150068
241600                                   / PV-ALLOC-QTY.                24160068
241700     IF PV-RANDOM-STR-SEL-REM > ZERO                              24170068
241800         ADD 1 TO PV-RANDOM-STR-SEL-QTY                           24180068
241900     END-IF.                                                      24190068
242000     MOVE PV-RANDOM-STR-SEL-QTY                                   24200068
242100       TO RC825-RANDOM-STR-SEL-CNT.                               24210099
242200                                                                  24220068
242300     PERFORM 9000-CALL-RANDOM.                                    24230068
242400                                                                  24240068
242500     IF RC825-NO-ERRORS                                           24250099
242600         PERFORM 4250-ALLOC-RANDOM-STORES                         24260068
242700     ELSE                                                         24270068
242800         SET PS-DONE-YES   TO TRUE                                24280068
242900         MOVE SPACES       TO TM501-TM500-RETURN-MSG              24290068
243000         MOVE '4230'       TO TM501-PARA                          24300068
                                    TM007-RETURNED-PARA                 24301099
243100         MOVE '824'        TO TM501-PGM                           24310068
243200         MOVE SQLCODE      TO TM500-SQLCODE                       24320068
243200                              TM007-SQLCODE                       24321099
243300         MOVE SQLCA        TO TM500-SQLCA                         24330068
243300                              TM007-SQLCA                         24331099
243400         MOVE 81           TO TM501-PRORATION-ERROR-NBR           24340068
243500         PERFORM TM501-SET-TM500-RETURN-MSG                       24350068
               MOVE TM500-RETURN-DATA                                   24361099
                                 TO TM007-RETURN-DATA                   24362099
243600         PERFORM RC001-RETURN-MSG                                 24363099
243700     END-IF.                                                      24370068
243800                                                                  24380068
243900******************************************************************24390068
244000 4240-LOAD-TIER-STORES.                                           24400068
244100     MOVE '4240-LOAD-TIER-STORES         ' TO RC001-PARAGRAPH.    24410068
244200                                                                  24420068
244300     MOVE 1 TO M.                                                 24430068
244400     PERFORM                                                      24440068
244500       VARYING L FROM 1 BY 1                                      24450068
244600         UNTIL L > PV-MAX-STORES                                  24460068
244700                                                                  24470068
244800         INITIALIZE RC825-STORE-TABLE (M)                         24480099
244900                                                                  24490068
245000         IF WK-STR-NBR (L) > ZEROES                               24500068
245100           AND WK-STR-TIER (L) = PV-COMPARE-TIER                  24510068
245200           AND WK-ST-TYPE-CODE (L) NOT = 'CS'                     24520068
245300                                                                  24530068
245400             MOVE WK-STR-NBR (L) TO RC825-STORE-NUMBER (M)        24540099
245500             MOVE 'N'            TO RC825-STORE-RANDOM-IND (M)    24550099
245600                                                                  24560068
245700             ADD 1 TO RC825-RANDOM-SEL-MAX                        24570099
245800             ADD 1 TO M                                           24580068
245900         END-IF                                                   24590068
246000     END-PERFORM.                                                 24600068
246100                                                                  24610068
246200******************************************************************24620068
246300 4250-ALLOC-RANDOM-STORES.                                        24630068
246400     MOVE '4250-ALLOC-RANDOM-STORES      ' TO RC001-PARAGRAPH.    24640068
246500                                                                  24650068
246600*LOOP THRU RC825-RANDOM-STORE-NBR                                 24660099
246700     PERFORM                                                      24670068
246800       VARYING L FROM 1 BY 1                                      24680068
246900         UNTIL L > PV-MAX-STORES                                  24690068
247000                                                                  24700068
247100         IF RC825-RANDOM-STORE-NBR (L) > ZEROES                   24710099
247200             PERFORM 4255-MATCH-STORE                             24720068
247300         END-IF                                                   24730068
247400     END-PERFORM.                                                 24740068
247500                                                                  24750068
247600******************************************************************24760068
247700 4255-MATCH-STORE.                                                24770068
247800     MOVE '4255-MATCH-STORE              ' TO RC001-PARAGRAPH.    24780068
247900                                                                  24790068
248000     SET PS-RANDOM-STR-MATCH-NO TO TRUE.                          24800068
248100*MATCH RC825-RANDOM-STORE-NBR (L) TO WK-STR-NBR (M)               24810099
248200     PERFORM                                                      24820068
248300       VARYING M FROM 1 BY 1                                      24830068
248400         UNTIL M > PV-MAX-STORES                                  24840068
248500            OR PS-RANDOM-STR-MATCH-YES                            24850068
248600                                                                  24860068
248700         IF RC825-RANDOM-STORE-NBR (L) = WK-STR-NBR (M)           24870099
248800             PERFORM 4256-ALLOC-MATCH-STORE                       24880068
248900         END-IF                                                   24890068
249000                                                                  24900068
249100         IF M = PV-MAX-STORES                                     24910068
249200             MOVE '  ==> RANDOM STORE NOT FOUND IN TIER - '       24920068
249300                                             TO RC001-SPECIAL-1   24930068
249400             MOVE RC825-RANDOM-STORE-NBR (L) TO RC001-SPECIAL-2   24940099
249500             SET PS-DONE-YES TO TRUE                              24950068
249600             MOVE SPACES     TO TM501-TM500-RETURN-MSG            24960068
249700             MOVE '4255'     TO TM501-PARA                        24970068
                                      TM007-RETURNED-PARA               24971099
249800             MOVE '824'      TO TM501-PGM                         24980068
249900             MOVE SQLCODE    TO TM500-SQLCODE                     24990068
249900                                TM007-SQLCODE                     24991099
250000             MOVE SQLCA      TO TM500-SQLCA                       25000068
250000                                TM007-SQLCA                       25001099
250100             MOVE 98         TO TM501-PRORATION-ERROR-NBR         25010068
250200             PERFORM TM501-SET-TM500-RETURN-MSG                   25020068
                   MOVE TM500-RETURN-DATA                               25031099
                                   TO TM007-RETURN-DATA                 25032099
250300             PERFORM RC001-RETURN-MSG                             25033099
250400         END-IF                                                   25040068
250500     END-PERFORM.                                                 25050068
250600                                                                  25060068
250700******************************************************************25070068
250800 4256-ALLOC-MATCH-STORE.                                          25080068
250900     MOVE '4256-ALLOC-MATCH-STORE        ' TO RC001-PARAGRAPH.    25090068
251000                                                                  25100068
251100*ALLOCATE 'PCT QTY' TO WK-STR-NBR (M)                             25110068
251200     COMPUTE PV-PCT-QTY ROUNDED = (WK-STR-ALLOC-PCT (M)           25120068
251300                                * PV-ALLOC-QTY-ACCUM) / 100.      25130068
251400                                                                  25140068
251500*DIVIDE PCT-QTY BY DISPERSAL QTY                                  25150068
251600     DIVIDE PV-PCT-QTY BY PV-DISPERSAL-QTY                        25160068
251700     GIVING PV-ALLOC-QTY                                          25170068
251800     REMAINDER PV-REMAINDER.                                      25180068
251900                                                                  25190068
252000*ROUND ALLOCATION QTY.                                            25200068
252100     IF PV-ALLOC-QTY > ZEROES                                     25210068
252200         PERFORM 7225-ROUND-ALLOC-PCT                             25220068
252300     END-IF.                                                      25230068
252400                                                                  25240068
252500*PRORATE AT LEAST ONE UNIT                                        25250068
252600     IF PV-ALLOC-QTY NOT > ZEROES                                 25260068
252700         MOVE 1 TO PV-ALLOC-QTY                                   25270068
252800     END-IF.                                                      25280068
252900                                                                  25290068
253000*PRORATE IN MULTIPLES OF THE DISPERSAL QTY.                       25300068
253100     MULTIPLY PV-ALLOC-QTY BY PV-DISPERSAL-QTY                    25310068
253200     GIVING PV-ALLOC-QTY.                                         25320068
253300                                                                  25330068
253400*ALLOCATE OVERAGE QTY BASED ON PERCENTAGE OF ORIGINAL ALLOCATION. 25340068
253500     IF PV-ALLOC-QTY < PV-OVERAGE-QTY                             25350068
253600         ADD      PV-ALLOC-QTY   TO WK-ALLOC-UNITS (M)            25360068
253700         SUBTRACT PV-ALLOC-QTY FROM PV-OVERAGE-QTY                25370068
253800                                    PV-LEFT-TO-ALLOC              25380068
253900     ELSE                                                         25390068
254000         ADD      PV-OVERAGE-QTY   TO WK-ALLOC-UNITS (M)          25400068
254100         SUBTRACT PV-OVERAGE-QTY FROM PV-OVERAGE-QTY              25410068
254200                                      PV-LEFT-TO-ALLOC            25420068
254300     END-IF.                                                      25430068
254400                                                                  25440068
254500     SET PS-RANDOM-STR-MATCH-YES TO TRUE.                         25450068
254600                                                                  25460068
254700******************************************************************25470068
254800*                                                                *25480068
254900*           S H O R T A G E   -   S A L E S   R A N K            *25490068
255000*                                                                *25500068
255100*    FILL SEQUENCE:                                              *25510068
255200*        1) NEW STORES (UP TO OTR)                               *25520068
255300*        2) EXISTING STORES (UP TO OTR)                          *25530068
255400*        3) CENTRAL STOCK STORES (UP TO OTR)                     *25540068
255500*                                                                *25550068
255600*    SORT STORES                                                 *25560068
255700*      - BEST TO WORST BASED ON SALES                            *25570068
255800*                                                                *25580068
255900*    PRORATION                                                   *25590068
256000*      - DISTRIBUTE IN 'DISPERSAL QTYS'                          *25600068
256100*      - FILL-IN 100% TO OTR                                     *25610068
256200*      - FILL-IN UNTIL UNITS RUN OUT                             *25620068
256300*                                                                *25630068
256400******************************************************************25640068
256500 5000-SALES-RANK-SHORT.                                           25650068
256600     MOVE '5000-SALES-RANK-SHORT         ' TO RC001-PARAGRAPH.    25660068
256700                                                                  25670068
256800************                                                      25680068
256900*NEW STORES*                                                      25690068
257000************                                                      25700068
257100*IF NEW STORES EXIST,                                             25710068
257200*IF OTR < ALLOCATION, MOVE OTR TO DISTRIBUTION QTY                25720068
257300*ELSE LOAD NEW STORES, SORT & ALLOCATE.                           25730068
257400     IF PV-NW-STR-OTR > ZEROES                                    25740068
257500         IF PV-LEFT-TO-ALLOC > PV-NW-STR-OTR                      25750068
257600             PERFORM                                              25760068
257700               VARYING L FROM 1 BY 1                              25770068
257800                 UNTIL L > PV-MAX-STORES                          25780068
257900                                                                  25790068
258000                 MOVE NW-STR-OTR-QTY (L) TO NW-ALLOC-UNITS (L)    25800068
258100                 COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC      25810068
258200                                          - NW-STR-OTR-QTY (L)    25820068
258300                 MOVE ZEROES             TO NW-STR-OTR-QTY (L)    25830068
258400             END-PERFORM                                          25840068
258500             MOVE ZEROES TO PV-NW-STR-OTR                         25850068
258600         ELSE                                                     25860068
258700*MOVE NEW STORE TABLE TO WORK TABLE.                              25870068
258800             PERFORM 5100-LOAD-NW-TO-WK                           25880068
258900*SORT STORES BY SALES RANK.                                       25890068
259000             PERFORM 2100-SORT-BY-SALES                           25900068
259100*ALLOCATE UNITS (FILL TO OTR) UNTIL GONE.                         25910068
259200             PERFORM 5200-ALLOC-SHORT-SR                          25920068
259300*MOVE WORK TABLE BACK TO NEW STORE TABLE.                         25930068
259400             PERFORM 5300-LOAD-WK-TO-NW                           25940068
259500         END-IF                                                   25950068
259600     END-IF.                                                      25960068
259700                                                                  25970068
259800*****************                                                 25980068
259900*EXISTING STORES*                                                 25990068
260000*****************                                                 26000068
260100*LOAD EXISTING STORES, SORT, ALLOCATE & RESET STORE TABLES.       26010068
260200     IF PV-LEFT-TO-ALLOC > ZEROES                                 26020068
260300       AND PV-RG-STR-OTR > ZEROES                                 26030068
260400         PERFORM 5400-LOAD-RG-TO-WK                               26040068
260500         PERFORM 2100-SORT-BY-SALES                               26050068
260600         PERFORM 5200-ALLOC-SHORT-SR                              26060068
260700         PERFORM 5500-LOAD-WK-TO-RG                               26070068
260800     END-IF.                                                      26080068
260900                                                                  26090068
261000**********************                                            26100068
261100*CENTRAL STOCK STORES*                                            26110068
261200**********************                                            26120068
261300*PROCESS CENTRAL STOCK STORES.                                    26130068
261400     IF PV-LEFT-TO-ALLOC > ZEROES                                 26140068
261500       AND PV-CS-STR-OTR > ZEROES                                 26150068
261600         PERFORM 5600-LOAD-CS-TO-WK                               26160068
261700         PERFORM 2100-SORT-BY-SALES                               26170068
261800         PERFORM 5200-ALLOC-SHORT-SR                              26180068
261900         PERFORM 5700-LOAD-WK-TO-CS                               26190068
262000     END-IF.                                                      26200068
262100                                                                  26210068
262200******************************************************************26220068
262300 5100-LOAD-NW-TO-WK.                                              26230068
262400     MOVE '5100-LOAD-NW-TO-WK            ' TO RC001-PARAGRAPH.    26240068
262500                                                                  26250068
262600     INITIALIZE WS-STORE-TABLE-WRK.                               26260068
262700                                                                  26270068
262800     PERFORM                                                      26280068
262900       VARYING L FROM 1 BY 1                                      26290068
263000         UNTIL L > PV-MAX-STORES                                  26300068
263100                                                                  26310068
263200         MOVE NW-STR-NBR (L)        TO WK-STR-NBR (L)             26320068
263300         MOVE NW-ALLOC-LNE-NBR (L)  TO WK-ALLOC-LNE-NBR (L)       26330068
263400         MOVE NW-EXISTING-STORE-CDE (L)                           26340068
263500                                    TO WK-EXISTING-STORE-CDE (L)  26350068
263600         MOVE NW-ST-TYPE-CODE (L)   TO WK-ST-TYPE-CODE (L)        26360068
263700         MOVE NW-STR-PLAN-QTY (L)   TO WK-STR-PLAN-QTY (L)        26370068
263800         MOVE NW-STR-PLAN-PK (L)    TO WK-STR-PLAN-PK (L)         26380068
263900         MOVE NW-STR-PLAN-OTR-QTY (L)                             26390068
264000                                    TO WK-STR-PLAN-OTR-QTY (L)    26400068
264100         MOVE NW-STR-PLAN-OTR-PK (L)                              26410068
264200                                    TO WK-STR-PLAN-OTR-PK (L)     26420068
264300         MOVE NW-STR-OTR-PK (L)     TO WK-STR-OTR-PK (L)          26430068
264400         MOVE NW-STR-OTR-QTY (L)    TO WK-STR-OTR-QTY (L)         26440068
264500         MOVE NW-STR-OTR-QTY-ORIG (L)                             26450068
264600                                    TO WK-STR-OTR-QTY-ORIG (L)    26460068
264700         MOVE NW-RNK-SEQ-NBR (L)    TO WK-RNK-SEQ-NBR (L)         26470068
264800         MOVE NW-STR-TIER (L)       TO WK-STR-TIER (L)            26480068
264900         MOVE NW-ALLOC-UNITS (L)    TO WK-ALLOC-UNITS (L)         26490068
265000         MOVE NW-STR-ALLOC-PCT (L)  TO WK-STR-ALLOC-PCT (L)       26500068
265100     END-PERFORM.                                                 26510068
265200                                                                  26520068
265300     MOVE PV-NW-STR-OTR TO PV-WK-STR-OTR.                         26530068
265400                                                                  26540068
265500******************************************************************26550068
265600 5110-LOAD-NW-NP-TO-WK.                                           26560068
265700     MOVE '5110-LOAD-NW-NP-TO-WK         ' TO RC001-PARAGRAPH.    26570068
265800                                                                  26580068
265900     INITIALIZE WS-STORE-TABLE-WRK.                               26590068
266000     MOVE ZEROES TO PV-WK-STR-OTR.                                26600068
266100                                                                  26610068
266200     MOVE 1 TO M.                                                 26620068
266300     PERFORM                                                      26630068
266400       VARYING L FROM 1 BY 1                                      26640068
266500         UNTIL L > PV-MAX-STORES                                  26650068
266600                                                                  26660068
266700         IF (NW-STR-NBR (L) > ZEROES)                             26670068
266800           AND (NW-ST-TYPE-CODE (L) NOT = 'CS')                   26680068
266900           AND (PV-DISPERSAL-QTY > NW-STR-PLAN-QTY (L)            26690068
267000                                 - NW-STR-OTR-QTY (L))            26700068
267100                                                                  26710068
267200             MOVE NW-STR-NBR (L)        TO WK-STR-NBR (M)         26720068
267300             MOVE NW-ALLOC-LNE-NBR (L)  TO WK-ALLOC-LNE-NBR (M)   26730068
267400             MOVE NW-EXISTING-STORE-CDE (L)                       26740068
267500                                    TO WK-EXISTING-STORE-CDE (M)  26750068
267600             MOVE NW-ST-TYPE-CODE (L)   TO WK-ST-TYPE-CODE (M)    26760068
267700             MOVE NW-STR-PLAN-QTY (L)   TO WK-STR-PLAN-QTY (M)    26770068
267800             MOVE NW-STR-PLAN-PK (L)    TO WK-STR-PLAN-PK (M)     26780068
267900             MOVE NW-STR-PLAN-OTR-QTY (L)                         26790068
268000                                    TO WK-STR-PLAN-OTR-QTY (M)    26800068
268100             MOVE NW-STR-PLAN-OTR-PK (L)                          26810068
268200                                    TO WK-STR-PLAN-OTR-PK (M)     26820068
268300             MOVE NW-STR-OTR-PK (L)     TO WK-STR-OTR-PK (M)      26830068
268400             MOVE NW-STR-OTR-QTY (L)    TO WK-STR-OTR-QTY (M)     26840068
268500             COMPUTE PV-WK-STR-OTR   = PV-WK-STR-OTR              26850068
268600                                     + WK-STR-OTR-QTY (M)         26860068
268700             MOVE NW-STR-OTR-QTY-ORIG (L)                         26870068
268800                                        TO WK-STR-OTR-QTY-ORIG (M)26880068
268900             MOVE NW-RNK-SEQ-NBR (L)    TO WK-RNK-SEQ-NBR (M)     26890068
269000             MOVE NW-STR-TIER (L)       TO WK-STR-TIER (M)        26900068
269100             MOVE NW-ALLOC-UNITS (L)    TO WK-ALLOC-UNITS (M)     26910068
269200             MOVE NW-STR-ALLOC-PCT (L)  TO WK-STR-ALLOC-PCT (M)   26920068
269300                                                                  26930068
269400             ADD 1 TO M                                           26940068
269500                                                                  26950068
269600         END-IF                                                   26960068
269700     END-PERFORM.                                                 26970068
269800                                                                  26980068
269900******************************************************************26990068
270000 5200-ALLOC-SHORT-SR.                                             27000068
270100     MOVE '5200-ALLOC-SHORT-SR           ' TO RC001-PARAGRAPH.    27010068
270200                                                                  27020068
270300     PERFORM                                                      27030068
270400       VARYING L FROM 1 BY 1                                      27040068
270500         UNTIL L > PV-MAX-STORES                                  27050068
270600            OR PV-LEFT-TO-ALLOC NOT > ZEROES                      27060068
270700                                                                  27070068
270800         IF WK-STR-NBR (L) > ZEROES                               27080068
270900           AND WK-STR-OTR-QTY (L) > ZEROES                        27090068
271000                                                                  27100068
271100             IF PV-LEFT-TO-ALLOC < WK-STR-OTR-QTY (L)             27110068
271200                 MOVE PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)    27120068
271300                 SUBTRACT PV-LEFT-TO-ALLOC                        27130068
271400                                       FROM WK-STR-OTR-QTY (L)    27140068
271500                                            PV-WK-STR-OTR         27150068
271600                 MOVE ZEROES             TO PV-LEFT-TO-ALLOC      27160068
271700             ELSE                                                 27170068
271800                 MOVE WK-STR-OTR-QTY (L) TO WK-ALLOC-UNITS (L)    27180068
271900                 SUBTRACT WK-STR-OTR-QTY (L)                      27190068
272000                                       FROM PV-LEFT-TO-ALLOC      27200068
272100                                            PV-WK-STR-OTR         27210068
272200                 MOVE ZEROES             TO WK-STR-OTR-QTY (L)    27220068
272300             END-IF                                               27230068
272400         END-IF                                                   27240068
272500     END-PERFORM.                                                 27250068
272600                                                                  27260068
272700******************************************************************27270068
272800 5300-LOAD-WK-TO-NW.                                              27280068
272900     MOVE '5300-LOAD-WK-TO-NW            ' TO RC001-PARAGRAPH.    27290068
273000                                                                  27300068
273100     INITIALIZE WS-STORE-TABLE-NEW.                               27310068
273200                                                                  27320068
273300     PERFORM                                                      27330068
273400       VARYING L FROM 1 BY 1                                      27340068
273500         UNTIL L > PV-MAX-STORES                                  27350068
273600                                                                  27360068
273700         MOVE WK-STR-NBR (L)        TO NW-STR-NBR (L)             27370068
273800         MOVE WK-ALLOC-LNE-NBR (L)  TO NW-ALLOC-LNE-NBR (L)       27380068
273900         MOVE WK-EXISTING-STORE-CDE (L)                           27390068
274000                                    TO NW-EXISTING-STORE-CDE (L)  27400068
274100         MOVE WK-ST-TYPE-CODE (L)   TO NW-ST-TYPE-CODE (L)        27410068
274200         MOVE WK-STR-PLAN-QTY (L)   TO NW-STR-PLAN-QTY (L)        27420068
274300         MOVE WK-STR-PLAN-PK (L)    TO NW-STR-PLAN-PK (L)         27430068
274400         MOVE WK-STR-PLAN-OTR-QTY (L)                             27440068
274500                                    TO NW-STR-PLAN-OTR-QTY (L)    27450068
274600         MOVE WK-STR-PLAN-OTR-PK (L)                              27460068
274700                                    TO NW-STR-PLAN-OTR-PK (L)     27470068
274800         MOVE WK-STR-OTR-PK (L)     TO NW-STR-OTR-PK (L)          27480068
274900         MOVE WK-STR-OTR-QTY (L)    TO NW-STR-OTR-QTY (L)         27490068
275000         MOVE WK-STR-OTR-QTY-ORIG (L)                             27500068
275100                                    TO NW-STR-OTR-QTY-ORIG (L)    27510068
275200         MOVE WK-RNK-SEQ-NBR (L)    TO NW-RNK-SEQ-NBR (L)         27520068
275300         MOVE WK-STR-TIER (L)       TO NW-STR-TIER (L)            27530068
275400         MOVE WK-ALLOC-UNITS (L)    TO NW-ALLOC-UNITS (L)         27540068
275500         MOVE WK-STR-ALLOC-PCT (L)  TO NW-STR-ALLOC-PCT (L)       27550068
275600     END-PERFORM.                                                 27560068
275700                                                                  27570068
275800     MOVE PV-WK-STR-OTR TO PV-NW-STR-OTR.                         27580068
275900                                                                  27590068
276000******************************************************************27600068
276100 5400-LOAD-RG-TO-WK.                                              27610068
276200     MOVE '5400-LOAD-RG-TO-WK            ' TO RC001-PARAGRAPH.    27620068
276300                                                                  27630068
276400     INITIALIZE WS-STORE-TABLE-WRK.                               27640068
276500                                                                  27650068
276600     PERFORM                                                      27660068
276700       VARYING L FROM 1 BY 1                                      27670068
276800         UNTIL L > PV-MAX-STORES                                  27680068
276900                                                                  27690068
277000         MOVE RG-STR-NBR (L)        TO WK-STR-NBR (L)             27700068
277100         MOVE RG-ALLOC-LNE-NBR (L)  TO WK-ALLOC-LNE-NBR (L)       27710068
277200         MOVE RG-EXISTING-STORE-CDE (L)                           27720068
277300                                    TO WK-EXISTING-STORE-CDE (L)  27730068
277400         MOVE RG-ST-TYPE-CODE (L)   TO WK-ST-TYPE-CODE (L)        27740068
277500         MOVE RG-STR-PLAN-QTY (L)   TO WK-STR-PLAN-QTY (L)        27750068
277600         MOVE RG-STR-PLAN-PK (L)    TO WK-STR-PLAN-PK (L)         27760068
277700         MOVE RG-STR-PLAN-OTR-QTY (L)                             27770068
277800                                    TO WK-STR-PLAN-OTR-QTY (L)    27780068
277900         MOVE RG-STR-PLAN-OTR-PK (L)                              27790068
278000                                    TO WK-STR-PLAN-OTR-PK (L)     27800068
278100         MOVE RG-STR-OTR-PK (L)     TO WK-STR-OTR-PK (L)          27810068
278200         MOVE RG-STR-OTR-QTY (L)    TO WK-STR-OTR-QTY (L)         27820068
278300         MOVE RG-STR-OTR-QTY-ORIG (L)                             27830068
278400                                    TO WK-STR-OTR-QTY-ORIG (L)    27840068
278500         MOVE RG-RNK-SEQ-NBR (L)    TO WK-RNK-SEQ-NBR (L)         27850068
278600         MOVE RG-STR-TIER (L)       TO WK-STR-TIER (L)            27860068
278700         MOVE RG-ALLOC-UNITS (L)    TO WK-ALLOC-UNITS (L)         27870068
278800         MOVE RG-STR-ALLOC-PCT (L)  TO WK-STR-ALLOC-PCT (L)       27880068
278900     END-PERFORM.                                                 27890068
279000                                                                  27900068
279100     MOVE PV-RG-STR-OTR TO PV-WK-STR-OTR.                         27910068
279200                                                                  27920068
279300******************************************************************27930068
279400 5410-LOAD-RG-NP-TO-WK.                                           27940068
279500     MOVE '5410-LOAD-RG-NP-TO-WK         ' TO RC001-PARAGRAPH.    27950068
279600                                                                  27960068
279700     INITIALIZE WS-STORE-TABLE-WRK.                               27970068
279800     MOVE ZEROES TO PV-WK-STR-OTR.                                27980068
279900                                                                  27990068
280000     MOVE 1 TO M.                                                 28000068
280100     PERFORM                                                      28010068
280200       VARYING L FROM 1 BY 1                                      28020068
280300         UNTIL L > PV-MAX-STORES                                  28030068
280400                                                                  28040068
280500         IF (RG-STR-NBR (L) > ZEROES)                             28050068
280600           AND (RG-ST-TYPE-CODE (L) NOT = 'CS')                   28060068
280700           AND (PV-DISPERSAL-QTY > RG-STR-PLAN-QTY (L)            28070068
280800                                 - RG-STR-OTR-QTY (L))            28080068
280900                                                                  28090068
281000             MOVE RG-STR-NBR (L)        TO WK-STR-NBR (M)         28100068
281100             MOVE RG-ALLOC-LNE-NBR (L)  TO WK-ALLOC-LNE-NBR (M)   28110068
281200             MOVE RG-EXISTING-STORE-CDE (L)                       28120068
281300                                    TO WK-EXISTING-STORE-CDE (M)  28130068
281400             MOVE RG-ST-TYPE-CODE (L)   TO WK-ST-TYPE-CODE (M)    28140068
281500             MOVE RG-STR-PLAN-QTY (L)   TO WK-STR-PLAN-QTY (M)    28150068
281600             MOVE RG-STR-PLAN-PK (L)    TO WK-STR-PLAN-PK (M)     28160068
281700             MOVE RG-STR-PLAN-OTR-QTY (L)                         28170068
281800                                    TO WK-STR-PLAN-OTR-QTY (M)    28180068
281900             MOVE RG-STR-PLAN-OTR-PK (L)                          28190068
282000                                    TO WK-STR-PLAN-OTR-PK (M)     28200068
282100             MOVE RG-STR-OTR-PK (L)     TO WK-STR-OTR-PK (M)      28210068
282200             MOVE RG-STR-OTR-QTY (L)    TO WK-STR-OTR-QTY (M)     28220068
282300             COMPUTE PV-WK-STR-OTR   = PV-WK-STR-OTR              28230068
282400                                     + WK-STR-OTR-QTY (M)         28240068
282500             MOVE RG-STR-OTR-QTY-ORIG (L)                         28250068
282600                                        TO WK-STR-OTR-QTY-ORIG (M)28260068
282700             MOVE RG-RNK-SEQ-NBR (L)    TO WK-RNK-SEQ-NBR (M)     28270068
282800             MOVE RG-STR-TIER (L)       TO WK-STR-TIER (M)        28280068
282900             MOVE RG-ALLOC-UNITS (L)    TO WK-ALLOC-UNITS (M)     28290068
283000             MOVE RG-STR-ALLOC-PCT (L)  TO WK-STR-ALLOC-PCT (M)   28300068
283100                                                                  28310068
283200             ADD 1 TO M                                           28320068
283300                                                                  28330068
283400         END-IF                                                   28340068
283500     END-PERFORM.                                                 28350068
283600                                                                  28360068
283700******************************************************************28370068
283800 5500-LOAD-WK-TO-RG.                                              28380068
283900     MOVE '5500-LOAD-WK-TO-RG            ' TO RC001-PARAGRAPH.    28390068
284000                                                                  28400068
284100     INITIALIZE WS-STORE-TABLE-REG.                               28410068
284200                                                                  28420068
284300     PERFORM                                                      28430068
284400       VARYING L FROM 1 BY 1                                      28440068
284500         UNTIL L > PV-MAX-STORES                                  28450068
284600                                                                  28460068
284700         MOVE WK-STR-NBR (L)        TO RG-STR-NBR (L)             28470068
284800         MOVE WK-ALLOC-LNE-NBR (L)  TO RG-ALLOC-LNE-NBR (L)       28480068
284900         MOVE WK-EXISTING-STORE-CDE (L)                           28490068
285000                                    TO RG-EXISTING-STORE-CDE (L)  28500068
285100         MOVE WK-ST-TYPE-CODE (L)   TO RG-ST-TYPE-CODE (L)        28510068
285200         MOVE WK-STR-PLAN-QTY (L)   TO RG-STR-PLAN-QTY (L)        28520068
285300         MOVE WK-STR-PLAN-PK (L)    TO RG-STR-PLAN-PK (L)         28530068
285400         MOVE WK-STR-PLAN-OTR-QTY (L)                             28540068
285500                                    TO RG-STR-PLAN-OTR-QTY (L)    28550068
285600         MOVE WK-STR-PLAN-OTR-PK (L)                              28560068
285700                                    TO RG-STR-PLAN-OTR-PK (L)     28570068
285800         MOVE WK-STR-OTR-PK (L)     TO RG-STR-OTR-PK (L)          28580068
285900         MOVE WK-STR-OTR-QTY (L)    TO RG-STR-OTR-QTY (L)         28590068
286000         MOVE WK-STR-OTR-QTY-ORIG (L)                             28600068
286100                                    TO RG-STR-OTR-QTY-ORIG (L)    28610068
286200         MOVE WK-RNK-SEQ-NBR (L)    TO RG-RNK-SEQ-NBR (L)         28620068
286300         MOVE WK-STR-TIER (L)       TO RG-STR-TIER (L)            28630068
286400         MOVE WK-ALLOC-UNITS (L)    TO RG-ALLOC-UNITS (L)         28640068
286500         MOVE WK-STR-ALLOC-PCT (L)  TO RG-STR-ALLOC-PCT (L)       28650068
286600     END-PERFORM.                                                 28660068
286700                                                                  28670068
286800     MOVE PV-WK-STR-OTR TO PV-RG-STR-OTR.                         28680068
286900                                                                  28690068
287000******************************************************************28700068
287100 5600-LOAD-CS-TO-WK.                                              28710068
287200     MOVE '5600-LOAD-CS-TO-WK            ' TO RC001-PARAGRAPH.    28720068
287300                                                                  28730068
287400     INITIALIZE WS-STORE-TABLE-WRK.                               28740068
287500                                                                  28750068
287600     PERFORM                                                      28760068
287700       VARYING L FROM 1 BY 1                                      28770068
287800         UNTIL L > PV-MAX-STORES                                  28780068
287900                                                                  28790068
288000         MOVE CS-STR-NBR (L)        TO WK-STR-NBR (L)             28800068
288100         MOVE CS-ALLOC-LNE-NBR (L)  TO WK-ALLOC-LNE-NBR (L)       28810068
288200         MOVE CS-EXISTING-STORE-CDE (L)                           28820068
288300                                    TO WK-EXISTING-STORE-CDE (L)  28830068
288400         MOVE CS-ST-TYPE-CODE (L)   TO WK-ST-TYPE-CODE (L)        28840068
288500         MOVE CS-STR-PLAN-QTY (L)   TO WK-STR-PLAN-QTY (L)        28850068
288600         MOVE CS-STR-PLAN-PK (L)    TO WK-STR-PLAN-PK (L)         28860068
288700         MOVE CS-STR-PLAN-OTR-QTY (L)                             28870068
288800                                    TO WK-STR-PLAN-OTR-QTY (L)    28880068
288900         MOVE CS-STR-PLAN-OTR-PK (L)                              28890068
289000                                    TO WK-STR-PLAN-OTR-PK (L)     28900068
289100         MOVE CS-STR-OTR-PK (L)     TO WK-STR-OTR-PK (L)          28910068
289200         MOVE CS-STR-OTR-QTY (L)    TO WK-STR-OTR-QTY (L)         28920068
289300         MOVE CS-STR-OTR-QTY-ORIG (L)                             28930068
289400                                    TO WK-STR-OTR-QTY-ORIG (L)    28940068
289500         MOVE CS-RNK-SEQ-NBR (L)    TO WK-RNK-SEQ-NBR (L)         28950068
289600         MOVE CS-STR-TIER (L)       TO WK-STR-TIER (L)            28960068
289700         MOVE CS-ALLOC-UNITS (L)    TO WK-ALLOC-UNITS (L)         28970068
289800         MOVE CS-STR-ALLOC-PCT (L)  TO WK-STR-ALLOC-PCT (L)       28980068
289900     END-PERFORM.                                                 28990068
290000                                                                  29000068
290100     MOVE PV-CS-STR-OTR TO PV-WK-STR-OTR.                         29010068
290200                                                                  29020068
290300******************************************************************29030068
290400 5700-LOAD-WK-TO-CS.                                              29040068
290500     MOVE '5700-LOAD-WK-TO-CS            ' TO RC001-PARAGRAPH.    29050068
290600                                                                  29060068
290700     INITIALIZE WS-STORE-TABLE-CS.                                29070068
290800                                                                  29080068
290900     PERFORM                                                      29090068
291000       VARYING L FROM 1 BY 1                                      29100068
291100         UNTIL L > PV-MAX-STORES                                  29110068
291200                                                                  29120068
291300         MOVE WK-STR-NBR (L)        TO CS-STR-NBR (L)             29130068
291400         MOVE WK-ALLOC-LNE-NBR (L)  TO CS-ALLOC-LNE-NBR (L)       29140068
291500         MOVE WK-EXISTING-STORE-CDE (L)                           29150068
291600                                    TO CS-EXISTING-STORE-CDE (L)  29160068
291700         MOVE WK-ST-TYPE-CODE (L)   TO CS-ST-TYPE-CODE (L)        29170068
291800         MOVE WK-STR-PLAN-QTY (L)   TO CS-STR-PLAN-QTY (L)        29180068
291900         MOVE WK-STR-PLAN-PK (L)    TO CS-STR-PLAN-PK (L)         29190068
292000         MOVE WK-STR-PLAN-OTR-QTY (L)                             29200068
292100                                    TO CS-STR-PLAN-OTR-QTY (L)    29210068
292200         MOVE WK-STR-PLAN-OTR-PK (L)                              29220068
292300                                    TO CS-STR-PLAN-OTR-PK (L)     29230068
292400         MOVE WK-STR-OTR-PK (L)     TO CS-STR-OTR-PK (L)          29240068
292500         MOVE WK-STR-OTR-QTY (L)    TO CS-STR-OTR-QTY (L)         29250068
292600         MOVE WK-STR-OTR-QTY-ORIG (L)                             29260068
292700                                    TO CS-STR-OTR-QTY-ORIG (L)    29270068
292800         MOVE WK-RNK-SEQ-NBR (L)    TO CS-RNK-SEQ-NBR (L)         29280068
292900         MOVE WK-STR-TIER (L)       TO CS-STR-TIER (L)            29290068
293000         MOVE WK-ALLOC-UNITS (L)    TO CS-ALLOC-UNITS (L)         29300068
293100         MOVE WK-STR-ALLOC-PCT (L)  TO CS-STR-ALLOC-PCT (L)       29310068
293200     END-PERFORM.                                                 29320068
293300                                                                  29330068
293400     MOVE PV-WK-STR-OTR TO PV-CS-STR-OTR.                         29340068
293500                                                                  29350068
293600******************************************************************29360068
293700*                                                                *29370068
293800*          S H O R T A G E   -   O T R   F I L L - I N           *29380068
293900*                                                                *29390068
294000*    FILL SEQUENCE:                                              *29400068
294100*        1) NEW STORES (UP TO OTR)                               *29410068
294200*        2) EXISTING STORES (UP TO OTR)                          *29420068
294300*        3) CENTRAL STOCK STORES (UP TO OTR)                     *29430068
294400*                                                                *29440068
294500*    IF RECEIVED QTY SUFFICIENT TO GIVE AT LEAST 1               *29450068
294600*    INNER PACK TO EVERY STORE WITH AN OTR ON THE PO             *29460068
294700*        SORT STORES                                             *29470068
294800*          - MOST OTR TO LEAST OTR QTY (BASED ON PLAN)           *29480068
294900*          - BEST TO WORST BASED ON SALES (SECONDARY SORT)       *29490068
295000*        PRORATION                                               *29500068
295100*          - GIVE 1 INNER PACK TO EVERY STORE WITH AN ALLOCATION *29510068
295200*          - FILL-IN UNTIL UNITS RUN OUT                         *29520068
295300*    ELSE                                                        *29530068
295400*        CALL RANDOM ROUTINE (RCKCS825) TO DETERMINE             *29540068
295500*        WHICH STORES RECEIVE ALLOCATIONS.                       *29550068
295600*                                                                *29560068
295700******************************************************************29570068
295800 6000-FILL-IN-SHORT.                                              29580068
295900     MOVE '6000-FILL-IN-SHORT            ' TO RC001-PARAGRAPH.    29590068
296000                                                                  29600068
296100************                                                      29610068
296200*NEW STORES*                                                      29620068
296300************                                                      29630068
296400     IF PV-NW-STR-OTR > ZEROES                                    29640068
296500                                                                  29650068
296600*IF LEFT TO ALLOC > OTR, JUST FILL OTR QTYS.                      29660068
296700         IF PV-LEFT-TO-ALLOC > PV-NW-STR-OTR                      29670068
296800             PERFORM                                              29680068
296900               VARYING L FROM 1 BY 1                              29690068
297000                 UNTIL L > PV-MAX-STORES                          29700068
297100                                                                  29710068
297200                 MOVE NW-STR-OTR-QTY (L) TO NW-ALLOC-UNITS (L)    29720068
297300                 COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC      29730068
297400                                          - NW-STR-OTR-QTY (L)    29740068
297500                 MOVE ZEROES             TO NW-STR-OTR-QTY (L)    29750068
297600             END-PERFORM                                          29760068
297700             MOVE ZEROES TO PV-NW-STR-OTR                         29770068
297800         ELSE                                                     29780068
297900*VERIFY EVERY NEW STORE CAN RECEIVE AT LEAST 1 INNER PACK QTY.    29790068
298000             MOVE ZEROES TO PV-NO-PACK-STR-CNT                    29800068
298100             PERFORM 6010-COUNT-NW-NO-PACK-STORES                 29810068
298200                                                                  29820068
298300             IF PV-DISPERSAL-QTY > 1                              29830068
298400                 COMPUTE PV-UNITS-NEEDED = PV-NO-PACK-STR-CNT     29840068
298500                                         * PV-DISPERSAL-QTY       29850068
298600             ELSE                                                 29860068
298700                 MOVE PV-NO-PACK-STR-CNT TO PV-UNITS-NEEDED       29870068
298800             END-IF                                               29880068
298900                                                                  29890068
299000*IF NO, CALL RANDOM ROUTINE TO DETERMINE STORE ALLOCATIONS.       29900068
299100             IF PV-LEFT-TO-ALLOC < PV-UNITS-NEEDED                29910068
299200                 PERFORM 5110-LOAD-NW-NP-TO-WK                    29920068
299300                 PERFORM 6100-LOAD-WK-TO-RANDOM                   29930068
299400                                                                  29940068
299500                 COMPUTE PV-RANDOM-STR-SEL-CNT = PV-LEFT-TO-ALLOC 29950068
299600                                               / PV-DISPERSAL-QTY 29960068
299700                 IF PV-RANDOM-STR-SEL-REM > ZERO                  29970068
299800                     ADD 1 TO PV-RANDOM-STR-SEL-QTY               29980068
299900                 END-IF                                           29990068
300000                 MOVE PV-RANDOM-STR-SEL-QTY                       30000068
300100                   TO RC825-RANDOM-STR-SEL-CNT                    30010099
300200                                                                  30020068
300300                 MOVE PV-NO-PACK-STR-CNT TO RC825-RANDOM-SEL-MAX  30030099
300400                                                                  30040068
300500                 PERFORM 9000-CALL-RANDOM                         30050068
300600                 IF RC825-NO-ERRORS                               30060099
300700                     PERFORM 5100-LOAD-NW-TO-WK                   30070068
300800                     PERFORM 6200-ASSIGN-UNITS                    30080068
300900                 ELSE                                             30090068
301000                     SET PS-DONE-YES TO TRUE                      30100068
301100                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    30110068
301200                     MOVE '6000'     TO TM501-PARA                30120068
                                              TM007-RETURNED-PARA       30121099
301300                     MOVE '824'      TO TM501-PGM                 30130068
301400                     MOVE SQLCODE    TO TM500-SQLCODE             30140068
301400                                        TM007-SQLCODE             30141099
301500                     MOVE SQLCA      TO TM500-SQLCA               30150068
301500                                        TM007-SQLCA               30151099
301600                     MOVE 82         TO TM501-PRORATION-ERROR-NBR 30160068
301700                     PERFORM TM501-SET-TM500-RETURN-MSG           30170068
                           MOVE TM500-RETURN-DATA                       30181099
                                           TO TM007-RETURN-DATA         30182099
301800                     PERFORM RC001-RETURN-MSG                     30183099
301900                 END-IF                                           30190068
302000                 PERFORM 5300-LOAD-WK-TO-NW                       30200068
302100                                                                  30210068
302200             ELSE                                                 30220068
302300*IF YES, FILL NEW STORES UNTIL ALLOCATION OR OTR GONE.            30230068
302400                 PERFORM 5100-LOAD-NW-TO-WK                       30240068
302500*JPL             PERFORM 2100-SORT-BY-SALES                       30250068
302600                 PERFORM 3100-SORT-BY-OTR                         30260068
302700                 PERFORM 7100-ALLOC-1-INNER-QTY                   30270068
302800                 PERFORM 3100-SORT-BY-OTR                         30280069
302900                 PERFORM 6300-ALLOC-SHORT-FILL                    30290068
303000                 PERFORM 5300-LOAD-WK-TO-NW                       30300068
303100             END-IF                                               30310068
303200         END-IF                                                   30320068
303300     END-IF.                                                      30330068
303400                                                                  30340068
303500*****************                                                 30350068
303600*EXISTING STORES*                                                 30360068
303700*****************                                                 30370068
303800     IF PV-LEFT-TO-ALLOC > ZEROES                                 30380068
303900       AND PV-RG-STR-OTR > ZEROES                                 30390068
304000                                                                  30400068
304100*IF LEFT TO ALLOC > OTR, JUST FILL OTR QTYS.                      30410068
304200         IF PV-LEFT-TO-ALLOC > PV-RG-STR-OTR                      30420068
304300             PERFORM                                              30430068
304400               VARYING L FROM 1 BY 1                              30440068
304500                 UNTIL L > PV-MAX-STORES                          30450068
304600                                                                  30460068
304700                 MOVE RG-STR-OTR-QTY (L) TO RG-ALLOC-UNITS (L)    30470068
304800                 COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC      30480068
304900                                          - RG-STR-OTR-QTY (L)    30490068
305000                 MOVE ZEROES             TO RG-STR-OTR-QTY (L)    30500068
305100             END-PERFORM                                          30510068
305200             MOVE ZEROES TO PV-RG-STR-OTR                         30520068
305300         ELSE                                                     30530068
305400*VERIFY EVERY NO-PACK STORE CAN RECEIVE AT LEAST 1 INNER PACK QTY 30540068
305500             MOVE ZEROES TO PV-NO-PACK-STR-CNT                    30550068
305600             PERFORM 6020-COUNT-RG-NO-PACK-STORES                 30560068
305700                                                                  30570068
305800             IF PV-DISPERSAL-QTY > 1                              30580068
305900                 COMPUTE PV-UNITS-NEEDED = PV-NO-PACK-STR-CNT     30590068
306000                                         * PV-DISPERSAL-QTY       30600068
306100             ELSE                                                 30610068
306200                 MOVE PV-NO-PACK-STR-CNT TO PV-UNITS-NEEDED       30620068
306300             END-IF                                               30630068
306400                                                                  30640068
306500*IF NO, CALL RANDOM ROUTINE TO DETERMINE STORE ALLOCATIONS.       30650068
306600             IF PV-LEFT-TO-ALLOC < PV-UNITS-NEEDED                30660068
306700                 PERFORM 5410-LOAD-RG-NP-TO-WK                    30670068
306800                 PERFORM 6100-LOAD-WK-TO-RANDOM                   30680068
306900                                                                  30690068
307000                                                                  30700068
307100                 COMPUTE PV-RANDOM-STR-SEL-CNT =                  30710068
307200                         PV-LEFT-TO-ALLOC                         30720068
307300                       / PV-DISPERSAL-QTY                         30730068
307400                 IF PV-RANDOM-STR-SEL-REM > ZERO                  30740068
307500                     ADD 1 TO PV-RANDOM-STR-SEL-QTY               30750068
307600                 END-IF                                           30760068
307700                 MOVE PV-RANDOM-STR-SEL-QTY                       30770068
307800                   TO RC825-RANDOM-STR-SEL-CNT                    30780099
307900                                                                  30790068
308000                 MOVE PV-NO-PACK-STR-CNT TO RC825-RANDOM-SEL-MAX  30800099
308100                                                                  30810068
308200                 PERFORM 9000-CALL-RANDOM                         30820068
308300                 IF RC825-NO-ERRORS                               30830099
308400                     PERFORM 5400-LOAD-RG-TO-WK                   30840068
308500                     PERFORM 6200-ASSIGN-UNITS                    30850068
308600                 ELSE                                             30860068
308700                     SET PS-DONE-YES TO TRUE                      30870068
308800                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    30880068
308900                     MOVE '6000'     TO TM501-PARA                30890068
                                              TM007-RETURNED-PARA       30891099
309000                     MOVE '824'      TO TM501-PGM                 30900068
309100                     MOVE SQLCODE    TO TM500-SQLCODE             30910068
309100                                        TM007-SQLCODE             30911099
309200                     MOVE SQLCA      TO TM500-SQLCA               30920068
309200                                        TM007-SQLCA               30921099
309300                     MOVE 83         TO TM501-PRORATION-ERROR-NBR 30930068
309400                     PERFORM TM501-SET-TM500-RETURN-MSG           30940068
                           MOVE TM500-RETURN-DATA                       30951099
                                           TO TM007-RETURN-DATA         30952099
309500                     PERFORM RC001-RETURN-MSG                     30953099
309600                 END-IF                                           30960068
309700                 PERFORM 5500-LOAD-WK-TO-RG                       30970068
309800                                                                  30980068
309900             ELSE                                                 30990068
310000*LOAD EXISTING STORES, SORT, ALLOCATE & RESET STORE TABLES.       31000068
310100                 PERFORM 5400-LOAD-RG-TO-WK                       31010068
310200*JPL             PERFORM 2100-SORT-BY-SALES                       31020068
310300                 PERFORM 3100-SORT-BY-OTR                         31030068
310400                 PERFORM 7100-ALLOC-1-INNER-QTY                   31040068
310500                 PERFORM 3100-SORT-BY-OTR                         31050069
310600                 PERFORM 6300-ALLOC-SHORT-FILL                    31060068
310700                 PERFORM 5500-LOAD-WK-TO-RG                       31070068
310800             END-IF                                               31080068
310900         END-IF                                                   31090068
311000     END-IF.                                                      31100068
311100                                                                  31110068
311200**********************                                            31120068
311300*CENTRAL STOCK STORES*                                            31130068
311400**********************                                            31140068
311500*PROCESS CENTRAL STOCK STORES.                                    31150068
311600     IF PV-LEFT-TO-ALLOC > ZEROES                                 31160068
311700       AND PV-CS-STR-OTR > ZEROES                                 31170068
311800         PERFORM 5600-LOAD-CS-TO-WK                               31180068
311900*JPL     PERFORM 2100-SORT-BY-SALES                               31190068
312000         PERFORM 3100-SORT-BY-OTR                                 31200068
312100         PERFORM 7100-ALLOC-1-INNER-QTY                           31210068
312200         PERFORM 3100-SORT-BY-OTR                                 31220069
312300         PERFORM 6300-ALLOC-SHORT-FILL                            31230068
312400         PERFORM 5700-LOAD-WK-TO-CS                               31240068
312500     END-IF.                                                      31250068
312600                                                                  31260068
312700******************************************************************31270068
312800 6010-COUNT-NW-NO-PACK-STORES.                                    31280068
312900     MOVE '6010-COUNT-NW-NO-PACK-STORES  ' TO RC001-PARAGRAPH.    31290068
313000                                                                  31300068
313100     PERFORM                                                      31310068
313200       VARYING L FROM 1 BY 1                                      31320068
313300         UNTIL L > PV-MAX-STORES                                  31330068
313400                                                                  31340068
313500         IF (NW-STR-NBR (L) > ZEROES)                             31350068
313600           AND (NW-ST-TYPE-CODE (L) NOT = 'CS')                   31360068
313700                                                                  31370068
313800             IF PV-DISPERSAL-QTY > NW-STR-PLAN-QTY (L)            31380068
313900                                 - NW-STR-OTR-QTY (L)             31390068
314000                 ADD 1 TO PV-NO-PACK-STR-CNT                      31400068
314100             END-IF                                               31410068
314200                                                                  31420068
314300         END-IF                                                   31430068
314400     END-PERFORM.                                                 31440068
314500                                                                  31450068
314600******************************************************************31460068
314700 6020-COUNT-RG-NO-PACK-STORES.                                    31470068
314800     MOVE '6020-COUNT-RG-NO-PACK-STORES  ' TO RC001-PARAGRAPH.    31480068
314900                                                                  31490068
315000     PERFORM                                                      31500068
315100       VARYING L FROM 1 BY 1                                      31510068
315200         UNTIL L > PV-MAX-STORES                                  31520068
315300                                                                  31530068
315400         IF (RG-STR-NBR (L) > ZEROES)                             31540068
315500           AND (RG-ST-TYPE-CODE (L) NOT = 'CS')                   31550068
315600                                                                  31560068
315700             IF PV-DISPERSAL-QTY > RG-STR-PLAN-QTY (L)            31570068
315800                                 - RG-STR-OTR-QTY (L)             31580068
315900                 ADD 1 TO PV-NO-PACK-STR-CNT                      31590068
316000             END-IF                                               31600068
316100                                                                  31610068
316200         END-IF                                                   31620068
316300     END-PERFORM.                                                 31630068
316400                                                                  31640068
316500******************************************************************31650068
316600 6100-LOAD-WK-TO-RANDOM.                                          31660068
316700     MOVE '6100-LOAD-WK-TO-RANDOM        ' TO RC001-PARAGRAPH.    31670068
316800                                                                  31680068
316900     PERFORM                                                      31690068
317000       VARYING L FROM 1 BY 1                                      31700068
317100         UNTIL L > PV-MAX-STORES                                  31710068
317200                                                                  31720068
317300         INITIALIZE RC825-STORE-TABLE (L)                         31730099
317400                                                                  31740068
317500         IF WK-STR-NBR (L) > ZEROES                               31750068
317600             MOVE WK-STR-NBR (L) TO RC825-STORE-NUMBER (L)        31760099
317700             MOVE 'N'            TO RC825-STORE-RANDOM-IND (L)    31770099
317800         END-IF                                                   31780068
317900                                                                  31790068
318000     END-PERFORM.                                                 31800068
318100                                                                  31810068
318200******************************************************************31820068
318300 6200-ASSIGN-UNITS.                                               31830068
318400     MOVE '6200-ASSIGN-UNITS             ' TO RC001-PARAGRAPH.    31840068
318500                                                                  31850068
318600*LOOP THRU RC825-RANDOM-STORE-NBR                                 31860099
318700     PERFORM                                                      31870068
318800       VARYING L FROM 1 BY 1                                      31880068
318900         UNTIL L > PV-MAX-STORES                                  31890068
319000                                                                  31900068
319100         IF RC825-RANDOM-STORE-NBR (L) > ZEROES                   31910099
319200             PERFORM 6210-MATCH-STORE                             31920068
319300         END-IF                                                   31930068
319400     END-PERFORM.                                                 31940068
319500                                                                  31950068
319600******************************************************************31960068
319700 6210-MATCH-STORE.                                                31970068
319800     MOVE '6210-MATCH-STORE              ' TO RC001-PARAGRAPH.    31980068
319900                                                                  31990068
320000     SET PS-RANDOM-STR-MATCH-NO TO TRUE.                          32000068
320100*MATCH RC825-RANDOM-STORE-NBR (L) TO WK-STR-NBR (M)               32010099
320200*ALLOCATE 1 UNIT TO WK-STR-NBR (L)                                32020068
320300     PERFORM                                                      32030068
320400       VARYING M FROM 1 BY 1                                      32040068
320500         UNTIL M > PV-MAX-STORES                                  32050068
320600            OR PS-RANDOM-STR-MATCH-YES                            32060068
320700                                                                  32070068
320800         IF RC825-RANDOM-STORE-NBR (L) = WK-STR-NBR (M)           32080099
320900             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               32090068
321000                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (M)32100068
321100                 SUBTRACT PV-LEFT-TO-ALLOC FROM WK-STR-OTR-QTY (M)32110068
321200                                                PV-LEFT-TO-ALLOC  32120068
321300                                                PV-WK-STR-OTR     32130068
321400             ELSE                                                 32140068
321500                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (M)32150068
321600                 SUBTRACT PV-DISPERSAL-QTY FROM WK-STR-OTR-QTY (M)32160068
321700                                                PV-LEFT-TO-ALLOC  32170068
321800                                                PV-WK-STR-OTR     32180068
321900             END-IF                                               32190068
322000             SET PS-RANDOM-STR-MATCH-YES TO TRUE                  32200068
322100         END-IF                                                   32210068
322200                                                                  32220068
322300         IF M = PV-MAX-STORES                                     32230068
322400             MOVE '  ==> RANDOM STORE NOT FOUND IN TIER - '       32240068
322500                                             TO RC001-SPECIAL-1   32250068
322600             MOVE RC825-RANDOM-STORE-NBR (L) TO RC001-SPECIAL-2   32260099
322700             SET PS-DONE-YES TO TRUE                              32270068
322800             MOVE SPACES     TO TM501-TM500-RETURN-MSG            32280068
322900             MOVE '6210'     TO TM501-PARA                        32290068
                                      TM007-RETURNED-PARA               32291099
323000             MOVE '824'      TO TM501-PGM                         32300068
323100             MOVE SQLCODE    TO TM500-SQLCODE                     32310068
323100                                TM007-SQLCODE                     32311099
323200             MOVE SQLCA      TO TM500-SQLCA                       32320068
323200                                TM007-SQLCA                       32321099
323300             MOVE 99         TO TM501-PRORATION-ERROR-NBR         32330068
323400             PERFORM TM501-SET-TM500-RETURN-MSG                   32340068
                   MOVE TM500-RETURN-DATA                               32351099
                                   TO TM007-RETURN-DATA                 32352099
323500             PERFORM RC001-RETURN-MSG                             32353099
323600         END-IF                                                   32360068
323700                                                                  32370068
323800     END-PERFORM.                                                 32380068
323900                                                                  32390068
324000******************************************************************32400068
324100 6300-ALLOC-SHORT-FILL.                                           32410068
324200     MOVE '6300-ALLOC-SHORT-FILL         ' TO RC001-PARAGRAPH.    32420068
324300                                                                  32430068
324400     MOVE 1 TO L.                                                 32440068
324500                                                                  32450068
324600     PERFORM                                                      32460068
324700       UNTIL PV-LEFT-TO-ALLOC NOT > ZEROES                        32470068
324800                                                                  32480068
324900         IF WK-STR-NBR (L) > ZEROES                               32490068
325000           AND WK-STR-OTR-QTY (L) > ZEROES                        32500068
325100                                                                  32510068
325200             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               32520068
325300                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)32530068
325400                 SUBTRACT PV-LEFT-TO-ALLOC FROM WK-STR-OTR-QTY (L)32540068
325500                                                PV-LEFT-TO-ALLOC  32550068
325600                                                PV-WK-STR-OTR     32560068
325700             ELSE                                                 32570068
325800                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (L)32580068
325900                 SUBTRACT PV-DISPERSAL-QTY FROM WK-STR-OTR-QTY (L)32590068
326000                                                PV-LEFT-TO-ALLOC  32600068
326100                                                PV-WK-STR-OTR     32610068
326200             END-IF                                               32620068
326300         END-IF                                                   32630068
326400                                                                  32640068
326500         IF WK-STR-NBR (L) = ZEROES                               32650068
326600           OR L = PV-MAX-STORES                                   32660068
326700             MOVE 1 TO L                                          32670068
326800         ELSE                                                     32680068
326900             ADD 1 TO L                                           32690068
327000         END-IF                                                   32700068
327100                                                                  32710068
327200     END-PERFORM.                                                 32720068
327300                                                                  32730068
327400******************************************************************32740068
327500 6400-SORT-BY-PLAN.                                               32750068
327600     MOVE '6400-SORT-BY-PLAN             ' TO RC001-PARAGRAPH.    32760068
327700                                                                  32770068
327800*SORT STORE TABLE (LARGEST TO SMALLEST - ALLOC QTY).              32780068
327900     MOVE 1 TO A.                                                 32790068
328000     PERFORM                                                      32800068
328100       UNTIL A > PV-MAX-STORES                                    32810068
328200          OR WK-STR-NBR (A) = ZEROES                              32820068
328300                                                                  32830068
328400         COMPUTE B = A + 1                                        32840068
328500         PERFORM 6410-SORT-BY-ALLOC                               32850068
328600           UNTIL B > PV-MAX-STORES                                32860068
328700              OR WK-STR-NBR (B) = ZEROES                          32870068
328800                                                                  32880068
328900         ADD 1 TO A                                               32890068
329000                                                                  32900068
329100     END-PERFORM.                                                 32910068
329200                                                                  32920068
329300*SORT STORE TABLE (WITHIN PLANNED OTR BY STORE RANK).             32930069
329400     MOVE 1 TO A.                                                 32940069
329500     PERFORM                                                      32950069
329600       UNTIL A > PV-MAX-STORES                                    32960069
329700          OR WK-STR-NBR (A) = ZEROES                              32970069
329800                                                                  32980069
329900         COMPUTE B = A + 1                                        32990069
330000         PERFORM 6420-SORT-BY-RANK                                33000069
330100           UNTIL B > PV-MAX-STORES                                33010069
330200              OR WK-STR-NBR (B) = ZEROES                          33020069
330300                                                                  33030069
330400         ADD 1 TO A                                               33040069
330500                                                                  33050069
330600     END-PERFORM.                                                 33060069
330700                                                                  33070069
330800******************************************************************33080069
330900 6410-SORT-BY-ALLOC.                                              33090068
331000     MOVE '6410-SORT-BY-ALLOC            ' TO RC001-PARAGRAPH.    33100068
331100                                                                  33110068
331200     IF WK-STR-PLAN-QTY (A) < WK-STR-PLAN-QTY (B)                 33120068
331300         MOVE WK-STORE-ENTRY (A)  TO WS-HOLD-STORE-TABLE          33130068
331400         MOVE WK-STORE-ENTRY (B)  TO WK-STORE-ENTRY (A)           33140068
331500         MOVE WS-HOLD-STORE-TABLE TO WK-STORE-ENTRY (B)           33150068
331600     END-IF.                                                      33160068
331700                                                                  33170068
331800     ADD 1 TO B.                                                  33180068
331900                                                                  33190068
332000******************************************************************33200068
332100 6420-SORT-BY-RANK.                                               33210069
332200                                                                  33220069
332300     IF WK-STR-PLAN-QTY (A) = WK-STR-PLAN-QTY (B)                 33230069
332400       AND WK-RNK-SEQ-NBR (A) > WK-RNK-SEQ-NBR (B)                33240069
332500         MOVE WK-STORE-ENTRY (A)  TO WS-HOLD-STORE-TABLE          33250069
332600         MOVE WK-STORE-ENTRY (B)  TO WK-STORE-ENTRY (A)           33260069
332700         MOVE WS-HOLD-STORE-TABLE TO WK-STORE-ENTRY (B)           33270069
332800     END-IF.                                                      33280069
332900                                                                  33290069
333000     ADD 1 TO B.                                                  33300069
333100                                                                  33310069
333200******************************************************************33320069
333300*                                                                *33330068
333400*        S H O R T A G E   -   O T R   S A L E S                 *33340068
333500*                                                                *33350068
333600*    FILL SEQUENCE:                                              *33360068
333700*        1) NEW STORES (UP TO OTR)                               *33370068
333800*        2) EXISTING STORES (UP TO OTR)                          *33380068
333900*        3) CENTRAL STOCK STORES (UP TO OTR)                     *33390068
334000*                                                                *33400068
334100*    IF RECEIVED QTY SUFFICIENT TO GIVE AT LEAST 1               *33410068
334200*    INNER PACK TO EVERY STORE WITH AN OTR ON THE PO             *33420068
334300*        SORT STORES                                             *33430068
334400*          - MOST OTR TO LEAST OTR QTY (BASED ON PLAN)           *33440068
334500*          - BEST TO WORST BASED ON SALES (SECONDARY SORT)       *33450068
334600*        PRORATION                                               *33460068
334700*          - GIVE 1 INNER PACK TO EVERY STORE WITH AN ALLOCATION *33470068
334800*          - RE-CALC OTR (TOTAL STORES & EACH STORE)             *33480068
334900*          - FILL-IN AS PERCENTAGE OF OTR                        *33490068
335000*    ELSE                                                        *33500068
335100*        CALL RANDOM ROUTINE (RCKCS825) TO DETERMINE             *33510068
335200*        WHICH STORES GET OTR SET TO ZERO.                       *33520068
335300*                                                                *33530068
335400******************************************************************33540068
335500 7000-SALES-SHORT.                                                33550068
335600     MOVE '7000-SALES-SHORT              ' TO RC001-PARAGRAPH.    33560068
335700                                                                  33570068
335800************                                                      33580068
335900*NEW STORES*                                                      33590068
336000************                                                      33600068
336100     IF PV-NW-STR-OTR > ZEROES                                    33610068
336200                                                                  33620068
336300*VERIFY EVERY NEW STORE CAN RECEIVE AT LEAST 1 INNER PACK QTY.    33630068
336400         MOVE ZEROES TO PV-NO-PACK-STR-CNT                        33640068
336500         PERFORM 6010-COUNT-NW-NO-PACK-STORES                     33650068
336600                                                                  33660068
336700         IF PV-DISPERSAL-QTY > 1                                  33670068
336800             COMPUTE PV-UNITS-NEEDED = PV-NO-PACK-STR-CNT         33680068
336900                                     * PV-DISPERSAL-QTY           33690068
337000         ELSE                                                     33700068
337100             MOVE PV-NO-PACK-STR-CNT TO PV-UNITS-NEEDED           33710068
337200         END-IF                                                   33720068
337300                                                                  33730068
337400*IF NO, CALL RANDOM ROUTINE TO DETERMINE STORE ALLOCATIONS.       33740068
337500         IF PV-LEFT-TO-ALLOC < PV-UNITS-NEEDED                    33750068
337600             PERFORM 5110-LOAD-NW-NP-TO-WK                        33760068
337700             PERFORM 6100-LOAD-WK-TO-RANDOM                       33770068
337800                                                                  33780068
337900             COMPUTE PV-RANDOM-STR-SEL-CNT = PV-LEFT-TO-ALLOC     33790068
338000                                           / PV-DISPERSAL-QTY     33800068
338100             IF PV-RANDOM-STR-SEL-REM > ZERO                      33810068
338200                 ADD 1 TO PV-RANDOM-STR-SEL-QTY                   33820068
338300             END-IF                                               33830068
338400             MOVE PV-RANDOM-STR-SEL-QTY                           33840068
338500               TO RC825-RANDOM-STR-SEL-CNT                        33850099
338600                                                                  33860068
338700             MOVE PV-NO-PACK-STR-CNT TO RC825-RANDOM-SEL-MAX      33870099
338800                                                                  33880068
338900             PERFORM 9000-CALL-RANDOM                             33890068
339000             IF RC825-NO-ERRORS                                   33900099
339100                 PERFORM 5100-LOAD-NW-TO-WK                       33910068
339200                 PERFORM 6200-ASSIGN-UNITS                        33920068
339300             ELSE                                                 33930068
339400                 SET PS-DONE-YES   TO TRUE                        33940068
339500                 MOVE SPACES       TO TM501-TM500-RETURN-MSG      33950068
339600                 MOVE '7000'       TO TM501-PARA                  33960068
                                            TM007-RETURNED-PARA         33961099
339700                 MOVE '824'        TO TM501-PGM                   33970068
339800                 MOVE SQLCODE      TO TM500-SQLCODE               33980068
339800                                      TM007-SQLCODE               33981099
339900                 MOVE SQLCA        TO TM500-SQLCA                 33990068
339900                                      TM007-SQLCA                 33991099
340000                 MOVE 84           TO TM501-PRORATION-ERROR-NBR   34000068
340100                 PERFORM TM501-SET-TM500-RETURN-MSG               34010068
                       MOVE TM500-RETURN-DATA                           34021099
                                         TO TM007-RETURN-DATA           34022099
340200                 PERFORM RC001-RETURN-MSG                         34023099
340300             END-IF                                               34030068
340400             PERFORM 5300-LOAD-WK-TO-NW                           34040068
340500         END-IF                                                   34050068
340600                                                                  34060068
340700*IF YES, SORT THE STORES & ALLOC UNITS (FILL-IN PCT).             34070068
340800         IF PV-LEFT-TO-ALLOC > PV-NW-STR-OTR                      34080068
340900             PERFORM                                              34090068
341000               VARYING L FROM 1 BY 1                              34100068
341100                 UNTIL L > PV-MAX-STORES                          34110068
341200                                                                  34120068
341300                 MOVE NW-STR-OTR-QTY (L) TO NW-ALLOC-UNITS (L)    34130068
341400                 COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC      34140068
341500                                          - NW-STR-OTR-QTY (L)    34150068
341600                 MOVE ZEROES             TO NW-STR-OTR-QTY (L)    34160068
341700             END-PERFORM                                          34170068
341800             MOVE ZEROES TO PV-NW-STR-OTR                         34180068
341900         ELSE                                                     34190068
342000             PERFORM 5100-LOAD-NW-TO-WK                           34200068
342100*JPL         PERFORM 2100-SORT-BY-SALES                           34210068
342200             PERFORM 3100-SORT-BY-OTR                             34220068
342300             PERFORM 7100-ALLOC-1-INNER-QTY                       34230068
342400             PERFORM 3100-SORT-BY-OTR                             34240069
342500             PERFORM 7200-ALLOC-SHORT-SALES                       34250068
342600             PERFORM 5300-LOAD-WK-TO-NW                           34260068
342700         END-IF                                                   34270068
342800     END-IF.                                                      34280068
342900                                                                  34290068
343000*****************                                                 34300068
343100*EXISTING STORES*                                                 34310068
343200*****************                                                 34320068
343300     IF PV-LEFT-TO-ALLOC > ZEROES                                 34330068
343400       AND PV-RG-STR-OTR > ZEROES                                 34340068
343500                                                                  34350068
343600*VERIFY EVERY EXISTING STORE CAN RECEIVE AT LEAST 1 INNER PACK QTY34360068
343700         MOVE ZEROES TO PV-NO-PACK-STR-CNT                        34370068
343800         PERFORM 6020-COUNT-RG-NO-PACK-STORES                     34380068
343900                                                                  34390068
344000         IF PV-DISPERSAL-QTY > 1                                  34400068
344100             COMPUTE PV-UNITS-NEEDED = PV-NO-PACK-STR-CNT         34410068
344200                                     * PV-DISPERSAL-QTY           34420068
344300         ELSE                                                     34430068
344400             MOVE PV-NO-PACK-STR-CNT TO PV-UNITS-NEEDED           34440068
344500         END-IF                                                   34450068
344600                                                                  34460068
344700*IF NO, CALL RANDOM ROUTINE TO DETERMINE STORE ALLOCATIONS.       34470068
344800         IF PV-LEFT-TO-ALLOC > ZEROES                             34480068
344900           AND PV-LEFT-TO-ALLOC < PV-UNITS-NEEDED                 34490068
345000             PERFORM 5410-LOAD-RG-NP-TO-WK                        34500068
345100             PERFORM 6100-LOAD-WK-TO-RANDOM                       34510068
345200                                                                  34520068
345300             COMPUTE PV-RANDOM-STR-SEL-CNT = PV-LEFT-TO-ALLOC     34530068
345400                                           / PV-DISPERSAL-QTY     34540068
345500             IF PV-RANDOM-STR-SEL-REM > ZERO                      34550068
345600                 ADD 1 TO PV-RANDOM-STR-SEL-QTY                   34560068
345700             END-IF                                               34570068
345800             MOVE PV-RANDOM-STR-SEL-QTY                           34580068
345900               TO RC825-RANDOM-STR-SEL-CNT                        34590099
346000                                                                  34600068
346100             MOVE PV-NO-PACK-STR-CNT TO RC825-RANDOM-SEL-MAX      34610099
346200                                                                  34620068
346300             PERFORM 9000-CALL-RANDOM                             34630068
346400             IF RC825-NO-ERRORS                                   34640099
346500                 PERFORM 5400-LOAD-RG-TO-WK                       34650068
346600                 PERFORM 6200-ASSIGN-UNITS                        34660068
346700             ELSE                                                 34670068
346800                 SET PS-DONE-YES   TO TRUE                        34680068
346900                 MOVE SPACES       TO TM501-TM500-RETURN-MSG      34690068
347000                 MOVE '7000'       TO TM501-PARA                  34700068
                                            TM007-RETURNED-PARA         34701099
347100                 MOVE '824'        TO TM501-PGM                   34710068
347200                 MOVE SQLCODE      TO TM500-SQLCODE               34720068
347200                                      TM007-SQLCODE               34721099
347300                 MOVE SQLCA        TO TM500-SQLCA                 34730068
347300                                      TM007-SQLCA                 34731099
347400                 MOVE 85           TO TM501-PRORATION-ERROR-NBR   34740068
347500                 PERFORM TM501-SET-TM500-RETURN-MSG               34750068
                       MOVE TM500-RETURN-DATA                           34761099
                                         TO TM007-RETURN-DATA           34762099
347600                 PERFORM RC001-RETURN-MSG                         34763099
347700             END-IF                                               34770068
347800             PERFORM 5500-LOAD-WK-TO-RG                           34780068
347900         END-IF                                                   34790068
348000                                                                  34800068
348100*LOAD EXISTING STORES, SORT, ALLOCATE & RESET STORE TABLES.       34810068
348200         IF PV-LEFT-TO-ALLOC > ZEROES                             34820068
348300             IF PV-LEFT-TO-ALLOC > PV-RG-STR-OTR                  34830068
348400                 PERFORM                                          34840068
348500                   VARYING L FROM 1 BY 1                          34850068
348600                     UNTIL L > PV-MAX-STORES                      34860068
348700                                                                  34870068
348800                     MOVE RG-STR-OTR-QTY (L) TO RG-ALLOC-UNITS (L)34880068
348900                     COMPUTE PV-LEFT-TO-ALLOC = PV-LEFT-TO-ALLOC  34890068
349000                                              - RG-STR-OTR-QTY (L)34900068
349100                     MOVE ZEROES             TO RG-STR-OTR-QTY (L)34910068
349200                 END-PERFORM                                      34920068
349300                 MOVE ZEROES TO PV-RG-STR-OTR                     34930068
349400             ELSE                                                 34940068
349500                 PERFORM 5400-LOAD-RG-TO-WK                       34950068
349600*JPL             PERFORM 2100-SORT-BY-SALES                       34960068
349700                 PERFORM 3100-SORT-BY-OTR                         34970068
349800                 PERFORM 7100-ALLOC-1-INNER-QTY                   34980068
349900                 PERFORM 3100-SORT-BY-OTR                         34990069
350000                 PERFORM 7200-ALLOC-SHORT-SALES                   35000068
350100                 PERFORM 5500-LOAD-WK-TO-RG                       35010068
350200             END-IF                                               35020068
350300         END-IF                                                   35030068
350400     END-IF.                                                      35040068
350500                                                                  35050068
350600**********************                                            35060068
350700*CENTRAL STOCK STORES*                                            35070068
350800**********************                                            35080068
350900*PROCESS CENTRAL STOCK STORES.                                    35090068
351000     IF PV-LEFT-TO-ALLOC > ZEROES                                 35100068
351100       AND PV-CS-STR-OTR > ZEROES                                 35110068
351200         PERFORM 5600-LOAD-CS-TO-WK                               35120068
351300*JPL     PERFORM 2100-SORT-BY-SALES                               35130068
351400         PERFORM 3100-SORT-BY-OTR                                 35140068
351500         PERFORM 7100-ALLOC-1-INNER-QTY                           35150068
351600         PERFORM 3100-SORT-BY-OTR                                 35160069
351700         PERFORM 7200-ALLOC-SHORT-SALES                           35170068
351800         PERFORM 5700-LOAD-WK-TO-CS                               35180068
351900     END-IF.                                                      35190068
352000                                                                  35200068
352100******************************************************************35210068
352200 7100-ALLOC-1-INNER-QTY.                                          35220068
352300     MOVE '7100-ALLOC-1-INNER-QTY        ' TO RC001-PARAGRAPH.    35230068
352400                                                                  35240068
352500     PERFORM                                                      35250068
352600       VARYING L FROM 1 BY 1                                      35260068
352700         UNTIL L > PV-MAX-STORES                                  35270068
352800                                                                  35280068
352900         IF WK-STR-NBR (L) > ZEROES                               35290068
353000           AND WK-STR-OTR-QTY (L) > ZEROES                        35300068
353100***        AND WK-STR-OTR-QTY (L) = WK-STR-PLAN-QTY (L)           35310068
353200           AND PV-DISPERSAL-QTY > (WK-STR-PLAN-QTY (L)            35320068
353300                                 - WK-STR-OTR-QTY (L))            35330068
353400                                                                  35340068
353500             IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY               35350068
353600                 ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)35360068
353700                 SUBTRACT PV-LEFT-TO-ALLOC FROM WK-STR-OTR-QTY (L)35370068
353800                                                PV-LEFT-TO-ALLOC  35380068
353900                                                PV-WK-STR-OTR     35390068
354000             ELSE                                                 35400068
354100                 ADD      PV-DISPERSAL-QTY   TO WK-ALLOC-UNITS (L)35410068
354200                 SUBTRACT PV-DISPERSAL-QTY FROM WK-STR-OTR-QTY (L)35420068
354300                                                PV-LEFT-TO-ALLOC  35430068
354400                                                PV-WK-STR-OTR     35440068
354500             END-IF                                               35450068
354600         END-IF                                                   35460068
354700     END-PERFORM.                                                 35470068
354800                                                                  35480068
354900******************************************************************35490068
355000 7200-ALLOC-SHORT-SALES.                                          35500068
355100     MOVE '7200-ALLOC-SHORT-SALES        ' TO RC001-PARAGRAPH.    35510068
355200                                                                  35520068
355300*RE-CALCULATE TOTAL STORE OTR.                                    35530068
355400     MOVE ZEROES TO PV-TOT-STR-OTR                                35540068
355500     PERFORM                                                      35550068
355600       VARYING L FROM 1 BY 1                                      35560068
355700         UNTIL L > PV-MAX-STORES                                  35570068
355800                                                                  35580068
355900         IF WK-STR-NBR (L) > ZEROES                               35590068
356000           AND WK-STR-OTR-QTY (L) > ZEROES                        35600068
356100             COMPUTE PV-TOT-STR-OTR = PV-TOT-STR-OTR              35610068
356200                                    + WK-STR-OTR-QTY (L)          35620068
356300         END-IF                                                   35630068
356400                                                                  35640068
356500     END-PERFORM.                                                 35650068
356600                                                                  35660068
356700*CALCULATE STORE OTR PERCENTAGE.                                  35670068
356800     PERFORM 7210-CALC-OTR-STR-PCT                                35680068
356900       VARYING L FROM 1 BY 1                                      35690068
357000         UNTIL L > PV-MAX-STORES.                                 35700068
357100                                                                  35710068
357200*PRORATE FROM OTR PERCENTAGE.                                     35720068
357300     MOVE PV-LEFT-TO-ALLOC TO PV-ALLOC-QTY-ACCUM.                 35730068
357400     PERFORM 7220-PRORATE-PER-PCT                                 35740068
357500       VARYING L FROM 1 BY 1                                      35750068
357600         UNTIL L > PV-MAX-STORES.                                 35760068
357700                                                                  35770068
357800*ACCUMULATE PRORATION QTY.                                        35780068
357900     MOVE ZEROES TO PV-ACCUM-ALLOC-USED.                          35790068
358000     PERFORM                                                      35800068
358100       VARYING L FROM 1 BY 1                                      35810068
358200         UNTIL L > PV-MAX-STORES                                  35820068
358300                                                                  35830068
358400         COMPUTE PV-ACCUM-ALLOC-USED = PV-ACCUM-ALLOC-USED        35840068
358500                                     + WK-ALLOC-UNITS (L)         35850068
358600     END-PERFORM.                                                 35860068
358700                                                                  35870068
358800*CORRECT ROUNDING MISMATCHES.                                     35880068
358900     IF TM500-UNITS-TO-ALLOC > PV-ACCUM-ALLOC-USED                35890068
359000         PERFORM 7230-PCT-ROUNDING-UP                             35900068
359100           VARYING L FROM 1 BY 1                                  35910068
359200             UNTIL L > PV-MAX-STORES                              35920068
359300                OR TM500-UNITS-TO-ALLOC NOT > PV-ACCUM-ALLOC-USED 35930068
359400     END-IF.                                                      35940068
359500                                                                  35950068
359600     IF TM500-UNITS-TO-ALLOC < PV-ACCUM-ALLOC-USED                35960068
359700         PERFORM 7240-PCT-ROUNDING-DN                             35970068
359800           VARYING L FROM 1 BY 1                                  35980068
359900             UNTIL L > PV-MAX-STORES                              35990068
360000                OR TM500-UNITS-TO-ALLOC NOT < PV-ACCUM-ALLOC-USED 36000068
360100     END-IF.                                                      36010068
360200                                                                  36020068
360300******************************************************************36030068
360400 7210-CALC-OTR-STR-PCT.                                           36040068
360500     MOVE '7210-CALC-OTR-STR-PCT         ' TO RC001-PARAGRAPH.    36050068
360600                                                                  36060068
360700     IF WK-STR-OTR-QTY (L) > ZEROES                               36070068
360800         COMPUTE WK-STR-ALLOC-PCT (L) = (WK-STR-OTR-QTY (L)       36080068
360900                                      / PV-TOT-STR-OTR)           36090068
361100     END-IF.                                                      36110068
361200                                                                  36120068
361300******************************************************************36130068
361400 7220-PRORATE-PER-PCT.                                            36140068
361500     MOVE '7220-PRORATE-PER-PCT          ' TO RC001-PARAGRAPH.    36150068
361600                                                                  36160068
361700     IF PV-LEFT-TO-ALLOC > ZEROES                                 36170068
361800       AND WK-STR-OTR-QTY (L) > ZEROES                            36180068
361900                                                                  36190068
362000         COMPUTE PV-PCT-QTY ROUNDED = WK-STR-ALLOC-PCT (L)        36200068
362100                                    * PV-ALLOC-QTY-ACCUM          36210068
362200                                                                  36220068
362300         DIVIDE PV-PCT-QTY BY PV-DISPERSAL-QTY                    36230068
362400         GIVING PV-ALLOC-QTY                                      36240068
362500         REMAINDER PV-REMAINDER                                   36250068
362600                                                                  36260068
362700*ROUND ALLOCATION QTY.                                            36270068
362800         IF PV-ALLOC-QTY > ZEROES                                 36280068
362900             PERFORM 7225-ROUND-ALLOC-PCT                         36290068
363000         END-IF                                                   36300068
363100                                                                  36310068
363200*PRORATE AT LEAST ONE UNIT.                                       36320068
363300         IF PV-ALLOC-QTY NOT > ZEROES                             36330068
363400             MOVE 1 TO PV-ALLOC-QTY                               36340068
363500         END-IF                                                   36350068
363600                                                                  36360068
363700*PRORATE IN MULTIPLES OF THE DISPERSAL QTY.                       36370068
363800         MULTIPLY PV-ALLOC-QTY BY PV-DISPERSAL-QTY                36380068
363900         GIVING PV-ALLOC-QTY                                      36390068
364000                                                                  36400068
364100         IF PV-ALLOC-QTY > PV-LEFT-TO-ALLOC                       36410068
364200             ADD      PV-LEFT-TO-ALLOC   TO WK-ALLOC-UNITS (L)    36420068
364300             SUBTRACT PV-LEFT-TO-ALLOC FROM WK-STR-OTR-QTY (L)    36430068
364400                                            PV-LEFT-TO-ALLOC      36440068
364500                                            PV-WK-STR-OTR         36450068
364600         ELSE                                                     36460068
364700             ADD      PV-ALLOC-QTY   TO WK-ALLOC-UNITS (L)        36470068
364800             SUBTRACT PV-ALLOC-QTY FROM WK-STR-OTR-QTY (L)        36480068
364900                                        PV-LEFT-TO-ALLOC          36490068
365000                                        PV-WK-STR-OTR             36500068
365100         END-IF                                                   36510068
365200                                                                  36520068
365300     END-IF.                                                      36530068
365400                                                                  36540068
365500******************************************************************36550068
365600* CHECK WITH KEVEN S. FOR ROUNDING SIZE CODE OF 'D'.              36560068
365700******************************************************************36570068
365800 7225-ROUND-ALLOC-PCT.                                            36580068
365900     MOVE '7225-ROUND-ALLOC-PCT          ' TO RC001-PARAGRAPH.    36590068
366000                                                                  36600068
366100     MOVE ZEROES TO PV-REMAINDER-PCT.                             36610068
366200     IF PV-REMAINDER > ZEROES                                     36620068
366300         COMPUTE PV-REMAINDER-PCT = (PV-REMAINDER                 36630068
366400                                  / PV-DISPERSAL-QTY)             36640068
366500                                  * 100                           36650068
366600     END-IF.                                                      36660068
366700                                                                  36670068
366800*IF ROUNDING CODE NOT VALID, SET IT TO 5.                         36680068
366900     IF NOT PV-VALID-PK-SIZE-RND-CDE                              36690068
367000         MOVE '5' TO PV-PK-SIZE-RND-CDE                           36700068
367100     END-IF.                                                      36710068
367200                                                                  36720068
367300     IF PV-PK-SIZE-RND-CDE  = '1'                                 36730068
367400         IF PV-REMAINDER-PCT > 9.99                               36740068
367500             ADD 1 TO PV-ALLOC-QTY                                36750068
367600         END-IF                                                   36760068
367700     END-IF.                                                      36770068
367800     IF PV-PK-SIZE-RND-CDE  = '2'                                 36780068
367900         IF PV-REMAINDER-PCT > 19.99                              36790068
368000             ADD 1 TO PV-ALLOC-QTY                                36800068
368100         END-IF                                                   36810068
368200     END-IF.                                                      36820068
368300     IF PV-PK-SIZE-RND-CDE  = '3'                                 36830068
368400         IF PV-REMAINDER-PCT > 29.99                              36840068
368500             ADD 1 TO PV-ALLOC-QTY                                36850068
368600         END-IF                                                   36860068
368700     END-IF.                                                      36870068
368800     IF PV-PK-SIZE-RND-CDE  = '4'                                 36880068
368900         IF PV-REMAINDER-PCT > 39.99                              36890068
369000             ADD 1 TO PV-ALLOC-QTY                                36900068
369100         END-IF                                                   36910068
369200     END-IF.                                                      36920068
369300     IF PV-PK-SIZE-RND-CDE  = '5'                                 36930068
369400         IF PV-REMAINDER-PCT > 49.99                              36940068
369500             ADD 1 TO PV-ALLOC-QTY                                36950068
369600         END-IF                                                   36960068
369700     END-IF.                                                      36970068
369800     IF PV-PK-SIZE-RND-CDE  = '6'                                 36980068
369900         IF PV-REMAINDER-PCT > 59.99                              36990068
370000             ADD 1 TO PV-ALLOC-QTY                                37000068
370100         END-IF                                                   37010068
370200     END-IF.                                                      37020068
370300     IF PV-PK-SIZE-RND-CDE  = '7'                                 37030068
370400         IF PV-REMAINDER-PCT > 69.99                              37040068
370500             ADD 1 TO PV-ALLOC-QTY                                37050068
370600         END-IF                                                   37060068
370700     END-IF.                                                      37070068
370800     IF PV-PK-SIZE-RND-CDE  = '8'                                 37080068
370900         IF PV-REMAINDER-PCT > 79.99                              37090068
371000             ADD 1 TO PV-ALLOC-QTY                                37100068
371100         END-IF                                                   37110068
371200     END-IF.                                                      37120068
371300     IF PV-PK-SIZE-RND-CDE  = '9'                                 37130068
371400         IF PV-REMAINDER-PCT > 89.99                              37140068
371500             ADD 1 TO PV-ALLOC-QTY                                37150068
371600         END-IF                                                   37160068
371700     END-IF.                                                      37170068
371800     IF PV-PK-SIZE-RND-CDE  = 'R'                                 37180068
371900         IF PV-REMAINDER-PCT > 49                                 37190068
372000             ADD 1 TO PV-ALLOC-QTY                                37200068
372100         END-IF                                                   37210068
372200     END-IF.                                                      37220068
372300     IF PV-PK-SIZE-RND-CDE  = 'U'                                 37230068
372400         IF PV-REMAINDER-PCT NOT = ZEROES                         37240068
372500             ADD 1 TO PV-ALLOC-QTY                                37250068
372600         END-IF                                                   37260068
372700     END-IF.                                                      37270068
372800                                                                  37280068
372900******************************************************************37290068
373000 7230-PCT-ROUNDING-UP.                                            37300068
373100     MOVE '7230-PCT-ROUNDING-UP          ' TO RC001-PARAGRAPH.    37310068
373200                                                                  37320068
373300     IF WK-ALLOC-UNITS (L) > ZEROES                               37330068
373400         IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY                   37340068
373500             ADD     PV-LEFT-TO-ALLOC    TO WK-ALLOC-UNITS (L)    37350068
373600             COMPUTE PV-ACCUM-ALLOC-USED  = PV-ACCUM-ALLOC-USED   37360068
373700                                          + PV-LEFT-TO-ALLOC      37370068
373800             SUBTRACT PV-LEFT-TO-ALLOC FROM WK-STR-OTR-QTY (L)    37380068
373900                                            PV-LEFT-TO-ALLOC      37390068
374000                                            PV-WK-STR-OTR         37400068
374100         ELSE                                                     37410068
374200             ADD     PV-DISPERSAL-QTY    TO WK-ALLOC-UNITS (L)    37420068
374300             COMPUTE PV-ACCUM-ALLOC-USED  = PV-ACCUM-ALLOC-USED   37430068
374400                                          + PV-DISPERSAL-QTY      37440068
374500             SUBTRACT PV-DISPERSAL-QTY FROM WK-STR-OTR-QTY (L)    37450068
374600                                            PV-LEFT-TO-ALLOC      37460068
374700                                            PV-WK-STR-OTR         37470068
374800         END-IF                                                   37480068
374900     END-IF.                                                      37490068
375000                                                                  37500068
375100******************************************************************37510068
375200 7240-PCT-ROUNDING-DN.                                            37520068
375300     MOVE '7240-PCT-ROUNDING-DN          ' TO RC001-PARAGRAPH.    37530068
375400                                                                  37540068
375500     IF WK-ALLOC-UNITS (L) > ZEROES                               37550068
375600         IF PV-LEFT-TO-ALLOC < PV-DISPERSAL-QTY                   37560068
375700             SUBTRACT PV-LEFT-TO-ALLOC FROM WK-ALLOC-UNITS (L)    37570068
375800             COMPUTE  PV-ACCUM-ALLOC-USED = PV-ACCUM-ALLOC-USED   37580068
375900                                          - PV-LEFT-TO-ALLOC      37590068
376000             ADD      PV-LEFT-TO-ALLOC   TO WK-STR-OTR-QTY (L)    37600068
376100                                            PV-LEFT-TO-ALLOC      37610068
376200                                            PV-WK-STR-OTR         37620068
376300         ELSE                                                     37630068
376400             SUBTRACT PV-DISPERSAL-QTY FROM WK-ALLOC-UNITS (L)    37640068
376500             COMPUTE  PV-ACCUM-ALLOC-USED = PV-ACCUM-ALLOC-USED   37650068
376600                                          - PV-DISPERSAL-QTY      37660068
376700             ADD      PV-DISPERSAL-QTY   TO WK-STR-OTR-QTY (L)    37670068
376800                                            PV-LEFT-TO-ALLOC      37680068
376900                                            PV-WK-STR-OTR         37690068
377000         END-IF                                                   37700068
377100     END-IF.                                                      37710068
377200                                                                  37720068
377300******************************************************************37730068
377400*             P E R F O R M   A L L O C A T I O N                *37740068
377500******************************************************************37750068
377600 8000-CREATE-ALLOCATION.                                          37760068
377700     MOVE '8000-CREATE-ALLOCATION        ' TO RC001-PARAGRAPH.    37770068
377800                                                                  37780068
377900*CREATE ALLOCATIONS FOR NEW STORES.                               37790068
378000     PERFORM 5100-LOAD-NW-TO-WK.                                  37800068
378100     PERFORM                                                      37810068
378200       VARYING L FROM 1 BY 1                                      37820068
378300         UNTIL WK-STR-NBR (L) NOT > ZEROES                        37830068
378400            OR L > PV-MAX-STORES                                  37840068
378500                                                                  37850068
378600         IF WK-STR-NBR (L) > ZEROES                               37860068
378800             PERFORM 8100-PREPARE-TRECDIS                         37880068
378900             PERFORM 8200-INSERT-TRECDIS                          37890068
379000         END-IF                                                   37900068
379100     END-PERFORM.                                                 37910068
379200                                                                  37920068
379300*CREATE ALLOCATIONS FOR EXISTING STORES.                          37930068
379400     PERFORM 5400-LOAD-RG-TO-WK.                                  37940068
379500     PERFORM                                                      37950068
379600       VARYING L FROM 1 BY 1                                      37960068
379700         UNTIL WK-STR-NBR (L) NOT > ZEROES                        37970068
379800            OR L > PV-MAX-STORES                                  37980068
379900                                                                  37990068
                                                                        37991099
380000         IF WK-STR-NBR (L) > ZEROES                               38000068
380200             PERFORM 8100-PREPARE-TRECDIS                         38020068
380300             PERFORM 8200-INSERT-TRECDIS                          38030068
380400         END-IF                                                   38040068
380500     END-PERFORM.                                                 38050068
380600                                                                  38060068
380700*CREATE ALLOCATIONS FOR CENTRAL STOCK STORES.                     38070068
380800     PERFORM 5600-LOAD-CS-TO-WK.                                  38080068
380900     PERFORM                                                      38090068
381000       VARYING L FROM 1 BY 1                                      38100068
381100         UNTIL WK-STR-NBR (L) NOT > ZEROES                        38110068
381200            OR L > PV-MAX-STORES                                  38120068
381300                                                                  38130068
381400         IF WK-STR-NBR (L) > ZEROES                               38140068
381600             PERFORM 8100-PREPARE-TRECDIS                         38160068
381700             PERFORM 8200-INSERT-TRECDIS                          38170068
381800         END-IF                                                   38180068
381900     END-PERFORM.                                                 38190068
382000                                                                  38200068
382100******************************************************************38210068
382200 8100-PREPARE-TRECDIS.                                            38220068
382300     MOVE '8100-PREPARE-TRECDIS          ' TO RC001-PARAGRAPH.    38230068
382400                                                                  38240068
382500     MOVE TM500-PO-NBR            TO RECDIS-ORD-NBR.              38250068
382600     MOVE TM500-PO-LNE-NBR        TO RECDIS-ORD-LNE-NBR.          38260068
382700     MOVE TM500-REC-SEQ-NBR       TO RECDIS-REC-SEQ-NBR.          38270068
382800     MOVE TM500-OPER-UNT-ID       TO RECDIS-OPER-UNT-ID.          38280068
382900     MOVE 1                       TO RECDIS-FCLTY-ID.             38290068
383100     MOVE TM500-NOTIF-UID         TO RECDIS-CRE-UID.              38310068
383200     MOVE 'A'                     TO RECDIS-VER-STATUS-CDE.       38320068
383300     MOVE WK-ALLOC-UNITS (L)      TO RECDIS-EXPTED-ITM-QTY        38330068
383400                                     RECDIS-VERIFY-ITM-QTY.       38340068
383500     MOVE 0                       TO RECDIS-AP-VERIFY-ITM-QTY.    38350068
383600     MOVE WK-STR-NBR (L)          TO RECDIS-STR-NBR.              38360068
383700     MOVE 1                       TO RECDIS-STR-FCLTY-ID.         38370068
383800     MOVE WK-STR-OTR-QTY-ORIG (L) TO RECDIS-PLAN-ITM-QTY.         38380068
383900     MOVE SPACES                  TO RECDIS-AP-PRC-CDE.           38390068
384000     MOVE PC-DEFAULT-DATE         TO RECDIS-AP-PRC-DTE.           38400068
384100                                                                  38410068
384200*CHECK IF VALID RATIO QTY.                                        38420068
384300     IF RC821-PKGNG-CDE = 'I' OR 'M'                              38430068
384400         MOVE ZEROES TO PV-REMAINDER                              38440068
384500         DIVIDE WK-ALLOC-UNITS (L)  BY PV-DISPERSAL-QTY           38450068
384600         GIVING PV-HOLD-QTY  REMAINDER PV-REMAINDER               38460068
384700         IF PV-REMAINDER NOT = ZEROES                             38470068
384800             MOVE '*** INVALID RATIO QUANTITY ***          '      38480068
384900                                      TO RC001-SPECIAL-1          38490068
385000             MOVE WK-ALLOC-UNITS (L)  TO PV-LEFT-TO-ALLOC-DISP    38500068
385100             STRING ' ==> '           DELIMITED BY SIZE           38510068
385200                'ALLOC-QTY = '        DELIMITED BY SIZE           38520068
385300                PV-LEFT-TO-ALLOC-DISP DELIMITED BY SIZE           38530068
385400                ' / DISPERSAL-QTY = ' DELIMITED BY SIZE           38540068
385500                PV-DISPERSAL-QTY      DELIMITED BY SIZE           38550068
385600                                    INTO RC001-SPECIAL-2          38560068
385700             SET PS-DONE-YES   TO TRUE                            38570068
385800             MOVE SPACES       TO TM501-TM500-RETURN-MSG          38580068
385900             MOVE '8100'       TO TM501-PARA                      38590068
                                        TM007-RETURNED-PARA             38591099
386000             MOVE '824'        TO TM501-PGM                       38600068
386100             MOVE SQLCODE      TO TM500-SQLCODE                   38610068
386100                                  TM007-SQLCODE                   38611099
386200             MOVE SQLCA        TO TM500-SQLCA                     38620068
386200                                  TM007-SQLCA                     38621099
386300             MOVE 105          TO TM501-PRORATION-ERROR-NBR       38630068
386400             PERFORM TM501-SET-TM500-RETURN-MSG                   38640068
                   MOVE TM500-RETURN-DATA                               38651099
                                     TO TM007-RETURN-DATA               38652099
386500             PERFORM RC001-RETURN-MSG                             38653099
386600         END-IF                                                   38660068
386700     END-IF.                                                      38670068
386800                                                                  38680068
386900******************************************************************38690068
387000 8200-INSERT-TRECDIS.                                             38700068
387100     MOVE '8200-INSERT-TRECDIS           ' TO RC001-PARAGRAPH.    38710068
387200                                                                  38720068
387300     PERFORM WITH TEST AFTER                                      38730068
387400       VARYING PV-RETRY-COUNTER  FROM 1 BY 1                      38740068
387500         UNTIL SQLCODE = +0 OR PS-DONE-YES                        38750068
387600            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  38760068
387700                                                                  38770068
387800         EXEC SQL                                                 38780068
387900             INSERT INTO TRECDIS                                  38790068
388000                     (ORD_NBR                                     38800068
388100                   ,  ORD_LNE_NBR                                 38810068
388200                   ,  REC_SEQ_NBR                                 38820068
388300                   ,  OPER_UNT_ID                                 38830068
388400                   ,  FCLTY_ID                                    38840068
388500                   ,  CRE_TMST                                    38850068
388600                   ,  CRE_UID                                     38860068
388700                   ,  VER_STATUS_CDE                              38870068
388800                   ,  EXPTED_ITM_QTY                              38880068
388900                   ,  VERIFY_ITM_QTY                              38890068
389000                   ,  AP_VERIFY_ITM_QTY                           38900068
389100                   ,  STR_NBR                                     38910068
389200                   ,  STR_FCLTY_ID                                38920068
389300                   ,  PLAN_ITM_QTY                                38930068
389400                   ,  AP_PRC_CDE                                  38940068
389500                   ,  AP_PRC_DTE)                                 38950068
389600              VALUES (:RECDIS-ORD-NBR                             38960068
389700                   ,  :RECDIS-ORD-LNE-NBR                         38970068
389800                   ,  :RECDIS-REC-SEQ-NBR                         38980068
389900                   ,  :RECDIS-OPER-UNT-ID                         38990068
390000                   ,  :RECDIS-FCLTY-ID                            39000068
390100                   ,  CURRENT TIMESTAMP                           39010068
390200                   ,  :PC-CURRENT-PROGRAM-NAME                    39020099
390300                   ,  :RECDIS-VER-STATUS-CDE                      39030068
390400                   ,  :RECDIS-EXPTED-ITM-QTY                      39040068
390500                   ,  :RECDIS-VERIFY-ITM-QTY                      39050068
390600                   ,  :RECDIS-AP-VERIFY-ITM-QTY                   39060068
390700                   ,  :RECDIS-STR-NBR                             39070068
390800                   ,  :RECDIS-STR-FCLTY-ID                        39080068
390900                   ,  :RECDIS-PLAN-ITM-QTY                        39090068
391000                   ,  :RECDIS-AP-PRC-CDE                          39100068
391100                   ,  :RECDIS-AP-PRC-DTE)                         39110068
391200         END-EXEC                                                 39120068
391300                                                                  39130068
391400         EVALUATE TRUE                                            39140068
391500           WHEN SQLCODE = +0                                      39150068
391600               CONTINUE                                           39160068
391700                                                                  39170068
391800           WHEN SQLCODE = -904                                    39180068
391900           WHEN SQLCODE = -911                                    39190068
392000           WHEN SQLCODE = -913                                    39200068
392100               CONTINUE                                           39210068
392200                                                                  39220068
392300           WHEN OTHER                                             39230068
392400               SET PS-DONE-YES   TO TRUE                          39240068
392500               MOVE SPACES       TO TM501-TM500-RETURN-MSG        39250068
392600               MOVE '8200'       TO TM501-PARA                    39260068
                                          TM007-RETURNED-PARA           39261099
392700               MOVE '824'        TO TM501-PGM                     39270068
392800               MOVE SQLCODE      TO TM500-SQLCODE                 39280068
392800                                    TM007-SQLCODE                 39281099
392900               MOVE SQLCA        TO TM500-SQLCA                   39290068
392900                                    TM007-SQLCA                   39291099
393000               MOVE 86           TO TM501-PRORATION-ERROR-NBR     39300068
393100               PERFORM TM501-SET-TM500-RETURN-MSG                 39310068
                     MOVE TM500-RETURN-DATA                             39321099
                                       TO TM007-RETURN-DATA             39322099
393200               PERFORM RC001-RETURN-MSG                           39323099
393300         END-EVALUATE                                             39330068
393400     END-PERFORM.                                                 39340068
393500                                                                  39350068
393600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         39360068
393700         SET PS-DONE-YES   TO TRUE                                39370068
393800         MOVE SPACES       TO TM501-TM500-RETURN-MSG              39380068
393900         MOVE '8200'       TO TM501-PARA                          39390068
                                    TM007-RETURNED-PARA                 39391099
394000         MOVE '824'        TO TM501-PGM                           39400068
394100         MOVE SQLCODE      TO TM500-SQLCODE                       39410068
394100                              TM007-SQLCODE                       39411099
394200         MOVE SQLCA        TO TM500-SQLCA                         39420068
394200                              TM007-SQLCA                         39421099
394300         MOVE 87           TO TM501-PRORATION-ERROR-NBR           39430068
394400         PERFORM TM501-SET-TM500-RETURN-MSG                       39440068
               MOVE TM500-RETURN-DATA                                   39451099
                                 TO TM007-RETURN-DATA                   39452099
394500         PERFORM RC001-RETURN-MSG                                 39453099
394600     END-IF.                                                      39460068
394700                                                                  39470068
397600******************************************************************39760068
402800******************************************************************40280068
402900*             C A L L   R A N D O M I Z A T I O N                *40290068
403000******************************************************************40300068
403100 9000-CALL-RANDOM.                                                40310068
403200     MOVE '9000-CALL-RANDOM              ' TO RC001-PARAGRAPH.    40320068
403300                                                                  40330068
417100     CALL PC-RCKUT825 USING RC825-COMMAREA.                       40371099
403800                                                                  40380068
403900******************************************************************40390068
404000*                                                                *40400068
404100*        W R I T E   A B E N D S   T O   C I C S   L O G         *40410068
404200*                                                                *40420068
404300******************************************************************40430068
404400* -------------------                                             40440068
404500*    COPY RCPD001.                                                40450068
404600* -------------------                                             40460068
404700 RC001-RETURN-MSG.                                                40470068
404800                                                                  40480068
405400     MOVE SQLCODE TO RC001-SAVE-SQLCODE.                          40540068
405500                                                                  40550068
405600     EXEC SQL                                                     40560068
405700         SELECT CURRENT_DATE                                      40570068
405800              , CURRENT_TIME                                      40580068
405900         INTO  :RC001-DATE                                        40590068
406000             , :RC001-TIME                                        40600068
406100         FROM TCOCNTL                                             40610068
              WHERE OPER_UNT_ID = 90                                    40611099
406200     END-EXEC.                                                    40620068
406300                                                                  40630068
407000*WRITE RC001-LINE-01.                                             40700068
407100     MOVE RC001-LINE-01         TO RC001-LOG-LINE.                40710068
407200     PERFORM RC001-WRITE-DISPLAY.                                 40720088
407300                                                                  40730068
407400*WRITE RC001-LINE-02.                                             40740068
407500     MOVE RC001-SAVE-SQLCODE    TO RC001-SQLCODE.                 40750068
407600     MOVE RC001-LINE-02         TO RC001-LOG-LINE.                40760068
407700     PERFORM RC001-WRITE-DISPLAY.                                 40770088
407800                                                                  40780068
407900*WRITE RC001-LINE-03.                                             40790068
408000     MOVE TM500-PO-NBR          TO RC001-PO-NBR.                  40800068
408100     MOVE TM500-REC-SEQ-NBR     TO RC001-REC-SEQ-NBR.             40810068
408200     MOVE RC821-REC-DRV-LNE-NBR TO RC001-PO-LNE-NBR.              40820068
408300     MOVE TM500-OPER-UNT-ID     TO RC001-OPER-UNT-ID.             40830068
408400     MOVE TM500-FCLTY-ID        TO RC001-FCLTY-ID.                40840068
408500     MOVE RC821-PREPK-ID        TO RC001-PREPK-ID.                40850068
408600     MOVE RC001-LINE-03         TO RC001-LOG-LINE.                40860068
408700     PERFORM RC001-WRITE-DISPLAY.                                 40870088
408800                                                                  40880068
408900*WRITE RC001-LINE-04.                                             40890068
409000     MOVE RC001-LINE-04      TO RC001-LOG-LINE.                   40900068
409100     PERFORM RC001-WRITE-DISPLAY.                                 40910088
409200                                                                  40920068
409300*WRITE RC001-LINE-05.                                             40930068
409400     MOVE RC001-LINE-05      TO RC001-LOG-LINE.                   40940068
409500     PERFORM RC001-WRITE-DISPLAY.                                 40950088
409600                                                                  40960068
410300*RETURN TO CALLING PROGRAM                                        41030068
410400     PERFORM 9999-GOBACK.                                         41040099
410500                                                                  41050068
410600******************************************************************41060068
410700 RC001-WRITE-DISPLAY.                                             41070088
410800                                                                  41080068
425100     DISPLAY RC001-LOG-LINE.                                      41081085
412400                                                                  41240068
413000******************************************************************41300068
413100     COPY TMPD501.                                                41310068
413200******************************************************************41320068
049900 9999-GOBACK.                                                     41330099
047700     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TMRD007.              41331099
050000     MOVE TM500-FIELDS              TO RC824-TM500-FIELDS.        41340099
050100     MOVE RC824-COMMAREA            TO LINK-COMMAREA.             41350099
050600                                                                  41360099
050700     GOBACK.                                                      41370099
