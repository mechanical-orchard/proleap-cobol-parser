000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RCKUT148.                                         00040015
000500 AUTHOR.        TKMA479.                                          00050014
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  SEPTEMBER 2012.                                   00070014
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001600*   GENERATE AN EXTRACT WHICH RECAPS THE PO-S ASSIGNED TO THE     00160044
001610*   DAY AFTER THANKSGIVING FLOWBACK SET.                          00161044
001620*                                                                 00162044
001630*   THIS PROGRAM WILL EXTRACT DATA AND THEN CREATE AN OUTPUT      00163044
001640*   FILE WHICH WILL BE INPUT INTO PROGRAM RCKUT149.               00164044
001650*                                                                 00165044
001660*   FOR EACH ROW FETCHED FROM MAIN CURSOR QUERY AND               00166044
001670*   WRITE A A RECORD TO AN OUTPUT FILE USING THE RCRD091          00167044
001680*   COPYBOOK.                                                     00168044
001700***************************************************************** 00170000
263784* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00172047
263784* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00173047
263784* MAKING THE CALL DYNAMIC VS STATIC.                              00174047
263784*---------------------------------------------------------------* 00175047
001800 ENVIRONMENT DIVISION.                                            00180000
001810                                                                  00181014
001900 INPUT-OUTPUT SECTION.                                            00190000
002000                                                                  00200000
002100 FILE-CONTROL.                                                    00210000
002200                                                                  00220000
002400     SELECT OUTPUT-FILE-1  ASSIGN TO UT-S-OUT01.                  00240000
002700                                                                  00270000
002800***************************************************************** 00280000
002900 DATA DIVISION.                                                   00290000
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
004000 FD  OUTPUT-FILE-1                                                00400000
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     RECORD CONTAINS 60                                           00430024
004400     BLOCK CONTAINS 0 RECORDS                                     00440000
004500     DATA RECORD IS OUTPUT-RECORD-1.                              00450000
004510                                                                  00451014
004600 01  OUTPUT-RECORD-1             PIC X(60).                       00460024
004700                                                                  00470000
005030***************************************************************** 00503000
005100 WORKING-STORAGE SECTION.                                         00510000
005363                                                                  00536300
005370 01  PS-PROGRAM-SWITCHES.                                         00537000
005400     05  PS-END-OF-DATFL-SW           PIC  X(01) VALUE 'N'.       00540027
005500         88  PS-END-OF-DATFL                     VALUE 'Y'.       00550027
005600         88  PS-NOT-END-OF-DATFL                 VALUE 'N'.       00560027
005700                                                                  00570014
005800 01  PV-PROGRAM-VARIABLES.                                        00580025
005900     05  PV-SQLCODE                   PIC 9999-.                  00590027
005910     05  PV-TOT-FETCH-COUNT           PIC 9(7)  VALUE 0.          00591036
005920     05  PV-TOT-WRITE-COUNT           PIC 9(7)  VALUE 0.          00592036
006000                                                                  00600025
013300 01 PC-PROGRAM-CONSTANTS.                                         01330000
013400     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'RCKUT148'.01340024
013500     05  PC-MAX-RETRIES               PIC S9(03) VALUE +5 COMP-3. 01350000
013800     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01380000
013900                                     '9999-09-09-09.09.09.999999'.01390000
014000 01  PV-ABEND-FIELDS.                                             01400000
014100     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01410000
014200                                                 COMP SYNC.       01420000
014300     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT148'.01430015
014400     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01440000
014500     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01450000
014600     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01460000
014700     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01470000
014800     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01480000
014900     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01490000
015000                                                                  01500000
015100***********************************************************       01510028
015200*  DB2 SQL COMMUNICATION AREA                                     01520028
015300***********************************************************       01530028
015400     EXEC SQL                                                     01540028
015500         INCLUDE SQLCA                                            01550028
015600     END-EXEC.                                                    01560028
015700                                                                  01570028
015800***********************************************************       01580028
015900*  PO TABLE                                                       01590028
016000***********************************************************       01600028
016100     EXEC SQL                                                     01610028
016200         INCLUDE TPURCHS                                          01620028
016300     END-EXEC.                                                    01630028
016310                                                                  01631028
016320***********************************************************       01632028
016330*  SEASONAL SET TABLE                                             01633028
016340***********************************************************       01634028
016350     EXEC SQL                                                     01635028
016360         INCLUDE TSEASET                                          01636028
016370     END-EXEC.                                                    01637028
016371                                                                  01637132
016400***********************************************************       01640000
016500*  OUTPUT FILE COPYBOOK                                           01650014
016600***********************************************************       01660000
016700     COPY RCRD091.                                                01670015
016701                                                                  01670123
016702***********************************************************       01670223
016703*  NUMERIC EDIT LAYOUT                                            01670323
016704***********************************************************       01670423
016705     COPY DPWS010I.                                               01670523
016706                                                                  01670615
016707***********************************************************       01670730
016708*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01670830
016709***********************************************************       01670930
016710     COPY DPWS004.                                                01671030
016711                                                                  01671130
016712***********************************************************       01671218
016713*   DATFL CURSOR                                                  01671318
016714***********************************************************       01671418
016715                                                                  01671518
016716     EXEC SQL                                                     01671618
016717        DECLARE DATFL-CSR CURSOR FOR                              01671718
016718           SELECT A.SEASET_YR                                     01671820
016719                 ,A.SEASET_SHRT_NM                                01671920
016720                 ,B.PO_NBR                                        01672021
016721                 ,B.DEPT_NBR                                      01672121
016722                 ,B.TOT_UNT_QTY                                   01672221
016730                 ,B.TOT_VAL_COST_AMT                              01673021
016731                 ,B.TOT_VAL_RTL_AMT                               01673121
016740                 ,B.TOT_SKUS_QTY                                  01674021
016741                 ,B.STATUS_CDE                                    01674121
016742                 ,B.PKGNG_CDE                                     01674221
016750           FROM TSEASET A                                         01675021
016760               ,TPURCHS B                                         01676021
016770           WHERE A.PO_RCPT_RPTG_IND = 'Y'                         01677016
016780             AND A.SEASET_STAT_CDE = 'A'                          01678016
016790             AND B.SEASET_YR = A.SEASET_YR                        01679016
016791             AND B.SEASET_SHRT_NM = A.SEASET_SHRT_NM              01679116
016792             AND B.VER_STATUS_CDE = 'A'                           01679216
016793           ORDER BY PO_NBR                                        01679316
016794           WITH UR                                                01679416
016795     END-EXEC.                                                    01679517
016800                                                                  01680000
023500 PROCEDURE DIVISION.                                              02350000
023800                                                                  02380000
023900     DISPLAY '*** START OF RCKUT148 ***'.                         02390029
023910                                                                  02391029
024000     PERFORM 0100-INITIAL.                                        02400026
024010     PERFORM 2000-OPEN-DATFL-CSR.                                 02401026
024011     PERFORM 2100-FETCH-DATFL-CSR                                 02401126
024012        UNTIL PS-END-OF-DATFL.                                    02401227
024013     PERFORM 2200-CLOSE-DATFL-CSR.                                02401326
024910     PERFORM 9000-END-OF-PROGRAM.                                 02491000
024920                                                                  02492000
027000     GOBACK.                                                      02700000
027100                                                                  02710000
027200******************************************************************02720000
027300 0100-INITIAL.                                                    02730026
027400******************************************************************02740000
027500     MOVE '0100-INITIAL               ' TO PV-ABEND-PARAGRAPH.    02750026
027600                                                                  02760000
027800     OPEN OUTPUT OUTPUT-FILE-1.                                   02780014
027810                                                                  02781036
029200******************************************************************02920019
029300* OPEN DATFL-CSR                                                  02930019
029400******************************************************************02940019
029500 2000-OPEN-DATFL-CSR.                                             02950026
029600                                                                  02960019
029610     MOVE '2000-OPEN-DATFL-CSR        ' TO PV-ABEND-PARAGRAPH.    02961026
029620                                                                  02962024
029700     EXEC SQL                                                     02970019
029800        OPEN DATFL-CSR                                            02980019
029810     END-EXEC.                                                    02981019
029820                                                                  02982019
029830     EVALUATE TRUE                                                02983019
029840        WHEN SQLCODE = 0                                          02984019
029850           CONTINUE                                               02985019
029860        WHEN OTHER                                                02986019
029870           MOVE '2000-OPEN-DATFL-CSR'                             02987026
029880                                 TO PV-ABEND-PARAGRAPH            02988019
029890           MOVE 'OPEN DATFL-CSR' TO PV-ABEND-OPERATION            02989019
029891           MOVE ' '              TO PV-ABEND-STRUCTURE-1          02989119
029892           MOVE 'OPEN CURSOR'    TO PV-DB2-OPERATION-MESSAGE-1    02989219
029893           PERFORM 9900-DB2-ABEND                                 02989319
029894     END-EVALUATE.                                                02989419
029895                                                                  02989519
029896******************************************************************02989619
029897* FETCH DATFL-CSR                                                 02989719
029898******************************************************************02989819
029899 2100-FETCH-DATFL-CSR.                                            02989926
029900                                                                  02990019
029901     MOVE '2100-FETCH-DATFL-CSR       ' TO PV-ABEND-PARAGRAPH.    02990126
029902                                                                  02990224
029903     EXEC SQL                                                     02990319
029904         FETCH DATFL-CSR                                          02990419
029905          INTO  :SEASET-SEASET-YR                                 02990521
029906               ,:SEASET-SEASET-SHRT-NM                            02990621
029907               ,:PURCHS-PO-NBR                                    02990721
029908               ,:PURCHS-DEPT-NBR                                  02990821
029909               ,:PURCHS-TOT-UNT-QTY                               02990921
029910               ,:PURCHS-TOT-VAL-COST-AMT                          02991021
029911               ,:PURCHS-TOT-VAL-RTL-AMT                           02991121
029912               ,:PURCHS-TOT-SKUS-QTY                              02991221
029913               ,:PURCHS-STATUS-CDE                                02991321
029914               ,:PURCHS-PKGNG-CDE                                 02991421
029925     END-EXEC                                                     02992519
029926                                                                  02992646
029927     EVALUATE TRUE                                                02992719
029928        WHEN SQLCODE = ZERO                                       02992819
029929           ADD 1 TO PV-TOT-FETCH-COUNT                            02992927
029930           PERFORM 3000-OUTPUT                                    02993026
029931        WHEN SQLCODE = +100                                       02993119
029932           SET PS-END-OF-DATFL TO TRUE                            02993227
029938        WHEN OTHER                                                02993819
029939           MOVE '2100-FETCH-DATFL-CSR'                            02993926
029940                                   TO PV-ABEND-PARAGRAPH          02994019
029941           MOVE 'FETCH DATFL-CSR' TO PV-ABEND-OPERATION           02994119
029942           MOVE ' '               TO PV-ABEND-STRUCTURE-1         02994219
029943           MOVE 'FETCH CURSOR'    TO PV-DB2-OPERATION-MESSAGE-1   02994319
029944           PERFORM 9900-DB2-ABEND                                 02994419
029945     END-EVALUATE.                                                02994519
029946                                                                  02994619
029947******************************************************************02994719
029948* CLOSE DATFL-CSR                                                 02994819
029949******************************************************************02994919
029950 2200-CLOSE-DATFL-CSR.                                            02995026
029951                                                                  02995119
029952     MOVE '2200-CLOSE-DATFL-CSR       ' TO PV-ABEND-PARAGRAPH.    02995226
029953                                                                  02995324
029954     EXEC SQL                                                     02995419
029955        CLOSE DATFL-CSR                                           02995519
029956     END-EXEC.                                                    02995619
029957                                                                  02995719
029958     EVALUATE TRUE                                                02995819
029959        WHEN SQLCODE = 0                                          02995919
029960           CONTINUE                                               02996019
029961        WHEN OTHER                                                02996119
029962           MOVE '2200-CLOSE-DATFL-CSR'                            02996226
029963                                  TO PV-ABEND-PARAGRAPH           02996319
029964           MOVE 'CLOSE DATFL-CSR' TO PV-ABEND-OPERATION           02996419
029965           MOVE ' '               TO PV-ABEND-STRUCTURE-1         02996519
029966           MOVE 'CLOSE CURSOR'    TO PV-DB2-OPERATION-MESSAGE-1   02996619
029967           PERFORM 9900-DB2-ABEND                                 02996719
029968     END-EVALUATE.                                                02996819
029970                                                                  02997000
030000******************************************************************03000000
030100 3000-OUTPUT.                                                     03010026
030200******************************************************************03020000
030201                                                                  03020120
030202     MOVE '3000-OUTPUT                ' TO PV-ABEND-PARAGRAPH.    03020226
030203                                                                  03020324
030204     INITIALIZE RCRD091-SEASET-PO-EXTRACT.                        03020420
030205     INITIALIZE DP010I-UNEDITED-FIELD.                            03020524
030206                                                                  03020621
030209     MOVE PURCHS-PO-NBR TO RC091-PO-NUMBER.                       03020921
030210     MOVE PURCHS-TOT-UNT-QTY TO RC091-TOT-UNT-QTY.                03021021
030211     MOVE PURCHS-TOT-VAL-COST-AMT TO RC091-TOT-VAL-COST-AMT.      03021121
030212     MOVE PURCHS-TOT-VAL-RTL-AMT TO RC091-TOT-VAL-RTL-AMT.        03021221
030213     MOVE PURCHS-TOT-SKUS-QTY TO RC091-TOT-SKUS-QTY.              03021321
030214     MOVE PURCHS-STATUS-CDE TO RC091-STATUS-CDE.                  03021421
030215     MOVE PURCHS-PKGNG-CDE TO RC091-PKGNG-CDE.                    03021538
030216     MOVE SEASET-SEASET-YR TO RC091-SEASET-YR.                    03021638
030217     MOVE SEASET-SEASET-SHRT-NM TO RC091-SEASET-SHRT-NM.          03021738
030219                                                                  03021938
030230     MOVE PURCHS-DEPT-NBR      TO DP010I-UNEDITED-FIELD.          03023022
030231     MOVE 4                    TO DP010I-MAXIMUM-DIGITS.          03023122
030232     MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS.        03023222
030233     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03023331
030234                                                                  03023431
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03023647
263784          USING DP010I-NUMERIC-EDIT-AREA.                         03023747
030236                                                                  03023822
030237     IF DP010I-ERROR-DETECTED                                     03023922
030238        MOVE 0 TO RC091-DEPT-NBR                                  03024022
030239     ELSE                                                         03024122
030240        MOVE DP010I-NUMERIC-FIELD TO RC091-DEPT-NBR               03024231
030250     END-IF.                                                      03025022
030251                                                                  03025127
030252     WRITE OUTPUT-RECORD-1 FROM RCRD091-SEASET-PO-EXTRACT.        03025227
030253                                                                  03025327
030260     ADD 1 TO PV-TOT-WRITE-COUNT.                                 03026027
112687                                                                  11268700
112883******************************************************************11288341
112884 9000-END-OF-PROGRAM.                                             11288441
112885***************************************************************** 11288541
112886                                                                  11288641
112887*DISPLAY COUNTS.                                                  11288741
112888     DISPLAY ' '.                                                 11288841
112889     DISPLAY '*********** RCKUT148 COUNTS ************'.          11288941
112890     DISPLAY '*** RECORDS FETCHED  ==> ' PV-TOT-FETCH-COUNT.      11289041
112891     DISPLAY '*** RECORDS WRITTEN  ==> ' PV-TOT-WRITE-COUNT.      11289141
112892     DISPLAY '****************************************'.          11289241
112893     DISPLAY ' '.                                                 11289341
112894                                                                  11289441
112895*CLOSE FILE.                                                      11289541
112896     CLOSE OUTPUT-FILE-1.                                         11289641
112897                                                                  11289741
112898*END.                                                             11289841
112899                                                                  11289941
112900     DISPLAY '*** END OF RCKUT148 ***'.                           11290041
112901                                                                  11290141
112902******************************************************************11290241
112903 9900-DB2-ABEND.                                                  11290341
112904******************************************************************11290441
112905     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    11290541
112910                                                                  11291000
113000     MOVE SQLCODE TO PV-SQLCODE.                                  11300000
113100     DISPLAY '*** DB2 ERROR '.                                    11310000
113200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       11320000
113300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11330000
113400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11340000
113500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11350000
113600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11360000
113700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       11370000
113800     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                11380000
113801                                                                  11380129
113810*ABEND                                                            11381029
113820                                                                  11382029
113830     DISPLAY '*** RCKUT148 ABEND ***'.                            11383029
113900                                                                  11390000
114000     COPY DPPD004.                                                11400000
114100                                                                  11410000
114200     MOVE +4013 TO PV-ABEND-CODE.                                 11420000
114300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11430000
