000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SNKUP033.                                00050001
000600 AUTHOR.                 NATALIYA PALATNIK.                       00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            03-04-93.                                00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200*     LOAD THE TASDTPL TABLE ( ASN DATAIL PO ITEM ASSOCIATION   * 00120001
001300*      TABLE ).                                                 * 00130001
001400*                                                               * 00140001
001500***************************************************************** 00150001
001600*  CHANGE MADE:                                                 * 00160001
001700*                                                               * 00170001
001800***************************************************************** 00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000***************************************************************** 00200001
002100                                                                  00210001
002200 CONFIGURATION SECTION.                                           00220001
002300                                                                  00230001
002400 SOURCE-COMPUTER.        IBM-3090.                                00240001
002500 OBJECT-COMPUTER.        IBM-3090.                                00250001
002600                                                                  00260001
002700 INPUT-OUTPUT SECTION.                                            00270001
002800                                                                  00280001
002900 FILE-CONTROL.                                                    00290001
003000*                                                                 00300001
003100     SELECT ASNDTPL-LOAD-FILE                                     00310001
003200         ASSIGN TO INP01.                                         00320001
003300                                                                  00330001
P46103     SELECT ASNDTPL-ERR-FILE                                      00340001
P46103         ASSIGN TO OUT01.                                         00350001
P46103                                                                  00360001
003400     SELECT ASNDTPL-REPORT-FILE                                   00370001
003500         ASSIGN TO RPT01.                                         00380001
003600*                                                                 00390001
003700***************************************************************** 00400001
003800 DATA DIVISION.                                                   00410001
003900***************************************************************** 00420001
004000*                                                                 00430001
004100 FILE SECTION.                                                    00440001
004200*                                                                 00450001
004300 FD  ASNDTPL-LOAD-FILE                                            00460001
004400     RECORDING MODE IS F                                          00470001
004500     LABEL RECORDS ARE STANDARD                                   00480001
004600     BLOCK CONTAINS 0 RECORDS                                     00490001
004700     RECORD CONTAINS 45 CHARACTERS                                00500001
004800     DATA RECORD IS ASNDTPL-LOAD-RECORD.                          00510001
004900                                                                  00520001
005000 01  ASNDTPL-LOAD-RECORD          PIC X(45).                      00530001
005100                                                                  00540001
005200 FD  ASNDTPL-REPORT-FILE                                          00550001
005300     RECORDING MODE IS F                                          00560001
005400     LABEL RECORDS ARE OMITTED                                    00570001
005500     BLOCK CONTAINS 0 RECORDS                                     00580001
005600     RECORD CONTAINS 132 CHARACTERS                               00590001
005700     DATA RECORD IS ASNDTPL-REPORT-LINE.                          00600001
005800                                                                  00610001
005900 01  ASNDTPL-REPORT-LINE          PIC X(132).                     00620001
P46103                                                                  00630001
P46103 FD  ASNDTPL-ERR-FILE                                             00640001
P46103     RECORDING MODE IS F                                          00650001
P46103     LABEL RECORDS ARE STANDARD                                   00660001
P46103     BLOCK CONTAINS 0 RECORDS                                     00670001
P46103     RECORD CONTAINS 45 CHARACTERS                                00680001
P46103     DATA RECORD IS ASNDTPL-LOAD-RECORD.                          00690001
P46103                                                                  00700001
P46103 01  ASNDTPL-ERR-RECORD           PIC X(45).                      00710001
006000*                                                                 00720001
006100 WORKING-STORAGE SECTION.                                         00730001
006200*                                                                 00740001
006300 01  FILLER.                                                      00750001
006400     05  FILLER                      PIC  X(36)    VALUE          00760001
006500         ' ***** WORKING STORAGE PGM=SNKUP033 '.                  00770001
006600     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00780001
006700     05  FILLER                      PIC  X(10)    VALUE          00790001
006800         ' LOCATION='.                                            00800001
006900     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00810001
007000     05  FILLER                      PIC  X(06)    VALUE          00820001
007100         ' *****'.                                                00830001
007200/                                                                 00840001
007300 01  CD-CPU-DATE.                                                 00850001
007400     05  CD-CPU-DATE-YY              PIC  9(02)    VALUE ZEROES.  00860001
007500     05  CD-CPU-DATE-MM              PIC  9(02)    VALUE ZEROES.  00870001
007600     05  CD-CPU-DATE-DD              PIC  9(02)    VALUE ZEROES.  00880001
007700/                                                                 00890001
007800 01  CT-CPU-TIME.                                                 00900001
007900     05  CT-CPU-TIME-HH              PIC  9(02)    VALUE ZEROES.  00910001
008000     05  CT-CPU-TIME-MM              PIC  9(02)    VALUE ZEROES.  00920001
008100     05  CT-CPU-TIME-SS              PIC  9(02)    VALUE ZEROES.  00930001
008200/                                                                 00940001
008300 01  PS-PROGRAM-SWITCHES.                                         00950001
008400     05  PS-END-OF-ASNDTPL-IND       PIC  X(01)    VALUE 'N'.     00960001
008500         88  PS-END-OF-ASNDTPL                     VALUE 'Y'.     00970001
008600         88  PS-NOT-END-OF-ASNDTPL                 VALUE 'N'.     00980001
008700     05  PS-ASNDTL-EXIST-IND         PIC  X(01)    VALUE 'N'.     00990001
008800         88  PS-ASNDTL-EXIST                       VALUE 'Y'.     01000001
008900         88  PS-ASNDTL-NOT-EXIST                   VALUE 'N'.     01010001
P46103*    05  PS-RET-CODE-IND             PIC  X(01)    VALUE 'N'.     01020001
P46103*        88  SET-RET-CODE                          VALUE 'Y'.     01030001
P46103*        88  DONT-SET-RET-CODE                     VALUE 'N'.     01040001
009300*                                                                 01050001
009400 01  PC-PROGRAM-CONSTANTS.                                        01060001
009500     05  PC-ILBOABN0                 PIC  X(08)    VALUE          01070001
009600                                                   'ILBOABN0'.    01080001
009900     05  PC-MAX-RETRIES              PIC S9(03)    VALUE +3       01090001
010000                                                   COMP-3.        01100001
010100     05  PC-NEG-803                  PIC S9(04)    VALUE -803     01110001
010200                                                   COMP SYNC.     01120001
010300     05  PC-NEG-904                  PIC S9(04)    VALUE -904     01130001
010400                                                   COMP SYNC.     01140001
010500     05  PC-NEG-913                  PIC S9(04)    VALUE -913     01150001
010600                                                   COMP SYNC.     01160001
010700     05  PC-OPERCO-NBR               PIC  X(02)    VALUE '03'.    01170001
010800     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01180001
010900                                                   COMP SYNC.     01190001
011000     05  PC-ASTERISK                 PIC  X(60)    VALUE          01200001
011100         '*******************************************'.           01210001
011200     05  PC-END-OF-REPORT-LINE       PIC  X(132)   VALUE          01220001
011300      '                        *END OF REPORT*    '.              01230001
011400*                                                                 01240001
011500*                                                                 01250001
011600 01  PV-PROGRAM-VARIABLES.                                        01260001
011700     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01270001
011800                                                   COMP SYNC.     01280001
011900     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01290001
012000     05  PV-SQL-SUB                  PIC S9(04)    COMP.          01300001
012100     05  PV-RETRY-COUNTER            PIC S9(03)    COMP-3.        01310001
012200     05  PV-ASDTPL-WRITTEN           PIC 9(9)      VALUE ZEROS.   01320001
012300     05  PV-ASDTPL-DELETED           PIC 9(9)      VALUE ZEROS.   01330001
012400     05  PV-PAGE-CNT                 PIC 9(4)      VALUE ZEROS.   01340001
012500     05  PV-LINE-CNT                 PIC 9(4)      VALUE ZEROS.   01350001
012600     05  PV-COMMIT-COUNTER           PIC 9(4)      VALUE ZEROS.   01360001
012800/                                                                 01370001
012900 01  INP01-ASNDTPL-LAYOUT.                                        01380001
013000*    05  O1-OPERCO-NBR              PIC X(2)      VALUE SPACES.   01390001
013100*    05  O1-EDI-VEND-ID             PIC X(17)     VALUE SPACES.   01400001
013200*    05  O1-ASNHDR-NBR              PIC X(30)     VALUE SPACES.   01410001
013300     05  O1-ASNDTL-NBR               PIC S9(7)     VALUE ZEROS    01420001
013400                                                   COMP-3.        01430001
013500     05  O1-PO-LN-NBR                PIC S9(3)     VALUE ZEROS    01440001
013600                                                   COMP-3.        01450001
013700     05  O1-ASSOC-QTY                PIC S9(7)     VALUE ZEROS    01460001
013800                                                   COMP-3.        01470001
013900     05  O1-ASDTPL-ALLOC-IND         PIC X(1)      VALUE SPACES.  01480001
014000     05  O1-SHIPT-VAR-QTY            PIC S9(7)     VALUE ZEROS    01490001
014100                                                   COMP-3.        01500001
014200     05  O1-PR-CHG-EFF-DAY-NBR       PIC S9(2)     VALUE ZEROS    01510001
014300                                                   COMP-3.        01520001
014400     05  O1-PR-VAR-IND               PIC X(1)      VALUE SPACES.  01530001
014500     05  O1-PR-DISC-IND              PIC X(1)      VALUE SPACES.  01540001
014600     05  O1-PO-NBR                   PIC X(22)     VALUE SPACES.  01550001
014700     05  O1-ASNHDR-ID                PIC S9(09)    VALUE ZERO     01560001
014800                                                   COMP.          01570001
014900/                                                                 01580001
015000 01  P1-MESSAGE                      PIC X(132)    VALUE SPACES.  01590001
015100 01  PRINT-RECORD-LAYOUT.                                         01600001
015200*    05  FILLER                      PIC X(11)     VALUE          01610001
015300*                                        'OPERCO-NBR='.           01620001
015400*    05  P1-OPERCO-NBR               PIC X(2)      VALUE SPACES.  01630001
015500*    05  FILLER                      PIC X(1)      VALUE SPACES.  01640001
015600*    05  FILLER                      PIC X(12)     VALUE          01650001
015700*                                        'EDI-VEND-ID='.          01660001
015800*    05  P1-EDI-VEND-ID              PIC X(17)     VALUE SPACES.  01670001
015900     05  FILLER                      PIC X(10)     VALUE SPACES.  01680001
016000     05  FILLER                      PIC X(12)     VALUE          01690001
016100                                         'ASNHDR-ID ='.           01700001
016200     05  P1-ASNHDR-ID                PIC 9(09)     VALUE ZERO.    01710001
016300     05  FILLER                      PIC X(1)      VALUE SPACES.  01720001
016400     05  FILLER                      PIC X(12)     VALUE          01730001
016500                                         'ASNDTL-NBR='.           01740001
016600     05  P1-ASNDTL-NBR               PIC  9(7)     VALUE ZEROS.   01750001
016700     05  FILLER                      PIC X(1)      VALUE SPACES.  01760001
016800     05  FILLER                      PIC X(11)     VALUE          01770001
016900                                         'PO-LN-NBR='.            01780001
017000     05  P1-PO-LN-NBR                PIC 9(3)      VALUE ZEROS.   01790001
017100/                                                                 01800001
017200 01  PRINT-MESSAGES.                                              01810001
017300     05  MESSAGE-1                  PIC X(37)     VALUE           01820001
017400         'ASN ITEM DOESN''T EXIST FOR ASDTPL : '.                 01830001
017500     05  MESSAGE-2                  PIC X(37)     VALUE           01840001
017600         'DUPLICATE KEY IS FOUND FOR ASDTPL : '.                  01850001
017700     05  MESSAGE-3.                                               01860001
017800         10  M3-ROWS-INSERTED      PIC  Z(09)9   VALUE ZEROS.     01870001
017900         10  FILLER                PIC  X(01)    VALUE SPACE.     01880001
018000         10  FILLER                PIC  X(120)   VALUE            01890001
018100         'ROWS SUCCESSFULLY INSERTED INTO TASDTPL'.               01900001
018200     05  MESSAGE-4 .                                              01910001
018300         10  M4-ROWS-DELETED       PIC  Z(09)9   VALUE ZEROS.     01920001
018400         10  FILLER                PIC  X(23)   VALUE             01930001
018500         ' DUPLICATES WERE FOUND.'.                               01940001
018600         10  FILLER                PIC  X(01)    VALUE SPACE.     01950001
018700         10  FILLER                PIC  X(120)   VALUE            01960001
018800       'INSERTED ROWS WERE DELETED FROM TASDTPL DUE TO ROLLBACK'. 01970001
018900 01  PRINT-HEADING-LINE.                                          01980001
019000     05  FILLER                      PIC X(40)     VALUE SPACES.  01990001
019100     05  FILLER                      PIC X(42)     VALUE          02000001
019200       'ERRORS/ DUPLICATES REPORT FOR LOAD TASDTPL'.              02010001
019300     05  FILLER                      PIC X(40)     VALUE SPACES.  02020001
019400******************************************************************02030001
019500*       STANDART KOHL'S HEADING                                   02040001
019600******************************************************************02050001
019700*                                                                 02060001
019800     COPY DPWS132O.                                               02070001
019900/                                                                 02080001
020000*                                                                 02090001
020100*  ASN ITEM DETAIL TABLE LAYOUT                                   02100001
020200*                                                                 02110001
020300     EXEC SQL                                                     02120001
020400         INCLUDE TASNDTL                                          02130001
020500     END-EXEC.                                                    02140001
020600*  ASN                                                            02150001
020700*                                                                 02160001
020800     EXEC SQL                                                     02170001
020900         INCLUDE TASNHDR                                          02180001
021000     END-EXEC.                                                    02190001
021100/                                                                 02200001
021200*  MATCH ASN DETAIL ITEM TO THE PO LINE ITEM TABLE LAYOUT         02210001
021300*                                                                 02220001
021400     EXEC SQL                                                     02230001
021500         INCLUDE TASDTPL                                          02240001
021600     END-EXEC.                                                    02250001
021700/                                                                 02260001
021800*  DB2 COMMUNICATION AREA                                         02270001
021900*                                                                 02280001
022000     EXEC SQL                                                     02290001
022100         INCLUDE SQLCA                                            02300001
022200     END-EXEC.                                                    02310001
022300/                                                                 02320001
022400*  DB2 COMMUNICATION AREA2                                        02330001
022500*                                                                 02340001
022600     COPY SQLCA2.                                                 02350001
022700/                                                                 02360001
022800*                                                                 02370001
022900***************************************************************** 02380001
023000*PROCEDURE DIVISION.                                              02390001
023100***************************************************************** 02400001
023200 PROCEDURE DIVISION.                                              02410001
023300*                                                                 02420001
023400*                                                                 02430001
023500 A000-MAINLINE-PROCESSING.                                        02440001
023600*                                                                 02450001
023700     DISPLAY '***********************************'.               02460001
023800     DISPLAY '*         S N K U P 0 3 3         *'.               02470001
023900     DISPLAY '***********************************'.               02480001
024000*                                                                 02490001
024100     MOVE 'A000'                  TO PGM-LOCATION.                02500001
024200     MOVE 'A000-MAINLINE-PROCESSING'                              02510001
024300                                  TO PV-ABEND-PARAGRAPH.          02520001
024400*    DISPLAY PV-ABEND-PARAGRAPH.                                  02530001
024500*                                                                 02540001
024600     OPEN  INPUT ASNDTPL-LOAD-FILE                                02550001
P46103          OUTPUT ASNDTPL-REPORT-FILE                              02560001
P46103                 ASNDTPL-ERR-FILE.                                02570001
024800                                                                  02580001
027600     PERFORM   B000-ACCEPT-DATE-TIME.                             02590001
027700     PERFORM   B200-PROCESS-HEADINGS.                             02600001
027800                                                                  02610001
027900     INITIALIZE INP01-ASNDTPL-LAYOUT.                             02620001
028000                                                                  02630001
028100     PERFORM   B100-READ-ASNDTPL-FILE.                            02640001
P46103*    SET DONT-SET-RET-CODE TO TRUE.                               02650001
028300     PERFORM A100-PROCESS-ASN                                     02660001
028400        UNTIL PS-END-OF-ASNDTPL.                                  02670001
028500****                                                              02680001
028600              EXEC SQL                                            02690001
028700                  COMMIT                                          02700001
028800              END-EXEC                                            02710001
028900                                                                  02720001
029000****                                                              02730001
029100                                                                  02740001
029200     MOVE PV-ASDTPL-WRITTEN TO M3-ROWS-INSERTED.                  02750001
029300                                                                  02760001
029400      WRITE  ASNDTPL-REPORT-LINE                                  02770001
029500       FROM  MESSAGE-3                                            02780001
029600       AFTER ADVANCING  2 LINE.                                   02790001
029700      WRITE  ASNDTPL-REPORT-LINE                                  02800001
029800       FROM  PC-END-OF-REPORT-LINE                                02810001
029900       AFTER ADVANCING  2 LINE.                                   02820001
030000                                                                  02830001
030100*                                                                 02840001
030200*    IF SET-RET-CODE                                              02850001
030300*      EXEC SQL                                                   02860001
030400*           ROLLBACK                                              02870001
030500*      END-EXEC                                                   02880001
030600*       MOVE PV-ASDTPL-DELETED   TO M4-ROWS-DELETED               02890001
030700*                                                                 02900001
030800*        WRITE  ASNDTPL-REPORT-LINE                               02910001
030900*        FROM  MESSAGE-4                                          02920001
031000*        AFTER ADVANCING  2 LINE                                  02930001
031100*    END-IF.                                                      02940001
031200                                                                  02950001
031300     CLOSE ASNDTPL-LOAD-FILE                                      02960001
P46103           ASNDTPL-REPORT-FILE                                    02970001
P46103           ASNDTPL-ERR-FILE.                                      02980001
031500                                                                  02990001
031600     DISPLAY 'ASDTPL RECORDS INSERTED ' PV-ASDTPL-WRITTEN.        03000001
P46103*    IF SET-RET-CODE                                              03010001
P46103*      MOVE +4008 TO RETURN-CODE                                  03020001
P46103*    END-IF.                                                      03030001
032000*                                                                 03040001
032100     STOP RUN.                                                    03050001
032200*                                                                 03060001
032300/                                                                 03070001
032400******************************************************************03080001
032500*  THIS IS THE MAIN CONTROLING PARAGRAPH FOR PROCESSING ASN      *03090001
032600*  INFORMATION.                                                  *03100001
032700******************************************************************03110001
032800 A100-PROCESS-ASN.                                                03120001
032900*                                                                 03130001
033000     MOVE 'A100'                  TO PGM-LOCATION.                03140001
033100     MOVE 'A100-PROCESS-ASN             '                         03150001
033200                                  TO PV-ABEND-PARAGRAPH.          03160001
033300*    DISPLAY PV-ABEND-PARAGRAPH.                                  03170001
033400*                                                                 03180001
033500     SET  PS-ASNDTL-NOT-EXIST   TO TRUE.                          03190001
033600     PERFORM C100-CHECK-IF-TASNDTL-EXIST.                         03200001
033700                                                                  03210001
033800     IF  PS-ASNDTL-EXIST                                          03220001
033900         PERFORM Z100-INSERT-ASNDTPL                              03230001
034000         IF SQLCODE = PC-NEG-803                                  03240001
P46103*           SET SET-RET-CODE TO TRUE                              03250001
P46103            PERFORM B400-WRITE-ERROR-FILE                         03260001
034100            MOVE MESSAGE-2      TO P1-MESSAGE                     03270001
034200            WRITE  ASNDTPL-REPORT-LINE                            03280001
034300            FROM P1-MESSAGE                                       03290001
034400            AFTER ADVANCING  2 LINE                               03300001
034500                                                                  03310001
034600*           MOVE O1-OPERCO-NBR  TO P1-OPERCO-NBR                  03320001
034700*           MOVE O1-EDI-VEND-ID TO P1-EDI-VEND-ID                 03330001
034800*           MOVE O1-ASNHDR-NBR  TO P1-ASNHDR-NBR                  03340001
034900            MOVE O1-ASNHDR-ID   TO P1-ASNHDR-ID                   03350001
035000            MOVE O1-ASNDTL-NBR  TO P1-ASNDTL-NBR                  03360001
035100            MOVE O1-PO-LN-NBR   TO P1-PO-LN-NBR                   03370001
035200            PERFORM B300-WRITE-REPORT-LINE                        03380001
035300            WRITE  ASNDTPL-REPORT-LINE                            03390001
035400            FROM  PC-END-OF-REPORT-LINE                           03400001
035500             AFTER ADVANCING  2 LINE                              03410001
035600             DISPLAY '**************************************'     03420001
035700             DISPLAY 'ERROR ISSUED ON INSERT OF TASDTPL     '     03430001
035800*            DISPLAY 'OPERCO-NBR:         '                       03440001
035900*                         O1-OPERCO-NBR                           03450001
036000*            DISPLAY 'EDI-VEND-ID:   '                            03460001
036100*                         O1-EDI-VEND-ID                          03470001
036200*            DISPLAY 'ASNHDR-NBR:         '                       03480001
036300*                         O1-ASNHDR-NBR                           03490001
036400             DISPLAY 'ASNHDR-ID :         '                       03500001
036500                          O1-ASNHDR-ID                            03510001
036600             DISPLAY 'ASNDTL-NBR:         '                       03520001
036700                          O1-ASNDTL-NBR                           03530001
036800             DISPLAY 'PO-NBR:             '                       03540001
036900                          O1-PO-NBR                               03550001
036910             DISPLAY 'PO-LN-NBR:          '                       03560001
036920                          O1-PO-LN-NBR                            03570001
037000             DISPLAY '**************************************'     03580001
037100*            SET SET-RET-CODE TO TRUE                             03590001
037200*            ADD +1 TO PV-ASDTPL-DELETED                          03600001
037300*            PERFORM Z900-SQL-ERROR                               03610001
037400         ELSE                                                     03620001
037500            IF PV-COMMIT-COUNTER > 500                            03630001
037600              EXEC SQL                                            03640001
037700                  COMMIT                                          03650001
037800              END-EXEC                                            03660001
037900                                                                  03670001
038000              MOVE ZERO TO PV-COMMIT-COUNTER                      03680001
038100                                                                  03690001
038200            END-IF                                                03700001
038300                                                                  03710001
038400         END-IF                                                   03720001
038500     ELSE                                                         03730001
P46103*        SET SET-RET-CODE TO TRUE                                 03740001
P46103         PERFORM B400-WRITE-ERROR-FILE                            03750001
038600         MOVE MESSAGE-1      TO P1-MESSAGE                        03760001
038700            WRITE  ASNDTPL-REPORT-LINE                            03770001
038800            FROM P1-MESSAGE                                       03780001
038900            AFTER ADVANCING  2 LINE                               03790001
039000*        MOVE O1-OPERCO-NBR  TO P1-OPERCO-NBR                     03800001
039100*        MOVE O1-EDI-VEND-ID TO P1-EDI-VEND-ID                    03810001
039200*        MOVE O1-ASNHDR-NBR  TO P1-ASNHDR-NBR                     03820001
039300         MOVE O1-ASNHDR-ID   TO P1-ASNHDR-ID                      03830001
039400         MOVE O1-ASNDTL-NBR  TO P1-ASNDTL-NBR                     03840001
039500         MOVE O1-PO-LN-NBR   TO P1-PO-LN-NBR                      03850001
039600            PERFORM B300-WRITE-REPORT-LINE                        03860001
039700            WRITE  ASNDTPL-REPORT-LINE                            03870001
039800            FROM  PC-END-OF-REPORT-LINE                           03880001
039900             AFTER ADVANCING  2 LINE                              03890001
040000                 DISPLAY '**************************************' 03900001
040100                 DISPLAY 'ERROR ISSUED ON SELECT OF TASNDTL     ' 03910001
040200*                DISPLAY 'OPERCO-NBR:         '                   03920001
040300*                         O1-OPERCO-NBR                           03930001
040400*                DISPLAY 'EDI-VEND-ID:   '                        03940001
040500*                         O1-EDI-VEND-ID                          03950001
040600*                DISPLAY 'ASNHDR-NBR:         '                   03960001
040700*                         O1-ASNHDR-NBR                           03970001
040800                 DISPLAY 'ASNHDR-ID :         '                   03980001
040900                          O1-ASNHDR-ID                            03990001
041000                 DISPLAY 'ASNDTL-NBR:         '                   04000001
041100                          O1-ASNDTL-NBR                           04010001
041200                 DISPLAY 'PO-LN-NBR:          '                   04020001
041300                          O1-PO-LN-NBR                            04030001
041400                 DISPLAY '**************************************' 04040001
041500                 PERFORM Z900-SQL-ERROR                           04050001
041600     END-IF.                                                      04060001
041700                                                                  04070001
041800     INITIALIZE INP01-ASNDTPL-LAYOUT.                             04080001
041900     PERFORM   B100-READ-ASNDTPL-FILE.                            04090001
042000                                                                  04100001
042100                                                                  04110001
042200                                                                  04120001
042300******************************************************************04130001
042400* ACCEPT SYSTEM DATE AND TIME                                    *04140001
042500*                                                                *04150001
042600******************************************************************04160001
042700 B000-ACCEPT-DATE-TIME.                                           04170001
042800*                                                                 04180001
042900     MOVE 'B000'                  TO PGM-LOCATION.                04190001
043000     MOVE 'B000-ACCEPT-DATE-TIME        '                         04200001
043100                                  TO PV-ABEND-PARAGRAPH.          04210001
043200*    DISPLAY PV-ABEND-PARAGRAPH.                                  04220001
043300*                                                                 04230001
043400     ACCEPT CD-CPU-DATE   FROM  DATE.                             04240001
043500      MOVE CD-CPU-DATE-YY   TO DP132O-RUN-YEAR.                   04250001
043600      MOVE CD-CPU-DATE-MM   TO DP132O-RUN-MONTH.                  04260001
043700      MOVE CD-CPU-DATE-DD   TO DP132O-RUN-DAY.                    04270001
043800                                                                  04280001
043900     ACCEPT CT-CPU-TIME   FROM  TIME.                             04290001
044000      MOVE CT-CPU-TIME-HH   TO DP132O-RUN-HOUR.                   04300001
044100      MOVE CD-CPU-DATE-MM   TO DP132O-RUN-MINUTE.                 04310001
044200                                                                  04320001
044300******************************************************************04330001
044400* READS AN INPUT LOAD FILE.                                      *04340001
044500*                                                                *04350001
044600******************************************************************04360001
044700 B100-READ-ASNDTPL-FILE.                                          04370001
044800*                                                                 04380001
044900     MOVE 'B100'                  TO PGM-LOCATION.                04390001
045000     MOVE 'B100-READ-ASNDTPL-FILE       '                         04400001
045100                                  TO PV-ABEND-PARAGRAPH.          04410001
045200*    DISPLAY PV-ABEND-PARAGRAPH.                                  04420001
045300*                                                                 04430001
045400     READ  ASNDTPL-LOAD-FILE                                      04440001
045500           INTO  INP01-ASNDTPL-LAYOUT                             04450001
045600       AT END                                                     04460001
045700           SET  PS-END-OF-ASNDTPL   TO TRUE.                      04470001
045800                                                                  04480001
045900                                                                  04490001
046000******************************************************************04500001
046100* PROCESS HEADINGS.                                              *04510001
046200*                                                                *04520001
046300******************************************************************04530001
046400 B200-PROCESS-HEADINGS.                                           04540001
046500*                                                                 04550001
046600     MOVE 'B200'                  TO PGM-LOCATION.                04560001
046700     MOVE 'B200-PROCESS-HEADINGS        '                         04570001
046800                                  TO PV-ABEND-PARAGRAPH.          04580001
046900*    DISPLAY PV-ABEND-PARAGRAPH.                                  04590001
047000*                                                                 04600001
047100       MOVE 'SNKUP033'  TO  DP132O-PROGRAM-NAME.                  04610001
047200       MOVE 1         TO  DP132O-REPORT-NUMBER.                   04620001
047300       ADD 1          TO  PV-PAGE-CNT.                            04630001
047400       MOVE PV-PAGE-CNT TO DP132O-PAGE-NUMBER.                    04640001
047500                                                                  04650001
047600       WRITE  ASNDTPL-REPORT-LINE                                 04660001
047700        FROM  DP132O-STANDRD-HEADER-132-COLS                      04670001
047800        AFTER ADVANCING  PAGE.                                    04680001
047900                                                                  04690001
048000       WRITE  ASNDTPL-REPORT-LINE                                 04700001
048100        FROM  PRINT-HEADING-LINE                                  04710001
048200        AFTER ADVANCING  1 LINE.                                  04720001
048300                                                                  04730001
048400       MOVE 1         TO  PV-LINE-CNT.                            04740001
048500                                                                  04750001
048600                                                                  04760001
048700******************************************************************04770001
048800* WRITE REPORT LINE                                              *04780001
048900*                                                                *04790001
049000******************************************************************04800001
049100 B300-WRITE-REPORT-LINE.                                          04810001
049200*                                                                 04820001
049300     MOVE 'B300'                  TO PGM-LOCATION.                04830001
049400     MOVE 'B300-WRITE-REPORT-LINE       '                         04840001
049500                                  TO PV-ABEND-PARAGRAPH.          04850001
049600*    DISPLAY PV-ABEND-PARAGRAPH.                                  04860001
049700*                                                                 04870001
049800       ADD 2          TO  PV-LINE-CNT.                            04880001
049900       IF   PV-PAGE-CNT > 54                                      04890001
050000            PERFORM  B200-PROCESS-HEADINGS                        04900001
050100       END-IF.                                                    04910001
050200            WRITE  ASNDTPL-REPORT-LINE                            04920001
050300              FROM  PRINT-RECORD-LAYOUT                           04930001
050400              AFTER ADVANCING  2 LINE.                            04940001
050500                                                                  04950001
P46103******************************************************************04960001
P46103* WRITE ERROR FILE                                               *04970001
P46103******************************************************************04980001
P46103 B400-WRITE-ERROR-FILE.                                           04990001
P46103*                                                                 05000001
P46103     WRITE  ASNDTPL-ERR-RECORD                                    05010001
P46103              FROM  INP01-ASNDTPL-LAYOUT.                         05020001
P46103                                                                  05030001
050600******************************************************************05040001
050700* REFERENTIAL INTEGRITY CHECK FOR TASNDTL                        *05050001
050800*                                                                *05060001
050900*                                                                *05070001
051000******************************************************************05080001
051100 C100-CHECK-IF-TASNDTL-EXIST.                                     05090001
051200                                                                  05100001
051300     PERFORM  D100-SELECT-SQL-TASNDTL.                            05110001
051400                                                                  05120001
051500     IF SQLCODE = +100                                            05130001
051600        SET  PS-ASNDTL-NOT-EXIST   TO TRUE                        05140001
051700     ELSE                                                         05150001
051800        SET  PS-ASNDTL-EXIST   TO TRUE                            05160001
051900     END-IF.                                                      05170001
052000                                                                  05180001
052100******************************************************************05190001
052200* SELECT  TASNDTL                                                *05200001
052300*                                                                *05210001
052400*                                                                *05220001
052500******************************************************************05230001
052600 D100-SELECT-SQL-TASNDTL.                                         05240001
052700                                                                  05250001
052800     PERFORM                                                      05260001
052900         WITH TEST AFTER                                          05270001
053000         VARYING PV-SQL-SUB                                       05280001
053100         FROM 1 BY 1                                              05290001
053200         UNTIL PV-SQL-SUB GREATER THAN  PC-MAX-RETRIES            05300001
053300              OR SQLCODE = 0                                      05310001
053400              OR SQLCODE = +100                                   05320001
053500                                                                  05330001
053600         EXEC SQL                                                 05340001
053700              SELECT                                              05350001
053800                  ASNDTL_NBR,                                     05360001
053900                  ASNHDR_ID                                       05370001
054000              INTO                                                05380001
054100                  :ASNDTL-ASNDTL-NBR,                             05390001
054200                  :ASNDTL-ASNHDR-ID                               05400001
054300              FROM                                                05410001
054400                 TASNDTL                                          05420001
054500              WHERE ASNHDR_ID     = :O1-ASNHDR-ID                 05430001
054600                AND ASNDTL_NBR    = :O1-ASNDTL-NBR                05440001
054700         END-EXEC                                                 05450001
054800                                                                  05460001
054900         EVALUATE TRUE                                            05470001
055000           WHEN SQLCODE = ZERO                                    05480001
055100           WHEN SQLCODE = +100                                    05490001
055200           WHEN SQLCODE = PC-NEG-904                              05500001
055300           WHEN SQLCODE = PC-NEG-913                              05510001
055400               CONTINUE                                           05520001
055500           WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                05530001
055600                 DISPLAY '**************************************' 05540001
055700                 DISPLAY 'WARNING ISSUED ON SELECT OF TASNDTL   ' 05550001
055800*                DISPLAY 'OPERCO-NBR:         '                   05560001
055900*                         O1-OPERCO-NBR                           05570001
056000*                DISPLAY 'EDI-VEND-ID:   '                        05580001
056100*                         O1-EDI-VEND-ID                          05590001
056200*                DISPLAY 'ASNHDR-NBR:         '                   05600001
056300*                         O1-ASNHDR-NBR                           05610001
056400                 DISPLAY 'ASNHDR-ID :         '                   05620001
056500                          O1-ASNHDR-ID                            05630001
056600                 DISPLAY 'ASNDTL-NBR:         '                   05640001
056700                          O1-ASNDTL-NBR                           05650001
056800                 DISPLAY '**********************************'     05660001
056900                 PERFORM Z800-SQL-WARNING                         05670001
057000                                                                  05680001
057100           WHEN  SQLCODE < ZERO                                   05690001
057200                 DISPLAY '**************************************' 05700001
057300                 DISPLAY 'ERROR ISSUED ON SELECT OF TASNDTL     ' 05710001
057400*                DISPLAY 'OPERCO-NBR:         '                   05720001
057500*                         O1-OPERCO-NBR                           05730001
057600*                DISPLAY 'EDI-VEND-ID:   '                        05740001
057700*                         O1-EDI-VEND-ID                          05750001
057800*                DISPLAY 'ASNHDR-NBR:         '                   05760001
057900*                         O1-ASNHDR-NBR                           05770001
058000                 DISPLAY 'ASNHDR-ID :         '                   05780001
058100                          O1-ASNHDR-ID                            05790001
058200                 DISPLAY 'ASNDTL-NBR:         '                   05800001
058300                          O1-ASNDTL-NBR                           05810001
058400                 DISPLAY 'PO-LN-NBR:          '                   05820001
058500                          O1-PO-LN-NBR                            05830001
058600                 DISPLAY '**************************************' 05840001
058700                 PERFORM Z900-SQL-ERROR                           05850001
058800                                                                  05860001
058900         END-EVALUATE                                             05870001
059000     END-PERFORM.                                                 05880001
059100                                                                  05890001
059200                                                                  05900001
059300                                                                  05910001
059400******************************************************************05920001
059500* INSERT TASNDTPL AFTER REFERENTIAL INTEGRITY CHECK IS PERFORMED.*05930001
059600*                                                                *05940001
059700*                                                                *05950001
059800******************************************************************05960001
059900 Z100-INSERT-ASNDTPL.                                             05970001
060000                                                                  05980001
060100                                                                  05990001
060200                                                                  06000001
060300     PERFORM                                                      06010001
060400         WITH TEST AFTER                                          06020001
060500         VARYING PV-SQL-SUB                                       06030001
060600         FROM 1 BY 1                                              06040001
060700         UNTIL PV-SQL-SUB GREATER THAN  PC-MAX-RETRIES            06050001
060800              OR SQLCODE = 0                                      06060001
060900              OR SQLCODE = PC-NEG-803                             06070001
061000                                                                  06080001
061100         EXEC SQL                                                 06090001
061200           INSERT  INTO  TASDTPL                                  06100001
061300            (ASNDTL_NBR,                                          06110001
061400             PO_LN_NBR,                                           06120001
061500             ASSOC_QTY,                                           06130001
061600             ASDTPL_ALLOC_IND,                                    06140001
061700             SHIPT_VAR_QTY,                                       06150001
061800             PR_CHG_EFF_DAY_NBR,                                  06160001
061900             PR_VAR_IND,                                          06170001
062000             PR_DISC_IND,                                         06180001
062100             PO_NBR,                                              06190001
062200             ASNHDR_ID)                                           06200001
062300           VALUES                                                 06210001
062400           (:O1-ASNDTL-NBR,                                       06220001
062500            :O1-PO-LN-NBR,                                        06230001
062600            :O1-ASSOC-QTY,                                        06240001
062700            :O1-ASDTPL-ALLOC-IND,                                 06250001
062800            :O1-SHIPT-VAR-QTY,                                    06260001
062900            :O1-PR-CHG-EFF-DAY-NBR,                               06270001
063000            :O1-PR-VAR-IND,                                       06280001
063100            :O1-PR-DISC-IND,                                      06290001
063200            :O1-PO-NBR,                                           06300001
063300            :O1-ASNHDR-ID)                                        06310001
063400         END-EXEC                                                 06320001
063500                                                                  06330001
063600         EVALUATE TRUE                                            06340001
063700           WHEN SQLCODE = ZERO                                    06350001
063800               ADD 1 TO PV-ASDTPL-WRITTEN                         06360001
063900               ADD 1 TO PV-COMMIT-COUNTER                         06370001
064000           WHEN SQLCODE = PC-NEG-803                              06380001
064100           WHEN SQLCODE = PC-NEG-904                              06390001
064200           WHEN SQLCODE = PC-NEG-913                              06400001
064300               CONTINUE                                           06410001
064400           WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                06420001
064500                 DISPLAY '**************************************' 06430001
064600                 DISPLAY 'WARNING ISSUED ON INSERT OF TASDTPL   ' 06440001
064700*                DISPLAY 'OPERCO-NBR:         '                   06450001
064800*                         O1-OPERCO-NBR                           06460001
064900*                DISPLAY 'EDI-VEND-ID:   '                        06470001
065000*                         O1-EDI-VEND-ID                          06480001
065100*                DISPLAY 'ASNHDR-NBR:         '                   06490001
065200*                         O1-ASNHDR-NBR                           06500001
065300                 DISPLAY 'ASNHDR-ID :         '                   06510001
065400                          O1-ASNHDR-ID                            06520001
065500                 DISPLAY 'ASNDTL-NBR:         '                   06530001
065600                          O1-ASNDTL-NBR                           06540001
065700                 DISPLAY 'PO-LN-NBR:          '                   06550001
065800                          O1-PO-LN-NBR                            06560001
065900                 DISPLAY '**********************************'     06570001
066000                 PERFORM Z800-SQL-WARNING                         06580001
066100                                                                  06590001
066200           WHEN  SQLCODE < ZERO                                   06600001
066300                 DISPLAY '**************************************' 06610001
066400                 DISPLAY 'ERROR ISSUED ON INSERT OF TASDTPL     ' 06620001
066500*                DISPLAY 'OPERCO-NBR:         '                   06630001
066600*                         O1-OPERCO-NBR                           06640001
066700*                DISPLAY 'EDI-VEND-ID:   '                        06650001
066800*                         O1-EDI-VEND-ID                          06660001
066900*                DISPLAY 'ASNHDR-NBR:         '                   06670001
067000*                         O1-ASNHDR-NBR                           06680001
067100                 DISPLAY 'ASNHDR-ID :         '                   06690001
067200                          O1-ASNHDR-ID                            06700001
067300                 DISPLAY 'ASNDTL-NBR:         '                   06710001
067400                          O1-ASNDTL-NBR                           06720001
067500                 DISPLAY 'PO-LN-NBR:          '                   06730001
067600                          O1-PO-LN-NBR                            06740001
067700                 DISPLAY '**************************************' 06750001
067800                 PERFORM Z900-SQL-ERROR                           06760001
067900                                                                  06770001
068000                                                                  06780001
068100         END-EVALUATE                                             06790001
068200     END-PERFORM.                                                 06800001
068300                                                                  06810001
068400     IF PV-SQL-SUB >  PC-MAX-RETRIES                              06820001
068500                 DISPLAY '**************************************' 06830001
068600                 DISPLAY 'ERROR ISSUED ON INSERT OF TASDTPL     ' 06840001
068700                 DISPLAY 'ASNHDR-ID :         '                   06850001
068800                          O1-ASNHDR-ID                            06860001
068900                 DISPLAY 'ASNDTL-NBR:         '                   06870001
069000                          O1-ASNDTL-NBR                           06880001
069100                 DISPLAY 'PO-LN-NBR:          '                   06890001
069200                          O1-PO-LN-NBR                            06900001
069300                 DISPLAY '**************************************' 06910001
069400                 PERFORM Z900-SQL-ERROR                           06920001
069500     END-IF.                                                      06930001
069600                                                                  06940001
069700******************************************************************06950001
069800                                                                  06960001
069900******************************************************************06970001
070000*     SQL WARNING OR ERROR PROCESSING                            *06980001
070100*                                                                *06990001
070200******************************************************************07000001
070300                                                                  07010001
070400 Z800-SQL-WARNING.                                                07020001
070500*-----------------                                                07030001
070600                                                                  07040001
070700     MOVE SQLCODE    TO SQLCODE2.                                 07050001
070800     MOVE SQLERRD(3) TO SQLERRD3.                                 07060001
070900     DISPLAY '** ABEND **       ** = SQLWARNING'.                 07070001
071000     DISPLAY '** PROGRAM        ** = SNKUP033'.                   07080001
071100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07090001
071200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07100001
071300     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  07110001
071400     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  07120001
071500     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  07130001
071600     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  07140001
071700     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  07150001
071800     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  07160001
071900     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  07170001
072000     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  07180001
072100                                                                  07190001
072200     EXEC SQL                                                     07200001
072300         ROLLBACK                                                 07210001
072400     END-EXEC.                                                    07220001
072500                                                                  07230001
072600     MOVE +4013 TO PV-ABEND-CODE.                                 07240001
072700     CALL PC-ILBOABN0 USING PV-ABEND-CODE.                        07250001
072800*                                                                 07260001
072900 Z900-SQL-ERROR.                                                  07270001
073000*---------------                                                  07280001
073100                                                                  07290001
073200     MOVE SQLCODE    TO SQLCODE2.                                 07300001
073300     MOVE SQLERRD(3) TO SQLERRD3.                                 07310001
073400     DISPLAY '** ABEND **       ** = SQLERROR'.                   07320001
073500     DISPLAY '** PROGRAM        ** = SNKUP033'.                   07330001
073600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07340001
073700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07350001
073800     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   07360001
073900     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  07370001
074000                                                                  07380001
074100     EXEC SQL                                                     07390001
074200         ROLLBACK                                                 07400001
074300     END-EXEC.                                                    07410001
074400                                                                  07420001
074500     MOVE +4013 TO PV-ABEND-CODE.                                 07430001
074600     CALL PC-ILBOABN0 USING PV-ABEND-CODE.                        07440001
074700*                                                                 07450001
