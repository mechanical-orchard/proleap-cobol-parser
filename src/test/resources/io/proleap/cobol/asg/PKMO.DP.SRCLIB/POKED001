000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKED001.                                         00020000
000300 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN.  05/94.                                            00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* THIS PROGRAM WILL DETERMINE ALL PURCHASE ORDERS NEEDING TO BE   00080000
000900* RELEASED AND CREATES INTO A FILE A JCL JOB FOR EACH PO          00090000
001000******************************************************************00100000
001100* DATE  12/28/01  MIKE FRIESS (TKMA508)                          *00110000
001200*   WR21351 ADD PO BRIDGE MQ AND ERROR HANDLING LOGIC.           *00120000
001300******************************************************************00130000
001400* DATE  05/02/03  VISWA KARUTURI (TKMA643)                       *00140000
001500*   WR23521 CHANGED TO UPDATE RLSE_IND (PARA 1225-UPDATE-RLSE)   *00150000
001600*           ONLY IF PO ENTRY IS NOT IN RMS.                      *00160000
001700******************************************************************00170000
001400* DATE  10/20/03  RYAN STAUFFACHER (TKMA609)                     *00180000
001500*   WR23521 REMOVED CALL TO PARA 1225-.  WILL NOW UPDATE RELEASE *00190000
001600*           INDICATOR NO MATTER WHERE ENTRY IS. ALSO REMOVED     *00200000
001600*           UNNCESSARY CALL TO 8600-CHECK-RLOUT-CTL-TABLE.       *00210000
001700******************************************************************00220000
001400* DATE  01/07/04  RYAN STAUFFACHER (TKMA609)                     *00230000
001500*   P622012 ADDED CHECK THAT PACK BY STORE ORDERS MUST BE FULLY  *00240000
001600*           ALLOCATED TO BE RELEASED                             *00250000
001700******************************************************************00260000
006900* DATE  08/01/11  COGNIZANT (KARTHIK) TKMAZ10                    *00270000
000900*   CR7896  FIXED UNWANTED ' IN THE BUYER NAME FIELD. WHEN BUYER *00280000
000900*           NAME CONTAINS ' IN IT, THE JCL CREATED DYNAMICALLY   *00290000
000900*           WILL FAIL WITH JCL ERROR. HERE ' WILL BE REPLACED    *00300000
000900*           WITH _                                               *00310000
000900*           CHANGED PARA 7300-GET-BUYER-NAME                     *00320000
000900*                                                                *00330000
000900*           EXAMPLE:                                             *00340000
000900*           --------                                             *00350000
000900*           NAME='STEVE O'BRIEN            ',                    *00360000
000900*              WILL BE REPLACED WITH                             *00370000
000900*           NAME='STEVE O_BRIEN            ',                    *00380000
000900*                                                                *00390000
      ******************************************************************00400000
      * DATE  04/16/12  COGNIZANT (RAMYA KAVERI) TKMAYZ2                00410000
      *   PE9933  PROGRAM HAS BEEN MODIFIED TO HANDLE INVALID PURCHASE  00420000
      *           ORDERS.                                               00430000
001700******************************************************************00440000
P5207 * DATE  11/18/13  COGNIZANT (SHEBENA ) TKMAKZD                    00441003
P5207 *   P5207   PROGRAM HAS BEEN MODIFIED TO COMMENT OUT THE MQ       00442003
P5207 *           DECLARATIONS, RELATED COPYBOOKS AND PROGRAM CALL      00443003
P5207 *           POKUT074. CR NO - CHG0081355, CHANGE TAG : P5207      00443106
P5207 ******************************************************************00444003
001800 ENVIRONMENT DIVISION.                                            00450000
001900 CONFIGURATION SECTION.                                           00460000
002000 SOURCE-COMPUTER. IBM-3090.                                       00470000
002100 OBJECT-COMPUTER. IBM-3090.                                       00480000
002200 INPUT-OUTPUT SECTION.                                            00490000
002300 FILE-CONTROL.                                                    00500000
002400                                                                  00510000
002500     SELECT OUTPUT-FILE                                           00520000
002600         ASSIGN TO OUT01.                                         00530000
002700                                                                  00540000
002800******************************************************************00550000
002900 DATA DIVISION.                                                   00560000
003000******************************************************************00570000
003100 FILE SECTION.                                                    00580000
003200                                                                  00590000
003300 FD  OUTPUT-FILE                                                  00600000
003400     RECORDING MODE F                                             00610000
003500     BLOCK CONTAINS 0 RECORDS                                     00620000
003600     RECORD CONTAINS 80 CHARACTERS                                00630000
003700     LABEL RECORDS ARE OMITTED                                    00640000
003800     DATA RECORD IS OUTPUT-RECORD.                                00650000
003900 01  OUTPUT-RECORD                    PIC  X(80).                 00660000
004000                                                                  00670000
004100 WORKING-STORAGE SECTION.                                         00680000
004200                                                                  00690000
004300 01  CR-CONTROL-RECORD.                                           00700000
004400     05  CR-JOB-RUN-IND               PIC  X(04).                 00710000
004500         88  CR-PROD-RUN                   VALUE 'PROD'.          00720000
004600         88  CR-TEST-RUN                   VALUE 'TEST'.          00730000
004700     05  CR-TEST-USERID               PIC  X(07).                 00740000
004800     05  FILLER                       PIC  X(69).                 00750000
004900                                                                  00760000
005000 01  PS-PROGRAM-SWITCHES.                                         00770000
005100     05  PS-EOF-PO-CSR-SW             PIC  X(01) VALUE 'N'.       00780000
005200         88  PS-EOF-PO-CSR                       VALUE 'Y'.       00790000
005600     05  PS-PBS-ORDER-SW              PIC  X(01) VALUE 'N'.       00860000
005700         88  PS-PBS-ORDER                        VALUE 'Y'.       00870000
005800         88  PS-NOT-PBS-ORDER                    VALUE 'N'.       00880000
005900                                                                  00890000
006000                                                                  00900000
006100 01  PV-PROGRAM-VARIABLES.                                        00910000
006200     05  PV-CURRENT-DATE              PIC  X(10) VALUE SPACES.    00920000
006300     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    00930000
006400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE SPACES.    00940000
006500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00950000
006600                                                 COMP.            00960000
006700     05  PV-DB2-COUNT1                PIC S9(04) VALUE +0         00970000
006800                                                 COMP.            00980000
006900     05  PV-DB2-COUNT2                PIC S9(04) VALUE +0         00990000
007000                                                 COMP.            01000000
007100     05  PV-DB2-COUNT3                PIC S9(04) VALUE +0         01010000
007200                                                 COMP.            01020000
007100     05  PV-DB2-COUNT4                PIC S9(04) VALUE +0         01030000
007200                                                 COMP.            01040000
PE9933     05  PV-DB2-COUNT5                PIC S9(04) VALUE +0         01050000
PE9933                                                 COMP.            01060000
007500     05  PV-LAST-UPD-TMESTMP          PIC  X(26).                 01090000
007600     05  PV-TEST-JOB-POK902.                                      01100000
007700         10  PV-TEST-JOB-USER-ID  PIC  X(07).                     01110000
007800         10  FILLER               PIC  X(01)  VALUE 'T'.          01120000
007900     05  PV-BUYER-NAME                PIC  X(25).                 01130000
008000     05  PV-BUYER-NUMBER              PIC  X(03).                 01140000
008100     05  PV-BUYER.                                                01150000
008200         10  FILLER                   PIC  X(01)  VALUE 'B'.      01160000
008300         10  PV-BYR-NBR               PIC  X(03).                 01170000
008400         10  FILLER                   PIC  X(03)  VALUE '   '.    01180000
008500         10  PV-BYR-NAME              PIC  X(25).                 01190000
004500     05  PV-DEPT-NBR                  PIC S9(4)V VALUE  0         01200000
004600                                                 COMP-3.          01210000
008800 01  PC-PROGRAM-CONSTANTS.                                        01220000
008900     05  PC-PGM-NAME              PIC  X(08)  VALUE  'POKED001'.  01230000
009100     05  PC-PROD-JOB-POK902       PIC  X(08)  VALUE  'POK902  '.  01250000
009200     05  PC-PROD-CLASS.                                           01260000
009300         10  FILLER               PIC  X(36)  VALUE               01270000
009400         '//      CLASS=Q,MSGCLASS=P,REGION=3M'.                  01280000
009500         10  FILLER               PIC  X(44)  VALUE  SPACES.      01290000
009600     05  PC-PROD-LIBSRCH.                                         01300000
009700         10  FILLER               PIC  X(40)  VALUE               01310000
009800         '//*                                    '.               01320000
009900         10  FILLER               PIC  X(40)  VALUE SPACES.       01330000
010000     05  PC-PROD-JOB-PARM.                                        01340000
010100         10  FILLER               PIC  X(03)  VALUE  '//*'.       01350000
010200         10  FILLER               PIC  X(77)  VALUE  SPACES.      01360000
010300     05  PC-PROD-JOBLIB.                                          01370000
010400         10  FILLER               PIC  X(39)  VALUE               01380000
010500         '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.               01390000
010600         10  FILLER               PIC  X(41)  VALUE  SPACES.      01400000
010700     05  PC-PROD-JOBOUT1.                                         01410000
010800         10  FILLER               PIC  X(48)  VALUE               01420000
010900         '//JOBOUT02 OUTPUT FORMDEF=L1S4PO,PAGEDEF=L1S4PO,'.      01430000
011000         10  FILLER               PIC  X(32)  VALUE  SPACES.      01440000
011100     05  PC-PROD-JOBOUT2.                                         01450000
011200         10  FILLER               PIC  X(41)  VALUE               01460000
011300         '//         USERLIB=(SYS2.AFPTEST.FDEFLIB,'.             01470000
011400         10  FILLER               PIC  X(39)  VALUE               01480000
011500         'SYS2.AFPTEST.PDEFLIB),                 '.               01490000
011600     05  PC-PROD-JOBOUT3.                                         01500000
011700         10  FILLER               PIC  X(16)  VALUE               01510000
011800         '//         NAME='.                                      01520000
011900         10  FILLER               PIC  X(01)  VALUE  QUOTE.       01530000
012000         10  PV-PROD-BYR-NAME     PIC  X(25).                     01540000
012100         10  FILLER               PIC  X(01)  VALUE  QUOTE.       01550000
012200         10  FILLER               PIC  X(01)  VALUE  ','.         01560000
012300         10  FILLER               PIC  X(36)  VALUE  SPACES.      01570000
012400     05  PC-PROD-JOBOUT4.                                         01580000
012500         10  FILLER               PIC  X(19)  VALUE               01590000
012600         '//         ADDRESS='.                                   01600000
012700         10  FILLER               PIC  X(01)  VALUE  QUOTE.       01610000
012800         10  PV-PROD-BYR-NAME-NO  PIC  X(32).                     01620000
012900         10  FILLER               PIC  X(01)  VALUE  QUOTE.       01630000
013000         10  FILLER               PIC  X(27)  VALUE  SPACES.      01640000
013100     05  PC-PROD-PROC-SI.                                         01650000
013200         10  FILLER               PIC  X(30)  VALUE               01660000
013300         '//PS010    EXEC POK9021,SOPT=0'.                        01670000
013400         10  FILLER               PIC  X(50)  VALUE  SPACES.      01680000
013500     05  PC-PROD-PROC-SI-PK.                                      01690000
013600         10  FILLER               PIC  X(30)  VALUE               01700000
013700         '//PS010    EXEC POK9021,SOPT=1'.                        01710000
013800         10  FILLER               PIC  X(50)  VALUE  SPACES.      01720000
013900     05  PC-TEST-CLASS.                                           01730000
014000         10  FILLER               PIC  X(44)  VALUE               01740000
014100         '//      CLASS=A,MSGCLASS=X,REGION=3M,NOTIFY='.          01750000
014200         10  PC-TEST-NOTIFY-ID    PIC  X(07).                     01760000
014300         10  FILLER               PIC  X(29)  VALUE SPACES.       01770000
014400*        ',TYPRUN=HOLD                 '.                         01780000
014500     05  PC-TEST-LIBSRCH.                                         01790000
014600         10  FILLER               PIC  X(40)  VALUE               01800000
014700         '//LIBSRCH  JCLLIB ORDER=TKMA.PROCLIB    '.              01810000
014800         10  FILLER               PIC  X(40)  VALUE  SPACES.      01820000
014900     05  PC-TEST-JOB-PARM.                                        01830000
015000         10  FILLER               PIC  X(18)  VALUE               01840000
015100         '/*JOBPARM P=PROC01'.                                    01850000
015200         10  FILLER               PIC  X(62)  VALUE  SPACES.      01860000
015300     05  PC-TEST-JOBLIB.                                          01870000
015400         10  FILLER               PIC  X(39)  VALUE               01880000
015500         '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.               01890000
015600         10  FILLER               PIC  X(41)  VALUE  SPACES.      01900000
015700     05  PC-TEST-JOBOUT1.                                         01910000
015800         10  FILLER               PIC  X(46)  VALUE               01920000
015900         '//JOBOUT02 OUTPUT CLASS=L,FORMS=8050,COPIES=1,'.        01930000
016000         10  FILLER               PIC  X(35)  VALUE  SPACES.      01940000
016100     05  PC-TEST-JOBOUT2A.                                        01950000
016200         10  FILLER               PIC  X(46)  VALUE               01960000
016300         '//         FORMDEF=L1S4PO,PAGEDEF=L1S4PO,     '.        01970000
016400         10  FILLER               PIC  X(32)  VALUE  SPACES.      01980000
016500     05  PC-TEST-JOBOUT2B.                                        01990000
016600         10  FILLER               PIC  X(41)  VALUE               02000000
016700         '//         USERLIB=(SYS2.AFPTEST.FDEFLIB,'.             02010000
016800         10  FILLER               PIC  X(39)  VALUE               02020000
016900         'SYS2.AFPTEST.PDEFLIB)                  '.               02030000
017000     05  PC-TEST-JOBOUT3.                                         02040000
017100         10  FILLER               PIC  X(03)  VALUE  '//*'.       02050000
017200         10  FILLER               PIC  X(77)  VALUE  SPACES.      02060000
017300     05  PC-TEST-PROC-SI.                                         02070000
017400         10  FILLER               PIC  X(30)  VALUE               02080000
017500         '//PS010    EXEC POK9021,SOPT=0'.                        02090000
017600         10  FILLER               PIC  X(50)  VALUE  SPACES.      02100000
017700     05  PC-TEST-PROC-SI-PK.                                      02110000
017800         10  FILLER               PIC  X(30)  VALUE               02120000
017900         '//PS010    EXEC POK9021,SOPT=1'.                        02130000
018000         10  FILLER               PIC  X(50)  VALUE  SPACES.      02140000
018100*                                                                 02150000
018200                                                                  02160000
018300                                                                  02170000
018400 01  JL-JCL-LINE-AREA.                                            02180000
018500     05  JL-JCL-LINE-1.                                           02190000
018600         10  FILLER               PIC  X(02)  VALUE '//'.         02200000
018700         10  JL-JOB-NAME          PIC  X(08).                     02210000
018800         10  FILLER               PIC  X(11)  VALUE               02220000
018900         ' JOB KOHLS,'.                                           02230000
019000         10  FILLER               PIC  X(01)  VALUE QUOTE.        02240000
019100         10  FILLER               PIC  X(20)  VALUE               02250000
019200         'PO SHIP INSTRUCTIONS'.                                  02260000
019300         10  FILLER               PIC  X(01)  VALUE QUOTE.        02270000
019400         10  FILLER               PIC  X(01)  VALUE ','.          02280000
019500         10  FILLER               PIC  X(36)  VALUE SPACES.       02290000
019600     05  JL-JCL-LINE-2.                                           02300000
019700         10  JL-JCL-CLASS         PIC  X(80).                     02310000
019800********************************************************          02320000
019900*   LINE 2T IS USED WHEN TESTING A PROC IN TKMA.PROCLIB           02330000
020000*   COMMENT THIS OUT FOR PRODUCTION RUN.                          02340000
020100********************************************************          02350000
020200     05  JL-JCL-LINE-2T.                                          02360000
020300         10  JL-JCL-LIBSRCH       PIC  X(80).                     02370000
020400     05  JL-JCL-LINE-3.                                           02380000
020500         10  JL-JCL-JOB-PARM      PIC  X(80).                     02390000
020600     05  JL-JCL-LINE-4.                                           02400000
020700         10  FILLER               PIC  X(40)  VALUE               02410000
020800         '//**************************************'.              02420000
020900         10  FILLER               PIC  X(40)  VALUE               02430000
021000         '****************************************'.              02440000
021100     05  JL-JCL-LINE-5.                                           02450000
021200         10  FILLER               PIC  X(40)  VALUE               02460000
021300         '//**   JOB WILL PRODUCE SHIPPING INSTRUC'.              02470000
021400         10  FILLER               PIC  X(40)  VALUE               02480000
021500         'TIONS FOR A PURCHASE ORDER              '.              02490000
021600     05  JL-JCL-LINE-6.                                           02500000
021700         10  FILLER               PIC  X(40)  VALUE               02510000
021800         '//**************************************'.              02520000
021900         10  FILLER               PIC  X(40)  VALUE               02530000
022000         '****************************************'.              02540000
022100     05  JL-JCL-LINE-7.                                           02550000
022200         10  JL-JCL-JOBLIB        PIC  X(80).                     02560000
022300     05  JL-JCL-LINE-8.                                           02570000
022400         10  JL-JCL-OUTPUT1       PIC  X(80).                     02580000
022500     05  JL-JCL-LINE-9.                                           02590000
022600         10  JL-JCL-OUTPUT2       PIC  X(80).                     02600000
022700     05  JL-JCL-LINE-10.                                          02610000
022800         10  JL-JCL-OUTPUT3       PIC  X(80).                     02620000
022900     05  JL-JCL-LINE-11.                                          02630000
023000         10  JL-JCL-OUTPUT4       PIC  X(80).                     02640000
023100     05  JL-JCL-LINE-12.                                          02650000
023200         10  JL-JCL-PROC          PIC  X(80).                     02660000
023300     05  JL-JCL-LINE-13.                                          02670000
023400         10  FILLER               PIC  X(21)  VALUE               02680000
023500         '//S010.SYSUT1   DD * '.                                 02690000
023600         10  FILLER               PIC  X(59)  VALUE SPACES.       02700000
023700     05  JL-JCL-LINE-14.                                          02710000
023800         10  JL-PO-NBR            PIC S9(09)  COMP.               02720000
023900         10  JL-PRINT-TYPE-BY     PIC  X(02).                     02730000
024000         10  JL-PRINT-TYPE-VN     PIC  X(02).                     02740000
024100         10  JL-PRINT-TYPE-DC     PIC  X(02).                     02750000
024200         10  JL-PRINT-TYPE-AN     PIC  X(02).                     02760000
024300         10  FILLER               PIC  X(68)  VALUE SPACES.       02770000
024400     05  JL-JCL-LINE-15.                                          02780000
024500         10  FILLER               PIC  X(02)  VALUE '/*'.         02790000
024600         10  FILLER               PIC  X(78)  VALUE SPACES.       02800000
024700     05  JL-JCL-LINE-16.                                          02810000
024800         10  FILLER               PIC  X(03)  VALUE '//*'.        02820000
024900         10  FILLER               PIC  X(77)  VALUE SPACES.       02830000
025000     05  JL-JCL-LINE-EOF.                                         02840000
025100         10  FILLER               PIC  X(05)  VALUE '/*EOF'.      02850000
025200         10  FILLER               PIC  X(75)  VALUE SPACES.       02860000
025300 01  JL-JCL-LINE-TABLE            REDEFINES JL-JCL-LINE-AREA.     02870000
025400     05  JL-JCL-LINE              OCCURS 17 TIMES                 02880000
025500                                  INDEXED BY JL-LINE-INDEX        02890000
025600                                  PIC X(80).                      02900000
032300                                                                  03570000
036800                                                                  04020000
037100******************************************************************04050000
037200*  COMMUNICATIONS AREA2 FOR DB2                                   04060000
037300******************************************************************04070000
037400     COPY SQLCA2.                                                 04080000
037500                                                                  04090000
037600                                                                  04100000
037700******************************************************************04110000
037800*  COMMUNICATIONS AREA FOR DB2                                    04120000
037900******************************************************************04130000
038000     EXEC SQL                                                     04140000
038100          INCLUDE SQLCA                                           04150000
038200     END-EXEC.                                                    04160000
038300******************************************************************04170000
038400*  COPY BOOK FOR PURCHASE ORDER TABLE                             04180000
038500******************************************************************04190000
038600     EXEC SQL                                                     04200000
038700          INCLUDE TPURCHS                                         04210000
038800     END-EXEC.                                                    04220000
038900******************************************************************04230000
039000*  COPY BOOK FOR VENDOR TABLE                                     04240000
039100******************************************************************04250000
039200     EXEC SQL                                                     04260000
039300          INCLUDE TEXTENT                                         04270000
039400     END-EXEC.                                                    04280000
039500******************************************************************04290000
039600*  COPY BOOK FOR VENDOR AGREEMENT TABLE                           04300000
039700******************************************************************04310000
039800     EXEC SQL                                                     04320000
039900          INCLUDE TVNDAGR                                         04330000
040000     END-EXEC.                                                    04340000
040100******************************************************************04350000
040200*  COPY BOOK FOR PLANNED SHIPMENT TABLE                           04360000
040300******************************************************************04370000
040400     EXEC SQL                                                     04380000
040500          INCLUDE TPLNSHP                                         04390000
040600     END-EXEC.                                                    04400000
040700******************************************************************04410000
040800*  COPY BOOK FOR PURCHASE ITEM TABLE                              04420000
040900******************************************************************04430000
041000     EXEC SQL                                                     04440000
041100          INCLUDE TPURITM                                         04450000
041200     END-EXEC.                                                    04460000
041300******************************************************************04470000
041400*  COPY BOOK FOR PO STATUS CODES                                  04480000
041500******************************************************************04490000
041600     EXEC SQL                                                     04500000
041700          INCLUDE TALLPLN                                         04510000
041800     END-EXEC.                                                    04520000
041900******************************************************************04530000
042000*  COPY BOOK FOR TMDSEAR                                          04540000
042100******************************************************************04550000
042200     EXEC SQL                                                     04560000
042300          INCLUDE TMDSEAR                                         04570000
042400     END-EXEC.                                                    04580000
042500******************************************************************04590000
042600*  COPY BOOK FOR TRSPBAR                                          04600000
042700******************************************************************04610000
042800     EXEC SQL                                                     04620000
042900          INCLUDE TRSPBAR                                         04630000
043000     END-EXEC.                                                    04640000
042500******************************************************************04650000
042600*  COPY BOOK FOR TMESTDS                                          04660000
042700******************************************************************04670000
042800     EXEC SQL                                                     04680000
042900          INCLUDE TMESTDS                                         04690000
043000     END-EXEC.                                                    04700000
042500******************************************************************04710000
042600*  COPY BOOK FOR TPOAGMT                                          04720000
042700******************************************************************04730000
042800     EXEC SQL                                                     04740000
042900          INCLUDE TPOAGMT                                         04750000
043000     END-EXEC.                                                    04760000
042500******************************************************************04770000
042600*  COPY BOOK FOR SYSDUMMY                                         04780000
042700******************************************************************04790000
042800     EXEC SQL                                                     04800000
042900          INCLUDE SYSDUMMY                                        04810000
043000     END-EXEC.                                                    04820000
043100******************************************************************04830000
043200*  COPY BOOK FOR POT00002                                         04840000
043300******************************************************************04850000
043400     EXEC SQL                                                     04860000
043500          INCLUDE POT00002                                        04870000
043600     END-EXEC.                                                    04880000
043700******************************************************************04890000
043800*    DB2 DCLGEN FOR RMS ROLLOUT CONTROL TABLE POT_RMS_RLOUT_CTL   04900000
043900******************************************************************04910000
044000     EXEC SQL                                                     04920000
044100         INCLUDE POT00006                                         04930000
044200     END-EXEC.                                                    04940000
044300******************************************************************04950000
044400*  CURSOR FOR PURCHASE ORDERS                                     04960000
044500******************************************************************04970000
044600     EXEC SQL                                                     04980000
044700         DECLARE PO-CSR CURSOR FOR                                04990000
044800         SELECT DISTINCT                                          05000000
044900                A.PO_NBR                                          05010000
045000               ,A.EDI_IND                                         05020000
045100               ,A.DEPT_NBR                                        05030000
045200               ,A.PKGNG_CDE                                       05040000
045300           FROM TPURCHS A                                         05050000
045400               ,TVNDAGR B                                         05060000
045500               ,TPLNSHP C                                         05070000
045600          WHERE   A.RLSE_IND       = 'N'                          05080000
                  AND   A.EDI_IND        = 'N'                          05090000
045700            AND   A.STATUS_CDE    IN ('AP', 'AC')                 05100000
045800            AND   A.VER_STATUS_CDE = 'A'                          05110000
045900            AND   A.PO_CATEG_CDE   = 'MR'                         05120000
046000            AND   A.PO_TYP_CDE NOT IN ('AP','IM','IE','IF','CD')  05130000
046100            AND   A.ENT_ID         = B.ENT_ID                     05140000
046200            AND   A.DEPT_NBR       = B.DEPT_NBR                   05150000
046300            AND   B.AGRMT_TYP_ID   = '6'                          05160000
046400            AND   B.TYP_CDE        =  5                           05170000
046500            AND   B.EFFECTIVE_DATE  <= CURRENT DATE               05180000
046600            AND   B.EXPIRATION_DATE >  CURRENT DATE               05190000
046700            AND   A.PO_NBR         = C.PO_NBR                     05200000
046800            AND   C.VER_STATUS_CDE = 'A'                          05210000
046900            AND   (CURRENT DATE                                   05220000
047000                   + B.LEADTIME_DAYS_QTY DAYS                     05230000
047100                   + 0 DAYS                                       05240000
047200                   >= C.DONT_SHIP_BEF_DTE)                        05250000
               UNION                                                    05260000
                                                                        05270000
044800         SELECT DISTINCT                                          05280000
044900                A.PO_NBR                                          05290000
045000               ,A.EDI_IND                                         05300000
045100               ,A.DEPT_NBR                                        05310000
045200               ,A.PKGNG_CDE                                       05320000
045300           FROM TPURCHS A                                         05330000
                WHERE A.RLSE_DTE    = '4000-04-04' AND                  05340000
                      A.OTB_PER_NBR > '200300'     AND                  05350000
                      A.VER_STATUS_CDE = 'A'       AND                  05360000
                      A.EDI_IND        = 'N'                            05370000
047300     END-EXEC.                                                    05380000
047400                                                                  05390000
047500 PROCEDURE DIVISION.                                              05400000
047600                                                                  05410000
047700******************************************************************05420000
047800*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   05430000
047900******************************************************************05440000
048000 0000-MAINLINE.                                                   05450000
048100                                                                  05460000
048200     OPEN OUTPUT OUTPUT-FILE.                                     05470000
048300     ACCEPT CR-CONTROL-RECORD.                                    05480000
048400                                                                  05490000
048700     PERFORM 1005-CURRENT-DATE.                                   05520000
048800                                                                  05530000
048900     PERFORM 1100-OPEN-PO-CSR.                                    05540000
049000     PERFORM 1200-PROCESS-PO-CSR                                  05550000
049100         UNTIL PS-EOF-PO-CSR.                                     05560000
049200     PERFORM 1300-CLOSE-PO-CSR.                                   05570000
049300                                                                  05580000
050100     CLOSE OUTPUT-FILE.                                           05660000
050200                                                                  05670000
050300     STOP RUN.                                                    05680000
050400                                                                  05690000
050500******************************************************************05700000
050600* GET CURRENT DATE FROM DB-2                                      05710000
050700******************************************************************05720000
050800 1005-CURRENT-DATE.                                               05730000
050900     EXEC SQL                                                     05740000
051000         SELECT                                                   05750000
051100         CURRENT DATE                                             05760000
051200         INTO :PV-CURRENT-DATE                                    05770000
051300         FROM TCOCNTL                                             05780000
051400     END-EXEC                                                     05790000
051500                                                                  05800000
051600     EVALUATE TRUE                                                05810000
051700         WHEN SQLCODE = ZERO                                      05820000
051800         WHEN SQLCODE = -811                                      05830000
051900             CONTINUE                                             05840000
052000         WHEN SQLWARN0 NOT = SPACES                               05850000
052100         WHEN SQLCODE NOT = +0                                    05860000
052200            MOVE '1005-CURRENT-DATE'                              05870000
052300                                  TO PV-ABEND-PARAGRAPH           05880000
052400            MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM     05890000
052500            MOVE SQLCODE                  TO SQLCODE2             05900000
052600            MOVE SQLERRD(3)               TO SQLERRD3             05910000
052700            PERFORM 9000-SQL-ABEND                                05920000
052800     END-EVALUATE.                                                05930000
052900                                                                  05940000
053000******************************************************************05950000
053100*  OPENS PO CSR                                                   05960000
053200******************************************************************05970000
053300 1100-OPEN-PO-CSR.                                                05980000
053400                                                                  05990000
053500     EXEC SQL                                                     06000000
053600         OPEN PO-CSR                                              06010000
053700     END-EXEC.                                                    06020000
053800                                                                  06030000
053900     EVALUATE TRUE                                                06040000
054000         WHEN SQLCODE = +0                                        06050000
054100             CONTINUE                                             06060000
054200         WHEN SQLWARN NOT = SPACE                                 06070000
054300         WHEN SQLCODE NOT = +0                                    06080000
054400             MOVE '1100-OPEN-PO-CSR'                              06090000
054500                                   TO PV-ABEND-PARAGRAPH          06100000
054600             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    06110000
054700             MOVE SQLCODE                  TO SQLCODE2            06120000
054800             MOVE SQLERRD(3)               TO SQLERRD3            06130000
054900             PERFORM 9000-SQL-ABEND                               06140000
055000     END-EVALUATE.                                                06150000
055100                                                                  06160000
055200                                                                  06170000
055300******************************************************************06180000
055400*  PROCESS PO CSR                                                 06190000
055500******************************************************************06200000
055600 1200-PROCESS-PO-CSR.                                             06210000
055700                                                                  06220000
055800     EXEC SQL                                                     06230000
055900         FETCH PO-CSR                                             06240000
056000         INTO  :PURCHS-PO-NBR                                     06250000
056100              ,:PURCHS-EDI-IND                                    06260000
056200              ,:PURCHS-DEPT-NBR                                   06270000
056300              ,:PURCHS-PKGNG-CDE                                  06280000
056400     END-EXEC.                                                    06290000
056500                                                                  06300000
056600     EVALUATE TRUE                                                06310000
056700         WHEN SQLCODE = +0                                        06320000
056800         WHEN SQLCODE = +100                                      06330000
056900             CONTINUE                                             06340000
057000         WHEN SQLWARN NOT = SPACE                                 06350000
057100         WHEN SQLCODE NOT = +0                                    06360000
057200             MOVE '1200-PROCESS-PO-CSR'                           06370000
057300                                   TO PV-ABEND-PARAGRAPH          06380000
057400             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    06390000
057500             MOVE SQLCODE                  TO SQLCODE2            06400000
057600             MOVE SQLERRD(3)               TO SQLERRD3            06410000
057700             PERFORM 9000-SQL-ABEND                               06420000
057800     END-EVALUATE.                                                06430000
057900                                                                  06440000
058000     IF SQLCODE = +100                                            06450000
058100         SET PS-EOF-PO-CSR         TO TRUE                        06460000
058200     ELSE                                                         06470000
058300         PERFORM 1210-RELEASE-EDITS                               06480000
058400         IF PV-DB2-COUNT1 > 0 OR                                  06490000
058500            PV-DB2-COUNT2 > 0 OR                                  06500000
058600            PV-DB2-COUNT3 > 0 OR                                  06510000
PE9933            PV-DB2-COUNT4 > 0 OR                                  06520000
PE9933            PV-DB2-COUNT5 > 0                                     06530000
058700             CONTINUE                                             06540000
058800         ELSE                                                     06550000
059100             PERFORM 1225-UPDATE-RLSE                             06560000
059500             IF PURCHS-EDI-IND = 'Y'                              06570000
059600                PERFORM 1230-RESET-EDI-REXMIT                     06580000
059700                CONTINUE                                          06590000
059800             ELSE                                                 06600000
059900                PERFORM 1220-SUBMIT-JOB                           06610000
060000             END-IF                                               06620000
060100         END-IF                                                   06630000
060200     END-IF.                                                      06640000
060300                                                                  06650000
060400                                                                  06660000
060500******************************************************************06670000
060600*  GETS COUNTS OF TALLPLNS TO INSURE ALLOCATIONS MADE             06680000
060700******************************************************************06690000
060800 1210-RELEASE-EDITS.                                              06700000
060900                                                                  06710000
061000     INITIALIZE PV-DB2-COUNT1                                     06720000
061100                PV-DB2-COUNT2                                     06730000
061200                PV-DB2-COUNT3                                     06740000
061200                PV-DB2-COUNT4                                     06750000
PE9933                PV-DB2-COUNT5.                                    06760000
061300                                                                  06770000
061400     EXEC SQL                                                     06780000
061500         SELECT  COUNT (*)                                        06790000
061600           INTO :PV-DB2-COUNT1                                    06800000
061700           FROM  TPURITM A                                        06810000
061800          WHERE A.PO_NBR = :PURCHS-PO-NBR                         06820000
061900            AND A.VER_STATUS_CDE = 'A'                            06830000
062000            AND A.STATUS_CDE IN ('AC', 'AP')                      06840000
062100            AND UNT_QTY <>                                        06850000
062200                (SELECT SUM(CURR_SPLIT_QTY)                       06860000
062300                   FROM TALLPLN B                                 06870000
062400                  WHERE A.PO_NBR     = B.PO_NBR                   06880000
062500                    AND A.PO_LNE_NBR = B.PO_LNE_NBR)              06890000
062600     END-EXEC                                                     06900000
062700                                                                  06910000
062800     EVALUATE TRUE                                                06920000
062900         WHEN SQLCODE = +0                                        06930000
063000             IF PV-DB2-COUNT1 > 0                                 06940000
063100                DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR '     '       06950000
063200                        'ERROR: SPLITS NOT EQUAL TO LINE QTY'     06960000
063300             END-IF                                               06970000
063400         WHEN SQLCODE = +100                                      06980000
063500         WHEN SQLCODE = -305                                      06990000
063600             CONTINUE                                             07000000
063700         WHEN SQLWARN0 NOT = SPACES                               07010000
063800         WHEN SQLCODE NOT = +0                                    07020000
063900             MOVE '1210-RELEASE-EDITS'                            07030000
064000                                   TO PV-ABEND-PARAGRAPH          07040000
064100             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    07050000
064200             MOVE SQLCODE                  TO SQLCODE2            07060000
064300             MOVE SQLERRD(3)               TO SQLERRD3            07070000
064400             PERFORM 9000-SQL-ABEND                               07080000
064500     END-EVALUATE.                                                07090000
064600                                                                  07100000
064700     EXEC SQL                                                     07110000
064800         SELECT  COUNT (*)                                        07120000
064900           INTO :PV-DB2-COUNT2                                    07130000
065000           FROM  TPURITM A                                        07140000
065100         WHERE A.PO_NBR         = :PURCHS-PO-NBR                  07150000
065200           AND A.VER_STATUS_CDE = 'A'                             07160000
065300           AND A.STATUS_CDE IN ('AC', 'AP')                       07170000
065400           AND NOT EXISTS                                         07180000
065500                (SELECT *                                         07190000
065600                   FROM TALLPLN B                                 07200000
065700                 WHERE A.PO_NBR     = B.PO_NBR                    07210000
065800                   AND A.PO_LNE_NBR = B.PO_LNE_NBR)               07220000
065900     END-EXEC.                                                    07230000
066000                                                                  07240000
066100     EVALUATE TRUE                                                07250000
066200          WHEN SQLCODE = +0                                       07260000
066300             IF PV-DB2-COUNT2 > 0                                 07270000
066400                DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR '     '       07280000
066500                        'ERROR: SPLITS DO NOT EXIST'              07290000
066600             END-IF                                               07300000
066700          WHEN SQLCODE = +100                                     07310000
066800          WHEN SQLCODE = -305                                     07320000
066900              CONTINUE                                            07330000
067000          WHEN SQLWARN0 NOT = SPACES                              07340000
067100          WHEN SQLCODE NOT = +0                                   07350000
067200             MOVE '1210-RELEASE-EDITS'                            07360000
067300                                   TO PV-ABEND-PARAGRAPH          07370000
067400             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    07380000
067500             MOVE SQLCODE                  TO SQLCODE2            07390000
067600             MOVE SQLERRD(3)               TO SQLERRD3            07400000
067700             PERFORM 9000-SQL-ABEND                               07410000
067800     END-EVALUATE.                                                07420000
067900                                                                  07430000
068000     EXEC SQL                                                     07440000
068100         SELECT  COUNT (*)                                        07450000
068200           INTO :PV-DB2-COUNT3                                    07460000
068300           FROM  TPURITM A                                        07470000
068400         WHERE A.PO_NBR         = :PURCHS-PO-NBR                  07480000
068500           AND A.VER_STATUS_CDE = 'A'                             07490000
068600           AND A.STATUS_CDE = 'RV'                                07500000
068700     END-EXEC.                                                    07510000
068800                                                                  07520000
068900     EVALUATE TRUE                                                07530000
069000          WHEN SQLCODE = +0                                       07540000
069100             IF PV-DB2-COUNT3 > 0                                 07550000
069200                DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR '     '       07560000
069300                        'ERROR: UNCONFIRMED PACK DATA'            07570000
069400             END-IF                                               07580000
069500          WHEN SQLCODE = +100                                     07590000
069600          WHEN SQLCODE = -305                                     07600000
069700              CONTINUE                                            07610000
069800          WHEN SQLWARN0 NOT = SPACES                              07620000
069900          WHEN SQLCODE NOT = +0                                   07630000
070000             MOVE '1210-RELEASE-EDITS'                            07640000
070100                                   TO PV-ABEND-PARAGRAPH          07650000
070200             PERFORM 9000-SQL-ABEND                               07660000
070300     END-EVALUATE.                                                07670000
                                                                        07680000
           IF PV-DB2-COUNT1 EQUAL ZERO AND                              07690000
              PV-DB2-COUNT2 EQUAL ZERO AND                              07700000
              PV-DB2-COUNT3 EQUAL ZERO                                  07710000
              PERFORM 1215-PBS-EDITS                                    07720000
           END-IF.                                                      07730000
070400                                                                  07740000
070500******************************************************************07750000
070600*  PERFORM NECESSARY PACK BY STORE ORDER EDITS                    07760000
070700******************************************************************07770000
       1215-PBS-EDITS.                                                  07780000
           PERFORM 7400-CHECK-PBS-ORDER.                                07790000
           IF PS-PBS-ORDER                                              07800000
              PERFORM 1216-CHECK-PBS-ALLOCS                             07810000
           END-IF.                                                      07820000
070500******************************************************************07830000
070600*  CHECK THAT ALL LINES ON THE ORDER ARE FULLY ALLOCATED          07840000
070700******************************************************************07850000
       1216-CHECK-PBS-ALLOCS.                                           07860000
061400     EXEC SQL                                                     07870000
061500         SELECT  COUNT (*)                                        07880000
061600           INTO :PV-DB2-COUNT4                                    07890000
061700           FROM  TPURITM A                                        07900000
061800          WHERE A.PO_NBR = :PURCHS-PO-NBR                         07910000
061900            AND A.VER_STATUS_CDE = 'A'                            07920000
062000            AND A.STATUS_CDE IN ('AC', 'AP')                      07930000
062100            AND UNT_QTY <>                                        07940000
062200                (SELECT SUM(STR_DISTRO_QTY)                       07950000
062300                   FROM TMESTDS B                                 07960000
062400                  WHERE A.PO_NBR     = B.PO_NBR                   07970000
062500                    AND A.PO_LNE_NBR = B.PO_LNE_NBR)              07980000
062600     END-EXEC                                                     07990000
062700                                                                  08000000
062800     EVALUATE TRUE                                                08010000
062900         WHEN SQLCODE = +0                                        08020000
063000             IF PV-DB2-COUNT4 > 0                                 08030000
063100                DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR '     '       08040000
063200                        'ERROR: ALLOCS NOT EQUAL TO LINE QTY'     08050000
PE9933             ELSE                                                 08060000
PE9933                  PERFORM 1217-CHECK-INVALID-PO                   08070000
063300             END-IF                                               08080000
063400         WHEN SQLCODE = +100                                      08090000
063500         WHEN SQLCODE = -305                                      08100000
063600             CONTINUE                                             08110000
063700         WHEN SQLWARN0 NOT = SPACES                               08120000
063800         WHEN SQLCODE NOT = +0                                    08130000
063900             MOVE '1216-CHECK-PBS-ALLOCS'                         08140000
064000                                   TO PV-ABEND-PARAGRAPH          08150000
064100             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    08160000
064200             MOVE SQLCODE                  TO SQLCODE2            08170000
064300             MOVE SQLERRD(3)               TO SQLERRD3            08180000
064400             PERFORM 9000-SQL-ABEND                               08190000
064500     END-EVALUATE.                                                08200000
PE9933******************************************************************08210000
|     *  CHECK FOR INVALID PO.                                          08220000
|     ******************************************************************08230000
|      1217-CHECK-INVALID-PO.                                           08240000
|          EXEC SQL                                                     08250000
|              SELECT  COUNT (*)                                        08260000
|                INTO :PV-DB2-COUNT5                                    08270000
|                FROM  TPURITM A                                        08280000
|               WHERE NOT EXISTS                                        08290000
|                     (SELECT 'X'                                       08300000
|                        FROM TMESTDS B                                 08310000
|                       WHERE A.PO_NBR     = B.PO_NBR                   08320000
|                         AND A.PO_LNE_NBR = B.PO_LNE_NBR)              08330000
|               AND A.PO_NBR         = :PURCHS-PO-NBR                   08340000
|               AND A.VER_STATUS_CDE = 'A'                              08350000
|               AND A.STATUS_CDE    IN ('AC', 'AP')                     08360000
|          END-EXEC.                                                    08370000
|                                                                       08380000
|          EVALUATE TRUE                                                08390000
|              WHEN SQLCODE = +0                                        08400000
|                  IF PV-DB2-COUNT5 > 0                                 08410000
|                     DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR '     '       08420000
|                             'ERROR: ALLOCS NOT EQUAL TO LINE QTY'     08430000
|                  END-IF                                               08440000
|              WHEN SQLCODE = +100                                      08450000
|              WHEN SQLCODE = -305                                      08460000
|                  CONTINUE                                             08470000
|              WHEN SQLWARN0 NOT = SPACES                               08480000
|              WHEN SQLCODE NOT = +0                                    08490000
|                  MOVE '1217-CHECK-INVALID-PO'                         08500000
|                                        TO PV-ABEND-PARAGRAPH          08510000
|                  MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    08520000
|                  MOVE SQLCODE                  TO SQLCODE2            08530000
|                  MOVE SQLERRD(3)               TO SQLERRD3            08540000
|                  PERFORM 9000-SQL-ABEND                               08550000
PE9933     END-EVALUATE.                                                08560000
070500******************************************************************08570000
070600*  SETS UP AND WRITES JCL TO OUTPUT FILE                          08580000
070700******************************************************************08590000
070800 1220-SUBMIT-JOB.                                                 08600000
070900                                                                  08610000
071000     IF CR-TEST-RUN                                               08620000
071100         MOVE CR-TEST-USERID       TO PV-TEST-JOB-USER-ID         08630000
071200                                      PC-TEST-NOTIFY-ID           08640000
071300         MOVE PV-TEST-JOB-POK902   TO JL-JOB-NAME                 08650000
071400         MOVE PC-TEST-CLASS        TO JL-JCL-CLASS                08660000
071500         MOVE PC-TEST-LIBSRCH      TO JL-JCL-LIBSRCH              08670000
071600         MOVE PC-TEST-JOB-PARM     TO JL-JCL-JOB-PARM             08680000
071700         MOVE PC-TEST-JOBLIB       TO JL-JCL-JOBLIB               08690000
071800         MOVE PC-TEST-JOBOUT1      TO JL-JCL-OUTPUT1              08700000
071900         MOVE PC-TEST-JOBOUT2A     TO JL-JCL-OUTPUT2              08710000
072000         MOVE PC-TEST-JOBOUT2B     TO JL-JCL-OUTPUT3              08720000
072100         MOVE PC-TEST-JOBOUT3      TO JL-JCL-OUTPUT4              08730000
072200           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       08740000
072300               MOVE PC-TEST-PROC-SI-PK                            08750000
072400                                   TO JL-JCL-PROC                 08760000
072500           ELSE                                                   08770000
072600               MOVE PC-TEST-PROC-SI                               08780000
072700                                   TO JL-JCL-PROC                 08790000
072800           END-IF                                                 08800000
072900     ELSE                                                         08810000
073000         PERFORM 7100-BUYER-INFORMATION                           08820000
073100         MOVE PC-PROD-JOB-POK902   TO JL-JOB-NAME                 08830000
073200         MOVE PC-PROD-CLASS        TO JL-JCL-CLASS                08840000
073300         MOVE PC-PROD-LIBSRCH      TO JL-JCL-LIBSRCH              08850000
073400         MOVE PC-PROD-JOB-PARM     TO JL-JCL-JOB-PARM             08860000
073500         MOVE PC-PROD-JOBLIB       TO JL-JCL-JOBLIB               08870000
073600         MOVE PC-PROD-JOBOUT1      TO JL-JCL-OUTPUT1              08880000
073700         MOVE PC-PROD-JOBOUT2      TO JL-JCL-OUTPUT2              08890000
073800         MOVE PC-PROD-JOBOUT3      TO JL-JCL-OUTPUT3              08900000
073900         MOVE PC-PROD-JOBOUT4      TO JL-JCL-OUTPUT4              08910000
074000           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       08920000
074100               MOVE PC-PROD-PROC-SI-PK                            08930000
074200                                   TO JL-JCL-PROC                 08940000
074300           ELSE                                                   08950000
074400               MOVE PC-PROD-PROC-SI                               08960000
074500                                   TO JL-JCL-PROC                 08970000
074600           END-IF                                                 08980000
074700     END-IF.                                                      08990000
074800                                                                  09000000
074900     MOVE PURCHS-PO-NBR            TO JL-PO-NBR.                  09010000
075000     MOVE 'VN'                     TO JL-PRINT-TYPE-VN.           09020000
075100     MOVE 'BY'                     TO JL-PRINT-TYPE-BY            09030000
075200     MOVE SPACES                   TO JL-PRINT-TYPE-AN            09040000
075300                                      JL-PRINT-TYPE-DC.           09050000
075400                                                                  09060000
075500     PERFORM                                                      09070000
075600         VARYING JL-LINE-INDEX                                    09080000
075700         FROM 1 BY 1                                              09090000
075800*        UNTIL JL-LINE-INDEX > 17                                 09100000
075900*  WHEN RUNNING THE PROCEDURE FROM TEST USE 18 FOR THE MAX INDEX  09110000
076000         UNTIL JL-LINE-INDEX > 18                                 09120000
076100             MOVE JL-JCL-LINE (JL-LINE-INDEX)                     09130000
076200                                   TO OUTPUT-RECORD               09140000
076300             WRITE OUTPUT-RECORD                                  09150000
076400     END-PERFORM.                                                 09160000
076500                                                                  09170000
076600******************************************************************09180000
076700** THIS UPDATES THE RELEASE INDICATOR FOR THOSE PO'S WITH AN    **09190000
076800** EDI INDICATOR SET TO YES                                     **09200000
076900******************************************************************09210000
077000 1225-UPDATE-RLSE.                                                09220000
077100         EXEC SQL                                                 09230000
077200              UPDATE TPURCHS                                      09240000
077300                 SET RLSE_IND = 'Y',                              09250000
077400                     RLSE_DTE = CURRENT DATE                      09260000
077500               WHERE PO_NBR         = :PURCHS-PO-NBR              09270000
077600                 AND VER_STATUS_CDE = 'A'                         09280000
077700                 AND PO_CATEG_CDE   = 'MR'                        09290000
077800         END-EXEC.                                                09300000
077900                                                                  09310000
078000         EVALUATE TRUE                                            09320000
078100             WHEN SQLCODE = ZERO                                  09330000
078200                 DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR ' RELEASED'  09340000
078400          WHEN SQLWARN0 NOT = SPACES                              09360000
078500          WHEN SQLCODE NOT = +0                                   09370000
078600             MOVE '1225-UPDATE-RLSE'                              09380000
078700                                   TO PV-ABEND-PARAGRAPH          09390000
078800             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    09400000
078900             MOVE SQLCODE                  TO SQLCODE2            09410000
079000             MOVE SQLERRD(3)               TO SQLERRD3            09420000
079100             PERFORM 9000-SQL-ABEND                               09430000
079200         END-EVALUATE.                                            09440000
079300******************************************************************09450000
079400** THIS UPDATES ONLY RELEASE DATE BUT NOT RELEASE INDICATOR     **09460000
079500** (PO ENTRY IS IN RMS) FOR THOSE PO'S WITH AN EDI INDICATOR    **09470000
079600** SET TO YES                                                   **09480000
079700******************************************************************09490000
079800 1227-UPDATE-RLSE-DTE.                                            09500000
079900         EXEC SQL                                                 09510000
080000              UPDATE TPURCHS                                      09520000
080100                 SET RLSE_DTE = CURRENT DATE                      09530000
080200               WHERE PO_NBR         = :PURCHS-PO-NBR              09540000
080300                 AND VER_STATUS_CDE = 'A'                         09550000
080400                 AND PO_CATEG_CDE   = 'MR'                        09560000
080500         END-EXEC.                                                09570000
080600                                                                  09580000
080700         EVALUATE TRUE                                            09590000
080800             WHEN SQLCODE = ZERO                                  09600000
080900                 DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR ' RELEASED'  09610000
081100          WHEN SQLWARN0 NOT = SPACES                              09630000
081200          WHEN SQLCODE NOT = +0                                   09640000
081300             MOVE '1227-UPDATE-RLSE-DTE'                          09650000
081400                                   TO PV-ABEND-PARAGRAPH          09660000
081500             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    09670000
081600             MOVE SQLCODE                  TO SQLCODE2            09680000
081700             MOVE SQLERRD(3)               TO SQLERRD3            09690000
081800             PERFORM 9000-SQL-ABEND                               09700000
081900         END-EVALUATE.                                            09710000
082000 EJECT                                                            09720000
082100                                                                  09730000
082200******************************************************************09740000
082300*  SET EDI REXMIT IND TO 'R' FOR RETRANSMISSION                   09750000
082400******************************************************************09760000
082500 1230-RESET-EDI-REXMIT.                                           09770000
082600                                                                  09780000
082700     EXEC SQL                                                     09790000
082800          UPDATE TPURCHS                                          09800000
082900             SET   EDI_REXMIT_IND  = 'R'                          09810000
083000                  ,EDI_REXMIT_TMST = CURRENT TIMESTAMP            09820000
083100             WHERE PO_NBR         = :PURCHS-PO-NBR                09830000
083200               AND VER_STATUS_CDE = 'A'                           09840000
083300     END-EXEC.                                                    09850000
083400                                                                  09860000
083500     EVALUATE TRUE                                                09870000
083600          WHEN SQLCODE = +0                                       09880000
083700               CONTINUE                                           09890000
083800          WHEN SQLWARN0 NOT = SPACES                              09900000
083900          WHEN SQLCODE NOT = +0                                   09910000
084000             MOVE '1230-RESET-EDI-REXMIT'                         09920000
084100                                   TO PV-ABEND-PARAGRAPH          09930000
084200             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    09940000
084300             MOVE SQLCODE                  TO SQLCODE2            09950000
084400             MOVE SQLERRD(3)               TO SQLERRD3            09960000
084500             PERFORM 9000-SQL-ABEND                               09970000
084600     END-EVALUATE.                                                09980000
084700                                                                  09990000
084800                                                                  10000000
084900******************************************************************10010000
085000*  CLOSES PO CSR                                                  10020000
085100******************************************************************10030000
085200 1300-CLOSE-PO-CSR.                                               10040000
085300                                                                  10050000
085400     EXEC SQL                                                     10060000
085500         CLOSE PO-CSR                                             10070000
085600     END-EXEC.                                                    10080000
085700                                                                  10090000
085800     EVALUATE TRUE                                                10100000
085900         WHEN SQLCODE = +0                                        10110000
086000             CONTINUE                                             10120000
086100         WHEN SQLWARN NOT = SPACE                                 10130000
086200         WHEN SQLCODE NOT = +0                                    10140000
086300             MOVE '1300-CLOSE-PO-CSR'                             10150000
086400                                   TO PV-ABEND-PARAGRAPH          10160000
086500             MOVE PC-PGM-NAME              TO PV-ABEND-PROGRAM    10170000
086600             MOVE SQLCODE                  TO SQLCODE2            10180000
086700             MOVE SQLERRD(3)               TO SQLERRD3            10190000
086800             PERFORM 9000-SQL-ABEND                               10200000
086900     END-EVALUATE.                                                10210000
087000                                                                  10220000
087100******************************************************************10230000
087200* FORMAT MESSAGE TO PLACE ON QUEUE                               *10240000
087300******************************************************************10250000
087400*----------------------------------------------------------------*10260000
087500* RETRIEVE BUYER INFORMATION TO DISPLAY ON BANNER PAGE           *10270000
087600*----------------------------------------------------------------*10280000
087700                                                                  10290000
087800 7100-BUYER-INFORMATION.                                          10300000
087900                                                                  10310000
088000     PERFORM 7200-GET-BUYER-NUMBER.                               10320000
088100     PERFORM 7300-GET-BUYER-NAME.                                 10330000
088200     MOVE PV-BUYER-NAME TO PV-BYR-NAME                            10340000
088300                           PV-PROD-BYR-NAME.                      10350000
088400     MOVE PV-BUYER-NUMBER TO PV-BYR-NBR.                          10360000
088500     MOVE PV-BUYER TO PV-PROD-BYR-NAME-NO.                        10370000
088600                                                                  10380000
088700*----------------------------------------------------------------*10390000
088800* GET BUYER NUMBER FROM TMDSEAR                                  *10400000
088900*----------------------------------------------------------------*10410000
089000                                                                  10420000
089100 7200-GET-BUYER-NUMBER.                                           10430000
089200                                                                  10440000
089300         EXEC SQL                                                 10450000
089400             SELECT BYR_NBR,                                      10460000
089500                    MDSEAR_DKEY                                   10470000
089600               INTO :MDSEAR-BYR-NBR,                              10480000
089700                    :MDSEAR-DKEY                                  10490000
089800               FROM TMDSEAR                                       10500000
089900              WHERE OPERCO_NBR = '03'                             10510000
090000                AND MDSELV_CDE = 'DPT'                            10520000
090100                AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE     10530000
090200                AND DEPT_NBR = :PURCHS-DEPT-NBR                   10540000
090300         END-EXEC.                                                10550000
090400                                                                  10560000
090500         EVALUATE TRUE                                            10570000
090600             WHEN SQLCODE = ZERO                                  10580000
090700                  CONTINUE                                        10590000
090800             WHEN SQLCODE = +100                                  10600000
090900                  MOVE SPACES          TO PV-BUYER-NUMBER         10610000
091000                  MOVE ZEROES          TO MDSEAR-DKEY             10620000
091100             WHEN SQLWARN0 NOT = SPACES                           10630000
091200             WHEN SQLCODE NOT = +0                                10640000
091300                  MOVE '7200-GET-BUYER-NUMBER'                    10650000
091400                                       TO PV-ABEND-PARAGRAPH      10660000
091500                  MOVE PC-PGM-NAME          TO PV-ABEND-PROGRAM   10670000
091600                  MOVE SQLCODE              TO SQLCODE2           10680000
091700                  MOVE SQLERRD(3)           TO SQLERRD3           10690000
091800                  PERFORM 9000-SQL-ABEND                          10700000
091900         END-EVALUATE.                                            10710000
092000                                                                  10720000
092100     IF SQLCODE = ZERO                                            10730000
092200          MOVE MDSEAR-BYR-NBR  TO PV-BUYER-NUMBER                 10740000
092300     END-IF.                                                      10750000
092400                                                                  10760000
092500*----------------------------------------------------------------*10770000
092600* GET BUYER NAME FROM TRSPBAR                                    *10780000
092700*----------------------------------------------------------------*10790000
092800                                                                  10800000
092900 7300-GET-BUYER-NAME.                                             10810000
093000                                                                  10820000
093100     MOVE SPACES         TO PV-BUYER-NAME.                        10830000
093200                                                                  10840000
093300         EXEC SQL                                                 10850000
093400              SELECT DISTINCT(WORKER_LAST_NAME), WORKER_FIR_NAME  10860000
093500                INTO :RSPBAR-WORKER-LAST-NAME,                    10870000
093600                     :RSPBAR-WORKER-FIR-NAME                      10880000
093700                FROM TRSPBAR                                      10890000
093800               WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   10900000
093900                 AND RSPLVL_CDE  = 'BYR'                          10910000
094000                 AND CURRENT DATE BETWEEN WORKER_STRT_DTE AND     10920000
094100                                          WORKER_END_DTE          10930000
094200         END-EXEC.                                                10940000
094300                                                                  10950000
094400         EVALUATE TRUE                                            10960000
094500             WHEN SQLCODE = ZEROS                                 10970000
094600                  CONTINUE                                        10980000
094700             WHEN SQLCODE = +100                                  10990000
094800                  MOVE SPACES TO PV-BUYER-NAME                    11000000
094900             WHEN SQLWARN0 NOT = SPACES                           11010000
095000             WHEN SQLCODE NOT = +0                                11020000
095100                  MOVE '7300-GET-BUYER-NAME'                      11030000
095200                                TO PV-ABEND-PARAGRAPH             11040000
095300                  MOVE PC-PGM-NAME            TO PV-ABEND-PROGRAM 11050000
095400                  MOVE SQLCODE                TO SQLCODE2         11060000
095500                  MOVE SQLERRD(3)             TO SQLERRD3         11070000
095600                  PERFORM 9000-SQL-ABEND                          11080000
095700         END-EVALUATE.                                            11090000
095800                                                                  11100000
095900     IF SQLCODE = ZEROS                                           11110000
085400         INSPECT RSPBAR-WORKER-FIR-NAME  REPLACING ALL            11120000
085400                 '''' BY '_'                                      11130000
085400         INSPECT RSPBAR-WORKER-LAST-NAME REPLACING ALL            11140000
085400                 '''' BY '_'                                      11150000
096000         STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' '          11160000
096100                ' '                     DELIMITED BY SIZE         11170000
096200                RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE         11180000
096300                                   INTO PV-BUYER-NAME             11190000
096400     END-IF.                                                      11200000
092500*----------------------------------------------------------------*11210000
092600* CHECK IF THE ORDER IS A PACK BY STORE ORDER.                   *11220000
092700*----------------------------------------------------------------*11230000
092800                                                                  11240000
092900 7400-CHECK-PBS-ORDER.                                            11250000
093000                                                                  11260000
093100     SET PS-NOT-PBS-ORDER TO TRUE.                                11270000
093200                                                                  11280000
049300     EXEC SQL                                                     11290000
              SELECT 'Y' INTO :PS-PBS-ORDER-SW                          11300000
                FROM SYSIBM.SYSDUMMY1 X                                 11310000
               WHERE EXISTS                                             11320000
049400              (SELECT 1                                           11330000
049600                 FROM TPOAGMT A                                   11340000
049700                WHERE A.PO_NBR = :PURCHS-PO-NBR                   11350000
049800                  AND A.AGRMT_TYP_ID = '4'                        11360000
049900                  AND A.TYP_CDE = 4                               11370000
050000                  AND A.VER_STATUS_CDE = 'A'                      11380000
                        AND X.IBMREQD = X.IBMREQD)                      11390000
050100     END-EXEC                                                     11400000
050200     EVALUATE TRUE                                                11410000
050300         WHEN SQLCODE = 0                                         11420000
050500         WHEN SQLCODE = 100                                       11430000
050400             CONTINUE                                             11440000
088700         WHEN SQLWARN0 NOT = SPACES                               11450000
088800         WHEN SQLCODE NOT = +0                                    11460000
088900              MOVE '7400-CHECK-PBS-ORDER'                         11470000
089000                            TO PV-ABEND-PARAGRAPH                 11480000
089100              MOVE PC-PGM-NAME            TO PV-ABEND-PROGRAM     11490000
089200              MOVE SQLCODE                TO SQLCODE2             11500000
089300              MOVE SQLERRD(3)             TO SQLERRD3             11510000
050800              PERFORM 9000-SQL-ABEND                              11520000
095700     END-EVALUATE.                                                11530000
096500                                                                  11540000
114200******************************************************************13310000
114300*   CHECK DEPARTMENT NUMBER IS ENTERED IN RMS                     13320000
114400******************************************************************13330000
114500 8600-CHECK-RLOUT-CTL-TABLE.                                      13340000
114600                                                                  13350000
114700     INITIALIZE POT00006-DEPT-NBR.                                13360000
           MOVE PURCHS-DEPT-NBR      TO PV-DEPT-NBR                     13370000
114800                                                                  13380000
114900         EXEC SQL                                                 13390000
115000               SELECT DEPT_NBR                                    13400000
115100                INTO :POT00006-DEPT-NBR                           13410000
115200                FROM POT_RMS_RLOUT_CTL                            13420000
115300               WHERE DEPT_NBR = :PV-DEPT-NBR                      13430000
115400                 AND PO_ENTR_IN_RMS_DTE <= CURRENT DATE           13440000
115500         END-EXEC                                                 13450000
115600                                                                  13460000
115700         EVALUATE TRUE                                            13470000
115800             WHEN SQLCODE = +0                                    13480000
115900             WHEN SQLCODE = +100                                  13490000
116200                  CONTINUE                                        13500000
116300             WHEN SQLWARN0 NOT = SPACES                           13510000
116400             WHEN SQLCODE NOT = +0                                13520000
116500                  MOVE '8600-CHECK-RLOUT-CTL-TABLE'               13530000
116600                                         TO PV-ABEND-PARAGRAPH    13540000
116700                  MOVE PC-PGM-NAME       TO PV-ABEND-PROGRAM      13550000
116800                  MOVE SQLCODE           TO SQLCODE2              13560000
116900                  MOVE SQLERRD(3)        TO SQLERRD3              13570000
117000                  PERFORM 9000-SQL-ABEND                          13580000
117100         END-EVALUATE.                                            13590000
117200                                                                  13600000
117300******************************************************************13610000
117400*  - ERROR ROUTINE FOR DB2 ABENDS                                 13620000
117500******************************************************************13630000
117600 9000-SQL-ABEND.                                                  13640000
117700     DISPLAY '** ABEND          **'.                              13650000
117800     DISPLAY '** PROGRAM        ** = ' PV-ABEND-PROGRAM.          13660000
117900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        13670000
118000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  13680000
118100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  13690000
118200     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   13700000
118300     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  13710000
118400     MOVE +4013                    TO PV-ABEND-CODE.              13720000
118500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13730000
