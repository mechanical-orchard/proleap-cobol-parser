      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    INKCS044.                                                 
       AUTHOR.        DAN GRUBER.                                               
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  10-09-97.                                                 
       DATE-COMPILED.                                                           
      *----------------------------------------------------------------*        
      *    I044 - PHYSICAL INVENTORY LAPTOP COUNT SCREEN               *        
      *                                                                *        
      *    THIS PROGRAM ALLOWS THE USER TO ADD AND UPDATE ALL THE      *        
      *    EXTENSION AND QUANTITY FOR ALL THE LAPTOPS USED DURING      *        
      *    PHYSICAL INVENTORY.  THESE TOTALS WILL BE USED TO BALANCE   *        
      *    THE EXPECTED AMOUNTS WITH THE VALUES TRANSMITTED FROM THE   *        
      *    STORES.                                                     *        
      *                                                                *        
      *----------------------------------------------------------------*        
      *  04/28/99 - JULIE SEIDLER                                      *        
      *  REMOVE REFERENCE TO DPG51-SYSTEM-DATE.  THE CALENDAR ROUTINE  *        
      *  NO LONGER USES THIS FIELD.                                    *        
W26600*                                                                *        
W26600*  W26600  07-  -2004  PHYSICAL INVENTORY STORE EXPANSION        *        
W26600*                      M JOHNSON                                 *        
W26600*                                                                *        
      *----------------------------------------------------------------*        
W26006*  W26006  02-24-2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.*        
W26006*                      ERIN SEARL                                *        
      *----------------------------------------------------------------*        
W28545*  W28545  04-04-2006  ALLOW STORES TO ENTER INVENTORY TOTALS    *        
W28545*                      AND SUBMIT THE FILE-BALANCING JOB(INK908).*        
W28545*                      IF THE TOTALS ARE INCORRECT, THE STORES   *        
W28545*                      CAN UPDATE THE TOTALS AND SUBMIT INK918.  *        
W28545*                      THE SUBMISSION OF BOTH JOBS IS TRANSPARENT*        
W28545*                      TO THE STORES. ALSO, ENABLE OPERATIONS TO *        
W28545*                      COMPARE THE TOTALS AND RESUBMIT INK908 IF *        
W28545*                      NECESSARY. A NEW MNEMONIC (INOCOUNT) WAS  *        
W28545*                      ADDED FOR OPERATIONS.                     *        
W28545*                      JOHN SELWITSCHKA                          *        
      *----------------------------------------------------------------*        
W28545*  W28545  06-20-2006  ALLOW DISPLAY AFTER ACTL-INV-RECD-DTE     *        
W28545*                      HAS BEEN SET. DO NOT DISPLAY MESSAGE      *        
W28545*                      3490 AFTER ACTL-INV-RECD-DTE IS SET.      *        
W28545*                      ALLOW TRANSFER TO PHYSICAL COUNT STATUS   *        
W28545*                      SCREEN.                                   *        
      *  W33304  05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS      *        
      *                      PERIODS INVENTORY SHORTAGE REPORTING      *        
      *                      -JILL LIN                                 *        
C63493*CHG63493  03-02-2017  CHANGED THE CLASS FROM 'P' TO 'K' FOR     *        
C63493*                      INK908 JOB.                               *        
C63493*                      -COGNIZANT                                *        
      *----------------------------------------------------------------*        
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126                 
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263126* MAKING THE CALL DYNAMIC VS STATIC.                                      
263126*----------------------------------------------------------------*        
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
1122RM* THE CICS ARCHITECTURE API.                                              
      *----------------------------------------------------------------*        
RONNA * CHANGED 05/25/2023    BY RONNA MCDONALD  WR: CHG0288464                 
RONNA *                                                                         
RONNA *  MODIFY PROCESSING TO RECOGNIZE WHEN A TRANSMISSION FILE                
RONNA *  EXISTS FOR A STORE, AND DISPLAY A STATUS OF THAT ON THE                
RONNA *  CICS SCREEN.                                                           
RONNA *                                                                         
RONNA *  WHEN THERE ISN'T A FILE, A MESSAGE WILL BE DISPLAYED ON                
RONNA *  THE SCREEN THAT NO TRANSMISSION FILE IS CATALOGED AND                  
RONNA *  THAT THE INVENTORY SERVICE NEEDS TO SEND A FILE.                       
RONNA *                                                                         
RONNA *  AFTER TOTALS ARE ENTERED AND THE F13 OR F15 KEY IS                     
RONNA *  PRESSED, A MESSAGE WILL DISPLAY STATING THAT THE FILE IS               
RONNA *  BEING PROCESSED, BACK OUT, WAIT FOR 1 MINUTE AND THEN                  
RONNA *  RETURN.                                                                
RONNA *                                                                         
RONNAM*                                                                         
RONNAM* CHANGED 06/20/2023    BY RONNA MCDONALD  WR: CHG0289831                 
RONNAM*                                                                         
RONNAM* THE UPDATE KEY WAS NOT ALWAYS WORKING.  ADDED CODE                      
RONNAM* TO SUBMIT THE INK908 JOB WHEN THE TINVLAP STATUS CODE IS                
RONNAM* NOT 'NB' FOR NOT BALANCED.                                              
RONNAM* SUSPECT THE REASONING IS A TIMING ISSUE WHERE THE INK908                
RONNAM* JOB ISN'T PAST THE STEP WHERE INKUT153 UPDATES THE                      
RONNAM* TINVLAP STATUS TO EITHER 'NB' OR 'BL'.                                  
RONNAM*                                                                         
      *----------------------------------------------------------------*        
                                                                                
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
                                                                                
       DATA DIVISION.                                                           
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  DK-DB2-KEYS.                                                         
W26600     05  DK-STORE-NBR                   PIC  9(04)  VALUE ZEROS.          
           05  DK-LAPTOP-NBR                  PIC  X(02)  VALUE SPACE.          
           05  DK-INVENTORY-YEAR              PIC  X(04)  VALUE SPACE.          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-ABSTIME               PIC S9(18)  VALUE ZERO                  
                                                    COMP SYNC.                  
           05  PC-SYSTEM-DATE           PIC  X(06)  VALUE SPACES.               
           05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'INKCS044'.          
           05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'IN044A  '.          
           05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'INKM044 '.          
           05  PC-APPL-MAP              PIC S9(04)  VALUE  +1                   
                                                    COMP.                       
           05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3                   
                                                    COMP.                       
           05  PC-HEADQUARTERS          PIC  X(02)  VALUE  'HQ'.                
           05  PC-OPERATING-CO          PIC  X(02)  VALUE  '03'.                
           05  PC-EMPTY-TMST            PIC  X(26)  VALUE                       
                                        '0001-01-01-00.00.00.000000'.           
W28545     05  PC-STORE-MNEMONIC        PIC  X(08)  VALUE  'INMCOUNT'.          
W28545     05  PC-OPS-MNEMONIC          PIC  X(08)  VALUE  'INOCOUNT'.          
                                                                                
W28545     05  PC-SYS-ID                PIC X(04).                              
W28545         88  PC-KOHLS-TEST-SYSTEM             VALUE 'CIT1'.               
W28545         88  PC-KOHLS-ACC-TEST-SYSTEM         VALUE 'CIQA',               
W28545                                                    'CIQT',               
W28545                                                    'CILA',               
W28545                                                    'CILT'.               
W28545         88  PC-KOHLS-QA-SYSTEM               VALUE 'CIQA',               
W28545                                                    'CIQT'.               
W28545         88  PC-KOHLS-LEARNING-SYSTEM         VALUE 'CILA',               
W28545                                                    'CILT'.               
W28545         88  PC-KOHLS-PROD-SYSTEM             VALUE 'CIPS',               
W28545                                                    'CIP1',               
W28545                                                    'CIP3',               
W28545                                                    'CIP4',               
W28545                                                    'CIP6'.               
W28545                                                                          
           05  PC-TSYMSG-NUMBERS.                                               
               10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.               
               10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.               
               10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.               
               10  PC-TSYMSG-00009      PIC  9(05)  VALUE  00009.               
               10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.               
               10  PC-TSYMSG-00016      PIC  9(05)  VALUE  00016.               
               10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.               
               10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.               
               10  PC-TSYMSG-00343      PIC  9(05)  VALUE  00343.               
W28545         10  PC-TSYMSG-00349      PIC  9(05)  VALUE  00349.               
               10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.               
               10  PC-TSYMSG-01655      PIC  9(05)  VALUE  01655.               
               10  PC-TSYMSG-01656      PIC  9(05)  VALUE  01656.               
               10  PC-TSYMSG-01657      PIC  9(05)  VALUE  01657.               
               10  PC-TSYMSG-01658      PIC  9(05)  VALUE  01658.               
               10  PC-TSYMSG-01664      PIC  9(05)  VALUE  01664.               
W28545         10  PC-TSYMSG-03489      PIC  9(05)  VALUE  03489.               
W28545         10  PC-TSYMSG-03490      PIC  9(05)  VALUE  03490.               
W28545         10  PC-TSYMSG-03491      PIC  9(05)  VALUE  03491.               
W28545         10  PC-TSYMSG-03492      PIC  9(05)  VALUE  03492.               
W28545         10  PC-TSYMSG-03493      PIC  9(05)  VALUE  03493.               
W28545         10  PC-TSYMSG-03496      PIC  9(05)  VALUE  03496.               
W28545         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.               
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-ERROR-SW                    PIC  X(01)   VALUE 'N'.           
               88  PS-ERROR                                VALUE 'Y'.           
               88  PS-NO-ERROR                             VALUE 'N'.           
           05  PS-STORE-NBR-ERROR-SW          PIC  X(01)   VALUE 'N'.           
               88  PS-STORE-NBR-ERROR                      VALUE 'Y'.           
               88  PS-NO-STORE-NBR-ERROR                   VALUE 'N'.           
           05  PS-STORE-INV-ERROR-SW          PIC  X(01)   VALUE 'N'.           
               88  PS-STORE-INV-ERROR                      VALUE 'Y'.           
               88  PS-NO-STORE-INV-ERROR                   VALUE 'N'.           
           05  PS-DATE-ERROR-SW               PIC  X(01)   VALUE 'N'.           
               88  PS-DATE-ERROR                           VALUE 'Y'.           
               88  PS-NO-DATE-ERROR                        VALUE 'N'.           
           05  PS-TIME-ERROR-SW               PIC  X(01)   VALUE 'N'.           
               88  PS-TIME-ERROR                           VALUE 'Y'.           
               88  PS-NO-TIME-ERROR                        VALUE 'N'.           
W28545     05  PS-INTERNAL-READER-ENQ-DEQ-IND PIC X(1)     VALUE 'D'.           
W28545         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.           
W28545         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.           
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0 COMP.              
           05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0                    
                                                    COMP SYNC.                  
                                                                                
W26600     05  PV-STORE-NBR             PIC 9(04)   VALUE ZEROES.               
W28545     05  PV-CURRENT-SYSID         PIC X(04)   VALUE SPACES.               
           05  PV-TIME-COMP-HOUR-9      PIC 9(02)   VALUE ZEROES.               
           05  PV-TIME-COMP-MINUTE-9    PIC 9(02)   VALUE ZEROES.               
                                                                                
           05  PV-CURRENT-DATE          PIC X(10)   VALUE SPACE.                
                                                                                
           05  PV-DB2-DATE.                                                     
               10  PV-DB2-DATE-CCYY     PIC X(04)   VALUE SPACE.                
               10  FILLER               PIC X       VALUE '-'.                  
               10  PV-DB2-DATE-MM       PIC X(02)   VALUE SPACE.                
               10  FILLER               PIC X       VALUE '-'.                  
               10  PV-DB2-DATE-DD       PIC X(02)   VALUE SPACE.                
                                                                                
           05  PV-CURRENT-TIMESTAMP     PIC X(26)   VALUE SPACE.                
                                                                                
W28545     05  PV-OPS-JOBNAME-LINE.                                             
W28545         10  FILLER               PIC X(13)   VALUE                       
W28545                                              'FILE TOTALS ('.            
W28545         10  PV-OPS-JOBNAME       PIC X(08)   VALUE SPACES.               
W28545         10  FILLER               PIC X(07)   VALUE                       
W28545                                              ').....:'.                  
W28545                                                                          
W28545 01  TD-TRANSIENT-DATA-AREA.                                      02490000
W28545     05  TD-QUEUE-NAME-LENGTH      PIC S9(4)  VALUE +4  COMP.     02500000
W28545     05  TD-JCL-LINE-LENGTH        PIC S9(4)  VALUE +80 COMP.     02510000
W28545     05  TD-QUEUE-NAME             PIC X(4)   VALUE 'IRTD'.       02520000
W28545     05  TD-JCL-LINE               PIC X(80)  VALUE SPACES.       02530000
W28545                                                                  02540000
W28545******************************************************************02550000
W28545*  JCL LINES FOR THE VSM BRIDGE TO ITEM HUB SHUTDOWN JOB          02560000
W28545******************************************************************02570000
W28545 01  JL-JCL-LINE-AREA.                                            02580000
W28545     05  JL-JCL-LINE-1P.                                          02590000
W28545         10  FILLER              PIC X(08)    VALUE               02600000
W28545             '//INK908'.                                          02610000
W28545         10  JL-JCL-JOBCHARS     PIC X(02)    VALUE 'A0'.         02600000
W28545         10  FILLER              PIC X(11)    VALUE               02600000
W28545             ' JOB KOHLS,'.                                       02610000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02620000
W28545         10  FILLER              PIC X(20)    VALUE               02630000
W28545             'INK908 STR XMIT     '.                              02640000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02650000
W28545         10  FILLER              PIC X(19)    VALUE               02660000
C63493             ',CLASS=K,MSGCLASS=P'.                               02670000
W28545         10  FILLER              PIC X(18)    VALUE SPACES.       02680000
W28545     05  JL-JCL-LINE-1P-918.                                      02590000
W28545         10  FILLER              PIC X(08)    VALUE               02600000
W28545             '//INK918'.                                          02610000
W28545         10  JL-JCL-JOBCHARS-918 PIC X(02)    VALUE 'A0'.         02600000
W28545         10  FILLER              PIC X(11)    VALUE               02600000
W28545             ' JOB KOHLS,'.                                       02610000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02620000
W28545         10  FILLER              PIC X(20)    VALUE               02630000
W28545             'INK918 STR XMIT     '.                              02640000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02650000
W28545         10  FILLER              PIC X(19)    VALUE               02660000
W28545             ',CLASS=P,MSGCLASS=P'.                               02670000
W28545         10  FILLER              PIC X(18)    VALUE SPACES.       02680000
W28545     05  JL-JCL-LINE-1T.                                          02890000
W28545         10  FILLER              PIC X(02)    VALUE '//'.         02900000
W28545         10  JL-JCL-JBNAME       PIC X(08)    VALUE SPACES.       02900000
W28545         10  FILLER              PIC X(11)    VALUE               02900000
W28545             ' JOB KOHLS,'.                                       02910000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02920000
W28545         10  FILLER              PIC X(20)    VALUE               02930000
W28545             'INK908 STR XMIT     '.                              02940000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02950000
W28545         10  FILLER              PIC X(19)    VALUE               02960000
W28545             ',CLASS=A,MSGCLASS=X'.                               02970000
W28545         10  FILLER              PIC X(18)    VALUE SPACES.       02980000
W28545     05  JL-JCL-LINE-1T-918.                                      02890000
W28545         10  FILLER              PIC X(02)    VALUE '//'.         02900000
W28545         10  JL-JCL-JBNAME-918   PIC X(08)    VALUE SPACES.       02900000
W28545         10  FILLER              PIC X(11)    VALUE               02900000
W28545             ' JOB KOHLS,'.                                       02910000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02920000
W28545         10  FILLER              PIC X(20)    VALUE               02930000
W28545             'INK918 STR XMIT     '.                              02940000
W28545         10  FILLER              PIC X(1)     VALUE QUOTE.        02950000
W28545         10  FILLER              PIC X(19)    VALUE               02960000
W28545             ',CLASS=A,MSGCLASS=X'.                               02970000
W28545         10  FILLER              PIC X(18)    VALUE SPACES.       02980000
W28545     05  JL-JCL-LINE-2.                                           02990000
W28545         10  FILLER              PIC X(13)    VALUE               03000000
W28545             '/*JOBPARM K=0'.                                     03010000
W28545         10  FILLER              PIC X(67)    VALUE SPACES.       03020000
W28545     05  JL-JCL-LINE-ALL-ASTERISK.                                03030000
W28545         10  FILLER              PIC X(02)    VALUE               03060100
W28545             '//'.                                                03061000
W28545         10  FILLER              PIC X(78)    VALUE ALL '*'.      03062000
W28545     05  JL-JCL-LINE-4.                                           03030000
W28545         10  FILLER              PIC X(03)    VALUE               03060100
W28545             '//*'.                                               03061000
W28545         10  FILLER              PIC X(77)    VALUE               03062000
W28545         '  USED TO TRANSMIT THE SCANNED STORE INVENTORY FROM THE 03062000
W28545-        'STORE'.                                                 03062000
W28545     05  JL-JCL-LINE-ASTERISK.                                    03030000
W28545         10  FILLER              PIC X(03)    VALUE               03060100
W28545             '//*'.                                               03061000
W28545         10  FILLER              PIC X(77)    VALUE SPACES.       03062000
W28545     05  JL-JCL-LINE-6.                                           03030000
W28545         10  FILLER              PIC X(03)    VALUE               03060100
W28545             '//*'.                                               03061000
W28545         10  FILLER              PIC X(77)    VALUE               03062000
W28545         '  JOB UNZIPS THE STORE INVENTORY DATA FILE AND DOES BALA03062000
W28545-        'NCING ON'.                                              03062000
W28545     05  JL-JCL-LINE-6-918.                                       03030000
W28545         10  FILLER              PIC X(03)    VALUE               03060100
W28545             '//*'.                                               03061000
W28545         10  FILLER              PIC X(77)    VALUE               03062000
W28545         '  JOB DOES BALANCING ON'.                               03062000
W28545     05  JL-JCL-LINE-7.                                           03030000
W28545         10  FILLER              PIC X(03)    VALUE               03060100
W28545             '//*'.                                               03061000
W28545         10  FILLER              PIC X(77)    VALUE               03062000
W28545         '  THE QTY AND PRICE'.                                   03062000
W28545     05  JL-JCL-LINE-9P-1.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-9P-2.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-9P-3.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//         DD DSN=TKMA.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-9T-1.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-9T-2.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-9T-3.                                        03190000
W28545         10  FILLER              PIC X(39)    VALUE               03190100
W28545         '//         DD DSN=PKMO.LOADLIB,DISP=SHR'.               03191000
W28545         10  FILLER              PIC X(41)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-10.                                          03190000
W28545         10  FILLER              PIC X(24)    VALUE               03190100
W28545         '//PS020    EXEC INK9081,'.                              03191000
W28545         10  FILLER              PIC X(56)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-10-918.                                      03190000
W28545         10  FILLER              PIC X(24)    VALUE               03190100
W28545         '//PS020    EXEC INK9181,'.                              03191000
W28545         10  FILLER              PIC X(56)    VALUE SPACES.       03210000
W28545     05  JL-JCL-LINE-11.                                          03190000
W28545         10  FILLER              PIC X(16)    VALUE               03190100
W28545         '//         SOPT='.                                      03191000
W28545         10  JL-JCL-SOPT         PIC X(02)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(26)    VALUE               03210000
W28545         ',          <== JOB LETTERS'.                            03191000
W28545     05  JL-JCL-LINE-12.                                          03190000
W28545         10  FILLER              PIC X(18)    VALUE               03190100
W28545         '//         INVDTE='.                                    03191000
W28545         10  JL-JCL-INVDTE       PIC X(06)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(23)    VALUE               03190100
W28545         ',    <== INVENTORY DATE'.                               03191000
W28545     05  JL-JCL-LINE-13.                                          03190000
W28545         10  FILLER              PIC X(19)    VALUE               03190100
W28545         '//         STRVARI='.                                   03191000
W28545         10  JL-JCL-STRVARI      PIC 9(04)    VALUE ZEROES.       03210000
W28545         10  FILLER              PIC X(40)    VALUE               03210000
W28545         ',     <== ESP STORE NUMBER - FOUR DIGITS'.              03191000
W28545     05  JL-JCL-LINE-14.                                          03190000
W28545         10  FILLER              PIC X(18)    VALUE               03190100
W28545         '//         ENVIRO='.                                    03191000
W28545         10  JL-JCL-ENVIRO       PIC X(01)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(31)    VALUE               03210000
W28545         ',         <== PROCESSING REGION'.                       03191000
W28545     05  JL-JCL-LINE-15.                                          03190000
W28545         10  FILLER              PIC X(19)    VALUE               03190100
W28545         '//         PLNDDTE='.                                   03191000
W28545         10  JL-JCL-PLNDDTE      PIC X(10)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(35)    VALUE               03210000
W28545         ',        <== PLANNED INVENTORY DATE'.                   03191000
W28545     05  JL-JCL-LINE-16.                                          03190000
W28545         10  FILLER              PIC X(16)    VALUE               03190100
W28545         '//         PHLQ='.                                      03191000
W28545         10  JL-JCL-PHLQ         PIC X(04)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(33)    VALUE               03210000
W28545         ',        <== HIGH LEVEL QUALIFIER'.                     03191000
W28545     05  JL-JCL-LINE-17.                                          03190000
W28545         10  FILLER              PIC X(16)    VALUE               03190100
W28545         '//         THLQ='.                                      03191000
W28545         10  JL-JCL-THLQ         PIC X(04)    VALUE SPACES.       03210000
W28545         10  FILLER              PIC X(38)    VALUE               03210000
W28545         '         <== TEMP HIGH LEVEL QUALIFIER'.                03191000
W28545     05  JL-JCL-LINE-18.                                          02990000
W28545         10  FILLER              PIC X(03)    VALUE               03000000
W28545             '//*'.                                               03010000
W28545         10  FILLER              PIC X(77)    VALUE SPACES.       03020000
W28545     05  JL-JCL-LINE-END.                                         02990000
W28545         10  FILLER              PIC X(02)    VALUE               03000000
W28545             '//'.                                                03010000
W28545         10  FILLER              PIC X(25)    VALUE ALL '*'.      03020000
W28545         10  FILLER              PIC X(12)    VALUE               03020000
W28545             ' END OF JOB '.                                      03010000
W28545         10  FILLER              PIC X(41)    VALUE ALL '*'.      03020000
W28545     05  JL-JCL-LINE-EOF.                                         03212500
W28545         10  FILLER              PIC X(5)     VALUE '/*EOF'.      03212600
W28545         10  FILLER              PIC X(75)    VALUE SPACES.       03213000
W28545                                                                  03224000
      *----------------------------------------------------------------*        
      *    MAP LAYOUT                                                  *        
      *----------------------------------------------------------------*        
                                                                                
           COPY INKM044.                                                        
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS015.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    FUNCTION KEYS COPYBOOK                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS016.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    DATE AND TIME COPYBOOK                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS017.                                                        
                                                                                
       EJECT                                                                    
      **--------------------------------------------------------------**        
      ** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **        
      ** SUB-ROUTINE (DPKUT100).                                      **        
      **--------------------------------------------------------------**        
                                                                                
           COPY DPWS010I.                                                       
                                                                                
      *----------------------------------------------------------------*        
      * CALENDAR ROUTINE WORK AREA.                                             
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS500.                                                        
                                                                                
       EJECT                                                                    
      **--------------------------------------------------------------**        
      ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*        
      ** APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.        **        
      **--------------------------------------------------------------**        
                                                                                
           COPY DPWS030.                                                        
1122RM     COPY DPWS930.                                                        
                                                                                
       EJECT                                                                    
      **--------------------------------------------------------------**        
      *    STANDARD COMMAREA.                                                   
      **--------------------------------------------------------------**        
                                                                                
           COPY DPWS020.                                                        
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
                                                                                
      *****************************************************************         
      *    INTER-APPLICATION COMMAREA.                                          
      *****************************************************************         
                                                                                
               10  INTER-APPL-COMM-AREA PIC X(200).                             
                                                                                
      *****************************************************************         
      *    APPLICATION SPECIFIC COMMMAREA FOR INKCS044.                         
      *****************************************************************         
               10  ASC-SPECIFIC-COMMAREA.                                       
W26600             15  ASC-STORE-NBR                  PIC X(04).                
                   15  ASC-STORE-NAME                 PIC X(25).                
                   15  ASC-CURRENT-YEAR               PIC X(04).                
                                                                                
                   15  ASC-TIME-COMP-TMST.                                      
                       20  ASC-TIME-COMP-DATE.                                  
                           25  ASC-TIME-COMP-YEAR     PIC  X(04).               
                           25  ASC-TIME-COMP-DASH1    PIC  X(01).               
                           25  ASC-TIME-COMP-MONTH    PIC  X(02).               
                           25  ASC-TIME-COMP-DASH2    PIC  X(01).               
                           25  ASC-TIME-COMP-DAY      PIC  X(02).               
                       20  ASC-TIME-COMP-DASH3        PIC  X(01).               
                       20  ASC-TIME-COMP-HOUR         PIC  X(02).               
                       20  ASC-TIME-COMP-PERIOD1      PIC  X(01).               
                       20  ASC-TIME-COMP-MINUTE       PIC  X(02).               
                       20  ASC-TIME-COMP-PERIOD2      PIC  X(01).               
                       20  ASC-TIME-COMP-SECOND       PIC  X(02).               
                       20  ASC-TIME-COMP-PERIOD3      PIC  X(01).               
                       20  ASC-TIME-COMP-SUBSEC       PIC  X(06).               
                                                                                
                   15  ASC-SCN-TIME-MONTH             PIC  X(02).               
                   15  ASC-SCN-TIME-DAY               PIC  X(02).               
                   15  ASC-SCN-TIME-YEAR              PIC  X(04).               
                   15  ASC-SCN-TIME-HOUR              PIC  X(02).               
                   15  ASC-SCN-TIME-MINUTE            PIC  X(02).               
                   15  ASC-SCN-TIME-INDICATOR         PIC  X(02).               
W28545             15  ASC-FILE-TRANS-IND             PIC  X(01).               
W33304             15  ASC-INV-STAT-CDE               PIC  X(02).               
                   15  ASC-L1-EXTENSION-AMT-X         PIC  X(14).               
                   15  ASC-L1-EXTENSION-AMT           PIC  9(9)V9(2).           
                   15  ASC-L1-QUANTITY-X              PIC  X(11).               
                   15  ASC-L1-QUANTITY                PIC  9(09).               
                   15  ASC-TOTAL-EXTENSION-X          PIC X(14).                
                   15  ASC-TOTAL-EXTENSION            PIC 9(9)V9(2).            
                   15  ASC-TOTAL-QUANTITY-X           PIC X(11).                
                   15  ASC-TOTAL-QUANTITY             PIC 9(09).                
                   15  ASC-UPDATE-REQUESTED-SW        PIC X(01).                
                       88  ASC-UPDATE-REQUESTED              VALUE 'Y'.         
                       88  ASC-UPDATE-NOT-REQUESTED          VALUE 'N'.         
                   15  ASC-LAPTOP-INFO-EXISTS-SW      PIC X(01).                
                       88  ASC-LAPTOP-INFO-EXISTS            VALUE 'Y'.         
                       88  ASC-NO-LAPTOP-INFO-EXISTS         VALUE 'N'.         
                   15  ASC-DATA-ENTERED-SW            PIC X(01).                
                       88  ASC-DATA-ENTERED                  VALUE 'Y'.         
                       88  ASC-NO-DATA-ENTERED               VALUE 'N'.         
                   15  ASC-TOTAL-ENTERED-SW           PIC X(01).                
                       88  ASC-TOTAL-ENTERED                 VALUE 'Y'.         
                       88  ASC-NO-TOTAL-ENTERED              VALUE 'N'.         
                   15  ASC-STORE-IN-INVENTORY-SW      PIC X(01).                
                       88  ASC-STORE-IN-INVENTORY            VALUE 'Y'.         
                       88  ASC-STORE-NOT-IN-INVENTORY        VALUE 'N'.         
RONNA              15  ASC-LAPTOP-FI-EXISTS-SW        PIC X(01).                
RONNA                  88  ASC-LAPTOP-FI-EXISTS              VALUE 'Y'.         
RONNA                  88  ASC-NO-LAPTOP-FI-EXISTS           VALUE 'N'.         
RONNA          10  FILLER                             PIC X(2692).              
RONNA *        10  FILLER                             PIC X(2693).              
                                                                                
           EJECT                                                                
      *----------------------------------------------------------------*        
      *    ABEND PROCESSING COPYBOOK.                                  *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS013.                                                        
                                                                                
       EJECT                                                                    
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR THE INVENTORY LAPTOP TABLE                    *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE TINVLAP                                                 
           END-EXEC.                                                            
                                                                                
       EJECT                                                                    
W28545*---------------------------------------------------------------*         
W28545*    DB2 AREA FOR THE INVENTORY CYCLE CONTROL TABLE             *         
W28545*---------------------------------------------------------------*         
W28545     EXEC SQL                                                             
W28545          INCLUDE TINCNTL                                                 
W28545     END-EXEC.                                                            
W28545                                                                          
W28545 EJECT                                                                    
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR THE INVENTORY PARMS TABLE                     *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE TINVPAR                                                 
           END-EXEC.                                                            
                                                                                
       EJECT                                                                    
W26600*---------------------------------------------------------------*         
W26600*    DB2 AREA FOR THE INVENTORY PARMS TABLE                     *         
W26600*---------------------------------------------------------------*         
W26600     EXEC SQL                                                             
W26600          INCLUDE XMT00001                                                
W26600     END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    DB2 AREA FOR COMMUNICATIONS                                *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
                                                                                
                                                                                
       EJECT                                                                    
       LINKAGE SECTION.                                                         
                                                                                
       01  DFHCOMMAREA.                                                         
           05  FILLER                         OCCURS  1 TO 4072 TIMES           
                                              DEPENDING ON EIBCALEN.            
               10  FILLER                     PIC X.                            
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      *****************************************************************         
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. **         
      ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  **         
      ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            **         
      **                                                             **         
      ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  **         
      ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       **         
      *****************************************************************         
       0000-MAIN-MODULE.                                                        
                                                                                
           INITIALIZE DP030-CICS-API-FIELDS.                                    
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
           MOVE LENGTH OF IN044AI        TO DP030-MAP-LENGTH (1).               
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
      *                                                                         
           PERFORM 1000-CONTROL-PROCESSING                                      
      *                                                                         
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
      ******************************************************************        
      **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
      **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
      ******************************************************************        
       0001-CALL-CICS-ARCH-API.                                                 
                                                                                
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                                       
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
                                 DFHCOMMAREA                                    
                                 DP030-CICS-API-FIELDS                          
                                 DP020-STANDARD-COMMAREA                        
                                 IN044AI.                                       
      *                                                                         
           IF  DP030-RC-CALL-SUCCESSFUL                                         
               CONTINUE                                                         
           ELSE                                                                 
               SET DP013-NO-ROLLBACK                                            
                   DP013-XCTL-DISPLAY-RESTART                                   
                   DP013-CICS-ABEND      TO TRUE                                
               MOVE 'BEFORE 0000-MAIN-MODULE'                                   
                                         TO DP013-PARAGRAPH                     
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
      *----------------------------------------------------------------*        
       1000-CONTROL-PROCESSING.                                                 
                                                                                
           EXEC CICS                                                            
               ASKTIME                                                          
                   ABSTIME(PC-ABSTIME)                                          
           END-EXEC.                                                            
                                                                                
           EXEC CICS                                                            
               FORMATTIME                                                       
                   ABSTIME(PC-ABSTIME)                                          
                   MMDDYY(PC-SYSTEM-DATE)                                       
           END-EXEC.                                                            
                                                                                
W28545     EXEC CICS                                                    05237000
W28545         ASSIGN SYSID (PV-CURRENT-SYSID)                          05238000
W28545     END-EXEC.                                                    05239000
W28545                                                                  05239100
W28545     MOVE PV-CURRENT-SYSID TO PC-SYS-ID.                          05239200
W28545                                                                  05239300
W28545     IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                            
W28545         MOVE DP015-PRO-DRK-MDT TO AFITOTLA                               
W28545                                   AEETOTLA                               
W28545                                   AEQTOTLA                               
W28545     ELSE                                                                 
W28545         MOVE DP015-ASK-NOR-OFF TO ASTTR01A                               
W28545                                   AEXTN01A                               
W28545                                   AQTY01A                                
W28545                                   ACOMPMMA                               
W28545                                   ACOMPDDA                               
W28545                                   ACOMPYYA                               
W28545                                   ACOMPHRA                               
W28545                                   ACOMPMIA                               
W28545                                   ACOMPIDA                               
W28545         MOVE DP015-BLUE        TO ASTTR01C                               
W28545                                   AEXTN01C                               
W28545                                   AQTY01C                                
W28545                                   ACOMPMMC                               
W28545                                   ACOMPDDC                               
W28545                                   ACOMPYYC                               
W28545                                   ACOMPHRC                               
W28545                                   ACOMPMIC                               
W28545                                   ACOMPIDC                               
W28545         MOVE DP015-HL-OFF      TO ASTTR01H                               
W28545                                   AEXTN01H                               
W28545                                   AQTY01H                                
W28545                                   ACOMPMMH                               
W28545                                   ACOMPDDH                               
W28545                                   ACOMPYYH                               
W28545                                   ACOMPHRH                               
W28545                                   ACOMPMIH                               
W28545                                   ACOMPIDH                               
W28545     END-IF.                                                              
W28545                                                                          
           EVALUATE TRUE                                                        
                                                                                
               WHEN DP020-NEXT-ACT-INITIAL                                      
                   PERFORM 1100-INITIALIZE-ASC                                  
                   PERFORM 4000-BUILD-INITIAL-PANEL                             
                                                                                
               WHEN DP020-NEXT-ACT-READ-MAP                                     
                   PERFORM 2000-PROCESS-PANEL                                   
                                                                                
               WHEN DP020-NEXT-ACT-RETURN                                       
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                                                                                
               WHEN OTHER                                                       
                   SET DP013-LOGIC-ABEND TO TRUE                                
                   SET DP013-NO-ROLLBACK TO TRUE                                
                   MOVE '1000-CONTROL-PROCESSING'                               
                                         TO DP013-PARAGRAPH                     
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
                                         TO DP013-MESSAGE-TEXT(1)               
                   MOVE DP020-NEXT-APPL-ACTIVITY                                
                                         TO DP013-MESSAGE-TEXT(2)               
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *  INITIALIZE THE ASC ON THE FIRST TIME INTO THE PROGRAM         *        
      *----------------------------------------------------------------*        
       1100-INITIALIZE-ASC.                                                     
                                                                                
           INITIALIZE ASC-SPECIFIC-COMMAREA.                                    
                                                                                
           SET ASC-UPDATE-NOT-REQUESTED     TO TRUE.                            
           SET ASC-NO-LAPTOP-INFO-EXISTS    TO TRUE.                            
           SET ASC-NO-DATA-ENTERED          TO TRUE.                            
           SET ASC-STORE-IN-INVENTORY       TO TRUE.                            
RONNA      SET ASC-NO-LAPTOP-FI-EXISTS      TO TRUE.                            
                                                                                
           SET PS-NO-ERROR                  TO TRUE.                            
           SET PS-NO-STORE-INV-ERROR        TO TRUE.                            
           SET PS-NO-DATE-ERROR             TO TRUE.                            
           SET PS-NO-TIME-ERROR             TO TRUE.                            
                                                                                
           EXEC SQL                                                             
               SET :PV-CURRENT-DATE = CURRENT DATE                              
           END-EXEC.                                                            
                                                                                
           MOVE PC-EMPTY-TMST               TO ASC-TIME-COMP-TMST.              
                                                                                
           MOVE PV-CURRENT-DATE             TO PV-DB2-DATE.                     
           MOVE PV-DB2-DATE-CCYY            TO ASC-CURRENT-YEAR                 
                                               ASC-SCN-TIME-YEAR                
                                               ASC-TIME-COMP-YEAR.              
           MOVE 'AM'                        TO ASC-SCN-TIME-INDICATOR.          
W28545     MOVE 'N'                         TO ASC-FILE-TRANS-IND.              
                                                                                
                                                                                
      *    --- IF THE LOCATION ISN'T A STORE, MOVE SPACES TO ---                
      *    --- THE STORE FIELDS.  OTHERWISE USE THE STORE    ---                
      *    --- NUMBER RETURNED FROM CICS ARCHITECTURE        ---                
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                             
               MOVE SPACES                  TO ASC-STORE-NBR                    
                                               ASC-STORE-NAME                   
           ELSE                                                                 
W26600         MOVE DP020-LOCATION-NBR      TO PV-STORE-NBR                     
W26600         MOVE PV-STORE-NBR            TO ASC-STORE-NBR                    
               PERFORM 3300-GET-STORE-NAME                                      
W26600         MOVE XMT00001-LOC-NM         TO ASC-STORE-NAME                   
W28545*    --- GET INV-ID FROM INVENTORY PARAMTERS ---                          
W28545         PERFORM 8100-SELECT-TINVPAR-TABLE                                
RONNA *        CHECK FOR A 'FI' FILE TYPE                                       
RONNA          PERFORM 4150-GET-LAPTOP-FI-INFO                                  
               PERFORM 4100-GET-LAPTOP-INFO                                     
      *        --- ACTL_INV_RECD_DTE WILL BE '9999-09-09' IF ---                
      *        --- THE STORE IS SET UP FOR INVENTORY         ---                
               PERFORM 8000-SELECT-TINVPAR-TABLE                                
               IF ASC-STORE-NOT-IN-INVENTORY                                    
                   SET  PS-ERROR                                                
                        PS-STORE-INV-ERROR                                      
                        DP020-MSG-FATAL  TO TRUE                                
      *            ---- STORE NOT IN INVENTORY ----                             
                   MOVE PC-TSYMSG-01655  TO DP020-MSG-NUMBER                    
                   MOVE DP015-REVERSE    TO ASTOREH                             
                   SET DP030-SET-CURSOR-APPL-1                                  
                                         TO TRUE                                
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*        
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
      * FUNCTION KEYS CAN GET THIS FAR.                                *        
      *----------------------------------------------------------------*        
       2000-PROCESS-PANEL.                                                      
                                                                                
           EVALUATE TRUE                                                        
                                                                                
               WHEN DP020-SRC-AID = DP016-CLEAR                                 
                   SET ASC-UPDATE-NOT-REQUESTED TO TRUE                         
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                                                                                
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
                   SET ASC-UPDATE-NOT-REQUESTED TO TRUE                         
                   SET DP030-DONT-ERASE                                         
                       DP030-SEND-DATAONLY (PC-APPL-MAP)                        
                                                TO TRUE                         
                   PERFORM 1100-INITIALIZE-ASC                                  
                   PERFORM 4000-BUILD-INITIAL-PANEL                             
                   PERFORM 3200-RESET-ATTRIBUTES                                
                                                                                
W28545*        --- LIST STORES KEY WAS HIT ---                                  
W28545         WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)                      
W28545             CONTINUE                                                     
W28545                                                                          
               WHEN OTHER                                                       
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
                   IF  PS-NO-ERROR                                              
                       SET DP030-CONTINUE-GO    TO TRUE                         
                       PERFORM 2100-CHECK-FUNCTION-KEY                          
                   ELSE                                                         
                       SET DP030-OVERRIDE-GO    TO TRUE                         
                   END-IF                                                       
           END-EVALUATE.                                                        
                                                                                
      *----------------------------------------------------------------*        
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *        
      * FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *        
      * FROM THE CICS ARCHITECTURE API.                                *        
      *----------------------------------------------------------------*        
       2100-CHECK-FUNCTION-KEY.                                                 
                                                                                
           EVALUATE TRUE                                                        
                                                                                
               WHEN DP020-SRC-AID = DP016-ENTER                                 
                   SET ASC-UPDATE-NOT-REQUESTED TO TRUE                         
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                                                                                
      *        --- ADD KEY WAS HIT ---                                          
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
W28545             IF INVPAR-FIL-TOT-BAL-CDE NOT = 'Y'                          
W28545                 SET ASC-UPDATE-NOT-REQUESTED TO TRUE                     
W28545                 IF ASC-NO-LAPTOP-INFO-EXISTS                             
W28545                     PERFORM 5000-ADD-LAPTOP-INFO                         
W28545                     IF ASC-LAPTOP-INFO-EXISTS                            
W28545                         PERFORM 7000-SUBMIT-JOB-INK908                   
W28545*                     --- INVENTORY COMPLETE - CALL OPERATIONS ---        
W28545                         MOVE 'WIP'            TO AYES001O                
RONNA *                        MOVE PC-TSYMSG-01656  TO DP020-MSG-NUMBERBER     
RONNA                          MOVE PC-TSYMSG-03492  TO DP020-MSG-NUMBERBER     
W28545                         SET DP020-MSG-WARNING TO TRUE                    
W28545                     END-IF                                               
W28545                 ELSE                                                     
W28545*                    --- CANNOT ADD, RECORD ALREADY EXISTS ---            
W28545                     MOVE PC-TSYMSG-00117      TO DP020-MSG-NUMBERBER     
W28545                     SET DP020-MSG-INFORMATIONAL TO TRUE                  
W28545                 END-IF                                                   
W28545             ELSE                                                         
W28545*                --- FILES ALREADY BALANCED ---                           
W28545                 SET DP020-MSG-WARNING         TO TRUE                    
W28545                 MOVE PC-TSYMSG-03496          TO DP020-MSG-NUMBERBER     
W28545                 MOVE DP015-RED                TO AYES001C                
W28545                 MOVE DP015-REVERSE            TO AYES001H                
W28545             END-IF                                                       
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                                                                                
      *        --- UPDATE KEY WAS HIT ---                                       
               WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
W28545             IF INVPAR-FIL-TOT-BAL-CDE NOT = 'Y'                          
W28545                 IF ASC-LAPTOP-INFO-EXISTS                                
W28545                     IF ASC-TOTAL-ENTERED                                 
W28545                         SET ASC-UPDATE-REQUESTED  TO TRUE                
W28545                         PERFORM 6000-UPDATE-LAPTOP-INFO                  
W33304                         IF INVLAP-INV-STAT-CDE = 'NB'                    
W28545                             PERFORM 7500-SUBMIT-JOB-INK918               
W28545*                            ---TRANSMISSION FILE IS PROCESSING           
W28545                             MOVE 'WIP'            TO AYES001O            
RONNA *                            MOVE PC-TSYMSG-01656  TO                     
RONNA                              MOVE PC-TSYMSG-03492  TO                     
W28545                                                  DP020-MSG-NUMBER        
W28545                             SET DP020-MSG-WARNING TO TRUE                
RONNAM                         ELSE                                             
RONNAM*                        INK908* JOB DID NOT MAKE IT TO THE END           
RONNAM*                        OF INKUT153 YET                                  
RONNAM*                        UPDATE REQUESTED AND TRANSMISSION                
RONNAM*                        FILE NEEDS TO BE PULLED IN AGAIN                 
RONNAM                             PERFORM 7000-SUBMIT-JOB-INK908               
RONNAM*                            ---TRANSMISSION FILE IS PROCESSING           
RONNAM                             MOVE 'WIP'        TO AYES001O                
RONNAM                             MOVE PC-TSYMSG-03492                         
RONNAM                                               TO DP020-MSG-NUMBER        
RONNAM                             SET DP020-MSG-WARNING                        
RONNAM                                               TO TRUE                    
W28545                         END-IF                                           
W28545                         SET ASC-UPDATE-NOT-REQUESTED                     
W28545                             ASC-NO-TOTAL-ENTERED  TO TRUE                
W28545                     END-IF                                               
W28545                 ELSE                                                     
W28545*                    --- LAPTOP INFO MUST EXIST BEFORE UPDATE ---         
W28545                     MOVE PC-TSYMSG-01657      TO DP020-MSG-NUMBER        
W28545                     SET DP020-MSG-WARNING        TO TRUE                 
W28545                     SET ASC-UPDATE-NOT-REQUESTED TO TRUE                 
W28545                 END-IF                                                   
W28545             ELSE                                                         
W28545*                --- FILES ALREADY BALANCED ---                           
W28545                 SET DP020-MSG-WARNING         TO TRUE                    
W28545                 MOVE PC-TSYMSG-03496          TO DP020-MSG-NUMBERBER     
W28545                 MOVE DP015-RED                TO AYES001C                
W28545                 MOVE DP015-REVERSE            TO AYES001H                
W28545             END-IF                                                       
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                                                                                
      *        --- WEB KEY WAS HIT ---                                          
W28545         WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)                      
W28545*            --- FUNCTION NOT AVAILABLE ---                               
W28545             MOVE PC-TSYMSG-99901         TO DP020-MSG-NUMBER             
W28545             SET DP020-MSG-WARNING        TO TRUE                         
W28545             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
W28545                                                                          
      *        --- RESUBMIT KEY WAS HIT ---                                     
W28545         WHEN DP020-FK-LOCAL-FUNC-12 (DP020-SRC-AID)                      
W28545             IF INVPAR-FIL-TOT-BAL-CDE NOT = 'Y'                          
W28545                 IF ASC-LAPTOP-INFO-EXISTS                                
W33304                     IF INVLAP-INV-STAT-CDE NOT = 'BL'                    
W28545                         PERFORM 7000-SUBMIT-JOB-INK908                   
W28545*                    --- INVENTORY COMPLETE - CALL OPERATIONS ---         
W28545                         MOVE 'WIP'            TO AYES001O                
RONNA *                        MOVE PC-TSYMSG-01656  TO DP020-MSG-NUMBER        
RONNA                          MOVE PC-TSYMSG-03492  TO DP020-MSG-NUMBER        
W28545                         SET DP020-MSG-WARNING TO TRUE                    
W28545                     ELSE                                                 
W28545                         SET DP020-MSG-WARNING TO TRUE                    
W28545                         MOVE PC-TSYMSG-03496  TO DP020-MSG-NUMBERBER     
W28545                         MOVE DP015-RED        TO AYES001C                
W28545                         MOVE DP015-REVERSE    TO AYES001H                
W28545                     END-IF                                               
W28545                 ELSE                                                     
W28545*                    --- LAPTOP INFO MUST EXIST BEFORE UPDATE ---         
W28545                     MOVE PC-TSYMSG-01657      TO DP020-MSG-NUMBER        
W28545                     SET DP020-MSG-WARNING        TO TRUE                 
W28545                     SET ASC-UPDATE-NOT-REQUESTED TO TRUE                 
W28545                 END-IF                                                   
W28545             ELSE                                                         
W28545*                --- FILES ALREADY BALANCED ---                           
W28545                 SET DP020-MSG-WARNING         TO TRUE                    
W28545                 MOVE PC-TSYMSG-03496          TO DP020-MSG-NUMBERBER     
W28545                 MOVE DP015-RED                TO AYES001C                
W28545                 MOVE DP015-REVERSE            TO AYES001H                
W28545             END-IF                                                       
W28545             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
W28545                                                                          
               WHEN OTHER                                                       
                   SET DP013-NO-ROLLBACK                                        
                       DP013-XCTL-DISPLAY-RESTART                               
                       DP013-CICS-ABEND  TO TRUE                                
                   MOVE '2100-CHECK-FUNCTION-KEY'                               
                                         TO DP013-PARAGRAPH                     
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
                                         TO DP013-MESSAGE-TEXT (1)              
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *        
      * IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *        
      * THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *        
      *----------------------------------------------------------------*        
       2200-MOVE-SCREEN-TO-COMMAREA.                                            
                                                                                
                                                                                
      *    --- ON A CHANGE IN STORE NUMBER, SET THE ---                         
      *    --- DATA NO DATA ENTERED FLAG TO TRUE    ---                         
           IF  ASTOREL > ZERO                                                   
               IF ASTOREI NOT EQUAL ASC-STORE-NBR                               
                   SET ASC-NO-DATA-ENTERED                                      
                                         TO TRUE                                
               END-IF                                                           
               MOVE ASTOREI              TO ASC-STORE-NBR                       
           ELSE                                                                 
               IF  ASTOREF = DP015-ERASE-EOF                                    
                   MOVE SPACE            TO ASC-STORE-NBR                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  ACOMPMML > ZERO                                                  
               MOVE ACOMPMMI             TO ASC-SCN-TIME-MONTH                  
               SET ASC-DATA-ENTERED      TO TRUE                                
           ELSE                                                                 
               IF  ACOMPMMF = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-SCN-TIME-MONTH                  
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  ACOMPDDL > ZERO                                                  
               MOVE ACOMPDDI             TO ASC-SCN-TIME-DAY                    
               SET ASC-DATA-ENTERED      TO TRUE                                
           ELSE                                                                 
               IF  ACOMPDDF = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-SCN-TIME-DAY                    
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  ACOMPHRL > ZERO                                                  
               MOVE ACOMPHRI             TO ASC-SCN-TIME-HOUR                   
               SET ASC-DATA-ENTERED      TO TRUE                                
           ELSE                                                                 
               IF  ACOMPHRF = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-SCN-TIME-HOUR                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  ACOMPMIL > ZERO                                                  
               MOVE ACOMPMII             TO ASC-SCN-TIME-MINUTE                 
               SET ASC-DATA-ENTERED      TO TRUE                                
           ELSE                                                                 
               IF  ACOMPMIF = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-SCN-TIME-MINUTE                 
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  ACOMPIDL > ZERO                                                  
               MOVE ACOMPIDI             TO ASC-SCN-TIME-INDICATOR              
               SET ASC-DATA-ENTERED      TO TRUE                                
           ELSE                                                                 
               IF  ACOMPIDF = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-SCN-TIME-INDICATOR              
               END-IF                                                           
           END-IF.                                                              
                                                                                
W28545     IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                            
W28545         IF  ASTTR01L > ZERO                                              
W28545             MOVE ASTTR01I             TO ASC-FILE-TRANS-IND              
W28545             SET ASC-DATA-ENTERED      TO TRUE                            
W28545         ELSE                                                             
W28545             IF  ASTTR01F = DP015-ERASE-EOF                               
W28545                 MOVE SPACE            TO ASC-FILE-TRANS-IND              
W28545             END-IF                                                       
W28545         END-IF                                                           
W28545     END-IF.                                                              
W28545                                                                          
           IF  AEXTN01L > ZERO                                                  
               MOVE AEXTN01I             TO ASC-L1-EXTENSION-AMT-X              
               SET ASC-DATA-ENTERED                                             
                   ASC-TOTAL-ENTERED     TO TRUE                                
           ELSE                                                                 
               IF  AEXTN01F = DP015-ERASE-EOF                                   
                   MOVE SPACE            TO ASC-L1-EXTENSION-AMT-X              
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  AQTY01L > ZERO                                                   
               MOVE AQTY01I              TO ASC-L1-QUANTITY-X                   
               SET ASC-DATA-ENTERED                                             
                   ASC-TOTAL-ENTERED     TO TRUE                                
           ELSE                                                                 
               IF  AQTY01F = DP015-ERASE-EOF                                    
                   MOVE SPACE            TO ASC-L1-QUANTITY-X                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *        
      * IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *        
      * APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *        
      *----------------------------------------------------------------*        
       3000-EDIT-DATA-IN-COMMAREA.                                              
                                                                                
           SET PS-NO-ERROR                    TO TRUE.                          
           SET PS-NO-STORE-NBR-ERROR          TO TRUE.                          
           SET PS-NO-STORE-INV-ERROR          TO TRUE.                          
           SET PS-NO-DATE-ERROR               TO TRUE.                          
           SET PS-NO-TIME-ERROR               TO TRUE.                          
                                                                                
      *    --- EDIT THE STORE NUMBER ---                                        
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                             
               IF ASC-STORE-NBR > SPACE                                         
                   MOVE ASC-STORE-NBR         TO DP010I-UNEDITED-FIELD          
                   MOVE LENGTH OF ASC-STORE-NBR                                 
                                              TO DP010I-MAXIMUM-DIGITS          
                   MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS        
                   SET  DP010I-NEGATIVE-NOT-ALLOWED                             
                                              TO TRUE                           
263126             CALL DP010I-NUMERIC-EDIT-ROUTINE                             
263126                  USING DP010I-NUMERIC-EDIT-AREA                          
                                                                                
                   IF DP010I-ERROR-DETECTED                                     
                       MOVE DP015-UNP-ALP-BRT-OFF   TO ASTOREA                  
                       MOVE DP015-RED               TO ASTOREC                  
                       MOVE DP015-REVERSE           TO ASTOREH                  
                       IF  PS-NO-ERROR                                          
                           SET PS-ERROR                                         
                               PS-STORE-NBR-ERROR                               
                               DP030-SET-CURSOR-APPL-1                          
                               DP020-MSG-FATAL      TO TRUE                     
      *                    ---- MUST BE NUMERIC ----                            
                           MOVE PC-TSYMSG-00008     TO DP020-MSG-NUMBER         
                           MOVE -1                  TO ASTOREL                  
                       END-IF                                                   
                   ELSE                                                         
                       MOVE DP010I-NUMERIC-FIELD    TO PV-STORE-NBR             
                       MOVE PV-STORE-NBR            TO ASC-STORE-NBR            
W26600                 IF ASC-STORE-NBR = '0000'                                
                           MOVE DP015-UNP-ALP-BRT-OFF                           
                                                    TO ASTOREA                  
                           MOVE DP015-RED           TO ASTOREC                  
                           MOVE DP015-REVERSE       TO ASTOREH                  
                           IF  PS-NO-ERROR                                      
                               SET PS-ERROR                                     
                                   PS-STORE-NBR-ERROR                           
                                   DP030-SET-CURSOR-APPL-1                      
                                   DP020-MSG-FATAL  TO TRUE                     
      *                        ---- CANNOT BE ZERO ----                         
                               MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER         
                               MOVE -1              TO ASTOREL                  
                           END-IF                                               
                       ELSE                                                     
                           PERFORM 3300-GET-STORE-NAME                          
                           EVALUATE TRUE                                        
                               WHEN SQLCODE = 0                                 
W26600                             MOVE XMT00001-LOC-NM                         
                                                       TO ASC-STORE-NAME        
W28545                                                    ASTDESCO              
                                   IF ASC-NO-DATA-ENTERED                       
W28545*                      --- GET INV-ID FROM INVENTORY PARAMTERS ---        
W28545                                 PERFORM 8100-SELECT-TINVPAR-TABLE        
RONNA *                                ALSO CHECK FOR 'FI' RECORD TYPE          
RONNA                                  PERFORM 4150-GET-LAPTOP-FI-INFO          
                                       PERFORM 4100-GET-LAPTOP-INFO             
                                   END-IF                                       
      *                            --- ACTL_INV_RECD_DTE WILL BE   ---          
      *                            --- '9999-09-09' IF THE STORE   ---          
      *                            --- IS IN INVENTORY             ---          
                                   PERFORM 8000-SELECT-TINVPAR-TABLE            
                                   IF ASC-STORE-NOT-IN-INVENTORY                
                                       MOVE ASC-STORE-NAME   TO ASTDESCO        
                                       MOVE DP015-UNP-ALP-BRT-OFF               
                                                             TO ASTOREA         
                                       MOVE DP015-RED        TO ASTOREC         
                                       MOVE DP015-REVERSE    TO ASTOREH         
                                       IF  PS-NO-ERROR                          
                                           SET PS-ERROR                         
                                               PS-STORE-INV-ERROR               
                                               DP030-SET-CURSOR-APPL-1          
                                               DP020-MSG-FATAL                  
                                                             TO TRUE            
      *                                ---- STORE NOT IN INVENTORY ----         
                                           MOVE PC-TSYMSG-01655                 
                                                    TO DP020-MSG-NUMBER         
                                           MOVE -1           TO ASTOREL         
                                       END-IF                                   
                                   END-IF                                       
                               WHEN SQLCODE = +100                              
                                   MOVE DP015-UNP-ALP-BRT-OFF TO ASTOREA        
                                   MOVE DP015-RED             TO ASTOREC        
                                   MOVE DP015-REVERSE         TO ASTOREH        
                                   IF  PS-NO-ERROR                              
                                       SET PS-ERROR                             
                                           PS-STORE-NBR-ERROR                   
                                           DP030-SET-CURSOR-APPL-1              
                                           DP020-MSG-FATAL    TO TRUE           
      *                                ---- STORE DOES NOT EXIST ----           
                                       MOVE PC-TSYMSG-00017                     
                                                     TO DP020-MSG-NUMBER        
                                       MOVE -1                TO ASTOREL        
                                   END-IF                                       
                               WHEN OTHER                                       
                                   IF  PS-NO-ERROR                              
                                       SET PS-ERROR                             
                                           DP020-MSG-WARNING   TO TRUE          
      *                            ---- WAIT 15 SECONDS, THEN RETRY ----        
                                       MOVE PC-TSYMSG-00551                     
                                                     TO DP020-MSG-NUMBER        
                                   END-IF                                       
                           END-EVALUATE                                         
                       END-IF                                                   
                   END-IF                                                       
               ELSE                                                             
                   MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA                       
                   MOVE DP015-RED              TO ASTOREC                       
                   MOVE DP015-REVERSE          TO ASTOREH                       
                   IF  PS-NO-ERROR                                              
                       SET PS-ERROR                                             
                           PS-STORE-NBR-ERROR                                   
                           DP030-SET-CURSOR-APPL-1                              
                           DP020-MSG-FATAL     TO TRUE                          
      *                ---- REQUIRED ENTRY ----                                 
                       MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              
                       MOVE -1                 TO ASTOREL                       
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
W26600         MOVE DP020-LOCATION-NBR         TO PV-STORE-NBR                  
W26600         MOVE PV-STORE-NBR               TO ASC-STORE-NBR                 
               PERFORM 3300-GET-STORE-NAME                                      
W26600         MOVE XMT00001-LOC-NM            TO ASC-STORE-NAME                
      *        --- ACTL_INV_RECD_DTE WILL BE '9999-09-09' IF ---                
      *        --- THE STORE IS SET UP FOR INVENTORY         ---                
               PERFORM 8000-SELECT-TINVPAR-TABLE                                
               IF ASC-STORE-NOT-IN-INVENTORY                                    
                   MOVE ASC-STORE-NAME         TO ASTDESCO                      
                   MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA                       
                   MOVE DP015-RED              TO ASTOREC                       
                   MOVE DP015-REVERSE          TO ASTOREH                       
                   IF  PS-NO-ERROR                                              
                       SET PS-ERROR                                             
                           PS-STORE-INV-ERROR                                   
                           DP030-SET-CURSOR-APPL-1                              
                           DP020-MSG-FATAL     TO TRUE                          
      *                ---- STORE NOT IN INVENTORY ----                         
                       MOVE PC-TSYMSG-01655    TO DP020-MSG-NUMBER              
                       MOVE -1                 TO ASTOREL                       
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    --- IF THERE WAS AN ERROR WITH THE STORE NUMBER, BLANK ---           
      *    --- OUT THE STORE NAME, DATE/TIME COMPLETED, AND ZERO  ---           
      *    --- OUT THE EXTENTIONS AND QUANTITY AMOUNTS.  POSSIBLE ---           
      *    --- ERRORS INCLUDE '000' FOR STORE NUMBER, OR STORE    ---           
      *    --- NUMBER NOT FOUND.                                  ---           
           IF PS-STORE-NBR-ERROR                                                
               MOVE SPACES               TO ASTDESCO                            
                                            ASC-STORE-NAME                      
                                            ASC-L1-EXTENSION-AMT-X              
W28545                                      ASC-FILE-TRANS-IND                  
                                            ASC-L1-QUANTITY-X                   
W28545         IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                          
W28545             MOVE SPACES           TO ASC-TOTAL-EXTENSION-X               
W28545                                      ASC-TOTAL-QUANTITY-X                
W28545         END-IF                                                           
               MOVE ZEROES               TO AEXTN01O                            
                                            AQTY01O                             
W28545         IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                          
W28545             MOVE ZEROES           TO AEETOTLO                            
W28545                                      AEQTOTLO                            
W28545         END-IF                                                           
               MOVE 'MM'                 TO ACOMPMMO                            
                                            ASC-SCN-TIME-MONTH                  
               MOVE 'DD'                 TO ACOMPDDO                            
                                            ASC-SCN-TIME-DAY                    
               MOVE 'HH'                 TO ACOMPHRO                            
                                            ASC-SCN-TIME-HOUR                   
               MOVE 'MM'                 TO ACOMPMIO                            
                                            ASC-SCN-TIME-MINUTE                 
               MOVE 'AM'                 TO ACOMPIDO                            
                                            ASC-SCN-TIME-INDICATOR              
           END-IF.                                                              
                                                                                
      *    --- EDIT FOR TIME COUNT COMPLETE DATE ---                            
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                      
           SET  DPG51-ACTUAL-CALENDAR-ONLY                                      
                                      TO TRUE.                                  
           SET  DPG51-DO-NOT-INCR-DECR-DATE                                     
                                      TO TRUE.                                  
           SET  DPG52-LK-DTE-ISO-FMT  TO TRUE.                                  
           MOVE ASC-SCN-TIME-MONTH    TO PV-DB2-DATE-MM.                        
           MOVE ASC-SCN-TIME-DAY      TO PV-DB2-DATE-DD.                        
           MOVE ASC-SCN-TIME-YEAR     TO PV-DB2-DATE-CCYY.                      
           MOVE PV-DB2-DATE           TO DPG52-LK-DATE-INPUT.                   
                                                                                
           CALL DP500-KOHLS-CALENDAR-ROUTINE                                    
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                       
                                                                                
           EVALUATE TRUE                                                        
               WHEN DPG54-SEVERE-ERROR                                          
                   SET PS-DATE-ERROR TO TRUE                                    
                                                                                
               WHEN OTHER                                                       
                   CONTINUE                                                     
                                                                                
           END-EVALUATE.                                                        
                                                                                
           IF DPG54-DATE-INVALID OR PS-DATE-ERROR                               
               MOVE ASC-SCN-TIME-MONTH     TO ACOMPMMO                          
               MOVE ASC-SCN-TIME-DAY       TO ACOMPDDO                          
               MOVE DP015-RED              TO ACOMPMMC                          
                                              ACOMPDDC                          
               MOVE DP015-REVERSE          TO ACOMPMMH                          
                                              ACOMPDDH                          
               MOVE DP015-UNP-ALP-BRT-OFF  TO ACOMPMMA                          
                                              ACOMPDDA                          
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       PS-DATE-ERROR                                            
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL     TO TRUE                              
      *            ---- INVALID DATE ----                                       
                   MOVE PC-TSYMSG-00009    TO DP020-MSG-NUMBER                  
                   MOVE -1                 TO ACOMPMML                          
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    --- EDIT FOR TIME COUNT COMPLETE HOUR ---                            
           MOVE ASC-SCN-TIME-HOUR                                               
                                   TO DP010I-UNEDITED-FIELD.                    
           MOVE 2                  TO DP010I-MAXIMUM-DIGITS.                    
           MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.                  
           SET DP010I-NEGATIVE-NOT-ALLOWED                                      
                                   TO TRUE.                                     
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
           IF  DP010I-ERROR-DETECTED                                            
               MOVE ASC-SCN-TIME-HOUR      TO ACOMPHRO                          
               MOVE DP015-RED              TO ACOMPHRC                          
               MOVE DP015-REVERSE          TO ACOMPHRH                          
               MOVE DP015-UNP-ALP-BRT-OFF  TO ACOMPHRA                          
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       PS-TIME-ERROR                                            
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL     TO TRUE                              
      *            ---- MUST BE A POSITIVE NUMERIC ----                         
                   MOVE PC-TSYMSG-00343    TO DP020-MSG-NUMBER                  
                   MOVE -1                 TO ACOMPHRL                          
               END-IF                                                           
           ELSE                                                                 
               IF ( ASC-SCN-TIME-HOUR > '00' ) AND                              
                  ( ASC-SCN-TIME-HOUR < '13' )                                  
                   MOVE DP010I-NUMERIC-FIELD                                    
                                       TO PV-TIME-COMP-HOUR-9                   
                   MOVE PV-TIME-COMP-HOUR-9                                     
                                       TO ASC-SCN-TIME-HOUR                     
                   MOVE ASC-SCN-TIME-HOUR                                       
                                       TO ACOMPHRO                              
               ELSE                                                             
                   MOVE ASC-SCN-TIME-HOUR      TO ACOMPHRO                      
                   MOVE DP015-RED              TO ACOMPHRC                      
                   MOVE DP015-REVERSE          TO ACOMPHRH                      
                   MOVE DP015-UNP-ALP-BRT-OFF  TO ACOMPHRA                      
                   IF  PS-NO-ERROR                                              
                       SET PS-ERROR                                             
                           PS-TIME-ERROR                                        
                           DP030-SET-CURSOR-APPL-1                              
                           DP020-MSG-FATAL     TO TRUE                          
      *                ---- INVALID TIME ----                                   
                       MOVE PC-TSYMSG-01664    TO DP020-MSG-NUMBER              
                       MOVE -1                 TO ACOMPHRL                      
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    --- EDIT TIME COUNT COMPLETE MINUTE ---                              
           MOVE ASC-SCN-TIME-MINUTE                                             
                                   TO DP010I-UNEDITED-FIELD.                    
           MOVE 2                  TO DP010I-MAXIMUM-DIGITS.                    
           MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.                  
           SET DP010I-NEGATIVE-NOT-ALLOWED                                      
                                   TO TRUE.                                     
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
           IF  DP010I-ERROR-DETECTED                                            
               MOVE ASC-SCN-TIME-MINUTE    TO ACOMPMIO                          
               MOVE DP015-RED              TO ACOMPMIC                          
               MOVE DP015-REVERSE          TO ACOMPMIH                          
               MOVE DP015-UNP-ALP-BRT-OFF  TO ACOMPMIA                          
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       PS-TIME-ERROR                                            
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL     TO TRUE                              
      *            ---- MUST BE A POSITIVE NUMERIC ----                         
                   MOVE PC-TSYMSG-00343    TO DP020-MSG-NUMBER                  
                   MOVE -1                 TO ACOMPMIL                          
               END-IF                                                           
           ELSE                                                                 
               IF ( ASC-SCN-TIME-MINUTE >= '00' ) AND                           
                  ( ASC-SCN-TIME-MINUTE <  '60' )                               
                   MOVE DP010I-NUMERIC-FIELD                                    
                                       TO PV-TIME-COMP-MINUTE-9                 
                   MOVE PV-TIME-COMP-MINUTE-9                                   
                                       TO ASC-SCN-TIME-MINUTE                   
                   MOVE ASC-SCN-TIME-MINUTE                                     
                                       TO ACOMPMIO                              
               ELSE                                                             
                   MOVE ASC-SCN-TIME-MINUTE    TO ACOMPMIO                      
                   MOVE DP015-RED              TO ACOMPMIC                      
                   MOVE DP015-REVERSE          TO ACOMPMIH                      
                   MOVE DP015-UNP-ALP-BRT-OFF  TO ACOMPMIA                      
                   IF  PS-NO-ERROR                                              
                       SET PS-ERROR                                             
                           PS-TIME-ERROR                                        
                           DP030-SET-CURSOR-APPL-1                              
                           DP020-MSG-FATAL     TO TRUE                          
      *                ---- INVALID TIME ----                                   
                       MOVE PC-TSYMSG-01664    TO DP020-MSG-NUMBER              
                       MOVE -1                 TO ACOMPMIL                      
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    --- EDIT TIME COUNT COMPLETE AM/PM INDICATOR ---                     
           IF ASC-SCN-TIME-INDICATOR EQUAL 'AM' OR 'PM'                         
               MOVE ASC-SCN-TIME-INDICATOR     TO ACOMPIDO                      
           ELSE                                                                 
               MOVE ASC-SCN-TIME-INDICATOR     TO ACOMPIDO                      
               MOVE DP015-RED                  TO ACOMPIDC                      
               MOVE DP015-REVERSE              TO ACOMPIDH                      
               MOVE DP015-UNP-ALP-BRT-OFF      TO ACOMPIDA                      
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       PS-TIME-ERROR                                            
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL         TO TRUE                          
      *            ---- INVALID TIME ----                                       
                   MOVE PC-TSYMSG-01664        TO DP020-MSG-NUMBER              
                   MOVE -1                     TO ACOMPIDL                      
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    --- GET THE HOUR IN MILITARY TIME TO BE USED IN THE  ---             
      *    --- PHY-CNT-TMST (TIMESTAMP) FIELD WHEN UPDATING THE ---             
      *    --- TINVPAR TABLE LATER IN THE PROGRAM               ---             
           IF PS-NO-DATE-ERROR AND PS-NO-TIME-ERROR                             
               MOVE ASC-SCN-TIME-MONTH          TO ASC-TIME-COMP-MONTH          
               MOVE ASC-SCN-TIME-DAY            TO ASC-TIME-COMP-DAY            
               IF ASC-SCN-TIME-INDICATOR EQUAL 'PM'                             
                   IF ASC-SCN-TIME-HOUR NOT EQUAL '12'                          
                       MOVE ASC-SCN-TIME-HOUR   TO PV-TIME-COMP-HOUR-9          
                       ADD 12                   TO PV-TIME-COMP-HOUR-9          
                       MOVE PV-TIME-COMP-HOUR-9 TO ASC-TIME-COMP-HOUR           
                   ELSE                                                         
                       MOVE ASC-SCN-TIME-HOUR   TO ASC-TIME-COMP-HOUR           
                   END-IF                                                       
               ELSE                                                             
                   IF ASC-SCN-TIME-HOUR EQUAL '12'                              
                       MOVE '00'                TO ASC-TIME-COMP-HOUR           
                   ELSE                                                         
                       MOVE ASC-SCN-TIME-HOUR   TO ASC-TIME-COMP-HOUR           
                   END-IF                                                       
               END-IF                                                           
               MOVE ASC-SCN-TIME-MINUTE         TO ASC-TIME-COMP-MINUTE         
           END-IF.                                                              
                                                                                
           PERFORM 3200-RESET-ATTRIBUTES.                                       
                                                                                
W28545*    --- EDIT FILE TRANSMISSION INDICATOR ---                             
W28545     IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                            
W28545         IF ASC-FILE-TRANS-IND = 'Y' OR 'N'                               
W28545             MOVE ASC-FILE-TRANS-IND TO INVLAP-STR-TRSM-IND               
W28545         ELSE                                                             
W28545             MOVE DP015-RED              TO ASTTR01C                      
W28545             MOVE DP015-REVERSE          TO ASTTR01H                      
W28545             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTTR01A                      
W28545             IF  PS-NO-ERROR                                              
W28545                 SET PS-ERROR                                             
W28545                     DP030-SET-CURSOR-APPL-1                              
W28545                     DP020-MSG-FATAL     TO TRUE                          
W28545*                ---- Y/N REQUIRED ----                                   
W28545                 MOVE PC-TSYMSG-00349    TO DP020-MSG-NUMBER              
W28545                 MOVE -1                 TO ASTTR01L                      
W28545             END-IF                                                       
W28545         END-IF                                                           
W28545     END-IF.                                                              
W28545                                                                          
      *    --- EDIT EXTENSION FOR LAPTOP #1 ---                                 
           MOVE ASC-L1-EXTENSION-AMT-X                                          
                                   TO DP010I-UNEDITED-FIELD.                    
           MOVE 9                  TO DP010I-MAXIMUM-DIGITS.                    
           MOVE 2                  TO DP010I-MAXIMUM-DECIMALS.                  
           SET DP010I-NEGATIVE-NOT-ALLOWED                                      
                                   TO TRUE.                                     
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
           IF  DP010I-ERROR-DETECTED                                            
               MOVE DP015-RED              TO AEXTN01C                          
               MOVE DP015-REVERSE          TO AEXTN01H                          
               MOVE DP015-UNP-ALP-BRT-OFF  TO AEXTN01A                          
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL     TO TRUE                              
      *            ---- MUST BE A POSITIVE NUMERIC ----                         
                   MOVE PC-TSYMSG-00343    TO DP020-MSG-NUMBER                  
                   MOVE -1                 TO AEXTN01L                          
               END-IF                                                           
           ELSE                                                                 
               MOVE DP010I-NUMERIC-FIELD                                        
                                   TO ASC-L1-EXTENSION-AMT                      
               MOVE ASC-L1-EXTENSION-AMT                                        
                                   TO AEXTN01O                                  
               MOVE AEXTN01O       TO ASC-L1-EXTENSION-AMT-X                    
           END-IF.                                                              
                                                                                
      *    --- EDIT QUANTITY FOR LAPTOP #1 ---                                  
           MOVE ASC-L1-QUANTITY-X  TO DP010I-UNEDITED-FIELD.                    
           MOVE 9                  TO DP010I-MAXIMUM-DIGITS.                    
           MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.                  
           SET DP010I-NEGATIVE-NOT-ALLOWED                                      
                                   TO TRUE.                                     
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA.                                 
           IF  DP010I-ERROR-DETECTED                                            
               MOVE DP015-RED              TO AQTY01C                           
               MOVE DP015-REVERSE          TO AQTY01H                           
               MOVE DP015-UNP-ALP-BRT-OFF  TO AQTY01A                           
               IF  PS-NO-ERROR                                                  
                   SET PS-ERROR                                                 
                       DP030-SET-CURSOR-APPL-1                                  
                       DP020-MSG-FATAL     TO TRUE                              
      *            ---- MUST BE A POSITIVE NUMERIC ----                         
                   MOVE PC-TSYMSG-00343    TO DP020-MSG-NUMBER                  
                   MOVE -1                 TO AQTY01L                           
               END-IF                                                           
           ELSE                                                                 
               MOVE DP010I-NUMERIC-FIELD                                        
                                   TO ASC-L1-QUANTITY                           
               MOVE ASC-L1-QUANTITY                                             
                                   TO AQTY01O                                   
               MOVE AQTY01O        TO ASC-L1-QUANTITY-X                         
           END-IF.                                                              
                                                                                
                                                                                
      *    --- BALANCE THE CALCULATED TOTALS WITH THE TOTALS ---                
      *    --- ENTERED BY THE USER.  IF THEY DON'T MATCH,    ---                
      *    --- DISPLAY AN ERROR MESSAGE.                     ---                
           IF  PS-NO-ERROR                                                      
W28545         IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                          
W28545             IF ASC-L1-EXTENSION-AMT NOT EQUAL ASC-TOTAL-EXTENSION        
W28545                 SET DP020-MSG-WARNING       TO TRUE                      
      *              -- CALCULATED TOTAL DOES NOT MATCH ENTERED TOTAL --        
W28545*                MOVE PC-TSYMSG-01658        TO DP020-MSG-NUMBER          
RONNA                  IF ASC-LAPTOP-FI-EXISTS                                  
RONNA *                   NEED TO FURTHER CHECK TO SEE IF THE FI RECORD         
RONNA *                   HAS ZEROS IN THE DOLLAR AND QTY FIELDS                
RONNA *                   TO KNOW IF INK908 WAS RUN AND UPDATED THIS            
RONNA *                   FI RECORD.                                            
RONNA                     IF ASC-TOTAL-ENTERED                                  
RONNA *                      DOLLAR AMOUNT ENTERED IS GE 0 AND                  
RONNA *                      QTY ENTERED IS GREATER THAN 0                      
RONNA                        IF ASC-L1-EXTENSION-AMT NOT < 0 AND                
RONNA                          ASC-L1-QUANTITY > 0                              
RONNA *                        TOTALS UPDATED ON SCREEN                         
RONNA                          MOVE 'WIP'          TO AYES001O                  
RONNA                          MOVE PC-TSYMSG-03492 TO DP020-MSG-NUMBER         
RONNA                        ELSE                                               
RONNA                          MOVE 'NO '          TO AYES001O                  
RONNA                          MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER         
RONNA                        END-IF                                             
RONNA                     ELSE                                                  
RONNA                     IF ASC-TOTAL-EXTENSION = 0 AND                        
RONNA                        ASC-TOTAL-QUANTITY  = 0                            
RONNA                        MOVE 'NO '           TO AYES001O                   
RONNA *                      PRESS THE RESUBMIT KEY MESSAGE                     
RONNA                        MOVE PC-TSYMSG-01656 TO DP020-MSG-NUMBER           
RONNA                     ELSE                                                  
RONNA *                      TOTALS DO NOT BALANCE; CORRECT TOTALS              
RONNA                        MOVE 'NO '          TO AYES001O                    
RONNA                        MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER           
RONNA                     END-IF                                                
RONNA                  ELSE                                                     
RONNA *                   NO TRANSMISSION FILES ARE PRESENT                     
RONNA                     MOVE PC-TSYMSG-03493     TO DP020-MSG-NUMBER          
RONNA                  END-IF                                                   
                       MOVE ASC-TOTAL-EXTENSION    TO AEETOTLO                  
                       MOVE DP015-RED              TO AEETOTLC                  
                       MOVE DP015-REVERSE          TO AEETOTLH                  
                   END-IF                                                       
                                                                                
                   IF ASC-L1-QUANTITY NOT EQUAL ASC-TOTAL-QUANTITY              
W28545                 SET DP020-MSG-WARNING       TO TRUE                      
      *              -- CALCULATED TOTAL DOES NOT MATCH ENTERED TOTAL --        
RONNA                  IF ASC-LAPTOP-FI-EXISTS                                  
RONNA *                   NEED TO FURTHER CHECK TO SEE IF THE FI RECORD         
RONNA *                   HAS ZEROS IN THE DOLLAR AND QTY FIELDS                
RONNA *                   TO KNOW IF INK908 WAS RUN AND UPDATED THIS            
RONNA *                   FI RECORD.                                            
RONNA                     IF ASC-TOTAL-ENTERED                                  
RONNA *                      DOLLAR AMOUNT ENTERED IS GE 0 AND                  
RONNA *                      QTY ENTERED IS GREATER THAN 0                      
RONNA                        IF ASC-L1-EXTENSION-AMT NOT < 0 AND                
RONNA                           ASC-L1-QUANTITY > 0                             
RONNA *                         TOTALS UPDATED ON SCREEN                        
RONNA                           MOVE 'WIP'          TO AYES001O                 
RONNA                           MOVE PC-TSYMSG-03492 TO DP020-MSG-NUMBER        
RONNA                        ELSE                                               
RONNA                           MOVE 'NO '          TO AYES001O                 
RONNA *                         MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER        
RONNA                        END-IF                                             
RONNA                     ELSE                                                  
RONNA                     IF ASC-TOTAL-EXTENSION = 0 AND                        
RONNA                        ASC-TOTAL-QUANTITY  = 0                            
RONNA *                      DOLLAR AMOUNT ENTERED IS GE 0 AND                  
RONNA *                      QTY ENTERED IS GREATER THAN 0                      
RONNA                        IF ASC-L1-EXTENSION-AMT NOT < 0 AND                
RONNA                           ASC-L1-QUANTITY > 0                             
RONNA *                         TOTALS UPDATED ON SCREEN                        
RONNA                           MOVE 'WIP'          TO AYES001O                 
RONNA                           MOVE PC-TSYMSG-03492 TO DP020-MSG-NUMBER        
RONNA                        ELSE                                               
RONNA                           MOVE 'NO '          TO AYES001O                 
RONNA *                         MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER        
RONNA                        END-IF                                             
RONNA                     ELSE                                                  
RONNA                        MOVE 'NO '           TO AYES001O                   
RONNA *                      PRESS THE RESUBMIT KEY MESSAGE                     
RONNA                        MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER           
RONNA                     END-IF                                                
RONNA                  ELSE                                                     
RONNA *                   NO TRANSMISSION FILES ARE PRESENT                     
RONNA                     MOVE PC-TSYMSG-03493     TO DP020-MSG-NUMBER          
RONNA                  END-IF                                                   
                       MOVE ASC-TOTAL-QUANTITY     TO AEQTOTLO                  
                       MOVE DP015-RED              TO AEQTOTLC                  
                       MOVE DP015-REVERSE          TO AEQTOTLH                  
                   END-IF                                                       
W28545         END-IF                                                           
                                                                                
           END-IF.                                                              
                                                                                
           IF  PS-NO-ERROR                                                      
               IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                         
                   MOVE -1                  TO ASTOREL                          
               ELSE                                                             
                   MOVE -1                  TO ACOMPMML                         
               END-IF                                                           
               SET DP030-SET-CURSOR-APPL-1  TO TRUE                             
           END-IF.                                                              
                                                                                
                                                                                
      *                                                                         
      *----------------------------------------------------------------*        
      * MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *        
      * MAP.                                                           *        
      *----------------------------------------------------------------*        
       3200-RESET-ATTRIBUTES.                                                   
                                                                                
           IF PS-NO-STORE-NBR-ERROR AND PS-NO-STORE-INV-ERROR                   
               IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                         
                   MOVE DP015-UNP-ALP-NOR-OFF  TO ASTOREA                       
                   MOVE DP015-GREEN            TO ASTOREC                       
                   MOVE DP015-UNDERLINE        TO ASTOREH                       
               ELSE                                                             
                   MOVE DP015-ASK-NOR-OFF      TO ASTOREA                       
                   MOVE DP015-BLUE             TO ASTOREC                       
                   MOVE DP015-HL-OFF           TO ASTOREH                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF ASC-STORE-IN-INVENTORY                                            
W28545         IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                        
W28545             IF PS-NO-DATE-ERROR                                          
W28545                 MOVE DP015-UNP-ALP-NOR-OFF  TO ACOMPMMA                  
W28545                                                ACOMPDDA                  
W28545                 MOVE DP015-GREEN            TO ACOMPMMC                  
W28545                                                ACOMPDDC                  
W28545                 MOVE DP015-UNDERLINE        TO ACOMPMMH                  
W28545                                                ACOMPDDH                  
W28545             END-IF                                                       
W28545             IF PS-NO-TIME-ERROR                                          
W28545                 MOVE DP015-UNP-ALP-NOR-OFF  TO ACOMPHRA                  
W28545                                                ACOMPMIA                  
W28545                                                ACOMPIDA                  
W28545                 MOVE DP015-GREEN            TO ACOMPHRC                  
W28545                                                ACOMPMIC                  
W28545                                                ACOMPIDC                  
W28545                 MOVE DP015-UNDERLINE        TO ACOMPHRH                  
W28545                                                ACOMPMIH                  
W28545                                                ACOMPIDH                  
W28545             END-IF                                                       
W28545         END-IF                                                           
W28545         IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                        
W28545             MOVE DP015-UNP-ALP-NOR-OFF  TO ASTTR01A                      
W28545                                            AEXTN01A                      
W28545                                            AQTY01A                       
W28545         END-IF                                                           
                                                                                
                                                                                
W28545         IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                        
W28545             MOVE DP015-GREEN            TO ASTTR01C                      
W28545                                            AEXTN01C                      
W28545                                            AQTY01C                       
W28545         END-IF                                                           
                                                                                
W28545         IF DP020-SRC-MNEMONIC = PC-STORE-MNEMONIC                        
W28545             MOVE DP015-UNDERLINE        TO ASTTR01H                      
W28545                                            AEXTN01H                      
W28545                                            AQTY01H                       
W28545         END-IF                                                           
                                                                                
           ELSE                                                                 
               MOVE DP015-ASK-NOR-OFF          TO ACOMPMMA                      
                                                  ACOMPDDA                      
                                                  ACOMPHRA                      
                                                  ACOMPMIA                      
                                                  ACOMPIDA                      
W28545                                            ASTTR01A                      
                                                  AEXTN01A                      
                                                  AQTY01A                       
                                                                                
               MOVE DP015-BLUE                 TO ACOMPMMC                      
                                                  ACOMPDDC                      
                                                  ACOMPHRC                      
                                                  ACOMPMIC                      
                                                  ACOMPIDC                      
W28545                                            ASTTR01C                      
                                                  AEXTN01C                      
                                                  AQTY01C                       
                                                                                
               MOVE DP015-HL-OFF               TO ACOMPMMH                      
                                                  ACOMPDDH                      
                                                  ACOMPHRH                      
                                                  ACOMPMIH                      
                                                  ACOMPIDH                      
W28545                                            ASTTR01H                      
                                                  AEXTN01H                      
                                                  AQTY01H                       
                                                                                
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * RETREIVE THE STORE NAME SO IT CAN BE DISPLAYED ON THE SCREEN.  *        
      *----------------------------------------------------------------*        
       3300-GET-STORE-NAME.                                                     
                                                                                
           MOVE ASC-STORE-NBR              TO DK-STORE-NBR.                     
W26600     MOVE DK-STORE-NBR               TO XMT00001-LOC-NBR.                 
W26600     MOVE SPACES                     TO XMT00001-LOC-NM.                  
                                                                                
W26600     EXEC SQL                                                             
W26600         SELECT LOC_NM                                                    
W26600         INTO  :XMT00001-LOC-NM                                           
W26600         FROM XMT_LOC                                                     
W26600         WHERE LOC_NBR = :XMT00001-LOC-NBR                                
W26600     END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
               WHEN SQLCODE = +100                                              
               WHEN SQLCODE = -911                                              
               WHEN SQLCODE = -913                                              
W28545             MOVE XMT00001-LOC-NBR TO INVPAR-LOC-NBR                      
               WHEN SQLWARN0 NOT = SPACE                                        
               WHEN SQLCODE  NOT = ZERO                                         
                    MOVE '3300-GET-STORE-NAME'                                  
                                 TO  DP013-PARAGRAPH                            
W26600              MOVE 'READ XMT_LOC'                                         
                                 TO  DP013-MESSAGE-TEXT (1)                     
                    MOVE SQLCA   TO  DP013-SQLCA                                
                    SET DP013-DB2-ABEND                                         
                                 TO  TRUE                                       
                    PERFORM DP013-0000-PROCESS-ABEND                            
           END-EVALUATE.                                                        
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    IF THE CICS ARCHETECTURE CAN'T DETERMINE THE STORE NUMBER,  *        
      *    DEFAULT ALL THE FIELDS TO SPACES, OTHERWISE CHECK TO SEE IF *        
      *    LAPTOP INFORMATION ALREADY EXISTS ON THE DB2 TABLES.        *        
      *----------------------------------------------------------------*        
       4000-BUILD-INITIAL-PANEL.                                                
                                                                                
           SET DP030-SET-CURSOR-APPL-1     TO TRUE.                             
                                                                                
           MOVE ASC-SCN-TIME-YEAR          TO ACOMPYYO.                         
                                                                                
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                             
               MOVE DP015-UNP-ALP-NOR-OFF  TO ASTOREA                           
               IF PS-NO-STORE-INV-ERROR                                         
                   MOVE DP015-GREEN        TO ASTOREC                           
                   MOVE DP015-UNDERLINE    TO ASTOREH                           
               ELSE                                                             
                   MOVE DP015-RED          TO ASTOREC                           
               END-IF                                                           
               MOVE -1                     TO ASTOREL                           
           ELSE                                                                 
               MOVE DP015-ASK-NOR-OFF      TO ASTOREA                           
               IF PS-NO-STORE-INV-ERROR                                         
                   MOVE DP015-BLUE         TO ASTOREC                           
                   MOVE DP015-HL-OFF       TO ASTOREH                           
                   MOVE -1                 TO ACOMPMML                          
               ELSE                                                             
                   SET  DP030-SET-CURSOR-TRAILER                                
                                           TO TRUE                              
               END-IF                                                           
               MOVE ASC-STORE-NBR          TO ASTOREO                           
               MOVE ASC-STORE-NAME         TO ASTDESCO                          
               IF ASC-LAPTOP-INFO-EXISTS                                        
                   MOVE ASC-SCN-TIME-MONTH TO ACOMPMMO                          
                   MOVE ASC-SCN-TIME-DAY   TO ACOMPDDO                          
                   MOVE ASC-SCN-TIME-YEAR  TO ACOMPYYO                          
                   MOVE ASC-SCN-TIME-HOUR  TO ACOMPHRO                          
                   MOVE ASC-SCN-TIME-MINUTE                                     
                                           TO ACOMPMIO                          
                   MOVE ASC-SCN-TIME-INDICATOR                                  
                                           TO ACOMPIDO                          
W28545             MOVE ASC-FILE-TRANS-IND                                      
W28545                                     TO ASTTR01O                          
RONNA *            STORE ENTERED TOTALS                                         
                   MOVE ASC-L1-EXTENSION-AMT                                    
                                           TO AEXTN01O                          
                   MOVE AEXTN01O           TO ASC-L1-EXTENSION-AMT-X            
                   MOVE ASC-L1-QUANTITY    TO AQTY01O                           
                   MOVE AQTY01O            TO ASC-L1-QUANTITY-X                 
RONNA *            FILE TOTALS                                                  
                   MOVE ASC-TOTAL-EXTENSION                                     
                                           TO AEETOTLO                          
                   MOVE AEETOTLO           TO ASC-TOTAL-EXTENSION-X             
                   MOVE ASC-TOTAL-QUANTITY                                      
                                           TO AEQTOTLO                          
                   MOVE AEQTOTLO           TO ASC-TOTAL-QUANTITY-X              
               ELSE                                                             
W28545             MOVE SPACES             TO ASC-L1-EXTENSION-AMT-X            
                                              ASC-L1-QUANTITY-X                 
                                              ASC-TOTAL-EXTENSION-X             
                                              ASC-TOTAL-QUANTITY-X              
                   MOVE 'MM'               TO ACOMPMMO                          
                                              ASC-SCN-TIME-MONTH                
                   MOVE 'DD'               TO ACOMPDDO                          
                                              ASC-SCN-TIME-DAY                  
                   MOVE 'HH'               TO ACOMPHRO                          
                                              ASC-SCN-TIME-HOUR                 
                   MOVE 'MM'               TO ACOMPMIO                          
                                              ASC-SCN-TIME-MINUTE               
                   MOVE 'AM'               TO ACOMPIDO                          
                                              ASC-SCN-TIME-INDICATOR            
               END-IF                                                           
               IF ASC-STORE-NOT-IN-INVENTORY                                    
                   MOVE DP015-ASK-NOR-OFF     TO ACOMPMMA                       
                                                 ACOMPDDA                       
                                                 ACOMPHRA                       
                                                 ACOMPMIA                       
                                                 ACOMPIDA                       
W28545                                           ASTTR01A                       
                                                 AEXTN01A                       
                                                 AQTY01A                        
                                                                                
                   MOVE DP015-BLUE            TO ACOMPMMC                       
                                                 ACOMPDDC                       
                                                 ACOMPHRC                       
                                                 ACOMPMIC                       
                                                 ACOMPIDC                       
W28545                                           ASTTR01C                       
                                                 AEXTN01C                       
                                                 AQTY01C                        
                                                                                
                   MOVE DP015-HL-OFF          TO ACOMPMMH                       
                                                 ACOMPDDH                       
                                                 ACOMPHRH                       
                                                 ACOMPMIH                       
                                                 ACOMPIDH                       
W28545                                           ASTTR01H                       
                                                 AEXTN01H                       
                                                 AQTY01H                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * RETRIEVE THE LAPTOP INFORMATION FOR THE GIVEN STORE.           *        
      *----------------------------------------------------------------*        
       4100-GET-LAPTOP-INFO.                                                    
                                                                                
           MOVE ASC-STORE-NBR        TO DK-STORE-NBR.                           
W26600     MOVE DK-STORE-NBR         TO INVLAP-LOC-NBR.                         
                                                                                
           SET  ASC-NO-LAPTOP-INFO-EXISTS                                       
                                     TO TRUE.                                   
                                                                                
W28545     MOVE 'ST'                 TO DK-LAPTOP-NBR.                          
           PERFORM 4200-SELECT-TINVLAP-TABLE.                                   
W28545     IF ASC-LAPTOP-INFO-EXISTS                                            
W28545         MOVE INVLAP-STR-TRSM-IND TO ASC-FILE-TRANS-IND                   
W28545     END-IF.                                                              
                                                                                
W28545     MOVE INVLAP-INV-STAT-CDE  TO ASC-INV-STAT-CDE.                       
W28545     MOVE ASC-FILE-TRANS-IND   TO ASTTR01O.                               
           MOVE INVLAP-LPTP-EXT-AMT  TO ASC-L1-EXTENSION-AMT.                   
           MOVE ASC-L1-EXTENSION-AMT TO AEXTN01O.                               
           MOVE AEXTN01O             TO ASC-L1-EXTENSION-AMT-X.                 
           MOVE INVLAP-LPTP-QTY      TO ASC-L1-QUANTITY.                        
           MOVE ASC-L1-QUANTITY      TO AQTY01O.                                
           MOVE AQTY01O              TO ASC-L1-QUANTITY-X.                      
                                                                                
W28545     IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                              
W28545        MOVE INVPAR-JOB-NM       TO PV-OPS-JOBNAME                        
W28545        MOVE PV-OPS-JOBNAME-LINE TO AFITOTLO                              
W28545     END-IF.                                                              
RONNA *    SET SCREEN SETTINGS FOR THE TRANSMISSION FILE RECEIVED               
RONNA *    IF A LAPTOP FI LPTP_NBR RECORD EXISTS, THEN A FILE EXISTS            
RONNA      IF ASC-LAPTOP-FI-EXISTS                                              
RONNA         MOVE 'YES'          TO ATRFI01O                                   
RONNA         MOVE DP015-YELLOW   TO ATRFI01C                                   
RONNA         SET DP020-MSG-WARNING TO TRUE                                     
RONNA      ELSE                                                                 
RONNA         MOVE 'NO '          TO ATRFI01O                                   
RONNA         MOVE DP015-RED      TO ATRFI01C                                   
RONNA         MOVE DP015-REVERSE  TO ATRFI01H                                   
RONNA         MOVE PC-TSYMSG-03493 TO DP020-MSG-NUMBER                          
RONNA         SET DP020-MSG-WARNING TO TRUE                                     
RONNA      END-IF                                                               
RONNA *    THIS IS FOR THE FILES BALANCED INDICATOR                             
W28545     EVALUATE INVLAP-INV-STAT-CDE                                         
W33304         WHEN 'BL'                                                        
W28545             MOVE 'YES'          TO AYES001O                              
W28545             MOVE DP015-YELLOW   TO AYES001C                              
W28545             MOVE DP015-HL-OFF   TO AYES001H                              
W28545             IF INVPAR-ACTL-INV-RECD-DTE = '9999-09-09'                   
W28545                 MOVE PC-TSYMSG-03490 TO DP020-MSG-NUMBER                 
W28545                 SET DP020-MSG-INFORMATIONAL TO TRUE                      
W28545             END-IF                                                       
W33304         WHEN 'ST'                                                        
W33304         WHEN 'FI'                                                        
W28545         WHEN 'FT'                                                        
W33304         WHEN 'NB'                                                        
RONNA          WHEN 'FR'                                                        
RONNA *            SET THE OUTPUT BASED ON IF A FI RECORD EXISTS                
RONNA              IF ASC-LAPTOP-FI-EXISTS                                      
RONNA *               NEED TO FURTHER CHECK TO SEE IF THE FI RECORD             
RONNA *               HAS ZEROS IN THE DOLLAR AND QTY FIELDS                    
RONNA *               TO KNOW IF INK908 WAS RUN AND UPDATED THIS                
RONNA *               FI RECORD.                                                
RONNA                 IF ASC-TOTAL-ENTERED                                      
RONNA *                  DOLLAR AMOUNT ENTERED IS GE 0 AND                      
RONNA *                  QTY ENTERED IS GREATER THAN 0                          
RONNA                    IF ASC-L1-EXTENSION-AMT NOT < 0 AND                    
RONNA                       ASC-L1-QUANTITY > 0                                 
RONNA *                     TOTALS UPDATED ON SCREEN                            
RONNA                       MOVE 'WIP'          TO AYES001O                     
RONNA                       MOVE PC-TSYMSG-03492 TO DP020-MSG-NUMBER            
RONNA                    ELSE                                                   
RONNA                       MOVE 'NO '          TO AYES001O                     
RONNA                       MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER            
RONNA                    END-IF                                                 
RONNA                 ELSE                                                      
RONNA                 IF ASC-TOTAL-EXTENSION = 0 AND                            
RONNA                    ASC-TOTAL-QUANTITY  = 0                                
RONNA *                  DOLLAR AMOUNT ENTERED IS GE 0 AND                      
RONNA *                  QTY ENTERED IS GREATER THAN 0                          
RONNA                    IF ASC-L1-EXTENSION-AMT NOT < 0 AND                    
RONNA                       ASC-L1-QUANTITY      > 0                            
RONNA *                    RESUBMIT NEEDS TO HAPPEN                             
RONNA                      MOVE 'NO '          TO AYES001O                      
RONNA                      MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER             
RONNA                    END-IF                                                 
RONNA                 ELSE                                                      
RONNA *                  DOLLAR AMOUNT ENTERED IS GE 0 AND                      
RONNA *                  QTY ENTERED IS GREATER THAN 0                          
RONNA                    IF ASC-L1-EXTENSION-AMT NOT < 0 AND                    
RONNA                       ASC-L1-QUANTITY      > 0                            
RONNA *                     TOTALS DO NOT BALANCE; CORRECT TOTALS               
RONNA                       MOVE 'NO '          TO AYES001O                     
RONNA                       MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER            
RONNA                    ELSE                                                   
RONNA                       MOVE 'NO '          TO AYES001O                     
RONNA                    END-IF                                                 
RONNA                 END-IF                                                    
RONNA              ELSE                                                         
RONNA *               TRANSMISSION FILE DOES NOT EXIST                          
RONNA                 MOVE 'NO '          TO AYES001O                           
RONNA                 MOVE PC-TSYMSG-03493 TO DP020-MSG-NUMBER                  
RONNA              END-IF                                                       
W28545             MOVE DP015-RED      TO AYES001C                              
W28545             MOVE DP015-REVERSE  TO AYES001H                              
W28545             SET DP020-MSG-WARNING TO TRUE                                
W28545     END-EVALUATE.                                                        
RONNA * NOT SURE WHY THIS IS IS CODED AGAIN AND COMMENTED IT OUT                
W28545*    MOVE ASC-FILE-TRANS-IND       TO ASTTR01O.                           
W28545     IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                              
W28545         MOVE 'FI'                 TO DK-LAPTOP-NBR                       
W28545         PERFORM 4200-SELECT-TINVLAP-TABLE                                
W28545         MOVE INVLAP-LPTP-EXT-AMT  TO ASC-TOTAL-EXTENSION                 
W28545         MOVE ASC-TOTAL-EXTENSION  TO AEETOTLO                            
W28545         MOVE AEETOTLO             TO ASC-TOTAL-EXTENSION-X               
W28545         MOVE INVLAP-LPTP-QTY      TO ASC-TOTAL-QUANTITY                  
W28545         MOVE ASC-TOTAL-QUANTITY   TO AEQTOTLO                            
W28545         MOVE AEQTOTLO             TO ASC-TOTAL-QUANTITY-X                
W28545         IF SQLCODE = ZERO                                                
RONNA *            TRANSMISSION FILE RECEIVED                                   
W28545             MOVE 'YES'          TO ATRFI01O                              
W28545             MOVE DP015-YELLOW   TO ATRFI01C                              
W28545             MOVE DP015-HL-OFF   TO ATRFI01H                              
W28545             EVALUATE INVLAP-INV-STAT-CDE                                 
W33304                 WHEN 'BL'                                                
W28545                     MOVE 'YES'          TO AYES001O                      
W28545                     MOVE DP015-YELLOW   TO AYES001C                      
W28545                                            AEETOTLC                      
W28545                                            AEQTOTLC                      
W28545                     MOVE DP015-HL-OFF   TO AYES001H                      
W28545                                            AEETOTLH                      
W28545                                            AEQTOTLH                      
W28545                     IF INVPAR-ACTL-INV-RECD-DTE = '9999-09-09'           
W28545                         MOVE PC-TSYMSG-03490 TO DP020-MSG-NUMBER         
W28545                         SET DP020-MSG-INFORMATIONAL TO TRUE              
W28545                     END-IF                                               
W33304                 WHEN 'ST'                                                
W33304                 WHEN 'FI'                                                
RONNA                  WHEN 'FR'                                                
RONNA *                    DOLLAR AMOUNT ENTERED IS GE 0 AND                    
RONNA *                    QTY ENTERED IS GREATER THAN 0                        
RONNA                      IF ASC-L1-EXTENSION-AMT NOT < 0 AND                  
RONNA                         ASC-L1-QUANTITY      > 0                          
RONNA *                       IF FI TOTALS ARE 0 THEN INK908 HASN'T             
RONNA *                       RUN YET OR ISN'T DONE RUNNING YET                 
W28545                        MOVE 'WIP'          TO AYES001O                   
W28545                        MOVE DP015-RED      TO AYES001C                   
W28545                        MOVE DP015-REVERSE  TO AYES001H                   
RONNA                         MOVE PC-TSYMSG-03492 TO DP020-MSG-NUMBER          
RONNA                         SET DP020-MSG-WARNING TO TRUE                     
RONNA                      ELSE                                                 
W28545                        MOVE 'NO '          TO AYES001O                   
W28545                        MOVE DP015-RED      TO AYES001C                   
W28545                        MOVE DP015-REVERSE  TO AYES001H                   
RONNA *                       MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER          
RONNA                         SET DP020-MSG-WARNING TO TRUE                     
RONNA                      END-IF                                               
W33304                 WHEN 'FT'                                                
W33304                 WHEN 'NB'                                                
W28545                     MOVE 'NO '          TO AYES001O                      
W28545                     MOVE DP015-RED      TO AYES001C                      
W28545                     MOVE DP015-REVERSE  TO AYES001H                      
W28545                     MOVE PC-TSYMSG-03491 TO DP020-MSG-NUMBER             
W28545                     SET DP020-MSG-WARNING TO TRUE                        
W28545             END-EVALUATE                                                 
W28545         ELSE                                                             
W28545             MOVE 'NO '          TO ATRFI01O                              
W28545             MOVE DP015-RED      TO ATRFI01C                              
W28545             MOVE DP015-REVERSE  TO ATRFI01H                              
W28545             MOVE 'NO '          TO AYES001O                              
W28545             MOVE DP015-RED      TO AYES001C                              
W28545             MOVE DP015-REVERSE  TO AYES001H                              
W28545             MOVE PC-TSYMSG-03493 TO DP020-MSG-NUMBER                     
W28545             SET DP020-MSG-WARNING TO TRUE                                
 28545         END-IF                                                           
W28545     END-IF.                                                              
                                                                                
       EJECT                                                                    
RONNA *----------------------------------------------------------------*        
RONNA * RETRIEVE THE LAPTOP INFORMATION FOR THE GIVEN STORE.           *        
RONNA *----------------------------------------------------------------*        
RONNA  4150-GET-LAPTOP-FI-INFO.                                                 
RONNA                                                                           
RONNA      MOVE ASC-STORE-NBR        TO DK-STORE-NBR.                           
RONNA      MOVE DK-STORE-NBR         TO INVLAP-LOC-NBR.                         
RONNA                                                                           
RONNA      SET  ASC-NO-LAPTOP-FI-EXISTS                                         
RONNA                                TO TRUE.                                   
RONNA                                                                           
RONNA      MOVE 'FI'                 TO DK-LAPTOP-NBR.                          
RONNA      PERFORM 4200-SELECT-TINVLAP-TABLE.                                   
RONNA      IF ASC-LAPTOP-FI-EXISTS                                              
RONNA *        THIS MEANS THAT THERE IS A RECORD TYPE 'FI'                      
RONNA *        MEANING THAT A RECORD WAS INSERTED FROM EITHER                   
RONNA *        JOB INK967, OR INK908                                            
RONNA *        THE MAP VARIABLE IS ATRFI01                                      
RONNA *        IF FOR THE STATUS AFTER 'TRANSMISSION FILES RECEIVED'            
RONNA          MOVE INVLAP-STR-TRSM-IND TO ASC-FILE-TRANS-IND                   
RONNA          MOVE 'YES'          TO ATRFI01O                                  
RONNA          MOVE DP015-YELLOW   TO ATRFI01C                                  
RONNA          MOVE DP015-HL-OFF   TO ATRFI01H                                  
RONNA      ELSE                                                                 
RONNA *        IF THERE IS NO RECORD THEN NO FILE EXISTS ON THE                 
RONNA *        MAINFRAME YET                                                    
RONNA              MOVE 'NO '          TO ATRFI01O                              
RONNA              MOVE DP015-RED      TO ATRFI01C                              
RONNA              MOVE DP015-REVERSE  TO ATRFI01H                              
RONNA              MOVE PC-TSYMSG-03493 TO DP020-MSG-NUMBER                     
RONNA              SET DP020-MSG-WARNING TO TRUE                                
RONNA      END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      ** SELECT A ROW OFF THE TINVLAP DB2 TABLE.                      **        
      ******************************************************************        
       4200-SELECT-TINVLAP-TABLE.                                               
                                                                                
           MOVE ZEROES                TO INVLAP-LPTP-EXT-AMT                    
                                         INVLAP-LPTP-QTY.                       
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                         OR (SQLCODE = ZERO)                                    
                         OR (SQLCODE = +100))                                   
               EXEC SQL                                                         
                   SELECT                                                       
                          LPTP_EXT_AMT                                          
                       ,  LPTP_QTY                                              
W28545                 ,  INV_STAT_CDE                                          
W28545                 ,  STR_TRSM_IND                                          
                   INTO  :INVLAP-LPTP-EXT-AMT                                   
                       , :INVLAP-LPTP-QTY                                       
W28545                 , :INVLAP-INV-STAT-CDE                                   
W28545                 , :INVLAP-STR-TRSM-IND                                   
                   FROM                                                         
                          TINVLAP                                               
W26600             WHERE  LOC_NBR        = :INVLAP-LOC-NBR                      
W28545               AND  INV_ID         = :INVLAP-INV-ID                       
                     AND  LPTP_NBR       = :DK-LAPTOP-NBR                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
RONNA *                'ST' IS STORE ENTERED TOTALS RECORD TYPE                 
RONNA                  IF DK-LAPTOP-NBR = 'ST'                                  
                          SET ASC-LAPTOP-INFO-EXISTS  TO TRUE                   
RONNA                     MOVE INVLAP-LPTP-EXT-AMT                              
RONNA                                         TO ASC-L1-EXTENSION-AMT           
RONNA                     MOVE INVLAP-LPTP-QTY                                  
RONNA                                         TO ASC-L1-QUANTITY                
RONNA                  ELSE                                                     
RONNA                     IF DK-LAPTOP-NBR = 'FI'                               
RONNA                        SET ASC-LAPTOP-FI-EXISTS     TO TRUE               
RONNA                        MOVE INVLAP-LPTP-EXT-AMT                           
RONNA                                        TO ASC-TOTAL-EXTENSION             
RONNA                        MOVE INVLAP-LPTP-QTY                               
RONNA                                        TO ASC-TOTAL-QUANTITY              
RONNA                     END-IF                                                
RONNA                  END-IF                                                   
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '4200-SELECT-TINVLAP-TABLE'                         
                                         TO DP013-PARAGRAPH                     
                       MOVE 'SELECT A ROW ON THE INV LAPTOP TABLE'              
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVLAP'    TO DP013-DB2-TABLE-NAME (1)            
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
               MOVE '4200-SELECT-TINVLAP-TABLE'                                 
                                         TO DP013-PARAGRAPH                     
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A LAP        
      -             'TOP RECORD'         TO DP013-MESSAGE-TEXT (1)              
               MOVE SQLCA                TO DP013-SQLCA                         
               MOVE 'TINVLAP'            TO DP013-DB2-TABLE-NAME (1)            
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                         TO TRUE                                
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
      *----------------------------------------------------------------*        
       4400-MOVE-COMMAREA-TO-SCREEN.                                            
                                                                                
           MOVE ASC-STORE-NBR            TO ASTOREO.                            
                                                                                
           IF PS-NO-STORE-NBR-ERROR                                             
               MOVE ASC-STORE-NAME       TO ASTDESCO                            
           ELSE                                                                 
               MOVE SPACES               TO ASTDESCO                            
                                            ASC-STORE-NAME                      
           END-IF.                                                              
                                                                                
      *    --- IF LAPTOP INFORMATION ALREADY EXISTED FOR A GIVEN  ---           
      *    --- STORE AND YEAR, OR DATA WAS ENTERED ON THE SCREEN, ---           
      *    --- MOVE THE COMMAREA TO THE SCREEN OTHERWISE MOVE     ---           
      *    --- SPACES AND ZEROES.                                 ---           
           IF ASC-LAPTOP-INFO-EXISTS OR ASC-DATA-ENTERED                        
               MOVE ASC-SCN-TIME-MONTH   TO ACOMPMMO                            
               MOVE ASC-SCN-TIME-DAY     TO ACOMPDDO                            
               MOVE ASC-SCN-TIME-YEAR    TO ACOMPYYO                            
               MOVE ASC-SCN-TIME-HOUR    TO ACOMPHRO                            
               MOVE ASC-SCN-TIME-MINUTE  TO ACOMPMIO                            
               MOVE ASC-SCN-TIME-INDICATOR                                      
                                         TO ACOMPIDO                            
W28545         MOVE ASC-FILE-TRANS-IND   TO ASTTR01O                            
RONNA *        STORE TOTALS                                                     
               MOVE ASC-L1-EXTENSION-AMT TO AEXTN01O                            
               MOVE AEXTN01O             TO ASC-L1-EXTENSION-AMT-X              
               MOVE ASC-L1-QUANTITY      TO AQTY01O                             
               MOVE AQTY01O              TO ASC-L1-QUANTITY-X                   
RONNA *        FILE TOTALS                                                      
               MOVE ASC-TOTAL-EXTENSION  TO AEETOTLO                            
               MOVE AEETOTLO             TO ASC-TOTAL-EXTENSION-X               
               MOVE ASC-TOTAL-QUANTITY   TO AEQTOTLO                            
               MOVE AEQTOTLO             TO ASC-TOTAL-QUANTITY-X                
           ELSE                                                                 
W28545         MOVE SPACES               TO ASC-L1-EXTENSION-AMT-X              
                                            ASC-L1-QUANTITY-X                   
W28545         IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                          
W28545             MOVE SPACES           TO ASC-TOTAL-EXTENSION-X               
W28545                                      ASC-TOTAL-QUANTITY-X                
W28545         END-IF                                                           
               MOVE ZEROES               TO AEXTN01O                            
                                            AQTY01O                             
W28545         IF DP020-SRC-MNEMONIC = PC-OPS-MNEMONIC                          
W28545             MOVE ZEROES           TO AEETOTLO                            
W28545                                      AEQTOTLO                            
W28545         END-IF                                                           
               MOVE 'MM'                 TO ACOMPMMO                            
                                            ASC-SCN-TIME-MONTH                  
               MOVE 'DD'                 TO ACOMPDDO                            
                                            ASC-SCN-TIME-DAY                    
               MOVE 'HH'                 TO ACOMPHRO                            
                                            ASC-SCN-TIME-HOUR                   
               MOVE 'MM'                 TO ACOMPMIO                            
                                            ASC-SCN-TIME-MINUTE                 
               MOVE 'AM'                 TO ACOMPIDO                            
                                            ASC-SCN-TIME-INDICATOR              
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * INSERT THE LAPTOP INFORMATION INTO THE TINVLAP TABLE.  DO NOT  *        
      * INSERT THE INFORMATION IF BOTH THE EXTENSION AND QUANTITY ARE  *        
      * ZERO.  THIS WILL SAVE SPACE ON THE DB2 TABLE.                  *        
      *----------------------------------------------------------------*        
       5000-ADD-LAPTOP-INFO.                                                    
                                                                                
W26600*    MOVE ASC-STORE-NBR        TO INVLAP-STR-NBR.                         
W26600     MOVE ASC-STORE-NBR        TO DK-STORE-NBR.                           
W26600     MOVE DK-STORE-NBR         TO INVLAP-LOC-NBR.                         
W28545     MOVE 'ST'                 TO DK-LAPTOP-NBR                           
W28545                                  INVLAP-LPTP-NBR.                        
W28545     IF ASC-UPDATE-NOT-REQUESTED                                          
W33304         MOVE 'ST'             TO INVLAP-INV-STAT-CDE                     
W28545     ELSE                                                                 
W28545         MOVE ASC-INV-STAT-CDE TO INVLAP-INV-STAT-CDE                     
W28545     END-IF.                                                              
                                                                                
W28545*    --- FOR ADD, GET INV-ID FROM INVENTORY PARAMTERS ---                 
W28545     PERFORM 8100-SELECT-TINVPAR-TABLE.                                   
W28545                                                                          
           IF (ASC-L1-EXTENSION-AMT NOT EQUAL ZERO) OR                          
              (ASC-L1-QUANTITY NOT EQUAL ZERO)                                  
               MOVE ASC-L1-EXTENSION-AMT  TO INVLAP-LPTP-EXT-AMT                
               MOVE ASC-L1-QUANTITY       TO INVLAP-LPTP-QTY                    
               PERFORM 5100-INSERT-TINVLAP-TABLE                                
               SET ASC-LAPTOP-INFO-EXISTS TO TRUE                               
W28545     ELSE                                                                 
W28545         IF ASC-L1-EXTENSION-AMT EQUAL ZERO                               
W28545             MOVE DP015-RED              TO AEXTN01C                      
W28545             MOVE DP015-REVERSE          TO AEXTN01H                      
W28545             MOVE DP015-UNP-ALP-BRT-OFF  TO AEXTN01A                      
W28545             IF  PS-NO-ERROR                                              
W28545                 SET PS-ERROR                                             
W28545                     DP030-SET-CURSOR-APPL-1                              
W28545                     DP020-MSG-FATAL     TO TRUE                          
W28545*                ---- CANNOT BE ZERO ----                                 
W28545                 MOVE PC-TSYMSG-00010    TO DP020-MSG-NUMBER              
W28545                 MOVE -1                 TO AEXTN01L                      
W28545             END-IF                                                       
W28545         END-IF                                                           
W28545         IF ASC-L1-QUANTITY EQUAL ZERO                                    
W28545             MOVE DP015-RED              TO AQTY01C                       
W28545             MOVE DP015-REVERSE          TO AQTY01H                       
W28545             MOVE DP015-UNP-ALP-BRT-OFF  TO AQTY01A                       
W28545             IF  PS-NO-ERROR                                              
W28545                 SET PS-ERROR                                             
W28545                     DP030-SET-CURSOR-APPL-1                              
W28545                     DP020-MSG-FATAL     TO TRUE                          
W28545*                ---- CANNOT BE ZERO ----                                 
W28545                 MOVE PC-TSYMSG-00010    TO DP020-MSG-NUMBER              
W28545                 MOVE -1                 TO AQTY01L                       
W28545             END-IF                                                       
W28545         END-IF                                                           
           END-IF.                                                              
                                                                                
W26600     MOVE INVLAP-LOC-NBR           TO INVPAR-LOC-NBR.                     
           MOVE '00'                     TO ASC-TIME-COMP-SECOND.               
           MOVE '000000'                 TO ASC-TIME-COMP-SUBSEC.               
           MOVE ASC-TIME-COMP-TMST       TO INVPAR-PHY-CNT-TMST.                
                                                                                
      *    --- UPDATE THE PHY-CNT-TMST (TIMESTAMP) FIELD WITH ---               
      *    --- THE DATE AND TIME ENTERED ON THE SCREEN.       ---               
W28545     IF ASC-LAPTOP-INFO-EXISTS                                            
W28545         PERFORM 6100-UPDATE-TINVPAR-TABLE                                
W28545     END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      ** INSERT THE ROW ON THE TINVLAP DB2 TABLE.                     **        
      ******************************************************************        
       5100-INSERT-TINVLAP-TABLE.                                               
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                         OR (SQLCODE = ZERO))                                   
               EXEC SQL                                                         
                   INSERT INTO TINVLAP                                          
                      (                                                         
W26600                 LOC_NBR                                                  
W28545                ,INV_ID                                                   
                      ,LPTP_NBR                                                 
                      ,LPTP_EXT_AMT                                             
                      ,LPTP_QTY                                                 
W28545                ,INV_STAT_CDE                                             
W28545                ,CRE_TMST                                                 
W28545                ,STR_TRSM_IND                                             
                      )                                                         
                   VALUES                                                       
                      (                                                         
W26600                 :INVLAP-LOC-NBR                                          
W28545                ,:INVLAP-INV-ID                                           
                      ,:INVLAP-LPTP-NBR                                         
                      ,:INVLAP-LPTP-EXT-AMT                                     
                      ,:INVLAP-LPTP-QTY                                         
W28545                ,:INVLAP-INV-STAT-CDE                                     
W28545                ,CURRENT TIMESTAMP                                        
W28545                ,:INVLAP-STR-TRSM-IND                                     
                      )                                                         
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '5100-INSERT-TINVLAP-TABLE'                         
                                         TO DP013-PARAGRAPH                     
                       MOVE 'INSERT A ROW ON THE INV LAPTOP TABLE'              
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVLAP'   TO DP013-DB2-TABLE-NAME (1)             
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
               MOVE '5100-INSERT-TINVLAP-TABLE'                                 
                                         TO DP013-PARAGRAPH                     
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A LAP        
      -             'TOP RECORD'         TO DP013-MESSAGE-TEXT (1)              
               MOVE SQLCA                TO DP013-SQLCA                         
               MOVE 'TINVLAP'            TO DP013-DB2-TABLE-NAME (1)            
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                         TO TRUE                                
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * UPDATE THE NEW LAPTOP INFORMATION BY DELETING THE OLD INFO     *        
      * AND ADDING THE NEW INFORMATION.  UPDATES WERE NOT DONE,        *        
      * BECAUSE WE ONLY STORED THE ROWS FOR A GIVEN LAPTOP IF THE      *        
      * EXTENSION OR QUANTITY WAS NOT ZERO.                            *        
      *----------------------------------------------------------------*        
       6000-UPDATE-LAPTOP-INFO.                                                 
                                                                                
W28545*    --- GET INV-ID FROM INVENTORY PARAMTERS ---                          
           MOVE ASC-STORE-NBR            TO DK-STORE-NBR.                       
           MOVE DK-STORE-NBR             TO INVLAP-LOC-NBR.                     
W28545     MOVE 'ST'                     TO DK-LAPTOP-NBR.                      
                                                                                
W28545     PERFORM 8100-SELECT-TINVPAR-TABLE.                                   
W28545     PERFORM 6200-DELETE-OLD-LAPTOP-INFO.                                 
                                                                                
           PERFORM 5000-ADD-LAPTOP-INFO.                                        
                                                                                
           MOVE '00'                     TO ASC-TIME-COMP-SECOND.               
           MOVE '000000'                 TO ASC-TIME-COMP-SUBSEC.               
           MOVE ASC-TIME-COMP-TMST       TO INVPAR-PHY-CNT-TMST.                
                                                                                
      *    --- UPDATE THE PHY-CNT-TMST (TIMESTAMP) FIELD WITH ---               
      *    --- THE DATE AND TIME ENTERED ON THE SCREEN.       ---               
           PERFORM 6100-UPDATE-TINVPAR-TABLE.                                   
                                                                                
      ******************************************************************        
      ** UPDATE THE ROW ON THE INVENTORY PARMS DB2 TABLE.             **        
      ******************************************************************        
       6100-UPDATE-TINVPAR-TABLE.                                               
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                         OR (SQLCODE = ZERO))                                   
               EXEC SQL                                                         
                   UPDATE TINVPAR                                               
                       SET PHY_CNT_TMST    = :INVPAR-PHY-CNT-TMST               
W26600*            WHERE STORE_NBR         = :DK-STORE-NBR                      
W26600             WHERE LOC_NBR           = :INVPAR-LOC-NBR                    
W28545               AND INV_ID            = :INVPAR-INV-ID                     
                     AND ACTL_INV_RECD_DTE = '9999-09-09'                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '6100-UPDATE-TINVPAR-TABLE'                         
                                         TO DP013-PARAGRAPH                     
                       MOVE 'UPDATE A ROW ON THE INV PARMS TABLE'               
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVPAR'   TO DP013-DB2-TABLE-NAME (1)             
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
               MOVE '6100-UPDATE-TINVPAR-TABLE'                                 
                                         TO DP013-PARAGRAPH                     
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A PAR        
      -             'M RECORD'           TO DP013-MESSAGE-TEXT (1)              
               MOVE SQLCA                TO DP013-SQLCA                         
               MOVE 'TINVPAR'            TO DP013-DB2-TABLE-NAME (1)            
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                         TO TRUE                                
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
      ******************************************************************        
      ** DELETE THE OLD LAPTOP INFORMATION SO THE NEW INFORMATION     **        
      ** CAN BE INSERTED INTO THE TABLE ON AN UPDATE.                 **        
      ******************************************************************        
W28545 6200-DELETE-OLD-LAPTOP-INFO.                                             
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                         OR (SQLCODE = ZERO)                                    
                         OR (SQLCODE = +100))                                   
               EXEC SQL                                                         
                   DELETE                                                       
                      FROM TINVLAP                                              
W26600             WHERE LOC_NBR         = :INVLAP-LOC-NBR                      
W28545               AND INV_ID          = :INVLAP-INV-ID                       
W28545               AND LPTP_NBR        = :DK-LAPTOP-NBR                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
W28545                 MOVE '6200-DELETE-OLD-LAPTOP-INFO'                       
                                         TO DP013-PARAGRAPH                     
                       MOVE 'DELETE ROWS ON THE INV LAPTOP TABLE'               
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVLAP'   TO DP013-DB2-TABLE-NAME (1)             
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
W28545         MOVE '6200-DELETE-OLD-LAPTOP-INFO'                               
                                         TO DP013-PARAGRAPH                     
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO DELETE LAPTO        
      -             'P RECORDS'          TO DP013-MESSAGE-TEXT (1)              
               MOVE SQLCA                TO DP013-SQLCA                         
               MOVE 'TINVLAP'            TO DP013-DB2-TABLE-NAME (1)            
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                         TO TRUE                                
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
                                                                                
W28545******************************************************************09570001
W28545*  WRITE ALL JCL LINES FOR THE JOB DECK OF THE EMAIL SUBMISSION   09580001
W28545*  JOB TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.       09590001
W28545*  THIS WILL SUBMIT THE JOB WITH THE CURRENT CICS PARTITION AS    09600001
W28545*  THE OWNER.  ENQUEUE THE INTERNAL READER BEFORE WRITING ANY     09610001
W28545*  JCL LINES, TO INSURE NO INTERLEAVING OF JCL LINES FROM OTHER   09620001
W28545*  REQUESTS, AND DEQUEUE THE INTERNAL READER AFTER WRITING THE    09630001
W28545*  LAST JCL LINE.                                                 09640001
W28545******************************************************************09650001
W28545 7000-SUBMIT-JOB-INK908.                                          09660001
W28545                                                                  09670001
W28545     PERFORM 7100-ENQUEUE-INTERNAL-READER.                        09680001
W28545                                                                  09690001
W28545     IF PC-KOHLS-PROD-SYSTEM                                      09700001
W28545         MOVE 'P'                 TO JL-JCL-ENVIRO                03210000
W28545         MOVE 'PKMO'              TO JL-JCL-PHLQ                  09740001
W28545         MOVE 'PKMT'              TO JL-JCL-THLQ                  09740001
W28545         MOVE INVPAR-JOB-NM (7:2) TO JL-JCL-JOBCHARS                      
W28545         MOVE JL-JCL-LINE-1P      TO TD-JCL-LINE                  09710001
W28545     ELSE                                                         09720001
W28545                 MOVE 'T'            TO JL-JCL-ENVIRO             03210000
W28545                 MOVE 'TKMA'         TO JL-JCL-PHLQ               09740001
W28545                 MOVE 'TKMT'         TO JL-JCL-THLQ               09740001
W28545                 MOVE DP020-USERID   TO JL-JCL-JBNAME             09780001
W28545                 MOVE 'T'            TO JL-JCL-JBNAME (8:1)       09780001
W28545                 MOVE JL-JCL-LINE-1T TO TD-JCL-LINE               09790001
W28545     END-IF.                                                      09820001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  09830001
W28545                                                                  09840001
W28545     MOVE INVPAR-JOB-NM (7:2)       TO JL-JCL-SOPT.                       
W28545     MOVE INVPAR-PLND-INV-DTE (3:2) TO JL-JCL-INVDTE (1:2).       03210000
W28545     MOVE INVPAR-PLND-INV-DTE (6:2) TO JL-JCL-INVDTE (3:2).       03210000
W28545     MOVE INVPAR-PLND-INV-DTE (9:2) TO JL-JCL-INVDTE (5:2).       03210000
W28545     MOVE PV-STORE-NBR              TO JL-JCL-STRVARI.            03210000
W28545     MOVE INVPAR-PLND-INV-DTE       TO JL-JCL-PLNDDTE.            03210000
W28545                                                                          
W28545     MOVE JL-JCL-LINE-2 TO TD-JCL-LINE.                           09850001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  09860001
W28545                                                                  09870001
W28545     MOVE JL-JCL-LINE-ALL-ASTERISK TO TD-JCL-LINE.                09890001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10010001
W28545                                                                  10020001
W28545     MOVE JL-JCL-LINE-4 TO TD-JCL-LINE.                           10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-ASTERISK TO TD-JCL-LINE.                    10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-6 TO TD-JCL-LINE.                           10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-7 TO TD-JCL-LINE.                           10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-ALL-ASTERISK TO TD-JCL-LINE.                09890001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     EVALUATE TRUE                                                10026101
W28545         WHEN PC-KOHLS-PROD-SYSTEM                                10026201
W28545             MOVE JL-JCL-LINE-9P-1 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9P-2 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9P-3 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545         WHEN PC-KOHLS-TEST-SYSTEM                                10026401
W28545             MOVE JL-JCL-LINE-9T-1 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9T-2 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9T-3 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545     END-EVALUATE.                                                10026601
W28545                                                                  10026801
W28545     MOVE JL-JCL-LINE-10 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-11 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-12 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-13 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-14 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-15 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-16 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-17 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-18 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-END TO TD-JCL-LINE.                         10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-EOF     TO TD-JCL-LINE.                     10027301
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10028001
W28545                                                                  10029001
W28545     PERFORM 7300-DEQUEUE-INTERNAL-READER.                        10060001
W28545                                                                  10070001
W28545                                                                  10071001
W28545******************************************************************10320000
W28545*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *10330000
W28545*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *10340000
W28545*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *10350000
W28545*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *10360000
W28545*  CONDITION.                                                    *10370000
W28545******************************************************************10380000
W28545 7100-ENQUEUE-INTERNAL-READER.                                    10390000
W28545     EXEC CICS                                                    10400000
W28545         ENQ                                                      10410000
W28545             RESOURCE(TD-QUEUE-NAME)                              10420000
W28545             LENGTH(TD-QUEUE-NAME-LENGTH)                         10430000
W28545             RESP(PV-CICS-RESPONSE)                               10440000
W28545     END-EXEC.                                                    10450000
W28545                                                                  10460000
W28545     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10470000
W28545         SET DP013-LINK-RETURN                                    10480000
W28545             DP013-OTHER-ABEND                                    10490000
W28545             DP013-NO-ROLLBACK     TO TRUE                        10500000
W28545         MOVE '7100-ENQUEUE-INTERNAL-READER'                      10510000
W28545                                   TO DP013-PARAGRAPH             10520000
W28545         STRING 'ENQUEUE '            DELIMITED BY SIZE           10530000
W28545                TD-QUEUE-NAME         DELIMITED BY SIZE           10540000
W28545                ' (INTERNAL READER)'  DELIMITED BY SIZE           10550000
W28545             INTO DP013-MESSAGE-TEXT (1)                          10560000
W28545         MOVE 'ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL R10570000
W28545-             'EADER '             TO DP013-MESSAGE-TEXT (2)      10570000
W28545         PERFORM DP013-0000-PROCESS-ABEND                         10570000
W28545     END-IF.                                                      10580000
W28545                                                                  10590000
W28545     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     10600000
W28545                                                                  10610000
W28545                                                                  10611000
W28545******************************************************************10080000
W28545*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *10090000
W28545*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER AND ABEND. *10100000
W28545******************************************************************10110000
W28545 7200-WRITE-TD-LINE.                                              10120000
W28545     EXEC CICS                                                    10130000
W28545         WRITEQ TD                                                10140000
W28545             QUEUE(TD-QUEUE-NAME)                                 10150000
W28545             FROM(TD-JCL-LINE)                                    10160000
W28545             LENGTH(TD-JCL-LINE-LENGTH)                           10170000
W28545             RESP(PV-CICS-RESPONSE)                               10180000
W28545     END-EXEC.                                                    10190000
W28545                                                                  10200000
W28545     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10210000
W28545         SET DP013-LINK-RETURN                                    10220000
W28545             DP013-OTHER-ABEND                                    10230000
W28545             DP013-NO-ROLLBACK     TO TRUE                        10240000
W28545         MOVE '7200-WRITE-TD-LINE' TO DP013-PARAGRAPH             10250000
W28545         MOVE 'ATTEMPTING TO WRITE TO INTERNAL READER TD QUEUE'   10260000
W28545                                   TO DP013-MESSAGE-TEXT(1)       10270000
W28545         PERFORM 7300-DEQUEUE-INTERNAL-READER                     10280000
W28545         PERFORM DP013-0000-PROCESS-ABEND                         10570000
W28545     END-IF.                                                      10300000
W28545                                                                  10310000
W28545                                                                  10311000
W28545******************************************************************10620000
W28545*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *10630000
W28545*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *10640000
W28545*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *10650000
W28545*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *10660000
W28545*  FOR THE NEXT USER.                                            *10670000
W28545******************************************************************10680000
W28545 7300-DEQUEUE-INTERNAL-READER.                                    10690000
W28545     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     10700000
W28545                                                                  10710000
W28545     EXEC CICS                                                    10720000
W28545         DEQ                                                      10730000
W28545             RESOURCE(TD-QUEUE-NAME)                              10740000
W28545             LENGTH(TD-QUEUE-NAME-LENGTH)                         10750000
W28545             RESP(PV-CICS-RESPONSE)                               10760000
W28545     END-EXEC.                                                    10770000
W28545                                                                  10780000
W28545     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10790000
W28545         SET DP013-LINK-RETURN                                    10800000
W28545             DP013-OTHER-ABEND                                    10810000
W28545             DP013-NO-ROLLBACK     TO TRUE                        10820000
W28545         MOVE '7300-DEQUEUE-INTERNAL-READER'                      10830000
W28545                                   TO DP013-PARAGRAPH             10840000
W28545         STRING 'DEQUEUE '            DELIMITED BY SIZE           10850000
W28545                TD-QUEUE-NAME         DELIMITED BY SIZE           10860000
W28545                ' (INTERNAL READER)'  DELIMITED BY SIZE           10870000
W28545             INTO DP013-MESSAGE-TEXT (1)                          10880000
W28545         MOVE 'DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL R10570000
W28545-             'EADER '             TO DP013-MESSAGE-TEXT (2)      10570000
W28545         PERFORM DP013-0000-PROCESS-ABEND                         10570000
W28545     END-IF.                                                      10900000
W28545                                                                  10910000
W28545                                                                  10920000
W28545******************************************************************09570001
W28545*7500-SUBMIT-JOB-INK918.                                          09660001
W28545*  WRITE ALL JCL LINES FOR THE JOB DECK OF THE EMAIL SUBMISSION   09580001
W28545*  JOB TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.       09590001
W28545*  THIS WILL SUBMIT THE JOB WITH THE CURRENT CICS PARTITION AS    09600001
W28545*  THE OWNER.  ENQUEUE THE INTERNAL READER BEFORE WRITING ANY     09610001
W28545*  JCL LINES, TO INSURE NO INTERLEAVING OF JCL LINES FROM OTHER   09620001
W28545*  REQUESTS, AND DEQUEUE THE INTERNAL READER AFTER WRITING THE    09630001
W28545*  LAST JCL LINE.                                                 09640001
W28545******************************************************************09650001
W28545 7500-SUBMIT-JOB-INK918.                                          09660001
W28545                                                                  09670001
W28545     PERFORM 7100-ENQUEUE-INTERNAL-READER.                        09680001
W28545                                                                  09690001
W28545     IF PC-KOHLS-PROD-SYSTEM                                      09700001
W28545         MOVE 'PKMO'              TO JL-JCL-PHLQ                  09740001
W28545         MOVE 'PKMT'              TO JL-JCL-THLQ                  09740001
W28545         MOVE INVPAR-JOB-NM (7:2) TO JL-JCL-JOBCHARS-918                  
W28545         MOVE JL-JCL-LINE-1P-918  TO TD-JCL-LINE                  09710001
W28545     ELSE                                                         09720001
W28545                 MOVE 'TKMA'         TO JL-JCL-PHLQ               09740001
W28545                 MOVE 'TKMT'         TO JL-JCL-THLQ               09740001
W28545                 MOVE DP020-USERID   TO JL-JCL-JBNAME-918         09780001
W28545                 MOVE 'T'            TO JL-JCL-JBNAME-918 (8:1)   09780001
W28545                 MOVE JL-JCL-LINE-1T-918 TO TD-JCL-LINE           09790001
W28545     END-IF.                                                      09820001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  09830001
W28545                                                                  09840001
W28545     MOVE INVPAR-JOB-NM (7:2)       TO JL-JCL-SOPT.                       
W28545     MOVE INVPAR-PLND-INV-DTE (3:2) TO JL-JCL-INVDTE (1:2).       03210000
W28545     MOVE INVPAR-PLND-INV-DTE (6:2) TO JL-JCL-INVDTE (3:2).       03210000
W28545     MOVE INVPAR-PLND-INV-DTE (9:2) TO JL-JCL-INVDTE (5:2).       03210000
W28545                                                                          
W28545     MOVE JL-JCL-LINE-2 TO TD-JCL-LINE.                           09850001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  09860001
W28545                                                                  09870001
W28545     MOVE JL-JCL-LINE-ALL-ASTERISK TO TD-JCL-LINE.                09890001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10010001
W28545                                                                  10020001
W28545     MOVE JL-JCL-LINE-4 TO TD-JCL-LINE.                           10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-ASTERISK TO TD-JCL-LINE.                    10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-6-918 TO TD-JCL-LINE.                       10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-7 TO TD-JCL-LINE.                           10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-ALL-ASTERISK TO TD-JCL-LINE.                09890001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     EVALUATE TRUE                                                10026101
W28545         WHEN PC-KOHLS-PROD-SYSTEM                                10026201
W28545             MOVE JL-JCL-LINE-9P-1 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9P-2 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9P-3 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545         WHEN PC-KOHLS-TEST-SYSTEM                                10026401
W28545             MOVE JL-JCL-LINE-9T-1 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9T-2 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545             MOVE JL-JCL-LINE-9T-3 TO TD-JCL-LINE                 10021001
W28545             PERFORM 7200-WRITE-TD-LINE                           10026701
W28545     END-EVALUATE.                                                10026601
W28545                                                                  10026801
W28545     MOVE JL-JCL-LINE-10-918 TO TD-JCL-LINE.                      10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-11 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-12 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-16 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-17 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-18 TO TD-JCL-LINE.                          10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-END TO TD-JCL-LINE.                         10021001
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10022001
W28545                                                                  10023001
W28545     MOVE JL-JCL-LINE-EOF     TO TD-JCL-LINE.                     10027301
W28545     PERFORM 7200-WRITE-TD-LINE.                                  10028001
W28545                                                                  10029001
W28545     PERFORM 7300-DEQUEUE-INTERNAL-READER.                        10060001
W28545                                                                  10070001
W28545                                                                  10071001
      ******************************************************************        
      ** SELECT THE ROW ON THE INVENTORY PARMS DB2 TABLE.             **        
      ******************************************************************        
       8000-SELECT-TINVPAR-TABLE.                                               
                                                                                
           MOVE ASC-STORE-NBR      TO DK-STORE-NBR.                             
W26600     MOVE DK-STORE-NBR       TO INVPAR-LOC-NBR.                           
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                         OR (SQLCODE = ZERO)                                    
                         OR (SQLCODE = +100))                                   
               EXEC SQL                                                         
                   SELECT                                                       
W28545                    B.PHY_CNT_TMST                                        
W28545                   ,B.FIL_TOT_BAL_CDE                                     
W28545                   ,B.JOB_NM                                              
                   INTO  :INVPAR-PHY-CNT-TMST                                   
W28545                  ,:INVPAR-FIL-TOT-BAL-CDE                                
W28545                  ,:INVPAR-JOB-NM                                         
                   FROM                                                         
W28545                    TINCNTL A                                             
W28545                  , TINVPAR B                                             
                   WHERE                                                        
W28545                    B.LOC_NBR           = :INVPAR-LOC-NBR                 
W28545               AND  A.INV_ID            = B.INV_ID                        
W28545               AND  A.ACTV_IND          = 'Y'                             
W33304               AND  B.ACTL_INV_DTE =                                      
W33304                (SELECT MIN(C.ACTL_INV_DTE)                               
W33304                   FROM TINVPAR C                                         
W33304                       ,TINCNTL D                                         
W33304                  WHERE C.LOC_NBR    = :INVPAR-LOC-NBR                    
W33304                    AND C.SCHD_PHY_CNT_CDE = 'PI'                         
W33304                    AND C.LOC_INV_STAT_CDE = 'IN'                         
W33304                    AND C.INV_ID     = D.INV_ID                           
W33304                    AND D.ACTV_IND   = 'Y'                                
W33304                    AND ((C.ACTL_INV_RECD_DTE = '9999-09-09'              
W33304                    AND   C.ACTL_INV_DTE <> '9999-09-09')                 
W33304                     OR  (C.ACTL_INV_RECD_DTE < '9999-09-09'              
W33304                    AND   B.ACTL_INV_RECD_DTE >= B.ACTL_INV_DTE)))        
W33304               WITH UR                                                    
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                       SET ASC-STORE-IN-INVENTORY TO TRUE                       
      *                --- CALCULATE THE STANDARD CLOCK TIME FROM ---           
      *                --- THE MILITARY TIME ON THE TIMESTAMP     ---           
                       IF ASC-NO-DATA-ENTERED                                   
                           IF INVPAR-PHY-CNT-TMST EQUAL PC-EMPTY-TMST           
                               MOVE 'MM'      TO ASC-SCN-TIME-MONTH             
                               MOVE 'DD'      TO ASC-SCN-TIME-DAY               
                               MOVE 'HH'      TO ASC-SCN-TIME-HOUR              
                               MOVE 'MM'      TO ASC-SCN-TIME-MINUTE            
                               MOVE 'AM'      TO ASC-SCN-TIME-INDICATOR         
                               MOVE ASC-CURRENT-YEAR                            
                                              TO ASC-SCN-TIME-YEAR              
                           ELSE                                                 
                               MOVE INVPAR-PHY-CNT-TMST                         
                                              TO ASC-TIME-COMP-TMST             
                               MOVE ASC-TIME-COMP-MONTH                         
                                              TO ASC-SCN-TIME-MONTH             
                               MOVE ASC-TIME-COMP-DAY                           
                                              TO ASC-SCN-TIME-DAY               
                               MOVE ASC-TIME-COMP-YEAR                          
                                              TO ASC-SCN-TIME-YEAR              
                               MOVE ASC-TIME-COMP-HOUR                          
                                              TO PV-TIME-COMP-HOUR-9            
                               IF PV-TIME-COMP-HOUR-9 >= 12                     
                                   MOVE 'PM'  TO ASC-SCN-TIME-INDICATOR         
                                   IF PV-TIME-COMP-HOUR-9 > 12                  
                                       SUBTRACT 12                              
                                              FROM PV-TIME-COMP-HOUR-9          
                                   END-IF                                       
                                   MOVE PV-TIME-COMP-HOUR-9                     
                                              TO ASC-SCN-TIME-HOUR              
                               ELSE                                             
                                   MOVE 'AM'  TO ASC-SCN-TIME-INDICATOR         
                                   IF PV-TIME-COMP-HOUR-9 EQUAL ZERO            
                                       ADD 12 TO PV-TIME-COMP-HOUR-9            
                                   END-IF                                       
                                   MOVE PV-TIME-COMP-HOUR-9                     
                                              TO ASC-SCN-TIME-HOUR              
                               END-IF                                           
                               MOVE ASC-TIME-COMP-MINUTE                        
                                              TO ASC-SCN-TIME-MINUTE            
                           END-IF                                               
                       END-IF                                                   
                                                                                
                   WHEN SQLCODE = +100                                          
                       SET ASC-STORE-NOT-IN-INVENTORY                           
                                              TO TRUE                           
                       MOVE PC-EMPTY-TMST     TO ASC-TIME-COMP-TMST             
                       MOVE ASC-SCN-TIME-YEAR TO ASC-TIME-COMP-YEAR             
                       MOVE 'MM'              TO ASC-SCN-TIME-MONTH             
                       MOVE 'DD'              TO ASC-SCN-TIME-DAY               
                       MOVE 'HH'              TO ASC-SCN-TIME-HOUR              
                       MOVE 'MM'              TO ASC-SCN-TIME-MINUTE            
                       MOVE 'AM'              TO ASC-SCN-TIME-INDICATOR         
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '8000-SELECT-TINVPAR-TABLE'                         
                                         TO DP013-PARAGRAPH                     
                       MOVE 'SELECT A ROW ON THE INV PARMS TABLE'               
                                         TO DP013-MESSAGE-TEXT(1)               
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)            
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
               MOVE '8000-SELECT-TINVPAR-TABLE'                                 
                                         TO DP013-PARAGRAPH                     
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A PAR        
      -             'M RECORD'           TO DP013-MESSAGE-TEXT (1)              
               MOVE SQLCA                TO DP013-SQLCA                         
               MOVE 'TINVPAR'            TO DP013-DB2-TABLE-NAME (1)            
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                         TO TRUE                                
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
W28545******************************************************************        
W28545** SELECT THE ROW ON THE INVENTORY PARMS DB2 TABLE.             **        
W28545******************************************************************        
W28545 8100-SELECT-TINVPAR-TABLE.                                               
W28545                                                                          
W28545     PERFORM                                                              
W28545         WITH TEST AFTER                                                  
W28545         VARYING PV-RETRY-COUNTER                                         
W28545         FROM 1 BY 1                                                      
W28545         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
W28545                   OR (SQLCODE = ZERO)                                    
W28545                   OR (SQLCODE = +100))                                   
W28545         EXEC SQL                                                         
W28545             SELECT                                                       
W28545                    B.INV_ID                                              
W28545                   ,B.PLND_INV_DTE                                        
W28545                   ,B.PHY_CNT_TMST                                        
W28545                   ,B.FIL_TOT_BAL_CDE                                     
W28545                   ,B.JOB_NM                                              
W28545                   ,B.ACTL_INV_RECD_DTE                                   
W28545             INTO  :INVPAR-INV-ID                                         
W28545                  ,:INVPAR-PLND-INV-DTE                                   
W28545                  ,:INVPAR-PHY-CNT-TMST                                   
W28545                  ,:INVPAR-FIL-TOT-BAL-CDE                                
W28545                  ,:INVPAR-JOB-NM                                         
W28545                  ,:INVPAR-ACTL-INV-RECD-DTE                              
W28545             FROM                                                         
W28545                    TINCNTL A                                             
W28545                  , TINVPAR B                                             
W28545             WHERE                                                        
W33304                    B.LOC_NBR      = :INVPAR-LOC-NBR                      
W33304               AND  A.INV_ID       = B.INV_ID                             
W33304               AND  A.ACTV_IND     = 'Y'                                  
W33304               AND  B.ACTL_INV_DTE =                                      
W33304                (SELECT MIN(C.ACTL_INV_DTE)                               
W33304                   FROM TINVPAR C                                         
W33304                       ,TINCNTL D                                         
W33304                  WHERE C.LOC_NBR    = :INVPAR-LOC-NBR                    
W33304                    AND C.SCHD_PHY_CNT_CDE = 'PI'                         
W33304                    AND C.LOC_INV_STAT_CDE = 'IN'                         
W33304                    AND C.INV_ID     = D.INV_ID                           
W33304                    AND D.ACTV_IND   = 'Y'                                
W33304                    AND ((C.ACTL_INV_RECD_DTE = '9999-09-09'              
W33304                    AND   C.ACTL_INV_DTE <> '9999-09-09')                 
W33304                     OR  (C.ACTL_INV_RECD_DTE < '9999-09-09'              
W33304                    AND   B.ACTL_INV_RECD_DTE >= B.ACTL_INV_DTE)))        
W28545         END-EXEC                                                         
W28545         EVALUATE TRUE                                                    
W28545             WHEN SQLCODE = ZERO                                          
W28545*                SET ASC-STORE-IN-INVENTORY TO TRUE                       
W28545*                --- CALCULATE THE STANDARD CLOCK TIME FROM ---           
W28545*                --- THE MILITARY TIME ON THE TIMESTAMP     ---           
W28545                 MOVE INVPAR-INV-ID     TO INVLAP-INV-ID                  
W28545             WHEN SQLCODE = +100                                          
W28545                 CONTINUE                                                 
W28545             WHEN SQLCODE = -911                                          
W28545             WHEN SQLCODE = -913                                          
W28545                 CONTINUE                                                 
W28545             WHEN SQLWARN0 NOT = SPACES                                   
W28545             WHEN SQLCODE < ZERO                                          
W28545             WHEN SQLCODE > ZERO                                          
W28545                 MOVE '8100-SELECT-TINVPAR-TABLE'                         
W28545                                   TO DP013-PARAGRAPH                     
W28545                 MOVE 'SELECT A ROW ON THE INV PARMS TABLE'               
W28545                                   TO DP013-MESSAGE-TEXT(1)               
W28545                 MOVE SQLCA        TO DP013-SQLCA                         
W28545                 MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)            
W28545                 SET DP013-DB2-ABEND                                      
W28545                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
W28545                 PERFORM DP013-0000-PROCESS-ABEND                         
W28545         END-EVALUATE                                                     
W28545     END-PERFORM.                                                         
W28545*                                                                         
W28545     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
W28545         MOVE '8100-SELECT-TINVPAR-TABLE'                                 
W28545                                   TO DP013-PARAGRAPH                     
W28545         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A PAR        
W28545-             'M RECORD'           TO DP013-MESSAGE-TEXT (1)              
W28545         MOVE SQLCA                TO DP013-SQLCA                         
W28545         MOVE 'TINVPAR'            TO DP013-DB2-TABLE-NAME (1)            
W28545         SET DP013-DB2-ABEND                                              
W28545             DP013-XCTL-DISPLAY-RESTART                                   
W28545                                   TO TRUE                                
W28545         PERFORM DP013-0000-PROCESS-ABEND                                 
W28545     END-IF.                                                              
W28545                                                                          
W28545 EJECT                                                                    
      *----------------------------------------------------------------*        
      *    ABEND PROCESSOR MODULE                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPPD013.                                                        
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    DATE AND TIME MODULE                                        *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPPD017.                                                        
                                                                                
