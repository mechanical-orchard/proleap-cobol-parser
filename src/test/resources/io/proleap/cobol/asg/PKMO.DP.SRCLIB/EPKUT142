000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.      EPKUT142.                                       00020001
000300 AUTHOR.          NANCY MARTIN.                                   00030001
000400 DATE-WRITTEN.    MAY 2004.                                       00040006
000500                                                                  00050001
000600*--------------------------------------------------------------*  00060001
000700*  EPKUT142 -- EXTRACT FPLU CHANGES AND NEXT NEW DAY FOR ALL   *  00070001
000701*              WHITE AND YELLOW (NON-CONTINTUED CLEARANCE)     *  00070001
000702*              PRICE CHANGES.                                  *  00070001
000703*                                                              *  00070001
000800*  INPUTS:                                                     *  00080001
002400*  00  EPRD135   CONTAINS LIST OF CHANGES FROM FUTURE PERM     *  00240001
002500*     (EPRD135)  AND REACTIVATED/EXCLUDED SKUS.           .    *  00250001
002600*                                                              *  00260001
002601*  01  EPCC045   CONTAINS NUMBER OF DAYS BEFORE OPENING TO     *  00090001
002602*     (EPRD045)  INCLUDE NEW STORES.                           *  00100001
002603*                                                              *  00110001
002604*  02  EPCC154   CONTAINS TODAYS DATE.                         *  00150001
002605*     (EPWS140)                                                *  00160001
002606*                                                              *  00170001
002607*  03  EPCC155   CONTAINS TOMORROWS DATE.                      *  00180001
002608*     (EPWS112)                                                *  00190001
002609*                                                              *  00200001
002610*  04  EPCC161   CONTAINS PREVIOUS AND NEXT "NEW" DAY DATES    *  00210001
002611*     (EPWS161)  FOR FPLU.                                     *  00220001
002612*                                                              *  00230001
002700* OUTPUTS:                                                     *  00270001
002800*                                                              *  00280001
003500*  01  EPRD220   FILE OF SQL SERVER DELETES ON SKU PRICING TBL *  00290001
003600*     (EPRD220)                                                *  00300001
003800*                                                              *  00310001
003900*  02  EPRD220   FILE OF SQL SERVER ADDS ON SKU PRICING TBL    *  00290001
004000*     (EPRD220)                                                *  00320001
004001*                                                              *  00340001
004002*                                                              *  00350001
004003* DESCRIPTION:                                                 *  00360001
004004*                                                              *  00370001
004005*      PROGRAM HAS THREE MAJOR PURPOSES: CREATE DELETE RECRODS *  00380001
004006*  BASED UPON PREVIOUSLY CREATED LISTS;  CREATE ADD RECORDS    *  00390001
004007*  FOR CHANGED FUTURE PERM (TWO PARTS - ONE FOR STORE CHANGES  *  00400001
004100*  AND OTHER FOR NON-STORE CHANGES); CREATE ADD RECORDS FOR    *  00410001
004200*  NEXT "NEW" DAY DETAILS (AGAIN TWO PARTS - STORE & NON-STORE)*  00420001
004300*  XS SKU TABLE IS CHECKED FOR ADD DETAILS TO GET DATA TO SEND *  00430001
004400*  AND CHECK TO SEE IF THE ITEM SHOULD BE EXCLUDED.            *  00440001
004500*       OUTPUT RECORDS WILL DEFAULT DATA NON-DIRECTLY ATTAINED.*  00450001
004600*                                                              *  00460001
004700*--------------------------------------------------------------*  00470001
004800*--------------------------------------------------------------*  00480001
004900* HISTORY LOG:                                                    00490001
005000*--------------------------------------------------------------*  00500001
005100* DATE:                                                           00510001
005200* WR/IR#:                                                         00520001
005300* PROGRAMMER:                                                     00530001
005400* DESCRIPTION:                                                    00540001
005500*                                                                 00550001
005600* FEB. 24, 2009                                                   00550001
005700* WR35484                                                         00550001
005800* DENORRIS COOKS                                                  00550001
005900* ADDED PARA: 7300-; 7400-; 7500-; 8100-; 8600-;                  00550001
006000* THESE PARAGRAPHS WILL STORE DATA IN AND WRITE DATA FROM         00550001
006100* NEW COPYBOOK EPRD220 FOR LOADING NEW SQL TABLE SKU_PRICG.       00550001
006200*                                                                 00550001
006300* ADDED M.LAST_UPD_TMST TO CURSOR TO BE EXTRACTED ALONG WITH      00550001
006400* OTHER DB2 DATA.                                                 00550001
006500*                                                                 00550001
006501*                                                                 00550001
006502*--------------------------------------------------------------*  00560001
006503* DATE: 07/23/2010                                                00510001
006504* WR/IR#: INC000001334615                                         00520001
006505* PROGRAMMER: COGNIZANT                                           00530001
006506* DESCRIPTION: ADDED COALESCE TO NULLABLE FIELDS IN THE           00540001
006507*              TABLE XST_PRCHG_MDSE TO AVOID SOC7 ABENDS          00550001
006508*              BECAUSE OF NULL VALUES.                            00550001
006509*                                                                 00550001
006510*--------------------------------------------------------------*  00560001
006520* AUG. 6, 2010                                                    00550001
006530* CL3132. CLARITY PROJECT ID: 3132                                00550001
006540* COGNIZANT                                                       00550001
006541* CHANGED PROGRAM TO IMPROVE PERFORMANCE.                         00550001
006542*--------------------------------------------------------------*  00560001
006543* DATE: 02/05/2011                                                00510001
006544* WR/IR#: PBI11409/PKE6877                                        00520001
006545* PROGRAMMER: MARGARET MORRISON                                   00530001
006546* DESCRIPTION: REMOVE NT10 PROCESSING.                            00540001
006549*                                                                 00550001
006550*--------------------------------------------------------------*  00560001
006551 ENVIRONMENT DIVISION.                                            00570001
006552*--------------------------------------------------------------*  00580001
006553 CONFIGURATION SECTION.                                           00590001
006554 SOURCE-COMPUTER.        IBM-3090.                                00600001
006555 OBJECT-COMPUTER.        IBM-3090.                                00610001
006556                                                                  00620001
006557 INPUT-OUTPUT SECTION.                                            00630001
006558                                                                  00640001
006560 FILE-CONTROL.                                                    00650001
006600                                                                  00660001
006700     SELECT FPLU-HEIR-LIST                                        00670005
006800            ASSIGN TO INP00.                                      00680005
006900                                                                  00690005
007000     SELECT CC-PRIOR-OPEN                                         00700001
007100            ASSIGN TO INP01.                                      00710005
007200                                                                  00720001
007300     SELECT CC-TODAY                                              00730001
007400            ASSIGN TO INP02.                                      00740001
007500                                                                  00750001
007600     SELECT CC-TOMORROW                                           00760001
007700            ASSIGN TO INP03.                                      00770001
007800                                                                  00780001
007900     SELECT CC-PREV-NEXT-NEW-DAY                                  00790001
008000            ASSIGN TO INP04.                                      00800001
008100                                                                  00810001
008800     SELECT FPLU-SQLDEL-FILE                                      00820005
008900            ASSIGN TO OUT01.                                      00830001
009000                                                                  00840001
009100     SELECT FPLU-SQLADD-FILE                                      00850005
009101            ASSIGN TO OUT02.                                      00860001
009102                                                                  00870001
009103 DATA DIVISION.                                                   00880001
009104 FILE SECTION.                                                    00890001
009105                                                                  00900001
009106*  00  EPCC045   CONTAINS NUMBER OF DAYS BEFORE OPENING TO     *  00910001
009200                                                                  00920001
009300 FD  CC-PRIOR-OPEN                                                00930001
009400     RECORDING MODE F                                             00940001
009500     BLOCK CONTAINS 0 RECORDS                                     00950001
009600     LABEL RECORDS ARE OMITTED                                    00960001
009700     DATA RECORD IS CC-PRIOR-OPEN-RECORD.                         00970001
009800 01  CC-PRIOR-OPEN-RECORD         PIC  X(080).                    00980001
009900                                                                  00990001
010000 FD  CC-TODAY                                                     01000001
010100     RECORDING MODE F                                             01010001
010200     BLOCK CONTAINS 0 RECORDS                                     01020001
010300     LABEL RECORDS ARE OMITTED                                    01030001
010400     DATA RECORD IS CC-TODAY-RECORD.                              01040001
010500 01  CC-TODAY-RECORD              PIC  X(080).                    01050001
010600                                                                  01060001
010700 FD  CC-TOMORROW                                                  01070001
010800     RECORDING MODE F                                             01080001
010900     BLOCK CONTAINS 0 RECORDS                                     01090001
011000     LABEL RECORDS ARE OMITTED                                    01100001
011100     DATA RECORD IS CC-TOMORROW-RECORD.                           01110001
011200 01  CC-TOMORROW-RECORD      PIC  X(080).                         01120001
011300                                                                  01130001
011400 FD  CC-PREV-NEXT-NEW-DAY                                         01140001
011500     RECORDING MODE F                                             01150001
011600     BLOCK CONTAINS 0 RECORDS                                     01160001
011700     LABEL RECORDS ARE OMITTED                                    01170001
011800     DATA RECORD IS CC-PREV-NEXT-NEW-DAY-RECORD.                  01180006
011900 01  CC-PREV-NEXT-NEW-DAY-RECORD     PIC  X(080).                 01190006
012000                                                                  01200001
012100 FD  FPLU-HEIR-LIST                                               01210005
012200     RECORDING MODE F                                             01220001
012300     BLOCK CONTAINS 0 RECORDS                                     01230001
012400     LABEL RECORDS ARE OMITTED                                    01240001
012500     DATA RECORD IS FPLU-HEIR-RECORD.                             01250005
012600 01  FPLU-HEIR-RECORD                PIC  X(060).                 01260005
012700                                                                  01270001
014200 FD  FPLU-SQLADD-FILE                                             01350005
014300     RECORDING MODE F                                             01360001
014400     BLOCK CONTAINS 0 RECORDS                                     01370001
014500     LABEL RECORDS ARE OMITTED                                    01380001
014600     DATA RECORD IS FPLU-SQLADD-RECORD.                           01390005
014601 01  FPLU-SQLADD-RECORD                 PIC  X(260).              01400005
014602                                                                  01410001
014603 FD  FPLU-SQLDEL-FILE                                             01280005
014604     RECORDING MODE F                                             01290001
014605     BLOCK CONTAINS 0 RECORDS                                     01300001
014606     LABEL RECORDS ARE OMITTED                                    01310001
014607     DATA RECORD IS FPLU-SQLDEL-RECORD.                           01320005
014608 01  FPLU-SQLDEL-RECORD                 PIC  X(260).              01330005
014609                                                                  01340001
014610 WORKING-STORAGE SECTION.                                         01420001
014611*--------------------------------------------------------------*  01430001
014612* PS - PROGRAM SWITCHES                                           01440001
014613*--------------------------------------------------------------*  01450001
014614                                                                  01460001
014700 01  PS-PROGRAM-SWITCHES.                                         01470001
014800********* NOTE: SAME SWITCH WILL BE USED FOR ALL CONTROL CARDS    01480005
014900     05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                01490001
015000         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      01500001
015100         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      01510001
015200                                                                  01520001
015300     05  PS-END-OF-FUTURE-PERM-CSR-SW PIC  X(001).                01530005
015400         88  PS-END-OF-FUTURE-PERM-CSR             VALUE 'Y'.     01540005
015500         88  PS-NOT-END-OF-FUTURE-PERM-CSR         VALUE 'N'.     01550005
015600                                                                  01560005
015700     05  PS-END-OF-FPLU-INPUT-SW      PIC  X(001).                01570006
015800         88  PS-END-OF-FPLU-INPUT                  VALUE 'Y'.     01580006
015900         88  PS-NOT-END-OF-FPLU-INPUT              VALUE 'N'.     01590006
016000                                                                  01600001
016001     05  PS-SKU-SW                    PIC  X(001).                01570006
016002         88  PS-SKU-OK                             VALUE 'Y'.     01580006
016003         88  PS-SKU-NOT-OK                         VALUE 'N'.     01590006
016004                                                                  01600001
016005     05  PS-STYLE-SW                  PIC  X(001).                01570006
016006         88  PS-STYLE-OK                           VALUE 'Y'.     01580006
016007         88  PS-STYLE-NOT-OK                       VALUE 'N'.     01590006
016008                                                                  01600001
016009     05  PS-WRITE-SW                  PIC  X(001).                01570006
016010         88  PS-BYPASS-WRITE                       VALUE 'N'.     01580006
016011         88  PS-CONTINUE-WRITE                     VALUE 'Y'.     01590006
016012                                                                  01600001
016013     05  PS-END-LOC-CURSOR-SW       PIC X       VALUE 'N'.                
016014         88  PS-END-OF-LOC-CSR                     VALUE 'Y'.             
016015                                                                  01520001
016016     05  PS-LOC-FND-SW                PIC  X(001).                01530005
016017         88  PS-LOC-FND                            VALUE 'Y'.     01540005
016018         88  PS-LOC-NOT-FND                        VALUE 'N'.     01550005
016019                                                                  01600001
016100*--------------------------------------------------------------*  01610001
016200* PROGRAM CONSTANTS                                               01620001
016300*--------------------------------------------------------------*  01630001
016400 01  PC-PROGRAM-CONSTANTS.                                        01640001
016500     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT142'.     01650001
016600     05  PC-MAX-RETRIES           PIC S9(4) VALUE +5 COMP.        01660004
016700     05  PC-FIVE-BLANKS           PIC X(05) VALUE SPACES.         01670001
016800     05  PC-TEN-BLANKS            PIC X(10) VALUE SPACES.         01680001
016810     05  PC-19-ZEROS              PIC X(19) VALUE ALL '0'.        01680001
016900     05  PC-ASTERISK-LINE         PIC X(80) VALUE ALL '*'.        01690001
017000     05  PC-ACTIVE-STAT           PIC XX    VALUE '20'.           01700001
017100     05  PC-CLEARANCE-STAT        PIC XX    VALUE '30'.           01710001
017200     05  PC-TCKT-CLR-YELLOW       PIC X     VALUE 'Y'.            01720001
017300     05  PC-TCKT-CLR-WHITE        PIC X     VALUE 'W'.            01720001
017400     05  PC-ALL-COLORS            PIC XX    VALUE 'AL'.           01720001
017500     05  PC-NULLS                 PIC X     VALUE '~'.            01720001
017600     05  PC-COLON                 PIC X     VALUE ':'.            01720001
017601     05  PC-3CLOCK                PIC X(09) VALUE ' 03:00:00'.    01720001
017602                                                                  01720001
017603*--------------------------------------------------------------*  01730001
017604* PV- PROGRAM VARIABLES                                           01740001
017605*--------------------------------------------------------------*  01750001
017606 01  PV-PROGRAM-VARIABLES.                                        01760001
017700     05  PV-NON-CL-RTL-PRC        PIC 9(06)V99 VALUE 0.           01770005
017800     05  PV-NEW-DATE              PIC X(10)    VALUE SPACES.      01780005
017900     05  PV-PARAGRAPH-NAME        PIC X(40)    VALUE SPACES.      01790005
018000     05  PV-SQL-SUB               PIC S9(04)   VALUE 0  COMP.     01800001
018100     05  PV-ABEND-CODE            PIC 9999     VALUE 0  COMP.     01810001
018200                                                                  01820001
018300*--------------------------------------------------------------*  01830001
018400* PV- DB2 VARIABLES.                                              01840001
018500*--------------------------------------------------------------*  01850001
018600 01  PV-DB2-VARIABLES.                                            01860001
018700     05  PV-DB2-DEPT              PIC S9(4)V COMP-3 VALUE 0.      01870005
018701     05  PV-DB2-MAJ-CL            PIC S9(4)V COMP-3 VALUE 0.      01870005
018702     05  PV-DB2-SUB-CL            PIC S9(4)V COMP-3 VALUE 0.      01870005
018703     05  PV-DB2-STYLE             PIC S9(8)V COMP-3 VALUE 0.      01870005
018704     05  PV-DB2-SKU-NBR           PIC S9(8)V COMP-3 VALUE 0.      01870005
018800     05  PV-DB2-INTR-UPC-ID       PIC S9(09) COMP   VALUE 0.      01880001
018900     05  PV-NULL-DEPT             PIC S9(04) VALUE +0 COMP SYNC.  01890006
018901     05  PV-NULL-MAJ-CL           PIC S9(04) VALUE +0 COMP SYNC.  01890006
018902     05  PV-NULL-SUB-CL           PIC S9(04) VALUE +0 COMP SYNC.  01890006
018903     05  PV-NULL-STYLE            PIC S9(04) VALUE +0 COMP SYNC.  01890006
018904     05  PV-NULL-SKU              PIC S9(04) VALUE +0 COMP SYNC.  01890006
018905     05  PV-NULL-UNIT-RTL         PIC S9(04) VALUE +0 COMP SYNC.  01890006
018906     05  PV-NULL-NCLR-RTL-AMT     PIC S9(04) VALUE +0 COMP SYNC.  01890006
019100     05  PV-NULL-GP-PRIC-ID       PIC S9(04) VALUE +0 COMP SYNC.  01910006
019300     05  PV-NULL-GP-RTL-QTY       PIC S9(04) VALUE +0 COMP SYNC.  01930006
019500     05  PV-NULL-GP-RTL-AMT       PIC S9(04) VALUE +0 COMP SYNC.  01950006
019600                                                                  01820001
019700 01  PV-ROW-ID                    PIC S9(04) COMP VALUE 0.                
019800                                                                  01820001
019900*-----------------------------------------------------------              
020000* TABLE TO HOLD THE 100 RECORDS FROM THE MULTI-ROW FETCH                  
020100*-----------------------------------------------------------              
020200 01  TL-HOST-VARIABLES-TABLE.                                             
020300     05 TL-XST00063-PRCHG-TYP-CDE     PIC   X(3)                          
020400                                         OCCURS 100 TIMES.                
020500     05 TL-XST00064-STR-GP-TYP-CDE       PIC  S9(4) COMP                  
020600                                         OCCURS 100 TIMES.                
020700     05 TL-XST00064-STR-GP-ID            PIC  S9(4) COMP                  
020800                                         OCCURS 100 TIMES.                
020900     05 TL-XST00064-PRCHG-EFF-DTE        PIC   X(10)                      
021000                                         OCCURS 100 TIMES.                
021100     05 TL-XST00065-UNT-RTL-AMT          PIC  S9(7)V9(2) COMP-3           
021200                                         OCCURS 100 TIMES.                
021300     05 TL-XST00065-GP-PRIC-ID           PIC  S9(9) COMP                  
021400                                         OCCURS 100 TIMES.                
021500     05 TL-XST00065-GP-RTL-QTY           PIC  S9(4) COMP                  
021600                                         OCCURS 100 TIMES.                
021700     05 TL-XST00065-GP-RTL-AMT           PIC  S9(7)V9(2) COMP-3           
021800                                         OCCURS 100 TIMES.                
021900     05 TL-XST00065-LAST-UPD-TMST        PIC   X(26)                      
022000                                         OCCURS 100 TIMES.                
022100     05 TL-NULL-UNIT-RTL         PIC S9(04) VALUE +0 COMP SYNC    01890006
022200                                         OCCURS 100 TIMES.                
022300     05 TL-NULL-GP-PRIC-ID       PIC S9(04) VALUE +0 COMP SYNC    01910006
022400                                         OCCURS 100 TIMES.                
022500     05 TL-NULL-GP-RTL-QTY       PIC S9(04) VALUE +0 COMP SYNC    01930006
022600                                         OCCURS 100 TIMES.                
022700     05 TL-NULL-GP-RTL-AMT       PIC S9(04) VALUE +0 COMP SYNC    01950006
022800                                         OCCURS 100 TIMES.                
022900                                                                  01970001
023000*--------------------------------------------------------------*  01830001
023100* LOCATION TABLE                                                  01840001
023200*--------------------------------------------------------------*  01850001
023300 01  TL-LOCATION-TABLE.                                                   
023400     05  TL-LOC-TB-SIZE          PIC  9(5).                               
023500     05  TL-LOCATIONS            OCCURS    9999 TIMES                     
023600                                 DEPENDING ON TL-LOC-TB-SIZE              
023700                                 ASCENDING KEY IS TL-LOC-NBR              
023800                                 INDEXED  BY LOC-IDX.                     
023801         10 TL-LOC-NBR              PIC S9(4) COMP.                       
023802*--------------------------------------------------------------*  01980001
023803*--------------------------------------------------------------*  01980001
023804* EPRD045 CONTROL CARD LAYOUT - NUMBER DAYS TO SEND BEFORE OPEN   01990001
023805*--------------------------------------------------------------*  02000001
023806     COPY EPRD045.                                                02010001
023807                                                                  02020001
023808*--------------------------------------------------------------*  02030001
023809* EPRD135 FPLU HIER RECORD LAYOUT --- INPUT                       02040001
023810*--------------------------------------------------------------*  02050001
023811     COPY EPRD135.                                                02060001
023812                                                                  02070001
023813*--------------------------------------------------------------*  02080001
023814* EPRD136 FPLU RECORD LAYOUT --- OUTPUT (BOTH FILES USE SAME)     02090001
023815*--------------------------------------------------------------*  02100001
023816     COPY EPRD136.                                                02110001
023817                                                                  02120001
023818*--------------------------------------------------------------*  02080001
023819* EPRD220 SQLFPLU RECORD LAYOUT --- OUTPUT (BOTH FILES USE SAME)  02090001
023820*--------------------------------------------------------------*  02100001
023821     COPY EPRD220.                                                02110001
023822                                                                  02120001
023823*--------------------------------------------------------------*  02130001
023824* EPWS112 CONTROL CARD LAYOUT - TOMMORROWS DATE                   02140001
023825*--------------------------------------------------------------*  02150001
023826     COPY EPWS112.                                                02160001
023827                                                                  02170001
023828*--------------------------------------------------------------*  02180001
023829* EPWS140 CONTROL CARD LAYOUT - TODAYS DATE                       02190001
023830*--------------------------------------------------------------*  02200001
023831     COPY EPWS140.                                                02210001
023832                                                                  02220001
023833*--------------------------------------------------------------*  02230001
023834* EPWS161 CONTROL CARD LAYOUT - FOR PREV & NEXT "NEW" DAY DATES   02240001
023835*--------------------------------------------------------------*  02250001
023836     COPY EPWS161.                                                02260001
023837                                                                  02270001
023838*--------------------------------------------------------------*  02280001
023839* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02290001
023840*--------------------------------------------------------------*  02300001
023841     COPY DPWS004.                                                02310001
023842                                                                  02320001
023843*--------------------------------------------------------------*  02330001
023844* DATE ROUTINE COPY MEMBER                                        02340001
023845*--------------------------------------------------------------*  02350001
023846     COPY DPWS500.                                                02360001
023847                                                                  02370001
024300*--------------------------------------------------------------*  02430001
024400* DB2 MESSAGE AREA                                                02440001
024500*--------------------------------------------------------------*  02450001
024600     COPY SQLCA2.                                                 02460001
024700                                                                  02470001
024800*--------------------------------------------------------------*  02480001
024900* PROGRAM COUNTERS                                                02490001
025000*--------------------------------------------------------------*  02500001
025100 01  PV-PROGRAM-COUNTERS         COMP-3.                          02510001
025200     05  PV-INPUT-RECORDS          PIC 9(9) VALUE 0.              02520006
025400     05  PV-OLD-FETCHES            PIC 9(9) VALUE 0.              02540006
025401     05  PV-OLD-SKU-FETCHES        PIC 9(9) VALUE 0.              02540006
025402     05  PV-OLD-STY-FETCHES        PIC 9(9) VALUE 0.              02540006
025403     05  PV-OLD-DPT-FETCHES        PIC 9(9) VALUE 0.              02540006
025404     05  PV-OLD-MCL-FETCHES        PIC 9(9) VALUE 0.              02540006
025405     05  PV-OLD-SCL-FETCHES        PIC 9(9) VALUE 0.              02540006
025500     05  PV-OLD-STR-FETCHES        PIC 9(9) VALUE 0.              02550006
025501     05  PV-OLD-SKU-STR-FETCHES    PIC 9(9) VALUE 0.              02550006
025502     05  PV-OLD-STY-STR-FETCHES    PIC 9(9) VALUE 0.              02550006
025503     05  PV-OLD-DPT-STR-FETCHES    PIC 9(9) VALUE 0.              02550006
025504     05  PV-OLD-MCL-STR-FETCHES    PIC 9(9) VALUE 0.              02550006
025505     05  PV-OLD-SCL-STR-FETCHES    PIC 9(9) VALUE 0.              02550006
025600     05  PV-NEW-FETCHES            PIC 9(9) VALUE 0.              02560015
025700     05  PV-NEW-STR-FETCHES        PIC 9(9) VALUE 0.              02570015
025800                                                                  02580001
025900     05  PV-FUTURE-PERM-COUNT      PIC 9(9) VALUE 0.              02590001
026000     05  PV-MISSING-SKU-COUNT      PIC 9(9) VALUE 0.              02600005
026010     05  PV-MISSING-STYLE-COUNT    PIC 9(9) VALUE 0.              02600005
026100     05  PV-EXCLUDE-SKU-COUNT      PIC 9(9) VALUE 0.              02610005
026200     05  PV-BYPASS-SKU-COUNT       PIC 9(9) VALUE 0.              02620005
026300     05  PV-FOUND-SKU-COUNT        PIC 9(9) VALUE 0.              02630005
026400                                                                  02640001
026500     05  PV-CNT-OUTPUT-RECORDS     PIC 9(9) VALUE 0.              02650001
026600     05  PV-CNT-SQLOUTADD-RECORDS  PIC 9(9) VALUE 0.              02660001
026710     05  PV-CNT-SQLOUTDEL-RECORDS  PIC 9(9) VALUE 0.              02670001
026800                                                                  02680001
026900*--------------------------------------------------------------*  02690001
027000* ERROR HANDLING                                                  02700001
027100*--------------------------------------------------------------*  02710001
027200 01  PV-MISC-ABEND-FIELDS.                                        02720001
027300     05  PV-OPERATION-MSG-1        PIC X(40) VALUE SPACES.        02730001
027400     05  PV-OPERATION-MSG-2        PIC X(40) VALUE SPACES.        02740001
027500     05  PV-DB2-OPERATION          PIC X(30) VALUE SPACES.        02750001
027600                                                                  02760001
027700 01  ABEND-CODE                    PIC S9(4) VALUE 0  COMP SYNC.  02770001
027800     88  ABEND-4003-CTRL-CARD-ERROR          VALUE +4003.         02780001
027900     88  ABEND-4013-DB2-ERROR                VALUE +4013.         02790001
028000     88  ABEND-4019-CAL-SUB-ERROR            VALUE +4019.         02800001
028100     88  ABEND-4020-MQ-ERROR                 VALUE +4020.         02810001
028200     88  ABEND-4444-FORCED-ABEND             VALUE +4444.         02820001
028300     88  ABEND-4008-PGM-LOGIC-ERROR          VALUE +4008.         02830001
028400                                                                  02840001
028500*--------------------------------------------------------------*  02850001
028600* DB2 COMMUNICATIONS AREA                                         02860001
028700*--------------------------------------------------------------*  02870001
028800     EXEC SQL                                                     02880001
028900       INCLUDE SQLCA                                              02890001
029000     END-EXEC.                                                    02900001
029100                                                                  02910001
029200*--------------------------------------------------------------*  02920001
029300* DB2 TABLE XST00001 (XST_LOC) - LOCATION TABLE                   02930001
029400*--------------------------------------------------------------*  02940001
029500     EXEC SQL                                                     02950001
029600       INCLUDE XST00001                                           02960001
029700     END-EXEC.                                                    02970001
029800                                                                  02980001
029801*--------------------------------------------------------------*  02920001
029802* DB2 TABLE XST00013 (XST_VND_STYL) VENDOR STYLE TABLE            02930001
029803*--------------------------------------------------------------*  02940001
029804     EXEC SQL                                                     02950001
029805       INCLUDE XST00013                                           02960001
029806     END-EXEC.                                                    02970001
029807                                                                  02980001
029900*--------------------------------------------------------------*  02990001
030000* DB2 TABLE XST00025 (XST_LOC_ATTR) - LOC ATTRIBUTE TABLE         03000001
030100*--------------------------------------------------------------*  03010001
030200     EXEC SQL                                                     03020001
030300       INCLUDE XST00025                                           03030001
030400     END-EXEC.                                                    03040001
030500                                                                  03050001
030600*--------------------------------------------------------------*  03060001
030700* DB2 TABLE XST00011 (XST_SKU) - SKU TABLE                        03070001
030800*--------------------------------------------------------------*  03080001
030900     EXEC SQL                                                     03090001
031000       INCLUDE XST00010                                           03100001
031100     END-EXEC.                                                    03110001
031200                                                                  03120001
031201*--------------------------------------------------------------*  03060001
031202* DB2 TABLE XST00011 (XST_SKU_ATTR) - SKU ATTRIBUTE TABLE         03070001
031203*--------------------------------------------------------------*  03080001
031204     EXEC SQL                                                     03090001
031205       INCLUDE XST00011                                           03100001
031206     END-EXEC.                                                    03110001
031207                                                                  03120001
031300*--------------------------------------------------------------*  03130001
031400* DB2 TABLE XST00063 (XST_PRCHG) FUTURE PERM PRICE CHANGE         03140001
031500*--------------------------------------------------------------*  03150001
031600     EXEC SQL                                                     03160001
031700       INCLUDE XST00063                                           03170001
031800     END-EXEC.                                                    03180001
031900                                                                  03190001
032000*--------------------------------------------------------------*  03200001
032100* DB2 TABLE XST00064 (XST_STR_GP_PRCHG) FUTURE PERM STORE GRP     03210001
032300*--------------------------------------------------------------*  03230001
032400     EXEC SQL                                                     03240001
032500       INCLUDE XST00064                                           03250001
032600     END-EXEC.                                                    03260001
032700                                                                  03270001
032701*--------------------------------------------------------------*  03200001
032702* DB2 TABLE XST00065 (XST_PRCHG_MDSE) FUTR PERM CHG MERCHANDISE   03210001
032703*--------------------------------------------------------------*  03230001
032704     EXEC SQL                                                     03240001
032705       INCLUDE XST00065                                           03250001
032706     END-EXEC.                                                    03260001
032707                                                                  03270001
032708*--------------------------------------------------------------*  03200001
032709* DB2 TABLE XST00134 (XSTW_STR_GP_PRCHG_EXTR) WORK TABLE          03210001
032710*--------------------------------------------------------------*  03230001
032720     EXEC SQL                                                     03240001
032730       INCLUDE XST00134                                           03250001
032731     END-EXEC.                                                    03260001
032732                                                                  03270001
032800*--------------------------------------------------------------*  03280001
032900*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
033000*  A PARTICULAR SKU - FOR STORE GROUPS THAT ARE NOT STORE.     *  03300005
033100*--------------------------------------------------------------*  03310001
033200     EXEC SQL                                                     03320001
033300       DECLARE LOC_CURSOR  CURSOR FOR                             03330006
033400       SELECT DISTINCT L.LOC_NBR                                          
033500       FROM                                                               
033600        XST_LOC          L                                                
033700       ,XST_LOC_ATTR     A                                                
033800       WHERE                                                              
033900            L.LOC_TYP_CDE = 'DS'                                          
034000       AND  L.CLO_DTE    >= :CC-EPCC140-TODAY-DATE                        
034100       AND (L.OPN_DTE    <= :CC-EPCC140-TODAY-DATE                        
034200        OR (L.OPN_DTE    >  :CC-EPCC140-TODAY-DATE                        
034300        AND L.OPN_DTE    <= :PV-NEW-DATE))                                
034400       AND  L.LOC_NBR  =  A.LOC_NBR                                       
034500       AND (A.POS_CAP_LVL_ID = 5                                          
034600         OR A.POS_CAP_LVL_ID > 12)                                        
034700       ORDER BY L.LOC_NBR                                                 
034800     END-EXEC                                                     03320001
034801                                                                  03270001
034802*--------------------------------------------------------------*  03280001
034803*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
034804*  A PARTICULAR SKU - FOR STORE GROUPS THAT ARE NOT STORE.     *  03300005
034805*--------------------------------------------------------------*  03310001
034806     EXEC SQL                                                     03320001
034807       DECLARE OLD-SKU-CSR CURSOR                                 03330006
034808         WITH ROWSET POSITIONING FOR                                      
034809        SELECT  Y.STR_GP_TYP_CDE                                  03340006
034810               ,Y.STR_GP_ID                                       03350006
034811               ,Y.PRCHG_EFF_DTE                                   03360006
034812               ,COALESCE(M.UNT_RTL_AMT,0)                         03370006
034813               ,COALESCE(M.GP_PRIC_ID,0)                          03380003
034814               ,COALESCE(M.GP_RTL_QTY,0)                          03390003
034815               ,COALESCE(M.GP_RTL_AMT,0)                          03400003
034816               ,Y.PRCHG_TYP_CDE                                   03410003
034817               ,M.LAST_UPD_TMST                                           
034818          FROM  XSTW_STR_GP_PRCHG_EXTR Y                          03420003
034819               ,XST_PRCHG_MDSE   M                                03430003
034820         WHERE  M.MDSE_HIER_CDE  = 'SKU'                          03450006
034821           AND  M.SKU_NBR        = :PV-DB2-SKU-NBR                03750006
034822           AND  M.LAST_ACTN_CDE  <> 'D'                           03480006
034823           AND  Y.PRCHG_ID       = M.PRCHG_ID                     03490006
034824           AND  Y.STR_GP_ID      = M.STR_GP_ID                    03490006
034825           AND  Y.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
034826                                                                  03510001
035200         FOR FETCH ONLY                                           03520001
035300         WITH UR                                                  03530001
035400     END-EXEC.                                                    03540001
035401                                                                  03270001
035402*--------------------------------------------------------------*  03280001
035403*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
035404*  A PARTICULAR STYLE - FOR STORE GROUPS THAT ARE NOT STORE.   *  03300005
035405*--------------------------------------------------------------*  03310001
035406     EXEC SQL                                                     03320001
035407       DECLARE OLD-STY-CSR CURSOR                                 03330006
035408         WITH ROWSET POSITIONING FOR                                      
035409        SELECT  Y.STR_GP_TYP_CDE                                  03340006
035410               ,Y.STR_GP_ID                                       03350006
035411               ,Y.PRCHG_EFF_DTE                                   03360006
035412               ,COALESCE(M.UNT_RTL_AMT,0)                         03370006
035413               ,COALESCE(M.GP_PRIC_ID,0)                          03380003
035414               ,COALESCE(M.GP_RTL_QTY,0)                          03390003
035415               ,COALESCE(M.GP_RTL_AMT,0)                          03400003
035416               ,Y.PRCHG_TYP_CDE                                   03410003
035417               ,M.LAST_UPD_TMST                                           
035418          FROM  XSTW_STR_GP_PRCHG_EXTR Y                          03420003
035419               ,XST_PRCHG_MDSE   M                                03430003
035420         WHERE  M.MDSE_HIER_CDE  = 'STY'                          03450006
035421           AND  M.STYL_ID        = :PV-DB2-STYLE                  03440006
035422           AND  M.LAST_ACTN_CDE  <> 'D'                           03480006
035423           AND  Y.PRCHG_ID       = M.PRCHG_ID                     03490006
035424           AND  Y.STR_GP_ID      = M.STR_GP_ID                    03490006
035425           AND  Y.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
035426                                                                  03510001
035427         FOR FETCH ONLY                                           03520001
035428         WITH UR                                                  03530001
035429     END-EXEC.                                                    03540001
035430                                                                  03270001
035431*--------------------------------------------------------------*  03280001
035432*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
035433*  A PARTICULAR DEPARTMENT - FOR STORE GROUPS THAT ARE NOT     *  03300005
035434*  STORE SPECIFIC.                                             *  03300005
035435*--------------------------------------------------------------*  03310001
035436     EXEC SQL                                                     03320001
035437       DECLARE OLD-DPT-CSR CURSOR                                 03330006
035438         WITH ROWSET POSITIONING FOR                                      
035439        SELECT  Y.STR_GP_TYP_CDE                                  03340006
035440               ,Y.STR_GP_ID                                       03350006
035441               ,Y.PRCHG_EFF_DTE                                   03360006
035442               ,COALESCE(M.UNT_RTL_AMT,0)                         03370006
035443               ,COALESCE(M.GP_PRIC_ID,0)                          03380003
035444               ,COALESCE(M.GP_RTL_QTY,0)                          03390003
035445               ,COALESCE(M.GP_RTL_AMT,0)                          03400003
035446               ,Y.PRCHG_TYP_CDE                                   03410003
035447               ,M.LAST_UPD_TMST                                           
035448          FROM  XSTW_STR_GP_PRCHG_EXTR Y                          03420003
035449               ,XST_PRCHG_MDSE   M                                03430003
035450         WHERE M.MDSE_HIER_CDE  =  :XST00065-MDSE-HIER-CDE        03450006
035460           AND  M.DEPT_NBR       =  :PV-DB2-DEPT                  03440006
035470           AND  M.MAJ_CL_NBR     IS NULL                                  
035480           AND  M.SUB_CL_NBR     IS NULL                                  
035481                                                                          
035482           AND  M.LAST_ACTN_CDE  <> 'D'                           03480006
035483           AND  Y.PRCHG_ID       = M.PRCHG_ID                     03490006
035484           AND  Y.STR_GP_ID      = M.STR_GP_ID                    03490006
035485           AND  Y.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
035486                                                                  03510001
035487         FOR FETCH ONLY                                           03520001
035488         WITH UR                                                  03530001
035489     END-EXEC.                                                    03540001
035490                                                                  03270001
035491*--------------------------------------------------------------*  03280001
035492*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
035493*  A PARTICULAR MAJOR CLASS - FOR STORE GROUPS THAT ARE NOT    *  03300005
035494*  STORE SPECIFIC.                                             *  03300005
035495*--------------------------------------------------------------*  03310001
035496     EXEC SQL                                                     03320001
035497       DECLARE OLD-MCL-CSR CURSOR                                 03330006
035498         WITH ROWSET POSITIONING FOR                                      
035499        SELECT  Y.STR_GP_TYP_CDE                                  03340006
035500               ,Y.STR_GP_ID                                       03350006
035501               ,Y.PRCHG_EFF_DTE                                   03360006
035502               ,COALESCE(M.UNT_RTL_AMT,0)                         03370006
035503               ,COALESCE(M.GP_PRIC_ID,0)                          03380003
035504               ,COALESCE(M.GP_RTL_QTY,0)                          03390003
035505               ,COALESCE(M.GP_RTL_AMT,0)                          03400003
035506               ,Y.PRCHG_TYP_CDE                                   03410003
035507               ,M.LAST_UPD_TMST                                           
035508          FROM  XSTW_STR_GP_PRCHG_EXTR Y                          03420003
035509               ,XST_PRCHG_MDSE   M                                03430003
035510         WHERE  M.MDSE_HIER_CDE  =  :XST00065-MDSE-HIER-CDE       03450006
035520           AND  M.DEPT_NBR       =  :PV-DB2-DEPT                  03440006
035530           AND  M.MAJ_CL_NBR     =  :PV-DB2-MAJ-CL                03440006
035540           AND  M.SUB_CL_NBR     IS NULL                                  
035541                                                                          
035542           AND  M.LAST_ACTN_CDE  <> 'D'                           03480006
035543           AND  Y.PRCHG_ID       = M.PRCHG_ID                     03490006
035544           AND  Y.STR_GP_ID      = M.STR_GP_ID                    03490006
035545           AND  Y.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
035546                                                                  03510001
035547         FOR FETCH ONLY                                           03520001
035548         WITH UR                                                  03530001
035549     END-EXEC.                                                    03540001
035550                                                                  03270001
035551*--------------------------------------------------------------*  03280001
035552*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES FOR *  03290003
035553*  A PARTICULAR SUB CLASS - FOR STORE GROUPS THAT ARE NOT      *  03300005
035554*  STORE SPECIFIC.                                             *  03300005
035555*--------------------------------------------------------------*  03310001
035556     EXEC SQL                                                     03320001
035557       DECLARE OLD-SCL-CSR CURSOR                                 03330006
035558         WITH ROWSET POSITIONING FOR                                      
035559        SELECT  Y.STR_GP_TYP_CDE                                  03340006
035560               ,Y.STR_GP_ID                                       03350006
035561               ,Y.PRCHG_EFF_DTE                                   03360006
035562               ,COALESCE(M.UNT_RTL_AMT,0)                         03370006
035563               ,COALESCE(M.GP_PRIC_ID,0)                          03380003
035564               ,COALESCE(M.GP_RTL_QTY,0)                          03390003
035565               ,COALESCE(M.GP_RTL_AMT,0)                          03400003
035566               ,Y.PRCHG_TYP_CDE                                   03410003
035567               ,M.LAST_UPD_TMST                                           
035568          FROM  XSTW_STR_GP_PRCHG_EXTR Y                          03420003
035569               ,XST_PRCHG_MDSE   M                                03430003
035570         WHERE  M.MDSE_HIER_CDE  =  :XST00065-MDSE-HIER-CDE       03450006
035580           AND  M.DEPT_NBR       =  :PV-DB2-DEPT                  03440006
035590           AND  M.MAJ_CL_NBR     =  :PV-DB2-MAJ-CL                03440006
035600           AND  M.SUB_CL_NBR     =  :PV-DB2-SUB-CL                03440006
035601                                                                          
035602           AND  M.LAST_ACTN_CDE  <> 'D'                           03480006
035603           AND  Y.PRCHG_ID       = M.PRCHG_ID                     03490006
035604           AND  Y.STR_GP_ID      = M.STR_GP_ID                    03490006
035605           AND  Y.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
035606                                                                  03510001
035607         FOR FETCH ONLY                                           03520001
035608         WITH UR                                                  03530001
035609     END-EXEC.                                                    03540001
035610                                                                  03550001
039700*--------------------------------------------------------------*  03970015
039800*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES     *  03980015
039900*         FOR THE "NEW DAY" DATA - FOR NON STORE GROUPS        *  03990015
040000*--------------------------------------------------------------*  04000015
040100     EXEC SQL                                                     04010015
040200       DECLARE NEW-CSR CURSOR FOR                                 04020015
040300        SELECT  M.MDSE_HIER_CDE                                   04030016
040400               ,COALESCE(M.DEPT_NBR,0)                            04030016
040500               ,COALESCE(M.MAJ_CL_NBR,0)                          04030016
040600               ,COALESCE(M.SUB_CL_NBR,0)                          04030016
040700               ,COALESCE(M.STYL_ID,0)                             04030016
040701               ,COALESCE(M.SKU_NBR,0)                             04030016
040702               ,S.STR_GP_TYP_CDE                                  04040016
040703               ,S.STR_GP_ID                                       04050015
040704               ,S.PRCHG_EFF_DTE                                   04060015
040705               ,COALESCE(M.UNT_RTL_AMT,0)                         04070015
040706               ,COALESCE(M.GP_PRIC_ID,0)                          04080015
040707               ,COALESCE(M.GP_RTL_QTY,0)                          04090015
040708               ,COALESCE(M.GP_RTL_AMT,0)                          04100015
041100               ,P.PRCHG_TYP_CDE                                   04110015
041200               ,M.LAST_UPD_TMST                                           
041300          FROM  XST_PRCHG        P                                03710003
041400               ,XST_STR_GP_PRCHG S                                03720003
041401               ,XST_PRCHG_MDSE   M                                03720003
041402         WHERE (S.PRCHG_EFF_DTE >  :CC-EPCC161-PREV-NEW-DATE      04140016
041500            AND S.PRCHG_EFF_DTE <= :CC-EPCC161-NEW-DATE)          04150015
041600           AND  S.STR_GP_TYP_CDE <> 5000                          04160015
041700           AND  M.LAST_ACTN_CDE  <> 'D'                           04170015
041800           AND  S.LAST_ACTN_CDE <> 'D'                            03480006
041900           AND  P.PRCHG_ID       = S.PRCHG_ID                     03490006
042000           AND  S.PRCHG_ID       = M.PRCHG_ID                     03490006
042100           AND  S.STR_GP_ID      = M.STR_GP_ID                    03490006
042200           AND  S.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
042300           AND  P.PRCHG_ST_CDE = 'APR'                            03500006
042400           AND  P.EVNT_CTG_CDE IN ('ACT','CLR','MK2','FNL')       03500006
042401                                                                          
042402         ORDER BY M.SKU_NBR                                       04200016
042403                                                                  04210015
042404         FOR FETCH ONLY                                           04220015
042405         WITH UR                                                  04230015
042406     END-EXEC.                                                    04240015
042500                                                                  04250015
042600*--------------------------------------------------------------*  04260015
042700*  CURSOR TO IDENTIFY CHANGES TO FUTURE PERM PRICE CHANGES     *  04270015
042800*         FOR THE "NEW DAY" DATA - FOR STORE GROUPS            *  04280015
042900*         NOTE: FOR OPEN STORES ONLY (OR WITHIN X DAYS)        *  04290015
043000*--------------------------------------------------------------*  04300015
043100     EXEC SQL                                                     04310015
043200       DECLARE NEW-CSR-STR CURSOR FOR                             04320015
043300        SELECT  M.MDSE_HIER_CDE                                   04030016
043400               ,COALESCE(M.DEPT_NBR,0)                            04030016
043500               ,COALESCE(M.MAJ_CL_NBR,0)                          04030016
043600               ,COALESCE(M.SUB_CL_NBR,0)                          04030016
043700               ,COALESCE(M.STYL_ID,0)                             04030016
043701               ,COALESCE(M.SKU_NBR,0)                             04030016
043702               ,S.STR_GP_TYP_CDE                                  04340016
043703               ,S.STR_GP_ID                                       04350015
043704               ,S.PRCHG_EFF_DTE                                   04360015
043705               ,COALESCE(M.UNT_RTL_AMT,0)                         04370015
043706               ,COALESCE(M.GP_PRIC_ID,0)                          04380015
043707               ,COALESCE(M.GP_RTL_QTY,0)                          04390015
043708               ,COALESCE(M.GP_RTL_AMT,0)                          04400015
044100               ,P.PRCHG_TYP_CDE                                   04410015
044200               ,M.LAST_UPD_TMST                                           
044300          FROM  XST_PRCHG        P                                03710003
044400               ,XST_STR_GP_PRCHG S                                03720003
044401               ,XST_PRCHG_MDSE   M                                03720003
044402               ,XST_LOC          L                                04440015
044500               ,XST_LOC_ATTR     A                                04450015
044600         WHERE (S.PRCHG_EFF_DTE >  :CC-EPCC161-PREV-NEW-DATE      04460016
044700            AND S.PRCHG_EFF_DTE <= :CC-EPCC161-NEW-DATE)          04470015
044800           AND  S.STR_GP_TYP_CDE =  5000                          04480015
044900           AND  M.LAST_ACTN_CDE  <> 'D'                           04490015
045000           AND  S.LAST_ACTN_CDE <> 'D'                            03480006
045100           AND  P.PRCHG_ID       = S.PRCHG_ID                     03490006
045200           AND  S.PRCHG_ID       = M.PRCHG_ID                     03490006
045300           AND  S.STR_GP_ID      = M.STR_GP_ID                    03490006
045400           AND  S.STR_GP_TYP_CDE = M.STR_GP_TYP_CDE               03490006
045500           AND  P.PRCHG_ST_CDE = 'APR'                            03500006
045501           AND  P.EVNT_CTG_CDE <> 'CON'                           03500006
045502                                                                  04530015
045503           AND  S.STR_GP_ID   = L.LOC_NBR                         04540015
045504           AND  L.LOC_TYP_CDE = 'DS'                              04550015
045700           AND  L.CLO_DTE    >= :CC-EPCC140-TODAY-DATE            04570015
045710           AND (L.OPN_DTE    <= :CC-EPCC140-TODAY-DATE            04560015
045800            OR (L.OPN_DTE    >  :CC-EPCC140-TODAY-DATE            04580015
045900            AND L.OPN_DTE    <= :PV-NEW-DATE))                    04590015
046100           AND  S.STR_GP_ID  =  A.LOC_NBR                         04610015
046200           AND (A.POS_CAP_LVL_ID = 5                              04620015
046300             OR A.POS_CAP_LVL_ID > 12)                            04630015
046301                                                                          
046302         ORDER BY M.SKU_NBR                                       04520016
046303                                                                          
046400         FOR FETCH ONLY                                           04640015
046500         WITH UR                                                  04650015
046600     END-EXEC.                                                    04660015
046700                                                                  04670015
046800 LINKAGE SECTION.                                                 04680001
046900                                                                  04690001
047000*--------------------------------------------------------------*  04700001
047100 PROCEDURE DIVISION.                                              04710001
047200*--------------------------------------------------------------*  04720001
047300 0000-MAINLINE.                                                   04730001
047400                                                                  04740001
047500     DISPLAY ' '.                                                 04750005
047600     DISPLAY  PC-ASTERISK-LINE                                    04760005
047700     DISPLAY '   PROGRAM NAME: ' PC-PROGRAM-NAME, ' START'.       04770005
047800     DISPLAY '*********************************************'.     04780005
047900     DISPLAY ' '.                                                 04790005
048000     PERFORM 1000-INITIALIZATION.                                 04800001
048100                                                                  04810001
048200     IF PS-NOT-END-OF-FPLU-INPUT                                  04820006
048300        DISPLAY PC-ASTERISK-LINE                                  04830006
048400        DISPLAY PC-FIVE-BLANKS, 'START OF INPUT LIST '            04840006
048410                                                                          
048500        PERFORM 2000-PROCESS-LIST                                 04850005
048600           UNTIL PS-END-OF-FPLU-INPUT                             04860006
048700     ELSE                                                         04870005
048800        DISPLAY PC-ASTERISK-LINE                                  04880006
048900        DISPLAY PC-FIVE-BLANKS, 'NO DATA FOUND IN INPUT LIST'     04890006
049000     END-IF.                                                      04900005
049100                                                                  04910005
049200     PERFORM 5000-NEW-DAY.                                        04920005
049300                                                                  04930001
049400     PERFORM 9999-WRAPUP.                                         04940001
049500                                                                  04950001
049600     GOBACK.                                                      04960001
049700                                                                  04970001
049800*0000-EXIT.                                                       04980001
049900                                                                  04990001
050000*--------------------------------------------------------------*  05000001
050100* 1000-INITIALIZATION.                                            05010001
050200*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      05020001
050300*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      05030001
050400*     PARAMETERS IT MAY NEED.                                     05040001
050500*--------------------------------------------------------------*  05050001
050600 1000-INITIALIZATION.                                             05060001
050700                                                                  05070001
050800     OPEN INPUT  CC-PREV-NEXT-NEW-DAY,                            05080005
050900                 CC-PRIOR-OPEN,                                   05090005
051000                 CC-TODAY,                                        05100005
051100                 CC-TOMORROW,                                     05110005
051200                 FPLU-HEIR-LIST.                                  05120005
051500     OPEN OUTPUT FPLU-SQLADD-FILE,                                05150001
051501                 FPLU-SQLDEL-FILE.                                05150001
051502                                                                  05150001
051503     INITIALIZE  TL-HOST-VARIABLES-TABLE.                                 
051504                                                                  05150001
051600     PERFORM 1100-READ-PREV-NEXT-NEW-RECORD.                      05160005
051700                                                                  05170001
051800     PERFORM 1200-READ-PRIOR-DAYS-RECORD.                         05180005
051900                                                                  05190005
052000     PERFORM 1300-READ-TODAY-RECORD.                              05200005
052100                                                                  05210005
052200     PERFORM 1400-READ-TOMORROW-RECORD.                           05220005
052300                                                                  05230005
052400     PERFORM 1500-CALC-DAYS-DATE.                                 05240015
052500                                                                  05250005
067000     DISPLAY ' '.                                                 06700005
067001     DISPLAY '** CONTROL CARD DATES USED TO PROVIDE '             05260005
067002             'SELECT DATE RANGES ** '.                            05270005
067003     DISPLAY PC-FIVE-BLANKS, '** EFFECTIVE DATE >=  '             05280005
067004              CC-EPCC112-TOMORROW-DATE, ' AND <='                 05290006
067005              CC-EPCC161-PREV-NEW-DATE, '***'.                    05300006
067006     DISPLAY PC-FIVE-BLANKS, '* STORE SPECIFIC DATES *',          05310005
067007              '* OPEN DATE <= TODAY AND CLOSE DATE >= TODAY - ',  05320005
067008               CC-EPCC140-TODAY-DATE, ' **'.                      05330015
067009     DISPLAY PC-FIVE-BLANKS, '*** FUTURE STORES ***'              05340005
067010              '* OPEN DATE > TODAY + OPEN DATE < CALC DAY & ',    05350005
067011              'CLOSE DATE >= TODAY - ',                           05360005
067012               CC-EPCC140-TODAY-DATE, ' **'.                      05330015
067013                                                                          
067014     PERFORM 1600-GET-LOC-DTS.                                    05390006
067015     SET PS-NOT-END-OF-FPLU-INPUT TO TRUE.                        05380006
067016     PERFORM 7600-READ-INPUT-LIST.                                05390006
067017                                                                  05400006
067018*1000-EXIT.                                                       05410001
067019                                                                  05420001
067020*--------------------------------------------------------------*  05000001
067030* 1600-GET-LOC-DTS.                                               05010001
067040* GET THE LOCATION DETAILS AND LOAD THEM INTO ARRAY                       
067050*--------------------------------------------------------------*  05000001
067060 1600-GET-LOC-DTS.                                                05390006
067070                                                                          
067080        EXEC SQL                                                          
067090            OPEN LOC_CURSOR                                               
067100        END-EXEC                                                          
067200        EVALUATE TRUE                                                     
067300            WHEN SQLCODE = +0                                             
067400                CONTINUE                                                  
067500             WHEN OTHER                                                   
067600                   MOVE 'ERROR ON OPEN  OF LOC OPEN ' TO                  
067700                        PV-DB2-OPERATION                                  
067800                   PERFORM 9900-SQL-ABEND-ROUTINE                         
067900        END-EVALUATE                                                      
068000                                                                          
068100     MOVE 0 TO TL-LOC-TB-SIZE                                             
068200                                                                          
068300     PERFORM VARYING LOC-IDX FROM 1 BY 1                                  
068400       UNTIL PS-END-OF-LOC-CSR                                            
068500                                                                          
068600        INITIALIZE XST00001-LOC-NBR                                       
068700                                                                          
068800        EXEC SQL                                                          
068900            FETCH LOC_CURSOR                                              
069000             INTO :XST00001-LOC-NBR                                       
069100        END-EXEC                                                          
069200                                                                          
069300        EVALUATE TRUE                                                     
069400            WHEN SQLCODE = +0                                             
069500                CONTINUE                                                  
069600            WHEN SQLCODE = +100                                           
069700                SET PS-END-OF-LOC-CSR TO TRUE                             
069800             WHEN OTHER                                                   
069900                MOVE 'ERROR ON FETCH OF LOC FETCH' TO                     
070000                     PV-DB2-OPERATION                                     
070100                PERFORM 9900-SQL-ABEND-ROUTINE                            
070200        END-EVALUATE                                                      
070300        IF NOT PS-END-OF-LOC-CSR                                          
070400                MOVE XST00001-LOC-NBR TO TL-LOC-NBR(LOC-IDX)              
070500                ADD 1 TO TL-LOC-TB-SIZE                                   
070600        END-IF                                                            
070700     END-PERFORM.                                                         
070701                                                                          
070702*--------------------------------------------------------------*  05430001
070703* 1100-READ-PREV-NEXT-NEW-RECORD.                                 05440005
070704*     READ CONTROL CARD EPCC161. THIS CONTROL CARD CONTAINS       05450005
070705*     THE PREVIOUS AND NEXT NEW FPLU DAY.                         05460005
070706*--------------------------------------------------------------*  05470001
070707 1100-READ-PREV-NEXT-NEW-RECORD.                                  05480005
070708                                                                  05490001
070709     READ CC-PREV-NEXT-NEW-DAY INTO CC-EPCC161-CONTROL-CARD       05500005
070710       AT END                                                     05510001
070711          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05520001
070712                                                                  05530001
070713     IF PS-END-OF-CNTL-CRD-FILE                                   05540001
070714        DISPLAY ' '                                               05550001
070715        DISPLAY '** ABEND     **'                                 05560001
070716        DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME             05570001
070717        DISPLAY '** PARAGRAPH **  = 1100-READ-PREV-NEXT-NEW'      05580005
070718        DISPLAY '** MISSING PREV NEXT NEW DAY CONTROL CARD - 161' 05590005
070719        DISPLAY ' '                                               05600001
070720        MOVE +4002 TO ABEND-CODE                                  05610001
070721        CALL 'ILBOABN0' USING ABEND-CODE                          05620001
070722     ELSE                                                         05630001
070723        DISPLAY '** PREV NEXT NEW DAY CONTROL CARD  = '           05640005
070724                CC-PREV-NEXT-NEW-DAY-RECORD,  ' **'               05650006
070725        DISPLAY PC-FIVE-BLANKS, '** EPCC161 NEXT NEW DATE  = '    05660005
070726                CC-EPCC161-NEW-DATE, ' **'                        05670005
070727        DISPLAY PC-FIVE-BLANKS, '** EPCC161 PREV NEW DATE  = '    05680005
070728                CC-EPCC161-PREV-NEW-DATE, ' **'                   05690005
070729        DISPLAY ' '                                               05700001
070730     END-IF.                                                      05710001
070731                                                                  05720001
070732*1100-EXIT.                                                       05730001
070733                                                                  05740001
070734*--------------------------------------------------------------*  05750005
070735* 1200-READ-PRIOR-DAYS-RECORD.                                    05760005
070736*     READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS       05770005
070737*     NUMBER OF DAYS PRIOR TO OPENING TO INCLUDE NEW STORES       05780005
070738*--------------------------------------------------------------*  05790005
070739 1200-READ-PRIOR-DAYS-RECORD.                                     05800005
070740                                                                  05810005
070741     READ CC-PRIOR-OPEN INTO EP045-ADVDAYS-TO-SND-RECORD          05820006
070742       AT END                                                     05830005
070743          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05840005
070744                                                                  05850005
070745     IF PS-END-OF-CNTL-CRD-FILE                                   05860005
070746        DISPLAY ' '                                               05870005
070747        DISPLAY '** ABEND     **'                                 05880005
070748        DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME             05890005
070749        DISPLAY '** PARAGRAPH **  = 1200-READ-PRIOR-DAYS'         05900005
070750        DISPLAY '** MISSING PRIOR DAYS CONTROL CARD - 045'        05910005
070751        DISPLAY ' '                                               05920005
070752        MOVE +4002 TO ABEND-CODE                                  05930005
070753        CALL 'ILBOABN0' USING ABEND-CODE                          05940005
070754     ELSE                                                         05950005
070755        DISPLAY '** PRIOR DAYS TO SEND STORES CARD  = '           05960005
070756                CC-PRIOR-OPEN-RECORD,  ' **'                      05970006
070757        DISPLAY PC-FIVE-BLANKS, '** EPCC045 DAYS TILL OPEN = '    05980005
070758                EP045-DAYS-TILL-STORE-OPN, ' **'                  05990005
070759        DISPLAY PC-FIVE-BLANKS, '** EPCC045 DAYS FOR METRO = '    06000005
070760                EP045-DAYS-TO-INCR-METRO, ' * (NOT USED) *'       06010006
070761        DISPLAY ' '                                               06020005
070762     END-IF.                                                      06030005
070763                                                                  06040015
070764     IF EP045-DAYS-TILL-STORE-OPN NOT NUMERIC                     06050015
070765        DISPLAY 'INVALID PRIOR DAYS CONTROL CARD 045 '            06060015
070766        DISPLAY '   DAYS UNTIL OPEN: ',                           06070015
070767                EP045-DAYS-TILL-STORE-OPN                         06080015
070768                ' ** SHOULD HAVE BEEN NUMERIC **'                 06090015
070769        MOVE 4003 TO ABEND-CODE                                   06100015
070770        CALL 'ILBOABN0' USING ABEND-CODE                          06110005
070771     END-IF.                                                      06120015
070772                                                                  06130005
070773*1200-EXIT.                                                       06140005
070774*--------------------------------------------------------------*  06150005
070775* 1300-READ-TODAY-RECORD.                                         06160005
070776*     READ CONTROL CARD EPCC154. THIS CONTROL CARD CONTAINS       06170006
070777*     TODAYS FPLU CYCLE DATE.                                     06180006
070778*--------------------------------------------------------------*  06190005
070779 1300-READ-TODAY-RECORD.                                          06200005
070780                                                                  06210005
070781     READ CC-TODAY INTO CC-EPCC140-CONTROL-CARD                   06220005
070782       AT END                                                     06230005
070783          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06240005
070784                                                                  06250005
070785     IF PS-END-OF-CNTL-CRD-FILE                                   06260005
070786        DISPLAY ' '                                               06270005
070787        DISPLAY '** ABEND     **'                                 06280005
070788        DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME             06290005
070789        DISPLAY '** PARAGRAPH **  = 1300-READ-TODAY'              06300006
070790        DISPLAY '** MISSING CONTROL CARD FOR TODAYS DATE - 140'   06310006
070791        DISPLAY ' '                                               06320005
070792        MOVE +4002 TO ABEND-CODE                                  06330005
070793        CALL 'ILBOABN0' USING ABEND-CODE                          06340005
070794     ELSE                                                         06350005
070795        DISPLAY '** CONTROL CARD FOR TODAYS DATE    = '           06360006
070796                CC-TODAY-RECORD,  ' **'                           06370006
070797        DISPLAY PC-FIVE-BLANKS, '** EPCC140 TODAY DATE     = '    06380006
070798                CC-EPCC140-TODAY-DATE, ' **'                      06390006
070799        DISPLAY ' '                                               06400005
070800     END-IF.                                                      06410005
070801                                                                  06420005
070802*1300-EXIT.                                                       06430005
070803                                                                  06440005
070804*--------------------------------------------------------------*  06450005
070805* 1400-READ-TOMORROW-RECORD.                                      06460005
070806*     READ CONTROL CARD EPCC155. THIS CONTROL CARD CONTAINS       06470006
070807*     TOMORROWS DATE FOR FPLU.                                    06480006
070808*--------------------------------------------------------------*  06490005
070809 1400-READ-TOMORROW-RECORD.                                       06500005
070810                                                                  06510005
070811     READ CC-TOMORROW INTO CC-EPCC112-CONTROL-CARD                06520005
070812       AT END                                                     06530005
070813          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06540005
070814                                                                  06550005
070815     IF PS-END-OF-CNTL-CRD-FILE                                   06560005
070816        DISPLAY ' '                                               06570005
070817        DISPLAY '** ABEND     **'                                 06580005
070818        DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME             06590005
070819        DISPLAY '** PARAGRAPH **  = 1400-READ-TOMORROW-RECORD'    06600006
070820        DISPLAY '** MISSING TOMORROW CONTROL CARD - 155'          06610006
070821        DISPLAY ' '                                               06620005
070822        MOVE +4002 TO ABEND-CODE                                  06630005
070823        CALL 'ILBOABN0' USING ABEND-CODE                          06640005
070824     ELSE                                                         06650005
070825        DISPLAY '** TOMORROW CONTROL CARD  = '                    06660006
070826                CC-TOMORROW-RECORD,  ' **'                        06670006
070827        DISPLAY PC-FIVE-BLANKS, '** EPCC150 TOMORROW       = '    06680006
070828                CC-EPCC112-TOMORROW-DATE, ' **'                   06690006
070829        DISPLAY ' '                                               06700005
070830     END-IF.                                                      06710005
070831                                                                  06720005
070832*1400-EXIT.                                                       06730005
070833                                                                  06740005
070834*--------------------------------------------------------------*  06750015
070835* 1500-CALC-DAYS-DATE.                                            06760015
070836*     CALCULATE THE DATE THAT TODAY PLUS THE NUMBER OF DAYS       06770015
070837*     VALUE COME OUT TO, USING DATE ROUTINE.                      06780015
070838*--------------------------------------------------------------*  06790015
070839 1500-CALC-DAYS-DATE.                                             06800015
070840                                                                  06810015
070841*    * ADD "DAYS" (BEFORE OPENING TO SEND DATA)                   06820015
070842*    * TO "TODAY" (RUN DATE)                                      06830015
070843*    * TO GET DATE FOR NEW STORES DATE CHECKING                   06840015
070844     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06850015
070845     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     06860015
070846     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     06870015
070847     SET  DPG51-INCREMENT-DATE       TO TRUE.                     06880015
070848     MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      06890015
070849     MOVE EP045-DAYS-TILL-STORE-OPN  TO DPG51-INCR-DECR-DAYS-9.   06900015
070850     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06910015
070851                                             DPG54 DPG55 DPG56.   06920015
070852     EVALUATE TRUE                                                06930015
070853         WHEN DPG54-NO-ERROR                                      06940015
070854             DISPLAY 'CALCULATED DATE FOR FUTURE STORES',         06950015
070855                     ' (USING DPKUT500): ',                       06960015
070856                DPG55-DB2-ISO-DATE-FMT                            06970015
070857             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE           06980015
070858             DISPLAY '     TODAY + DAYS = FUTURE DATE'            06990015
070859                      '   TODAY (', CC-EPCC140-TODAY-DATE         07000015
070860                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     07010015
070861                      ') = FUTURE DATE (', PV-NEW-DATE, ')'       07020015
070862         WHEN DPG54-SEVERE-ERROR                                  07030015
070863             DISPLAY ' '                                          07040015
070864             DISPLAY '** ABEND ** IN EPKUT142 '                   07050015
070865             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    07060015
070866             DISPLAY '     TODAY + DAYS = FUTURE DATE'            07070015
070867                      '   TODAY (', CC-EPCC140-TODAY-DATE         07080015
070900                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     07090015
071000                      ') + DAYS (', EP045-DAYS-TILL-STORE-OPN     07100015
071100                      ') = FUTURE DATE (', PV-NEW-DATE, ')'       07110015
071200             DISPLAY '** CALLED BY 1500-CALC-DAYS-DATE'           07120015
071300             DISPLAY '** ERROR MESSAGE = '                        07130015
071400                               DPG54-ERROR-MESSAGE                07140015
071500             DISPLAY '** DPG51 = ' DPG51                          07150015
071600             DISPLAY '** DPG52 = ' DPG52                          07160015
071700             DISPLAY '** DPG53 = ' DPG53                          07170015
071800             DISPLAY '** DPG54 = ' DPG54                          07180015
071900             DISPLAY '** DPG55 = ' DPG55                          07190015
072000             DISPLAY '** DPG56 = ' DPG56                          07200015
072100             MOVE '1500-CALC-DAYS-DATE'                           07210015
072200                                  TO PV-PARAGRAPH-NAME            07220015
072300             MOVE 'ERROR CALCULATING NEW STORE DATE'              07230015
072400                                  TO PV-OPERATION-MSG-1           07240015
072500             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      07250015
072600             MOVE 4019 TO ABEND-CODE                              07260015
072700             CALL 'ILBOABN0' USING ABEND-CODE                     07270005
072800     END-EVALUATE.                                                07280015
072900                                                                  07290015
073000*1500-EXIT.                                                       07300015
073100                                                                  07310015
073200*--------------------------------------------------------------*  07320001
073300* 2000-PROCESS-LIST.                                           *  07330006
073400*      THIS PROCESS GOES THRU INPUT LIST.  ISSUES A DELETE     *  07340006
073500*  RECORD FOR EACH, IF INPUT RECORD IS AT SKU LEVEL GET MORE   *  07350006
073600*  INFORMATION AND ISSUE ADD RECORD AS APPROPRIATE.            *  07360006
073700*      FIRST CURSOR DOES NON-STORE GROUPS (MOST COMMON DATA)   *  07370006
073800*      2ND CURSOR CHECKS STR RELATED (MAKING SURE STR IS OPEN) *  07380006
073900*--------------------------------------------------------------*  07390001
074000 2000-PROCESS-LIST.                                               07400006
074100                                                                  07410001
074200     SET PS-CONTINUE-WRITE TO TRUE.                                       
074300                                                                          
074400*    ** STYLE DATA IS MISSING DEPT NBR, MAJ CL NBR & SUB CL NBR **        
074500*    ** VALUES, WHICH ARE NEEDED FOR IT TO BE MEANINGFUL AT THE **        
074600*    ** STORE.  SELECT THESE BEFORE PROCEEDING.                 **        
074700     IF EP135-MDSE-HIER-CDE = 'STY'                                       
074800        MOVE EP135-VENDOR-STYLE TO XST00013-STYL-ID                       
074900        PERFORM 9100-SELECT-STYLE                                         
075000                                                                          
075100        IF PS-STYLE-NOT-OK                                                
075200           SET PS-BYPASS-WRITE TO TRUE                                    
075300        END-IF                                                            
075400     END-IF.                                                              
075500                                                                          
075501     IF PS-CONTINUE-WRITE                                                 
075505        PERFORM 7300-FORMAT-SQL-OUTPUT                            07420006
075506        PERFORM 7400-FORMAT-SQL-DEL                               07430006
075507                                                                          
075509        PERFORM 8100-WRITE-FPLU-SQLSVR-DEL-REC                    07440006
075510                                                                          
075511     END-IF.                                                              
075512                                                                  07450006
075513     IF EP135-MDSE-HIER-CDE = 'SKU'                               03440006
075514        IF EP135-SKU-NBR     > 0  AND                             07460006
075515           EP135-INTR-UPC-ID > 0                                  07470006
075516                                                                  07500006
076800           MOVE EP135-SKU-NBR TO XST00010-SKU-NBR                 07680006
076900           PERFORM 9000-SELECT-SKU-ATTR                           07690006
077000                                                                  07700006
077010           IF PS-SKU-OK                                                   
077100              IF XST00011-PLU-DWNLD-EXCL-IND = 'Y'                07710006
077110                 SET PS-SKU-NOT-OK TO TRUE                                
077200                 ADD 1             TO PV-EXCLUDE-SKU-COUNT        07720015
077400              END-IF                                              07740015
077500           END-IF                                                 07750006
077501        ELSE                                                      07510015
077502           DISPLAY ' ** BYPASSING SKU ', EP135-SKU-NBR            07520006
077503                   ', INTR UPC ID ', EP135-INTR-UPC-ID            07530006
077504           ADD 1             TO PV-BYPASS-SKU-COUNT               07540015
077505           SET PS-SKU-NOT-OK TO TRUE                                      
077506        END-IF                                                    07510015
077507                                                                          
077508        IF PS-SKU-NOT-OK                                                  
077509           SET PS-BYPASS-WRITE TO TRUE                                    
077510        END-IF                                                    07510015
077600     END-IF.                                                      07760006
077700                                                                          
077800     IF PS-CONTINUE-WRITE                                         03440006
077900        PERFORM 3000-CURSORS                                      07500006
077901     END-IF.                                                              
077902                                                                  07560001
077903     PERFORM 7600-READ-INPUT-LIST.                                07570006
077904                                                                  07580001
077905*2000-EXIT.                                                       07590006
077906                                                                  07600001
084000*--------------------------------------------------------------*  08400006
084001* 3000-CURSORS                                                 *  08360006
084002*      THIS FIRST LOOKS FOR MDSE DETAILS ON NON STORE TYPE     *  08370006
084003*  GROUP AND THEN LOOKS FOR ANY STORE SPECIFIC DETAILS (THE    *  08380006
084004*  STORE MUST BE OPEN OR WITHIN STANDARD WINDOW OF OPEN)       *  08390006
084005*--------------------------------------------------------------*  08400006
084100 3000-CURSORS.                                                    08410006
084200                                                                  08420006
084300     MOVE EP135-MDSE-HIER-CDE   TO XST00065-MDSE-HIER-CDE.                
084400                                                                          
084500     EVALUATE TRUE                                                        
084600        WHEN EP135-MDSE-HIER-CDE = 'SKU'                          03440006
084700             MOVE EP135-SKU-NBR TO PV-DB2-SKU-NBR                 15320016
084800             MOVE ZEROES        TO PV-DB2-DEPT                    15320016
084900                                   PV-DB2-MAJ-CL                  01870005
085000                                   PV-DB2-SUB-CL                  01870005
085100                                   PV-DB2-STYLE                   01870005
085200             MOVE XST00011-LAST-NCLR-RTL-AMT TO                   16240006
085300                  PV-NON-CL-RTL-PRC                               16250006
085400                                                                          
085500             PERFORM 3100-PROCESS-OLD-SKU                                 
085600                                                                          
085700        WHEN EP135-MDSE-HIER-CDE = 'STY'                          03440006
085800             MOVE EP135-VENDOR-STYLE  TO PV-DB2-STYLE             15320016
085900             MOVE XST00013-DEPT-NBR   TO PV-DB2-DEPT              07960005
086000             MOVE XST00013-MAJ-CL-NBR TO PV-DB2-MAJ-CL            07970005
086100             MOVE XST00013-SUB-CL-NBR TO PV-DB2-SUB-CL            07970005
086200             MOVE ZEROES              TO PV-DB2-SKU-NBR           15320016
086300             MOVE ZEROES              TO PV-NON-CL-RTL-PRC        16250006
086400                                                                          
086500             PERFORM 3200-PROCESS-OLD-STY                                 
086600                                                                          
086700        WHEN EP135-MDSE-HIER-CDE = 'DPT'                          03440006
086800             MOVE EP135-DEPT-NBR      TO PV-DB2-DEPT              15320016
086900             MOVE ZEROES              TO PV-DB2-SKU-NBR           15320016
087000                                         PV-DB2-MAJ-CL            01870005
087100                                         PV-DB2-SUB-CL            01870005
087200                                         PV-DB2-STYLE             01870005
087300             MOVE ZEROES              TO PV-NON-CL-RTL-PRC        16250006
087400                                                                          
087500             PERFORM 3300-PROCESS-OLD-DPT                                 
087600                                                                          
087700        WHEN EP135-MDSE-HIER-CDE = 'MCL'                          03440006
087800             MOVE EP135-DEPT-NBR      TO PV-DB2-DEPT              15320016
087900             MOVE EP135-MAJ-CLASS     TO PV-DB2-MAJ-CL            15320016
088000             MOVE ZEROES              TO PV-DB2-SKU-NBR           15320016
088100                                         PV-DB2-STYLE             01870005
088200                                         PV-DB2-SUB-CL            03440006
088300             MOVE ZEROES              TO PV-NON-CL-RTL-PRC        16250006
088400                                                                          
088500             PERFORM 3400-PROCESS-OLD-MCL                                 
088600                                                                          
088700        WHEN EP135-MDSE-HIER-CDE = 'SCL'                          03440006
088800             MOVE EP135-DEPT-NBR      TO PV-DB2-DEPT              15320016
088900             MOVE EP135-MAJ-CLASS     TO PV-DB2-MAJ-CL            15320016
089000             MOVE EP135-SUB-CLASS     TO PV-DB2-SUB-CL            15320016
089100             MOVE ZEROES              TO PV-DB2-STYLE             15320016
089200                                         PV-DB2-SKU-NBR           01870005
089300             MOVE ZEROES              TO PV-NON-CL-RTL-PRC        16250006
089400                                                                          
089500             PERFORM 3500-PROCESS-OLD-SCL                                 
089600                                                                          
089700        WHEN OTHER                                                03440006
089800             DISPLAY ' '                                          06570005
089900             DISPLAY '** ABEND     **'                            06580005
090000             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        06590005
090100             DISPLAY '** PARAGRAPH **  = 3000-CURSORS'            06600006
090200             DISPLAY '** UNEXPECTED HIER CODE FOUND - '           06610006
090300                       EP135-MDSE-HIER-CDE, '**'                  03440006
090400             DISPLAY ' '                                          06620005
090500             MOVE +4008 TO ABEND-CODE                             06630005
090600             CALL 'ILBOABN0' USING ABEND-CODE                     06640005
090601     END-EVALUATE.                                                        
090602                                                                  08640006
090603*3000-EXIT.                                                       08650006
090604                                                                  08660006
090605*--------------------------------------------------------------*  08670006
090606* 3100-PROCESS-OLD-SKU                                         *  08680006
090607*    PROCESS THE OLD SKU AND OLD SKU STR CURSORS, FORMATTING   *  08690006
090608*    AND WRITING ADD RECORDS AS APPROPRIATE.                   *  08690006
090609*--------------------------------------------------------------*  08700006
090610 3100-PROCESS-OLD-SKU.                                            08710006
090611                                                                          
090612     MOVE '3100-PROCESS-OLD-SKU' TO PV-PARAGRAPH-NAME.            08720006
090613                                                                  08730006
090614     PERFORM 3110-OPEN-OLD-SKU.                                   08430006
090615     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   08440006
090616     SET PS-LOC-FND                    TO TRUE.                   08440006
090617                                                                          
090618     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      08460006
090619     PERFORM 3120-FETCH-OLD-SKU                                   08450006
090620*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
090630      PERFORM VARYING PV-ROW-ID FROM 1 BY 1                               
090640       UNTIL PV-ROW-ID > SQLERRD (3)                                      
090650                                                                          
090660           MOVE TL-XST00064-STR-GP-TYP-CDE (PV-ROW-ID)                    
090670                               TO XST00064-STR-GP-TYP-CDE                 
090680           MOVE TL-XST00064-STR-GP-ID (PV-ROW-ID)                         
090690                               TO XST00064-STR-GP-ID                      
090700           MOVE TL-XST00064-PRCHG-EFF-DTE (PV-ROW-ID)                     
090800                               TO XST00064-PRCHG-EFF-DTE                  
090900           MOVE TL-XST00065-UNT-RTL-AMT (PV-ROW-ID)                       
091000                               TO XST00065-UNT-RTL-AMT                    
091100           MOVE TL-XST00065-GP-PRIC-ID (PV-ROW-ID)                        
091200                               TO XST00065-GP-PRIC-ID                     
091300           MOVE TL-XST00065-GP-RTL-QTY (PV-ROW-ID)                        
091400                               TO XST00065-GP-RTL-QTY                     
091500           MOVE TL-XST00065-GP-RTL-AMT (PV-ROW-ID)                        
091600                               TO XST00065-GP-RTL-AMT                     
091700           MOVE TL-XST00063-PRCHG-TYP-CDE (PV-ROW-ID)                     
091800                               TO XST00063-PRCHG-TYP-CDE                  
091900           MOVE TL-XST00065-LAST-UPD-TMST (PV-ROW-ID)                     
092000                               TO XST00065-LAST-UPD-TMST                  
092100           MOVE TL-NULL-GP-PRIC-ID (PV-ROW-ID)                            
092200                               TO PV-NULL-GP-PRIC-ID                      
092300           MOVE TL-NULL-UNIT-RTL (PV-ROW-ID)                              
092400                               TO PV-NULL-UNIT-RTL                        
092500           MOVE TL-NULL-GP-RTL-QTY (PV-ROW-ID)                            
092600                               TO PV-NULL-GP-RTL-QTY                      
092700           MOVE TL-NULL-GP-RTL-AMT (PV-ROW-ID)                            
092800                               TO PV-NULL-GP-RTL-AMT                      
092900*                                                                 08460006
093000                                                                          
093100       IF   XST00064-STR-GP-TYP-CDE = 5000                                
093200         PERFORM 3600-VALIDATIONS                                 08470006
093300       ELSE                                                               
093800         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
093900         PERFORM 7500-FORMAT-SQL-ADD                                      
094000         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
094100                                                                          
094200       END-IF                                                             
094300                                                                          
094400       IF PS-LOC-FND AND XST00064-STR-GP-TYP-CDE = 5000                   
094900         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
095000         PERFORM 7500-FORMAT-SQL-ADD                                      
095100         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
095200                                                                          
095300       END-IF                                                             
095400                                                                          
095500     END-PERFORM                                                  08510006
095600     END-PERFORM.                                                 08510006
095601                                                                          
095602     PERFORM 3130-CLOSE-OLD-SKU.                                  08520006
095603                                                                  08530006
095604                                                                  08640006
095605*3100-EXIT.                                                       08650006
095606                                                                  08660006
095607*--------------------------------------------------------------*  08670006
095608* 3110-OPEN-OLD-SKU                                            *  08680006
095609*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08690006
095610*--------------------------------------------------------------*  08700006
095620 3110-OPEN-OLD-SKU.                                               08710006
095621                                                                          
095622     MOVE '3110-OPEN-OLD-SKU' TO PV-PARAGRAPH-NAME.               08720006
095623                                                                  08730006
095624     PERFORM                                                      08740006
095625         WITH TEST AFTER                                          08750006
095626         VARYING PV-SQL-SUB                                       08760006
095627         FROM 1 BY 1                                              08770006
095628         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08780006
095629                   OR  SQLCODE = 0)                               08790006
095630             EXEC SQL                                             08800006
095631               OPEN OLD-SKU-CSR                                   08810006
095632             END-EXEC                                             08820006
095633                                                                  08830006
095634         EVALUATE TRUE                                            08840006
095635            WHEN SQLCODE = -904                                   08850006
095636            WHEN SQLCODE = -911                                   08860006
095637            WHEN SQLCODE = -913                                   08870006
095638               CONTINUE                                           08880006
095639            WHEN SQLCODE = 0                                      08890006
095640               CONTINUE                                           08900006
095641            WHEN SQLWARN0 NOT EQUAL SPACE                         08910006
095642            WHEN SQLCODE NOT EQUAL ZERO                           08920006
095643               MOVE 'ERROR ON OPEN OF OLD SKU CSR' TO             08930006
095644                    PV-DB2-OPERATION                              08940006
095645               PERFORM 9900-SQL-ABEND-ROUTINE                     08950006
095646         END-EVALUATE                                             08960006
095647     END-PERFORM.                                                 08970006
095648                                                                  08980006
095649     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990006
095650        MOVE 'OPEN RETRIES EXCEEDED' TO PV-DB2-OPERATION          09000006
095651        PERFORM 9900-SQL-ABEND-ROUTINE                            09020006
095652     END-IF.                                                      09030006
095653                                                                  09040006
095654*3110-EXIT.                                                       09050006
095655                                                                  09060006
095656*--------------------------------------------------------------*  09070001
095657* 3120-FETCH-OLD-SKU.                                          *  09080001
095658*--------------------------------------------------------------*  09090001
095659 3120-FETCH-OLD-SKU.                                              09100001
095660                                                                  09110001
095661     MOVE '3120-FETCH-OLD-SKU  ' TO PV-PARAGRAPH-NAME.            09120001
095662                                                                  09130001
095663     PERFORM                                                      09140004
095664          WITH TEST AFTER                                         09150004
095665          VARYING PV-SQL-SUB                                      09160004
095666          FROM 1 BY 1                                             09170004
095667          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                09180004
095668                    OR  SQLCODE = 0                               09190004
095669                    OR  SQLCODE = +100)                           09200004
095670                                                                  09350001
095680          EXEC SQL                                                09210004
095690                FETCH NEXT ROWSET FROM OLD-SKU-CSR FOR 100 ROWS           
095700                INTO  :TL-XST00064-STR-GP-TYP-CDE                 09230004
095800                     ,:TL-XST00064-STR-GP-ID                      09240004
095900                     ,:TL-XST00064-PRCHG-EFF-DTE                  09250004
096000                     ,:TL-XST00065-UNT-RTL-AMT                    09260004
096100                      :TL-NULL-UNIT-RTL                           09280006
096200                     ,:TL-XST00065-GP-PRIC-ID                     09270004
096300                      :TL-NULL-GP-PRIC-ID                         09280006
096400                     ,:TL-XST00065-GP-RTL-QTY                     09290004
096500                      :TL-NULL-GP-RTL-QTY                         09300006
096600                     ,:TL-XST00065-GP-RTL-AMT                     09310004
096700                      :TL-NULL-GP-RTL-AMT                         09320006
096800                     ,:TL-XST00063-PRCHG-TYP-CDE                  09330004
096900                     ,:TL-XST00065-LAST-UPD-TMST                  12260004
096901           END-EXEC                                               09340004
096902                                                                  09350001
096903           EVALUATE TRUE                                          09360004
096904              WHEN SQLCODE = -911                                 09370004
096905              WHEN SQLCODE = -913                                 09380004
096906                   CONTINUE                                       09390004
096907              WHEN SQLCODE = 0                                    09400004
096908*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
096909                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
096910                            PV-OLD-SKU-FETCHES                    09410004
096911                            PV-FUTURE-PERM-COUNT                  09420004
096912              WHEN SQLCODE = +100                                 09450004
096913                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
096914                            PV-OLD-SKU-FETCHES                    09410004
096915                            PV-FUTURE-PERM-COUNT                  09420004
096916                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          09460004
096917              WHEN OTHER                                          09470004
096918                   MOVE 'ERROR ON FETCH OF OLD-SKU-CSR' TO        09480004
096919                        PV-DB2-OPERATION                          09490001
096920                   PERFORM 9900-SQL-ABEND-ROUTINE                 09500004
096921           END-EVALUATE                                           09510004
096922     END-PERFORM.                                                 09520004
096923                                                                          
096924     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09530004
096925        MOVE 'FETCH RETRIES EXCEEDED' TO PV-DB2-OPERATION         09540004
096926        PERFORM 9900-SQL-ABEND-ROUTINE                            09560004
096927     END-IF.                                                      09570004
096928                                                                  09580001
096929*--------------------------------------------------------------*  09610001
096930* 3130-CLOSE-OLD-SKU.                                          *  09620001
096931*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  09630001
096932*--------------------------------------------------------------*  09640001
096933 3130-CLOSE-OLD-SKU.                                              09650001
096934                                                                  09660001
096935     MOVE '3130-CLOSE-OLD-SKU' TO PV-PARAGRAPH-NAME.              09670001
096936                                                                  09680001
096937     PERFORM                                                      09690001
097000         WITH TEST AFTER                                          09700001
097100         VARYING PV-SQL-SUB                                       09710001
097200         FROM 1 BY 1                                              09720001
097300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09730001
097400                   OR  SQLCODE = 0)                               09740001
097500             EXEC SQL                                             09750001
097600                CLOSE OLD-SKU-CSR                                 09760001
097700             END-EXEC                                             09770001
097800                                                                  09780001
097900         EVALUATE TRUE                                            09790001
098000           WHEN SQLCODE = -904                                    09800001
098100           WHEN SQLCODE = -911                                    09810001
098200           WHEN SQLCODE = -913                                    09820001
098300                CONTINUE                                          09830001
098400           WHEN SQLCODE = 0                                       09840001
098500                CONTINUE                                          09850001
098600           WHEN SQLWARN0 NOT EQUAL SPACE                          09860001
098700           WHEN SQLCODE NOT EQUAL ZERO                            09870001
098800                MOVE 'ERROR ON CLOSE OF OLD SKU CSR' TO           09880001
098900                     PV-DB2-OPERATION                             09890001
099000                PERFORM 9900-SQL-ABEND-ROUTINE                    09900001
099100         END-EVALUATE                                             09910001
099200     END-PERFORM.                                                 09920001
099300                                                                  09930001
099400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09940001
099500        MOVE 'CLOSE RETRIES EXCEEDED' TO PV-DB2-OPERATION         09950001
099700        PERFORM 9900-SQL-ABEND-ROUTINE                            09970001
099800     END-IF.                                                      09980001
099900                                                                  09990001
100000*3130-EXIT.                                                       10000001
100100                                                                  10010001
100101*--------------------------------------------------------------*  08670006
100102* 3200-PROCESS-OLD-STY                                         *  08680006
100103*    PROCESS THE OLD STY AND OLD STY STR CURSORS, FORMATTING   *  08690006
100104*    AND WRITING ADD RECORDS AS APPROPRIATE.                   *  08690006
100105*--------------------------------------------------------------*  08700006
100106 3200-PROCESS-OLD-STY.                                            08710006
100107                                                                          
100108     MOVE '3200-PROCESS-OLD-STY' TO PV-PARAGRAPH-NAME.            08720006
100109                                                                  08730006
100110     PERFORM 3210-OPEN-OLD-STY.                                   08430006
100120     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   08440006
100121                                                                          
100122     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      08460006
100123     PERFORM 3220-FETCH-OLD-STY                                   08450006
100124*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
100125      PERFORM VARYING PV-ROW-ID FROM 1 BY 1                               
100126       UNTIL PV-ROW-ID > SQLERRD (3)                                      
100127                                                                          
100128           MOVE TL-XST00064-STR-GP-TYP-CDE (PV-ROW-ID)                    
100129                               TO XST00064-STR-GP-TYP-CDE                 
100130           MOVE TL-XST00064-STR-GP-ID (PV-ROW-ID)                         
100140                               TO XST00064-STR-GP-ID                      
100150           MOVE TL-XST00064-PRCHG-EFF-DTE (PV-ROW-ID)                     
100160                               TO XST00064-PRCHG-EFF-DTE                  
100170           MOVE TL-XST00065-UNT-RTL-AMT (PV-ROW-ID)                       
100180                               TO XST00065-UNT-RTL-AMT                    
100190           MOVE TL-XST00065-GP-PRIC-ID (PV-ROW-ID)                        
100200                               TO XST00065-GP-PRIC-ID                     
100300           MOVE TL-XST00065-GP-RTL-QTY (PV-ROW-ID)                        
100400                               TO XST00065-GP-RTL-QTY                     
100500           MOVE TL-XST00065-GP-RTL-AMT (PV-ROW-ID)                        
100600                               TO XST00065-GP-RTL-AMT                     
100700           MOVE TL-XST00063-PRCHG-TYP-CDE (PV-ROW-ID)                     
100800                               TO XST00063-PRCHG-TYP-CDE                  
100900           MOVE TL-XST00065-LAST-UPD-TMST (PV-ROW-ID)                     
101000                               TO XST00065-LAST-UPD-TMST                  
101100           MOVE TL-NULL-GP-PRIC-ID (PV-ROW-ID)                            
101200                               TO PV-NULL-GP-PRIC-ID                      
101300           MOVE TL-NULL-UNIT-RTL (PV-ROW-ID)                              
101400                               TO PV-NULL-UNIT-RTL                        
101500           MOVE TL-NULL-GP-RTL-QTY (PV-ROW-ID)                            
101600                               TO PV-NULL-GP-RTL-QTY                      
101700           MOVE TL-NULL-GP-RTL-AMT (PV-ROW-ID)                            
101800                               TO PV-NULL-GP-RTL-AMT                      
101900*                                                                 08460006
102000       IF   XST00064-STR-GP-TYP-CDE = 5000                                
102100         PERFORM 3600-VALIDATIONS                                 08470006
102200       ELSE                                                               
102700         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
102800         PERFORM 7500-FORMAT-SQL-ADD                                      
102900         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
103000                                                                          
103100       END-IF                                                             
103200                                                                          
103300        IF PS-LOC-FND AND XST00064-STR-GP-TYP-CDE = 5000                  
103800         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
103900         PERFORM 7500-FORMAT-SQL-ADD                                      
104000         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
104100                                                                          
104200       END-IF                                                             
104300                                                                          
104400     END-PERFORM                                                  08510006
104500     END-PERFORM.                                                 08510006
104501                                                                          
104502     PERFORM 3230-CLOSE-OLD-STY.                                  08520006
104503                                                                  08530006
104504                                                                  08640006
104505*3200-EXIT.                                                       08650006
104506                                                                  08660006
104507*--------------------------------------------------------------*  08670006
104508* 3210-OPEN-OLD-STY                                            *  08680006
104509*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08690006
104510*--------------------------------------------------------------*  08700006
104520 3210-OPEN-OLD-STY.                                               08710006
104521                                                                          
104522     MOVE '3210-OPEN-OLD-STY' TO PV-PARAGRAPH-NAME.               08720006
104523                                                                  08730006
104524     PERFORM                                                      08740006
104525         WITH TEST AFTER                                          08750006
104526         VARYING PV-SQL-SUB                                       08760006
104527         FROM 1 BY 1                                              08770006
104528         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08780006
104529                   OR  SQLCODE = 0)                               08790006
104530             EXEC SQL                                             08800006
104531               OPEN OLD-STY-CSR                                   08810006
104532             END-EXEC                                             08820006
104533                                                                  08830006
104534         EVALUATE TRUE                                            08840006
104535            WHEN SQLCODE = -904                                   08850006
104536            WHEN SQLCODE = -911                                   08860006
104537            WHEN SQLCODE = -913                                   08870006
104538               CONTINUE                                           08880006
104539            WHEN SQLCODE = 0                                      08890006
104540               CONTINUE                                           08900006
104541            WHEN SQLWARN0 NOT EQUAL SPACE                         08910006
104542            WHEN SQLCODE NOT EQUAL ZERO                           08920006
104543               MOVE 'ERROR ON OPEN OF OLD STY CSR' TO             08930006
104544                    PV-DB2-OPERATION                              08940006
104545               PERFORM 9900-SQL-ABEND-ROUTINE                     08950006
104546         END-EVALUATE                                             08960006
104547     END-PERFORM.                                                 08970006
104548                                                                  08980006
104549     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990006
104550        MOVE 'OPEN RETRIES EXCEEDED' TO PV-DB2-OPERATION          09000006
104551        PERFORM 9900-SQL-ABEND-ROUTINE                            09020006
104552     END-IF.                                                      09030006
104553                                                                  09040006
104554*3210-EXIT.                                                       09050006
104555                                                                  09060006
104556*--------------------------------------------------------------*  09070001
104557* 3220-FETCH-OLD-STY.                                          *  09080001
104558*--------------------------------------------------------------*  09090001
104559 3220-FETCH-OLD-STY.                                              09100001
104560                                                                  09110001
104561     MOVE '3220-FETCH-OLD-STY  ' TO PV-PARAGRAPH-NAME.            09120001
104562                                                                  09130001
104563     PERFORM                                                      09140004
104564          WITH TEST AFTER                                         09150004
104565          VARYING PV-SQL-SUB                                      09160004
104566          FROM 1 BY 1                                             09170004
104567          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                09180004
104568                    OR  SQLCODE = 0                               09190004
104569                    OR  SQLCODE = +100)                           09200004
104570                                                                  09350001
104580           EXEC SQL                                               09210004
104590           FETCH NEXT ROWSET FROM OLD-STY-CSR FOR 100 ROWS        09220004
104600                 INTO  :TL-XST00064-STR-GP-TYP-CDE                09230004
104700                      ,:TL-XST00064-STR-GP-ID                     09240004
104800                      ,:TL-XST00064-PRCHG-EFF-DTE                 09250004
104900                      ,:TL-XST00065-UNT-RTL-AMT                   09260004
105000                       :TL-NULL-UNIT-RTL                          09280006
105100                      ,:TL-XST00065-GP-PRIC-ID                    09270004
105200                       :TL-NULL-GP-PRIC-ID                        09280006
105300                      ,:TL-XST00065-GP-RTL-QTY                    09290004
105400                       :TL-NULL-GP-RTL-QTY                        09300006
105500                      ,:TL-XST00065-GP-RTL-AMT                    09310004
105600                       :TL-NULL-GP-RTL-AMT                        09320006
105700                      ,:TL-XST00063-PRCHG-TYP-CDE                 09330004
105800                      ,:TL-XST00065-LAST-UPD-TMST                 12260004
105801           END-EXEC                                               09340004
105802                                                                  09350001
105803           EVALUATE TRUE                                          09360004
105804              WHEN SQLCODE = -911                                 09370004
105805              WHEN SQLCODE = -913                                 09380004
105806                   CONTINUE                                       09390004
105807              WHEN SQLCODE = 0                                    09400004
105808*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
105809                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
105810                            PV-OLD-STY-FETCHES                    09410004
105811                            PV-FUTURE-PERM-COUNT                  09420004
105812              WHEN SQLCODE = +100                                 09450004
105813                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
105814                            PV-OLD-STY-FETCHES                    09410004
105815                            PV-FUTURE-PERM-COUNT                  09420004
105816                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          09460004
105817              WHEN OTHER                                          09470004
105818                   MOVE 'ERROR ON FETCH OF OLD-STY-CSR' TO        09480004
105819                        PV-DB2-OPERATION                          09490001
105820                   PERFORM 9900-SQL-ABEND-ROUTINE                 09500004
105821           END-EVALUATE                                           09510004
105822     END-PERFORM.                                                 09520004
105823                                                                          
105824     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09530004
105825        MOVE 'FETCH RETRIES EXCEEDED' TO PV-DB2-OPERATION         09540004
105826        PERFORM 9900-SQL-ABEND-ROUTINE                            09560004
105827     END-IF.                                                      09570004
105828                                                                  09580001
105829*3220-EXIT.                                                       09590001
105830                                                                  09600001
105831*--------------------------------------------------------------*  09610001
105832* 3230-CLOSE-OLD-STY.                                          *  09620001
105833*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  09630001
105834*--------------------------------------------------------------*  09640001
105835 3230-CLOSE-OLD-STY.                                              09650001
105836                                                                  09660001
105837     MOVE '3230-CLOSE-OLD-STY' TO PV-PARAGRAPH-NAME.              09670001
105838                                                                  09680001
105839     PERFORM                                                      09690001
105840         WITH TEST AFTER                                          09700001
105841         VARYING PV-SQL-SUB                                       09710001
105842         FROM 1 BY 1                                              09720001
105843         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09730001
105844                   OR  SQLCODE = 0)                               09740001
105845             EXEC SQL                                             09750001
105846                CLOSE OLD-STY-CSR                                 09760001
105847             END-EXEC                                             09770001
105848                                                                  09780001
105849         EVALUATE TRUE                                            09790001
105850           WHEN SQLCODE = -904                                    09800001
105851           WHEN SQLCODE = -911                                    09810001
105852           WHEN SQLCODE = -913                                    09820001
105853                CONTINUE                                          09830001
105854           WHEN SQLCODE = 0                                       09840001
105855                CONTINUE                                          09850001
105856           WHEN SQLWARN0 NOT EQUAL SPACE                          09860001
105857           WHEN SQLCODE NOT EQUAL ZERO                            09870001
105858                MOVE 'ERROR ON CLOSE OF OLD STY CSR' TO           09880001
105859                     PV-DB2-OPERATION                             09890001
105860                PERFORM 9900-SQL-ABEND-ROUTINE                    09900001
105861         END-EVALUATE                                             09910001
105862     END-PERFORM.                                                 09920001
105863                                                                  09930001
105864     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09940001
105865        MOVE 'CLOSE RETRIES EXCEEDED' TO PV-DB2-OPERATION         09950001
105866        PERFORM 9900-SQL-ABEND-ROUTINE                            09970001
105867     END-IF.                                                      09980001
105868                                                                  09990001
105869*3230-EXIT.                                                       10000001
105870                                                                  10010001
105871*--------------------------------------------------------------*  08670006
105872* 3300-PROCESS-OLD-DPT                                         *  08680006
105873*    PROCESS THE OLD DPT AND OLD DPT STR CURSORS, FORMATTING   *  08690006
105874*    AND WRITING ADD RECORDS AS APPROPRIATE.                   *  08690006
105875*--------------------------------------------------------------*  08700006
105876 3300-PROCESS-OLD-DPT.                                            08710006
105877                                                                          
105878     MOVE '3300-PROCESS-OLD-DPT' TO PV-PARAGRAPH-NAME.            08720006
105879                                                                  08730006
105880     PERFORM 3310-OPEN-OLD-DPT.                                   08430006
105890     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   08440006
105900     SET PS-LOC-FND                    TO TRUE.                   08440006
106000                                                                          
106100     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      08460006
106200     PERFORM 3320-FETCH-OLD-DPT                                   08450006
106300*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
106400      PERFORM VARYING PV-ROW-ID FROM 1 BY 1                               
106500       UNTIL PV-ROW-ID > SQLERRD (3)                                      
106600                                                                          
106700           MOVE TL-XST00064-STR-GP-TYP-CDE (PV-ROW-ID)                    
106800                               TO XST00064-STR-GP-TYP-CDE                 
106900           MOVE TL-XST00064-STR-GP-ID (PV-ROW-ID)                         
107000                               TO XST00064-STR-GP-ID                      
107100           MOVE TL-XST00064-PRCHG-EFF-DTE (PV-ROW-ID)                     
107200                               TO XST00064-PRCHG-EFF-DTE                  
107300           MOVE TL-XST00065-UNT-RTL-AMT (PV-ROW-ID)                       
107400                               TO XST00065-UNT-RTL-AMT                    
107500           MOVE TL-XST00065-GP-PRIC-ID (PV-ROW-ID)                        
107600                               TO XST00065-GP-PRIC-ID                     
107700           MOVE TL-XST00065-GP-RTL-QTY (PV-ROW-ID)                        
107800                               TO XST00065-GP-RTL-QTY                     
107900           MOVE TL-XST00065-GP-RTL-AMT (PV-ROW-ID)                        
108000                               TO XST00065-GP-RTL-AMT                     
108100           MOVE TL-XST00063-PRCHG-TYP-CDE (PV-ROW-ID)                     
108200                               TO XST00063-PRCHG-TYP-CDE                  
108300           MOVE TL-XST00065-LAST-UPD-TMST (PV-ROW-ID)                     
108400                               TO XST00065-LAST-UPD-TMST                  
108500           MOVE TL-NULL-GP-PRIC-ID (PV-ROW-ID)                            
108600                               TO PV-NULL-GP-PRIC-ID                      
108700           MOVE TL-NULL-UNIT-RTL (PV-ROW-ID)                              
108800                               TO PV-NULL-UNIT-RTL                        
108900           MOVE TL-NULL-GP-RTL-QTY (PV-ROW-ID)                            
109000                               TO PV-NULL-GP-RTL-QTY                      
109100           MOVE TL-NULL-GP-RTL-AMT (PV-ROW-ID)                            
109200                               TO PV-NULL-GP-RTL-AMT                      
109300*                                                                 08460006
109400       IF   XST00064-STR-GP-TYP-CDE = 5000                                
109500         PERFORM 3600-VALIDATIONS                                 08470006
109600       ELSE                                                               
110100         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
110200         PERFORM 7500-FORMAT-SQL-ADD                                      
110300         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
110400                                                                          
110500       END-IF                                                             
110600                                                                          
110700        IF PS-LOC-FND AND XST00064-STR-GP-TYP-CDE = 5000                  
111200         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
111300         PERFORM 7500-FORMAT-SQL-ADD                                      
111400         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
111500                                                                          
111600       END-IF                                                             
111700                                                                          
111800     END-PERFORM                                                  08510006
111900     END-PERFORM.                                                 08510006
112000                                                                          
112100     PERFORM 3330-CLOSE-OLD-DPT.                                  08520006
112101*                                                                 08640006
112102*3300-EXIT.                                                       08650006
112103                                                                  08660006
112104*--------------------------------------------------------------*  08670006
112105* 3310-OPEN-OLD-DPT                                            *  08680006
112106*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08690006
112107*--------------------------------------------------------------*  08700006
112108 3310-OPEN-OLD-DPT.                                               08710006
112109                                                                          
112110     MOVE '3310-OPEN-OLD-DPT' TO PV-PARAGRAPH-NAME.               08720006
112111                                                                  08730006
112112     PERFORM                                                      08740006
112113         WITH TEST AFTER                                          08750006
112114         VARYING PV-SQL-SUB                                       08760006
112115         FROM 1 BY 1                                              08770006
112116         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08780006
112117                   OR  SQLCODE = 0)                               08790006
112118             EXEC SQL                                             08800006
112119               OPEN OLD-DPT-CSR                                   08810006
112120             END-EXEC                                             08820006
112121                                                                  08830006
112122         EVALUATE TRUE                                            08840006
112123            WHEN SQLCODE = -904                                   08850006
112124            WHEN SQLCODE = -911                                   08860006
112125            WHEN SQLCODE = -913                                   08870006
112126               CONTINUE                                           08880006
112127            WHEN SQLCODE = 0                                      08890006
112128               CONTINUE                                           08900006
112129            WHEN SQLWARN0 NOT EQUAL SPACE                         08910006
112130            WHEN SQLCODE NOT EQUAL ZERO                           08920006
112131               MOVE 'ERROR ON OPEN OF OLD DPT CSR' TO             08930006
112132                    PV-DB2-OPERATION                              08940006
112133               PERFORM 9900-SQL-ABEND-ROUTINE                     08950006
112134         END-EVALUATE                                             08960006
112135     END-PERFORM.                                                 08970006
112136                                                                  08980006
112137     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990006
112138        MOVE 'OPEN RETRIES EXCEEDED' TO PV-DB2-OPERATION          09000006
112139        PERFORM 9900-SQL-ABEND-ROUTINE                            09020006
112140     END-IF.                                                      09030006
112141                                                                  09040006
112142*3310-EXIT.                                                       09050006
112143                                                                  09060006
112144*--------------------------------------------------------------*  09070001
112145* 3320-FETCH-OLD-DPT.                                          *  09080001
112146*--------------------------------------------------------------*  09090001
112147 3320-FETCH-OLD-DPT.                                              09100001
112148                                                                  09110001
112149     MOVE '3320-FETCH-DPT-CSR  ' TO PV-PARAGRAPH-NAME.            09120001
112150                                                                  09130001
112151     PERFORM                                                      09140004
112152          WITH TEST AFTER                                         09150004
112153          VARYING PV-SQL-SUB                                      09160004
112154          FROM 1 BY 1                                             09170004
112155          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                09180004
112156                    OR  SQLCODE = 0                               09190004
112157                    OR  SQLCODE = +100)                           09200004
112158                                                                  09350001
112159           EXEC SQL                                               09210004
112160           FETCH NEXT ROWSET FROM  OLD-DPT-CSR FOR 100 ROWS       09220004
112170                 INTO  :TL-XST00064-STR-GP-TYP-CDE                09230004
112180                      ,:TL-XST00064-STR-GP-ID                     09240004
112190                      ,:TL-XST00064-PRCHG-EFF-DTE                 09250004
112200                      ,:TL-XST00065-UNT-RTL-AMT                   09260004
112300                       :TL-NULL-UNIT-RTL                          09280006
112400                      ,:TL-XST00065-GP-PRIC-ID                    09270004
112500                       :TL-NULL-GP-PRIC-ID                        09280006
112600                      ,:TL-XST00065-GP-RTL-QTY                    09290004
112700                       :TL-NULL-GP-RTL-QTY                        09300006
112800                      ,:TL-XST00065-GP-RTL-AMT                    09310004
112900                       :TL-NULL-GP-RTL-AMT                        09320006
113000                      ,:TL-XST00063-PRCHG-TYP-CDE                 09330004
113001                      ,:TL-XST00065-LAST-UPD-TMST                 12260004
113002           END-EXEC                                               09340004
113003                                                                  09350001
113004           EVALUATE TRUE                                          09360004
113005              WHEN SQLCODE = -911                                 09370004
113006              WHEN SQLCODE = -913                                 09380004
113007                   CONTINUE                                       09390004
113008              WHEN SQLCODE = 0                                    09400004
113009*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
113010                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
113011                            PV-OLD-DPT-FETCHES                    09410004
113012                            PV-FUTURE-PERM-COUNT                  09420004
113013              WHEN SQLCODE = +100                                 09450004
113014                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
113015                            PV-OLD-DPT-FETCHES                    09410004
113016                            PV-FUTURE-PERM-COUNT                  09420004
113017                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          09460004
113018              WHEN OTHER                                          09470004
113019                   MOVE 'ERROR ON FETCH OF OLD-DPT-CSR' TO        09480004
113020                        PV-DB2-OPERATION                          09490001
113021                   PERFORM 9900-SQL-ABEND-ROUTINE                 09500004
113022           END-EVALUATE                                           09510004
113023     END-PERFORM.                                                 09520004
113024                                                                          
113025     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09530004
113026        MOVE 'FETCH RETRIES EXCEEDED' TO PV-DB2-OPERATION         09540004
113027        PERFORM 9900-SQL-ABEND-ROUTINE                            09560004
113028     END-IF.                                                      09570004
113029                                                                  09580001
113030*3320-EXIT.                                                       09590001
113031                                                                  09600001
113032*--------------------------------------------------------------*  09610001
113033* 3330-CLOSE-OLD-DPT.                                          *  09620001
113034*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  09630001
113035*--------------------------------------------------------------*  09640001
113036 3330-CLOSE-OLD-DPT.                                              09650001
113037                                                                  09660001
113038     MOVE '3330-CLOSE-OLD-DPT' TO PV-PARAGRAPH-NAME.              09670001
113039                                                                  09680001
113040     PERFORM                                                      09690001
113041         WITH TEST AFTER                                          09700001
113042         VARYING PV-SQL-SUB                                       09710001
113043         FROM 1 BY 1                                              09720001
113044         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09730001
113045                   OR  SQLCODE = 0)                               09740001
113046             EXEC SQL                                             09750001
113047                CLOSE OLD-DPT-CSR                                 09760001
113048             END-EXEC                                             09770001
113049                                                                  09780001
113050         EVALUATE TRUE                                            09790001
113051           WHEN SQLCODE = -904                                    09800001
113052           WHEN SQLCODE = -911                                    09810001
113053           WHEN SQLCODE = -913                                    09820001
113054                CONTINUE                                          09830001
113055           WHEN SQLCODE = 0                                       09840001
113056                CONTINUE                                          09850001
113057           WHEN SQLWARN0 NOT EQUAL SPACE                          09860001
113058           WHEN SQLCODE NOT EQUAL ZERO                            09870001
113059                MOVE 'ERROR ON CLOSE OF OLD DPT CSR' TO           09880001
113060                     PV-DB2-OPERATION                             09890001
113061                PERFORM 9900-SQL-ABEND-ROUTINE                    09900001
113062         END-EVALUATE                                             09910001
113063     END-PERFORM.                                                 09920001
113064                                                                  09930001
113065     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09940001
113066        MOVE 'CLOSE RETRIES EXCEEDED' TO PV-DB2-OPERATION         09950001
113067        PERFORM 9900-SQL-ABEND-ROUTINE                            09970001
113068     END-IF.                                                      09980001
113069                                                                  09990001
113070*3330-EXIT.                                                       10000001
113071                                                                  10010001
113072*--------------------------------------------------------------*  08670006
113073* 3400-PROCESS-OLD-MCL                                         *  08680006
113074*    PROCESS THE OLD MCL AND OLD MCL STR CURSORS, FORMATTING   *  08690006
113075*    AND WRITING ADD RECORDS AS APPROPRIATE.                   *  08690006
113076*--------------------------------------------------------------*  08700006
113077 3400-PROCESS-OLD-MCL.                                            08710006
113078                                                                          
113079     MOVE '3400-PROCESS-OLD-MCL' TO PV-PARAGRAPH-NAME.            08720006
113080                                                                  08730006
113081     PERFORM 3410-OPEN-OLD-MCL.                                   08430006
113082     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   08440006
113083                                                                          
113084     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      08460006
113085*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
113086     PERFORM 3420-FETCH-OLD-MCL                                   08450006
113087      PERFORM VARYING PV-ROW-ID FROM 1 BY 1                               
113088       UNTIL PV-ROW-ID > SQLERRD (3)                                      
113089                                                                          
113090           MOVE TL-XST00064-STR-GP-TYP-CDE (PV-ROW-ID)                    
113100                               TO XST00064-STR-GP-TYP-CDE                 
113200           MOVE TL-XST00064-STR-GP-ID (PV-ROW-ID)                         
113300                               TO XST00064-STR-GP-ID                      
113400           MOVE TL-XST00064-PRCHG-EFF-DTE (PV-ROW-ID)                     
113500                               TO XST00064-PRCHG-EFF-DTE                  
113600           MOVE TL-XST00065-UNT-RTL-AMT (PV-ROW-ID)                       
113700                               TO XST00065-UNT-RTL-AMT                    
113800           MOVE TL-XST00065-GP-PRIC-ID (PV-ROW-ID)                        
113900                               TO XST00065-GP-PRIC-ID                     
114000           MOVE TL-XST00065-GP-RTL-QTY (PV-ROW-ID)                        
114100                               TO XST00065-GP-RTL-QTY                     
114200           MOVE TL-XST00065-GP-RTL-AMT (PV-ROW-ID)                        
114300                               TO XST00065-GP-RTL-AMT                     
114400           MOVE TL-XST00063-PRCHG-TYP-CDE (PV-ROW-ID)                     
114500                               TO XST00063-PRCHG-TYP-CDE                  
114600           MOVE TL-XST00065-LAST-UPD-TMST (PV-ROW-ID)                     
114700                               TO XST00065-LAST-UPD-TMST                  
114800           MOVE TL-NULL-GP-PRIC-ID (PV-ROW-ID)                            
114900                               TO PV-NULL-GP-PRIC-ID                      
115000           MOVE TL-NULL-UNIT-RTL (PV-ROW-ID)                              
115100                               TO PV-NULL-UNIT-RTL                        
115200           MOVE TL-NULL-GP-RTL-QTY (PV-ROW-ID)                            
115300                               TO PV-NULL-GP-RTL-QTY                      
115400           MOVE TL-NULL-GP-RTL-AMT (PV-ROW-ID)                            
115500                               TO PV-NULL-GP-RTL-AMT                      
115600*                                                                 08460006
115700       IF   XST00064-STR-GP-TYP-CDE = 5000                                
115800         PERFORM 3600-VALIDATIONS                                 08470006
115900       ELSE                                                               
116400         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
116500         PERFORM 7500-FORMAT-SQL-ADD                                      
116600         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
116700                                                                          
116800       END-IF                                                             
116900                                                                          
117000        IF PS-LOC-FND AND XST00064-STR-GP-TYP-CDE = 5000                  
117104         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
117105         PERFORM 7500-FORMAT-SQL-ADD                                      
117106         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
117107                                                                          
117108       END-IF                                                             
117109                                                                          
117110     END-PERFORM                                                  08510006
117120     END-PERFORM.                                                 08510006
117130                                                                          
117131     PERFORM 3430-CLOSE-OLD-MCL.                                  08520006
117132                                                                  08530006
117133                                                                  08640006
117134*3400-EXIT.                                                       08650006
117135                                                                  08660006
117136*--------------------------------------------------------------*  08670006
117137* 3410-OPEN-OLD-MCL                                            *  08680006
117138*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08690006
117139*--------------------------------------------------------------*  08700006
117140 3410-OPEN-OLD-MCL.                                               08710006
117141                                                                          
117142     MOVE '3410-OPEN-OLD-MCL' TO PV-PARAGRAPH-NAME.               08720006
117143                                                                  08730006
117144     PERFORM                                                      08740006
117145         WITH TEST AFTER                                          08750006
117146         VARYING PV-SQL-SUB                                       08760006
117147         FROM 1 BY 1                                              08770006
117148         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08780006
117149                   OR  SQLCODE = 0)                               08790006
117150             EXEC SQL                                             08800006
117151               OPEN OLD-MCL-CSR                                   08810006
117152             END-EXEC                                             08820006
117153                                                                  08830006
117154         EVALUATE TRUE                                            08840006
117155            WHEN SQLCODE = -904                                   08850006
117156            WHEN SQLCODE = -911                                   08860006
117157            WHEN SQLCODE = -913                                   08870006
117158               CONTINUE                                           08880006
117159            WHEN SQLCODE = 0                                      08890006
117160               CONTINUE                                           08900006
117161            WHEN SQLWARN0 NOT EQUAL SPACE                         08910006
117162            WHEN SQLCODE NOT EQUAL ZERO                           08920006
117163               MOVE 'ERROR ON OPEN OF OLD MCL CSR' TO             08930006
117164                    PV-DB2-OPERATION                              08940006
117165               PERFORM 9900-SQL-ABEND-ROUTINE                     08950006
117166         END-EVALUATE                                             08960006
117167     END-PERFORM.                                                 08970006
117168                                                                  08980006
117169     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990006
117170        MOVE 'OPEN RETRIES EXCEEDED' TO PV-DB2-OPERATION          09000006
117171        PERFORM 9900-SQL-ABEND-ROUTINE                            09020006
117172     END-IF.                                                      09030006
117173                                                                  09040006
117174*3410-EXIT.                                                       09050006
117175                                                                  09060006
117176*--------------------------------------------------------------*  09070001
117177* 3420-FETCH-OLD-MCL.                                          *  09080001
117178*--------------------------------------------------------------*  09090001
117179 3420-FETCH-OLD-MCL.                                              09100001
117180                                                                  09110001
117181     MOVE '3420-FETCH-OLD-MCL  ' TO PV-PARAGRAPH-NAME.            09120001
117182                                                                  09130001
117183     PERFORM                                                      09140004
117184          WITH TEST AFTER                                         09150004
117185          VARYING PV-SQL-SUB                                      09160004
117186          FROM 1 BY 1                                             09170004
117187          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                09180004
117188                    OR  SQLCODE = 0                               09190004
117189                    OR  SQLCODE = +100)                           09200004
117190           EXEC SQL                                               09210004
117200           FETCH NEXT ROWSET FROM OLD-MCL-CSR FOR 100 ROWS        09220004
117300                 INTO  :TL-XST00064-STR-GP-TYP-CDE                09230004
117400                      ,:TL-XST00064-STR-GP-ID                     09240004
117500                      ,:TL-XST00064-PRCHG-EFF-DTE                 09250004
117600                      ,:TL-XST00065-UNT-RTL-AMT                   09260004
117700                       :TL-NULL-UNIT-RTL                          09280006
117800                      ,:TL-XST00065-GP-PRIC-ID                    09270004
117900                       :TL-NULL-GP-PRIC-ID                        09280006
118000                      ,:TL-XST00065-GP-RTL-QTY                    09290004
118100                       :TL-NULL-GP-RTL-QTY                        09300006
118200                      ,:TL-XST00065-GP-RTL-AMT                    09310004
118300                       :TL-NULL-GP-RTL-AMT                        09320006
118400                      ,:TL-XST00063-PRCHG-TYP-CDE                 09330004
118401                      ,:TL-XST00065-LAST-UPD-TMST                 12260004
118402           END-EXEC                                               09340004
118403                                                                  09350001
118404           EVALUATE TRUE                                          09360004
118405              WHEN SQLCODE = -911                                 09370004
118406              WHEN SQLCODE = -913                                 09380004
118407                   CONTINUE                                       09390004
118408              WHEN SQLCODE = 0                                    09400004
118409*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
118410                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
118411                            PV-OLD-MCL-FETCHES                    09410004
118412                            PV-FUTURE-PERM-COUNT                  09420004
118413              WHEN SQLCODE = +100                                 09450004
118414                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
118415                            PV-OLD-MCL-FETCHES                    09410004
118416                            PV-FUTURE-PERM-COUNT                  09420004
118417                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          09460004
118418              WHEN OTHER                                          09470004
118419                   MOVE 'ERROR ON FETCH OF OLD-MCL-CSR' TO        09480004
118420                        PV-DB2-OPERATION                          09490001
118421                   PERFORM 9900-SQL-ABEND-ROUTINE                 09500004
118422           END-EVALUATE                                           09510004
118423     END-PERFORM.                                                 09520004
118424                                                                          
118425     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09530004
118426        MOVE 'FETCH RETRIES EXCEEDED' TO PV-DB2-OPERATION         09540004
118427        PERFORM 9900-SQL-ABEND-ROUTINE                            09560004
118428     END-IF.                                                      09570004
118429                                                                  09580001
118430*3420-EXIT.                                                       09590001
118431                                                                  09600001
118432*--------------------------------------------------------------*  09610001
118433* 3430-CLOSE-OLD-MCL.                                          *  09620001
118434*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  09630001
118435*--------------------------------------------------------------*  09640001
118436 3430-CLOSE-OLD-MCL.                                              09650001
118437                                                                  09660001
118438     MOVE '3430-CLOSE-OLD-MCL' TO PV-PARAGRAPH-NAME.              09670001
118439                                                                  09680001
118440     PERFORM                                                      09690001
118441         WITH TEST AFTER                                          09700001
118442         VARYING PV-SQL-SUB                                       09710001
118443         FROM 1 BY 1                                              09720001
118444         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09730001
118445                   OR  SQLCODE = 0)                               09740001
118446             EXEC SQL                                             09750001
118447                CLOSE OLD-MCL-CSR                                 09760001
118448             END-EXEC                                             09770001
118449                                                                  09780001
118450         EVALUATE TRUE                                            09790001
118451           WHEN SQLCODE = -904                                    09800001
118452           WHEN SQLCODE = -911                                    09810001
118453           WHEN SQLCODE = -913                                    09820001
118454                CONTINUE                                          09830001
118455           WHEN SQLCODE = 0                                       09840001
118456                CONTINUE                                          09850001
118457           WHEN SQLWARN0 NOT EQUAL SPACE                          09860001
118458           WHEN SQLCODE NOT EQUAL ZERO                            09870001
118459                MOVE 'ERROR ON CLOSE OF OLD MCL CSR' TO           09880001
118460                     PV-DB2-OPERATION                             09890001
118461                PERFORM 9900-SQL-ABEND-ROUTINE                    09900001
118462         END-EVALUATE                                             09910001
118463     END-PERFORM.                                                 09920001
118464                                                                  09930001
118465     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09940001
118466        MOVE 'CLOSE RETRIES EXCEEDED' TO PV-DB2-OPERATION         09950001
118467        PERFORM 9900-SQL-ABEND-ROUTINE                            09970001
118468     END-IF.                                                      09980001
118469                                                                  09990001
118470*3430-EXIT.                                                       10000001
118471                                                                  10010001
118472*--------------------------------------------------------------*  08670006
118473* 3500-PROCESS-OLD-SCL                                         *  08680006
118474*    PROCESS THE OLD SCL AND OLD SCL STR CURSORS, FORMATTING   *  08690006
118475*    AND WRITING ADD RECORDS AS APPROPRIATE.                   *  08690006
118476*--------------------------------------------------------------*  08700006
118477 3500-PROCESS-OLD-SCL.                                            08710006
118478                                                                          
118479     MOVE '3500-PROCESS-OLD-SCL' TO PV-PARAGRAPH-NAME.            08720006
118480                                                                  08730006
118481     PERFORM 3510-OPEN-OLD-SCL.                                   08430006
118482     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   08440006
118483                                                                          
118484     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      08460006
118485     PERFORM 3520-FETCH-OLD-SCL                                   08450006
118486*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
118487      PERFORM VARYING PV-ROW-ID FROM 1 BY 1                               
118488       UNTIL PV-ROW-ID > SQLERRD (3)                                      
118489                                                                          
118490           MOVE TL-XST00064-STR-GP-TYP-CDE (PV-ROW-ID)                    
118500                               TO XST00064-STR-GP-TYP-CDE                 
118600           MOVE TL-XST00064-STR-GP-ID (PV-ROW-ID)                         
118700                               TO XST00064-STR-GP-ID                      
118800           MOVE TL-XST00064-PRCHG-EFF-DTE (PV-ROW-ID)                     
118900                               TO XST00064-PRCHG-EFF-DTE                  
119000           MOVE TL-XST00065-UNT-RTL-AMT (PV-ROW-ID)                       
119100                               TO XST00065-UNT-RTL-AMT                    
119200           MOVE TL-XST00065-GP-PRIC-ID (PV-ROW-ID)                        
119300                               TO XST00065-GP-PRIC-ID                     
119400           MOVE TL-XST00065-GP-RTL-QTY (PV-ROW-ID)                        
119500                               TO XST00065-GP-RTL-QTY                     
119600           MOVE TL-XST00065-GP-RTL-AMT (PV-ROW-ID)                        
119700                               TO XST00065-GP-RTL-AMT                     
119800           MOVE TL-XST00063-PRCHG-TYP-CDE (PV-ROW-ID)                     
119900                               TO XST00063-PRCHG-TYP-CDE                  
120000           MOVE TL-XST00065-LAST-UPD-TMST (PV-ROW-ID)                     
120100                               TO XST00065-LAST-UPD-TMST                  
120200           MOVE TL-NULL-GP-PRIC-ID (PV-ROW-ID)                            
120300                               TO PV-NULL-GP-PRIC-ID                      
120400           MOVE TL-NULL-UNIT-RTL (PV-ROW-ID)                              
120500                               TO PV-NULL-UNIT-RTL                        
120600           MOVE TL-NULL-GP-RTL-QTY (PV-ROW-ID)                            
120700                               TO PV-NULL-GP-RTL-QTY                      
120800           MOVE TL-NULL-GP-RTL-AMT (PV-ROW-ID)                            
120900                               TO PV-NULL-GP-RTL-AMT                      
121000*                                                                 08460006
121100       IF   XST00064-STR-GP-TYP-CDE = 5000                                
121200         PERFORM 3600-VALIDATIONS                                 08470006
121201       ELSE                                                               
121206         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
121207         PERFORM 7500-FORMAT-SQL-ADD                                      
121208         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
121209                                                                          
121210       END-IF                                                             
121220                                                                          
121230        IF PS-LOC-FND AND XST00064-STR-GP-TYP-CDE = 5000                  
121280         PERFORM 7300-FORMAT-SQL-OUTPUT                                   
121290         PERFORM 7500-FORMAT-SQL-ADD                                      
121300         PERFORM 8600-WRT-FPLU-SQLADD-REC                                 
121400                                                                          
121500       END-IF                                                             
121600                                                                          
121700     END-PERFORM                                                  08510006
121800     END-PERFORM.                                                 08510006
121801                                                                          
121802     PERFORM 3530-CLOSE-OLD-SCL.                                  08520006
121803                                                                  08530006
121804                                                                  08640006
121805*3500-EXIT.                                                       08650006
121806                                                                  08660006
121807*--------------------------------------------------------------*  08670006
121808* 3510-OPEN-OLD-SCL                                            *  08680006
121809*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08690006
121810*--------------------------------------------------------------*  08700006
121820 3510-OPEN-OLD-SCL.                                               08710006
121821                                                                          
121822     MOVE '3510-OPEN-OLD-SCL' TO PV-PARAGRAPH-NAME.               08720006
121823                                                                  08730006
121824     PERFORM                                                      08740006
121825         WITH TEST AFTER                                          08750006
121826         VARYING PV-SQL-SUB                                       08760006
121827         FROM 1 BY 1                                              08770006
121828         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08780006
121829                   OR  SQLCODE = 0)                               08790006
121830             EXEC SQL                                             08800006
121831               OPEN OLD-SCL-CSR                                   08810006
121832             END-EXEC                                             08820006
121833                                                                  08830006
121834         EVALUATE TRUE                                            08840006
121835            WHEN SQLCODE = -904                                   08850006
121836            WHEN SQLCODE = -911                                   08860006
121837            WHEN SQLCODE = -913                                   08870006
121838               CONTINUE                                           08880006
121839            WHEN SQLCODE = 0                                      08890006
121840               CONTINUE                                           08900006
121841            WHEN SQLWARN0 NOT EQUAL SPACE                         08910006
121842            WHEN SQLCODE NOT EQUAL ZERO                           08920006
121843               MOVE 'ERROR ON OPEN OF OLD SCL CSR' TO             08930006
121844                    PV-DB2-OPERATION                              08940006
121845               PERFORM 9900-SQL-ABEND-ROUTINE                     08950006
121846         END-EVALUATE                                             08960006
121847     END-PERFORM.                                                 08970006
121848                                                                  08980006
121849     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990006
121850        MOVE 'OPEN RETRIES EXCEEDED' TO PV-DB2-OPERATION          09000006
121851        PERFORM 9900-SQL-ABEND-ROUTINE                            09020006
121852     END-IF.                                                      09030006
121853                                                                  09040006
121854*3510-EXIT.                                                       09050006
121855                                                                  09060006
121856*--------------------------------------------------------------*  09070001
121857* 3520-FETCH-OLD-SCL.                                          *  09080001
121858*--------------------------------------------------------------*  09090001
121859 3520-FETCH-OLD-SCL.                                              09100001
121860                                                                  09110001
121861     MOVE '3520-FETCH-OLD-SCL  ' TO PV-PARAGRAPH-NAME.            09120001
121862                                                                  09130001
121863     PERFORM                                                      09140004
121864          WITH TEST AFTER                                         09150004
121865          VARYING PV-SQL-SUB                                      09160004
121866          FROM 1 BY 1                                             09170004
121867          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                09180004
121868                    OR  SQLCODE = 0                               09190004
121869                    OR  SQLCODE = +100)                           09200004
121870                                                                  09350001
121871           EXEC SQL                                               09210004
121872            FETCH NEXT ROWSET FROM OLD-SCL-CSR FOR 100 ROWS       09220004
121873                 INTO  :TL-XST00064-STR-GP-TYP-CDE                09230004
121874                      ,:TL-XST00064-STR-GP-ID                     09240004
121875                      ,:TL-XST00064-PRCHG-EFF-DTE                 09250004
121876                      ,:TL-XST00065-UNT-RTL-AMT                   09260004
121877                       :TL-NULL-UNIT-RTL                          09280006
121878                      ,:TL-XST00065-GP-PRIC-ID                    09270004
121879                       :TL-NULL-GP-PRIC-ID                        09280006
121880                      ,:TL-XST00065-GP-RTL-QTY                    09290004
121881                       :TL-NULL-GP-RTL-QTY                        09300006
121882                      ,:TL-XST00065-GP-RTL-AMT                    09310004
121883                       :TL-NULL-GP-RTL-AMT                        09320006
121884                      ,:TL-XST00063-PRCHG-TYP-CDE                 09330004
121885                      ,:TL-XST00065-LAST-UPD-TMST                 12260004
121886           END-EXEC                                               09340004
121887                                                                  09350001
121888           EVALUATE TRUE                                          09360004
121889              WHEN SQLCODE = -911                                 09370004
121890              WHEN SQLCODE = -913                                 09380004
121891                   CONTINUE                                       09390004
121892              WHEN SQLCODE = 0                                    09400004
121893*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED                  
121894                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
121895                            PV-OLD-SCL-FETCHES                    09410004
121896                            PV-FUTURE-PERM-COUNT                  09420004
121897              WHEN SQLCODE = +100                                 09450004
121898                   ADD SQLERRD (3)  TO PV-OLD-FETCHES             09410004
121899                            PV-OLD-SCL-FETCHES                    09410004
121900                            PV-FUTURE-PERM-COUNT                  09420004
121901                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          09460004
121902              WHEN OTHER                                          09470004
121903                   MOVE 'ERROR ON FETCH OF OLD-SCL-CSR' TO        09480004
121904                        PV-DB2-OPERATION                          09490001
121905                   PERFORM 9900-SQL-ABEND-ROUTINE                 09500004
121906           END-EVALUATE                                           09510004
121907     END-PERFORM.                                                 09520004
121908                                                                          
121909     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09530004
121910        MOVE 'FETCH RETRIES EXCEEDED' TO PV-DB2-OPERATION         09540004
121911        PERFORM 9900-SQL-ABEND-ROUTINE                            09560004
121912     END-IF.                                                      09570004
121913                                                                  09580001
121914*3520-EXIT.                                                       09590001
121915                                                                  09600001
121916*--------------------------------------------------------------*  09610001
121917* 3530-CLOSE-OLD-SCL.                                          *  09620001
121918*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  09630001
121919*--------------------------------------------------------------*  09640001
121920 3530-CLOSE-OLD-SCL.                                              09650001
121921                                                                  09660001
121922     MOVE '3530-CLOSE-OLD-SCL' TO PV-PARAGRAPH-NAME.              09670001
121923                                                                  09680001
121924     PERFORM                                                      09690001
121925         WITH TEST AFTER                                          09700001
121926         VARYING PV-SQL-SUB                                       09710001
121927         FROM 1 BY 1                                              09720001
121928         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09730001
121929                   OR  SQLCODE = 0)                               09740001
121930             EXEC SQL                                             09750001
121931                CLOSE OLD-SCL-CSR                                 09760001
121932             END-EXEC                                             09770001
121933                                                                  09780001
121934         EVALUATE TRUE                                            09790001
121935           WHEN SQLCODE = -904                                    09800001
121936           WHEN SQLCODE = -911                                    09810001
121937           WHEN SQLCODE = -913                                    09820001
121938                CONTINUE                                          09830001
121939           WHEN SQLCODE = 0                                       09840001
121940                CONTINUE                                          09850001
121941           WHEN SQLWARN0 NOT EQUAL SPACE                          09860001
121942           WHEN SQLCODE NOT EQUAL ZERO                            09870001
121943                MOVE 'ERROR ON CLOSE OF OLD SCL CSR' TO           09880001
121944                     PV-DB2-OPERATION                             09890001
121945                PERFORM 9900-SQL-ABEND-ROUTINE                    09900001
121946         END-EVALUATE                                             09910001
121947     END-PERFORM.                                                 09920001
121948                                                                  09930001
121949     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09940001
121950        MOVE 'CLOSE RETRIES EXCEEDED' TO PV-DB2-OPERATION         09950001
121951        PERFORM 9900-SQL-ABEND-ROUTINE                            09970001
121952     END-IF.                                                      09980001
121953                                                                  09990001
121954*3530-EXIT.                                                       10000001
121955                                                                  10010001
121956*--------------------------------------------------------------*  09610001
121957* 3600-VALIDATIONS.                                            *  09620001
121958*    VALIDATE THE LOCATION WITH THE LIST LOADED INTO ARRAY     *  09630001
121959*--------------------------------------------------------------*  09640001
121960 3600-VALIDATIONS.                                                08470006
121970                                                                          
121980       SET PS-LOC-NOT-FND  TO TRUE                                        
121990       SET LOC-IDX TO 1                                                   
122000       SEARCH ALL TL-LOCATIONS                                            
122100           AT END                                                         
122200               SET PS-LOC-NOT-FND TO TRUE                                 
122300           WHEN TL-LOC-NBR (LOC-IDX) = XST00064-STR-GP-ID                 
122400                SET PS-LOC-FND  TO TRUE                                   
122500       END-SEARCH.                                                        
122600                                                                  11350001
122601*3600-EXIT.                                                       10000001
122602*--------------------------------------------------------------*  11360006
122603* 5000-NEW-DAY.                                                *  11370006
122604*      THIS PROCESS EXTRACTS FUTURE PERMANENT PRICE CHANGES    *  11380006
122605*  THAT ARE SCHEDULED TO OCCUR ON THE NEXT "NEW" DAY. AN       *  11390006
122606*  FPLU ADD RECORD IS CREATED AS APPROPRIATE.                  *  11400006
122607*--------------------------------------------------------------*  11410006
122608 5000-NEW-DAY.                                                    11420006
122609                                                                  11430006
122610     DISPLAY PC-ASTERISK-LINE.                                    11440006
122620     DISPLAY PC-FIVE-BLANKS, 'START OF NEW DAY WORK '.            11450006
122630                                                                          
122640     MOVE ZEROS    TO PV-DB2-SKU-NBR.                                     
122641     SET PS-SKU-OK TO TRUE.                                               
122642                                                                  11460006
122643     PERFORM 5300-OPEN-NEW.                                       11470015
122644     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   11480015
122645     PERFORM 5400-FETCH-NEW.                                      11490015
122646                                                                          
122647     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      11500015
122648        SET PS-CONTINUE-WRITE TO TRUE                                     
122649        PERFORM 5100-HIER-WORK                                    11620015
122650                                                                          
122651        PERFORM 5400-FETCH-NEW                                    11540015
122652     END-PERFORM.                                                 11550015
122653                                                                          
122654     PERFORM 5500-CLOSE-NEW.                                      11560015
122655                                                                          
122656     MOVE ZEROS    TO PV-DB2-SKU-NBR.                                     
122657     SET PS-SKU-OK TO TRUE.                                               
122658                                                                  11570015
122659     PERFORM 5600-OPEN-NEW-STR.                                   11580015
122660     SET PS-NOT-END-OF-FUTURE-PERM-CSR TO TRUE.                   11590015
122670     PERFORM 5700-FETCH-NEW-STR.                                  11600015
122671                                                                          
122672     PERFORM UNTIL PS-END-OF-FUTURE-PERM-CSR                      11610015
122673        PERFORM 5100-HIER-WORK                                    11620015
122674                                                                          
122675        PERFORM 5700-FETCH-NEW-STR                                11650015
122676     END-PERFORM.                                                 11660015
122677                                                                          
122678     PERFORM 5800-CLOSE-NEW-STR.                                  11670015
122679                                                                  11700006
122680*5000-EXIT.                                                       11710006
122690                                                                  11720006
122700*--------------------------------------------------------------*  11730016
122800* 5100-HIER-WORK.                                              *  11740016
122900*      THIS SECTION PERFORMS LOGIC NECESSARY FOR EACH HIERARCHY*  11750016
123000*  LEVEL OF DATA, AND WRITES OUTPUT RECORDS.                   *  11760016
123100*--------------------------------------------------------------*  11780016
123200 5100-HIER-WORK.                                                  11790016
123300                                                                          
123400     SET PS-CONTINUE-WRITE TO TRUE.                                       
123700     PERFORM 7300-FORMAT-SQL-OUTPUT.                                      
123800                                                                          
123900     EVALUATE TRUE                                                        
124000        WHEN XST00065-MDSE-HIER-CDE = 'SKU'                       03440006
124001           IF XST00065-SKU-NBR = ZEROS                                    
124002              SET PS-SKU-NOT-OK     TO TRUE                       01590006
124003              ADD 1                 TO PV-BYPASS-SKU-COUNT                
124004**            DISPLAY '** NEW DAY SKU BYPASSED ', XST00065-SKU-NBR11850016
124005**                    ' * FOR GP TYPE ',  XST00064-STR-GP-TYP-CDE,11850016
124006**                    ' * FOR GP ID ',  XST00064-STR-GP-ID,       11850016
124007**                    ' * WITH EFF DT ',  XST00064-PRCHG-EFF-DTE  11850016
124008           ELSE                                                           
124009              IF XST00065-SKU-NBR NOT = PV-DB2-SKU-NBR                    
124010                 MOVE XST00065-SKU-NBR TO XST00010-SKU-NBR                
124020                 PERFORM 9000-SELECT-SKU-ATTR                     11810016
124030              END-IF                                                      
124031           END-IF                                                         
124032                                                                  11820016
124033           IF PS-SKU-OK                                                   
124034              IF XST00011-PLU-DWNLD-EXCL-IND = 'Y'                11830016
124035                 SET PS-SKU-NOT-OK TO TRUE                        01590006
124036                 ADD 1             TO PV-EXCLUDE-SKU-COUNT        11840016
124037*X               DISPLAY ' ** NEW DAY SKU EXCLUDED ',             11850016
124038*X                    PV-DB2-INTR-UPC-ID                          11850016
124039*X                    ' * FROM DTL SKU ', PV-DB2-SKU-NBR,         11850016
124040*X                    ' * FOR GP TYPE ',  XST00064-STR-GP-TYP-CDE,11850016
124050*X                    ' * FOR GP ID ',  XST00064-STR-GP-ID,       11850016
124051*X                    ' * WITH EFF DT ',  XST00064-PRCHG-EFF-DTE  11850016
124052              END-IF                                              11880016
124053           END-IF                                                 11880016
124054                                                                  11890016
124055           IF PS-SKU-OK                                           01590006
124090              MOVE  PC-NULLS      TO EP220-DEPT-NBR-NUL           15990005
124100                                     EP220-MAJ-CL-NBR-NUL         16000005
124200                                     EP220-SUB-CL-NBR-NUL         16010005
124300                                     EP220-STYL-ID-NUL            16020005
124400              IF PV-DB2-SKU-NBR = ZERO                                    
124500                 MOVE PC-NULLS         TO EP220-SKU-NBR-NUL               
124600              ELSE                                                        
124700                 MOVE PV-DB2-SKU-NBR   TO EP220-SKU-NBR                   
124800              END-IF                                                      
124900                                                                          
162400              MOVE XST00011-LAST-NCLR-RTL-AMT TO                  16240006
162500                   PV-NON-CL-RTL-PRC                              16250006
162600           ELSE                                                           
162601              SET PS-BYPASS-WRITE TO TRUE                                 
162602           END-IF                                                 11880016
162603                                                                  15320016
162604        WHEN XST00065-MDSE-HIER-CDE = 'STY'                       03440006
162605             MOVE XST00065-STYL-ID TO XST00013-STYL-ID            15320016
162606             PERFORM 9100-SELECT-STYLE                                    
162607                                                                          
162608             IF PS-STYLE-OK                                               
162635                MOVE XST00065-STYL-ID    TO EP220-STYL-ID         15320016
162636                MOVE XST00013-DEPT-NBR   TO EP220-DEPT-NBR        15320016
162637                MOVE XST00013-MAJ-CL-NBR TO EP220-MAJ-CL-NBR      15320016
162638                MOVE XST00013-SUB-CL-NBR TO EP220-SUB-CL-NBR      15320016
162639                MOVE PC-NULLS            TO EP220-SKU-NBR-NUL     15320016
162640                MOVE ZEROS               TO PV-NON-CL-RTL-PRC     16250006
162650             ELSE                                                         
162660                SET PS-BYPASS-WRITE      TO TRUE                          
162670             END-IF                                                       
162680                                                                          
162690        WHEN XST00065-MDSE-HIER-CDE = 'DPT'                       03440006
163500             IF PV-NULL-DEPT < 0                                          
163600                MOVE PC-NULLS           TO EP220-DEPT-NBR-NUL             
163700             ELSE                                                         
163800                MOVE XST00065-DEPT-NBR  TO EP220-DEPT-NBR                 
163900             END-IF                                                       
164000             MOVE PC-NULLS            TO EP220-SKU-NBR-NUL        15320016
164100                                         EP220-STYL-ID-NUL        15320016
164200                                         EP220-MAJ-CL-NBR-NUL     15320016
164300                                         EP220-SUB-CL-NBR-NUL     15320016
164400             MOVE ZEROS               TO PV-NON-CL-RTL-PRC        16250006
164500                                                                          
164600        WHEN XST00065-MDSE-HIER-CDE = 'MCL'                       03440006
165500             IF PV-NULL-DEPT < 0                                          
165600                MOVE PC-NULLS            TO EP220-DEPT-NBR-NUL            
165700             ELSE                                                         
165800                MOVE XST00065-DEPT-NBR   TO EP220-DEPT-NBR                
165900             END-IF                                                       
166000             IF PV-NULL-MAJ-CL < 0                                        
166100                MOVE PC-NULLS            TO EP220-MAJ-CL-NBR-NUL          
166200             ELSE                                                         
166300                MOVE XST00065-MAJ-CL-NBR TO EP220-MAJ-CL-NBR              
166400             END-IF                                                       
166500                                                                          
166600             MOVE PC-NULLS            TO EP220-SKU-NBR-NUL        15320016
166700                                         EP220-STYL-ID-NUL        15320016
166800                                         EP220-SKU-NBR-NUL        15320016
166900             MOVE ZEROS               TO PV-NON-CL-RTL-PRC        16250006
167000                                                                          
167100        WHEN XST00065-MDSE-HIER-CDE = 'SCL'                       03440006
168000             IF PV-NULL-DEPT < 0                                          
168100                MOVE PC-NULLS            TO EP220-DEPT-NBR-NUL            
168200             ELSE                                                         
168300                MOVE XST00065-DEPT-NBR   TO EP220-DEPT-NBR                
168400             END-IF                                                       
168500             IF PV-NULL-MAJ-CL < 0                                        
168600                MOVE PC-NULLS            TO EP220-MAJ-CL-NBR-NUL          
168700             ELSE                                                         
168800                MOVE XST00065-MAJ-CL-NBR TO EP220-MAJ-CL-NBR              
168900             END-IF                                                       
169000             IF PV-NULL-SUB-CL < 0                                        
169100                MOVE PC-NULLS             TO EP220-SUB-CL-NBR-NUL         
169200             ELSE                                                         
169300                MOVE XST00065-SUB-CL-NBR  TO EP220-SUB-CL-NBR             
169400             END-IF                                                       
169500             MOVE PC-NULLS TO EP220-STYL-ID-NUL                   15320016
169600                             EP220-SKU-NBR-NUL                    15320016
169700             MOVE ZEROS   TO PV-NON-CL-RTL-PRC                    16250006
169800                                                                          
169900        WHEN OTHER                                                03440006
170000             DISPLAY ' '                                          06570005
170100             DISPLAY '** ABEND     **'                            06580005
170200             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        06590005
170300             DISPLAY '** PARAGRAPH **  = 5100-HIER-WORK'          06600006
170400             DISPLAY '** UNEXPECTED HIER CODE FOUND - '           06610006
170500                       XST00065-MDSE-HIER-CDE, '**'               03440006
170600             DISPLAY ' '                                          06620005
170700             MOVE +4008 TO ABEND-CODE                             06630005
170800             CALL 'ILBOABN0' USING ABEND-CODE                     06640005
170900     END-EVALUATE.                                                        
171000*    DISPLAY ' ** NEW DAY HIER -', XST00065-MDSE-HIER-CDE,        11850016
171100*            ' * FOR GP TYPE-',  XST00064-STR-GP-TYP-CDE,         11850016
171200*            ' * FOR GP ID-',  XST00064-STR-GP-ID,                11850016
171300*            ' * WITH EFF DT-',  XST00064-PRCHG-EFF-DTE           11850016
171400                                                                  11820016
171500     IF PS-CONTINUE-WRITE                                                 
171900        PERFORM 7500-FORMAT-SQL-ADD                                       
172000        PERFORM 8600-WRT-FPLU-SQLADD-REC                                  
172300     END-IF.                                                              
172400                                                                  11890016
172401*5100-EXIT.                                                       11900016
172402                                                                  12500016
172403*--------------------------------------------------------------*  12510015
172404* 5300-OPEN-NEW                                                *  12520015
172405*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  12530015
172406*--------------------------------------------------------------*  12540015
172407 5300-OPEN-NEW.                                                   12550015
172408                                                                          
172409     MOVE '5300-OPEN-NEW' TO PV-PARAGRAPH-NAME.                   12560015
172410                                                                  12570015
172411     PERFORM                                                      12580015
172412         WITH TEST AFTER                                          12590015
172413         VARYING PV-SQL-SUB                                       12600015
172414         FROM 1 BY 1                                              12610015
172415         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12620015
172416                   OR  SQLCODE = 0)                               12630015
172417             EXEC SQL                                             12640015
172418               OPEN NEW-CSR                                       12650015
172419             END-EXEC                                             12660015
172420                                                                  12670015
172421         EVALUATE TRUE                                            12680015
172422            WHEN SQLCODE = -904                                   12690015
172423            WHEN SQLCODE = -911                                   12700015
172424            WHEN SQLCODE = -913                                   12710015
172425               CONTINUE                                           12720015
172426            WHEN SQLCODE = 0                                      12730015
172427               CONTINUE                                           12740015
172428            WHEN SQLWARN0 NOT EQUAL SPACE                         12750015
172429            WHEN SQLCODE NOT EQUAL ZERO                           12760015
172430               MOVE 'ERROR ON OPEN OF NEW SKU CSR' TO             12770015
172431                    PV-DB2-OPERATION                              12780015
172432               PERFORM 9900-SQL-ABEND-ROUTINE                     12790015
172433         END-EVALUATE                                             12800015
172434     END-PERFORM.                                                 12810015
172435                                                                  12820015
172436     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12830015
172437        MOVE 'OPEN RETRIES EXCEEDED FOR NEW SKU CSR' TO           12840015
172438             PV-DB2-OPERATION                                     12850015
172439        PERFORM 9900-SQL-ABEND-ROUTINE                            12860015
172440     END-IF.                                                      12870015
172441                                                                  12880015
172442*5300-EXIT.                                                       12890015
172443                                                                  12900015
172444*--------------------------------------------------------------*  12910015
172445* 5400-FETCH-NEW.                                              *  12920015
172446*--------------------------------------------------------------*  12930015
172447 5400-FETCH-NEW.                                                  12940015
172448                                                                  12950015
172449     MOVE '5400-FETCH-NEW  ' TO PV-PARAGRAPH-NAME.                12960015
172450                                                                  12970015
172451     PERFORM                                                      12980015
172452          WITH TEST AFTER                                         12990015
172453          VARYING PV-SQL-SUB                                      13000015
172454          FROM 1 BY 1                                             13010015
172455          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                13020015
172456                    OR  SQLCODE = 0                               13030015
172457                    OR  SQLCODE = +100)                           13040015
172458           EXEC SQL                                               13050015
172459                FETCH  NEW-CSR                                    13060015
172460                 INTO  :XST00065-MDSE-HIER-CDE                    13070016
172470                      ,:XST00065-DEPT-NBR                         13070016
172480                       :PV-NULL-DEPT                              13130015
172490                      ,:XST00065-MAJ-CL-NBR                       13070016
172500                       :PV-NULL-MAJ-CL                            13130015
172600                      ,:XST00065-SUB-CL-NBR                       13070016
172700                       :PV-NULL-SUB-CL                            13130015
172800                      ,:XST00065-STYL-ID                          13070016
172900                       :PV-NULL-STYLE                             13130015
173000                      ,:XST00065-SKU-NBR                          13070016
173001                       :PV-NULL-SKU                               13130015
173002                      ,:XST00064-STR-GP-TYP-CDE                   13080016
173003                      ,:XST00064-STR-GP-ID                        13090015
173004                      ,:XST00064-PRCHG-EFF-DTE                    13100015
173005                      ,:XST00065-UNT-RTL-AMT                      13110015
173006                       :PV-NULL-UNIT-RTL                          09280006
173007                      ,:XST00065-GP-PRIC-ID                       13120015
173008                       :PV-NULL-GP-PRIC-ID                        13130015
173009                      ,:XST00065-GP-RTL-QTY                       13140015
173010                       :PV-NULL-GP-RTL-QTY                        13150015
173011                      ,:XST00065-GP-RTL-AMT                       13160015
173012                       :PV-NULL-GP-RTL-AMT                        13170015
173013                      ,:XST00063-PRCHG-TYP-CDE                    13180015
173014                      ,:XST00065-LAST-UPD-TMST                    12260004
173015           END-EXEC                                               13190015
173016                                                                  13200015
173017           EVALUATE TRUE                                          13210015
173018              WHEN SQLCODE = -911                                 13220015
173019              WHEN SQLCODE = -913                                 13230015
173020                   CONTINUE                                       13240015
173021              WHEN SQLCODE = 0                                    13250015
173022                   ADD 1 TO PV-NEW-FETCHES                        13260015
173023                            PV-FUTURE-PERM-COUNT                  13270015
173024              WHEN SQLCODE = +100                                 13300015
173025                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          13310015
173026              WHEN OTHER                                          13320015
173027                   MOVE 'FETCH ERROR ON NEW FUTURE-PERM-CSR' TO   13330015
173028                        PV-DB2-OPERATION                          13340015
173029                   PERFORM 9900-SQL-ABEND-ROUTINE                 13350015
173030           END-EVALUATE                                           13360015
173040     END-PERFORM.                                                 13370015
173041                                                                          
173042     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13380015
173043        MOVE 'FETCH NEW SKU RETRY EXCEEDED' TO                    13390015
173044             PV-DB2-OPERATION                                     13400015
173045        PERFORM 9900-SQL-ABEND-ROUTINE                            13410015
173046     END-IF.                                                      13420015
173047                                                                  13430015
173048*5400-EXIT.                                                       13440015
173049                                                                  13450015
173050*--------------------------------------------------------------*  13460015
173051* 5500-CLOSE-NEW.                                               * 13470015
173052*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  13480015
173053*--------------------------------------------------------------*  13490015
173054 5500-CLOSE-NEW.                                                  13500015
173055                                                                  13510015
173056     MOVE '5500-CLOSE-NEW' TO PV-PARAGRAPH-NAME.                  13520015
173057                                                                  13530015
173058     PERFORM                                                      13540015
173059         WITH TEST AFTER                                          13550015
173060         VARYING PV-SQL-SUB                                       13560015
173061         FROM 1 BY 1                                              13570015
173062         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13580015
173063                   OR  SQLCODE = 0)                               13590015
173064             EXEC SQL                                             13600015
173065               CLOSE NEW-CSR                                      13610015
173066             END-EXEC                                             13620015
173067                                                                  13630015
173068         EVALUATE TRUE                                            13640015
173069            WHEN SQLCODE = -904                                   13650015
173070            WHEN SQLCODE = -911                                   13660015
173071            WHEN SQLCODE = -913                                   13670015
173072                 CONTINUE                                         13680015
173073            WHEN SQLCODE = 0                                      13690015
173074                 CONTINUE                                         13700015
173075            WHEN SQLWARN0 NOT EQUAL SPACE                         13710015
173076            WHEN SQLCODE NOT EQUAL ZERO                           13720015
173077                 MOVE 'ERROR ON CLOSE OF NEW SKU CSR' TO          13730015
173078                      PV-DB2-OPERATION                            13740015
173079                 PERFORM 9900-SQL-ABEND-ROUTINE                   13750015
173080         END-EVALUATE                                             13760015
173081     END-PERFORM.                                                 13770015
173082                                                                  13780015
173083     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13790015
173084        MOVE 'CLOSE NEW SKU RETRY EXCEEDED' TO PV-DB2-OPERATION   13800015
173085        PERFORM 9900-SQL-ABEND-ROUTINE                            13820015
173086     END-IF.                                                      13830015
173087                                                                  13840015
173088*5500-EXIT.                                                       13850015
173089                                                                  13860015
173090*--------------------------------------------------------------*  13870015
173091* 5600-OPEN-NEW-STR.                                            * 13880015
173092*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  13890015
173093*--------------------------------------------------------------*  13900015
173094 5600-OPEN-NEW-STR.                                               13910015
173095                                                                          
173096     MOVE '5600-OPEN-NEW-STR' TO PV-PARAGRAPH-NAME.               13920015
173097                                                                  13930015
173098     PERFORM                                                      13940015
173099         WITH TEST AFTER                                          13950015
173100         VARYING PV-SQL-SUB                                       13960015
173101         FROM 1 BY 1                                              13970015
173102         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13980015
173103                   OR  SQLCODE = 0)                               13990015
173104             EXEC SQL                                             14000015
173105               OPEN NEW-CSR-STR                                   14010015
173106             END-EXEC                                             14020015
173107                                                                  14030015
173108         EVALUATE TRUE                                            14040015
173109            WHEN SQLCODE = -904                                   14050015
173110            WHEN SQLCODE = -911                                   14060015
173111            WHEN SQLCODE = -913                                   14070015
173112                 CONTINUE                                         14080015
173113            WHEN SQLCODE = 0                                      14090015
173114                 CONTINUE                                         14100015
173115            WHEN SQLWARN0 NOT EQUAL SPACE                         14110015
173116            WHEN SQLCODE NOT EQUAL ZERO                           14120015
173117                 MOVE 'ERR OPEN OF NEW SKU CSR STR' TO            14130015
173118                      PV-DB2-OPERATION                            14140015
173119                 PERFORM 9900-SQL-ABEND-ROUTINE                   14150015
173120         END-EVALUATE                                             14160015
173121     END-PERFORM.                                                 14170015
173122                                                                  14180015
173123     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14190015
173124        MOVE 'OPEN RETRY EXCEEDED FOR NEW SKU CSR STR' TO         14200015
173125             PV-DB2-OPERATION                                     14210015
173126        PERFORM 9900-SQL-ABEND-ROUTINE                            14220015
173127     END-IF.                                                      14230015
173128                                                                  14240015
173129*5600-EXIT.                                                       14250015
173130                                                                  14260015
173131*--------------------------------------------------------------*  14270015
173132* 5700-FETCH-NEW-STR.                                           * 14280015
173133*--------------------------------------------------------------*  14290015
173134 5700-FETCH-NEW-STR.                                              14300015
173135                                                                          
173136     MOVE '5700-FETCH-NEW  ' TO PV-PARAGRAPH-NAME.                14310015
173137                                                                  14320015
173138     PERFORM                                                      14330015
173139          WITH TEST AFTER                                         14340015
173140          VARYING PV-SQL-SUB                                      14350015
173141          FROM 1 BY 1                                             14360015
173142          UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                14370015
173143                    OR  SQLCODE = 0                               14380015
173144                    OR  SQLCODE = +100)                           14390015
173145           EXEC SQL                                               14400015
173146                FETCH  NEW-CSR-STR                                14410015
173147                 INTO  :XST00065-MDSE-HIER-CDE                    13070016
173148                      ,:XST00065-DEPT-NBR                         13070016
173149                       :PV-NULL-DEPT                              13130015
173150                      ,:XST00065-MAJ-CL-NBR                       13070016
173160                       :PV-NULL-MAJ-CL                            13130015
173170                      ,:XST00065-SUB-CL-NBR                       13070016
173180                       :PV-NULL-SUB-CL                            13130015
173190                      ,:XST00065-STYL-ID                          13070016
173200                       :PV-NULL-STYLE                             13130015
173300                      ,:XST00065-SKU-NBR                          13070016
173301                       :PV-NULL-SKU                               13130015
173302                      ,:XST00064-STR-GP-TYP-CDE                   14430016
173303                      ,:XST00064-STR-GP-ID                        14440015
173304                      ,:XST00064-PRCHG-EFF-DTE                    14450015
173305                      ,:XST00065-UNT-RTL-AMT                      14460015
173306                       :PV-NULL-UNIT-RTL                          09280006
173307                      ,:XST00065-GP-PRIC-ID                       14470015
173308                       :PV-NULL-GP-PRIC-ID                        14480015
173309                      ,:XST00065-GP-RTL-QTY                       14490015
173310                       :PV-NULL-GP-RTL-QTY                        14500015
173311                      ,:XST00065-GP-RTL-AMT                       14510015
173312                       :PV-NULL-GP-RTL-AMT                        14520015
173313                      ,:XST00063-PRCHG-TYP-CDE                    14530015
173314                      ,:XST00065-LAST-UPD-TMST                    12260004
173315           END-EXEC                                               14540015
173316                                                                  14550015
173317           EVALUATE TRUE                                          14560015
173318              WHEN SQLCODE = -911                                 14570015
173319              WHEN SQLCODE = -913                                 14580015
173320                   CONTINUE                                       14590015
173321              WHEN SQLCODE = 0                                    14600015
173322                   ADD 1 TO PV-NEW-STR-FETCHES                    14610015
173323                            PV-FUTURE-PERM-COUNT                  14620015
173324              WHEN SQLCODE = +100                                 14650015
173325                   SET PS-END-OF-FUTURE-PERM-CSR TO TRUE          14660015
173326              WHEN OTHER                                          14670015
173327                   MOVE 'ERR ON FETCH NEW-STR CSR' TO             14680015
173328                        PV-DB2-OPERATION                          14690015
173329                   PERFORM 9900-SQL-ABEND-ROUTINE                 14700015
173330           END-EVALUATE                                           14710015
173340     END-PERFORM.                                                 14720015
173341                                                                          
173342     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14730015
173343        MOVE 'FETCH RETRY EXCEDED NEW-STR' TO PV-DB2-OPERATION    14740015
173344        PERFORM 9900-SQL-ABEND-ROUTINE                            14760015
173345     END-IF.                                                      14770015
173346                                                                  14780015
173347*5700-EXIT.                                                       14790015
173348                                                                  14800015
173349*--------------------------------------------------------------*  14810015
173350* 5800-CLOSE-NEW-STR.                                          *  14820015
173351*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  14830015
173352*--------------------------------------------------------------*  14840015
173353 5800-CLOSE-NEW-STR.                                              14850015
173354                                                                  14860015
173355     MOVE '5800-CLOSE-NEW-STR' TO PV-PARAGRAPH-NAME.              14870015
173356                                                                  14880015
173357     PERFORM                                                      14890015
173358         WITH TEST AFTER                                          14900015
173359         VARYING PV-SQL-SUB                                       14910015
173360         FROM 1 BY 1                                              14920015
173361         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14930015
173362                   OR  SQLCODE = 0)                               14940015
173363             EXEC SQL                                             14950015
173364               CLOSE NEW-CSR-STR                                  14960015
173365             END-EXEC                                             14970015
173366                                                                  14980015
173367         EVALUATE TRUE                                            14990015
173368            WHEN SQLCODE = -904                                   15000015
173369            WHEN SQLCODE = -911                                   15010015
173370            WHEN SQLCODE = -913                                   15020015
173371                 CONTINUE                                         15030015
173372            WHEN SQLCODE = 0                                      15040015
173373                 CONTINUE                                         15050015
173374            WHEN SQLWARN0 NOT EQUAL SPACE                         15060015
173375            WHEN SQLCODE NOT EQUAL ZERO                           15070015
173376                 MOVE 'ERROR ON CLOSE OF NEW SKU CSR' TO          15080015
173377                      PV-DB2-OPERATION                            15090015
173378                 PERFORM 9900-SQL-ABEND-ROUTINE                   15100015
173379         END-EVALUATE                                             15110015
173380     END-PERFORM.                                                 15120015
173381                                                                  15130015
173382     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15140015
173383        MOVE 'CLOSE NEW SKU STR EXCEEDED RETRY LIMIT' TO          15150015
173384             PV-DB2-OPERATION                                     15160015
173385        PERFORM 9900-SQL-ABEND-ROUTINE                            15170015
173386     END-IF.                                                      15180015
173387                                                                  15190015
173388*5800-EXIT.                                                       15200015
173389                                                                  15210015
173964*--------------------------------------------------------------*  15220001
173965* 7300-FORMAT-SQL-OUTPUT.                                         15230006
173966*    INITIALIZE OUTPUT RECORD FOR ALL OUTPUT (DELETE OR ADD)   *  15240006
173967*--------------------------------------------------------------*  15250001
173968 7300-FORMAT-SQL-OUTPUT.                                          15260006
173969                                                                  15270001
173970     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       17000004
173980                                                                  15270001
173990     SET EP220-SKU-PRICG-ID-NO    TO TRUE.                                
174000                                                                  15270001
174100     SET EP220-DEPT-NBR-YES            TO TRUE.                           
174200     SET EP220-MAJ-CL-NBR-YES          TO TRUE.                           
174300     SET EP220-SUB-CL-NBR-YES          TO TRUE.                           
174400     SET EP220-STYL-ID-YES             TO TRUE                            
174500     SET EP220-SKU-NBR-YES             TO TRUE                            
174600     SET EP220-EXCL-MDSE-IND-YES       TO TRUE.                           
174700     SET EP220-N-RCPT-RT-RTL-AMT-Y     TO TRUE.                           
174800     SET EP220-PERM-PRCHG-DIRN-CDE-YES TO TRUE.                           
174900                                                                  17010004
175000     SET EP220-FILE-CHANGE        TO TRUE.                        17020005
175100                                                                  17010004
175200     SET EP220-APPLY-NIGHTLY      TO TRUE.                        17030005
175300                                                                          
175400     SET EP220-UNT-RTL-AMT-YES        TO TRUE.                            
175500     SET EP220-GP-PRIC-ID-YES         TO TRUE.                            
175600     SET EP220-GP-RTL-QTY-YES         TO TRUE.                            
175700     SET EP220-GP-RTL-AMT-YES         TO TRUE.                            
175800     SET EP220-LAST-NCLR-RTL-AMT-YES  TO TRUE.                            
175900     SET EP220-PRMPT-FOR-PRIC-IND-YES TO TRUE.                    17910005
176000     SET EP220-LOC-SKU-STAT-CDE-YES   TO TRUE.                            
176100     SET EP220-TKT-CLOR-CDE-YES       TO TRUE.                            
176200                                                                  17640001
176300     SET EP220-PRCHG-APL-TKT-CLR-CD-Y TO TRUE.                            
176400     SET EP220-LO-UNT-RTL-AMT-YES     TO TRUE.                            
176500     SET EP220-HGH-UNT-RTL-AMT-YES    TO TRUE.                            
176600     SET EP220-MLT-PRPT-IND-YES       TO TRUE.                    17640001
176700                                                                  17640001
176800     MOVE PC-NULLS           TO EP220-LO-UNT-RTL-AMT-NUL                  
176900                                EP220-HGH-UNT-RTL-AMT-NUL.                
177000                                                                  17640001
177100     MOVE PC-NULLS           TO EP220-EXCL-MDSE-IND                       
177200                                EP220-N-RCPT-RT-UNT-RTL-AMT-NL.           
177300                                                                          
177400     MOVE 'N'                TO EP220-PERM-PRCHG-DIRN-CDE                 
177500                                EP220-MLT-PRPT-IND.                       
177600                                                                          
177700     IF PV-DB2-SKU-NBR = ZERO                                     12250006
177800        MOVE PC-NULLS          TO EP220-SKU-NBR-NUL               17780006
177900     ELSE                                                         17780006
178000        MOVE PV-DB2-SKU-NBR    TO EP220-SKU-NBR                   17040006
178100     END-IF.                                                      17780006
178200     IF  PV-DB2-DEPT      = ZEROS                                         
178300        MOVE PC-NULLS           TO EP220-DEPT-NBR-NUL                     
178400     ELSE                                                                 
178500        MOVE PV-DB2-DEPT        TO EP220-DEPT-NBR                 01870005
178600     END-IF.                                                              
178700     IF  PV-DB2-MAJ-CL    = ZEROS                                         
178800        MOVE PC-NULLS           TO EP220-MAJ-CL-NBR-NUL                   
178900     ELSE                                                                 
179000        MOVE PV-DB2-MAJ-CL      TO EP220-MAJ-CL-NBR               01870005
179100     END-IF.                                                              
179200     IF  PV-DB2-SUB-CL    = ZEROS                                         
179300        MOVE PC-NULLS           TO EP220-SUB-CL-NBR-NUL                   
179400     ELSE                                                                 
179500        MOVE PV-DB2-SUB-CL      TO EP220-SUB-CL-NBR               01870005
179600     END-IF.                                                              
179700     IF  PV-DB2-STYLE     = ZEROS                                         
179800        MOVE PC-NULLS           TO EP220-STYL-ID-NUL                      
179900     ELSE                                                                 
180000        MOVE PV-DB2-STYLE       TO EP220-STYL-ID                  01870005
180100     END-IF.                                                              
180200                                                                          
180300*7300-EXIT.                                                       15550004
180400                                                                  15560001
180500*--------------------------------------------------------------*  15570001
180600* 7400-FORMAT-SQL-DEL.                                         *  15580004
180700*    SETUP DATA FOR DELETE RECORDS                             *  15590006
180800*--------------------------------------------------------------*  15600001
180900 7400-FORMAT-SQL-DEL.                                             15610004
181000                                                                  15620001
181100     SET EP220-RECORD-DELETE  TO TRUE.                            15630005
181200     MOVE 01000               TO EP220-STR-GRP-TYP-CDE.           15640005
181300     MOVE 00001               TO EP220-STR-GRP-ID.                15650005
181400     MOVE CC-EPCC112-TOMORROW-DATE TO                             15660005
181500             EP220-PRICG-EFFECT-DTE                               15670005
181600             EP220-PRIC-EFF-TMST.                                 15680005
181700                                                                          
181800     MOVE PC-3CLOCK            TO EP220-PRIC-EFF-TMST(11:9).              
181900     SET EP220-PRIC-EFF-TMST-YES   TO TRUE.                               
182000                                                                          
182100     MOVE PC-19-ZEROS  TO EP220-LAST-PRCHG-TMST.                          
182200                                                                          
182300     MOVE  PC-COLON     TO EP220-LAST-PRCHG-TMST(14:1)                    
182400                           EP220-LAST-PRCHG-TMST(17:1).                   
182500                                                                          
182600     SET EP220-LAST-PRCHG-TMST-YES TO TRUE.                               
182700                                                                          
182800*    ** OVERRIDE IMPUT VALUES WITH SELECTED VALUES FOR STYLE **           
182900     IF EP135-MDSE-HIER-CDE = 'STY'                                       
183000        MOVE XST00013-DEPT-NBR      TO EP220-DEPT-NBR             15690005
183100        MOVE XST00013-MAJ-CL-NBR    TO EP220-MAJ-CL-NBR           15700005
183200        MOVE XST00013-SUB-CL-NBR    TO EP220-SUB-CL-NBR           15710005
183300     END-IF.                                                              
183400                                                                          
183500     MOVE PC-ACTIVE-STAT   TO EP220-LOC-SKU-STAT-CDE.             15750005
183600     MOVE ZEROS            TO EP220-UNT-RTL-AMT.                  15770005
183700     MOVE PC-NULLS         TO EP220-GP-RTL-QTY-NUL                15780005
183800                               EP220-GP-RTL-AMT-NUL               15790005
183900                               EP220-GP-PRIC-ID-NUL               15810005
184000                               EP220-LAST-NCLR-RTL-AMT-NUL.               
184100                                                                          
184200     MOVE PC-ALL-COLORS    TO EP220-PRCHG-APLBL-TKT-CLOR-CDE.             
184300                                                                          
184400     MOVE EP135-MDSE-HIER-CDE      TO EP220-MDSE-HIER-CDE.                
184500     SET EP220-MDSE-HIER-CDE-YES   TO TRUE.                               
184600     MOVE PC-NULLS                 TO EP220-TKT-CLOR-CDE.                 
184700     MOVE 'N'                      TO EP220-PRMPT-FOR-PRIC-IND.           
184800                                                                          
184900                                                                          
185000*7400-EXIT.                                                       15850004
185100                                                                  15860001
185200*--------------------------------------------------------------*  15870001
185300* 7500-FORMAT-SQL-ADD.                                         *  15880004
185400*    FINISH SETTING UP ADD RECORD DATA                         *  15890004
185500*--------------------------------------------------------------*  15900001
185600 7500-FORMAT-SQL-ADD.                                             15910004
185700                                                                  15920001
185800     SET EP220-RECORD-ADD         TO TRUE.                        15930005
185900                                                                  15920001
186000     MOVE XST00064-STR-GP-TYP-CDE TO EP220-STR-GRP-TYP-CDE.       15940005
186100     MOVE XST00064-STR-GP-ID      TO EP220-STR-GRP-ID.            15950005
186200                                                                          
186300     MOVE XST00064-PRCHG-EFF-DTE  TO EP220-PRICG-EFFECT-DTE.      15960005
186400     MOVE XST00064-PRCHG-EFF-DTE  TO EP220-PRIC-EFF-TMST.         16030005
186500     MOVE PC-3CLOCK               TO EP220-PRIC-EFF-TMST(11:9).           
186600                                                                          
186700     SET EP220-PRIC-EFF-TMST-YES   TO TRUE.                               
186800                                                                          
186900     MOVE XST00065-LAST-UPD-TMST(1:10)                                    
187000                        TO EP220-LAST-PRCHG-TMST.                         
187100     MOVE  PC-COLON     TO EP220-LAST-PRCHG-TMST(14:1)                    
187200                           EP220-LAST-PRCHG-TMST(17:1).                   
187300                                                                          
187400     MOVE XST00065-LAST-UPD-TMST(12:2) TO                                 
187500                       EP220-LAST-PRCHG-TMST(12:2).                       
187600     MOVE XST00065-LAST-UPD-TMST(15:2) TO                                 
187700                       EP220-LAST-PRCHG-TMST(15:2).                       
187800     MOVE XST00065-LAST-UPD-TMST(18:2) TO                                 
187900                       EP220-LAST-PRCHG-TMST(18:2).                       
188000     SET EP220-LAST-PRCHG-TMST-YES TO TRUE.                               
188100                                                                          
188200     IF PV-NULL-UNIT-RTL < 0                                      16210015
188300         MOVE ZEROS               TO EP220-UNT-RTL-AMT            16220006
188400     ELSE                                                         16230015
188500        MOVE XST00065-UNT-RTL-AMT TO EP220-UNT-RTL-AMT            16040005
188600     END-IF.                                                      16230015
188700                                                                          
188800     MOVE XST00065-MDSE-HIER-CDE   TO EP220-MDSE-HIER-CDE.                
188900     SET EP220-MDSE-HIER-CDE-YES   TO TRUE.                               
189000                                                                          
189100     IF PV-NULL-GP-PRIC-ID  < 0                                   17770006
189200        MOVE PC-NULLS             TO EP220-GP-PRIC-ID-NUL                 
189300                                     EP220-GP-RTL-QTY-NUL                 
189400                                     EP220-GP-RTL-AMT-NUL                 
189500     ELSE                                                                 
189600        MOVE XST00065-GP-PRIC-ID   TO EP220-GP-PRIC-ID               17840
189700        IF PV-NULL-GP-RTL-QTY  < 0                                        
189800           MOVE PC-NULLS           TO EP220-GP-RTL-QTY-NUL                
189900        ELSE                                                              
190000           MOVE XST00065-GP-RTL-QTY  TO EP220-GP-RTL-QTY             17850
190100        END-IF                                                            
190200        IF PV-NULL-GP-RTL-AMT  < 0                                        
190300           MOVE PC-NULLS           TO EP220-GP-RTL-AMT-NUL                
190400        ELSE                                                              
190500           MOVE XST00065-GP-RTL-AMT TO EP220-GP-RTL-AMT              17860
190600        END-IF                                                            
190700     END-IF.                                                              
190800                                                                  16140006
190900     MOVE PC-ALL-COLORS   TO EP220-PRCHG-APLBL-TKT-CLOR-CDE.      16140006
191000                                                                  16140006
191100     IF XST00063-PRCHG-TYP-CDE =  'CLR'  OR                       16160015
191200        XST00063-PRCHG-TYP-CDE =  'RCP'  OR                       16160015
191300        XST00063-PRCHG-TYP-CDE =  'MK2'  OR                       16160015
191400        XST00063-PRCHG-TYP-CDE =  'FNL'                           16160015
191500                                                                  16160015
191600*       ** CHANGE FROM ACTIVE TO CLEARANCE               **               
191700*       ** OR YELLOW TO YELLOW FOR MARKDOWN OPTIMIZATION **               
191800                                                                  16160015
191900        IF PV-NON-CL-RTL-PRC = ZEROS                                      
192000           MOVE PC-NULLS     TO EP220-LAST-NCLR-RTL-AMT-NUL               
192100        ELSE                                                              
192200           MOVE PV-NON-CL-RTL-PRC                                 17530005
192300                             TO EP220-LAST-NCLR-RTL-AMT           17530005
192400        END-IF                                                            
192500                                                                  16160015
192600        MOVE PC-CLEARANCE-STAT    TO EP220-LOC-SKU-STAT-CDE       16200006
192700        MOVE 'N'                  TO EP220-PRMPT-FOR-PRIC-IND             
192800        MOVE PC-TCKT-CLR-YELLOW   TO EP220-TKT-CLOR-CDE                   
192900                                                                          
193000     ELSE                                                         16270006
193100********** CHANGE TO, OR REMAINING, ACTIVE **************                 
193200        IF PV-NULL-UNIT-RTL < 0                                           
193300            MOVE PC-NULLS    TO EP220-LAST-NCLR-RTL-AMT-NUL               
193400        ELSE                                                              
193500           MOVE XST00065-UNT-RTL-AMT                              18040006
193600                              TO EP220-LAST-NCLR-RTL-AMT          18040006
193700        END-IF                                                            
193800                                                                  16330006
193900        MOVE PC-ACTIVE-STAT      TO EP220-LOC-SKU-STAT-CDE        18030006
194000        MOVE 'Y'                 TO EP220-PRMPT-FOR-PRIC-IND              
194100        MOVE PC-TCKT-CLR-WHITE   TO EP220-TKT-CLOR-CDE                    
194200                                                                  16330006
194300     END-IF.                                                      16330006
194301                                                                          
194302*7500-EXIT.                                                       16370004
194303                                                                  16380001
194304*--------------------------------------------------------------*  16390006
194305* 7600-READ-INPUT-LIST.                                           16400006
194306*     READ INPUT LIST OF FPLU HEIRARCHY CHANGES (FROM SEVERAL     16410006
194307*     SOURCES) - MAY BE SKU LEVEL OR ABOVE DATA.                  16420006
194308*--------------------------------------------------------------*  16430006
194309 7600-READ-INPUT-LIST.                                            16440006
194310                                                                  16450006
194311     READ FPLU-HEIR-LIST INTO EP135-FPLU-HIER-RECORD              16460006
194312       AT END                                                     16470006
194313          SET PS-END-OF-FPLU-INPUT TO TRUE.                       16480006
194314                                                                  16490006
194315     IF PS-NOT-END-OF-FPLU-INPUT                                  16500006
194316       MOVE EP135-DEPT-NBR     TO PV-DB2-DEPT                     01870005
194317       MOVE EP135-MAJ-CLASS    TO PV-DB2-MAJ-CL                   01870005
194318       MOVE EP135-SUB-CLASS    TO PV-DB2-SUB-CL                   01870005
194319       MOVE EP135-VENDOR-STYLE TO PV-DB2-STYLE                    01870005
194320       MOVE EP135-SKU-NBR      TO PV-DB2-SKU-NBR                  16530006
194321       ADD 1                   TO PV-INPUT-RECORDS                16540006
194322     END-IF.                                                      16550006
194323                                                                  16560006
194324*7600-EXIT.                                                       16570006
194325                                                                  16580006
194340*--------------------------------------------------------------*  16590001
194341* 8100-WRITE-FPLU-SQLSVR-DEL-REC.                                 16600001
194342*--------------------------------------------------------------*  16610001
194343 8100-WRITE-FPLU-SQLSVR-DEL-REC.                                  16620001
194344                                                                  16630001
194345     MOVE '8100-WRITE-FPLU-SQLSVR-DEL-REC'   TO PV-PARAGRAPH-NAME.16640001
194346                                                                  16650001
194347     WRITE FPLU-SQLDEL-RECORD FROM EP220-XST-SKU-PRICG-RECORD.    16660005
194348                                                                  16690001
194349     ADD 1 TO PV-CNT-OUTPUT-RECORDS.                              16700005
194350     ADD 1 TO PV-CNT-SQLOUTDEL-RECORDS.                           16710005
194351                                                                  16720001
194352*8100-EXIT.                                                       16730001
194353                                                                  16740001
194368*--------------------------------------------------------------*  16750001
194369* 8600-WRT-FPLU-SQLADD-REC.                                       16760001
194370*--------------------------------------------------------------*  16770001
194371 8600-WRT-FPLU-SQLADD-REC.                                        16780001
194372                                                                  16790001
194373     MOVE '8600-WRT-FPLU-SQLADD-REC'                              16800001
194374                                    TO PV-PARAGRAPH-NAME.         16810001
194375                                                                  16810001
194376     WRITE FPLU-SQLADD-RECORD FROM EP220-XST-SKU-PRICG-RECORD.    16660005
194377                                                                  16840001
194378     ADD 1 TO PV-CNT-OUTPUT-RECORDS.                              16850005
194379     ADD 1 TO PV-CNT-SQLOUTADD-RECORDS.                           16860005
194380                                                                  16870001
194381*8600-EXIT.                                                       16880001
194382                                                                  11910016
194383*--------------------------------------------------------------*  11920016
194384* 9000-SELECT-SKU-ATTR.                                        *  11930016
194385*--------------------------------------------------------------*  11940016
194386 9000-SELECT-SKU-ATTR.                                            11950016
194387                                                                          
194388     MOVE '9000-SELECT-SKU-ATTR' TO PV-PARAGRAPH-NAME.            11960016
194389                                                                  11970016
194390     PERFORM                                                      11980016
194391        WITH TEST AFTER                                           11990016
194392      VARYING PV-SQL-SUB                                          12000016
194393         FROM 1 BY 1                                              12010016
194394        UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                  12020016
194395                    OR  SQLCODE = 0                               12030016
194396                    OR  SQLCODE = +100)                           12040016
194397         EXEC SQL                                                 12050016
194398              SELECT  A.INTR_UPC_ID                               12060016
194399                     ,PLU_DWNLD_EXCL_IND                          12070016
194400                     ,LAST_NCLR_RTL_AMT                           12080016
194401                INTO  :XST00010-INTR-UPC-ID                       12090016
194402                     ,:XST00011-PLU-DWNLD-EXCL-IND                12100016
194403                     ,:XST00011-LAST-NCLR-RTL-AMT                 12110016
194404                            :PV-NULL-NCLR-RTL-AMT                 12120016
194405                FROM  XST_SKU       S                             12130016
194406                     ,XST_SKU_ATTR  A                             12140016
194407               WHERE S.SKU_NBR     = :XST00010-SKU-NBR            12150016
194408                 AND A.INTR_UPC_ID =  S.INTR_UPC_ID               12160016
194409                WITH UR                                           12170016
194410         END-EXEC                                                 12180016
194411                                                                  12190016
194412         EVALUATE TRUE                                            12200016
194413             WHEN SQLCODE = -911                                  12210016
194414             WHEN SQLCODE = -913                                  12220016
194415                  CONTINUE                                        12230016
194416             WHEN SQLCODE = 0                                     12240016
194417                  SET PS-SKU-OK  TO TRUE                          01580006
194418                  MOVE XST00010-SKU-NBR TO PV-DB2-SKU-NBR                 
194419                  IF PV-NULL-NCLR-RTL-AMT < 0                     16210015
194420                     MOVE ZEROES TO XST00011-LAST-NCLR-RTL-AMT    16240006
194421                  END-IF                                          16260015
194422             WHEN SQLCODE = +100                                  12270016
194423                  SET PS-SKU-NOT-OK TO TRUE                       01590006
194424                  DISPLAY '*** SKU ATTR NOT FOUND FOR SKU '       12280016
194425                          XST00010-SKU-NBR                        12290016
194426                  ADD 1       TO PV-MISSING-SKU-COUNT             12300016
194427                  MOVE ZEROES TO XST00011-LAST-NCLR-RTL-AMT       12310016
194428             WHEN OTHER                                           12360016
194429                  MOVE 'ERROR ON SKU ATTR SELECT ' TO             12370016
194430                       PV-DB2-OPERATION                           12380016
194431                  PERFORM 9900-SQL-ABEND-ROUTINE                  12390016
194432         END-EVALUATE                                             12400016
194433     END-PERFORM.                                                 12410016
194434                                                                          
194435     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12420016
194436        MOVE '9000-SELECT-SKU-ATTR' TO  PV-PARAGRAPH-NAME         12430016
194437        MOVE 'SELECT SKU ATTR RETRIES EXCEEDED' TO                12440016
194438             PV-DB2-OPERATION                                     12450016
194439        PERFORM 9900-SQL-ABEND-ROUTINE                            12460016
194440     END-IF.                                                      12470016
194441                                                                  12480016
194442*9000-EXIT.                                                       12490016
194443                                                                  08340001
194444*--------------------------------------------------------------*  07610006
194445* 9100-SELECT-STYLE.                                           *  07620006
194446*      THIS PROCESS SELECTS HIERARCHY FIELD FOR A STYLE.  THE  *  07630006
194447*  HIERARCHY INPUT FILE AND XST_PRCHG_MDSE TABLE DO NOT HAVE   *  07640006
194448*  THES VALUES POPULATED, BUT THEY ARE NEEDED IN THE OUTPUT.   *  07640006
194449*--------------------------------------------------------------*  07660006
194450 9100-SELECT-STYLE.                                               07670006
194460                                                                  07700006
194470     MOVE '9100-SELECT-STYLE ' TO PV-PARAGRAPH-NAME.              07840004
194480                                                                  07850001
194490     PERFORM                                                      07860004
194500        WITH TEST AFTER                                           07870004
194600        VARYING PV-SQL-SUB                                        07880004
194700           FROM 1 BY 1                                            07890004
194800        UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                  07900004
194900                    OR  SQLCODE = 0                               07910004
195000                    OR  SQLCODE = +100)                           07920004
195100        EXEC SQL                                                  07930004
195200             SELECT  DEPT_NBR                                     07940004
195300                    ,MAJ_CL_NBR                                   07950004
195400                    ,SUB_CL_NBR                                   07950004
195500               INTO  :XST00013-DEPT-NBR                           07960005
195600                    ,:XST00013-MAJ-CL-NBR                         07970005
195700                    ,:XST00013-SUB-CL-NBR                         07970005
195800               FROM  XST_VND_STYL                                 07990004
195900              WHERE  STYL_ID  = :XST00013-STYL-ID                 08000004
196000               WITH UR                                            08010004
196100        END-EXEC                                                  08020004
196200                                                                  08030004
196300        EVALUATE TRUE                                             08040004
196400           WHEN SQLCODE = -911                                    08050004
196500           WHEN SQLCODE = -913                                    08060004
196600                CONTINUE                                          08070004
196700           WHEN SQLCODE = 0                                       08080004
196800                SET PS-STYLE-OK     TO TRUE                               
196900           WHEN SQLCODE = +100                                    08110004
197000                DISPLAY '*** VENDOR STYLE NOT FOUND FOR '         08120005
197100                        XST00013-STYL-ID                          08130005
197200                ADD 1               TO PV-MISSING-STYLE-COUNT     08140005
197300                SET PS-STYLE-NOT-OK TO TRUE                               
197400           WHEN OTHER                                             08200004
197500                MOVE 'ERROR ON VND STYL SELECT ' TO               08210004
197600                     PV-DB2-OPERATION                             08220004
197700                PERFORM 9900-SQL-ABEND-ROUTINE                    08230004
197800        END-EVALUATE                                              08240004
197900     END-PERFORM.                                                 08250004
198000                                                                          
198100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08260004
198200        MOVE '9100-SELECT-STYLE'       TO PV-PARAGRAPH-NAME       08270004
198300        MOVE 'SELECT RETRIES EXCEEDED' TO PV-DB2-OPERATION        08280004
198400        PERFORM 9900-SQL-ABEND-ROUTINE                            08300004
198500     END-IF.                                                      08310004
198600                                                                  08320001
198601*9100-EXIT.                                                       07780006
198602                                                                  16890001
198603*--------------------------------------------------------------*  16900001
198604* 9900-SQL-ABEND-ROUTINE.                                         16910001
198605*     SQL ABEND ROUTINE.                                          16920001
198606*--------------------------------------------------------------*  16930001
198607 9900-SQL-ABEND-ROUTINE.                                          16940001
198608     DISPLAY '** ABEND     **'.                                   16950001
198609     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                16960001
198610     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              16970001
198611     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               16980001
198612                                                                  16990001
198613     COPY DPPD004.                                                17000001
198614     SET ABEND-4013-DB2-ERROR TO TRUE.                            17010001
198615     CALL 'ILBOABN0' USING ABEND-CODE.                            17020001
198616                                                                  17030001
198617*9900-EXIT.                                                       17040001
198618                                                                  17050001
198619*--------------------------------------------------------------*  17060001
198620* 9999-WRAPUP.                                                    17070001
198621*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      17080001
198622*     ANY DATA COUNTS FROM THE PROGRAM.                           17090001
198623*--------------------------------------------------------------*  17100001
198624 9999-WRAPUP.                                                     17110001
198625     CLOSE CC-PREV-NEXT-NEW-DAY,                                  17120005
198626           CC-PRIOR-OPEN,                                         17130005
198627           CC-TODAY,                                              17140005
198628           CC-TOMORROW,                                           17150005
198629           FPLU-HEIR-LIST,                                        17160005
198632           FPLU-SQLADD-FILE,                                      17180005
198633           FPLU-SQLDEL-FILE.                                      17180005
198634                                                                  17190001
198635     DISPLAY ' '.                                                 17200001
198636     DISPLAY '*************************************************'. 17210005
198637     DISPLAY ' '.                                                 17220001
198638     DISPLAY 'NUMBER OF FPLU HEIR INPUT RECORDS:       '          17230006
198639              PV-INPUT-RECORDS.                                   17240006
198640     DISPLAY 'NUMBER OF ZERO SKU/INTR UPC ID BYPASSED: '          17250001
198641              PV-BYPASS-SKU-COUNT.                                17260001
198642     DISPLAY 'NUMBER OF EXCLUDED SKUS ENCOUNTERED:     '          17270001
198643              PV-EXCLUDE-SKU-COUNT.                               17280001
198644     DISPLAY 'NUMBER OF MISSING SKU ENCOUNTERED:       '          17290001
198645              PV-MISSING-SKU-COUNT.                               17300001
198646                                                                          
198647     IF PV-MISSING-SKU-COUNT > 0                                          
198648        DISPLAY ' '                                               17360001
198649        DISPLAY  '*>*>*> SKU MESSAGE TRIGGER >*>*>*'              17630001
198650        MOVE 04        TO RETURN-CODE                                     
198660     END-IF.                                                              
198670                                                                          
198680     DISPLAY 'NUMBER OF MISSING STYLES ENCOUNTERED:    '          17290001
198690              PV-MISSING-STYLE-COUNT.                             08140005
198700                                                                          
198800     IF PV-MISSING-STYLE-COUNT > 0                                        
198900        DISPLAY ' '                                               17360001
199000        DISPLAY  '*>*>*>*> STYLE MESSAGE TRIGGER >*>*>*'          17630001
199100        MOVE 04        TO RETURN-CODE                                     
199200     END-IF.                                                              
199201                                                                          
199202     COMPUTE PV-FOUND-SKU-COUNT = PV-INPUT-RECORDS -              17310005
199203         PV-EXCLUDE-SKU-COUNT -                                   17320005
199204         PV-BYPASS-SKU-COUNT -  PV-MISSING-SKU-COUNT.             17330005
199205     DISPLAY '      NUMBER OF XS SKU RECORDS FOUND:    '          17340005
199206              PV-FOUND-SKU-COUNT.                                 17350005
199207     DISPLAY ' '.                                                 17360001
199208     DISPLAY 'NUMBER OF ALL FUTURE PERM PRCHG FETCHES: '          17370003
199209              PV-FUTURE-PERM-COUNT.                               17380001
199210     DISPLAY ' '.                                                 17510001
199211     DISPLAY PC-TEN-BLANKS,                                       17390005
199212             'FUTURE PERM OLD FETCHES:      '                     17400003
199213              PV-OLD-FETCHES.                                     17410001
199214     DISPLAY PC-TEN-BLANKS,                                       17390005
199215             PC-TEN-BLANKS,                                       17390005
199216             'FUTURE PERM OLD SKU FETCHES:    '                   17400003
199217              PV-OLD-SKU-FETCHES.                                 17410001
199218     DISPLAY PC-TEN-BLANKS,                                       17390005
199219             PC-TEN-BLANKS,                                       17390005
199220             'FUTURE PERM OLD STYLE FETCHES:  '                   17400003
199221              PV-OLD-STY-FETCHES.                                 17410001
199222     DISPLAY PC-TEN-BLANKS,                                       17390005
199223             PC-TEN-BLANKS,                                       17390005
199224             'FUTURE PERM OLD DEPT FETCHES:   '                   17400003
199225              PV-OLD-DPT-FETCHES.                                 17410001
199226     DISPLAY PC-TEN-BLANKS,                                       17390005
199227             PC-TEN-BLANKS,                                       17390005
199228             'FUTURE PERM OLD MAJ CL FETCHES: '                   17400003
199229              PV-OLD-MCL-FETCHES.                                 17410001
199230     DISPLAY PC-TEN-BLANKS,                                       17390005
199231             PC-TEN-BLANKS,                                       17390005
199232             'FUTURE PERM OLD SUB CL FETCHES: '                   17400003
199233              PV-OLD-SCL-FETCHES.                                 17410001
199234     DISPLAY ' '.                                                 17510001
199235     DISPLAY PC-TEN-BLANKS,                                       17420005
199236             'FUTURE PERM OLD STR FETCH:    '                     17430003
199237              PV-OLD-STR-FETCHES.                                 17440001
199238     DISPLAY PC-TEN-BLANKS,                                       17390005
199239             PC-TEN-BLANKS,                                       17390005
199240             'FUTURE PERM OLD SKU STR FETCHES:    '               17400003
199241              PV-OLD-SKU-STR-FETCHES.                             17410001
199242     DISPLAY PC-TEN-BLANKS,                                       17390005
199243             PC-TEN-BLANKS,                                       17390005
199244             'FUTURE PERM OLD STYLE STR FETCHES:  '               17400003
199245              PV-OLD-STY-STR-FETCHES.                             17410001
199246     DISPLAY PC-TEN-BLANKS,                                       17390005
199247             PC-TEN-BLANKS,                                       17390005
199248             'FUTURE PERM OLD DEPT STR FETCHES:   '               17400003
199249              PV-OLD-DPT-STR-FETCHES.                             17410001
199250     DISPLAY PC-TEN-BLANKS,                                       17390005
199251             PC-TEN-BLANKS,                                       17390005
199252             'FUTURE PERM OLD MAJ CL STR FETCHES: '               17400003
199253              PV-OLD-MCL-STR-FETCHES.                             17410001
199254     DISPLAY PC-TEN-BLANKS,                                       17390005
199255             PC-TEN-BLANKS,                                       17390005
199256             'FUTURE PERM OLD SUB CL STR FETCHES: '               17400003
199257              PV-OLD-SCL-STR-FETCHES.                             17410001
199258     DISPLAY ' '.                                                 17510001
199259     DISPLAY PC-TEN-BLANKS,                                       17450015
199260             'FUTURE PERM NEW FETCHES:      '                     17460015
199261              PV-NEW-FETCHES.                                     17470015
199262     DISPLAY PC-TEN-BLANKS,                                       17480015
199263             'FUTURE PERM NEW STR FETCH:    '                     17490015
199264              PV-NEW-STR-FETCHES.                                 17500015
199265     DISPLAY ' '.                                                 17510001
199266     DISPLAY 'NUMBER OF TOTAL OUTPUT RECORDS WRITTEN:  '          17520005
199267              PV-CNT-OUTPUT-RECORDS, ' *'.                        17530005
199280     DISPLAY PC-TEN-BLANKS,                                       17540005
199290             '** DEL EP220 RECORDS WRITTEN: '                     17550005
199300              PV-CNT-SQLOUTDEL-RECORDS,                           17560005
199301             ' - DD OUT01'.                                       17570001
199302     DISPLAY PC-TEN-BLANKS,                                       17580005
199303             '** ADD EP220 RECORDS WRITTEN: '                     17590005
199304              PV-CNT-SQLOUTADD-RECORDS,                           17600005
199305             ' - DD OUT02'.                                       17610001
199307                                                                          
199314     DISPLAY ' '.                                                 17620001
199315     DISPLAY '*********************************************'.     17630001
199316     DISPLAY '   PROGRAM NAME: ' PC-PROGRAM-NAME, ' END'.         17640005
199317     DISPLAY  PC-ASTERISK-LINE.                                   17650005
199318                                                                  17660005
199319*9999-EXIT.                                                       17670005
