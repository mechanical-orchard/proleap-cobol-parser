000100 IDENTIFICATION DIVISION.                                         00010013
000200 PROGRAM-ID.         SVKUT026.                                    00020013
000300 AUTHOR.             SUSAN COONEY.                                00030013
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040013
000500 DATE-WRITTEN.       MARCH 1998.                                  00050013
000600 DATE-COMPILED.                                                   00060013
000700                                                                  00070013
000800******************************************************************00080013
000900* THIS PROGRAM WILL PULL INFORMATION FROM THE ACTIVITY FILE      *00090013
001000* FOR EACH CARD ON THE STOCK FILE THAT HAS ACTIVITY BETWEEN THE  *00100013
001100* REQUEST DATE RANGE.  IF THE CARD ON THE STOCK FILE DOES NOT    *00110013
001200* HAVE ACTIVITY WITHIN THE DATE RANGE, THE CARD NUMBER WILL NOT  *00120013
001300* BE WRITTEN TO THE OUTPUT FILE.                                 *00130013
001400******************************************************************00140013
001500******************************************************************00150013
001600* HISTORY LOG:                                                   *00160013
001700* 02/01/99  WR6041 TKMA348                                       *00170013
001800*           CHANGED CODE TO MAKE CALENDAR ROUTINE CALLS COMPLIANT*00180013
001900*           TO KOHLS STANDARDS.                                  *00190013
002000*                                                                *00200013
002100* 02/11/00  WR5220 DAVID COLOMBO - COMPUWARE                     *00210013
002200*           CHANGED TKMCACT-CSR TO NOT INCLUDE THE FEE ACTIVITY  *00220013
002300*           (ACTIVITY TYPE CODE 4).                              *00230013
002400*                                                                *00240013
002500* 05/14/01  WR#     GREGORY SHEFF                                *00250013
002600*           ADDED HISTORY TKMCHAC-CSR AND TKMCHTB EXTRACT FILE   *00260013
002700*                                                                *00270013
002800* 09/19/01  ARCHIVE PROJECT - GREG SHEFF                         *00280013
002900*           ALSO RETRIEVE DATA FROM HISTORY TABLE TKMCHAC        *00290013
003000*                                                                *00300013
003100* 10/19/01  ARCHIVE PROJECT - GREG SHEFF                         *00310013
003200*           Added 'WITH UR' to TSV009, TKMCHAC CURSOR declare    *00320013
003300*                                                                *00330013
003400* 03/31/02  MULTI-CHANNEL GIFT CARD PROJECT - BARB ERTL          *00340013
003500*           RENAMED FROM RDKUT013.                               *00350013
003600*           REWRITE WITH BMC EXTRACT FILES AS INPUT.             *00360013
003610*                                                                *00370013
003620* 06/08/09  PROJECT 2317 - GIFT CARD NUMBERING TO 30 DIGITS.     *00380013
003630*           WR# 29062.                                            00390013
003640*           RECOMPILE TO PICK UP CHANGES IN SVWS004.             *00400013
003610*                                                                *00410013
003620* 10/08/12  INCIDENT 2376618                                     *00420013
003630*           CRQ: 34587                                            00430013
003640*           Coded for the Incomm Store (676) to not count         00440013
      *           deactivations (Rev Code: 0 Auth Amt: negative).  This 00450013
      *           was counting them as add ons.                         00460013
      *           Incomm currently is the only one that does deacts.    00470013
      *  transaction   rev cde    void ind    auth amt                  00480013
      *  ACTIVATION      0           N          POSITIVE                00490013
      *  DEACTIVATION    0           Y          NEGATIVE                00500013
      *  REVERSAL        1           Y          NEGATIVE                00510013
      *  DEACT/REVER     1           Y          POSITIVE                00520013
c95927*                                                                *00530013
c95927*  10/23/14 CRQ: CHG0095927                                      *00540013
c95927*           MODIFIED TO PROCESS BOTH MONTHLY AND ANNUAL DATA IN  *00550013
c95927*           SINGLE STEP. EXTRACT AND STOCK FILES WILL BE READ    *00560013
c95927*           ONCE AND OUTPUT WILL VARY BASED ON TIMESTAMP.        *00570013
003700******************************************************************00580013
003800                                                                  00590013
003900 ENVIRONMENT DIVISION.                                            00600013
004000                                                                  00610013
004100 CONFIGURATION SECTION.                                           00620013
004200                                                                  00630013
004300 SOURCE-COMPUTER.    IBM-3090.                                    00640013
004400 OBJECT-COMPUTER.    IBM-3090.                                    00650013
004500                                                                  00660013
004600 INPUT-OUTPUT SECTION.                                            00670013
004700                                                                  00680013
004800 FILE-CONTROL.                                                    00690013
004900                                                                  00700013
c95927     SELECT CONTROL-DATE-FILE-MON     ASSIGN TO INP01.            00710013
005100     SELECT EXTRACT-FILE              ASSIGN TO INP02.            00720013
005200     SELECT STOCK-FILE                ASSIGN TO INP03.            00730013
c95927     SELECT CONTROL-DATE-FILE-YRD     ASSIGN TO INP04.            00740013
c95927     SELECT UPDATED-CARD-FILE-MON     ASSIGN TO OUT01.            00750013
c95927     SELECT UPDATED-CARD-FILE-YRD     ASSIGN TO OUT02.            00760013
005400                                                                  00770013
005500 DATA DIVISION.                                                   00780013
005600                                                                  00790013
005700 FILE SECTION.                                                    00800013
005800                                                                  00810013
c95927 FD  CONTROL-DATE-FILE-MON                                        00820013
006000     RECORDING MODE IS F                                          00830013
006100     BLOCK CONTAINS 0 RECORDS                                     00840013
006200     LABEL RECORDS ARE OMITTED.                                   00850013
c95927 01  CONTROL-DATE-RECORD-MON          PIC X(80).                  00860013
006400                                                                  00870013
006500 FD  EXTRACT-FILE                                                 00880013
006600     RECORDING MODE IS F                                          00890013
006700     BLOCK CONTAINS 0 RECORDS                                     00900013
006800     LABEL RECORDS ARE OMITTED.                                   00910013
006900 01  EXTRACT-FILE-RECORD              PIC X(69).                  00920013
007000                                                                  00930013
007100 FD  STOCK-FILE                                                   00940013
007200     RECORDING MODE IS F                                          00950013
007300     BLOCK CONTAINS 0 RECORDS                                     00960013
007400     LABEL RECORDS ARE OMITTED.                                   00970013
007500 01  STOCK-FILE-RECORD                PIC X(47).                  00980013
007600                                                                  00990013
c95927 FD  CONTROL-DATE-FILE-YRD                                        01000013
c95927     RECORDING MODE IS F                                          01010013
c95927     BLOCK CONTAINS 0 RECORDS                                     01020013
c95927     LABEL RECORDS ARE OMITTED.                                   01030013
c95927 01  CONTROL-DATE-RECORD-YRD          PIC X(80).                  01040013
c95927                                                                  01050013
c95927 FD  UPDATED-CARD-FILE-MON                                        01060013
007800     RECORDING MODE IS F                                          01070013
007900     BLOCK CONTAINS 0 RECORDS                                     01080013
008000     LABEL RECORDS ARE OMITTED.                                   01090013
c95927 01  UPDATED-CARD-FILE-RECORD-MON     PIC X(53).                  01100013
008200                                                                  01110013
c95927 FD  UPDATED-CARD-FILE-YRD                                        01120013
c95927     RECORDING MODE IS F                                          01130013
c95927     BLOCK CONTAINS 0 RECORDS                                     01140013
c95927     LABEL RECORDS ARE OMITTED.                                   01150013
c95927 01  UPDATED-CARD-FILE-RECORD-YRD     PIC X(53).                  01160013
c95927                                                                  01170013
008300 WORKING-STORAGE SECTION.                                         01180013
008400                                                                  01190013
008500 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.01200013
008600     88  ABEND-CONTROL-ERROR-4003                   VALUE +4003.  01210013
008700     88  ABEND-DATA-ERROR-4008                      VALUE +4008.  01220013
008800     88  ABEND-CALENDAR-ERROR-4019                  VALUE +4019.  01230013
008900                                                                  01240013
009000******************************************************************01250013
009100*    CR-CONTROL RECORD     FORMAT: CCYY-MM-DDCCYY-MM-DD         * 01260013
c95927*    CCYY-MM-DD = STARTING DATE OF THE DATE RANGE FOR YEAR       *01270013
c95927*    CCYY-MM-DD = ENDING DATE OF THE DATE RANGE FOR YEAR         *01280013
009400******************************************************************01290013
c95927 01  CR-CONTROL-RECORD-YRD.                                       01300013
009600     05  FILLER                       PIC X.                      01310013
c95927     05  CR-CONTROL-BEG-DATE-YRD      PIC X(10).                  01320013
c95927     05  CR-CONTROL-BEG-DATE-YUNFMT REDEFINES                     01330013
c95927                                       CR-CONTROL-BEG-DATE-YRD.   01340013
c95927         10  CR-BEG-CC-YRD            PIC  X(02).                 01350013
c95927         10  CR-BEG-YY-YRD            PIC  X(02).                 01360013
010000         10  FILLER                   PIC  X(01).                 01370013
c95927         10  CR-BEG-MM-YRD            PIC  X(02).                 01380013
010200         10  FILLER                   PIC  X(01).                 01390013
c95927         10  CR-BEG-DD-YRD            PIC  X(02).                 01400013
c95927     05  CR-CONTROL-END-DATE-YRD      PIC X(10).                  01410013
c95927     05  CR-CONTROL-END-DATE-YUNFMT REDEFINES                     01420013
c95927                                       CR-CONTROL-END-DATE-YRD.   01430013
c95927         10  CR-END-CC-YRD            PIC  X(02).                 01440013
c95927         10  CR-END-YY-YRD            PIC  X(02).                 01450013
010700         10  FILLER                   PIC  X(01).                 01460013
c95927         10  CR-END-MM-YRD            PIC  X(02).                 01470013
010900         10  FILLER                   PIC  X(01).                 01480013
c95927         10  CR-END-DD-YRD            PIC  X(02).                 01490013
011100     05  FILLER                       PIC  X(59).                 01500013
011200                                                                  01510013
c95927******************************************************************01520013
c95927*    CR-CONTROL RECORD     FORMAT: CCYY-MM-DDCCYY-MM-DD         * 01530013
c95927*    CCYY-MM-DD = STARTING DATE OF THE DATE RANGE FOR MONTH      *01540013
c95927*    CCYY-MM-DD = ENDING DATE OF THE DATE RANGE FOR MONTH        *01550013
c95927******************************************************************01560013
c95927 01  CR-CONTROL-RECORD-MON.                                       01570013
c95927     05  FILLER                       PIC X.                      01580013
c95927     05  CR-CONTROL-BEG-DATE-MON      PIC X(10).                  01590013
c95927     05  CR-CONTROL-BEG-DATE-MUNFMT REDEFINES                     01600013
c95927                                       CR-CONTROL-BEG-DATE-MON.   01610013
c95927         10  CR-BEG-CC-MON            PIC  X(02).                 01620013
c95927         10  CR-BEG-YY-MON            PIC  X(02).                 01630013
c95927         10  FILLER                   PIC  X(01).                 01640013
c95927         10  CR-BEG-MM-MON            PIC  X(02).                 01650013
c95927         10  FILLER                   PIC  X(01).                 01660013
c95927         10  CR-BEG-DD-MON            PIC  X(02).                 01670013
c95927     05  CR-CONTROL-END-DATE-MON      PIC X(10).                  01680013
c95927     05  CR-CONTROL-END-DATE-MUNFMT REDEFINES                     01690013
c95927                                       CR-CONTROL-END-DATE-MON.   01700013
c95927         10  CR-END-CC-MON            PIC  X(02).                 01710013
c95927         10  CR-END-YY-MON            PIC  X(02).                 01720013
c95927         10  FILLER                   PIC  X(01).                 01730013
c95927         10  CR-END-MM-MON            PIC  X(02).                 01740013
c95927         10  FILLER                   PIC  X(01).                 01750013
c95927         10  CR-END-DD-MON            PIC  X(02).                 01760013
c95927     05  FILLER                       PIC  X(59).                 01770013
c95927                                                                  01780013
011300******************************************************************01790013
011400*    PC-PROGRAM CONSTANTS                                        *01800013
011500******************************************************************01810013
011600 01  PC-PROGRAM-CONSTANTS.                                        01820013
011700     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        01830013
011800                                                    'SVKUT026'.   01840013
011900     05  PC-ONE                       PIC  S9(2)     VALUE +1     01850013
011900                                                     COMP.        01860013
011900                                                                  01870013
012000******************************************************************01880013
012100*       PROGRAM VARIABLES                                        *01890013
012200******************************************************************01900013
012300 01  PV-PROGRAM-VARIABLES.                                        01910013
012400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01920013
012500     05  PV-OPERATION-MSG-1           PIC  X(40)     VALUE SPACE. 01930013
012600     05  PV-OPERATION-MSG-2           PIC  X(40)     VALUE SPACE. 01940013
012600     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01950013
c95927     05  PV-START-RANGE-TIMESTAMP-DETY.                           01960013
c95927         10  PV-START-RANGE-DATE-YRD  PIC  X(10).                 01970013
012900         10  FILLER                   PIC  X(01)     VALUE '-'.   01980013
013000         10  PV-START-RANGE-HH        PIC  X(02)     VALUE '03'.  01990013
013100         10  FILLER                   PIC  X(01)     VALUE '.'.   02000013
013200         10  PV-START-RANGE-MN        PIC  X(02)     VALUE '00'.  02010013
013300         10  FILLER                   PIC  X(01)     VALUE '.'.   02020013
013400         10  PV-START-RANGE-SS        PIC  X(02)     VALUE '00'.  02030013
013500         10  FILLER                   PIC  X(01)     VALUE '.'.   02040013
013600         10  PV-START-RANGE-TTTTTT    PIC  X(06)     VALUE        02050013
013700                                                     '000000'.    02060013
013800                                                                  02070013
c95927     05  PV-START-RANGE-TIMESTAMP-YRD REDEFINES                   02080013
c95927           PV-START-RANGE-TIMESTAMP-DETY                          02090013
014100                                      PIC  X(26).                 02100013
c95927                                                                  02110013
c95927     05  PV-START-RANGE-TIMESTAMP-DETM.                           02120013
c95927         10  PV-START-RANGE-DATE-MON  PIC  X(10).                 02130013
c95927         10  FILLER                   PIC  X(01)     VALUE '-'.   02140013
c95927         10  PV-START-RANGE-HH        PIC  X(02)     VALUE '03'.  02150013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02160013
c95927         10  PV-START-RANGE-MN        PIC  X(02)     VALUE '00'.  02170013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02180013
c95927         10  PV-START-RANGE-SS        PIC  X(02)     VALUE '00'.  02190013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02200013
c95927         10  PV-START-RANGE-TTTTTT    PIC  X(06)     VALUE        02210013
c95927                                                     '000000'.    02220013
c95927                                                                  02230013
c95927     05  PV-START-RANGE-TIMESTAMP-MON REDEFINES                   02240013
c95927           PV-START-RANGE-TIMESTAMP-DETM                          02250013
014100                                      PIC  X(26).                 02260013
014200                                                                  02270013
c95927     05  PV-END-RANGE-TIMESTAMP-DETY.                             02280013
c95927         10  PV-END-RANGE-DATE-YRD    PIC  X(10).                 02290013
014500         10  FILLER                   PIC  X(01)     VALUE '-'.   02300013
014600         10  PV-END-RANGE-HH          PIC  X(02)     VALUE '02'.  02310013
014700         10  FILLER                   PIC  X(01)     VALUE '.'.   02320013
014800         10  PV-END-RANGE-MN          PIC  X(02)     VALUE '59'.  02330013
014900         10  FILLER                   PIC  X(01)     VALUE '.'.   02340013
015000         10  PV-END-RANGE-SS          PIC  X(02)     VALUE '59'.  02350013
015100         10  FILLER                   PIC  X(01)     VALUE '.'.   02360013
015200         10  PV-END-RANGE-TTTTTT      PIC  X(06)     VALUE        02370013
015300                                                     '999999'.    02380013
015400                                                                  02390013
c95927     05  PV-END-RANGE-TIMESTAMP-YRD REDEFINES                     02400013
c95927           PV-END-RANGE-TIMESTAMP-DETY                            02410013
015700                                      PIC  X(26).                 02420013
c95927     05  PV-END-RANGE-TIMESTAMP-DETM.                             02430013
c95927         10  PV-END-RANGE-DATE-MON    PIC  X(10).                 02440013
c95927         10  FILLER                   PIC  X(01)     VALUE '-'.   02450013
c95927         10  PV-END-RANGE-HH          PIC  X(02)     VALUE '02'.  02460013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02470013
c95927         10  PV-END-RANGE-MN          PIC  X(02)     VALUE '59'.  02480013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02490013
c95927         10  PV-END-RANGE-SS          PIC  X(02)     VALUE '59'.  02500013
c95927         10  FILLER                   PIC  X(01)     VALUE '.'.   02510013
c95927         10  PV-END-RANGE-TTTTTT      PIC  X(06)     VALUE        02520013
c95927                                                     '999999'.    02530013
c95927                                                                  02540013
c95927     05  PV-END-RANGE-TIMESTAMP-MON REDEFINES                     02550013
c95927           PV-END-RANGE-TIMESTAMP-DETM                            02560013
c95927                                      PIC  X(26).                 02570013
015800     05  PV-TRN-PSTD-TMST.                                        02580013
015900         10  PV-TRN-PSTD-DATE         PIC  X(10).                 02590013
016000         10  FILLER                   PIC  X(16).                 02600013
016100                                                                  02610013
016200     05  PV-SAVE-CRD-NBR              PIC  9(12)      VALUE 0.    02620013
016300     05  PV-ISSUE-COUNT               PIC S9(03)      VALUE +0.   02630013
           05  PV-APP-AUTH-AMT              PIC  S9(07)V9(02) COMP-3    02640013
                                                        VALUE ZEROES.   02650013
c95927     05  PV-STORE-SUB-Y               PIC  9(04)  VALUE 0 COMP.   02660013
c95927     05  PV-STORE-SUB-M               PIC  9(04)  VALUE 0 COMP.   02670013
016300     05  PV-NUM-OF-STORES             PIC  9(04)  VALUE ZEROES.   02680013
016400                                                                  02690013
016500******************************************************************02700013
016600*    PS-PROGRAM SWITCHES                                         *02710013
016700******************************************************************02720013
016800 01  PS-PROGRAM-SWITCHES.                                         02730013
c95927     05  PS-END-OF-CONTROL-YRFILE-SW  PIC  X(01)     VALUE 'N'.   02740013
c95927         88  PS-END-OF-CONTROL-FILE-YRD              VALUE 'Y'.   02750013
c95927     05  PS-END-OF-CONTROL-MNFILE-SW  PIC  X(01)     VALUE 'N'.   02760013
c95927         88  PS-END-OF-CONTROL-FILE-MON              VALUE 'Y'.   02770013
017100     05  PS-END-OF-EXTRACT-FILE-SW    PIC  X(01)     VALUE 'N'.   02780013
017200         88  PS-END-OF-EXTRACT-FILE                  VALUE 'Y'.   02790013
017300     05  PS-END-OF-STOCK-FILE-SW      PIC  X(01)     VALUE 'N'.   02800013
017400         88  PS-END-OF-STOCK-FILE                    VALUE 'Y'.   02810013
017500     05  PS-STOCK-FOUND-SW            PIC  X(01)     VALUE 'N'.   02820013
017600         88  PS-STOCK-FOUND                          VALUE 'Y'.   02830013
017700         88  PS-STOCK-NOT-FOUND                      VALUE 'N'.   02840013
017800     05  PS-END-OF-STORE-CSR-SW       PIC  X(01)     VALUE 'N'.   02850013
017800         88  PS-END-OF-STORE-CSR                     VALUE 'Y'.   02860013
017800                                                                  02870013
017900******************************************************************02880013
018000*    PA-PROGRAM ACCUMULATORS                                     *02890013
018100******************************************************************02900013
018200 01  PA-PROGRAM-ACCUMULATORS.                                     02910013
c95927     05  PA-NUM-OF-RECORDS-WRITTEN-YRD PIC 9(9).                  02920013
c95927     05  PA-NUM-OF-RECORDS-WRITTEN-MON PIC 9(9).                  02930013
c95927     05  PA-STORE-TABLE-YRD.                                      02940013
c95927         10  PA-STORE-ENTRY-YRD          OCCURS 9999 TIMES.       02950013
c95927             15  PA-STORE-NUM-Y   PIC S9(04)     COMP.            02960013
c95927             15  PA-STORE-NAME-Y  PIC  X(10).                     02970013
c95927             15  PA-E-BUS-IND-Y   PIC  X(01).                     02980013
c95927                                                                  02990013
c95927     05  PA-STORE-TABLE-MON.                                      03000013
c95927         10  PA-STORE-ENTRY-MON          OCCURS 9999 TIMES.       03010013
c95927             15  PA-STORE-NUM-M   PIC S9(04)     COMP.            03020013
c95927             15  PA-STORE-NAME-M  PIC  X(10).                     03030013
c95927             15  PA-E-BUS-IND-M   PIC  X(01).                     03040013
c95927                                                                  03050013
018400******************************************************************03060013
018400*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *03070013
018400******************************************************************03080013
018400     EXEC SQL                                                     03090013
018400         INCLUDE SQLCA                                            03100013
018400     END-EXEC.                                                    03110013
018400                                                                  03120013
018400     COPY SQLCA2.                                                 03130013
018400                                                                  03140013
018400******************************************************************03150013
018400*      KOHL'S DOMAIN LOCATION TABLE                             * 03160013
018400******************************************************************03170013
018400     EXEC SQL                                                     03180013
018400         INCLUDE XST00001                                         03190013
018400     END-EXEC.                                                    03200013
018400                                                                  03210013
028200*                                                                 03220013
018500******************************************************************03230013
018600*    STOCK RECORD                                                *03240013
018700******************************************************************03250013
018800     COPY SVRD013.                                                03260013
018900                                                                  03270013
019000******************************************************************03280013
019100*    EXTRACT RECORD                                              *03290013
019200******************************************************************03300013
019300     COPY SVRD009.                                                03310013
019400                                                                  03320013
019500******************************************************************03330013
019600*    OUTPUT RECORD                                               *03340013
019700******************************************************************03350013
019800     COPY SVRD010.                                                03360013
019900                                                                  03370013
020000******************************************************************03380013
020100*    STORED VALUE CARD CONSTANTS                                 *03390013
020200******************************************************************03400013
020300     COPY SVWS004.                                                03410013
020400                                                                  03420013
020500******************************************************************03430013
020600*    DATE ROUTINE COPY MEMBERS                                   *03440013
020700******************************************************************03450013
020800     COPY DPWS500.                                                03460013
020900                                                                  03470013
020900******************************************************************03480013
020900*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *03490013
020900******************************************************************03500013
020900     COPY DPWS004.                                                03510013
020900                                                                  03520013
020900******************************************************************03530013
020900*    CURSOR TO ACCESS STORES                                     *03540013
020900******************************************************************03550013
020900     EXEC SQL                                                     03560013
020900       DECLARE XST00001-CSR CURSOR FOR                            03570013
020900           SELECT LOC_NBR,                                        03580013
c95927                  COALESCE(E_BUS_IND, 'N'),                       03590013
c95927                  CLO_DTE,                                        03600013
c95927                  OPN_DTE                                         03610013
020900             FROM XST_LOC                                         03620013
020900            WHERE LOC_TYP_CDE IN ('DS','SV','HQ')                 03630013
c95927              AND CLO_DTE >= :CR-CONTROL-BEG-DATE-YRD             03640013
c95927              AND OPN_DTE <= :CR-CONTROL-END-DATE-YRD             03650013
020900           ORDER BY LOC_NBR                                       03660013
020900           WITH UR                                                03670013
020900     END-EXEC.                                                    03680013
020900                                                                  03690013
021000 PROCEDURE DIVISION.                                              03700013
021100                                                                  03710013
021200 0000-MAINLINE.                                                   03720013
021300                                                                  03730013
021400     PERFORM 1000-INITIALIZE.                                     03740013
021500                                                                  03750013
021600     PERFORM 2000-PROCESS-EXTRACT-RECORD                          03760013
021700         UNTIL PS-END-OF-EXTRACT-FILE.                            03770013
021800                                                                  03780013
021900     PERFORM 9000-EOJ-ROUTINE.                                    03790013
022000                                                                  03800013
022100     GOBACK.                                                      03810013
022200                                                                  03820013
022300*0000-EXIT.                                                       03830013
022400                                                                  03840013
022500******************************************************************03850013
022600*     1000-INITIALIZE                                            *03860013
022700* ==> PROCESSES:                                                 *03870013
022800* ==> PERFORMED FROM:  0000-MAINLINE                             *03880013
022900******************************************************************03890013
023000 1000-INITIALIZE.                                                 03900013
023100                                                                  03910013
c95927     OPEN INPUT  CONTROL-DATE-FILE-MON                            03920013
023300                 EXTRACT-FILE                                     03930013
023400                 STOCK-FILE                                       03940013
c95927                 CONTROL-DATE-FILE-YRD                            03950013
c95927          OUTPUT UPDATED-CARD-FILE-MON                            03960013
c95927                 UPDATED-CARD-FILE-YRD.                           03970013
c95927                                                                  03980013
c95927* READ DATE CONTROL CARDs                                         03990013
c95927     PERFORM 5100-READ-DATE-FILE.                                 04000013
c95927                                                                  04010013
029600*LOAD STORE TABLE                                                 04020013
029600     EXEC SQL                                                     04030013
029600       OPEN XST00001-CSR                                          04040013
029600     END-EXEC.                                                    04050013
029600     EVALUATE TRUE                                                04060013
029600       WHEN SQLCODE NOT = 0                                       04070013
029600         DISPLAY ' '                                              04080013
029600         DISPLAY '** ABEND     **'                                04090013
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04100013
029600         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             04110013
029600         DISPLAY '** OPEN CURSOR TO XST00001 TABLE'               04120013
029600         PERFORM Z900-SQL-ABEND                                   04130013
029600     END-EVALUATE.                                                04140013
029600                                                                  04150013
c95927     INITIALIZE PA-STORE-TABLE-YRD                                04160013
c95927                PA-STORE-TABLE-MON.                               04170013
029600                                                                  04180013
029600     PERFORM 1100-FETCH-XST00001-CSR.                             04190013
029600                                                                  04200013
029600     PERFORM 1200-LOAD-STORE-TABLE                                04210013
029600       UNTIL PS-END-OF-STORE-CSR.                                 04220013
029600                                                                  04230013
029600     EXEC SQL                                                     04240013
029600       CLOSE XST00001-CSR                                         04250013
029600     END-EXEC.                                                    04260013
029600     EVALUATE TRUE                                                04270013
029600        WHEN SQLCODE NOT = 0                                      04280013
029600         DISPLAY ' '                                              04290013
029600         DISPLAY '** ABEND     **'                                04300013
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04310013
029900         DISPLAY '** PARAGRAPH **  = 1000-initialize '            04320013
029900         DISPLAY '** CLOSE CURSOR TO XST00001 TABLE'              04330013
029900         PERFORM Z900-SQL-ABEND                                   04340013
029900     END-EVALUATE.                                                04350013
029900                                                                  04360013
029700     PERFORM 4000-READ-EXTRACT.                                   04370013
029800     INITIALIZE SV013-STOCK-RECORD.                               04380013
029900                                                                  04390013
030000*1000-EXIT.                                                       04400013
029900                                                                  04410013
030100******************************************************************04420013
030100* ==> PROCESSES:  FETCH THE STORE NUMBERS AND DESCRIPTION.       *04430013
030100******************************************************************04440013
030100 1100-FETCH-XST00001-CSR.                                         04450013
030100                                                                  04460013
030100     EXEC SQL                                                     04470013
030100       FETCH XST00001-CSR                                         04480013
030100         INTO  :XST00001-LOC-NBR,                                 04490013
c95927               :XST00001-E-BUS-IND,                               04500013
c95927               :XST00001-CLO-DTE,                                 04510013
c95927               :XST00001-OPN-DTE                                  04520013
030100     END-EXEC.                                                    04530013
030100                                                                  04540013
030100     EVALUATE TRUE                                                04550013
030100        WHEN SQLCODE = +0                                         04560013
030100            CONTINUE                                              04570013
030100        WHEN SQLCODE = +100                                       04580013
030100           SET PS-END-OF-STORE-CSR TO TRUE                        04590013
030100        WHEN OTHER                                                04600013
030100         DISPLAY ' '                                              04610013
030100         DISPLAY '** ABEND     **'                                04620013
030100         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04630013
030100         DISPLAY '** PARAGRAPH **  = 1100-FETCH-XST000010-CSR'    04640013
030100         DISPLAY '** FETCHING STORE INFORMATION'                  04650013
030100         PERFORM Z900-SQL-ABEND                                   04660013
030100     END-EVALUATE.                                                04670013
030100                                                                  04680013
029900******************************************************************04690013
c95927* PROCESSES:  LOADS THE STORE NUMBERS AND DESCRIPTION FOR YEARLY *04700013
029900******************************************************************04710013
029900 1200-LOAD-STORE-TABLE.                                           04720013
029900                                                                  04730013
c95927     MOVE XST00001-LOC-NBR    TO PV-STORE-SUB-Y.                  04740013
c95927     MOVE XST00001-LOC-NBR    TO PA-STORE-NUM-Y(PV-STORE-SUB-Y).  04750013
c95927     MOVE XST00001-E-BUS-IND  TO PA-E-BUS-IND-Y(PV-STORE-SUB-Y).  04760013
030100                                                                  04770013
030100     ADD PC-ONE TO PV-NUM-OF-STORES.                              04780013
c95927     PERFORM 1300-LOAD-STORE-MONTHLY-TABLE.                       04790013
030100                                                                  04800013
030100     PERFORM 1100-FETCH-XST00001-CSR.                             04810013
030100                                                                  04820013
c95927******************************************************************04830013
c95927* PROCESSES:  LOADS THE STORE NUMBERS AND DESCRIPTION FOR MONTH  *04840013
c95927******************************************************************04850013
c95927 1300-LOAD-STORE-MONTHLY-TABLE.                                   04860013
c95927                                                                  04870013
c95927     IF XST00001-CLO-DTE >= CR-CONTROL-BEG-DATE-MON AND           04880013
c95927        XST00001-OPN-DTE <= CR-CONTROL-END-DATE-MON               04890013
c95927        MOVE XST00001-LOC-NBR    TO PV-STORE-SUB-M                04900013
c95927        MOVE XST00001-LOC-NBR    TO PA-STORE-NUM-M(PV-STORE-SUB-M)04910013
c95927        MOVE XST00001-E-BUS-IND  TO PA-E-BUS-IND-M(PV-STORE-SUB-M)04920013
c95927     END-IF.                                                      04930013
030100                                                                  04940013
030200******************************************************************04950013
030300*     2000-PROCESS-EXTRACT-RECORD                                *04960013
030400* ==> PROCESSES:                                                 *04970013
030500* ==> PERFORMED FROM:  0000-MAINLINE                             *04980013
030600******************************************************************04990013
030700 2000-PROCESS-EXTRACT-RECORD.                                     05000013
030800                                                                  05010013
030900     PERFORM 6000-CONVERT-TRN-PSTD-TMST.                          05020013
                                                                        05030013
c95927     IF ((SV009-TRN-AUTH-TMST >= PV-START-RANGE-TIMESTAMP-YRD     05040013
c95927        AND SV009-TRN-AUTH-TMST <= PV-END-RANGE-TIMESTAMP-YRD)    05050013
c95927         OR (PA-E-BUS-IND-Y(SV009-STR-NBR) = 'Y' AND              05060013
031200*        OR ((SV009-STR-NBR = 809 OR                              05070013
031200*             SV009-STR-NBR = 819 OR                              05080013
031200*             SV009-STR-NBR = 873) AND                            05090013
c95927            (PV-TRN-PSTD-DATE >= PV-START-RANGE-DATE-YRD AND      05100013
c95927             PV-TRN-PSTD-DATE < PV-END-RANGE-DATE-YRD)))          05110013
031500        AND SV009-ACTVY-TYP-CDE NOT = SV004-SRV-FEE-ACT-TYP-N     05120013
031600         IF SV009-CRD-NBR = SV013-CRD-NBR                         05130013
031700            MOVE SV013-CRD-TYP-CDE    TO SV010-CRD-TYP-CDE        05140013
031800            MOVE SV013-CRD-STK-TYP-ID TO SV010-CRD-STK-TYP-ID     05150013
031900            MOVE SV013-CRD-STK-TYP-DESC                           05160013
032000                                      TO SV010-CRD-STK-TYP-DESC   05170013
032100         ELSE                                                     05180013
032200             SET PS-STOCK-NOT-FOUND TO TRUE                       05190013
032300             PERFORM 5000-READ-STOCK                              05200013
032400                 UNTIL PS-STOCK-FOUND                             05210013
032500                    OR PS-END-OF-STOCK-FILE                       05220013
032600             IF PS-STOCK-FOUND                                    05230013
032700                MOVE SV013-CRD-TYP-CDE    TO SV010-CRD-TYP-CDE    05240013
032800                MOVE SV013-CRD-STK-TYP-ID TO SV010-CRD-STK-TYP-ID 05250013
032900                MOVE SV013-CRD-STK-TYP-DESC                       05260013
033000                                       TO SV010-CRD-STK-TYP-DESC  05270013
033100             ELSE                                                 05280013
033200                 MOVE '2000-PROCESS-EXTRACT' TO PV-PARAGRAPH-NAME 05290013
033300                 MOVE 'GET STOCK TYPE ' TO PV-OPERATION-MSG-1     05300013
033400                 DISPLAY 'CARD NUMBER IS ' SV009-CRD-NBR          05310013
033500                 SET ABEND-DATA-ERROR-4008 TO TRUE                05320013
033600                 PERFORM 9999-ABEND                               05330013
033700             END-IF                                               05340013
033800         END-IF                                                   05350013
                                                                        05360013
033900         MOVE SV009-CRD-NBR           TO SV010-CRD-NBR            05370013
034000                                         PV-SAVE-CRD-NBR          05380013
033900         MOVE SV009-APP-AUTH-AMT    TO PV-APP-AUTH-AMT            05390013
034100         MOVE SV009-STR-NBR           TO SV010-STR-NBR            05400013
034200         MOVE SV009-ACTVY-TYP-CDE     TO SV010-ACTVY-TYP-CDE      05410013
034300         IF SV009-ACTVY-TYP-CDE = 1 OR 2                          05420013
034400             MOVE PV-ISSUE-COUNT TO SV010-ADDON-COUNTER           05430013
034500         ELSE                                                     05440013
034600             MOVE ZERO TO SV010-ADDON-COUNTER                     05450013
034700         END-IF                                                   05460013
034800         MOVE SV009-TRN-RVRSL-CDE     TO SV010-TRN-RVRSL-CDE      05470013
034900         MOVE SV009-APP-AUTH-AMT      TO SV010-APP-AUTH-AMT       05480013
035000         MOVE SV009-ACTVY-STAT-CDE    TO SV010-ACTVY-STAT-CDE     05490013
c95927         PERFORM 5500-WRITE-PROCESS                               05500013
035400     END-IF.                                                      05510013
035500                                                                  05520013
035600     MOVE SV009-CRD-NBR               TO PV-SAVE-CRD-NBR.         05530013
033900     MOVE SV009-APP-AUTH-AMT          TO PV-APP-AUTH-AMT.         05540013
                                                                        05550013
035700     PERFORM 4000-READ-EXTRACT.                                   05560013
035800                                                                  05570013
035900*2000-EXIT.                                                       05580013
036000******************************************************************05590013
036100*     4000-READ-EXTRACT                                          *05600013
036200* ==> PROCESSES:                                                 *05610013
036300*     - READS EXTRACT                                            *05620013
036400* ==> PERFORMED FROM:  2000-PROCESS-EXTRACT-RECORD               *05630013
036500******************************************************************05640013
036600 4000-READ-EXTRACT.                                               05650013
036700     READ EXTRACT-FILE INTO SV009-RECORD                          05660013
036800       AT END                                                     05670013
036900         SET PS-END-OF-EXTRACT-FILE TO TRUE.                      05680013
037000                                                                  05690013
037100     IF SV009-CRD-NBR NOT EQUAL PV-SAVE-CRD-NBR                   05700013
037200        MOVE +0 TO PV-ISSUE-COUNT                                 05710013
037300     END-IF.                                                      05720013
037400                                                                  05730013
037500     IF SV009-CRD-NBR = PV-SAVE-CRD-NBR                           05740013
037600        IF (SV009-ACTVY-TYP-CDE = 1 OR 2)                         05750013
                 IF (SV009-STR-NBR = SV004-INCOMM-LOCATION)             05760013
                    IF ((SV009-TRN-RVRSL-CDE = 0) AND                   05770013
                        (SV009-APP-AUTH-AMT > 0) AND                    05780013
                        (PV-APP-AUTH-AMT > 0))                          05790013
037700                 ADD +1 TO PV-ISSUE-COUNT                         05800013
                    END-IF                                              05810013
                 ELSE                                                   05820013
037700              ADD +1 TO PV-ISSUE-COUNT                            05830013
                 END-IF                                                 05840013
037800        END-IF                                                    05850013
037900     END-IF.                                                      05860013
038000                                                                  05870013
038100*4000-EXIT.                                                       05880013
038200******************************************************************05890013
038300*     5000-READ-STOCK                                            *05900013
038400* ==> PROCESSES:                                                 *05910013
038500*     - READS STOCK FILE                                         *05920013
038600* ==> PERFORMED FROM:  2000-PROCESS-EXTRACT-RECORD               *05930013
038700******************************************************************05940013
038800 5000-READ-STOCK.                                                 05950013
038900     READ STOCK-FILE INTO SV013-STOCK-RECORD                      05960013
039000       AT END                                                     05970013
039100         SET PS-END-OF-STOCK-FILE TO TRUE                         05980013
039200       NOT AT END                                                 05990013
039300         IF SV009-CRD-NBR = SV013-CRD-NBR                         06000013
039400             SET PS-STOCK-FOUND TO TRUE                           06010013
039500         END-IF.                                                  06020013
039600*5000-EXIT.                                                       06030013
039700                                                                  06040013
c95927******************************************************************06050013
c95927*     5100-READ-DATE-FILE                                        *06060013
c95927* ==> PROCESSES:                                                 *06070013
c95927*     - READS BOTH MONTHLY AND YEARLY DATE FILES                 *06080013
c95927* ==> PERFORMED FROM:  1000-INITIALIZE                           *06090013
c95927******************************************************************06100013
c95927 5100-READ-DATE-FILE.                                             06110013
c95927     READ CONTROL-DATE-FILE-YRD INTO CR-CONTROL-RECORD-YRD        06120013
c95927       AT END                                                     06130013
c95927         SET PS-END-OF-CONTROL-FILE-YRD TO TRUE.                  06140013
c95927                                                                  06150013
c95927     IF PS-END-OF-CONTROL-FILE-YRD                                06160013
c95927       DISPLAY ' '                                                06170013
c95927       DISPLAY '** ABEND     **'                                  06180013
c95927       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06190013
c95927       DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE  '         06200013
c95927       DISPLAY '** CONTROL YEARLY DATE FILE IS EMPTY  '           06210013
c95927       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       06220013
c95927       PERFORM 9999-ABEND                                         06230013
c95927     ELSE                                                         06240013
c95927       MOVE CR-CONTROL-BEG-DATE-YRD TO PV-START-RANGE-DATE-YRD    06250013
c95927       MOVE CR-CONTROL-END-DATE-YRD TO PV-END-RANGE-DATE-YRD      06260013
c95927       DISPLAY ' '                                                06270013
c95927       DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                 06280013
c95927               CR-CONTROL-BEG-DATE-YRD ' TO '                     06290013
c95927               CR-CONTROL-END-DATE-YRD                            06300013
c95927     END-IF.                                                      06310013
c95927* READ MONTHLY DATE CONTROL CARD                                  06320013
c95927     READ CONTROL-DATE-FILE-MON INTO CR-CONTROL-RECORD-MON        06330013
c95927       AT END                                                     06340013
c95927         SET PS-END-OF-CONTROL-FILE-MON TO TRUE.                  06350013
c95927                                                                  06360013
c95927     IF PS-END-OF-CONTROL-FILE-MON                                06370013
c95927       DISPLAY ' '                                                06380013
c95927       DISPLAY '** ABEND     **'                                  06390013
c95927       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06400013
c95927       DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE  '         06410013
c95927       DISPLAY '** CONTROL MONTHLY DATE FILE IS EMPTY  '          06420013
c95927       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       06430013
c95927       PERFORM 9999-ABEND                                         06440013
c95927     ELSE                                                         06450013
c95927       MOVE CR-CONTROL-BEG-DATE-MON TO PV-START-RANGE-DATE-MON    06460013
c95927       MOVE CR-CONTROL-END-DATE-MON TO PV-END-RANGE-DATE-MON      06470013
c95927       DISPLAY ' '                                                06480013
c95927       DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                 06490013
c95927               CR-CONTROL-BEG-DATE-MON ' TO '                     06500013
c95927               CR-CONTROL-END-DATE-MON                            06510013
c95927     END-IF.                                                      06520013
c95927                                                                  06530013
c95927** VERIFY THE BEGINNING AND ENDING CONTROL YEAR DATES ARE VALID **06540013
c95927     INITIALIZE DPG51 DPG52 DPG53                                 06550013
c95927                DPG54 DPG55 DPG56.                                06560013
c95927                                                                  06570013
c95927     SET DPG51-ACTUAL-CALENDAR-ONLY                               06580013
c95927                                   TO TRUE.                       06590013
c95927     MOVE CR-CONTROL-BEG-DATE-YRD  TO DPG52-LK-DATE-INPUT.        06600013
c95927     MOVE CR-CONTROL-END-DATE-YRD  TO DPG53-LK-CMPR-DATE-INPUT.   06610013
c95927     SET DPG52-LK-DTE-ISO-FMT      TO TRUE                        06620013
c95927     SET DPG53-LK-CMPR-DTE-ISO-FMT TO TRUE                        06630013
c95927                                                                  06640013
c95927     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06650013
c95927                                             DPG54 DPG55 DPG56.   06660013
c95927     EVALUATE TRUE                                                06670013
c95927       WHEN DPG54-SEVERE-ERROR                                    06680013
c95927       WHEN DPG54-DATE-INVALID                                    06690013
c95927         DISPLAY ' '                                              06700013
c95927         DISPLAY '** ABEND     **'                                06710013
c95927         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06720013
c95927         DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE'         06730013
c95927         DISPLAY '** BAD CALL TO CALENDAR MODULE '                06740013
c95927         DISPLAY '** DETERMINE VALID YEAR DATES **'               06750013
c95927         DISPLAY DPG54-ERROR-MESSAGE                              06760013
c95927         SET ABEND-CALENDAR-ERROR-4019 TO TRUE                    06770013
c95927         PERFORM 9999-ABEND                                       06780013
c95927     END-EVALUATE.                                                06790013
c95927                                                                  06800013
c95927** VERIFY THE BEGINNING DATE IS LESS THAN THE ENDING DATE **      06810013
c95927     IF DPG55-DAYS-DIFFERENCE > 0                                 06820013
c95927       DISPLAY ' '                                                06830013
c95927       DISPLAY '** ABEND     **'                                  06840013
c95927       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              06850013
c95927       DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE'           06860013
c95927       DISPLAY '** THE BEGINNING DATE CAN NOT BE '                06870013
c95927               'GREATER THAN THE ENDING DATE **'                  06880013
c95927       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       06890013
c95927       PERFORM 9999-ABEND                                         06900013
c95927     END-IF.                                                      06910013
c95927                                                                  06920013
c95927** VERIFY THE BEGINNING AND ENDING CONTROL MON DATES ARE VALID ** 06930013
c95927     INITIALIZE DPG51 DPG52 DPG53                                 06940013
c95927                DPG54 DPG55 DPG56.                                06950013
c95927                                                                  06960013
c95927     SET DPG51-ACTUAL-CALENDAR-ONLY                               06970013
c95927                                   TO TRUE.                       06980013
c95927     MOVE CR-CONTROL-BEG-DATE-MON  TO DPG52-LK-DATE-INPUT.        06990013
c95927     MOVE CR-CONTROL-END-DATE-MON  TO DPG53-LK-CMPR-DATE-INPUT.   07000013
c95927     SET DPG52-LK-DTE-ISO-FMT      TO TRUE                        07010013
c95927     SET DPG53-LK-CMPR-DTE-ISO-FMT TO TRUE                        07020013
c95927                                                                  07030013
c95927     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07040013
c95927                                             DPG54 DPG55 DPG56.   07050013
c95927     EVALUATE TRUE                                                07060013
c95927       WHEN DPG54-SEVERE-ERROR                                    07070013
c95927       WHEN DPG54-DATE-INVALID                                    07080013
c95927         DISPLAY ' '                                              07090013
c95927         DISPLAY '** ABEND     **'                                07100013
c95927         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07110013
c95927         DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE'         07120013
c95927         DISPLAY '** BAD CALL TO CALENDAR MODULE '                07130013
c95927         DISPLAY '** DETERMINE VALID MONTH DATES **'              07140013
c95927         DISPLAY DPG54-ERROR-MESSAGE                              07150013
c95927         SET ABEND-CALENDAR-ERROR-4019 TO TRUE                    07160013
c95927         PERFORM 9999-ABEND                                       07170013
c95927     END-EVALUATE.                                                07180013
c95927                                                                  07190013
c95927** VERIFY THE BEGINNING DATE IS LESS THAN THE ENDING DATE **      07200013
c95927     IF DPG55-DAYS-DIFFERENCE > 0                                 07210013
c95927       DISPLAY ' '                                                07220013
c95927       DISPLAY '** ABEND     **'                                  07230013
c95927       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              07240013
c95927       DISPLAY '** PARAGRAPH **  = 5100-READ-DATE-FILE'           07250013
c95927       DISPLAY '** THE BEGINNING DATE CAN NOT BE '                07260013
c95927               'GREATER THAN THE ENDING DATE **'                  07270013
c95927       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       07280013
c95927       PERFORM 9999-ABEND                                         07290013
c95927     END-IF.                                                      07300013
c95927                                                                  07310013
c95927******************************************************************07320013
c95927*     5500-WRITE-PROCESS                                          07330013
c95927* ==> PROCESS:                                                    07340013
c95927*     - CHECK FOR CONDITIONS TO WRITE MONTHLY FILE                07350013
c95927* ==> PERFORMED FROM: 2000-PROCESS-EXTRACT-RECORD                 07360013
c95927******************************************************************07370013
c95927 5500-WRITE-PROCESS.                                              07380013
c95927                                                                  07390013
c95927     IF ((SV009-TRN-AUTH-TMST >= PV-START-RANGE-TIMESTAMP-MON     07400013
c95927        AND SV009-TRN-AUTH-TMST <= PV-END-RANGE-TIMESTAMP-MON)    07410013
c95927         OR (PA-E-BUS-IND-M(SV009-STR-NBR) = 'Y' AND              07420013
c95927            (PV-TRN-PSTD-DATE >= PV-START-RANGE-DATE-MON AND      07430013
c95927             PV-TRN-PSTD-DATE < PV-END-RANGE-DATE-MON)))          07440013
c95927         WRITE UPDATED-CARD-FILE-RECORD-MON FROM                  07450013
c95927                                  SV010-RECORD                    07460013
c95927         ADD 1                  TO PA-NUM-OF-RECORDS-WRITTEN-MON  07470013
c95927     END-IF.                                                      07480013
c95927                                                                  07490013
c95927     WRITE UPDATED-CARD-FILE-RECORD-YRD FROM                      07500013
c95927                               SV010-RECORD                       07510013
c95927     ADD 1                  TO PA-NUM-OF-RECORDS-WRITTEN-YRD.     07520013
c95927                                                                  07530013
039800******************************************************************07540013
039900* 6000-CONVERT-TRN-PSTD-TMST                                     *07550013
040000* ==> PROCESSES:                                                 *07560013
040100*     - SUBSTRACT 1 FROM TRN-PSTD-TMST                           *07570013
040200* ==> PERFORMED FROM:  2000-PROCESS-EXTRACT-RECORD               *07580013
040300******************************************************************07590013
040400 6000-CONVERT-TRN-PSTD-TMST.                                      07600013
040500                                                                  07610013
040600     MOVE SV009-TRN-PSTD-TMST TO PV-TRN-PSTD-TMST.                07620013
040700     IF PV-TRN-PSTD-TMST = SV004-DEFAULT-TIMESTAMP                07630013
040800         CONTINUE                                                 07640013
040900     ELSE                                                         07650013
041000         INITIALIZE DPG51 DPG52 DPG53                             07660013
041100                    DPG54 DPG55 DPG56                             07670013
041200         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   07680013
041300         SET DPG51-DECREMENT-DATE    TO TRUE                      07690013
041400         MOVE 1      TO DPG51-INCR-DECR-DAYS-9                    07700013
041500         MOVE PV-TRN-PSTD-DATE       TO DPG52-LK-DATE-INPUT       07710013
041600         SET DPG52-LK-DTE-ISO-FMT    TO TRUE                      07720013
041700         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG5307730013
041800                                                 DPG54 DPG55 DPG5607740013
041900         EVALUATE TRUE                                            07750013
042000         WHEN DPG54-SEVERE-ERROR                                  07760013
042100         WHEN DPG54-DATE-INVALID                                  07770013
042200             DISPLAY ' '                                          07780013
042300             DISPLAY '** ABEND     **'                            07790013
042400             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        07800013
042500             DISPLAY '** PARAGRAPH **  = B125-DATE-CONVERSION'    07810013
042600             DISPLAY '** BAD CALL TO CALENDAR MODULE '            07820013
042700             DISPLAY '** DETERMINE VALID ENDING DATE **'          07830013
042800             DISPLAY DPG54-ERROR-MESSAGE                          07840013
042900             SET ABEND-CALENDAR-ERROR-4019 TO TRUE                07850013
043000             PERFORM 9999-ABEND                                   07860013
043100         END-EVALUATE                                             07870013
043200                                                                  07880013
043300         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-TRN-PSTD-DATE          07890013
043400     END-IF.                                                      07900013
043500******************************************************************07910013
043600*     9000-EOJ-ROUTINE                                           *07920013
043700* ==> PROCESSES:                                                 *07930013
043800*     - CLOSES THE CONTROL FILE, AND THE REPORT FILES            *07940013
043900* ==> PERFORMED FROM:  0000-MAINLINE                             *07950013
044000******************************************************************07960013
044100 9000-EOJ-ROUTINE.                                                07970013
044200                                                                  07980013
c95927     CLOSE CONTROL-DATE-FILE-MON                                  07990013
044400           EXTRACT-FILE                                           08000013
044500           STOCK-FILE                                             08010013
c95927           CONTROL-DATE-FILE-YRD                                  08020013
c95927           UPDATED-CARD-FILE-MON                                  08030013
c95927           UPDATED-CARD-FILE-YRD.                                 08040013
044700                                                                  08050013
044800     DISPLAY ' '.                                                 08060013
044900     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME              08070013
c95927     DISPLAY 'NUMBER OF MONTHLY UPDATED RECORDS WRITTEN:   '      08080013
c95927         PA-NUM-OF-RECORDS-WRITTEN-MON.                           08090013
c95927     DISPLAY 'NUMBER OF YEARLY UPDATED RECORDS WRITTEN:   '       08100013
c95927         PA-NUM-OF-RECORDS-WRITTEN-YRD.                           08110013
045200                                                                  08120013
045300*9000-EXIT.                                                       08130013
045400******************************************************************08140013
045500* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           08150013
045600******************************************************************08160013
045700 9999-ABEND.                                                      08170013
045800     DISPLAY '** ABEND           **'.                             08180013
045900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          08190013
046000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08200013
046100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08210013
046200     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08220013
046300     CALL 'ILBOABN0' USING ABEND-CODE.                            08230013
045200******************************************************************08240013
045200*     Z900-SQL-ABEND                                             *08250013
045200* ==> PROCESSES:                                                 *08260013
045200*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *08270013
045200* ==> PERFORMED FROM:                                            *08280013
045200*                      E200-WRITE-DETAIL-LINE-KMRC               *08290013
045200*                      E500-WRITE-DETAIL-LINE-GIFT               *08300013
045200******************************************************************08310013
045200 Z900-SQL-ABEND.                                                  08320013
045200                                                                  08330013
045200     DISPLAY ' '.                                                 08340013
045200     DISPLAY 'Z900-SQL-ABEND'.                                    08350013
045200     DISPLAY '**  ABEND     **'.                                  08360013
045200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               08370013
045200     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             08380013
045200     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    08390013
045200                                                                  08400013
045200******************************************************************08410013
045200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *08420013
045200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *08430013
045200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *08440013
045200* FORMAT.                                                        *08450013
045200******************************************************************08460013
045200     COPY DPPD004.                                                08470013
045200                                                                  08480013
045200     MOVE +4013 TO ABEND-CODE.                                    08490013
045200     CALL 'ILBOABN0' USING ABEND-CODE.                            08500013
045200                                                                  08510013
