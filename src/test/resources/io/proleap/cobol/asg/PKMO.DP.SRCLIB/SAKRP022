000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SAKRP022.                                00050000
000600 AUTHOR.                 JIM HUNTER.                              00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            AUGUST, 2023.                            00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200* * * *>>>   THIS PROGRAM WAS COPIED FROM SAKRP017     <<<* * * * 00120000
001300***************************************************************** 00130000
001400*                                                                 00140000
001500*  THIS PROGRAM WILL CREATE A PAYPAL CORRECTIONS AUDIT REPORT.    00150000
001700*                                                                 00160000
001800*   INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE        00170000
001900*                  PROCESS DATE TO CREATE THE REPORT.             00180000
002000*  OUTPUT: RPT01 - REPORT SHOWING PAYPAL CORRECTIONS BY SALES     00190000
002100*                  DATE.                                          00200000
002200*                                                                 00210000
002300***************************************************************** 00220000
002400*                                                                 00230000
002500*  THIS PROGRAM USES THE TEPDKEY TABLE TO JOIN THE TEPTRN,        00240000
002600*  TEPTND, AND TEPCRD TABLES.  THE TEPDKEY TABLE CONTAINS ALL     00250000
002700*  KEY INFORMATION FOR TRANSACTIONS THAT HAVE BEEN PROCESSED FOR  00260000
002800*  A PROCESSING DAY THAT DO NOT HAVE SALES DATES FOR THAT         00270000
002900*  PROCESSING DAY.  THE MOST COMMON EXAMPLE OF THIS IS A SALES    00280000
003000*  CORRECTION.                                                    00290000
003100*                                                                 00300000
003200*  THE REPORT USES DATA FROM THE TEPTND, TEPCRD, AND TEPTRN       00310000
003300*  TABLES.  A DETAIL LINE IS WRITTEN FOR EACH ROW FETCHED.        00320000
003400*  THE REPORT BREAKS ON STORE NUMBER AND ALSO SALES DATE.         00330000
003500*  WHEN A NEW SALES DATE IS ENCOUNTERED, THE DATE IS PASSED TO    00340000
003700*  THE CALENDAR ROUTINE TO BE CHANGED INTO GREGORIAN FORMAT.      00360000
003900*                                                                 00380000
004000*  WHEN THE FETCH IS COMPLETE, A TOTAL LINE IS PRINTED AT THE     00390000
004100*  END OF THE REPORT.                                             00400000
004200*                                                                 00410000
004300***************************************************************** 00420000
004200*                                                                 00430000
004400* NEW PROGRAM SAKRP022                                            00550000
004500* CHANGED: 08/07/23  WR/IR#: CHG0292252   JIM HUNTER              00560000
004600* DESCRIPTION: CREATE A NEW REPORT FOR THE PAYPAL CORRECTIONS.    00570000
004200*                                                                 00571000
SETTLP* CHANGED: 10/03/23  WR/IR#: CHG0294623   JIM HUNTER              00573006
SETTLP* DESCRIPTION: COMMENT OUT THE CHECK IN THE PAYPAL-CURSOR FOR     00574005
SETTLP*              STTLMNT_PRCD_CDE   = 'P'.                          00575005
004700***************************************************************** 00580000
005000 ENVIRONMENT DIVISION.                                            00590000
005100***************************************************************** 00600000
005200                                                                  00610000
005300 CONFIGURATION SECTION.                                           00620000
005400                                                                  00630000
005500 SOURCE-COMPUTER.        IBM-3090.                                00640000
005600                                                                  00650000
005700 OBJECT-COMPUTER.        IBM-3090.                                00660000
005800                                                                  00670000
005900 INPUT-OUTPUT SECTION.                                            00680000
006000                                                                  00690000
006100 FILE-CONTROL.                                                    00700000
006200                                                                  00710000
006300     SELECT POS-DATE-CARD-FILE                                    00720000
006400         ASSIGN TO INP01.                                         00730000
006500                                                                  00740000
006600     SELECT PAYPAL-REPORT-FILE                                    00750000
006700         ASSIGN TO RPT01.                                         00760000
006800                                                                  00770000
006900 EJECT                                                            00780000
007000******************************************************************00790000
007100 DATA DIVISION.                                                   00800000
007200******************************************************************00810000
007300                                                                  00820000
007400 FILE SECTION.                                                    00830000
007500                                                                  00840000
007600 FD  POS-DATE-CARD-FILE                                           00850000
007700     RECORDING MODE IS F                                          00860000
007800     BLOCK CONTAINS 0 RECORDS                                     00870000
007900     LABEL RECORDS ARE STANDARD.                                  00880000
008000                                                                  00890000
008100 01  POS-DATE-CARD-RECORD            PIC X(80).                   00900000
008200                                                                  00910000
008300 FD  PAYPAL-REPORT-FILE                                           00920000
008400     RECORDING MODE IS F                                          00930000
008500     BLOCK CONTAINS 0  RECORDS.                                   00940000
008600                                                                  00950000
008700 01  PAYPAL-REPORT-RECORD            PIC  X(132).                 00960000
008800                                                                  00970000
008900 EJECT                                                            00980000
009000******************************************************************00990000
009100 WORKING-STORAGE SECTION.                                         01000000
009200******************************************************************01010000
009300 01  FILLER                            PIC X(50)  VALUE           01020000
009400     ' *** WORKING STORAGE STARTS HERE FOR SAKRP022 *** '.        01030000
009500                                                                  01040000
009600******************************************************************01050000
009700* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01060000
009800******************************************************************01070000
009900 01  CC-CONTROL-CARD.                                             01080000
010000     05  CC-CONTROL-CARD-DISPLAY.                                 01090000
010100         10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        01100000
010200             88  CC-VALID-CONTROL-NAME        VALUE               01110000
010300                 'P.O.S. DATE = '.                                01120000
010400         10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         01130000
010500     05  FILLER                  PIC X(60)    VALUE SPACE.        01140000
010600                                                                  01150000
010700******************************************************************01160000
010800*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01170000
010900******************************************************************01180000
011000     COPY DPWS500.                                                01190000
011100                                                                  01200000
011200 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01210000
011300                                                  COMP SYNC.      01220000
011400     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01230000
011500     88  AC-DB2-ERROR                             VALUE +4013.    01240000
011600     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01250000
011700                                                                  01260000
011800                                                                  01270000
011900 EJECT                                                            01280000
012000 01  PS-PROGRAM-SWITCHES.                                         01290000
012100     05  PS-END-OF-CURSOR-SW           PIC X(01)  VALUE 'N'.      01300000
012200         88  PS-END-OF-CURSOR                     VALUE 'Y'.      01310000
012300     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01320000
012400         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01330000
012500                                                                  01340000
012600 01  PC-CONSTANTS.                                                01350000
012700     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01360000
012800     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01370000
012900                                                   COMP SYNC.     01380000
013000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01390000
013100                                                   'SAKRP022'.    01400000
013200     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01410000
013300     05  PC-PAYPAL-TENDER-TYPE       PIC  X(02)    VALUE '16'.    01420000
013400     05  PC-SYSTEM-CORRECTION        PIC  X(01)    VALUE 'S'.     01430000
013500     05  PC-REVERSAL-CORRECTION      PIC  X(01)    VALUE 'R'.     01440000
013600                                                                  01450000
013700 EJECT                                                            01460000
013800 01  PV-MISC-COUNT-FIELDS            COMP-3.                      01470000
013900     05  PV-PAGE-CNT                 PIC S9(05)    VALUE ZERO.    01480000
014000     05  PV-LINE-CNT                 PIC S9(03)    VALUE ZERO.    01490000
014100     05  PV-LINE-CNT-AHEAD           PIC S9(03)    VALUE ZERO.    01500000
014200     05  PV-CURSOR-CNT               PIC S9(07)    VALUE ZERO.    01510000
014300                                                                  01520000
014400******************************************************************01530000
014500*  ACCUMULATORS TO HOLD STORE AND COMPANY DOLLAR AMOUNTS.         01540000
014600******************************************************************01550000
014700 01  PA-PROGRAM-ACCUMULATORS.                                     01560000
014800     05  PA-STORE-SALES-AMOUNT       PIC S9(07)V99  VALUE ZERO    01570000
014900                                         COMP-3.                  01580000
015000     05  PA-STORE-RETURN-AMOUNT      PIC S9(07)V99  VALUE ZERO    01590000
015100                                         COMP-3.                  01600000
015200     05  PA-COMPANY-SALES-AMOUNT     PIC S9(07)V99  VALUE ZERO    01610000
015300                                         COMP-3.                  01620000
015400     05  PA-COMPANY-RETURN-AMOUNT    PIC S9(07)V99  VALUE ZERO    01630000
015500                                         COMP-3.                  01640000
015600                                                                  01650000
015700 01  PV-MISC-FIELDS.                                              01660000
015800     05  PV-PRINT-RECORD             PIC X(132)    VALUE SPACE.   01670000
015900     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01680000
016000                                                   COMP SYNC.     01690000
016100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01700000
016200     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01710000
016300     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01720000
016400     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01730000
016500     05  PV-EDIT-MASK                PIC  Z,ZZZ,ZZ9.              01740000
016600     05  PV-HOLD-STORE               PIC  S9(04)  COMP VALUE ZERO.01750000
016700     05  PV-HOLD-SALES-DATE          PIC   X(10)  VALUE SPACE.    01760000
016800     05  PV-AMOUNT                   PIC  S9(07)V99 COMP-3        01770000
016900                                          VALUE ZERO.             01780000
017000     05  PV-AMOUNT-FORMATTED         PIC   ZZ,ZZ9.99-.            01790000
018900                                                                  01980000
019000 01  PV-DATE-AND-TIME-FIELDS.                                     01990000
019100     05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   02000000
019200     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      02010000
019300         10  PV-POS-CCYY             PIC X(04).                   02020000
019400         10  FILLER                  PIC X(01).                   02030000
019500         10  PV-POS-MM               PIC X(02).                   02040000
019600         10  FILLER                  PIC X(01).                   02050000
019700         10  PV-POS-DD               PIC X(02).                   02060000
019800     05  PV-CURR-DATE-CCYYMMDD.                                   02070000
019900         10  PV-CURR-DATE-CCYY       PIC  9(04).                  02080000
020000         10  PV-CURR-DATE-MM         PIC  9(02).                  02090000
020100         10  PV-CURR-DATE-DD         PIC  9(02).                  02100000
020200     05  PV-CURR-TIME.                                            02110000
020300         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    02120000
020400         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    02130000
020500         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    02140000
020600     05  PV-POS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   02150000
020700     05  PV-SLS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   02160000
020800 EJECT                                                            02170000
020900******************************************************************02180000
021000*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  02190000
021100******************************************************************02200000
021200     COPY DPWS132.                                                02210000
021300                                                                  02220000
021400******************************************************************02230000
021500*  HEADING LINES FOR THE PAYPAL CORRECTIONS REPORT.               02240000
021600******************************************************************02250000
021700 01  HL2-HEADING-LINE-2.                                          02260000
021800     05  FILLER                      PIC  X(38)    VALUE SPACE.   02270000
021900     05  FILLER                      PIC  X(07)    VALUE          02280000
022000                                          'PAYPAL '.              02290000
022100     05  FILLER                      PIC  X(12)    VALUE          02300000
022200                                          'CORRECTIONS '.         02310000
022300     05  FILLER                      PIC  X(10)    VALUE          02320000
022400                                          'AUDIT FOR '.           02330000
022500     05  FILLER                      PIC  X(11)    VALUE          02340000
022600                                          'PROCESSING '.          02350000
022700     05  FILLER                      PIC  X(06)    VALUE          02360000
022800                                          'DATE: '.               02370000
022900     05  HL2-DATE                    PIC  X(10)    VALUE SPACE.   02380000
023000     05  FILLER                      PIC  X(38)    VALUE SPACE.   02390000
023100                                                                  02400000
023200 01  HL3-HEADING-LINE-3.                                          02410000
023300     05  FILLER                      PIC  X(47)    VALUE ALL '-'. 02420000
023400     05  FILLER                      PIC  X(09)    VALUE          02430000
023500                                          ' STORE # '.            02440000
023600     05  HL3-STORE                   PIC  Z999.                   02450000
024100     05  FILLER                      PIC  X(01)    VALUE SPACE.   02500000
024200     05  FILLER                      PIC  X(71)    VALUE ALL '-'. 02510000
024300                                                                  02520000
024400 01  HL4-HEADING-LINE-4.                                          02530000
024500     05  FILLER                      PIC  X(50)    VALUE SPACE.   02540000
024600     05  FILLER                      PIC  X(04)    VALUE 'AUTH'.  02550000
024700     05  FILLER                      PIC  X(78)    VALUE SPACE.   02560000
024800                                                                  02570000
024900 01  HL5-HEADING-LINE-5.                                          02580000
025000     05  FILLER                      PIC  X(08)    VALUE SPACE.   02590000
025100     05  FILLER                      PIC  X(10)    VALUE          02600000
025200                                                   'SALES DATE'.  02610000
025300     05  FILLER                      PIC  X(04)    VALUE SPACE.   02620000
025400     05  FILLER                      PIC  X(05)    VALUE 'REG #'. 02630000
025500     05  FILLER                      PIC  X(02)    VALUE SPACE.   02640000
025600     05  FILLER                      PIC  X(07)    VALUE          02650000
025700                                                   'TRANS #'.     02660000
025800     05  FILLER                      PIC  X(02)    VALUE SPACE.   02670000
025900     05  FILLER                      PIC  X(08)    VALUE          02680000
026000                                                   'ASSOC ID'.    02690000
026100     05  FILLER                      PIC  X(02)    VALUE SPACE.   02700000
026200     05  FILLER                      PIC  X(06)    VALUE          02710000
026300                                                   'NUMBER'.      02720000
026400     05  FILLER                      PIC  X(11)    VALUE SPACE.   02730000
026500     05  FILLER                      PIC  X(06)    VALUE          02740000
026600                                                   'ACCT #'.      02750000
026700     05  FILLER                      PIC  X(12)    VALUE SPACE.   02760000
026800     05  FILLER                      PIC  X(04)    VALUE          02770000
026900                                                   'CODE'.        02780000
027000     05  FILLER                      PIC  X(08)    VALUE SPACE.   02790000
027100     05  FILLER                      PIC  X(05)    VALUE          02800000
027200                                                   'SALES'.       02810000
027300     05  FILLER                      PIC  X(06)    VALUE SPACE.   02820000
027400     05  FILLER                      PIC  X(07)    VALUE          02830000
027500                                                   'RETURNS'.     02840000
027600     05  FILLER                      PIC  X(04)    VALUE SPACE.   02850000
027700     05  FILLER                      PIC  X(10)    VALUE          02860000
027800                                                   'NET AMOUNT'.  02870000
027900     05  FILLER                      PIC  X(03)    VALUE SPACE.   02880000
028000                                                                  02890000
028100 01  HL6-HEADING-LINE-6.                                          02900000
028200     05  FILLER                      PIC  X(04)    VALUE SPACE.   02910000
028300     05  FILLER                      PIC  X(08)    VALUE          02920000
028400                                          'STORE # '.             02930000
028500     05  HL6-STORE                   PIC  Z999.                   02940000
028600     05  FILLER                      PIC  X(11)    VALUE          02950000
028700                                          ' TOTAL FOR '.          02960000
028800     05  HL6-DATE                    PIC  X(10)    VALUE SPACE.   02970000
028900     05  FILLER                      PIC  X(54)    VALUE SPACE.   02980000
029000     05  HL6-SALES-TOTAL             PIC  X(10)    VALUE SPACE.   02990000
029100     05  FILLER                      PIC  X(03)    VALUE SPACE.   03000000
029200     05  HL6-RETURN-TOTAL            PIC  X(10)    VALUE SPACE.   03010000
029300     05  FILLER                      PIC  X(04)    VALUE SPACE.   03020000
029400     05  HL6-NET-AMOUNT              PIC  X(10)    VALUE SPACE.   03030000
029500     05  FILLER                      PIC  X(04)    VALUE SPACE.   03040000
029600                                                                  03050000
029700******************************************************************03060000
029800*  DETAIL LINE PRINTED ON THE REPORT.                             03070000
029900******************************************************************03080000
030000 01  DL1-DETAIL-LINE-1.                                           03090000
030100     05  FILLER                      PIC  X(08)    VALUE SPACE.   03100000
030200     05  DL1-SALES-DATE              PIC  X(10)    VALUE SPACE.   03110000
030300     05  FILLER                      PIC  X(04)    VALUE SPACE.   03120000
030400     05  DL1-REGISTER                PIC  9(04)    VALUE ZERO.    03130000
030500     05  FILLER                      PIC  X(04)    VALUE SPACE.   03140000
030600     05  DL1-TRANSACTION             PIC  9(04)    VALUE ZERO.    03150000
030700     05  FILLER                      PIC  X(04)    VALUE SPACE.   03160000
030800     05  DL1-ASSOC-ID                PIC  X(08)    VALUE SPACE.   03170000
030900     05  FILLER                      PIC  X(02)    VALUE SPACE.   03180000
031000     05  DL1-AUTH-NBR                PIC  X(06)    VALUE SPACE.   03190000
031100     05  FILLER                      PIC  X(04)    VALUE SPACE.   03200000
031200     05  DL1-CARD-NBR.                                            03210000
031300         10  DL1-CARD-NBR-FIRST-4    PIC  X(04)    VALUE SPACE.   03220000
031400         10  FILLER                  PIC  X(01)    VALUE '-'.     03230000
031500         10  DL1-CARD-NBR-SECOND-4   PIC  X(04)    VALUE SPACE.   03240000
031600         10  FILLER                  PIC  X(01)    VALUE '-'.     03250000
031500         10  DL1-CARD-NBR-THIRD-4    PIC  X(04)    VALUE SPACE.   03251000
031600         10  FILLER                  PIC  X(01)    VALUE '-'.     03252000
031700         10  DL1-CARD-NBR-LAST-4     PIC  X(04)    VALUE SPACE.   03260000
031800     05  FILLER                      PIC  X(07)    VALUE SPACE.   03270000
031900     05  DL1-CODE                    PIC  X(01)    VALUE SPACE.   03280000
032000     05  FILLER                      PIC  X(06)    VALUE SPACE.   03290000
032100     05  DL1-SALES-AMOUNT            PIC  X(10)    VALUE SPACE.   03300000
032200     05  FILLER                      PIC  X(03)    VALUE SPACE.   03310000
032300     05  DL1-RETURN-AMOUNT           PIC  X(10)    VALUE SPACE.   03320000
032400     05  FILLER                      PIC  X(18)    VALUE SPACE.   03330000
032500                                                                  03340000
032600 EJECT                                                            03350000
032700******************************************************************03360000
032800*  TOTAL LINE PRINTED AT THE END OF THE REPORT                    03370000
032900******************************************************************03380000
033000 01 TL1-TOTAL-LINE-1.                                             03390000
033100    05  FILLER                       PIC X(01) VALUE SPACE.       03400000
033200    05  FILLER                       PIC X(08) VALUE              03410000
033300                                         'COMPANY '.              03420000
033400    05  FILLER                       PIC X(10) VALUE              03430000
033500                                         'TOTAL FOR '.            03440000
033600    05  FILLER                       PIC X(04) VALUE              03450000
033700                                         'ALL '.                  03460000
033800    05  FILLER                       PIC X(12) VALUE              03470000
033900                                         'CORRECTIONS '.          03480000
034000    05  FILLER                       PIC X(11) VALUE              03490000
034100                                         'ENTERED ON '.           03500000
034200    05  TL1-DATE                     PIC X(10) VALUE SPACE.       03510000
034300    05  FILLER                       PIC X(34) VALUE SPACE.       03520000
034400    05  TL1-SALES-AMOUNT             PIC ZZZ,ZZ9.99-.             03530000
034500    05  FILLER                       PIC X(02) VALUE SPACE.       03540000
034600    05  TL1-RETURN-AMOUNT            PIC ZZZ,ZZ9.99-.             03550000
034700    05  FILLER                       PIC X(03) VALUE SPACE.       03560000
034800    05  TL1-NET-AMOUNT               PIC ZZZ,ZZ9.99-.             03570000
034900    05  FILLER                       PIC X(04) VALUE SPACE.       03580000
035000                                                                  03590000
035100******************************************************************03600000
035200*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03610000
035300******************************************************************03620000
035400     COPY DPWS004.                                                03630000
035500 EJECT                                                            03640000
035600******************************************************************03650000
035700*  DB2 COMMUNICATION AREA.                                        03660000
035800******************************************************************03670000
035900     EXEC SQL                                                     03680000
036000          INCLUDE SQLCA                                           03690000
036100     END-EXEC.                                                    03700000
036200 EJECT                                                            03710000
036300******************************************************************03720000
036400*  DB2 TABLE TEPPART - PARTITION TABLE                            03730000
036500******************************************************************03740000
036600     EXEC SQL                                                     03750000
036700          INCLUDE TEPPART                                         03760000
036800     END-EXEC.                                                    03770000
036900 EJECT                                                            03780000
037000******************************************************************03790000
037100*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           03800000
037200******************************************************************03810000
037300     EXEC SQL                                                     03820000
037400          INCLUDE TEPTRN                                          03830000
037500     END-EXEC.                                                    03840000
037600 EJECT                                                            03850000
037700******************************************************************03860000
037800*  DB2 TABLE TEPTND - TENDER TABLE                                03870000
037900******************************************************************03880000
038000     EXEC SQL                                                     03890000
038100          INCLUDE TEPTND                                          03900000
038200     END-EXEC.                                                    03910000
038300 EJECT                                                            03920000
038400******************************************************************03930000
038500*  DB2 TABLE TEPCRD - CREDIT TENDER TABLE                         03940000
038600******************************************************************03950000
038700     EXEC SQL                                                     03960000
038800          INCLUDE TEPCRD                                          03970000
038900     END-EXEC.                                                    03980000
039000 EJECT                                                            03990000
039100******************************************************************04000000
039200*  DB2 TABLE TEPDKEY - CURRENT PROCESSING DAY KEYS                04010000
039300******************************************************************04020000
039400     EXEC SQL                                                     04030000
039500          INCLUDE TEPDKEY                                         04040000
039600     END-EXEC.                                                    04050000
039700 EJECT                                                            04060000
039800******************************************************************04070000
039900*  DB2 TABLE TEPSAT - SALES AUDIT USER ID TABLE                   04080000
040000******************************************************************04090000
040100     EXEC SQL                                                     04100000
040200          INCLUDE TEPSAT                                          04110000
040300     END-EXEC.                                                    04120000
040400 EJECT                                                            04130000
041200******************************************************************04210000
041300*  CURSOR TO RETRIEVE PAYPAL CORRECTION DATA                      04220000
041400******************************************************************04230000
041500     EXEC SQL                                                     04240000
041600       DECLARE PAYPAL-CURSOR CURSOR FOR                           04250000
041700            SELECT  T.PARTN_NBR                                   04260000
041800                   ,T.STR_NBR                                     04270000
041900                   ,T.RGST_ID                                     04280000
042000                   ,T.TRN_NBR                                     04290000
042100                   ,T.STRT_TM                                     04300000
042200                   ,T.SLS_CORR_SEQ_NBR                            04310000
042300                   ,TRN_STAT_CDE                                  04320000
042400                   ,T.SLS_DTE                                     04330000
042500                   ,ASSOC_ID                                      04340000
042600                   ,TNDR_ID                                       04350000
042700                   ,TNDR_AMT                                      04360000
042800                   ,TNDR_ID_LEN_NBR                               04370000
042900                   ,AUTH_NBR                                      04380000
043000            FROM    TEPDKEY D                                     04390000
043100                   ,TEPTRN T                                      04400000
043200                   ,TEPTND N                                      04410000
043300                   ,TEPCRD C                                      04420000
043400                   ,TEPPART A                                     04430000
043500            WHERE   D.PRCG_DTE         = :EPDKEY-PRCG-DTE         04440000
043600              AND   D.SLS_DTE          = A.SLS_DTE                04450000
043700              AND   A.PARTN_NBR        = T.PARTN_NBR              04460000
043800              AND   D.STR_NBR          = T.STR_NBR                04470000
043900              AND   D.RGST_ID          = T.RGST_ID                04480000
044000              AND   D.TRN_NBR          = T.TRN_NBR                04490000
044100              AND   D.STRT_TM          = T.STRT_TM                04500000
044200              AND   D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR       04510000
044300              AND   T.PARTN_NBR        = N.PARTN_NBR              04520000
044400              AND   T.STR_NBR          = N.STR_NBR                04530000
044500              AND   T.RGST_ID          = N.RGST_ID                04540000
044600              AND   T.TRN_NBR          = N.TRN_NBR                04550000
044700              AND   T.STRT_TM          = N.STRT_TM                04560000
044800              AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR       04570000
044900              AND   N.PARTN_NBR        = C.PARTN_NBR              04580000
045000              AND   N.STR_NBR          = C.STR_NBR                04590000
045100              AND   N.RGST_ID          = C.RGST_ID                04600000
045200              AND   N.TRN_NBR          = C.TRN_NBR                04610000
045300              AND   N.STRT_TM          = C.STRT_TM                04620000
045400              AND   N.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR       04630000
045500              AND   N.TNDR_SEQ_NBR     = C.TNDR_SEQ_NBR           04640000
045600              AND   D.SLS_CORR_SEQ_NBR <> 0                       04650000
045700              AND   VOID_ABRT_CDE      = 'N'                      04660000
045800              AND   TRN_STAT_CDE       IN ('V', 'R', 'L', 'Z')    04670000
045900              AND   TNDR_TYP_CDE       = :PC-PAYPAL-TENDER-TYPE   04680000
046000              AND   TNDR_VOID_IND      = 'N'                      04690000
SETTLP****          AND   STTLMNT_PRCD_CDE   = 'P'                      04700005
046200           ORDER BY T.STR_NBR                                     04710000
046300                   ,T.SLS_DTE                                     04720000
046400                   ,T.RGST_ID                                     04730000
046500                   ,T.TRN_NBR                                     04740000
046600           WITH UR                                                04750000
046700     END-EXEC.                                                    04760000
046800                                                                  04770000
046900***************************************************************** 04780000
047000* PROCEDURE DIVISION.                                           * 04790000
047100***************************************************************** 04800000
047200 PROCEDURE DIVISION.                                              04810000
047300                                                                  04820000
047400******************************************************************04830000
047500* 0000-MAINLINE-PARAGRAPH                                         04840000
047600*      PRODUCE PAYPAL CORRECTIONS REPORT                          04850000
047700******************************************************************04860000
047800 0000-MAINLINE-PARAGRAPH.                                         04870000
047900                                                                  04880000
048000     PERFORM 1000-INITIALIZE-PROGRAM.                             04890000
048100                                                                  04900000
048200     PERFORM 2000-PRODUCE-REPORT-LINES                            04910000
048300         UNTIL PS-END-OF-CURSOR.                                  04920000
048400                                                                  04930000
048500     IF PV-CURSOR-CNT           GREATER THAN ZERO                 04940000
048600         PERFORM 5200-PRINT-STORE-TOTAL-LINE                      04950000
048700     END-IF.                                                      04960000
048800                                                                  04970000
048900     PERFORM 4000-PRINT-REPORT-TOTALS.                            04980000
049000                                                                  04990000
049100     DISPLAY '****************************************'           05000000
049200     DISPLAY '*************** SAKRP022 ***************'           05010000
049300     DISPLAY '****************************************'           05020000
049400     MOVE PV-CURSOR-CNT          TO PV-EDIT-MASK                  05030000
049500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          05040000
049600     DISPLAY 'CORRECTION ROWS FETCHED........'                    05050000
049700         PV-EDIT-MASK                                             05060000
049800     DISPLAY '****************************************'           05070000
049900     DISPLAY '****************************************'           05080000
050000     DISPLAY '****************************************'           05090000
050100                                                                  05100000
050200     STOP RUN.                                                    05110000
050300                                                                  05120000
050400 EJECT                                                            05130000
050500                                                                  05140000
050600******************************************************************05150000
050700* 1000-INITIALIZE-PROGRAM                                         05160000
050800*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,   05170000
050900*     OPEN PAYPAL-CUROSR, ATTEMPT FIRST FETCH OF CURSOR           05180000
051000******************************************************************05190000
051100 1000-INITIALIZE-PROGRAM.                                         05200000
051200                                                                  05210000
051300     OPEN INPUT  POS-DATE-CARD-FILE                               05220000
051400          OUTPUT PAYPAL-REPORT-FILE.                              05230000
051500                                                                  05240000
051600     PERFORM 1100-PROCESS-CONTROL-CARD.                           05250000
051700                                                                  05260000
051800     PERFORM 1200-FORMAT-HEADINGS.                                05270000
051900                                                                  05280000
052000     PERFORM 1300-PREPARE-FOR-REPORT.                             05290000
052100                                                                  05300000
052200******************************************************************05310000
052300* 1100-PROCESS-CONTROL-CARD                                       05320000
052400*     READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL   05330000
052500*     DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.  05340000
052600******************************************************************05350000
052700 1100-PROCESS-CONTROL-CARD.                                       05360000
052800                                                                  05370000
052900     PERFORM 1110-READ-POS-DATE-CARD-FILE.                        05380000
053000     CLOSE POS-DATE-CARD-FILE.                                    05390000
053100     IF PS-END-OF-CARD-FILE                                       05400000
053200         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05410000
053300         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05420000
053400         SET AC-CONTROL-CARD-ERROR TO TRUE                        05430000
053500         PERFORM 9999-ABEND                                       05440000
053600     END-IF.                                                      05450000
053700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05460000
053800             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  05470000
053900     PERFORM 1115-CONVERT-INPUT-DATE.                             05480000
054000 EJECT                                                            05490000
054100                                                                  05500000
054200******************************************************************05510000
054300* 1110-READ-POS-DATE-CARD-FILE                                    05520000
054400*     READ DATE CONTROL CARD.                                     05530000
054500******************************************************************05540000
054600 1110-READ-POS-DATE-CARD-FILE.                                    05550000
054700     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 05560000
054800        AT END                                                    05570000
054900           SET PS-END-OF-CARD-FILE TO TRUE.                       05580000
055000                                                                  05590000
055100******************************************************************05600000
055200* 1115-CONVERT-INPUT-DATE                                         05610000
055300*     CALL KOHLS CALENDAR ROUTINE:                                05620000
055400*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            05630000
055500*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 05640000
055600******************************************************************05650000
055700                                                                  05660000
055800 1115-CONVERT-INPUT-DATE.                                         05670000
055900                                                                  05680000
056000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05690000
056100                                                                  05700000
056200     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   05710000
056300     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   05720000
056400     SET  DPG52-LK-DTE-GREG            TO TRUE.                   05730000
056500     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    05740000
056600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05750000
056700                                             DPG54 DPG55 DPG56.   05760000
056800     EVALUATE TRUE                                                05770000
056900         WHEN DPG54-SEVERE-ERROR                                  05780000
057000         WHEN DPG54-DATE-INVALID                                  05790000
057100             MOVE '1115-CONVERT-INPUT-DATE'                       05800000
057200                                   TO PV-PARAGRAPH-NAME           05810000
057300             MOVE 'ERROR CONVERTING INPUT CARD DATE'              05820000
057400                                   TO PV-OPERATION-MSG-1          05830000
057500             SET AC-CALENDAR-ROUTINE-ERROR                        05840000
057600                                   TO TRUE                        05850000
057700             MOVE DPG54-ERROR-MESSAGE                             05860000
057800                                   TO PV-OPERATION-MSG-2          05870000
057900             PERFORM 9999-ABEND                                   05880000
058000     END-EVALUATE.                                                05890000
058100                                                                  05900000
058200     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-POS-CCYY-MM-DD           05910000
058300                                      EPDKEY-PRCG-DTE.            05920000
058400     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-POS-DATE-FORMATTED.      05930000
058500 EJECT                                                            05940000
058600                                                                  05950000
058700******************************************************************05960000
058800* 1200-FORMAT-HEADINGS                                            05970000
058900*     GET CURRENT DATE AND TIME FROM SYSTEM.                      05980000
059000*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          05990000
059100*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              06000000
059200******************************************************************06010000
059300 1200-FORMAT-HEADINGS.                                            06020000
059400                                                                  06030000
059500     MOVE FUNCTION CURRENT-DATE (1:8)                             06040000
059600                                   TO PV-CURR-DATE-CCYYMMDD.      06050000
059700     ACCEPT PV-CURR-TIME FROM TIME.                               06060000
059800                                                                  06070000
059900     MOVE PV-CURR-DATE-MM          TO DP132-RUN-MONTH.            06080000
060000     MOVE PV-CURR-DATE-DD          TO DP132-RUN-DAY.              06090000
060100     MOVE PV-CURR-DATE-CCYY        TO DP132-RUN-YEAR.             06100000
060200                                                                  06110000
060300     MOVE PV-CURR-TIME-HH          TO DP132-RUN-HOUR.             06120000
060400     MOVE PV-CURR-TIME-MM          TO DP132-RUN-MINUTE.           06130000
060500     MOVE PC-CURRENT-PROGRAM-NAME  TO DP132-PROGRAM-NAME.         06140000
060600     MOVE PC-REPORT-NBR-1          TO DP132-REPORT-NUMBER.        06150000
060700                                                                  06160000
060800     MOVE PV-POS-DATE-FORMATTED    TO HL2-DATE.                   06170000
060900 EJECT                                                            06180000
061000                                                                  06190000
061100******************************************************************06200000
061200* 1300-PREPARE FOR REPORT                                         06210000
061300*     - OPEN THE CURSOR                                           06220000
061400*     - FETCH FIRST RECORD                                        06230000
061500*     - IF RECORD                                                 06240000
061600******************************************************************06250000
061700 1300-PREPARE-FOR-REPORT.                                         06260000
061800                                                                  06270000
061900     PERFORM 8000-PRINT-HEADINGS.                                 06280000
062000     PERFORM 2100-OPEN-PAYPAL-CURSOR.                             06290000
062100     PERFORM 2200-FETCH-PAYPAL-CURSOR.                            06300000
062200     IF PS-END-OF-CURSOR                                          06310000
062300         DISPLAY '*** NO DATA PRESENT FOR PAYPAL CORR ***'        06320000
062400                 '*** ON SALES DATE '                             06330000
062500                 PV-POS-DATE-FORMATTED                            06340000
062600     ELSE                                                         06350000
062700         PERFORM 2500-PROCESS-FIRST-RECORD                        06360000
062800     END-IF.                                                      06370000
062900                                                                  06380000
063000******************************************************************06390000
063100* 2000-PRODUCE-REPORT-LINES                                       06400000
063200*  PRODUCE THE ACTUAL REPORT LINES                                06410000
063300******************************************************************06420000
063400 2000-PRODUCE-REPORT-LINES.                                       06430000
063500                                                                  06440000
063600     IF EPTRN-STR-NBR              = PV-HOLD-STORE                06450000
063700         CONTINUE                                                 06460000
063800     ELSE                                                         06470000
063900         PERFORM 3000-STORE-BREAK                                 06480000
064000     END-IF.                                                      06490000
064100                                                                  06500000
064200     IF EPTRN-SLS-DTE              = PV-HOLD-SALES-DATE           06510000
064300         CONTINUE                                                 06520000
064400     ELSE                                                         06530000
064500         PERFORM 3500-SALES-DATE-BREAK                            06540000
064600     END-IF.                                                      06550000
064700                                                                  06560000
064800     PERFORM 5000-PRINT-DETAIL-LINE.                              06570000
064900     PERFORM 2200-FETCH-PAYPAL-CURSOR.                            06580000
065000                                                                  06590000
065100******************************************************************06600000
065200* 2100-OPEN-PAYPAL-CURSOR.                                        06610000
065300*     OPEN PAYPAL CURSOR                                          06620000
065400******************************************************************06630000
065500 2100-OPEN-PAYPAL-CURSOR.                                         06640000
065600                                                                  06650000
065700     EXEC SQL                                                     06660000
065800          OPEN PAYPAL-CURSOR                                      06670000
065900     END-EXEC.                                                    06680000
066000                                                                  06690000
066100     EVALUATE TRUE                                                06700000
066200         WHEN SQLCODE = ZERO                                      06710000
066300              CONTINUE                                            06720000
066400         WHEN SQLWARN0 NOT EQUAL SPACE                            06730000
066500         WHEN SQLCODE NOT EQUAL ZERO                              06740000
066600             MOVE '2100-OPEN PAYPAL CURSOR'                       06750000
066700                                   TO PV-PARAGRAPH-NAME           06760000
066800             MOVE 'ERROR ON OPEN OF PAYPAL-CURSOR'                06770000
066900                                   TO PV-DB2-OPERATION            06780000
067000             PERFORM 9100-SQL-ABEND                               06790000
067100     END-EVALUATE.                                                06800000
067200 EJECT                                                            06810000
067300                                                                  06820000
067400******************************************************************06830000
067500* 2200-FETCH-SUMMARY-CURSOR                                       06840000
067600*   -FETCH ROWS THAT QUALIFY FOR THE REPORT                       06850000
067700******************************************************************06860000
067800 2200-FETCH-PAYPAL-CURSOR.                                        06870000
067900                                                                  06880000
068000     EXEC SQL                                                     06890000
068100          FETCH PAYPAL-CURSOR                                     06900000
068200           INTO :EPTRN-PARTN-NBR                                  06910000
068300               ,:EPTRN-STR-NBR                                    06920000
068400               ,:EPTRN-RGST-ID                                    06930000
068500               ,:EPTRN-TRN-NBR                                    06940000
068600               ,:EPTRN-STRT-TM                                    06950000
068700               ,:EPTRN-SLS-CORR-SEQ-NBR                           06960000
068800               ,:EPTRN-TRN-STAT-CDE                               06970000
068900               ,:EPTRN-SLS-DTE                                    06980000
069000               ,:EPTRN-ASSOC-ID                                   06990000
069100               ,:EPTND-TNDR-ID                                    07000000
069200               ,:EPTND-TNDR-AMT                                   07010000
069300               ,:EPTND-TNDR-ID-LEN-NBR                            07020000
069400               ,:EPCRD-AUTH-NBR                                   07030000
069500     END-EXEC.                                                    07040000
069600                                                                  07050000
069700     EVALUATE TRUE                                                07060000
069800         WHEN SQLCODE = ZERO                                      07070000
069900             ADD 1                 TO PV-CURSOR-CNT               07080000
070000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          07090000
070100             SET PS-END-OF-CURSOR  TO TRUE                        07100000
070200         WHEN SQLWARN0 NOT EQUAL SPACE                            07110000
070300         WHEN SQLCODE NOT EQUAL ZERO                              07120000
070400             MOVE '2200-FETCH-PAYPAL-CURSOR'                      07130000
070500                                   TO PV-PARAGRAPH-NAME           07140000
070600             MOVE 'ERROR ON FETCH OF SETTLEMENT-CURSOR'           07150000
070700                                   TO PV-DB2-OPERATION            07160000
070800             PERFORM 9100-SQL-ABEND                               07170000
070900     END-EVALUATE.                                                07180000
071000 EJECT                                                            07190000
071100                                                                  07200000
071200******************************************************************07210000
071300* 2300-CLOSE-PAYPAL-CURSOR                                        07220000
071400*   -CLOSE THE CURSOR                                             07230000
071500******************************************************************07240000
071600 2300-CLOSE-PAYPAL-CURSOR.                                        07250000
071700                                                                  07260000
071800     EXEC SQL                                                     07270000
071900          CLOSE PAYPAL-CURSOR                                     07280000
072000     END-EXEC.                                                    07290000
072100                                                                  07300000
072200     EVALUATE TRUE                                                07310000
072300         WHEN SQLCODE = ZERO                                      07320000
072400              CONTINUE                                            07330000
072500         WHEN SQLWARN0 NOT EQUAL SPACE                            07340000
072600         WHEN SQLCODE NOT EQUAL ZERO                              07350000
072700             MOVE '2300-CLOSE-PAYPAL-CURSOR'                      07360000
072800                                   TO PV-PARAGRAPH-NAME           07370000
072900             MOVE 'ERROR ON CLOSE OF PAYPAL-CURSOR'               07380000
073000                                   TO PV-DB2-OPERATION            07390000
073100             PERFORM 9100-SQL-ABEND                               07400000
073200     END-EVALUATE.                                                07410000
073300 EJECT                                                            07420000
073400                                                                  07430000
073500******************************************************************07440000
073600*  FIRST RECORD PROCESSING.  WRITE THE HEADER RECORDS AND MOVE    07450000
073700*  THE DATA INTO THE APPROPRIATE FIELDS.                          07460000
073800******************************************************************07470000
073900 2500-PROCESS-FIRST-RECORD.                                       07480000
074000                                                                  07490000
074100     MOVE EPTRN-STR-NBR            TO PV-HOLD-STORE.              07500000
074200     MOVE EPTRN-SLS-DTE            TO PV-HOLD-SALES-DATE.         07510000
074400     PERFORM 5100-PRINT-STORE-LINE.                               07530000
074500     PERFORM 3510-FORMAT-SALES-DATE.                              07540000
074600                                                                  07550000
074700******************************************************************07560000
074800*  PRINT THE STORE TOTAL WHEN A BREAK ON THE STORE NUMBER OCCURS  07570000
074900******************************************************************07580000
075000 3000-STORE-BREAK.                                                07590000
075100                                                                  07600000
075200     PERFORM 5200-PRINT-STORE-TOTAL-LINE.                         07610000
075400     PERFORM 5100-PRINT-STORE-LINE.                               07630000
075500                                                                  07640000
075600*** THE SALES DATE SHOULD ALWAYS BE PRINTED UNDER THE NEW STORE   07650000
075700*** INFORMATION.  THIS CHECKS TO SEE IF WE HAVE A DIFFERENT SALES 07660000
075800*** DATE WITH THE NEW STORE.                                      07670000
075900                                                                  07680000
076000     IF EPTRN-SLS-DTE              = PV-HOLD-SALES-DATE           07690000
076100         CONTINUE                                                 07700000
076200     ELSE                                                         07710000
076300         MOVE EPTRN-SLS-DTE        TO PV-HOLD-SALES-DATE          07720000
076400         PERFORM 3510-FORMAT-SALES-DATE                           07730000
076500     END-IF.                                                      07740000
076600                                                                  07750000
076700     MOVE ZERO TO                  PA-STORE-SALES-AMOUNT          07760000
076800                                   PA-STORE-RETURN-AMOUNT.        07770000
076900     MOVE EPTRN-STR-NBR            TO PV-HOLD-STORE.              07780000
077000                                                                  07790000
079700***************************************************************** 08060000
079800*  PRINT THE REQUIRED DATA ON A BREAK IN SALES DATE               08070000
079900***************************************************************** 08080000
080000 3500-SALES-DATE-BREAK.                                           08090000
080100                                                                  08100000
080200     PERFORM 5200-PRINT-STORE-TOTAL-LINE.                         08110000
080300     MOVE ZERO                     TO PA-STORE-SALES-AMOUNT       08120000
080400                                      PA-STORE-RETURN-AMOUNT.     08130000
080500     MOVE EPTRN-SLS-DTE            TO PV-HOLD-SALES-DATE.         08140000
080600     PERFORM 3510-FORMAT-SALES-DATE.                              08150000
080700                                                                  08160000
080800****************************************************************  08170000
080900*  CALL CALENDAR ROUTINE TO CONVERT THE SALES DATE FROM DB2       08180000
081000*  FORMAT INTO GREGORIAN FORMATTED FORMAT                         08190000
081100****************************************************************  08200000
081200 3510-FORMAT-SALES-DATE.                                          08210000
081300                                                                  08220000
081400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              08230000
081500                                                                  08240000
081600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   08250000
081700     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   08260000
081800     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   08270000
081900     MOVE EPTRN-SLS-DTE                TO DPG52-LK-DATE-INPUT.    08280000
082000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    08290000
082100                                             DPG54 DPG55 DPG56.   08300000
082200     EVALUATE TRUE                                                08310000
082300         WHEN DPG54-SEVERE-ERROR                                  08320000
082400         WHEN DPG54-DATE-INVALID                                  08330000
082500             MOVE '3510-FORMAT-SALES-DATEE'                       08340000
082600                                   TO PV-PARAGRAPH-NAME           08350000
082700             MOVE 'ERROR CONVERTING SALES DATE'                   08360000
082800                                   TO PV-OPERATION-MSG-1          08370000
082900             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                08380000
083000             MOVE DPG54-ERROR-MESSAGE                             08390000
083100                                   TO PV-OPERATION-MSG-2          08400000
083200             PERFORM 9999-ABEND                                   08410000
083300     END-EVALUATE.                                                08420000
083400     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-SLS-DATE-FORMATTED.      08430000
083500                                                                  08440000
083600******************************************************************08450000
083700* 4000-PRINT-REPORT-TOTALS                                        08460000
083800*     PRINT REPORT TOTALS (IF DATA WAS PRESENT & REPORT CREATED), 08470000
083900*     CLOSE REPORT FILE.                                          08480000
084000******************************************************************08490000
084100 4000-PRINT-REPORT-TOTALS.                                        08500000
084200                                                                  08510000
084300     PERFORM 2300-CLOSE-PAYPAL-CURSOR.                            08520000
084400     MOVE PV-POS-DATE-FORMATTED    TO TL1-DATE.                   08530000
084500     MOVE PA-COMPANY-SALES-AMOUNT                                 08540000
084600                                   TO TL1-SALES-AMOUNT.           08550000
084700     MOVE PA-COMPANY-RETURN-AMOUNT                                08560000
084800                                   TO TL1-RETURN-AMOUNT.          08570000
084900     COMPUTE PV-AMOUNT             = PA-COMPANY-RETURN-AMOUNT     08580000
085000                                   + PA-COMPANY-SALES-AMOUNT.     08590000
085100     MOVE PV-AMOUNT                TO TL1-NET-AMOUNT.             08600000
085200     MOVE +4                       TO PV-LINE-SPACING.            08610000
085300     MOVE TL1-TOTAL-LINE-1         TO PV-PRINT-RECORD.            08620000
085400     PERFORM 8200-WRITE-REPORT-LINE.                              08630000
085500     CLOSE PAYPAL-REPORT-FILE.                                    08640000
085600 EJECT                                                            08650000
085700                                                                  08660000
085800******************************************************************08670000
085900* 5000-PRINT-DETAIL-LINE                                          08680000
086000*     FORMAT AND PRINT REPORT DETAIL LINE.                        08690000
086100******************************************************************08700000
086200 5000-PRINT-DETAIL-LINE.                                          08710000
086300                                                                  08720000
086400     IF PV-LINE-CNT                > PC-LINE-LIMIT                08730000
086500         PERFORM 8000-PRINT-HEADINGS                              08740000
086600     END-IF.                                                      08750000
086700                                                                  08760000
086800     INITIALIZE                    DL1-SALES-AMOUNT               08770000
086900                                   DL1-RETURN-AMOUNT              08780000
087000                                   DL1-ASSOC-ID                   08790000
087100                                   DL1-CODE                       08800000
087200                                   DL1-CARD-NBR-FIRST-4           08810000
087300                                   DL1-CARD-NBR-SECOND-4          08820000
087300                                   DL1-CARD-NBR-THIRD-4           08821000
087400                                   DL1-CARD-NBR-LAST-4.           08830000
087500     MOVE PV-SLS-DATE-FORMATTED    TO DL1-SALES-DATE.             08840000
087600     MOVE EPTRN-RGST-ID            TO DL1-REGISTER.               08850000
087700     MOVE EPTRN-TRN-NBR            TO DL1-TRANSACTION.            08860000
087800     MOVE EPCRD-AUTH-NBR           TO DL1-AUTH-NBR.               08870000
087900     MOVE ALL '*'                  TO DL1-CARD-NBR-FIRST-4.       08880000
088000     MOVE ALL '*'                  TO DL1-CARD-NBR-SECOND-4.      08890000
088000     MOVE ALL '*'                  TO DL1-CARD-NBR-THIRD-4.       08891000
P10237     MOVE EPTND-TNDR-ID (12:4)     TO DL1-CARD-NBR-LAST-4.        08910000
088200                                                                  08920000
088300     EVALUATE TRUE                                                08930000
088400         WHEN EPTND-TNDR-AMT       > ZERO                         08940000
088500             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         08950000
088600             MOVE PV-AMOUNT-FORMATTED                             08960000
088700                                   TO DL1-SALES-AMOUNT            08970000
088800             MOVE SPACE            TO DL1-RETURN-AMOUNT           08980000
088900             ADD EPTND-TNDR-AMT    TO PA-STORE-SALES-AMOUNT       08990000
089000                                                                  09000000
089100         WHEN EPTND-TNDR-AMT       < ZERO                         09010000
089200             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         09020000
089300             MOVE PV-AMOUNT-FORMATTED                             09030000
089400                                   TO DL1-RETURN-AMOUNT           09040000
089500             MOVE SPACE            TO DL1-SALES-AMOUNT            09050000
089600             ADD EPTND-TNDR-AMT    TO PA-STORE-RETURN-AMOUNT      09060000
089700                                                                  09070000
089800         WHEN OTHER                                               09080000
089900             MOVE ZERO             TO PV-AMOUNT-FORMATTED         09090000
090000             MOVE PV-AMOUNT-FORMATTED                             09100000
090100                                   TO DL1-RETURN-AMOUNT           09110000
090200                                      DL1-SALES-AMOUNT            09120000
090300     END-EVALUATE.                                                09130000
090400                                                                  09140000
090500**** A LATE TRANSACTION, INDICATED BY A -1 SEQUENCE NUMBER, WILL N09150000
090600**** HAVE A SALES AUDIT USER ID.  A REGULAR CORRECTION WILL HVAE A09160000
090700**** SALES AUDIT USER ID.                                         09170000
090800                                                                  09180000
090900     IF EPTRN-SLS-CORR-SEQ-NBR     < ZERO                         09190000
091000         MOVE PC-SYSTEM-CORRECTION TO DL1-CODE                    09200000
091100     ELSE                                                         09210000
091200         IF EPTRN-TRN-STAT-CDE     = PC-REVERSAL-CORRECTION       09220000
091300             MOVE PC-REVERSAL-CORRECTION                          09230000
091400                                   TO DL1-CODE                    09240000
091500         END-IF                                                   09250000
091600         PERFORM 5010-SELECT-SLS-AUD-USER-ID                      09260000
091700     END-IF.                                                      09270000
091800                                                                  09280000
091900     MOVE DL1-DETAIL-LINE-1        TO PV-PRINT-RECORD.            09290000
092000                                                                  09300000
092100**** FOLLOWING CODE CHECKS IF THE LAST LINE PRINTED WAS SINGLE    09310000
092200**** SPACED (LIKE A DETAIL LINE) OR GREATER THAN SINGLE SPACED    09320000
092300**** (LIKE A HEADING LINE).  IF LAST LINE WAS NOT SINGLE SPACED,  09330000
092400**** PRINT THE DETAIL LINE DOUBLE SPACED.                         09340000
092500                                                                  09350000
092600     IF PV-LINE-SPACING            > +1                           09360000
092700         MOVE +2                   TO  PV-LINE-SPACING            09370000
092800     ELSE                                                         09380000
092900         MOVE +1                   TO  PV-LINE-SPACING            09390000
093000     END-IF.                                                      09400000
093100     PERFORM 8200-WRITE-REPORT-LINE.                              09410000
093200     MOVE +1                       TO  PV-LINE-SPACING.           09420000
093300 EJECT                                                            09430000
093400                                                                  09440000
093500***************************************************************** 09450000
093600* 5010-SELECT-SLS-AUD-USER-ID                                     09460000
093700*   - SELECT THE SALES AUDIT USER ID WHEN THE SALES CORRECTION    09470000
093800*     CORRECTION SEQUNCE NUMBER IS GREATER THAN ZERO              09480000
093900***************************************************************** 09490000
094000 5010-SELECT-SLS-AUD-USER-ID.                                     09500000
094100                                                                  09510000
094200     EXEC SQL                                                     09520000
094300         SELECT SLS_AUD_USR_ID                                    09530000
094400           INTO :EPSAT-SLS-AUD-USR-ID                             09540000
094500           FROM TEPSAT                                            09550000
094600          WHERE PARTN_NBR          = :EPTRN-PARTN-NBR             09560000
094700            AND STR_NBR            = :EPTRN-STR-NBR               09570000
094800            AND RGST_ID            = :EPTRN-RGST-ID               09580000
094900            AND TRN_NBR            = :EPTRN-TRN-NBR               09590000
095000            AND STRT_TM            = :EPTRN-STRT-TM               09600000
095100            AND SLS_CORR_SEQ_NBR   = :EPTRN-SLS-CORR-SEQ-NBR      09610000
095200         WITH UR                                                  09620000
095300     END-EXEC.                                                    09630000
095400                                                                  09640000
095500     EVALUATE TRUE                                                09650000
095600         WHEN SQLCODE = ZERO                                      09660000
095700             MOVE EPSAT-SLS-AUD-USR-ID                            09670000
095800                                   TO DL1-ASSOC-ID                09680000
095900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09690000
096000             MOVE 'UNKNOWN'        TO DL1-ASSOC-ID                09700000
096100         WHEN SQLWARN0 NOT EQUAL SPACE                            09710000
096200         WHEN SQLCODE NOT EQUAL ZERO                              09720000
096300             MOVE '5010-SELECT-SLS-AUD-USER-ID'                   09730000
096400                                   TO PV-PARAGRAPH-NAME           09740000
096500             MOVE 'ERROR ON SELECTING SLS AUD USER ID'            09750000
096600                                   TO PV-DB2-OPERATION            09760000
096700             PERFORM 9100-SQL-ABEND                               09770000
096800     END-EVALUATE.                                                09780000
096900                                                                  09790000
097000***************************************************************** 09800000
097100*  PRINT THE LINE CONTAINING THE STORE NUMBER                     09810000
097200***************************************************************** 09820000
097300 5100-PRINT-STORE-LINE.                                           09830000
097400                                                                  09840000
097500**** FOLLOWING CODE CHECKS FOR ENOUGH ROOM ON THE PAGE TO         09850000
097600**** PRINT THE STORE LINE, SALES DATE LINE, AND                   09860000
097700**** AT LEAST ONE DETAIL LINE.                                    09870000
097800                                                                  09880000
097900     MOVE PV-LINE-CNT              TO  PV-LINE-CNT-AHEAD.         09890000
098000     ADD +8                        TO  PV-LINE-CNT-AHEAD.         09900000
098100     IF PV-LINE-CNT-AHEAD          > PC-LINE-LIMIT                09910000
098200         PERFORM 8000-PRINT-HEADINGS                              09920000
098300     END-IF.                                                      09930000
098400                                                                  09940000
098500     MOVE EPTRN-STR-NBR            TO HL3-STORE.                  09950000
098700     MOVE +4                       TO PV-LINE-SPACING.            09970000
098800     MOVE HL3-HEADING-LINE-3       TO PV-PRINT-RECORD.            09980000
098900     PERFORM 8200-WRITE-REPORT-LINE.                              09990000
099000                                                                  10000000
099100******************************************************************10010000
099200*  PRINT THE STORE TOTAL LINE INFORMATION                         10020000
099300******************************************************************10030000
099400 5200-PRINT-STORE-TOTAL-LINE.                                     10040000
099500                                                                  10050000
099600     IF PV-LINE-CNT                > PC-LINE-LIMIT                10060000
099700         PERFORM 8000-PRINT-HEADINGS                              10070000
099800     END-IF.                                                      10080000
099900                                                                  10090000
100000     MOVE PV-HOLD-STORE            TO HL6-STORE.                  10100000
100100     MOVE PV-SLS-DATE-FORMATTED    TO HL6-DATE.                   10110000
100200                                                                  10120000
100300     IF PA-STORE-SALES-AMOUNT      > ZERO                         10130000
100400         MOVE PA-STORE-SALES-AMOUNT                               10140000
100500                                   TO PV-AMOUNT-FORMATTED         10150000
100600         MOVE PV-AMOUNT-FORMATTED  TO HL6-SALES-TOTAL             10160000
100700     ELSE                                                         10170000
100800         MOVE SPACE                TO HL6-SALES-TOTAL             10180000
100900     END-IF.                                                      10190000
101000                                                                  10200000
101100     ADD  PA-STORE-SALES-AMOUNT    TO PA-COMPANY-SALES-AMOUNT.    10210000
101200                                                                  10220000
101300     IF PA-STORE-RETURN-AMOUNT     < ZERO                         10230000
101400         MOVE PA-STORE-RETURN-AMOUNT                              10240000
101500                                   TO PV-AMOUNT-FORMATTED         10250000
101600         MOVE PV-AMOUNT-FORMATTED  TO HL6-RETURN-TOTAL            10260000
101700     ELSE                                                         10270000
101800         MOVE SPACE                TO HL6-RETURN-TOTAL            10280000
101900     END-IF.                                                      10290000
102000                                                                  10300000
102100     ADD PA-STORE-RETURN-AMOUNT    TO PA-COMPANY-RETURN-AMOUNT.   10310000
102200     COMPUTE PV-AMOUNT             = PA-STORE-RETURN-AMOUNT       10320000
102300                                   + PA-STORE-SALES-AMOUNT.       10330000
102400     MOVE PV-AMOUNT                TO PV-AMOUNT-FORMATTED.        10340000
102500     MOVE PV-AMOUNT-FORMATTED      TO HL6-NET-AMOUNT.             10350000
102600     MOVE +2                       TO PV-LINE-SPACING.            10360000
102700     MOVE HL6-HEADING-LINE-6       TO PV-PRINT-RECORD.            10370000
102800     PERFORM 8200-WRITE-REPORT-LINE.                              10380000
102900                                                                  10390000
103000******************************************************************10400000
103100* 8000-PRINT-HEADINGS                                             10410000
103200*     PRINT THE HEADINGS FOR THE REPORT.                          10420000
103300******************************************************************10430000
103400 8000-PRINT-HEADINGS.                                             10440000
103500                                                                  10450000
103600     ADD +1                        TO PV-PAGE-CNT.                10460000
103700     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       10470000
103800     MOVE DP132-STANDRD-HEADER-132-COLS                           10480000
103900                                   TO PV-PRINT-RECORD.            10490000
104000     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          10500000
104100                                                                  10510000
104200     MOVE HL2-HEADING-LINE-2       TO PV-PRINT-RECORD.            10520000
104300     MOVE +1                       TO PV-LINE-SPACING.            10530000
104400     PERFORM 8200-WRITE-REPORT-LINE.                              10540000
104500                                                                  10550000
104600     MOVE +2                       TO PV-LINE-SPACING.            10560000
104700     MOVE HL4-HEADING-LINE-4       TO PV-PRINT-RECORD.            10570000
104800     PERFORM 8200-WRITE-REPORT-LINE.                              10580000
104900                                                                  10590000
105000     MOVE +1                       TO PV-LINE-SPACING.            10600000
105100     MOVE HL5-HEADING-LINE-5       TO PV-PRINT-RECORD.            10610000
105200     PERFORM 8200-WRITE-REPORT-LINE.                              10620000
105300     MOVE +2                       TO PV-LINE-SPACING.            10630000
105400                                                                  10640000
105500 EJECT                                                            10650000
105600                                                                  10660000
105700******************************************************************10670000
105800* 8100-WRITE-RPT-TOP-OF-PAGE                                      10680000
105900*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   10690000
106000******************************************************************10700000
106100 8100-WRITE-RPT-TOP-OF-PAGE.                                      10710000
106200                                                                  10720000
106300     WRITE PAYPAL-REPORT-RECORD                                   10730000
106400       FROM PV-PRINT-RECORD                                       10740000
106500         AFTER ADVANCING PAGE.                                    10750000
106600     MOVE +1                       TO PV-LINE-CNT.                10760000
106700 EJECT                                                            10770000
106800                                                                  10780000
106900******************************************************************10790000
107000* 8200-WRITE-REPORT-LINE                                          10800000
107100*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             10810000
107200******************************************************************10820000
107300 8200-WRITE-REPORT-LINE.                                          10830000
107400                                                                  10840000
107500     WRITE PAYPAL-REPORT-RECORD                                   10850000
107600       FROM PV-PRINT-RECORD                                       10860000
107700         AFTER ADVANCING PV-LINE-SPACING.                         10870000
107800                                                                  10880000
107900     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          10890000
108000 EJECT                                                            10900000
108100                                                                  10910000
108200******************************************************************10920000
108300* 9100-SQL-ABEND                                                  10930000
108400*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.10940000
108500******************************************************************10950000
108600 9100-SQL-ABEND.                                                  10960000
108700     DISPLAY '** ABEND     **'.                                   10970000
108800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10980000
108900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10990000
109000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               11000000
109100                                                                  11010000
109200******************************************************************11020000
109300* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     11030000
109400* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      11040000
109500******************************************************************11050000
109600     COPY DPPD004.                                                11060000
109700                                                                  11070000
109800     SET AC-DB2-ERROR TO TRUE.                                    11080000
109900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         11090000
110000                                                                  11100000
110100******************************************************************11110000
110200* 9999-ABEND                                                      11120000
110300*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  11130000
110400******************************************************************11140000
110500 9999-ABEND.                                                      11150000
110600     DISPLAY '** ABEND           **'.                             11160000
110700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  11170000
110800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        11180000
110900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       11190000
111000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       11200000
111100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         11210000
