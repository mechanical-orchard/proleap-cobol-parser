000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS067.                                         00040000
000500 AUTHOR.        JIM SCHNEIDER.                                    00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  02-06-95.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    W067 - ADDITIONAL PO INFORMATION MENU PROGRAM              * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAYS A MENU. IT ALLOWS THE USER TO        * 00130000
001400*    TRANSFER CONTROL TO ONE OF SIX DIFFERENT SCREENS.          * 00140000
001500*                                                               * 00150000
001600*    THE PROGRAM CAN ALSO ACCEPT PO'S FROM A LIST OR CRITERIA   * 00160000
001700*    SPEC PROGRAM.                                              * 00170000
001800*---------------------------------------------------------------* 00180000
C98147* DATE     WHO      DESCRIPTION                                   00181022
C98147* 11/07/14 TKMAB17  EXPANDED PO NUMBER TO 8 DIGITS                00182022
C98147*                                    CHANGE TAG :C98147           00183022
C98147*                                           CR# :CHG0098147       00184022
001700* 03/2021  JEAN KURK  REMOVE DB2 TABLE TPORESV                    00184124
001800*---------------------------------------------------------------* 00185024
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00186027
CICS  *                                                               * 00187026
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00188026
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00189026
CICS  *---------------------------------------------------------------* 00189126
001800*                                                               * 00189226
001900 ENVIRONMENT DIVISION.                                            00190000
002000 DATA DIVISION.                                                   00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200*                                                                 00220000
002300 01  PC-PROGRAM-CONSTANTS.                                        00230000
002400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'PO067A  '. 00240000
002500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'POKM067 '. 00250000
002600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'POKCS067'. 00260000
002700     05  PC-TSYMSG-NUMBERS.                                       00270000
002800         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00280000
002900         10  PC-TSYMSG-00083       PIC  9(05)  VALUE  00083.      00290000
003000         10  PC-TSYMSG-00984       PIC  9(05)  VALUE  00984.      00300000
003100         10  PC-TSYMSG-00148       PIC  9(05)  VALUE  00148.      00310000
003200         10  PC-TSYMSG-00069       PIC  9(05)  VALUE  00069.      00320000
003300         10  PC-TSYMSG-00070       PIC  9(05)  VALUE  00070.      00330000
003400         10  PC-TSYMSG-01189       PIC  9(05)  VALUE  01189.      00340000
003500     05  PC-INTER-APPL-CODES.                                     00350000
003600         10  PC-INTER-APPL-CRIT       PIC X(01)  VALUE ' '.       00360000
003700         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '1'.       00370000
003800     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00380000
003900                                                 COMP.            00390000
004000*                                                                 00400000
004100 01  PS-PROGRAM-SWITCHES.                                         00410000
004200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00420000
004300         88  PS-ERROR                          VALUE  'Y'.        00430000
004400         88  PS-NO-ERROR                       VALUE  'N'.        00440000
004500     05  PS-COMMAREA-SW            PIC  X(01)  VALUE  'N'.        00450000
004600         88  PS-COMMAREA-VALID                 VALUE  'Y'.        00460000
004700         88  PS-COMMAREA-NOT-VALID             VALUE  'N'.        00470000
004800     05  PS-LIST-END-SW            PIC X(01)   VALUE  'N'.        00480000
004900         88  PS-LIST-END                       VALUE  'Y'.        00490000
005000         88  PS-NO-LIST-END                    VALUE  'N'.        00500000
005100                                                                  00510000
005200 01  PV-PROGRAM-VARIABLES.                                        00520000
005300     05  PV-DB2-COUNT              PIC S9(09)  VALUE +0           00530000
005400                                               COMP-3.            00540000
C98147     05  PV-PO-NUMBER              PIC 9(08)   VALUE ZERO.        00550022
005600                                                                  00560000
005700     05  PV-CICS-RESPONSE          PIC S9(04) VALUE +0            00570000
005800                                               COMP SYNC.         00580000
005900     05  PV-RETRY-COUNTER          PIC S9(04) VALUE +0            00590000
006000                                               COMP SYNC.         00600000
006100*----------------------------------------------------------------*00610000
006200*    MAP LAYOUT                                                  *00620000
006300*----------------------------------------------------------------*00630000
006400     COPY POKM067.                                                00640000
006500     EJECT                                                        00650000
006600*----------------------------------------------------------------*00660000
006700*    ATTRIBUTE SETTINGS COPYBOOK.                                *00670000
006800*----------------------------------------------------------------*00680000
006900     COPY DPWS015.                                                00690000
007000 EJECT                                                            00700000
007100*----------------------------------------------------------------*00710000
007200*    FUNCTION KEYS COPYBOOK                                      *00720000
007300*----------------------------------------------------------------*00730000
007400     COPY DPWS016.                                                00740000
007500 EJECT                                                            00750000
007600*----------------------------------------------------------------*00760000
007700*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *00770000
007800*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *00780000
007900*----------------------------------------------------------------*00790000
008000     COPY POWS012.                                                00800000
008100 EJECT                                                            00810000
008200******************************************************************00820000
008300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00830000
008400** SUB-ROUTINE (DPKUT100).                                      **00840000
008500******************************************************************00850000
008600     COPY DPWS010I.                                               00860000
008700 EJECT                                                            00870000
008800******************************************************************00880000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **00890026
009100******************************************************************00910000
009200     COPY DPWS030.                                                00920000
CICS       COPY DPWS930.                                                00921026
009300 EJECT                                                            00930000
009400***************************************************************** 00940000
009500*    STANDARD COMMAREA.                                           00950000
009600***************************************************************** 00960000
009700                                                                  00970000
009800     COPY DPWS020.                                                00980000
009900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00990000
010000                                                                  01000000
010100***************************************************************** 01010000
010200*    INTER-APPLICATION COMMAREA.                                  01020000
010300***************************************************************** 01030000
010400                                                                  01040000
010500         10  INTER-APPL-COMM-AREA PIC X(200).                     01050000
010600     COPY POWS017.                                                01060000
010600     COPY POWS011.                                                01061001
010700     COPY POWS013.                                                01070000
010800     COPY APWS300.                                                01080000
010900     COPY VLWS005.                                                01090000
011000***************************************************************** 01100000
011100*    SPECIFIC COMMMAREA FOR POKCS067.                             01110000
011200***************************************************************** 01120000
011300         10  ASC-SPECIFIC-COMMAREA.                               01130000
011400             15  ASC-USE-SELECTION-QUEUE-IND                      01140000
011500                                           PIC X(01).             01150000
011600                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        01160000
011700             15  ASC-SEL-QUEUE-NAME        PIC X(08).             01170000
011800             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01180000
011900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01190000
012000                                           PIC S9(09) COMP-3.     01200000
012100             15  ASC-SEL-SUB               PIC S9(04) COMP.       01210000
012200             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01220000
012300             15  ASC-PO-NBR                PIC  S9(9) COMP.       01230000
012400             15  ASC-VDR-NAME              PIC  X(30).            01240000
012500             15  ASC-DEPT-NBR              PIC  X(03).            01250000
012600             15  ASC-PREV-SCREEN           PIC  X(01).            01260000
012700                 88 ASC-LIST               VALUE 'Y'.             01270000
012800                 88 ASC-CRIT               VALUE 'N'.             01280000
012900 EJECT                                                            01290000
013000*----------------------------------------------------------------*01300000
013100*    ABEND PROCESSING COPYBOOK.                                  *01310000
013200*----------------------------------------------------------------*01320000
013300     COPY DPWS013.                                                01330000
013400                                                                  01340000
013500*---------------------------------------------------------------* 01350000
013600*    DB2 AREA FOR TPURCHS TABLE                                 * 01360000
013700*---------------------------------------------------------------* 01370000
013800     EXEC SQL                                                     01380000
013900          INCLUDE TPURCHS                                         01390000
014000     END-EXEC.                                                    01400000
014100*---------------------------------------------------------------* 01410000
014200*    DB2 AREA FOR TENTNME TABLE                                 * 01420000
014300*---------------------------------------------------------------* 01430000
014400     EXEC SQL                                                     01440000
014500          INCLUDE TENTNME                                         01450000
014600     END-EXEC.                                                    01460000
014700*---------------------------------------------------------------* 01470000
014800*    DB2 AREA FOR TPORESV TABLE                                 * 01480000
014900*---------------------------------------------------------------* 01490000
015000*    EXEC SQL                                                     01500023
015100*         INCLUDE TPORESV                                         01510023
015200*    END-EXEC.                                                    01520023
015300*---------------------------------------------------------------* 01530000
015400*    DB2 AREA FOR COMMUNICATIONS                                * 01540000
015500*---------------------------------------------------------------* 01550000
015600     EXEC SQL                                                     01560000
015700          INCLUDE SQLCA                                           01570000
015800     END-EXEC.                                                    01580000
015900*---------------------------------------------------------------* 01590000
016000 EJECT                                                            01600000
016100 LINKAGE SECTION.                                                 01610000
016200                                                                  01620000
016300 01  DFHCOMMAREA.                                                 01630000
016400     05  FILLER                         OCCURS  1 TO 4072 TIMES   01640000
016500                                        DEPENDING ON EIBCALEN.    01650000
016600         10  FILLER                     PIC X.                    01660000
016700                                                                  01670000
016800 PROCEDURE DIVISION.                                              01680000
016900***************************************************************** 01690000
017000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01700000
017100** THE SETUP AND PERFORM OF PARAGRAPH 9000-CALL-CICS-ARCH-API  ** 01710000
017200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01720000
017300**                                                             ** 01730000
017400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01740000
017500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01750000
017600***************************************************************** 01760000
017700 0000-MAIN-MODULE.                                                01770000
017800     INITIALIZE DP030-CICS-API-FIELDS.                            01780000
017900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01790000
018000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01800000
018100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01810000
018200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01820000
018300     MOVE LENGTH OF PO067AI        TO DP030-MAP-LENGTH (1).       01830000
018400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01840000
018500     PERFORM 9000-CALL-CICS-ARCH-API.                             01850000
018600                                                                  01860000
018700     PERFORM 1000-CONTROL-PROCESSING                              01870000
018800                                                                  01880000
018900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01890000
019000     PERFORM 9000-CALL-CICS-ARCH-API.                             01900000
019100*----------------------------------------------------------------*01910000
019200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01920000
019300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01930000
019400*----------------------------------------------------------------*01940000
019500 1000-CONTROL-PROCESSING.                                         01950000
019600                                                                  01960000
019700     EVALUATE TRUE                                                01970000
019800         WHEN DP020-NEXT-ACT-INITIAL                              01980000
019900             INITIALIZE ASC-SPECIFIC-COMMAREA                     01990000
020000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 02000000
020100             IF  PS-COMMAREA-VALID                                02010000
020200                 PERFORM 4000-BUILD-INITIAL-PANEL                 02020000
020300             END-IF                                               02030000
020400                                                                  02040000
020500         WHEN DP020-NEXT-ACT-READ-MAP                             02050000
020600             PERFORM 2000-FKEY-PROCESSING                         02060000
020700                                                                  02070000
020800         WHEN DP020-NEXT-ACT-RETURN                               02080000
020900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02090000
021000                                                                  02100000
021100         WHEN OTHER                                               02110000
021200             SET DP013-LOGIC-ABEND                                02120000
021300                 DP013-NO-ROLLBACK TO TRUE                        02130000
021400             MOVE '1000-CONTROL-PROCESSING'                       02140000
021500                                   TO  DP013-PARAGRAPH            02150000
021600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02160000
021700                                   TO  DP013-MESSAGE-TEXT(1)      02170000
021800             MOVE DP020-NEXT-APPL-ACTIVITY                        02180000
021900                                   TO DP013-MESSAGE-TEXT(2)       02190000
022000             PERFORM DP013-0000-PROCESS-ABEND                     02200000
022100     END-EVALUATE.                                                02210000
022200*----------------------------------------------------------------*02220000
022300*    VERIFY PO NUMBER IS VALID, PROCESS INTER-APPL-LIST          *02230000
022400*----------------------------------------------------------------*02240000
022500 1100-PROCESS-INTER-APPL-COMM.                                    02250000
022600                                                                  02260000
022700     EVALUATE DP020-INT-APPL-FORMAT-IND                           02270000
022800                                                                  02280000
022900         WHEN PC-INTER-APPL-CRIT                                  02290000
023000             SET ASC-CRIT        TO TRUE                          02300000
023100             PERFORM 1200-SELECT-TPURCHS                          02310000
023200                                                                  02320000
023300             IF PV-DB2-COUNT > 0                                  02330000
023400                SET PS-COMMAREA-VALID     TO TRUE                 02340000
023500             ELSE                                                 02350000
024700                MOVE PC-TSYMSG-00083 TO DP020-MSG-NUMBER          02351025
024800                SET PS-ERROR                                      02352025
024900                    PS-COMMAREA-NOT-VALID                         02353025
025000                    DP020-NEXT-ACT-APPL-ERROR                     02354025
025100                    DP020-MSG-FATAL                               02355025
025200                                 TO TRUE                          02356025
025400             END-IF                                               02358025
023600*                PERFORM 1250-CHECK-TPORESV                       02360023
023700*                IF  SQLCODE = +0                                 02370023
023800*                    MOVE PORESV-DEPT-NBR TO DP020-MSG-TEXT       02380023
023900*                    MOVE PC-TSYMSG-01189                         02390023
024000*                                TO DP020-MSG-NUMBER              02400023
024100*                    SET PS-ERROR                                 02410023
024200*                        PS-COMMAREA-NOT-VALID                    02420023
024300*                        DP020-NEXT-ACT-APPL-ERROR                02430023
024400*                        DP020-MSG-FATAL                          02440023
024500*                                TO TRUE                          02450023
024600*                ELSE                                             02460023
024700*                    MOVE PC-TSYMSG-00083 TO DP020-MSG-NUMBER     02470025
024800*                    SET PS-ERROR                                 02480025
024900*                        PS-COMMAREA-NOT-VALID                    02490025
025000*                        DP020-NEXT-ACT-APPL-ERROR                02500025
025100*                        DP020-MSG-FATAL                          02510025
025200*                                TO TRUE                          02520025
025300*                END-IF                                           02530023
025400*            END-IF                                               02540025
025500         WHEN PC-INTER-APPL-LIST                                  02550000
025600             SET PS-COMMAREA-VALID         TO TRUE                02560000
025700             SET ASC-USE-SELECTION-QUEUE                          02570000
025800                                 TO TRUE                          02580000
025900             SET ASC-LIST        TO TRUE                          02590000
026000             MOVE PO013-NUMBER-OF-SELECTED-ITEMS                  02600000
026100                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  02610000
026200             MOVE PO013-NUMBER-OF-TS-ITEMS                        02620000
026300                                 TO ASC-NUMBER-OF-TS-ITEMS        02630000
026400             MOVE PO013-SEL-QUEUE-NAME                            02640000
026500                                 TO ASC-SEL-QUEUE-NAME            02650000
026600             PERFORM 1120-PREPARE-LIST-ENTRY                      02660000
026700                                                                  02670000
026800         WHEN OTHER                                               02680000
026900             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             02690000
027000             SET PS-ERROR                                         02700000
027100                 PS-COMMAREA-NOT-VALID                            02710000
027200                 DP020-MSG-FATAL                                  02720000
027300                 DP020-NEXT-ACT-APPL-ERROR                        02730000
027400                                 TO TRUE                          02740000
027500     END-EVALUATE.                                                02750000
027600*----------------------------------------------------------------*02760000
027700*    ENTRY IS FROM A LIST.  GET THE PO NUMBER FROM THE           *02770000
027800*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *02780000
027900*----------------------------------------------------------------*02790000
028000 1120-PREPARE-LIST-ENTRY.                                         02800000
028100                                                                  02810000
028200     MOVE PO012-MAX-ITEMS          TO ASC-SEL-SUB.                02820000
028300     MOVE ZERO                     TO ASC-SEL-ITEM.               02830000
028400     PERFORM 2115-GET-NEXT-PO.                                    02840000
028500*----------------------------------------------------------------*02850000
028600*    SELECT TPURCHS TABLE (VERIFY PO NUMBER IS VALID)            *02860000
028700*----------------------------------------------------------------*02870000
028800 1200-SELECT-TPURCHS.                                             02880000
028900                                                                  02890000
029000     MOVE PO017-PO-NBR TO ASC-PO-NBR.                             02900000
029100     MOVE ZEROES TO PV-DB2-COUNT.                                 02910000
029200                                                                  02920000
029300     EXEC SQL                                                     02930000
029400         SELECT COUNT(*)                                          02940000
029500         INTO :PV-DB2-COUNT                                       02950000
029600         FROM TPURCHS                                             02960000
029700         WHERE PO_NBR = :ASC-PO-NBR AND                           02970000
029800               VER_STATUS_CDE = 'A'                               02980000
029900     END-EXEC                                                     02990000
030000                                                                  03000000
030100     EVALUATE TRUE                                                03010000
030200         WHEN SQLCODE = +0                                        03020000
030300         WHEN SQLCODE = +100                                      03030000
030400              CONTINUE                                            03040000
030500         WHEN SQLCODE = -904                                      03050000
030600         WHEN SQLCODE = -911                                      03060000
030700         WHEN SQLCODE = -913                                      03070000
030800              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       03080000
030900              SET PS-ERROR                                        03090000
031000                  DP020-NEXT-ACT-APPL-ERROR                       03100000
031100                  DP020-MSG-FATAL                                 03110000
031200                      TO TRUE                                     03120000
031300              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 03130000
031400              PERFORM 9000-CALL-CICS-ARCH-API                     03140000
031500                                                                  03150000
031600         WHEN SQLWARN0 NOT = SPACES                               03160000
031700         WHEN SQLCODE < +0                                        03170000
031800         WHEN SQLCODE > +0                                        03180000
031900              MOVE '1200-SELECT-TPURCHS'                          03190000
032000                              TO DP013-PARAGRAPH                  03200000
032100              MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'               03210000
032200                              TO DP013-MESSAGE-TEXT (1)           03220000
032300              MOVE SQLCA      TO DP013-SQLCA                      03230000
032400              MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)         03240000
032500              SET DP013-DB2-ABEND                                 03250000
032600                  DP013-XCTL-DISPLAY-RESTART                      03260000
032700                              TO TRUE                             03270000
032800              PERFORM DP013-0000-PROCESS-ABEND                    03280000
032900     END-EVALUATE.                                                03290000
033000                                                                  03300000
033100*----------------------------------------------------------------*03310000
033200*    CHECK TO SEE IF THE PO NUMBER EXISTS ON TPORESV             *03320000
033300*----------------------------------------------------------------*03330000
033400*1250-CHECK-TPORESV.                                              03340023
033500*                                                                 03350023
033600*    PERFORM                                                      03360023
033700*        WITH TEST AFTER                                          03370023
033800*        VARYING PV-RETRY-COUNTER                                 03380023
033900*        FROM 1 BY 1                                              03390023
034000*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03400023
034100*            OR (SQLCODE = +0)                                    03410023
034200*            OR (SQLCODE = +100))                                 03420023
034300*                                                                 03430023
034400*        EXEC SQL                                                 03440023
034500*             SELECT DEPT_NBR                                     03450023
034600*               INTO :PORESV-DEPT-NBR                             03460023
034700*               FROM TPORESV                                      03470023
034800*              WHERE RSVD_PO_NBR    = :ASC-PO-NBR                 03480023
034900*        END-EXEC                                                 03490023
035000*                                                                 03500023
035100*        EVALUATE TRUE                                            03510023
035200*            WHEN SQLCODE = +0                                    03520023
035300*            WHEN SQLCODE = +100                                  03530023
035400*            WHEN SQLCODE = -904                                  03540023
035500*            WHEN SQLCODE = -913                                  03550023
035600*                 CONTINUE                                        03560023
035700*                                                                 03570023
035800*            WHEN SQLWARN0 NOT = SPACES                           03580023
035900*            WHEN SQLCODE < +0                                    03590023
036000*            WHEN SQLCODE > +0                                    03600023
036100*                 MOVE '1250-CHECK-TPORESV'                       03610023
036200*                                 TO DP013-PARAGRAPH              03620023
036300*                 MOVE 'UNSUCCESSFUL SELECT ON PO RESERVATION'    03630023
036400*                                 TO DP013-MESSAGE-TEXT (1)       03640023
036500*                 MOVE SQLCA      TO DP013-SQLCA                  03650023
036600*                 MOVE 'TPORESV ' TO DP013-DB2-TABLE-NAME (1)     03660023
036700*                 SET DP013-DB2-ABEND                             03670023
036800*                     DP013-XCTL-DISPLAY-RESTART                  03680023
036900*                                 TO TRUE                         03690023
037000*                 PERFORM DP013-0000-PROCESS-ABEND                03700023
037100*        END-EVALUATE                                             03710023
037200*    END-PERFORM.                                                 03720023
037300*                                                                 03730023
037400*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03740023
037500*        MOVE '1250-CHECK-TPORESV' TO DP013-PARAGRAPH             03750023
037600*        MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         03760023
037700*                                 TO DP013-MESSAGE-TEXT (1)       03770023
037800*        MOVE SQLCA               TO DP013-SQLCA                  03780023
037900*        MOVE 'TPORESV '          TO DP013-DB2-TABLE-NAME (1)     03790023
038000*        SET DP013-DB2-ABEND                                      03800023
038100*            DP013-XCTL-DISPLAY-RESTART                           03810023
038200*                                 TO TRUE                         03820023
038300*        PERFORM DP013-0000-PROCESS-ABEND                         03830023
038400*    END-IF.                                                      03840023
038500                                                                  03850000
038600*----------------------------------------------------------------*03860000
038700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03870000
038800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03880000
038900* EDITS.                                                         *03890000
039000*----------------------------------------------------------------*03900000
039100 2000-FKEY-PROCESSING.                                            03910000
039200                                                                  03920000
039300     EVALUATE TRUE                                                03930000
039400                                                                  03940000
039500         WHEN DP020-SRC-AID = DP016-CLEAR                         03950000
039600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03960000
039700                                                                  03970000
039800         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03980000
039900             PERFORM 4000-BUILD-INITIAL-PANEL                     03990000
040000                                                                  04000000
040100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04010000
040200             IF  ASC-USE-SELECTION-QUEUE                          04020000
040300                 PERFORM 2115-GET-NEXT-PO                         04030000
040400                 IF PS-LIST-END                                   04040000
040500                    SET PS-NO-LIST-END                            04050000
040600                                   TO TRUE                        04060000
040700                 ELSE                                             04070000
040800                    PERFORM 4000-BUILD-INITIAL-PANEL              04080000
040900                 END-IF                                           04090000
041000             ELSE                                                 04100000
041100*                --- BOTTOM OF LIST ---                           04110000
041200                 MOVE PC-TSYMSG-00070                             04120000
041300                                   TO DP020-MSG-NUMBER            04130000
041400                 SET DP020-MSG-INFORMATIONAL                      04140000
041500                     PS-LIST-END   TO TRUE                        04150000
041600             END-IF                                               04160000
041700                                                                  04170000
041800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04180000
041900             IF  ASC-USE-SELECTION-QUEUE                          04190000
042000                 PERFORM 2120-GET-PREV-PO                         04200000
042100                 IF PS-LIST-END                                   04210000
042200                    SET PS-NO-LIST-END                            04220000
042300                                   TO TRUE                        04230000
042400                 ELSE                                             04240000
042500                    PERFORM 4000-BUILD-INITIAL-PANEL              04250000
042600                 END-IF                                           04260000
042700             ELSE                                                 04270000
042800*                --- TOP OF LIST ---                              04280000
042900                 MOVE PC-TSYMSG-00069                             04290000
043000                                   TO DP020-MSG-NUMBER            04300000
043100                 SET DP020-MSG-INFORMATIONAL                      04310000
043200                     PS-LIST-END   TO TRUE                        04320000
043300             END-IF                                               04330000
043400                                                                  04340000
043500         WHEN OTHER                                               04350000
043600             SET DP030-CONTINUE-GO TO TRUE                        04360000
043700             PERFORM 2100-CHECK-FUNCTION-KEY                      04370000
043800     END-EVALUATE.                                                04380000
043900******************************************************************04390000
044000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04400000
044100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04410000
044200** FROM THE CICS ARCHITECTURE API.                              **04420000
044300******************************************************************04430000
044400 2100-CHECK-FUNCTION-KEY.                                         04440000
044500     EVALUATE TRUE                                                04450000
044600         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 04460000
044700             PERFORM 2110-PREPARE-INTER-APPL-COMM                 04470000
044800                                                                  04480000
044900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04490000
045000             INITIALIZE VL005-INTER-APPL-COMMAREA                 04500000
045100             MOVE ASC-PO-NBR               TO VL005-PO-NUMBER     04510000
045101                                                                  04510100
045102*RS ADDED 2/9 2 LINES                                             04510200
045110         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04510300
045120             INITIALIZE PO011-INTER-APPL-COMMAREA                 04510401
                   MOVE ASC-PO-NBR               TO PO011-PO-NBR        04510602
                   MOVE ASC-VDR-NAME             TO PO011-VENDOR-NAME   04510702
                   MOVE ASC-DEPT-NBR             TO PO011-DEPT-NBR      04510802
045200                                                                  04511802
045300         WHEN DP020-SRC-AID = DP016-ENTER                         04511902
045400             CONTINUE                                             04512002
045500                                                                  04512102
045600         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               04512202
045700             CONTINUE                                             04512302
045800                                                                  04512400
045900         WHEN OTHER                                               04513000
046000             SET DP013-NO-ROLLBACK                                04514000
046100                 DP013-XCTL-DISPLAY-RESTART                       04515000
046200                 DP013-CICS-ABEND  TO TRUE                        04516000
046300             MOVE '2100-CHECK-FUNCTION-KEY'                       04517000
046400                                   TO DP013-PARAGRAPH             04518000
046500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04519000
046600                                   TO DP013-MESSAGE-TEXT (1)      04520000
046700             PERFORM DP013-0000-PROCESS-ABEND                     04530000
046800     END-EVALUATE.                                                04540000
046900*----------------------------------------------------------------*04550000
047000** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **04560000
047100** INTER-APPLICATION COMMAREA.                                  **04570000
047200*----------------------------------------------------------------*04580000
047300 2110-PREPARE-INTER-APPL-COMM.                                    04590000
047400     INITIALIZE PO017-INTER-APPL-COMMAREA.                        04600019
047500     MOVE ASC-PO-NBR               TO PO017-PO-NBR.               04610000
047600     MOVE ASC-VDR-NAME             TO PO017-ENT-NAME-DESC.        04620000
047610     MOVE ASC-DEPT-NBR             TO PO017-DEPT-NBR.             04630000
           IF DP020-SRC-AID = DP016-PF18                                04631021
               INITIALIZE AP300-INTER-APPL-COMMAREA                     04632017
047700         MOVE ASC-PO-NBR           TO AP300-PO-NBR                04640017
047800         INITIALIZE                   AP300-INVC-TYP-CDE          04650017
033200                                      AP300-DUN-NBR               04651016
033300                                      AP300-INVC-ID               04652016
033500                                      AP300-INVC-STATUS           04654016
033600                                      AP300-SELCTN-DTE            04655017
033400                                      AP300-STORE-NBR             04657017
           END-IF.                                                      04658017
047900 EJECT                                                            04660000
048000*----------------------------------------------------------------*04670000
048100*    GET THE PO NUMBER (KEY) OF THE NEXT SELECTED OBJECT         *04680000
048200*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *04690000
048300*----------------------------------------------------------------*04700000
048400 2115-GET-NEXT-PO.                                                04710000
048500                                                                  04720000
048600     ADD +1                        TO ASC-SEL-SUB.                04730000
048700     IF  ASC-SEL-SUB > PO012-MAX-ITEMS                            04740000
048800         ADD +1                    TO ASC-SEL-ITEM                04750000
048900         MOVE +1                   TO ASC-SEL-SUB                 04760000
049000     END-IF.                                                      04770000
049100                                                                  04780000
049200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04790000
049300         PERFORM 9100-READ-SEL-QUEUE                              04800000
049400         IF  PO012-ITEM (ASC-SEL-SUB) > ZERO                      04810000
049500             MOVE PO012-PO-NBR (ASC-SEL-SUB)                      04820000
049600                                   TO ASC-PO-NBR                  04830000
049700             SET PO012-INQ (ASC-SEL-SUB)                          04840000
049800                                   TO TRUE                        04850000
049900             PERFORM 9200-REWRITE-SEL-QUEUE                       04860000
050000         ELSE                                                     04870000
050100             SUBTRACT +1 FROM ASC-SEL-SUB                         04880000
050200*            --- BOTTOM OF LIST ---                               04890000
050300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04900000
050400             SET DP020-MSG-INFORMATIONAL                          04910000
050500                 PS-LIST-END                                      04920000
050600                                   TO TRUE                        04930000
050700         END-IF                                                   04940000
050800     ELSE                                                         04950000
050900         SUBTRACT +1 FROM ASC-SEL-ITEM                            04960000
051000         MOVE PO012-MAX-ITEMS      TO ASC-SEL-SUB                 04970000
051100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04980000
051200         SET DP020-MSG-INFORMATIONAL                              04990000
051300             PS-LIST-END                                          05000000
051400                                   TO TRUE                        05010000
051500     END-IF.                                                      05020000
051600*----------------------------------------------------------------*05030000
051700*    GET THE PO NUMBER (KEY) OF THE PREVIOUS SELECTED            *05040000
051800*    OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *05050000
051900*----------------------------------------------------------------*05060000
052000 2120-GET-PREV-PO.                                                05070000
052100                                                                  05080000
052200     SUBTRACT +1 FROM ASC-SEL-SUB.                                05090000
052300     IF  ASC-SEL-SUB < +1                                         05100000
052400         SUBTRACT +1 FROM ASC-SEL-ITEM                            05110000
052500         MOVE PO012-MAX-ITEMS      TO ASC-SEL-SUB                 05120000
052600     END-IF.                                                      05130000
052700                                                                  05140000
052800     IF  ASC-SEL-ITEM > ZERO                                      05150000
052900         PERFORM 9100-READ-SEL-QUEUE                              05160000
053000         MOVE PO012-PO-NBR (ASC-SEL-SUB)                          05170000
053100                                   TO ASC-PO-NBR                  05180000
053200     ELSE                                                         05190000
053300         MOVE +1                   TO ASC-SEL-ITEM                05200000
053400                                      ASC-SEL-SUB                 05210000
053500*        --- TOP OF LIST ---                                      05220000
053600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05230000
053700         SET DP020-MSG-INFORMATIONAL                              05240000
053800             PS-LIST-END           TO TRUE                        05250000
053900     END-IF.                                                      05260000
054000                                                                  05270000
054100*----------------------------------------------------------------*05280000
054200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *05290000
054300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *05300000
054400*  IT HERE.                                                      *05310000
054500*----------------------------------------------------------------*05320000
054600 4000-BUILD-INITIAL-PANEL.                                        05330000
054700                                                                  05340000
054800     EVALUATE TRUE                                                05350000
054900        WHEN ASC-CRIT                                             05360000
055000          MOVE PO017-PO-NBR           TO ASC-PO-NBR               05370000
055100        WHEN OTHER                                                05380000
055200          CONTINUE                                                05390000
055300     END-EVALUATE.                                                05400000
055400                                                                  05410000
055500     PERFORM 4100-SELECT-VENDNAME-DEPT.                           05420000
055600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        05430000
055700*----------------------------------------------------------------*05440000
055800* SELECT VENDOR NAME AND PO DEPARTMENT                           *05450000
055900*----------------------------------------------------------------*05460000
056000 4100-SELECT-VENDNAME-DEPT.                                       05470000
056100                                                                  05480000
056200     EXEC SQL                                                     05490000
056300         SELECT ENT_NAME_DESC,                                    05500000
056400                DEPT_NBR                                          05510000
056500         INTO :ASC-VDR-NAME,                                      05520000
056600              :ASC-DEPT-NBR                                       05530000
056700         FROM TPURCHS A,                                          05540000
056800              TENTNME B                                           05550000
056900         WHERE                                                    05560000
057000              A.PO_NBR = :ASC-PO-NBR   AND                        05570000
057100              A.VER_STATUS_CDE = 'A'   AND                        05580000
057200              A.ENT_ID = B.ENT_ID      AND                        05590000
057300              B.TYPE_CDE = '01'                                   05600000
057400     END-EXEC.                                                    05610000
057500                                                                  05620000
057600     EVALUATE TRUE                                                05630000
057700         WHEN SQLCODE = ZERO                                      05640000
057800              CONTINUE                                            05650000
057900         WHEN SQLCODE = +100                                      05660000
058000              MOVE SPACES TO ASC-VDR-NAME                         05670000
058100         WHEN SQLWARN0 NOT EQUAL SPACE                            05680000
058200         WHEN SQLCODE NOT EQUAL ZERO                              05690000
058300              MOVE '4100-SELECT-VENDNME-DEPT'                     05700000
058400                           TO  DP013-PARAGRAPH                    05710000
058500              MOVE 'SELECT VENDOR NAME'                           05720000
058600                           TO  DP013-MESSAGE-TEXT (1)             05730000
058700              MOVE SQLCA   TO  DP013-SQLCA                        05740000
058800              SET DP013-DB2-ABEND                                 05750000
058900                           TO  TRUE                               05760000
059000              PERFORM DP013-0000-PROCESS-ABEND                    05770000
059100     END-EVALUATE.                                                05780000
059200 EJECT                                                            05790000
059300*----------------------------------------------------------------*05800000
059400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *05810000
059500*----------------------------------------------------------------*05820000
059600 4400-MOVE-COMMAREA-TO-SCREEN.                                    05830000
059700     MOVE ASC-PO-NBR               TO PV-PO-NUMBER.               05840000
059800     MOVE PV-PO-NUMBER             TO APONMBRO.                   05850000
059900     MOVE ASC-VDR-NAME             TO AVDRNAMO.                   05860000
060000     MOVE ASC-DEPT-NBR             TO ADEPTNOO.                   05870000
060100 EJECT                                                            05880000
060200*----------------------------------------------------------------*05890000
060300*    WRITE COMMAREA TO TRANSFER CONTROL TO ANOTHER PROGRAM       *05900000
060400*----------------------------------------------------------------*05910000
060500 9000-CALL-CICS-ARCH-API.                                         05920000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05930026
060700                                    DFHCOMMAREA                   05940026
060800                                    DP030-CICS-API-FIELDS         05950026
060900                                    DP020-STANDARD-COMMAREA       05960026
061000                                    PO067AI.                      05970026
061100     IF  DP030-RC-CALL-SUCCESSFUL                                 05980000
061200         CONTINUE                                                 05990000
061300     ELSE                                                         06000000
061400         SET DP013-NO-ROLLBACK                                    06010000
061500             DP013-XCTL-DISPLAY-RESTART                           06020000
061600             DP013-CICS-ABEND      TO TRUE                        06030000
CICS           MOVE '9000-CALL-CICS-ARCH-API'                           06040026
061800                                   TO DP013-PARAGRAPH             06050000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06060026
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06070026
062100         MOVE DP030-RETURN-CODE                                   06080000
062200                                   TO DP013-MESSAGE-TEXT (3)      06090000
062300         PERFORM DP013-0000-PROCESS-ABEND                         06100000
062400     END-IF.                                                      06110000
062500 EJECT                                                            06120000
062600*----------------------------------------------------------------*06130000
062700*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *06140000
062800*----------------------------------------------------------------*06150000
062900 9100-READ-SEL-QUEUE.                                             06160000
063000     EXEC CICS                                                    06170000
063100         READQ TS                                                 06180000
063200             QUEUE (ASC-SEL-QUEUE-NAME)                           06190000
063300             INTO  (PO012-PO-SELECT-RECORD)                       06200000
063400             ITEM  (ASC-SEL-ITEM)                                 06210000
063500             RESP  (PV-CICS-RESPONSE)                             06220000
063600     END-EXEC.                                                    06230000
063700                                                                  06240000
063800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   06250000
063900         CONTINUE                                                 06260000
064000     ELSE                                                         06270000
064100         SET DP013-LOGIC-ABEND                                    06280000
064200             DP013-NO-ROLLBACK     TO TRUE                        06290000
064300         MOVE '9100-READ-SEL-QUEUE'                               06300000
064400                                   TO DP013-PARAGRAPH             06310000
064500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   06320000
064600                                   TO DP013-MESSAGE-TEXT (1)      06330000
064700         PERFORM DP013-0000-PROCESS-ABEND                         06340000
064800     END-IF.                                                      06350000
064900 EJECT                                                            06360000
065000*----------------------------------------------------------------*06370000
065100*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *06380000
065200*----------------------------------------------------------------*06390000
065300 9200-REWRITE-SEL-QUEUE.                                          06400000
065400     EXEC CICS                                                    06410000
065500          WRITEQ TS                                               06420000
065600              QUEUE  (ASC-SEL-QUEUE-NAME)                         06430000
065700              FROM   (PO012-PO-SELECT-RECORD)                     06440000
065800              ITEM   (ASC-SEL-ITEM)                               06450000
065900              RESP   (PV-CICS-RESPONSE)                           06460000
066000              REWRITE                                             06470000
066100     END-EXEC.                                                    06480000
066200                                                                  06490000
066300     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               06500000
066400         SET DP013-CICS-ABEND                                     06510000
066500             DP013-NO-ROLLBACK     TO TRUE                        06520000
066600         MOVE '9200-REWRITE-SEL-QUEUE'                            06530000
066700                                   TO DP013-PARAGRAPH             06540000
066800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   06550000
066900                                   TO DP013-MESSAGE-TEXT (1)      06560000
067000         PERFORM DP013-0000-PROCESS-ABEND                         06570000
067100     END-IF.                                                      06580000
067200 EJECT                                                            06590000
067300*----------------------------------------------------------------*06600000
067400*    ABEND PROCESSOR MODULE                                      *06610000
067500*----------------------------------------------------------------*06620000
067600     COPY DPPD013.                                                06630000
067700*----------------------------------------------------------------*06640000
