000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT080.                                        00020000
000300 AUTHOR.         CHRIS KUNSTMANN IBS.                             00030000
000400 DATE-WRITTEN.   07/22/1998.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700*    COBOL II / DB2                                             * 00070000
000800*                                                               * 00080000
000900*      FORMAT DATA FOR IMPORT COST VARIANCE REPORTING           * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM REFORMATS AND CONDENSES DATA ON THE APRD031   * 00110000
001200*    FILE AND CREATES FILE APRD036. APRD036 WILL BE USED TO     * 00120000
001300*    PRODUCE REPORTS OF THIS COST VARIANCE DATA. THE FILE WILL  * 00130000
001400*    CONTAIN 1 HEADER RECORD FOR EACH PO AND 1 DETAIL RECORD    * 00140000
001500*    PER PO/COST TYPE.                                          * 00150000
001600*---------------------------------------------------------------* 00160000
001700*                                                               * 00170000
001800* DB2 TABLES:                                                   * 00180000
001900*   ACCOUNT NUMBER/CHARGE TYPE XREF        (TACCTYP)            * 00190000
002000*                                                               * 00200000
002100* INPUT:                                                        * 00210000
002200*   IMPORT PO VARIANCE REPORT DATA         (APRD031)            * 00220000
002300*                                                               * 00230000
002400* OUTPUT:                                                       * 00240000
002500*   IMPORT PO COST VARIANCE REPORT DATA    (APRD036)            * 00250000
002600*                                                               * 00260000
002700* CHANGE LOG:                                                   * 00270000
002800*   7/22/98   CHRIS KUNSTMANN, IBS.      WR4164                 * 00280000
002900*       INITIAL VERSION.                                        * 00290000
003000*                                                               * 00300000
003100*  12/08/99                                                     * 00310000
003200*       ADDED ONE NEW CHARGE CODE: ROY.  ROY IS ROYALTY AND ITS * 00320000
003300*       TOTALS ARE TO APPEAR AFTER AGENT COMMISSION (LCC).      * 00330000
003400*  MADE BY:  MIKE BESKE                       PITS/WR#:20529    * 00340000
003500*                                                               * 00350000
003600*  05/08/00   W A EHMKE                                         * 00360000
003700*       ADD LOGIC TO ACCUMULATE 2 UNIT COSTS. EST-UNT-COST      * 00370000
003800*       AND INV-UNIT-COST.                                        00380000
003900*  MADE BY:  W A EHMKE                        PITS/WR#:20557    * 00390000
004000*                                                               * 00400000
004100*  08/08/2002                                                   * 00410000
004200*       COLBY HANGER EXPENSE PROCESSING.  MODIFIED PROGRAM TO   * 00420000
004300*       PROCESS HANGER CHARGES.  CHANGED WORKING STORAGE AREA   * 00430000
004400*       PC-RPT-SEQ-K1 TO HOLD 'HGR' IN THE COLBY CODE POSITION. * 00440000
004500*  MADE BY:  KEVIN CATLIN                   WR/IR #: 23254      * 00450000
004600*                                                               * 00460000
004700*  11/04/2002                                                   * 00470000
004800*       COLBY DATING PROJECT.  ADDED EFFECTIVE DATING TO THE SQL* 00480000
004900*       FOR TACCTYP IN PARA Z150-.                              * 00490000
005000*  MADE BY:  MIKE BESKE                     WR/IR #: 23750      * 00500000
005100*                                                               * 00510000
005200* DATE  01/26/2005                                              * 00520000
005300*     CHANGE MADE: REMOVED PV-VENDOR-NAME AND ADDED PV-VENDOR-  * 00530000
005400*     NBR TO REPLACE THAT FIELD.  REPLACED THE 88 LEVEL OF THE  * 00540000
005500*     REMOVED FIELD THAT REFERRED TO COLBY WITH AN 88 LEVEL FOR * 00550000
005600*     PV-VENDOR-NBR USING THE VENDOR NUMBER 009206194.          * 00560000
005700*     MADE BY: MIKE BESKE              WR/IR #: WR28114         * 00570000
005800*                                                               * 00580000
005810* DATE  02/04/2008                                              * 00581000
005820*     CHANGE MADE: CREATE FCL REC FOR PRIVATE LABEL ACCOUNTING  * 00582000
005830*     MADE BY: CHRISTINE TWIEHAUS      WR/IR #: WR32664         * 00583000
005840*                                                               * 00584000
005850* DATE  03/16/2009                                              * 00585000
005860*     CHANGE MADE: ADDED LOGIC TO EXTRACT THE DMA (DIVISION)    * 00586000
005861*     FROM TMDSEAR AND PLACE ON THE OUTPUT FILE FOR ALL         * 00586100
005862*     POSTING RECORDS.                                          * 00586200
005863*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31546         * 00586300
005864*                                                               * 00586400
005865* DATE  06/30/2012                                              * 00586500
005866*     CHANGE MADE: ACCEPT THE OPEN ACCOUNT PROCESSING OPTION    * 00586600
005867*     MADE BY: TOM MARTIN              WR/IR #: WR39735         * 00586700
005868*                                                               * 00586800
005869* DATE  07/15/2015                                              * 00586900
005870*     CHANGE MADE: TO INCLUDE MPF FEE IN THE MISCELLANEOUS      * 00587000
005880*                  IMPORT CHARGES BUCKET                        * 00588000
005890*     MADE BY: MEENAKSHI MITTAL        WR/IR #: CHG112172       * 00589000
005891*                                                               * 00589100
005892* DATE  03/14/2023                                              * 00589200
005893*     CHANGE MADE: DIRECT IMPORT PROJECT.                       * 00589300
005894*     ADDED NEW VALUE OF 1NX TO THE PC-LIT TABLE IN WORKING     * 00589400
005895*     STORAGE AND A 4TH VALUE TO EACH ENTRY IN THE TABLE.       * 00589500
005896*     NEW LABEL OF 'PC-NEXUS-CDE' ASSIGNED TO THE NEW VALUE.    * 00589600
005897*     MADE BY: NANCY EILBES            WR/IR #: CHG112172       * 00589700
005898*                                                               * 00589803
005899* DATE  03/23/2023                                              * 00589903
005900*     CHANGE MADE: REVERTED TO PRIOR VERSION OF THE PROGRAM AS  * 00590003
005901*     THE DIRECT IMPORT CHANGES WERE CAUSING LC POS TO REPORT   * 00590103
005902*     INCORRECTLY.                                              * 00590203
005903*     MADE BY: NANCY EILBES            WR/IR #: CHG0286045      * 00590303
005904*                                                               * 00590403
005905* DATE  04/12/2023                                              * 00590504
005906*     CHANGE MADE: DIRECT IMPORT PROJECT.                       * 00590603
005907*     ADDED NEW VALUE OF 1NX TO THE PC-LIT TABLE IN WORKING     * 00590703
005908*     STORAGE AND A 4TH VALUE TO EACH ENTRY IN THE TABLE.       * 00590803
005909*     NEW LABEL OF 'PC-NEXUS-CDE' ASSIGNED TO THE NEW VALUE.    * 00590903
005910*     ALSO ADDED PV-ALW-CHRG-CDE3 AND PV-COMP-DESC3 TO THE      * 00591003
005911*     DETAIL TABLE TO SUPPORT THE NEW CODE AND DESCRIPTIONS     * 00591103
005912*     FOR NEXUS FIRST COST. ADDED LOGIC TO C150, C200 AND Z100  * 00591203
005913*     TO HANDLE THE NEW CODES AND LITERALS FOR POS WITH 1NX IN  * 00591303
005914*     THE AP031-IMPRT-CST-CDE.                                  * 00591403
005915*     MADE BY: NANCY EILBES            WR/IR #: CHG0286709      * 00591504
005916***************************************************************** 00591603
005917                                                                  00591703
005920 ENVIRONMENT DIVISION.                                            00592003
006000 CONFIGURATION SECTION.                                           00600000
006100 SOURCE-COMPUTER.    IBM-3090.                                    00610000
006200 OBJECT-COMPUTER.    IBM-3090.                                    00620000
006300                                                                  00630000
006400 INPUT-OUTPUT SECTION.                                            00640000
006500 FILE-CONTROL.                                                    00650000
006600     SELECT PO-VAR-FILE          ASSIGN TO UT-S-INP01.            00660000
006700     SELECT PO-COST-VAR-FILE     ASSIGN TO UT-S-OUT01.            00670000
006800                                                                  00680000
006900 DATA DIVISION.                                                   00690000
007000 FILE SECTION.                                                    00700000
007100                                                                  00710000
007200 FD  PO-VAR-FILE                                                  00720000
007300     RECORDING MODE IS F                                          00730000
007400     LABEL RECORDS ARE STANDARD                                   00740000
007500     DATA RECORD IS PO-VAR-REC.                                   00750000
007600 01  PO-VAR-REC                  PIC  X(175).                     00760000
007700                                                                  00770000
007800 FD  PO-COST-VAR-FILE                                             00780000
007900     RECORDING MODE IS F                                          00790000
008000     LABEL RECORDS ARE STANDARD                                   00800000
008100     BLOCK CONTAINS 0 RECORDS                                     00810000
008200     DATA RECORD IS PO-COST-VAR-REC.                              00820000
008300 01  PO-COST-VAR-REC             PIC  X(170).                     00830000
008400                                                                  00840000
008500 WORKING-STORAGE SECTION.                                         00850000
008600                                                                  00860000
008700 01  PC-PROGRAM-CONSTANTS.                                        00870000
008800     05  FILLER                  PIC  X(15)     VALUE             00880000
008900         '** BEGINING OF '.                                       00890000
009000     05  PC-PROGRAM-NAME         PIC  X(8)      VALUE 'APKUT080'. 00900000
009100     05  FILLER                  PIC  X(7)      VALUE ' W/S **'.  00910000
009200     05  PC-C200-ERROR-MESSAGE.                                   00920000
009300         10  FILLER              PIC X(50)      VALUE             00930000
009400         '  ALL VALID DATA PROCESSED. ERROR DATA BYPASSED AN'.    00940000
009500         10  FILLER              PIC X(50)      VALUE             00950000
009600         'D DISPLAYED.      '.                                    00960000
009700                                                                  00970000
009800     05  PC-SUB-LITERALS         COMP-3.                          00980000
009900         10  PC-CHRG-SUB-MAX     PIC S99        VALUE +14.        00990000
010000         10  PC-TOT-SUB          PIC S99        VALUE +13.        01000000
010100         10  PC-CODE-SUB-MAX     PIC S99        VALUE +12.        01010000
010200                                                                  01020000
010300***************************************************************** 01030000
010400*  THIS LITERAL TABLE ASSIGNS A REPORT LINE SEQUENCE CODE TO      01040000
010500*   AN ALLOWANCE CHARGE CODE. 1 OCCURENCE PER RPT SEQ CODE.       01050000
010600*  RPT SEQ CODES ARE USED FOR SORTING.                            01060000
010700*                                                                 01070000
010800*  TO REMOVE A RPT SEQ CODE, JUST BLANK OUT THE ALLOW. CHARGE     01080000
010900*   CODES THAT ARE ASSIGNED TO IT.                                01090000
011000*  TO ADD A NEW RPT SEQ CODE, INSERT A NEW OCCURANCE ANYWHERE     01100000
011100*   BEFORE THE 'TOT' CODE. THEN CHANGE ALL RPT SEQ CODES AFTER    01110000
011200*   THE NEW OCCURANCE, SO THEY REMAIN IN ASCENDING ORDER.         01120000
011300*  THE LAST 2 CODES IN THIS TABLE ('TOT' & 'LCL') MUST ALWAYS     01130000
011400*   REMAIN THE LAST 2 OCCURANCES.                                 01140000
011500*                                                                 01150000
011600*  ANY CHANGES TO RPT SEQ CODES MUST BE REFLECTED:                01160000
011700*   IN PROGRAMS; APKRP081, APKRP082, APKRP083                     01170000
011800*  * IF THE 'COLBY' AND 'LETTER OF CREDIT' CODES ARE DIFFERENT,   01180000
011900*     APKRP083 REQUIRES SPECIAL ATTENTION (IN B200-).             01190000
012000*  ANY CHANGES IN THE NUMBER OF OCCURANCES MUST BE REFLECTED:     01200000
012100*   IN TABLES;   PV-LIT-DETAIL-TABLE, PV-DETAIL-TABLE             01210000
012200*   IN WORKING STORAGE FIELDS; PC-CHRG-SUB-MAX, PC-TOT-SUB,       01220000
012300*                              PC-CODE-SUB-MAX                    01230000
012400*                                                                 01240000
012500*  PC-CHRG-SUB-MAX IS THE MAXIMUM SIZE OF THE TABLE (+14).        01250000
012600*  PC-TOT-SUB IS THE OCCURANCE OF THE 'TOT' CODE (+13).           01260000
012700*     ( THIS WILL ALWAYS BE THE TABLE MAX MINUS 1 ).              01270000
012800*  PC-CODE-SUB-MAX IS  THE OCCURENCE OF THE 'LCL CODE (+12).      01280000
012900*     ( THIS WILL ALWAYS BE THE TABLE MAX MINUS 2 ).              01290000
013000*                                                                 01300000
013100***************************************************************** 01310000
013200     05  PC-LIT-TABLE.                                            01320000
013300         10  PC-RPT-SEQ-A1.                                       01330000
013400* 'A1' REPORT LINE SEQ.                                           01340000
013500* '1ST' COLBY ALW CHRG CODE                                       01350000
013600* '1LC' LETTER OF CREDIT  ALW CHRG CODE                           01360000
013700             15  FILLER          PIC X(2)       VALUE 'A1'.       01370000
013800             15  FILLER          PIC X(3)       VALUE '1ST'.      01380000
013900             15  FILLER          PIC X(3)       VALUE '1LC'.      01390000
014000             15  FILLER          PIC X(3)       VALUE '1OA'.      01400000
014100             15  FILLER          PIC X(3)       VALUE '1NX'.      01410000
014200         10  PC-RPT-SEQ-B1.                                       01420000
014300             15  FILLER          PIC X(2)       VALUE 'B1'.       01430000
014400             15  FILLER          PIC X(3)       VALUE 'DUT'.      01440000
014500             15  FILLER          PIC X(3)       VALUE 'DUT'.      01450000
014600             15  FILLER          PIC X(3)       VALUE 'DUT'.      01460000
014700             15  FILLER          PIC X(3)       VALUE 'DUT'.      01470000
014800         10  PC-RPT-SEQ-C1.                                       01480000
014900             15  FILLER          PIC X(2)       VALUE 'C1'.       01490000
015000             15  FILLER          PIC X(3)       VALUE 'IAC'.      01500000
015100             15  FILLER          PIC X(3)       VALUE 'LCC'.      01510000
015200             15  FILLER          PIC X(3)       VALUE 'LCC'.      01520000
015210             15  FILLER          PIC X(3)       VALUE 'LCC'.      01521000
015220         10  PC-RPT-SEQ-D1.                                       01522000
015230             15  FILLER          PIC X(2)       VALUE 'D1'.       01523000
015240             15  FILLER          PIC X(3)       VALUE 'ROY'.      01524000
015250             15  FILLER          PIC X(3)       VALUE 'ROY'.      01525000
015260             15  FILLER          PIC X(3)       VALUE 'ROY'.      01526000
015270             15  FILLER          PIC X(3)       VALUE 'ROY'.      01527000
015280         10  PC-RPT-SEQ-E1.                                       01528000
015290             15  FILLER          PIC X(2)       VALUE 'E1'.       01529000
015300             15  FILLER          PIC X(3)       VALUE 'OAF'.      01530000
015400             15  FILLER          PIC X(3)       VALUE 'OAF'.      01540000
015500             15  FILLER          PIC X(3)       VALUE 'OAF'.      01550000
015600             15  FILLER          PIC X(3)       VALUE 'OAF'.      01560000
015700         10  PC-RPT-SEQ-F1.                                       01570000
015800             15  FILLER          PIC X(2)       VALUE 'F1'.       01580000
015900             15  FILLER          PIC X(3)       VALUE 'FCL'.      01590000
016000             15  FILLER          PIC X(3)       VALUE 'FCL'.      01600000
016100             15  FILLER          PIC X(3)       VALUE 'FCL'.      01610000
016200             15  FILLER          PIC X(3)       VALUE 'FCL'.      01620000
016300         10  PC-RPT-SEQ-G1.                                       01630000
016400             15  FILLER          PIC X(2)       VALUE 'G1'.       01640000
016500             15  FILLER          PIC X(3)       VALUE 'DDF'.      01650000
016600             15  FILLER          PIC X(3)       VALUE 'DDF'.      01660000
016700             15  FILLER          PIC X(3)       VALUE 'DDF'.      01670000
016800             15  FILLER          PIC X(3)       VALUE 'DDF'.      01680000
016900         10  PC-RPT-SEQ-H1.                                       01690000
017000             15  FILLER          PIC X(2)       VALUE 'H1'.       01700000
017100             15  FILLER          PIC X(3)       VALUE 'ENT'.      01710000
017200             15  FILLER          PIC X(3)       VALUE 'ENT'.      01720000
017300             15  FILLER          PIC X(3)       VALUE 'ENT'.      01730000
017400             15  FILLER          PIC X(3)       VALUE 'ENT'.      01740000
017500         10  PC-RPT-SEQ-I1.                                       01750000
017600             15  FILLER          PIC X(2)       VALUE 'I1'.       01760000
017700             15  FILLER          PIC X(3)       VALUE 'DRA'.      01770000
017800             15  FILLER          PIC X(3)       VALUE 'DRA'.      01780000
017900             15  FILLER          PIC X(3)       VALUE 'DRA'.      01790000
018000             15  FILLER          PIC X(3)       VALUE 'DRA'.      01800000
018100         10  PC-RPT-SEQ-J1.                                       01810000
018200             15  FILLER          PIC X(2)       VALUE 'J1'.       01820000
018300             15  FILLER          PIC X(3)       VALUE 'OCF'.      01830000
018400             15  FILLER          PIC X(3)       VALUE 'OCF'.      01840000
018500             15  FILLER          PIC X(3)       VALUE 'OCF'.      01850000
018600             15  FILLER          PIC X(3)       VALUE 'OCF'.      01860000
018700         10  PC-RPT-SEQ-K1.                                       01870000
018800             15  FILLER          PIC X(2)       VALUE 'K1'.       01880000
018900             15  FILLER          PIC X(3)       VALUE 'HGR'.      01890000
019000             15  FILLER          PIC X(3)       VALUE 'HGR'.      01900000
019100             15  FILLER          PIC X(3)       VALUE 'HGR'.      01910000
019200             15  FILLER          PIC X(3)       VALUE 'HGR'.      01920000
019300         10  PC-RPT-SEQ-L1.                                       01930000
019400             15  FILLER          PIC X(2)       VALUE 'L1'.       01940000
019500             15  FILLER          PIC X(3)       VALUE 'MIS'.      01950000
019600             15  FILLER          PIC X(3)       VALUE 'MIS'.      01960000
019700             15  FILLER          PIC X(3)       VALUE 'MIS'.      01970000
019710             15  FILLER          PIC X(3)       VALUE 'MIS'.      01971000
019720* ADD NEW OCCURANCES BEFORE THE 'TOT' CODE.                       01972000
019730         10  PC-RPT-SEQ-M1.                                       01973000
019740             15  FILLER          PIC X(2)       VALUE 'M1'.       01974000
019750             15  FILLER          PIC X(3)       VALUE 'TOT'.      01975000
019760             15  FILLER          PIC X(3)       VALUE 'TOT'.      01976000
019770             15  FILLER          PIC X(3)       VALUE 'TOT'.      01977000
019780             15  FILLER          PIC X(3)       VALUE 'TOT'.      01978000
019790         10  PC-RPT-SEQ-N1.                                       01979000
019800             15  FILLER          PIC X(2)       VALUE 'N1'.       01980000
019900             15  FILLER          PIC X(3)       VALUE 'LCL'.      01990000
020000             15  FILLER          PIC X(3)       VALUE SPACES.     02000000
020100             15  FILLER          PIC X(3)       VALUE SPACES.     02010000
020200             15  FILLER          PIC X(3)       VALUE SPACES.     02020000
020300     05  PC-DETAIL-LIT-TBL       REDEFINES      PC-LIT-TABLE.     02030000
020400         10  PC-DTL-LIT          OCCURS 14 TIMES.                 02040000
020500             15  PC-RPT-LINE-SEQ PIC  X(2).                       02050000
020600             15  PC-COLBY-CDE    PIC  X(3).                       02060000
020700             15  PC-LETTER-CDE   PIC  X(3).                       02070000
020800             15  PC-OPN-ACCT-CDE PIC  X(3).                       02080000
020900             15  PC-NEXUS-CDE    PIC  X(3).                       02090000
021000                                                                  02100000
021100 01  PS-PROGRAM-SWITCHES.                                         02110000
021200     05  PS-PO-VAR-SW            PIC  X         VALUE ' '.        02120000
021300         88  PO-VAR-FOUND                       VALUE 'N'.        02130000
021400         88  PO-VAR-END                         VALUE 'Y'.        02140000
021500     05  PS-MPF-FEE-SW           PIC  X         VALUE 'N'.        02150000
021600         88  MPF-FEE-FOUND                      VALUE 'Y'.        02160000
021700         88  MPF-FEE-NOT-FOUND                  VALUE 'N'.        02170000
021800                                                                  02180000
021900 01  PV-PROGRAM-VARIABLES.                                        02190000
022000     05  PV-HOLD-PO-NBR          PIC  X(9)      VALUE SPACES.     02200000
022100     05  PV-HOLD-DMA-NBR         PIC X(02)      VALUE SPACE.      02210000
022200     05  PV-DEPT-NBR             PIC X(03)      VALUE SPACE.      02220000
022300     05  PV-VENDOR-NBR           PIC  X(9)      VALUE SPACES.     02230000
022400         88  PV-VENDOR-NBR-LIFUNG          VALUE '009206194'.     02240000
022970     05  PV-HLD-CHRG-CDE         PIC  X(3)      VALUE SPACES.     02297000
022980     05  PV-HLD-COMP-DESC        PIC  X(30)     VALUE SPACES.     02298000
022990     05  PV-NUMERICS             COMP-3.                          02299000
023000         10  PV-PO-ACT-COST-AMT  PIC S9(9)V999  VALUE ZEROES.     02300000
023100         10  PV-PO-EST-COST-AMT  PIC S9(9)V999  VALUE ZEROES.     02310000
023200         10  PV-PO-UNT-QTY       PIC S9(9)      VALUE ZEROES.     02320000
023300         10  PV-RCV-EST-COST-AMT PIC S9(9)V999  VALUE ZEROES.     02330000
023400         10  PV-INV-UNT-QTY      PIC S9(9)      VALUE ZEROES.     02340000
023500         10  PV-INV-1ST-COST-AMT PIC S9(11)V99  VALUE ZEROES.     02350000
023600     05  CHRG-SUB                PIC S99        COMP-3            02360000
023700                                                VALUE ZEROES.     02370000
023800                                                                  02380000
023900     05  PV-COUNTERS                            COMP-3.           02390000
024000         10  PV-PO-HEADER-READ   PIC  9(7)      VALUE ZEROS.      02400000
024100         10  PV-PO-DETAIL-READ   PIC  9(7)      VALUE ZEROS.      02410000
024200         10  PV-PO-VAR-READ      PIC  9(7)      VALUE ZEROS.      02420000
024300         10  PV-PO-HEADER-WROTE  PIC  9(7)      VALUE ZEROS.      02430000
024400         10  PV-PO-DETAIL-WROTE  PIC  9(7)      VALUE ZEROS.      02440000
024500         10  PV-PO-VAR-WROTE     PIC  9(7)      VALUE ZEROS.      02450000
024600         10  PV-ERROR-COUNT      PIC  9(7)      VALUE ZEROS.      02460000
024700     05  PV-RETRY-COUNTER        PIC S9(4) COMP VALUE ZERO.       02470000
024800                                                                  02480000
024900     05  PV-DISPLAY-FIELDS.                                       02490000
025000         10  PV-HEADER-READ-O    PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02500000
025100         10  PV-DETAIL-READ-O    PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02510000
025200         10  PV-ERROR-COUNT-O    PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02520000
025300         10  PV-VAR-READ-O       PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02530000
025400         10  PV-HEADER-WROTE-O   PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02540000
025500         10  PV-DETAIL-WROTE-O   PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02550000
025600         10  PV-VAR-WROTE-O      PIC  Z,ZZZ,ZZ9 VALUE ZEROS.      02560000
025700                                                                  02570000
025800***************************************************************** 02580000
025900*  THIS LITERAL TABLE IS LOADED ONCE IN THE BEGINNING OF THE      02590000
026000*   PROCESSING (B100-INITIALIZE). THE RPT-LINE-SEQ, COLBY-CDE,    02600000
026100*   AND LETTER-CDE ARE LOADED FROM PC-DETAIL-LIT-TBL. THE DESC    02610000
026200*   FIELDS ARE LOADED FROM TACCTYP DB2 TABLE. THIS TABLE IS USED  02620000
026300*   TO SET UP THE 'WORKING' TABLE, PV-DETAIL-TABLE, FOR EACH PO.  02630000
026400*   IF THE PO IS A 'COLBY' PO, THE COLBY FIELDS ARE MOVED. IF     02640000
026500*   IT'S A 'LETTER OF CREDIT' PO, THE LETTER FIELDS ARE MOVED.    02650000
026600*                                                                 02660000
026700***************************************************************** 02670000
026800 01  PV-LIT-DETAIL-TABLE.                                         02680000
026900     05  PV-LIT-DETAIL           OCCURS 14 TIMES.                 02690000
027000         10  PV-LIT-RPT-LINE-SEQ PIC  X(2)      VALUE SPACES.     02700000
027100         10  PV-LIT-COLBY-CDE    PIC  X(3)      VALUE SPACES.     02710000
027200         10  PV-LIT-COLBY-DESC   PIC  X(30)     VALUE SPACES.     02720000
027300         10  PV-LIT-LETTER-CDE   PIC  X(3)      VALUE SPACES.     02730000
027400         10  PV-LIT-LETTER-DESC  PIC  X(30)     VALUE SPACES.     02740000
027500         10  PV-LIT-OPN-ACCT-CDE PIC  X(3)      VALUE SPACES.     02750000
027600         10  PV-LIT-OPN-ACCT-DESC PIC X(30)     VALUE SPACES.     02760000
027700         10  PV-LIT-NEXUS-CDE    PIC  X(3)      VALUE SPACES.     02770000
027800         10  PV-LIT-NEXUS-DESC   PIC  X(30)     VALUE SPACES.     02780000
027900                                                                  02790000
028000 01  PV-DETAIL-TABLE.                                             02800000
028100     05  PV-COLBY-DETAIL-CHG     OCCURS 14 TIMES.                 02810000
028200         10  PV-ALW-CHRG-CDE     PIC  X(3)      VALUE SPACES.     02820000
028300         10  PV-ALW-CHRG-CDE2    PIC  X(3)      VALUE SPACES.     02830000
028310         10  PV-ALW-CHRG-CDE3    PIC  X(3)      VALUE SPACES.     02831001
028400         10  PV-RPT-LINE-SEQ     PIC  X(2)      VALUE SPACES.     02840000
028500         10  PV-COMP-DESC        PIC  X(30)     VALUE SPACES.     02850000
028600         10  PV-COMP-DESC2       PIC  X(30)     VALUE SPACES.     02860000
028610         10  PV-COMP-DESC3       PIC  X(30)     VALUE SPACES.     02861001
028700         10  FILLER              COMP-3.                          02870000
028800             15  PV-PO-COST-AMT  PIC S9(11)V99  VALUE ZEROES.     02880000
028900             15  PV-EST-COST-AMT PIC S9(11)V99  VALUE ZEROES.     02890000
029000             15  PV-EST-UNT-COST PIC S999V9(5)  VALUE ZEROES.     02900000
029100             15  PV-RCV-COST-AMT PIC S9(11)V99  VALUE ZEROES.     02910000
029200             15  PV-INV-COST-AMT PIC S9(11)V99  VALUE ZEROES.     02920000
029300             15  PV-INV-UNT-COST PIC S999V9(5)  VALUE ZEROES.     02930000
029400             15  PV-PCT-TO-FC    PIC S9V9(5)    VALUE ZEROES.     02940000
029500             15  PV-PCT-TO-LC    PIC S9V9(5)    VALUE ZEROES.     02950000
029600                                                                  02960000
029700*----------------------------------------------------------------*02970000
029800*  IMPORT PO VARIANCE REPORT DATA                                 02980000
029900*----------------------------------------------------------------*02990000
030000     COPY APRD031.                                                03000000
030100                                                                  03010000
030200*----------------------------------------------------------------*03020000
030300*  IMPORT PO COST VARIANCE REPORT DATA                            03030000
030400*----------------------------------------------------------------*03040000
030500     COPY APRD036.                                                03050000
030600                                                                  03060000
030700*----------------------------------------------------------------*03070000
030800*    SQL COMMUNICATIONS AREA DCLGEN                               03080000
030900*----------------------------------------------------------------*03090000
031000     EXEC SQL                                                     03100000
031100         INCLUDE SQLCA                                            03110000
031200     END-EXEC.                                                    03120000
031300                                                                  03130000
031400*----------------------------------------------------------------*03140000
031500*    TACCTYP DCLGEN                                               03150000
031600*----------------------------------------------------------------*03160000
031700     EXEC SQL                                                     03170000
031800         INCLUDE TACCTYP                                          03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100*----------------------------------------------------------------*03210000
032200*  MERCHANDISE AREA TABLE                                        *03220000
032300*----------------------------------------------------------------*03230000
032400     EXEC SQL                                                     03240000
032500          INCLUDE TMDSEAR                                         03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800*----------------------------------------------------------------*03280000
032900*  ABEND DATA AREAS                                              *03290000
033000*----------------------------------------------------------------*03300000
033010 01  ABEND-CODE                  PIC S9(4)      VALUE ZEROS       03301000
033020                                                COMP SYNC.        03302000
033030     88  AC-ANY-ERROR                           VALUE +4001       03303000
033040                                                THRU  +4019.      03304000
033050     88  AC-INVALID-KEY-WRITE                   VALUE +4001.      03305000
033060     88  AC-INVALID-KEY-READ                    VALUE +4002.      03306000
033070     88  AC-INVALID-CONTROL-CARD                VALUE +4003.      03307000
033080     88  AC-TABLE-OVERFLOW                      VALUE +4004.      03308000
033081     88  AC-OPEN-FILE-ERROR                     VALUE +4005.      03308100
033082     88  AC-CLOSE-FILE-ERROR                    VALUE +4006.      03308200
033083     88  AC-SEQUENCE-ERROR                      VALUE +4007.      03308300
033084     88  AC-INVALID-DATA                        VALUE +4008.      03308400
033085     88  AC-INVALID-KEYPUNCH                    VALUE +4009.      03308500
033086     88  AC-INTERNAL-SORT-ERROR                 VALUE +4012.      03308600
033087     88  AC-DB2-ERROR                           VALUE +4013.      03308700
033088     88  AC-DPWS500-DATE-ERROR                  VALUE +4019.      03308800
033089                                                                  03308900
033090                                                                  03309000
033091 01  ABEND-AREAS.                                                 03309100
033092     05  AA-ABEND-LIT            PIC  X(40)     VALUE             03309200
033093             '*****       ABEND'.                                 03309300
033094     05  AA-PROGRAM-LIT          PIC  X(40)     VALUE             03309400
033095             '*****   PROGRAM: APKUT080'.                         03309500
033096     05  AA-PARAGRAPH-LIT.                                        03309600
033097         10  FILLER              PIC  X(17)     VALUE             03309700
033098             '***** PARAGRAPH: '.                                 03309800
033099         10  AA-PARAGRAPH-NAME   PIC  X(35)     VALUE SPACES.     03309900
033100     05  AA-MESSAGE-LINE.                                         03310000
033101         10  FILLER              PIC  X(6)      VALUE '*****'.    03310100
033102         10  AA-MESSAGE          PIC  X(127)    VALUE SPACES.     03310200
033103     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                03310300
033104             '*****    DB2 ERROR'.                                03310400
033105     05  AA-DB2-OPERATION-LIT.                                    03310500
033106         10  FILLER              PIC  X(17)  VALUE                03310600
033107             '***** OPERATION: '.                                 03310700
033108         10  AA-DB2-OPERATION.                                    03310800
033109             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        03310900
033110             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        03311000
033120     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        03312000
033130     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        03313000
033140     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        03314000
033150                                                                  03315000
033160*-----------------------------------------------------------      03316000
033170*  SQLCA FORMATTED MESSAGE AREA                                   03317000
033180*-----------------------------------------------------------      03318000
033190                                                                  03319000
033200     COPY DPWS004.                                                03320000
033300 01  FILLER                      PIC  X(25)     VALUE             03330000
033400     '** END OF APKUT080 W/S **'.                                 03340000
033500                                                                  03350000
033600 PROCEDURE DIVISION.                                              03360000
033700 A100-MAIN.                                                       03370000
033800                                                                  03380000
033900     PERFORM B100-HOUSEKEEPING.                                   03390000
034000                                                                  03400000
034100     IF PO-VAR-FOUND                                              03410000
034200         PERFORM B200-PROCESS-POS                                 03420000
034300           UNTIL PO-VAR-END                                       03430000
034400                                                                  03440000
034500*  WRITE HEADER RECORD FOR LAST PO PROCESSED                      03450000
034600         MOVE PV-HOLD-DMA-NBR TO AP036-DMA-NBR                    03460000
034700         PERFORM W100-WRITE-AP036-RECORD                          03470000
034800         ADD 1                   TO PV-PO-HEADER-WROTE            03480000
034900                                                                  03490000
035000         PERFORM C300-PROCESS-DETAIL-TOTALS                       03500000
035100*  WRITE DETAIL RECORDS FROM TABLE FOR LAST PO PROCESSED          03510000
035200         SET AP036-DETAIL        TO TRUE                          03520000
035300         PERFORM F100-FORMAT-DETAIL-RECORDS                       03530000
035400           VARYING CHRG-SUB FROM 1 BY 1                           03540000
035500           UNTIL   CHRG-SUB > PC-CHRG-SUB-MAX                     03550000
035600     END-IF.                                                      03560000
035700                                                                  03570000
035800     PERFORM B300-END-PROGRAM.                                    03580000
035900                                                                  03590000
036000     GOBACK.                                                      03600000
036100                                                                  03610000
036200 B100-HOUSEKEEPING.                                               03620000
036300*----------------------------------------------------------------*03630000
036400*    INITIALIZATION PROCESS AND INITIAL READ FOR INPUT.          *03640000
036500*----------------------------------------------------------------*03650000
036600                                                                  03660000
036700     OPEN INPUT  PO-VAR-FILE.                                     03670000
036800     OPEN OUTPUT PO-COST-VAR-FILE.                                03680000
036900                                                                  03690000
037000*  MOVE SPACES TO INSURE THAT THE FILLER GETS CLEANED UP.         03700000
037100     MOVE SPACES                 TO AP036-IMPORT-REPORT-RECORD.   03710000
037200     INITIALIZE AP036-IMPORT-REPORT-RECORD                        03720000
037300                PV-DETAIL-TABLE.                                  03730000
037400                                                                  03740000
037500     PERFORM Z100-LOAD-TABLE-DESC                                 03750000
037600       VARYING CHRG-SUB FROM 1 BY 1                               03760000
037700       UNTIL   CHRG-SUB > PC-CHRG-SUB-MAX.                        03770000
037800                                                                  03780000
037900* INITIAL READ OF PO VARIANCE REPORT FILE.                        03790000
038000     PERFORM R100-READ-PO-VAR.                                    03800000
038100     IF PO-VAR-END                                                03810000
038200         DISPLAY 'PO VARIANCE REPORT FILE IS EMPTY '              03820000
038300         DISPLAY ' INITIAL READ IN B100-HOUSEKEEPING'             03830000
038400     ELSE                                                         03840000
038500        MOVE AP031-PO-NBR TO PV-HOLD-PO-NBR                       03850000
038600        MOVE AP031-DEPT-NBR TO PV-DEPT-NBR                        03860000
038700        PERFORM Z200-SELECT-DMA                                   03870000
038800     END-IF.                                                      03880000
038900                                                                  03890000
039000                                                                  03900000
039100 B200-PROCESS-POS.                                                03910000
039200*----------------------------------------------------------------*03920000
039300*    CONTROLS THE PROCESSING OF EACH PO:                         *03930000
039400*                                                                *03940000
039500*    - IF THE PO NUMBER CHANGES                                  *03950000
039600*        WRITE HEADER RECORD FOR LAST PO PROCESSED               *03960000
039700*        WRITE DETAIL RECORDS FROM TABLE FOR LAST PO PROCESSED   *03970000
039800*        INITIALIZE THE OUTPUT RECORD AND THE DETAIL TABLE FOR   *03980000
039900*         NEXT PO.                                               *03990000
040000*        SET UP SAVED FIELDS                                     *04000000
040100*    - PROCESS HEADER RECORDS TO CREATE 1 OUTPUT HEADER RECORD   *04010000
040200*       - OR -                                                   *04020000
040300*    - ACCUMULATE DETAIL RECORDS IN TABLE UNTIL PO NBR CHANGES   *04030000
040400*    - GET THE NEXT INPUT RECORD                                 *04040000
040500*----------------------------------------------------------------*04050000
040600                                                                  04060000
040700*  WRITE HEADER RECORD FOR LAST PO PROCESSED                      04070000
040800     IF AP031-PO-NBR NOT = PV-HOLD-PO-NBR                         04080000
040900         MOVE PV-HOLD-DMA-NBR TO AP036-DMA-NBR                    04090000
041000         PERFORM W100-WRITE-AP036-RECORD                          04100000
041100         ADD 1                   TO PV-PO-HEADER-WROTE            04110000
041200                                                                  04120000
041300         PERFORM C300-PROCESS-DETAIL-TOTALS                       04130000
041400*  WRITE DETAIL RECORDS FROM TABLE FOR LAST PO PROCESSED          04140000
041500         SET AP036-DETAIL        TO TRUE                          04150000
041600         PERFORM F100-FORMAT-DETAIL-RECORDS                       04160000
041700           VARYING CHRG-SUB FROM 1 BY 1                           04170000
041800           UNTIL   CHRG-SUB > PC-CHRG-SUB-MAX                     04180000
041900                                                                  04190000
042000*  MOVE SPACES TO INSURE THAT THE FILLER GETS CLEANED UP.         04200000
042100*   THE FILLER IN THE HEADER-INFO WASN'T INITIALIZED, SO SOME     04210000
042200*   NUMERICS REMAINED FROM THE PREVIOUS PO DETAIL RECORD.         04220000
042300         MOVE SPACES             TO AP036-HEADER-INFO             04230000
042400         INITIALIZE AP036-IMPORT-REPORT-RECORD                    04240000
042500                    PV-DETAIL-TABLE                               04250000
042600         MOVE AP031-PO-NBR       TO PV-HOLD-PO-NBR                04260000
042700         MOVE AP031-DEPT-NBR TO PV-DEPT-NBR                       04270000
042800         PERFORM Z200-SELECT-DMA                                  04280000
042900     END-IF.                                                      04290000
043000                                                                  04300000
043100*  PROCESS HEADER RECORDS TO CREATE 1 OUTPUT HEADER RECORD        04310000
043200*   - OR -                                                        04320000
043300*  ACCUMULATE DETAIL RECORDS IN TABLE UNTIL PO NBR CHANGES        04330000
043301     IF AP031-HEADER                                              04330100
043302         PERFORM C100-PROCESS-HEADER-DATA                         04330200
043303     ELSE                                                         04330300
043304         IF AP031-DETAIL                                          04330400
043305             PERFORM C200-PROCESS-DETAIL-DATA                     04330500
043306         END-IF                                                   04330600
043307     END-IF.                                                      04330700
043308                                                                  04330800
043309*  GET THE NEXT INPUT RECORD                                      04330900
043310     IF PO-VAR-FOUND                                              04331000
043320         PERFORM R100-READ-PO-VAR                                 04332000
043330     END-IF.                                                      04333000
043340                                                                  04334000
043350                                                                  04335000
043360 B300-END-PROGRAM.                                                04336000
043370*----------------------------------------------------------------*04337000
043380*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *04338000
043390*----------------------------------------------------------------*04339000
043400                                                                  04340000
043500     MOVE PV-ERROR-COUNT         TO PV-ERROR-COUNT-O.             04350000
043600     MOVE PV-PO-HEADER-READ      TO PV-HEADER-READ-O.             04360000
043700     MOVE PV-PO-DETAIL-READ      TO PV-DETAIL-READ-O.             04370000
043800     MOVE PV-PO-VAR-READ         TO PV-VAR-READ-O.                04380000
043900     MOVE PV-PO-HEADER-WROTE     TO PV-HEADER-WROTE-O.            04390000
044000     MOVE PV-PO-DETAIL-WROTE     TO PV-DETAIL-WROTE-O.            04400000
044100     MOVE PV-PO-VAR-WROTE        TO PV-VAR-WROTE-O.               04410000
044200                                                                  04420000
044300     DISPLAY '**  END OF ' PC-PROGRAM-NAME ' PROCESSING  **'.     04430000
044400     DISPLAY ' '.                                                 04440000
044500     DISPLAY 'ERROR  RECORDS SKIPPED = ' PV-ERROR-COUNT-O.        04450000
044600     DISPLAY 'HEADER RECORDS PROCESS = ' PV-HEADER-READ-O.        04460000
044700     DISPLAY 'DETAIL RECORDS PROCESS = ' PV-DETAIL-READ-O.        04470000
044800     DISPLAY '                         _________'.                04480000
044900     DISPLAY 'TOTAL  RECORDS READ    = ' PV-VAR-READ-O.           04490000
045000     DISPLAY ' '                                                  04500000
045100                                                                  04510000
045200     DISPLAY 'HEADER RECORDS WROTE   = ' PV-HEADER-WROTE-O.       04520000
045300     DISPLAY 'DETAIL RECORDS WROTE   = ' PV-DETAIL-WROTE-O.       04530000
045400     DISPLAY '                         _________'.                04540000
045500     DISPLAY 'TOTAL  RECORDS WROTE   = ' PV-VAR-WROTE-O.          04550000
045600                                                                  04560000
045700     CLOSE PO-VAR-FILE                                            04570000
045800           PO-COST-VAR-FILE.                                      04580000
045900                                                                  04590000
046000                                                                  04600000
046100 C100-PROCESS-HEADER-DATA.                                        04610000
046200*----------------------------------------------------------------*04620000
046300*    PROCESS HEADER RECORDS TO CREATE 1 OUTPUT HEADER RECORD     *04630000
046400*                                                                *04640000
046500*    - FORMAT THE PV-DETAIL-TABLE WITH THE LITERAL TABLE DATA.   *04650000
046600*    - MOVE PO, RECEIVING, INVOICE DATA TO OUTPUT RECORD.        *04660000
046700*    - SAVE CERTAIN DATA TO BE CARRIED ON THE DETAIL RECORDS.    *04670000
046800*----------------------------------------------------------------*04680000
046900                                                                  04690000
047000     SET AP036-HEADER            TO TRUE.                         04700000
047100     ADD 1                       TO PV-PO-HEADER-READ.            04710000
047200                                                                  04720000
047300     IF AP031-PO-INFO                                             04730000
047400* FORMAT THE PV-DETAIL-TABLE WITH THE LITERAL TABLE DATA.         04740000
047500         PERFORM C150-FORMAT-TABLE                                04750000
047600         MOVE AP031-REPORT-TYP-CDE                                04760000
047700                                 TO AP036-REPORT-TYP-CDE          04770000
047800         MOVE AP031-VENDOR-NAME  TO AP036-VENDOR-NAME             04780000
047900         MOVE AP031-PO-NBR       TO AP036-PO-NBR                  04790000
048000         MOVE AP031-DEPT-NBR     TO AP036-DEPT-NBR                04800000
048100         MOVE AP031-FOB-CDE      TO AP036-FOB-CDE                 04810000
048200         MOVE AP031-VENDOR-NBR   TO AP036-VENDOR-NBR              04820000
048300                                    AP036-HDR-VENDOR-NBR          04830000
048400         MOVE AP031-OTB-PER-NBR  TO AP036-OTB-PER-NBR             04840000
048500         MOVE AP031-PO-STATUS-CDE                                 04850000
048600                                 TO AP036-PO-STATUS-CDE           04860000
048700         MOVE AP031-TOTAL-QTY    TO AP036-PO-UNT-QTY              04870000
048800                                    PV-PO-UNT-QTY                 04880000
048900* SAVE THIS DATA FOR CREATION OF DETAIL RECORDS                   04890000
049000         MOVE AP031-ACT-COST-AMT TO PV-PO-ACT-COST-AMT            04900000
049100         MOVE AP031-EST-COST-AMT TO PV-PO-EST-COST-AMT            04910000
049200     END-IF.                                                      04920000
049300                                                                  04930000
049400     IF AP031-RCV-TOT-INFO                                        04940000
049500         MOVE AP031-FIRST-VERFYD-DTE                              04950000
049600                                 TO AP036-1ST-VERFYD-DTE          04960000
049700         MOVE AP031-LAST-VERFYD-DTE                               04970000
049800                                 TO AP036-LAST-VERFYD-DTE         04980000
049900         MOVE AP031-TOTAL-QTY    TO AP036-RCV-UNT-QTY             04990000
050000* SAVE THIS DATA FOR CREATION OF DETAIL RECORDS                   05000000
050100         MOVE AP031-EST-COST-AMT TO PV-RCV-EST-COST-AMT           05010000
050200     END-IF.                                                      05020000
050300                                                                  05030000
050400     IF AP031-INV-TOT-INFO                                        05040000
050500         MOVE AP031-IMPRT-RPT-DTE                                 05050000
050600                                 TO AP036-1ST-INVC-DTE            05060000
050700         MOVE AP031-TOTAL-QTY    TO AP036-INV-UNT-QTY             05070000
050800                                    PV-INV-UNT-QTY                05080000
050900     END-IF.                                                      05090000
051000                                                                  05100000
051200*----------------------------------------------------------------*05120000
051300*    PROCESS HEADER RECORDS TO CREATE 1 OUTPUT HEADER RECORD     *05130000
051400*                                                                *05140000
051500*    - FORMAT 'WORKING' TABLE WITH DATA FROM LITERAL TABLE       *05150000
051600*----------------------------------------------------------------*05160000
051610 C150-FORMAT-TABLE.                                               05161003
051700                                                                  05170000
051800     INITIALIZE PV-DETAIL-TABLE.                                  05180000
051900     MOVE AP031-VENDOR-NBR       TO PV-VENDOR-NBR.                05190000
052000                                                                  05200000
052100     PERFORM                                                      05210000
052200       VARYING CHRG-SUB FROM 1 BY 1                               05220000
052300       UNTIL   CHRG-SUB > PC-CHRG-SUB-MAX                         05230000
052400         IF PV-VENDOR-NBR-LIFUNG                                  05240000
052500             IF PC-COLBY-CDE (CHRG-SUB) > SPACES                  05250000
052600                 MOVE PC-COLBY-CDE (CHRG-SUB)                     05260000
052700                                 TO PV-ALW-CHRG-CDE (CHRG-SUB)    05270000
052800                 MOVE PV-LIT-COLBY-DESC (CHRG-SUB)                05280000
052900                                 TO PV-COMP-DESC (CHRG-SUB)       05290000
053000             END-IF                                               05300000
053100         ELSE                                                     05310000
053802             IF PC-LETTER-CDE (CHRG-SUB) > SPACES                 05380200
053803                 MOVE PC-LETTER-CDE (CHRG-SUB)                    05380300
053804                                 TO PV-ALW-CHRG-CDE (CHRG-SUB)    05380400
053805                 MOVE PV-LIT-LETTER-DESC (CHRG-SUB)               05380500
053806                                 TO PV-COMP-DESC (CHRG-SUB)       05380600
053807             END-IF                                               05380702
053808             IF PC-OPN-ACCT-CDE (CHRG-SUB) > SPACES               05380800
053809             AND PC-OPN-ACCT-CDE (CHRG-SUB) NOT =                 05380900
053810                 PC-LETTER-CDE (CHRG-SUB)                         05381000
053820                 MOVE PC-OPN-ACCT-CDE (CHRG-SUB)                  05382000
053830                             TO PV-ALW-CHRG-CDE2 (CHRG-SUB)       05383000
053840                 MOVE PV-LIT-OPN-ACCT-DESC (CHRG-SUB)             05384000
053850                             TO PV-COMP-DESC2 (CHRG-SUB)          05385000
053851             END-IF                                               05385102
053853             IF PC-NEXUS-CDE (CHRG-SUB) > SPACES                  05385301
053854             AND PC-NEXUS-CDE (CHRG-SUB) NOT =                    05385401
053855                 PC-LETTER-CDE (CHRG-SUB)                         05385501
053856             AND PC-NEXUS-CDE (CHRG-SUB) NOT =                    05385601
053857                 PC-OPN-ACCT-CDE (CHRG-SUB)                       05385701
053858                    MOVE PC-NEXUS-CDE (CHRG-SUB)                  05385801
053859                      TO PV-ALW-CHRG-CDE3 (CHRG-SUB)              05385901
053860                    MOVE PV-LIT-NEXUS-DESC (CHRG-SUB)             05386001
053861                      TO PV-COMP-DESC3 (CHRG-SUB)                 05386101
053862             END-IF                                               05386201
053890           END-IF                                                 05389000
053900         MOVE PC-RPT-LINE-SEQ (CHRG-SUB)                          05390000
054000                                 TO PV-RPT-LINE-SEQ (CHRG-SUB)    05400000
054100     END-PERFORM.                                                 05410000
054200                                                                  05420000
054300 C200-PROCESS-DETAIL-DATA.                                        05430000
054400*----------------------------------------------------------------*05440000
054500*    CONTROLS THE PROCESSING OF PO DETAIL DATA                   *05450000
054600*                                                                *05460000
054700*    - FIND THE IMPORT CHARGE CODE IN THE LITERAL TABLE          *05470000
054800*    - IF A MATCH IS FOUND IN THE WS-DETAIL-TABLE,               *05480000
054900*       POPULATE THE FIELDS.                                     *05490000
055000*----------------------------------------------------------------*05500000
055100                                                                  05510000
055110     IF AP031-IMPRT-CST-CDE = 'BSS'                               05511000
055120        SET MPF-FEE-FOUND TO TRUE                                 05512000
055130        MOVE 'MIS' TO AP031-IMPRT-CST-CDE                         05513000
055140     END-IF.                                                      05514000
055150                                                                  05515000
055160*  FIND THE IMPORT CHARGE CODE IN THE LITERAL TABLE               05516000
055170     PERFORM                                                      05517000
055180       VARYING CHRG-SUB FROM 1 BY 1                               05518000
055190       UNTIL   AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE (CHRG-SUB)   05519000
055200       OR      AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE2 (CHRG-SUB)  05520000
055210       OR      AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE3 (CHRG-SUB)  05521001
055300       OR      CHRG-SUB > PC-CHRG-SUB-MAX                         05530000
055400     END-PERFORM.                                                 05540000
055500                                                                  05550000
055600     IF CHRG-SUB > PC-CHRG-SUB-MAX                                05560000
055700*  THIS WILL CATCH ANY CHARGE CODES THAT ARE NOT ON THE LITERAL   05570000
055800*   TABLE. WE MAY WANT TO DO SOMETHING WITH THESE LATER.          05580000
055900*  ( EX. OLD PO'S WITH 'FCD' ALLOWANCE CHARGE CODES ).            05590000
056000         MOVE 'C200-PROCESS-DETAIL-DATA           '               05600000
056100                                 TO AA-PARAGRAPH-NAME             05610000
056200         IF PV-ERROR-COUNT = ZEROES                               05620000
056300             DISPLAY AA-PARAGRAPH-LIT                             05630000
056400         END-IF                                                   05640000
056500*        DISPLAY ' ALLOWANCE CHARGE CODE NOT ON LITERAL TABLE = ' 05650000
056600*          AP031-IMPRT-CST-CDE                                    05660000
056700         DISPLAY 'PO #: ' AP031-PO-NBR ',VENDOR #: '              05670000
056800           AP031-VENDOR-NBR ',REPORT CDE: ' AP031-REPORT-TYP-CDE  05680000
056900           ',RECORD CDE: ' AP031-RECORD-TYP-CDE                   05690000
057000           ',CDE NOT FND: ' AP031-IMPRT-CST-CDE                   05700000
057100         ADD +1                  TO PV-ERROR-COUNT                05710000
057200     END-IF.                                                      05720000
057300                                                                  05730000
057400*  WHEN INPUT HAS 1OA REPLACE TABLE CDE AND DESC                  05740000
057500     IF  AP031-IMPRT-CST-CDE = '1OA'                              05750001
057600     AND AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE2 (CHRG-SUB)        05760001
057700       MOVE PV-ALW-CHRG-CDE2 (CHRG-SUB)                           05770000
057800         TO PV-ALW-CHRG-CDE (CHRG-SUB)                            05780000
057900       MOVE PV-COMP-DESC2 (CHRG-SUB)                              05790000
058000         TO PV-COMP-DESC  (CHRG-SUB)                              05800000
058100     END-IF.                                                      05810000
058200                                                                  05820000
058210*  WHEN INPUT HAS 1NX REPLACE TABLE CDE AND DESC                  05821001
058220     IF  AP031-IMPRT-CST-CDE = '1NX'                              05822001
058230     AND AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE3 (CHRG-SUB)        05823001
058240       MOVE PV-ALW-CHRG-CDE3 (CHRG-SUB)                           05824001
058250         TO PV-ALW-CHRG-CDE (CHRG-SUB)                            05825001
058260       MOVE PV-COMP-DESC3 (CHRG-SUB)                              05826001
058270         TO PV-COMP-DESC  (CHRG-SUB)                              05827001
058280     END-IF.                                                      05828001
058290                                                                  05829001
058300*  IF A MATCH IS FOUND IN THE WS-  TABLE, POPULATE THE FIELDS.    05830000
058400     IF AP031-IMPRT-CST-CDE = PV-ALW-CHRG-CDE (CHRG-SUB)          05840000
058500         ADD 1                   TO PV-PO-DETAIL-READ             05850000
058600         IF AP031-IMPRT-CST-CDE = '1ST'                           05860000
058700           OR AP031-IMPRT-CST-CDE = '1LC'                         05870000
058800           OR AP031-IMPRT-CST-CDE = '1OA'                         05880000
058900           OR AP031-IMPRT-CST-CDE = '1NX'                         05890000
059000             MOVE PV-PO-ACT-COST-AMT                              05900000
059100                                 TO PV-PO-COST-AMT (CHRG-SUB)     05910000
059110         END-IF                                                   05911000
059120         IF ( AP031-PPD-INFO OR AP031-ELC-INFO )                  05912000
059130           AND AP031-IMPRT-CST-CDE NOT = 'LCL'                    05913000
059140             ADD AP031-EST-COST-AMT                               05914000
059150                                 TO PV-EST-COST-AMT (CHRG-SUB)    05915000
059160         END-IF                                                   05916000
059170         IF AP031-RCV-VAR-INFO                                    05917000
059180             ADD AP031-ACT-COST-AMT                               05918000
059190                                 TO PV-RCV-COST-AMT (CHRG-SUB)    05919000
059200         END-IF                                                   05920000
059300         IF AP031-IMPRT-CST-CDE = 'LCL'                           05930000
059400           AND AP031-RCV-VAR-INFO                                 05940000
059500             MOVE AP031-ACT-COST-AMT                              05950000
059600                                 TO PV-INV-COST-AMT (CHRG-SUB)    05960000
059700         ELSE                                                     05970000
059800             IF ( AP031-INV-INFO OR AP031-PPD-INFO )              05980000
059900                 ADD AP031-ACT-COST-AMT                           05990000
060000                                 TO PV-INV-COST-AMT (CHRG-SUB)    06000000
060100             END-IF                                               06010000
060200         END-IF                                                   06020000
060300     END-IF.                                                      06030000
060400                                                                  06040000
060500*    IF MPF-FEE-FOUND                                             06050000
060600*       MOVE 'BSS' TO AP031-IMPRT-CST-CDE                         06060000
060700*       SET MPF-FEE-NOT-FOUND TO TRUE                             06070000
060800*    END-IF.                                                      06080000
060900                                                                  06090000
061000 C300-PROCESS-DETAIL-TOTALS.                                      06100000
061100*----------------------------------------------------------------*06110000
061200*    END OF PO PROCESSING TO CREATE THE LCL COMPONENT ENTRY      *06120000
061300*                                                                *06130000
061400*    - HARD CODE THE 'LANDED COST' DESCRIPTION.                  *06140000
061500*       THIS THE PO TOTAL COMPONENT ('TOT').                     *06150000
061600*    - ACCUMULATE PO TOTALS                                      *06160000
061700*    - CALCULATE UNIT COSTS FOR EACH COMPONENT                   *06170000
061800*    - CALCULATE PECENTAGES FOR ALL COMPONENT                    *06180000
061900*    - REMOVE BOTH %'S FOR 'TOT' COMPONENT, AND % TO FC FOR      *06190000
062000*       THE LCL COMPONENT. THESE PERCENTAGES ARE MEANINGLESS.    *06200000
062100*----------------------------------------------------------------*06210000
062200*  PC-CHRG-SUB-MAX IS THE MAXIMUM SIZE OF THE TABLE (+13).       *06220000
062300*  PC-TOT-SUB IS THE OCCURANCE OF THE 'TOT' CODE (+12).          *06230000
062400*     ( THIS WILL ALWAYS BE THE TABLE MAX MINUS 1 ).             *06240000
062500*  PC-CODE-SUB-MAX IS  THE OCCURENCE OF THE 'LCL CODE (+11).     *06250000
062600*     ( THIS WILL ALWAYS BE THE TABLE MAX MINUS 2 ).             *06260000
062700*----------------------------------------------------------------*06270000
062800                                                                  06280000
062900* HARD CODE THE 'LANDED COST' DESCRIPTION                         06290000
063000*  FOR THE PO TOTAL COMPONENT ('TOT').                            06300000
063100     MOVE 'LANDED COST                   '                        06310000
063200                                 TO PV-COMP-DESC (PC-TOT-SUB).    06320000
063300     MOVE PV-PO-EST-COST-AMT     TO PV-PO-COST-AMT (PC-TOT-SUB).  06330000
063400                                                                  06340000
063500     PERFORM                                                      06350000
063600       VARYING CHRG-SUB FROM 1 BY 1                               06360000
063700       UNTIL   CHRG-SUB > PC-CODE-SUB-MAX                         06370000
063800*                                                                 06380000
063900* ACCUMULATE PO TOTALS                                            06390000
064000*                                                                 06400000
064100         ADD PV-EST-COST-AMT (CHRG-SUB)                           06410000
064200                                 TO PV-EST-COST-AMT (PC-TOT-SUB)  06420000
064300         ADD PV-INV-COST-AMT (CHRG-SUB)                           06430000
064400                                 TO PV-INV-COST-AMT (PC-TOT-SUB)  06440000
064500                                                                  06450000
064600* CALCULATE UNIT COSTS FOR EACH COMPONENT                         06460000
064700         IF PV-PO-UNT-QTY > ZEROES                                06470000
064800             COMPUTE PV-EST-UNT-COST (CHRG-SUB) =                 06480000
064900               ( PV-EST-COST-AMT (CHRG-SUB)                       06490000
065000                                    / PV-PO-UNT-QTY ) + .00005    06500000
065100         ELSE                                                     06510000
065200             MOVE ZEROES         TO  PV-EST-UNT-COST (CHRG-SUB)   06520000
065300         END-IF                                                   06530000
065400         IF PV-INV-UNT-QTY > ZEROES                               06540000
065500             COMPUTE PV-INV-UNT-COST (CHRG-SUB) =                 06550000
065600               ( PV-INV-COST-AMT (CHRG-SUB)                       06560000
065700                                    / PV-INV-UNT-QTY ) + .00005   06570000
065800         ELSE                                                     06580000
065900             MOVE ZEROES         TO PV-INV-UNT-COST (CHRG-SUB)    06590000
066000         END-IF                                                   06600000
066100*                                                                 06610000
066200* ACCUMULATE UNIT COST                                            06620000
066300*                                                                 06630000
066400                                                                  06640000
066500         ADD PV-EST-UNT-COST (CHRG-SUB)                           06650000
066600                                 TO PV-EST-UNT-COST (PC-TOT-SUB)  06660000
066700         ADD PV-INV-UNT-COST (CHRG-SUB)                           06670000
066800                                 TO PV-INV-UNT-COST (PC-TOT-SUB)  06680000
066900                                                                  06690000
067000     END-PERFORM.                                                 06700000
067100                                                                  06710000
067200     MOVE PV-RCV-EST-COST-AMT    TO PV-RCV-COST-AMT (PC-TOT-SUB). 06720000
067300                                                                  06730000
067400* CALCULATE PECENTAGES FOR ALL COMPONENT                          06740000
067500     PERFORM                                                      06750000
067600       VARYING CHRG-SUB FROM 1 BY 1                               06760000
067700       UNTIL   CHRG-SUB > PC-CHRG-SUB-MAX                         06770000
067800         IF PV-ALW-CHRG-CDE (CHRG-SUB) = '1ST'                    06780000
067900           OR PV-ALW-CHRG-CDE (CHRG-SUB) = '1LC'                  06790000
068000           OR PV-ALW-CHRG-CDE (CHRG-SUB) = '1OA'                  06800000
068010           OR PV-ALW-CHRG-CDE (CHRG-SUB) = '1NX'                  06801000
068020             MOVE PV-INV-COST-AMT (CHRG-SUB)                      06802000
068030                                 TO PV-INV-1ST-COST-AMT           06803000
068040         END-IF                                                   06804000
068050         IF PV-INV-1ST-COST-AMT > ZEROES                          06805000
068060             COMPUTE PV-PCT-TO-FC (CHRG-SUB) = (                  06806000
068070               ( PV-INV-COST-AMT (CHRG-SUB) /                     06807000
068080                 PV-INV-1ST-COST-AMT ) + .00005 )                 06808000
068090         ELSE                                                     06809000
068100             MOVE ZEROES         TO PV-PCT-TO-FC (CHRG-SUB)       06810000
068200         END-IF                                                   06820000
068300                                                                  06830000
068400         IF PV-INV-COST-AMT (PC-TOT-SUB) > ZEROES                 06840000
068500             COMPUTE PV-PCT-TO-LC (CHRG-SUB) = (                  06850000
068600               ( PV-INV-COST-AMT (CHRG-SUB) /                     06860000
068700                 PV-INV-COST-AMT (PC-TOT-SUB) ) + .00005 )        06870000
068800         ELSE                                                     06880000
068900             MOVE ZEROES         TO PV-PCT-TO-LC (CHRG-SUB)       06890000
069000         END-IF                                                   06900000
069100                                                                  06910000
069200     END-PERFORM.                                                 06920000
069300                                                                  06930000
069400* REMOVE BOTH %'S FOR 'TOT' COMPONENT, AND % TO FC FOR            06940000
069500*  THE LCL COMPONENT. THESE PERCENTAGES ARE MEANINGLESS.          06950000
069600     INITIALIZE PV-PCT-TO-FC (PC-TOT-SUB)                         06960000
069700                PV-PCT-TO-LC (PC-TOT-SUB)                         06970000
069800                PV-PCT-TO-FC (PC-CHRG-SUB-MAX).                   06980000
069900                                                                  06990000
070000                                                                  07000000
070100 F100-FORMAT-DETAIL-RECORDS.                                      07010000
070200*----------------------------------------------------------------*07020000
070300*    FORMAT AND WRITE DETAIL RECORDS FROM THE TABLE              *07030000
070400*                                                                *07040000
070500*    - IF COMPONENT CODE IS 'LCL' AND THE INVOICE COST IS        *07050000
070600*       GREATER THAN ZERO, WRITE THE RECORD                      *07060000
070700*    - IF COMPONENT CODE IS NOT 'LCL' AND NOT SPACES, WRITE THE  *07070000
070800*       RECORD                                                   *07080000
070900*----------------------------------------------------------------*07090000
071000                                                                  07100000
071100     IF ( PV-ALW-CHRG-CDE (CHRG-SUB) NOT = SPACES                 07110000
071200         AND PV-ALW-CHRG-CDE (CHRG-SUB) NOT = 'LCL' )             07120000
071300       OR ( PV-ALW-CHRG-CDE (CHRG-SUB) = 'LCL'                    07130000
071400           AND PV-INV-COST-AMT (CHRG-SUB) > ZEROES )              07140000
071500                                                                  07150000
071600         MOVE PV-RPT-LINE-SEQ (CHRG-SUB)                          07160000
071700                                 TO AP036-RPT-LINE-SEQ            07170000
071800         MOVE PV-COMP-DESC (CHRG-SUB)                             07180000
071900                                 TO AP036-COMPONENT-DESC          07190000
072000         MOVE PV-PO-COST-AMT (CHRG-SUB)                           07200000
072100                                 TO AP036-PO-COST-AMT             07210000
072200         MOVE PV-EST-COST-AMT (CHRG-SUB)                          07220000
072300                                 TO AP036-EST-COST-AMT            07230000
072400         MOVE PV-EST-UNT-COST (CHRG-SUB)                          07240000
072500                                 TO AP036-EST-UNT-COST            07250000
072600         MOVE PV-RCV-COST-AMT (CHRG-SUB)                          07260000
072700                                 TO AP036-RCV-COST-AMT            07270000
072800         MOVE PV-INV-COST-AMT (CHRG-SUB)                          07280000
072900                                 TO AP036-INV-COST-AMT            07290000
073000         MOVE PV-INV-UNT-COST (CHRG-SUB)                          07300000
073100                                 TO AP036-INV-UNT-COST            07310000
073200         MOVE PV-PCT-TO-FC (CHRG-SUB)                             07320000
073300                                 TO AP036-INV-PCT-TO-FC           07330000
073400         MOVE PV-PCT-TO-LC (CHRG-SUB)                             07340000
073500                                 TO AP036-INV-PCT-TO-LC           07350000
073600                                                                  07360000
073700         PERFORM W100-WRITE-AP036-RECORD                          07370000
073800         ADD 1                   TO PV-PO-DETAIL-WROTE            07380000
073900     END-IF.                                                      07390000
074000                                                                  07400000
074100                                                                  07410000
074200 R100-READ-PO-VAR.                                                07420000
074300*----------------------------------------------------------------*07430000
074400*     READ THE IMPORT PO RECEIVING FILE                          *07440000
074500*----------------------------------------------------------------*07450000
074600                                                                  07460000
074700     MOVE 'R100-READ-PO-VAR'     TO AA-PARAGRAPH-NAME.            07470000
074800                                                                  07480000
074900     READ PO-VAR-FILE INTO AP031-IMPORT-REPORT-FILE               07490000
075000       AT END  SET PO-VAR-END    TO TRUE.                         07500000
075100                                                                  07510000
075200     IF PO-VAR-END                                                07520000
075300        CONTINUE                                                  07530000
075400     ELSE                                                         07540000
075500        SET PO-VAR-FOUND         TO TRUE                          07550000
075600        ADD 1                    TO PV-PO-VAR-READ                07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900                                                                  07590000
076000 W100-WRITE-AP036-RECORD.                                         07600000
076100*----------------------------------------------------------------*07610000
076200*    WRITE THE PO COST VARIANCE RECORD.                          *07620000
076300*----------------------------------------------------------------*07630000
076400                                                                  07640000
076500     WRITE PO-COST-VAR-REC                                        07650000
076600       FROM AP036-IMPORT-REPORT-RECORD.                           07660000
076700                                                                  07670000
076800     ADD 1                       TO PV-PO-VAR-WROTE.              07680000
076900                                                                  07690000
077000                                                                  07700000
077100 Z100-LOAD-TABLE-DESC.                                            07710000
077200*----------------------------------------------------------------*07720000
077300*   IF A VALID ALLOW. CHARGE CODE IS ASSIGNED TO THE RPT LINE    *07730000
077400*    SEQ, THE RPT LINE SEQ AND CHRAGE CODES ARE LOADED TO A      *07740000
077500*    LITERAL TABLE. THE DESCRIPTION IS SELECTED FROM DB2, AND    *07750000
077600*    LOADED TO THE TABLE.                                        *07760000
077700*   THIS IS DONE ONCE IN THE PROGRAM, FOR 'COLBY' AND 'LETTER    *07770000
077800*    OF CREDIT', AND THESE VALUES ARE MOVED TO A WORKING TABLE   *07780000
077900*    ON A PO-BY-PO BASIS.                                        *07790000
078000*----------------------------------------------------------------*07800000
078100                                                                  07810000
078200     INITIALIZE  DCLTACCTYP.                                      07820000
078300                                                                  07830000
078400     IF PC-COLBY-CDE (CHRG-SUB) > SPACES                          07840000
078500       OR PC-LETTER-CDE (CHRG-SUB) > SPACES                       07850000
078600       OR PC-OPN-ACCT-CDE (CHRG-SUB) > SPACES                     07860000
078700       OR PC-NEXUS-CDE (CHRG-SUB) > SPACES                        07870000
078800         MOVE PC-RPT-LINE-SEQ (CHRG-SUB)                          07880000
078900                                 TO PV-LIT-RPT-LINE-SEQ           07890000
079000                                                      (CHRG-SUB)  07900000
079100         IF PC-COLBY-CDE (CHRG-SUB) > SPACES                      07910000
079200             MOVE PC-COLBY-CDE (CHRG-SUB)                         07920000
079300                                 TO PV-HLD-CHRG-CDE               07930000
079400                                    PV-LIT-COLBY-CDE (CHRG-SUB)   07940000
079500             PERFORM Z150-SELECT-DESC                             07950000
079600             MOVE PV-HLD-COMP-DESC                                07960000
079700                                  TO PV-LIT-COLBY-DESC (CHRG-SUB) 07970000
079800         END-IF                                                   07980000
079900                                                                  07990000
080000                                                                  08000000
080100         IF PC-NEXUS-CDE (CHRG-SUB) > SPACES                      08010000
080200             IF PC-NEXUS-CDE (CHRG-SUB) =                         08020000
080300                                          PV-HLD-CHRG-CDE         08030000
080400                 MOVE PV-HLD-COMP-DESC                            08040000
080500                                 TO PV-LIT-NEXUS-DESC (CHRG-SUB)  08050000
080600             ELSE                                                 08060000
080700                 MOVE PC-NEXUS-CDE (CHRG-SUB)                     08070000
080800                                 TO PV-HLD-CHRG-CDE               08080000
080900                                    PV-LIT-NEXUS-CDE (CHRG-SUB)   08090000
081000                 PERFORM Z150-SELECT-DESC                         08100000
081100                 MOVE PV-HLD-COMP-DESC                            08110000
081200                                 TO PV-LIT-NEXUS-DESC (CHRG-SUB)  08120000
081300             END-IF                                               08130000
081400         END-IF                                                   08140000
081500                                                                  08150000
081600         IF PC-LETTER-CDE (CHRG-SUB) > SPACES                     08160000
081700             IF PC-LETTER-CDE (CHRG-SUB) =                        08170000
081800                                          PV-HLD-CHRG-CDE         08180000
081900                 MOVE PV-HLD-COMP-DESC                            08190000
082000                                 TO PV-LIT-LETTER-DESC (CHRG-SUB) 08200000
082100             ELSE                                                 08210000
082110                 MOVE PC-LETTER-CDE (CHRG-SUB)                    08211000
082120                                 TO PV-HLD-CHRG-CDE               08212000
082130                                    PV-LIT-LETTER-CDE (CHRG-SUB)  08213000
082140                 PERFORM Z150-SELECT-DESC                         08214000
082150                 MOVE PV-HLD-COMP-DESC                            08215000
082160                                 TO PV-LIT-LETTER-DESC (CHRG-SUB) 08216000
082170             END-IF                                               08217000
082180         END-IF                                                   08218000
082190                                                                  08219000
082200         IF PC-OPN-ACCT-CDE (CHRG-SUB) > SPACES                   08220000
082300             IF PC-OPN-ACCT-CDE (CHRG-SUB) =                      08230000
082301                                          PV-HLD-CHRG-CDE         08230100
082302                 MOVE PV-HLD-COMP-DESC                            08230200
082303                               TO PV-LIT-OPN-ACCT-DESC (CHRG-SUB) 08230300
082304             ELSE                                                 08230400
082305                 MOVE PC-OPN-ACCT-CDE (CHRG-SUB)                  08230500
082306                               TO PV-HLD-CHRG-CDE                 08230600
082307                                  PV-LIT-OPN-ACCT-CDE (CHRG-SUB)  08230700
082308                 PERFORM Z150-SELECT-DESC                         08230800
082309                 MOVE PV-HLD-COMP-DESC                            08230900
082310                               TO PV-LIT-OPN-ACCT-DESC (CHRG-SUB) 08231000
082311             END-IF                                               08231100
082312         END-IF                                                   08231200
082313     END-IF.                                                      08231300
082314                                                                  08231400
082315                                                                  08231500
082316 Z150-SELECT-DESC.                                                08231600
082317*----------------------------------------------------------------*08231700
082318*    DB2 SELECT TO GET THE ALLOWANCE CHARGE CODE DESC            *08231800
082319*     FROM TACCTYP                                               *08231900
082320*----------------------------------------------------------------*08232000
082330     PERFORM WITH TEST AFTER                                      08233000
082340             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 08234000
082350             UNTIL   PV-RETRY-COUNTER > 3  OR                     08235000
082360                     SQLCODE = ZERO OR                            08236000
082370                     SQLCODE = +100                               08237000
082380                                                                  08238000
082390         EXEC SQL                                                 08239000
082400             SELECT ALW_CHRG_DESC                                 08240000
082500             INTO   :PV-HLD-COMP-DESC                             08250000
082600             FROM   TACCTYP                                       08260000
082700             WHERE  ALW_CHRG_CDE = :PV-HLD-CHRG-CDE               08270000
082800               AND  CURRENT DATE   BETWEEN EFF_STRT_DTE           08280000
082900                                       AND EFF_END_DTE            08290000
083000         END-EXEC                                                 08300000
083100                                                                  08310000
083200         EVALUATE TRUE                                            08320000
083300           WHEN SQLCODE = ZERO                                    08330000
083400             CONTINUE                                             08340000
083500                                                                  08350000
083600           WHEN SQLCODE = +100                                    08360000
083700             MOVE 'NO CHARGE CODE DESC FOUND '                    08370000
083800                                 TO PV-HLD-COMP-DESC              08380000
083900                                                                  08390000
084000           WHEN SQLWARN0 NOT = SPACES                             08400000
084100           WHEN SQLCODE NOT  = ZERO                               08410000
084200             DISPLAY 'ALLOW CHARGE CODE: ' PV-HLD-CHRG-CDE        08420000
084300             MOVE 'Z150-SELECT-DESC  '                            08430000
084400                                 TO AA-PARAGRAPH-NAME             08440000
084500             MOVE 'UNSUCCESSFUL SELECT'                           08450000
084600                                 TO AA-DB2-OPERATION              08460000
084700             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                08470000
084800             INITIALIZE             AA-DB2-TABLE-2                08480000
084900                                    AA-DB2-TABLE-3                08490000
085000             PERFORM Z999-DB2-ABEND                               08500000
085100         END-EVALUATE                                             08510000
085200     END-PERFORM.                                                 08520000
085300                                                                  08530000
085400     IF PV-RETRY-COUNTER > 3                                      08540000
085500         MOVE 'Z150-SELECT-DESC  '                                08550000
085600                                 TO AA-PARAGRAPH-NAME             08560000
085700         MOVE 'MAX RETRIES EXCEEDED ON SELECT ACCTYP'             08570000
085800                                 TO AA-DB2-OPERATION              08580000
085900         PERFORM Z999-DB2-ABEND                                   08590000
086000     END-IF.                                                      08600000
086100                                                                  08610000
086200                                                                  08620000
086300 Z200-SELECT-DMA.                                                 08630000
086400*----------------------------------------------------------------*08640000
086500*    DB2 SELECT TO GET THE DIVISION (DMA) FROM TMDSEAR.          *08650000
086600*----------------------------------------------------------------*08660000
086700                                                                  08670000
086800     EXEC SQL                                                     08680000
086900         SELECT DMA_NBR                                           08690000
087000          INTO :PV-HOLD-DMA-NBR                                   08700000
087100          FROM TMDSEAR                                            08710000
087200        WHERE MDSELV_CDE = 'DPT'                                  08720000
087300          AND DEPT_NBR   = :PV-DEPT-NBR                           08730000
087400          AND END_DTE = (SELECT MAX(A.END_DTE)                    08740000
087500               FROM TMDSEAR A                                     08750000
087600                 WHERE A.DEPT_NBR   = DEPT_NBR                    08760000
087700                   AND A.END_DTE >= CURRENT DATE)                 08770000
087800         WITH UR                                                  08780000
087900     END-EXEC.                                                    08790000
088000                                                                  08800000
088100     EVALUATE TRUE                                                08810000
088200         WHEN SQLCODE = ZERO                                      08820000
088300            CONTINUE                                              08830000
088400                                                                  08840000
088500         WHEN SQLWARN0 NOT = SPACES                               08850000
088600         WHEN SQLCODE NOT  = ZERO                                 08860000
088700            MOVE 'Z200-SELECT-DMA '                               08870000
088800                                TO AA-PARAGRAPH-NAME              08880000
088900            MOVE 'UNSUCCESSFUL SELECT OF DMA'                     08890000
089000                                TO AA-DB2-OPERATION               08900000
089100            MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                 08910000
089200            INITIALIZE             AA-DB2-TABLE-2                 08920000
089300                                   AA-DB2-TABLE-3                 08930000
089400            PERFORM Z999-DB2-ABEND                                08940000
089500                                                                  08950000
089600     END-EVALUATE.                                                08960000
089700                                                                  08970000
089800                                                                  08980000
089900 Z999-DB2-ABEND.                                                  08990000
090000*----------------------------------------------------------------*09000000
090100*    ABEND ROUTINE                                               *09010000
090200*----------------------------------------------------------------*09020000
090300                                                                  09030000
090400     CLOSE PO-VAR-FILE                                            09040000
090500           PO-COST-VAR-FILE.                                      09050000
090600     DISPLAY AA-ABEND-LIT.                                        09060000
090700     DISPLAY AA-MESSAGE-LINE.                                     09070000
090800     DISPLAY AA-DB2-ERROR-LIT.                                    09080000
090900     DISPLAY AA-PROGRAM-LIT.                                      09090000
091000     DISPLAY AA-PARAGRAPH-LIT.                                    09100000
091100     DISPLAY AA-DB2-OPERATION-LIT.                                09110000
091200     DISPLAY AA-DB2-TABLE-1.                                      09120000
091300     DISPLAY AA-DB2-TABLE-2.                                      09130000
091400     DISPLAY AA-DB2-TABLE-3.                                      09140000
091500     SET AC-DB2-ERROR TO TRUE.                                    09150000
091600                                                                  09160000
091700     COPY DPPD004.                                                09170000
091800                                                                  09180000
091900     CALL 'ILBOABN0' USING ABEND-CODE.                            09190000
092000                                                                  09200000
092100                                                                  09210000
092200                                                                  09220000
