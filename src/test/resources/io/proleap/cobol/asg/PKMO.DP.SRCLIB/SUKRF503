000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020049
000300******************************************************************00030049
000400                                                                  00040049
000500 PROGRAM-ID.             SUKRF503.                                00050049
000600 AUTHOR.                 LARRY SCHLEICHER - STRATAGEM             00060049
000700 INSTALLATION.           KOHLS.                                   00070049
000800 DATE-WRITTEN            JUNE, 1996.                              00080049
000900 DATE-COMPILED.                                                   00090049
001000                                                                  00100049
001100******************************************************************00110049
001200* THIS PROGRAM DISPLAYS THE TRAILER STOP SCREEN ON THE            00120049
001300* LRT (LASER RADIO TERMINAL).  THE OPERATOR CAN SELECT TO         00130049
001400* POSTPONE THE CHECK-IN -OR- PRINT THE REPORTS.                   00140049
001500******************************************************************00150049
001600* CHANGED: 04/03/98 DENISE HAHN  WR#6203                          00160049
001700*          ADDED 3RD OPTION TO SCREEN TO PRINT INDIVIDUAL REPORTS 00170049
001800******************************************************************00180049
263968* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00182099
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00183099
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00184099
001800******************************************************************00186099
001900                                                                  00190049
002000******************************************************************00200049
002100 ENVIRONMENT DIVISION.                                            00210049
002200******************************************************************00220049
002300                                                                  00230049
002400******************************************************************00240049
002500 DATA DIVISION.                                                   00250049
002600******************************************************************00260049
002700                                                                  00270049
002800******************************************************************00280049
002900 WORKING-STORAGE SECTION.                                         00290049
003000******************************************************************00300049
003100 01  CA-COMMAREA.                                                 00310059
003200     COPY SUWS001.                                                00320099
003300                                                                  00330099
003400 01  CA-PROGRAM-DATA.                                             00340060
003500     05  CA-SELECTION-X              PIC  X(01)  VALUE SPACE.     00350060
003600     05  CA-SELECTION REDEFINES CA-SELECTION-X                    00360060
003700                                         PIC  9(01).              00370049
003800         88  CA-VALID-SELECTION               VALUE               00380060
003900             1 2 3.                                               00390049
004000         88  CA-POSTPONE-CHECKIN              VALUE 1.            00400060
004100         88  CA-PRINT-REPORTS                 VALUE 2.            00410060
004200         88  CA-PRINT-IND-REPORTS             VALUE 3.            00420060
004300                                                                  00430049
004400*----------------------------------------------------------------*00440097
004500*  DB2 KEYS                                                      *00450056
004600*----------------------------------------------------------------*00460056
004700 01  DK-DB2-KEYS.                                                 00470056
004800     05  DK-OPER-UNT-ID                  PIC  S9(04)  COMP.       00480056
004900     05  DK-FCLTY-ID                     PIC  S9(04)  COMP.       00490056
005000                                                                  00500099
005100*----------------------------------------------------------------*00510056
005200*                                                                *00520056
005300*----------------------------------------------------------------*00530056
005400 01  PC-PROGRAM-CONSTANTS.                                        00540049
005500     05  PC-LOGON-TRAN-ID                PIC  X(04)  VALUE 'Z028'.00550049
005600*LMM 05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +300   00560099
005700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00570099
005800                                                     COMP SYNC.   00580099
005900     05  PC-LEAVE-SYSTEM-LENGTH         PIC S9(04)   VALUE +160   00590049
006000                                                     COMP SYNC.   00600049
006100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00610049
006200         'SUKRF503'.                                              00620049
006300     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00630049
006400         'DPKCS060'.                                              00640049
006500     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00650049
006600         'SUKRP002'.                                              00660049
006700     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00670049
006800         'MPKCS027'.                                              00680049
006900     05  PC-SU-TRAILER-PGM               PIC  X(08)  VALUE        00690049
007000         'SUKRF529'.                                              00700088
007100     05  PC-SU-IND-RPT-PGM               PIC  X(08)  VALUE        00710049
007200         'SUKRF525'.                                              00720049
007300*LMM                                                              00730099
007400     05  PC-SU-PO-RPT-RQST-PGM           PIC  X(08)  VALUE        00740099
007500         'SUKRF531'.                                              00750099
007600     05  PC-SU-TRAILER-STOP              PIC  X(04)  VALUE 'S503'.00760049
007700     05  PC-SU-MENU                      PIC  X(04)  VALUE 'S500'.00770049
007800     05  PC-01                           PIC  X(02)  VALUE '01'.  00780049
007900     05  PC-A                            PIC  X(01)  VALUE 'A'.   00790049
008000     05  PC-Y                            PIC  X(01)  VALUE 'Y'.   00800055
008100     05  PC-N                            PIC  X(01)  VALUE 'N'.   00810099
008200     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00820049
008300         'END OF SESSION     '.                                   00830049
008400     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00840049
008500         'INVALID SELECTION  '.                                   00850049
008600     05  PC-INVALID-PRINT-ID-MSG         PIC  X(19)  VALUE        00860049
008700         'INVALID PRINTER ID '.                                   00870049
008800     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00880049
008900         'UNRECOGNIZED PF KEY'.                                   00890049
009000     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00900049
009100         'NUMERIC VALUE REQ. '.                                   00910049
009200     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00920049
009300         'TRANS NOT AVAILABLE'.                                   00930049
009400     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00940049
009500         'CICS ABEND -CALL DP'.                                   00950049
009600     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00960049
009700         'CICSAUTH BAD RETURN'.                                   00970049
009800     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00980049
009900         'SELECTION NOT AVAIL'.                                   00990049
010000     05  PC-REPORT-SENT-MSG.                                      01000062
010100         10  FILLER                      PIC  X(10)  VALUE        01010064
010200             'RPTS SENT '.                                        01020064
010300         10  PC-MSG-PRTR-ID              PIC  X(08)  VALUE SPACES.01030062
010400                                                                  01040049
010500                                                                  01050049
010600 01  PS-PROGRAM-SWITCHES.                                         01060049
010700     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01070049
010800         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01080049
010900         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01090049
011000     05  PS-ABEND-IND                   PIC X(01)    VALUE 'N'.   01100049
011100         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   01110049
011200         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   01120049
011300     05  PS-INTERNAL-READER-ENQ-DEQ-IND                           01130049
011400                                        PIC X(01)    VALUE 'D'.   01140049
011500         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   01150049
011600         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   01160049
011700                                                                  01170049
011800                                                                  01180049
011900 01  PV-PROGRAM-VARIABLES.                                        01190049
012000*LMM                                                              01200099
012100*                                                                 01210099
012200     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01220049
012300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01230049
012400                                                     COMP SYNC.   01240049
012500     05  PV-LEAVE-SYSTEM-MESSAGE         PIC X(160)  VALUE SPACES.01250049
012600     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01260049
012700     05  PV-SYSTEM-ID.                                            01270049
012800         10  FILLER              PIC  X(04)   VALUE SPACE.        01280049
012900         10  PV-REGION-IND       PIC  X(01).                      01290049
013000             88  PV-TEST-CICS                 VALUE 'T'.          01300049
013100             88  PV-QA-CICS                   VALUE 'Q'.          01310049
013200             88  PV-PROD-CICS                 VALUE 'P'.          01320049
013300             88  PV-LEARN-CICS                VALUE 'L'.          01330049
013400         10  FILLER              PIC X(03)    VALUE SPACES.       01340049
013500     05  PV-PRINTER-DESTINATION  PIC X(08)    VALUE SPACES.       01350099
013600                                                                  01360049
013700 01  PV-SUKRP511-COMMAREA.                                        01370049
013800     05  PV-CA-ORD-NBR         PIC  9(08)  VALUE ZEROS.           01380049
013900     05  PV-CA-RCVR-SEQ-NBR    PIC  9(03)  VALUE ZEROS.           01390049
014000     05  PV-CA-ORD-LNE-NBR     PIC  9(04)  VALUE ZEROS.           01400049
014100     05  PV-CA-WORK-ORD-SEQ-NBR                                   01410049
014200                               PIC  9(03)  VALUE ZEROS.           01420049
014300     05  PV-CA-PRINTER-DESTINATION                                01430049
014400                               PIC  X(04)  VALUE SPACE.           01440049
014500     05  PV-CA-USER-ID         PIC  X(08)  VALUE SPACE.           01450049
014600     05  PV-CA-OPERATING-ID    PIC  X(04)  VALUE SPACE.           01460049
014700     05  PV-CA-FACILITY-ID     PIC  X(04)  VALUE SPACE.           01470049
014800     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01480049
014900                                                     COMP.        01490049
015000     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01500049
015100                                                     COMP SYNC.   01510049
015200     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01520049
015300*                                                                 01530049
015400 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  01540049
015500     05  TS-INFO-QUEUE-NAME.                                      01550049
015600         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 01560049
015700         10  FILLER                      PIC  X(04)  VALUE 'INFO'.01570049
015800                                                                  01580049
015900******************************************************************01590049
016000*  JCL LINES FOR REQUESTING THE COMPLETION/EXCEPTION REPORTS      01600049
016100******************************************************************01610049
016200                                                                  01620049
016300 01  JL-JCL-LINE-AREA.                                            01630049
016400     05  JL-JCL-LINE-1           PIC X(80).                       01640049
016500     05  JL-JOB-LINE-PROD.                                        01650049
016600         10  FILLER              PIC X(21)    VALUE               01660049
016700             '//SUK900   JOB KOHLS,'.                             01670049
016800         10  FILLER              PIC X(1)     VALUE QUOTE.        01680049
016900         10  FILLER              PIC X(13)    VALUE               01690049
017000             'REPORTS PRINT'.                                     01700049
017100         10  FILLER              PIC X(1)     VALUE QUOTE.        01710049
017200         10  FILLER              PIC X(19)    VALUE               01720049
017300             ',MSGCLASS=P,CLASS=Q'.                               01730099
017400         10  FILLER              PIC X(16)    VALUE SPACES.       01740049
017500     05  JL-JOB-LINE-TEST.                                        01750049
017600         10  FILLER              PIC X(02)    VALUE               01760049
017700             '//'.                                                01770049
017800         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       01780049
017900         10  FILLER              PIC X(01)    VALUE               01790049
018000             'Q'.                                                 01800049
018100         10  FILLER              PIC X(11)    VALUE               01810049
018200             ' JOB KOHLS,'.                                       01820049
018300         10  FILLER              PIC X(1)     VALUE QUOTE.        01830049
018400         10  FILLER              PIC X(13)    VALUE               01840049
018500             'REPORTS PRINT'.                                     01850049
018600         10  FILLER              PIC X(1)     VALUE QUOTE.        01860049
018700         10  FILLER              PIC X(19)    VALUE               01870049
018800             ',MSGCLASS=X,CLASS=E'.                               01880049
018900         10  FILLER              PIC X(18)    VALUE SPACES.       01890049
019000     05  JL-JCL-LINE-3.                                           01900049
019100         10  FILLER              PIC X(13)    VALUE               01910049
019200             '/*JOBPARM K=0'.                                     01920049
019300         10  FILLER              PIC X(67)    VALUE SPACES.       01930049
019400     05  JL-JCL-LINE-4-PROD.                                      01940049
019500         10  FILLER              PIC X(39)    VALUE               01950049
019600             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           01960049
019700         10  FILLER              PIC X(41)    VALUE SPACES.       01970049
019800     05  JL-JCL-LINE-4-TEST.                                      01980049
019900         10  FILLER              PIC X(39)    VALUE               01990049
020000             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           02000049
020100         10  FILLER              PIC X(41)    VALUE SPACES.       02010049
020200     05  JL-JCL-LINE-4-QA.                                        02020090
020300         10  FILLER              PIC X(39)    VALUE               02030090
020400             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           02040090
020500         10  FILLER              PIC X(41)    VALUE SPACES.       02050090
020600     05  JL-JCL-LINE-4-LRN.                                       02060090
020700         10  FILLER              PIC X(39)    VALUE               02070090
020800             '//JOBLIB   DD DSN=LKMO.LOADLIB,DISP=SHR'.           02080090
020900         10  FILLER              PIC X(41)    VALUE SPACES.       02090090
021400     05  JL-JCL-LINE-12.                                          02140090
021500         10  FILLER              PIC X(17)    VALUE               02150090
021600             '//PS020    EXEC '.                                  02160090
021700         10  JL-LINE-12-PROC     PIC X(06)    VALUE               02170090
021800             'SUK900'.                                            02180090
021900         10  JL-LINE-12-PROC-T   PIC X(01)    VALUE SPACES.       02190090
022000         10  JL-LINE-12-PROC-T2  PIC X(01)    VALUE SPACES.       02200092
022100         10  FILLER              PIC X(56)    VALUE SPACES.       02210090
022200     05  JL-JCL-LINE-13.                                          02220049
022300         10  FILLER              PIC  X(34)  VALUE                02230049
022400             '//JOBOUT01 OUTPUT FORMS=STD,FCB=8S'.                02240049
022500         10  FILLER              PIC  X(17)  VALUE                02250049
022600             ',CLASS=A,COPIES=1'.                                 02260049
022700         10  FILLER              PIC  X(06)  VALUE                02270049
022800             ',DEST='.                                            02280049
022900         10  JL-LINE-13-PRINTER  PIC  X(08)  VALUE SPACES.        02290049
023000         10  FILLER              PIC  X(16)  VALUE SPACE.         02300049
023100*    05  JL-JCL-LINE-AUTO-SCHD.                                   02310099
023200*        10  FILLER                     PIC X(40)  VALUE          02320099
023300*            '//$AUTO    EXEC PGM=$A,COND=(0,LE),PARM='.          02330099
023400*        10  FILLER                     PIC X(01)  VALUE QUOTE.   02340099
023500*        10  FILLER                     PIC X(01)  VALUE '>'.     02350099
023600*        10  FILLER                     PIC X(01)  VALUE QUOTE.   02360099
023700*        10  FILLER                     PIC X(37)  VALUE SPACES.  02370099
023800*BUILD TRIP CONTROL CARD-SUCC005                                  02380099
023900     05  JL-JCL-LINE-14.                                          02390049
024000         10  FILLER              PIC X(18)    VALUE               02400049
024100             '//S010.SYSUT1 DD *'.                                02410049
024200         10  FILLER              PIC X(62)    VALUE SPACES.       02420049
024300     05  JL-JCL-LINE-15.                                          02430049
024400         10  JL-LINE-15-MANIFEST PIC X(09).                       02440049
024500*LMM ADD TK NUMBER AND REQUEST TIMESTAMP                          02450098
024600         10  FILLER              PIC X(01)    VALUE SPACES.       02460098
024700         10  JL-LINE-15-USER-ID  PIC X(08).                       02470099
024800         10  FILLER              PIC X(01)    VALUE SPACES.       02480098
024900         10  JL-LINE-15-TIMESTMP PIC X(26).                       02490098
025000         10  FILLER              PIC X(35)    VALUE SPACES.       02500099
025100*BUILD PRINTER CONTROL CARD-SUCC006                               02510099
025200     05  JL-JCL-LINE-16.                                          02520049
025300         10  FILLER              PIC X(18)    VALUE               02530049
025400             '//S035.SYSUT1 DD *'.                                02540049
025500         10  FILLER              PIC X(62)    VALUE SPACES.       02550049
025600     05  JL-JCL-LINE-17.                                          02560052
025700         10  JL-LINE-17-PRINTER  PIC X(08)    VALUE SPACES.       02570055
025800         10  JL-LINE-17-PRTR-IND PIC X(01)    VALUE SPACES.       02580052
025900         10  JL-LINE-17-TRACK-NBR                                 02590052
026000                                 PIC  9(1)    VALUE 0.            02600052
026100         10  FILLER              PIC X(01)    VALUE SPACES.       02610052
026200         10  JL-LINE-17-CUT-RPT  PIC X(01)    VALUE SPACES.       02620052
026300         10  JL-LINE-17-USER-ID  PIC X(08)    VALUE SPACES.       02630052
026400         10  JL-LINE-17-STAT-RPT PIC X(01)    VALUE SPACES.       02640052
026500         10  JL-LINE-17-CRTN-RPT PIC X(01)    VALUE SPACES.       02650052
026600         10  JL-LINE-17-MSDR-RPT PIC X(01)    VALUE SPACES.       02660052
026700         10  JL-LINE-17-FREE-RPT PIC X(01)    VALUE SPACES.       02670054
026800         10  JL-LINE-17-DUPL-RPT PIC X(01)    VALUE SPACES.       02680052
026900         10  JL-LINE-17-WRKS-RPT PIC X(01)    VALUE SPACES.       02690052
027000         10  JL-LINE-17-SCAN-RPT PIC X(01)    VALUE SPACES.       02700052
027100         10  JL-LINE-17-ULBL-RPT PIC X(01)    VALUE SPACES.       02710089
027200*LMM ADD ALL PO INDICATOR                                         02720098
027300         10  FILLER              PIC X(01)    VALUE SPACES.       02730098
027400         10  JL-LINE-17-ALL-PO-IND                                02740098
027500                                 PIC X(01)    VALUE SPACES.       02750098
027600         10  FILLER              PIC X(50)    VALUE SPACES.       02760098
027700     05  JL-JCL-LINE-EOF.                                         02770049
027800         10  FILLER              PIC X(5)     VALUE '/*EOF'.      02780049
027900         10  FILLER              PIC X(75)    VALUE SPACES.       02790049
028000                                                                  02800049
028100 01  TD-TRANSIENT-DATA-AREA.                                      02810049
028200     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       02820049
028300     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            02830049
028400                                 COMP SYNC.                       02840049
028500     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       02850049
028600     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           02860049
028700                                 COMP SYNC.                       02870049
028800                                                                  02880049
028900                                                                  02890049
029000 01  SE-SYSTEM-ERROR-MESSAGE.                                     02900049
029100     05  FILLER                  PIC X(43)    VALUE               02910049
029200         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           02920049
029300     05  FILLER                  PIC X(33)    VALUE               02930049
029400         'PROGRAM RFKCS215       EIBRESP = '.                     02940049
029500     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         02950049
029600     05  FILLER                  PIC X(5)     VALUE SPACES.       02960049
029700     05  FILLER                  PIC X(14)    VALUE               02970049
029800         'ATTEMPTING TO '.                                        02980049
029900     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       02990049
030000******************************************************************03000049
030100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               03010049
030200******************************************************************03020049
030300     COPY DPWS013.                                                03030099
030400                                                                  03040049
030500******************************************************************03050049
030600*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        03060049
030700******************************************************************03070049
030800     COPY DPWS008.                                                03080099
030900                                                                  03090049
031000******************************************************************03100049
031100*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 03110049
031200******************************************************************03120049
031300     COPY DPWS010I.                                               03130099
031400                                                                  03140049
031500                                                                  03150049
031600******************************************************************03160049
031700*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          03170049
031800*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            03180049
031900******************************************************************03190049
032000     COPY DPWS026.                                                03200099
032100******************************************************************03210049
032200*  SENDING/RECEIVING AREA FOR THE                                 03220049
032300*  PRINTER VALIDATION ROUTING (DPKCS060)                          03230049
032400******************************************************************03240049
032500     COPY DPWS072.                                                03250099
032600                                                                  03260049
032700******************************************************************03270049
032800*  GENERATED DSECT FOR THE MPKM027 MAPSET                         03280049
032900******************************************************************03290049
033000     COPY SUKM503.                                                03300049
033100                                                                  03310049
033200******************************************************************03320049
033300*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03330049
033400******************************************************************03340049
033500     COPY DPWS015.                                                03350099
033600                                                                  03360049
033700******************************************************************03370049
033800*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      03380049
033900******************************************************************03390049
034000     COPY DFHAID.                                                 03400049
034100                                                                  03410049
034200******************************************************************03420049
034300*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE COMPANY CONTROL    03430049
034400*  TABLE                                                          03440049
034500******************************************************************03450049
034600     EXEC SQL                                                     03460049
034700          INCLUDE TCOCNTL                                         03470049
034800     END-EXEC.                                                    03480049
034900                                                                  03490099
035000******************************************************************03500099
035100*  COMMUNICATIONS AREA FOR DB2                                    03510099
035200******************************************************************03520099
035300     EXEC SQL                                                     03530099
035400          INCLUDE SQLCA                                           03540099
035500     END-EXEC.                                                    03550099
035600******************************************************************03560099
035700 LINKAGE SECTION.                                                 03570099
035800******************************************************************03580099
035900*01  DFHCOMMAREA                         PIC  X(300).             03590099
036000 01  DFHCOMMAREA.                                                 03600099
036100     05  FILLER                       OCCURS 1 TO 4072 TIMES      03610099
036200                                      DEPENDING ON EIBCALEN.      03620099
036300         10  FILLER                   PIC X.                      03630099
036400                                                                  03640099
036500******************************************************************03650099
036600 PROCEDURE DIVISION.                                              03660099
036700******************************************************************03670099
036800 0000-PROGRAM-MAINLINE.                                           03680099
036900     MOVE DFHCOMMAREA                TO CA-COMMAREA.              03690099
037000                                                                  03700099
037100                                                                  03710099
037200     MOVE SU001-PRINTER-ID TO PV-PRINTER-DESTINATION.             03720099
037300                                                                  03730099
037400     EVALUATE TRUE                                                03740099
037500         WHEN EIBCALEN = ZERO                                     03750099
037600         WHEN EIBAID = DFHCLEAR                                   03760099
037700         WHEN SU001-INITIALIZE-SCREEN                             03770099
037800              SET SU001-PROCESS-SCREEN TO TRUE                    03780099
037900              INITIALIZE CA-PROGRAM-DATA                          03790099
038000                                                                  03800099
038100              IF SU001-LAST-PROGRAM = 'SUKRF531' AND              03810099
038200                 SU001-SUBMIT-JOB                                 03820099
038400                 MOVE SU001-PRINTER-ID TO PV-PRINTER-DESTINATION  03840099
038500                 PERFORM 1200-VALIDATE-PRINTER                    03850099
038600                 PERFORM 2200-PRINT-REPORTS                       03860099
038700              END-IF                                              03870099
038800                                                                  03880099
038900*             IF SU001-LAST-PROGRAM = 'SUKRF531' OR               03890099
039000*                SU001-LAST-PROGRAM = 'SUKRF525'                  03900099
039100*                AND SU001-NO-RPT-REQUESTED                       03910099
039200*                MOVE SU001-PRINTER-ID-USE                        03920099
039300*                                      TO APRNTIDO                03930099
039400*                                         PV-PRINTER-DESTINATION  03940099
039500*             ELSE                                                03950099
039510              IF SU001-PRINTER-ID = SPACES                        03951099
039600                 PERFORM 0500-SELECT-PRINTER                      03960099
039700                 MOVE COCNTL-DFLT-SU-PRTR-ID TO APRNTIDO          03970099
039710                                                SU001-PRINTER-ID  03971099
039720                                           SU001-PRINTER-ID-USE   03972099
039800                 MOVE DP015-UNP-ALP-NOR-MDT  TO APRNTIDA          03980099
039810              ELSE                                                03981099
039820                 MOVE SU001-PRINTER-ID-USE   TO APRNTIDO          03982099
039830                 MOVE DP015-UNP-ALP-NOR-MDT  TO APRNTIDA          03983099
039900              END-IF                                              03990099
040000                                                                  04000099
040100              IF  SU001-RPT-REQUESTED                             04010099
040200*WR-9900                                                          04020099
040300*                 MOVE COCNTL-DFLT-SU-PRTR-ID TO PC-MSG-PRTR-ID   04030099
040400                  MOVE SU001-PRINTER-ID-USE   TO PC-MSG-PRTR-ID   04040099
040500*WR-9900                                                          04050099
040600                  MOVE PC-REPORT-SENT-MSG     TO AMSGLNO          04060099
040700                  MOVE SPACES  TO  SU001-REPORT-REQUEST-SW        04070099
040800              END-IF                                              04080099
040900                                                                  04090099
041000              PERFORM 8000-SEND-MAP                               04100099
041100              PERFORM 8200-RETURN-TRANID                          04110099
041200         WHEN EIBAID = DFHENTER                                   04120099
041300              PERFORM 1000-RECEIVE-MAP                            04130099
041400              PERFORM 1100-EDIT-SELECTION                         04140099
041500         WHEN OTHER                                               04150099
041600              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     04160099
041700                                     TO AMSGLNO                   04170099
041800              PERFORM 8100-SEND-DATA-ONLY                         04180099
041900              PERFORM 8200-RETURN-TRANID                          04190099
042000     END-EVALUATE.                                                04200099
042100                                                                  04210099
042200     GOBACK.                                                      04220099
042300                                                                  04230099
042400 0500-SELECT-PRINTER.                                             04240099
042500                                                                  04250099
042600     MOVE  SU001-OPER-UNT-ID TO  DK-OPER-UNT-ID                   04260099
042700     MOVE  SU001-FCLTY-ID    TO  DK-FCLTY-ID.                     04270099
042800                                                                  04280099
042900     EXEC SQL                                                     04290099
043000          SELECT DFLT_SU_PRTR_ID                                  04300099
043100            INTO :COCNTL-DFLT-SU-PRTR-ID                          04310099
043200            FROM TCOCNTL                                          04320099
043300            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                   04330099
043400              AND FCLTY_ID    = :DK-FCLTY-ID                      04340099
043500     END-EXEC.                                                    04350099
043600                                                                  04360099
043700     EVALUATE TRUE                                                04370099
043800         WHEN SQLCODE = ZERO                                      04380099
043900             CONTINUE                                             04390099
044000         WHEN SQLWARN0 NOT = SPACES                               04400099
044100         WHEN SQLCODE < ZERO                                      04410099
044200         WHEN SQLCODE > ZERO                                      04420099
044300             MOVE '0500-SELECT-PRINTER'                           04430099
044400                             TO DP013-PARAGRAPH                   04440099
044500             MOVE 'SELECT DEFAULT PRINTER ID'                     04450099
044600                             TO DP013-MESSAGE-TEXT(1)             04460099
044700             MOVE SU001-OPER-UNT-ID                               04470099
044800                             TO DP013-MESSAGE-TEXT(2)             04480099
044900             MOVE SU001-FCLTY-ID                                  04490099
045000                             TO DP013-MESSAGE-TEXT(3)             04500099
045100             MOVE SQLCA      TO DP013-SQLCA                       04510099
045200             MOVE 'TCOCNTL'  TO DP013-DB2-TABLE-NAME(1)           04520099
045300             SET DP013-DB2-ABEND                                  04530099
045400                             TO TRUE                              04540099
045500             SET DP013-NO-ROLLBACK                                04550099
045600                             TO TRUE                              04560099
045700             SET DP013-XCTL-DISPLAY-RESTART                       04570099
045800                             TO TRUE                              04580099
045900             PERFORM DP014-0000-PROCESS-ABEND                     04590099
046000     END-EVALUATE.                                                04600099
046100 1000-RECEIVE-MAP.                                                04610099
046200     EXEC CICS                                                    04620099
046300         RECEIVE MAP    ('SU503A')                                04630099
046400                 MAPSET ('SUKM503')                               04640099
046500                 RESP   (PV-CICS-RESPONSE)                        04650099
046600     END-EXEC.                                                    04660099
046700                                                                  04670099
046800     EVALUATE TRUE                                                04680099
046900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04690099
047000              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  04700099
047100         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                04710099
047200              CONTINUE                                            04720099
047300         WHEN OTHER                                               04730099
047400              MOVE '1000-RECEIVE-MAP'                             04740099
047500                                     TO DP013-PARAGRAPH           04750099
047600              MOVE 'UNABLE TO RECEIVE MAP'                        04760099
047700                                     TO DP013-MESSAGE-TEXT (1)    04770099
047800              SET DP013-LOGIC-ABEND  TO TRUE                      04780099
047900              SET DP013-NO-ROLLBACK  TO TRUE                      04790099
048000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04800099
048100     END-EVALUATE.                                                04810099
048200                                                                  04820099
048300 1010-RECEIVE-SCREEN-FIELDS.                                      04830099
048400     IF  ASELECTL > ZERO                                          04840099
048500         MOVE ASELECTI               TO CA-SELECTION-X            04850099
048600     END-IF.                                                      04860099
048700                                                                  04870099
048800     IF  APRNTIDL > ZERO                                          04880099
048900         MOVE APRNTIDI               TO PV-PRINTER-DESTINATION    04890099
049000*LMM                                                              04900099
049100                                        SU001-PRINTER-ID-USE      04910099
049200     END-IF.                                                      04920099
049300                                                                  04930099
049400 1100-EDIT-SELECTION.                                             04940099
049500     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    04950099
049600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    04960099
049700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  04970099
049800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     04980099
049900                                                                  04990099
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05001099
263968          USING DP010I-NUMERIC-EDIT-AREA.                         05002099
050100                                                                  05010099
050200     IF  DP010I-ERROR-DETECTED                                    05020099
050300         MOVE PC-NON-NUMERIC-SELECTION-MSG                        05030099
050400                                     TO AMSGLNO                   05040099
050500         PERFORM 8100-SEND-DATA-ONLY                              05050099
050600         PERFORM 8200-RETURN-TRANID                               05060099
050700     ELSE                                                         05070099
050800         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              05080099
050900     END-IF.                                                      05090099
051000                                                                  05100099
051100     IF  CA-PRINT-REPORTS OR                                      05110099
051200         CA-PRINT-IND-REPORTS                                     05120099
051300         PERFORM 1200-VALIDATE-PRINTER                            05130099
051400     END-IF.                                                      05140099
051500                                                                  05150099
051600     EVALUATE TRUE                                                05160099
051700         WHEN CA-PRINT-REPORTS                                    05170099
051800          AND DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL PC-A         05180099
051900             MOVE DP015-UNP-ALP-NOR-MDT  TO APRNTIDA              05190099
052000             MOVE -1 TO APRNTIDL                                  05200099
052100             MOVE PC-INVALID-PRINT-ID-MSG                         05210099
052200                                         TO AMSGLNO               05220099
052300             PERFORM 8100-SEND-DATA-ONLY                          05230099
052400             PERFORM 8200-RETURN-TRANID                           05240099
052500         WHEN CA-PRINT-IND-REPORTS                                05250099
052600          AND DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL PC-A         05260099
052700             MOVE DP015-UNP-ALP-NOR-MDT  TO APRNTIDA              05270099
052800             MOVE -1 TO APRNTIDL                                  05280099
052900             MOVE PC-INVALID-PRINT-ID-MSG                         05290099
053000                                         TO AMSGLNO               05300099
053100             PERFORM 8100-SEND-DATA-ONLY                          05310099
053200             PERFORM 8200-RETURN-TRANID                           05320099
053300         WHEN CA-VALID-SELECTION                                  05330099
053400             PERFORM 2000-PROCESS-SELECTION                       05340099
053500         WHEN OTHER                                               05350099
053600             MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA              05360099
053700             MOVE PC-INVALID-SELECTION-MSG                        05370099
053800                                         TO AMSGLNO               05380099
053900             PERFORM 8100-SEND-DATA-ONLY                          05390099
054000             PERFORM 8200-RETURN-TRANID                           05400099
054100     END-EVALUATE.                                                05410099
054200                                                                  05420099
054300***************************************************************** 05430099
054400*   1200-VALIDATE-PRINTER                                       * 05440099
054500* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                     * 05450099
054600***************************************************************** 05460099
054700 1200-VALIDATE-PRINTER.                                           05470099
054800                                                                  05480099
054900*    GET THE LOCATION OPER UNT ID FROM THE TEMP STORAGE QUEUE     05490099
055000*    THAT IS SET-UP IN THE ARCHITECTURE.                          05500099
055100     PERFORM 1300-FIND-SYSTEM-ID.                                 05510099
055200     PERFORM 1400-FIND-LOGON-INFO.                                05520099
055300                                                                  05530099
055400     MOVE PV-PRINTER-DESTINATION     TO DP072-PRINTER-ID.         05540099
055500     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        05550099
055600     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     05560099
055700     MOVE DP026-LOCATION-NBR         TO DP072-ORIGIN-OPER-UNT-ID  05570099
055800                                        SU001-ORIGIN-OPER-UNT-ID. 05580099
055900     MOVE SU001-OPER-UNT-ID          TO DP072-OPER-UNT-ID.        05590099
056000     MOVE DP026-FCLTY-ID             TO DP072-ORIGIN-FCLTY-ID.    05600099
056100     MOVE SU001-FCLTY-ID             TO DP072-FCLTY-ID            05610099
056200     SET DP072-VALIDATE              TO TRUE.                     05620099
056300                                                                  05630099
056400     EXEC CICS                                                    05640099
056500         LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                   05650099
056600              COMMAREA (DP072-COMM-AREA)                          05660099
056700              RESP     (PV-CICS-RESPONSE)                         05670099
056800     END-EXEC                                                     05680099
056900                                                                  05690099
057000     EVALUATE TRUE                                                05700099
057100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05710099
057200             CONTINUE                                             05720099
057300         WHEN OTHER                                               05730099
057400               MOVE '1200-VALIDATE-PRINTER'                       05740099
057500                                    TO DP013-PARAGRAPH            05750099
057600               MOVE PV-CICS-RESPONSE                              05760099
057700                                    TO DP013-MESSAGE-TEXT(1)      05770099
057800               MOVE SQLCA           TO DP013-SQLCA                05780099
057900               SET DP013-LINK-RETURN                              05790099
058000                   DP013-CICS-ABEND                               05800099
058100                   DP013-NO-ROLLBACK TO TRUE                      05810099
058200               PERFORM DP014-0000-PROCESS-ABEND                   05820099
058300     END-EVALUATE.                                                05830099
058400                                                                  05840099
058500*                                                                 05850099
058600 1300-FIND-SYSTEM-ID.                                             05860099
058700     EXEC CICS                                                    05870099
058800         INQUIRE                                                  05880099
058900             TRANSACTION   (PC-LOGON-TRAN-ID)                     05890099
059000             REMOTESYSTEM  (PV-SYSID)                             05900099
059100             RESP          (PV-CICS-RESPONSE)                     05910099
059200     END-EXEC.                                                    05920099
059300                                                                  05930099
059400     EVALUATE TRUE                                                05940099
059500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05950099
059600             CONTINUE                                             05960099
059700         WHEN OTHER                                               05970099
059800             MOVE '1300-FIND-SYSTEM-ID'                           05980099
059900                 TO DP013-PARAGRAPH                               05990099
060000             MOVE 'UNABLE TO DETERMINE SYSTEM ID'                 06000099
060100                 TO DP013-MESSAGE-TEXT (1)                        06010099
060200             SET DP013-CICS-ABEND      TO  TRUE                   06020099
060300             SET DP013-NO-ROLLBACK     TO  TRUE                   06030099
060400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06040099
060500             MOVE PC-CICS-ABEND-MSG    TO  AMSGLNO                06050099
060600             PERFORM 8100-SEND-DATA-ONLY                          06060099
060700             PERFORM 8200-RETURN-TRANID                           06070099
060800     END-EVALUATE.                                                06080099
060900*                                                                 06090099
061000 1400-FIND-LOGON-INFO.                                            06100099
061100     MOVE LENGTH OF DP026-SIGN-ON-INFO                            06110099
061200                    TO  PV-SIGN-ON-INFO-LENGTH.                   06120099
061300     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   06130099
061400     MOVE +1        TO  PV-TS-ITEM.                               06140099
061500                                                                  06150099
061600     IF PV-SYSID = SPACES                                         06160099
061700         EXEC CICS                                                06170099
061800             READQ TS                                             06180099
061900                 QUEUE  (TS-INFO-QUEUE-NAME)                      06190099
062000                 ITEM   (PV-TS-ITEM)                              06200099
062100                 INTO   (DP026-SIGN-ON-INFO)                      06210099
062200                 RESP   (PV-CICS-RESPONSE)                        06220099
062300         END-EXEC                                                 06230099
062400     ELSE                                                         06240099
062500         EXEC CICS                                                06250099
062600             READQ TS                                             06260099
062700                 QUEUE   (TS-INFO-QUEUE-NAME)                     06270099
062800                 SYSID   (PV-SYSID)                               06280099
062900                 ITEM    (PV-TS-ITEM)                             06290099
063000                 INTO    (DP026-SIGN-ON-INFO)                     06300099
063100                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 06310099
063200                 RESP    (PV-CICS-RESPONSE)                       06320099
063300         END-EXEC                                                 06330099
063400     END-IF.                                                      06340099
063500                                                                  06350099
063600     EVALUATE TRUE                                                06360099
063700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06370099
063800             CONTINUE                                             06380099
063900         WHEN OTHER                                               06390099
064000             MOVE '1400-FIND-LOGON-INFO'                          06400099
064100                 TO DP013-PARAGRAPH                               06410099
064200             MOVE 'UNABLE TO READ LOGON TSQ'                      06420099
064300                 TO DP013-MESSAGE-TEXT (1)                        06430099
064400             SET DP013-CICS-ABEND     TO TRUE                     06440099
064500             SET DP013-NO-ROLLBACK    TO TRUE                     06450099
064600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06460099
064700             MOVE PC-CICS-ABEND-MSG    TO  AMSGLNO                06470099
064800             SET SU001-PROCESS-SCREEN TO TRUE                     06480099
064900             PERFORM 8100-SEND-DATA-ONLY                          06490099
065000             PERFORM 8200-RETURN-TRANID                           06500099
065100     END-EVALUATE.                                                06510099
065200*                                                                 06520099
065300                                                                  06530099
065400 2000-PROCESS-SELECTION.                                          06540099
065500                                                                  06550099
065600*LMM                                                              06560099
065700     IF  CA-PRINT-REPORTS                                         06570099
065800         MOVE PV-PRINTER-DESTINATION TO SU001-PRINTER-ID          06580099
065900         MOVE PC-Y                   TO CA-525-STATISTICS-RPT-IND 06590099
066000                                        CA-525-WORKSHEET-RPT-IND  06600099
066100                                        SU001-525-CARTONS-RPT-IND 06610099
066200                                        CA-525-FREE-ASTRAY-RPT-IND06620099
066300                                        CA-525-MISDIRECT-RPT-IND  06630099
066400                                        CA-525-DUPLICATE-RPT-IND  06640099
066500                                        SU001-525-SCAN-RPT-IND    06650099
066600                                        SU001-525-UNUSED-RPT-IND  06660099
066700         MOVE PC-SU-PO-RPT-RQST-PGM  TO PV-TRANSFER-PROGRAM       06670099
066800         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    06680099
066900     ELSE                                                         06690099
067000     IF  CA-PRINT-IND-REPORTS                                     06700099
067100         MOVE PV-PRINTER-DESTINATION TO SU001-PRINTER-ID          06710099
067200         MOVE PC-N                   TO CA-525-STATISTICS-RPT-IND 06720099
067300                                        CA-525-WORKSHEET-RPT-IND  06730099
067400                                        SU001-525-CARTONS-RPT-IND 06740099
067500                                        CA-525-FREE-ASTRAY-RPT-IND06750099
067600                                        CA-525-MISDIRECT-RPT-IND  06760099
067700                                        CA-525-DUPLICATE-RPT-IND  06770099
067800                                        SU001-525-SCAN-RPT-IND    06780099
067900                                        SU001-525-UNUSED-RPT-IND  06790099
068000         MOVE PC-SU-PO-RPT-RQST-PGM  TO PV-TRANSFER-PROGRAM       06800099
068100         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    06810099
068200                                                                  06820099
068300*LMM NO LONGER GOES TO SUKRF525- GOES TO SUKRF531 FIRST           06830099
068400*        MOVE PC-SU-IND-RPT-PGM      TO PV-TRANSFER-PROGRAM       06840099
068500*        MOVE PV-PRINTER-DESTINATION TO SU001-PRINTER-ID          06850099
068600*        PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    06860099
068700                                                                  06870099
068800     ELSE                                                         06880099
068900         MOVE PC-SU-TRAILER-PGM      TO PV-TRANSFER-PROGRAM       06890099
069000         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    06900099
069100     END-IF.                                                      06910099
069200                                                                  06920099
069300 2100-XCTL-TO-SELECTED-PROGRAM.                                   06930099
069400     SET SU001-INITIALIZE-SCREEN     TO TRUE.                     06940099
069500     MOVE PC-CURRENT-PROGRAM-NAME    TO SU001-LAST-PROGRAM.       06950099
069600                                                                  06960099
069800     MOVE LENGTH OF CA-COMMAREA    TO PV-COMMAREA-LENGTH.         06980099
069900     EXEC CICS                                                    06990099
070000         XCTL                                                     07000099
070100             PROGRAM   (PV-TRANSFER-PROGRAM)                      07010099
070200             COMMAREA  (CA-COMMAREA)                              07020099
070400             LENGTH    (PV-COMMAREA-LENGTH)                       07040099
070500             RESP      (PV-CICS-RESPONSE)                         07050099
070600     END-EXEC.                                                    07060099
070700                                                                  07070099
070800     EVALUATE TRUE                                                07080099
070900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07090099
071000              CONTINUE                                            07100099
071100         WHEN OTHER                                               07110099
071200              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                07120099
071300                                     TO DP013-PARAGRAPH           07130099
071400              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       07140099
071500                                     TO DP013-MESSAGE-TEXT (1)    07150099
071600              MOVE PV-TRANSFER-PROGRAM                            07160099
071700                                     TO DP013-MESSAGE-TEXT (2)    07170099
071800              SET DP013-CICS-ABEND   TO TRUE                      07180099
071900              SET DP013-NO-ROLLBACK  TO TRUE                      07190099
072000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07200099
072100              MOVE PC-TRANS-UNAVAILABLE-MSG                       07210099
072200                                     TO AMSGLNO                   07220099
072300              SET SU001-PROCESS-SCREEN TO TRUE                    07230099
072400              PERFORM 8100-SEND-DATA-ONLY                         07240099
072500              PERFORM 8200-RETURN-TRANID                          07250099
072600     END-EVALUATE.                                                07260099
072700*----------------------------------------------------------------*07270099
072800*    START JOB WHICH WILL CREATE REPORTS                         *07280099
072900*----------------------------------------------------------------*07290099
073000 2200-PRINT-REPORTS.                                              07300099
073100                                                                  07310099
073200*LMM                                                              07320099
073300     PERFORM 9000-SUBMIT-JOB.                                     07330099
073400     MOVE PC-SU-TRAILER-PGM      TO PV-TRANSFER-PROGRAM.          07340099
073500                                                                  07350099
073600*LMM SET SU001-RPT-REQUESTED     TO TRUE.                         07360099
073700                                                                  07370099
073800*LMM PERFORM 2100-XCTL-TO-SELECTED-PROGRAM.                       07380099
073900*                                                                 07390099
074000*                                                                 07400099
074100 8000-SEND-MAP.                                                   07410099
074200     EXEC CICS                                                    07420099
074300         SEND MAP       ('SU503A')                                07430099
074400              MAPSET    ('SUKM503')                               07440099
074500              ERASE                                               07450099
074600              RESP      (PV-CICS-RESPONSE)                        07460099
074700     END-EXEC.                                                    07470099
074800                                                                  07480099
074900     EVALUATE TRUE                                                07490099
075000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07500099
075100              CONTINUE                                            07510099
075200         WHEN OTHER                                               07520099
075300              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           07530099
075400              MOVE 'UNABLE TO SEND MAP'                           07540099
075500                                     TO DP013-MESSAGE-TEXT (1)    07550099
075600              SET DP013-CICS-ABEND   TO TRUE                      07560099
075700              SET DP013-NO-ROLLBACK  TO TRUE                      07570099
075800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07580099
075900     END-EVALUATE.                                                07590099
076000                                                                  07600099
076100 8100-SEND-DATA-ONLY.                                             07610099
076200     MOVE -1 TO ASELECTL.                                         07620099
076300                                                                  07630099
076400     EXEC CICS                                                    07640099
076500         SEND MAP       ('SU503A')                                07650099
076600              MAPSET    ('SUKM503')                               07660099
076700              CURSOR                                              07670099
076800              DATAONLY                                            07680099
076900              RESP      (PV-CICS-RESPONSE)                        07690099
077000     END-EXEC.                                                    07700099
077100                                                                  07710099
077200     EVALUATE TRUE                                                07720099
077300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07730099
077400              CONTINUE                                            07740099
077500         WHEN OTHER                                               07750099
077600              MOVE '8100-SEND-DATA-ONLY'                          07760099
077700                                     TO DP013-PARAGRAPH           07770099
077800              MOVE 'UNABLE TO SEND DATA'                          07780099
077900                                     TO DP013-MESSAGE-TEXT (1)    07790099
078000              SET DP013-CICS-ABEND   TO TRUE                      07800099
078100              SET DP013-NO-ROLLBACK  TO TRUE                      07810099
078200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07820099
078300     END-EVALUATE.                                                07830099
078400                                                                  07840099
078500 8200-RETURN-TRANID.                                              07850099
078600                                                                  07860099
078700     MOVE LENGTH OF CA-COMMAREA      TO PV-COMMAREA-LENGTH.       07870099
078800     EXEC CICS                                                    07880099
078900         RETURN TRANSID   (PC-SU-TRAILER-STOP)                    07890099
079000                COMMAREA  (CA-COMMAREA)                           07900099
079200                LENGTH    (PV-COMMAREA-LENGTH)                    07920099
079300                RESP      (PV-CICS-RESPONSE)                      07930099
079400     END-EXEC.                                                    07940099
079500                                                                  07950099
079600     EVALUATE TRUE                                                07960099
079700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07970099
079800              CONTINUE                                            07980099
079900         WHEN OTHER                                               07990099
080000              MOVE '8200-RETURN-TRANID'                           08000099
080100                                     TO DP013-PARAGRAPH           08010099
080200              MOVE 'UNABLE TO RETURN TO TRANID'                   08020099
080300                                     TO DP013-MESSAGE-TEXT (1)    08030099
080400              SET DP013-CICS-ABEND   TO TRUE                      08040099
080500              SET DP013-NO-ROLLBACK  TO TRUE                      08050099
080600              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              08060099
080700     END-EVALUATE.                                                08070099
080800                                                                  08080099
080900 9000-SUBMIT-JOB.                                                 08090099
081000                                                                  08100099
081100     EXEC CICS ASSIGN                                             08110099
081200               APPLID(PV-SYSTEM-ID)                               08120099
081300               USERID(SU001-USER-ID)                              08130099
081400     END-EXEC.                                                    08140099
081500                                                                  08150099
081600     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        08160099
081700                                                                  08170099
081800     IF PV-PROD-CICS                                              08180099
081900        MOVE '1'               TO JL-LINE-12-PROC-T               08190099
082000        MOVE ' '               TO JL-LINE-12-PROC-T2              08200099
082100        MOVE JL-JOB-LINE-PROD  TO JL-JCL-LINE-1                   08210099
082200        MOVE JL-JCL-LINE-1     TO TD-JCL-LINE                     08220099
082300        PERFORM 9100-WRITE-TD-LINE                                08230099
082400        MOVE JL-JCL-LINE-3     TO TD-JCL-LINE                     08240099
082500        PERFORM 9100-WRITE-TD-LINE                                08250099
082600*       MOVE PV-PRINTER-DESTINATION TO JL-LINE-13-PRINTER         08260099
082700        MOVE SU001-PRINTER-ID       TO JL-LINE-13-PRINTER         08270099
082800        MOVE JL-JCL-LINE-13 TO TD-JCL-LINE                        08280099
082900        PERFORM 9100-WRITE-TD-LINE                                08290099
083000        MOVE JL-JCL-LINE-4-PROD TO TD-JCL-LINE                    08300099
083100        PERFORM 9100-WRITE-TD-LINE                                08310099
083400     ELSE                                                         08340099
083500        IF PV-TEST-CICS                                           08350099
083600           MOVE '1'               TO JL-LINE-12-PROC-T            08360099
083700           MOVE 'T'               TO JL-LINE-12-PROC-T2           08370099
083800           MOVE SU001-USER-ID     TO  JL-TEST-JOB-NAME            08380099
083900           MOVE JL-JOB-LINE-TEST  TO  JL-JCL-LINE-1               08390099
084000           MOVE JL-JCL-LINE-1     TO TD-JCL-LINE                  08400099
084100           PERFORM 9100-WRITE-TD-LINE                             08410099
084200*          MOVE PV-PRINTER-DESTINATION TO JL-LINE-13-PRINTER      08420099
084300           MOVE SU001-PRINTER-ID       TO JL-LINE-13-PRINTER      08430099
084400           MOVE JL-JCL-LINE-13 TO TD-JCL-LINE                     08440099
084500           PERFORM 9100-WRITE-TD-LINE                             08450099
084600           MOVE JL-JCL-LINE-4-TEST TO TD-JCL-LINE                 08460099
084700           PERFORM 9100-WRITE-TD-LINE                             08470099
084800        ELSE                                                      08480099
084900           IF PV-QA-CICS                                          08490099
085000              MOVE '1'               TO JL-LINE-12-PROC-T         08500099
085100              MOVE 'Q'               TO JL-LINE-12-PROC-T2        08510099
085200*             MOVE JL-JOB-LINE-PROD  TO JL-JCL-LINE-1             08520099
085300*             MOVE JL-JCL-LINE-1     TO TD-JCL-LINE               08530099
085400              MOVE SU001-USER-ID     TO  JL-TEST-JOB-NAME         08540099
085500              MOVE JL-JOB-LINE-TEST  TO  JL-JCL-LINE-1            08550099
085600              MOVE JL-JCL-LINE-1     TO TD-JCL-LINE               08560099
085700              PERFORM 9100-WRITE-TD-LINE                          08570099
085800*             MOVE PV-PRINTER-DESTINATION TO JL-LINE-13-PRINTER   08580099
085900              MOVE SU001-PRINTER-ID       TO JL-LINE-13-PRINTER   08590099
086000              MOVE JL-JCL-LINE-13    TO TD-JCL-LINE               08600099
086100              PERFORM 9100-WRITE-TD-LINE                          08610099
086200              MOVE JL-JCL-LINE-4-QA  TO TD-JCL-LINE               08620099
086300              PERFORM 9100-WRITE-TD-LINE                          08630099
086400           ELSE                                                   08640099
086410              IF PV-LEARN-CICS                                    08641099
086420                 MOVE '1'               TO JL-LINE-12-PROC-T      08642099
086430                 MOVE 'L'               TO JL-LINE-12-PROC-T2     08643099
086440*                MOVE JL-JOB-LINE-PROD  TO JL-JCL-LINE-1          08644099
086450*                MOVE JL-JCL-LINE-1     TO TD-JCL-LINE            08645099
086460                 MOVE SU001-USER-ID     TO  JL-TEST-JOB-NAME      08646099
086470                 MOVE JL-JOB-LINE-TEST  TO  JL-JCL-LINE-1         08647099
086480                 MOVE JL-JCL-LINE-1     TO TD-JCL-LINE            08648099
086490                 PERFORM 9100-WRITE-TD-LINE                       08649099
086491*                MOVE PV-PRINTER-DESTINATION TO JL-LINE-13-PRINTER08649199
086492                 MOVE SU001-PRINTER-ID       TO JL-LINE-13-PRINTER08649299
086493                 MOVE JL-JCL-LINE-13    TO TD-JCL-LINE            08649399
086494                 PERFORM 9100-WRITE-TD-LINE                       08649499
086495                 MOVE JL-JCL-LINE-4-QA  TO TD-JCL-LINE            08649599
086496                 PERFORM 9100-WRITE-TD-LINE                       08649699
086497              END-IF                                              08649799
086498           END-IF                                                 08649899
086500        END-IF                                                    08650099
086600     END-IF.                                                      08660099
086700                                                                  08670099
086800     MOVE JL-JCL-LINE-12 TO TD-JCL-LINE.                          08680099
086900     PERFORM 9100-WRITE-TD-LINE.                                  08690099
087000                                                                  08700099
087100     MOVE JL-JCL-LINE-14 TO TD-JCL-LINE.                          08710099
087200     PERFORM 9100-WRITE-TD-LINE.                                  08720099
087300                                                                  08730099
087400     MOVE SU001-MANIFEST         TO JL-LINE-15-MANIFEST.          08740099
087500*LMM                                                              08750099
087600     MOVE SU001-USER-ID          TO JL-LINE-15-USER-ID.           08760099
087700     MOVE SU001-RQST-TMST        TO JL-LINE-15-TIMESTMP.          08770099
087800     MOVE JL-JCL-LINE-15         TO TD-JCL-LINE.                  08780099
087900     PERFORM 9100-WRITE-TD-LINE.                                  08790099
088000                                                                  08800099
088100     MOVE JL-JCL-LINE-16 TO TD-JCL-LINE.                          08810099
088200     PERFORM 9100-WRITE-TD-LINE.                                  08820099
088300                                                                  08830099
088400     MOVE SU001-PRINTER-ID TO JL-LINE-17-PRINTER.                 08840099
088500     MOVE DP072-PRTR-PRTR-CNTL-IND                                08850099
088600                                 TO JL-LINE-17-PRTR-IND.          08860099
088700     MOVE DP072-PRTR-TRACK-NBR   TO JL-LINE-17-TRACK-NBR.         08870099
088800     MOVE SU001-USER-ID          TO JL-LINE-17-USER-ID.           08880099
088900     MOVE PC-Y                   TO JL-LINE-17-STAT-RPT           08890099
089000                                    JL-LINE-17-CRTN-RPT           08900099
089100                                    JL-LINE-17-FREE-RPT           08910099
089200                                    JL-LINE-17-MSDR-RPT           08920099
089300                                    JL-LINE-17-DUPL-RPT           08930099
089400                                    JL-LINE-17-WRKS-RPT           08940099
089500                                    JL-LINE-17-SCAN-RPT           08950099
089600                                    JL-LINE-17-ULBL-RPT.          08960099
089700*LMM                                                              08970099
089800     MOVE SU001-ALL-PO-IND       TO JL-LINE-17-ALL-PO-IND.        08980099
089900     MOVE JL-JCL-LINE-17 TO TD-JCL-LINE.                          08990099
090000     PERFORM 9100-WRITE-TD-LINE.                                  09000099
090100                                                                  09010099
090200*    MOVE JL-JCL-LINE-AUTO-SCHD TO TD-JCL-LINE.                   09020099
090300*    PERFORM 9100-WRITE-TD-LINE.                                  09030099
090400                                                                  09040099
090500     MOVE JL-JCL-LINE-EOF TO TD-JCL-LINE.                         09050099
090600     PERFORM 9100-WRITE-TD-LINE.                                  09060099
090700                                                                  09070099
090800     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        09080099
090900                                                                  09090099
091000******************************************************************09100099
091100*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *09110099
091200*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *09120099
091300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *09130099
091400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *09140099
091500*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *09150099
091600*  CICS.                                                         *09160099
091700******************************************************************09170099
091800                                                                  09180099
091900 9100-WRITE-TD-LINE.                                              09190099
092000     EXEC CICS                                                    09200099
092100         WRITEQ TD                                                09210099
092200             QUEUE(TD-QUEUE-NAME)                                 09220099
092300             FROM(TD-JCL-LINE)                                    09230099
092400             LENGTH(TD-JCL-LINE-LENGTH)                           09240099
092500             RESP(PV-CICS-RESPONSE)                               09250099
092600     END-EXEC.                                                    09260099
092700                                                                  09270099
092800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09280099
092900         SET PS-ABEND-IN-PROGRESS TO TRUE                         09290099
093000         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  09300099
093100                                                DELIMITED BY SIZE 09310099
093200                TD-QUEUE-NAME                   DELIMITED BY SIZE 09320099
093300                ' (INTERNAL READER)'            DELIMITED BY SIZE 09330099
093400             INTO SE-ATTEMPTED-ACTION                             09340099
093500         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                09350099
093600         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  09360099
093700         PERFORM 9600-DEQUEUE-INTERNAL-READER                     09370099
093800         PERFORM 9900-LEAVE-SYSTEM                                09380099
093900     END-IF.                                                      09390099
094000     EJECT                                                        09400099
094100******************************************************************09410099
094200*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *09420099
094300*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *09430099
094400*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *09440099
094500*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *09450099
094600*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *09460099
094700*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *09470099
094800*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *09480099
094900*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *09490099
095000******************************************************************09500099
095100                                                                  09510099
095200 9500-ENQUEUE-INTERNAL-READER.                                    09520099
095300     EXEC CICS                                                    09530099
095400         ENQ                                                      09540099
095500             RESOURCE(TD-QUEUE-NAME)                              09550099
095600             LENGTH(TD-QUEUE-NAME-LENGTH)                         09560099
095700             RESP(PV-CICS-RESPONSE)                               09570099
095800     END-EXEC.                                                    09580099
095900                                                                  09590099
096000     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09600099
096100         SET PS-ABEND-IN-PROGRESS TO TRUE                         09610099
096200         STRING 'ENQUEUE '            DELIMITED BY SIZE           09620099
096300                TD-QUEUE-NAME         DELIMITED BY SIZE           09630099
096400                ' (INTERNAL READER)'  DELIMITED BY SIZE           09640099
096500             INTO SE-ATTEMPTED-ACTION                             09650099
096600         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                09660099
096700         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  09670099
096800         PERFORM 9900-LEAVE-SYSTEM                                09680099
096900     END-IF.                                                      09690099
097000                                                                  09700099
097100     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     09710099
097200     EJECT                                                        09720099
097300******************************************************************09730099
097400*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *09740099
097500*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *09750099
097600*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *09760099
097700*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *09770099
097800*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *09780099
097900*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *09790099
098000*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *09800099
098100*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *09810099
098200*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *09820099
098300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *09830099
098400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *09840099
098500*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *09850099
098600*  CICS.                                                         *09860099
098700******************************************************************09870099
098800                                                                  09880099
098900 9600-DEQUEUE-INTERNAL-READER.                                    09890099
099000     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     09900099
099100                                                                  09910099
099200     EXEC CICS                                                    09920099
099300         DEQ                                                      09930099
099400             RESOURCE(TD-QUEUE-NAME)                              09940099
099500             LENGTH(TD-QUEUE-NAME-LENGTH)                         09950099
099600             RESP(PV-CICS-RESPONSE)                               09960099
099700     END-EXEC.                                                    09970099
099800                                                                  09980099
099900     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09990099
100000         IF PS-NO-ABEND-IN-PROGRESS                               10000099
100100             SET PS-ABEND-IN-PROGRESS TO TRUE                     10010099
100200             STRING 'DEQUEUE '            DELIMITED BY SIZE       10020099
100300                    TD-QUEUE-NAME         DELIMITED BY SIZE       10030099
100400                    ' (INTERNAL READER)'  DELIMITED BY SIZE       10040099
100500                 INTO SE-ATTEMPTED-ACTION                         10050099
100600             MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE            10060099
100700             MOVE SE-SYSTEM-ERROR-MESSAGE TO                      10070099
100800                       PV-LEAVE-SYSTEM-MESSAGE                    10080099
100900             PERFORM 9900-LEAVE-SYSTEM                            10090099
101000         END-IF                                                   10100099
101100     END-IF.                                                      10110099
101200     EJECT                                                        10120099
101300******************************************************************10130099
101400*  EXIT THE SHIPT UNIT REPORT REQUEST SYSTEM, DISPLAYING A       *10140099
101500*  REASON FOR THE PROGRAM ABEND.                                 *10150099
101600******************************************************************10160099
101700                                                                  10170099
101800 9900-LEAVE-SYSTEM.                                               10180099
101900     EXEC CICS                                                    10190099
102000         SEND                                                     10200099
102100             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        10210099
102200             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       10220099
102300             ERASE                                                10230099
102400     END-EXEC.                                                    10240099
102500                                                                  10250099
102600     EXEC CICS                                                    10260099
102700         RETURN                                                   10270099
102800     END-EXEC.                                                    10280099
102900     EJECT                                                        10290099
103000                                                                  10300099
103100 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  10310099
103200     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            10320099
103300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           10330099
103400     INITIALIZE DP013-SRC-TASK-NUMBER                             10340099
103500                DP013-STACK.                                      10350099
103600     SET DP013-LINK-RETURN           TO TRUE.                     10360099
103700                                                                  10370099
103800     EXEC CICS                                                    10380099
103900         LINK                                                     10390099
104000             PROGRAM   (DP013-NAME)                               10400099
104100             COMMAREA  (DP013-PARAMETERS)                         10410099
104200             LENGTH    (DP013-LENGTH)                             10420099
104300     END-EXEC.                                                    10430099
104400*----------------------------------------------------------------*10440099
104500*    ABEND PROCESSOR MODULE                                      *10450099
104600*----------------------------------------------------------------*10460099
104700                                                                  10470099
104800     COPY DPPD014.                                                10480099
104900                                                                  10490099
