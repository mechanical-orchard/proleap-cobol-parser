000200 IDENTIFICATION DIVISION.                                         00020000
000300                                                                  00030000
000400 PROGRAM-ID.    TRKCS155.                                         00040002
000500 AUTHOR.        MARGARET MORRISON.                                00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  12-30-97.                                         00070002
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000***************************************************************** 00100000
001100*    Y155 - PORT OF ENTRY LIST PROGRAM.                         * 00110002
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF POE CODES.  THE           * 00130002
001400*    ASSOCIATED TABLE VALUES ARE DISPLAYED. THE                 * 00140000
001500*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * 00150000
001600*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.              * 00160000
001700***************************************************************** 00170000
263697*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100 DATA DIVISION.                                                   00210000
002200                                                                  00220000
002300 WORKING-STORAGE SECTION.                                         00230000
002400                                                                  00240000
002500 01  DK-DB2-KEYS.                                                 00250000
002800     15  DK-ENT-ID                      PIC S9(09) COMP.          00280000
002900     15  DK-POE-CODE                    PIC  X(03)  VALUE SPACE.  00290000
003000     15  DK-STAT-CDE                    PIC  X(01)  VALUE SPACE.  00300000
003100                                                                  00310000
003200 01  PC-PROGRAM-CONSTANTS.                                        00320000
003300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00330000
003400                                                    'TR155A  '.   00340002
003500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00350000
003600                                                    'TRKM155 '.   00360002
003700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00370000
003800                                                    'TRKCS155'.   00380002
003900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00390000
004000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00400000
004100     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00410000
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00420000
004300                                                    COMP SYNC.    00430000
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00440000
004500                                                    COMP SYNC.    00450000
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00460000
004700                                                    +1000000      00470000
004800                                                    COMP-3.       00480000
004900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00490000
005000                                                    COMP SYNC.    00500000
005100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00510000
005200     05  PC-ASTRK                       PIC  X(01)  VALUE '*'.    00520000
005300     05  PC-A                           PIC  X(01)  VALUE 'A'.    00530000
005400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00540000
005500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00550000
005600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00560000
005700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00570000
005800     05  PC-PRIMARY                     PIC XX    VALUE '01'.     00580000
005900     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    00590000
005901     05  PC-INTER-APPL-CODES.                                             
005902         10  PC-INTER-APPL-LIST-ACT                                       
005903                                  PIC  X(01)  VALUE  '2'.                 
006000                                                                  00600000
006100     05  PC-TSYMSG-NUMBERS.                                       00610000
006200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00620000
006210*             -  INVALID VALUE                                            
006300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00630000
006310*             -  MUST BE NUMERIC                                          
006600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00660000
006610*             -  NO END OF RANGE HAS BEEN SPECIFIED                       
006700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00670000
006710*             -  END OF RANGE PRECEDES START OF RANGE                     
006800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00680000
006810*             -  NO START OF RANGE HAS BEEN SPECIFIED                     
006900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00690000
006910*             -  ONLY ONE START OF RANGE INDICATOR                        
006920*                MAY BE SPECIFIED                                         
007000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00700000
007010*             -  ONLY ONE END OF RANGE INDICATOR                          
007020*                MAY BE SPECIFIED                                         
007100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00710000
007110*             -  A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION           
007200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00720000
007210*             -  TOP OF LIST                                              
007300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00730000
007310*             -  BOTTOM OF LIST                                           
007400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00740000
007410*             -  VALUE MUST BE GREATER THAN ZERO                          
007420*                AND LESS THAN 1,000,000                                  
007500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00750000
007510*             -  MORE ITEMS TO DISPLAY                                    
007600         10  PC-TSYMSG-01645            PIC  9(05)  VALUE 01645.  00760000
007610*             -  SELECT AND F13 TO ACTIVATE / F13 TO ADD                  
007700         10  PC-TSYMSG-01646            PIC  9(05)  VALUE 01646.  00770000
007710*             -  SELECTED CODE IS ALREADY ACTIVE                          
007800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00780000
007810*             -  INVALID COMMAND WAS ENTERED                              
007900                                                                  00790000
008000 01  PS-PROGRAM-SWITCHES.                                         00800000
008100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00810000
008200         88  PS-NO-ERROR                            VALUE 'Y'.    00820000
008300         88  PS-ERROR                               VALUE 'N'.    00830000
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00840000
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00850000
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00860000
008700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00870000
008800         88  PS-DONE                                VALUE 'Y'.    00880000
008900         88  PS-NOT-DONE                            VALUE 'N'.    00890000
009000                                                                  00900000
009100 01  PV-PROGRAM-VARIABLES.                                        00910000
009200     05  PV-SUB                         PIC S9(04)  VALUE +0      00920000
009300                                                    COMP SYNC.    00930000
009400     05  PV-ASTRK-CNT                   PIC S9(04)  VALUE +0      00940000
009500                                                    COMP SYNC.    00950000
009600     05  PV-NUMBER-OF-SELECTED-ITEMS    PIC S9(09)                00960000
009700                                                    COMP-3.       00970000
009800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00980000
009900                                                    COMP SYNC.    00990000
010000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01000000
010100                                                    COMP-3.       01010000
010200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01020000
010300                                                    COMP-3.       01030000
010400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01040000
010500                                                    COMP-3.       01050000
010600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01060000
010700                                                    COMP-3.       01070000
010800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01080000
010900                                                    COMP-3.       01090000
011000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01100000
011100                                                    COMP-3.       01110000
011200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01120000
011300                                                    COMP-3.       01130000
011400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01220000
012300                                                    COMP SYNC.    01230000
012400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01240000
012500                                                    COMP SYNC.    01250000
012600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01260000
012700                                                    COMP SYNC.    01270000
012800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01280000
012900                                                    COMP SYNC.    01290000
013000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01340000
013500                                                    COMP SYNC.    01350000
013600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01400000
014100                                                    COMP SYNC.    01410000
014200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01420000
014300                                                    COMP SYNC.    01430000
015800******************************************************************01580000
015900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01590000
016000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01600000
016100**  APPLICATION-SPECIFIC COMMAREA.                              **01610000
016200******************************************************************01620000
016300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01630000
016400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01640000
016500     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01650000
016600                                        INDEXED BY LQW-IDX.       01660000
016700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01670000
016800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01680000
016900         10  LQW-SELECTED-SW            PIC  X(01).               01690000
017000             88  LQW-SELECT                         VALUE 'S'.    01700000
017100             88  LQW-DESELECT                       VALUE ' '.    01710000
017200         10  LQW-ACTION                 PIC  X(03).               01720000
017300         10  LQW-POE-CODE               PIC  X(03).               01730003
017411         10  LQW-POE-CODE-DESC          PIC  X(30).               01740010
017412         10  LQW-POE-CITY-NAME          PIC  X(30).               01741010
017420         10  LQW-POE-STATE-CODE         PIC  X(02).               01742003
017430         10  LQW-DCONSLR-SCAC           PIC  X(04).               01743003
017450         10  LQW-DCONSLR-ENT-ID         PIC  S9(9).               01745003
017480         10  LQW-POE-STD-EDI-CDE        PIC  X(04).               01748003
017481         10  LQW-ALLOWED-ON-PO          PIC  X(01).                       
017482         10  LQW-TRIP-TYP-CDE           PIC  X(01).                       
017483         10  LQW-IATA-CDE               PIC  X(03).                       
017490                                                                  01749000
017500     EJECT                                                        01750000
017600***************************************************************** 01760000
017700*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01770000
017800***************************************************************** 01780000
018000     COPY TRWS023.                                                01800002
018100                                                                  01810000
018200     EJECT                                                        01820000
018300***************************************************************** 01830000
018400*    MAP LAYOUT                                                 * 01840000
018500***************************************************************** 01850000
018700     COPY TRKM155.                                                01870002
018800*                                                                 01880000
018900 01  MR-OCCURS-LAYOUT                   REDEFINES  TR155AO.       01890003
019000     05  FILLER                         PIC X(42).                01900000
019100     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01910000
019200         10  MR-SELECTL                 PIC S9(04) COMP.          01920000
019300         10  MR-SELECTA                 PIC  X(01).               01930000
019400         10  MR-SELECTC                 PIC  X(01).               01940000
019500         10  MR-SELECTH                 PIC  X(01).               01950000
019600         10  MR-SELECTI                 PIC  X(01).               01960000
019700                                                                  01970000
019800         10  MR-ACTIONL                 PIC S9(04) COMP.          01980000
019900         10  MR-ACTIONA                 PIC  X(01).               01990000
020000         10  MR-ACTIONC                 PIC  X(01).               02000000
020100         10  MR-ACTIONH                 PIC  X(01).               02010000
020200         10  MR-ACTION                  PIC  X(03).               02020000
020300                                                                  02030000
020400         10  MR-POE-CODEL               PIC S9(04) COMP.          02040004
020500         10  MR-POE-CODEA               PIC  X(01).               02050004
020600         10  MR-POE-CODEC               PIC  X(01).               02060004
020700         10  MR-POE-CODEH               PIC  X(01).               02070004
020800         10  MR-POE-CODE                PIC  X(03).               02080004
020900                                                                  02090000
020910         10  MR-DCONSL-SCACL            PIC S9(04) COMP.          02220004
020920         10  MR-DCONSL-SCACA            PIC  X(01).               02230004
020930         10  MR-DCONSL-SCACC            PIC  X(01).               02240004
020940         10  MR-DCONSL-SCACH            PIC  X(01).               02250004
020950         10  MR-DCONSL-SCAC             PIC  X(04).               02260004
020960                                                                  02270000
020970         10  MR-EDI-CODEL               PIC S9(04) COMP.          02400000
020980         10  MR-EDI-CODEA               PIC  X(01).               02410000
020990         10  MR-EDI-CODEC               PIC  X(01).               02420000
020991         10  MR-EDI-CODEH               PIC  X(01).               02430000
020992         10  MR-EDI-CODE                PIC  X(04).               02440000
020993                                                                  02450000
021000         10  MR-ALLOWED-ON-POL          PIC S9(04) COMP.          02040004
021100         10  MR-ALLOWED-ON-POA          PIC  X(01).               02050004
021200         10  MR-ALLOWED-ON-POC          PIC  X(01).               02060004
021300         10  MR-ALLOWED-ON-POH          PIC  X(01).               02070004
021400         10  MR-ALLOWED-ON-PO           PIC  X(01).               02080004
021500                                                                  02090000
021600         10  MR-CITY-NAMEL              PIC S9(04) COMP.          02160000
021700         10  MR-CITY-NAMEA              PIC  X(01).               02170000
021800         10  MR-CITY-NAMEC              PIC  X(01).               02180000
021900         10  MR-CITY-NAMEH              PIC  X(01).               02190000
022000         10  MR-CITY-NAME               PIC  X(15).               02200004
022100                                                                  02210000
022110         10  MR-STATE-CODEL             PIC S9(04) COMP.          02211007
022120         10  MR-STATE-CODEA             PIC  X(01).               02212007
022130         10  MR-STATE-CODEC             PIC  X(01).               02213007
022140         10  MR-STATE-CODEH             PIC  X(01).               02214007
022150         10  MR-STATE-CODE              PIC  X(02).               02215007
022160                                                                  02216004
022161         10  MR-TRIP-TYPEL              PIC S9(04) COMP.          02211007
022162         10  MR-TRIP-TYPEA              PIC  X(01).               02212007
022163         10  MR-TRIP-TYPEC              PIC  X(01).               02213007
022164         10  MR-TRIP-TYPEH              PIC  X(01).               02214007
022165         10  MR-TRIP-TYPE               PIC  X(01).               02215007
022166                                                                  02216004
022170         10  MR-POE-NAMEL               PIC S9(04) COMP.          02217004
022180         10  MR-POE-NAMEA               PIC  X(01).               02218004
022190         10  MR-POE-NAMEC               PIC  X(01).               02219004
022191         10  MR-POE-NAMEH               PIC  X(01).               02219104
022192         10  MR-POE-NAME                PIC  X(20).               02219204
022193                                                                  02219304
024510         10  MR-IATA-CODEL              PIC S9(04) COMP.          02400000
024520         10  MR-IATA-CODEA              PIC  X(01).               02410000
024530         10  MR-IATA-CODEC              PIC  X(01).               02420000
024540         10  MR-IATA-CODE-H             PIC  X(01).               02430000
024550         10  MR-IATA-CODE               PIC  X(03).               02440000
024560                                                                  02450000
024600     EJECT                                                        02460000
024700***************************************************************** 02470000
024800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02480000
024900***************************************************************** 02490000
025100     COPY DPWS015.                                                02510000
025200                                                                  02520000
025300***************************************************************** 02530000
025400*    FUNCTION KEYS COPYBOOK.                                    * 02540000
025500***************************************************************** 02550000
025700     COPY DPWS016.                                                02570000
025800                                                                  02580000
025900***************************************************************** 02590000
026000*    NUMERIC EDIT LAYOUT.                                       * 02600000
026100***************************************************************** 02610000
026300     COPY DPWS010I.                                               02630000
026400 EJECT                                                            02640000
026500***************************************************************** 02650000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02660000
026700***************************************************************** 02670000
026900     COPY DPWS030.                                                02690000
CICS       COPY DPWS930.                                                02690000
027000 EJECT                                                            02700000
027100***************************************************************** 02710000
027200*    STANDARD COMMAREA.                                         * 02720000
027300***************************************************************** 02730000
027400                                                                  02740000
027500     COPY DPWS020.                                                02750000
027600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02760000
027700                                                                  02770000
027800***************************************************************** 02780000
027900* INTER-APPLICATION COMMAREA.                                   * 02790000
028000*   TRWS022 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02800002
028100*             SPEC SCREEN.                                      * 02810000
028200***************************************************************** 02820000
028300                                                                  02830000
028400         10  INTER-APPL-COMM-AREA       PIC X(200).               02840000
028500     COPY TRWS022.                                                02850002
028600***************************************************************** 02860000
028700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02870000
028800***************************************************************** 02880000
028900         10  ASC-SPECIFIC-COMMAREA.                               02890000
029000             15  ASC-LIST-KEYS.                                   02900000
029100                 20  ASC-KEY-POE-CODE                PIC  X(03).  02910003
029200                 20  ASC-KEY-POE-STAT                PIC  X(01).  02920003
029300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02930000
029400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02940000
029500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02950000
029600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02960000
029700                                                                  02970000
029800                 20  ASC-ITEM-ARRAY.                              02980000
029900                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02990000
030000                         30  ASC-LIST-ITEM-NUMBER                 03000000
030100                                                     PIC S9(09)   03010000
030200                                                     COMP-3.      03020000
030300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03030000
030400                             88  ASC-VALID-SELECT    VALUE ' '    03040000
030500                                                           'S'    03050000
030600                                                           'B'    03060000
030700                                                           'E'.   03070000
030800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03080000
030900                             88  ASC-TEMP-SELECT     VALUE 'S'.   03090000
031000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03100000
031100                             88  ASC-TEMP-END        VALUE 'E'.   03110000
031200                         30  ASC-SELECTED-SW         PIC  X(01).  03120000
031300                             88  ASC-NO-SELECT       VALUE ' '.   03130000
031400                             88  ASC-SELECT          VALUE 'S'.   03140000
031500                             88  ASC-BEGIN           VALUE 'B'.   03150000
031600                             88  ASC-END             VALUE 'E'.   03160000
031700                         30  ASC-ACTION              PIC  X(03).  03170000
031800                         30  ASC-POE-CODE            PIC  X(03).  03180003
032101                         30  ASC-POE-CODE-DESC       PIC  X(30).  03200003
032102                         30  ASC-POE-CITY-NAME       PIC  X(30).  03210008
032110                         30  ASC-POE-STATE-CODE      PIC  X(02).  03211003
032200                         30  ASC-DCONSLR-SCAC        PIC  X(04).  03220003
032400                         30  ASC-DCONSLR-ENT-ID      PIC  S9(9).  03240003
032700                         30  ASC-POE-STD-EDI-CDE     PIC  X(04).  03270003
032710                         30  ASC-ALLOWED-ON-PO       PIC  X(01).          
032720                         30  ASC-TRIP-TYP-CDE        PIC  X(01).          
032730                         30  ASC-IATA-CDE            PIC  X(03).          
032800                                                                  03280000
032900             15  ASC-BLK-SUB                         PIC S9(04)   03290000
033000                                                          COMP    03300000
033100                                                          SYNC.   03310000
033200             15  ASC-ITEM-SUB                        PIC S9(04)   03320000
033300                                                          COMP    03330000
033400                                                          SYNC.   03340000
033500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03350000
033600                                                          COMP-3. 03360000
033700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03370000
033800                                                          COMP-3. 03380000
033900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03390000
034000                                                          COMP-3. 03400000
034100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03410000
034200                                                          COMP-3. 03420000
034300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03430000
034400                                                          COMP-3. 03440000
034500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03450000
034600                                                          COMP    03460000
034700                                                          SYNC.   03470000
034800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03480000
034900                                                          COMP-3. 03490000
035000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03500000
035100                                                          COMP-3. 03510000
035200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03520000
035300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03530000
035400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03540000
035500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03550000
035600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03560000
035700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03570000
035800             15  ASC-LIST-QUEUE-NAME.                             03580000
035900                 20  ASC-LIST-TERM-ID                PIC  X(04).  03590000
036000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03600000
036100                                                          COMP-3. 03610000
036200                 20  ASC-LIST-SEQ                    PIC  9(01).  03620000
036300             15  ASC-SEL-QUEUE-NAME.                              03630000
036400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03640000
036500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03650000
036600                                                          COMP-3. 03660000
036700                 20  ASC-SEL-SEQ                     PIC  9(01).  03670000
036800                                                                  03680000
036900             15  ASC-CURSOR-SW                       PIC  X(01).  03690000
037000                 88  ASC-USE-LIKE-CURSOR             VALUE 'L'.   03700000
037100                 88  ASC-USE-ALL-CURSOR              VALUE 'A'.   03710000
037200             15  ASC-START-ITEM-REQUEST.                          03720000
037300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03730000
037400     EJECT                                                        03740000
037500***************************************************************** 03750000
037600*    ABEND PROCESSING COPYBOOK.                                 * 03760000
037700***************************************************************** 03770000
037900     COPY DPWS013.                                                03790000
038100 EJECT                                                            03810000
038200***************************************************************** 03820000
038300*    DB2 AREA FOR TEXTENT                                       * 03830000
038400***************************************************************** 03840000
038500     EXEC SQL                                                     03850000
038600          INCLUDE TEXTENT                                         03860000
038700     END-EXEC.                                                    03870000
040000***************************************************************** 04000000
040100*    DB2 AREA FOR TIMPOE                                        * 04010000
040200***************************************************************** 04020000
040300     EXEC SQL                                                     04030000
040400          INCLUDE TIMPOE                                          04040000
040500     END-EXEC.                                                    04050000
040600***************************************************************** 04060000
040700*    DB2 AREA FOR TENTNME                                       * 04070000
040800***************************************************************** 04080000
040900     EXEC SQL                                                     04090000
041000          INCLUDE TENTNME                                         04100000
041100     END-EXEC.                                                    04110000
041200***************************************************************** 04120000
041300*    DB2 AREA FOR COMMUNICATIONS                                * 04130000
041400***************************************************************** 04140000
041500     EXEC SQL                                                     04150000
041600          INCLUDE SQLCA                                           04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900***************************************************************** 04190000
042000*    TIMPOE CURSOR FOR ALL PORT OF ENTRY CODES                  * 04200004
042100***************************************************************** 04210000
042200                                                                  04220000
042300     EXEC SQL                                                     04230000
042400          DECLARE POE-ALL-CSR CURSOR                              04240004
042500          FOR SELECT                                              04250000
042600                A.POE_CDE                                         04260004
042610              , A.DCONSLR_ENT_ID                                  04261004
042700              , A.POE_STD_EDI_CDE                                 04270004
042710              , A.POE_NM                                          04271006
042800              , A.POE_CTY_NM                                      04280004
042900              , A.POE_ST_CDE                                      04290004
043000              , A.PO_ASGMT_ALWD_IND                                       
043100              , A.TRIP_TYP_CDE                                            
043200              , A.STD_IATA_CDE                                            
043400          FROM  TIMPOE A                                          04340004
043600          WHERE A.STAT_CDE = :DK-STAT-CDE                         04360000
043800          ORDER BY                                                04380000
043900                A.POE_CDE                                         04390004
043910              , A.DCONSLR_ENT_ID                                          
043920              , A.POE_STD_EDI_CDE                                         
044000     END-EXEC.                                                    04400000
044100                                                                  04410000
044200***************************************************************** 04420000
044300*    TIMPOE CURSOR FOR ALL POE CODES BEGINNING WITH ENTERED     * 04430004
044400*    CHARACTERS                                                 * 04440000
044500***************************************************************** 04450000
044600                                                                  04460000
044700     EXEC SQL                                                     04470000
044800          DECLARE POE-LIKE-CSR CURSOR                             04480004
044900          FOR SELECT                                              04490000
044910                A.POE_CDE                                         04491004
044920              , A.DCONSLR_ENT_ID                                  04492004
044930              , A.POE_STD_EDI_CDE                                 04493004
044940              , A.POE_NM                                          04494006
044950              , A.POE_CTY_NM                                      04495004
044960              , A.POE_ST_CDE                                      04496004
044970              , A.PO_ASGMT_ALWD_IND                                       
044980              , A.TRIP_TYP_CDE                                            
044990              , A.STD_IATA_CDE                                            
045800          FROM  TIMPOE A                                          04580004
046000          WHERE A.POE_CDE   LIKE :DK-POE-CODE                     04600004
046200            AND A.STAT_CDE     = :DK-STAT-CDE                     04620004
046300          ORDER BY                                                04630000
046400                POE_CDE                                           04640004
046410              , A.DCONSLR_ENT_ID                                          
046420              , A.POE_STD_EDI_CDE                                         
046500     END-EXEC.                                                    04650000
046600                                                                  04660000
046700                                                                  04670000
046800 EJECT                                                            04680000
046900 LINKAGE SECTION.                                                 04690000
047000                                                                  04700000
047100 01  DFHCOMMAREA.                                                 04710000
047200     05  FILLER                         OCCURS  1 TO 4072 TIMES   04720000
047300                                        DEPENDING ON EIBCALEN.    04730000
047400         10  FILLER                     PIC X.                    04740000
047500                                                                  04750000
047600 EJECT                                                            04760000
047700 PROCEDURE DIVISION.                                              04770000
047800******************************************************************04780000
047900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04790000
048000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04800000
048100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04810000
048200******************************************************************04820000
048300 0000-MAIN-MODULE.                                                04830000
048400     INITIALIZE DP030-CICS-API-FIELDS.                            04840000
048500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04850000
048600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04860000
048700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04870000
048800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04880000
048900     MOVE LENGTH OF TR155AI        TO DP030-MAP-LENGTH (1).       04890003
049000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04900000
049100     PERFORM 0001-CALL-CICS-ARCH-API.                             04910000
049200*                                                                 04920000
049300     PERFORM 1000-CONTROL-PROCESSING.                             04930000
049400*                                                                 04940000
049500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04950000
049600     PERFORM 0001-CALL-CICS-ARCH-API.                             04960000
049700                                                                  04970000
049800******************************************************************04980000
049900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04990000
050000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05000000
050100******************************************************************05010000
050200 0001-CALL-CICS-ARCH-API.                                         05020000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
050400                                    DFHCOMMAREA                           
050500                                    DP030-CICS-API-FIELDS                 
050600                                    DP020-STANDARD-COMMAREA               
050700                                    TR155AI.                              
050800*                                                                 05080000
050900     IF  DP030-RC-CALL-SUCCESSFUL                                 05090000
051000         CONTINUE                                                 05100000
051100     ELSE                                                         05110000
051200         SET DP013-NO-ROLLBACK                                    05120000
051300             DP013-XCTL-DISPLAY-RESTART                           05130000
051400             DP013-CICS-ABEND      TO TRUE                        05140000
051500         MOVE '0001-CALL-CICS-ARCH-API'                           05150000
051600                                   TO DP013-PARAGRAPH             05160000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05170000
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05180000
051900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05190000
052000         PERFORM DP013-0000-PROCESS-ABEND                         05200000
052100     END-IF.                                                      05210000
052110                                                                          
052200******************************************************************05220000
052300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05230000
052400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05240000
052500*                                                                *05250000
052600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05260000
052700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05270000
052800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05280000
052900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05290000
053000******************************************************************05300000
053200 1000-CONTROL-PROCESSING.                                         05320000
053300                                                                  05330000
053400     EVALUATE TRUE                                                05340000
053500         WHEN DP020-NEXT-ACT-INITIAL                              05350000
053501             IF ASC-NUMBER-OF-SELECTED-ITEMS NUMERIC                      
053502                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                    
053503                  PV-NUMBER-OF-SELECTED-ITEMS                             
053504             ELSE                                                         
053505                 MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS                    
053510             END-IF                                                       
053600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05360000
053700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05370000
053800                                      ASC-SEL-TERM-ID             05380000
053900             MOVE DP020-SRC-TASK-NUMBER                           05390000
054000                                   TO ASC-LIST-TASK-NUMBER        05400000
054100                                      ASC-SEL-TASK-NUMBER         05410000
054200             MOVE PC-LIST-QUEUE-SEQ                               05420000
054300                                   TO ASC-LIST-SEQ                05430000
054400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05440000
054500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05450000
054600***-----$TEMPLATE NOTE$-------------------------------------------05460000
054700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05470000
054800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05480000
054900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05490000
055000***---------------------------------------------------------------05500000
055100             IF  PS-COMMAREA-NOT-VALID                            05510000
055600                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            05560000
055800             ELSE                                                 05580000
055900                 PERFORM 4000-BUILD-INITIAL-PANEL                 05590000
056000             END-IF                                               05600000
056100                                                                  05610000
056200         WHEN DP020-NEXT-ACT-READ-MAP                             05620000
056300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05630000
056500             PERFORM 2000-PROCESS-PANEL                           05650000
056600                                                                  05660000
056700         WHEN DP020-NEXT-ACT-RETURN                                       
056900             IF TR022-RECORD-UPDATED                                      
057000                 MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS                 
057100                 MOVE 'A' TO DK-STAT-CDE                                  
057200                 MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             
057400                 MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                    
057500                 PERFORM 2050-DELETE-LIST-QUEUE                           
057610                 IF ASC-USE-LIKE-CURSOR                                   
057620                     MOVE TR022-POE-CODE TO DK-POE-CODE                   
057630                 END-IF                                                   
057640             PERFORM 4000-BUILD-INITIAL-PANEL                             
057700             ELSE                                                         
057800                 MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             
058000                 MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                    
058100                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP                     
058200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
058300                 PERFORM 3000-EDIT-DATA-IN-COMMAREA                       
058400             END-IF                                                       
058500                                                                          
058600         WHEN OTHER                                                       
058700             SET DP013-LOGIC-ABEND TO TRUE                        05870000
058800             SET DP013-NO-ROLLBACK TO TRUE                        05880000
058900             MOVE '1000-CONTROL-PROCESSING'                       05890000
059000                                   TO DP013-PARAGRAPH             05900000
059100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05910000
059200                                   TO DP013-MESSAGE-TEXT(1)       05920000
059300             PERFORM DP013-0000-PROCESS-ABEND                     05930000
059400     END-EVALUATE.                                                05940000
059500                                                                  05950000
059600 EJECT                                                            05960000
059700******************************************************************05970000
059800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05980000
059900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05990000
060000******************************************************************06000000
060200 1100-PROCESS-INTER-APPL-COMM.                                    06020000
060300                                                                  06030000
060400     SET PS-COMMAREA-VALID         TO TRUE.                       06040000
060500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06050000
060600     MOVE TR022-POE-CODE           TO ASC-KEY-POE-CODE            06060004
060700                                      DK-POE-CODE.                06070004
061000     MOVE TR022-STAT-CDE           TO DK-STAT-CDE.                06100004
061100                                                                  06110000
061200     IF TR022-POE-CODE = SPACES                                   06120004
061210         MOVE SPACES  TO DK-POE-CODE                                      
061220                         ASC-KEY-POE-CODE                                 
061300         SET ASC-USE-ALL-CURSOR TO TRUE                           06130000
061400     ELSE                                                         06140000
061500         SET ASC-USE-LIKE-CURSOR TO TRUE                          06150000
061600     END-IF.                                                      06160000
061700                                                                  06170000
061800     INSPECT DK-POE-CODE TALLYING PV-ASTRK-CNT FOR ALL PC-ASTRK.  06180004
061900                                                                          
062000     IF PV-ASTRK-CNT > 0                                          06200000
062100         SET ASC-USE-LIKE-CURSOR TO TRUE                          06210000
062200         INSPECT DK-POE-CODE                                      06220004
062300             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06230000
062400         INSPECT ASC-KEY-POE-CODE                                 06240004
062500             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06250000
062600     END-IF.                                                      06260000
062700                                                                  06270000
062702     INSPECT DK-POE-CODE TALLYING PV-ASTRK-CNT FOR ALL            06310299
062703                                       PC-ASTRK.                  06310399
062704     IF PV-ASTRK-CNT > 0                                          06310499
062705         SET ASC-USE-LIKE-CURSOR TO TRUE                          06310599
062706         INSPECT DK-POE-CODE                                      06310699
062707             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06310799
062708         INSPECT ASC-KEY-POE-CODE                                 06310899
062709             REPLACING FIRST PC-ASTRK BY PC-PERCENT               06310999
062710     END-IF.                                                      06311099
062711                                                                  06311199
062712     INSPECT DK-POE-CODE TALLYING PV-ASTRK-CNT FOR ALL            06312099
062713                                       PC-SPACE.                  06313099
062714     IF PV-ASTRK-CNT > 0                                          06314099
062715         SET ASC-USE-LIKE-CURSOR TO TRUE                          06315099
062716         INSPECT DK-POE-CODE                                      06316099
062717             REPLACING FIRST PC-SPACE BY PC-PERCENT               06317099
062718         INSPECT ASC-KEY-POE-CODE                                 06318099
062719             REPLACING FIRST PC-SPACE BY PC-PERCENT               06319099
062720     END-IF.                                                      06319199
062721                                                                  06319299
062722     INSPECT DK-POE-CODE TALLYING PV-ASTRK-CNT FOR ALL            06319399
062723                                       PC-SPACE.                  06319499
062724     IF PV-ASTRK-CNT > 0                                          06319599
062725         SET ASC-USE-LIKE-CURSOR TO TRUE                          06319699
062726         INSPECT DK-POE-CODE                                      06319799
062727             REPLACING FIRST PC-SPACE BY PC-PERCENT               06319899
062728         INSPECT ASC-KEY-POE-CODE                                 06319999
062729             REPLACING FIRST PC-SPACE BY PC-PERCENT               06320099
062730     END-IF.                                                      06320199
062731                                                                  06320299
062732     INSPECT DK-POE-CODE TALLYING PV-ASTRK-CNT FOR ALL            06320399
062733                                       PC-SPACE.                  06320499
062734     IF PV-ASTRK-CNT > 0                                          06320599
062735         SET ASC-USE-LIKE-CURSOR TO TRUE                          06320699
062736         INSPECT DK-POE-CODE                                      06320799
062737             REPLACING FIRST PC-SPACE BY PC-PERCENT               06320899
062738         INSPECT ASC-KEY-POE-CODE                                 06320999
062739             REPLACING FIRST PC-SPACE BY PC-PERCENT               06321099
062740     END-IF.                                                      06321199
062750                                                                  06322069
062800 EJECT                                                            06280000
062900******************************************************************06290000
063000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06300000
063100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06310000
063200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06320000
063300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06330000
063400* FUNCTION KEYS CAN GET THIS FAR.                                *06340000
063500******************************************************************06350000
063700 2000-PROCESS-PANEL.                                              06370000
063710                                                                          
063800     EVALUATE TRUE                                                06380000
063900         WHEN DP020-SRC-AID = DP016-CLEAR                         06390000
064000             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                        
064100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06410000
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420000
064300                                                                  06430000
064400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06440000
064500             PERFORM 2050-DELETE-LIST-QUEUE                       06450000
064600             MOVE 0 TO PV-NUMBER-OF-SELECTED-ITEMS                06460000
065000             MOVE ASC-KEY-POE-STAT  TO DK-STAT-CDE                06500004
065100             IF ASC-USE-LIKE-CURSOR                               06510000
065200                 MOVE ASC-KEY-POE-CODE TO                         06520004
065300                      DK-POE-CODE                                 06530004
065400                 INSPECT DK-POE-CODE TALLYING                     06540004
065500                      PV-ASTRK-CNT FOR ALL                        06550000
065600                                       PC-ASTRK                   06560000
065700                 IF PV-ASTRK-CNT > 0                              06570000
065800                     SET ASC-USE-LIKE-CURSOR TO TRUE              06580000
065900                     INSPECT DK-POE-CODE                          06590004
066000                         REPLACING FIRST PC-ASTRK BY PC-PERCENT   06600000
066100                     INSPECT DK-POE-CODE                          06610004
066200                         REPLACING FIRST PC-ASTRK BY PC-PERCENT   06620000
066300                     INSPECT DK-POE-CODE                          06630004
066400                         REPLACING FIRST PC-SPACE BY PC-PERCENT   06640000
066500                 END-IF                                           06650000
066600             END-IF                                               06660000
066800             PERFORM 4000-BUILD-INITIAL-PANEL                     06680000
066900             MOVE +0 TO  ASC-NUMBER-OF-SELECTED-ITEMS             06690000
067000                                                                  06700000
067100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06710000
067200             PERFORM 2140-DESELECT-ALL-ITEMS                      06720000
067300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06730000
067400                                                                  06740000
067500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06750000
067600             PERFORM 2150-SELECT-ALL-ITEMS                        06760000
067700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06770000
067800                                                                  06780000
067900         WHEN OTHER                                               06790000
068000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06800000
068100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06810000
068200             IF  PS-NO-ERROR                                      06820000
068300                 SET DP030-CONTINUE-GO                            06830000
068400                                 TO TRUE                          06840000
068500                 PERFORM 2100-CHECK-FUNCTION-KEY                  06850000
068600             ELSE                                                 06860000
068700                 SET DP030-OVERRIDE-GO                            06870000
068800                                 TO TRUE                          06880000
068900             END-IF                                               06890000
069000     END-EVALUATE.                                                06900000
069100 EJECT                                                            06910000
069200******************************************************************06920000
069300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06930000
069400******************************************************************06940000
069500 2050-DELETE-LIST-QUEUE.                                          06950000
069600                                                                  06960000
069700     EXEC CICS                                                    06970000
069800         DELETEQ TS                                               06980000
069900             QUEUE (ASC-LIST-QUEUE-NAME)                          06990000
070000             RESP  (PV-CICS-RESP)                                 07000000
070100     END-EXEC.                                                    07010000
070200                                                                  07020000
070300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07030000
070400        (PV-CICS-RESP = DFHRESP(QIDERR))                          07040000
070500         CONTINUE                                                 07050000
070600     ELSE                                                         07060000
070700         SET DP013-CICS-ABEND      TO TRUE                        07070000
070800         SET DP013-NO-ROLLBACK     TO TRUE                        07080000
070900                                                                  07090000
071000         MOVE '2050-DELETE-LIST-QUEUE'                            07100000
071100                                   TO DP013-PARAGRAPH             07110000
071200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07120000
071300                                   TO DP013-MESSAGE-TEXT (1)      07130000
071400         PERFORM DP013-0000-PROCESS-ABEND                         07140000
071500     END-IF.                                                      07150000
071600                                                                  07160000
071700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07170000
071800 EJECT                                                            07180000
071900******************************************************************07190000
072000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07200000
072100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07210000
072200* CICS ARCHITECTURE API.                                         *07220000
072300******************************************************************07230000
072400 2100-CHECK-FUNCTION-KEY.                                         07240000
072410                                                                          
072500     EVALUATE TRUE                                                07250000
072600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07260000
072700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07270000
072800             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                 07280000
072900                 INITIALIZE TR022-INTER-APPL-COMMAREA             07290003
073000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07300000
073100                                TO TR022-NUMBER-OF-SELECTED-ITEMS 07310003
073200                 PERFORM 5000-PREPARE-SEL-QUEUE                   07320000
073300             ELSE                                                 07330000
073400                 SET DP030-OVERRIDE-GO TO TRUE                    07340000
073600                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        07360000
073800                 SET DP020-MSG-WARNING TO TRUE                    07380000
074000             END-IF                                               07400000
074100                                                                  07410000
074200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07420000
074300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                 07430000
074400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07440000
074500                            TO TR022-NUMBER-OF-SELECTED-ITEMS     07450003
074700                 MOVE +1 TO ASC-NUMBER-OF-SELECTED-ITEMS          07470000
074800                 INITIALIZE TR022-INTER-APPL-COMMAREA             07480003
074900                 MOVE 'I' TO TR022-STAT-CDE                       07490003
075100                 PERFORM 5000-PREPARE-SEL-QUEUE                   07510000
075200             ELSE                                                 07520000
075300                 IF  ASC-NUMBER-OF-SELECTED-ITEMS < +1            07530000
075400                     MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS      07540000
075500                     INITIALIZE TR022-INTER-APPL-COMMAREA         07550003
075600                     MOVE 'I' TO TR022-STAT-CDE                   07560003
075800                     PERFORM 5000-PREPARE-SEL-QUEUE               07580000
075900                  END-IF                                          07590000
076000             END-IF                                               07600000
076100                                                                  07610000
076200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07620000
076300             MOVE +1 TO PV-TOP-ITEM                               07630000
076400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07640000
076500             PERFORM 3200-RESET-ATTRIBUTES                        07650000
076600                                                                  07660000
076700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07670000
076800             PERFORM 2110-BROWSE-BACKWARD                         07680000
076900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07690000
077000             PERFORM 3200-RESET-ATTRIBUTES                        07700000
077100                                                                  07710000
077200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07720000
077300             PERFORM 2120-BROWSE-FORWARD                          07730000
077400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07740000
077500             PERFORM 3200-RESET-ATTRIBUTES                        07750000
077600                                                                  07760000
077700         WHEN DP020-SRC-AID = DP016-ENTER                         07770000
077800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07780000
077900             IF  PS-ERROR                                         07790000
078000                 CONTINUE                                         07800000
078100             ELSE                                                 07810000
078200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07820000
078300             END-IF                                               07830000
078400                                                                  07840000
078500         WHEN OTHER                                               07850000
078600             SET DP013-NO-ROLLBACK                                07860000
078700                 DP013-XCTL-DISPLAY-RESTART                       07870000
078800                 DP013-CICS-ABEND  TO TRUE                        07880000
078900             MOVE '2100-CHECK-FUNCTION-KEY'                       07890000
079000                                   TO DP013-PARAGRAPH             07900000
079100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07910000
079200                                   TO DP013-MESSAGE-TEXT (1)      07920000
079300             PERFORM DP013-0000-PROCESS-ABEND                     07930000
079400     END-EVALUATE.                                                07940000
079500                                                                  07950000
079600******************************************************************07960000
079700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07970000
079800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07980000
079900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07990000
080000*    MESSAGE.                                                    *08000000
080100******************************************************************08010000
080300 2110-BROWSE-BACKWARD.                                            08030000
080310                                                                          
080400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08040000
080500         GIVING PV-TOP-ITEM.                                      08050000
080600                                                                  08060000
080700     IF  ((PV-TOP-ITEM < +1) OR                                   08070000
080800          (PV-TOP-ITEM = +1))                                     08080000
080900         MOVE +1                   TO PV-TOP-ITEM                 08090000
081000*        -- TOP OF LIST --                                        08100000
081100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08110000
081200         SET DP020-MSG-INFORMATIONAL TO TRUE                      08120000
081300     END-IF.                                                      08130000
081400                                                                  08140000
081500 EJECT                                                            08150000
081600******************************************************************08160000
081700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08170000
081800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08180000
081900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08190000
082000******************************************************************08200000
082200 2120-BROWSE-FORWARD.                                             08220000
082300                                                                  08230000
082400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08240000
082500         GIVING PV-TOP-ITEM.                                      08250000
082600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08260000
082700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08270000
082800                                   TO PV-TOP-ITEM                 08280000
082900*        -- BOTTOM OF LIST --                                     08290000
083000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08300000
083100         SET DP020-MSG-INFORMATIONAL                              08310000
083200                                   TO TRUE                        08320000
083300     ELSE                                                         08330000
083400         COMPUTE PV-BOTTOM-ITEM =                                 08340000
083500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08350000
083600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08360000
083700*            -- BOTTOM OF LIST --                                 08370000
083800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08380000
083900             SET DP020-MSG-INFORMATIONAL                          08390000
084000                                   TO TRUE                        08400000
084100         END-IF                                                   08410000
084200     END-IF.                                                      08420000
084300 EJECT                                                            08430000
084400******************************************************************08440000
084500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08450000
084600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08460000
084700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08470000
084800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08480000
084900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08490000
085000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08500000
085100******************************************************************08510000
085300 2130-CHECK-FOR-JUMP-BROWSE.                                      08530000
085310                                                                          
085400     SET PS-NO-ERROR               TO TRUE.                       08540000
085500     IF (ASC-START-ITEM-REQUEST = SPACE)                          08550000
085600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08560000
085700                                   TO PV-TOP-ITEM                 08570000
085800     ELSE                                                         08580000
085900         MOVE ASC-START-ITEM-REQUEST                              08590000
086000                                   TO DP010I-UNEDITED-FIELD       08600000
086100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08610000
086200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08620000
086300         SET DP010I-NEGATIVE-NOT-ALLOWED                          08630000
086400                                   TO TRUE                        08640000
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
086600                                                                  08660000
086700         IF  NOT DP010I-ERROR-DETECTED                            08670000
086800             MOVE DP010I-NUMERIC-FIELD                            08680000
086900                                   TO  ASC-START-ITEM-REQUEST-N   08690000
087000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08700000
087100                 IF  ASC-START-ITEM-REQUEST-N >                   08710000
087200                                          ASC-NUMBER-OF-ITEMS-READ08720000
087300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08730000
087400                     COMPUTE PV-TOP-ITEM =                        08740000
087500                             ASC-NUMBER-OF-ITEMS-READ             08750000
087600                             - PC-ITEMS-PER-PANEL + 1             08760000
087700                     IF  PV-TOP-ITEM < +1                         08770000
087800                         MOVE +1   TO PV-TOP-ITEM                 08780000
087900                         MOVE PC-TSYMSG-00070                     08790000
088000                                   TO DP020-MSG-NUMBER            08800000
088100                         SET DP020-MSG-INFORMATIONAL              08810000
088200                                   TO TRUE                        08820000
088300                     END-IF                                       08830000
088400                 ELSE                                             08840000
088500                     MOVE ASC-START-ITEM-REQUEST-N                08850000
088600                                   TO PV-TOP-ITEM                 08860000
088700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08870000
088800                     COMPUTE PV-BOTTOM-ITEM =                     08880000
088900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08890000
089000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08900000
089100*                        -- BOTTOM OF LIST --                     08910000
089200                         MOVE PC-TSYMSG-00070                     08920000
089300                                   TO DP020-MSG-NUMBER            08930000
089400                         SET DP020-MSG-INFORMATIONAL              08940000
089500                                   TO TRUE                        08950000
089600                     END-IF                                       08960000
089700                 END-IF                                           08970000
089800             ELSE                                                 08980000
089900*                --- VALUE OUT OF RANGE ----                      08990000
090000                 MOVE PC-TSYMSG-00101                             09000000
090100                                   TO DP020-MSG-NUMBER            09010000
090200                 MOVE -1           TO ASTRTITL                    09020000
090300                 SET DP030-SET-CURSOR-APPL-1                      09030000
090400                                   TO TRUE                        09040000
090500                 MOVE DP015-REVERSE                               09050000
090600                                   TO ASTRTITH                    09060000
090700                 MOVE DP015-RED    TO ASTRTITC                    09070000
090800                 MOVE DP015-UNP-NUM-BRT-MDT                       09080000
090900                                   TO ASTRTITA                    09090000
091000                 SET DP020-MSG-FATAL                              09100000
091100                                   TO TRUE                        09110000
091200                 SET PS-ERROR      TO TRUE                        09120000
091300             END-IF                                               09130000
091400                                                                  09140000
091500         ELSE                                                     09150000
091600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09160000
091700             MOVE -1               TO ASTRTITL                    09170000
091800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09180000
091900             MOVE DP015-REVERSE    TO ASTRTITH                    09190000
092000             MOVE DP015-RED        TO ASTRTITC                    09200000
092100             MOVE DP015-UNP-NUM-BRT-MDT                           09210000
092200                                   TO ASTRTITA                    09220000
092300             SET DP020-MSG-FATAL   TO TRUE                        09230000
092400             SET PS-ERROR          TO TRUE                        09240000
092500         END-IF                                                   09250000
092600     END-IF.                                                      09260000
092700 EJECT                                                            09270000
092800******************************************************************09280000
092900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09290000
093000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09300000
093100******************************************************************09310000
093200 2140-DESELECT-ALL-ITEMS.                                         09320000
093210                                                                          
093300     MOVE +1                       TO ASC-BLK-SUB.                09330000
093400                                                                  09340000
093500     PERFORM 2141-CLEAR-SELECTED-INDS                             09350000
093600         VARYING ASC-ITEM-SUB                                     09360000
093700         FROM 1 BY 1                                              09370000
093800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09380000
093900                                                                  09390000
094000     ADD +1                        TO ASC-BLK-SUB.                09400000
094100                                                                  09410000
094200     PERFORM 2141-CLEAR-SELECTED-INDS                             09420000
094300         VARYING ASC-ITEM-SUB                                     09430000
094400         FROM 1 BY 1                                              09440000
094500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09450000
094600                                                                  09460000
094700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09470000
094800                                   TO PV-LIST-ITEM-NUMBER.        09480000
094900                                                                  09490000
095000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09500000
095100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09510000
095200                                                                  09520000
095300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09530000
095400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09540000
095500         MOVE +1                   TO ASC-BLK-SUB                 09550000
095600                                                                  09560000
095700         PERFORM 5100-WRITE-TEMP-STORAGE                          09570000
095800                                                                  09580000
095900         MOVE +1                   TO PV-BLOCK-NUMBER             09590000
096000                                                                  09600000
096100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09610000
096200             PV-FIRST-BLOCK-IN-ARRAY - 1                          09620000
096300                                                                  09630000
096400         PERFORM                                                  09640000
096500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09650000
096600                                                                  09660000
096700             PERFORM 4410-READ-TEMP-STORAGE                       09670000
096800                                                                  09680000
096900             PERFORM 2141-CLEAR-SELECTED-INDS                     09690000
097000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09700000
097100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09710000
097200                                                                  09720000
097300             PERFORM 5100-WRITE-TEMP-STORAGE                      09730000
097400                                                                  09740000
097500             ADD +1                TO PV-BLOCK-NUMBER             09750000
097600                                                                  09760000
097700         END-PERFORM                                              09770000
097800                                                                  09780000
097900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09790000
098000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09800000
098100                                                                  09810000
098200         PERFORM                                                  09820000
098300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09830000
098400                   ASC-HIGHEST-BLOCK-WRITTEN                      09840000
098500                                                                  09850000
098600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09860000
098700                                   TO PV-BLOCK-NUMBER             09870000
098800                                                                  09880000
098900             PERFORM 4410-READ-TEMP-STORAGE                       09890000
099000                                                                  09900000
099100             PERFORM 2141-CLEAR-SELECTED-INDS                     09910000
099200                 VARYING ASC-ITEM-SUB                             09920000
099300                 FROM 1 BY 1                                      09930000
099400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09940000
099500                                                                  09950000
099600             PERFORM 5100-WRITE-TEMP-STORAGE                      09960000
099700                                                                  09970000
099800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09980000
099900                                                                  09990000
100000         END-PERFORM                                              10000000
100100                                                                  10010000
100200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10020000
100300                                   TO PV-BLOCK-NUMBER             10030000
100400                                                                  10040000
100500         PERFORM 4410-READ-TEMP-STORAGE                           10050000
100600     END-IF.                                                      10060000
100700                                                                  10070000
100900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS.       
101000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10100000
101100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10110000
101200                                                                  10120000
101300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10130000
101400                                                                  10140000
101500 EJECT                                                            10150000
101600******************************************************************10160000
101700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10170000
101800******************************************************************10180000
102000 2141-CLEAR-SELECTED-INDS.                                        10200000
102100                                                                  10210000
102200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10220000
102300             NOT EQUAL ZERO                                       10230000
102400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10240000
102500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10250000
102600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10260000
102700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10270000
102800                                   TO TRUE                        10280000
102900         END-IF                                                   10290000
103000     END-IF.                                                      10300000
103100                                                                  10310000
103200 EJECT                                                            10320000
103300******************************************************************10330000
103400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *10340000
103500*  FOR ALL ITEMS.                                                *10350000
103600******************************************************************10360000
103800 2150-SELECT-ALL-ITEMS.                                           10380000
103900                                                                  10390000
104000     MOVE +1                       TO ASC-BLK-SUB.                10400000
104100                                                                  10410000
104200     PERFORM 2151-SET-SELECTED-INDS                               10420000
104300         VARYING ASC-ITEM-SUB                                     10430000
104400         FROM 1 BY 1                                              10440000
104500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10450000
104600                                                                  10460000
104700     ADD +1                        TO ASC-BLK-SUB.                10470000
104800                                                                  10480000
104900     PERFORM 2151-SET-SELECTED-INDS                               10490000
105000         VARYING ASC-ITEM-SUB                                     10500000
105100         FROM 1 BY 1                                              10510000
105200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10520000
105300                                                                  10530000
105400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10540000
105500                                   TO PV-LIST-ITEM-NUMBER.        10550000
105600                                                                  10560000
105700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10570000
105800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10580000
105900                                                                  10590000
106000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10600000
106100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10610000
106200         MOVE +1                   TO ASC-BLK-SUB                 10620000
106300                                                                  10630000
106400         PERFORM 5100-WRITE-TEMP-STORAGE                          10640000
106500                                                                  10650000
106600         MOVE +1                   TO PV-BLOCK-NUMBER             10660000
106700                                                                  10670000
106800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10680000
106900             PV-FIRST-BLOCK-IN-ARRAY - 1                          10690000
107000                                                                  10700000
107100         PERFORM                                                  10710000
107200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10720000
107300                                                                  10730000
107400             PERFORM 4410-READ-TEMP-STORAGE                       10740000
107500                                                                  10750000
107600             PERFORM 2151-SET-SELECTED-INDS                       10760000
107700                 VARYING ASC-ITEM-SUB                             10770000
107800                 FROM 1 BY 1                                      10780000
107900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10790000
108000                                                                  10800000
108100             PERFORM 5100-WRITE-TEMP-STORAGE                      10810000
108200                                                                  10820000
108300             ADD +1                TO PV-BLOCK-NUMBER             10830000
108400                                                                  10840000
108500         END-PERFORM                                              10850000
108600                                                                  10860000
108700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10870000
108800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10880000
108900                                                                  10890000
109000         PERFORM                                                  10900000
109100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10910000
109200                   ASC-HIGHEST-BLOCK-WRITTEN                      10920000
109300                                                                  10930000
109400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10940000
109500                                   TO PV-BLOCK-NUMBER             10950000
109600                                                                  10960000
109700             PERFORM 4410-READ-TEMP-STORAGE                       10970000
109800                                                                  10980000
109900             PERFORM 2151-SET-SELECTED-INDS                       10990000
110000                 VARYING ASC-ITEM-SUB                             11000000
110100                 FROM 1 BY 1                                      11010000
110200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11020000
110300                                                                  11030000
110400             PERFORM 5100-WRITE-TEMP-STORAGE                      11040000
110500                                                                  11050000
110600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11060000
110700                                                                  11070000
110800         END-PERFORM                                              11080000
110900                                                                  11090000
111000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11100000
111100                                   TO PV-BLOCK-NUMBER             11110000
111200                                                                  11120000
111300         PERFORM 4410-READ-TEMP-STORAGE                           11130000
111400     END-IF.                                                      11140000
111500                                                                  11150000
112000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11200000
112100                                                                  11210000
112200 EJECT                                                            11220000
112300******************************************************************11230000
112400*    MARK EACH ITEM AS BEING SELECTED.                           *11240000
112500******************************************************************11250000
112700 2151-SET-SELECTED-INDS.                                          11270000
112800                                                                  11280000
112900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11290000
113000             NOT EQUAL ZERO                                       11300000
113100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11310000
113200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11320000
113300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11330000
113400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11340000
113500                               TO  TRUE                           11350000
113600         END-IF                                                   11360000
113700     END-IF.                                                      11370000
113710                                                                          
113800******************************************************************11380000
113900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11390000
114000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11400000
114100******************************************************************11410000
114200 2200-MOVE-SCREEN-TO-COMMAREA.                                    11420000
114300                                                                  11430000
114400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11440000
114500     MOVE +1                       TO PV-SUB.                     11450000
114600                                                                  11460000
114700     PERFORM 3100-SET-SUBSCRIPTS.                                 11470000
114800     IF  ASTRTITL > ZERO                                          11480000
114900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11490000
115000     ELSE                                                         11500000
115100         IF  ASTRTITF = DP015-ERASE-EOF                           11510000
115200             INITIALIZE ASC-START-ITEM-REQUEST                    11520000
115300         END-IF                                                   11530000
115400     END-IF.                                                      11540000
115500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11550000
115600         VARYING PV-SUB                                           11560000
115700         FROM 1 BY 1                                              11570000
115800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11580000
115810                                                                          
115900******************************************************************11590000
116000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**11600000
116100******************************************************************11610000
116200 2210-MOVE-LINES-TO-COMMAREA.                                     11620000
116210                                                                          
116300     IF  MR-SELECTL (PV-SUB) > ZERO                               11630000
116400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11640000
116500         MOVE MR-SELECTI (PV-SUB)                                 11650000
116600                                   TO ASC-TEMP-SELECTED-SW        11660000
116700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11670000
116800     ELSE                                                         11680000
116900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11690000
117000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11700000
117100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11710000
117200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11720000
117300         END-IF                                                   11730000
117400     END-IF.                                                      11740000
117500     ADD +1                        TO ASC-ITEM-SUB.               11750000
117600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11760000
117700         ADD +1                    TO ASC-BLK-SUB                 11770000
117800         MOVE +1                   TO ASC-ITEM-SUB                11780000
117900     END-IF.                                                      11790000
117910                                                                          
118000******************************************************************11800000
118100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11810000
118200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11820000
118300******************************************************************11830000
118400 3000-EDIT-DATA-IN-COMMAREA.                                      11840000
118410                                                                          
118500     SET PS-NO-ERROR               TO TRUE.                       11850000
118600     PERFORM 3200-RESET-ATTRIBUTES.                               11860000
118700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11870000
118800**                                                                11880000
118900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11890000
119000* EDITTING IS DONE FROM THE BOTTOM UP.                            11900000
119100**                                                                11910000
119200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11920000
119300         ASC-ITEMS-DISPLAYED - 1.                                 11930000
119400     PERFORM 3100-SET-SUBSCRIPTS.                                 11940000
119500     PERFORM 3300-EDIT-SELECTIONS                                 11950000
119600         VARYING PV-SUB                                           11960000
119700         FROM PV-SUB BY -1                                        11970000
119800         UNTIL PV-SUB < +1                                        11980000
119900                                                                  11990000
120000     IF  PS-NO-ERROR                                              12000000
120100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12010000
120200     END-IF.                                                      12020000
120300                                                                  12030000
120400     IF  ((PS-NO-ERROR)                                           12040000
120500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12050000
120600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12060000
120700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12070000
120800     END-IF.                                                      12080000
120900 EJECT                                                            12090000
121000******************************************************************12100000
121100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12110000
121200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12120000
121300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12130000
121400*                                                                *12140000
121500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12150000
121600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12160000
121700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12170000
121800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12180000
121900******************************************************************12190000
122100 3100-SET-SUBSCRIPTS.                                             12210000
122200                                                                  12220000
122300     COMPUTE ASC-ITEM-SUB =                                       12230000
122400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12240000
122500                                                                  12250000
122600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12260000
122700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12270000
122800                                                                  12280000
122900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12290000
123000     ELSE                                                         12300000
123100         MOVE +1                     TO ASC-BLK-SUB               12310000
123200     END-IF.                                                      12320000
123210                                                                          
123300******************************************************************12330000
123400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12340000
123500******************************************************************12350000
123700 3200-RESET-ATTRIBUTES.                                           12370000
123800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12380000
123900     MOVE DP015-GREEN              TO ASTRTITC.                   12390000
124000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12400000
124100                                                                  12410000
124200     PERFORM                                                      12420000
124300         VARYING PV-SUB                                           12430000
124400         FROM 1 BY 1                                              12440000
124500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12450000
124600         MOVE DP015-UNP-ALP-NOR-OFF                               12460000
124700                                   TO MR-SELECTA (PV-SUB)         12470000
124800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12480000
124900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12490000
125000     END-PERFORM.                                                 12500000
125010                                                                          
125100******************************************************************12510000
125200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12520000
125300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12530000
125400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12540000
125500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12550000
125600******************************************************************12560000
125700 3300-EDIT-SELECTIONS.                                            12570000
125710                                                                          
125800     EVALUATE TRUE                                                12580000
125900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12590000
126000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12600000
126100                 CONTINUE                                         12610000
126200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12620000
126300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12630000
126400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12640000
126500                 MOVE ASC-TEMP-SELECTED-SW                        12650000
126600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12660000
126700                                TO ASC-SELECTED-SW                12670000
126800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12680000
126900             END-IF                                               12690000
127000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12700000
127100                 = SPACE                                          12710000
127200             EVALUATE TRUE                                        12720000
127300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12730000
127400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12740000
127500                     MOVE SPACE TO ASC-SELECTED-SW                12750000
127600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12760000
127700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12770000
127800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12780000
127900                     MOVE SPACE TO ASC-SELECTED-SW                12790000
128000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12800000
128100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12810000
128200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12820000
128300                     MOVE SPACE TO ASC-SELECTED-SW                12830000
128400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12840000
128500             END-EVALUATE                                         12850000
128600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12860000
128700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12870000
128800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12880000
128900             END-IF                                               12890000
129000             PERFORM 3310-EDIT-RANGE                              12900000
129100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12910000
129200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12920000
129300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12930000
129400             END-IF                                               12940000
129500             PERFORM 3310-EDIT-RANGE                              12950000
129600         WHEN OTHER                                               12960000
129700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12970000
129800             SET DP020-MSG-FATAL    TO TRUE                       12980000
129900             MOVE -1                TO MR-SELECTL (PV-SUB)        12990000
130000             SET DP030-SET-CURSOR-APPL-1                          13000000
130100                                    TO TRUE                       13010000
130200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13020000
130300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13030000
130400             SET PS-ERROR TO TRUE                                 13040000
130500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13050000
130600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13060000
130700                 MOVE SPACE         TO ASC-SELECTED-SW            13070000
130800                                        (ASC-BLK-SUB ASC-ITEM-SUB)13080000
130900             END-IF                                               13090000
131000     END-EVALUATE.                                                13100000
131100                                                                  13110000
131200     IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    13120000
131300         MOVE ASC-POE-CODE       (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13130004
131400                                   TR022-POE-CODE                 13140004
131500         MOVE ASC-POE-CODE-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13150004
131600                                   TR022-POE-CODE-DESC            13160004
131900         MOVE ASC-POE-CITY-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13190004
132000                                   TR022-POE-CITY-NAME            13200004
132010         MOVE ASC-POE-STATE-CODE (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13201004
132020                                   TR022-POE-STATE-CODE           13202004
132210         MOVE ASC-DCONSLR-SCAC   (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13210004
132220                                   TR022-DCONSLR-NAME             13220004
132300         MOVE ASC-DCONSLR-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13230004
132400                                   TR022-DCONSLR-ENT-ID           13240004
132500         MOVE ASC-POE-STD-EDI-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  TO  13250004
132600                                   TR022-POE-STD-EDI-CDE          13260004
132700         MOVE ASC-ALLOWED-ON-PO  (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13130004
132800                                   TR022-ALLOWED-ON-PO            13140004
132900         MOVE ASC-TRIP-TYP-CDE   (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13130004
133000                                   TR022-TRIP-TYP-CDE             13140004
133010         MOVE ASC-IATA-CDE       (ASC-BLK-SUB ASC-ITEM-SUB)   TO  13130004
133020                                   TR022-IATA-CDE                 13140004
133100         MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) TO  13310004
133200                                   TR022-LIST-ITEM-NUMBER         13320004
133700     END-IF.                                                      13370000
133800                                                                  13380000
133900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13390000
134000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13400000
134100     IF  ASC-ITEM-SUB < 1                                         13410000
134200         SUBTRACT +1 FROM ASC-BLK-SUB                             13420000
134300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13430000
134400     END-IF.                                                      13440000
134410                                                                          
134500******************************************************************13450000
134600** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13460000
134700** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13470000
134800** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13480000
134900** THE ENDING.                                                  **13490000
135000******************************************************************13500000
135100 3310-EDIT-RANGE.                                                 13510000
135110                                                                          
135200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13520000
135300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13530000
135400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13540000
135500                                   TO ASC-SELECTED-SW             13550000
135600                                        (ASC-BLK-SUB ASC-ITEM-SUB)13560000
135700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13570000
135800         ELSE                                                     13580000
135900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13590000
136000                 CONTINUE                                         13600000
136100             ELSE                                                 13610000
136200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13620000
136300                 MOVE PC-TSYMSG-00054                             13630000
136400                                   TO DP020-MSG-NUMBER            13640000
136500                 SET DP020-MSG-FATAL                              13650000
136600                                   TO TRUE                        13660000
136700                 MOVE -1           TO MR-SELECTL (PV-SUB)         13670000
136800                 SET DP030-SET-CURSOR-APPL-1                      13680000
136900                                   TO TRUE                        13690000
137000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13700000
137100                 MOVE DP015-UNDERLINE                             13710000
137200                                   TO MR-SELECTH (PV-SUB)         13720000
137300                 SET PS-ERROR      TO TRUE                        13730000
137400             END-IF                                               13740000
137500         END-IF                                                   13750000
137600     ELSE                                                         13760000
137700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13770000
137800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13780000
137900                                   TO ASC-SELECTED-SW             13790000
138000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13800000
138100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13810000
138200         ELSE                                                     13820000
138300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13830000
138400                 CONTINUE                                         13840000
138500             ELSE                                                 13850000
138600*                -- ONLY ONE END-OF-RANGE ALLOWED --              13860000
138700                 MOVE PC-TSYMSG-00055                             13870000
138800                                   TO DP020-MSG-NUMBER            13880000
138900                 SET DP020-MSG-FATAL                              13890000
139000                                   TO TRUE                        13900000
139100                 MOVE -1           TO MR-SELECTL (PV-SUB)         13910000
139200                 SET DP030-SET-CURSOR-APPL-1                      13920000
139300                                   TO TRUE                        13930000
139400                 SET PS-ERROR      TO TRUE                        13940000
139500             END-IF                                               13950000
139600         END-IF                                                   13960000
139700     END-IF.                                                      13970000
139800                                                                  13980000
139900******************************************************************13990000
140000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14000000
140100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14010000
140200******************************************************************14020000
140300 3400-CHECK-RANGE-SEQUENCE.                                       14030000
140310                                                                          
140400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14040000
140500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14050000
140600       AND  ASC-START-OF-SELECTED-RANGE >                         14060000
140700                                         ASC-END-OF-SELECTED-RANGE14070000
140800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14080000
140900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14090000
141000         SET DP020-MSG-FATAL TO TRUE                              14100000
141100         SET PS-ERROR TO TRUE                                     14110000
141200         PERFORM 3410-POSITION-AT-ERROR                           14120000
141300     END-IF.                                                      14130000
141310                                                                          
141400******************************************************************14140000
141500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14150000
141600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14160000
141700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14170000
141800******************************************************************14180000
141900 3410-POSITION-AT-ERROR.                                          14190000
141910                                                                          
142000     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         14200000
142200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14220000
142300                    - PV-TOP-ITEM + 1.                            14230000
142400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14240000
142500         CONTINUE                                                 14250000
142600     ELSE                                                         14260000
142700         MOVE -1                   TO MR-SELECTL (PV-SUB)         14270000
142800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14280000
142900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14290000
143000     END-IF.                                                      14300000
143100                                                                  14310000
143200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14320000
143300                    - PV-TOP-ITEM + 1.                            14330000
143400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14340000
143500         CONTINUE                                                 14350000
143600     ELSE                                                         14360000
143700         MOVE -1                   TO MR-SELECTL (PV-SUB)         14370000
143800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14380000
143900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14390000
144000     END-IF.                                                      14400000
144100 EJECT                                                            14410000
144200******************************************************************14420000
144300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14430000
144400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14440000
144500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14450000
144600******************************************************************14460000
144800 3500-MARK-RANGE-AS-SELECTED.                                     14480000
144810                                                                          
144900     MOVE +1                       TO  ASC-BLK-SUB.               14490000
145000     PERFORM 3510-MARK-SELECTED-INDS                              14500000
145100         VARYING ASC-ITEM-SUB                                     14510000
145200         FROM 1 BY 1                                              14520000
145300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14530000
145400                                                                  14540000
145500     ADD +1                        TO ASC-BLK-SUB.                14550000
145600     PERFORM 3510-MARK-SELECTED-INDS                              14560000
145700         VARYING ASC-ITEM-SUB                                     14570000
145800         FROM 1 BY 1                                              14580000
145900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14590000
146000                                                                  14600000
146100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14610000
146200                                   TO  PV-LIST-ITEM-NUMBER.       14620000
146300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14630000
146400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14640000
146500               PC-ITEMS-PER-PANEL).                               14650000
146600                                                                  14660000
146700     MOVE ASC-START-OF-SELECTED-RANGE                             14670000
146800                                   TO PV-START-OF-SELECTED-RANGE. 14680000
146900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14690000
147000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14700000
147100               PC-ITEMS-PER-PANEL).                               14710000
147200                                                                  14720000
147300     MOVE ASC-END-OF-SELECTED-RANGE                               14730000
147400                                   TO  PV-END-OF-SELECTED-RANGE.  14740000
147500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14750000
147600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14760000
147700               PC-ITEMS-PER-PANEL).                               14770000
147800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14780000
147900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14790000
148000                                                                  14800000
148100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14810000
148200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14820000
148300         MOVE +1                   TO ASC-BLK-SUB                 14830000
148400         PERFORM 5100-WRITE-TEMP-STORAGE                          14840000
148500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14850000
148600             PV-FIRST-BLOCK-IN-ARRAY - 1                          14860000
148700                                                                  14870000
148800         PERFORM                                                  14880000
148900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14890000
149000                   PV-PREV-BLOCK-IN-ARRAY                         14900000
149100             MOVE PV-FIRST-BLOCK-IN-RANGE                         14910000
149200                                   TO PV-BLOCK-NUMBER             14920000
149300             PERFORM 4410-READ-TEMP-STORAGE                       14930000
149400             PERFORM 3510-MARK-SELECTED-INDS                      14940000
149500                 VARYING ASC-ITEM-SUB                             14950000
149600                 FROM 1 BY 1                                      14960000
149700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14970000
149800             PERFORM 5100-WRITE-TEMP-STORAGE                      14980000
149900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14990000
150000         END-PERFORM                                              15000000
150100                                                                  15010000
150200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15020000
150300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15030000
150400         PERFORM                                                  15040000
150500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15050000
150600                   PV-LAST-BLOCK-IN-RANGE                         15060000
150700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15070000
150800                                   TO PV-BLOCK-NUMBER             15080000
150900             PERFORM 4410-READ-TEMP-STORAGE                       15090000
151000             PERFORM 3510-MARK-SELECTED-INDS                      15100000
151100                 VARYING ASC-ITEM-SUB                             15110000
151200                 FROM 1 BY 1                                      15120000
151300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15130000
151400             PERFORM 5100-WRITE-TEMP-STORAGE                      15140000
151500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15150000
151600         END-PERFORM                                              15160000
151700                                                                  15170000
151800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15180000
151900                                   TO PV-BLOCK-NUMBER             15190000
152000         PERFORM 4410-READ-TEMP-STORAGE                           15200000
152100     END-IF.                                                      15210000
152200                                                                  15220000
152300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15230000
152400                                      ASC-END-OF-SELECTED-RANGE.  15240000
152600 EJECT                                                            15260000
152700******************************************************************15270000
152800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15280000
152900******************************************************************15290000
153100 3510-MARK-SELECTED-INDS.                                         15310000
153200                                                                  15320000
153300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15330000
153400                                ASC-ITEM-SUB) >                   15340000
153500         ASC-START-OF-SELECTED-RANGE)                             15350000
153600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15360000
153700                                ASC-ITEM-SUB) =                   15370000
153800         ASC-START-OF-SELECTED-RANGE)                             15380000
153900                                                                  15390000
154000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15400000
154100                                    ASC-ITEM-SUB) <               15410000
154200             ASC-END-OF-SELECTED-RANGE)                           15420000
154300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15430000
154400                                    ASC-ITEM-SUB) =               15440000
154500             ASC-END-OF-SELECTED-RANGE)                           15450000
154600                                                                  15460000
154700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15470000
154800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15480000
154900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15490000
155000                               TO TRUE                            15500000
155100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15510000
155200                               TO TRUE                            15520000
155300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15530000
155400             END-IF                                               15540000
155500         END-IF                                                   15550000
155600     END-IF.                                                      15560000
155700                                                                  15570000
155800 EJECT                                                            15580000
155900******************************************************************15590000
156000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15600000
156100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15610000
156200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15620000
156300*    DISPLAY THE PANEL TO USER.                                  *15630000
156400******************************************************************15640000
156600 4000-BUILD-INITIAL-PANEL.                                        15660000
156700                                                                  15670000
156800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15680000
156900                                 ASC-BLOCK-ENTRIES (2).           15690000
157000     MOVE +1                 TO ASC-BLK-SUB.                      15700000
157100     SET ASC-ITEMS-LEFT-ON-DB                                     15710000
157200                             TO TRUE.                             15720000
157300                                                                  15730000
157400     MOVE +0                 TO ASC-ITEM-SUB                      15740000
157500                                ASC-NUMBER-OF-ITEMS-READ          15750000
157600                                ASC-NUMBER-OF-SELECTED-ITEMS      15760000
157700                                ASC-HIGHEST-BLOCK-WRITTEN         15770000
157800                                ASC-START-OF-SELECTED-RANGE       15780000
157900                                ASC-END-OF-SELECTED-RANGE         15790000
158000                                ASC-ITEM-AT-TOP-OF-PANEL.         15800000
158100     PERFORM 4100-PREPARE-CURSOR.                                 15810000
158200                                                                  15820000
158300     PERFORM 4010-OPEN-CURSOR.                                    15830000
158400                                                                  15840000
158500     PERFORM 4300-READ-ITEMS-FROM-DB.                             15850000
158600                                                                  15860000
158700     PERFORM 4020-CLOSE-CURSOR.                                   15870000
158800                                                                  15880000
158900     MOVE +1                   TO  PV-TOP-ITEM.                   15890000
158902                                                                          
158903     IF (ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
158904         AND PV-NUMBER-OF-SELECTED-ITEMS > 0                              
158905         AND DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST-ACT)          
158906         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                            
158907         SET DP020-MSG-FATAL   TO  TRUE                                   
158908         MOVE PC-TSYMSG-01646  TO  DP020-MSG-NUMBER                       
158909         MOVE -1               TO MR-SELECTL (1)                          
158910         SET DP030-SET-CURSOR-APPL-1                                      
158911                               TO TRUE                                    
158912                 SET DP030-OVERRIDE-GO                                    
158913                                 TO TRUE                                  
159400     ELSE                                                         15940000
159500         MOVE -1               TO MR-SELECTL (1)                  15950000
159600         SET DP030-SET-CURSOR-APPL-1                              15960000
159700                               TO TRUE                            15970000
159800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15980000
159900     END-IF.                                                      15990000
160000 EJECT                                                            16000000
160100******************************************************************16010000
160200* OPEN THE TMESSAGE CURSOR.                                      *16020000
160300*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *16030000
160400*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16040000
160500*   USER.                                                        *16050000
160600******************************************************************16060000
160800 4010-OPEN-CURSOR.                                                16080000
160810                                                                          
160900     EVALUATE TRUE                                                16090000
161000         WHEN ASC-USE-LIKE-CURSOR                                 16100000
161100             MOVE 'CURSOR:  POE-LIKE-CSR'                         16110004
161200                               TO DP013-MESSAGE-TEXT (2)          16120000
161300             EXEC SQL                                             16130000
161400                  OPEN POE-LIKE-CSR                               16140004
161500             END-EXEC                                             16150000
161600                                                                  16160000
161700         WHEN ASC-USE-ALL-CURSOR                                  16170000
161800             MOVE 'CURSOR:  POE-ALL-CSR'                          16180004
161900                               TO DP013-MESSAGE-TEXT (2)          16190000
162000             EXEC SQL                                             16200000
162100                  OPEN POE-ALL-CSR                                16210004
162200             END-EXEC                                             16220000
162300                                                                  16230000
162400     END-EVALUATE.                                                16240000
162500                                                                  16250000
162600     EVALUATE TRUE                                                16260000
162700         WHEN SQLCODE = ZERO                                      16270000
162800             CONTINUE                                             16280000
162900         WHEN SQLWARN0 NOT = SPACES                               16290000
163000         WHEN SQLCODE < ZERO                                      16300000
163100         WHEN SQLCODE > ZERO                                      16310000
163200             MOVE '4010-OPEN-CURSOR'                              16320000
163300                               TO DP013-PARAGRAPH                 16330000
163400             MOVE 'OPEN SYSTEM MESSAGE CURSOR - '                 16340000
163500                               TO DP013-MESSAGE-TEXT (1)          16350000
163600             MOVE SQLCA        TO DP013-SQLCA                     16360000
163700             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        16370000
163800             SET DP013-DB2-ABEND                                  16380000
163900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16390000
164000             PERFORM DP013-0000-PROCESS-ABEND                     16400000
164100     END-EVALUATE.                                                16410000
164200*                                                                 16420000
164300 EJECT                                                            16430000
164400******************************************************************16440000
164500* CLOSE THE TMESSAGE CURSOR.                                     *16450000
164600*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *16460000
164700*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16470000
164800*   USER.                                                        *16480000
164900******************************************************************16490000
165100 4020-CLOSE-CURSOR.                                               16510000
165110                                                                          
165200     EVALUATE TRUE                                                16520000
165300         WHEN ASC-USE-LIKE-CURSOR                                 16530000
165400             MOVE 'CURSOR:  POE-LIKE-CSR'                         16540004
165500                               TO DP013-MESSAGE-TEXT (2)          16550000
165600             EXEC SQL                                             16560000
165700                  CLOSE POE-LIKE-CSR                              16570004
165800             END-EXEC                                             16580000
165900                                                                  16590000
166000         WHEN ASC-USE-ALL-CURSOR                                  16600000
166100             MOVE 'CURSOR:  POE-ALL-CSR'                          16610004
166200                               TO DP013-MESSAGE-TEXT (2)          16620000
166300             EXEC SQL                                             16630000
166400                  CLOSE POE-ALL-CSR                               16640004
166500             END-EXEC                                             16650000
166600                                                                  16660000
166700     END-EVALUATE.                                                16670000
166800*                                                                 16680000
166900     EVALUATE TRUE                                                16690000
167000         WHEN SQLCODE = ZERO                                      16700000
167100             CONTINUE                                             16710000
167200         WHEN SQLWARN0 NOT = SPACES                               16720000
167300         WHEN SQLCODE < ZERO                                      16730000
167400         WHEN SQLCODE > ZERO                                      16740000
167500             MOVE '4020-CLOSE-CURSOR'                             16750000
167600                               TO DP013-PARAGRAPH                 16760000
167700             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  16770000
167800                               TO DP013-MESSAGE-TEXT (1)          16780000
167900             MOVE SQLCA        TO DP013-SQLCA                     16790000
168000             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        16800000
168100             SET DP013-DB2-ABEND                                  16810000
168200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16820000
168300             PERFORM DP013-0000-PROCESS-ABEND                     16830000
168400     END-EVALUATE.                                                16840000
168500                                                                  16850000
168600 EJECT                                                            16860000
168700******************************************************************16870000
168800*    SET UP THE HOST VARIABLES.                                  *16880000
168900******************************************************************16890000
169100 4100-PREPARE-CURSOR.                                             16910000
169200                                                                  16920000
169210     MOVE ASC-KEY-POE-CODE TO DK-POE-CODE.                                
169300                                                                  16930000
169400 EJECT                                                            16940000
169500******************************************************************16950000
169600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16960000
169700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16970000
169800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16980000
169900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16990000
170000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17000000
170100*                                                                *17010000
170200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17020000
170300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17030000
170400*    UPON INITIALIZATION.                                        *17040000
170500******************************************************************17050000
170700 4300-READ-ITEMS-FROM-DB.                                         17070000
170800                                                                  17080000
170900     PERFORM                                                      17090000
171000         VARYING PV-READ-COUNT                                    17100000
171100         FROM 1 BY 1                                              17110000
171200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17120000
171300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17130000
171400                                                                  17140000
171500         PERFORM 4310-FETCH                                       17150000
171600                                                                  17160000
171700         IF  ASC-ITEMS-LEFT-ON-DB                                 17170000
171800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17180000
171900                 ADD +1            TO ASC-ITEM-SUB                17190000
172000             ELSE                                                 17200000
172100                 ADD +1            TO ASC-BLK-SUB                 17210000
172200                 MOVE +1           TO ASC-ITEM-SUB                17220000
172300                                                                  17230000
172400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17240000
172500                     MOVE +1       TO ASC-BLK-SUB                 17250000
172600                     SET ASC-BLOCK-MODIFIED (1)                   17260000
172700                                   TO TRUE                        17270000
172800                     PERFORM 5100-WRITE-TEMP-STORAGE              17280000
172900                     MOVE ASC-BLOCK-ENTRIES                       17290000
173000                               (PC-MAX-BLOCKS-IN-ARRAY)           17300000
173100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17310000
173200                     ADD +1        TO ASC-BLK-SUB                 17320000
173300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17330000
173400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17340000
173500                                   TO TRUE                        17350000
173600                 END-IF                                           17360000
173700             END-IF                                               17370000
173800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17380000
173900             MOVE ASC-NUMBER-OF-ITEMS-READ                        17390000
174000                                   TO ASC-LIST-ITEM-NUMBER        17400000
174100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17410000
174200             MOVE IMPOE-POE-CDE    TO ASC-POE-CODE                17420005
174300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17430000
174310             MOVE IMPOE-PO-ASGMT-ALWD-IND TO ASC-ALLOWED-ON-PO    17420005
174320                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17430000
174330             MOVE IMPOE-TRIP-TYP-CDE TO ASC-TRIP-TYP-CDE          17420005
174340                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17430000
174350             MOVE IMPOE-STD-IATA-CDE TO ASC-IATA-CDE              17420005
174360                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17430000
174400             MOVE IMPOE-POE-STD-EDI-CDE                           17440005
174500                                   TO ASC-POE-STD-EDI-CDE         17450005
174501                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17450105
174502             MOVE IMPOE-POE-NM     TO ASC-POE-CODE-DESC           17450205
174504                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17450405
174700             MOVE IMPOE-POE-CTY-NM TO ASC-POE-CITY-NAME           17470005
174900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17490000
174910             MOVE IMPOE-POE-ST-CDE TO ASC-POE-STATE-CODE          17491005
174930                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17493005
175600                                                                  17560000
175610             MOVE IMPOE-DCONSLR-ENT-ID TO DK-ENT-ID               17561005
175700             MOVE DK-STAT-CDE       TO   ASC-KEY-POE-STAT         17570005
175900             PERFORM 4330-SELECT-SCAC                             17590000
175902                                                                  17690099
175903             MOVE EXTENT-SCAC-CDE                                 17700099
175904                                   TO ASC-DCONSLR-SCAC            17710099
175905                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17720069
176400             MOVE IMPOE-DCONSLR-ENT-ID TO                         17640005
176500                             ASC-DCONSLR-ENT-ID                   17650005
176600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17660000
177800         END-IF                                                   17780000
177900     END-PERFORM.                                                 17790000
178000                                                                  17800000
178100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17810000
178200         MOVE +1               TO ASC-BLK-SUB                     17820000
178300         PERFORM 5100-WRITE-TEMP-STORAGE                          17830000
178400         ADD +1                TO ASC-BLK-SUB                     17840000
178500         PERFORM 5100-WRITE-TEMP-STORAGE                          17850000
178600                                                                  17860000
178700         MOVE 1                TO ASC-BLK-SUB                     17870000
178800                                  PV-BLOCK-NUMBER                 17880000
178900         PERFORM 4410-READ-TEMP-STORAGE                           17890000
179000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17900000
179100             MOVE 2            TO ASC-BLK-SUB                     17910000
179200                                  PV-BLOCK-NUMBER                 17920000
179300             PERFORM 4410-READ-TEMP-STORAGE                       17930000
179400         END-IF                                                   17940000
179500     END-IF.                                                      17950000
179600 EJECT                                                            17960000
179700******************************************************************17970000
179800*    FETCH THE MESSAGE CURSOR.                                   *17980000
179900******************************************************************17990000
180100 4310-FETCH.                                                      18010000
180200                                                                  18020000
180300     EVALUATE TRUE                                                18030000
180400         WHEN ASC-USE-LIKE-CURSOR                                 18040000
180500             MOVE 'CURSOR:  POE-LIKE-CSR'                         18050004
180600                               TO DP013-MESSAGE-TEXT (2)          18060000
180700             EXEC SQL                                             18070000
180800                  FETCH POE-LIKE-CSR                              18080005
180900                  INTO  :IMPOE-POE-CDE                            18090005
180910                      , :IMPOE-DCONSLR-ENT-ID                     18091005
181000                      , :IMPOE-POE-STD-EDI-CDE                    18100005
181010                      , :IMPOE-POE-NM                             18101005
181100                      , :IMPOE-POE-CTY-NM                         18110005
181200                      , :IMPOE-POE-ST-CDE                         18120005
181300                      , :IMPOE-PO-ASGMT-ALWD-IND                          
181400                      , :IMPOE-TRIP-TYP-CDE                               
181500                      , :IMPOE-STD-IATA-CDE                               
181700             END-EXEC                                             18170000
181800                                                                  18180000
181900         WHEN ASC-USE-ALL-CURSOR                                  18190000
182000             MOVE 'CURSOR:  POE-ALL-CSR'                          18200005
182100                               TO DP013-MESSAGE-TEXT (2)          18210000
182200             EXEC SQL                                             18220000
182300                  FETCH POE-ALL-CSR                               18230005
182400                  INTO  :IMPOE-POE-CDE                            18240005
182420                      , :IMPOE-DCONSLR-ENT-ID                     18242005
182430                      , :IMPOE-POE-STD-EDI-CDE                    18243005
182440                      , :IMPOE-POE-NM                             18244005
182450                      , :IMPOE-POE-CTY-NM                         18245005
182460                      , :IMPOE-POE-ST-CDE                         18246005
182470                      , :IMPOE-PO-ASGMT-ALWD-IND                          
182480                      , :IMPOE-TRIP-TYP-CDE                               
182490                      , :IMPOE-STD-IATA-CDE                               
183200             END-EXEC                                             18320000
183300                                                                  18330000
183400     END-EVALUATE.                                                18340000
183500                                                                  18350000
183600     EVALUATE TRUE                                                18360000
183700         WHEN SQLCODE = ZERO                                      18370000
183800         WHEN SQLCODE = +100                                      18380000
183802              IF PV-NUMBER-OF-SELECTED-ITEMS NOT NUMERIC                  
183803                   MOVE 0  TO PV-NUMBER-OF-SELECTED-ITEMS                 
183804               END-IF                                                     
184000         WHEN SQLWARN0 NOT = SPACE                                18400000
184100         WHEN SQLCODE NOT = ZERO                                  18410000
184200              MOVE '4310-FETCH-CURSOR'                            18420000
184300                               TO DP013-PARAGRAPH                 18430000
184400              MOVE 'FETCH MESSAGE CURSOR'                         18440000
184500                               TO DP013-MESSAGE-TEXT (1)          18450000
184600              MOVE SQLCA       TO DP013-SQLCA                     18460000
184700              SET DP013-DB2-ABEND                                 18470000
184800                               TO TRUE                            18480000
184900              PERFORM DP013-0000-PROCESS-ABEND                    18490000
185000     END-EVALUATE.                                                18500000
185100                                                                  18510000
185200     IF  SQLCODE EQUAL +100                                       18520000
185300         SET ASC-NO-ITEMS-LEFT-ON-DB                              18530000
185400                                   TO TRUE                        18540000
185500     END-IF.                                                      18550000
185600                                                                  18560000
188500 4330-SELECT-SCAC.                                                18850000
188600                                                                  18860000
189602     EXEC SQL                                                     18950299
189603         SELECT B.SCAC_CDE                                        18950399
189604            INTO :EXTENT-SCAC-CDE                                 18950599
189605             FROM TENTNME A,                                      18950799
189606                  TEXTENT B                                       18950899
189607             WHERE A.ENT_ID = B.ENT_ID                            18950999
189608               AND B.ENT_ID = :DK-ENT-ID                          18951099
189609               AND A.TYPE_CDE = :PC-PRIMARY                       18952099
189610     END-EXEC                                                     18960099
189620                                                                  19100199
191200         EVALUATE TRUE                                            19120000
191300             WHEN SQLCODE = -811                                  19130000
191310             WHEN SQLCODE = ZERO                                  19131000
191320                 CONTINUE                                         19132000
191330             WHEN SQLCODE = +100                                  19133000
191340                 MOVE SPACES TO EXTENT-SCAC-CDE                           
191350                 MOVE SPACES TO ENTNME-ENT-NAME-DESC              19135000
191360                 CONTINUE                                         19136000
191370             WHEN OTHER                                           19137000
191380                 MOVE '4330-SELECT-SCAC'                          19138000
191390                                   TO DP013-PARAGRAPH             19139000
191400                 MOVE 'SQL ERROR SELECTING ENTNME SCAC'           19140000
191500                                   TO DP013-MESSAGE-TEXT (1)      19150000
191600                 MOVE SQLCA        TO DP013-SQLCA                 19160000
191700                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    19170000
191800                 SET DP013-DB2-ABEND                              19180000
191900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19190000
192000                 PERFORM DP013-0000-PROCESS-ABEND                 19200000
192100         END-EVALUATE.                                            19210000
192200                                                                  19220000
195100 EJECT                                                            19510000
195200******************************************************************19520000
195300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19530000
195400******************************************************************19540000
195600 4400-MOVE-COMMAREA-TO-SCREEN.                                    19560000
195610                                                                          
195700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19570000
195800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19580000
195900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19590000
196000             MOVE +1    TO ASC-BLK-SUB                            19600000
196100             PERFORM 5100-WRITE-TEMP-STORAGE                      19610000
196200             ADD +1     TO ASC-BLK-SUB                            19620000
196300             PERFORM 5100-WRITE-TEMP-STORAGE                      19630000
196400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19640000
196500                 GIVING PV-BLOCK-NUMBER                           19650000
196600                 REMAINDER PV-REMAINDER                           19660000
196700             IF  PV-REMAINDER > ZERO                              19670000
196800                 ADD +1 TO PV-BLOCK-NUMBER                        19680000
196900             END-IF                                               19690000
197000             MOVE +1    TO ASC-BLK-SUB                            19700000
197100             PERFORM 4410-READ-TEMP-STORAGE                       19710000
197200             ADD +1     TO ASC-BLK-SUB                            19720000
197300                           PV-BLOCK-NUMBER                        19730000
197400             PERFORM 4410-READ-TEMP-STORAGE                       19740000
197500     END-IF.                                                      19750000
197600     MOVE +1            TO ASC-BLK-SUB.                           19760000
197700     COMPUTE ASC-ITEM-SUB =                                       19770000
197800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19780000
197900         + PC-ITEMS-PER-PANEL).                                   19790000
198000*                                                                 19800000
198100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19810000
198200         ADD +1         TO ASC-BLK-SUB                            19820000
198300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19830000
198400     END-IF.                                                      19840000
198500*                                                                 19850000
198600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19860000
198700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19870000
198800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19880000
198900     PERFORM 4420-FORMAT-LIST-LINES                               19890000
199000         VARYING PV-SUB                                           19900000
199100         FROM PC-ITEMS-PER-PANEL BY -1                            19910000
199200         UNTIL PV-SUB < +1.                                       19920000
199300*                                                                 19930000
199400     COMPUTE ASC-ITEMS-DISPLAYED =                                19940000
199500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19950000
199600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19960000
199700                                      ASTRTITO.                   19970000
199800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19980000
199900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19990000
200000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20000000
200100                                   TO ASELITO.                    20010000
200300*                                                                 20030000
200400     IF  DP020-MSG-NUMBER-X = SPACE                               20040000
200500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20050000
200600*            --- MORE ITEMS TO DISPLAY ----                       20060000
200700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20070000
200800             SET DP020-MSG-INFORMATIONAL TO TRUE                  20080000
200900         END-IF                                                   20090000
201000     IF ASC-KEY-POE-STAT = 'I' MOVE                               20100004
201100         PC-TSYMSG-01645  TO DP020-MSG-NUMBER                     20110000
201200             SET DP020-MSG-INFORMATIONAL TO TRUE                  20120000
201300     END-IF                                                       20130000
201400     END-IF.                                                      20140000
201500******************************************************************20150000
201600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20160000
201700******************************************************************20170000
201900 4410-READ-TEMP-STORAGE.                                          20190000
202000                                                                  20200000
202100     EXEC CICS                                                    20210000
202200         READQ TS                                                 20220000
202300             QUEUE (ASC-LIST-QUEUE-NAME)                          20230000
202400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20240000
202500             ITEM  (PV-BLOCK-NUMBER)                              20250000
202600             RESP  (PV-CICS-RESP)                                 20260000
202700     END-EXEC.                                                    20270000
202800                                                                  20280000
202900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20290000
203000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20300000
203100         CONTINUE                                                 20310000
203200     ELSE                                                         20320000
203300         SET DP013-CICS-ABEND     TO TRUE                         20330000
203400         SET DP013-NO-ROLLBACK    TO TRUE                         20340000
203500         MOVE '4410-READ-TEMP-STORAGE'                            20350000
203600                                  TO DP013-PARAGRAPH              20360000
203700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20370000
203800                                  TO DP013-MESSAGE-TEXT(1)        20380000
203900         PERFORM DP013-0000-PROCESS-ABEND                         20390000
204000     END-IF.                                                      20400000
204100                                                                  20410000
204200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20420000
204300                                                                  20430000
204400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20440000
204500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20450000
204600     END-IF.                                                      20460000
204700 EJECT                                                            20470000
204800******************************************************************20480000
204900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20490000
205000******************************************************************20500000
205200 4420-FORMAT-LIST-LINES.                                          20520000
205300                                                                  20530000
205400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20540000
205500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20550000
205600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20560000
205700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20570000
205800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           20580000
205900                                                                  20590000
206000         MOVE SPACE              TO MR-CITY-NAME (PV-SUB)         20600000
206100                                    MR-POE-CODE (PV-SUB)          20610005
206110                                    MR-ALLOWED-ON-PO (PV-SUB)             
206120                                    MR-TRIP-TYPE (PV-SUB)                 
206130                                    MR-IATA-CODE (PV-SUB)                 
206200                                    MR-EDI-CODE (PV-SUB)          20620000
206300                                    MR-STATE-CODE (PV-SUB)        20630005
206400                                    MR-POE-NAME (PV-SUB)          20640005
206500                                    MR-DCONSL-SCAC (PV-SUB)       20650005
206800     ELSE                                                         20680000
206900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20690000
207000                                                   > SPACE        20700000
207100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20710000
207200                                 TO MR-SELECTI (PV-SUB)           20720000
207400         ELSE                                                     20740000
207500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20750000
207600                                 TO MR-SELECTI (PV-SUB)           20760000
207700         END-IF                                                   20770000
207800                                                                  20780000
207900         IF  DP030-SET-CURSOR-TRAILER                             20790000
208000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20800000
208100                 > SPACE)                                         20810000
208200               OR (PV-SUB = 1))                                   20820000
208300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20830000
208400                MOVE -1          TO MR-SELECTL (PV-SUB)           20840000
208500             END-IF                                               20850000
208600         END-IF                                                   20860000
208700*                                                                 20870000
208800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20880000
208900             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           20890000
209000                                 TO MR-ACTION (PV-SUB)            20900000
209100             MOVE ASC-POE-CODE (ASC-BLK-SUB ASC-ITEM-SUB)         20910005
209200                                 TO MR-POE-CODE (PV-SUB)          20920005
209210             MOVE ASC-ALLOWED-ON-PO (ASC-BLK-SUB ASC-ITEM-SUB)            
209220                                 TO MR-ALLOWED-ON-PO (PV-SUB)             
209230             MOVE ASC-TRIP-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)             
209240                                 TO MR-TRIP-TYPE (PV-SUB)                 
209250             MOVE ASC-IATA-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)        20910005
209260                                 TO MR-IATA-CODE (PV-SUB)                 
209300             MOVE ASC-POE-STD-EDI-CDE(ASC-BLK-SUB ASC-ITEM-SUB)   20930005
209301                                 TO MR-EDI-CODE (PV-SUB)          20930105
209310             MOVE ASC-POE-CODE-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)   20931005
209320                                 TO MR-POE-NAME (PV-SUB)          20932005
209500             MOVE ASC-POE-CITY-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)   20950005
209600                                 TO MR-CITY-NAME (PV-SUB)         20960000
209700             MOVE ASC-POE-STATE-CODE (ASC-BLK-SUB ASC-ITEM-SUB)   20970005
209800                                 TO MR-STATE-CODE (PV-SUB)        20980005
210010             MOVE ASC-DCONSLR-SCAC   (ASC-BLK-SUB ASC-ITEM-SUB)   21060099
210100                                 TO MR-DCONSL-SCAC (PV-SUB)       21070099
210500         END-IF                                                   21050000
210600     END-IF.                                                      21060000
210610                                                                          
210700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               21070000
210710                                                                          
210800     IF  ASC-ITEM-SUB < + 1                                       21080000
210900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21090000
211000         MOVE +1                 TO ASC-BLK-SUB                   21100000
211100     END-IF.                                                      21110000
211110                                                                          
211200******************************************************************21120000
211300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21130000
211400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21140000
211500** ISSUE A WARNING.                                             **21150000
211600******************************************************************21160000
211700 4430-CHECK-FOR-BEGIN-AND-END.                                    21170000
211710                                                                          
211800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21180000
211900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21190000
212000*            -- NO END-OF-RANGE SPECFIED ---                      21200000
212100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21210000
212200             SET DP020-MSG-WARNING TO TRUE                        21220000
212300             PERFORM 4431-POSITION-AT-WARNING                     21230000
212400         END-IF                                                   21240000
212500     ELSE                                                         21250000
212600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21260000
212700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21270000
212800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21280000
212900             SET DP020-MSG-WARNING TO TRUE                        21290000
213000             PERFORM 4431-POSITION-AT-WARNING                     21300000
213100         END-IF                                                   21310000
213200     END-IF.                                                      21320000
213210                                                                          
213300******************************************************************21330000
213400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21340000
213500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21350000
213600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21360000
213700** POSITION THE CURSOR THERE.                                   **21370000
213800******************************************************************21380000
213900 4431-POSITION-AT-WARNING.                                        21390000
213910                                                                          
214000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21400000
214100                    - PV-TOP-ITEM + 1.                            21410000
214200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21420000
214300         CONTINUE                                                 21430000
214400     ELSE                                                         21440000
214500         SET DP030-SET-CURSOR-APPL-1                              21450000
214600                                   TO TRUE                        21460000
214700         MOVE -1                   TO MR-SELECTL (PV-SUB)         21470000
214800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21480000
214900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21490000
215000     END-IF.                                                      21500000
215100                                                                  21510000
215200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21520000
215300                    - PV-TOP-ITEM + 1.                            21530000
215400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21540000
215500         CONTINUE                                                 21550000
215600     ELSE                                                         21560000
215700         SET DP030-SET-CURSOR-APPL-1                              21570000
215800                                   TO TRUE                        21580000
215900         MOVE -1                   TO MR-SELECTL (PV-SUB)         21590000
216000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21600000
216100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21610000
216200     END-IF.                                                      21620000
216300 EJECT                                                            21630000
216400******************************************************************21640000
216500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21650000
216600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21660000
216700* FOR THE SELECTED ITEMS QUEUE.                                  *21670000
216800*                                                                *21680000
216900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21690000
217000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21700000
217100* THE ARRAY IS FULL.                                             *21710000
217200******************************************************************21720000
217400 5000-PREPARE-SEL-QUEUE.                                          21740000
217500                                                                  21750000
217600     MOVE +1                   TO  ASC-BLK-SUB.                   21760000
217700     PERFORM 5100-WRITE-TEMP-STORAGE.                             21770000
217800     ADD +1                    TO  ASC-BLK-SUB.                   21780000
217900     PERFORM 5100-WRITE-TEMP-STORAGE.                             21790000
218000                                                                  21800000
218100     MOVE ASC-SEL-QUEUE-NAME  TO  TR022-SEL-QUEUE-NAME.           21810003
218200                                                                  21820000
218300     PERFORM 6010-DELETE-SEL-QUEUE.                               21830000
218400                                                                  21840000
218500     SET ASC-UPDATE-TSQ        TO  TRUE.                          21850000
218600                                                                  21860000
218700     SET TR023-IDX             TO  1.                             21870003
218800     MOVE ZERO                 TO TR022-NUMBER-OF-TS-ITEMS.       21880003
218900     INITIALIZE TR023-SELECTED-ITEM-ARRAY.                        21890003
219000                                                                  21900000
219100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21910000
219200             VARYING PV-ITEM                                      21920000
219300             FROM 1 BY 1                                          21930000
219400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21940000
219500                                                                  21950000
219600     IF  TR023-IDX > 1                                            21960003
219700         PERFORM 5205-WRITE-SEL-QUEUE                             21970000
219800         ADD +1                TO TR022-NUMBER-OF-TS-ITEMS        21980003
219900     END-IF.                                                      21990000
220000 EJECT                                                            22000000
220100******************************************************************22010000
220200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22020000
220300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22030000
220400******************************************************************22040000
220600 5100-WRITE-TEMP-STORAGE.                                         22060000
220610                                                                          
220700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22070000
220800                                   TO PV-LIST-ITEM-NUMBER.        22080000
220900     COMPUTE PV-BLOCK-NUMBER =                                    22090000
221000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22100000
221100                                                                  22110000
221200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22120000
221300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22130000
221400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22140000
221500             PERFORM 5105-REWRITE-ASC-LISTQ                       22150000
221600         END-IF                                                   22160000
221700     ELSE                                                         22170000
221800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22180000
221900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22190000
222000         PERFORM 5110-WRITE-ASC-LISTQ                             22200000
222100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22210000
222200     END-IF.                                                      22220000
222300                                                                  22230000
222400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22240000
222410                                                                          
222500******************************************************************22250000
222600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22260000
222700** SPECIFIC COMMAREA.                                           **22270000
222800******************************************************************22280000
222900 5105-REWRITE-ASC-LISTQ.                                          22290000
222910                                                                          
223000     EXEC CICS                                                    22300000
223100         WRITEQ TS                                                22310000
223200             QUEUE (ASC-LIST-QUEUE-NAME)                          22320000
223300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22330000
223400             ITEM  (PV-BLOCK-NUMBER)                              22340000
223500             REWRITE                                              22350000
223600             RESP  (PV-CICS-RESP)                                 22360000
223700     END-EXEC.                                                    22370000
223800                                                                  22380000
223900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22390000
224000         CONTINUE                                                 22400000
224100     ELSE                                                         22410000
224200         SET DP013-CICS-ABEND            TO TRUE                  22420000
224300         SET DP013-NO-ROLLBACK           TO TRUE                  22430000
224400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22440000
224500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22450000
224600                                         TO DP013-MESSAGE-TEXT(1) 22460000
224700         PERFORM DP013-0000-PROCESS-ABEND                         22470000
224800     END-IF.                                                      22480000
224900                                                                  22490000
225000******************************************************************22500000
225100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22510000
225200** SPECIFIC COMMAREA.                                           **22520000
225300******************************************************************22530000
225400 5110-WRITE-ASC-LISTQ.                                            22540000
225410                                                                          
225500     EXEC CICS                                                    22550000
225600         WRITEQ TS                                                22560000
225700             QUEUE (ASC-LIST-QUEUE-NAME)                          22570000
225800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22580000
225900             ITEM  (PV-BLOCK-NUMBER)                              22590000
226000             RESP  (PV-CICS-RESP)                                 22600000
226100     END-EXEC.                                                    22610000
226200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22620000
226300         SET DP013-CICS-ABEND      TO TRUE                        22630000
226400         SET DP013-NO-ROLLBACK     TO TRUE                        22640000
226500         MOVE '5110-WRITE-ASC-LISTQ'                              22650000
226600                                   TO DP013-PARAGRAPH             22660000
226700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22670000
226800                                   TO DP013-MESSAGE-TEXT(1)       22680000
226900         PERFORM DP013-0000-PROCESS-ABEND                         22690000
227000     END-IF.                                                      22700000
227100 EJECT                                                            22710000
227200******************************************************************22720000
227300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22730000
227400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22740000
227500******************************************************************22750000
227700 5200-FILL-SEL-QUEUE-RECORD.                                      22770000
227800                                                                  22780000
227900     PERFORM 6112-READ-LIST-QUEUE.                                22790000
228000                                                                  22800000
228100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22810000
228200         PERFORM                                                  22820000
228300         VARYING LQW-IDX                                          22830000
228400         FROM 1 BY 1                                              22840000
228500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22850000
228600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22860000
228700                                                                  22870000
228800             IF  LQW-SELECT (LQW-IDX)                             22880000
228900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22890000
229000                                   TO TR023-ITEM (TR023-IDX)      22900005
229100                 MOVE LQW-POE-CODE (LQW-IDX)                      22910005
229200                            TO TR023-POE-CODE (TR023-IDX)         22920005
229300                               TR022-POE-CODE                     22930005
229310                 MOVE LQW-ALLOWED-ON-PO (LQW-IDX)                         
229320                            TO TR023-ALLOWED-ON-PO (TR023-IDX)            
229330                               TR022-ALLOWED-ON-PO                        
229340                 MOVE LQW-TRIP-TYP-CDE (LQW-IDX)                          
229350                            TO TR023-TRIP-TYP-CDE (TR023-IDX)             
229360                               TR022-TRIP-TYP-CDE                         
229370                 MOVE LQW-IATA-CDE (LQW-IDX)                              
229380                            TO TR023-IATA-CDE (TR023-IDX)                 
229390                               TR022-IATA-CDE                             
229400                 MOVE LQW-POE-CODE-DESC (LQW-IDX)                         
229500                            TO TR023-POE-NAME (TR023-IDX)                 
229600                               TR022-POE-CODE-DESC                        
230000                 MOVE LQW-POE-CITY-NAME (LQW-IDX)                 23000005
230100                            TO TR023-POE-CITY-NAME (TR023-IDX)    23010005
230200                               TR022-POE-CITY-NAME                23020005
230210                 MOVE LQW-POE-STATE-CODE (LQW-IDX)                23021005
230220                            TO TR023-POE-STATE-CODE (TR023-IDX)   23022005
230230                               TR022-POE-STATE-CODE               23023005
230600                 MOVE LQW-DCONSLR-ENT-ID (LQW-IDX)                23060005
230700                            TO TR023-DCONSLR-ENT-ID (TR023-IDX)   23070005
230800                               TR022-DCONSLR-ENT-ID               23080005
230900                 MOVE LQW-DCONSLR-SCAC (LQW-IDX)                          
231000                            TO TR023-DCONSLR-SCAC (TR023-IDX)             
231100                               TR022-DCONSLR-SCAC                         
231800                 MOVE LQW-POE-STD-EDI-CDE (LQW-IDX)                       
231900                            TO TR023-POE-STD-EDI-CDE (TR023-IDX)          
232000                               TR022-POE-STD-EDI-CDE              23200005
232100*                                                                 23210000
232200                 MOVE SPACE        TO TR023-ACTION-SW (TR023-IDX) 23220003
232300                 SET TR023-IDX UP BY 1                            23230003
232400                 IF  TR023-IDX > TR023-MAX-ITEMS                  23240003
232500                     PERFORM 5205-WRITE-SEL-QUEUE                 23250000
232600                     ADD +1        TO TR022-NUMBER-OF-TS-ITEMS    23260003
232700                     INITIALIZE TR023-SELECTED-ITEM-ARRAY         23270003
232800                     SET TR023-IDX TO  1                          23280003
232900                     CONTINUE                                     23290000
233000                 END-IF                                           23300000
233100             END-IF                                               23310000
233200         END-PERFORM                                              23320000
233300     END-IF.                                                      23330000
233400                                                                  23340000
233500******************************************************************23350000
233600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23360000
233700******************************************************************23370000
233900 5205-WRITE-SEL-QUEUE.                                            23390000
234000                                                                  23400000
234100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23410000
234200                                   TO TR023-SELECTED-ITEMS.       23420003
234400     EXEC CICS                                                    23440000
234500          WRITEQ TS                                               23450000
234600              QUEUE (ASC-SEL-QUEUE-NAME)                          23460000
234700              FROM  (TR023-POE-SEL-REC)                           23470003
234800              ITEM  (PV-SEL-QUEUE-ITEM)                           23480000
234900              RESP  (PV-CICS-RESP)                                23490000
235000     END-EXEC.                                                    23500000
235100                                                                  23510000
235200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23520000
235300         CONTINUE                                                 23530000
235400     ELSE                                                         23540000
235500         SET DP013-CICS-ABEND      TO TRUE                        23550000
235600         SET DP013-NO-ROLLBACK     TO TRUE                        23560000
235700         MOVE '5205-WRITE-SEL-QUEUE'                              23570000
235800                                   TO DP013-PARAGRAPH             23580000
235900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23590000
236000                                   TO DP013-MESSAGE-TEXT(1)       23600000
236100         PERFORM DP013-0000-PROCESS-ABEND                         23610000
236200     END-IF.                                                      23620000
236300 EJECT                                                            23630000
236400******************************************************************23640000
236500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23650000
236600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23660000
236700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23670000
236800** THE USER.                                                    **23680000
236900******************************************************************23690000
237000 6000-REFRESH-PANEL-FROM-TEMP.                                    23700000
237010                                                                          
237100     IF  ASC-UPDATE-TSQ                                           23710000
237200         SET ASC-NO-TSQ-UPDATE TO TRUE                            23720000
237300         MOVE ZERO                 TO PV-SAVE-ITEM                23730000
237400                                      PV-SEL-QUEUE-ITEM           23740000
237500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23750000
237600                                   TO PV-HOLD-SELECTED-ITEMS      23760000
237700         MOVE +1                   TO PV-ITEMS-PROCESSED          23770000
237800         PERFORM 6100-UPDATE-TSQ                                  23780000
237900             UNTIL PV-ITEMS-PROCESSED >                           23790000
238000                                     PV-HOLD-SELECTED-ITEMS       23800000
238100         PERFORM 6010-DELETE-SEL-QUEUE                            23810000
238200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23820000
238300                    ASC-BLOCK-ENTRIES (2)                         23830000
238400     END-IF.                                                      23840000
238500                                                                  23850000
238600******************************************************************23860000
238700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23870000
238800******************************************************************23880000
238900 6010-DELETE-SEL-QUEUE.                                           23890000
239000                                                                  23900000
239100     EXEC CICS                                                    23910000
239200         DELETEQ TS                                               23920000
239300             QUEUE (ASC-SEL-QUEUE-NAME)                           23930000
239400             RESP  (PV-CICS-RESP)                                 23940000
239500     END-EXEC.                                                    23950000
239600                                                                  23960000
239700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23970000
239800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23980000
239900         CONTINUE                                                 23990000
240000     ELSE                                                         24000000
240100         SET DP013-CICS-ABEND TO TRUE                             24010000
240200         SET DP013-NO-ROLLBACK TO TRUE                            24020000
240300         MOVE '6010-DELETE-SEL-QUEUE'                             24030000
240400                        TO DP013-PARAGRAPH                        24040000
240500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24050000
240600                        TO DP013-MESSAGE-TEXT (1)                 24060000
240700         PERFORM DP013-0000-PROCESS-ABEND                         24070000
240800     END-IF.                                                      24080000
240900                                                                  24090000
241000******************************************************************24100000
241100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24110000
241200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24120000
241300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24130000
241400*    THE TEMP QUEUE.                                             *24140000
241500******************************************************************24150000
241700 6100-UPDATE-TSQ.                                                 24170000
241800                                                                  24180000
241900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24190000
242000     PERFORM 6105-READ-SEL-QUEUE.                                 24200000
242100     PERFORM                                                      24210000
242200         VARYING TR023-IDX                                        24220003
242300         FROM 1 BY 1                                              24230000
242400         UNTIL ((PV-ITEMS-PROCESSED >                             24240000
242500                              PV-HOLD-SELECTED-ITEMS)             24250000
242600         OR (TR023-IDX GREATER THAN TR023-MAX-ITEMS))             24260003
242700         IF  TR023-ACTION-SW (TR023-IDX) > SPACE                  24270003
242800             PERFORM 6110-PROCESS-ITEMS                           24280000
242900         END-IF                                                   24290000
243000         ADD +1                TO PV-ITEMS-PROCESSED              24300000
243100     END-PERFORM.                                                 24310000
243200     PERFORM 6111-WRITE-LIST-QUEUE.                               24320000
243210                                                                          
243300******************************************************************24330000
243400*    READ THE LIST QUEUE RECORD.                                 *24340000
243500******************************************************************24350000
243700 6105-READ-SEL-QUEUE.                                             24370000
243800                                                                  24380000
243900     EXEC CICS                                                    24390000
244000          READQ TS                                                24400000
244100              QUEUE (ASC-SEL-QUEUE-NAME)                          24410000
244200              INTO  (TR023-POE-SEL-REC)                           24420003
244300              ITEM  (PV-SEL-QUEUE-ITEM)                           24430000
244400              RESP  (PV-CICS-RESP)                                24440000
244500     END-EXEC.                                                    24450000
244600                                                                  24460000
244700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24470000
244800         CONTINUE                                                 24480000
244900     ELSE                                                         24490000
245000         SET DP013-CICS-ABEND      TO  TRUE                       24500000
245100         SET DP013-NO-ROLLBACK     TO  TRUE                       24510000
245200         MOVE '6105-READ-SEL-QUEUE'                               24520000
245300                                   TO  DP013-PARAGRAPH            24530000
245400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24540000
245500                                   TO  DP013-MESSAGE-TEXT(1)      24550000
245600         PERFORM DP013-0000-PROCESS-ABEND                         24560000
245700     END-IF.                                                      24570000
245800 EJECT                                                            24580000
245900******************************************************************24590000
246000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24600000
246100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24610000
246200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24620000
246300******************************************************************24630000
246500 6110-PROCESS-ITEMS.                                              24650000
246600                                                                  24660000
246700     COMPUTE PV-ITEM = 1 + ((TR023-ITEM (TR023-IDX) - 1)          24670003
246800                     / PC-ITEMS-PER-PANEL).                       24680000
246900                                                                  24690000
247000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24700000
247100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24710000
247200             PERFORM 6111-WRITE-LIST-QUEUE                        24720000
247300         END-IF                                                   24730000
247400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24740000
247500                                                                  24750000
247600         PERFORM 6112-READ-LIST-QUEUE                             24760000
247700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24770000
247800             CONTINUE                                             24780000
247900         END-IF                                                   24790000
248000     END-IF.                                                      24800000
248100                                                                  24810000
248200     COMPUTE PV-SUB = (TR023-ITEM (TR023-IDX)                     24820003
248300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24830000
248400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24840000
248500     MOVE LQW-SELECTED-SW (PV-SUB)                                24850000
248600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24860000
248700     EVALUATE TRUE                                                24870000
248800         WHEN TR023-INQ (TR023-IDX)                               24880003
248900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24890000
249000                                                                  24900000
249100         WHEN TR023-UPD (TR023-IDX)                               24910003
249200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24920000
249300              MOVE TR022-POE-CODE TO                              24930005
249400                             LQW-POE-CODE (PV-SUB)                24940005
249500              MOVE TR022-ALLOWED-ON-PO TO                                 
249600                             LQW-ALLOWED-ON-PO (PV-SUB)                   
249700              MOVE TR022-TRIP-TYP-CDE TO                                  
249710                             LQW-TRIP-TYP-CDE (PV-SUB)                    
249720              MOVE TR022-IATA-CDE TO                                      
249730                             LQW-IATA-CDE (PV-SUB)                        
249800              MOVE TR022-POE-CODE-DESC TO                                 
249900                             LQW-POE-CODE-DESC (PV-SUB)                   
250200              MOVE TR022-POE-CITY-NAME TO                                 
250300                             LQW-POE-CITY-NAME (PV-SUB)           25030005
250400              MOVE TR022-POE-STATE-CODE TO                        25040005
250500                             LQW-POE-STATE-CODE (PV-SUB)          25050005
250600              MOVE TR022-DCONSLR-ENT-ID TO                        25060005
250700                             LQW-DCONSLR-ENT-ID (PV-SUB)          25070005
251000              MOVE TR022-POE-STD-EDI-CDE TO                       25100005
251100                             LQW-POE-STD-EDI-CDE (PV-SUB)         25110005
251400              MOVE TR022-DCONSLR-SCAC TO                          25120005
251500                             LQW-DCONSLR-SCAC (PV-SUB)            25130005
251600                                                                  25160000
251700         WHEN TR023-DEL (TR023-IDX)                               25170003
251800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25180000
251900                                                                  25190000
252000         WHEN TR023-ERR (TR023-IDX)                               25200003
252100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25210000
252200     END-EVALUATE.                                                25220000
252300                                                                  25230000
252400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25240000
252500                                                                  25250000
252600******************************************************************25260000
252700*    WRITE THE TS QUEUE RECORD JUST UPDATED.                     *25270000
252800******************************************************************25280000
253000 6111-WRITE-LIST-QUEUE.                                           25300000
253100                                                                  25310000
253200     EXEC CICS                                                    25320000
253300         WRITEQ TS                                                25330000
253400             QUEUE (ASC-LIST-QUEUE-NAME)                          25340000
253500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25350000
253600             ITEM  (PV-SAVE-ITEM)                                 25360000
253700             REWRITE                                              25370000
253800             RESP  (PV-CICS-RESP)                                 25380000
253900     END-EXEC.                                                    25390000
254000*                                                                 25400000
254100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25410000
254200         CONTINUE                                                 25420000
254300     ELSE                                                         25430000
254400         SET DP013-CICS-ABEND  TO  TRUE                           25440000
254500         SET DP013-NO-ROLLBACK TO  TRUE                           25450000
254600         MOVE '6111-WRITE-LIST-QUEUE'                             25460000
254700                               TO  DP013-PARAGRAPH                25470000
254800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25480000
254900                               TO  DP013-MESSAGE-TEXT(1)          25490000
255000         PERFORM DP013-0000-PROCESS-ABEND                         25500000
255100     END-IF.                                                      25510000
255200                                                                  25520000
255300 EJECT                                                            25530000
255400******************************************************************25540000
255500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25550000
255600******************************************************************25560000
255800 6112-READ-LIST-QUEUE.                                            25580000
255900                                                                  25590000
256000     EXEC CICS                                                    25600000
256100         READQ TS                                                 25610000
256200             QUEUE (ASC-LIST-QUEUE-NAME)                          25620000
256300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25630000
256400             ITEM  (PV-ITEM)                                      25640000
256500             RESP  (PV-CICS-RESP)                                 25650000
256600     END-EXEC.                                                    25660000
256700*                                                                 25670000
256800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25680000
256900         CONTINUE                                                 25690000
257000     ELSE                                                         25700000
257100         SET DP013-CICS-ABEND        TO TRUE                      25710000
257200         SET DP013-NO-ROLLBACK       TO TRUE                      25720000
257300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25730000
257400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25740000
257500                                     TO DP013-MESSAGE-TEXT(1)     25750000
257600         PERFORM DP013-0000-PROCESS-ABEND                         25760000
257700     END-IF.                                                      25770000
257800                                                                  25780000
257900 EJECT                                                            25790000
258000******************************************************************25800000
258100*    ABEND PROCESSOR MODULE                                      *25810000
258200******************************************************************25820000
258400     COPY DPPD013.                                                25840000
