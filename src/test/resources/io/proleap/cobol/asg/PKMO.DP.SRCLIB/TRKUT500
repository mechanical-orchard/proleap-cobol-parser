000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    TRKUT500.                                         00050000
000600 AUTHOR.        BUDDY BARNES.                                     00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   APR 2011.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM EXTRACTS EVERY ROW IN TRT_VND_TRANS_RT.            00120000
001330******************************************************************00160000
001340******************************************************************00170000
001350 ENVIRONMENT DIVISION.                                            00180000
001360******************************************************************00190000
001370 CONFIGURATION SECTION.                                           00200000
001380 SOURCE-COMPUTER.        IBM-3090.                                00210000
001390 OBJECT-COMPUTER.        IBM-3090.                                00220000
001400                                                                  00230000
001500 INPUT-OUTPUT SECTION.                                            00240000
001600 FILE-CONTROL.                                                    00250000
002100     SELECT OUTPUT-FILE1                                          00300000
002200         ASSIGN TO OUT01.                                         00310000
002600                                                                  00350000
002700******************************************************************00360000
002800 DATA DIVISION.                                                   00370000
002900******************************************************************00380000
003000                                                                  00390000
003100 FILE SECTION.                                                    00400000
004100                                                                  00500000
004200 FD  OUTPUT-FILE1                                                 00510000
004300     RECORDING MODE IS F                                          00520000
004400     LABEL RECORDS ARE STANDARD                                   00530000
004500     RECORD CONTAINS 184                                          00540001
004510     BLOCK CONTAINS 0 RECORDS                                     00550000
004520     DATA RECORD IS OUTPUT-RECORD1.                               00560000
004530                                                                  00570000
004531 01  OUTPUT-RECORD1            PIC  X(184).                       00580001
004560******************************************************************00690000
004570 WORKING-STORAGE SECTION.                                         00700000
004580******************************************************************00710000
004590 01  PS-PROGRAM-SWITCHES.                                         00720000
005200     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00800000
005300         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00810000
005400         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.       00820000
005401                                                                  00890000
005402 01  PC-PROGRAM-CONSTANTS.                                        00900000
005403     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'TRKUT500'. 00910000
005404     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00920000
005419                                                                  01070000
005420 01  PV-PROGRAM-VARIABLES.                                        01080000
005422     05  PV-RECORDS-WRITTEN           PIC 9(09)  VALUE ZERO.      01100000
005423     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    01110000
005804                                                                  02120000
005805 01  PV-ABEND-FIELDS.                                             02130000
005806     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         02140000
005807                                                 COMP SYNC.       02150000
005808     05  PV-SQLCODE                   PIC  Z(08)9-.               02160000
005809     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02170000
005810     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    02180000
005811     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    02190000
005812     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    02200000
005813     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    02210000
005814     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    02220000
005815     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    02230000
005816     05  PV-DB2-TABLE-NAME            PIC X(12)  VALUE SPACE.     02240000
005550     05  PV-NULL-EFF-RT-END-DTE       PIC S9(4)   VALUE ZERO      02241003
005560                                                  COMP SYNC.      02242002
005550     05  PV-NULL-DCONSLR-SCAC-ID      PIC S9(4)   VALUE ZERO      02243003
005560                                                  COMP SYNC.      02244002
005550     05  PV-NULL-POE-STD-EDI-CDE      PIC S9(4)   VALUE ZERO      02245004
005560                                                  COMP SYNC.      02246002
005550     05  PV-NULL-FOB-STD-EDI-CDE      PIC S9(4)   VALUE ZERO      02247004
005560                                                  COMP SYNC.      02248003
005550     05  PV-NULL-EDI-CONTNR-SZ-TYP-CDE PIC S9(4)   VALUE ZERO     02249004
005560                                                  COMP SYNC.      02249103
005550     05  PV-NULL-CMDTY-TYP-GRP-CDE    PIC S9(4)   VALUE ZERO      02249204
005560                                                  COMP SYNC.      02249303
005550     05  PV-NULL-RT-WT-TYP-CDE        PIC S9(4)   VALUE ZERO      02249404
005560                                                 COMP SYNC.       02249504
005550     05  PV-NULL-UOM-CDE              PIC S9(4)   VALUE ZERO      02249604
005560                                                  COMP SYNC.      02249703
005550     05  PV-NULL-LAST-UPD-TMST        PIC S9(4)   VALUE ZERO      02249804
005560                                                  COMP SYNC.      02249903
005550     05  PV-NULL-LAST-UPD-USRID       PIC S9(4)   VALUE ZERO      02250004
005560                                                  COMP SYNC.      02251003
005817                                                                  02260003
005844******************************************************************02540000
005845*  DB2 FORMATTED MESSAGE AREA                                     02550000
005846******************************************************************02560000
005847     COPY DPWS004.                                                02570000
005848*                                                                 02580000
007529******************************************************************04150000
007530*    TRT_VND_TRANS_AMT (TRT00050)                                 04160000
007531******************************************************************04170000
007532     EXEC SQL                                                     04180000
007533          INCLUDE TRT00050                                        04190000
007534     END-EXEC.                                                    04200000
007535                                                                  04210000
007536******************************************************************04220000
007537*    CURSOR TO GET ASSOCIATES ON A TEAM ASSIGNMENT                04230000
007538******************************************************************04240000
007539                                                                  04250000
007540     EXEC SQL                                                     04260000
007550        DECLARE TRT-CURSOR CURSOR FOR                             04270000
007560         SELECT                                                   04280000
                     TRT.VND_TRANS_RT_ID                                04290000
                    ,TRT.VND_NBR                                        04300000
                    ,TRT.TRANS_RT_TYP_CDE                               04310000
                    ,TRT.EFF_RT_BEG_DTE                                 04320000
                    ,TRT.EFF_RT_END_DTE                                 04330000
                    ,TRT.DCONSLR_SCAC_ID                                04340000
                    ,TRT.POE_STD_EDI_CDE                                04341000
                    ,TRT.FOB_STD_EDI_CDE                                04342000
                    ,TRT.EDI_CONTNR_SZ_TYP_CDE                          04343000
                    ,TRT.CMDTY_TYP_GRP_CDE                              04345000
                    ,TRT.TRANS_RT_AMT                                   04346000
                    ,TRT.RT_WT_TYP_CDE                                  04347000
                    ,TRT.UOM_CDE                                        04348000
                    ,TRT.RT_BSS_MAX_QTY                                 04349000
007900              ,TRT.RT_BSS_MIN_QTY                                 04350000
008000              ,TRT.CRE_TMST                                       04360000
                    ,TRT.CRE_USRID                                      04361000
                    ,TRT.LAST_UPD_TMST                                  04362000
                    ,TRT.LAST_UPD_USRID                                 04363000
               FROM TRT_VND_TRANS_RT TRT                                04380000
               WITH UR                                                  04390006
008502     END-EXEC.                                                    04430000
007535                                                                  04440000
008504******************************************************************04630000
008505*  COMMUNICATIONS AREA FOR DB2                                    04640000
008506******************************************************************04650000
008507     EXEC SQL                                                     04660000
008508          INCLUDE SQLCA                                           04670000
008509     END-EXEC.                                                    04680000
008510                                                                  04690000
008520******************************************************************04700000
008530 PROCEDURE DIVISION.                                              04710000
008540******************************************************************04720000
008550 0000-PROGRAM-MAINLINE.                                           04730000
008560                                                                  04740000
008580     OPEN OUTPUT OUTPUT-FILE1.                                    04760000
008800                                                                  04800000
008900     PERFORM 1000-OPEN-CURSOR.                                    04810000
009000                                                                  04820000
009100     PERFORM 2000-FETCH-CURSOR                                    04830000
005300         UNTIL PS-END-OF-CURSOR.                                  04841000
009300                                                                  04841100
008900     PERFORM 3000-CLOSE-CURSOR.                                   04842000
009300                                                                  04850000
009400     PERFORM 9000-EOJ.                                            04860000
009500                                                                  04870000
009600     STOP RUN.                                                    04880000
009700                                                                  04890000
043015****************************************************************  25960000
043016*                                                              *  25970000
043017*                                                              *  25980000
043018****************************************************************  25990000
043019 1000-OPEN-CURSOR.                                                26000000
043020     MOVE '1000-OPEN-CURSOR'   TO PV-ABEND-PARAGRAPH.             26010000
043040                                                                  26030000
043050     PERFORM                                                      26040000
043060         WITH TEST AFTER                                          26050000
043070             VARYING PV-RETRY-COUNTER                             26060000
043080             FROM 1 BY 1                                          26070000
043090             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              26080000
043100                OR SQLCODE = ZERO                                 26090000
043200                                                                  26100000
043300         EXEC SQL                                                 26110000
043400              OPEN  TRT-CURSOR                                    26120000
043500         END-EXEC                                                 26130000
043600                                                                  26140000
043700         EVALUATE TRUE                                            26150000
043800             WHEN SQLCODE = ZERO                                  26160000
043900                  CONTINUE                                        26170000
044000                                                                  26180000
044100             WHEN SQLCODE = +100                                  26190000
044200             WHEN SQLCODE = -904                                  26200000
044300             WHEN SQLCODE = -913                                  26210000
044400             WHEN SQLCODE = -911                                  26220000
044500             WHEN SQLWARN0 NOT = SPACES                           26230000
044600             WHEN SQLCODE NOT = ZERO                              26240000
044700                  MOVE +4             TO PV-RETRY-COUNTER         26250000
044800         END-EVALUATE                                             26260000
044900     END-PERFORM.                                                 26270000
045000                                                                  26280000
045100     IF SQLCODE = ZERO                                            26290000
045200        CONTINUE                                                  26300000
045300     ELSE                                                         26310000
045400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26320000
045401         MOVE SQLCODE               TO PV-SQLCODE                 26330000
045402         MOVE 'CURSOR OPEN ERROR'   TO PV-DB2-OPERATION-MESSAGE-1 26340000
045403         MOVE 'TRT_VND_TRANS_RT'   TO PV-DB2-TABLE-NAME           26350000
045404         PERFORM 9999-SQL-ABEND                                   26360000
045405     END-IF.                                                      26370000
045406                                                                  26380000
045407****************************************************************  26390000
045408*                                                              *  26400000
045409*                                                              *  26410000
045410****************************************************************  26420000
045411 2000-FETCH-CURSOR.                                               26430000
045412     MOVE '2000-FETCH-CURSOR'             TO PV-ABEND-PARAGRAPH.  26440000
029200                                                                  26450005
045414     INITIALIZE DCLTRT00050.                                      26450105
029300     INITIALIZE                                                   26451005
005550         PV-NULL-EFF-RT-END-DTE                                   26454005
005550         PV-NULL-DCONSLR-SCAC-ID                                  26456005
005550         PV-NULL-POE-STD-EDI-CDE                                  26458005
005550         PV-NULL-FOB-STD-EDI-CDE                                  26459105
005550         PV-NULL-EDI-CONTNR-SZ-TYP-CDE                            26459305
005550         PV-NULL-CMDTY-TYP-GRP-CDE                                26459505
005550         PV-NULL-RT-WT-TYP-CDE                                    26459705
005550         PV-NULL-UOM-CDE                                          26459905
005550         PV-NULL-LAST-UPD-TMST                                    26460105
005550         PV-NULL-LAST-UPD-USRID.                                  26460305
                                                                        26461005
045415     PERFORM                                                      26470000
045416         WITH TEST AFTER                                          26480000
045417         VARYING PV-RETRY-COUNTER                                 26490000
045418         FROM 1 BY 1                                              26500000
045419         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  26510000
045420            OR SQLCODE = ZERO                                     26520000
045430            OR SQLCODE = +100                                     26530000
045440                                                                  26540000
045450         EXEC SQL                                                 26550000
045460             FETCH  TRT-CURSOR INTO                               26560000
                     :TRT00050-VND-TRANS-RT-ID                          26561000
                    ,:TRT00050-VND-NBR                                  26562000
                    ,:TRT00050-TRANS-RT-TYP-CDE                         26563000
                    ,:TRT00050-EFF-RT-BEG-DTE                           26564003
                    ,:TRT00050-EFF-RT-END-DTE  :PV-NULL-EFF-RT-END-DTE  26565003
                    ,:TRT00050-DCONSLR-SCAC-ID :PV-NULL-DCONSLR-SCAC-ID 26566003
                    ,:TRT00050-POE-STD-EDI-CDE :PV-NULL-POE-STD-EDI-CDE 26567003
                    ,:TRT00050-FOB-STD-EDI-CDE :PV-NULL-FOB-STD-EDI-CDE 26568003
                    ,:TRT00050-EDI-CONTNR-SZ-TYP-CDE                    26569000
                                     :PV-NULL-EDI-CONTNR-SZ-TYP-CDE     26569103
                    ,:TRT00050-CMDTY-TYP-GRP-CDE                        26569200
                                     :PV-NULL-CMDTY-TYP-GRP-CDE         26569303
                    ,:TRT00050-TRANS-RT-AMT                             26569400
                    ,:TRT00050-RT-WT-TYP-CDE   :PV-NULL-RT-WT-TYP-CDE   26569503
                    ,:TRT00050-UOM-CDE         :PV-NULL-UOM-CDE         26569603
                    ,:TRT00050-RT-BSS-MAX-QTY                           26569700
                    ,:TRT00050-RT-BSS-MIN-QTY                           26569800
                    ,:TRT00050-CRE-TMST                                 26569900
                    ,:TRT00050-CRE-USRID                                26570000
                    ,:TRT00050-LAST-UPD-TMST   :PV-NULL-LAST-UPD-TMST   26570103
                    ,:TRT00050-LAST-UPD-USRID  :PV-NULL-LAST-UPD-USRID  26571003
046100                                                                  26590000
046200         END-EXEC                                                 26600000
046300                                                                  26610000
046400         EVALUATE TRUE                                            26620000
046500             WHEN SQLCODE = ZERO                                  26630000
046600                  CONTINUE                                        26640000
046700                                                                  26650000
046800             WHEN SQLCODE = +100                                  26660000
046900                  SET PS-END-OF-CURSOR TO TRUE                    26670000
047000                                                                  26680000
047100             WHEN SQLCODE = -904                                  26690000
047200             WHEN SQLCODE = -911                                  26700000
047300             WHEN SQLCODE = -913                                  26710000
047400             WHEN SQLWARN0 NOT = SPACES                           26720000
047500             WHEN SQLCODE NOT = ZERO                              26730000
047600                  MOVE +4             TO PV-RETRY-COUNTER         26740000
047700         END-EVALUATE                                             26750000
047800     END-PERFORM.                                                 26760000
047900                                                                  26770000
047901     IF SQLCODE = ZERO                                            26780000
047902         PERFORM 4000-WRITE-OUTPUT-FILE                           26790000
048123     ELSE                                                         26800000
048124     IF SQLCODE = +100                                            26810000
048125        CONTINUE                                                  26820000
048126     ELSE                                                         26830000
048127     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26840000
036108         MOVE SQLCODE               TO PV-SQLCODE                 26850000
036109         MOVE 'CURSOR FETCH ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 26860000
036110         MOVE 'TRT_VND_TRANS_RT'    TO PV-DB2-TABLE-NAME          26870000
036115         PERFORM 9999-SQL-ABEND                                   26980000
048150     END-IF.                                                      26990000
048160                                                                  27000000
048170****************************************************************  27010000
048180*                                                              *  27020000
048190*                                                              *  27030000
048200****************************************************************  27040000
048201 3000-CLOSE-CURSOR.                                               27050000
048202     MOVE '3000-CLOSE-CURSOR'   TO PV-ABEND-PARAGRAPH.            27060000
048204                                                                  27080000
048205     PERFORM                                                      27090000
048206         WITH TEST AFTER                                          27100000
048207         VARYING PV-RETRY-COUNTER                                 27110000
048208         FROM 1 BY 1                                              27120000
048209         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  27130000
048210            OR SQLCODE = ZERO                                     27140000
048220                                                                  27150000
048230         EXEC SQL                                                 27160000
048240              CLOSE TRT-CURSOR                                    27170000
048250         END-EXEC                                                 27180000
048260                                                                  27190000
048270         EVALUATE TRUE                                            27200000
048280             WHEN SQLCODE = ZERO                                  27210000
048290                  CONTINUE                                        27220000
048300                                                                  27230000
048400             WHEN SQLCODE = -904                                  27240000
048500             WHEN SQLCODE = -913                                  27250000
048600             WHEN SQLCODE = -911                                  27260000
048700             WHEN SQLCODE = +100                                  27270000
048800             WHEN SQLWARN0 NOT = SPACES                           27280000
048900             WHEN SQLCODE NOT = ZERO                              27290000
049000                  MOVE +4             TO PV-RETRY-COUNTER         27300000
049100         END-EVALUATE                                             27310000
049200     END-PERFORM.                                                 27320000
049300                                                                  27330000
049400     IF SQLCODE = ZERO                                            27340000
049500        CONTINUE                                                  27350000
049600     ELSE                                                         27360000
049700        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      27370000
049701         MOVE SQLCODE               TO PV-SQLCODE                 27380000
049702         MOVE 'CURSOR CLOSE ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 27390000
049703         MOVE 'TRT_VND_TRANS_RT'    TO PV-DB2-TABLE-NAME          27400000
049704         PERFORM 9999-SQL-ABEND                                   27410000
049705        END-IF                                                    27420000
049706     END-IF.                                                      27430000
035520                                                                  27440000
050903******************************************************************28070000
050904* WRITES THE APPROPRIATE OUTPUT RECORDS                          *28080000
050905******************************************************************28090000
050906 4000-WRITE-OUTPUT-FILE.                                          28100000
050908     MOVE '4000-WRITE-OUTPUT-FILE.'  TO PV-ABEND-PARAGRAPH.       28120000
050910                                                                  28140000
050912     WRITE OUTPUT-RECORD1                                         28160000
050913             FROM DCLTRT00050                                     28170000
050919     ADD  1  TO  PV-RECORDS-WRITTEN.                              28270000
050920                                                                  28280000
050921 9000-EOJ.                                                        28290000
050923                                                                  28310000
050925     CLOSE OUTPUT-FILE1.                                          28330000
050927                                                                  28350000
050929     DISPLAY ' RECORDS WRITTEN = ' PV-RECORDS-WRITTEN.            28370000
050930                                                                  28380000
050931******************************************************************28390000
050932* ABEND PROCEDURE                                                *28400000
050933******************************************************************28410000
050934 9999-SQL-ABEND.                                                  28420000
050935     DISPLAY '** ABEND           ** = SQLABEND'.                  28430000
050936     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          28440000
050937     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       28450000
050938     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        28460000
050939     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE-128470000
050940     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-228480000
050941     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               28490000
050942     COPY DPPD004.                                                28500000
050943     MOVE +4013                  TO PV-ABEND-CODE.                28510000
050944     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       28520000
050945                                                                  28530000
