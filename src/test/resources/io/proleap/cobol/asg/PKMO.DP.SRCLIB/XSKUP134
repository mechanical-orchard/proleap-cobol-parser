000100*----------------------------------------------------------       00000100
000200 IDENTIFICATION DIVISION.                                         00000200
000300*----------------------------------------------------------       00000300
000400 PROGRAM-ID.    XSKUP134.                                         00000400
000500 AUTHOR.        CHERI PARMLEY.                                    00000500
000600 DATE-WRITTEN.  APRIL 16, 2010.                                   00000600
000700                                                                  00000700
000800*----------------------------------------------------------       00000800
000900*              REBATE BUSINESS EVENT LOADER                       00000900
001000*----------------------------------------------------------       00001000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00001100
001020* LOAD FOR THE REBATE FORMS. THIS PROGRAM IS A MODULE AND         00001200
001030* WILL BE CALLED BY ANOTHER PROGRAM(XSKUT134).                    00001300
001040* THERE ARE 5 PARAMETERS PASSED IN THIS PROGRAM.  ONE WILL        00001400
001050* BE THE ACTUAL REBATE FORM TEXT RECORD, MAXIMUM                  00001500
001060* FUTURE OFFSET DATE IN CCYYMMDD, A LOAD SQL RETURN CODE FIELD,   00001600
001070* A PROGRAM STATUS CODE, AND A LOAD SEVERITY LEVEL.  THIS PROGRAM 00001700
001080* WILL EITHER UPDATE OR INSERT A RECORD TO THE XST_REBT_FM AND    00001800
001090* XST_REBT_FM_TXT TABLES.                                         00001900
001094* THIS PROGRAM WILL ALWAYS SEND BACK A LOAD SQL RETURN CODE,      00002000
001096* A PROGRAM STATUS CODE, AND A LOAD SEVERITY CODE.                00003000
001097* IF THE PROGRAM DOES NOT UPDATE OR INSERT THE RECORD CORRECTLY IT00004000
001098* WILL SELECT THE CORRECT ERROR CODES, FIND THE SEVERITY LEVEL,   00005000
001099* AND EXIT OUT OF THE PROGRAM.                                    00006000
001101*                                                                 00007000
001102*          ERROR CODES - LOAD SQL RETURN CODE                     00008000
001103*             - THIS IS THE LAST SQL RETURN CODE RECEIVED         00009000
001104*               FROM A DATABASE ACTION.                           00009100
001105*                                                                 00009200
001106*          ERROR CODES - PROGRAM STATUS CODE                      00009300
001107*            THIS CODE IS FOUND BY TAKING THE MAXIMUM OFFSET      00009400
001108*            DATE AND COMPARING IT TO THE PROMOTION START         00009500
001109*            DATE.  IF THE MAXIMUM OFFSET DATE IS LESS THAN       00009600
001110*            THE PROMOTION START DATE THE LOAD IS NOT CRITICAL,   00009700
001111*            OTHERWISE IT IS CRITICAL TO THE SYSTEM.              00009800
001112*            THE PROMOTION START DATE IS FOUND BY SELECTING IT    00009900
001113*            FROM XST_PROMO (PROMOTION TABLE).                    00010000
001114*           - 00 - ALL DATABASE ACTION WAS SUCCESSFUL AND         00010100
001115*                  WORKED ACCORDING TO THE MESSAGE TYPE.          00010200
001116*           - 01 - AN 'ADD' RECORD WAS TURNED INTO AN             00010300
001117*                  UPDATE AND THE BUSINESS EVENT WAS FOUND        00010400
001118*                  TO BE THE ONE NEEDED ON THE DATABASE.          00010500
001119*           - 02 - AN 'ADD' RECORD WAS TURNED INTO AN UPDATE      00010600
001120*                  AND THE BUSINESS EVENT WAS FOUND TO BE         00010700
001121*                  THE ONE NOT NEEDED ON THE DATABASE.            00010800
001122*           - 03 - AN 'UPDATE' RECORD WAS TURNED INTO AN ADD.     00010900
001123*           - 04 - AN 'UPDATE' RECORD WAS BYPASSED BECAUSE THE    00011000
001124*                  RECORD CURRENTLY ON THE DATABASE WAS THE       00011100
001125*                  MOST RECENT DATA.                              00011200
001126*           - 05 - THE DATABASE ACTION WAS NOT SUCCESSFUL DUE     00011300
001127*                  TO THE RETURNED SQL CODE.                      00011400
001128*           - 06 - UNEXPECTED ACTION CODE RECEIVED.               00011500
001129*                                                                 00011600
001130*          ERROR CODES - LOAD SEVERITY LEVEL                      00011700
001131*           - 00 - THE LOAD OF THE DATA WAS SUCCESSFUL AND        00011800
001132*                  THEREFORE THE SEVERITY OF THE LOAD DID         00011900
001133*                  NOT NEED TO BE DETERMINED.                     00012000
001134*           - 01 - THE LOAD IS CRITICAL TO A SYSTEM AND           00012100
001135*                  THEREFORE MUST BE RESOLVED ASAP.               00012200
001136*           - 02 - THE LOAD IS NOT CRITICAL AND THEREFORE CAN     00012300
001137*                  WAIT UNTIL A LATER TIME TO BE RESOLVED.        00012400
001138*                                                                 00012500
001139*----------------------------------------------------------       00012600
001140* HISTORY LOG:                                                    00012700
001141*                                                                 00012800
001142*----------------------------------------------------------       00012900
001143* DATE: 04/16/2010                                                00013000
001144* WR/IR#: WR#38172                                                00013100
001145* PROGRAMMER: CHERI PARMLEY                                       00013200
001146* DESCRIPTION: INITIAL VERSION                                    00013300
001148*                                                                 00013400
001156* DATE:  07/21/2010                                               00013509
001157* WR/IR#:  WR#38172                                               00013600
001158* PROGRAMMER: CHERI PARMLEY                                       00013700
001159* DESCRIPTION: STANDARDIZE CODE FOR SERVICE DELIVERY              00013800
001160*                                                                 00013900
101210* DATE:  10/12/2010                                               00014009
101210* WR/IR#:  PKE#0000000000005286                                   00014109
101210* PROGRAMMER: CHERI PARMLEY                                       00014209
101210* DESCRIPTION: CHANGE CODE IN 8600- TO FIRST LOOK IF RECORD       00014309
101210* EXISTS, THEN CHECK SOR-TMST TO KNOW WHETHER TO INSERT, UPDATE   00014409
101210* OR DROP ROW.                                                    00014509
001160*                                                                 00014609
001161*----------------------------------------------------------       00014709
001162 ENVIRONMENT DIVISION.                                            00014809
001163*----------------------------------------------------------       00014909
001164 CONFIGURATION SECTION.                                           00015009
001165 SOURCE-COMPUTER. IBM-3090.                                       00015109
001166 OBJECT-COMPUTER. IBM-3090.                                       00015209
001167                                                                  00015309
001168 INPUT-OUTPUT SECTION.                                            00015409
001169                                                                  00015509
001170 FILE-CONTROL.                                                    00015609
001180                                                                  00015709
001190*----------------------------------------------------------       00015809
001200 DATA DIVISION.                                                   00015909
001300*----------------------------------------------------------       00016009
001400 FILE SECTION.                                                    00016109
001600                                                                  00016209
001700*---------------------------------------------------------        00016309
001800                                                                  00016409
001900 WORKING-STORAGE SECTION.                                         00016509
002000*---------------------------------------------------------        00016609
002100* PC- PROGRAM CONSTANTS                                           00016709
002200*----------------------------------------------------------       00017000
002300 01  PC-PROGRAM-CONSTANTS.                                        00018000
002400     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUP134'. 00019000
002500     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00019100
002600                                                                  00019200
002700*----------------------------------------------------------       00019300
002800* PS- PROGRAM SWITCHES                                            00019400
002900*----------------------------------------------------------       00019500
003000 01  PS-PROGRAM-SWITCHES.                                         00019600
003100     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       00019700
003200         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       00019800
003300         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       00019900
003340     05  PS-NOT-READY-TBL-SW          PIC X(01)  VALUE 'Y'.       00020000
003350         88  PS-NOT-READY-TBL                    VALUE 'Y'.       00020100
003360         88  PS-READY-FOR-TBL                    VALUE 'N'.       00020200
003400                                                                  00020300
003500*----------------------------------------------------------       00020400
003600* PV- PROGRAM VARIABLES                                           00020500
003700*----------------------------------------------------------       00020600
003800 01 PV-PROGRAM-VARIABLES.                                         00020700
003900    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00020800
004000    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00020900
004010    05  PV-SQL-CODE                   PIC S9(4)  VALUE +0.        00021000
004020    05  PV-STRT-DTE                   PIC X(10)  VALUE SPACES.    00021100
004030    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    00021200
004031    05  PV-ACT-STRT-TMST              PIC X(26)  VALUE SPACES.    00021300
004045    05  PV-ACTION-CODE                PIC X(01).                  00021400
004050        88  PV-INSERT-DATA                       VALUE 'I'.       00021500
004060        88  PV-UPDATE-DATA                       VALUE 'U'.       00021600
004070    05  PV-LD-STATUS-CDE              PIC X(02).                  00021700
004080        88  PV-NO-ERROR                          VALUE '00'.      00021800
004090        88  PV-CRITICAL-ERROR                    VALUE '01'.      00021900
004100        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00022000
004200    05  PV-PGM-STATUS-CDE             PIC X(02).                  00022100
004210        88  PV-SUCCESS-CDE                       VALUE '00'.      00022200
004220        88  PV-UPDATE-NEED                       VALUE '01'.      00022300
004230        88  PV-UPDATE-NOT-NEED                   VALUE '02'.      00022400
004240        88  PV-ADD-CDE                           VALUE '03'.      00022500
004241        88  PV-UPDATE-BYPASS                     VALUE '04'.      00022600
004250        88  PV-NO-SUCCESS-CDE                    VALUE '05'.      00022700
004260        88  PV-UNEXPECT-CDE                      VALUE '06'.      00022800
004270                                                                  00022900
004328    05  PV-STAT-CODE                  PIC X(01).                  00023000
004329        88  PV-SCHEDULED                         VALUE 'S'.       00024000
004330        88  PV-CANCELED                          VALUE 'C'.       00024100
004331        88  PV-DELETED                           VALUE 'D'.       00024200
004332                                                                  00024300
004333    05  PV-PROMO-STRT-DTE-TM.                                     00024400
004334        10  PV-PROMO-STRT-DTE.                                    00024500
004335            15  PV-PROMO-DTE-TM-CCYY      PIC X(04).              00024600
004336            15  FILLER                    PIC X(01).              00024700
004337            15  PV-PROMO-DTE-TM-MM        PIC X(02).              00024800
004338            15  FILLER                    PIC X(01).              00024900
004339            15  PV-PROMO-DTE-TM-DD        PIC X(02).              00025000
004340        10  PV-PROMO-STRT-TM              PIC X(16).              00025100
004341                                                                  00025200
004400    05  PV-PRC-EXC-STRT-DTE-NBR.                                  00025300
004500        10  PV-PRC-EXC-DTE-CCYY           PIC 9(04).              00025400
004600        10  PV-PRC-EXC-DTE-MM             PIC 9(02).              00025500
004700        10  PV-PRC-EXC-DTE-DD             PIC 9(02).              00025600
004800                                                                  00025700
004900    05  PV-PRC-EXC-STRT-DTE.                                      00025800
005000        15  PV-PRC-EXC-DTE-CH-CCYY        PIC X(04).              00025900
005100        15  FILLER                        PIC X(01).              00026000
005200        15  PV-PRC-EXC-DTE-CH-MM          PIC X(02).              00027000
005300        15  FILLER                        PIC X(01).              00028000
005400        15  PV-PRC-EXC-DTE-CH-DD          PIC X(02).              00029000
                                                                        00030000
004600*----------------------------------------------------------       00030100
004700* REBATE FORMS RECORD LAYOUT                                      00030200
004800*----------------------------------------------------------       00030300
004900     COPY XSRD121.                                                00030400
005000                                                                  00030500
005600*----------------------------------------------------------       00030600
005700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00030700
005800*----------------------------------------------------------       00030800
005900     COPY DPWS004.                                                00030900
006000                                                                  00031000
006100*---------------------------------------------                    00031100
006200*  DB2 COMMUNICATION AREA.                                        00031200
006300*---------------------------------------------                    00031300
006400     EXEC SQL                                                     00031400
006500          INCLUDE SQLCA                                           00031500
006600     END-EXEC.                                                    00031600
006700                                                                  00031700
006800*------------------------------------------------                 00031800
006900*  DB2 TABLE XST00130(XST_REBT_FM) - REBATE TABLE                 00031900
007000*------------------------------------------------                 00032000
007100     EXEC SQL                                                     00033000
007200          INCLUDE XST00130                                        00033100
007300     END-EXEC.                                                    00033200
007400                                                                  00033300
007500*--------------------------------------------------------         00033400
007600*  DB2 TABLE XST00131(XST_REBT_FM_TXT) - REBATE FORM TEXT         00033500
007700*--------------------------------------------------------         00033600
007800     EXEC SQL                                                     00033700
007900          INCLUDE XST00131                                        00033800
008000     END-EXEC.                                                    00033900
008100                                                                  00034000
007800*---------------------------------------------                    00034100
007900*  DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                00034200
008000*---------------------------------------------                    00034300
008100     EXEC SQL                                                     00034400
008200          INCLUDE XST00026                                        00034500
008300     END-EXEC.                                                    00034600
008400                                                                  00034700
008410*---------------------------------------------                    00034800
008420*  DB2 TABLE XST00028(XST_MDSE_LNE_SELN)                          00034900
008430*---------------------------------------------                    00035000
008440     EXEC SQL                                                     00035100
008450          INCLUDE XST00028                                        00035200
008460     END-EXEC.                                                    00035300
008470                                                                  00035400
009169 LINKAGE SECTION.                                                 00035500
009170                                                                  00035600
009171*----------------------------------------------------------       00035700
009180* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          00035800
009190*----------------------------------------------------------       00035900
009200 01 LV-LINKAGE-VARIABLES.                                         00036000
009300    05  LV-PRICE-BUS-REC           PIC X(300).                    00036100
009400    05  LV-MAX-OFFSET-DTE          PIC X(08).                     00036200
009500    05  LV-LD-SQL-RETURN-CDE       PIC S9(4).                     00036300
009600    05  LV-PGM-STATUS-CDE          PIC X(02).                     00036400
009700    05  LV-LD-SEVERITY-LVL         PIC X(02).                     00036500
009800                                                                  00036600
009900                                                                  00036700
010000*----------------------------------------------------------       00036800
010100 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00036900
010200*----------------------------------------------------------       00037000
010300 0000-MAINLINE.                                                   00037100
010400                                                                  00037300
010500     PERFORM 1000-INITIALIZATION.                                 00037400
010600                                                                  00037500
010700     PERFORM 2000-PROCESS-MESSAGE                                 00037600
010800             UNTIL PS-PROCESS-COMPLETE.                           00037700
010900                                                                  00037800
011000     PERFORM 9999-WRAPUP.                                         00037900
011100                                                                  00038000
011200     EXIT PROGRAM.                                                00038100
011300                                                                  00039000
011400*0000-EXIT.                                                       00039100
011500 EJECT.                                                           00039200
011600                                                                  00039300
011700*----------------------------------------------------------       00039400
011800* 1000-INITIALIZATION.                                            00039500
011900*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            00039600
012000*     UPDATE OR INSERT A RECORD.                                  00039700
012100*----------------------------------------------------------       00039800
012200 1000-INITIALIZATION.                                             00039900
012400     INITIALIZE DCLXST00130.                                      00040000
012500     INITIALIZE DCLXST00131.                                      00040100
012700     INITIALIZE PV-SQL-CODE.                                      00040200
012800     MOVE LV-PRICE-BUS-REC     TO XS121-REBATE-RECORD.            00040300
                                                                        00040500
012900     MOVE XS121-ACTION-CDE     TO PV-ACTION-CODE.                 00040600
013100     MOVE XS121-STAT-CDE       TO PV-STAT-CODE.                   00040700
013600     SET PV-NO-ERROR           TO TRUE.                           00040800
013700     SET PV-SUCCESS-CDE        TO TRUE.                           00040900
013800     SET PS-PROCESS-CONTINUE   TO TRUE.                           00041000
013820     SET PS-NOT-READY-TBL      TO TRUE.                           00041100
013900                                                                  00041200
014000     IF LV-MAX-OFFSET-DTE = SPACES                                00041300
014100        INITIALIZE PV-MAX-OFFSET-DTE                              00041400
014200     ELSE                                                         00041500
014300        MOVE LV-MAX-OFFSET-DTE    TO PV-MAX-OFFSET-DTE            00041600
014400     END-IF.                                                      00041700
014500                                                                  00041800
014700     PERFORM 1400-POPULATE-DCLGEN.                                00041900
014760                                                                  00042000
015000*1000-EXIT.                                                       00043000
015100 EJECT.                                                           00044000
015200                                                                  00044100
016599*----------------------------------------------------------       00044200
016600* 1400-POPULATE-DCLGEN.                                           00044300
016601*     POPULATES THE REBATE FORM TABLE VARIABLES.                  00044400
016603*----------------------------------------------------------       00044500
016604 1400-POPULATE-DCLGEN.                                            00044600
016605                                                                  00044800
016608     MOVE XS121-REBT-FM-ID       TO XST00130-REBT-FM-ID.          00044900
016606     MOVE XS121-PROMO-INTFC-ID   TO XST00130-PROMO-INTFC-ID.      00045000
016607     MOVE XS121-MDSE-LNE-ID      TO XST00130-MDSE-LNE-ID.         00045100
           MOVE XS121-REBT-PROMO-ID    TO XST00131-REBT-PROMO-ID.       00045200
016612     MOVE XS121-LAST-UPD-TMST    TO XST00130-SOR-LAST-UPD-TMST.   00045300
016609     MOVE XS121-FM-SECT-TYP-CDE  TO XST00131-FM-SECT-TYP-CDE.     00045400
016611     MOVE XS121-FM-LNE-TYP-CDE   TO XST00131-FM-LNE-TYP-CDE.      00045500
016610     MOVE XS121-FM-LNE-NBR       TO XST00131-FM-LNE-NBR.          00045600
016611     MOVE XS121-EFF-END-DTE      TO XST00131-EFF-END-DTE.         00045700
016611     MOVE XS121-FM-TXT           TO XST00131-FM-TXT.              00045800
016611     MOVE XS121-STAT-CDE         TO XST00131-STAT-CDE.            00045900
016673                                                                  00046000
016674*1400-EXIT.                                                       00048300
016675 EJECT.                                                           00048400
016676                                                                  00048500
016677*----------------------------------------------------------       00049000
016678* 2000-PROCESS-MESSAGE.                                           00050000
016679*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            00060000
016680*     SHOULD BE INSERTED INTO THE REBATE TABLE OR UPDATED.        00061000
016690*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          00061100
016700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      00061200
016800*----------------------------------------------------------       00061300
016900 2000-PROCESS-MESSAGE.                                            00061400
017000                                                                  00061600
017100     EVALUATE TRUE                                                00061700
017200        WHEN PV-INSERT-DATA                                       00061800
017300             PERFORM 6100-INSERT-DATA                             00061900
                   PERFORM 6110-PROCESS-ROW                             00062000
017700        WHEN PV-UPDATE-DATA                                       00062100
017800             PERFORM 7150-UPDATE-DATA                             00063000
017800             PERFORM 7160-PROCESS-ROW                             00064000
018200        WHEN OTHER                                                00065000
018300             SET PS-PROCESS-COMPLETE TO TRUE                      00066000
018400             SET PV-UNEXPECT-CDE     TO TRUE                      00067000
018500             PERFORM 9000-LOAD-SEVERITY-ERROR                     00068000
018600     END-EVALUATE.                                                00068100
018700                                                                  00068200
018800*2000-EXIT.                                                       00068300
018900 EJECT.                                                           00068400
019000                                                                  00068500
019100*------------------------------------------------------           00068600
019200* 6100-INSERT-DATA.                                               00068700
019300*     INSERT THE REBATE RECORD.                                   00068800
019400*------------------------------------------------------           00068900
019500 6100-INSERT-DATA.                                                00069000
019600                                                                  00069200
019700     PERFORM                                                      00069300
019800         WITH TEST AFTER                                          00069400
019900         VARYING PV-SQL-SUB                                       00069500
020000         FROM 1 BY 1                                              00069600
020100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00069700
020300                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00069800
020500                                                                  00069900
020600         EXEC SQL                                                 00070000
020700             INSERT INTO XST_REBT_FM                              00071000
020800                                      (REBT_FM_ID                 00080000
020900                                      ,PROMO_INTFC_ID             00090000
021000                                      ,MDSE_LNE_ID                00100000
021100                                      ,LAST_UPD_TMST              00110000
021120                                      ,SOR_LAST_UPD_TMST)         00120000
021197             VALUES                                               00121000
021198                (:XST00130-REBT-FM-ID                             00122000
021199                ,:XST00130-PROMO-INTFC-ID                         00123000
021200                ,:XST00130-MDSE-LNE-ID                            00124000
021660                ,CURRENT TIMESTAMP                                00125000
021661                ,:XST00130-SOR-LAST-UPD-TMST)                     00126000
021670         END-EXEC                                                 00127000
021680                                                                  00128000
021681         MOVE SQLCODE TO PV-SQL-CODE                              00129000
021682                                                                  00129100
021690         EVALUATE TRUE                                            00129200
021700             WHEN SQLCODE = -904                                  00129300
021800             WHEN SQLCODE = -911                                  00129400
021900             WHEN SQLCODE = -913                                  00129500
072110                  CONTINUE                                        00129600
072110             WHEN SQLCODE = 0                                     00129700
072110                  CONTINUE                                        00129800
022400             WHEN SQLCODE = -803                                  00129900
072110                  CONTINUE                                        00130000
022600             WHEN OTHER                                           00130100
022700                  SET PS-PROCESS-COMPLETE TO TRUE                 00130200
022800                  SET PV-NO-SUCCESS-CDE TO TRUE                   00130300
022900                  SET PS-NOT-READY-TBL TO TRUE                    00130400
023100         END-EVALUATE                                             00130500
023200     END-PERFORM.                                                 00130600
023500                                                                  00130700
023600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00130800
023700        SET PS-PROCESS-COMPLETE TO TRUE                           00130900
023800        SET PV-NO-SUCCESS-CDE TO TRUE                             00131000
023900        SET PS-NOT-READY-TBL TO TRUE                              00131100
024000        PERFORM 9000-LOAD-SEVERITY-ERROR                          00131200
024100     END-IF.                                                      00131300
024200                                                                  00131400
024300*6100-EXIT.                                                       00131500
024400 EJECT.                                                           00131600
030700*------------------------------------------------------           00131700
072110* 6110-PROCESS-ROW.                                               00131800
072110*     DETERMINE SQL AND PROCESS ACCORDINGLY                       00131900
030700*------------------------------------------------------           00132000
072110 6110-PROCESS-ROW.                                                00132100
072110     EVALUATE PV-SQL-CODE                                         00132300
072110         WHEN 0                                                   00132400
101210            SET PV-ADD-CDE TO TRUE                                00132609
072110            PERFORM 8700-INSERT-DATA-TEXT                         00132800
                  PERFORM 8710-PROCESS-ROW                              00132900
072110         WHEN -803                                                00133000
072110            PERFORM 8800-SELECT-DATA                              00133100
                  PERFORM 8810-PROCESS-ROW                              00133200
072110            IF PV-UPDATE-DATA                                     00133300
072110                 PERFORM 7150-UPDATE-DATA                         00133400
                       PERFORM 7160-PROCESS-ROW                         00133500
072110            END-IF                                                00133600
072110         WHEN OTHER                                               00133700
072110            PERFORM 9000-LOAD-SEVERITY-ERROR                      00133800
072110     END-EVALUATE.                                                00133900
072110*6110-EXIT.                                                       00134000
                                                                        00134100
031000*------------------------------------------------------           00134200
030800* 7150-UPDATE-DATA.                                               00134300
030900*     UPDATE THE REBATE RECORD.                                   00134400
031000*------------------------------------------------------           00134500
031100 7150-UPDATE-DATA.                                                00134600
031200                                                                  00134800
031300     PERFORM                                                      00134900
031400         WITH TEST AFTER                                          00135000
031500         VARYING PV-SQL-SUB                                       00135100
031600         FROM 1 BY 1                                              00135200
031700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00135300
031710                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00135400
032100                                                                  00135500
032200         EXEC SQL                                                 00136000
032300             UPDATE XST_REBT_FM                                   00137000
033360              SET LAST_UPD_TMST    = CURRENT TIMESTAMP,           00138000
033361                  SOR_LAST_UPD_TMST                               00139000
033362                                   = :XST00130-SOR-LAST-UPD-TMST  00140000
033370             WHERE REBT_FM_ID      = :XST00130-REBT-FM-ID         00150000
033370               AND PROMO_INTFC_ID  = :XST00130-PROMO-INTFC-ID     00151000
033380               AND MDSE_LNE_ID     = :XST00130-MDSE-LNE-ID        00152000
033381               AND SOR_LAST_UPD_TMST                              00153000
033382                                  <= :XST00130-SOR-LAST-UPD-TMST  00153100
033390         END-EXEC                                                 00153200
033400                                                                  00153300
033410         MOVE SQLCODE TO PV-SQL-CODE                              00153400
033420                                                                  00153500
033500         EVALUATE TRUE                                            00153600
033600             WHEN SQLCODE = -904                                  00153700
033700             WHEN SQLCODE = -911                                  00153800
033800             WHEN SQLCODE = -913                                  00153900
033900                  CONTINUE                                        00154000
034000             WHEN SQLCODE = 0                                     00154100
072110                  CONTINUE                                        00154200
034300             WHEN SQLCODE = +100                                  00154300
072110                  CONTINUE                                        00154400
034700             WHEN OTHER                                           00154500
034800                  SET PS-PROCESS-COMPLETE TO TRUE                 00154600
034900                  SET PV-NO-SUCCESS-CDE TO TRUE                   00154700
035000                  SET PS-NOT-READY-TBL TO TRUE                    00154800
035200         END-EVALUATE                                             00154900
035300     END-PERFORM.                                                 00155000
035400                                                                  00155100
035700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00155200
035800        SET PS-PROCESS-COMPLETE TO TRUE                           00155300
035900        SET PV-NO-SUCCESS-CDE TO TRUE                             00155400
036000        SET PS-NOT-READY-TBL TO TRUE                              00155500
036100        PERFORM 9000-LOAD-SEVERITY-ERROR                          00155600
036200     END-IF.                                                      00155700
036300                                                                  00155800
036400*7150-EXIT.                                                       00155900
036500 EJECT.                                                           00156000
072110*------------------------------------------------------           00156100
072110* 7160-PROCESS-ROW.                                               00156200
072110*     DETERMINE SQL AND PROCESS ACCORDINGLY                       00156300
072110*------------------------------------------------------           00156400
072110 7160-PROCESS-ROW.                                                00156500
072110                                                                  00156700
072110     EVALUATE PV-SQL-CODE                                         00156800
072110        WHEN 0                                                    00156900
101210           SET PV-UPDATE-NEED TO TRUE                             00157009
072110           PERFORM 8600-UPDATE-DATA-TEXT                          00157205
                 PERFORM 8610-PROCESS-ROW                               00157300
072110        WHEN +100                                                 00157400
072110           PERFORM 8800-SELECT-DATA                               00157500
                 PERFORM 8810-PROCESS-ROW                               00157600
072110           IF PV-INSERT-DATA                                      00157700
072110                PERFORM 6100-INSERT-DATA                          00157800
                      PERFORM 6110-PROCESS-ROW                          00157900
072110           END-IF                                                 00158000
072110        WHEN OTHER                                                00158100
072110           PERFORM 9000-LOAD-SEVERITY-ERROR                       00158200
072110      END-EVALUATE.                                               00158300
072110*7160-EXIT.                                                       00158400
                                                                        00158500
030700*------------------------------------------------------           00158600
030800* 8600-UPDATE-DATA-TEXT.                                          00158700
030900*     UPDATE THE REBATE RECORD.                                   00158800
031000*------------------------------------------------------           00158900
031100 8600-UPDATE-DATA-TEXT.                                           00159000
101210**NEW PKE#5286                                                    00159209
101210     PERFORM                                                      00159309
101210         WITH TEST AFTER                                          00159409
101210         VARYING PV-SQL-SUB                                       00159509
101210         FROM 1 BY 1                                              00159609
101210         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00159709
101210                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00159809
101210                                                                  00159909
101210         EXEC SQL                                                 00160009
101210             SELECT  SOR_LAST_UPD_TMST                            00160109
101210               INTO :PV-LAST-UPD-TMST                             00160209
101210               FROM  XST_REBT_FM_TXT                              00160309
101210               WHERE REBT_FM_ID      = :XST00130-REBT-FM-ID       00160409
101210                 AND FM_SECT_TYP_CDE = :XST00131-FM-SECT-TYP-CDE  00160509
101210                 AND FM_LNE_TYP_CDE  = :XST00131-FM-LNE-TYP-CDE   00160609
101210                 AND FM_LNE_NBR      = :XST00131-FM-LNE-NBR       00160709
101210         END-EXEC                                                 00160809
101210                                                                  00160909
101210         MOVE SQLCODE TO PV-SQL-CODE                              00161009
101210                                                                  00161209
101210         EVALUATE TRUE                                            00161309
101210             WHEN SQLCODE = -904                                  00161409
101210             WHEN SQLCODE = -911                                  00161509
101210             WHEN SQLCODE = -913                                  00161609
101210                  CONTINUE                                        00161709
101210             WHEN SQLCODE = 0                                     00161809
101210             WHEN SQLCODE = +100                                  00161909
101210                  CONTINUE                                        00162009
101210             WHEN OTHER                                           00162109
101210                  SET PS-PROCESS-COMPLETE TO TRUE                 00162209
101210                  SET PV-NO-SUCCESS-CDE TO TRUE                   00162309
101210                  SET PS-NOT-READY-TBL TO TRUE                    00162409
101210         END-EVALUATE                                             00162509
101210     END-PERFORM.                                                 00162609
101210                                                                  00162709
101210     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00162809
101210        SET PS-PROCESS-COMPLETE TO TRUE                           00162909
101210        SET PV-NO-SUCCESS-CDE TO TRUE                             00163009
101210        SET PS-NOT-READY-TBL TO TRUE                              00163109
101210        PERFORM 9000-LOAD-SEVERITY-ERROR                          00163209
101210     END-IF.                                                      00163309
                                                                        00163403
101210     IF PV-SQL-CODE = +100                                        00163509
072110         PERFORM 8700-INSERT-DATA-TEXT                            00163803
072110         PERFORM 8710-PROCESS-ROW                                 00163903
101210     ELSE                                                         00164109
101210         IF PV-SQL-CODE = 0                                       00164209
101210             IF PV-LAST-UPD-TMST > XST00130-SOR-LAST-UPD-TMST     00164309
101210******          DONT WRITE - BYPASS                               00164409
101210                SET PS-PROCESS-COMPLETE TO TRUE                   00164609
101210                SET PS-READY-FOR-TBL TO TRUE                      00164709
101210                SET PV-UPDATE-BYPASS TO TRUE                      00164809
101210             ELSE                                                 00165009
031300                PERFORM                                           00165403
031400                  WITH TEST AFTER                                 00165503
031500                 VARYING PV-SQL-SUB                               00165603
031600                 FROM 1 BY 1                                      00165703
031700                UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES          00165803
031710                      OR  SQLCODE NOT = -904 AND -911 AND -913)   00165903
032100                                                                  00166000
032200                EXEC SQL                                          00166103
032300                 UPDATE XST_REBT_FM_TXT                           00166203
020900                  SET REBT_PROMO_ID   = :XST00131-REBT-PROMO-ID   00167003
021000                    ,EFF_END_DTE     = :XST00131-EFF-END-DTE      00168003
021100                    ,FM_TXT          = :XST00131-FM-TXT           00169003
021120                    ,STAT_CDE        = :XST00131-STAT-CDE         00169103
021120                    ,LAST_UPD_TMST   = CURRENT TIMESTAMP          00169203
033361                  ,SOR_LAST_UPD_TMST = :XST00130-SOR-LAST-UPD-TMST00169303
                       WHERE REBT_FM_ID      = :XST00130-REBT-FM-ID     00169403
                         AND FM_SECT_TYP_CDE = :XST00131-FM-SECT-TYP-CDE00169503
                         AND FM_LNE_TYP_CDE  = :XST00131-FM-LNE-TYP-CDE 00169603
                         AND FM_LNE_NBR      = :XST00131-FM-LNE-NBR     00169703
033390                END-EXEC                                          00170003
033400                                                                  00170100
033410                MOVE SQLCODE TO PV-SQL-CODE                       00170203
033420                                                                  00171000
033500                EVALUATE TRUE                                     00171103
033600                   WHEN SQLCODE = -904                            00171203
033700                   WHEN SQLCODE = -911                            00171303
033800                   WHEN SQLCODE = -913                            00171403
033900                       CONTINUE                                   00171503
034000                   WHEN SQLCODE = 0                               00171603
                             CONTINUE                                   00171703
034300                   WHEN SQLCODE = +100                            00171803
      ***                     NO DATA TEXT LINE FOR REBATE              00171903
                              CONTINUE                                  00172003
034700                   WHEN OTHER                                     00172103
034800                        SET PS-PROCESS-COMPLETE TO TRUE           00172203
034900                        SET PV-NO-SUCCESS-CDE TO TRUE             00172303
035000                        SET PS-NOT-READY-TBL TO TRUE              00172403
035200                 END-EVALUATE                                     00172503
035300             END-PERFORM                                          00172603
035400                                                                  00172700
035700             IF PV-SQL-SUB GREATER PC-MAX-RETRIES                 00172803
035800                SET PS-PROCESS-COMPLETE TO TRUE                   00172903
035900                SET PV-NO-SUCCESS-CDE TO TRUE                     00173003
036000                SET PS-NOT-READY-TBL TO TRUE                      00173103
036100                PERFORM 9000-LOAD-SEVERITY-ERROR                  00173203
036200             END-IF                                               00173303
036300         ELSE                                                     00173403
036641              SET PS-PROCESS-COMPLETE TO TRUE                     00173503
036642              SET PV-NO-SUCCESS-CDE TO TRUE                       00173603
036643              SET PS-NOT-READY-TBL TO TRUE                        00173703
               END-IF.                                                  00173803
036400*8600-EXIT.                                                       00173900
036500 EJECT.                                                           00174000
                                                                        00174100
030700*------------------------------------------------------           00174200
072110*8610-PROCESS-ROW.                                                00174300
072110*   DETERMINE SQL AND PROCESS ACCORDINGLY                         00174400
030700*------------------------------------------------------           00174500
072110 8610-PROCESS-ROW.                                                00174600
072110                                                                  00174800
            EVALUATE PV-SQL-CODE                                        00174900
072110          WHEN 0                                                  00175100
101210             SET PV-UPDATE-NEED TO TRUE                           00175209
034100             SET PS-PROCESS-COMPLETE TO TRUE                      00175500
034200             SET PS-READY-FOR-TBL TO TRUE                         00175600
072110          WHEN +100                                               00175905
                   CONTINUE                                             00176005
072110          WHEN OTHER                                              00176603
072110             PERFORM 9000-LOAD-SEVERITY-ERROR                     00176703
072110     END-EVALUATE.                                                00176803
072110*8610-EXIT                                                        00176903
019100*------------------------------------------------------           00177003
019200* 8700-INSERT-DATA-TEXT.                                          00177103
019300*     INSERT THE REBATE FORM TEXT RECORD.                         00177203
019400*------------------------------------------------------           00177303
019500 8700-INSERT-DATA-TEXT.                                           00177403
019600                                                                  00177603
019700     PERFORM                                                      00177703
019800         WITH TEST AFTER                                          00177803
019900         VARYING PV-SQL-SUB                                       00177903
020000         FROM 1 BY 1                                              00178003
020100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00178103
020300                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00178203
020500                                                                  00178303
020600         EXEC SQL                                                 00178403
020700             INSERT INTO XST_REBT_FM_TXT                          00178503
020800                                      (REBT_FM_ID                 00178603
020900                                      ,FM_SECT_TYP_CDE            00178703
020900                                      ,FM_LNE_NBR                 00178803
020900                                      ,REBT_PROMO_ID              00178903
020900                                      ,FM_LNE_TYP_CDE             00179003
021000                                      ,EFF_END_DTE                00179103
021100                                      ,FM_TXT                     00179203
021120                                      ,STAT_CDE                   00179303
021120                                      ,LAST_UPD_TMST              00179403
021120                                      ,SOR_LAST_UPD_TMST)         00179503
021197             VALUES                                               00179603
021198                (:XST00130-REBT-FM-ID                             00179703
021199                ,:XST00131-FM-SECT-TYP-CDE                        00179803
021199                ,:XST00131-FM-LNE-NBR                             00179903
021199                ,:XST00131-REBT-PROMO-ID                          00180003
021199                ,:XST00131-FM-LNE-TYP-CDE                         00180103
021200                ,:XST00131-EFF-END-DTE                            00180203
021200                ,:XST00131-FM-TXT                                 00180303
021200                ,:XST00131-STAT-CDE                               00180403
021660                ,CURRENT TIMESTAMP                                00180503
021661                ,:XST00130-SOR-LAST-UPD-TMST)                     00180603
021670         END-EXEC                                                 00180703
021680                                                                  00180803
021681         MOVE SQLCODE TO PV-SQL-CODE                              00180903
021682                                                                  00181703
021690         EVALUATE TRUE                                            00181803
021700             WHEN SQLCODE = -904                                  00181903
021800             WHEN SQLCODE = -911                                  00182003
021900             WHEN SQLCODE = -913                                  00182103
022000                  CONTINUE                                        00182203
022100             WHEN SQLCODE = 0                                     00182303
                        CONTINUE                                        00182403
022400             WHEN SQLCODE = -803                                  00182503
                        CONTINUE                                        00182603
022600             WHEN OTHER                                           00182703
022700                  SET PS-PROCESS-COMPLETE TO TRUE                 00182803
022800                  SET PV-NO-SUCCESS-CDE TO TRUE                   00182903
022900                  SET PS-NOT-READY-TBL TO TRUE                    00183003
023100         END-EVALUATE                                             00183103
023200     END-PERFORM.                                                 00183203
023500                                                                  00183303
023600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00183403
023700        SET PS-PROCESS-COMPLETE TO TRUE                           00183503
023800        SET PV-NO-SUCCESS-CDE TO TRUE                             00183603
023900        SET PS-NOT-READY-TBL TO TRUE                              00183703
024000        PERFORM 9000-LOAD-SEVERITY-ERROR                          00183803
024100     END-IF.                                                      00183903
024200                                                                  00184003
024300*8700-EXIT.                                                       00184103
024400 EJECT.                                                           00184203
036601*------------------------------------------------------           00184303
036602* 8710-PROCESS-ROW.                                               00184403
036603*     DETERMINE SQL AND PROCESS ACCORDINGLY                       00184503
036601*------------------------------------------------------           00184603
036605 8710-PROCESS-ROW.                                                00184703
                                                                        00184903
            EVALUATE PV-SQL-CODE                                        00185003
022400         WHEN 0                                                   00185103
022200            SET PS-PROCESS-COMPLETE TO TRUE                       00185203
022300            SET PS-READY-FOR-TBL TO TRUE                          00185303
101210            SET PV-ADD-CDE TO TRUE                                00185409
022400         WHEN -803                                                00185603
022500            PERFORM 8800-SELECT-DATA                              00185703
                  PERFORM 8810-PROCESS-ROW                              00185803
                  IF PV-UPDATE-DATA                                     00185903
                       PERFORM 8600-UPDATE-DATA-TEXT                    00186103
                       PERFORM 8610-PROCESS-ROW                         00186203
                  END-IF                                                00186303
022600         WHEN OTHER                                               00186403
023000            PERFORM 9000-LOAD-SEVERITY-ERROR                      00186503
023100      END-EVALUATE.                                               00186603
      *8710-EXIT.                                                       00186703
                                                                        00186803
036604*------------------------------------------------------           00186903
036602* 8800-SELECT-DATA.                                               00187003
036603*     SELECT THE TIMESTAMP IN THE REBATE RECORD.                  00187103
036604*------------------------------------------------------           00187203
036605 8800-SELECT-DATA.                                                00187303
036606                                                                  00187503
036607     PERFORM                                                      00187603
036608         WITH TEST AFTER                                          00187703
036609         VARYING PV-SQL-SUB                                       00187803
036610         FROM 1 BY 1                                              00187903
036611         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00188003
036612                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00188103
036613                                                                  00188203
036614         EXEC SQL                                                 00188303
036615             SELECT  SOR_LAST_UPD_TMST                            00188403
036616               INTO :PV-LAST-UPD-TMST                             00188503
036617               FROM  XST_REBT_FM                                  00188603
036619              WHERE  REBT_FM_ID     = :XST00130-REBT-FM-ID        00188703
036618                AND  PROMO_INTFC_ID = :XST00130-PROMO-INTFC-ID    00188803
036619                AND  MDSE_LNE_ID    = :XST00130-MDSE-LNE-ID       00188903
036620         END-EXEC                                                 00189003
036621                                                                  00189103
036622         MOVE SQLCODE TO PV-SQL-CODE                              00189203
036623                                                                  00189303
036624         EVALUATE TRUE                                            00189403
036625             WHEN SQLCODE = -904                                  00189503
036626             WHEN SQLCODE = -911                                  00189603
036627             WHEN SQLCODE = -913                                  00189703
036628                  CONTINUE                                        00189803
036629             WHEN SQLCODE = 0                                     00189903
036637             WHEN SQLCODE = +100                                  00190003
                        CONTINUE                                        00190103
036640             WHEN OTHER                                           00190203
036641                  SET PS-PROCESS-COMPLETE TO TRUE                 00190303
036642                  SET PV-NO-SUCCESS-CDE TO TRUE                   00190403
036643                  SET PS-NOT-READY-TBL TO TRUE                    00190503
036646         END-EVALUATE                                             00190603
036647     END-PERFORM.                                                 00190703
036648                                                                  00190803
036649     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00190903
036650        SET PS-PROCESS-COMPLETE TO TRUE                           00191003
036651        SET PV-NO-SUCCESS-CDE TO TRUE                             00191103
036652        SET PS-NOT-READY-TBL TO TRUE                              00191203
036653        PERFORM 9000-LOAD-SEVERITY-ERROR                          00191303
036654     END-IF.                                                      00191403
036655                                                                  00191503
036656*8800-EXIT.                                                       00191603
036659*--------------------------------------------------------         00191703
036660* 8810-PROCESS-ROW.                                               00191803
036661*     DETERMINE SQL AND PROCESS ACCORDINGLY                       00191903
036659*--------------------------------------------------------         00192003
        8810-PROCESS-ROW.                                               00192103
                                                                        00192303
            EVALUATE PV-SQL-CODE                                        00192403
               WHEN 0                                                   00192503
036631           IF PV-UPDATE-DATA                                      00192603
036632               SET PS-PROCESS-COMPLETE TO TRUE                    00192703
036633               SET PS-READY-FOR-TBL TO TRUE                       00192803
036634           ELSE                                                   00192903
036635               PERFORM 8820-REBATE-TMST-COMPARE                   00193003
036636           END-IF                                                 00193103
036637         WHEN +100                                                00193203
036638           SET PV-INSERT-DATA TO TRUE                             00193303
036639           SET PS-NOT-READY-TBL TO TRUE                           00193403
036640         WHEN OTHER                                               00193503
036644            PERFORM 9000-LOAD-SEVERITY-ERROR                      00193603
036646     END-EVALUATE.                                                00193703
      *8810-EXIT                                                        00193803
036657 EJECT.                                                           00193903
036659*--------------------------------------------------------         00194003
036660* 8820-REBATE-TMST-COMPARE.                                       00194103
036661*     COMPARE TIMESTAMP OF EXISTING ROW TO MESSAGE RECORD         00194203
036662*     AND UPDATE IF MESSAGE HAS A NEWER TIMESTAMP.                00194303
036663*--------------------------------------------------------         00194403
036664 8820-REBATE-TMST-COMPARE.                                        00194503
036665                                                                  00194703
036666     IF XS121-LAST-UPD-TMST >= PV-LAST-UPD-TMST                   00194803
036667        SET PV-UPDATE-DATA      TO TRUE                           00195003
036668        SET PS-NOT-READY-TBL    TO TRUE                           00195103
036669     ELSE                                                         00195203
036670        SET PS-PROCESS-COMPLETE TO TRUE                           00195403
036671        SET PS-READY-FOR-TBL    TO TRUE                           00195503
036672     END-IF.                                                      00195603
036673                                                                  00195703
036674*8820-EXIT.                                                       00195803
036675 EJECT.                                                           00195903
036676                                                                  00196003
036760*----------------------------------------------------------       00196103
036800* 9000-LOAD-SEVERITY-ERROR.                                       00196203
036900*     THIS PROCEDURE IS CALLED IF THE RECORD WAS NOT UPDATED      00196303
037000*     OR INSERTED INTO THE REBATE. COMPARES                       00196403
037100*     THE MAXIMUM OFFSET DATE TO THE PROMO EVENT START DATE.      00196503
037200*     IF THE MAXIMUM OFFSET DATE IS LESS THAN THE PROMO EVENT     00196603
037300*     START DATE THE ERROR IS UNCRITICAL,                         00196703
037400*     OTHERWISE IT IS CRITICAL.                                   00196803
037500*----------------------------------------------------------       00196903
037600 9000-LOAD-SEVERITY-ERROR.                                        00197003
037800     INITIALIZE DCLXST00026.                                      00197203
037810     INITIALIZE DCLXST00028.                                      00197303
037900                                                                  00197403
038000     MOVE XS121-PROMO-INTFC-ID TO XST00028-PROMO-INTFC-ID.        00197503
038010     MOVE XS121-MDSE-LNE-ID    TO XST00028-MDSE-LNE-ID.           00197603
038020                                                                  00197703
038021     PERFORM 9010-SELECT-STRT-DATE.                               00197803
038022                                                                  00197903
038023     IF PV-PRC-EXC-STRT-DTE = SPACES                              00198003
038024        MOVE ZEROES TO PV-PRC-EXC-STRT-DTE-NBR                    00198103
038025     ELSE                                                         00198203
038026        PERFORM 9100-FORMAT-DATE-INFO                             00198303
038027     END-IF.                                                      00198403
038028                                                                  00198503
038029     IF (PV-MAX-OFFSET-DTE < PV-PRC-EXC-STRT-DTE-NBR) AND         00198603
038030       (PV-MAX-OFFSET-DTE NOT = ZEROES) AND                       00198703
038040       (PV-PRC-EXC-STRT-DTE-NBR NOT = ZEROES)                     00198803
038050        SET PV-NOT-CRITICAL-ERROR TO TRUE                         00198903
038060     ELSE                                                         00199003
038070        SET PV-CRITICAL-ERROR TO TRUE                             00199103
038080     END-IF.                                                      00199203
038090                                                                  00199303
038100*9000-EXIT.                                                       00199403
038200 EJECT.                                                           00199503
038300                                                                  00199603
038400*------------------------------------------------------           00199703
038500* 9010-SELECT-STRT-DATE.                                          00199803
038600*     SELECT THE START DATE OF THE PROMOTION.                     00199903
038700*------------------------------------------------------           00200003
038800 9010-SELECT-STRT-DATE.                                           00200103
038900                                                                  00200303
039000     PERFORM                                                      00200403
039100         WITH TEST AFTER                                          00200503
039200         VARYING PV-SQL-SUB                                       00200603
039300         FROM 1 BY 1                                              00200703
039400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 00200803
039500                   OR  SQLCODE NOT = -904 AND -911 AND -913)      00200903
039710                                                                  00201003
039720         EXEC SQL                                                 00201103
039730             SELECT  A.ACTL_END_TMST                              00201203
039740               INTO :PV-ACT-STRT-TMST                             00201303
039750               FROM  XST_PROMO         A                          00201403
039751                    ,XST_MDSE_LNE_SELN B                          00201503
039760              WHERE  B.PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID  00201603
039770                AND  B.MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID     00201703
039781                AND  A.PROMO_ID       = B.PROMO_ID                00201803
039782                WITH UR                                           00201903
039790         END-EXEC                                                 00202003
039800                                                                  00202103
039801         EVALUATE TRUE                                            00202203
039802             WHEN SQLCODE = -904                                  00202303
039803             WHEN SQLCODE = -911                                  00202403
039804             WHEN SQLCODE = -913                                  00202503
039805                  CONTINUE                                        00202603
039806             WHEN SQLCODE = 0                                     00202703
039807                  MOVE PV-ACT-STRT-TMST TO PV-PROMO-STRT-DTE-TM   00202803
039808                  MOVE PV-PROMO-STRT-DTE TO PV-PRC-EXC-STRT-DTE   00202903
039809             WHEN OTHER                                           00203003
039810                  MOVE SPACES TO PV-PRC-EXC-STRT-DTE              00203103
039811         END-EVALUATE                                             00203203
039812     END-PERFORM.                                                 00203303
039813                                                                  00203403
039814     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         00203503
039815        MOVE SPACES TO PV-PRC-EXC-STRT-DTE                        00203603
039816     END-IF.                                                      00203703
039817                                                                  00203803
039818     INITIALIZE PV-SQL-SUB.                                       00203903
039819                                                                  00204003
039820*9010-EXIT.                                                       00204103
039821 EJECT.                                                           00204203
039822                                                                  00204303
039823*----------------------------------------------------------       00204403
039830* 9100-FORMAT-DATE-INFO.                                          00204503
039840*     FORMATS THE DATE FOR COMPARING.                             00204603
039850*----------------------------------------------------------       00204703
039860 9100-FORMAT-DATE-INFO.                                           00204803
039870                                                                  00205003
039880     MOVE PV-PRC-EXC-DTE-CH-CCYY TO PV-PRC-EXC-DTE-CCYY.          00205103
039890     MOVE PV-PRC-EXC-DTE-CH-MM   TO PV-PRC-EXC-DTE-MM.            00205203
039900     MOVE PV-PRC-EXC-DTE-CH-DD   TO PV-PRC-EXC-DTE-DD.            00205303
040000                                                                  00205403
040100*9100-EXIT.                                                       00205503
040200 EJECT.                                                           00205603
040300                                                                  00205703
040400*----------------------------------------------------------       00205803
040500* 9999-WRAPUP.                                                    00205903
040600*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           00206003
040700*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           00206103
040800*     PROGRAM.                                                    00206203
040900*----------------------------------------------------------       00206303
041000 9999-WRAPUP.                                                     00206403
041200     MOVE PV-PGM-STATUS-CDE TO LV-PGM-STATUS-CDE.                 00206603
041300     MOVE PV-SQL-CODE       TO LV-LD-SQL-RETURN-CDE.              00206903
041400     MOVE PV-LD-STATUS-CDE  TO LV-LD-SEVERITY-LVL.                00207003
041500                                                                  00207103
041600*9999-EXIT.                                                       00207203
041700 EJECT.                                                           00207303
041800                                                                  00208000
