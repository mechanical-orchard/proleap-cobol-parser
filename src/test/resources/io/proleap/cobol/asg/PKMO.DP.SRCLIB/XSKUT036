000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    XSKUT036.                                         00040000
000500 AUTHOR.        ALEXIS KEIKER.                                    00050000
000600 DATE-WRITTEN.  JANUARY 27, 2002.                                 00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*            PRICE DETERMINATION CALLED MODULE                    00090000
001000*----------------------------------------------------------       00100000
001100* THIS PROGRAM WILL BE CALLED BY XSKUT035 AND ACCEPT IN           00110000
001110* A LINKAGE SECTION.  THIS LINKAGE SECTION WILL HAVE              00120000
001120* A CERTAIN ITEM THAT NEEDS THE PRICE DETERMINED PRICE.           00130000
001130* THIS PROGRAM WILL FOLLOW THE PRICE DETERMINATION RULES          00140000
001131* TO PICK THE CORRECT SIMPLE NON-GROUP PROMOTION, THE             00150000
001132* GROUP PROMOTION, AND THE TIERED PROMOTION.  ONCE THE            00160000
001133* PROGRAM HAS FOUND THIS INFORMATION IT WILL EXIT AND             00170000
001134* RETURN THE INFORMATION BACK TO XSKUT035.                        00180000
001135*----------------------------------------------------------       00190000
001136* HISTORY LOG:                                                    00200000
001137*                                                                 00210000
001138*----------------------------------------------------------       00220000
      * DATE:         06/18/2003                                        00230000
      * WR/IR#:       WR21428                                           00240000
      * PROGRAMMER:   KARI HAAK                                         00250000
      * DESCRIPTION:  MODIFIED PROGRAM TO RETURN LOWEST SIX WEEK        00260000
      * PRICE EVEN WHEN PROMO PRICES WERE NOT FOUND.                    00270000
001138*----------------------------------------------------------       00280000
      * DATE:         07/15/2003                                        00290000
      * WR/IR#:       WR21428                                           00300000
      * PROGRAMMER:   JODY TAINTER                                      00310000
      * DESCRIPTION:  MODIFIED PROGRAM TO RETURN TIMESTAMPS FOR         00320000
      * PD, GP, ADDL, BWP, AND TIERED.  ALSO CHANGED PROGRAM SO         00330000
      * GROUP PROMO IDS AND TYPE CODES ARE NOT PUT IN THE PD            00340000
      * OUTPUT FIELDS.                                                  00350000
      *----------------------------------------------------------       00360000
      * DATE:         09/03/2003                                        00370000
      * WR/IR#:       WR21428                                           00380000
      * PROGRAMMER:   JODY TAINTER                                      00390000
      * DESCRIPTION:  ADD WORKING STORAGE FILEDS FOR FOLLOWING          00400000
      * BATCH PDE.                                                      00410000
      *     PROMO INTERFACE ID                                          00420000
      *     PROMO MDSE LINE ID                                          00430000
      *     PROMO INTERFACE SUB ID                                      00440000
      *----------------------------------------------------------       00450000
      * DATE:         09/03/2003                                        00460000
      * WR/IR#:       WR21428                                           00470000
      * PROGRAMMER:   JODY TAINTER                                      00480000
      * DESCRIPTION:  ADD EBOGO CODE 'GBL'                              00490000
      *----------------------------------------------------------       00500000
      * DATE:         10/29/2003                                        00510000
      * WR/IR#:       P000603068                                        00520000
      * PROGRAMMER:   JODY TAINTER                                      00530000
      * DESCRIPTION:  FIX TO XSPD001 GROUP PRICING                      00540000
W26114*----------------------------------------------------------       00550000
W26114* DATE:         01/16/2004                                        00560000
W26114* WR/IR#:       WR26114                                           00570000
W26114* PROGRAMMER:   NANCY MARTIN                                      00580000
W26114* DESCRIPTION:  MODIFIED PROGRAM TO ACCOMODATE NEW BOGO CODES     00590000
W26114* OF GBP & GBD.                                                   00600000
W26114*                                                                 00610000
      *----------------------------------------------------------       00620000
      * DATE:         01/21/2004                                        00630001
      * WR/IR#:       P000619089                                        00640001
      * PROGRAMMER:   JODY TAINTER                                      00650001
      * DESCRIPTION:  FIX TO ROUNDING ERROR IN FIELD PV-PERCENT-VAL     00660001
      *               FIELD NEEDS TO BE S9(7)V9(5) LENGTH INORDER       00670001
      *               TO CALCULATE GOLDSTAR CORRECTLY.                  00680001
      *                                                                 00690001
      *----------------------------------------------------------       00700001
001139* DATE:                                                           00710000
001140* WR/IR#:                                                         00720000
001141* PROGRAMMER:                                                     00730000
001142* DESCRIPTION:                                                    00740000
001143*                                                                 00750000
001150*----------------------------------------------------------       00760000
001160 ENVIRONMENT DIVISION.                                            00770000
001170*----------------------------------------------------------       00780000
001180 CONFIGURATION SECTION.                                           00790000
001190 SOURCE-COMPUTER. IBM-3090.                                       00800000
001200 OBJECT-COMPUTER. IBM-3090.                                       00810000
001300                                                                  00820000
001500                                                                  00830000
001700                                                                  00840000
001800*----------------------------------------------------------       00850000
001900 DATA DIVISION.                                                   00860000
002000*----------------------------------------------------------       00870000
002200                                                                  00880000
002300                                                                  00890000
002400*---------------------------------------------------------        00900000
002500                                                                  00910000
002600 WORKING-STORAGE SECTION.                                         00920000
002700*---------------------------------------------------------        00930000
002800* PC- PROGRAM CONSTANTS                                           00940000
002900*----------------------------------------------------------       00950000
003000 01  PC-PROGRAM-CONSTANTS.                                        00960000
003100     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT036'. 00970000
003200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00980000
003210     05  PC-SUB-ONE                   PIC S9(02) VALUE +01.       00990000
003300                                                                  01000000
003400*----------------------------------------------------------       01010000
003500* PS- PROGRAM SWITCHES                                            01020000
003600*----------------------------------------------------------       01030000
003700 01  PS-PROGRAM-SWITCHES.                                         01040000
003800     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       01050000
003900         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       01060000
004000         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       01070000
004010     05  PS-PROMO-ID-FOUND-SW         PIC X(01)  VALUE 'Y'.       01080000
004020         88  PS-PROMO-ID-FOUND                   VALUE 'N'.       01090000
004030         88  PS-PROMO-ID-NOT-FOUND               VALUE 'Y'.       01100000
004040     05  PS-GP-PRC-CHECK-SW           PIC X(01)  VALUE 'Y'.       01110000
004050         88  PS-GP-PRC-WINS                      VALUE 'N'.       01120000
004060         88  PS-SMPL-PRC-WINS                    VALUE 'Y'.       01130000
004100                                                                  01140000
004200*----------------------------------------------------------       01150000
004300* PV- PROGRAM VARIABLES                                           01160000
004400*----------------------------------------------------------       01170000
004500 01 PV-PROGRAM-VARIABLES.                                         01180000
004600    05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.    01190000
004610    05  PV-TABLE-SIZE                PIC 9(05) VALUE 0.           01200000
004611    05  PV-PROMO-ID                  PIC S9(10)V VALUE +0 COMP-3. 01210000
004611    05  PV-PROMO-INTFC-ID            PIC S9(10)V VALUE +0 COMP-3. 01220000
004611    05  PV-PROMO-MDSE-LNE-ID         PIC S9(10)V VALUE +0 COMP-3. 01230000
004612    05  PV-AD-VERSION                PIC S9(4) VALUE +0 COMP.     01240000
004613    05  PV-PERCENT-VAL               PIC S9(07)V9(05)             01250001
004614                                               VALUE +0 COMP-3.   01260000
004617    05  PV-PRICE-DET-PRC             PIC S9(07)V9(02)             01270000
004618                                                 VALUE +0 COMP-3. 01280000
004619    05  PV-GP-INDV-GP-PRC            PIC S9(07)V9(02)             01290000
004620                                                 VALUE +0 COMP-3. 01300000
004619    05  PV-BOGO-INDV-PRC             PIC S9(07)V9(02)             01310000
004620                                                 VALUE +0 COMP-3. 01320000
004621    05  PV-RGLR-PRICE                PIC S9(07)V9(02)             01330000
004622                                                 VALUE +0 COMP-3. 01340000
004623    05  PV-PRICG-TYP-CDE             PIC X(03) VALUE SPACES.      01350000
004630        88  PV-TIERED                          VALUES 'TAP',      01360000
004640                                                      'TQP'.      01370000
004650        88  PV-SIMPLE                          VALUES 'SPO',      01380000
004660                          'SRP', 'SPP', 'CPO', 'CPP', 'MPP'.      01390000
004670        88  PV-GROUP-PRICG                     VALUES 'GAO'.      01400000
004670        88  PV-BOGO                            VALUES 'GBL',      01410000
W26114                                                 'GBD', 'GBP'.    01420000
004700    05  PV-TIERED-DATA.                                           01430000
004800        10 PV-TIERED-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 01440000
004900        10 PV-TIERED-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 01450000
004900        10 PV-TIERED-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 01460000
005000        10 PV-TIERED-STRT-DTE        PIC X(26) VALUE SPACES.      01470000
005100        10 PV-TIERED-END-DTE         PIC X(26) VALUE SPACES.      01480000
005200        10 PV-TIERED-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      01490000
005300        10 PV-TIERED-MRCH-HEIR-CDE   PIC X(03) VALUE SPACES.      01500000
005310                                                                  01510000
005400    05  PV-FINAL-SMPL-PRICG.                                      01520000
005401        10  PV-SMPL-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01530000
005402        10  PV-SMPL-INTFC-ID         PIC S9(10)V VALUE +0 COMP-3. 01540000
005402        10  PV-SMPL-MDSE-LNE-ID      PIC S9(10)V VALUE +0 COMP-3. 01550000
005403        10  PV-SMPL-STRT-DTE         PIC X(26) VALUE SPACES.      01560000
005404        10  PV-SMPL-END-DTE          PIC X(26) VALUE SPACES.      01570000
005410        10  PV-SMPL-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      01580000
005420        10  PV-SMPL-HEIR-CDE         PIC X(03) VALUE SPACES.      01590000
005500        10  PV-SMPL-PRC-DET-PRICE    PIC S9(07)V9(02)             01600000
005600                                               VALUE +0 COMP-3.   01610000
008200                                                                  01620000
005400    05  PV-FINAL-BOGO-PRICG.                                      01630000
005401        10  PV-BOGO-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01640000
005402        10  PV-BOGO-PRC-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 01650000
005402        10  PV-BOGO-PRC-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 01660000
005403        10  PV-BOGO-PRC-STRT-DTE     PIC X(26) VALUE SPACES.      01670000
005404        10  PV-BOGO-PRC-END-DTE      PIC X(26) VALUE SPACES.      01680000
005410        10  PV-BOGO-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      01690000
W26114        10  PV-BOGO-DISC-QTY         PIC S9(04) COMP VALUE +0.    01700002
W26114        10  PV-BOGO-DISC-AMT         PIC S9(07)V9(03)             01710002
W26114                                           VALUE +0 COMP-3.       01720002
008200                                                                  01730000
008201    05  PV-FINAL-GP-PRICG.                                        01740000
008202        10  PV-GP-PRC-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3. 01750000
008203        10  PV-GP-PRC-INTFC-ID       PIC S9(10)V VALUE +0 COMP-3. 01760000
008203        10  PV-GP-PRC-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3. 01770000
008204        10  PV-GP-PRC-STRT-DTE       PIC X(26) VALUE SPACES.      01780000
008205        10  PV-GP-PRC-END-DTE        PIC X(26) VALUE SPACES.      01790000
008206        10  PV-GP-PRC-TYP-CDE        PIC X(03) VALUE SPACES.      01800000
008207        10  PV-GP-PRC-HEIR-CDE       PIC X(03) VALUE SPACES.      01810000
008208        10  PV-GP-PRC-QTY            PIC S9(04) VALUE +0 COMP.    01820000
008209        10  PV-GP-PRC-DLR            PIC S9(07)V9(02)             01830000
008210                                               VALUE +0 COMP-3.   01840000
008211        10  PV-GP-PRC-IDV-PRICE      PIC S9(07)V9(02)             01850000
008212                                               VALUE +0 COMP-3.   01860000
008213                                                                  01870000
008214    05  PV-FINAL-PRICING.                                         01880000
008215        10  PV-FINAL-PRC-DET-PRC     PIC S9(07)V9(02)             01890000
008216                                               VALUE +0 COMP-3.   01900000
008217        10  PV-FINAL-PRC-TYP-CDE     PIC X(03) VALUE SPACES.      01910000
008218        10  PV-FINAL-DET-PROMO-ID    PIC S9(10)V VALUE +0 COMP-3. 01920000
008218        10  PV-FINAL-DET-INTFC-ID    PIC S9(10)V VALUE +0 COMP-3. 01930000
008218        10  PV-FINAL-DET-MDSE-LNE-ID PIC S9(10)V VALUE +0 COMP-3. 01940000
008204        10  PV-FINAL-PD-STRT-DTE     PIC X(26) VALUE SPACES.      01950000
008205        10  PV-FINAL-PD-END-DTE      PIC X(26) VALUE SPACES.      01960000
008219        10  PV-FINAL-GP-QTY          PIC S9(04) VALUE +0 COMP.    01970000
008220        10  PV-FINAL-GP-DLR          PIC S9(07)V9(02)             01980000
008221                                               VALUE +0 COMP-3.   01990000
008222        10  PV-FINAL-GP-IDV-PRC      PIC S9(07)V9(02)             02000000
008223                                               VALUE +0 COMP-3.   02010000
008224        10  PV-FINAL-GP-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 02020000
008224        10  PV-FINAL-GP-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02030000
008224        10  PV-FINAL-GP-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 02040000
008204        10  PV-FINAL-GP-STRT-DTE     PIC X(26) VALUE SPACES.      02050000
008205        10  PV-FINAL-GP-END-DTE      PIC X(26) VALUE SPACES.      02060000
008225        10  PV-FINAL-GP-TYP-CDE      PIC X(03) VALUE SPACES.      02070000
008226        10  PV-FINAL-LWST-SIX-PRC    PIC S9(07)V9(02)             02080000
008227                                               VALUE +0 COMP-3.   02090000
008232                                                                  02100000
008233*----------------------------------------------------------       02110000
008234* TBL- TABLE VARIABLES                                            02120000
008235*----------------------------------------------------------       02130000
008236 01 TBL-TIERED-TABLES.                                            02140000
008237    05  TBL-TIERED-TABLE.                                         02150000
008238        10 FILLER                     OCCURS 10 TIMES             02160000
008239                                      INDEXED BY TBL-TIER-INDEX.  02170000
008240           15 TBL-BUY-QTY            PIC S9(04) VALUE +0 COMP.    02180000
008241           15 TBL-BUY-DLR            PIC S9(07)V9(02)             02190000
008242                                                VALUE +0 COMP-3.  02200000
008243           15 TBL-GET-PCT            PIC S9(03)V9(03)             02210000
008244                                                VALUE +0 COMP-3.  02220000
008245           15 TBL-GET-DLR            PIC S9(07)V9(02)             02230000
008246                                                VALUE +0 COMP-3.  02240000
008247           15 TBL-INTFC-SUB-ID       PIC S9(10)V VALUE +0 COMP-3. 02250000
008248                                                                  02260000
008249 01 TBL-SMPL-TABLES.                                              02270000
008250    05  TBL-SMPL-PRICG-TABLE.                                     02280000
008251        10 FILLER                     OCCURS 1 TO 2000 TIMES      02290000
008252                                      DEPENDING ON PC-CNT-SMPL    02300000
008253                                      INDEXED BY TBL-SMPL-INDEX.  02310000
008254           15 TBL-PROMO-ID           PIC S9(10)V VALUE +0 COMP-3. 02320000
008255           15 TBL-PROMO-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02330000
008255           15 TBL-MDSE-LNE-ID        PIC S9(10)V VALUE +0 COMP-3. 02340000
008256           15 TBL-PROMO-STRT-DTE     PIC X(26) VALUE SPACES.      02350000
008257           15 TBL-PROMO-END-DTE      PIC X(26) VALUE SPACES.      02360000
008258           15 TBL-PRICG-TYP-CDE      PIC X(03) VALUE SPACES.      02370000
008259           15 TBL-MERCH-HEIR-CDE     PIC X(03) VALUE SPACES.      02380000
008260           15 TBL-PRICE-DET-PRC      PIC S9(07)V9(02)             02390000
008261                                                VALUE +0 COMP-3.  02400000
008262                                                                  02410000
008263 01 TBL-GP-TABLES.                                                02420000
008264    05  TBL-GP-PRICG-TABLE.                                       02430000
008265        10 FILLER                     OCCURS 1 TO 2000 TIMES      02440000
008266                                      DEPENDING ON PC-CNT-GP      02450000
008267                                      INDEXED BY TBL-GP-INDEX.    02460000
008268           15 TBL-GP-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 02470000
008269           15 TBL-GP-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 02480000
008269           15 TBL-GP-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 02490000
008270           15 TBL-GP-PROMO-STRT-DTE  PIC X(26) VALUE SPACES.      02500000
008271           15 TBL-GP-PROMO-END-DTE   PIC X(26) VALUE SPACES.      02510000
008272           15 TBL-GP-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      02520000
008273           15 TBL-GP-MERCH-HEIR-CDE  PIC X(03) VALUE SPACES.      02530000
008274           15 TBL-GP-GROUP-QTY       PIC S9(04) VALUE +0 COMP.    02540000
008275           15 TBL-GP-GROUP-PRC       PIC S9(07)V9(03) VALUE +0    02550000
008276                                                COMP-3.           02560000
008277           15 TBL-GP-INDV-GP-PRC     PIC S9(07)V9(02) VALUE +0    02570000
008278                                                COMP-3.           02580000
       01 TBL-BOGO-TABLES.                                              02590000
          05  TBL-BOGO-PRICG-TABLE.                                     02600000
              10 FILLER                     OCCURS 1 TO 200  TIMES      02610002
W26114                                      DEPENDING ON PC-CNT-BOGO    02620002
                                            INDEXED BY TBL-BOGO-INDEX.  02630000
                 15 TBL-BOGO-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3.02640000
                 15 TBL-BOGO-PROMO-INTFC-ID PIC S9(10)V VALUE +0 COMP-3.02650000
                 15 TBL-BOGO-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3.02660000
                 15 TBL-BOGO-PROMO-STRT-DTE PIC X(26) VALUE SPACES.     02670000
                 15 TBL-BOGO-PROMO-END-DTE  PIC X(26) VALUE SPACES.     02680000
                 15 TBL-BOGO-PRICG-TYP-CDE  PIC X(03) VALUE SPACES.     02690000
W26114           15 TBL-BOGO-DISC-QTY       PIC S9(04) COMP VALUE +0.   02700002
W26114           15 TBL-BOGO-DISC-AMT       PIC S9(07)V9(03)            02710002
W26114                                            VALUE +0 COMP-3.      02720002
                                                                        02730000
008279                                                                  02740000
008280*-----------------------------------------------------------      02750000
008281* PC- PROGRAM COUNTERS                                            02760000
008282*-----------------------------------------------------------      02770000
008283 01  PC-PROGRAM-COUNTERS.                                         02780000
008284     05  PC-CNT-GP                   PIC S9(04) VALUE +0.         02790000
008284     05  PC-CNT-BOGO                 PIC S9(04) VALUE +0.         02800000
008285     05  PC-CNT-SMPL                 PIC S9(04) VALUE +0.         02810000
008286     05  PC-HOLD-INDEX               PIC S9(04) VALUE +0.         02820000
008287     05  PC-TBL-SUB                  PIC S9(04) VALUE +0.         02830000
008288     05  PC-CNT-INDX                 PIC S9(04) VALUE +0.         02840000
008289     05  PC-CNT-NEW-INDX             PIC S9(04) VALUE +0.         02850000
008290                                                                  02860000
008820*----------------------------------------------------------       02870000
008821* COPYBOOK USED FOR INPUT.                                        02880000
008822*----------------------------------------------------------       02890000
008823     COPY XSRD042.                                                02900000
008824                                                                  02910000
008830*----------------------------------------------------------       02920000
008900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02930000
009000*----------------------------------------------------------       02940000
009100     COPY DPWS004.                                                02950000
009200                                                                  02960000
009300*---------------------------------------------                    02970000
009400*  DB2 COMMUNICATION AREA.                                        02980000
009500*---------------------------------------------                    02990000
009600     EXEC SQL                                                     03000000
009700          INCLUDE SQLCA                                           03010000
009800     END-EXEC.                                                    03020000
009900                                                                  03030000
009910*---------------------------------------------                    03040000
009920*  DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP MEMBERSHIP  03050000
009921*                                                TABLE            03060000
009930*---------------------------------------------                    03070000
009940     EXEC SQL                                                     03080000
009950          INCLUDE XST00023                                        03090000
009960     END-EXEC.                                                    03100000
009970                                                                  03110000
010000*---------------------------------------------                    03120000
010100*  DB2 TABLE EPT00011(EPT_LO_RTL) - LOWEST SIX WEEK PRICE TABLE   03130000
010200*---------------------------------------------                    03140000
010300     EXEC SQL                                                     03150000
010400          INCLUDE EPT00011                                        03160000
010500     END-EXEC.                                                    03170000
010600                                                                  03180000
010700 LINKAGE SECTION.                                                 03190000
010900*----------------------------------------------------------       03200000
011000* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          03210000
011100*----------------------------------------------------------       03220000
011910     COPY XSRD045.                                                03230000
011920                                                                  03240000
012000*----------------------------------------------------------       03250000
012100 PROCEDURE DIVISION USING XS045-BUS-RULE-LINKAGE.                 03260000
012200*----------------------------------------------------------       03270000
012300 0000-MAINLINE.                                                   03280000
012400                                                                  03290000
012500     PERFORM 1000-INITIALIZATION.                                 03300000
012600                                                                  03310000
012700     PERFORM 2000-PROCESS-PRICING                                 03320000
012800             UNTIL PS-PROCESS-COMPLETE.                           03330000
012900                                                                  03340000
013000     PERFORM 9999-WRAPUP.                                         03350000
013100                                                                  03360000
013200     EXIT PROGRAM.                                                03370000
013300                                                                  03380000
013400*0000-EXIT.                                                       03390000
013500 EJECT.                                                           03400000
013600                                                                  03410000
013700*----------------------------------------------------------       03420000
013800* 1000-INITIALIZATION.                                            03430000
013900*     INTIALIZES OR MOVES ANY VARIABLES.  CHECKS THE TABLE        03440000
014000*     IN THE LINKAGE SECTION TO SEE IF IT IS LEGIT.               03450000
014100*----------------------------------------------------------       03460000
014200 1000-INITIALIZATION.                                             03470000
014300                                                                  03480000
014310     INITIALIZE PC-PROGRAM-COUNTERS                               03490000
014311                PV-TIERED-DATA                                    03500000
014312                PV-FINAL-SMPL-PRICG                               03510000
014313                PV-FINAL-GP-PRICG                                 03520000
014313                PV-FINAL-BOGO-PRICG                               03530000
014314                PV-FINAL-PRICING                                  03540000
014315                XS045-VARIABLES-SENT-BACK.                        03550000
014320                                                                  03560000
014400     INITIALIZE TBL-TIERED-TABLE                                  03570000
014410         REPLACING ALPHANUMERIC DATA BY ZEROES                    03580000
014420                   NUMERIC DATA BY ZEROS.                         03590000
014421                                                                  03600000
014422     SET PS-SMPL-PRC-WINS TO TRUE.                                03610000
014423                                                                  03620000
014426     IF XS045-ELIG-PROMO-TBL-SZ = 0                               03630000
014427        MOVE XS045-RGLR-PRICE TO PV-FINAL-PRC-DET-PRC             03640000
              PERFORM 4000-CHECK-LWST-SIX-WK-PRC                        03650000
014428        SET PS-PROCESS-COMPLETE TO TRUE                           03660000
014429     ELSE                                                         03670000
014460        SET PS-PROCESS-CONTINUE TO TRUE                           03680000
016100     END-IF.                                                      03690000
016110                                                                  03700000
016200*1000-EXIT.                                                       03710000
016300 EJECT.                                                           03720000
016400                                                                  03730000
016500*----------------------------------------------------------       03740000
020220* 2000-PROCESS-PRICING.                                           03750000
020230*     THIS PROCESS ALL THE RECORDS THAT WERE SENT THROUGH         03760000
020240*     THE LINKAGE SECTION.  IT WILL SIFT THROUGH EACH RECORD      03770000
020250*     TO FIND OUT THE PRICE DETERMINED PRICE.                     03780000
020270*----------------------------------------------------------       03790000
020280 2000-PROCESS-PRICING.                                            03800000
020290                                                                  03810000
020292     PERFORM VARYING PC-TBL-SUB FROM 1 BY 1                       03820000
020293        UNTIL PC-TBL-SUB > XS045-ELIG-PROMO-TBL-SZ                03830000
020294            MOVE XS045-ELIG-PROMO-ID (PC-TBL-SUB) TO              03840000
020295                                     PV-PROMO-ID                  03850000
020296            MOVE XS045-PRICG-TYP-CDE (PC-TBL-SUB) TO              03860000
020297                                     PV-PRICG-TYP-CDE             03870000
020298            INITIALIZE XS042-PD-DETAIL-RECORD                     03880000
020299            PERFORM 2010-POPULATE-COPYBOOK                        03890000
020300            EVALUATE TRUE                                         03900000
020301                WHEN PV-TIERED                                    03910000
020302                     PERFORM 2100-CHECK-TIERED                    03920000
020303                WHEN PV-SIMPLE                                    03930000
020306                     PERFORM 2200-CHECK-SMPL-PRICG                03940000
020307                WHEN PV-GROUP-PRICG                               03950000
020310                     PERFORM 2300-CHECK-GP-PRICG                  03960000
020307                WHEN PV-BOGO                                      03970000
020310                     PERFORM 2400-CHECK-BOGO                      03980000
020311                WHEN OTHER                                        03990000
020312                     CONTINUE                                     04000000
020318            END-EVALUATE                                          04010000
020319     END-PERFORM.                                                 04020000
020320                                                                  04030000
020321     PERFORM 3000-PROCESS-PRC-DET.                                04040000
020322                                                                  04050000
020323     PERFORM 4000-CHECK-LWST-SIX-WK-PRC.                          04060000
020324                                                                  04070000
020325     SET PS-PROCESS-COMPLETE TO TRUE.                             04080000
020326                                                                  04090000
020327*2000-EXIT.                                                       04100000
020328 EJECT.                                                           04110000
020329                                                                  04120000
020330*----------------------------------------------------------       04130000
020331* 2010-POPULATE-COPYBOOK.                                         04140000
020332*     THIS POPULATES THE INPUT COPYBOOK WITH THE DATA             04150000
020333*     FROM THE LINKAGE SECTION.                                   04160000
020334*----------------------------------------------------------       04170000
020335 2010-POPULATE-COPYBOOK.                                          04180000
020336                                                                  04190000
020337     MOVE XS045-RGLR-PRICE             TO PV-RGLR-PRICE.          04200000
020338     MOVE XS045-INTR-UPC-ID            TO XS042-INTR-UPC-ID.      04210000
020339     MOVE XS045-ELIG-PROMO-ID(PC-TBL-SUB) TO XS042-ELIG-PROMO-ID. 04220000
020340     MOVE XS045-ELIG-PROMO-INTFC-ID(PC-TBL-SUB)                   04230000
020341                                    TO XS042-ELIG-PROMO-INTFC-ID. 04240000
020342     MOVE XS045-PROMO-STRT-DTE(PC-TBL-SUB)                        04250000
020343                                        TO XS042-PROMO-STRT-DTE.  04260000
020344     MOVE XS045-PROMO-END-DTE(PC-TBL-SUB)                         04270000
020345                                        TO XS042-PROMO-END-DTE.   04280000
020346     MOVE XS045-PRICG-TYP-CDE(PC-TBL-SUB)                         04290000
020347                                        TO XS042-PRICG-TYP-CDE.   04300000
020348     MOVE XS045-MRCH-HIER-CDE(PC-TBL-SUB)                         04310000
020349                                        TO XS042-MRCH-HEIR-CDE.   04320000
020350     MOVE XS045-DISC-GP-QTY(PC-TBL-SUB) TO XS042-DISC-GP-QTY.     04330000
020351     MOVE XS045-DISC-GP-AMT(PC-TBL-SUB) TO XS042-DISC-GP-AMT.     04340000
020352                                                                  04350000
020353     IF PV-TIERED                                                 04360000
020355        PERFORM VARYING XS045-ELIG-TIER-INDEX FROM 1 BY 1         04370000
020357           UNTIL XS045-ELIG-TIER-INDEX > 10                       04380000
020358              OR XS045-PROMO-INTFC-SUB-ID                         04390000
020359                 (PC-TBL-SUB XS045-ELIG-TIER-INDEX) = 0           04400000
020360                 SET XS042-TIER-INDEX TO XS045-ELIG-TIER-INDEX    04410000
020361                 MOVE XS045-BUY-QTY                               04420000
020362                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04430000
020363                       TO XS042-BUY-QTY(XS042-TIER-INDEX)         04440000
020364                 MOVE XS045-BUY-DLR                               04450000
020365                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04460000
020366                       TO XS042-BUY-DLR(XS042-TIER-INDEX)         04470000
020367                 MOVE XS045-GET-PCT                               04480000
020368                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04490000
020369                       TO XS042-GET-PCT(XS042-TIER-INDEX)         04500000
020370                 MOVE XS045-GET-DLR                               04510000
020371                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04520000
020372                       TO XS042-GET-DLR(XS042-TIER-INDEX)         04530000
020373                 MOVE XS045-PROMO-INTFC-SUB-ID                    04540000
020374                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04550000
020375                       TO XS042-INTFC-SUB-ID(XS042-TIER-INDEX)    04560000
020376        END-PERFORM                                               04570000
020377     END-IF.                                                      04580000
020378                                                                  04590000
020379*2010-EXIT.                                                       04600000
020380 EJECT.                                                           04610000
020381                                                                  04620000
020382*** THIS MEMBER HOLDS THE REST OF THE CODE FOR THIS PROGRAM       04630000
020383     COPY XSPD001.                                                04640000
020384                                                                  04650000
020390*----------------------------------------------------------       04660000
020400* 4000-CHECK-LWST-SIX-WK-PRC.                                     04670000
020500*     CHECKS TO SEE IF THE LOWEST SIX WEEK PRICE IS NEEDED.       04680000
020600*     IF IT IS NEEDED IT WILL SELECT IT FROM THE LOWEST           04690000
020700*     RETAIL AMOUNT TABLE.                                        04700000
020800*----------------------------------------------------------       04710000
020900 4000-CHECK-LWST-SIX-WK-PRC.                                      04720000
021000                                                                  04730000
021100     IF XS045-LWST-SIX-WK-NEEDED-IND = 'Y'                        04740000
021200        PERFORM 4100-SELECT-AD-VERSION                            04750000
021210        IF PV-AD-VERSION NOT = 0                                  04760000
021300           PERFORM 4200-SELECT-LWST-6-WK-PRC                      04770000
021310        END-IF                                                    04780000
021400     END-IF.                                                      04790000
021410                                                                  04800000
021500*4000-EXIT.                                                       04810000
021600 EJECT.                                                           04820000
021700                                                                  04830000
021800*----------------------------------------------------------       04840000
021900* 4100-SELECT-AD-VERSION.                                         04850000
022000*     SELECTS WHAT AD VERSION BELONGS TO A SPECIFIC STORE.        04860000
022100*----------------------------------------------------------       04870000
022200 4100-SELECT-AD-VERSION.                                          04880000
022300                                                                  04890000
022400     PERFORM                                                      04900000
022500         WITH TEST AFTER                                          04910000
022600         VARYING PV-SQL-SUB                                       04920000
022700         FROM 1 BY 1                                              04930000
022800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04940000
022900                   OR  SQLCODE NOT = -904 AND -911 AND -913)      04950000
023000                                                                  04960000
023100          EXEC SQL                                                04970000
023200               SELECT  STR_GP_ID                                  04980000
023300                 INTO :PV-AD-VERSION                              04990000
023400                 FROM XST_STR_GP_MBSHP                            05000000
023500                WHERE STR_NBR        = :XS045-STORE               05010000
023600                  AND STR_GP_TYP_CDE = 4000                       05020000
023700                  AND EFF_BEG_DTE   <= :XS045-DATE                05030000
023800                  AND (EFF_END_DTE   > :XS045-DATE                05040000
023900                   OR  EFF_END_DTE  IS NULL)                      05050000
024000                WITH UR                                           05060000
024100          END-EXEC                                                05070000
024200                                                                  05080000
024300          EVALUATE TRUE                                           05090000
024400              WHEN SQLCODE = -904                                 05100000
024500              WHEN SQLCODE = -911                                 05110000
024600              WHEN SQLCODE = -913                                 05120000
024700                   CONTINUE                                       05130000
024800              WHEN SQLCODE = ZERO                                 05140000
024900                   CONTINUE                                       05150000
025000              WHEN SQLCODE NOT EQUAL ZERO                         05160000
025100                   MOVE '4100-SELECT-AD-VERSION' TO               05170000
025101                                           XS045-ERROR-SECT-NAME  05180000
025110                   MOVE SQLCODE TO XS045-SQL-CODE                 05190000
025120                   MOVE ZEROES TO PV-AD-VERSION                   05200000
025200          END-EVALUATE                                            05210000
025300     END-PERFORM.                                                 05220000
025400                                                                  05230000
025500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05240000
025600        MOVE '4100-SELECT-AD-VERSION' TO XS045-ERROR-SECT-NAME    05250000
025700        MOVE SQLCODE TO XS045-SQL-CODE                            05260000
025800        MOVE ZEROES TO PV-AD-VERSION                              05270000
026100     END-IF.                                                      05280000
026200                                                                  05290000
026300*3500-EXIT.                                                       05300000
026400 EJECT.                                                           05310000
026500                                                                  05320000
026600*----------------------------------------------------------       05330000
026700* 4200-SELECT-LWST-6-WK-PRC.                                      05340000
026800*     SELECTS THE LOWEST 6-WEEK PRICE DETERMINED FOR THE          05350000
026900*     SKU/AD VERSION LEVEL.                                       05360000
027000*----------------------------------------------------------       05370000
027100 4200-SELECT-LWST-6-WK-PRC.                                       05380000
027200                                                                  05390000
027300     PERFORM                                                      05400000
027400         WITH TEST AFTER                                          05410000
027500         VARYING PV-SQL-SUB                                       05420000
027600         FROM 1 BY 1                                              05430000
027700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05440000
027800                   OR  SQLCODE NOT = -904 AND -911 AND -913)      05450000
027900                                                                  05460000
028000          EXEC SQL                                                05470000
028100               SELECT  MIN(UNT_RTL_AMT)                           05480000
028200                 INTO :PV-FINAL-LWST-SIX-PRC                      05490000
028300                 FROM EPT_LO_RTL                                  05500000
028400                WHERE INTR_UPC_ID    = :XS045-INTR-UPC-ID         05510000
028500                  AND STR_GP_TYP_CDE = 4000                       05520000
028600                  AND STR_GP_ID      = :PV-AD-VERSION             05530000
028700                WITH UR                                           05540000
028800          END-EXEC                                                05550000
028900                                                                  05560000
029000          EVALUATE TRUE                                           05570000
029100              WHEN SQLCODE = -904                                 05580000
029200              WHEN SQLCODE = -911                                 05590000
029300              WHEN SQLCODE = -913                                 05600000
029400                  CONTINUE                                        05610000
029500              WHEN SQLCODE = ZERO                                 05620000
029600                   CONTINUE                                       05630000
029700              WHEN SQLCODE = +100 OR -305                         05640000
029800                   MOVE 0 TO PV-FINAL-LWST-SIX-PRC                05650000
029900              WHEN SQLCODE NOT EQUAL ZERO                         05660000
030000                   MOVE '4200-SELECT-LWST-6-WK-PRC' TO            05670000
030100                                        XS045-ERROR-SECT-NAME     05680000
030200                   MOVE SQLCODE TO XS045-SQL-CODE                 05690000
030500          END-EVALUATE                                            05700000
030600     END-PERFORM.                                                 05710000
030700                                                                  05720000
030800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05730000
030900        MOVE '4200-SELECT-LWST-6-WK-PRC' TO                       05740000
031000                                 XS045-ERROR-SECT-NAME            05750000
031100        MOVE SQLCODE TO XS045-SQL-CODE                            05760000
031400     END-IF.                                                      05770000
031500                                                                  05780000
031600*4200-EXIT.                                                       05790000
031700 EJECT.                                                           05800000
031800                                                                  05810000
042800*----------------------------------------------------------       05820000
042900* 9999-WRAPUP.                                                    05830000
043000*     MOVES ALL VARIABLES TO THE LINKAGE SECTION SO THEY          05840000
043100*     CAN BE PASSED BACK TO THE CALLING PROGRAM.                  05850000
043300*----------------------------------------------------------       05860000
043400 9999-WRAPUP.                                                     05870000
043500                                                                  05880000
043600     MOVE PV-FINAL-PRC-DET-PRC    TO XS045-PD-PRICE.              05890000
043700     MOVE PV-FINAL-PRC-TYP-CDE    TO XS045-PD-PRC-PRC-TYP-CDE.    05900000
043800     MOVE PV-FINAL-DET-PROMO-ID   TO XS045-PD-PROMO-ID.           05910000
008204     MOVE PV-FINAL-PD-STRT-DTE    TO XS045-PD-STRT-TMST.          05920000
008205     MOVE PV-FINAL-PD-END-DTE     TO XS045-PD-END-TMST.           05930000
043810     MOVE PV-FINAL-GP-QTY         TO XS045-PROMO-GP-PRICG-QTY.    05940000
043820     MOVE PV-FINAL-GP-DLR         TO XS045-PROMO-GP-PRICG-DLR.    05950000
043821     MOVE PV-FINAL-GP-PROMO-ID    TO XS045-PROMO-GP-PROMO-ID.     05960000
043822     MOVE PV-FINAL-GP-TYP-CDE     TO XS045-PROMO-GP-PRICG-TYP-CDE.05970000
043830     MOVE PV-FINAL-LWST-SIX-PRC   TO XS045-LWST-SIX-WEEK-PRICE.   05980000
008204     MOVE PV-FINAL-GP-STRT-DTE    TO XS045-PROMO-GP-STRT-TMST.    05990000
008205     MOVE PV-FINAL-GP-END-DTE     TO XS045-PROMO-GP-END-TMST.     06000000
043900                                                                  06010000
      *                                                                 06020000
      * EBOGO                                                           06030000
      *                                                                 06040000
040400     MOVE PV-BOGO-PRC-PROMO-ID    TO XS045-EBOGO-PROMO-ID.        06050000
040600     MOVE PV-BOGO-PRC-INTFC-ID    TO XS045-EBOGO-INTFC-ID.        06060000
040600     MOVE PV-BOGO-PRC-MDSE-LNE-ID TO XS045-EBOGO-MDSE-LNE-ID.     06070000
040800     MOVE PV-BOGO-PRC-STRT-DTE    TO XS045-EBOGO-STRT-TMST.       06080000
041000     MOVE PV-BOGO-PRC-END-DTE     TO XS045-EBOGO-END-TMST.        06090000
041200     MOVE PV-BOGO-PRC-TYP-CDE     TO XS045-EBOGO-PRICG-TYP-CDE.   06100000
W26114     MOVE PV-BOGO-DISC-QTY        TO XS045-EBOGO-DISC-QTY.        06110003
W26114     MOVE PV-BOGO-DISC-AMT        TO XS045-EBOGO-DISC-AMT.        06120003
041700                                                                  06130000
043910     IF PV-FINAL-PRC-TYP-CDE NOT = 'SRP'                          06140000
043911        MOVE PV-TIERED-PROMO-ID TO XS045-TIERED-PROMO-ID          06150000
043912        MOVE PV-TIERED-PRICG-TYP-CDE                              06160000
043913                                TO XS045-TIERED-PRICG-TYP-CDE     06170000
006300        MOVE PV-TIERED-STRT-DTE TO XS045-TIERED-STRT-TMST         06180000
006400        MOVE PV-TIERED-END-DTE  TO XS045-TIERED-END-TMST          06190000
043915        PERFORM VARYING TBL-TIER-INDEX FROM 1 BY 1                06200000
043916           UNTIL TBL-TIER-INDEX > 10                              06210000
043917              OR TBL-INTFC-SUB-ID(TBL-TIER-INDEX) = 0             06220000
043918                 SET TIER-INDEX TO TBL-TIER-INDEX                 06230000
043919                 MOVE TBL-BUY-QTY(TBL-TIER-INDEX) TO              06240000
043920                             XS045-TIER-BUY-QTY(TIER-INDEX)       06250000
043921                 MOVE TBL-BUY-DLR(TBL-TIER-INDEX) TO              06260000
043922                             XS045-TIER-BUY-DLR(TIER-INDEX)       06270000
043923                 MOVE TBL-GET-PCT(TBL-TIER-INDEX) TO              06280000
043924                             XS045-TIER-GET-PCT(TIER-INDEX)       06290000
043925                 MOVE TBL-GET-DLR(TBL-TIER-INDEX) TO              06300000
043926                             XS045-TIER-GET-DLR(TIER-INDEX)       06310000
043927        END-PERFORM                                               06320000
043935     END-IF.                                                      06330000
043940                                                                  06340000
044000*9999-EXIT.                                                       06350000
044100 EJECT.                                                           06360000
044200                                                                  06370000
