       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    SDKUT155.                                         00020000
       AUTHOR.        JACKIE HELING                                     00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  02-08-01.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      *      DATABASES USED:   DB2 - YES   ORACLE - NO                  00081001
      *      UPDATES SDT-WKLY-STR-BGT (SDT00000)                        00082002
      *              ONLY "AC" BGTD-TYP-CDE ROWS                        00083005
      *                                                                 00084004
      *    LOAD WEEKLY FLASH SALES TO THE STORE ADMIN DATABASE.         00090000
      *                                                                 00100000
      *   THIS PROGRAM READS IN THE WEEKLY FLASH FILE, AND UPDATES      00110000
      *   THE STORE RECORD FOR A PARTICULAR FISCAL WEEK ENDING DATE     00120000
      *   WITH ACTUAL SALES DOLLARS.  SDT_WKLY_STR_BGT IS THE TABLE     00130000
      *   WHICH HOUSES THE INFORMATION FOR STORE ADMIN.                 00140000
      ******************************************************************00150000
      *  CHANGE HISTORY                                                 00160000
      ******************************************************************00170000
100801* 10/08/01    JACKIE HELING      PITS 425635                      00180000
100801*             ADD NOT NUMERIC CHECK                               00190000
031207* 03/12/2007  BRYAN BUKOWSKI     PITS 993656                      00191011
031207*             CHANGE THE INPUT FILE RECORD LENGTH                 00192011
031207* 12/12/2007  CHERI PARMLEY      INC  185969                      00193018
031207*             ADD THE XST00001 TABLE TO CHECK IF STORE IS FROM    00194018
031207*             E-COMM, IF SO BYPASS STORE, AND DO NOT UPDATE TABLE 00195032
      ******************************************************************00200000
       ENVIRONMENT DIVISION.                                            00210000
       CONFIGURATION SECTION.                                           00220000
       SOURCE-COMPUTER.  IBM-3090.                                      00230000
       OBJECT-COMPUTER.  IBM-3090.                                      00240000
                                                                        00250000
       INPUT-OUTPUT SECTION.                                            00260000
       FILE-CONTROL.                                                    00270000
                                                                        00280000
           SELECT WEEKLY-FLASH-FILE                                     00290000
               ASSIGN TO INP01.                                         00300000
                                                                        00310000
       DATA DIVISION.                                                   00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
       FD  WEEKLY-FLASH-FILE                                            00350000
           RECORDING MODE IS F                                          00360000
           LABEL RECORDS ARE STANDARD                                   00370000
031207*    RECORD CONTAINS 80 CHARACTERS                                00380011
031207     RECORD CONTAINS 91 CHARACTERS                                00381011
           BLOCK CONTAINS 0 RECORDS                                     00390000
           DATA RECORD IS WEEKLY-FLASH-RECORD.                          00400000
                                                                        00410000
031207*01  WEEKLY-FLASH-RECORD             PIC X(80).                   00420011
031207 01  WEEKLY-FLASH-RECORD             PIC X(91).                   00421011
                                                                        00430000
       WORKING-STORAGE SECTION.                                         00440000
       01  PC-PROGRAM-CONSTANTS.                                        00450000
           05  PC-PROGRAM                  PIC X(08) VALUE 'SDKUT155'.  00460000
                                                                        00470000
       01  PV-PROGRAM-VARIABLES.                                        00480000
           05  PV-PARA-NAME                PIC X(25) VALUE SPACES.      00490000
           05  PV-ABEND-NOTE               PIC X(40) VALUE SPACES.      00500000
           05  PV-WEEK-IN-MONTH            PIC 9(02) VALUE ZEROES.      00510000
           05  PV-NUMERIC-STORE            PIC 9(04) VALUE ZEROES.      00520002
           05  PV-NBR-READS                PIC  9(9) VALUE 0.           00521008
           05  PV-NBR-UPDATES              PIC  9(9) VALUE 0.           00522008
           05  PV-NBR-NOT-FOUND            PIC  9(9) VALUE 0.           00523008
                                                                        00530000
       01  SW-SWITCHES.                                                 00540000
           05  SW-WF-EOF                   PIC X(01) VALUE 'N'.         00550000
           05  IS-VALID-LOC                PIC X(01) VALUE 'N'.         00551020
               88  VALID-LOC                         VALUE 'Y'.         00552020
                                                                        00553020
       01  WS-WORK-FIELDS.                                              00570000
           05  WS-SLS-AMT                  PIC S9(9)V99 COMP-3 VALUE 0. 00580000
                                                                        00590000
           05  WS-CURR-STORE               PIC S9(04) COMP.             00600000
           05  WS-DATE.                                                 00610000
               10 WS-YEAR                  PIC 9(02) VALUE ZEROES.      00620000
               10 WS-MONTH                 PIC 9(02) VALUE ZEROES.      00630000
               10 WS-DAY                   PIC 9(02) VALUE ZEROES.      00640000
                                                                        00650000
           05  WS-GREG-DATE.                                            00660000
               10 WS-GREG-MONTH            PIC 9(02) VALUE ZEROES.      00670000
               10 WS-GREG-DAY              PIC 9(02) VALUE ZEROES.      00680000
               10 WS-GREG-YEAR             PIC 9(02) VALUE ZEROES.      00690000
                                                                        00700000
           05  WS-WK-END-DTE               PIC X(10) VALUE SPACES.      00710000
           05  WS-WORK-DATE                PIC X(10) VALUE SPACES.      00720000
                                                                        00730000
       01  SD-TIME-STAMP                   PIC  X(26)  VALUE SPACES.    00740000
       01  FILLER REDEFINES SD-TIME-STAMP.                              00750000
           05  SD-CURR-DTE                 PIC  X(10).                  00760000
           05  FILLER                      PIC  X(01).                  00770000
           05  SD-HOUR                     PIC  X(02).                  00780000
           05  FILLER                      PIC  X(01).                  00790000
           05  SD-MINUTE                   PIC  X(02).                  00800000
           05  FILLER                      PIC  X(01).                  00810000
           05  SD-SECOND                   PIC  X(02).                  00820000
           05  FILLER                      PIC  X(01).                  00830000
           05  SD-MICROSEC                 PIC  X(06).                  00840000
                                                                        00850000
       01  ABEND-CODE                  PIC S9(04)  VALUE +0 COMP SYNC.  00860000
           88  AC-OPEN-FILE-ERROR                  VALUE +4005.         00870000
           88  AC-CLOSE-FILE-ERROR                 VALUE +4006.         00880000
           88  AC-DB2-ERROR                        VALUE +4013.         00890000
           88  AC-DATE-ROUTINE-ERROR               VALUE +4019.         00900000
           88  AC-LOGIC-ERROR                      VALUE +4020.         00910000
      *----------------------------------------------------------------*00920000
      * FILE LAYOUT FOR INPUT FILE                                      00930000
      *----------------------------------------------------------------*00940000
           COPY SDRD155.                                                00950000
                                                                        00960000
      *----------------------------------------------------------------*00970000
      * PARAMETER LIST FOR THE CALENDAR ROUTINE                         00980000
      *----------------------------------------------------------------*00990000
           COPY DPWS500.                                                01000000
                                                                        01010000
      *----------------------------------------------------------------*01020000
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01030000
      *----------------------------------------------------------------*01040000
           COPY DPWS004.                                                01050000
                                                                        01060000
      *----------------------------------------------------------------*01070000
      * DB2 MESSAGE AREA                                                01080000
      *----------------------------------------------------------------*01090000
           COPY SQLCA2.                                                 01100000
                                                                        01110000
      *----------------------------------------------------------------*01120000
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 01130000
      *----------------------------------------------------------------*01140000
           EXEC SQL                                                     01150000
               INCLUDE SQLCA                                            01160000
           END-EXEC.                                                    01170021
                                                                        01180000
      *----------------------------------------------------------------*01190000
      * SDT_WKLY_STR_BGT TABLE                                          01200000
      *----------------------------------------------------------------*01210000
           EXEC SQL                                                     01220000
               INCLUDE SDT00000                                         01230000
           END-EXEC.                                                    01240000
      *----------------------------------------------------------------*01241018
      * XST_LOC TABLE                                                   01242018
      *----------------------------------------------------------------*01243018
121207     EXEC SQL                                                     01244033
121207         INCLUDE XST00001                                         01245033
121207     END-EXEC.                                                    01246033
                                                                        01250000
       PROCEDURE DIVISION.                                              01260000
       000-MAIN.                                                        01270000
                                                                        01281012
           PERFORM 100-INIT-HOUSEKEEPING.                               01290000
           PERFORM 300-READ-WF-FILE.                                    01300000
                                                                        01310000
           PERFORM UNTIL SW-WF-EOF = 'Y'                                01320000
              PERFORM 300-READ-WF-FILE                                  01330000
              IF SW-WF-EOF = 'N'                                        01340000
                 PERFORM 400-UPDATE-DB-RECORD                           01350000
              END-IF                                                    01360000
           END-PERFORM.                                                 01370000
                                                                        01380000
           PERFORM 9999-FINAL-HOUSEKEEPING.                             01390000
                                                                        01400000
           STOP RUN.                                                    01410000
           EJECT                                                        01420000
                                                                        01430000
       100-INIT-HOUSEKEEPING.                                           01440000
                                                                        01450000
           OPEN INPUT WEEKLY-FLASH-FILE.                                01460000
           ACCEPT WS-DATE FROM DATE.                                    01470000
           DISPLAY 'WS-DATE IS ------> '                                01471002
                    WS-DATE.                                            01472002
           PERFORM 1100-GET-TIMESTAMP.                                  01480000
           PERFORM 800-GET-WEEK-END-DATE.                               01490000
                                                                        01500000
           EJECT                                                        01510000
                                                                        01520000
       300-READ-WF-FILE.                                                01530000
                                                                        01540000
           READ WEEKLY-FLASH-FILE                                       01550000
              AT END                                                    01560000
                 MOVE 'Y' TO SW-WF-EOF                                  01570000
              NOT AT END                                                01580000
                 MOVE WEEKLY-FLASH-RECORD TO PR155-ACTUAL-SALES-AREA    01590000
                 MOVE PR155-AS-STORE-NUM TO PV-NUMERIC-STORE            01600000
                 MOVE PV-NUMERIC-STORE TO WS-CURR-STORE                 01610000
                 DISPLAY 'CURRENT STORE - ' WS-CURR-STORE               01611007
                 ADD 1 TO PV-NBR-READS                                  01620007
           END-READ.                                                    01630000
           EJECT                                                        01640000
                                                                        01650000
       400-UPDATE-DB-RECORD.                                            01660000
                                                                        01670000
121207     PERFORM 510-DETERMINE-LOC.                                   01671020
121207     IF VALID-LOC                                                 01671520
                                                                        01672020
               PERFORM 500-DETERMINE-SALES                              01680020
                                                                        01690000
               EXEC SQL                                                 01700027
               UPDATE SDT_WKLY_STR_BGT                                  01710027
               SET SLS_AMT = :WS-SLS-AMT                                01720027
                  ,LAST_UPD_TMST = :SD-TIME-STAMP                       01730027
               WHERE STR_NBR = :WS-CURR-STORE                           01740027
                     AND BGTD_TYP_CDE = 'AC'                            01750027
                     AND WK_END_DTE = :WS-WK-END-DTE                    01760027
               END-EXEC                                                 01770027
                                                                        01780000
               EVALUATE TRUE                                            01790027
                   WHEN SQLCODE = +0                                    01800027
                       PERFORM 1200-COMMIT                              01810027
                       ADD 1 TO PV-NBR-UPDATES                          01811027
                   WHEN SQLCODE = +100                                  01820027
                       DISPLAY 'ROW FOR UPDATE NOT FOUND - '            01821027
                                WS-CURR-STORE                           01821127
                               ' - '                                    01821227
                                WS-SLS-AMT                              01821327
                               ' - '                                    01821427
                                WS-WK-END-DTE                           01821527
                                                                        01822027
                       ADD 1 TO PV-NBR-NOT-FOUND                        01823030
                       MOVE '400-UPDATE-DB-RECORD' TO PV-PARA-NAME      01830030
                       MOVE '***ROW FOR UPDATE NOT FOUND***'            01840030
                                                      TO PV-ABEND-NOTE  01850030
BLBTMP                 PERFORM 1000-DB2-ABEND                           01860030
                   WHEN SQLCODE = -913                                  01870027
                       MOVE '400-UPDATE-DB-RECORD' TO PV-PARA-NAME      01880027
                       MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE     01890027
                       PERFORM 1000-DB2-ABEND                           01900027
                   WHEN SQLCODE = -904                                  01910027
                       MOVE '400-UPDATE-DB-RECORD' TO PV-PARA-NAME      01920027
                       MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE     01930027
                       PERFORM 1000-DB2-ABEND                           01940027
                   WHEN OTHER                                           01950027
                       MOVE '400-UPDATE-DB-RECORD' TO PV-PARA-NAME      01960027
                       PERFORM 1000-DB2-ABEND                           01970027
               END-EVALUATE                                             01980027
121207     END-IF.                                                      01981020
                                                                        01990000
           EJECT                                                        02000000
                                                                        02010000
       500-DETERMINE-SALES.                                             02020000
                                                                        02030000
           EVALUATE PV-WEEK-IN-MONTH                                    02050000
              WHEN 1                                                    02060000
100801          IF PR155-AS-WK1-AMT = SPACES                            02070000
100801             MOVE 0 TO PR155-AS-WK1-AMT                           02080000
100801          ELSE                                                    02090000
                   IF PR155-AS-WK1-CENTS > 50                           02100000
                      ADD 1 TO PR155-AS-WK1-AMT                         02110000
                   END-IF                                               02120000
100801          END-IF                                                  02130000
                MOVE PR155-AS-WK1-AMT TO WS-SLS-AMT                     02140000
              WHEN 2                                                    02150000
100801          IF PR155-AS-WK2-AMT = SPACES                            02160000
100801             MOVE 0 TO PR155-AS-WK2-AMT                           02170000
100801          ELSE                                                    02180000
                   IF PR155-AS-WK2-CENTS > 50                           02190000
                      ADD 1 TO PR155-AS-WK2-AMT                         02200000
                   END-IF                                               02210000
100801          END-IF                                                  02220000
                MOVE PR155-AS-WK2-AMT TO WS-SLS-AMT                     02230000
              WHEN 3                                                    02240000
100801          IF PR155-AS-WK3-AMT = SPACES                            02250000
100801             MOVE 0 TO PR155-AS-WK3-AMT                           02260000
100801          ELSE                                                    02270000
                   IF PR155-AS-WK3-CENTS > 50                           02280000
                      ADD 1 TO PR155-AS-WK3-AMT                         02290000
                   END-IF                                               02300000
100801          END-IF                                                  02310000
                MOVE PR155-AS-WK3-AMT TO WS-SLS-AMT                     02320000
              WHEN 4                                                    02330000
100801          IF PR155-AS-WK4-AMT = SPACES                            02340000
100801             MOVE 0 TO PR155-AS-WK4-AMT                           02350000
100801          ELSE                                                    02360000
                   IF PR155-AS-WK4-CENTS > 50                           02370000
                      ADD 1 TO PR155-AS-WK4-AMT                         02380000
                   END-IF                                               02390000
100801          END-IF                                                  02400000
                MOVE PR155-AS-WK4-AMT TO WS-SLS-AMT                     02410000
              WHEN 5                                                    02420000
100801          IF PR155-AS-WK5-AMT = SPACES                            02430000
100801             MOVE 0 TO PR155-AS-WK5-AMT                           02440000
100801          ELSE                                                    02450000
                   IF PR155-AS-WK5-CENTS > 50                           02460000
                      ADD 1 TO PR155-AS-WK5-AMT                         02470000
                   END-IF                                               02480000
100801          END-IF                                                  02490000
                MOVE PR155-AS-WK5-AMT TO WS-SLS-AMT                     02500000
              WHEN OTHER                                                02510000
                MOVE 'INVALID NUMBER OF WEEKS IN MONTH' TO              02520000
                                 PV-ABEND-NOTE                          02530000
                MOVE '500-DETERMINE-SALES' TO PV-PARA-NAME              02540000
                SET AC-LOGIC-ERROR TO TRUE                              02550000
                PERFORM 900-NON-DB2-ABEND                               02560000
           END-EVALUATE.                                                02570000
           EJECT                                                        02580000
                                                                        02590000
121207************************************************************      02590120
121207* IF E-BUS-IND = Y ITS AN E-COMM STORE, DONT INCLUDE       *      02590231
121207************************************************************      02590320
121207 510-DETERMINE-LOC.                                               02591020
           MOVE 'N'           TO IS-VALID-LOC.                          02591220
           MOVE WS-CURR-STORE TO XST00001-LOC-NBR.                      02591320
                                                                        02591520
           EXEC SQL                                                     02591620
               SELECT E_BUS_IND                                         02591720
               INTO :XST00001-E-BUS-IND                                 02591820
               FROM XST_LOC                                             02591920
               WHERE LOC_NBR = :XST00001-LOC-NBR                        02592020
                 AND E_BUS_IND = 'N'                                    02592120
           END-EXEC.                                                    02592220
                                                                        02592320
           EVALUATE TRUE                                                02592420
               WHEN SQLCODE = +0                                        02592520
                   MOVE 'Y' TO IS-VALID-LOC                             02592620
               WHEN SQLCODE = +100                                      02592820
                   MOVE 'N' TO IS-VALID-LOC                             02592920
               WHEN SQLCODE = -913                                      02594920
                   MOVE '510-DETERMINE-LOC   ' TO PV-PARA-NAME          02595020
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         02595120
                   PERFORM 1000-DB2-ABEND                               02595220
               WHEN SQLCODE = -904                                      02595320
                   MOVE '510-DETERMINE-LOC   ' TO PV-PARA-NAME          02595420
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         02595520
                   PERFORM 1000-DB2-ABEND                               02595620
               WHEN OTHER                                               02595720
                   MOVE '510-DETERMINE-LOC   ' TO PV-PARA-NAME          02595820
                   PERFORM 1000-DB2-ABEND                               02595920
           END-EVALUATE.                                                02596023
                                                                        02597020
       600-CALL-DATE-ROUTINE.                                           02600000
                                                                        02610000
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                02620000
                                                   DPG52                02630000
                                                   DPG53                02640000
                                                   DPG54                02650000
                                                   DPG55                02660000
                                                   DPG56.               02670000
           EJECT                                                        02680000
                                                                        02690000
       800-GET-WEEK-END-DATE.                                           02700000
                                                                        02710000
           MOVE WS-YEAR TO WS-GREG-YEAR.                                02720000
           MOVE WS-MONTH TO WS-GREG-MONTH.                              02730000
           MOVE WS-DAY TO WS-GREG-DAY.                                  02740000
                                                                        02750000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02760000
           SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      02770000
           SET DPG51-DECREMENT-DATE TO TRUE.                            02780000
           SET DPG52-LK-DTE-GREG TO TRUE.                               02790000
           MOVE 7 TO DPG51-INCR-DECR-DAYS-9.                            02800000
           MOVE WS-GREG-DATE TO DPG52-GREG-DATE.                        02810000
                                                                        02820000
           PERFORM 600-CALL-DATE-ROUTINE.                               02830000
                                                                        02840000
           EVALUATE TRUE                                                02850000
             WHEN DPG54-NO-ERROR                                        02860000
               MOVE DPG55-DB2-ISO-DATE  TO WS-WORK-DATE                 02870000
               DISPLAY '800-GET-WEEK-END-DATE - '                       02871002
                       'WS-WORK-DATE IS ------> '                       02871102
                        WS-WORK-DATE                                    02872002
             WHEN OTHER                                                 02880000
                SET AC-DATE-ROUTINE-ERROR TO TRUE                       02890000
                MOVE '800-GET-WEEK-END-DATE' TO PV-PARA-NAME            02900000
                MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              02910000
                PERFORM 900-NON-DB2-ABEND                               02920000
           END-EVALUATE.                                                02930000
                                                                        02940000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02950000
           SET DPG51-VALID-FISCAL-CALENDAR TO TRUE.                     02960000
           SET DPG52-LK-DTE-ISO TO TRUE.                                02970000
           MOVE WS-WORK-DATE TO DPG52-DB2-ISO-DATE.                     02980000
                                                                        02990000
           PERFORM 600-CALL-DATE-ROUTINE.                               03000000
                                                                        03010000
           EVALUATE TRUE                                                03020000
             WHEN DPG54-NO-ERROR                                        03030000
               MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO WS-WK-END-DTE         03040000
               MOVE DPG56-FISCAL-PERIOD-WEEK TO PV-WEEK-IN-MONTH        03050000
               DISPLAY '800-GET-WEEK-END-DATE - '                       03051002
                       'WS-WK-END-DTE IS ------> '                      03052002
                        WS-WK-END-DTE                                   03053002
               DISPLAY 'PV-WEEK-IN-MONTH ------> '                      03055002
                        PV-WEEK-IN-MONTH                                03056002
             WHEN OTHER                                                 03060000
                SET AC-DATE-ROUTINE-ERROR TO TRUE                       03070000
                MOVE '800-GET-WEEK-END-DATE' TO PV-PARA-NAME            03080000
                MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              03090000
                PERFORM 900-NON-DB2-ABEND                               03100000
           END-EVALUATE.                                                03110000
                                                                        03120000
           EJECT                                                        03130000
                                                                        03140000
       900-NON-DB2-ABEND.                                               03150000
                                                                        03160000
           CLOSE WEEKLY-FLASH-FILE.                                     03170000
                                                                        03180000
           DISPLAY '***************************************************'03190000
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    03200000
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  03210000
           DISPLAY '**' PV-ABEND-NOTE                                   03220000
           DISPLAY '***************************************************'03230000
                                                                        03240000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03250000
                                                                        03260000
           EJECT                                                        03270000
                                                                        03280000
       1000-DB2-ABEND.                                                  03290000
                                                                        03300000
           MOVE SQLCODE TO SQLCODE2.                                    03310000
           MOVE SQLERRD(3) TO SQLERRD3.                                 03320000
                                                                        03330000
           CLOSE WEEKLY-FLASH-FILE.                                     03340000
                                                                        03350000
           DISPLAY '**************************************************' 03360000
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    03370000
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  03380000
           DISPLAY '** SQL ERROR      = ' SQLCODE2.                     03390000
           DISPLAY '** SQLERRM        = ' SQLERRM.                      03400000
           DISPLAY '**************************************************'.03410000
                                                                        03420000
      *----------------------------------------------------------------*03430000
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   03440000
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        03450000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     03460000
      *  FORMAT.                                                        03470000
      *----------------------------------------------------------------*03480000
           COPY DPPD004.                                                03490000
                                                                        03500000
           CALL 'DSNTIAR' USING SQLCA                                   03510000
                                DP004-FORMATTED-MESSAGE                 03520000
                                DP004-ERROR-LINE-LENGTH.                03530000
                                                                        03540000
           DISPLAY DP004-ASTERISK-LINE.                                 03550000
                                                                        03560000
           PERFORM                                                      03570000
              VARYING DP004-MSG-IDX                                     03580000
              FROM 1 BY 1                                               03590000
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             03600000
                  DISPLAY '**'                                          03610000
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            03620000
                          ' **'                                         03630000
           END-PERFORM.                                                 03640000
                                                                        03650000
           DISPLAY DP004-ASTERISK-LINE.                                 03660000
                                                                        03670000
           IF SQLCODE NOT = -911                                        03680000
               EXEC SQL                                                 03690000
                   COMMIT                                               03700000
               END-EXEC                                                 03710000
           END-IF.                                                      03720000
                                                                        03730000
           SET AC-DB2-ERROR TO TRUE.                                    03740000
                                                                        03750000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03760000
                                                                        03770000
           EJECT                                                        03780000
                                                                        03790000
       1100-GET-TIMESTAMP.                                              03800000
                                                                        03810000
           EXEC SQL                                                     03820000
             SET :SD-TIME-STAMP = CURRENT TIMESTAMP                     03830000
           END-EXEC.                                                    03840000
                                                                        03850000
           IF SQLCODE NOT EQUAL ZERO                                    03860000
               MOVE '1100-GET-TIMESTAMP' TO PV-PARA-NAME                03870000
               MOVE 'UNSUCCESSFUL SET TIMESTAMP' TO PV-ABEND-NOTE       03880000
               PERFORM 1000-DB2-ABEND                                   03890000
           END-IF.                                                      03900000
                                                                        03910000
       1200-COMMIT.                                                     03920000
                                                                        03930000
           EXEC SQL                                                     03940000
              COMMIT                                                    03950000
           END-EXEC.                                                    03960000
                                                                        03970000
           EVALUATE TRUE                                                03980000
               WHEN SQLCODE = +0                                        03990000
                 CONTINUE                                               04000000
               WHEN OTHER                                               04010000
                   MOVE '1200-COMMIT' TO PV-PARA-NAME                   04020000
                   PERFORM 1000-DB2-ABEND                               04030000
           END-EVALUATE.                                                04040000
                                                                        04050000
           EJECT                                                        04060000
                                                                        04070000
       9999-FINAL-HOUSEKEEPING.                                         04080000
                                                                        04090000
           CLOSE WEEKLY-FLASH-FILE.                                     04100000
           DISPLAY ' '.                                                 04101007
           DISPLAY 'NUMBER OF READS -------> '                          04101107
                    PV-NBR-READS.                                       04102007
           DISPLAY 'NUMBER OF UPDATES -----> '                          04103007
                    PV-NBR-UPDATES.                                     04104007
           DISPLAY 'NUMBER NOT FOUND ------> '                          04105007
                    PV-NBR-NOT-FOUND.                                   04106007
                                                                        04110000
           EJECT                                                        04120000
                                                                        04130000
