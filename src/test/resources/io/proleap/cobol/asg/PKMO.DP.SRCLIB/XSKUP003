000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP003.                                         00020001
000300 AUTHOR.        BARB ERTL.                                        00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  10/15/2002.                                       00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800**       LOCATION MESSAGE FOR TO POPULATE XST_TERR                00080005
000900******************************************************************00090001
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100001
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_TERR      00110005
001200**     TABLE.  IT DOES THE FOLLOWING WITH THESE RETURN CODES:     00120001
001300**     0000 - END PROGRAM                                         00130001
001400**    -0530 - END PROGRAM                                         00140001
001500**    -0803 - END PROGRAM                                         00150002
001600**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00160001
001700******************************************************************00170001
001800 ENVIRONMENT DIVISION.                                            00180001
001900 CONFIGURATION SECTION.                                           00190001
002000 SOURCE-COMPUTER.  IBM-3090.                                      00200001
002100 OBJECT-COMPUTER.  IBM-3090.                                      00210001
002200 DATA DIVISION.                                                   00220001
002300                                                                  00230001
002400 WORKING-STORAGE SECTION.                                         00240001
002500******************************************************************00250001
002600**PROGRAM SWITCHES                                                00260001
002700******************************************************************00270001
002800 01  PS-PROGRAM-SWITCHES.                                         00280001
002900     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00290001
003000         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00300001
003100         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00310001
003200******************************************************************00320001
003300**PROGRAM CONSTANTS                                               00330003
003400******************************************************************00340001
003500 01  PC-PROGRAM-CONSTANTS.                                        00350003
003600     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00360001
003700******************************************************************00370001
003800**PROGRAM VARIABLES                                               00380001
003900******************************************************************00390001
004000 01  PV-PROGRAM-VARIABLES.                                        00400001
004100     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00410003
004200     05  PV-REGN-TERR-IND            PIC X(01)  VALUE SPACES.     00420007
004300******************************************************************00430001
004400**COPYBOOKS                                                       00440001
004500******************************************************************00450001
004600***DB2 MESSAGE AREA                                               00460001
004700     COPY SQLCA2.                                                 00470012
004800***MESSAGE COPYBOOK                                               00480001
004900     COPY HORD100.                                                00490012
005000******************************************************************00500001
005100**TABLE INCLUSIONS                                                00510001
005200******************************************************************00520001
005300***DB2 COMMUNICATIONS AREA                                        00530001
005400     EXEC SQL                                                     00540001
005500          INCLUDE SQLCA                                           00550001
005600     END-EXEC.                                                    00560001
005700* ------------------------------------------------------------- * 00570001
005800*  SQL AND COBOL DECLARATIONS FOR TERRITORY TABLE (XST_TERR)      00580001
005900* ------------------------------------------------------------- * 00590001
006000     EXEC SQL                                                     00600001
006100         INCLUDE XST00007                                         00610001
006200     END-EXEC.                                                    00620001
006300                                                                  00630001
006400* ------------------------------------------------------------- * 00640006
006500*  SQL AND COBOL DECLARATIONS FOR REGION/TERRITORY TABLE          00650006
006600*  (XST_REGN_TERR)                                                00660006
006700* ------------------------------------------------------------- * 00670006
006800     EXEC SQL                                                     00680006
006900         INCLUDE XST00006                                         00690006
007000     END-EXEC.                                                    00700006
007100                                                                  00710006
007200 LINKAGE SECTION.                                                 00720001
007300******************************************************************00730001
007400**LINKAGE VARIABLES                                               00740001
007500******************************************************************00750001
007600 01  LV-LINKAGE-VARIABLES.                                        00760008
007700     05  LV-HORD100-RECORD               PIC X(500).              00770008
007800     05  LV-RETURN-CODE                  PIC S9(04).              00780008
007900                                                                  00790001
008000 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00800008
008100******************************************************************00810001
008200 0000-MAINLINE.                                                   00820001
008300                                                                  00830001
008400      PERFORM 1000-INITIALIZATION.                                00840001
008500      PERFORM 2000-PROCESS-MESSAGE                                00850001
008600              UNTIL PS-PROCESS-COMPLETE.                          00860001
008700      PERFORM 9999-WRAPUP.                                        00870001
008800                                                                  00880001
008900***************************************************************** 00890001
009000**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00900001
009100***************************************************************** 00910001
009200 1000-INITIALIZATION.                                             00920001
009300                                                                  00930001
009400     INITIALIZE PV-RETRY-COUNTER.                                 00940003
009500     SET PS-PROCESS-CONTINUE TO TRUE.                             00950011
009600                                                                  00960001
009700     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           00970001
009800     MOVE HO100-AREA-AREA            TO XST00007-TERR-NBR.        00980001
009900     MOVE HO100-AREA-NAME            TO XST00007-TERR-NM.         00990001
010000     MOVE HO100-AREA-MGR-NAME        TO XST00007-TERR-MGR-NM.     01000001
010100                                                                  01010001
010200***************************************************************** 01020001
010300**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01030001
010400***************************************************************** 01040001
010500 2000-PROCESS-MESSAGE.                                            01050001
010600                                                                  01060001
010700     EVALUATE TRUE                                                01070001
010800        WHEN HO100-ACTN-TYP-INSERT                                01080001
010900             PERFORM 2100-INSERT-DATA                             01090001
011000        WHEN HO100-ACTN-TYP-UPDATE                                01100001
011100             PERFORM 2200-UPDATE-DATA                             01110001
011200        WHEN HO100-ACTN-TYP-DELETE                                01120001
011300             PERFORM 2400-SELECT-REGN-TERR                        01130006
011400             IF PS-PROCESS-CONTINUE                               01140006
011500                 PERFORM 2300-DELETE-DATA                         01150006
011600             END-IF                                               01160006
011700     END-EVALUATE.                                                01170001
011800                                                                  01180001
011900***************************************************************** 01190001
012000**INSERT ACTION TYPE                                              01200001
012100***************************************************************** 01210001
012200 2100-INSERT-DATA.                                                01220001
012300                                                                  01230001
012400     PERFORM                                                      01240010
012500         WITH TEST AFTER                                          01250010
012600         VARYING PV-RETRY-COUNTER                                 01260010
012700         FROM 1 BY 1                                              01270010
012800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01280010
012900            OR SQLCODE = 0                                        01290010
013000            OR PS-PROCESS-COMPLETE                                01300010
013100                                                                  01310010
013200         EXEC SQL                                                 01320010
013300             INSERT INTO XST_TERR                                 01330010
013400                 (TERR_NBR                                        01340010
013500                , TERR_NM                                         01350010
013600                , TERR_MGR_NM )                                   01360010
013700             VALUES (: XST00007-TERR-NBR                          01370010
013800                   , : XST00007-TERR-NM                           01380010
013900                   , : XST00007-TERR-MGR-NM )                     01390010
014000         END-EXEC                                                 01400010
014100                                                                  01410001
014200         EVALUATE TRUE                                            01420010
014300             WHEN SQLCODE = -911                                  01430010
014400             WHEN SQLCODE = -913                                  01440010
014500             WHEN SQLCODE = 0                                     01450010
014600                 CONTINUE                                         01460010
014700             WHEN SQLWARN0 NOT = SPACE                            01470010
014800             WHEN SQLCODE NOT =  ZERO                             01480010
014900                 SET PS-PROCESS-COMPLETE TO TRUE                  01490010
015000         END-EVALUATE                                             01500010
015100     END-PERFORM.                                                 01510010
015200                                                                  01520010
015300     EVALUATE TRUE                                                01530001
015400        WHEN SQLCODE = -913                                       01540001
015500        WHEN SQLCODE = -911                                       01550001
015600             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01560003
015700                 SET PS-PROCESS-COMPLETE TO TRUE                  01570001
015800             ELSE                                                 01580001
015900                 ADD +1                  TO PV-RETRY-COUNTER      01590003
016000             END-IF                                               01600001
016100        WHEN OTHER                                                01610001
016200             SET PS-PROCESS-COMPLETE     TO TRUE                  01620001
016300     END-EVALUATE.                                                01630001
016400                                                                  01640001
016500******************************************************************01650001
016600**UPDATE ACTION TYPE                                              01660001
016700******************************************************************01670001
016800 2200-UPDATE-DATA.                                                01680001
016900                                                                  01690001
017000     PERFORM                                                      01700010
017100         WITH TEST AFTER                                          01710010
017200         VARYING PV-RETRY-COUNTER                                 01720010
017300         FROM 1 BY 1                                              01730010
017400         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01740010
017500            OR SQLCODE = 0                                        01750010
017600            OR PS-PROCESS-COMPLETE                                01760010
017700                                                                  01770010
017800         EXEC SQL                                                 01780010
017900             UPDATE XST_TERR                                      01790010
018000                SET TERR_NM     = : XST00007-TERR-NM              01800010
018100                  , TERR_MGR_NM = : XST00007-TERR-MGR-NM          01810010
018200             WHERE TERR_NBR = : XST00007-TERR-NBR                 01820010
018300         END-EXEC                                                 01830010
018400                                                                  01840001
018500         EVALUATE TRUE                                            01850010
018600             WHEN SQLCODE = -911                                  01860010
018700             WHEN SQLCODE = -913                                  01870010
018800             WHEN SQLCODE = 0                                     01880010
018900                 CONTINUE                                         01890010
019000             WHEN SQLWARN0 NOT = SPACE                            01900010
019100             WHEN SQLCODE NOT =  ZERO                             01910010
019200                 SET PS-PROCESS-COMPLETE TO TRUE                  01920010
019300         END-EVALUATE                                             01930010
019400     END-PERFORM.                                                 01940010
019500                                                                  01950010
019600     EVALUATE TRUE                                                01960001
019700        WHEN SQLCODE = -911                                       01970001
019800             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01980003
019900                 SET PS-PROCESS-COMPLETE TO TRUE                  01990001
020000             ELSE                                                 02000001
020100                 ADD +1                  TO PV-RETRY-COUNTER      02010003
020200             END-IF                                               02020001
020300        WHEN OTHER                                                02030001
020400             SET PS-PROCESS-COMPLETE     TO TRUE                  02040001
020500     END-EVALUATE.                                                02050001
020600                                                                  02060001
020700******************************************************************02070001
020800**DELETE TYPE ACTION                                              02080001
020900******************************************************************02090001
021000 2300-DELETE-DATA.                                                02100001
021100                                                                  02110001
021200     PERFORM                                                      02120010
021300         WITH TEST AFTER                                          02130010
021400         VARYING PV-RETRY-COUNTER                                 02140010
021500         FROM 1 BY 1                                              02150010
021600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02160010
021700            OR SQLCODE = 0                                        02170010
021800            OR PS-PROCESS-COMPLETE                                02180010
021900                                                                  02190010
022000         EXEC SQL                                                 02200010
022100             DELETE FROM XST_TERR                                 02210010
022200             WHERE TERR_NBR   = : XST00007-TERR-NBR               02220010
022300         END-EXEC                                                 02230010
022400                                                                  02240001
022500         EVALUATE TRUE                                            02250010
022600             WHEN SQLCODE = -911                                  02260010
022700             WHEN SQLCODE = -913                                  02270010
022800             WHEN SQLCODE = 0                                     02280010
022900                 CONTINUE                                         02290010
023000             WHEN SQLWARN0 NOT = SPACE                            02300010
023100             WHEN SQLCODE NOT =  ZERO                             02310010
023200                 SET PS-PROCESS-COMPLETE TO TRUE                  02320010
023300         END-EVALUATE                                             02330010
023400     END-PERFORM.                                                 02340010
023500                                                                  02350010
023600     EVALUATE TRUE                                                02360001
023700        WHEN SQLCODE = -911                                       02370001
023800        WHEN SQLCODE = -913                                       02380001
023900             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02390003
024000                 SET PS-PROCESS-COMPLETE TO TRUE                  02400001
024100             ELSE                                                 02410001
024200                 ADD +1                  TO PV-RETRY-COUNTER      02420003
024300             END-IF                                               02430001
024400        WHEN OTHER                                                02440001
024500             SET PS-PROCESS-COMPLETE     TO TRUE                  02450001
024600     END-EVALUATE.                                                02460001
024700                                                                  02470001
024800******************************************************************02480006
024900**SELECT REGN_TERR ROW FOR DELETED TERRITORY                      02490006
025000******************************************************************02500006
025100 2400-SELECT-REGN-TERR.                                           02510006
025200                                                                  02520006
025300     EXEC SQL                                                     02530006
025400         SELECT 'Y'                                               02540006
025500           INTO :PV-REGN-TERR-IND                                 02550006
025600           FROM XST_REGN_TERR                                     02560006
025700          WHERE  TERR_NBR = :XST00007-TERR-NBR                    02570006
025800     END-EXEC                                                     02580006
025900                                                                  02590006
026000     EVALUATE TRUE                                                02600006
026100        WHEN SQLCODE = 0                                          02610006
026200        WHEN SQLCODE = -811                                       02620006
026300             SET PS-PROCESS-COMPLETE     TO TRUE                  02630006
026400        WHEN OTHER                                                02640006
026500            CONTINUE                                              02650006
026600     END-EVALUATE.                                                02660006
026700                                                                  02670006
026800******************************************************************02680001
026900**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        02690001
027000******************************************************************02700001
027100 9999-WRAPUP.                                                     02710001
027200                                                                  02720001
027300     MOVE SQLCODE       TO LV-RETURN-CODE.                        02730001
027400                                                                  02740001
027500     EXIT PROGRAM.                                                02750001
