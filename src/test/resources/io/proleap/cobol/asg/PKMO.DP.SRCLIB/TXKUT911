000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             TXKUT911.                                00050001
000600 AUTHOR.                 BARB ERTL.                               00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            APRIL 2003.                              00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200*  THIS PROGRAM WILL CREATE A FILE OF SKUS THAT ARE ACTIVE IN PLU 00120001
001300*  FOR EACH STATE WHERE THE STORES ARE IN TRAINING MODE OR ACTIVE 00130012
001400*  IN THE PLU SYSTEM.  EACH RECORD WILL HAVE THE DEFAULT TAX      00140012
001500*  PARAMETER FOR THE DEPARTMENT/SUBCLASS ASSOCIATED WITH THE      00150012
001600*  ITEM.                                                          00160012
001700******************************************************************00170001
001800 ENVIRONMENT DIVISION.                                            00180001
001900***************************************************************** 00190001
002000                                                                  00200001
002100 CONFIGURATION SECTION.                                           00210001
002200                                                                  00220001
002300 SOURCE-COMPUTER.        IBM-3090.                                00230001
002400 OBJECT-COMPUTER.        IBM-3090.                                00240001
002500                                                                  00250001
002600 INPUT-OUTPUT SECTION.                                            00260001
002700                                                                  00270001
002800 FILE-CONTROL.                                                    00280001
002900                                                                  00290001
003300     SELECT DAYS-OUT-CONTROL-FILE                                 00330013
003400         ASSIGN TO INP01.                                         00340096
003500                                                                  00350013
003600     SELECT PROCESS-DATE-CONTROL-FILE                             00360022
003700         ASSIGN TO INP02.                                         00370096
003800                                                                  00380013
003900     SELECT TODAY-CONTROL-FILE                                    00390022
004000         ASSIGN TO INP03.                                         00400096
004100                                                                  00410022
004110     SELECT SKU-INPUT-FILE                                        00411089
004120         ASSIGN TO INP04.                                         00412096
004130                                                                  00413089
004200     SELECT SKU-FILE                                              00420001
004300         ASSIGN TO OUT01.                                         00430001
004400                                                                  00440001
004500******************************************************************00450001
004600 DATA DIVISION.                                                   00460001
004700******************************************************************00470001
004800                                                                  00480001
004900 FILE SECTION.                                                    00490001
005000                                                                  00500001
005800 FD  DAYS-OUT-CONTROL-FILE                                        00580013
005900     RECORDING MODE IS F                                          00590013
006000     BLOCK CONTAINS 0                                             00600013
006100     LABEL RECORDS ARE STANDARD.                                  00610013
006200 01  DAYS-OUT-CONTROL-RECORD          PIC X(80).                  00620013
006300                                                                  00630013
006400 FD  PROCESS-DATE-CONTROL-FILE                                    00640022
006500     RECORDING MODE IS F                                          00650013
006600     BLOCK CONTAINS 0                                             00660013
006700     LABEL RECORDS ARE STANDARD.                                  00670013
006800 01  PROCESS-DATE-CONTROL-RECORD      PIC X(80).                  00680022
006900                                                                  00690013
007000 FD  TODAY-CONTROL-FILE                                           00700022
007100     RECORDING MODE IS F                                          00710022
007200     BLOCK CONTAINS 0                                             00720022
007300     LABEL RECORDS ARE STANDARD.                                  00730022
007400 01  TODAY-CONTROL-RECORD             PIC X(80).                  00740022
007500                                                                  00750022
007000 FD  SKU-INPUT-FILE                                               00751089
007100     RECORDING MODE IS F                                          00752089
007200     BLOCK CONTAINS 0                                             00753089
007300     LABEL RECORDS ARE STANDARD.                                  00754089
007400 01  SKU-INPUT-RECORD                 PIC X(60).                  00755090
007500                                                                  00756089
007600 FD  SKU-FILE                                                     00760001
007700     RECORDING MODE IS F                                          00770001
007800     BLOCK CONTAINS 0  RECORDS.                                   00780001
007900                                                                  00790001
008000 01  SKU-RECORD                       PIC  X(60).                 00800090
008100******************************************************************00810001
008200 WORKING-STORAGE SECTION.                                         00820001
008300******************************************************************00830001
008400 01  FILLER                            PIC X(50)  VALUE           00840001
008500     ' *** WORKING STORAGE STARTS HERE FOR TXKUT911 *** '.        00850001
008600                                                                  00860001
009400******************************************************************00940005
009500* RECORD LAYOUT FOR THE ITEM TAXABILITY EXTRACT ITEM OUTPUT FILE  00950009
009600******************************************************************00960005
009700     COPY TXRD911.                                                00970050
009800                                                                  00980005
009900*----------------------------------------------------------------*00990013
010000*    COPYBOOK FOR DPKUT500 - CALENDAR SUBROUTINE                  01000013
010100*----------------------------------------------------------------*01010013
010200     COPY DPWS500.                                                01020013
010300*----------------------------------------------------------------*01030013
010400*    COPYBOOK FOR CONTROL CARD EPCC045 - DAYS OUT                 01040013
010500*----------------------------------------------------------------*01050013
010600     COPY EPRD045.                                                01060013
010700*----------------------------------------------------------------*01070013
010800*    COPYBOOK FOR CONTROL CARD EPCC140 - PROCESS DATE             01080022
010900*----------------------------------------------------------------*01090013
011000     COPY EPWS140.                                                01100022
011100                                                                  01110013
011200*----------------------------------------------------------------*01120022
011300*    COPYBOOK FOR CONTROL CARD EPCC112 - TOMORROW'S DATE          01130023
011400*----------------------------------------------------------------*01140022
011500     COPY EPWS112.                                                01150022
011600                                                                  01160022
011700 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01170001
011800                                                  COMP SYNC.      01180001
011900     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01190001
012000     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    01200001
012100     88  AC-DB2-ERROR                             VALUE +4013.    01210001
012200     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01220013
012300                                                                  01230001
012400 01  PS-PROGRAM-SWITCHES.                                         01240001
012500     05  PS-END-OF-SKU-SW              PIC X(01)  VALUE 'N'.      01250001
012600         88  PS-END-OF-SKU                        VALUE 'Y'.      01260001
012700         88  PS-NOT-END-OF-SKU                    VALUE 'N'.      01270001
013100     05  PS-END-OF-DAYS-OUT-SW         PIC X(01)  VALUE 'N'.      01310013
013200         88  PS-END-OF-DAYS-OUT                   VALUE 'Y'.      01320013
013300         88  PS-NOT-END-OF-DAYS-OUT               VALUE 'N'.      01330013
013400     05  PS-END-OF-PROCESS-DATE-SW     PIC X(01)  VALUE 'N'.      01340022
013500         88  PS-END-OF-PROCESS-DATE               VALUE 'Y'.      01350022
013600         88  PS-NOT-END-OF-PROCESS-DATE           VALUE 'N'.      01360022
013700     05  PS-END-OF-TODAY-SW            PIC X(01)  VALUE 'N'.      01370022
013800         88  PS-END-OF-TODAY                      VALUE 'Y'.      01380022
013900         88  PS-NOT-END-OF-TODAY                  VALUE 'N'.      01390022
014000     05  PS-END-OF-STATES-SW           PIC X(01)  VALUE 'N'.      01400001
014100         88  PS-END-OF-STATES                     VALUE 'Y'.      01410001
014200         88  PS-NOT-END-OF-STATES                 VALUE 'N'.      01420001
014000     05  PS-TAXABILITY-SW              PIC X(01)  VALUE 'N'.      01421061
014100         88  PS-TAXABILITY-FOUND                  VALUE 'Y'.      01422061
014200         88  PS-TAXABILITY-NOT-FOUND              VALUE 'N'.      01423061
014300                                                                  01430001
014400 01  PC-CONSTANTS.                                                01440001
014500     05  PC-STATE-LIMIT              PIC S9(04)    VALUE +50.     01450001
014600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01460001
014700                                                   'TXKUT911'.    01470001
014800                                                                  01480001
014900 01  PV-MISC-FIELDS.                                              01490001
015000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01500001
015100     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01510001
015200     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01520001
015300     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01530001
015400     05  PV-STATE-SUB                PIC S9(3)     VALUE ZERO     01540001
015500                                          COMP-3.                 01550001
015600     05  PV-SAVE-DEPT                PIC S9(4)     VALUE ZERO     01560001
015700                                          COMP-3.                 01570001
015800     05  PV-SAVE-SUBCLASS            PIC S9(4)     VALUE ZERO     01580001
015900                                          COMP-3.                 01590001
016000     05  PV-DATE-TO-VALIDATE         PIC X(10)     VALUE SPACES.  01600022
016100     05  PV-NEW-DTE                  PIC X(10)     VALUE SPACES.  01610022
016200     05  PV-SKUS-READ                PIC S9(9)     VALUE ZERO     01620003
016300                                          COMP-3.                 01630003
016400     05  PV-RECORDS-WRITTEN          PIC S9(9)     VALUE ZERO     01640003
016500                                          COMP-3.                 01650003
016600     05  PV-SKUS-READ-DISPLAY        PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  01660003
016700     05  PV-RECORDS-WRITTEN-DISPLAY  PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  01670005
016700     05  PV-TX-CDE-DESC              PIC X(20)     VALUE SPACES.  01671081
066700     05  PV-TX-PRD-CDE-DESC-W REDEFINES PV-TX-CDE-DESC.           01672081
066700         10  PV-TX-PRD-CDE-DESC      PIC X(05).                   01673081
066700         10  PV-TX-PRD-CDE-DESC-N REDEFINES PV-TX-PRD-CDE-DESC    01680181
066700                                     PIC 9(05).                   01680281
016800         10  FILLER                  PIC X(15).                   01680581
                                                                        01681069
016900******************************************************************01690001
017000*  TABLES FOR PROCESSING.                                         01700001
017100******************************************************************01710001
017200******************************************************************01720001
017300*  THE STATE TABLE HOLDS ALL OF THE STATES WHERE KOHL'S HAS A     01730001
017400*  PRESENCE.                                                      01740001
017500******************************************************************01750001
017600 01  STATE-TABLE.                                                 01760001
017700     05  ST-STATE-DEF OCCURS 50 TIMES.                            01770005
017800         10  ST-STATE          PIC X(2).                          01780001
017800         10  ST-PRD-CDE        PIC 9(5).                          01781081
017800         10  ST-PRD-CDE-X REDEFINES ST-PRD-CDE PIC X(5).          01781181
017800         10  ST-TX-CDE         PIC X(1).                          01782052
018300                                                                  01783052
017900******************************************************************01790001
018000*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01800001
018100******************************************************************01810001
018200     COPY DPWS004.                                                01820020
018300                                                                  01830001
018400******************************************************************01840001
018500*  DB2 COMMUNICATION AREA.                                        01850001
018600******************************************************************01860001
018700     EXEC SQL                                                     01870001
018800          INCLUDE SQLCA                                           01880001
018900     END-EXEC.                                                    01890001
019000******************************************************************01891052
019100*  DB2 TABLE TAX PRODUCT TABLE - TXT_PRD                          01892052
019200******************************************************************01893052
019300     EXEC SQL                                                     01894052
019400          INCLUDE TXT00007                                        01895052
019500     END-EXEC.                                                    01896052
019000******************************************************************01900001
019100*  DB2 TABLE TAX PRODUCT EXCEPTION TABLE - TXT_PRD_EXC            01910052
019200******************************************************************01920001
019300     EXEC SQL                                                     01930001
019400          INCLUDE TXT00008                                        01940052
019500     END-EXEC.                                                    01950001
020800******************************************************************02080001
020900*  DB2 TABLE XST_SUB_CL                                           02090001
021000******************************************************************02100001
021100     EXEC SQL                                                     02110001
021200          INCLUDE XST00014                                        02120001
021300     END-EXEC.                                                    02130001
022000******************************************************************02200001
022100*  DB2 TABLE XST_LOC                                              02210001
022200******************************************************************02220001
022300     EXEC SQL                                                     02230001
022400          INCLUDE XST00001                                        02240001
022500     END-EXEC.                                                    02250001
022600******************************************************************02260001
022700*  DB2 TABLE XST_LOC_ATTR                                         02270001
022800******************************************************************02280001
022900     EXEC SQL                                                     02290001
023000          INCLUDE XST00025                                        02300001
023100     END-EXEC.                                                    02310001
025300******************************************************************02530001
025400*  STATE CURSOR - PULLS EACH STATE WHERE STORES ARE OPEN OR IN    02540001
025500*                 TRAINING                                        02550001
025600*                                                                 02560034
025700*  NOTE: DURING THE PILOT NEW STORES WILL NOT BE ON THE PLU TAX   02570034
025800*        SYSTEM.  WHEN THE PILOT IS COMPLETE WE WILL LOOK FOR POS 02580034
025900*        CAPABILITY LEVELS 5 OR > 11.                             02590034
026000******************************************************************02600001
026100*                                                                 02610034
026200     EXEC SQL                                                     02620001
026300       DECLARE STATE-CSR CURSOR FOR                               02630001
026400           SELECT DISTINCT ST_CDE                                 02640001
026500           FROM   XST_LOC A                                       02650001
026600                 ,XST_LOC_ATTR B                                  02660001
026700           WHERE  A.LOC_NBR = B.LOC_NBR                           02670001
026800             AND  A.LOC_TYP_CDE = 'DS'                            02680003
026900             AND (B.POS_CAP_LVL_ID = 5                            02690050
027000              OR  B.POS_CAP_LVL_ID > 11)                          02700050
027000             AND  ST_CDE ^= 'XX'                                  02710079
027200             AND (:PV-NEW-DTE BETWEEN A.OPN_DTE AND A.CLO_DTE     02720017
027300              OR :CC-EPCC112-TOMORROW-DATE BETWEEN A.OPN_DTE AND  02730023
027400                 A.CLO_DTE)                                       02740017
027500           ORDER BY ST_CDE                                        02750001
027600           WITH UR                                                02760001
027700     END-EXEC.                                                    02770001
027800***************************************************************** 02780001
027900* PROCEDURE DIVISION.                                           * 02790001
028000***************************************************************** 02800001
028100 PROCEDURE DIVISION.                                              02810001
028200                                                                  02820001
028300 0000-MAINLINE-PROCESSING.                                        02830001
028400                                                                  02840001
028500     PERFORM 1000-INITIALIZE-PROGRAM.                             02850001
028600                                                                  02860001
028700     PERFORM 2000-CREATE-FILE                                     02870001
028800       UNTIL PS-END-OF-SKU.                                       02880001
028900                                                                  02890001
029000     CLOSE SKU-FILE                                               02900090
029000           SKU-INPUT-FILE.                                        02901090
029100                                                                  02910001
029200     MOVE PV-SKUS-READ       TO PV-SKUS-READ-DISPLAY.             02920003
029300     MOVE PV-RECORDS-WRITTEN TO PV-RECORDS-WRITTEN-DISPLAY.       02930003
029400     DISPLAY 'SKUS READ       ' PV-SKUS-READ-DISPLAY.             02940003
029500     DISPLAY 'RECORDS WRITTEN ' PV-RECORDS-WRITTEN-DISPLAY.       02950003
029600     GOBACK.                                                      02960001
029700                                                                  02970001
029800******************************************************************02980001
029900* 1000-INITIALIZE-PROGRAM                                        *02990032
030000* OPEN FILES, READ CONTROL CARD, INITIALIZE AND FILL STATE TABLE.*03000032
030100******************************************************************03010001
030200 1000-INITIALIZE-PROGRAM.                                         03020001
030300                                                                  03030001
030400     DISPLAY '***TXKUT911 MESSAGES***'                            03040015
030500                                                                  03050008
030600     OPEN INPUT  DAYS-OUT-CONTROL-FILE                            03060096
030800                 PROCESS-DATE-CONTROL-FILE                        03080022
030900                 TODAY-CONTROL-FILE                               03090022
030900                 SKU-INPUT-FILE                                   03091090
031000          OUTPUT SKU-FILE.                                        03100001
031100                                                                  03110001
031200     INITIALIZE STATE-TABLE.                                      03120032
031300                                                                  03130001
032500     PERFORM 1200-READ-PROCESS-DATE.                              03250022
032600                                                                  03260013
032700     IF PS-END-OF-PROCESS-DATE                                    03270022
032800         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03280013
032900         MOVE 'NO PROCESS DATE AVAILABLE'  TO PV-OPERATION-MSG-1  03290022
033000         SET AC-CONTROL-CARD-ERROR TO TRUE                        03300013
033100         PERFORM 9999-ABEND                                       03310013
033200     END-IF.                                                      03320013
033300                                                                  03330013
033400     DISPLAY 'PROCESS DATE IS       ' CC-EPCC112-TOMORROW-DATE.   03340022
033500                                                                  03350015
033600     MOVE CC-EPCC112-TOMORROW-DATE TO PV-DATE-TO-VALIDATE.        03360022
033700                                                                  03370022
033800     PERFORM 1400-VALIDATE-DATE.                                  03380022
033900                                                                  03390013
034000     PERFORM 1300-READ-TODAY-DATE.                                03400022
034100                                                                  03410022
034200     IF PS-END-OF-TODAY                                           03420022
034300         MOVE '1000-INITIALIZE-PROGRAM   '  TO PV-PARAGRAPH-NAME  03430022
034400         MOVE 'NO TODAY DATE AVAILABLE   '  TO PV-OPERATION-MSG-1 03440022
034500         SET AC-CONTROL-CARD-ERROR TO TRUE                        03450022
034600         PERFORM 9999-ABEND                                       03460022
034700     END-IF.                                                      03470022
034800                                                                  03480022
034900     DISPLAY 'TODAY DATE IS      ' CC-EPCC140-TODAY-DATE.         03490022
035000                                                                  03500022
035100     MOVE CC-EPCC140-TODAY-DATE TO PV-DATE-TO-VALIDATE.           03510022
035200                                                                  03520022
035300     PERFORM 1400-VALIDATE-DATE.                                  03530022
035400                                                                  03540022
035500     PERFORM 1500-READ-DAYS-OUT.                                  03550022
035600                                                                  03560013
035700     IF PS-END-OF-DAYS-OUT                                        03570013
035800         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03580013
035900         MOVE 'NO DAYS OUT RECORD       '  TO PV-OPERATION-MSG-1  03590013
036000         SET AC-CONTROL-CARD-ERROR TO TRUE                        03600013
036100         PERFORM 9999-ABEND                                       03610013
036200     END-IF.                                                      03620013
036300                                                                  03630013
036400     IF EP045-DAYS-TILL-STORE-OPN NUMERIC                         03640016
036500         CONTINUE                                                 03650016
036600     ELSE                                                         03660016
036700         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03670016
036800         MOVE 'DAYS OUT NOT NUMERIC     '  TO PV-OPERATION-MSG-1  03680016
036900         DISPLAY 'DAYS OUT PARAMETER ' EP045-DAYS-TILL-STORE-OPN  03690016
037000         SET AC-CONTROL-CARD-ERROR TO TRUE                        03700016
037100         PERFORM 9999-ABEND                                       03710016
037200     END-IF.                                                      03720016
037300                                                                  03730016
037400     DISPLAY 'DAYS OUT PARAMETER IS ' EP045-DAYS-TILL-STORE-OPN.  03740015
037500                                                                  03750015
037600     PERFORM  1600-CALC-NEW-OPEN-DTE.                             03760022
037700                                                                  03770013
037800     DISPLAY 'DATE INCL DAYS OUT IS ' PV-NEW-DTE.                 03780015
037900                                                                  03790015
038000     CLOSE DAYS-OUT-CONTROL-FILE                                  03800096
038200           PROCESS-DATE-CONTROL-FILE                              03820022
038300           TODAY-CONTROL-FILE.                                    03830022
038400                                                                  03840001
038500     PERFORM 1700-OPEN-STATE-CSR.                                 03850022
038600                                                                  03860001
038700     PERFORM 1750-FETCH-STATE-CSR.                                03870022
038800                                                                  03880001
038900     PERFORM 1710-PROCESS-STATES                                  03890022
039000         UNTIL PS-END-OF-STATES.                                  03900001
039100                                                                  03910001
039200     PERFORM 1720-CLOSE-STATE-CSR.                                03920022
039300                                                                  03930001
039310     PERFORM 8000-READ-SKU-INPUT-FILE.                            03931094
039320                                                                  03932090
040400******************************************************************04040013
040500* 1200-READ-PROCESS-DATE                                          04050022
040600* READ PROCESS DATE CONTROL CARD.                                 04060022
040700******************************************************************04070013
040800 1200-READ-PROCESS-DATE.                                          04080022
040900                                                                  04090013
041000     READ PROCESS-DATE-CONTROL-FILE INTO CC-EPCC112-CONTROL-CARD  04100022
041100         AT END                                                   04110013
041200             SET PS-END-OF-PROCESS-DATE TO TRUE.                  04120022
041300                                                                  04130013
041400******************************************************************04140022
041500* 1300-READ-TODAY-DATE                                            04150022
041600* READ TODAY'S DATE FROM CONTROL CARD.                            04160022
041700******************************************************************04170022
041800 1300-READ-TODAY-DATE.                                            04180022
041900                                                                  04190022
042000     READ TODAY-CONTROL-FILE INTO CC-EPCC140-CONTROL-CARD         04200022
042100         AT END                                                   04210022
042200             SET PS-END-OF-TODAY TO TRUE.                         04220022
042300                                                                  04230022
042400*----------------------------------------------------------------*04240013
042500* 1400-VALIDATE-DATE CHECKS PROCESS DATE FOR VALID DATE           04250022
042600*----------------------------------------------------------------*04260013
042700 1400-VALIDATE-DATE.                                              04270022
042800                                                                  04280013
042900     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04290013
043000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04300013
043100     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     04310013
043200                                                                  04320013
043300     MOVE PV-DATE-TO-VALIDATE        TO DPG52-LK-DATE-INPUT.      04330022
043400                                                                  04340013
043500     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04350013
043600          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04360013
043700                                                                  04370013
043800     EVALUATE TRUE                                                04380013
043900         WHEN DPG54-NO-ERROR                                      04390013
044000             CONTINUE                                             04400013
044100         WHEN OTHER                                               04410013
044200             MOVE '1400-VALIDATE-DATE   '  TO PV-PARAGRAPH-NAME   04420022
044300             MOVE 'INVALID PROCESS DATE  ' TO PV-OPERATION-MSG-1  04430018
044400             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                04440018
044500             PERFORM 9999-ABEND                                   04450018
044600     END-EVALUATE.                                                04460013
044700                                                                  04470013
044800******************************************************************04480013
044900* 1500-READ-DAYS-OUT                                              04490022
045000* READ DAYS OUT CONTROL CARD.                                     04500013
045100******************************************************************04510013
045200 1500-READ-DAYS-OUT.                                              04520022
045300                                                                  04530013
045400     READ DAYS-OUT-CONTROL-FILE INTO EP045-ADVDAYS-TO-SND-RECORD  04540013
045500         AT END                                                   04550013
045600             SET PS-END-OF-DAYS-OUT  TO TRUE.                     04560013
045700                                                                  04570013
045800*----------------------------------------------------------------*04580013
045900* 1600-CALC-NEW-OPEN-DTE                                          04590022
046000*----------------------------------------------------------------*04600013
046100 1600-CALC-NEW-OPEN-DTE.                                          04610022
046200                                                                  04620013
046300     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04630013
046400     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04640013
046500     SET DPG51-INCREMENT-DATE    TO TRUE.                         04650013
046600                                                                  04660013
046700     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    04670013
046800                                                                  04680013
046900     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     04690013
047000     MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      04700022
047100                                                                  04710013
047200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04720013
047300          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04730013
047400                                                                  04740013
047500     EVALUATE TRUE                                                04750013
047600         WHEN DPG54-NO-ERROR                                      04760013
047700             CONTINUE                                             04770013
047800         WHEN OTHER                                               04780013
047900             DISPLAY DPG54-ERROR-MESSAGE                          04790013
048000             MOVE '1600-CALC-NEW-OPEN-DTE' TO PV-PARAGRAPH-NAME   04800022
048100             MOVE 'INVALID NEW OPEN DTE  ' TO PV-OPERATION-MSG-1  04810018
048200             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                04820018
048300             PERFORM 9999-ABEND                                   04830018
048400     END-EVALUATE.                                                04840013
048500                                                                  04850013
048600     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DTE.                   04860013
048700                                                                  04870013
048800******************************************************************04880001
048900* 1700-OPEN-STATE-CSR.                                            04890022
049000******************************************************************04900001
049100 1700-OPEN-STATE-CSR.                                             04910022
049200     EXEC SQL                                                     04920001
049300          OPEN STATE-CSR                                          04930001
049400     END-EXEC.                                                    04940001
049500                                                                  04950001
049600     EVALUATE TRUE                                                04960001
049700         WHEN SQLCODE = ZERO                                      04970001
049800              CONTINUE                                            04980001
049900         WHEN SQLWARN0 NOT EQUAL SPACE                            04990001
050000         WHEN SQLCODE NOT EQUAL ZERO                              05000001
050100             MOVE '1700-OPEN-STATE-CSR        '                   05010022
050200                                            TO PV-PARAGRAPH-NAME  05020001
050300             MOVE 'ERROR ON OPEN OF STATE-CSR'                    05030001
050400                                            TO PV-DB2-OPERATION   05040001
050500             PERFORM 9100-SQL-ABEND                               05050001
050600     END-EVALUATE.                                                05060001
050700                                                                  05070001
050800******************************************************************05080001
050900* 1710-PROCESS-STATES                                             05090022
051000* SELECT STATES FOR LOCATIONS THAT ARE IN TRAINING OR SET UP FOR  05100009
051100* NEW PLU PROCESS.                                                05110009
051200******************************************************************05120001
051300 1710-PROCESS-STATES.                                             05130022
051400                                                                  05140001
051500     ADD +1 TO PV-STATE-SUB.                                      05150011
051600                                                                  05160011
051700     IF PV-STATE-SUB GREATER THAN PC-STATE-LIMIT                  05170011
051800         SET AC-TABLE-OVERFLOW-ERROR TO TRUE                      05180011
051900         MOVE '1710-PROCESS-STATES'                               05190022
052000                                        TO PV-PARAGRAPH-NAME      05200011
052100         MOVE 'STATE TABLE OVERFLOW'                              05210019
052200                                        TO PV-OPERATION-MSG-1     05220011
052300         PERFORM 9999-ABEND                                       05230011
052400     END-IF.                                                      05240011
052500                                                                  05250011
052600     MOVE XST00001-ST-CDE TO ST-STATE(PV-STATE-SUB).              05260011
052700                                                                  05270001
052800     PERFORM 1750-FETCH-STATE-CSR.                                05280022
052900                                                                  05290001
053000******************************************************************05300001
053100* 1720-CLOSE-STATE-CSR.                                           05310022
053200******************************************************************05320001
053300 1720-CLOSE-STATE-CSR.                                            05330022
053400                                                                  05340001
053500     EXEC SQL                                                     05350001
053600          CLOSE STATE-CSR                                         05360001
053700     END-EXEC.                                                    05370001
053800                                                                  05380001
053900     EVALUATE TRUE                                                05390001
054000         WHEN SQLCODE = ZERO                                      05400001
054100              CONTINUE                                            05410001
054200         WHEN SQLWARN0 NOT EQUAL SPACE                            05420001
054300         WHEN SQLCODE NOT EQUAL ZERO                              05430001
054400             MOVE '1720-CLOSE-STATE-CSR       '                   05440022
054500                                            TO PV-PARAGRAPH-NAME  05450001
054600             MOVE 'ERROR ON CLOSE OF STATE-CSR'                   05460001
054700                                            TO PV-DB2-OPERATION   05470001
054800             PERFORM 9100-SQL-ABEND                               05480001
054900     END-EVALUATE.                                                05490001
055000******************************************************************05500001
055100* 1750-FETCH-STATE-CSR.                                           05510022
055200******************************************************************05520001
055300 1750-FETCH-STATE-CSR.                                            05530022
055400     EXEC SQL                                                     05540001
055500          FETCH STATE-CSR                                         05550001
055600           INTO :XST00001-ST-CDE                                  05560001
055700     END-EXEC.                                                    05570001
055800                                                                  05580001
055900     EVALUATE TRUE                                                05590001
056000         WHEN SQLCODE = ZERO                                      05600001
056100             CONTINUE                                             05610001
056200         WHEN SQLCODE = +100                                      05620001
056300             SET PS-END-OF-STATES TO TRUE                         05630001
056400         WHEN SQLWARN0 NOT EQUAL SPACE                            05640001
056500         WHEN SQLCODE NOT EQUAL ZERO                              05650001
056600             MOVE '1750-FETCH-STATE-CSR       '                   05660022
056700                                            TO PV-PARAGRAPH-NAME  05670001
056800             MOVE 'ERROR ON FETCH OF STATE-CSR'                   05680001
056900                                            TO PV-DB2-OPERATION   05690001
057000             PERFORM 9100-SQL-ABEND                               05700001
057100     END-EVALUATE.                                                05710001
057200                                                                  05720001
057300******************************************************************05730001
057400* 2000-CREATE-FILE                                                05740001
057500* CREATE FILE OF CURRENT SKUS FOR ITEM TAXABILITY.                05750009
057600******************************************************************05760001
057700 2000-CREATE-FILE.                                                05770001
057800                                                                  05780001
062300     SET PS-NOT-END-OF-STATES TO TRUE.                            06230003
062400                                                                  06240003
062400     IF TX911-TX-PRD-CDE = PV-TX-CDE-DESC AND                     06240194
062500        TX911-TX-PRD-CDE NOT = SPACES                             06240294
062400        PERFORM 4000-MOVE-TABLE-VALUES                            06240353
                 VARYING PV-STATE-SUB FROM 1 BY 1                       06240453
062400           UNTIL PS-END-OF-STATES OR                              06240553
062400                 PV-STATE-SUB > PC-STATE-LIMIT                    06240658
062400     ELSE                                                         06240753
062400        MOVE TX911-TX-PRD-CDE TO PV-TX-CDE-DESC                   06240894
062400        PERFORM 5000-GET-ITEM-TAXABILITY                          06240953
062400           VARYING PV-STATE-SUB FROM 1 BY 1                       06241053
062400           UNTIL PS-END-OF-STATES OR                              06241159
062500                 PV-STATE-SUB > PC-STATE-LIMIT                    06242095
062600     END-IF.                                                      06243095
062700                                                                  06244095
062800     INITIALIZE TX911-TAX-ITEM-RECORD.                            06245095
062900                                                                  06246095
063000     PERFORM 8000-READ-SKU-INPUT-FILE.                            06300094
063100                                                                  06310001
066200******************************************************************06881053
066300* 4000-MOVE-TABLE-VALUES                                          06882053
066400* MOVE VALUES AND WRITE THE RECORD                                06883053
066500******************************************************************06884053
066600 4000-MOVE-TABLE-VALUES.                                          06885053
066700                                                                  06886053
066700     IF ST-STATE (PV-STATE-SUB) = SPACES OR                       06886176
066700        PV-STATE-SUB > PC-STATE-LIMIT                             06886276
066700           SET PS-END-OF-STATES TO TRUE                           06886376
066700     ELSE                                                         06886476
066700        MOVE ST-STATE (PV-STATE-SUB)   TO TX911-STATE-CODE        06887076
066700        MOVE ST-PRD-CDE (PV-STATE-SUB) TO TX911-TX-PRD-CDE        06887281
066700        MOVE ST-TX-CDE(PV-STATE-SUB)   TO TX911-TX-PARM-CDE       06887387
066700        PERFORM 7000-WRITE-RECORD                                 06889076
066700     END-IF.                                                      06889176
066700                                                                  06889276
066200******************************************************************06889353
066300* 5000-GET-ITEM-TAXABILITY                                        06889453
066400* GET THE ITEM TAX ABILITY CODE AND WRITE THE RECORD              06889553
066500******************************************************************06889653
066600 5000-GET-ITEM-TAXABILITY.                                        06889753
066700                                                                  06889853
066700     IF ST-STATE (PV-STATE-SUB) = SPACES OR                       06889953
066700        PV-STATE-SUB > PC-STATE-LIMIT                             06890053
066700           SET PS-END-OF-STATES TO TRUE                           06890161
066700     ELSE                                                         06890253
066700        SET PS-TAXABILITY-NOT-FOUND TO TRUE                       06890362
066700        MOVE ST-STATE (PV-STATE-SUB) TO TX911-STATE-CODE          06890453
066710        IF TX911-TX-PRD-CDE = SPACES                              06890594
066720            PERFORM 5300-GET-TAX-DFLT-IND                         06890688
066700            IF PS-TAXABILITY-FOUND                                06890788
066710                IF XST00014-TAX-DFLT-IND = 'Y'                    06890888
064900                    SET TX911-TAX-FULL-RTE TO TRUE                06890988
064910                ELSE                                              06891088
064920                    SET TX911-NON-TAXABLE TO TRUE                 06891188
064930                END-IF                                            06891288
066700            END-IF                                                06891388
066730        ELSE                                                      06891488
066700            PERFORM 5100-FIND-PRODUCT-CDE-EXP                     06891588
066700            IF PS-TAXABILITY-FOUND                                06891688
067800                MOVE TXT00008-PRD-TX-CDE TO TX911-TX-PARM-CDE     06891788
066700            ELSE                                                  06891888
066700                PERFORM 5200-FIND-DEFAULT-PRODUCT-CDE             06891988
066700                IF PS-TAXABILITY-FOUND                            06892088
067800                    MOVE TXT00007-PRD-TX-CDE TO TX911-TX-PARM-CDE 06892188
066700                ELSE                                              06892288
066700                    PERFORM 5300-GET-TAX-DFLT-IND                 06892388
066700                    IF PS-TAXABILITY-FOUND                        06892488
066800                        IF XST00014-TAX-DFLT-IND = 'Y'            06892588
064900                            SET TX911-TAX-FULL-RTE TO TRUE        06892688
065000                        ELSE                                      06892788
065100                            SET TX911-NON-TAXABLE TO TRUE         06892888
065200                        END-IF                                    06892988
065300                    END-IF                                        06893088
066700                END-IF                                            06893188
066800            END-IF                                                06893288
066700        END-IF                                                    06893381
066700     END-IF.                                                      06893481
066700                                                                  06893581
066700     IF PS-END-OF-STATES                                          06893681
               CONTINUE                                                 06893781
           ELSE                                                         06893881
066700         MOVE TX911-TX-PRD-CDE TO ST-PRD-CDE(PV-STATE-SUB)        06893981
066700         MOVE TX911-TX-PARM-CDE TO ST-TX-CDE(PV-STATE-SUB)        06894081
066700         PERFORM 7000-WRITE-RECORD                                06894182
066700     END-IF.                                                      06894281
                                                                        06894381
066200******************************************************************06894481
066300* 5100-FIND-PRODUCT-CDE-EXP                                       06894581
066400* GET THE PRODUCT TAX CODE FROM THE EXCEPTION TABLE               06894681
066500******************************************************************06894781
066600 5100-FIND-PRODUCT-CDE-EXP.                                       06894881
066700                                                                  06894981
066700     MOVE ST-STATE (PV-STATE-SUB)  TO TXT00008-ST-PROV-CDE.       06895081
066700     MOVE TX911-TX-PRD-CDE         TO PV-TX-CDE-DESC.             06895194
066700     MOVE PV-TX-PRD-CDE-DESC-N     TO TXT00008-TX-PRD-NBR.        06895281
066800     EXEC SQL                                                     06895381
066700        SELECT PRD_TX_CDE                                         06895481
066700          INTO :TXT00008-PRD-TX-CDE                               06895583
066700        FROM TXT_PRD_EXC                                          06895681
066700        WHERE TX_PRD_NBR   = :TXT00008-TX-PRD-NBR                 06895781
066700          AND ST_PROV_CDE  = :TXT00008-ST-PROV-CDE                06895881
066700          AND EFF_BEG_DTE <= :CC-EPCC112-TOMORROW-DATE            06895981
066700          AND EFF_END_DTE >= :CC-EPCC112-TOMORROW-DATE            06896081
066700        WITH UR                                                   06896181
066800     END-EXEC.                                                    06896281
                                                                        06896381
067600     EVALUATE TRUE                                                06896481
067700         WHEN SQLCODE = ZERO                                      06896581
                   SET PS-TAXABILITY-FOUND TO TRUE                      06896681
067810         WHEN SQLCODE = +100                                      06896781
067820             CONTINUE                                             06896881
068000         WHEN OTHER                                               06896981
068100             MOVE '5100-FIND-PRODUCT-CDE-EXP' TO PV-PARAGRAPH-NAME06897081
068200             MOVE 'ERROR ON SELECT FROM TXT00008'                 06897181
068300                                            TO PV-DB2-OPERATION   06897281
068400             DISPLAY 'ERROR SELECTING FROM TXT00008'              06897381
068500             DISPLAY 'STATE CODE ' ST-STATE(PV-STATE-SUB)         06897481
068500             DISPLAY 'TX PRD NBR ' TX911-TX-PRD-CDE               06897594
068600             PERFORM 9100-SQL-ABEND                               06897681
068700     END-EVALUATE.                                                06897781
                                                                        06897881
066200******************************************************************06897981
066300* 5200-FIND-DEFAULT-PRODUCT-CDE                                   06898081
066400* GET THE PRODUCT TAX CODE                                        06898181
066500******************************************************************06898281
066600 5200-FIND-DEFAULT-PRODUCT-CDE.                                   06898381
066700     MOVE TX911-TX-PRD-CDE         TO PV-TX-PRD-CDE-DESC-W.       06898494
066700     MOVE PV-TX-PRD-CDE-DESC       TO TXT00007-TX-PRD-NBR.        06898571
066800     EXEC SQL                                                     06898656
066700        SELECT PRD_TX_CDE                                         06898770
066700          INTO :TXT00007-PRD-TX-CDE                               06898870
066700        FROM TXT_PRD                                              06898956
066700        WHERE TX_PRD_NBR   = :TXT00007-TX-PRD-NBR                 06899056
066700        WITH UR                                                   06899156
066800     END-EXEC.                                                    06899256
                                                                        06899356
067600     EVALUATE TRUE                                                06899456
067700         WHEN SQLCODE = ZERO                                      06899556
                   SET PS-TAXABILITY-FOUND TO TRUE                      06899662
067810         WHEN SQLCODE = +100                                      06899756
067820             CONTINUE                                             06899856
068000         WHEN OTHER                                               06899956
068100             MOVE '5200-FIND-DEFAULT-PRODUCT-CDE'                 06900056
068100                                   TO PV-PARAGRAPH-NAME           06900156
068200             MOVE 'ERROR ON SELECT FROM TXT00007'                 06900256
068300                                            TO PV-DB2-OPERATION   06900356
068400             DISPLAY 'ERROR SELECTING FROM TXT00007'              06900456
068500             DISPLAY 'TX PRD NBR ' TX911-TX-PRD-CDE               06900594
068600             PERFORM 9100-SQL-ABEND                               06900656
068700     END-EVALUATE.                                                06900756
066700                                                                  06900856
063200******************************************************************06900957
063300* 5300-GET-TAX-DFLT-IND.                                          06901057
063400* CHECK WHAT THE TAX DEFAULT IS FOR THIS DEPARTMENT/SUBCLASS.     06901157
063500******************************************************************06901257
063600 5300-GET-TAX-DFLT-IND.                                           06901357
063700                                                                  06901457
063710     MOVE TX911-DEPT-NBR   TO XST00014-DEPT-NBR.                  06901592
063720     MOVE TX911-SUB-CL-NBR TO XST00014-SUB-CL-NBR.                06901692
063730     MOVE TX911-MAJ-CL-NBR TO XST00014-MAJ-CL-NBR.                06901792
063740                                                                  06901892
063800     EXEC SQL                                                     06901957
063900          SELECT TAX_DFLT_IND                                     06902057
064000            INTO :XST00014-TAX-DFLT-IND                           06902157
064100            FROM XST_SUB_CL                                       06902257
064200           WHERE DEPT_NBR   = :XST00014-DEPT-NBR                  06902393
064300             AND SUB_CL_NBR = :XST00014-SUB-CL-NBR                06902493
064300             AND MAJ_CL_NBR = :XST00014-MAJ-CL-NBR                06902593
064400            WITH UR                                               06902684
064500     END-EXEC.                                                    06902784
064600                                                                  06902884
064700     EVALUATE TRUE                                                06902984
064800         WHEN SQLCODE = ZERO                                      06903084
                   SET PS-TAXABILITY-FOUND TO TRUE                      06903184
065000         WHEN SQLWARN0 NOT EQUAL SPACE                            06903257
065100         WHEN SQLCODE NOT EQUAL ZERO                              06903357
065200             MOVE '5300-GET-TAX-DFLT-IND'                         06903457
065300                                            TO PV-PARAGRAPH-NAME  06903557
065400             MOVE 'ERROR ON SELECT FROM XST_SUB_CL'               06903657
065500                                            TO PV-DB2-OPERATION   06903757
065600             DISPLAY 'ERROR SELECTING FROM XST_SUB_CL '           06903857
065700             DISPLAY 'DEPT/SUBCL IS ' TX911-DEPT-NBR ' '          06903991
065800               TX911-SUB-CL-NBR                                   06904091
065900             PERFORM 9100-SQL-ABEND                               06904157
066000     END-EVALUATE.                                                06904257
066100                                                                  06905057
066700******************************************************************07590082
066700* 7000-WRITE-RECORD                                               07600082
066700* WRITE RECORD FOR EACH STATE IN THE STATE TABLE.                 07610082
066700******************************************************************07620082
066700 7000-WRITE-RECORD.                                               07630082
066700                                                                  07640082
066700     WRITE SKU-RECORD FROM TX911-TAX-ITEM-RECORD.                 07650082
066700     ADD +1 TO PV-RECORDS-WRITTEN.                                07651082
066700                                                                  07660082
066800***************************************************************** 07670090
066900* 8000-READ-SKU-INPUT-FILE.                                     * 07680094
067000*     READ THE INPUT SKU FILE                                   * 07690090
067100***************************************************************** 07700090
039800 8000-READ-SKU-INPUT-FILE.                                        07710094
039900                                                                  07720090
040000     READ SKU-INPUT-FILE INTO TX911-TAX-ITEM-RECORD               07721094
040100        AT END                                                    07722090
040200           SET PS-END-OF-SKU TO TRUE.                             07723090
040300                                                                  07724090
077300******************************************************************07730001
077400* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      07740001
077500* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 07750001
077600******************************************************************07760001
077700 9100-SQL-ABEND.                                                  07770001
077800     DISPLAY '** ABEND     **'.                                   07780001
077900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07790001
078000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07800001
078100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               07810001
078200                                                                  07820001
078300******************************************************************07830001
078400* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     07840001
078500* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      07850001
078600******************************************************************07860001
078700     COPY DPPD004.                                                07870050
078800                                                                  07880001
078900     SET AC-DB2-ERROR TO TRUE.                                    07890001
079000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07900001
079100                                                                  07910001
079200******************************************************************07920001
079300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           07930001
079400******************************************************************07940001
079500 9999-ABEND.                                                      07950001
079600     DISPLAY '** ABEND           **'.                             07960001
079700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  07970001
079800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07980001
079900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07990001
080000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08000001
080100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08010001
