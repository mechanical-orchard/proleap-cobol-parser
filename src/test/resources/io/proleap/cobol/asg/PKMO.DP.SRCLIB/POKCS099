000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS099.                                         00040000
000500 AUTHOR.        DAVE COLOMBO - COMPUWARE.                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  05-12-99.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    W099 - SET SELECTION LIST PROGRAM                          * 00110000
001200*    COBOL WITH SQL                                             * 00120000
001300*                                                               * 00130000
001400*    THIS PROGRAM GENERATES A LIST OF SETS. THE SET SHORT NAME, * 00140000
001500*    LONG NAME, TYPE, YEAR, RELS TO STORE BEGIN AND END DATE    * 00150000
001600*    AND STORE SETUP BEGIN AND END DATE ARE DISPLAYED.  THE     * 00160000
001700*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * 00170000
001800*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.  NO SELECTION* 00180000
001900*    IS NECESSARY TO ADD A NEW SET.                             * 00190000
002000*                                                               * 00200000
002100*---------------------------------------------------------------* 00210000
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485        00211092
CICS  *                                                                 00212091
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00213091
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00214091
002100*---------------------------------------------------------------* 00215091
002200 EJECT                                                            00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400                                                                  00240000
002500 DATA DIVISION.                                                   00250000
002600                                                                  00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800                                                                  00280000
002900 01  PC-PROGRAM-CONSTANTS.                                        00290000
003000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00300000
003100                                                    'PO099A  '.   00310000
003200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00320000
003300                                                    'POKM099 '.   00330000
003400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00340000
003500                                                    'POKCS099'.   00350000
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00360000
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00370000
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00380000
003900                                                    COMP SYNC.    00390000
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00400000
004100                                                    COMP SYNC.    00410000
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00420000
004300                                                    +1000000      00430000
004400                                                    COMP-3.       00440000
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00450000
004600                                                    COMP SYNC.    00460000
004700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00470000
004800                                                    COMP-3.       00480000
004900     05  PC-DEFAULT-DATE                PIC  X(10)  VALUE         00490000
005000                                                    '9999-09-09'. 00500000
005010     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00501072
005100                                                                  00510000
005200     05  PC-TSYMSG-NUMBERS.                                       00520000
005300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00530000
005400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00540000
005500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00550000
005600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00560000
005700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00570000
005800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00580000
005900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00590000
006000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00600000
006100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00610000
006200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00620000
006300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00630000
006400         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00640000
006500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00650000
006600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00660000
006700         10  PC-TSYMSG-02043            PIC  9(05)  VALUE 02043.  00670000
006800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00680000
006900                                                                  00690000
007000 01  PS-PROGRAM-SWITCHES.                                         00700000
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00710000
007200         88  PS-NO-ERROR                            VALUE 'Y'.    00720000
007300         88  PS-ERROR                               VALUE 'N'.    00730000
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00740000
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00750000
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00760000
007601     05  PS-VALID-SRCH-SET-SW           PIC  X(01)  VALUE 'N'.    00760177
007602         88  PS-VALID-SRCH-SET                      VALUE 'Y'.    00760277
007603         88  PS-VALID-SRCH-SET-NO                   VALUE 'N'.    00760377
007620                                                                  00762077
007700 01  DK-DB2-KEYS.                                                 00770077
007701     05  DK-SET-NAME                    PIC  X(05)  VALUE SPACES. 00770177
007710                                                                  00771077
007800 01  PV-PROGRAM-VARIABLES.                                        00780000
007900     05  PV-SUB                         PIC S9(04)  VALUE +0      00790000
008000                                                    COMP SYNC.    00800000
008100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00810000
008200                                                    COMP SYNC.    00820000
008300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00830000
008400                                                    COMP-3.       00840000
008500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00850000
008600                                                    COMP-3.       00860000
008700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00870000
008800                                                    COMP-3.       00880000
008900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00890000
009000                                                    COMP-3.       00900000
009100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00910000
009200                                                    COMP-3.       00920000
009300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00930000
009400                                                    COMP-3.       00940000
009500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00950000
009600                                                    COMP-3.       00960000
009700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00970000
009800                                                    COMP SYNC.    00980000
009900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00990000
010000                                                    COMP SYNC.    01000000
010100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01010000
010200                                                    COMP SYNC.    01020000
010300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01030000
010400                                                    COMP SYNC.    01040000
010500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01050000
010600                                                    COMP SYNC.    01060000
010700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01070000
010800                                                    COMP SYNC.    01080000
010900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01130000
011400                                                    COMP SYNC.    01140000
011500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-DISPLAY-DATE.                                         01270000
012800         10  PV-DISPLAY-DATE-MM         PIC  X(02)  VALUE SPACES. 01280000
012900         10  FILLER                     PIC  X(01)  VALUE '/'.    01290000
013000         10  PV-DISPLAY-DATE-DD         PIC  X(02)  VALUE SPACES. 01300000
013100         10  FILLER                     PIC  X(01)  VALUE '/'.    01310000
013200         10  PV-DISPLAY-DATE-YY         PIC  X(02)  VALUE SPACES. 01320000
013300                                                                  01330000
013400     EJECT                                                        01340000
013500******************************************************************01350000
013600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01360000
013700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01370000
013800**  APPLICATION-SPECIFIC COMMAREA.                              **01380000
013900******************************************************************01390000
014000 01  LQW-LIST-QUEUE-WORK-AREA.                                    01400000
014100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01410000
014200     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01420000
014300                                        INDEXED BY LQW-IDX.       01430000
014400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01440000
014500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01450000
014600         10  LQW-SELECTED-SW            PIC  X(01).               01460000
014700             88  LQW-SELECT                         VALUE 'S'.    01470000
014800             88  LQW-DESELECT                       VALUE ' '.    01480000
014900         10  LQW-SHORT-NME              PIC  X(05).               01490000
015000         10  LQW-LONG-NME               PIC  X(20).               01500000
015100         10  LQW-TYPE                   PIC  X(03).               01510000
015200         10  LQW-YEAR                   PIC  X(04).               01520000
015300         10  LQW-RELS-BEGIN-DTE         PIC  X(08).               01530000
015400         10  LQW-RELS-END-DTE           PIC  X(08).               01540000
015500         10  LQW-SETUP-BEGIN-DTE        PIC  X(08).               01550000
015600         10  LQW-SETUP-END-DTE          PIC  X(08).               01560000
015610         10  LQW-PO-RCPT-RPTG-IND       PIC  X.                   01561069
015700                                                                  01570000
015800     EJECT                                                        01580000
015900*---------------------------------------------------------------* 01590000
016000*  RECORD LAYOUT FOR THE SET TEMP STORAGE QUEUE.                * 01600000
016100*---------------------------------------------------------------* 01610000
016200     COPY POWS077.                                                01620000
016300                                                                  01630000
016400     EJECT                                                        01640000
016500*---------------------------------------------------------------* 01650000
016600*    MAP LAYOUT                                                 * 01660000
016700*---------------------------------------------------------------* 01670000
016800                                                                  01680000
016900     COPY POKM099.                                                01690000
017000                                                                  01700000
017100 01  MR-OCCURS-LAYOUT                   REDEFINES  PO099AO.       01710000
017200     05  FILLER                         PIC  X(89).               01720076
017300     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01730000
017400         10  MR-SELECTL                 PIC S9(04) COMP.          01740000
017500         10  MR-SELECTA                 PIC  X(01).               01750000
017600         10  MR-SELECTC                 PIC  X(01).               01760000
017700         10  MR-SELECTH                 PIC  X(01).               01770000
017800         10  MR-SELECTI                 PIC  X(01).               01780000
017900                                                                  01790000
018000         10  MR-SHORT-NMEL              PIC S9(04) COMP.          01800000
018100         10  MR-SHORT-NMEA              PIC  X(01).               01810000
018200         10  MR-SHORT-NMEC              PIC  X(01).               01820000
018300         10  MR-SHORT-NMEH              PIC  X(01).               01830000
018400         10  MR-SHORT-NME               PIC  X(05).               01840000
018500                                                                  01850000
018600         10  MR-LONG-NMEL               PIC S9(04) COMP.          01860000
018700         10  MR-LONG-NMEA               PIC  X(01).               01870000
018800         10  MR-LONG-NMEC               PIC  X(01).               01880000
018900         10  MR-LONG-NMEH               PIC  X(01).               01890000
019000         10  MR-LONG-NME                PIC  X(20).               01900000
019100                                                                  01910000
019200         10  MR-TYPEL                   PIC S9(04) COMP.          01920000
019300         10  MR-TYPEA                   PIC  X(01).               01930000
019400         10  MR-TYPEC                   PIC  X(01).               01940000
019500         10  MR-TYPEH                   PIC  X(01).               01950000
019600         10  MR-TYPE                    PIC  X(03).               01960000
019700                                                                  01970000
019800         10  MR-YEAR-L                  PIC S9(04) COMP.          01980000
019900         10  MR-YEARA                   PIC  X(01).               01990000
020000         10  MR-YEARC                   PIC  X(01).               02000000
020100         10  MR-YEARH                   PIC  X(01).               02010000
020200         10  MR-YEAR                    PIC  X(04).               02020000
020300                                                                  02030000
020400         10  MR-RELS-BEGIN-DTEL         PIC S9(04) COMP.          02040000
020500         10  MR-RELS-BEGIN-DTEA         PIC  X(01).               02050000
020600         10  MR-RELS-BEGIN-DTEC         PIC  X(01).               02060000
020700         10  MR-RELS-BEGIN-DTEH         PIC  X(01).               02070000
020800         10  MR-RELS-BEGIN-DTE          PIC  X(08).               02080000
020900                                                                  02090000
021000         10  MR-RELS-END-DTEL           PIC S9(04) COMP.          02100000
021100         10  MR-RELS-END-DTEA           PIC  X(01).               02110000
021200         10  MR-RELS-END-DTEC           PIC  X(01).               02120000
021300         10  MR-RELS-END-DTEH           PIC  X(01).               02130000
021400         10  MR-RELS-END-DTE            PIC  X(08).               02140000
021500                                                                  02150000
021600         10  MR-SETUP-BEGIN-DTEL        PIC S9(04) COMP.          02160000
021700         10  MR-SETUP-BEGIN-DTEA        PIC  X(01).               02170000
021800         10  MR-SETUP-BEGIN-DTEC        PIC  X(01).               02180000
021900         10  MR-SETUP-BEGIN-DTEH        PIC  X(01).               02190000
022000         10  MR-SETUP-BEGIN-DTE         PIC  X(08).               02200000
022100                                                                  02210000
022200         10  MR-SETUP-END-DTEL          PIC S9(04) COMP.          02220000
022300         10  MR-SETUP-END-DTEA          PIC  X(01).               02230000
022400         10  MR-SETUP-END-DTEC          PIC  X(01).               02240000
022500         10  MR-SETUP-END-DTEH          PIC  X(01).               02250000
022600         10  MR-SETUP-END-DTE           PIC  X(08).               02260000
022700                                                                  02270000
022710         10  MR-PO-RCPT-RPTG-IND-INDL   PIC S9(04) COMP.          02271069
022730         10  MR-PO-RCPT-RPTG-INDA       PIC  X(01).               02273066
022740         10  MR-PO-RCPT-RPTG-INDC       PIC  X(01).               02274066
022750         10  MR-PO-RCPT-RPTG-INDH       PIC  X(01).               02275066
022760         10  MR-PO-RCPT-RPTG-IND        PIC  X(01).               02276066
022761     05  FILLER                         PIC  X(12).               02276169
022770                                                                  02277059
022800     EJECT                                                        02280000
022900*---------------------------------------------------------------* 02290000
023000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02300000
023100*---------------------------------------------------------------* 02310000
023200                                                                  02320000
023300     COPY DPWS015.                                                02330000
023400                                                                  02340000
023500*---------------------------------------------------------------* 02350000
023600*    FUNCTION KEYS COPYBOOK.                                    * 02360000
023700*---------------------------------------------------------------* 02370000
023800                                                                  02380000
023900     COPY DPWS016.                                                02390000
024000                                                                  02400000
024100*---------------------------------------------------------------* 02410000
024200*    NUMERIC EDIT LAYOUT.                                       * 02420000
024300*---------------------------------------------------------------* 02430000
024400                                                                  02440000
024500     COPY DPWS010I.                                               02450000
024600 EJECT                                                            02460000
024700*---------------------------------------------------------------* 02470000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02480091
024900*---------------------------------------------------------------* 02490000
025000                                                                  02500000
025100     COPY DPWS030.                                                02510000
CICS       COPY DPWS930.                                                02511091
025200 EJECT                                                            02520000
025300*---------------------------------------------------------------* 02530000
025400*    STANDARD COMMAREA.                                         * 02540000
025500*---------------------------------------------------------------* 02550000
025600                                                                  02560000
025700     COPY DPWS020.                                                02570000
025800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02580000
025900                                                                  02590000
026000*---------------------------------------------------------------* 02600000
026100* INTER-APPLICATION COMMAREA.                                   * 02610000
026200*   POWS078 - COMMAREA PASSED TO PO SET MAINTENANCE PROGRAMS    * 02620000
026300*---------------------------------------------------------------* 02630000
026400         10  INTER-APPL-COMM-AREA       PIC X(200).               02640000
026500                                                                  02650000
026600     COPY POWS078.                                                02660000
026700*---------------------------------------------------------------* 02670000
026800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02680000
026900*---------------------------------------------------------------* 02690000
027000         10  ASC-SPECIFIC-COMMAREA.                               02700000
027100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02710000
027200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02720000
027300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02730000
027400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02740000
027500                                                                  02750000
027600                 20  ASC-ITEM-ARRAY.                              02760000
027700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02770000
027800                         30  ASC-LIST-ITEM-NUMBER                 02780000
027900                                                     PIC S9(09)   02790000
028000                                                     COMP-3.      02800000
028100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02810000
028200                             88  ASC-VALID-SELECT    VALUE ' '    02820000
028300                                                           'S'    02830000
028400                                                           'B'    02840000
028500                                                           'E'.   02850000
028600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02860000
028700                             88  ASC-TEMP-SELECT     VALUE 'S'.   02870000
028800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02880000
028900                             88  ASC-TEMP-END        VALUE 'E'.   02890000
029000                         30  ASC-SELECTED-SW         PIC  X(01).  02900000
029100                             88  ASC-NO-SELECT       VALUE ' '.   02910000
029200                             88  ASC-SELECT          VALUE 'S'.   02920000
029300                             88  ASC-BEGIN           VALUE 'B'.   02930000
029400                             88  ASC-END             VALUE 'E'.   02940000
029500                         30  ASC-SHORT-NME           PIC  X(05).  02950000
029600                         30  ASC-LONG-NME            PIC  X(20).  02960000
029700                         30  ASC-TYPE                PIC  X(03).  02970000
029800                         30  ASC-YEAR                PIC  X(04).  02980000
029900                         30  ASC-RELS-BEGIN-DTE      PIC  X(08).  02990000
030000                         30  ASC-RELS-END-DTE        PIC  X(08).  03000000
030100                         30  ASC-SETUP-BEGIN-DTE     PIC  X(08).  03010000
030200                         30  ASC-SETUP-END-DTE       PIC  X(08).  03020000
030210                         30  ASC-PO-RCPT-RPTG-IND    PIC  X(01).  03021068
030300                                                                  03030000
030400             15  ASC-BLK-SUB                         PIC S9(04)   03040000
030500                                                          COMP    03050000
030600                                                          SYNC.   03060000
030700             15  ASC-ITEM-SUB                        PIC S9(04)   03070000
030800                                                          COMP    03080000
030900                                                          SYNC.   03090000
031000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03100000
031100                                                          COMP-3. 03110000
031200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03120000
031300                                                          COMP-3. 03130000
031400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03140000
031500                                                          COMP-3. 03150000
031600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03160000
031700                                                          COMP-3. 03170000
031800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03180000
031900                                                          COMP-3. 03190000
032000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03200000
032100                                                          COMP    03210000
032200                                                          SYNC.   03220000
032300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03230000
032400                                                          COMP-3. 03240000
032500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03250000
032600                                                          COMP-3. 03260000
032700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03270000
032800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03280000
032900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03290000
033000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03300000
033100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03310000
033200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03320000
033300             15  ASC-LIST-QUEUE-NAME.                             03330000
033400                 20  ASC-LIST-TERM-ID                PIC  X(04).  03340000
033500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03350000
033600                                                          COMP-3. 03360000
033700                 20  ASC-LIST-SEQ                    PIC  9(01).  03370000
033800             15  ASC-SEL-QUEUE-NAME.                              03380056
033900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03390055
034000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03400055
034100                                                          COMP-3. 03410000
034200                 20  ASC-SEL-SEQ                     PIC  9(01).  03420055
034300                                                                  03430000
034400             15  ASC-START-ITEM-REQUEST.                          03440000
034500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03450000
034501                                                                  03450174
034510             15  ASC-CURSOR-SW           PIC  X(01).              03451074
034520                 88  ASC-SET-CSR              VALUE '1' ' '.      03452074
034530                 88  ASC-YEAR-SET-CSR         VALUE '2'.          03453074
034540             15  ASC-REQUEST-SET         PIC  X(05).              03454077
034541             15  FILLER                  PIC  X(45).              03454177
034542                                                                  03454277
034600     EJECT                                                        03460000
034700*---------------------------------------------------------------* 03470000
034800*    ABEND PROCESSING COPYBOOK.                                 * 03480000
034900*---------------------------------------------------------------* 03490000
035000                                                                  03500000
035100     COPY DPWS013.                                                03510000
035200                                                                  03520000
035300 EJECT                                                            03530000
035400*---------------------------------------------------------------* 03540000
035500*    SEASONAL SET TABLE                                         * 03550000
035600*---------------------------------------------------------------* 03560000
035700     EXEC SQL                                                     03570000
035800          INCLUDE TSEASET                                         03580000
035900     END-EXEC.                                                    03590000
036000 EJECT                                                            03600000
036100*---------------------------------------------------------------* 03610000
036200*    SEASONAL SET TYPE CODE TABLE                               * 03620000
036300*---------------------------------------------------------------* 03630000
036400     EXEC SQL                                                     03640000
036500          INCLUDE TSSTYCD                                         03650000
036600     END-EXEC.                                                    03660000
036700 EJECT                                                            03670000
036800*---------------------------------------------------------------* 03680000
036900*    DB2 AREA FOR COMMUNICATIONS                                * 03690000
037000*---------------------------------------------------------------* 03700000
037100     EXEC SQL                                                     03710000
037200          INCLUDE SQLCA                                           03720000
037300     END-EXEC.                                                    03730000
037400 EJECT                                                            03740000
037500*---------------------------------------------------------------* 03750000
037600*    DECLARE THE PO-SET-CSR                                     * 03760000
037700*---------------------------------------------------------------* 03770000
037800                                                                  03780000
037900     EXEC SQL                                                     03790000
038000         DECLARE PO-SET-CSR CURSOR FOR                            03800000
038100         SELECT SEASET_YR                                         03810000
038200               ,SEASET_SHRT_NM                                    03820000
038300               ,SEASET_TYP_CDE                                    03830000
038400               ,SEASET_NM                                         03840000
038500               ,STR_STUP_BEG_DTE                                  03850000
038600               ,STR_STUP_END_DTE                                  03860000
038700               ,STR_RLSE_BEG_DTE                                  03870000
038800               ,STR_RLSE_END_DTE                                  03880000
038810               ,PO_RCPT_RPTG_IND                                  03881065
038900           FROM TSEASET                                           03890000
039000          WHERE SEASET_STAT_CDE  = 'A'                            03900000
039100          ORDER BY SEASET_SHRT_NM, SEASET_YR                      03910000
039200     END-EXEC.                                                    03920000
039201                                                                  03920170
039202                                                                  03920270
039210*---------------------------------------------------------------* 03921070
039220*    DECLARE THE PO-YEAR-SET-CSR                                * 03922070
039230*---------------------------------------------------------------* 03923070
039240                                                                  03924070
039250     EXEC SQL                                                     03925070
039260         DECLARE PO-YEAR-SET-CSR CURSOR FOR                       03926070
039270         SELECT SEASET_YR                                         03927070
039280               ,SEASET_SHRT_NM                                    03928070
039290               ,SEASET_TYP_CDE                                    03929070
039291               ,SEASET_NM                                         03929170
039292               ,STR_STUP_BEG_DTE                                  03929270
039293               ,STR_STUP_END_DTE                                  03929370
039294               ,STR_RLSE_BEG_DTE                                  03929470
039295               ,STR_RLSE_END_DTE                                  03929570
039296               ,PO_RCPT_RPTG_IND                                  03929670
039297           FROM TSEASET                                           03929770
039298          WHERE SEASET_STAT_CDE  = 'A'                            03929870
039299          ORDER BY SEASET_YR DESC                                 03929975
039300                 , SEASET_SHRT_NM ASC                             03930075
039301     END-EXEC.                                                    03930175
039310 EJECT                                                            03931000
039400                                                                  03940000
039500 LINKAGE SECTION.                                                 03950000
039600                                                                  03960000
039700 01  DFHCOMMAREA.                                                 03970000
039800     05  FILLER                         OCCURS  1 TO 4072 TIMES   03980000
039900                                        DEPENDING ON EIBCALEN.    03990000
040000         10  FILLER                     PIC X.                    04000000
040100                                                                  04010000
040200 EJECT                                                            04020000
040300 PROCEDURE DIVISION.                                              04030000
040400******************************************************************04040000
040500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04050000
040600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04060000
040700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04070000
040800******************************************************************04080000
040900 0000-MAIN-MODULE.                                                04090000
041000     INITIALIZE DP030-CICS-API-FIELDS.                            04100000
041100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04110000
041200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04120000
041300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04130000
041400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04140000
041500     MOVE LENGTH OF PO099AI        TO DP030-MAP-LENGTH (1).       04150000
041600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04160000
041700     PERFORM 0001-CALL-CICS-ARCH-API.                             04170000
041800                                                                  04180000
041900     PERFORM 1000-CONTROL-PROCESSING                              04190000
042000                                                                  04200000
042100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04210000
042200     PERFORM 0001-CALL-CICS-ARCH-API.                             04220000
042300                                                                  04230000
042400******************************************************************04240000
042500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04250000
042600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04260000
042700******************************************************************04270000
042800 0001-CALL-CICS-ARCH-API.                                         04280000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04290091
043000                                    DFHCOMMAREA                   04300091
043100                                    DP030-CICS-API-FIELDS         04310091
043200                                    DP020-STANDARD-COMMAREA       04320091
043300                                    PO099AI.                      04330091
043400                                                                  04340000
043500     IF  DP030-RC-CALL-SUCCESSFUL                                 04350000
043600         CONTINUE                                                 04360000
043700     ELSE                                                         04370000
043800         SET DP013-NO-ROLLBACK                                    04380000
043900             DP013-XCTL-DISPLAY-RESTART                           04390000
044000             DP013-CICS-ABEND      TO TRUE                        04400000
044100         MOVE '0001-CALL-CICS-ARCH-API'                           04410000
044200                                   TO DP013-PARAGRAPH             04420000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04430091
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04440091
044500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04450000
044600         PERFORM DP013-0000-PROCESS-ABEND                         04460000
044700     END-IF.                                                      04470000
044800*----------------------------------------------------------------*04480000
044900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04490000
045000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04500000
045100*                                                                *04510000
045200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04520000
045300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04530000
045400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04540000
045500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04550000
045600*----------------------------------------------------------------*04560000
045700                                                                  04570000
045800 1000-CONTROL-PROCESSING.                                         04580000
045900                                                                  04590000
046000     EVALUATE TRUE                                                04600000
046100         WHEN DP020-NEXT-ACT-INITIAL                              04610000
046200             INITIALIZE ASC-SPECIFIC-COMMAREA                     04620000
046300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04630000
046400                                      ASC-SEL-TERM-ID             04640055
046500             MOVE DP020-SRC-TASK-NUMBER                           04650000
046600                                   TO ASC-LIST-TASK-NUMBER        04660000
046700                                      ASC-SEL-TASK-NUMBER         04670055
046800             MOVE PC-LIST-QUEUE-SEQ                               04680000
046900                                   TO ASC-LIST-SEQ                04690000
047000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04700055
047100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04710000
047200             PERFORM 4000-BUILD-INITIAL-PANEL                     04720000
047300                                                                  04730000
047400         WHEN DP020-NEXT-ACT-READ-MAP                             04740000
047500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04750000
047600                                   TO PV-TOP-ITEM                 04760000
047700             PERFORM 2000-PROCESS-PANEL                           04770000
047800                                                                  04780000
047900         WHEN DP020-NEXT-ACT-RETURN                               04790000
048000             IF PO078-W099-REFRESH                                04800000
048100*                ITEMS WERE ADDED/DELETED FROM LIST               04810000
048200                 PERFORM 2050-DELETE-LIST-QUEUE                   04820000
048300                 PERFORM 4000-BUILD-INITIAL-PANEL                 04830000
048400             ELSE                                                 04840000
048500                 IF ASC-NUMBER-OF-ITEMS-READ > ZERO               04850000
048600                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                04860000
048700                                   TO PV-TOP-ITEM                 04870000
048800                     MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL    04880000
048900                     PERFORM 6000-REFRESH-PANEL-FROM-TEMP         04890000
049000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04900000
049100                 ELSE                                             04910000
049200                     PERFORM 4100-FORMAT-EMPTY-SCREEN             04920000
049300                         VARYING PV-SUB FROM +1 BY +1             04930000
049400                             UNTIL PV-SUB > PC-ITEMS-PER-PANEL    04940000
049500                     END-IF                                       04950000
049600             END-IF                                               04960000
049700                                                                  04970000
049800         WHEN OTHER                                               04980000
049900             SET DP013-LOGIC-ABEND TO TRUE                        04990000
050000             SET DP013-NO-ROLLBACK TO TRUE                        05000000
050100             MOVE '1000-CONTROL-PROCESSING'                       05010000
050200                                   TO DP013-PARAGRAPH             05020000
050300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05030000
050400                                   TO DP013-MESSAGE-TEXT(1)       05040000
050500             PERFORM DP013-0000-PROCESS-ABEND                     05050000
050600     END-EVALUATE.                                                05060000
050700                                                                  05070000
050800 EJECT                                                            05080000
050900*----------------------------------------------------------------*05090000
051000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05100000
051100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05110000
051200*----------------------------------------------------------------*05120000
051300                                                                  05130000
051400 1100-PROCESS-INTER-APPL-COMM.                                    05140000
051500                                                                  05150000
051600     SET PS-COMMAREA-VALID         TO TRUE.                       05160000
051700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05170000
051701                                                                  05170170
051710     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05171073
051720         SET ASC-SET-CSR           TO TRUE                        05172070
051740     END-IF.                                                      05174070
051800                                                                  05180000
051900 EJECT                                                            05190000
052000*----------------------------------------------------------------*05200000
052100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05210000
052200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05220000
052300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05230000
052400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05240000
052500* FUNCTION KEYS CAN GET THIS FAR.                                *05250000
052600*----------------------------------------------------------------*05260000
052700                                                                  05270000
052800 2000-PROCESS-PANEL.                                              05280000
052900     EVALUATE TRUE                                                05290000
053000         WHEN DP020-SRC-AID = DP016-CLEAR                         05300000
053100             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   05310000
053200                 MOVE ZERO           TO ASC-ITEM-AT-TOP-OF-PANEL  05320000
053300                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05330000
053400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05340000
053500             ELSE                                                 05350000
053600                 PERFORM 4100-FORMAT-EMPTY-SCREEN                 05360000
053700                     VARYING PV-SUB FROM +1 BY +1                 05370000
053800                         UNTIL PV-SUB > PC-ITEMS-PER-PANEL        05380000
053900             END-IF                                               05390000
054000                                                                  05400000
054100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05410000
054110              MOVE SPACES    TO ASC-REQUEST-SET                   05411084
054120                                ASC-CURSOR-SW                     05412084
054130                                AREQSETO                          05413088
054200             PERFORM 2050-DELETE-LIST-QUEUE                       05420000
054300             PERFORM 4000-BUILD-INITIAL-PANEL                     05430000
054400                                                                  05440000
054500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05450000
054600             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   05460000
054700                 PERFORM 2140-DESELECT-ALL-ITEMS                  05470000
054800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05480000
054900             END-IF                                               05490000
055000                                                                  05500000
055100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05510000
055200             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   05520000
055300                 PERFORM 2150-SELECT-ALL-ITEMS                    05530000
055400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05540000
055500             END-IF                                               05550000
055600                                                                  05560000
055700         WHEN OTHER                                               05570000
055800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05580000
055900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05590000
056000             IF  PS-NO-ERROR                                      05600000
056100                 SET DP030-CONTINUE-GO                            05610000
056200                                 TO TRUE                          05620000
056300                 PERFORM 2100-CHECK-FUNCTION-KEY                  05630000
056400             ELSE                                                 05640000
056500                 SET DP030-OVERRIDE-GO                            05650000
056600                                 TO TRUE                          05660000
056700             END-IF                                               05670000
056800     END-EVALUATE.                                                05680000
056900 EJECT                                                            05690000
057000*----------------------------------------------------------------*05700000
057100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05710000
057200*----------------------------------------------------------------*05720000
057300 2050-DELETE-LIST-QUEUE.                                          05730000
057400                                                                  05740000
057500     EXEC CICS                                                    05750000
057600         DELETEQ TS                                               05760000
057700             QUEUE (ASC-LIST-QUEUE-NAME)                          05770000
057800             RESP  (PV-CICS-RESP)                                 05780000
057900     END-EXEC.                                                    05790000
058000                                                                  05800000
058100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05810000
058200        (PV-CICS-RESP = DFHRESP(QIDERR))                          05820000
058300         CONTINUE                                                 05830000
058400     ELSE                                                         05840000
058500         SET DP013-CICS-ABEND      TO TRUE                        05850000
058600         SET DP013-NO-ROLLBACK     TO TRUE                        05860000
058700                                                                  05870000
058800         MOVE '2050-DELETE-LIST-QUEUE'                            05880000
058900                                   TO DP013-PARAGRAPH             05890000
059000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05900000
059100                                   TO DP013-MESSAGE-TEXT (1)      05910000
059200         PERFORM DP013-0000-PROCESS-ABEND                         05920000
059300     END-IF.                                                      05930000
059400                                                                  05940000
059500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05950000
059600 EJECT                                                            05960000
059700*----------------------------------------------------------------*05970000
059800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05980000
059900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05990000
060000* CICS ARCHITECTURE API.                                         *06000000
060100*----------------------------------------------------------------*06010000
060200 2100-CHECK-FUNCTION-KEY.                                         06020000
060300                                                                  06030000
060400     EVALUATE TRUE                                                06040000
060500         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)  OR           06050000
060600              DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)  OR           06060000
060700              DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               06070000
060800*             PO SET INQUIRY, UPDATE, DELETE                      06080000
060900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06090000
061000                 INITIALIZE PO078-INTER-APPL-COMMAREA             06100000
061100                 SET PO078-W099-DONT-REFRESH  TO TRUE             06110000
061200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06120000
061300                                TO PO078-NUMBER-OF-SELECTED-ITEMS 06130000
061400                 PERFORM 5000-PREPARE-SEL-QUEUE                   06140000
061500             ELSE                                                 06150000
061600                 SET DP030-OVERRIDE-GO                            06160000
061700                                   TO TRUE                        06170000
061800                 MOVE PC-TSYMSG-00057                             06180000
061900                                   TO DP020-MSG-NUMBER            06190000
062000                 SET DP020-MSG-WARNING                            06200000
062100                                   TO TRUE                        06210000
062200             END-IF                                               06220000
062300                                                                  06230000
062400         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID) OR            06240053
062500              DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               06250053
062600*            PO LIST                                              06260000
062700             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                 06270000
062800                 INITIALIZE PO078-INTER-APPL-COMMAREA             06280000
062900                 SET PO078-W099-DONT-REFRESH  TO TRUE             06290000
063000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06300000
063100                                TO PO078-NUMBER-OF-SELECTED-ITEMS 06310000
063200                 PERFORM 5000-PREPARE-SEL-QUEUE                   06320000
063300             ELSE                                                 06330000
063400                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              06340000
063500*                    ONLY ONE SELECTION ALLOWED (ZERO OR >1 MADE) 06350000
063600                     SET DP030-OVERRIDE-GO                        06360000
063700                                   TO TRUE                        06370000
063800                     MOVE PC-TSYMSG-02043                         06380000
063900                                   TO DP020-MSG-NUMBER            06390000
064000                     SET DP020-MSG-WARNING                        06400000
064100                                   TO TRUE                        06410000
064200                 ELSE                                             06420000
064300*                    NO SELECTION MADE                            06430000
064400                     SET DP030-OVERRIDE-GO                        06440000
064500                                   TO TRUE                        06450000
064600                     MOVE PC-TSYMSG-00057                         06460000
064700                                   TO DP020-MSG-NUMBER            06470000
064800                     SET DP020-MSG-WARNING                        06480000
064900                                   TO TRUE                        06490000
065000                 END-IF                                           06500000
065100             END-IF                                               06510000
065200                                                                  06520000
065300         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               06530000
065400*            PO SET ADD - NO SELECTION ALLOWED                    06540000
065500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06550000
065600                 SET DP030-OVERRIDE-GO                            06560000
065700                                   TO TRUE                        06570000
065800                 MOVE PC-TSYMSG-00146                             06580000
065900                                   TO DP020-MSG-NUMBER            06590000
066000                 SET DP020-MSG-WARNING                            06600000
066100                                   TO TRUE                        06610000
066200             ELSE                                                 06620000
066300                 INITIALIZE PO078-INTER-APPL-COMMAREA             06630000
066400                 SET PO078-W099-DONT-REFRESH  TO TRUE             06640000
066500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06650000
066600                                TO PO078-NUMBER-OF-SELECTED-ITEMS 06660000
066700                 PERFORM 5000-PREPARE-SEL-QUEUE                   06670000
066800             END-IF                                               06680000
066900                                                                  06690000
066910                                                                  06691070
066920         WHEN DP020-FK-LOCAL-FUNC-07(DP020-SRC-AID)               06692070
066930*            LIST ORDER - TOGGLES BETWEEN SET & YEAR-SET ORDER    06693070
066940             PERFORM 2050-DELETE-LIST-QUEUE                       06694070
066951                                                                  06695181
066955              MOVE SPACES    TO  AREQSETO                         06695589
066956                                 ASC-REQUEST-SET                  06695687
066957                                                                  06695781
066960             IF ASC-SET-CSR                                       06696070
066970                SET ASC-YEAR-SET-CSR  TO TRUE                     06697070
066990             ELSE                                                 06699070
066991                SET ASC-SET-CSR       TO TRUE                     06699170
066993             END-IF                                               06699370
066994                                                                  06699470
066995             PERFORM 4000-BUILD-INITIAL-PANEL                     06699570
066999                                                                  06699970
067000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06700000
067100             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   06710000
067200                 MOVE +1           TO PV-TOP-ITEM                 06720000
067300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06730000
067400                 PERFORM 3200-RESET-ATTRIBUTES                    06740000
067500             END-IF                                               06750000
067600                                                                  06760000
067700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06770000
067800             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   06780000
067900                 PERFORM 2110-BROWSE-BACKWARD                     06790000
068000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06800000
068100                 PERFORM 3200-RESET-ATTRIBUTES                    06810000
068200             END-IF                                               06820000
068300                                                                  06830000
068400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06840000
068500             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   06850000
068600                 PERFORM 2120-BROWSE-FORWARD                      06860000
068700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06870000
068800                 PERFORM 3200-RESET-ATTRIBUTES                    06880000
068900             END-IF                                               06890000
069000                                                                  06900000
069100         WHEN DP020-SRC-AID = DP016-ENTER                         06910000
069200             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   06920000
069300                 PERFORM 2130-CHECK-FOR-JUMP-BROWSE               06930000
069400                 IF  PS-ERROR                                     06940000
069500                     CONTINUE                                     06950000
069600                 ELSE                                             06960000
069700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06970000
069800                 END-IF                                           06980000
069900             END-IF                                               06990000
070000                                                                  07000000
070100         WHEN OTHER                                               07010000
070200             SET DP013-NO-ROLLBACK                                07020000
070300                 DP013-XCTL-DISPLAY-RESTART                       07030000
070400                 DP013-CICS-ABEND  TO TRUE                        07040000
070500             MOVE '2100-CHECK-FUNCTION-KEY'                       07050000
070600                                   TO DP013-PARAGRAPH             07060000
070700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07070000
070800                                   TO DP013-MESSAGE-TEXT (1)      07080000
070900             PERFORM DP013-0000-PROCESS-ABEND                     07090000
071000     END-EVALUATE.                                                07100000
071100                                                                  07110000
071200*----------------------------------------------------------------*07120000
071300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07130000
071400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07140000
071500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07150000
071600*    MESSAGE.                                                    *07160000
071700*----------------------------------------------------------------*07170000
071800                                                                  07180000
071900 2110-BROWSE-BACKWARD.                                            07190000
072000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07200000
072100         GIVING PV-TOP-ITEM.                                      07210000
072200                                                                  07220000
072300     IF  ((PV-TOP-ITEM < +1)                                      07230000
072400       OR (PV-TOP-ITEM = +1))                                     07240000
072500         MOVE +1                   TO PV-TOP-ITEM                 07250000
072600*        -- TOP OF LIST --                                        07260000
072700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07270000
072800         SET DP020-MSG-INFORMATIONAL TO TRUE                      07280000
072900     END-IF.                                                      07290000
073000                                                                  07300000
073100 EJECT                                                            07310000
073200*----------------------------------------------------------------*07320000
073300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07330000
073400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07340000
073500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07350000
073600*----------------------------------------------------------------*07360000
073700                                                                  07370000
073800 2120-BROWSE-FORWARD.                                             07380000
073900                                                                  07390000
074000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07400000
074100         GIVING PV-TOP-ITEM.                                      07410000
074200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07420000
074300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07430000
074400                                   TO PV-TOP-ITEM                 07440000
074500*        -- BOTTOM OF LIST --                                     07450000
074600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07460000
074700         SET DP020-MSG-INFORMATIONAL                              07470000
074800                                   TO TRUE                        07480000
074900     ELSE                                                         07490000
075000         COMPUTE PV-BOTTOM-ITEM =                                 07500000
075100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07510000
075200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07520000
075300*            -- BOTTOM OF LIST --                                 07530000
075400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07540000
075500             SET DP020-MSG-INFORMATIONAL                          07550000
075600                                   TO TRUE                        07560000
075700         END-IF                                                   07570000
075800     END-IF.                                                      07580000
075900 EJECT                                                            07590000
076000*----------------------------------------------------------------*07600000
076100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07610000
076200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07620000
076300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07630000
076400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07640000
076500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07650000
076600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07660000
076700*----------------------------------------------------------------*07670000
076800                                                                  07680000
076900 2130-CHECK-FOR-JUMP-BROWSE.                                      07690000
077000     SET PS-NO-ERROR               TO TRUE.                       07700000
077010                                                                  07701077
077012*DMH - 06-16-21 - BEGIN                                           07701277
077013     IF  ASC-REQUEST-SET  >  SPACES                               07701377
077015         PERFORM 2300-CHECK-FOR-SEARCH-SET                        07701577
077016     END-IF.                                                      07701677
077017*DMH - 06-16-21 - EN                                              07701777
077018                                                                  07701877
077020                                                                  07702077
077030                                                                  07703077
077100     IF (ASC-START-ITEM-REQUEST = SPACE)                          07710000
077200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07720000
077300                                   TO PV-TOP-ITEM                 07730000
077400     ELSE                                                         07740000
077500         MOVE ASC-START-ITEM-REQUEST                              07750000
077600                                   TO DP010I-UNEDITED-FIELD       07760000
077700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07770000
077800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07780000
077900         SET DP010I-NEGATIVE-NOT-ALLOWED                          07790000
078000                                   TO TRUE                        07800000
078100         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07810000
078200              USING DP010I-NUMERIC-EDIT-AREA                      07820000
078300                                                                  07830000
078400         IF  NOT DP010I-ERROR-DETECTED                            07840000
078500             MOVE DP010I-NUMERIC-FIELD                            07850000
078600                                   TO  ASC-START-ITEM-REQUEST-N   07860000
078700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07870000
078800                 IF  ASC-START-ITEM-REQUEST-N >                   07880000
078900                                          ASC-NUMBER-OF-ITEMS-READ07890000
079000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07900000
079100                     COMPUTE PV-TOP-ITEM =                        07910000
079200                             ASC-NUMBER-OF-ITEMS-READ             07920000
079300                             - PC-ITEMS-PER-PANEL + 1             07930000
079400                     IF  PV-TOP-ITEM < +1                         07940000
079500                         MOVE +1   TO PV-TOP-ITEM                 07950000
079600                         MOVE PC-TSYMSG-00070                     07960000
079700                                   TO DP020-MSG-NUMBER            07970000
079800                         SET DP020-MSG-INFORMATIONAL              07980000
079900                                   TO TRUE                        07990000
080000                     END-IF                                       08000000
080100                 ELSE                                             08010000
080200                     MOVE ASC-START-ITEM-REQUEST-N                08020000
080300                                   TO PV-TOP-ITEM                 08030000
080400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08040000
080500                     COMPUTE PV-BOTTOM-ITEM =                     08050000
080600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08060000
080700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08070000
080800*                        -- BOTTOM OF LIST --                     08080000
080900                         MOVE PC-TSYMSG-00070                     08090000
081000                                   TO DP020-MSG-NUMBER            08100000
081100                         SET DP020-MSG-INFORMATIONAL              08110000
081200                                   TO TRUE                        08120000
081300                     END-IF                                       08130000
081400                 END-IF                                           08140000
081500             ELSE                                                 08150000
081600*                --- VALUE OUT OF RANGE ----                      08160000
081700                 MOVE PC-TSYMSG-00101                             08170000
081800                                   TO DP020-MSG-NUMBER            08180000
081900                 MOVE -1           TO ASTRTITL                    08190000
082000                 SET DP030-SET-CURSOR-APPL-1                      08200000
082100                                   TO TRUE                        08210000
082200                 MOVE DP015-REVERSE                               08220000
082300                                   TO ASTRTITH                    08230000
082400                 MOVE DP015-RED    TO ASTRTITC                    08240000
082500                 MOVE DP015-UNP-NUM-BRT-MDT                       08250000
082600                                   TO ASTRTITA                    08260000
082700                 SET DP020-MSG-FATAL                              08270000
082800                                   TO TRUE                        08280000
082900                 SET PS-ERROR      TO TRUE                        08290000
083000             END-IF                                               08300000
083100                                                                  08310000
083200         ELSE                                                     08320000
083300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08330000
083400             MOVE -1               TO ASTRTITL                    08340000
083500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08350000
083600             MOVE DP015-REVERSE    TO ASTRTITH                    08360000
083700             MOVE DP015-RED        TO ASTRTITC                    08370000
083800             MOVE DP015-UNP-NUM-BRT-MDT                           08380000
083900                                   TO ASTRTITA                    08390000
084000             SET DP020-MSG-FATAL   TO TRUE                        08400000
084100             SET PS-ERROR          TO TRUE                        08410000
084200         END-IF                                                   08420000
084300     END-IF.                                                      08430000
084400 EJECT                                                            08440000
084500*----------------------------------------------------------------*08450000
084600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08460000
084700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08470000
084800*----------------------------------------------------------------*08480000
084900 2140-DESELECT-ALL-ITEMS.                                         08490000
085000     MOVE +1                       TO ASC-BLK-SUB.                08500000
085100                                                                  08510000
085200     PERFORM 2141-CLEAR-SELECTED-INDS                             08520000
085300         VARYING ASC-ITEM-SUB                                     08530000
085400         FROM 1 BY 1                                              08540000
085500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08550000
085600                                                                  08560000
085700     ADD +1                        TO ASC-BLK-SUB.                08570000
085800                                                                  08580000
085900     PERFORM 2141-CLEAR-SELECTED-INDS                             08590000
086000         VARYING ASC-ITEM-SUB                                     08600000
086100         FROM 1 BY 1                                              08610000
086200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08620000
086300                                                                  08630000
086400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08640000
086500                                   TO PV-LIST-ITEM-NUMBER.        08650000
086600                                                                  08660000
086700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08670000
086800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08680000
086900                                                                  08690000
087000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08700000
087100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08710000
087200         MOVE +1                   TO ASC-BLK-SUB                 08720000
087300                                                                  08730000
087400         PERFORM 5100-WRITE-TEMP-STORAGE                          08740000
087500                                                                  08750000
087600         MOVE +1                   TO PV-BLOCK-NUMBER             08760000
087700                                                                  08770000
087800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08780000
087900             PV-FIRST-BLOCK-IN-ARRAY - 1                          08790000
088000                                                                  08800000
088100         PERFORM                                                  08810000
088200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08820000
088300                                                                  08830000
088400             PERFORM 4410-READ-TEMP-STORAGE                       08840000
088500                                                                  08850000
088600             PERFORM 2141-CLEAR-SELECTED-INDS                     08860000
088700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08870000
088800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08880000
088900                                                                  08890000
089000             PERFORM 5100-WRITE-TEMP-STORAGE                      08900000
089100                                                                  08910000
089200             ADD +1                TO PV-BLOCK-NUMBER             08920000
089300                                                                  08930000
089400         END-PERFORM                                              08940000
089500                                                                  08950000
089600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08960000
089700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08970000
089800                                                                  08980000
089900         PERFORM                                                  08990000
090000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09000000
090100                   ASC-HIGHEST-BLOCK-WRITTEN                      09010000
090200                                                                  09020000
090300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09030000
090400                                   TO PV-BLOCK-NUMBER             09040000
090500                                                                  09050000
090600             PERFORM 4410-READ-TEMP-STORAGE                       09060000
090700                                                                  09070000
090800             PERFORM 2141-CLEAR-SELECTED-INDS                     09080000
090900                 VARYING ASC-ITEM-SUB                             09090000
091000                 FROM 1 BY 1                                      09100000
091100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09110000
091200                                                                  09120000
091300             PERFORM 5100-WRITE-TEMP-STORAGE                      09130000
091400                                                                  09140000
091500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09150000
091600                                                                  09160000
091700         END-PERFORM                                              09170000
091800                                                                  09180000
091900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09190000
092000                                   TO PV-BLOCK-NUMBER             09200000
092100                                                                  09210000
092200         PERFORM 4410-READ-TEMP-STORAGE                           09220000
092300     END-IF.                                                      09230000
092400                                                                  09240000
092500                                                                  09250000
092600     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09260000
092700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09270000
092800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09280000
092900                                                                  09290000
093000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09300000
093100                                                                  09310000
093200 EJECT                                                            09320000
093300*----------------------------------------------------------------*09330000
093400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09340000
093500*----------------------------------------------------------------*09350000
093600                                                                  09360000
093700 2141-CLEAR-SELECTED-INDS.                                        09370000
093800                                                                  09380000
093900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09390000
094000             NOT EQUAL ZERO                                       09400000
094100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09410000
094200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09420000
094300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09430000
094400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09440000
094500                                   TO TRUE                        09450000
094600         END-IF                                                   09460000
094700     END-IF.                                                      09470000
094800                                                                  09480000
094900 EJECT                                                            09490000
095000*----------------------------------------------------------------*09500000
095100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09510000
095200*  FOR ALL ITEMS.                                                *09520000
095300*----------------------------------------------------------------*09530000
095400                                                                  09540000
095500 2150-SELECT-ALL-ITEMS.                                           09550000
095600                                                                  09560000
095700     MOVE +1                       TO ASC-BLK-SUB.                09570000
095800                                                                  09580000
095900     PERFORM 2151-SET-SELECTED-INDS                               09590000
096000         VARYING ASC-ITEM-SUB                                     09600000
096100         FROM 1 BY 1                                              09610000
096200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09620000
096300                                                                  09630000
096400     ADD +1                        TO ASC-BLK-SUB.                09640000
096500                                                                  09650000
096600     PERFORM 2151-SET-SELECTED-INDS                               09660000
096700         VARYING ASC-ITEM-SUB                                     09670000
096800         FROM 1 BY 1                                              09680000
096900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09690000
097000                                                                  09700000
097100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09710000
097200                                   TO PV-LIST-ITEM-NUMBER.        09720000
097300                                                                  09730000
097400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09740000
097500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09750000
097600                                                                  09760000
097700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09770000
097800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09780000
097900         MOVE +1                   TO ASC-BLK-SUB                 09790000
098000                                                                  09800000
098100         PERFORM 5100-WRITE-TEMP-STORAGE                          09810000
098200                                                                  09820000
098300         MOVE +1                   TO PV-BLOCK-NUMBER             09830000
098400                                                                  09840000
098500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09850000
098600             PV-FIRST-BLOCK-IN-ARRAY - 1                          09860000
098700                                                                  09870000
098800         PERFORM                                                  09880000
098900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09890000
099000                                                                  09900000
099100             PERFORM 4410-READ-TEMP-STORAGE                       09910000
099200                                                                  09920000
099300             PERFORM 2151-SET-SELECTED-INDS                       09930000
099400                 VARYING ASC-ITEM-SUB                             09940000
099500                 FROM 1 BY 1                                      09950000
099600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09960000
099700                                                                  09970000
099800             PERFORM 5100-WRITE-TEMP-STORAGE                      09980000
099900                                                                  09990000
100000             ADD +1                TO PV-BLOCK-NUMBER             10000000
100100                                                                  10010000
100200         END-PERFORM                                              10020000
100300                                                                  10030000
100400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10040000
100500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10050000
100600                                                                  10060000
100700         PERFORM                                                  10070000
100800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10080000
100900                   ASC-HIGHEST-BLOCK-WRITTEN                      10090000
101000                                                                  10100000
101100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10110000
101200                                   TO PV-BLOCK-NUMBER             10120000
101300                                                                  10130000
101400             PERFORM 4410-READ-TEMP-STORAGE                       10140000
101500                                                                  10150000
101600             PERFORM 2151-SET-SELECTED-INDS                       10160000
101700                 VARYING ASC-ITEM-SUB                             10170000
101800                 FROM 1 BY 1                                      10180000
101900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10190000
102000                                                                  10200000
102100             PERFORM 5100-WRITE-TEMP-STORAGE                      10210000
102200                                                                  10220000
102300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10230000
102400                                                                  10240000
102500         END-PERFORM                                              10250000
102600                                                                  10260000
102700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10270000
102800                                   TO PV-BLOCK-NUMBER             10280000
102900                                                                  10290000
103000         PERFORM 4410-READ-TEMP-STORAGE                           10300000
103100     END-IF.                                                      10310000
103200                                                                  10320000
103300                                                                  10330000
103400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10340000
103500                       ASC-NUMBER-OF-SELECTED-ITEMS.              10350000
103600                                                                  10360000
103700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10370000
103800                                                                  10380000
103900 EJECT                                                            10390000
104000*----------------------------------------------------------------*10400000
104100*    MARK EACH ITEM AS BEING SELECTED.                           *10410000
104200*----------------------------------------------------------------*10420000
104300                                                                  10430000
104400 2151-SET-SELECTED-INDS.                                          10440000
104500                                                                  10450000
104600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10460000
104700             NOT EQUAL ZERO                                       10470000
104800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10480000
104900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10490000
105000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10500000
105100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10510000
105200                               TO  TRUE                           10520000
105300         END-IF                                                   10530000
105400     END-IF.                                                      10540000
105500******************************************************************10550000
105600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10560000
105700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10570000
105800******************************************************************10580000
105900 2200-MOVE-SCREEN-TO-COMMAREA.                                    10590000
106000                                                                  10600000
106100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10610000
106200     MOVE +1                       TO PV-SUB.                     10620000
106300                                                                  10630000
106400     PERFORM 3100-SET-SUBSCRIPTS.                                 10640000
106500     IF  ASTRTITL > ZERO                                          10650000
106600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10660000
106700     ELSE                                                         10670000
106800         IF  ASTRTITF = DP015-ERASE-EOF                           10680000
106900             INITIALIZE ASC-START-ITEM-REQUEST                    10690000
107000         END-IF                                                   10700000
107100     END-IF.                                                      10710000
107110                                                                  10711077
107120     IF  AREQSETL  > ZERO                                         10712077
107130         MOVE  AREQSETI        TO ASC-REQUEST-SET                 10713077
107131                                  DK-SET-NAME                     10713177
107140     ELSE                                                         10714077
107150         MOVE  SPACES          TO ASC-REQUEST-SET                 10715077
107151                                  DK-SET-NAME                     10715177
107160     END-IF.                                                      10716077
107170                                                                  10717077
107200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10720000
107300         VARYING PV-SUB                                           10730000
107400         FROM 1 BY 1                                              10740000
107500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10750000
107600******************************************************************10760000
107700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10770000
107800******************************************************************10780000
107900 2210-MOVE-LINES-TO-COMMAREA.                                     10790000
108000                                                                  10800000
108100     IF  MR-SELECTL (PV-SUB) > ZERO                               10810000
108200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10820000
108300         MOVE MR-SELECTI (PV-SUB)                                 10830000
108400                                   TO ASC-TEMP-SELECTED-SW        10840000
108500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10850000
108600     ELSE                                                         10860000
108700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10870000
108800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10880000
108900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10890000
109000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10900000
109100         END-IF                                                   10910000
109200     END-IF.                                                      10920000
109300     ADD +1                        TO ASC-ITEM-SUB.               10930000
109400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10940000
109500         ADD +1                    TO ASC-BLK-SUB                 10950000
109600         MOVE +1                   TO ASC-ITEM-SUB                10960000
109700     END-IF.                                                      10970000
109701                                                                  10970177
109702                                                                  10970277
109703******************************************************************10970377
109704* THE ASSOCIATE CAN CHANGE THE SEARCH FOR A SPECIFIC SET TO      *10970477
109705* REPOPSITION THE LIST TO THE NEXT SERT THAT IS = OR > THEN      *10970577
109706* THE SET THAT WAS KEYED IN THE SEARCH FIELD.                    *10970677
109707* ADDED - 6/16/21                                                 10970777
109708******************************************************************10970877
109710 2300-CHECK-FOR-SEARCH-SET.                                       10971077
109711                                                                  10971177
109712     IF  ASC-REQUEST-SET > SPACE                                  10971277
109713         MOVE 99999 TO ASC-START-ITEM-REQUEST-N                   10971377
109714         SET  PS-VALID-SRCH-SET-NO  TO  TRUE                      10971477
109715         PERFORM 2400-SRCH-LISTQ-CNTL                             10971577
109716             VARYING PV-ITEM                                      10971677
109717             FROM 1 BY 1                                          10971777
109718             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN            10971877
109719             OR ASC-REQUEST-SET = LQW-SHORT-NME (LQW-IDX)         10971977
109720     END-IF.                                                      10972077
109721                                                                  10972177
109723     IF  PS-VALID-SRCH-SET-NO                                     10972377
109724         MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER                10972477
109725         MOVE -1               TO AREQSETL                        10972577
109726         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      10972677
109727         MOVE DP015-REVERSE    TO AREQSETH                        10972777
109728         MOVE DP015-YELLOW     TO AREQSETC                        10972877
109729         MOVE DP015-UNP-NUM-BRT-MDT                               10972977
109730                               TO AREQSETA                        10973077
109731         SET DP020-MSG-WARNING TO TRUE                            10973177
109732         SET PS-ERROR          TO TRUE                            10973277
109733     END-IF.                                                      10973377
109734                                                                  10973477
109735                                                                  10973577
109740*----------------------------------------------------------------*10974077
109750* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *10975077
109760* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *10976077
109761* ADDED - 6/16/21                                                 10976177
109770*----------------------------------------------------------------*10977077
109780                                                                  10978077
109790 2400-SRCH-LISTQ-CNTL.                                            10979077
109791                                                                  10979177
109792     PERFORM 6112-READ-LIST-QUEUE.                                10979277
109793                                                                  10979377
109794     IF PV-CICS-RESP = DFHRESP(NORMAL)                            10979477
109795         PERFORM                                                  10979577
109796         VARYING LQW-IDX                                          10979677
109797         FROM 1 BY 1                                              10979777
109798         UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                       10979877
109799         OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO                10979977
109800                                                                  10980077
109801             IF ASC-REQUEST-SET = LQW-SHORT-NME (LQW-IDX)         10980177
109803                 SET PS-VALID-SRCH-SET TO TRUE                    10980377
109804                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              10980477
109805                                   TO ASC-START-ITEM-REQUEST-N    10980577
109806                 SET LQW-IDX TO PC-ITEMS-PER-PANEL                10980677
109807                 ADD ASC-HIGHEST-BLOCK-WRITTEN TO PV-ITEM         10980777
109808             END-IF                                               10980877
109809         END-PERFORM                                              10980977
109810     END-IF.                                                      10981077
109811/                                                                 10981177
109820******************************************************************10982000
109900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10990000
110000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11000000
110100******************************************************************11010000
110200 3000-EDIT-DATA-IN-COMMAREA.                                      11020000
110300                                                                  11030000
110400     SET PS-NO-ERROR               TO TRUE.                       11040000
110500     PERFORM 3200-RESET-ATTRIBUTES.                               11050000
110600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11060000
110700**                                                                11070000
110800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11080000
110900* EDITTING IS DONE FROM THE BOTTOM UP.                            11090000
111000**                                                                11100000
111100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11110000
111200         ASC-ITEMS-DISPLAYED - 1.                                 11120000
111300     PERFORM 3100-SET-SUBSCRIPTS.                                 11130000
111400     PERFORM 3300-EDIT-SELECTIONS                                 11140000
111500         VARYING PV-SUB                                           11150000
111600         FROM PV-SUB BY -1                                        11160000
111700         UNTIL PV-SUB < +1                                        11170000
111800                                                                  11180000
111900     IF  PS-NO-ERROR                                              11190000
112000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11200000
112100     END-IF.                                                      11210000
112200                                                                  11220000
112300     IF  ((PS-NO-ERROR)                                           11230000
112400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11240000
112500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11250000
112600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11260000
112700     END-IF.                                                      11270000
112800 EJECT                                                            11280000
112900*----------------------------------------------------------------*11290000
113000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11300000
113100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11310000
113200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11320000
113300*                                                                *11330000
113400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11340000
113500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11350000
113600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11360000
113700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11370000
113800*----------------------------------------------------------------*11380000
113900                                                                  11390000
114000 3100-SET-SUBSCRIPTS.                                             11400000
114100                                                                  11410000
114200     COMPUTE ASC-ITEM-SUB =                                       11420000
114300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11430000
114400                                                                  11440000
114500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11450000
114600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11460000
114700                                                                  11470000
114800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11480000
114900     ELSE                                                         11490000
115000         MOVE +1                     TO ASC-BLK-SUB               11500000
115100     END-IF.                                                      11510000
115200******************************************************************11520000
115300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11530000
115400******************************************************************11540000
115500                                                                  11550000
115600 3200-RESET-ATTRIBUTES.                                           11560000
115700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    11570090
115710                                      AREQSETA.                   11571090
115800     MOVE DP015-GREEN              TO ASTRTITC                    11580090
115810                                      AREQSETC.                   11581090
115900     MOVE DP015-UNDERLINE          TO ASTRTITH                    11590090
115910                                      AREQSETH.                   11591090
116000                                                                  11600000
116100     PERFORM                                                      11610000
116200         VARYING PV-SUB                                           11620000
116300         FROM 1 BY 1                                              11630000
116400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                       11640000
116500             MOVE DP015-UNP-ALP-NOR-OFF                           11650000
116600                                       TO MR-SELECTA (PV-SUB)     11660000
116700             MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)     11670000
116800             MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)     11680000
116900     END-PERFORM.                                                 11690000
117000                                                                  11700000
117100******************************************************************11710000
117200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11720000
117300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11730000
117400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11740000
117500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11750000
117600******************************************************************11760000
117700 3300-EDIT-SELECTIONS.                                            11770000
117800                                                                  11780000
117900     EVALUATE TRUE                                                11790000
118000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11800000
118100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11810000
118200                 CONTINUE                                         11820000
118300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11830000
118400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11840000
118500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11850000
118600                 MOVE ASC-TEMP-SELECTED-SW                        11860000
118700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11870000
118800                                TO ASC-SELECTED-SW                11880000
118900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11890000
119000             END-IF                                               11900000
119100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11910000
119200                 = SPACE                                          11920000
119300             EVALUATE TRUE                                        11930000
119400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11940000
119500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11950000
119600                     MOVE SPACE TO ASC-SELECTED-SW                11960000
119700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11970000
119800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11980000
119900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11990000
120000                     MOVE SPACE TO ASC-SELECTED-SW                12000000
120100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12010000
120200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12020000
120300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12030000
120400                     MOVE SPACE TO ASC-SELECTED-SW                12040000
120500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12050000
120600             END-EVALUATE                                         12060000
120700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12070000
120800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12080000
120900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12090000
121000             END-IF                                               12100000
121100             PERFORM 3310-EDIT-RANGE                              12110000
121200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12120000
121300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12130000
121400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12140000
121500             END-IF                                               12150000
121600             PERFORM 3310-EDIT-RANGE                              12160000
121700         WHEN OTHER                                               12170000
121800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12180000
121900             SET DP020-MSG-FATAL    TO TRUE                       12190000
122000             MOVE -1                TO MR-SELECTL (PV-SUB)        12200000
122100             SET DP030-SET-CURSOR-APPL-1                          12210000
122200                                    TO TRUE                       12220000
122300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12230000
122400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12240000
122500             SET PS-ERROR TO TRUE                                 12250000
122600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12260000
122700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12270000
122800                 MOVE SPACE         TO ASC-SELECTED-SW            12280000
122900                                        (ASC-BLK-SUB ASC-ITEM-SUB)12290000
123000             END-IF                                               12300000
123100     END-EVALUATE.                                                12310000
123200                                                                  12320000
123300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12330000
123400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12340000
123500     IF  ASC-ITEM-SUB < 1                                         12350000
123600         SUBTRACT +1 FROM ASC-BLK-SUB                             12360000
123700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12370000
123800     END-IF.                                                      12380000
123900******************************************************************12390000
124000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12400000
124100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12410000
124200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12420000
124300** THE ENDING.                                                  **12430000
124400******************************************************************12440000
124500 3310-EDIT-RANGE.                                                 12450000
124600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12460000
124700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12470000
124800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12480000
124900                                   TO ASC-SELECTED-SW             12490000
125000                                        (ASC-BLK-SUB ASC-ITEM-SUB)12500000
125100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12510000
125200         ELSE                                                     12520000
125300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12530000
125400                 CONTINUE                                         12540000
125500             ELSE                                                 12550000
125600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12560000
125700                 MOVE PC-TSYMSG-00054                             12570000
125800                                   TO DP020-MSG-NUMBER            12580000
125900                 SET DP020-MSG-FATAL                              12590000
126000                                   TO TRUE                        12600000
126100                 MOVE -1           TO MR-SELECTL (PV-SUB)         12610000
126200                 SET DP030-SET-CURSOR-APPL-1                      12620000
126300                                   TO TRUE                        12630000
126400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12640000
126500                 MOVE DP015-UNDERLINE                             12650000
126600                                   TO MR-SELECTH (PV-SUB)         12660000
126700                 SET PS-ERROR      TO TRUE                        12670000
126800             END-IF                                               12680000
126900         END-IF                                                   12690000
127000     ELSE                                                         12700000
127100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12710000
127200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12720000
127300                                   TO ASC-SELECTED-SW             12730000
127400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12740000
127500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12750000
127600         ELSE                                                     12760000
127700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12770000
127800                 CONTINUE                                         12780000
127900             ELSE                                                 12790000
128000*                -- ONLY ONE END-OF-RANGE ALLOWED --              12800000
128100                 MOVE PC-TSYMSG-00055                             12810000
128200                                   TO DP020-MSG-NUMBER            12820000
128300                 SET DP020-MSG-FATAL                              12830000
128400                                   TO TRUE                        12840000
128500                 MOVE -1           TO MR-SELECTL (PV-SUB)         12850000
128600                 SET DP030-SET-CURSOR-APPL-1                      12860000
128700                                   TO TRUE                        12870000
128800                 SET PS-ERROR      TO TRUE                        12880000
128900             END-IF                                               12890000
129000         END-IF                                                   12900000
129100     END-IF.                                                      12910000
129200                                                                  12920000
129300******************************************************************12930000
129400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12940000
129500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12950000
129600******************************************************************12960000
129700 3400-CHECK-RANGE-SEQUENCE.                                       12970000
129800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12980000
129900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12990000
130000       AND  ASC-START-OF-SELECTED-RANGE >                         13000000
130100                                         ASC-END-OF-SELECTED-RANGE13010000
130200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13020000
130300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13030000
130400         SET DP020-MSG-FATAL TO TRUE                              13040000
130500         SET PS-ERROR TO TRUE                                     13050000
130600         PERFORM 3410-POSITION-AT-ERROR                           13060000
130700     END-IF.                                                      13070000
130800******************************************************************13080000
130900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13090000
131000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13100000
131100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13110000
131200******************************************************************13120000
131300 3410-POSITION-AT-ERROR.                                          13130000
131400     SET DP030-SET-CURSOR-APPL-1                                  13140000
131500                                   TO TRUE.                       13150000
131600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13160000
131700                    - PV-TOP-ITEM + 1.                            13170000
131800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13180000
131900         CONTINUE                                                 13190000
132000     ELSE                                                         13200000
132100         MOVE -1                   TO MR-SELECTL (PV-SUB)         13210000
132200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13220000
132300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13230000
132400     END-IF.                                                      13240000
132500                                                                  13250000
132600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13260000
132700                    - PV-TOP-ITEM + 1.                            13270000
132800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13280000
132900         CONTINUE                                                 13290000
133000     ELSE                                                         13300000
133100         MOVE -1                   TO MR-SELECTL (PV-SUB)         13310000
133200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13320000
133300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13330000
133400     END-IF.                                                      13340000
133500 EJECT                                                            13350000
133600*----------------------------------------------------------------*13360000
133700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13370000
133800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13380000
133900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13390000
134000*----------------------------------------------------------------*13400000
134100                                                                  13410000
134200 3500-MARK-RANGE-AS-SELECTED.                                     13420000
134300     MOVE +1                       TO  ASC-BLK-SUB.               13430000
134400     PERFORM 3510-MARK-SELECTED-INDS                              13440000
134500         VARYING ASC-ITEM-SUB                                     13450000
134600         FROM 1 BY 1                                              13460000
134700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13470000
134800                                                                  13480000
134900     ADD +1                        TO ASC-BLK-SUB.                13490000
135000     PERFORM 3510-MARK-SELECTED-INDS                              13500000
135100         VARYING ASC-ITEM-SUB                                     13510000
135200         FROM 1 BY 1                                              13520000
135300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13530000
135400                                                                  13540000
135500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13550000
135600                                   TO  PV-LIST-ITEM-NUMBER.       13560000
135700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13570000
135800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13580000
135900               PC-ITEMS-PER-PANEL).                               13590000
136000                                                                  13600000
136100     MOVE ASC-START-OF-SELECTED-RANGE                             13610000
136200                                   TO PV-START-OF-SELECTED-RANGE. 13620000
136300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13630000
136400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13640000
136500               PC-ITEMS-PER-PANEL).                               13650000
136600                                                                  13660000
136700     MOVE ASC-END-OF-SELECTED-RANGE                               13670000
136800                                   TO  PV-END-OF-SELECTED-RANGE.  13680000
136900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13690000
137000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13700000
137100               PC-ITEMS-PER-PANEL).                               13710000
137200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13720000
137300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13730000
137400                                                                  13740000
137500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13750000
137600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13760000
137700         MOVE +1                   TO ASC-BLK-SUB                 13770000
137800         PERFORM 5100-WRITE-TEMP-STORAGE                          13780000
137900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13790000
138000             PV-FIRST-BLOCK-IN-ARRAY - 1                          13800000
138100                                                                  13810000
138200         PERFORM                                                  13820000
138300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13830000
138400                   PV-PREV-BLOCK-IN-ARRAY                         13840000
138500             MOVE PV-FIRST-BLOCK-IN-RANGE                         13850000
138600                                   TO PV-BLOCK-NUMBER             13860000
138700             PERFORM 4410-READ-TEMP-STORAGE                       13870000
138800             PERFORM 3510-MARK-SELECTED-INDS                      13880000
138900                 VARYING ASC-ITEM-SUB                             13890000
139000                 FROM 1 BY 1                                      13900000
139100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13910000
139200             PERFORM 5100-WRITE-TEMP-STORAGE                      13920000
139300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13930000
139400         END-PERFORM                                              13940000
139500                                                                  13950000
139600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13960000
139700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13970000
139800         PERFORM                                                  13980000
139900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13990000
140000                   PV-LAST-BLOCK-IN-RANGE                         14000000
140100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14010000
140200                                   TO PV-BLOCK-NUMBER             14020000
140300             PERFORM 4410-READ-TEMP-STORAGE                       14030000
140400             PERFORM 3510-MARK-SELECTED-INDS                      14040000
140500                 VARYING ASC-ITEM-SUB                             14050000
140600                 FROM 1 BY 1                                      14060000
140700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14070000
140800             PERFORM 5100-WRITE-TEMP-STORAGE                      14080000
140900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14090000
141000         END-PERFORM                                              14100000
141100                                                                  14110000
141200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14120000
141300                                   TO PV-BLOCK-NUMBER             14130000
141400         PERFORM 4410-READ-TEMP-STORAGE                           14140000
141500     END-IF.                                                      14150000
141600                                                                  14160000
141700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14170000
141800                                      ASC-END-OF-SELECTED-RANGE.  14180000
141900                                                                  14190000
142000 EJECT                                                            14200000
142100*----------------------------------------------------------------*14210000
142200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14220000
142300*----------------------------------------------------------------*14230000
142400                                                                  14240000
142500 3510-MARK-SELECTED-INDS.                                         14250000
142600                                                                  14260000
142700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14270000
142800                                ASC-ITEM-SUB) >                   14280000
142900         ASC-START-OF-SELECTED-RANGE)                             14290000
143000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14300000
143100                                ASC-ITEM-SUB) =                   14310000
143200         ASC-START-OF-SELECTED-RANGE)                             14320000
143300                                                                  14330000
143400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14340000
143500                                    ASC-ITEM-SUB) <               14350000
143600             ASC-END-OF-SELECTED-RANGE)                           14360000
143700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14370000
143800                                    ASC-ITEM-SUB) =               14380000
143900             ASC-END-OF-SELECTED-RANGE)                           14390000
144000                                                                  14400000
144100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14410000
144200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14420000
144300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14430000
144400                               TO TRUE                            14440000
144500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14450000
144600                               TO TRUE                            14460000
144700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14470000
144800             END-IF                                               14480000
144900         END-IF                                                   14490000
145000     END-IF.                                                      14500000
145100                                                                  14510000
145200 EJECT                                                            14520000
145300*----------------------------------------------------------------*14530000
145400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14540000
145500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14550000
145600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14560000
145700*    DISPLAY THE PANEL TO USER.                                  *14570000
145800*----------------------------------------------------------------*14580000
145900                                                                  14590000
146000 4000-BUILD-INITIAL-PANEL.                                        14600000
146100                                                                  14610000
146200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14620000
146300                                 ASC-BLOCK-ENTRIES (2).           14630000
146400     MOVE +1                 TO ASC-BLK-SUB.                      14640000
146500     SET ASC-ITEMS-LEFT-ON-DB                                     14650000
146600                             TO TRUE.                             14660000
146700                                                                  14670000
146800     MOVE +0                 TO ASC-ITEM-SUB                      14680000
146900                                ASC-NUMBER-OF-ITEMS-READ          14690000
147000                                ASC-NUMBER-OF-SELECTED-ITEMS      14700000
147100                                ASC-HIGHEST-BLOCK-WRITTEN         14710000
147200                                ASC-START-OF-SELECTED-RANGE       14720000
147300                                ASC-END-OF-SELECTED-RANGE         14730000
147400                                ASC-ITEM-AT-TOP-OF-PANEL.         14740000
147401                                                                  14740180
147500                                                                  14750000
147600     PERFORM 4010-OPEN-CURSOR.                                    14760000
147700                                                                  14770000
147800     PERFORM 4300-READ-ITEMS-FROM-DB.                             14780000
147900                                                                  14790000
148000     PERFORM 4020-CLOSE-CURSOR.                                   14800000
148100                                                                  14810000
148200     MOVE +1                   TO  PV-TOP-ITEM.                   14820000
148300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14830000
148400         SET DP020-MSG-WARNING TO  TRUE                           14840000
148500         PERFORM 4100-FORMAT-EMPTY-SCREEN                         14850000
148600             VARYING PV-SUB FROM +1 BY +1                         14860000
148700                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                14870000
148800         MOVE PC-TSYMSG-00148  TO  DP020-MSG-NUMBER               14880000
148900     ELSE                                                         14890000
149000         MOVE -1               TO MR-SELECTL (1)                  14900000
149100         SET DP030-SET-CURSOR-APPL-1                              14910000
149200                               TO TRUE                            14920000
149300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14930000
149400     END-IF.                                                      14940000
149500 EJECT                                                            14950000
149600*----------------------------------------------------------------*14960000
149700* OPEN THE PO SET CURSOR.                                        *14970000
149800*----------------------------------------------------------------*14980000
149900 4010-OPEN-CURSOR.                                                14990000
150000                                                                  15000000
150100     PERFORM                                                      15010000
150200         WITH TEST AFTER                                          15020000
150300         VARYING PV-RETRY-COUNTER                                 15030000
150400         FROM 1 BY 1                                              15040000
150500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15050000
150600                   OR (SQLCODE = ZERO))                           15060000
150700                                                                  15070000
150710             IF  ASC-SET-CSR                                      15071070
150800                 EXEC SQL                                         15080070
150900                      OPEN PO-SET-CSR                             15090070
151000                 END-EXEC                                         15100070
151010             ELSE                                                 15101070
151020                 EXEC SQL                                         15102070
151030                      OPEN PO-YEAR-SET-CSR                        15103070
151040                 END-EXEC                                         15104070
151100             END-IF                                               15110070
151110                                                                  15111070
151200         EVALUATE TRUE                                            15120000
151300             WHEN SQLCODE = ZERO                                  15130000
151400             WHEN SQLCODE = -904                                  15140000
151500             WHEN SQLCODE = -913                                  15150000
151600                 CONTINUE                                         15160000
151700             WHEN SQLWARN0 NOT = SPACES                           15170000
151800             WHEN SQLCODE < ZERO                                  15180000
151900             WHEN SQLCODE > ZERO                                  15190000
152000                 MOVE '4010-OPEN-CURSOR'                          15200000
152100                                   TO DP013-PARAGRAPH             15210000
152200                 MOVE 'OPEN PO SET CURSOR'                        15220000
152300                                   TO DP013-MESSAGE-TEXT (1)      15230000
152400                 MOVE SQLCA        TO DP013-SQLCA                 15240000
152500                 MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)    15250000
152510                 MOVE ASC-CURSOR-SW                               15251071
152520                                   TO DP013-MESSAGE-TEXT (2)      15252070
152600                 SET DP013-DB2-ABEND                              15260000
152700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15270000
152800                 PERFORM DP013-0000-PROCESS-ABEND                 15280000
152900         END-EVALUATE                                             15290000
153000     END-PERFORM.                                                 15300000
153100                                                                  15310000
153200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15320000
153300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15330000
153400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15340000
153500                                   TO DP013-MESSAGE-TEXT (1)      15350000
153600         MOVE SQLCA                TO DP013-SQLCA                 15360000
153700         MOVE 'TSEASET '           TO DP013-DB2-TABLE-NAME (1)    15370000
153710         MOVE ASC-CURSOR-SW        TO DP013-MESSAGE-TEXT (2)      15371071
153800         SET DP013-DB2-ABEND                                      15380000
153900             DP013-XCTL-DISPLAY-RESTART                           15390000
154000                                   TO TRUE                        15400000
154100         PERFORM DP013-0000-PROCESS-ABEND                         15410000
154200     END-IF.                                                      15420000
154300                                                                  15430000
154400 EJECT                                                            15440000
154500*----------------------------------------------------------------*15450000
154600* CLOSE THE PO SET CURSOR.                                       *15460000
154700*----------------------------------------------------------------*15470000
154800 4020-CLOSE-CURSOR.                                               15480000
154900                                                                  15490000
154910     IF  ASC-SET-CSR                                              15491070
155000         EXEC SQL                                                 15500070
155100              CLOSE PO-SET-CSR                                    15510070
155200         END-EXEC                                                 15520070
155210     ELSE                                                         15521070
155220         EXEC SQL                                                 15522070
155230              CLOSE PO-YEAR-SET-CSR                               15523070
155240         END-EXEC                                                 15524070
155250     END-IF                                                       15525070
155300                                                                  15530000
155400     EVALUATE TRUE                                                15540000
155500         WHEN SQLCODE = ZERO                                      15550000
155600             CONTINUE                                             15560000
155700         WHEN SQLWARN0 NOT = SPACES                               15570000
155800         WHEN SQLCODE < ZERO                                      15580000
155900         WHEN SQLCODE > ZERO                                      15590000
156000             MOVE '4020-CLOSE-CURSOR'                             15600000
156100                               TO DP013-PARAGRAPH                 15610000
156200             MOVE 'CLOSE PO SET CURSOR '                          15620000
156300                               TO DP013-MESSAGE-TEXT (1)          15630000
156400             MOVE SQLCA        TO DP013-SQLCA                     15640000
156500             MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)        15650000
156510             MOVE ASC-CURSOR-SW                                   15651070
156520                               TO DP013-MESSAGE-TEXT (2)          15652070
156600             SET DP013-DB2-ABEND                                  15660000
156700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15670000
156800             PERFORM DP013-0000-PROCESS-ABEND                     15680000
156900     END-EVALUATE.                                                15690000
157000                                                                  15700000
157100 EJECT                                                            15710000
157200*----------------------------------------------------------------*15720000
157300* FORMAT EMPTY SCREEN WHEN NO DATA EXIST FOR PO SET.             *15730000
157400*----------------------------------------------------------------*15740000
157500 4100-FORMAT-EMPTY-SCREEN.                                        15750000
157600                                                                  15760000
157700     MOVE DP015-PRO-DRK-OFF      TO MR-SELECTA (PV-SUB).          15770000
157800     MOVE SPACE                  TO MR-SELECTI (PV-SUB)           15780000
157900                                    MR-SHORT-NME (PV-SUB)         15790000
158000                                    MR-LONG-NME (PV-SUB)          15800000
158100                                    MR-TYPE (PV-SUB)              15810000
158200                                    MR-YEAR (PV-SUB)              15820000
158300                                    MR-RELS-BEGIN-DTE (PV-SUB)    15830000
158400                                    MR-RELS-END-DTE (PV-SUB)      15840000
158500                                    MR-SETUP-BEGIN-DTE (PV-SUB)   15850000
158600                                    MR-SETUP-END-DTE (PV-SUB)     15860061
158610                                    MR-PO-RCPT-RPTG-IND (PV-SUB). 15861066
158700 EJECT                                                            15870000
158800*----------------------------------------------------------------*15880000
158900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15890000
159000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15900000
159100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15910000
159200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15920000
159300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15930000
159400*                                                                *15940000
159500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15950000
159600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15960000
159700*    UPON INITIALIZATION.                                        *15970000
159800*----------------------------------------------------------------*15980000
159900                                                                  15990000
160000 4300-READ-ITEMS-FROM-DB.                                         16000000
160100                                                                  16010000
160200     PERFORM                                                      16020000
160300         VARYING PV-READ-COUNT                                    16030000
160400         FROM 1 BY 1                                              16040000
160500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16050000
160600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16060000
160700                                                                  16070000
160800         PERFORM 4310-FETCH                                       16080000
160900                                                                  16090000
161000         IF  ASC-ITEMS-LEFT-ON-DB                                 16100000
161100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16110000
161200                 ADD +1            TO ASC-ITEM-SUB                16120000
161300             ELSE                                                 16130000
161400                 ADD +1            TO ASC-BLK-SUB                 16140000
161500                 MOVE +1           TO ASC-ITEM-SUB                16150000
161600                                                                  16160000
161700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16170000
161800                     MOVE +1       TO ASC-BLK-SUB                 16180000
161900                     SET ASC-BLOCK-MODIFIED (1)                   16190000
162000                                   TO TRUE                        16200000
162100                     PERFORM 5100-WRITE-TEMP-STORAGE              16210000
162200                     MOVE ASC-BLOCK-ENTRIES                       16220000
162300                               (PC-MAX-BLOCKS-IN-ARRAY)           16230000
162400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16240000
162500                     ADD +1        TO ASC-BLK-SUB                 16250000
162600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16260000
162700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16270000
162800                                   TO TRUE                        16280000
162900                 END-IF                                           16290000
163000             END-IF                                               16300000
163100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16310000
163200             MOVE ASC-NUMBER-OF-ITEMS-READ                        16320000
163300                                   TO ASC-LIST-ITEM-NUMBER        16330000
163400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16340000
163500             MOVE SEASET-SEASET-YR TO ASC-YEAR                    16350000
163600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16360000
163700             MOVE SEASET-SEASET-SHRT-NM                           16370000
163800                                   TO ASC-SHORT-NME               16380000
163900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16390000
164000             MOVE SEASET-SEASET-TYP-CDE                           16400000
164100                                   TO ASC-TYPE                    16410000
164200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16420000
164300             MOVE SEASET-SEASET-NM TO ASC-LONG-NME                16430000
164400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16440000
164500             IF SEASET-STR-STUP-BEG-DTE = PC-DEFAULT-DATE         16450000
164600                 MOVE SPACES       TO ASC-SETUP-BEGIN-DTE         16460000
164700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16470000
164800             ELSE                                                 16480000
164900                 MOVE SEASET-STR-STUP-BEG-DTE(3:2)                16490000
165000                                   TO PV-DISPLAY-DATE-YY          16500000
165100                 MOVE SEASET-STR-STUP-BEG-DTE(6:2)                16510000
165200                                   TO PV-DISPLAY-DATE-MM          16520000
165300                 MOVE SEASET-STR-STUP-BEG-DTE(9:2)                16530000
165400                                   TO PV-DISPLAY-DATE-DD          16540000
165500                 MOVE PV-DISPLAY-DATE                             16550000
165600                                   TO ASC-SETUP-BEGIN-DTE         16560000
165700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16570000
165800             END-IF                                               16580000
165900             IF SEASET-STR-STUP-END-DTE = PC-DEFAULT-DATE         16590000
166000                 MOVE SPACES       TO ASC-SETUP-END-DTE           16600000
166100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16610000
166200             ELSE                                                 16620000
166300                 MOVE SEASET-STR-STUP-END-DTE(3:2)                16630000
166400                                   TO PV-DISPLAY-DATE-YY          16640000
166500                 MOVE SEASET-STR-STUP-END-DTE(6:2)                16650000
166600                                   TO PV-DISPLAY-DATE-MM          16660000
166700                 MOVE SEASET-STR-STUP-END-DTE(9:2)                16670000
166800                                   TO PV-DISPLAY-DATE-DD          16680000
166900                 MOVE PV-DISPLAY-DATE                             16690000
167000                                   TO ASC-SETUP-END-DTE           16700000
167100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16710000
167200             END-IF                                               16720000
167300             IF SEASET-STR-RLSE-BEG-DTE = PC-DEFAULT-DATE         16730000
167400                 MOVE SPACES       TO ASC-RELS-BEGIN-DTE          16740000
167500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16750000
167600             ELSE                                                 16760000
167700                 MOVE SEASET-STR-RLSE-BEG-DTE(3:2)                16770000
167800                                   TO PV-DISPLAY-DATE-YY          16780000
167900                 MOVE SEASET-STR-RLSE-BEG-DTE(6:2)                16790000
168000                                   TO PV-DISPLAY-DATE-MM          16800000
168100                 MOVE SEASET-STR-RLSE-BEG-DTE(9:2)                16810000
168200                                   TO PV-DISPLAY-DATE-DD          16820000
168300                 MOVE PV-DISPLAY-DATE                             16830000
168400                                   TO ASC-RELS-BEGIN-DTE          16840000
168500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16850000
168600             END-IF                                               16860000
168700             IF SEASET-STR-RLSE-END-DTE = PC-DEFAULT-DATE         16870000
168800                 MOVE SPACES       TO ASC-RELS-END-DTE            16880000
168900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16890000
169000             ELSE                                                 16900000
169100                 MOVE SEASET-STR-RLSE-END-DTE(3:2)                16910000
169200                                   TO PV-DISPLAY-DATE-YY          16920000
169300                 MOVE SEASET-STR-RLSE-END-DTE(6:2)                16930000
169400                                   TO PV-DISPLAY-DATE-MM          16940000
169500                 MOVE SEASET-STR-RLSE-END-DTE(9:2)                16950000
169600                                   TO PV-DISPLAY-DATE-DD          16960000
169700                 MOVE PV-DISPLAY-DATE                             16970000
169800                                   TO ASC-RELS-END-DTE            16980000
169900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16990000
170000             END-IF                                               17000000
170010             MOVE SEASET-PO-RCPT-RPTG-IND                         17001065
170020                                   TO ASC-PO-RCPT-RPTG-IND        17002065
170030                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17003065
170100         END-IF                                                   17010000
170200     END-PERFORM.                                                 17020000
170300                                                                  17030000
170400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17040000
170500         MOVE +1               TO ASC-BLK-SUB                     17050000
170600         PERFORM 5100-WRITE-TEMP-STORAGE                          17060000
170700         ADD +1                TO ASC-BLK-SUB                     17070000
170800         PERFORM 5100-WRITE-TEMP-STORAGE                          17080000
170900                                                                  17090000
171000         MOVE 1                TO ASC-BLK-SUB                     17100000
171100                                  PV-BLOCK-NUMBER                 17110000
171200         PERFORM 4410-READ-TEMP-STORAGE                           17120000
171300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17130000
171400             MOVE 2            TO ASC-BLK-SUB                     17140000
171500                                  PV-BLOCK-NUMBER                 17150000
171600             PERFORM 4410-READ-TEMP-STORAGE                       17160000
171700         END-IF                                                   17170000
171800     END-IF.                                                      17180000
171900 EJECT                                                            17190000
172000*----------------------------------------------------------------*17200000
172100*    FETCH THE PO SET CURSOR.                                    *17210000
172200*----------------------------------------------------------------*17220000
172300                                                                  17230000
172400 4310-FETCH.                                                      17240000
172500                                                                  17250000
172510     IF  ASC-SET-CSR                                              17251070
172600         EXEC SQL                                                 17260070
172700              FETCH  PO-SET-CSR                                   17270070
172800               INTO :SEASET-SEASET-YR                             17280070
172900                   ,:SEASET-SEASET-SHRT-NM                        17290070
173000                   ,:SEASET-SEASET-TYP-CDE                        17300070
173100                   ,:SEASET-SEASET-NM                             17310070
173200                   ,:SEASET-STR-STUP-BEG-DTE                      17320070
173300                   ,:SEASET-STR-STUP-END-DTE                      17330070
173400                   ,:SEASET-STR-RLSE-BEG-DTE                      17340070
173500                   ,:SEASET-STR-RLSE-END-DTE                      17350070
173510                   ,:SEASET-PO-RCPT-RPTG-IND                      17351070
173600         END-EXEC                                                 17360070
173610     ELSE                                                         17361070
173620         EXEC SQL                                                 17362070
173630              FETCH  PO-YEAR-SET-CSR                              17363070
173640               INTO :SEASET-SEASET-YR                             17364070
173650                   ,:SEASET-SEASET-SHRT-NM                        17365070
173660                   ,:SEASET-SEASET-TYP-CDE                        17366070
173670                   ,:SEASET-SEASET-NM                             17367070
173680                   ,:SEASET-STR-STUP-BEG-DTE                      17368070
173690                   ,:SEASET-STR-STUP-END-DTE                      17369070
173691                   ,:SEASET-STR-RLSE-BEG-DTE                      17369170
173692                   ,:SEASET-STR-RLSE-END-DTE                      17369270
173693                   ,:SEASET-PO-RCPT-RPTG-IND                      17369370
173694         END-EXEC                                                 17369470
173695     END-IF.                                                      17369570
173700                                                                  17370000
173800     EVALUATE TRUE                                                17380000
173900         WHEN SQLCODE = ZERO                                      17390000
174000         WHEN SQLCODE = +100                                      17400000
174100              CONTINUE                                            17410000
174200         WHEN SQLWARN0 NOT = SPACE                                17420000
174300         WHEN SQLCODE NOT = ZERO                                  17430000
174400              MOVE '4310-FETCH-CURSOR'                            17440000
174500                               TO DP013-PARAGRAPH                 17450000
174600              MOVE 'FETCH PO SET CURSOR'                          17460000
174700                               TO DP013-MESSAGE-TEXT (1)          17470000
174710              MOVE ASC-CURSOR-SW                                  17471070
174720                               TO DP013-MESSAGE-TEXT (2)          17472070
174800              MOVE SQLCA       TO DP013-SQLCA                     17480000
174900              SET DP013-DB2-ABEND                                 17490000
175000                               TO TRUE                            17500000
175100              PERFORM DP013-0000-PROCESS-ABEND                    17510000
175200     END-EVALUATE.                                                17520000
175300                                                                  17530000
175400     IF  SQLCODE EQUAL +100                                       17540000
175500         SET ASC-NO-ITEMS-LEFT-ON-DB                              17550000
175600                                   TO TRUE                        17560000
175700     END-IF.                                                      17570000
175800                                                                  17580000
175900 EJECT                                                            17590000
176000*----------------------------------------------------------------*17600000
176100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17610000
176200*----------------------------------------------------------------*17620000
176300                                                                  17630000
176400 4400-MOVE-COMMAREA-TO-SCREEN.                                    17640000
176500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17650000
176600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17660000
176700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17670000
176800             MOVE +1    TO ASC-BLK-SUB                            17680000
176900             PERFORM 5100-WRITE-TEMP-STORAGE                      17690000
177000             ADD +1     TO ASC-BLK-SUB                            17700000
177100             PERFORM 5100-WRITE-TEMP-STORAGE                      17710000
177200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17720000
177300                 GIVING PV-BLOCK-NUMBER                           17730000
177400                 REMAINDER PV-REMAINDER                           17740000
177500             IF  PV-REMAINDER > ZERO                              17750000
177600                 ADD +1 TO PV-BLOCK-NUMBER                        17760000
177700             END-IF                                               17770000
177800             MOVE +1    TO ASC-BLK-SUB                            17780000
177900             PERFORM 4410-READ-TEMP-STORAGE                       17790000
178000             ADD +1     TO ASC-BLK-SUB                            17800000
178100                           PV-BLOCK-NUMBER                        17810000
178200             PERFORM 4410-READ-TEMP-STORAGE                       17820000
178300     END-IF.                                                      17830000
178400     MOVE +1            TO ASC-BLK-SUB.                           17840000
178500     COMPUTE ASC-ITEM-SUB =                                       17850000
178600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17860000
178700         + PC-ITEMS-PER-PANEL).                                   17870000
178800                                                                  17880000
178900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17890000
179000         ADD +1         TO ASC-BLK-SUB                            17900000
179100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17910000
179200     END-IF.                                                      17920000
179300                                                                  17930000
179400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17940000
179500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17950000
179600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17960000
179700     PERFORM 4420-FORMAT-LIST-LINES                               17970000
179800         VARYING PV-SUB                                           17980000
179900         FROM PC-ITEMS-PER-PANEL BY -1                            17990000
180000         UNTIL PV-SUB < +1.                                       18000000
180100                                                                  18010000
180200     COMPUTE ASC-ITEMS-DISPLAYED =                                18020000
180300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18030000
180400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18040000
180500                                      ASTRTITO.                   18050000
180600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18060000
180700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18070000
180800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18080000
180900                                   TO ASELITO.                    18090000
180901                                                                  18090170
180910     IF  ASC-SET-CSR                                              18091070
180920         MOVE 'SET CODE ORDER'      TO AORDERO                    18092070
180921     ELSE                                                         18092170
180930         MOVE 'YEAR-SET CODE ORDER' TO AORDERO                    18093070
180940     END-IF.                                                      18094070
181000                                                                  18100000
181100     IF  DP020-MSG-NUMBER-X = SPACE                               18110000
181200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18120000
181300*            --- MORE ITEMS TO DISPLAY ----                       18130000
181400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18140000
181500             SET DP020-MSG-INFORMATIONAL TO TRUE                  18150000
181600         END-IF                                                   18160000
181700     END-IF.                                                      18170000
181800*----------------------------------------------------------------*18180000
181900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18190000
182000*----------------------------------------------------------------*18200000
182100                                                                  18210000
182200 4410-READ-TEMP-STORAGE.                                          18220000
182300                                                                  18230000
182400     EXEC CICS                                                    18240000
182500         READQ TS                                                 18250000
182600             QUEUE (ASC-LIST-QUEUE-NAME)                          18260000
182700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18270000
182800             ITEM  (PV-BLOCK-NUMBER)                              18280000
182900             RESP  (PV-CICS-RESP)                                 18290000
183000     END-EXEC.                                                    18300000
183100                                                                  18310000
183200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18320000
183300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18330000
183400         CONTINUE                                                 18340000
183500     ELSE                                                         18350000
183600         SET DP013-CICS-ABEND     TO TRUE                         18360000
183700         SET DP013-NO-ROLLBACK    TO TRUE                         18370000
183800         MOVE '4410-READ-TEMP-STORAGE'                            18380000
183900                                  TO DP013-PARAGRAPH              18390000
184000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18400000
184100                                  TO DP013-MESSAGE-TEXT(1)        18410000
184200         PERFORM DP013-0000-PROCESS-ABEND                         18420000
184300     END-IF.                                                      18430000
184400                                                                  18440000
184500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18450000
184600                                                                  18460000
184700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18470000
184800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18480000
184900     END-IF.                                                      18490000
185000 EJECT                                                            18500000
185100*----------------------------------------------------------------*18510000
185200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18520000
185300*----------------------------------------------------------------*18530000
185400                                                                  18540000
185500 4420-FORMAT-LIST-LINES.                                          18550000
185600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18560000
185700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18570000
185800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           18580000
185900         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           18590000
186000         MOVE SPACE              TO MR-SELECTI (PV-SUB)           18600000
186100                                    MR-SHORT-NME (PV-SUB)         18610000
186200                                    MR-LONG-NME (PV-SUB)          18620000
186300                                    MR-TYPE (PV-SUB)              18630000
186400                                    MR-YEAR (PV-SUB)              18640000
186500                                    MR-RELS-BEGIN-DTE (PV-SUB)    18650000
186600                                    MR-RELS-END-DTE (PV-SUB)      18660000
186700                                    MR-SETUP-BEGIN-DTE (PV-SUB)   18670000
186800                                    MR-SETUP-END-DTE (PV-SUB)     18680000
186810                                    MR-PO-RCPT-RPTG-IND (PV-SUB)  18681066
186900     ELSE                                                         18690000
187000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18700000
187100                                                   > SPACE        18710000
187200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18720000
187300                                 TO MR-SELECTI (PV-SUB)           18730000
187400         ELSE                                                     18740000
187500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18750000
187600                                 TO MR-SELECTI (PV-SUB)           18760000
187700         END-IF                                                   18770000
187800                                                                  18780000
187900         IF  DP030-SET-CURSOR-TRAILER                             18790000
188000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)18800000
188100                 > SPACE)                                         18810000
188200               OR (PV-SUB = 1))                                   18820000
188300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18830000
188400                MOVE -1          TO MR-SELECTL (PV-SUB)           18840000
188500             END-IF                                               18850000
188600         END-IF                                                   18860000
188700                                                                  18870000
188800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18880000
188900             MOVE ASC-SHORT-NME (ASC-BLK-SUB ASC-ITEM-SUB)        18890000
189000                                 TO MR-SHORT-NME (PV-SUB)         18900000
189100             MOVE ASC-LONG-NME (ASC-BLK-SUB ASC-ITEM-SUB)         18910000
189200                                 TO MR-LONG-NME (PV-SUB)          18920000
189300             MOVE ASC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)             18930000
189400                                 TO MR-TYPE (PV-SUB)              18940000
189500             MOVE ASC-YEAR (ASC-BLK-SUB ASC-ITEM-SUB)             18950000
189600                                 TO MR-YEAR (PV-SUB)              18960000
189700             MOVE ASC-RELS-BEGIN-DTE (ASC-BLK-SUB ASC-ITEM-SUB)   18970000
189800                                 TO MR-RELS-BEGIN-DTE (PV-SUB)    18980000
189900             MOVE ASC-RELS-END-DTE (ASC-BLK-SUB ASC-ITEM-SUB)     18990000
190000                                 TO MR-RELS-END-DTE (PV-SUB)      19000000
190100             MOVE ASC-SETUP-BEGIN-DTE (ASC-BLK-SUB ASC-ITEM-SUB)  19010000
190200                                 TO MR-SETUP-BEGIN-DTE (PV-SUB)   19020000
190300             MOVE ASC-SETUP-END-DTE (ASC-BLK-SUB ASC-ITEM-SUB)    19030000
190400                                 TO MR-SETUP-END-DTE (PV-SUB)     19040000
190411             MOVE ASC-PO-RCPT-RPTG-IND (ASC-BLK-SUB ASC-ITEM-SUB) 19041166
190420                                 TO MR-PO-RCPT-RPTG-IND (PV-SUB)  19042066
190500         END-IF                                                   19050000
190600     END-IF.                                                      19060000
190700                                                                  19070000
190800     SUBTRACT +1 FROM ASC-ITEM-SUB                                19080000
190900     IF  ASC-ITEM-SUB < + 1                                       19090000
191000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19100000
191100         MOVE +1                 TO ASC-BLK-SUB                   19110000
191200     END-IF.                                                      19120000
191300******************************************************************19130000
191400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19140000
191500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19150000
191600** ISSUE A WARNING.                                             **19160000
191700******************************************************************19170000
191800 4430-CHECK-FOR-BEGIN-AND-END.                                    19180000
191900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19190000
192000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19200000
192100*            -- NO END-OF-RANGE SPECFIED ---                      19210000
192200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19220000
192300             SET DP020-MSG-WARNING TO TRUE                        19230000
192400             PERFORM 4431-POSITION-AT-WARNING                     19240000
192500         END-IF                                                   19250000
192600     ELSE                                                         19260000
192700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19270000
192800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19280000
192900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19290000
193000             SET DP020-MSG-WARNING TO TRUE                        19300000
193100             PERFORM 4431-POSITION-AT-WARNING                     19310000
193200         END-IF                                                   19320000
193300     END-IF.                                                      19330000
193400******************************************************************19340000
193500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19350000
193600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19360000
193700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19370000
193800** POSITION THE CURSOR THERE.                                   **19380000
193900******************************************************************19390000
194000 4431-POSITION-AT-WARNING.                                        19400000
194100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19410000
194200                    - PV-TOP-ITEM + 1.                            19420000
194300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19430000
194400         CONTINUE                                                 19440000
194500     ELSE                                                         19450000
194600         SET DP030-SET-CURSOR-APPL-1                              19460000
194700                                   TO TRUE                        19470000
194800         MOVE -1                   TO MR-SELECTL (PV-SUB)         19480000
194900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19490000
195000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19500000
195100     END-IF.                                                      19510000
195200                                                                  19520000
195300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19530000
195400                    - PV-TOP-ITEM + 1.                            19540000
195500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19550000
195600         CONTINUE                                                 19560000
195700     ELSE                                                         19570000
195800         SET DP030-SET-CURSOR-APPL-1                              19580000
195900                                   TO TRUE                        19590000
196000         MOVE -1                   TO MR-SELECTL (PV-SUB)         19600000
196100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19610000
196200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19620000
196300     END-IF.                                                      19630000
196400 EJECT                                                            19640000
196500*----------------------------------------------------------------*19650000
196600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19660000
196700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19670000
196800* FOR THE SELECTED ITEMS QUEUE.                                  *19680000
196900*                                                                *19690000
197000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19700000
197100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19710000
197200* THE ARRAY IS FULL.                                             *19720000
197300*----------------------------------------------------------------*19730000
197400                                                                  19740000
197500 5000-PREPARE-SEL-QUEUE.                                          19750000
197600                                                                  19760000
197700     MOVE +1                   TO  ASC-BLK-SUB.                   19770000
197800     PERFORM 5100-WRITE-TEMP-STORAGE.                             19780000
197900     ADD +1                    TO  ASC-BLK-SUB.                   19790000
198000     PERFORM 5100-WRITE-TEMP-STORAGE.                             19800000
198100                                                                  19810000
198200     MOVE ASC-SEL-QUEUE-NAME TO    PO078-SEL-QUEUE-NAME.          19820057
198300     PERFORM 6010-DELETE-SEL-QUEUE.                               19830000
198400                                                                  19840000
198500     SET ASC-UPDATE-TSQ        TO  TRUE.                          19850000
198600                                                                  19860000
198700     SET PO077-IDX             TO  1.                             19870000
198800     MOVE ZERO                 TO PO078-NUMBER-OF-TS-ITEMS.       19880000
198900     INITIALIZE PO077-SELECTED-ITEM-ARRAY.                        19890000
199000                                                                  19900000
199100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19910000
199200             VARYING PV-ITEM                                      19920000
199300             FROM 1 BY 1                                          19930000
199400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19940000
199500                                                                  19950000
199600     IF  PO077-IDX > 1                                            19960000
199700         PERFORM 5205-WRITE-SEL-QUEUE                             19970000
199800         ADD +1                TO PO078-NUMBER-OF-TS-ITEMS        19980000
199900     END-IF.                                                      19990000
200000 EJECT                                                            20000000
200100*----------------------------------------------------------------*20010000
200200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20020000
200300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20030000
200400*----------------------------------------------------------------*20040000
200500                                                                  20050000
200600 5100-WRITE-TEMP-STORAGE.                                         20060000
200700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20070000
200800                                   TO PV-LIST-ITEM-NUMBER.        20080000
200900     COMPUTE PV-BLOCK-NUMBER =                                    20090000
201000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20100000
201100                                                                  20110000
201200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20120000
201300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20130000
201400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20140000
201500             PERFORM 5105-REWRITE-ASC-LISTQ                       20150000
201600         END-IF                                                   20160000
201700     ELSE                                                         20170000
201800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20180000
201900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20190000
202000         PERFORM 5110-WRITE-ASC-LISTQ                             20200000
202100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20210000
202200     END-IF.                                                      20220000
202300                                                                  20230000
202400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20240000
202500******************************************************************20250000
202600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20260000
202700** SPECIFIC COMMAREA.                                           **20270000
202800******************************************************************20280000
202900 5105-REWRITE-ASC-LISTQ.                                          20290000
203000     EXEC CICS                                                    20300000
203100         WRITEQ TS                                                20310000
203200             QUEUE (ASC-LIST-QUEUE-NAME)                          20320000
203300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20330000
203400             ITEM  (PV-BLOCK-NUMBER)                              20340000
203500             REWRITE                                              20350000
203600             RESP  (PV-CICS-RESP)                                 20360000
203700     END-EXEC.                                                    20370000
203800                                                                  20380000
203900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20390000
204000         CONTINUE                                                 20400000
204100     ELSE                                                         20410000
204200         SET DP013-CICS-ABEND            TO TRUE                  20420000
204300         SET DP013-NO-ROLLBACK           TO TRUE                  20430000
204400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20440000
204500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20450000
204600                                         TO DP013-MESSAGE-TEXT(1) 20460000
204700         PERFORM DP013-0000-PROCESS-ABEND                         20470000
204800     END-IF.                                                      20480000
204900                                                                  20490000
205000******************************************************************20500000
205100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20510000
205200** SPECIFIC COMMAREA.                                           **20520000
205300******************************************************************20530000
205400 5110-WRITE-ASC-LISTQ.                                            20540000
205500     EXEC CICS                                                    20550000
205600         WRITEQ TS                                                20560000
205700             QUEUE (ASC-LIST-QUEUE-NAME)                          20570000
205800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20580000
205900             ITEM  (PV-BLOCK-NUMBER)                              20590000
206000             RESP  (PV-CICS-RESP)                                 20600000
206100     END-EXEC.                                                    20610000
206200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20620000
206300         SET DP013-CICS-ABEND      TO TRUE                        20630000
206400         SET DP013-NO-ROLLBACK     TO TRUE                        20640000
206500         MOVE '5110-WRITE-ASC-LISTQ'                              20650000
206600                                   TO DP013-PARAGRAPH             20660000
206700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20670000
206800                                   TO DP013-MESSAGE-TEXT(1)       20680000
206900         PERFORM DP013-0000-PROCESS-ABEND                         20690000
207000     END-IF.                                                      20700000
207100 EJECT                                                            20710000
207200*----------------------------------------------------------------*20720000
207300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *20730000
207400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *20740000
207500*----------------------------------------------------------------*20750000
207600                                                                  20760000
207700 5200-FILL-SEL-QUEUE-RECORD.                                      20770000
207800                                                                  20780000
207900     PERFORM 6112-READ-LIST-QUEUE.                                20790000
208000                                                                  20800000
208100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20810000
208200         PERFORM                                                  20820000
208300         VARYING LQW-IDX                                          20830000
208400         FROM 1 BY 1                                              20840000
208500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20850000
208600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20860000
208700                                                                  20870000
208800             IF  LQW-SELECT (LQW-IDX)                             20880000
208900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              20890000
209000                                   TO PO077-ITEM (PO077-IDX)      20900000
209100                 MOVE LQW-SHORT-NME (LQW-IDX)                     20910000
209200                                   TO PO077-SHORT-NME (PO077-IDX) 20920000
209300                 MOVE LQW-YEAR (LQW-IDX)                          20930000
209400                                   TO PO077-YEAR (PO077-IDX)      20940000
209500                 MOVE SPACE        TO PO077-ACTION-SW (PO077-IDX) 20950000
209600                 SET PO077-IDX UP BY 1                            20960000
209700                 IF  PO077-IDX > PO077-MAX-ITEMS                  20970000
209800                     PERFORM 5205-WRITE-SEL-QUEUE                 20980000
209900                     ADD +1        TO PO078-NUMBER-OF-TS-ITEMS    20990000
210000                     INITIALIZE PO077-SELECTED-ITEM-ARRAY         21000000
210100                     SET PO077-IDX TO  1                          21010000
210200                 END-IF                                           21020000
210300             END-IF                                               21030000
210400         END-PERFORM                                              21040000
210500     END-IF.                                                      21050000
210600                                                                  21060000
210700                                                                  21070000
210800*----------------------------------------------------------------*21080000
210900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21090000
211000*----------------------------------------------------------------*21100000
211100                                                                  21110000
211200 5205-WRITE-SEL-QUEUE.                                            21120000
211300                                                                  21130000
211400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21140000
211500                                   TO PO077-SELECTED-ITEMS.       21150000
211600                                                                  21160000
211700     EXEC CICS                                                    21170000
211800          WRITEQ TS                                               21180000
211900              QUEUE (ASC-SEL-QUEUE-NAME)                          21190058
212000              FROM  (PO077-SET-SEL-REC)                           21200000
212100              ITEM  (PV-SEL-QUEUE-ITEM)                           21210000
212200              RESP  (PV-CICS-RESP)                                21220000
212300     END-EXEC.                                                    21230000
212400                                                                  21240000
212500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21250000
212600         CONTINUE                                                 21260000
212700     ELSE                                                         21270000
212800         SET DP013-CICS-ABEND      TO TRUE                        21280000
212900         SET DP013-NO-ROLLBACK     TO TRUE                        21290000
213000         MOVE '5205-WRITE-SEL-QUEUE'                              21300000
213100                                   TO DP013-PARAGRAPH             21310000
213200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21320000
213300                                   TO DP013-MESSAGE-TEXT(1)       21330000
213400         PERFORM DP013-0000-PROCESS-ABEND                         21340000
213500     END-IF.                                                      21350000
213600 EJECT                                                            21360000
213700******************************************************************21370000
213800** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21380000
213900** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21390000
214000** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21400000
214100** THE USER.                                                    **21410000
214200******************************************************************21420000
214300 6000-REFRESH-PANEL-FROM-TEMP.                                    21430000
214400     IF  ASC-UPDATE-TSQ                                           21440000
214500         SET ASC-NO-TSQ-UPDATE TO TRUE                            21450000
214600         MOVE ZERO                 TO PV-SAVE-ITEM                21460000
214700                                      PV-SEL-QUEUE-ITEM           21470000
214800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21480000
214900                                   TO PV-HOLD-SELECTED-ITEMS      21490000
215000         MOVE +1                   TO PV-ITEMS-PROCESSED          21500000
215100         PERFORM 6100-UPDATE-TSQ                                  21510000
215200             UNTIL PV-ITEMS-PROCESSED >                           21520000
215300                                     PV-HOLD-SELECTED-ITEMS       21530000
215400         PERFORM 6010-DELETE-SEL-QUEUE                            21540000
215500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21550000
215600                    ASC-BLOCK-ENTRIES (2)                         21560000
215700     END-IF.                                                      21570000
215800                                                                  21580000
215900*----------------------------------------------------------------*21590000
216000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21600000
216100*----------------------------------------------------------------*21610000
216200 6010-DELETE-SEL-QUEUE.                                           21620000
216300                                                                  21630000
216400     EXEC CICS                                                    21640000
216500         DELETEQ TS                                               21650000
216600             QUEUE (ASC-SEL-QUEUE-NAME)                           21660058
216700             RESP  (PV-CICS-RESP)                                 21670000
216800     END-EXEC.                                                    21680000
216900                                                                  21690000
217000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21700000
217100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         21710000
217200         CONTINUE                                                 21720000
217300     ELSE                                                         21730000
217400         SET DP013-CICS-ABEND TO TRUE                             21740000
217500         SET DP013-NO-ROLLBACK TO TRUE                            21750000
217600         MOVE '6010-DELETE-SEL-QUEUE'                             21760000
217700                        TO DP013-PARAGRAPH                        21770000
217800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         21780000
217900                        TO DP013-MESSAGE-TEXT (1)                 21790000
218000         PERFORM DP013-0000-PROCESS-ABEND                         21800000
218100     END-IF.                                                      21810000
218200                                                                  21820000
218300*----------------------------------------------------------------*21830000
218400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *21840000
218500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *21850000
218600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21860000
218700*    THE TEMP QUEUE.                                             *21870000
218800*----------------------------------------------------------------*21880000
218900                                                                  21890000
219000 6100-UPDATE-TSQ.                                                 21900000
219100                                                                  21910000
219200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21920000
219300     PERFORM 6105-READ-SEL-QUEUE.                                 21930000
219400     PERFORM                                                      21940000
219500         VARYING PO077-IDX                                        21950000
219600         FROM 1 BY 1                                              21960000
219700         UNTIL ((PV-ITEMS-PROCESSED >                             21970000
219800                              PV-HOLD-SELECTED-ITEMS)             21980000
219900         OR (PO077-IDX GREATER THAN PO077-MAX-ITEMS))             21990000
220000         IF  PO077-ACTION-SW (PO077-IDX) > SPACE                  22000000
220100             PERFORM 6110-PROCESS-ITEMS                           22010000
220200         END-IF                                                   22020000
220300         ADD +1                TO PV-ITEMS-PROCESSED              22030000
220400     END-PERFORM.                                                 22040000
220500     PERFORM 6111-WRITE-LIST-QUEUE.                               22050000
220600*----------------------------------------------------------------*22060000
220700*    READ THE LIST QUEUE RECORD.                                 *22070000
220800*----------------------------------------------------------------*22080000
220900                                                                  22090000
221000 6105-READ-SEL-QUEUE.                                             22100000
221100                                                                  22110000
221200     EXEC CICS                                                    22120000
221300          READQ TS                                                22130000
221400              QUEUE (ASC-SEL-QUEUE-NAME)                          22140058
221500              INTO  (PO077-SET-SEL-REC)                           22150000
221600              ITEM  (PV-SEL-QUEUE-ITEM)                           22160000
221700              RESP  (PV-CICS-RESP)                                22170000
221800     END-EXEC.                                                    22180000
221900                                                                  22190000
222000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22200000
222100         CONTINUE                                                 22210000
222200     ELSE                                                         22220000
222300         SET DP013-CICS-ABEND      TO  TRUE                       22230000
222400         SET DP013-NO-ROLLBACK     TO  TRUE                       22240000
222500         MOVE '6105-READ-SEL-QUEUE'                               22250000
222600                                   TO  DP013-PARAGRAPH            22260000
222700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22270000
222800                                   TO  DP013-MESSAGE-TEXT(1)      22280000
222900         PERFORM DP013-0000-PROCESS-ABEND                         22290000
223000     END-IF.                                                      22300000
223100 EJECT                                                            22310000
223200*----------------------------------------------------------------*22320000
223300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22330000
223400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22340000
223500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22350000
223600*----------------------------------------------------------------*22360000
223700                                                                  22370000
223800 6110-PROCESS-ITEMS.                                              22380000
223900                                                                  22390000
224000     COMPUTE PV-ITEM = 1 + ((PO077-ITEM (PO077-IDX) - 1)          22400000
224100                     / PC-ITEMS-PER-PANEL).                       22410000
224200                                                                  22420000
224300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22430000
224400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22440000
224500             PERFORM 6111-WRITE-LIST-QUEUE                        22450000
224600         END-IF                                                   22460000
224700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22470000
224800                                                                  22480000
224900         PERFORM 6112-READ-LIST-QUEUE                             22490000
225000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22500000
225100             CONTINUE                                             22510000
225200         END-IF                                                   22520000
225300     END-IF.                                                      22530000
225400                                                                  22540000
225500     COMPUTE PV-SUB = (PO077-ITEM (PO077-IDX)                     22550000
225600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22560000
225700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22570000
225800     MOVE LQW-SELECTED-SW (PV-SUB)                                22580000
225900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22590000
226000                                                                  22600000
226100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22610000
226200                                                                  22620000
226300*----------------------------------------------------------------*22630000
226400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22640000
226500*----------------------------------------------------------------*22650000
226600                                                                  22660000
226700 6111-WRITE-LIST-QUEUE.                                           22670000
226800                                                                  22680000
226900     EXEC CICS                                                    22690000
227000         WRITEQ TS                                                22700000
227100             QUEUE (ASC-LIST-QUEUE-NAME)                          22710000
227200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22720000
227300             ITEM  (PV-SAVE-ITEM)                                 22730000
227400             REWRITE                                              22740000
227500             RESP  (PV-CICS-RESP)                                 22750000
227600     END-EXEC.                                                    22760000
227700                                                                  22770000
227800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22780000
227900         CONTINUE                                                 22790000
228000     ELSE                                                         22800000
228100         SET DP013-CICS-ABEND  TO  TRUE                           22810000
228200         SET DP013-NO-ROLLBACK TO  TRUE                           22820000
228300         MOVE '6111-WRITE-LIST-QUEUE'                             22830000
228400                               TO  DP013-PARAGRAPH                22840000
228500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22850000
228600                               TO  DP013-MESSAGE-TEXT(1)          22860000
228700         PERFORM DP013-0000-PROCESS-ABEND                         22870000
228800     END-IF.                                                      22880000
228900                                                                  22890000
229000 EJECT                                                            22900000
229100*----------------------------------------------------------------*22910000
229200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22920000
229300*----------------------------------------------------------------*22930000
229400                                                                  22940000
229500 6112-READ-LIST-QUEUE.                                            22950000
229600                                                                  22960000
229700     EXEC CICS                                                    22970000
229800         READQ TS                                                 22980000
229900             QUEUE (ASC-LIST-QUEUE-NAME)                          22990000
230000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23000000
230100             ITEM  (PV-ITEM)                                      23010000
230200             RESP  (PV-CICS-RESP)                                 23020000
230300     END-EXEC.                                                    23030000
230400                                                                  23040000
230500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23050000
230600         CONTINUE                                                 23060000
230700     ELSE                                                         23070000
230800         SET DP013-CICS-ABEND        TO TRUE                      23080000
230900         SET DP013-NO-ROLLBACK       TO TRUE                      23090000
231000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23100000
231100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23110000
231200                                     TO DP013-MESSAGE-TEXT(1)     23120000
231300         PERFORM DP013-0000-PROCESS-ABEND                         23130000
231400     END-IF.                                                      23140000
231500                                                                  23150000
231600 EJECT                                                            23160000
231700*----------------------------------------------------------------*23170000
231800*    ABEND PROCESSOR MODULE                                      *23180000
231900*----------------------------------------------------------------*23190000
232000                                                                  23200000
232100     COPY DPPD013.                                                23210000
