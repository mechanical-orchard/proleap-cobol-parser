       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.    MLKUT213.                                         00030000
       AUTHOR.        B. GRAHAM STRATAGEM.                              00040000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
       DATE-WRITTEN.  05-30-2008.                                       00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ******************************************************************00090000
      * MLKUT213 - DESCRIPTION.............                             00100000
      *                                                                 00110000
      * CREATE UNLOAD CONTROL CARDS FOR UNLOAD OF SKU BOM SNAPSHOT      00120000
      *                                                                 00130000
      * THIS PROGRAM WILL USE AN INPUT DATE (BEGINNING OF MONTH),       00140000
      * VERIFY THAT IT IS A CORRECT DATE, AND DETERMINE THE DATE FOR    00150000
      * THE BEGINNING OF THE PREVIOUS MONTH.                            00160000
      * TWO CONTROL CARDS WILL BE WRITTEN OUT CONTAINING THE CONTROL    00170000
      * INFORMATION INCLUDING THE SELECTION DATE FOR EACH MONTH         00180000
      * (CURRENT AND PREVIOUS).                                         00190000
      *                                                                 00200000
      *CHANGE HISTORY:                                                  00260000
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00270000
      * ------- ---------- ----------- -------------------------------- 00280000
      * W34517  07-29-2008 B.GRAHAM ORIGINAL IMPLEMENTATION             00290010
      *                                                                 00300000
      ******************************************************************00310000
                                                                        00320000
       ENVIRONMENT DIVISION.                                            00330000
                                                                        00340000
       CONFIGURATION SECTION.                                           00350000
       SOURCE-COMPUTER.        IBM-3090.                                00360000
       OBJECT-COMPUTER.        IBM-3090.                                00370000
                                                                        00380000
       INPUT-OUTPUT SECTION.                                            00390000
       FILE-CONTROL.                                                    00400000
                                                                        00410000
           SELECT BOM-DATE-IN                                           00420000
               ASSIGN TO INP01.                                         00430000
                                                                        00440000
           SELECT UNLOAD-CNTL-CURR-MN                                   00440104
               ASSIGN TO OUT01.                                         00460000
                                                                        00470000
           SELECT UNLOAD-CNTL-PREV-MN                                   00480004
               ASSIGN TO OUT02.                                         00490000
                                                                        00491007
           SELECT DATE-CNTL-FILE                                        00492007
               ASSIGN TO OUT03.                                         00493007
                                                                        00500000
      ******************************************************************00510000
       DATA DIVISION.                                                   00520000
      ******************************************************************00530000
       FILE SECTION.                                                    00540000
                                                                        00550000
       FD  BOM-DATE-IN                                                  00560000
           LABEL RECORDS ARE STANDARD                                   00570000
           RECORDING MODE  F                                            00580000
           BLOCK CONTAINS 0 RECORDS.                                    00590000
       01  BOM-DATE-IN-REC             PIC X(80).                       00600000
                                                                        00610000
       FD  UNLOAD-CNTL-CURR-MN                                          00620000
           LABEL RECORDS ARE STANDARD                                   00630000
           RECORDING MODE  F                                            00640000
           BLOCK CONTAINS 0 RECORDS.                                    00650000
       01  UNLOAD-CNTL-CURR-MN-REC     PIC X(80).                       00660000
                                                                        00670000
       FD  UNLOAD-CNTL-PREV-MN                                          00680000
           LABEL RECORDS ARE STANDARD                                   00690000
           RECORDING MODE  F                                            00700000
           BLOCK CONTAINS 0 RECORDS.                                    00710000
       01  UNLOAD-CNTL-PREV-MN-REC     PIC X(80).                       00720000
                                                                        00721007
       FD  DATE-CNTL-FILE                                               00722007
           LABEL RECORDS ARE STANDARD                                   00723007
           RECORDING MODE  F                                            00724007
           BLOCK CONTAINS 0 RECORDS.                                    00725007
       01  DATE-CNTL-REC               PIC X(80).                       00726007
                                                                        00730000
                                                                        00790000
       EJECT                                                            00800000
                                                                        00810000
       WORKING-STORAGE SECTION.                                         00820000
                                                                        00830005
       01  PC-PROGRAM-CONSTANTS.                                        00840005
           05  PC-4005                 PIC S9(08)  VALUE +4013.         00850005
           05  PC-4013                 PIC S9(08)  VALUE +4013.         00860005
                                                                        00960000
       01  PROGRAM-VARIABLES.                                           00970000
           05  PV-CURR-MN-BEG-DTE      PIC X(10)   VALUE SPACES.        01010003
           05  PV-PREV-MN-BEG-DTE      PIC X(10)   VALUE SPACES.        01011003
           05  PV-PREV-MN-EOM-DTE      PIC X(10)   VALUE SPACES.        01012007
           05  PV-CURR-MN-NBR          PIC X(02)   VALUE SPACES.        01013009
                                                                        01130005
       01  PV-UNLOAD-CNTL-MN-REC.                                       01140001
           05  FILLER                  PIC X(16)   VALUE SPACES.        01150001
           05  FILLER                  PIC X(01)   VALUE QUOTE.         01151001
           05  PV-UNLOAD-DTE           PIC X(10)   VALUE SPACES.        01160004
           05  FILLER                  PIC X(01)   VALUE QUOTE.         01170001
           05  FILLER                  PIC X(01)   VALUE ';'.           01170101
           05  FILLER                  PIC X(51)   VALUE SPACES.        01171001
                                                                        01180000
      *** VALID DATE FORMAT IS CCYY-MM-DD ***                           01181001
                                                                        01182001
       01  PV-BOM-DATE-IN-REC.                                          01190001
           05  PV-BDI-DATE             PIC X(10).                       01200001
           05  FILLER                  PIC X(70).                       01210001
                                                                        01240000
                                                                        01240101
                                                                        01240207
       01  PV-DATE-CNTL-REC.                                            01240307
           05  PV-CURR-BOM-DATE        PIC X(10)   VALUE SPACES.        01240407
           05  FILLER                  PIC X(01)   VALUE SPACES.        01240507
           05  PV-PREV-BOM-DATE        PIC X(10)   VALUE SPACES.        01240607
           05  FILLER                  PIC X(01)   VALUE SPACES.        01240707
           05  PV-PREV-EOM-DATE        PIC X(10)   VALUE SPACES.        01240807
           05  FILLER                  PIC X(01)   VALUE SPACES.        01240909
           05  PV-CURR-FSCL-MN-NBR     PIC X(02)   VALUE SPACES.        01241009
           05  FILLER                  PIC X(45)   VALUE SPACES.        01241109
                                                                        01241209
                                                                        01241309
                                                                        01242007
       EJECT                                                            01250000
                                                                        01260000
      *-----------------------------------------------------------------01270000
      *  ABEND AREA                                                     01280000
      *-----------------------------------------------------------------01290000
       01 ABEND-AREAS.                                                  01300000
           05 ABEND-CODE               PIC S9(08)  VALUE ZERO           01310004
                                                   COMP SYNC.           01320000
               88  AC-BAD-DATA                     VALUE +4003.         01330000
               88  AC-DB2-ERROR                    VALUE +4013.         01340000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01350000
                   '***** ABEND'.                                       01360000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01370000
                   '***** PROGRAM: MLKUT213'.                           01380000
           05  AA-PARAGRAPH-LIT.                                        01390000
               10  FILLER              PIC X(17)   VALUE                01400000
                   '***** PARAGRAPH: '.                                 01410000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01420000
           05  AA-MESSAGE-LINE.                                         01430000
               10  FILLER              PIC X(06)   VALUE '*****'.       01440000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01450000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01460000
                   '*****    DB2 ERROR'.                                01470000
           05  AA-DB2-OPERATION-LIT.                                    01480000
               10  FILLER              PIC X(17)   VALUE                01490000
                   '***** OPERATION: '.                                 01500000
               10  AA-DB2-OPERATION.                                    01510000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01520000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01530000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01540000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01550000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01560000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01570000
                                                                        01580000
       EJECT                                                            01590000
                                                                        01630000
      ******************************************************************01640000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01650000
      ******************************************************************01660000
           COPY DPWS004.                                                01670000
                                                                        01680000
      ******************************************************************01690000
      *  USED FOR DB2 ERRORS                                            01700000
      ******************************************************************01710000
           EXEC SQL                                                     01720000
               INCLUDE SQLCA                                            01730000
           END-EXEC.                                                    01740000
                                                                        01820000
      ******************************************************************01830000
      *  LAYOUT FOR DATE TABLE                                          01840000
      ******************************************************************01850000
           EXEC SQL                                                     01860000
               INCLUDE TDTATTR                                          01870000
           END-EXEC.                                                    01880000
                                                                        01890000
                                                                        02430000
       EJECT                                                            02440000
      ******************************************************************02450000
       PROCEDURE DIVISION.                                              02460000
      ******************************************************************02470000
                                                                        02480000
       0000-MAINLINE-MLKUT213.                                          02490000
                                                                        02500000
           PERFORM 1000-INITIALIZATION.                                 02510000
                                                                        02520000
           PERFORM 2000-GET-BOM-DATE.                                   02521001
                                                                        02522001
           PERFORM 3000-CREATE-OUTPUTS.                                 02524002
                                                                        02540000
           PERFORM 8000-EOJ.                                            02550000
                                                                        02560000
           STOP RUN.                                                    02570000
                                                                        02580000
           EJECT                                                        02590000
                                                                        02600000
      ******************************************************************02610000
       1000-INITIALIZATION.                                             02620000
      ******************************************************************02630000
                                                                        02640000
           OPEN INPUT  BOM-DATE-IN                                      02670001
           OPEN OUTPUT UNLOAD-CNTL-CURR-MN                              02680004
                       UNLOAD-CNTL-PREV-MN                              02690007
                       DATE-CNTL-FILE.                                  02700007
                                                                        02710000
                                                                        02720000
       EJECT                                                            02730000
      ******************************************************************02740000
       2000-GET-BOM-DATE.                                               02750001
      ******************************************************************02760000
                                                                        02770000
           PERFORM 2100-READ-BOM-DATE-FILE.                             02780005
                                                                        02800002
           PERFORM 2200-VALIDATE-DATE.                                  02801005
                                                                        02820001
      ******************************************************************02821001
       2100-READ-BOM-DATE-FILE.                                         02830001
      ******************************************************************02831001
                                                                        02840001
           READ BOM-DATE-IN INTO PV-BOM-DATE-IN-REC                     02850001
               AT END                                                   02860001
                   MOVE '2100-READ-BOM-DATE-FILE' TO AA-PARAGRAPH-NAME  02870001
                   MOVE 'MISSING INPUT BOM DATE'  TO AA-MESSAGE         02880002
                   MOVE PC-4005  TO ABEND-CODE                          02890001
                   PERFORM 9900-COMMON-ABEND-ROUTINE.                   02900002
                                                                        02910001
           DISPLAY 'INPUT BOM DATE IS : ' PV-BOM-DATE-IN-REC.           02911005
                                                                        02920001
                                                                        02930002
      ******************************************************************02940002
       2200-VALIDATE-DATE.                                              02950002
      ******************************************************************02960002
                                                                        02970002
           EXEC SQL                                                     02970106
           SELECT A.FSCL_MN_BEG_DTE,                                    02971006
                  B.FSCL_MN_BEG_DTE,                                    02972007
                  A.PFM_END_DTE,                                        02972109
                  A.FSCL_MN_NBR                                         02972209
                INTO :PV-CURR-MN-BEG-DTE,                               02973006
                     :PV-PREV-MN-BEG-DTE,                               02973107
                     :PV-PREV-MN-EOM-DTE,                               02973209
                     :PV-CURR-MN-NBR                                    02973309
                FROM TDTATTR A,                                         02973409
                     TDTATTR B                                          02974002
                WHERE A.KY_DTE = :PV-BDI-DATE                           02975002
                  AND A.KY_DTE = A.FSCL_MN_BEG_DTE                      02976002
                  AND B.KY_DTE = A.PFM_END_DTE                          02977004
                                                                        02978002
           END-EXEC.                                                    02979002
                                                                        02979104
           EVALUATE TRUE                                                02979402
               WHEN SQLCODE = 0                                         02979502
                   CONTINUE                                             02979602
               WHEN OTHER                                               02979902
                   MOVE '2200-VALIDATE-DATE'                            02980003
                                       TO AA-PARAGRAPH-NAME             02980102
                   MOVE 'CONTROL CARD WILL NOT RETURN A VALID DATE'     02980202
                                       TO AA-MESSAGE                    02980302
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02980402
                   PERFORM 9901-SQL-ERROR                               02980502
           END-EVALUATE.                                                02980602
                                                                        02990002
      ******************************************************************02991004
       3000-CREATE-OUTPUTS.                                             03000004
      ******************************************************************03001004
                                                                        03010004
           MOVE PV-CURR-MN-BEG-DTE TO PV-UNLOAD-DTE.                    03020004
                                                                        03021004
           WRITE UNLOAD-CNTL-CURR-MN-REC FROM PV-UNLOAD-CNTL-MN-REC.    03022004
                                                                        03023004
           MOVE PV-PREV-MN-BEG-DTE TO PV-UNLOAD-DTE.                    03030004
                                                                        03040004
           WRITE UNLOAD-CNTL-PREV-MN-REC FROM PV-UNLOAD-CNTL-MN-REC.    03050005
                                                                        03060004
           MOVE PV-CURR-MN-BEG-DTE TO PV-CURR-BOM-DATE.                 03070007
           MOVE PV-PREV-MN-BEG-DTE TO PV-PREV-BOM-DATE.                 03080007
           MOVE PV-PREV-MN-EOM-DTE TO PV-PREV-EOM-DATE.                 03090007
           MOVE PV-CURR-MN-NBR     TO PV-CURR-FSCL-MN-NBR.              03091009
                                                                        03100007
           WRITE DATE-CNTL-REC FROM PV-DATE-CNTL-REC.                   03110007
                                                                        03120007
           DISPLAY 'PV-CURR-BOM-DATE '  PV-CURR-BOM-DATE.               03130007
           DISPLAY 'PV-PREV-BOM-DATE '  PV-PREV-BOM-DATE.               03140007
           DISPLAY 'PV-PREV-EOM-DATE '  PV-PREV-EOM-DATE.               03150007
                                                                        03160007
                                                                        08410000
      ******************************************************************08420000
       8000-EOJ.                                                        08430000
      ******************************************************************08440000
                                                                        08450000
           CLOSE BOM-DATE-IN                                            08460004
                 UNLOAD-CNTL-CURR-MN                                    08470004
                 UNLOAD-CNTL-PREV-MN                                    08480007
                 DATE-CNTL-FILE.                                        08490007
                                                                        08500004
                                                                        08510000
      ******************************************************************08520000
       9900-COMMON-ABEND-ROUTINE.                                       08530000
      ******************************************************************08540000
                                                                        08550000
           DISPLAY AA-ABEND-LIT.                                        08560000
           DISPLAY AA-PROGRAM-LIT.                                      08570000
           DISPLAY AA-PARAGRAPH-LIT.                                    08580000
           DISPLAY AA-MESSAGE-LINE.                                     08590000
           DISPLAY ABEND-CODE.                                          08600000
                                                                        08610000
           CALL 'ILBOABN0' USING ABEND-CODE.                            08620000
                                                                        08630000
           EJECT                                                        08640000
                                                                        08650000
      ******************************************************************08660000
       9901-SQL-ERROR.                                                  08670000
      ******************************************************************08680000
                                                                        08690000
                                                                        08730000
           DISPLAY AA-ABEND-LIT.                                        08740000
           DISPLAY AA-DB2-ERROR-LIT.                                    08750000
           DISPLAY AA-PROGRAM-LIT.                                      08760000
           DISPLAY AA-PARAGRAPH-LIT.                                    08770000
           DISPLAY AA-MESSAGE-LINE.                                     08780000
           DISPLAY AA-DB2-OPERATION-LIT.                                08790000
           SET AC-DB2-ERROR TO TRUE.                                    08800000
           MOVE PC-4013                TO ABEND-CODE.                   08810004
                                                                        08820000
           COPY DPPD004.                                                08830000
           CALL 'ILBOABN0' USING ABEND-CODE.                            08840000
                                                                        08850000
