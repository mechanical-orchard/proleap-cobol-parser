000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    CEKRP052.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  DECEMBER 2015.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM READS IN THE CENTRAL STOCK BOL AND CARTON DATA  * 00100000
001100*  FROM SHIPPED FROM THE EFC TO RDC.                            * 00110000
001200*                                                               * 00120000
001300*  IF INVALID CONDITIONS OCCUR DURING UPDATING, AN ERROR RECORD * 00130000
001400*  IS WRITTEN TO AN OUTPUT FILE AND AN ENTRY IS WRITTEN TO A    * 00140000
001500*  RDS ERROR REPORT.                                            * 00150000
001510*                                                               * 00151000
001511*  01/09/2020  JEAN KURK                                        * 00151100
001512*              RENAMED FROM WMKUT052 TO CEKRP052                * 00151200
001513***************************************************************** 00151300
001514 ENVIRONMENT DIVISION.                                            00151400
001515 INPUT-OUTPUT SECTION.                                            00151500
001516                                                                  00151600
001517 FILE-CONTROL.                                                    00151700
001518                                                                  00151800
001519     SELECT INPUT-FILE     ASSIGN TO UT-S-INP01.                  00151900
001520     SELECT OUTPUT-FILE-1  ASSIGN TO UT-S-OUT01.                  00152000
001530     SELECT OUTPUT-FILE-2  ASSIGN TO UT-S-OUT02.                  00153000
001540     SELECT OUTPUT-FILE-3  ASSIGN TO UT-S-OUT03.                  00154000
001550     SELECT OUTPUT-FILE-4  ASSIGN TO UT-S-OUT04.                  00155000
001560     SELECT OUTPUT-FILE-5  ASSIGN TO UT-S-RPT01.                  00156000
001570                                                                  00157000
001580***************************************************************** 00158000
001590 DATA DIVISION.                                                   00159000
001600 FILE SECTION.                                                    00160000
001700                                                                  00170000
001800 FD  INPUT-FILE                                                   00180000
001900     RECORDING MODE IS F                                          00190000
002000     LABEL RECORDS ARE STANDARD                                   00200000
002100     RECORD CONTAINS 100                                          00210000
002200     BLOCK CONTAINS 0 RECORDS                                     00220000
002300     DATA RECORD IS INPUT-RECORD.                                 00230000
002400 01  INPUT-RECORD                PIC X(100).                      00240000
002500                                                                  00250000
002600 FD  OUTPUT-FILE-1                                                00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     RECORD CONTAINS 100                                          00290000
003000     BLOCK CONTAINS 0 RECORDS                                     00300000
003100     DATA RECORD IS OUTPUT-RECORD-1.                              00310000
003200 01  OUTPUT-RECORD-1             PIC X(100).                      00320000
003300                                                                  00330000
003400 FD  OUTPUT-FILE-2                                                00340000
003500     RECORDING MODE IS F                                          00350000
003600     LABEL RECORDS ARE STANDARD                                   00360000
003700     RECORD CONTAINS 150                                          00370000
003800     BLOCK CONTAINS 0 RECORDS                                     00380000
003900     DATA RECORD IS OUTPUT-RECORD-2.                              00390000
004000 01  OUTPUT-RECORD-2             PIC X(150).                      00400000
004100                                                                  00410000
004200 FD  OUTPUT-FILE-3                                                00420000
004300     RECORDING MODE IS F                                          00430000
004400     LABEL RECORDS ARE STANDARD                                   00440000
004500     RECORD CONTAINS 130                                          00450000
004600     BLOCK CONTAINS 0 RECORDS                                     00460000
004700     DATA RECORD IS OUTPUT-RECORD-3.                              00470000
004800 01  OUTPUT-RECORD-3             PIC X(130).                      00480000
004900                                                                  00490000
004910                                                                  00491000
004920 FD  OUTPUT-FILE-4                                                00492000
004930     RECORDING MODE IS F                                          00493000
004940     LABEL RECORDS ARE STANDARD                                   00494000
004950     RECORD CONTAINS 100                                          00495000
004960     BLOCK CONTAINS 0 RECORDS                                     00496000
004970     DATA RECORD IS OUTPUT-RECORD-4.                              00497000
004980 01  OUTPUT-RECORD-4             PIC X(100).                      00498000
004990                                                                  00499000
005000 FD  OUTPUT-FILE-5                                                00500000
005001     RECORDING MODE IS F                                          00500100
005002     LABEL RECORDS ARE STANDARD                                   00500200
005003     RECORD CONTAINS 150                                          00500300
005004     BLOCK CONTAINS 0 RECORDS                                     00500400
005005     DATA RECORD IS ERROR-REPORT-REC.                             00500500
005006 01  ERROR-REPORT-REC            PIC X(150).                      00500600
005007                                                                  00500700
005008***************************************************************** 00500800
005009 WORKING-STORAGE SECTION.                                         00500900
005010                                                                  00501000
005011*                                                                 00501100
005012*  STANDARD HEADER LINE - KOHLS 150 COL                           00501200
005013*                                                                 00501300
005014     COPY DPWS150O.                                               00501400
005015                                                                  00501500
005016 01  WS-EOR-LINE1.                                                00501600
005017     05  FILLER                       PIC X(55)   VALUE SPACES.   00501700
005018     05  FILLER                       PIC X(41)   VALUE           00501800
005019         '      ***** END OF REPORT *****      '.                 00501900
005020     05  FILLER                       PIC X(54)   VALUE SPACES.   00502000
005030                                                                  00503000
005040 01  WS-HEADING-LINE1.                                            00504000
005050     05  FILLER                       PIC X(55)   VALUE SPACES.   00505000
005060     05  FILLER                       PIC X(41)   VALUE           00506000
005070         'WMOS BILL OF LADING/CS ERROR FILE REPORT '.             00507000
005080     05  FILLER                       PIC X(54)   VALUE SPACES.   00508000
005090                                                                  00509000
005100 01  WS-HEADING-LINE2.                                            00510000
005200     05  FILLER                  PIC X(34) VALUE SPACES.          00520000
005210     05  FILLER                  PIC X(5)  VALUE 'CNSTK'.         00521000
005220     05  FILLER                  PIC X(18) VALUE SPACES.          00522000
005230     05  FILLER                  PIC X(10) VALUE 'DEPT   SUB'.    00523000
005240     05  FILLER                  PIC X(29) VALUE SPACES.          00524000
005250     05  FILLER                  PIC X(5)  VALUE 'ERROR'.         00525000
005260     05  FILLER                  PIC X(53) VALUE SPACES.          00526000
005270                                                                  00527000
005280 01  WS-HEADING-LINE3.                                            00528000
005290     05  FILLER                  PIC X(6)  VALUE 'CARTON'.        00529000
005300     05  FILLER                  PIC X(18) VALUE SPACES.          00530000
005301     05  FILLER                  PIC X(8)  VALUE 'PULL NBR'.      00530100
005302     05  FILLER                  PIC X(2)  VALUE SPACES.          00530200
005303     05  FILLER                  PIC X(3)  VALUE 'LOC'.           00530300
005304     05  FILLER                  PIC X(4)  VALUE SPACES.          00530400
005305     05  FILLER                  PIC X(4)  VALUE 'LINE'.          00530500
005306     05  FILLER                  PIC X(2)  VALUE SPACES.          00530600
005307     05  FILLER                  PIC X(3)  VALUE 'SKU'.           00530700
005308     05  FILLER                  PIC X(8)  VALUE SPACES.          00530800
005309*CHG0210914                                                       00530900
005310     05  FILLER                  PIC X(09) VALUE 'NBR    CL'.     00531000
005320     05  FILLER                  PIC X(2)  VALUE SPACES.          00532000
005321*CHG0210914                                                       00532100
005322     05  FILLER                  PIC X(5)  VALUE 'STORE'.         00532200
005323     05  FILLER                  PIC X(8)  VALUE SPACES.          00532300
005324     05  FILLER                  PIC X(3)  VALUE 'QTY'.           00532400
005325     05  FILLER                  PIC X(3)  VALUE SPACES.          00532500
005326     05  FILLER                  PIC X(2)  VALUE 'DC'.            00532600
005327     05  FILLER                  PIC X(6)  VALUE SPACES.          00532700
005328     05  FILLER                  PIC X(4)  VALUE 'DATE'.          00532800
005329     05  FILLER                  PIC X(9)  VALUE SPACES.          00532900
005330     05  FILLER                  PIC X(8)  VALUE 'ERROR(S)'.      00533000
005331                                                                  00533100
005332 01  WS-ERROR-DETAIL-LINE.                                        00533200
005333     05  WS-ERROR-DTL-LINE           PIC X(105) VALUE SPACES.     00533300
005334     05  WS-ERR-DTL-LINE REDEFINES WS-ERROR-DTL-LINE.             00533400
005335         10  WS-ERR-DTL-CARTON   PIC X(20).                       00533500
005336         10  FILLER              PIC X(2).                        00533600
005337         10  WS-ERR-DTL-PULL-NBR PIC ZZZZZ9(5).                   00533700
005338         10  FILLER              PIC X(2).                        00533800
005339         10  WS-ERR-DTL-LOC-ID   PIC 9(4).                        00533900
005340         10  FILLER              PIC X(2).                        00534000
005341         10  WS-ERR-DTL-LINE-NBR PIC ZZZZ9.                       00534100
005342         10  FILLER              PIC X(2).                        00534200
005343         10  WS-ERR-DTL-SKU      PIC 9(8).                        00534300
005344         10  FILLER              PIC X(2).                        00534400
005345*CHG0210914                                                       00534500
005346         10  WS-ERR-DTL-DEPT     PIC ZZZ9.                        00534600
005347         10  FILLER              PIC X(2).                        00534700
005348         10  WS-ERR-DTL-SUB      PIC ZZZ9.                        00534800
005349         10  FILLER              PIC X(2).                        00534900
005350*CHG0210914                                                       00535000
005351         10  WS-ERR-DTL-STORE    PIC 9(4).                        00535100
005352         10  FILLER              PIC X(2).                        00535200
005353         10  WS-ERR-DTL-QTY      PIC Z(9)9.                       00535300
005354         10  FILLER              PIC X(2).                        00535400
005355         10  WS-ERR-DTL-DC       PIC 9(4).                        00535500
005356         10  FILLER              PIC X(2).                        00535600
005357         10  WS-ERR-DATE         PIC X(10).                       00535700
005358         10  FILLER              PIC X(2).                        00535800
005359     05  WS-ERR-DTL-MESSAGE      PIC X(40) VALUE SPACES.          00535900
005360                                                                  00536000
005361 01  PS-PROGRAM-SWITCHES.                                         00536100
005362     05  PS-END-OF-INPUT-SW           PIC  X(01) VALUE 'N'.       00536200
005363         88  PS-END-OF-INPUT                     VALUE 'Y'.       00536300
005364         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00536400
005365     05  PS-PULL-NBR-SW               PIC  X(01) VALUE 'V'.       00536500
005366         88  PS-PULL-NBR-VALID                   VALUE 'V'.       00536600
005367         88  PS-PULL-NBR-NOT-FOUND               VALUE 'N'.       00536700
005368         88  PS-PULL-NBR-CANCELED                VALUE 'C'.       00536800
005369         88  PS-PULL-NBR-POSTED                  VALUE 'P'.       00536900
005370     05  PS-PULL-LN-NBR-SW            PIC  X(01) VALUE 'V'.       00537000
005380         88  PS-PULL-LN-NBR-VALID                VALUE 'V'.       00538000
005390         88  PS-PULL-LN-NBR-NOT-FOUND            VALUE 'N'.       00539000
005400         88  PS-PULL-LN-NBR-CANCELED             VALUE 'C'.       00540000
005500         88  PS-PULL-LN-NBR-POSTED               VALUE 'P'.       00550000
005600     05  PS-PULL-SKU-NBR-SW           PIC  X(01) VALUE 'V'.       00560000
005700         88  PS-PULL-SKU-NBR-VALID               VALUE 'V'.       00570000
005800         88  PS-PULL-SKU-NBR-INVALID             VALUE 'I'.       00580000
005900     05  PS-PULL-STR-NBR-SW           PIC  X(01) VALUE 'V'.       00590000
006000         88  PS-PULL-STR-NBR-VALID               VALUE 'V'.       00600000
006100         88  PS-PULL-STR-NBR-INVALID             VALUE 'I'.       00610000
006200     05  PS-BARCODE-SW                PIC  X(01) VALUE 'V'.       00620000
006300         88  PS-BARCODE-VALID                    VALUE 'V'.       00630000
006400         88  PS-BARCODE-INVALID                  VALUE 'I'.       00640000
006500         88  PS-BARCODE-DUPLICATE                VALUE 'D'.       00650000
006600         88  PS-BARCODE-OTBND-TRIP-SHPD          VALUE 'S'.       00660000
006700         88  PS-DUPLICATE-SML                    VALUE 'E'.       00670000
006800     05  PS-DUP-ERROR-SW              PIC  X(01) VALUE 'N'.       00680000
006900         88  PS-DUP-FIRST-ERROR-NO               VALUE 'N'.       00690000
007000         88  PS-DUP-FIRST-ERROR-YES              VALUE 'Y'.       00700000
007100     05  PS-CONTAINER-SW              PIC  X(01) VALUE 'V'.       00710000
007200         88  PS-CONTAINER-VALID                  VALUE 'V'.       00720000
007300         88  PS-CONTAINER-INVALID                VALUE 'I'.       00730000
007400     05  PS-PACKAGE-TYP-SW            PIC  X(01) VALUE 'V'.       00740000
007500         88  PS-PACKAGE-TYP-VALID                VALUE 'V'.       00750000
007600         88  PS-PACKAGE-TYP-INVALID              VALUE 'I'.       00760000
007700     05  PS-SOFTWARE-SRC-SW           PIC  X(01) VALUE 'V'.       00770000
007800         88  PS-SOFTWARE-SRC-VALID               VALUE 'V'.       00780000
007801         88  PS-SOFTWARE-SRC-INVALID             VALUE 'I'.       00780100
007802     05  PS-DIVERT-CD-SW              PIC  X(01) VALUE 'V'.       00780200
007803         88  PS-DIVERT-CD-VALID                  VALUE 'V'.       00780300
007804         88  PS-DIVERT-CD-INVALID                VALUE 'I'.       00780400
007805     05  PS-DC-ORIGIN-SW              PIC  X(01) VALUE 'V'.       00780500
007806         88  PS-DC-ORIGIN-VALID                  VALUE 'V'.       00780600
007807         88  PS-DC-ORIGIN-INVALID                VALUE 'I'.       00780700
007808     05  PS-ERROR-SW                  PIC  X(01) VALUE 'N'.       00780800
007809         88  PS-ERROR-NOT-FOUND                  VALUE 'N'.       00780900
007810         88  PS-ERROR-FOUND                      VALUE 'Y'.       00781000
007811     05  PS-DETAIL-SW                 PIC  X(01) VALUE 'N'.       00781100
007812         88  PS-DETAIL-NOT-WRITTEN               VALUE 'N'.       00781200
007813         88  PS-DETAIL-WRITTEN                   VALUE 'Y'.       00781300
007814     05  PS-VAILD-REC-SW              PIC  X(01) VALUE 'N'.       00781400
007815         88  PS-VALID-INPUT-REC-NO               VALUE 'N'.       00781500
007816         88  PS-VALID-INPUT-REC                  VALUE 'Y'.       00781600
007817     05  PS-CHECK-PARM-ON-SW          PIC  X(01) VALUE 'Y'.       00781700
007818         88  PS-CHECK-PARM-ON-YES                VALUE 'Y'.       00781800
007819         88  PS-CHECK-PARM-ON-NO                 VALUE 'N'.       00781900
007820     05  PS-PROCESS-BARCODE-SW        PIC  X(01) VALUE 'Y'.       00782000
007830         88  PS-PROCESS-BARCODE-YES              VALUE 'Y'.       00783000
007831         88  PS-PROCESS-BARCODE-NO               VALUE 'N'.       00783100
007832     05  PV-CS-FUNC-PROCESS.                                      00783200
007833         10  PV-SML-IND                  PIC   X(03).             00783300
007834         10  FILLER                      PIC   X(01).             00783400
007835         10  PV-CS-PULL-EXC-1            PIC   X(05).             00783500
007836         10  PV-CS-PULL-EXC-R1 REDEFINES PV-CS-PULL-EXC-1         00783600
007837                                         PIC 9(05).               00783700
007838         10  FILLER                      PIC   X(01).             00783800
007839         10  PV-CS-PULL-EXC-2            PIC   X(05).             00783900
007840         10  PV-CS-PULL-EXC-R2 REDEFINES PV-CS-PULL-EXC-2         00784000
007841                                         PIC 9(05).               00784100
007842         10  FILLER                      PIC   X(01).             00784200
007843         10  PV-CS-PULL-EXC-3            PIC   X(05).             00784300
007844         10  PV-CS-PULL-EXC-R3 REDEFINES PV-CS-PULL-EXC-3         00784400
007845                                         PIC 9(05).               00784500
007846         10  FILLER                      PIC  X(04).              00784600
007847***      EXC 99999 99999 99999                                    00784700
007848 01  DK-DB2-KEY-FIELDS.                                           00784800
007849     05  DK-REQ-PL-NBR                PIC S9(09) VALUE +0 COMP.   00784900
007850     05  DK-PL-LNE-NBR                PIC S9(04) VALUE +0 COMP.   00785000
007851     05  DK-STR-NBR                   PIC S9(04) VALUE +0 COMP.   00785100
007852     05  DK-SKU-NBR                   PIC S9(8)V COMP-3  VALUE 0. 00785200
007853     05  DK-SHIPT-UNT-ID              PIC S9(18)V COMP-3 VALUE 0. 00785300
007854                                                                  00785400
007855 01  PV-PROGRAM-VARIABLES.                                        00785500
007856     05  PV-SQLCODE                   PIC  9999-.                 00785600
007857     05  PV-PAGE-CNT                  PIC  9(3) VALUE 0.          00785700
007858     05  PV-LINE-CNT                  PIC  9(3) VALUE 0.          00785800
007859     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00785900
007860                                                 COMP SYNC.       00786000
007861     05  PV-PREV-PULL-NBR             PIC  9(08) VALUE ZERO.      00786100
007862     05  PV-PR-SHIPT-UNT-ID           PIC  9(20) VALUE ZEROS.     00786200
007863     05  PV-PR-CNSTK-REQ-PL-NBR       PIC  9(10) VALUE ZEROS.     00786300
007864     05  PV-PR-PL-LNE-NBR             PIC  9(05) VALUE ZEROS.     00786400
007865     05  PV-PR-SKU-NUMBER             PIC  9(08) VALUE ZEROS.     00786500
007866     05  PV-PR-STORE-NUMBER           PIC  9(04) VALUE ZEROS.     00786600
007867     05  PV-PR-REQ-ORD-QTY            PIC  9(10) VALUE ZEROS.     00786700
007868     05  PV-PR-DC-NUMBER              PIC  9(04) VALUE ZEROS.     00786800
007869     05  PV-PR-STOCK-ORDER-NBR        PIC  9(09) VALUE ZEROS.     00786900
007870     05  PV-PR-ERROR-CODE             PIC  X(01) VALUE SPACES.    00787000
007880     05  PV-PR-ERROR-DATE             PIC  X(10) VALUE SPACES.    00788000
007890     05  PV-PREV-PULL-LNE-NBR         PIC  9(04) VALUE ZERO.      00789000
007900     05  PV-PREV-RECV-STORE-NBR       PIC  9(04) VALUE ZERO.      00790000
008000     05  PV-SQL-OUTPUT-TMST           PIC  X(26) VALUE SPACES.    00800000
008100     05  PV-NULL-IND-1                PIC S9(04) VALUE +0 COMP.   00810000
008200     05  PV-RECORDS-READ              PIC S9(08) VALUE ZERO.      00820000
008300     05  PV-COUNT-ERROR               PIC S9(08) VALUE ZERO.      00830000
008400     05  PV-COUNT-RECYCLE             PIC S9(08) VALUE ZERO.      00840000
008500     05  PV-COUNT-PULL                PIC S9(08) VALUE ZERO.      00850000
008600     05  PV-COUNT-MNFST               PIC S9(08) VALUE ZERO.      00860000
008700     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZ9-.            00870000
008800     05  PV-SML-NBR                   PIC  9(20) VALUE 0.         00880000
008900     05  PV-SML-CNT                   PIC  S9(09) VALUE +0 COMP.  00890000
009000     05  PV-ELAPSED-DAYS              PIC  S9(09) VALUE +0 COMP.  00900000
009100     05  PV-MAX-RECYCLE-DAYS          PIC  S9(04) VALUE +0 COMP.  00910000
009200     05  PV-STR-NBR                   PIC  S9(4) COMP.            00920000
009300     05  PV-SHIPT-UNT-ID              PIC S9(18)V COMP-3 VALUE 0. 00930000
009400     05  PV-UPC-NBR                   PIC S9(15)V COMP-3 VALUE 0. 00940000
009500     05  PV-PULL-NBR                  PIC  9(09) VALUE 0.         00950000
009600     05  PV-PULL-LN-NBR               PIC  9(05) VALUE 0.         00960000
009700     05  PV-LINE-NBR                  PIC  S9(4) COMP.            00970000
009800     05  PV-STR-NUM                   PIC  S9(04) VALUE +0 COMP.  00980000
009900     05  PV-SKU-NUM                   PIC  S9(8)V COMP-3.         00990000
010000     05  PV-SKU-NBR                   PIC  9(09) VALUE 0.         01000000
010100     05  PV-ITM-NBR                   PIC  9(15) VALUE 0.         01010000
010200     05  PV-STORE-NBR                 PIC  9(05) VALUE 0.         01020000
010300     05  PV-DC-NBR                    PIC  9(04) VALUE 0.         01030000
010400     05  PV-QTY-NBR                   PIC  9(10) VALUE 0.         01040000
010500     05  PV-USER-NAME                 PIC  X(42) VALUE SPACES.    01050000
010600     05  PV-20-DIGIT-BARCODE          PIC  9(20) VALUE 0.         01060000
010700     05  PV-20-DIGIT-BARCODE-R     REDEFINES PV-20-DIGIT-BARCODE. 01070000
010800         10  PV-20-SML-CONTAINER-CDE  PIC  9(02).                 01080000
010900             88  PV-20-SML-CNTNR-VAL             VALUE 0.         01090000
011000         10  PV-20-SML-PACKAGING-TYP  PIC  9(01).                 01100000
011100             88  PV-20-SML-INTRNAL-LBL           VALUE 4.         01110000
011200         10  PV-20-SML-SOFTWARE-SRC   PIC  9(01).                 01120000
011300             88  PV-20-SML-FROM-PT               VALUE 1 2.       01130000
011400         10  PV-20-SML-BC-DIVERT.                                 01140000
011500             15  PV-20-SML-BC-DIVERT-PFX  PIC  9(01).             01150000
011600             15  PV-20-SML-BC-DIVERT-CDE  PIC  9(04).             01160000
011700         10  PV-20-SML-BC-DC-ORIGIN   PIC  9(03).                 01170000
011800         10  PV-20-SML-BC-MNFST-NBR   PIC  9(08).                 01180000
011900     05  PV-TMST                      PIC X(26)   VALUE SPACES.   01190000
012000     05  PV-ERROR-DATE                PIC X(10)   VALUE SPACES.   01200000
012100     05  PV-REFORMAT-TMST-DTE.                                    01210000
012200         10  PV-REFORMAT-TMST-DTE-MM  PIC X(02)  VALUE SPACES.    01220000
012300         10  PV-REFORMAT-TMST-DTE-DD  PIC X(02)  VALUE SPACES.    01230000
012400         10  PV-REFORMAT-TMST-DTE-CY  PIC X(04)  VALUE SPACES.    01240000
012500     05  PV-REFORMAT-DATE-EDIT        PIC X(10)  VALUE SPACES.    01250000
012600     05  PV-REFORMAT-TIME-EDIT        PIC X(08)  VALUE SPACES.    01260000
012700     05  PV-DISTRIBUTION-NBR.                                     01270000
012800         10  PV-TRN-NBR               PIC 9(5) VALUE ZEROES.      01280000
012900         10  PV-TRN-LNE-NBR           PIC 9(4) VALUE ZEROES.      01290000
013000                                                                  01300000
013100                                                                  01310000
013110 01 PC-PROGRAM-CONSTANTS.                                         01311000
013120     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'CEKRP052'.01312000
013130     05  PC-MAX-RETRIES               PIC S9(03) VALUE +5 COMP-3. 01313000
013140     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01314000
013150                                     '9999-09-09-09.09.09.999999'.01315000
013160 01  PV-ABEND-FIELDS.                                             01316000
013170     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01317000
013180                                                 COMP SYNC.       01318000
013190     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'CEKRP052'.01319000
013200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01320000
013201     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01320100
013202     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01320200
013203     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01320300
013204     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01320400
013205     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01320500
013206                                                                  01320600
013207*----------------------------------------------------------------*01320700
013208**  ASSOCIATE INFO SUBROUTINE PARAMETERS                          01320800
013209*----------------------------------------------------------------*01320900
013210     COPY XLWS067.                                                01321000
013220                                                                  01322000
013230***********************************************************       01323000
013240*  COPYBOOK USED BY INPUT FILE                            *       01324000
013250***********************************************************       01325000
013260     COPY CERD048.                                                01326000
013270                                                                  01327000
013280***********************************************************       01328000
013290*  COPYBOOK FOR OUTPUT FILE USED IN CENTRAL STOCK PROC.   *       01329000
013300***********************************************************       01330000
013400     COPY CERD026.                                                01340000
013500                                                                  01350000
013600***********************************************************       01360000
013700*  COPYBOOK FOR OUTPUT FILE FOR SML BARCODE PROCESSING.   *       01370000
013800***********************************************************       01380000
013900     COPY SURD011.                                                01390000
014000                                                                  01400000
014100***********************************************************       01410000
014200*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01420000
014300***********************************************************       01430000
014400     COPY DPWS004.                                                01440000
014500                                                                  01450000
014600***********************************************************       01460000
014700*  DB2 SQL COMMUNICATION AREA                             *       01470000
014800***********************************************************       01480000
014900     EXEC SQL                                                     01490000
015000         INCLUDE SQLCA                                            01500000
015100     END-EXEC.                                                    01510000
015200                                                                  01520000
015300***********************************************************       01530000
015400*  CENTRAL STOCK - STATUS TABLE                           *       01540000
015500***********************************************************       01550000
015600     EXEC SQL                                                     01560000
015700         INCLUDE TKRPRPM                                          01570000
015800     END-EXEC.                                                    01580000
015900                                                                  01590000
016000***********************************************************       01600000
016100*  CENTRAL STOCK - STATUS TABLE                           *       01610000
016200***********************************************************       01620000
016300     EXEC SQL                                                     01630000
016400         INCLUDE TCEPLST                                          01640000
016500     END-EXEC.                                                    01650000
016600                                                                  01660000
016700***********************************************************       01670000
016800*  CENTRAL STOCK - REQUEST TABLE                          *       01680000
016900***********************************************************       01690000
017000     EXEC SQL                                                     01700000
017100         INCLUDE TCEPLRQ                                          01710000
017200     END-EXEC.                                                    01720000
017300                                                                  01730000
017400***********************************************************       01740000
017500*  CENTRAL STOCK - LINE ITEM TABLE                        *       01750000
017600***********************************************************       01760000
017700     EXEC SQL                                                     01770000
017800         INCLUDE TCEPLIT                                          01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100***********************************************************       01810000
018200*  CENTRAL STOCK - STORE (DISTRIBUTION) TABLE             *       01820000
018300***********************************************************       01830000
018400     EXEC SQL                                                     01840000
018500         INCLUDE TCEPLDS                                          01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800***********************************************************       01880000
018900*  XLT_SKU                                                *       01890000
019000***********************************************************       01900000
019100     EXEC SQL                                                     01910000
019200         INCLUDE XLT00003                                         01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500*CHG0210914                                                       01950000
019600***********************************************************       01960000
019700*  XLT_VND_STYL                                           *       01970000
019800***********************************************************       01980000
019900     EXEC SQL                                                     01990000
020000         INCLUDE XLT00004                                         02000000
020100     END-EXEC.                                                    02010000
020200                                                                  02020000
020300*CHG0210914                                                       02030000
020400***********************************************************       02040000
020500*  XLT_UPC                                                *       02050000
020600***********************************************************       02060000
020700     EXEC SQL                                                     02070000
020710         INCLUDE XLT00006                                         02071000
020720     END-EXEC.                                                    02072000
020730                                                                  02073000
020740***********************************************************       02074000
020750*  SUT_OTBND_CART                                         *       02075000
020760***********************************************************       02076000
020770     EXEC SQL                                                     02077000
020780         INCLUDE SUT00024                                         02078000
020790     END-EXEC.                                                    02079000
020800                                                                  02080000
020900***********************************************************       02090000
021000*  SUT_OTBND_UPC                                          *       02100000
021100***********************************************************       02110000
021200     EXEC SQL                                                     02120000
021300         INCLUDE SUT00028                                         02130000
021400     END-EXEC.                                                    02140000
021500                                                                  02150000
021600***********************************************************       02160000
021700***********************************************************       02170000
021800 PROCEDURE DIVISION.                                              02180000
021900     DISPLAY '*** START OF CEKRP052 ***'.                         02190000
022000     DISPLAY ' '.                                                 02200000
022100                                                                  02210000
022200*INITIALIZATION.                                                  02220000
022300     PERFORM 0100-INITIALIZATION.                                 02230000
022400                                                                  02240000
022500*PROCESS INPUT FILE.                                              02250000
022600     IF PS-END-OF-INPUT                                           02260000
022700         DISPLAY '**** NO INPUT FILE FOUND FOR CEKRP052 ****'     02270000
022800         PERFORM 8400-EMPTY-ERROR-REPORT                          02280000
022900     ELSE                                                         02290000
023000         PERFORM 1000-PROCESS-INPUT                               02300000
023100           UNTIL PS-END-OF-INPUT                                  02310000
023200     END-IF.                                                      02320000
023300                                                                  02330000
023400     PERFORM 9000-END-OF-PROGRAM.                                 02340000
023500                                                                  02350000
023600     GOBACK.                                                      02360000
023700                                                                  02370000
023800******************************************************************02380000
023900 0100-INITIALIZATION.                                             02390000
024000******************************************************************02400000
024100     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    02410000
024200                                                                  02420000
024300     OPEN INPUT  INPUT-FILE                                       02430000
024400          OUTPUT OUTPUT-FILE-1                                    02440000
024500                 OUTPUT-FILE-2                                    02450000
024600                 OUTPUT-FILE-3                                    02460000
024700                 OUTPUT-FILE-4                                    02470000
024800                 OUTPUT-FILE-5.                                   02480000
024900                                                                  02490000
025000     PERFORM 8000-GET-TIMESTAMP.                                  02500000
025100                                                                  02510000
025200*GET ERROR RECYCLE DAYS PARM FROM TKRPRPM                         02520000
025300     PERFORM 8800-GET-ERROR-RECYCLE-DAYS.                         02530000
025400                                                                  02540000
025500*CREATE INITIAL HEADINGS FOR ERROR REPORT                         02550000
025600     PERFORM 8100-NEW-PAGE.                                       02560000
025700                                                                  02570000
025800*READ FIRST INPUT RECORD                                          02580000
025900     PERFORM 2000-READ-INPUT-FILE.                                02590000
026000                                                                  02600000
026100******************************************************************02610000
026200 1000-PROCESS-INPUT.                                              02620000
026300******************************************************************02630000
026400     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    02640000
026500                                                                  02650000
026600                                                                  02660000
026700*RETAIN THE PREVIOUS PULL#, LINE & STORE SO UNNEEDED SELECTS ARE  02670000
026800*NOT PERFORMED (IF DATA IS THE SAME).  PREVIOUS RECORD STATUSES   02680000
026900*MUST ALSO BE RETAINED FOR WRITING ERRORS OUT AS NEEDED.          02690000
027000                                                                  02700000
027100*READ PULL REQUEST TABLE.                                         02710000
027200     MOVE CE048-CNSTK-REQ-PL-NBR TO DK-REQ-PL-NBR.                02720000
027300     IF CE048-CNSTK-REQ-PL-NBR NOT = PV-PREV-PULL-NBR             02730000
027400         SET PS-PULL-NBR-VALID     TO TRUE                        02740000
027500         MOVE 9999 TO PV-PREV-PULL-LNE-NBR                        02750000
027600                      PV-PREV-RECV-STORE-NBR                      02760000
027700         PERFORM 1100-PROCESS-TCEPLRQ                             02770000
027800     END-IF.                                                      02780000
027900     IF PS-PULL-NBR-VALID                                         02790000
028000         CONTINUE                                                 02800000
028100     ELSE                                                         02810000
028200         SET PS-ERROR-FOUND  TO TRUE                              02820000
028300     END-IF.                                                      02830000
028400                                                                  02840000
028500*READ PULL ITEM TABLE.                                            02850000
028600     IF CE048-PL-LNE-NBR = 0                                      02860000
028700        PERFORM 1320-GET-LINE-NBR                                 02870000
028800     END-IF.                                                      02880000
028900     MOVE CE048-PL-LNE-NBR TO DK-PL-LNE-NBR.                      02890000
029000     IF CE048-PL-LNE-NBR NOT = PV-PREV-PULL-LNE-NBR               02900000
029100         SET PS-PULL-LN-NBR-VALID  TO TRUE                        02910000
029200         MOVE 9999 TO PV-PREV-RECV-STORE-NBR                      02920000
029300         PERFORM 1200-PROCESS-TCEPLIT                             02930000
029400     END-IF.                                                      02940000
029500     IF PS-PULL-LN-NBR-VALID                                      02950000
029600         CONTINUE                                                 02960000
029700     ELSE                                                         02970000
029800         SET PS-ERROR-FOUND  TO TRUE                              02980000
029900     END-IF.                                                      02990000
030000                                                                  03000000
030100     MOVE CE048-SKU-NUMBER TO DK-SKU-NBR.                         03010000
030200     SET PS-PULL-SKU-NBR-VALID TO TRUE.                           03020000
030300     PERFORM 1250-PROCESS-XLT-SKU                                 03030000
030400     IF PS-PULL-SKU-NBR-VALID                                     03040000
030500         CONTINUE                                                 03050000
030600     ELSE                                                         03060000
030700         SET PS-ERROR-FOUND  TO TRUE                              03070000
030800     END-IF.                                                      03080000
030900                                                                  03090000
031000*READ STORE DISTRIBUTION TABLE.                                   03100000
031100     MOVE CE048-STORE-NUMBER TO DK-STR-NBR                        03110000
031200     IF CE048-STORE-NUMBER NOT = PV-PREV-RECV-STORE-NBR           03120000
031300         SET PS-PULL-STR-NBR-VALID TO TRUE                        03130000
031400         PERFORM 1300-PROCESS-TCEPLDS                             03140000
031500     END-IF.                                                      03150000
031600     IF PS-PULL-STR-NBR-VALID                                     03160000
031700         CONTINUE                                                 03170000
031800     ELSE                                                         03180000
031900         SET PS-ERROR-FOUND  TO TRUE                              03190000
032000     END-IF.                                                      03200000
032100     SET PS-CHECK-PARM-ON-YES TO TRUE                             03210000
032200     PERFORM 3600-CHECK-INTR-START-DTE                            03220000
032300     IF PS-CHECK-PARM-ON-NO                                       03230000
032400        SET PS-PROCESS-BARCODE-NO TO TRUE                         03240000
032500     ELSE                                                         03250000
032600       PERFORM 3650-EVAL-CS-SML-CHECK                             03260000
032700     END-IF                                                       03270000
032800     SET PS-BARCODE-VALID TO TRUE                                 03280000
032900     IF PS-PROCESS-BARCODE-YES                                    03290000
033000        PERFORM 1050-VALIDATE-BARCODE                             03300000
033100     END-IF                                                       03310000
033200                                                                  03320000
033300     IF PS-ERROR-FOUND                                            03330000
033400         PERFORM 3000-PROCESS-ERRORS                              03340000
033401     ELSE                                                         03340100
033402         PERFORM 4000-WRITE-OUTPUT-RECS                           03340200
033403     END-IF.                                                      03340300
033404                                                                  03340400
033405     MOVE CE048-SHIPT-UNT-ID      TO  PV-PR-SHIPT-UNT-ID.         03340500
033406     MOVE CE048-CNSTK-REQ-PL-NBR  TO  PV-PR-CNSTK-REQ-PL-NBR.     03340600
033407     MOVE CE048-PL-LNE-NBR        TO  PV-PR-PL-LNE-NBR.           03340700
033408     MOVE CE048-SKU-NUMBER        TO  PV-PR-SKU-NUMBER.           03340800
033409     MOVE CE048-STORE-NUMBER      TO  PV-PR-STORE-NUMBER.         03340900
033410     MOVE CE048-REQ-ORD-QTY       TO  PV-PR-REQ-ORD-QTY.          03341000
033420     MOVE CE048-DC-NUMBER         TO  PV-PR-DC-NUMBER.            03342000
033430     MOVE CE048-STOCK-ORDER-NBR   TO  PV-PR-STOCK-ORDER-NBR.      03343000
033440                                                                  03344000
033450*READ NEXT INPUT RECORD.                                          03345000
033460                                                                  03346000
033470     PERFORM 2000-READ-INPUT-FILE.                                03347000
033480                                                                  03348000
033490***************************************************************** 03349000
033500 1050-VALIDATE-BARCODE.                                           03350000
033600*VALIDATE BARCODE/SML                                             03360000
033700*    CHECK THE FORMATTING OF THE BAR CODE                         03370000
033800     MOVE CE048-SHIPT-UNT-ID TO PV-20-DIGIT-BARCODE.              03380000
033900                                                                  03390000
034000*    CHECK THAT 1ST 2 DIGITS ARE ZERO                             03400000
034100     IF PV-20-SML-CNTNR-VAL                                       03410000
034200        CONTINUE                                                  03420000
034300     ELSE                                                         03430000
034400        SET PS-CONTAINER-INVALID TO TRUE                          03440000
034500        SET PS-BARCODE-INVALID   TO TRUE                          03450000
034600     END-IF.                                                      03460000
034700                                                                  03470000
034800*    CHECK THAT 3RD DIGIT IS 4                                    03480000
034900     IF PV-20-SML-INTRNAL-LBL                                     03490000
035000        CONTINUE                                                  03500000
035100     ELSE                                                         03510000
035200        SET PS-PACKAGE-TYP-INVALID TO TRUE                        03520000
035300        SET PS-BARCODE-INVALID   TO TRUE                          03530000
035400     END-IF.                                                      03540000
035500                                                                  03550000
035600*    CHECK THAT 4TH DIGIT IS 2                                    03560000
035700     IF PV-20-SML-FROM-PT                                         03570000
035800        CONTINUE                                                  03580000
035900     ELSE                                                         03590000
036000        SET PS-SOFTWARE-SRC-INVALID TO TRUE                       03600000
036100        SET PS-BARCODE-INVALID   TO TRUE                          03610000
036200     END-IF.                                                      03620000
036300                                                                  03630000
036400*    CHECK THAT DIGITS 6 THRU 9 = THE STORE NUMBER                03640000
036500     IF PV-20-SML-BC-DIVERT-CDE = CE048-STORE-NUMBER              03650000
036600        CONTINUE                                                  03660000
036700     ELSE                                                         03670000
036800        SET PS-DIVERT-CD-INVALID TO TRUE                          03680000
036900        SET PS-BARCODE-INVALID   TO TRUE                          03690000
037000     END-IF.                                                      03700000
037100                                                                  03710000
037200                                                                  03720000
037210*    IF THERE ARE NO FORMATTING ERRORS, DO ADDL CHECKS            03721000
037220     IF PS-BARCODE-VALID                                          03722000
037221         PERFORM 1400-PROCESS-SUT-OTBND-CART                      03722100
037222     ELSE                                                         03722200
037223             SET PS-ERROR-FOUND TO TRUE                           03722300
037224     END-IF.                                                      03722400
037225                                                                  03722500
037226***************************************************************** 03722600
037227 1100-PROCESS-TCEPLRQ.                                            03722700
037228***************************************************************** 03722800
037229     MOVE '1100-PROCESS-TCEPLRQ         ' TO PV-ABEND-PARAGRAPH.  03722900
037230                                                                  03723000
037231     MOVE CE048-CNSTK-REQ-PL-NBR TO PV-PREV-PULL-NBR.             03723100
037232                                                                  03723200
037233     PERFORM 1110-READ-TCEPLRQ.                                   03723300
037234                                                                  03723400
037235***************************************************************** 03723500
037236 1110-READ-TCEPLRQ.                                               03723600
037237***************************************************************** 03723700
037238     MOVE '1110-READ-TCEPLRQ            ' TO PV-ABEND-PARAGRAPH.  03723800
037239                                                                  03723900
037240     EXEC SQL                                                     03724000
037250         SELECT  CNSTK_LOC_ID                                     03725000
037260              ,  SRC_REF_NBR                                      03726000
037270              ,  SRC_TYP_CDE                                      03727000
037280              ,  STAT_CDE                                         03728000
037290           INTO  :CEPLRQ-CNSTK-LOC-ID                             03729000
037300              ,  :CEPLRQ-SRC-REF-NBR                              03730000
037400              ,  :CEPLRQ-SRC-TYP-CDE                              03740000
037500              ,  :CEPLRQ-STAT-CDE                                 03750000
037600           FROM  TCEPLRQ                                          03760000
037700          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                03770000
037800          WITH UR                                                 03780000
037900     END-EXEC.                                                    03790000
038000                                                                  03800000
038100                                                                  03810000
038200     EVALUATE TRUE                                                03820000
038300       WHEN SQLCODE = +0                                          03830000
038400           IF CEPLRQ-STAT-CDE = 'CA'                              03840000
038500               SET PS-PULL-NBR-CANCELED TO TRUE                   03850000
038600           ELSE                                                   03860000
038700               IF CEPLRQ-STAT-CDE = 'PD'                          03870000
038800                   SET PS-PULL-NBR-POSTED TO TRUE                 03880000
038900               ELSE                                               03890000
039000                   SET PS-PULL-NBR-VALID TO TRUE                  03900000
039100               END-IF                                             03910000
039200           END-IF                                                 03920000
039300                                                                  03930000
039400       WHEN SQLCODE = +100                                        03940000
039500           SET PS-PULL-NBR-NOT-FOUND TO TRUE                      03950000
039600                                                                  03960000
039700       WHEN OTHER                                                 03970000
039800           MOVE 'TCEPLRQ' TO PV-DB2-TABLE-NAME                    03980000
039900           MOVE 'SELECT CE PULL REQUEST'                          03990000
040000                          TO PV-DB2-OPERATION-MESSAGE-1           04000000
040100           PERFORM 9900-DB2-ABEND                                 04010000
040200     END-EVALUATE.                                                04020000
040300                                                                  04030000
040400***************************************************************** 04040000
040500 1200-PROCESS-TCEPLIT.                                            04050000
040600***************************************************************** 04060000
040700     MOVE '1200-PROCESS-TCEPLIT         ' TO PV-ABEND-PARAGRAPH.  04070000
040800                                                                  04080000
040900     MOVE CE048-PL-LNE-NBR TO PV-PREV-PULL-LNE-NBR.               04090000
041000                                                                  04100000
041100     PERFORM 1210-READ-TCEPLIT.                                   04110000
041200                                                                  04120000
041300***************************************************************** 04130000
041400 1210-READ-TCEPLIT.                                               04140000
041500***************************************************************** 04150000
041600     MOVE '1210-READ-TCEPLIT            ' TO PV-ABEND-PARAGRAPH.  04160000
041700                                                                  04170000
041800     EXEC SQL                                                     04180000
041900         SELECT  A.STAT_CDE                                       04190000
042000           INTO  :CEPLIT-STAT-CDE                                 04200000
042100           FROM  TCEPLIT A                                        04210000
042200          WHERE  A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              04220000
042300            AND  A.PL_LNE_NBR       = :DK-PL-LNE-NBR              04230000
042400          WITH UR                                                 04240000
042500     END-EXEC.                                                    04250000
042600                                                                  04260000
042700     EVALUATE TRUE                                                04270000
042800       WHEN SQLCODE = +0                                          04280000
042900           IF CEPLIT-STAT-CDE = 'CA'                              04290000
043000               SET PS-PULL-LN-NBR-CANCELED TO TRUE                04300000
043100           ELSE                                                   04310000
043200               IF CEPLIT-STAT-CDE = 'PD'                          04320000
043300                   SET PS-PULL-LN-NBR-POSTED TO TRUE              04330000
043400               ELSE                                               04340000
043500                   SET PS-PULL-LN-NBR-VALID TO TRUE               04350000
043600               END-IF                                             04360000
043700           END-IF                                                 04370000
043800                                                                  04380000
043900       WHEN SQLCODE = +100                                        04390000
044000           SET PS-PULL-LN-NBR-NOT-FOUND TO TRUE                   04400000
044100                                                                  04410000
044200       WHEN OTHER                                                 04420000
044300           MOVE 'TCEPLIT' TO PV-DB2-TABLE-NAME                    04430000
044400           MOVE 'SELECT CE PULL ITEM   '                          04440000
044500                          TO PV-DB2-OPERATION-MESSAGE-1           04450000
044600           PERFORM 9900-DB2-ABEND                                 04460000
044700     END-EVALUATE.                                                04470000
044800                                                                  04480000
044900***************************************************************** 04490000
045000 1250-PROCESS-XLT-SKU.                                            04500000
045100***************************************************************** 04510000
045200     MOVE '1250-PROCESS-XLT-SKU         ' TO PV-ABEND-PARAGRAPH.  04520000
045300                                                                  04530000
045400     PERFORM 1255-READ-XLT-SKU.                                   04540000
045500                                                                  04550000
045600***************************************************************** 04560000
045700 1255-READ-XLT-SKU.                                               04570000
045800***************************************************************** 04580000
045900     MOVE '1255-READ-XLT-SKU            ' TO PV-ABEND-PARAGRAPH.  04590000
046000                                                                  04600000
046100     EXEC SQL                                                     04610000
046200         SELECT  A.ITM_NBR                                        04620000
046300           INTO  :CEPLIT-ITM-NBR                                  04630000
046400           FROM  TCEPLIT A                                        04640000
046500              ,  XLT_SKU B                                        04650000
046600          WHERE  A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              04660000
046700            AND  A.PL_LNE_NBR       = :DK-PL-LNE-NBR              04670000
046800            AND  A.ITM_NBR          = B.ITM_NBR                   04680000
046900            AND  B.SKU_NBR          = :DK-SKU-NBR                 04690000
047000          WITH UR                                                 04700000
047100     END-EXEC.                                                    04710000
047200                                                                  04720000
047300     EVALUATE TRUE                                                04730000
047400       WHEN SQLCODE = +0                                          04740000
047500           SET PS-PULL-SKU-NBR-VALID TO TRUE                      04750000
047600                                                                  04760000
047700       WHEN SQLCODE = +100                                        04770000
047800           SET PS-PULL-SKU-NBR-INVALID TO TRUE                    04780000
047900                                                                  04790000
048000       WHEN OTHER                                                 04800000
048100           MOVE 'XLT-SKU' TO PV-DB2-TABLE-NAME                    04810000
048200           MOVE 'SELECT CE SKU NUMBER  '                          04820000
048300                          TO PV-DB2-OPERATION-MESSAGE-1           04830000
048400           PERFORM 9900-DB2-ABEND                                 04840000
048500     END-EVALUATE.                                                04850000
048600                                                                  04860000
048700***************************************************************** 04870000
048800 1300-PROCESS-TCEPLDS.                                            04880000
048900***************************************************************** 04890000
049000     MOVE '1300-PROCESS-TCEPLDS         ' TO PV-ABEND-PARAGRAPH.  04900000
049100                                                                  04910000
049200     MOVE CE048-STORE-NUMBER   TO PV-PREV-RECV-STORE-NBR.         04920000
049300                                                                  04930000
049400     PERFORM 1310-READ-TCEPLDS.                                   04940000
049500                                                                  04950000
049600                                                                  04960000
049700***************************************************************** 04970000
049800 1310-READ-TCEPLDS.                                               04980000
049900***************************************************************** 04990000
050000     MOVE '1310-READ-TCEPLDS            ' TO PV-ABEND-PARAGRAPH.  05000000
050100                                                                  05010000
050200     EXEC SQL                                                     05020000
050300         SELECT  A.STR_NBR                                        05030000
050400           INTO :PV-STR-NBR                                       05040000
050500           FROM  TCEPLDS A                                        05050000
050600              ,  XLT_SKU B                                        05060000
050700              ,  TCEPLIT C                                        05070000
050800          WHERE  A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              05080000
050900            AND  A.PL_LNE_NBR       = :DK-PL-LNE-NBR              05090000
051000            AND  A.STR_NBR          = :DK-STR-NBR                 05100000
051100            AND  A.CNSTK_REQ_PL_NBR = C.CNSTK_REQ_PL_NBR          05110000
051200            AND  A.PL_LNE_NBR       = C.PL_LNE_NBR                05120000
051300            AND  B.ITM_NBR          = C.ITM_NBR                   05130000
051400            AND  B.SKU_NBR          = :DK-SKU-NBR                 05140000
051500          WITH UR                                                 05150000
051600     END-EXEC.                                                    05160000
051700                                                                  05170000
051800     EVALUATE TRUE                                                05180000
051900       WHEN SQLCODE = +0                                          05190000
052000           SET PS-PULL-STR-NBR-VALID TO TRUE                      05200000
052100                                                                  05210000
052200       WHEN SQLCODE = +100                                        05220000
052300           SET PS-PULL-STR-NBR-INVALID TO TRUE                    05230000
052400                                                                  05240000
052500       WHEN OTHER                                                 05250000
052600           MOVE 'TCEPLDS' TO PV-DB2-TABLE-NAME                    05260000
052700           MOVE 'SELECT STORE DISTRIBUTION'                       05270000
052800                          TO PV-DB2-OPERATION-MESSAGE-1           05280000
052900           PERFORM 9900-DB2-ABEND                                 05290000
053000     END-EVALUATE.                                                05300000
053100                                                                  05310000
053200***************************************************************** 05320000
053300 1320-GET-LINE-NBR.                                               05330000
053400***************************************************************** 05340000
053500                                                                  05350000
053600* IF INPUT LINE NBR IS EQUALTO 0, ATTEMPT TO FIND LINE NBR        05360000
053700                                                                  05370000
053800     MOVE '1320-GET-LINE-NBR            ' TO PV-ABEND-PARAGRAPH.  05380000
053900                                                                  05390000
054000     MOVE 0 TO PV-LINE-NBR.                                       05400000
054100     MOVE CE048-SKU-NUMBER TO PV-SKU-NUM.                         05410000
054200     MOVE CE048-STORE-NUMBER TO PV-STR-NUM.                       05420000
054300                                                                  05430000
054400     EXEC SQL                                                     05440000
054500         SELECT  A.PL_LNE_NBR                                     05450000
054600           INTO :PV-LINE-NBR                                      05460000
054700           FROM  TCEPLDS A,                                       05470000
054800                 XLT_SKU B,                                       05480000
054900                 TCEPLIT C                                        05490000
055000          WHERE  A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              05500000
055100            AND  A.STR_NBR          = :PV-STR-NUM                 05510000
055200            AND  A.CNSTK_REQ_PL_NBR = C.CNSTK_REQ_PL_NBR          05520000
055300            AND  A.PL_LNE_NBR       = C.PL_LNE_NBR                05530000
055400            AND  B.ITM_NBR          = C.ITM_NBR                   05540000
055500            AND  B.SKU_NBR          = :PV-SKU-NUM                 05550000
055600          WITH UR                                                 05560000
055700     END-EXEC.                                                    05570000
055800                                                                  05580000
055900     EVALUATE TRUE                                                05590000
056000       WHEN SQLCODE = 0                                           05600000
056100          MOVE PV-LINE-NBR TO CE048-PL-LNE-NBR                    05610000
056200          DISPLAY '** INPUT LINE NBR ZERO **'                     05620000
056300       WHEN SQLCODE = +100                                        05630000
056400          CONTINUE                                                05640000
056500       WHEN OTHER                                                 05650000
056600          MOVE '* MULT *' TO PV-DB2-TABLE-NAME                    05660000
056700          MOVE 'XLT_SKU/TCEPLIT/TCEPLDS JOIN FOR LINE NBR'        05670000
056800                         TO PV-DB2-OPERATION-MESSAGE-1            05680000
056900          MOVE 'JOIN TO GET LINE NBR IF INPUT LINE NBR IS 0'      05690000
057000                         TO PV-DB2-OPERATION-MESSAGE-2            05700000
057100          PERFORM 9900-DB2-ABEND                                  05710000
057200     END-EVALUATE.                                                05720000
057300                                                                  05730000
057400***************************************************************** 05740000
057500 1400-PROCESS-SUT-OTBND-CART.                                     05750000
057600***************************************************************** 05760000
057700     MOVE '1400-PROCESS-SUT-OTBND-CART  ' TO PV-ABEND-PARAGRAPH.  05770000
057800                                                                  05780000
057900     MOVE CE048-SHIPT-UNT-ID   TO DK-SHIPT-UNT-ID.                05790000
058000                                                                  05800000
058100     PERFORM 1410-READ-SUT-OTBND-CART.                            05810000
058200                                                                  05820000
058300                                                                  05830000
058400***************************************************************** 05840000
058500 1410-READ-SUT-OTBND-CART.                                        05850000
058600***************************************************************** 05860000
058700*    CHECK TO SEE IF THE CARTON ALREADY EXISTS - THIS WOULD BE    05870000
058800*    A DUPLICATE SML NUMBER.  IF IS DOESN'T EXIST, SET THE        05880000
058900*    SWITCH TO VALID.                                             05890000
059000                                                                  05900000
059100     MOVE '1410-READ-SUT-OTBND-CART     ' TO PV-ABEND-PARAGRAPH.  05910000
059200                                                                  05920000
059300     EXEC SQL                                                     05930000
059400         SELECT  SHIPT_UNT_ID                                     05940000
059500                ,OTBND_TRIP_ID                                    05950000
059600           INTO :PV-SHIPT-UNT-ID                                  05960000
059700               ,:SUT00024-OTBND-TRIP-ID :PV-NULL-IND-1            05970000
059800           FROM  SUT_OTBND_CART                                   05980000
059900          WHERE  SHIPT_UNT_ID       = :DK-SHIPT-UNT-ID            05990000
060000            AND  ACTV_IND           = 'Y'                         06000000
060100     END-EXEC.                                                    06010000
060200                                                                  06020000
060300     EVALUATE TRUE                                                06030000
060400       WHEN SQLCODE = +0                                          06040000
060500         IF PV-NULL-IND-1 = 0                                     06050000
060600           SET PS-BARCODE-DUPLICATE       TO TRUE                 06060000
060700           SET PS-BARCODE-OTBND-TRIP-SHPD TO TRUE                 06070000
060800           SET PS-ERROR-FOUND             TO TRUE                 06080000
060900         ELSE                                                     06090000
061000           IF PV-NULL-IND-1 = -1                                  06100000
061100              PERFORM 1500-PROCESS-SUT-OTBND-UPC                  06110000
061200           END-IF                                                 06120000
061300         END-IF                                                   06130000
061400       WHEN SQLCODE = +100                                        06140000
061500           CONTINUE                                               06150000
061600                                                                  06160000
061700       WHEN OTHER                                                 06170000
061800           MOVE 'SUT_OTBND_CART' TO PV-DB2-TABLE-NAME             06180000
061900           MOVE 'SELECT CARTON / SML'                             06190000
062000                          TO PV-DB2-OPERATION-MESSAGE-1           06200000
062100           PERFORM 9900-DB2-ABEND                                 06210000
062200     END-EVALUATE.                                                06220000
062300                                                                  06230000
062400***************************************************************** 06240000
062500 1500-PROCESS-SUT-OTBND-UPC.                                      06250000
062600***************************************************************** 06260000
062700*    CHECK TO SEE IF THE ITEM ALREADY EXISTS - THIS WOULD BE      06270000
062800*    A DUPLICATE SML NUMBER.  IF IS DOESN'T EXIST, SET THE        06280000
062900*    SWITCH TO VALID.                                             06290000
063000                                                                  06300000
063100     MOVE '1500-PROCESS-SUT-OTBND-UPC   ' TO PV-ABEND-PARAGRAPH.  06310000
063200                                                                  06320000
063300     EXEC SQL                                                     06330000
063400         SELECT  A.UPC_NBR                                        06340000
063500           INTO :PV-UPC-NBR                                       06350000
063600           FROM  SUT_OTBND_UPC A                                  06360000
063700                ,XLT_UPC   B                                      06370000
063800                ,XLT_SKU   C                                      06380000
063900          WHERE  SHIPT_UNT_ID       = :DK-SHIPT-UNT-ID            06390000
064000            AND  B.UPC_NBR          = A.UPC_NBR                   06400000
064100            AND  B.INTR_UPC_ID      = C.INTR_UPC_ID               06410000
064200            AND  TRN_NBR            = :DK-REQ-PL-NBR              06420000
064300            AND  RCVR_SEQ_NBR       = 0                           06430000
064400            AND  TRN_LNE_NBR        = :DK-PL-LNE-NBR              06440000
064500            AND  SKU_NBR            = :DK-SKU-NBR                 06450000
064600     END-EXEC.                                                    06460000
064700                                                                  06470000
064800     EVALUATE TRUE                                                06480000
064900       WHEN SQLCODE = +0                                          06490000
065000           SET PS-DUPLICATE-SML           TO TRUE                 06500000
065100           SET PS-ERROR-FOUND             TO TRUE                 06510000
065200       WHEN SQLCODE = +100                                        06520000
065300           CONTINUE                                               06530000
065400       WHEN OTHER                                                 06540000
065500           MOVE 'SUT_OTBND_UPC' TO PV-DB2-TABLE-NAME              06550000
065600           MOVE 'SELECT UPC'                                      06560000
065700                          TO PV-DB2-OPERATION-MESSAGE-1           06570000
065800           PERFORM 9900-DB2-ABEND                                 06580000
065900     END-EVALUATE.                                                06590000
066000                                                                  06600000
066010***************************************************************** 06601000
066020 2000-READ-INPUT-FILE.                                            06602000
066030***************************************************************** 06603000
066040     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    06604000
066041                                                                  06604100
066042     SET PS-ERROR-NOT-FOUND    TO TRUE.                           06604200
066043     SET PS-BARCODE-VALID      TO TRUE.                           06604300
066044     SET PS-CONTAINER-VALID    TO TRUE.                           06604400
066045     SET PS-PACKAGE-TYP-VALID  TO TRUE.                           06604500
066046     SET PS-SOFTWARE-SRC-VALID TO TRUE.                           06604600
066047     SET PS-DIVERT-CD-VALID    TO TRUE.                           06604700
066048     SET PS-DC-ORIGIN-VALID    TO TRUE.                           06604800
066049     SET PS-DUP-FIRST-ERROR-NO TO TRUE.                           06604900
066050     SET PS-VALID-INPUT-REC-NO TO TRUE.                           06605000
066060                                                                  06606000
066070     PERFORM UNTIL PS-END-OF-INPUT OR                             06607000
066080                   PS-VALID-INPUT-REC                             06608000
066090        READ INPUT-FILE                                           06609000
066100          INTO CE048-PULL-BRCD-EXTRACT-REC                        06610000
066200            AT END                                                06620000
066300              SET PS-END-OF-INPUT TO TRUE                         06630000
066310            NOT AT END                                            06631000
066320            ADD +1 TO PV-RECORDS-READ                             06632000
066330        END-READ                                                  06633000
066331                                                                  06633100
066332        IF (CE048-ERR-FIRST-TIME OR CE048-ERR-SECND-TIME) AND     06633200
066333           PS-NOT-END-OF-INPUT                                    06633300
066334           PERFORM 8700-CHECK-DAYS                                06633400
066335           IF (PV-ELAPSED-DAYS <= PV-MAX-RECYCLE-DAYS) AND        06633500
066336              PV-MAX-RECYCLE-DAYS > 0                             06633600
066337              SET PS-VALID-INPUT-REC TO TRUE                      06633700
066338           ELSE                                                   06633800
066339              SET PS-VALID-INPUT-REC-NO TO TRUE                   06633900
066340           END-IF                                                 06634000
066350        ELSE                                                      06635000
066360           SET PS-VALID-INPUT-REC TO TRUE                         06636000
066370        END-IF                                                    06637000
066380        IF PS-NOT-END-OF-INPUT                                    06638000
066390           IF  (CE048-SHIPT-UNT-ID     = PV-PR-SHIPT-UNT-ID       06639000
066400              AND CE048-CNSTK-REQ-PL-NBR = PV-PR-CNSTK-REQ-PL-NBR 06640000
066500              AND CE048-PL-LNE-NBR       = PV-PR-PL-LNE-NBR       06650000
066600              AND CE048-SKU-NUMBER       = PV-PR-SKU-NUMBER       06660000
066700              AND CE048-STORE-NUMBER     = PV-PR-STORE-NUMBER     06670000
066800              AND CE048-REQ-ORD-QTY      = PV-PR-REQ-ORD-QTY      06680000
066810              AND CE048-DC-NUMBER        = PV-PR-DC-NUMBER        06681000
066811              AND CE048-STOCK-ORDER-NBR  = PV-PR-STOCK-ORDER-NBR) 06681100
066812              WRITE OUTPUT-RECORD-1 FROM                          06681200
066813                 CE048-PULL-BRCD-EXTRACT-REC                      06681300
066814              ADD 1 TO PV-COUNT-ERROR                             06681400
066815              MOVE PV-ERROR-DATE TO CE048-ERROR-DATE              06681500
066816              PERFORM 8300-FILL-DETAIL-LINE                       06681600
066817              MOVE 'DUPLICATE RECORD' TO WS-ERR-DTL-MESSAGE       06681700
066818              SET PS-DETAIL-NOT-WRITTEN TO TRUE                   06681800
066819              PERFORM 8200-WRITE-REPORT                           06681900
066820              PERFORM 8500-WRITE-BLANK-LINE                       06682000
066821              SET PS-VALID-INPUT-REC-NO TO TRUE                   06682100
066822           ELSE                                                   06682200
066823              SET PS-VALID-INPUT-REC TO TRUE                      06682300
066824           END-IF                                                 06682400
066825        END-IF                                                    06682500
066826     END-PERFORM.                                                 06682600
066827                                                                  06682700
066828*********** FOR TESTING ONLY ******************************       06682800
066829*    MOVE CE048-SHIPT-UNT-ID     TO PV-SML-NBR.                   06682900
066830*    MOVE CE048-CNSTK-REQ-PL-NBR TO PV-PULL-NBR.                  06683000
066831*    MOVE CE048-PL-LNE-NBR       TO PV-PULL-LN-NBR.               06683100
066832*    MOVE CE048-SKU-NUMBER       TO PV-SKU-NBR.                   06683200
066833*    MOVE CE048-STORE-NUMBER     TO PV-STORE-NBR.                 06683300
066834*    MOVE CE048-DC-NUMBER        TO PV-DC-NBR.                    06683400
066835*    DISPLAY 'TESTING: ' PV-SML-NBR '/' PV-PULL-NBR '/'           06683500
066836*            PV-PULL-LN-NBR '/' PV-SKU-NBR '/'                    06683600
066837*            PV-STORE-NBR '/' PV-DC-NBR.                          06683700
066838*********** FOR TESTING ONLY ******************************       06683800
066839                                                                  06683900
066840***************************************************************** 06684000
066841 3000-PROCESS-ERRORS.                                             06684100
066842***************************************************************** 06684200
066843     MOVE '3000-PROCESS-ERRORS        ' TO PV-ABEND-PARAGRAPH.    06684300
066844                                                                  06684400
066845     PERFORM 3100-WRITE-ERROR-RECORD.                             06684500
066846     PERFORM 3200-DISPLAY-ERROR-MSGS.                             06684600
066847                                                                  06684700
066848***************************************************************** 06684800
066849 3100-WRITE-ERROR-RECORD.                                         06684900
066850***************************************************************** 06685000
066860     MOVE '3100-WRITE-ERROR-RECORD    ' TO PV-ABEND-PARAGRAPH.    06686000
066870                                                                  06687000
066880     IF CE048-ERROR-CODE = ' '                                    06688000
066890         SET CE048-ERR-FIRST-TIME TO TRUE                         06689000
066900     ELSE                                                         06690000
067000         IF CE048-ERR-FIRST-TIME                                  06700000
067100            SET CE048-ERR-SECND-TIME TO TRUE                      06710000
067200         END-IF                                                   06720000
067300     END-IF.                                                      06730000
067400                                                                  06740000
067500     IF CE048-ERROR-DATE > SPACES                                 06750000
067600        CONTINUE                                                  06760000
067700     ELSE                                                         06770000
067800        MOVE PV-ERROR-DATE TO CE048-ERROR-DATE                    06780000
067900     END-IF.                                                      06790000
067901                                                                  06790100
067902     WRITE OUTPUT-RECORD-1 FROM CE048-PULL-BRCD-EXTRACT-REC.      06790200
067903                                                                  06790300
067904     ADD 1 TO PV-COUNT-ERROR.                                     06790400
067905                                                                  06790500
067906     IF (PS-PULL-NBR-CANCELED    OR                               06790600
067907        PS-PULL-NBR-POSTED      OR                                06790700
067908        PS-PULL-LN-NBR-CANCELED OR                                06790800
067909        PS-PULL-LN-NBR-POSTED) AND                                06790900
067910        (PS-BARCODE-SW NOT = 'E')                                 06791000
067911        PERFORM 3150-WRITE-RECYCLE-RECORD                         06791100
067912     END-IF.                                                      06791200
067913                                                                  06791300
067914***************************************************************** 06791400
067915 3150-WRITE-RECYCLE-RECORD.                                       06791500
067916***************************************************************** 06791600
067917     MOVE '3150-WRITE-RECYCLE-RECORD  ' TO PV-ABEND-PARAGRAPH.    06791700
067918                                                                  06791800
067919     WRITE OUTPUT-RECORD-4 FROM CE048-PULL-BRCD-EXTRACT-REC.      06791900
067920                                                                  06792000
067930     ADD 1 TO PV-COUNT-RECYCLE.                                   06793000
067931                                                                  06793100
067932***************************************************************** 06793200
067933 3200-DISPLAY-ERROR-MSGS.                                         06793300
067934***************************************************************** 06793400
067935     MOVE '3200-DISPLAY-ERROR-MSGS    ' TO PV-ABEND-PARAGRAPH.    06793500
067936                                                                  06793600
067937     MOVE SPACES TO PV-USER-NAME.                                 06793700
067938     MOVE SPACES TO WS-ERR-DTL-MESSAGE.                           06793800
067939                                                                  06793900
067940     MOVE CE048-SHIPT-UNT-ID     TO PV-SML-NBR.                   06794000
067950     MOVE CE048-CNSTK-REQ-PL-NBR TO PV-PULL-NBR.                  06795000
067960     MOVE CE048-PL-LNE-NBR       TO PV-PULL-LN-NBR.               06796000
067970     MOVE CE048-SKU-NUMBER       TO PV-SKU-NBR.                   06797000
067980     MOVE CE048-STORE-NUMBER     TO PV-STORE-NBR.                 06798000
067990     MOVE CE048-DC-NUMBER        TO PV-DC-NBR.                    06799000
068000     MOVE CE048-REQ-ORD-QTY      TO PV-QTY-NBR.                   06800000
068100                                                                  06810000
068110     DISPLAY PV-SML-NBR '/' PV-PULL-NBR '/'                       06811000
068120             PV-PULL-LN-NBR '/' PV-SKU-NBR '/'                    06812000
068130             PV-STORE-NBR '/' PV-DC-NBR.                          06813000
068140                                                                  06814000
068150     SET PS-DETAIL-NOT-WRITTEN TO TRUE.                           06815000
068160                                                                  06816000
068161     IF PS-PULL-NBR-VALID                                         06816100
068162        DISPLAY '    PULL NBR VALID'                              06816200
068163     ELSE                                                         06816300
068164        IF PS-PULL-NBR-NOT-FOUND                                  06816400
068165            DISPLAY '    PULL NBR NOT FOUND ' PV-PULL-NBR         06816500
068166            MOVE 'PULL NBR NOT FOUND' TO WS-ERR-DTL-MESSAGE       06816600
068167        ELSE                                                      06816700
068168           IF PS-PULL-NBR-CANCELED                                06816800
068169               DISPLAY '    PULL NBR CANCELED ' PV-PULL-NBR       06816900
068170               MOVE 'PULL NBR CANCELED' TO WS-ERR-DTL-MESSAGE     06817000
068180           ELSE                                                   06818000
068190              IF PS-PULL-NBR-POSTED                               06819000
068200                  DISPLAY '    PULL NBR POSTED ' PV-PULL-NBR      06820000
068300                  MOVE 'PULL NBR POSTED' TO WS-ERR-DTL-MESSAGE    06830000
068400              END-IF                                              06840000
068410           END-IF                                                 06841000
068420        END-IF                                                    06842000
068430     END-IF.                                                      06843000
068440                                                                  06844000
068441     IF PS-PULL-NBR-VALID                                         06844100
068442        CONTINUE                                                  06844200
068443     ELSE                                                         06844300
068444        PERFORM 8200-WRITE-REPORT                                 06844400
068445     END-IF.                                                      06844500
068446                                                                  06844600
068447     IF PS-PULL-LN-NBR-VALID                                      06844700
068448        DISPLAY '    PULL LINE NBR VALID'                         06844800
068449     ELSE                                                         06844900
068450        IF PS-PULL-LN-NBR-NOT-FOUND                               06845000
068460            DISPLAY '    PULL LINE NBR NOT FOUND '                06846000
068470                       PV-PULL-LN-NBR                             06847000
068480            MOVE 'PULL LINE NBR NOT FOUND' TO WS-ERR-DTL-MESSAGE  06848000
068490        ELSE                                                      06849000
068500           IF PS-PULL-LN-NBR-CANCELED                             06850000
068510               DISPLAY '    PULL LINE NBR CANCELED '              06851000
068520                       PV-PULL-LN-NBR                             06852000
068530               MOVE 'PULL LINE NBR CANCELED' TO                   06853000
068540                  WS-ERR-DTL-MESSAGE                              06854000
068550           ELSE                                                   06855000
068560              IF PS-PULL-LN-NBR-POSTED                            06856000
068570                  DISPLAY '    PULL LINE NBR POSTED '             06857000
068580                       PV-PULL-LN-NBR                             06858000
068590                  MOVE 'PULL LINE NBR POSTED' TO                  06859000
068600                     WS-ERR-DTL-MESSAGE                           06860000
068700                  PERFORM 3300-SELECT-TCEPLST                     06870000
068800                  PERFORM 3400-POSTED-MSG                         06880000
068900              END-IF                                              06890000
068910           END-IF                                                 06891000
068920        END-IF                                                    06892000
068930     END-IF.                                                      06893000
068940     IF PS-PULL-LN-NBR-VALID                                      06894000
068950        CONTINUE                                                  06895000
068960     ELSE                                                         06896000
068970        PERFORM 8200-WRITE-REPORT                                 06897000
068971     END-IF.                                                      06897100
068972     IF PS-PULL-LN-NBR-VALID                                      06897200
068973        CONTINUE                                                  06897300
068974     ELSE                                                         06897400
068975        IF PS-PULL-LN-NBR-POSTED                                  06897500
068976           STRING 'LINE POSTED - '     DELIMITED BY SIZE          06897600
068977                  PV-USER-NAME    DELIMITED BY SIZE               06897700
068978                  INTO WS-ERR-DTL-MESSAGE                         06897800
068979           END-STRING                                             06897900
068980           PERFORM 8200-WRITE-REPORT                              06898000
068990        END-IF                                                    06899000
068991     END-IF.                                                      06899100
068992     IF PS-PULL-LN-NBR-POSTED                                     06899200
068993        STRING 'LINE POSTED - '     DELIMITED BY SIZE             06899300
068994               CEPLST-CRE-TMST DELIMITED BY SIZE                  06899400
068995               INTO WS-ERR-DTL-MESSAGE                            06899500
068996        END-STRING                                                06899600
068997        PERFORM 8200-WRITE-REPORT                                 06899700
068998     END-IF.                                                      06899800
068999                                                                  06899900
069000     IF PS-PULL-SKU-NBR-VALID                                     06900000
069001        DISPLAY '    SKU NUMBER VALID'                            06900100
069002     ELSE                                                         06900200
069003        DISPLAY '    SKU NUMBER NOT VALID ' PV-SKU-NBR            06900300
069004        MOVE 'SKU NUMBER NOT VALID' TO WS-ERR-DTL-MESSAGE         06900400
069005        PERFORM 8200-WRITE-REPORT                                 06900500
069006     END-IF.                                                      06900600
069007                                                                  06900700
069008     IF PS-PULL-STR-NBR-VALID                                     06900800
069009        DISPLAY '    STORE NUMBER VALID'                          06900900
069010     ELSE                                                         06901000
069020        DISPLAY '    STORE NUMBER NOT VALID ' PV-STORE-NBR        06902000
069021        MOVE 'STORE NUMBER NOT VALID' TO WS-ERR-DTL-MESSAGE       06902100
069022        PERFORM 8200-WRITE-REPORT                                 06902200
069023     END-IF.                                                      06902300
069024                                                                  06902400
069025     IF PS-BARCODE-VALID                                          06902500
069026        DISPLAY '    BARCODE VALID'                               06902600
069027     ELSE                                                         06902700
069028        IF PS-BARCODE-INVALID                                     06902800
069029            DISPLAY '    BARCODE NOT VALID ' PV-SML-NBR           06902900
069030            MOVE 'BARCODE NOT VALID' TO WS-ERR-DTL-MESSAGE        06903000
069031            PERFORM 8200-WRITE-REPORT                             06903100
069032            IF PS-CONTAINER-INVALID                               06903200
069033               DISPLAY '        CONTAINER NOT VALID'              06903300
069034                       ' (POS 1-2)'                               06903400
069035               MOVE 'CONTAINER NOT VALID (POS 1-2)' TO            06903500
069036                  WS-ERR-DTL-MESSAGE                              06903600
069037               PERFORM 8200-WRITE-REPORT                          06903700
069038            END-IF                                                06903800
069039            IF PS-PACKAGE-TYP-INVALID                             06903900
069040               DISPLAY '        PACKAGE TYPE NOT VALID'           06904000
069050                       ' (POS 3)'                                 06905000
069060               MOVE 'PACKAGE TYPE NOT VALID (POS 3)' TO           06906000
069061                  WS-ERR-DTL-MESSAGE                              06906100
069062               PERFORM 8200-WRITE-REPORT                          06906200
069063            END-IF                                                06906300
069064            IF PS-SOFTWARE-SRC-INVALID                            06906400
069065               DISPLAY '        SOFTWARE SRC NOT VALID'           06906500
069066                       ' (POS 4)'                                 06906600
069067               MOVE 'SOFTWARE SRC NOT VALID (POS 4)' TO           06906700
069068                  WS-ERR-DTL-MESSAGE                              06906800
069069               PERFORM 8200-WRITE-REPORT                          06906900
069070            END-IF                                                06907000
069071            IF PS-DIVERT-CD-INVALID                               06907100
069072               DISPLAY '        DIVERT CODE NOT VALID'            06907200
069073                       ' (POS 6-9)'                               06907300
069074               MOVE 'DIVERT CODE NOT VALID (POS 4-9)' TO          06907400
069075                  WS-ERR-DTL-MESSAGE                              06907500
069076               PERFORM 8200-WRITE-REPORT                          06907600
069077            END-IF                                                06907700
069078            IF PS-DC-ORIGIN-INVALID                               06907800
069079               DISPLAY '        DC ORIGIN NOT VALID'              06907900
069080                       ' (POS 10-12)'                             06908000
069081               MOVE 'DC ORIGIN NOT VALID (POS 10-12)' TO          06908100
069082                  WS-ERR-DTL-MESSAGE                              06908200
069083               PERFORM 8200-WRITE-REPORT                          06908300
069084            END-IF                                                06908400
069085        ELSE                                                      06908500
069086           IF PS-BARCODE-DUPLICATE                                06908600
069087              DISPLAY '    DUPLICATE BARCODE ' PV-SML-NBR         06908700
069088              MOVE 'DUPLICATE BARCODE' TO                         06908800
069089                 WS-ERR-DTL-MESSAGE                               06908900
069090              PERFORM 8200-WRITE-REPORT                           06909000
069091           ELSE                                                   06909100
069092              IF PS-BARCODE-OTBND-TRIP-SHPD                       06909200
069093                  DISPLAY '    OUTBOUND TRIP SHIPPED '            06909300
069094                          PV-SML-NBR                              06909400
069095                 MOVE 'OUTBOUND TRIP SHIPPED' TO                  06909500
069096                    WS-ERR-DTL-MESSAGE                            06909600
069097                 PERFORM 8200-WRITE-REPORT                        06909700
069098              ELSE                                                06909800
069099                 IF PS-DUPLICATE-SML                              06909900
069100                    DISPLAY '    DUPLICATE SML    '               06910000
069101                               PV-SML-NBR                         06910100
069102                    MOVE 'DUPLICATE SML' TO                       06910200
069103                          WS-ERR-DTL-MESSAGE                      06910300
069104                    PERFORM 8200-WRITE-REPORT                     06910400
069105                 END-IF                                           06910500
069106              END-IF                                              06910600
069107           END-IF                                                 06910700
069108        END-IF                                                    06910800
069109     END-IF.                                                      06910900
069110                                                                  06911000
069111     PERFORM 8500-WRITE-BLANK-LINE.                               06911100
069112                                                                  06911200
069113                                                                  06911300
069114***************************************************************** 06911400
069115 3300-SELECT-TCEPLST.                                             06911500
069116***************************************************************** 06911600
069117                                                                  06911700
069118     MOVE '3300-SELECT-TCEPLST' TO PV-ABEND-PARAGRAPH.            06911800
069119                                                                  06911900
069120     MOVE PV-PULL-NBR TO CEPLST-CNSTK-REQ-PL-NBR.                 06912000
069121     MOVE PV-PULL-LN-NBR TO CEPLST-PL-LNE-NBR.                    06912100
069122                                                                  06912200
069123     EXEC SQL                                                     06912300
069124         SELECT  A.CRE_TMST, A.CRE_BY_USR_ID                      06912400
069125           INTO  :CEPLST-CRE-TMST, :CEPLST-CRE-BY-USR-ID          06912500
069126           FROM  TCEPLST A                                        06912600
069127          WHERE  A.CNSTK_REQ_PL_NBR = :CEPLST-CNSTK-REQ-PL-NBR    06912700
069128             AND A.PL_LNE_NBR = :CEPLST-PL-LNE-NBR                06912800
069129             AND A.STAT_CDE = 'PD'                                06912900
069130             AND A.CRE_TMST =                                     06913000
069131                (SELECT  MAX(B.CRE_TMST)                          06913100
069132                  FROM  TCEPLST B                                 06913200
069133                 WHERE  B.CNSTK_REQ_PL_NBR =                      06913300
069134                                    :CEPLST-CNSTK-REQ-PL-NBR      06913400
069135                    AND B.PL_LNE_NBR = :CEPLST-PL-LNE-NBR         06913500
069136                    AND B.STAT_CDE = 'PD')                        06913600
069137          WITH UR                                                 06913700
069138     END-EXEC.                                                    06913800
069139                                                                  06913900
069140     EVALUATE TRUE                                                06914000
069141       WHEN SQLCODE = +0                                          06914100
069142          CONTINUE                                                06914200
069143       WHEN OTHER                                                 06914300
069144           MOVE 'TCEPLST' TO PV-DB2-TABLE-NAME                    06914400
069145           MOVE 'SELECT FOR WHO POSTED PULL'                      06914500
069146                          TO PV-DB2-OPERATION-MESSAGE-1           06914600
069147           PERFORM 9900-DB2-ABEND                                 06914700
069148     END-EVALUATE.                                                06914800
069149                                                                  06914900
069150***************************************************************** 06915000
069151* 3400-POSTED-MSG.                                                06915100
069152***************************************************************** 06915200
069153                                                                  06915300
069154 3400-POSTED-MSG.                                                 06915400
069155                                                                  06915500
069156     EVALUATE TRUE                                                06915600
069157        WHEN CEPLST-CRE-BY-USR-ID = 'CEKCS611'                    06915700
069158             MOVE 'AUTO PRINT' TO PV-USER-NAME                    06915800
069159        WHEN CEPLST-CRE-BY-USR-ID = 'CEKUP006'                    06915900
069160             MOVE 'AUTO POST PROCESS' TO PV-USER-NAME             06916000
069161        WHEN CEPLST-CRE-BY-USR-ID = 'WMKUP015'                    06916100
069162             MOVE 'RDM AUTO POST PROCESS' TO PV-USER-NAME         06916200
069163        WHEN CEPLST-CRE-BY-USR-ID = 'WMKUP024'                    06916300
069164             MOVE 'POSTED BY AGING PROCESS' TO PV-USER-NAME       06916400
069165        WHEN CEPLST-CRE-BY-USR-ID = 'CEKUP024'                    06916500
069166             MOVE 'POSTED BY AGING PROCESS' TO PV-USER-NAME       06916600
069167        WHEN CEPLST-CRE-BY-USR-ID = 'WMKUP027'                    06916700
069168             MOVE 'POSTED BY CPLT MSG IR VENDOR' TO               06916800
069169             PV-USER-NAME                                         06916900
069170        WHEN OTHER                                                06917000
069171             PERFORM 3500-GET-USER-NAME                           06917100
069172     END-EVALUATE.                                                06917200
069173                                                                  06917300
069174 3500-GET-USER-NAME.                                              06917400
069175                                                                  06917500
069176*----------------------------------------------------------------*06917600
069177*  CVLL XLKUT067 TO RETRIEVE THE NAME FOR USERID                  06917700
069178*----------------------------------------------------------------*06917800
069179                                                                  06917900
069180     MOVE CEPLST-CRE-BY-USR-ID TO XL067-KEY-USER-ID.              06918000
069181                                                                  06918100
069182     SET XL067-BY-USER-ID                                         06918200
069183         XL067-SELECT-BOTH-USERS      TO TRUE.                    06918300
069184                                                                  06918400
069185     CALL XL067-USER-PGM USING XL067-USER-COMMAREA.               06918500
069186                                                                  06918600
069187     IF XL067-SUCCESSFUL                                          06918700
069188        IF XL067-USER-NOT-FOUND                                   06918800
069189           MOVE CEPLST-CRE-BY-USR-ID     TO PV-USER-NAME          06918900
069190        ELSE                                                      06919000
069191           MOVE XL067-COMBINED-NAME-2    TO PV-USER-NAME          06919100
069192        END-IF                                                    06919200
069193     ELSE                                                         06919300
069194        MOVE CEPLST-CRE-BY-USR-ID     TO PV-USER-NAME             06919400
069195     END-IF.                                                      06919500
069196                                                                  06919600
069197***************************************************************** 06919700
069198 3600-CHECK-INTR-START-DTE.                                       06919800
069199***************************************************************** 06919900
069200     MOVE '3600-CHECK-INTR-START-DTE    ' TO PV-ABEND-PARAGRAPH.  06920000
069201                                                                  06920100
069202     DISPLAY '3600-CHECK-INTR-START-DTE'.                         06920200
069203                                                                  06920300
069204     SET PS-PROCESS-BARCODE-NO  TO TRUE.                          06920400
069205                                                                  06920500
069206     EXEC SQL                                                     06920600
069207         SELECT C.FUNC_TXT                                        06920700
069208           INTO :KRPRPM-FUNC-TXT                                  06920800
069209         FROM TCEPLRQ   A                                         06920900
069210            , TCEPLST   B                                         06921000
069211            , TKRPRPM   C                                         06921100
069212         WHERE A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                06921200
069213           AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR            06921300
069214           AND A.CNSTK_LOC_ID     = C.LOC_ID                      06921400
069215           AND B.STAT_CDE         = 'NW'                          06921500
069216           AND B.PL_LNE_NBR       = 0                             06921600
069217           AND C.INTFC_SYS_CDE    = 'KHL'                         06921700
069218           AND C.SYS_PRC_FUNC_CDE = 'CSSMLC'                      06921800
069219           AND B.CRE_TMST         >= C.FUNC_BEG_TMST              06921900
069220           AND C.FUNC_PRC_STAT_CDE = 'AC'                         06922000
069221     END-EXEC.                                                    06922100
069222                                                                  06922200
069223     EVALUATE TRUE                                                06922300
069224       WHEN SQLCODE = +0                                          06922400
069225            CONTINUE                                              06922500
069226       WHEN SQLCODE = +100                                        06922600
069227            SET PS-CHECK-PARM-ON-NO    TO TRUE                    06922700
069228                                                                  06922800
069229       WHEN OTHER                                                 06922900
069230           MOVE 'TKRPRPM' TO PV-DB2-TABLE-NAME                    06923000
069240           MOVE 'SELECT INTRANSIT PUL CREATE DATES '              06924000
069241                          TO PV-DB2-OPERATION-MESSAGE-1           06924100
069242           PERFORM 9900-DB2-ABEND                                 06924200
069243     END-EVALUATE.                                                06924300
069244                                                                  06924400
069245 3650-EVAL-CS-SML-CHECK.                                          06924500
069246      MOVE KRPRPM-FUNC-TXT TO PV-CS-FUNC-PROCESS.                 06924600
069247      EVALUATE TRUE                                               06924700
069248         WHEN PV-SML-IND  = 'ALL'                                 06924800
069249           SET PS-PROCESS-BARCODE-YES  TO TRUE                    06924900
069250         WHEN PV-SML-IND  = 'BYP'                                 06925000
069251           SET PS-PROCESS-BARCODE-NO   TO TRUE                    06925100
069252         WHEN PV-SML-IND  = 'EXC'                                 06925200
069253           SET PS-PROCESS-BARCODE-YES  TO TRUE                    06925300
069254           IF PV-CS-PULL-EXC-1 > SPACE                            06925400
069255              IF CE048-CNSTK-REQ-PL-NBR = PV-CS-PULL-EXC-R1       06925500
069256                 SET PS-PROCESS-BARCODE-NO   TO TRUE              06925600
069257              END-IF                                              06925700
069258           END-IF                                                 06925800
069259           IF PV-CS-PULL-EXC-2 > SPACE                            06925900
069260              IF CE048-CNSTK-REQ-PL-NBR = PV-CS-PULL-EXC-R2       06926000
069261                 SET PS-PROCESS-BARCODE-NO   TO TRUE              06926100
069262              END-IF                                              06926200
069263           END-IF                                                 06926300
069264           IF PV-CS-PULL-EXC-3 > SPACE                            06926400
069265              IF CE048-CNSTK-REQ-PL-NBR = PV-CS-PULL-EXC-R3       06926500
069266                 SET PS-PROCESS-BARCODE-NO   TO TRUE              06926600
069267              END-IF                                              06926700
069268           END-IF                                                 06926800
069269      END-EVALUATE.                                               06926900
069270***************************************************************** 06927000
069271 4000-WRITE-OUTPUT-RECS.                                          06927100
069272***************************************************************** 06927200
069273     MOVE '4000-WRITE-OUTPUT-RECS     ' TO PV-ABEND-PARAGRAPH.    06927300
069274                                                                  06927400
069275     PERFORM 4100-WRITE-CS-PULL-FILE.                             06927500
069276     IF PS-PROCESS-BARCODE-YES                                    06927600
069277        PERFORM 4200-WRITE-MANIFEST-FILE                          06927700
069278     END-IF.                                                      06927800
069279                                                                  06927900
069280***************************************************************** 06928000
069281 4100-WRITE-CS-PULL-FILE.                                         06928100
069282***************************************************************** 06928200
069283*    WRITE THE OUTPUT FILE USED IN CENTRAL STOCK PROCESSING       06928300
069284*                                                                 06928400
069285     MOVE '4100-WRITE-CS-PULL-FILE    ' TO PV-ABEND-PARAGRAPH.    06928500
069286                                                                  06928600
069287     INITIALIZE CE026-CS-STR-MANIFEST-RECORD.                     06928700
069288     MOVE CE048-CNSTK-REQ-PL-NBR       TO CE026-PULL-NBR.         06928800
069289     MOVE CE048-PL-LNE-NBR             TO CE026-PULL-LNE-NBR.     06928900
069290     MOVE CE048-DC-NUMBER              TO CE026-DC-STORE-NBR.     06929000
069291     MOVE CE048-STORE-NUMBER           TO CE026-RECV-STORE-NBR.   06929100
069292     MOVE PV-REFORMAT-TMST-DTE         TO CE026-MANIFEST-DATE.    06929200
069293     MOVE CE048-REQ-ORD-QTY            TO CE026-MANIFEST-QTY.     06929300
069294     MOVE CE048-STOCK-ORDER-NBR        TO CE026-BOL-NBR.          06929400
069295     MOVE ZERO                         TO CE026-RDM-BATCH-NBR.    06929500
069296     WRITE OUTPUT-RECORD-2 FROM CE026-CS-STR-MANIFEST-RECORD.     06929600
069297     ADD 1 TO PV-COUNT-PULL.                                      06929700
069298                                                                  06929800
069299                                                                  06929900
069300***************************************************************** 06930000
069301 4200-WRITE-MANIFEST-FILE.                                        06930100
069302***************************************************************** 06930200
069303*    WRITE THE OUTPUT FILE USED IN SML BARCODE PROCESSING         06930300
069304*                                                                 06930400
069305     MOVE '4200-WRITE-MANIFEST-FILE   ' TO PV-ABEND-PARAGRAPH.    06930500
069306                                                                  06930600
069307     INITIALIZE SU011-BOL-MANIFEST-RECORD.                        06930700
069308     MOVE CE048-SHIPT-UNT-ID           TO PV-SML-NBR.             06930800
069309     MOVE PV-SML-NBR                   TO SU011-CONTAINER-ID.     06930900
069310     MOVE CE048-DC-NUMBER              TO SU011-OPER-UNT-ID.      06931000
069311     MOVE CE048-STORE-NUMBER           TO SU011-DEST-OPER-UNT-ID. 06931100
069312     MOVE CE048-CNSTK-REQ-PL-NBR       TO PV-TRN-NBR.             06931200
069313     MOVE CE048-PL-LNE-NBR             TO PV-TRN-LNE-NBR.         06931300
069314     MOVE PV-DISTRIBUTION-NBR          TO SU011-DISTRIBUTION-NBR. 06931400
069315     MOVE ZERO                         TO SU011-BATCH-NBR.        06931500
069316     MOVE PV-REFORMAT-DATE-EDIT        TO SU011-ETA-DATE.         06931600
069317     MOVE PV-REFORMAT-TIME-EDIT        TO SU011-ETA-TIME.         06931700
069318     MOVE CE048-REQ-ORD-QTY            TO SU011-UNIT-QTY.         06931800
069319     WRITE OUTPUT-RECORD-3 FROM SU011-BOL-MANIFEST-RECORD.        06931900
069320     ADD 1 TO PV-COUNT-MNFST.                                     06932000
069321                                                                  06932100
069322                                                                  06932200
069323                                                                  06932300
069324******************************************************************06932400
069325 8000-GET-TIMESTAMP.                                              06932500
069326***************************************************************** 06932600
069327*  FORMAT EXAMPLE 2000-01-01-00.00.00.000000                      06932700
069328                                                                  06932800
069329     MOVE '8000-GET-TIMESTAMP         ' TO PV-ABEND-PARAGRAPH.    06932900
069330                                                                  06933000
069331     EXEC SQL                                                     06933100
069332         SET :PV-TMST = CURRENT TIMESTAMP                         06933200
069333     END-EXEC.                                                    06933300
069334                                                                  06933400
069335     EVALUATE TRUE                                                06933500
069336       WHEN SQLCODE = ZERO                                        06933600
069337            MOVE PV-TMST(1:10)    TO PV-ERROR-DATE                06933700
069338            MOVE PV-TMST(1:4)     TO PV-REFORMAT-TMST-DTE-CY      06933800
069339                                     DP150O-RUN-YEAR              06933900
069340            MOVE PV-TMST(6:2)     TO PV-REFORMAT-TMST-DTE-MM      06934000
069350                                     DP150O-RUN-MONTH             06935000
069360            MOVE PV-TMST(9:2)     TO PV-REFORMAT-TMST-DTE-DD      06936000
069370                                     DP150O-RUN-DAY               06937000
069380            MOVE PV-TMST(1:10)    TO PV-REFORMAT-DATE-EDIT        06938000
069390            MOVE PV-TMST(12:8)    TO PV-REFORMAT-TIME-EDIT        06939000
069400            MOVE PV-TMST(12:2)    TO DP150O-RUN-HOUR              06940000
069500            MOVE PV-TMST(15:2)    TO DP150O-RUN-MINUTE            06950000
069600                                                                  06960000
069700       WHEN SQLWARN0 NOT EQUAL SPACE                              06970000
069800       WHEN SQLCODE NOT EQUAL ZERO                                06980000
069900           DISPLAY '**********************************'           06990000
070000           DISPLAY '** ABEND                        **'           07000000
070100           DISPLAY '** PROGRAM = CEKRP052           **'           07010000
070200           DISPLAY '** PARAGRAPH = 8000-GET-TIMESTAMP*'           07020000
070300           DISPLAY '** UNSUCCESSFUL SELECT          **'           07030000
070400           DISPLAY '**********************************'           07040000
070500           PERFORM 9900-DB2-ABEND                                 07050000
070600     END-EVALUATE.                                                07060000
070700                                                                  07070000
070800 8100-NEW-PAGE.                                                   07080000
070900                                                                  07090000
071000     MOVE 'CEKRP052'             TO DP150O-PROGRAM-NAME.          07100000
071100     MOVE 1                      TO DP150O-REPORT-NUMBER.         07110000
071200     ADD 1                       TO PV-PAGE-CNT.                  07120000
071300     MOVE PV-PAGE-CNT            TO DP150O-PAGE-NUMBER.           07130000
071400                                                                  07140000
071500     WRITE ERROR-REPORT-REC FROM DP150O-STANDRD-HEADER-150-COLS   07150000
071600        AFTER ADVANCING PAGE.                                     07160000
071700                                                                  07170000
071800     WRITE ERROR-REPORT-REC FROM WS-HEADING-LINE1                 07180000
071900        AFTER ADVANCING 2 LINE.                                   07190000
072000                                                                  07200000
072100     WRITE ERROR-REPORT-REC FROM WS-HEADING-LINE2                 07210000
072200        AFTER ADVANCING 2 LINE.                                   07220000
072300                                                                  07230000
072400     WRITE ERROR-REPORT-REC FROM WS-HEADING-LINE3                 07240000
072500        AFTER ADVANCING 1 LINE.                                   07250000
072600                                                                  07260000
072700     MOVE SPACES TO ERROR-REPORT-REC.                             07270000
072800     WRITE ERROR-REPORT-REC AFTER ADVANCING 1 LINE.               07280000
072900                                                                  07290000
073000     MOVE 7 TO PV-LINE-CNT.                                       07300000
073100                                                                  07310000
073200     SET PS-DETAIL-NOT-WRITTEN TO TRUE.                           07320000
073300                                                                  07330000
073400 8200-WRITE-REPORT.                                               07340000
073500                                                                  07350000
073600     IF PV-LINE-CNT > 59                                          07360000
073700        PERFORM 8100-NEW-PAGE                                     07370000
073800     END-IF.                                                      07380000
073900                                                                  07390000
074000     IF PS-DETAIL-WRITTEN                                         07400000
074100        MOVE SPACES TO WS-ERROR-DTL-LINE                          07410000
074200        WRITE ERROR-REPORT-REC FROM WS-ERROR-DETAIL-LINE          07420000
074300     ELSE                                                         07430000
074400        PERFORM 8300-FILL-DETAIL-LINE                             07440000
074500        WRITE ERROR-REPORT-REC FROM WS-ERROR-DETAIL-LINE          07450000
074600        SET PS-DETAIL-WRITTEN TO TRUE                             07460000
074700     END-IF.                                                      07470000
074800                                                                  07480000
074900     ADD 1 TO PV-LINE-CNT.                                        07490000
075000                                                                  07500000
075100***************************************************************** 07510000
075200 8300-FILL-DETAIL-LINE.                                           07520000
075300***************************************************************** 07530000
075400                                                                  07540000
075500     MOVE CE048-SHIPT-UNT-ID     TO WS-ERR-DTL-CARTON.            07550000
075600     MOVE CE048-CNSTK-REQ-PL-NBR TO WS-ERR-DTL-PULL-NBR.          07560000
075700     MOVE CEPLRQ-CNSTK-LOC-ID    TO WS-ERR-DTL-LOC-ID.            07570000
075800     MOVE CE048-PL-LNE-NBR       TO WS-ERR-DTL-LINE-NBR.          07580000
075900     MOVE CE048-SKU-NUMBER       TO WS-ERR-DTL-SKU.               07590000
076000     MOVE CE048-STORE-NUMBER     TO WS-ERR-DTL-STORE.             07600000
076100     MOVE CE048-REQ-ORD-QTY      TO WS-ERR-DTL-QTY.               07610000
076200     MOVE CE048-DC-NUMBER        TO WS-ERR-DTL-DC.                07620000
076300     MOVE CE048-ERROR-DATE(6:5)  TO WS-ERR-DATE(1:5).             07630000
076400     MOVE CE048-ERROR-DATE(5:1)  TO WS-ERR-DATE(6:1).             07640000
076500     MOVE CE048-ERROR-DATE(1:4)  TO WS-ERR-DATE(7:4).             07650000
076600*CHG0210914                                                       07660000
076700     PERFORM 8310-GET-DEPT-SUB-CLASS.                             07670000
076800                                                                  07680000
076900 8310-GET-DEPT-SUB-CLASS.                                         07690000
077000                                                                  07700000
077100      MOVE CE048-SKU-NUMBER TO XLT00003-SKU-NBR                   07710000
077200                                                                  07720000
077300      EXEC SQL                                                    07730000
077400           SELECT  A.DEPT_NBR                                     07740000
077500                 , A.SUB_CL_NBR                                   07750000
077600           INTO                                                   07760000
077700                   :XLT00004-DEPT-NBR                             07770000
077800                 , :XLT00004-SUB-CL-NBR                           07780000
077900           FROM  XLT_VND_STYL A                                   07790000
078000               , XLT_SKU B                                        07800000
078100           WHERE B.SKU_NBR = :XLT00003-SKU-NBR                    07810000
078200             AND B.STYL_ID = A.STYL_ID                            07820000
078201           WITH UR                                                07820100
078202                                                                  07820200
078203      END-EXEC.                                                   07820300
078204                                                                  07820400
078205     EVALUATE TRUE                                                07820500
078206       WHEN SQLCODE = +0                                          07820600
078207            MOVE XLT00004-DEPT-NBR      TO WS-ERR-DTL-DEPT        07820700
078208            MOVE XLT00004-SUB-CL-NBR    TO WS-ERR-DTL-SUB         07820800
078209                                                                  07820900
078210       WHEN SQLCODE = +100                                        07821000
078220            MOVE ZEROS                  TO WS-ERR-DTL-DEPT        07822000
078221            MOVE ZEROS                  TO WS-ERR-DTL-SUB         07822100
078222                                                                  07822200
078223       WHEN OTHER                                                 07822300
078224           MOVE 'XLT-VND_STYL' TO PV-DB2-TABLE-NAME               07822400
078225           MOVE 'SELECT DEPT & SUB CL NBR'                        07822500
078226                          TO PV-DB2-OPERATION-MESSAGE-1           07822600
078227           PERFORM 9900-DB2-ABEND                                 07822700
078228     END-EVALUATE.                                                07822800
078229*CHG0210914                                                       07822900
078230 8400-EMPTY-ERROR-REPORT.                                         07823000
078231                                                                  07823100
078232     MOVE SPACES TO ERROR-REPORT-REC.                             07823200
078233     MOVE '* NO DATA *' TO ERROR-REPORT-REC.                      07823300
078234     WRITE ERROR-REPORT-REC AFTER ADVANCING 1 LINE.               07823400
078235                                                                  07823500
078236     ADD 1 TO PV-LINE-CNT.                                        07823600
078237                                                                  07823700
078238 8500-WRITE-BLANK-LINE.                                           07823800
078239                                                                  07823900
078240     MOVE SPACES TO ERROR-REPORT-REC.                             07824000
078250     WRITE ERROR-REPORT-REC AFTER ADVANCING 1 LINE.               07825000
078260                                                                  07826000
078270     ADD 1 TO PV-LINE-CNT.                                        07827000
078280                                                                  07828000
078290 8600-EOR.                                                        07829000
078300                                                                  07830000
078400     MOVE SPACES TO ERROR-REPORT-REC.                             07840000
078500     WRITE ERROR-REPORT-REC FROM WS-EOR-LINE1                     07850000
078600        AFTER ADVANCING 2 LINE.                                   07860000
078700                                                                  07870000
078800     ADD 2 TO PV-LINE-CNT.                                        07880000
078900                                                                  07890000
079000******************************************************************07900000
079100* CHECK ELASPED DAYS SINCE ERROR CREATED (HOW LONG RECYCLED)      07910000
079200***************************************************************** 07920000
079300 8700-CHECK-DAYS.                                                 07930000
079400                                                                  07940000
079500     MOVE '8700 CHECK DAYS            ' TO PV-ABEND-PARAGRAPH.    07950000
079600                                                                  07960000
079700     EXEC SQL                                                     07970000
079800         SET :PV-ELAPSED-DAYS =                                   07980000
079900               DAYS(CURRENT DATE) - DAYS(:CE048-ERROR-DATE)       07990000
080000     END-EXEC.                                                    08000000
080100                                                                  08010000
080200     EVALUATE TRUE                                                08020000
080300       WHEN SQLCODE = ZERO                                        08030000
080400          CONTINUE                                                08040000
080500       WHEN SQLWARN0 NOT EQUAL SPACE                              08050000
080600       WHEN SQLCODE NOT EQUAL ZERO                                08060000
080700           DISPLAY '**********************************'           08070000
080800           DISPLAY '** ABEND                        **'           08080000
080900           DISPLAY '** PROGRAM = CEKRP052           **'           08090000
081000           DISPLAY '** PARAGRAPH = 8700-CHECK-DAYS  **'           08100000
081100           DISPLAY '** UNSUCCESSFUL SELECT          **'           08110000
081200           DISPLAY '**********************************'           08120000
081300           PERFORM 9900-DB2-ABEND                                 08130000
081400     END-EVALUATE.                                                08140000
081500                                                                  08150000
081600***************************************************************** 08160000
081700* GET MAX DAYS RECYCLE PARM FROM TKRPRPM                          08170000
081800***************************************************************** 08180000
081900 8800-GET-ERROR-RECYCLE-DAYS.                                     08190000
082000                                                                  08200000
082100     MOVE '8800-GET-ERROR-RECYCLE-DAYS' TO PV-ABEND-PARAGRAPH.    08210000
082200*                                                                 08220000
082300     EXEC SQL                                                     08230000
082400         SELECT  FUNC_QTY                                         08240000
082500           INTO  :KRPRPM-FUNC-QTY                                 08250000
082600           FROM  TKRPRPM                                          08260000
082700          WHERE LOC_ID = 90                                       08270000
082800            AND INTFC_SYS_CDE = 'KHL'                             08280000
082900            AND SYS_PRC_FUNC_CDE = 'WMPTDY'                       08290000
083000          WITH UR                                                 08300000
083100     END-EXEC.                                                    08310000
083200     EVALUATE TRUE                                                08320000
083300       WHEN SQLCODE = +0                                          08330000
083400          MOVE KRPRPM-FUNC-QTY TO PV-MAX-RECYCLE-DAYS             08340000
083500       WHEN OTHER                                                 08350000
083600           MOVE 'TKRPRPM' TO PV-DB2-TABLE-NAME                    08360000
083700           MOVE 'GET ERROR RECYCLE DAYS'                          08370000
083800                          TO PV-DB2-OPERATION-MESSAGE-1           08380000
083900           PERFORM 9900-DB2-ABEND                                 08390000
084000     END-EVALUATE.                                                08400000
084100                                                                  08410000
084200******************************************************************08420000
084300 9000-END-OF-PROGRAM.                                             08430000
084400***************************************************************** 08440000
084500                                                                  08450000
084600*DISPLAY RECORD COUNTS.                                           08460000
084700     DISPLAY ' '.                                                 08470000
084800     DISPLAY '****************************************'.          08480000
084900     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            08490000
085000     DISPLAY '*** RECORDS READ     ==> ' PV-DISPLAY-RECORD.       08500000
085100     MOVE PV-COUNT-ERROR         TO PV-DISPLAY-RECORD.            08510000
085200     DISPLAY '*** ERROR RECORDS    ==> ' PV-DISPLAY-RECORD.       08520000
085300     MOVE PV-COUNT-RECYCLE       TO PV-DISPLAY-RECORD.            08530000
085400     DISPLAY '*** RECYCLE RECS     ==> ' PV-DISPLAY-RECORD.       08540000
085500     MOVE PV-COUNT-PULL          TO PV-DISPLAY-RECORD.            08550000
085600     DISPLAY '*** CS PULL RECS     ==> ' PV-DISPLAY-RECORD.       08560000
085700     MOVE PV-COUNT-MNFST         TO PV-DISPLAY-RECORD.            08570000
085800     DISPLAY '*** MANIFEST RECS    ==> ' PV-DISPLAY-RECORD.       08580000
085900     DISPLAY '****************************************'.          08590000
086000     DISPLAY ' '.                                                 08600000
086100                                                                  08610000
086200     PERFORM 8600-EOR.                                            08620000
086300                                                                  08630000
086400*CLOSE FILES.                                                     08640000
086500     CLOSE INPUT-FILE                                             08650000
086600           OUTPUT-FILE-1                                          08660000
086700           OUTPUT-FILE-2                                          08670000
086800           OUTPUT-FILE-3                                          08680000
086900           OUTPUT-FILE-4                                          08690000
087000           OUTPUT-FILE-5.                                         08700000
087100                                                                  08710000
087200     IF PV-COUNT-ERROR > 0                                        08720000
087300        MOVE 4095 TO RETURN-CODE                                  08730000
087400     END-IF.                                                      08740000
087500                                                                  08750000
087600     DISPLAY '***  END OF CEKRP052  ***'.                         08760000
087700******************************************************************08770000
087800 9900-DB2-ABEND.                                                  08780000
087900******************************************************************08790000
088000     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    08800000
088100                                                                  08810000
088200     MOVE SQLCODE TO PV-SQLCODE.                                  08820000
088300     DISPLAY '*** DB2 ERROR '.                                    08830000
088400     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08840000
088500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08850000
088600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08860000
088700     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08870000
088800     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08880000
088900     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08890000
089000     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                08900000
089100                                                                  08910000
089200     COPY DPPD004.                                                08920000
089300                                                                  08930000
089400     MOVE +4013 TO PV-ABEND-CODE.                                 08940000
089500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08950000
089600                                                                  08960000
089700******************************************************************08970000
089800******************************************************************08980000
