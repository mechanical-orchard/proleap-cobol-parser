000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKUP121.                                00050000
000600 AUTHOR.                 DAVID COLOMBO - COMPUWARE.               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MAY 2001.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                    ITEM MAINTENANCE                           * 00120000
001300*                                                               * 00130000
001400*  THIS PROGRAM WILL UPDATE THE MR-ITEM/STORE FCST ERR LOOKUP   * 00140000
001500*  CONTROL TABLE.                                               * 00150000
001600*                                                               * 00160000
001700***************************************************************** 00170000
001800*  CHANGE MADE:                                                 * 00180000
001900*                                                               * 00190000
002000***************************************************************** 00200000
002100* CHANGED XX/XX/XX BY XXXXXXXXXXXXXXXX                            00210000
002200*   WR# XXXXXXXXXXXX                                              00220000
002300*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   00230000
002400*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   00240000
002500*                                                                 00250000
002600***************************************************************** 00260000
002700 ENVIRONMENT DIVISION.                                            00270000
002800***************************************************************** 00280000
002900                                                                  00290000
003000 CONFIGURATION SECTION.                                           00300000
003100                                                                  00310000
003200 SOURCE-COMPUTER.        IBM-3090.                                00320000
003300 OBJECT-COMPUTER.        IBM-3090.                                00330000
003400                                                                  00340000
003500 INPUT-OUTPUT SECTION.                                            00350000
003600                                                                  00360000
003700 FILE-CONTROL.                                                    00370000
003800***************************************************************** 00380000
003900 DATA DIVISION.                                                   00390000
004000***************************************************************** 00400000
004100                                                                  00410000
004200 FILE SECTION.                                                    00420000
004300                                                                  00430000
004400 WORKING-STORAGE SECTION.                                         00440000
004500                                                                  00450000
004600 01  FILLER                          PIC X(50)     VALUE          00460001
004700     ' *** WORKING STORAGE STARTS HERE FOR MRKUP121 *** '.        00470001
004800                                                                  00480001
004900 01  PROGRAM-CONSTANTS.                                           00490001
005000     05  PC-PROGRAM-NAME             PIC  X(08)    VALUE          00500004
005100                                                   'MRKUP121'.    00510001
005200                                                                  00520001
005300 01  PROGRAM-VARIABLES.                                           00530001
005400     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   00540002
005500     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   00550001
005600     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   00560001
005700     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   00570001
005800                                                                  00580001
005900 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00590001
006000                                                  COMP SYNC.      00600001
006100     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00610001
006200     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    00620001
006300     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    00630001
006400     88  AC-DB2-ERROR                             VALUE +4013.    00640001
006500     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00650001
006600                                                                  00660001
006700                                                                  00670000
006800******************************************************************00680000
006900*  DB2 FORMATTED ERROR MESSAGE                                   *00690000
007000******************************************************************00700000
007100     COPY DPWS004.                                                00710000
007200                                                                  00720000
007300***************************************************************** 00730000
007400*    SQL COMMUNICATIONS AREA DCLGEN                               00740000
007500***************************************************************** 00750000
007600     EXEC SQL                                                     00760000
007700         INCLUDE SQLCA                                            00770000
007800     END-EXEC.                                                    00780000
007900                                                                  00790000
008000***************************************************************** 00800000
008100*    MR - ITEM/STORE FCST ERR LOOKUP                              00810000
008200***************************************************************** 00820000
008300     EXEC SQL                                                     00830000
008400         INCLUDE TMRISFL                                          00840000
008500     END-EXEC.                                                    00850000
008600                                                                  00860000
008700 LINKAGE SECTION.                                                 00870000
008800                                                                  00880000
008900***************************************************************** 00890000
009000 PROCEDURE DIVISION.                                              00900000
009100***************************************************************** 00910000
009200                                                                  00920000
009300 A000-MAINLINE-PROCESSING.                                        00930000
009400                                                                  00940000
009500     DISPLAY ' '.                                                 00950004
009600     DISPLAY '** MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.          00960004
009700                                                                  00970004
009800     PERFORM S500-SET-WEEK-NBRS.                                  00980001
009900                                                                  00990000
010000     PERFORM S600-SELECT-MAX-WEEK-NBR.                            01000000
010100                                                                  01010000
010200     DISPLAY ' '.                                                 01020004
010300     DISPLAY '** UPDATES COMPLETED    ' PC-PROGRAM-NAME.          01030005
010400                                                                  01040004
010500     GOBACK.                                                      01050000
010600                                                                  01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*  RENUMBER THE SEQUENCE NUMBERS ON THE FORECAST ERROR TABLE FOR *01090001
011000*  FUTURE PROCESSING.  INCREASE EACH SEQUENCE BY 1 AND SET THE   *01100001
011100*  HIGHEST SEQUENCE NUMBER TO 1.                                 *01110001
011200******************************************************************01120000
011300 S500-SET-WEEK-NBRS.                                              01130000
011400                                                                  01140000
011500     EXEC SQL                                                     01150000
011600         UPDATE  TMRISFL                                          01160001
011700            SET  WEEK_NBR = WEEK_NBR + 1                          01170001
011800     END-EXEC.                                                    01180000
011900                                                                  01190000
012000     EVALUATE TRUE                                                01200000
012100       WHEN SQLCODE = ZERO                                        01210001
012200       WHEN SQLCODE = +100                                        01220001
012300         CONTINUE                                                 01230000
012400       WHEN OTHER                                                 01240000
012500         MOVE 'S500-SET-WEEK-NBRS'          TO PV-PARAGRAPH-NAME  01250001
012600         MOVE 'ERROR ON UPDATE OF TMRISFL'  TO PV-DB2-OPERATION   01260001
012700         PERFORM Z999-SQL-ABEND                                   01270001
012800     END-EVALUATE.                                                01280000
012900                                                                  01290000
013000******************************************************************01300000
013100* THIS PARAGRAPH SELECTS THE MAX WEEK NUMBER FOR SEQUENCE NUMBER *01310000
013200* RENUMBERING.                                                   *01320000
013300******************************************************************01330000
013400 S600-SELECT-MAX-WEEK-NBR.                                        01340000
013500                                                                  01350000
013600     EXEC SQL                                                     01360000
013700         SELECT  MAX(WEEK_NBR)                                    01370001
013800           INTO  :MRISFL-WEEK-NBR                                 01380001
013900           FROM  TMRISFL                                          01390001
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200     EVALUATE TRUE                                                01420000
014300       WHEN SQLCODE = ZERO                                        01430001
014400         PERFORM S700-UPDATE-MAX-WEEK-NBR                         01440001
014500       WHEN SQLCODE = +100                                        01450001
014600         CONTINUE                                                 01460001
014700       WHEN OTHER                                                 01470000
014800         MOVE 'S600-SELECT-MAX-WEEK-NBR'    TO PV-PARAGRAPH-NAME  01480001
014900         MOVE 'ERROR ON SELECT OF TMRISFL'  TO PV-DB2-OPERATION   01490001
015000         PERFORM Z999-SQL-ABEND                                   01500001
015100     END-EVALUATE.                                                01510000
015200                                                                  01520000
015300******************************************************************01530000
015400* THIS PARAGRAPH SETS THE MAX WEEK NUMBER TO 1                   *01540000
015500******************************************************************01550000
015600 S700-UPDATE-MAX-WEEK-NBR.                                        01560000
015700                                                                  01570000
015800     EXEC SQL                                                     01580000
015900         UPDATE  TMRISFL                                          01590001
016000            SET  WEEK_NBR = 1                                     01600001
016100          WHERE  WEEK_NBR = :MRISFL-WEEK-NBR                      01610001
016200     END-EXEC.                                                    01620000
016300                                                                  01630000
016400     EVALUATE TRUE                                                01640000
016500       WHEN SQLCODE = ZERO                                        01650001
016600       WHEN SQLCODE = +100                                        01660002
016700         CONTINUE                                                 01670000
016800       WHEN OTHER                                                 01680000
016900         MOVE 'S700-UPDATE-MAX-WEEK-NBR'    TO PV-PARAGRAPH-NAME  01690001
017000         MOVE 'ERROR ON SELECT OF TMRISFL'  TO PV-DB2-OPERATION   01700001
017100         PERFORM Z999-SQL-ABEND                                   01710001
017200     END-EVALUATE.                                                01720000
017300                                                                  01730000
017400******************************************************************01740000
017500* Z999-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      01750001
017600* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 01760000
017700******************************************************************01770000
017800 Z999-SQL-ABEND.                                                  01780001
017900                                                                  01790001
018000     DISPLAY '** ABEND     **'.                                   01800000
018100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                01810004
018200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01820000
018300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               01830000
018400                                                                  01840000
018500******************************************************************01850000
018600* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     01860000
018700* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      01870000
018800******************************************************************01880000
018900     COPY DPPD004.                                                01890000
019000                                                                  01900000
019100     SET AC-DB2-ERROR TO TRUE.                                    01910000
019200     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01920000
019300                                                                  01930000
