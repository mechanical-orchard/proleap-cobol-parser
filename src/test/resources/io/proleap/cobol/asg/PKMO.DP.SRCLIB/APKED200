000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKED200.                                        00020000
000300 AUTHOR.         M WILKINSON.                                     00030000
000400*DATE-WRITTEN.   MAY 16, 1994.                                    00040000
000500*DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700* COBOL II WITH SQL                                             * 00070000
000800*---------------------------------------------------------------* 00080000
000900* TEST EDI INVOICE EDIT PROGRAM                                 * 00090000
001000*---------------------------------------------------------------* 00100000
001100* INPUT:                                                        * 00110000
001200*  1. EXTERNAL ENTERPRISE TABLE                  (TEXTENT)      * 00120000
001300*  2. PEOPLESOFT LOCATION TABLE                  (XFT00017)     * 00130000
001400*  3. TRADING PARTNER TRANSACTION TABLE          (TTRDPRT)      * 00140000
001500*  4. EXTERNAL ENTERPRISE NAME TABLE             (TENTNME)      * 00150000
001600*  5. MERCHANDISE AREA TABLE                     (TMDSEAR)      * 00160000
001700*  6. PO INSTRUCTION TABLE                       (TPOINST)      * 00170000
001800*  7. SPECIAL INSTRUCTIONS CODE TABLE            (TINSTCD)      * 00180000
001900*  8. PURCHASE ORDER TABLE                       (TPURCHS)      * 00190000
002000*  9. PURCHASE ORDER ITEM TABLE                  (TPURITM)      * 00200000
002100* 10. UPC/SKU RELATIONSHIP TABLE                 (TUPCSKU)      * 00210000
002200* 11. TEST EDI TRANSMISSION RECORDS              (APRD050)      * 00220000
002300*                                                               * 00230000
002400* OUTPUT:                                                       * 00240000
002500*  1. VALID EDI TRANSMISSION RECORDS             (APRD055)      * 00250000
002600*  2. REJECTED EDI TRANSMISSION RECORDS          (APRD051)      * 00260000
002700*  3. CONSOLIDATED EDI TRANSMISSION RECORDS      (APRD051)      * 00270000
002800*---------------------------------------------------------------* 00280000
002900* CHANGE LOG:                                                   * 00290000
003000*                                                               * 00300000
003100* 05/16/94    INITIAL VERSION.                                  * 00310000
003200* 08/29/94    BY MARILYN WILKINSON                              * 00320000
003300*             CHANGED LRECL OF REJOUT, AFPOUT, CONS FILES       * 00330000
003400*             TO ACCOMMODATE ADDITIONAL INFORMATION.            * 00340000
003500*                                                               * 00350000
003600* 09/06/94    BY MARILYN WILKINSON                              * 00360000
003700*             ADD CODE TO NOT REJECT ITEM INVOICE QTY OF 0      * 00370000
003800*                                                               * 00380000
003900* 09/21/94    BY MARILYN WILKINSON                              * 00390000
004000*             ADD CODE TO REJECT INVOICE WITH NO STORE.         * 00400000
004100*             ADD CODE TO REJECT INVOICE FOR CONSIGNMENT        * 00410000
004200*                 DEPARTMENT.                                   * 00420000
004300*             ADD CODE TO INITIALIZE ALL TABLES IN HOUSE        * 00430000
004400*                 KEEPING.                                      * 00440000
004500*             CHANGE CODE FOR STORE SELECT TO LOOK AT PO        * 00450000
004600*                 DATE FOR 'CURRENT' SO THAT STORES THAT        * 00460000
004700*                 WILL BE OPENING CAN BE INVOICED               * 00470000
004800*             REMOVE CHECK FOR ALLW/CHRG METHOD TYPE            * 00480000
004900* 08/15/95    COMMENTED OUT THE EDIT FOR CHARGE PCT/TOTAL       * 00490000
005000*             OVER CNTL LIMIT (49).                             * 00500000
005100*             THESE CHANGES WERE MADE ON 081595 AND HAVE        * 00510000
005200*             THIS DATE AFTER THE COMMENT IN THE CODE           * 00520000
005300*             -JOHN OBERHAUSER -CPU                             * 00530000
005400* 06/26/96    ADDED LOGIC IN R300-SELECT-TSTR000 TO ACCEPT      * 00540000
005500*             'CS' (CENTRAL STOCK) AS A VALID STORE TYPE TO     * 00550000
005600*             BE HANDLED LIKE A STORE, NOT A DC.                * 00560000
005700*             -DARYL WOELFEL        P16013                      * 00570000
005800* 09/04/96    CHANGED TRDPRT_CSR TO SELECT OF INACTV_DTE        * 00580000
005900*             TO ORDER BY INVACTV_DTE DESC.                     * 00590000
006000*             -MARILYN WILKINSON    P37290                      * 00600000
006100* 09/24/96    CHANGED TRDPRT_CSR - WHERE CURRENT DATE <=        * 00610000
006200*             INACTV_DTE                                        * 00620000
006300*             BY INACTV_DTE DESC.                               * 00630000
006400*             - MARILYN WILKINSON              P37290           * 00640000
006500* 04/29/97    BY MARILYN WILKINSON                              * 00650000
006600*             CHANGED CONSIGNMENT LOGIC. ALLOW 'CN'             * 00660000
006700*             PO-TYP-CDE TO PROCESS.  ONLY DEPT 127 IS TO       * 00670000
006800*             BE CONSIDERED AS CONSIGNMENT.                     * 00680000
006900* 09/16/97    ADDED CODE THAT WILL PRINT A 'NO DATA TO          * 00690000
007000*             REPORT FOR THIS RUN' MESSAGE ON THE REPORT        * 00700000
007100*             WHEN THE FILE IS EMPTY.                           * 00710000
007200*             - MIKE BESKE                    WR3807            * 00720000
007300*                                                               * 00730000
007400* 02/03/98   ROBIN BERNOSKI                WR/IR #: WR5703      * 00740000
007500*            - MODIFIED THE MANNER IN WHICH THE STANDARD        * 00750000
007600*              DATE ROUTINE, DPKUT500, IS TO BE CALLED          * 00760000
007700*              WITHIN A PROGRAM SO THAT THE CALL IS             * 00770000
007800*              DYNAMIC.                                         * 00780000
007900*                                                               * 00790000
008000* 08/17/98   CAROLYN GIFFORD               WR/IR #: 10199       * 00800000
008100*            - REMOVED CONSIGNMENT PROCESSING FOR               * 00810000
008200*              DEPARTMENT #127.                                 * 00820000
008300*                                                               * 00830000
008400* 09/01/98    CAROLYN GIFFORD               WR# 6041            * 00840000
008500*             Y2K CHANGES. MOVE ZEROES TO WS-CENTURY FIELD.     * 00850000
008600*             SEPARATE WS-YYMMDD DATE TO YY MM DD FIELDS.       * 00860000
008700*             ADD WINDOWING LOGIC IN DATE CHECK PARAGRAPH       * 00870000
008800*             E400-CHECK-DATE TO CALCULATE CENTURY BASED ON     * 00880000
008900*             WS-YY.                                            * 00890000
009000*                                                               * 00900000
009100* 12/08/1999 JILL JUEL                      WR/IR #: WR6041     * 00910000
009200*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO        * 00920000
009300*              CONFORM WITH Y2K STANDARDS BY ADDING             * 00930000
009400*              DPG54-WARNING-ERROR.                             * 00940000
009500*                                                               * 00950000
009600*                                                               * 00960000
009700* 01/13/2000 ROBIN BERNOSKI                 WR/IR#: WR20721     * 00970000
009800*            - MODIFIED PARAGRAPHS E200 AND E300.  IN E200      * 00980000
009900*              THE ORIGNINAL COMPUTE STATEMENT FOR THE          * 00990000
010000*              WS-DETAIL-ALLW-AMT WAS REPLACED WITH THE         * 01000000
010100*              ADD STATEMENT ACCUMULATING THE ALLOWANCE/        * 01010000
010200*              CHARGE.  THIS COMPUTE STATEMENT WAS THEN         * 01020000
010300*              PLACED IN E300 USING THESE NEW ACCUMULATING      * 01030000
010400*              FIELDS AND THE GROSS COST CALCULATED FROM        * 01040000
010500*              THE DETAIL LINES.                                * 01050000
010600*                                                               * 01060000
010700* 01/21/2000 JILL JUEL                      WR#: 20724          * 01070000
010800*            - ADDED THE INTERCHG-CNTL-NBR TO THE REJECT        * 01080000
010900*              FILE IN THE AP051-ADDITIONAL-AREA, SO THAT       * 01090000
011000*              IT CAN BE DISPLAYED ON THE EDI REJECTION         * 01100000
011100*              REPORT. ADDED THE WORKING STORAGE FIELD          * 01110000
011200*              WS-SAVE-INTERCHG-CNTL-NBR.                       * 01120000
011300*                                                               * 01130000
011400* 02/02/2000 JILL JUEL                      WR#: 20626          * 01140000
011500*            - RECOMPILED PROGRAM. CHANGES WERE MADE TO         * 01150000
011600*              APRD050, APRD051, APRD052, AND APRD056 BY        * 01160000
011700*              THE EDI TEAM.                                    * 01170000
011800*                                                               * 01180000
011900* 07/11/2000 JILL JUEL                      WR#: 20903          * 01190000
012000*            REMOVED THE INVALID SKU CHECK. REMOVED ALL         * 01200000
012100*            THE COMMENTED OUT LINES AND CODE FOR FILES         * 01210000
012200*            NOT BEING USED.                                    * 01220000
012300*                                                               * 01230000
012400* 12/12/2000 NANCY EILBES                   WR#: 20224          * 01240000
012500*            IN PARAGRAPH W200-WRITE-AFP ADDED NEW VALUES       * 01250000
012600*            FOR ALLOWANCE/CHARGE CODES FOR 'MOS', 'ADV'        * 01260000
012700*            AND 'TRD'.                                         * 01270000
012800*                                                               * 01280000
012900* 08/07/2001 MARK BURNSIDE                 WR#:                 * 01290000
013000*            MODIFIED THE FIELDS PV-ACCUM-ALLW,                 * 01300000
013100*            PV-ACCUM-CHRG, PV-ACCUM-ALLW-PCT, AND              * 01310000
013200*            PV-ACCUM-CHRG-PCT FIELDS TO ADD/INCREASE           * 01320000
013300*            THE NUMBER OF DIGITS AFTER THE DECIMAL POINT       * 01330000
013400*            TO HANDLE VALUES LESS THAN ONE WHOLE PERCENT.      * 01340000
013500*                                                               * 01350000
013600* 08/22/2001 KEVIN CATLIN                  WR#:                 * 01360000
013700*            REPLACED WS-DETAIL-ALLW-CHRG-AMT WITH              * 01370000
013800*            WS-DETAIL-ALLW-AMT AND WS-DETAIL-CHRG-AMT          * 01380000
013900*            IN CALCULATING WS-DETAIL-GROSS-INVOICE-AMT         * 01390000
014000*            IN PARAGRAPH W300.                                 * 01400000
014100*                                                               * 01410000
014200* 10/01/2001 MIKE BESKE                    WR#:20704            * 01420000
014300*            CORRECTED E200- TO USE THE FOLLOWING FIELDS,       * 01430000
014400*            WS-DETAIL-ALLW-AMT AND WS-DETAIL-CHRG-AMT,         * 01440000
014500*            IN CALCULATING THEIR RESPECTIVE TOTALS WHEN THE    * 01450000
014600*            RECORD TYPE = 05.                                  * 01460000
014700*                                                               * 01470000
014800* 08/08/2002 COLBY HANGER EXPENSE PROCESSING.  RECOMPILE FROM   * 01480000
014900*            PRODUCTION TO INCORPORATE COPYBOOK CHANGES.        * 01490000
015000*        BY: KEVIN CATLIN                   WR#: 23254          * 01500000
015100*                                                               * 01510000
015200* 09/19/2002 COLBY HANGER EXPENSE PROCESSING.  ADD HANGER       * 01520000
015300*            PROCESSING FOR '05' RECORD TO REFLECT PRODUCTION   * 01530000
015400*            CHANGES.  PARAGRAPH MODIFIED IS E200.              * 01540000
015500*        BY: KEVIN CATLIN                   WR#: 22902          * 01550000
015600*                                                               * 01560000
015700* 09/26/2002 TO AVOID AP050-QUANTITY-INVOICED FROM NOT BEING A  * 01570000
015800*            WHOLE NUMBER, IT WILL BE MOVED TO                  * 01580000
015900*            WS-QUANTITY-INVOICED (WHICH IS A WHOLE NUMBER      * 01590000
016000*            FIELD) IN CALCULATING THE DIFFERENCE BETWEEN       * 01600000
016100*            GROSS-INVOICE-AMT AND DETAIL-GROSS-INVOICE-AMT.    * 01610000
016200*            THIS WILL CAUSE INVOICES SENT WITH NON-WHOLE       * 01620000
016300*            NUMBERS IN THIS FIELD TO REJECT WITH ERROR CODE 36.* 01630000
016400*        BY: KEVIN CATLIN                WR/IR #: P000496641    * 01640000
016500*                                                               * 01650000
016600* 10/16/2002                                                    * 01660000
016700*    COLBY HANGER PROCESSING CHANGE.  ADDED CHECK FOR '05'      * 01670000
016800*    RECORD IN PARA B100.  IF ALLW-CHG-TYPE = 'N', THE RECORD   * 01680000
016900*    WILL NOT BE LOADED AND EDITED.  THIS REFLECTS HOW PROGRAM  * 01690000
017000*    APKED201 PROCESSES EDI INVOICES IN PRODCUTION.             * 01700000
017100* MADE BY: KEVIN CATLIN                WR/IR #: WR23750         * 01710000
017200*                                                               * 01720000
017300* DATE  03/25/2003                                              * 01730000
017400*     CHANGE MADE: INCREASED SIZE OF INTERNAL TABLES TO REFLECT * 01740000
017500*     PRODUCTION SIZE FOR TEST EDI INVOICES.                    * 01750000
017600*     MADE BY: KEVIN CATLIN            WR/IR #: PM00535572      * 01760000
017700*                                                               * 01770000
017800* DATE  05/13/2003                                              * 01780000
017900*     CHANGE MADE: NI-SKU PROJECT.                              * 01790000
018000*     REMOVED THE FOLLOWING PARAGRAPHS: R475- R500-.     MODI-  * 01800000
018100*     FIED CODE INVOLVING SKU: REMOVED SKU BREAKDOWN OF DEPT/   * 01810000
018200*     CLASS/SEQ, REMOVED SEVERAL VALIDATION CHECKS FROM E200-   * 01820000
018300*     INVOLVING VALID SKU & FILLING INFO FOR MISSING SKU RELATED* 01830000
018400*     DATA FROM VENDOR DATA XMITTED VIA EDI, ONLY KEPT THE SEL- * 01840000
018500*     ECTION OF PO LINE NBR IN PARAGRAPHS R450- & R485- AND RE- * 01850000
018600*     MOVED THE KOHLS-SKU MOVE IN W250-. REMOVED TSK TABLE.     * 01860000
018700*     MADE BY: MIKE BESKE              WR/IR #: WR22557         * 01870000
018800*                                                               * 01880000
018900* DATE  07/10/2003                                              * 01890000
019000*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                 * 01900000
019100*     ADDED CODE TO PROCESS COMPOUND PREPACK EDI RECORDS. THIS  * 01910000
019200*     INCLUDES CREATING PARA E600-.  THIS PARAGRAPH CHECKS FOR  * 01920000
019300*     ANY WARNING INDICATORS THAT WERE SET ON THE 07 REC WITH   * 01930000
019400*     'AS' AS A UNIT MEASURE VALUE.  WHEN ANY OF THEM ARE SET   * 01940000
019500*     THESE ARE TO BE WRITTEN TO THE ERROR REPORT FILE.  WHEN   * 01950000
019600*     CERTAIN ONES ARE SET THEN THE INVOICE SHOULD ALSO BE      * 01960000
019700*     WRITTEN TO THE AFP OUTPUT FILE TO APPEAR ON THE TEST EDI  * 01970000
019800*     INVOICES CREATED IN APK017.  THE 07 'AS' RECORD WON'T     * 01980000
019900*     WRITTEN TO THE AFP OUTPUT FILE BUT IT WILL BE WRITTEN TO  * 01990000
020000*     THE ERROR REPORT FILE IF THE ENTIRE INVOICE IS SUPPOSED   * 02000000
020100*     TO GO TO EITHER ONE OF THE FILES.                         * 02010000
020200*     MADE BY: MIKE BESKE              WR/IR #: WR24658         * 02020000
020300*                                                               * 02030000
020400* DATE  08/27/2003                                              * 02040000
020500*     CHANGE MADE: ADDED CODE TO PROCESS COLBY PREPACKS WITH    * 02050000
020600*     HANGER CHARGES CORRECTLY.  THE HANGER CHARGE IS ALREADY   * 02060000
020700*     IMBEDDED AS PART OF CALCULATED DETAIL AMOUNT.  THE NEW    * 02070000
020800*     CODE WILL SAVE OFF THE HANGER CHARGE FOR ANY COLBY PRE-   * 02080000
020900*     PACKS THAT ARE BEING PROCESSED.  IN PARA E300-EDIT-ALL,   * 02090000
021000*     THE SAVED COLBY HANGER CHARGE WILL BE SUBTRACTED OUT OF   * 02100000
021100*     THE TOTAL DETAIL CHARGE AMOUNT BEFORE IT IS USED TO       * 02110000
021200*     COMPUTE THE CALCULATED DETAIL AMOUNT WHICH WILL THEN BE   * 02120000
021300*     COMPARED TO THE SENT GROSS INVOICE AMOUNT IN THE 06 REC   * 02130000
021400*     TYPE.                                                     * 02140000
021500*     MADE BY: MIKE BESKE              WR/IR #: WR24481         * 02150000
021600*                                                               * 02160000
021700* DATE  10/03/2003                                              * 02170000
021800*     CHANGE MADE: COMMENTED OUT CODE REFERRING TO THE 88       * 02180000
021900*     LEVELS OF WS-PI-WARNING3-WS. THIS VARIABLE IS ASSOCIATED  * 02190000
022000*     WITH THE ERROR IND AP050-UPC-CANT-EXPLODE-IND.  WHEN THE  * 02200000
022100*     VALUE OF THE ERROR IND = 'Y', THEN THE ENTIRE INVOICE     * 02210000
022200*     WILL BE REJECTED.  THIS WILL STOP AN INVOICE FROM BEING   * 02220000
022300*     LOADED WRITTEN TO THE AFP OUTPUT FILE.                    * 02230000
022400*     MADE BY: MIKE BESKE              WR/IR #: WR25850         * 02240000
022500*                                                               * 02250000
022600* DATE  03/29/2004                                              * 02260000
022700*     CHANGE MADE: INCREASED THE SIZE OF VARIOUS W/S STORE      * 02270000
022800*     FIELDS FROM A SIZE OF 3 TO 5 BYTES.  REMOVED TSTR000 AND  * 02280000
022900*     ADDED XFT00003 AS REPLACEMENT TABLE.                      * 02290000
023000*     RECODED PARAS R300- AND R350- TO USE THE NEWLY ADDED      * 02300000
023100*     TABLES.                                                   * 02310000
023200*     MADE BY: MIKE BESKE              WR/IR #: WR25805         * 02320000
023300*                                                               * 02330000
023400* DATE  09/30/2004                                              * 02340000
023500*     CHANGE MADE: ADDED PARAGRAPH U100 TO COMMIT AFTER EACH    * 02350000
023600*     SELECT FROM THE XFT_LOC TABLE.  THIS WILL PREVENT THE     * 02360000
023700*     THREAD BEING LOST IN THE DB3P SUBSYSTEM.                  * 02370000
023800*     MADE BY: KEVIN CATLIN            WR/IR #: PM00690867      * 02380000
023900*                                                               * 02390000
024000* DATE  01/21/2005                                              * 02400000
024100*     CHANGE MADE: MODIFIED STORE VALIDATION SO THAT 'DE' IS A  * 02410000
024200*     VALID STORE TYPE - PARAGRAPHS R300 AND R350 AND LOCATION  * 02420000
024300*     CURSOR.                                                   * 02430000
024400*     MADE BY: NANCY EILBES            WR/IR #: WR28188         * 02440000
024500*                                                               * 02450000
024600* DATE  03/11/2007                                              * 02460000
024700*     CHANGE MADE: MATCH BY DC -- ADDED 'NA' (CORPORATE NOT     * 02470000
024800*     ALLOCATED) AS AN ACCEPTABLE XFT00003-LOC-TYP-CDE TO       * 02480000
024900*     PARAGRAPHS R300-VALIDATE-STORE1 AND R350-VALIDATE-STORE2. * 02490000
025000*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578         * 02500000
025100*                                                               * 02510000
025200* DATE  03/27/2007                                              * 02520000
025300*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE     * 02530000
025400*     CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.       * 02540000
025500*     MADE BY: KEVIN CATLIN            WR/IR #: WR31452         * 02550000
025600*                                                               * 02560000
025700* DATE  04/23/2007                                              * 02570000
025800*     CHANGE MADE: CHANGED THE FOLLOWING FIELDS TO REFER TO     * 02580000
025900*     LI & FUNG INSTEAD OF COLBY: WS-VENDOR-IS-COLBY,           * 02590000
026000*     WS-COLBY-HANGER-AMT, WS-COLBY-PREPACK-SW,                 * 02600000
026100*     COLBY-PREPACK-FOUND, AND COLBY-PREPACK-NOT-FOUND.         * 02610000
026200*     MADE BY: KRYSTEN LEARY           WR/IR #: WR26018         * 02620000
026300*                                                               * 02630000
026400* DATE  05/16/2007                                              * 02640000
026500*     CHANGE MADE: RECOMPILED TO PICK UP APWS050 MODIFICATION.  * 02650000
026600*     MADE BY: MIKE BESKE              WR/IR #: P001021023      * 02660000
026700*                                                               * 02670000
026800* DATE  12/19/2007                                               *02680000
026900*     CHANGE MADE: MODIFIED CODE TO NO LONGER ABEND PROGRAM WHEN *02690000
027000*     THE WS-INVOICE-TABLE LIMIT (10998) IS PASSED. THIS IS NOW  *02700000
027100*     CONSIDERED AN ERROR CONDITION (ERROR CODE 75). THE         *02710000
027200*     WAY AN INVOICE THAT HAS TOO MANY LINES (> 10998) IS WRITTEN*02720000
027300*     TO THE REJECT FILE IS DIFFERENT FROM ALL OTHER ERRORS.     *02730000
027400*     BECAUSE OF THE EXCESSIVE AMOUNT OF INVOICE LINES FOR THIS  *02740000
027500*     SITUATION ONLY ONE DETAIL RECORD (REC TYPE 07) WILL BE     *02750000
027600*     WRITTEN TO THE REJECT FILE. ALSO THE NUMBER OF INVC        *02760000
027700*     LINES IS TOTALED AND MOVED TO A NEW FIELD ON THE APRD051   *02770000
027800*     COPYBOOK.  THIS TOTAL WILL BE DISPLAYED WITH THE ERROR MES-*02780000
027900*     SAGE LATER ON IN THE ERROR REPORT PROGAM.  ADDED MISSING   *02790000
028000*     END-IF STMTS AS THEY WERE ENCOUNTERED WHILE MODIFYING CODE *02800000
028100*     FOR ERROR CODE 75 IMPLEMENTATION. UPDATED VARIOUS COMMENTS *02810000
028200*     REFERRING TO THE VALUE OF INV-INDX THROUGHOUT THE PROGRAM  *02820000
028300*     TO MATCH AS 10998 OR 11000. THIS WILL MAKE ANY FUTURE      *02830000
028400*     CHANGES TO THE SIZE OF WS-INVOICE-TABLE EASIER AND UNIFORM.*02840000
028500*     MOD PARAS: A100- B200- B300- H200- R125- R150- W300- Z900- *02850000
028600*     MADE BY: MIKE BESKE              WR/IR #: WR31187          *02860000
028700*                                                               * 02870000
028800*   DATE  08/02/2011                                            * 02880000
028900*   MODIFY PROGRAM TO REFERENCE THE NEW DOMAIN TABLE IN DB2     * 02890000
029000*   INSTEAD OF REFERENCING THE DB3P DOMAIN TABLES AS DB3P IS    * 02900000
029100*   GOING AWAY.  THIS IS PART OF THE PEOPLESOFT FINANCIALS      * 02910000
029200*   UPGRADE PROJECT AND RE-PLATFORM TO ORACLE.                  * 02920000
029300*   CHANGE OF FINANCE DOMAIN TABLE FOR LOCATION INFORMATION     * 02930000
029400*      FI_XFT_LOC  --> XFT_LOC(XFT00017)                        * 02940000
029500*      MADE BY : ANIL (CTS)          WR/IR  #: W37038           * 02950000
029600*                                                               * 02951001
029700*   DATE  10/17/2014                                            * 02952001
029800*   CHANGE MADE: PO EXTENDED DIGIT CHANGES.                     * 02953001
029900*      EXTENDED PO# FROM 7 TO 9                                 * 02954001
030000*      MADE BY: COGNIZANT               WR/IR #: CHG0094517     * 02955001
030001*                                                               * 02956001
029700*   DATE  03/16/2023                                            * 02958012
029800*   CHANGE MADE: RECOMPILE FOR UPDATED COPYBOOKS APWS050 &      * 02959006
029800*                APRD051                                        * 02960006
029800*                ACCOUNT FOR INFOR NEXUS INVOICES               * 02960110
030000*      MADE BY: JEAN KURK               WR/IR #: CHG0285404     * 02961012
030002***************************************************************** 02970000
030003                                                                  02980000
030004 ENVIRONMENT DIVISION.                                            02990000
030005 INPUT-OUTPUT SECTION.                                            03000000
030100                                                                  03010000
030200 FILE-CONTROL.                                                    03020000
030300                                                                  03030000
030400     SELECT EDIIN-AP050-FILE        ASSIGN TO UT-S-INP01.         03040000
030500     SELECT REJOUT-AP051-FILE       ASSIGN TO UT-S-OUT02.         03050000
030600     SELECT AFPOUT-AP055-FILE       ASSIGN TO UT-S-OUT03.         03060000
030700     SELECT EDIOUT-AP051-CONS-FILE  ASSIGN TO UT-S-OUT04.         03070000
030800                                                                  03080000
030900 DATA DIVISION.                                                   03090000
031000 FILE SECTION.                                                    03100000
031100                                                                  03110000
031200 FD  EDIIN-AP050-FILE                                             03120000
031300         LABEL RECORDS  ARE STANDARD                              03130000
031400         RECORDING MODE IS  F                                     03140000
031500         DATA RECORD    IS  EDIIN-AP050-RECORD.                   03150000
031600 01  EDIIN-AP050-RECORD            PIC X(350).                    03160000
031700                                                                  03170000
031800 FD  REJOUT-AP051-FILE                                            03180000
031900         LABEL RECORDS  ARE STANDARD                              03190000
032000         RECORDING MODE IS  F                                     03200000
032100         DATA RECORD    IS  REJOUT-AP051-RECORD.                  03210000
032200 01  REJOUT-AP051-RECORD           PIC X(500).                    03220000
032300                                                                  03230000
032400 FD  AFPOUT-AP055-FILE                                            03240000
032500         LABEL RECORDS  ARE STANDARD                              03250000
032600         RECORDING MODE IS  F                                     03260000
032700         DATA RECORD    IS  AFPOUT-AP055-RECORD.                  03270000
032800 01  AFPOUT-AP055-RECORD           PIC X(800).                    03280000
032900                                                                  03290000
033000 FD  EDIOUT-AP051-CONS-FILE                                       03300000
033100         LABEL RECORDS  ARE STANDARD                              03310000
033200         RECORDING MODE IS  F                                     03320000
033300         DATA RECORD    IS  EDIOUT-CONS-RECORD.                   03330000
033400 01  EDIOUT-CONS-RECORD            PIC X(500).                    03340000
033500                                                                  03350000
033600 WORKING-STORAGE SECTION.                                         03360000
033700                                                                  03370000
033800 01  FILLER                        PIC X(25) VALUE                03380000
033900                             'WS FOR APKED200 BEGINS==>'.         03390000
034000 01  ABEND-CODE                    PIC S9(4) COMP SYNC            03400000
034100                                             VALUE ZEROS.         03410000
034200     88 AP-TABLE-FULL              VALUE +4004.                   03420000
034300     88 AP-EMPTY-FILE              VALUE +4005.                   03430000
034400     88 PO-TABLE-FULL              VALUE +4006.                   03440000
034500     88 AP-DB2-ERROR               VALUE +4013.                   03450000
034600                                                                  03460000
034700 01  ALLW-INDX                     PIC S9(4) COMP VALUE ZERO.     03470000
034800                                                                  03480000
034900 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     03490000
035000 01  WS-ABEND-FIELDS.                                             03500000
035100     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKED200'. 03510000
035200     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     03520000
035300     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     03530000
035400     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     03540000
035500     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     03550000
035600     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     03560000
035700                                                                  03570000
035800     05  WS-STYLE.                                                03580000
035900         10  WS-STYLE-AREA             OCCURS 20 TIMES            03590000
036000                                       INDEXED BY STYLE-INDX.     03600000
036100             15  WS-STYLE-ONE          PIC X(01).                 03610000
036200     05  WS-STYLE2                     PIC X(20).                 03620000
036300     05  WS-STYLE2-RDF REDEFINES WS-STYLE2.                       03630000
036400         10  WS-STYLE2-AREA            OCCURS 20 TIMES            03640000
036500                                       INDEXED BY STYLE-INDX2.    03650000
036600             15  WS-STYLE2-ONE         PIC X(01).                 03660000
036700                                                                  03670000
036800     05  WS-EAN-UPC              PIC X(13)  VALUE SPACES.         03680000
036900     05  WS-EAN-UPC-EDITTED      PIC X(16)  VALUE SPACES.         03690000
037000     05  WS-AP055-STORE          PIC X(05)  VALUE '00000'.        03700000
037100     05  WS-SAVE-STORE-NBR       PIC X(05)  VALUE SPACES.         03710000
037200     05  WS-SAVE-STORE-NBR2      PIC X(05)  VALUE SPACES.         03720000
037300     05  WS-SAVE-STORE-NBR-9     PIC S9(4)  COMP VALUE 0.         03730000
037400     05  WS-SAVE-STORE-NBR2-9    PIC S9(4)  COMP VALUE 0.         03740000
037500     05  WS-SAVE-STORE-NBR-9-UNPK  PIC S9(4) VALUE 0.             03750000
037600     05  WS-SAVE-STORE-NBR2-9-UNPK PIC S9(4) VALUE 0.             03760000
037700                                                                  03770000
037800     05  WS-VND-NMBR-9S          PIC 9(09)  VALUE ZEROS.          03780000
037900     05  WS-VND-NMBR-X REDEFINES WS-VND-NMBR-9S PIC X(09).        03790000
038000                                                                  03800000
038100     05  WS-ITEM-SEQ             PIC 9(03)  VALUE ZEROS.          03810000
038200     05  WS-PAGE-NO              PIC 9(05)  VALUE ZEROS.          03820000
038300     05  WS-EDITTED-PAGE-NO      PIC ZZZZ9.                       03830000
038400     05  WS-EDIT-PO-NMBR         PIC ZZZZZZZZ9.                   03840001
038400     05  WS-PO-TYP-CDE           PIC X(02).                       03841008
038500                                                                  03850000
038600     05  WS-DATE.                                                 03860000
038700         10  WS-DATE-MM          PIC X(02)  VALUE SPACES.         03870000
038800         10  FILLER              PIC X(01)  VALUE '/'.            03880000
038900         10  WS-DATE-DD          PIC X(02)  VALUE SPACES.         03890000
039000         10  FILLER              PIC X(01)  VALUE '/'.            03900000
039100         10  WS-DATE-YY          PIC X(02)  VALUE SPACES.         03910000
039200                                                                  03920000
039300     05  WS-CHECK-BASIS-DTE-CODE PIC X(02)  VALUE SPACES.         03930000
039400                                                                  03940000
039500     05  WS-SAVE-INVOICE-NBR     PIC X(22)  VALUE SPACES.         03950000
039600     05  WS-SAVE-EDI-SEQ-NBR     PIC X(05)  VALUE SPACES.         03960000
039700                                                                  03970000
039800     05  WS-SAVE-PO-NBR          PIC 9(09)  VALUE ZEROS.          03980001
039900     05  WS-SAVE-PO-NBR-X REDEFINES WS-SAVE-PO-NBR PIC X(09).     03990001
040000                                                                  04000000
040100     05  WS-SAVE-PO-NBR-COMP     PIC S9(9)  COMP                  04010000
040200                                            VALUE ZEROS.          04020000
040300     05  WS-QUANTITY-INVOICED    PIC S9(6)V VALUE ZEROS.          04030000
040400                                                                  04040000
040500     05  WS-SAVE-PO-INV-NBR      PIC X(31)  VALUE SPACES.         04050001
040600                                                                  04060000
040700     05  WS-SAVE-INVOICE-DATE    PIC X(06)  VALUE '000000'.       04070000
040800     05  WS-SAVE-INV-DATE  REDEFINES WS-SAVE-INVOICE-DATE.        04080000
040900         10  WS-SAVE-INV-YY      PIC X(02).                       04090000
041000         10  WS-SAVE-INV-MM      PIC X(02).                       04100000
041100         10  WS-SAVE-INV-DD      PIC X(02).                       04110000
041200     05  WS-SAVE-SHIPPED-DATE    PIC X(06)  VALUE '000000'.       04120000
041300     05  WS-SAVE-SHIP-DATE REDEFINES WS-SAVE-SHIPPED-DATE.        04130000
041400         10  WS-SAVE-SHIP-YY     PIC X(02).                       04140000
041500         10  WS-SAVE-SHIP-MM     PIC X(02).                       04150000
041600         10  WS-SAVE-SHIP-DD     PIC X(02).                       04160000
041700     05  WS-SAVE-EFFECTIVE-DATE  PIC X(06)  VALUE '000000'.       04170000
041800     05  WS-SAVE-EFF-DATE REDEFINES WS-SAVE-EFFECTIVE-DATE.       04180000
041900         10  WS-SAVE-EFF-YY      PIC X(02).                       04190000
042000         10  WS-SAVE-EFF-MM      PIC X(02).                       04200000
042100         10  WS-SAVE-EFF-DD      PIC X(02).                       04210000
042200                                                                  04220000
042300     05  WS-SAVE-GROSS-INVOICE-AMT   PIC S9(08)V99 VALUE          04230000
042400                                                  ZEROS.          04240000
042500     05  WS-SAVE-INTERCHG-CNTL-NBR   PIC X(09) VALUE SPACES.      04250000
042600     05  WS-DETAIL-GROSS-INVOICE-AMT PIC S9(09)V99 VALUE          04260000
042700                                                  ZEROS.          04270000
042800     05  WS-DETAIL-ALLW-CHRG-AMT     PIC S9(09)V99 VALUE          04280000
042900                                                  ZEROS.          04290000
043000     05  WS-DIFFERENCE               PIC S9(08)V99 VALUE 0.       04300000
043100     05  WS-DETAIL-TOT-UNITS         PIC S9(08)V99 VALUE          04310000
043200                                                  ZEROS.          04320000
043300     05  WS-DETAIL-ALLW-AMT          PIC S9(08)V99 VALUE ZEROS.   04330000
043400     05  WS-DETAIL-CHRG-AMT          PIC S9(08)V99 VALUE ZEROS.   04340000
043500     05  WS-LI-FUNG-HANGER-AMT       PIC S9(08)V99 VALUE ZEROS.   04350000
043600                                                                  04360000
043700     05  WS-CALC-EXTEN-INVOICE-AMT   PIC S9(08)V99 VALUE          04370000
043800                                                  ZEROS.          04380000
043900                                                                  04390000
044000     05  WS-LAST-REC-TYPE            PIC X(02)   VALUE SPACES.    04400000
044100                                                                  04410000
044200     05  WS-DATE-INVALID         PIC  X(1) VALUE SPACE.           04420000
044300         88  WS-VALID-DATE                 VALUE 'Y'.             04430000
044400         88  WS-NOT-VALID-DATE             VALUE 'N'.             04440000
044500                                                                  04450000
044600     05  WS-DISC-DAYS-DUE        PIC S9(5) VALUE ZERO.            04460000
044700                                                                  04470000
044800     05  WS-CCYYMMDD.                                             04480000
044900         10  WS-CENTURY          PIC X(02) VALUE '00'.            04490000
045000         10  WS-YYMMDD.                                           04500000
045100             15 WS-YY            PIC X(02) VALUE '00'.            04510000
045200             15 WS-MM            PIC X(02) VALUE '00'.            04520000
045300             15 WS-DD            PIC X(02) VALUE '00'.            04530000
045400                                                                  04540000
045500     05  WS-UPC-CODE             PIC 9(12) VALUE ZEROS.           04550000
045600     05  WS-UPC-CODE-COMP3       PIC S9(15) COMP-3                04560000
045700                                            VALUE ZEROS.          04570000
045800                                                                  04580000
045900     05  WS-DUN-NBR-9S           PIC  9(09) VALUE ZEROS.          04590000
046000     05  WS-DUN-NBR-X  REDEFINES WS-DUN-NBR-9S PIC X(09).         04600000
046100         88  WS-VENDOR-IS-LI-FUNG VALUE '009206194'.              04610000
046200                                                                  04620000
046300     05  WS-DOL-13               PIC $$,$$$,$$$.99.               04630000
046400     05  WS-DOL-14-2DEC          PIC $$$,$$$,$$$.99.              04640000
046500     05  WS-EDIT-3               PIC ZZZ.                         04650000
046600     05  WS-EDIT-10              PIC ZZZZZZZ.99.                  04660000
046700     05  WS-EDIT-10-NODEC        PIC ZZZZZZZZ9-.                  04670000
046800     05  WS-EDIT-14              PIC ZZZ,ZZZ,ZZZ.99.              04680000
046900     05  WS-PCT-14.                                               04690000
047000         10  FILLER              PIC X(03) VALUE SPACES.          04700000
047100         10  WS-PCT-11.                                           04710000
047200             15  FILLER          PIC X(04) VALUE SPACES.          04720000
047300             15  WS-PCT-6        PIC ZZZ.99.                      04730000
047400             15  FILLER          PIC X(01) VALUE '%'.             04740000
096100     05  WS-VEND-INCHG-ID            PIC X(15)     VALUE SPACES.  04743010
096300         88 WS-INFOCHAIN                 VALUE 'INFOCHAIN'.       04744010
047500                                                                  04750000
047600*--------------------------------------------------------------*  04760000
047700* GREGORIAN/JULIAN DATE CONVERSION                             *  04770000
047800*--------------------------------------------------------------*  04780000
047900     COPY DPWS500.                                                04790000
048000                                                                  04800000
048100 01  WS-PROGRAM-COUNTERS.                                         04810000
048200     05  WS-EDIIN-REC-CNT        PIC 9(9)  VALUE ZEROS.           04820000
048300     05  WS-EDIOUT4-REC-CNT      PIC 9(9)  VALUE ZEROS.           04830000
048400     05  WS-REJOUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           04840000
048500     05  WS-AFPOUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           04850000
048600     05  WS-TOT-INVC-LINES       PIC 9(8)  VALUE ZEROS.           04860000
048700                                                                  04870000
048800 01  WS-INVOICE-COUNTERS.                                         04880000
048900     05  WS-TOT-REC-CNT          PIC 9(03) VALUE ZEROS.           04890000
049000     05  WS-REC-01-CNT           PIC 9(3)  VALUE ZEROS.           04900000
049100     05  WS-REC-02-CNT           PIC 9(3)  VALUE ZEROS.           04910000
049200     05  WS-REC-03-CNT           PIC 9(3)  VALUE ZEROS.           04920000
049300     05  WS-REC-04-CNT           PIC 9(3)  VALUE ZEROS.           04930000
049400     05  WS-REC-05-CNT           PIC 9(3)  VALUE ZEROS.           04940000
049500     05  WS-REC-06-CNT           PIC 9(3)  VALUE ZEROS.           04950000
049600     05  WS-REC-07-CNT           PIC 9(7)  VALUE ZEROS.           04960000
049700     05  WS-REC-OTHER-CNT        PIC 9(3)  VALUE ZEROS.           04970000
049800                                                                  04980000
049900 01  WS-SWITCHES.                                                 04990000
050000     05  WS-ERROR-SW             PIC X(01) VALUE 'N'.             05000000
050100         88  ERROR-EDI                     VALUE 'Y'.             05010000
050200         88  NO-EDI-ERROR                  VALUE 'N'.             05020000
050300     05  WS-PI-WARNING1-WS       PIC X(01) VALUE 'N'.             05030000
050400         88  NO-PI-WARNING1                VALUE 'N'.             05040000
050500         88  PI-WARNING1-EXISTS            VALUE 'Y'.             05050000
050600     05  WS-PI-WARNING2-WS       PIC X(01) VALUE 'N'.             05060000
050700         88  NO-PI-WARNING2                VALUE 'N'.             05070000
050800         88  PI-WARNING2-EXISTS            VALUE 'Y'.             05080000
050900*    05  WS-PI-WARNING3-WS       PIC X(01) VALUE 'N'.             05090000
051000*        88  NO-PI-WARNING3                VALUE 'N'.             05100000
051100*        88  PI-WARNING3-EXISTS            VALUE 'Y'.             05110000
051200     05  END-OF-EDIIN-SW         PIC X(01) VALUE 'N'.             05120000
051300         88  END-OF-EDIIN                  VALUE 'Y'.             05130000
051400                                                                  05140000
051500     05  ERR-DETAIL-SUM-GROSS-SW PIC X(01) VALUE 'N'.             05150000
051600         88  ERR-DETAIL-GROSS-INVOICE      VALUE 'Y'.             05160000
051700         88  NO-ERR-DETAIL-GROSS-INVOICE   VALUE 'N'.             05170000
051800                                                                  05180000
051900     05  VALID-DUNS-NUMBER-SW    PIC X(01) VALUE ' '.             05190000
052000         88  WS-VALID-DUNS                 VALUE 'Y'.             05200000
052100         88  WS-NOT-VALID-DUNS             VALUE 'N'.             05210000
052200                                                                  05220000
052300     05  VALID-TRADE-PART-SW     PIC X(01) VALUE ' '.             05230000
052400         88  WS-VALID-TRADE-PART           VALUE 'Y'.             05240000
052500         88  WS-NOT-VALID-TRADE-PART       VALUE 'N'.             05250000
052600                                                                  05260000
052700     05  CONSOLIDATED-SW         PIC X(01) VALUE ' '.             05270000
052800         88  WS-CONSOLIDATED-INVOICE       VALUE 'Y'.             05280000
052900         88  WS-NOT-CONSOLIDATED           VALUE 'N'.             05290000
053000                                                                  05300000
053100     05  VALID-STORE-SW          PIC X(01) VALUE ' '.             05310000
053200         88  WS-VALID-STORE                VALUE 'Y'.             05320000
053300         88  WS-VALID-DC                   VALUE 'X'.             05330000
053400         88  WS-NOT-VALID-STORE            VALUE 'N'.             05340000
053500                                                                  05350000
053600     05  VALID-STORE2-SW         PIC X(01) VALUE ' '.             05360000
053700         88  WS-VALID-STORE2               VALUE 'Y'.             05370000
053800         88  WS-VALID-DC2                  VALUE 'X'.             05380000
053900         88  WS-NOT-VALID-STORE2           VALUE 'N'.             05390000
054000                                                                  05400000
054100     05  VALID-UPC-CODE-SW       PIC X(01) VALUE ' '.             05410000
054200         88  WS-VALID-UPC                  VALUE 'Y'.             05420000
054300         88  WS-NOT-VALID-UPC              VALUE 'N'.             05430000
054400                                                                  05440000
054500     05  NODATA-AFP-SW           PIC X(01) VALUE ' '.             05450000
054600         88  NODATA-AFP                    VALUE 'Y'.             05460000
054700         88  DATA-AFP                      VALUE 'N'.             05470000
054800                                                                  05480000
054900     05  WS-LI-FUNG-PREPACK-SW   PIC X(01) VALUE 'N'.             05490000
055000         88  LI-FUNG-PREPACK-FOUND         VALUE 'Y'.             05500000
055100         88  LI-FUNG-PREPACK-NOT-FOUND     VALUE 'N'.             05510000
055200                                                                  05520000
055300     05  WS-TOO-INVC-LINES-SW        PIC X(1)      VALUE 'N'.     05530000
055400         88  TOO-MANY-INVC-LINES                   VALUE 'Y'.     05540000
055500         88  NOT-TOO-MANY-INVC-LINES               VALUE 'N'.     05550000
055600                                                                  05560000
055700     05  WS-FIRST-07-REC-WRITTEN-SW  PIC X(1)      VALUE 'N'.     05570000
055800         88  FIRST-07-REC-WRITTEN                  VALUE 'Y'.     05580000
055900         88  FIRST-07-REC-NOT-WRITTEN              VALUE 'N'.     05590000
056000                                                                  05600000
056100 01  WS-PO-INV-TABLE-AREA.                                        05610000
056200     05  WS-PO-INV-TABLE         OCCURS 15000 TIMES               05620000
056300                                 INDEXED BY PO-INDX.              05630000
056400         10  WS-PO-INV-NBR       PIC X(31).                       05640001
056500         10  WS-PO-INV-FLAG      PIC X(01).                       05650000
056600                                                                  05660000
056700 01  WS-TABLE-AREA.                                               05670000
056800     05  WS-INVOICE-TABLE        OCCURS 11000 TIMES               05680000
056900                                 INDEXED BY INV-INDX.             05690000
057000         10  WS-INV-REC.                                          05700000
057100             15  WS-AP050-KEY-AREA.                               05710000
057200                 20  WS-AP050-PO-NBR     PIC X(09).               05720001
057300                 20  WS-AP050-INV-NBR    PIC X(22).               05730000
057400                 20  WS-AP050-REC-TYPE   PIC X(02).               05740000
057500                 20  WS-AP050-FILLER     PIC X(17).               05750002
057600             15  WS-AP050-DATA-AREA  PIC X(300).                  05760000
057700         10  WS-INV-ERR-TBL-AREA.                                 05770000
057800             15  WS-INV-ERR-TBL  OCCURS 25 TIMES                  05780000
057900                                 INDEXED BY REJ-INDX.             05790000
058000                 20  WS-INV-ERR-CD      PIC 9(2).                 05800000
058100                                                                  05810000
058200 01 PV-ACCUMULATORS.                                              05820000
058300     05  PV-ACCUM-ALLW           PIC S999V99 VALUE ZERO.          05830000
058400     05  PV-ACCUM-CHRG           PIC S999V99 VALUE ZERO.          05840000
058500                                                                  05850000
058600 01 PV-ACCUMULATORS-PCT.                                          05860000
058700     05  PV-ACCUM-ALLW-PCT       PIC S99V9999 COMP-3.             05870000
058800     05  PV-ACCUM-CHRG-PCT       PIC S99V9999 COMP-3.             05880000
058900                                                                  05890000
059000 01 PV-STORE-9                   PIC 9(5) VALUE ZERO.             05900000
059100                                                                  05910000
059200 01  RUN-TIME.                                                    05920000
059300     05  R-HR                    PIC 99.                          05930000
059400     05  R-MIN                   PIC 99.                          05940000
059500     05  R-SEC                   PIC 99.                          05950000
059600     05  R-TH                    PIC 99.                          05960000
059700                                                                  05970000
059800 01  DATE-IN.                                                     05980000
059900     05 DATE-IN-YY               PIC XX.                          05990000
060000     05 DATE-IN-MM               PIC XX.                          06000000
060100     05 DATE-IN-DD               PIC XX.                          06010000
060200                                                                  06020000
060300 01  NO-DATA-DESCRIPTION.                                         06030000
060400     05  FILLER                  PIC  X(43)  VALUE                06040000
060500             'THERE IS NO DATA TO REPORT ON FOR THIS RUN.'.       06050000
060600                                                                  06060000
060700*--------------------------------------------------------------*  06070000
060800* NEW EDI INVOICE INPUT LAYOUT                                 *  06080000
060900*--------------------------------------------------------------*  06090000
061000 01  FILLER                      PIC X(35)  VALUE                 06100000
061100     'BEGINNING OF AP050 INPUT FILE    **'.                       06110000
061200 01  AP050-EDI-IN-FILE.                                           06120000
061300     COPY APRD050.                                                06130000
061400                                                                  06140000
061500*--------------------------------------------------------------*  06150000
061600* AP WORK RECORD AREA                                          *  06160000
061700*--------------------------------------------------------------*  06170000
061800 01  FILLER                      PIC X(35)  VALUE                 06180000
061900     'BEGINNING OF AP WORK RECORD AREA **'.                       06190000
062000 01  WS-WORK-REC.                                                 06200000
062100     COPY APRD050.                                                06210000
062200                                                                  06220000
062300*--------------------------------------------------------------*  06230000
062400* REJECTED EDI INVOICE OUTPUT LAYOUT                           *  06240000
062500*--------------------------------------------------------------*  06250000
062600 01  FILLER                      PIC X(35)  VALUE                 06260000
062700     'BEGINNING OF REJECT  RECORD AREA **'.                       06270000
062800 01  WS-REJECT-REC.                                               06280000
062900     COPY APRD051.                                                06290000
063000                                                                  06300000
063100*--------------------------------------------------------------*  06310000
063200* EDI INVOICE EDIT CODES AND MESSAGES                          *  06320000
063300*--------------------------------------------------------------*  06330000
063400 01  FILLER                      PIC X(35)  VALUE                 06340000
063500     'BEGINNING OF AP050 EDIT CODE FILE**'.                       06350000
063600 01  WS-EDIT-CODES.                                               06360000
063700     COPY APWS050.                                                06370000
063800                                                                  06380000
063900*--------------------------------------------------------------*  06390000
064000* EDI INVOICE OUTPUT LAYOUT                                    *  06400000
064100*--------------------------------------------------------------*  06410000
064200 01  FILLER                      PIC X(35)  VALUE                 06420000
064300     'BEGINNING OF AP055 OUTPUT FILE   **'.                       06430000
064400 01  WS-AFP-OUT-REC.                                              06440000
064500     COPY APRD055.                                                06450000
064600                                                                  06460000
064700 01  WS-SAVE-AFP-HEADER.                                          06470000
064800     COPY APRD055.                                                06480000
064900                                                                  06490000
065000 01  FILLER                      PIC X(35)  VALUE                 06500000
065100     'END OF AP WORK RECORD AREA       **'.                       06510000
065200                                                                  06520000
065300*--------------------------------------------------------------*  06530000
065400* SQLCA FORMATTED MESSAGE AREA                                 *  06540000
065500*--------------------------------------------------------------*  06550000
065600     COPY DPWS004.                                                06560000
065700                                                                  06570000
065800*--------------------------------------------------------------*  06580000
065900* COMMUNICATIONS AREA FOR DB2                                  *  06590000
066000*--------------------------------------------------------------*  06600000
066100     COPY SQLCA2.                                                 06610000
066200                                                                  06620000
066300     EXEC SQL                                                     06630000
066400          INCLUDE SQLCA                                           06640000
066500     END-EXEC.                                                    06650000
066600                                                                  06660000
066700*--------------------------------------------------------------*  06670000
066800* EXTERNAL ENTERPRISE TABLE                                    *  06680000
066900*--------------------------------------------------------------*  06690000
067000     EXEC SQL                                                     06700000
067100          INCLUDE TEXTENT                                         06710000
067200     END-EXEC.                                                    06720000
067300                                                                  06730000
067400*--------------------------------------------------------------*  06740000
067500* MERCHANDISE AREA TABLE                                       *  06750000
067600*--------------------------------------------------------------*  06760000
067700     EXEC SQL                                                     06770000
067800          INCLUDE TMDSEAR                                         06780000
067900     END-EXEC.                                                    06790000
068000                                                                  06800000
068100*--------------------------------------------------------------*  06810000
068200* PO INSTRUCTION TABLE                                         *  06820000
068300*--------------------------------------------------------------*  06830000
068400     EXEC SQL                                                     06840000
068500          INCLUDE TPOINST                                         06850000
068600     END-EXEC.                                                    06860000
068700                                                                  06870000
068800*--------------------------------------------------------------*  06880000
068900* SPECIAL INSTRUCTIONS CODE TABLE                              *  06890000
069000*--------------------------------------------------------------*  06900000
069100     EXEC SQL                                                     06910000
069200          INCLUDE TINSTCD                                         06920000
069300     END-EXEC.                                                    06930000
069400                                                                  06940000
069500*--------------------------------------------------------------*  06950000
069600* PURCHASE ORDER TABLE                                         *  06960000
069700*--------------------------------------------------------------*  06970000
069800     EXEC SQL                                                     06980000
069900          INCLUDE TPURCHS                                         06990000
070000     END-EXEC.                                                    07000000
070100                                                                  07010000
070200*--------------------------------------------------------------*  07020000
070300* PURCHASE ORDER ITEM TABLE                                    *  07030000
070400*--------------------------------------------------------------*  07040000
070500     EXEC SQL                                                     07050000
070600          INCLUDE TPURITM                                         07060000
070700     END-EXEC.                                                    07070000
070800                                                                  07080000
070900*--------------------------------------------------------------*  07090000
071000* LOCATION TABLE                                               *  07100000
071100*--------------------------------------------------------------*  07110000
071200     EXEC SQL                                                     07120000
071300          INCLUDE XFT00017                                        07130000
071400     END-EXEC.                                                    07140000
071500                                                                  07150000
071600*--------------------------------------------------------------*  07160000
071700* UPC/SKU RELATIONSHIP TABLE                                   *  07170000
071800*--------------------------------------------------------------*  07180000
071900     EXEC SQL                                                     07190000
072000          INCLUDE TUPCSKU                                         07200000
072100     END-EXEC.                                                    07210000
072200                                                                  07220000
072300*--------------------------------------------------------------*  07230000
072400* TRADING PARTNER TRANSACTION TABLE                            *  07240000
072500*--------------------------------------------------------------*  07250000
072600     EXEC SQL                                                     07260000
072700          INCLUDE TTRDPRT                                         07270000
072800     END-EXEC.                                                    07280000
072900                                                                  07290000
073000*--------------------------------------------------------------*  07300000
073100* EXTERNAL ENTITY NAME TABLE                                   *  07310000
073200*--------------------------------------------------------------*  07320000
073300     EXEC SQL                                                     07330000
073400          INCLUDE TENTNME                                         07340000
073500     END-EXEC.                                                    07350000
073600                                                                  07360000
073700*--------------------------------------------------------------*  07370000
073800* TRADING PARTNER CURSOR: RETURNS THE ACTIVE ENTITY ID FOR THE *  07380000
073900* TRADING PARTNER INTERCHANGE ID ON THE INCOMING INVOICES.     *  07390000
074000*--------------------------------------------------------------*  07400000
074100     EXEC SQL                                                     07410000
074200          DECLARE TRDPRT_CSR CURSOR FOR                           07420000
074300            SELECT                                                07430000
074400               ENT_ID                                             07440000
074500             , VEND_INCHG_ID                                      07450000
074600             , VEND_INCHG_ID_DESC                                 07460000
074700             , INACTV_DTE                                         07470000
074800            FROM                                                  07480000
074900               TTRDPRT                                            07490000
075000            WHERE                                                 07500000
075100                VEND_INCHG_ID      = :TRDPRT-VEND-INCHG-ID        07510000
075200            AND VEND_INCHG_ID_DESC = :TRDPRT-VEND-INCHG-ID-DESC   07520000
075300            AND CURRENT DATE      <= INACTV_DTE                   07530000
075400            ORDER BY                                              07540000
075500                INACTV_DTE DESC                                   07550000
075600     END-EXEC.                                                    07560000
075700                                                                  07570000
075800 01  FILLER                        PIC X(25) VALUE                07580000
075900          '<====WS FOR APKED200 ENDS'.                            07590000
076000                                                                  07600000
076100*-------------------------*                                       07610000
076200 PROCEDURE DIVISION.                                              07620000
076300*-------------------------*                                       07630000
076400 A100-MAINLINE.                                                   07640000
076500                                                                  07650000
076600     PERFORM H100-HOUSEKEEPING.                                   07660000
076700     PERFORM R100-READ-AP050.                                     07670000
076800     IF   END-OF-EDIIN                                            07680000
076900          DISPLAY '**********************************'            07690000
077000          DISPLAY '*   EMPTY EDI INVOICE FILE       *'            07700000
077100          DISPLAY '*   PROGRAM ** = APKED200        *'            07710000
077200          DISPLAY '**********************************'            07720000
077300     ELSE                                                         07730000
077400        MOVE AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE        07740000
077500                                 TO WS-SAVE-INVOICE-NBR           07750000
077600        MOVE AP050-EDI-SEQ-NBR OF AP050-EDI-IN-FILE               07760000
077700                                 TO WS-SAVE-EDI-SEQ-NBR           07770000
077800        MOVE AP050-KOHLS-PO-NBR OF AP050-EDI-IN-FILE TO           07780000
077900                                    WS-SAVE-PO-NBR                07790000
078000                                    WS-SAVE-PO-NBR-COMP           07800000
078100        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'      07810000
078200           MOVE AP050-INTRCHG-CNTL-NBR OF AP050-EDI-IN-FILE       07820000
078300                            TO WS-SAVE-INTERCHG-CNTL-NBR          07830000
078400        ELSE                                                      07840000
078500           MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR          07850000
078600        END-IF                                                    07860000
078700                                                                  07870000
078800        PERFORM B100-PROCESSING                                   07880000
078900                     UNTIL END-OF-EDIIN                           07890000
079000        SET NO-EDI-ERROR                                          07900000
079100            NO-PI-WARNING1                                        07910000
079200            NO-PI-WARNING2 TO TRUE                                07920000
079300        IF WS-CONSOLIDATED-INVOICE                                07930000
079400           PERFORM W400-WRITE-CONSOLIDATED                        07940000
079500        ELSE                                                      07950000
079600           IF NOT-TOO-MANY-INVC-LINES                             07960000
079700              PERFORM E100-EDIT-CHECKS                            07970000
079800           ELSE                                                   07980000
079900              SET ERROR-EDI TO TRUE                               07990000
080000              IF WS-AP050-REC-TYPE(1) = '01'                      08000000
080100                 MOVE WS-INV-REC(1) TO WS-WORK-REC                08010000
080200                 PERFORM R800-SELECT-ENT-ID                       08020000
080300              END-IF                                              08030000
080400           END-IF                                                 08040000
080500           IF ERROR-EDI                                           08050000
080600              PERFORM W300-WRITE-REJECT                           08060000
080700           ELSE                                                   08070000
080800              MOVE 0 TO WS-ITEM-SEQ                               08080000
080900              MOVE 0 TO ALLW-INDX                                 08090000
081000              PERFORM R700-SELECT-TMDSEAR                         08100000
081100              PERFORM S200-SELECT-TPOINST                         08110000
081200              PERFORM W200-WRITE-AFP                              08120000
081300              IF PI-WARNING1-EXISTS OR                            08130000
081400                 PI-WARNING2-EXISTS                               08140000
081500                 PERFORM W300-WRITE-REJECT                        08150000
081600              END-IF                                              08160000
081700           END-IF                                                 08170000
081800        END-IF                                                    08180000
081900     END-IF.                                                      08190000
082000                                                                  08200000
082100     IF WS-AFPOUT-REC-CNT = ZEROES                                08210000
082200        PERFORM W260-WRITE-NODATA-AFP                             08220000
082300     END-IF.                                                      08230000
082400     PERFORM Z900-END-OF-JOB.                                     08240000
082500     GOBACK.                                                      08250000
082600                                                                  08260000
082700*--------------------------------------------------------------*  08270000
082800* PROCESS EDI INVOICES WHILE BREAKING ON THE CHANGE IN VENDOR  *  08280000
082900* NUMBER.  NOTE: THE ENTIRE INVOICE IS LOADED INTO WORKING     *  08290000
083000* STORAGE.                                                     *  08300000
083100*--------------------------------------------------------------*  08310000
083200 B100-PROCESSING.                                                 08320000
083300                                                                  08330000
083400     IF (AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE            08340000
083500                            NOT = WS-SAVE-INVOICE-NBR)   OR       08350000
083600        (AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE            08360000
083700                                = WS-SAVE-INVOICE-NBR AND         08370000
083800         AP050-EDI-SEQ-NBR OF AP050-EDI-IN-FILE                   08380000
083900                            NOT = WS-SAVE-EDI-SEQ-NBR)            08390000
084000        IF AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE          08400000
084100                                 = SPACES                         08410000
084200           NEXT SENTENCE                                          08420000
084300        ELSE                                                      08430000
084400           SET NO-EDI-ERROR                                       08440000
084500               NO-PI-WARNING1                                     08450000
084600               NO-PI-WARNING2 TO TRUE                             08460000
084700           IF WS-CONSOLIDATED-INVOICE                             08470000
084800              PERFORM W400-WRITE-CONSOLIDATED                     08480000
084900           ELSE                                                   08490000
085000              IF NOT-TOO-MANY-INVC-LINES                          08500000
085100                 PERFORM E100-EDIT-CHECKS                         08510000
085200              ELSE                                                08520000
085300                 SET ERROR-EDI TO TRUE                            08530000
085400              END-IF                                              08540000
085500              IF ERROR-EDI                                        08550000
085600                 PERFORM W300-WRITE-REJECT                        08560000
085700              ELSE                                                08570000
085800                 MOVE 0 TO WS-ITEM-SEQ                            08580000
085900                 MOVE 0 TO ALLW-INDX                              08590000
086000                 PERFORM R700-SELECT-TMDSEAR                      08600000
086100                 PERFORM S200-SELECT-TPOINST                      08610000
086200                 PERFORM W200-WRITE-AFP                           08620000
086300                 IF PI-WARNING1-EXISTS OR                         08630000
086400                    PI-WARNING2-EXISTS                            08640000
086500                    PERFORM W300-WRITE-REJECT                     08650000
086600                 END-IF                                           08660000
086700              END-IF                                              08670000
086800           END-IF                                                 08680000
086900           MOVE AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE     08690000
087000                                      TO WS-SAVE-INVOICE-NBR      08700000
087100           MOVE AP050-EDI-SEQ-NBR OF AP050-EDI-IN-FILE            08710000
087200                                      TO WS-SAVE-EDI-SEQ-NBR      08720000
087300           MOVE AP050-KOHLS-PO-NBR OF AP050-EDI-IN-FILE TO        08730000
087400                                         WS-SAVE-PO-NBR           08740000
087500                                         WS-SAVE-PO-NBR-COMP      08750000
087600           IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'   08760000
087700               MOVE AP050-INTRCHG-CNTL-NBR OF AP050-EDI-IN-FILE   08770000
087800                                TO WS-SAVE-INTERCHG-CNTL-NBR      08780000
087900           ELSE                                                   08790000
088000               MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR      08800000
088100           END-IF                                                 08810000
088200                                                                  08820000
088300           MOVE '000000' TO WS-SAVE-INVOICE-DATE                  08830000
088400                            WS-SAVE-SHIPPED-DATE                  08840000
088500                            WS-SAVE-EFFECTIVE-DATE                08850000
088600           MOVE  0    TO WS-DETAIL-GROSS-INVOICE-AMT              08860000
088700                         WS-DETAIL-ALLW-CHRG-AMT                  08870000
088800                         WS-DETAIL-TOT-UNITS                      08880000
088900                         PV-ACCUM-ALLW                            08890000
089000                         PV-ACCUM-CHRG                            08900000
089100                         PV-ACCUM-ALLW-PCT                        08910000
089200                         PV-ACCUM-CHRG-PCT                        08920000
089300                         WS-DETAIL-CHRG-AMT                       08930000
089400                         WS-LI-FUNG-HANGER-AMT                    08940000
089500                         WS-DETAIL-ALLW-AMT                       08950000
089600           INITIALIZE    WS-INVOICE-COUNTERS                      08960000
089700           PERFORM H200-INITIALIZE                                08970000
089800        END-IF                                                    08980000
089900     END-IF.                                                      08990000
090000                                                                  09000000
090100**   IF INV-INDX > 11000                                          09010000
090200     IF INV-INDX > 10998                                          09020000
090300        IF NOT-TOO-MANY-INVC-LINES                                09030000
090400           DISPLAY '**********************************'           09040000
090500           DISPLAY '*   TOO MANY INVOICE LINES SENT  *'           09050000
090600           DISPLAY '*   OVER 10998 RECORDS HAVE BEEN *'           09060000
090700           DISPLAY '*   FOUND FOR INVOICE ID         *'           09070000
090800           DISPLAY '* ' WS-SAVE-INVOICE-NBR '         *'          09080000
090900           DISPLAY '*   PARAGRAPH  = B100-PROCESSING *'           09090000
091000           DISPLAY '**********************************'           09100000
091100           SET TOO-MANY-INVC-LINES TO TRUE                        09110000
091200           SET INV-INDX UP BY 1                                   09120000
091300           MOVE WS-AP050-KEY-AREA(INV-INDX - 1) TO                09130000
091400                   WS-AP050-KEY-AREA(INV-INDX)                    09140000
091500           MOVE HIGH-VALUES TO WS-AP050-REC-TYPE(INV-INDX)        09150000
091600           SET REJ-INDX TO 1                                      09160000
091700           SET MAX-INVC-LINES-CD TO TRUE                          09170000
091800           MOVE EDI-ERROR-CD TO                                   09180000
091900                WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 09190000
092000        END-IF                                                    09200000
092100     ELSE                                                         09210000
092200        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '05'      09220000
092300          AND AP050-ALLW-CHG-TYPE OF AP050-EDI-IN-FILE = 'N'      09230000
092400            CONTINUE                                              09240000
092500        ELSE                                                      09250000
092600            SET INV-INDX UP BY 1                                  09260000
092700            MOVE AP050-EDI-IN-FILE TO                             09270000
092800                 WS-INV-REC(INV-INDX)                             09280000
092900        END-IF                                                    09290000
093000        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '06'      09300000
093100           MOVE AP050-GROSS-INVOICE-AMT OF AP050-EDI-IN-FILE TO   09310000
093200                            WS-SAVE-GROSS-INVOICE-AMT             09320000
093300        END-IF                                                    09330000
093400        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '02'      09340000
093500           AND AP050-CONSOLIDATED OF AP050-EDI-IN-FILE            09350000
093600           SET WS-CONSOLIDATED-INVOICE TO TRUE                    09360000
093700        END-IF                                                    09370000
093800     END-IF.                                                      09380000
093900                                                                  09390000
094000     MOVE AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE TO           09400000
094100                                         WS-LAST-REC-TYPE.        09410000
094200     PERFORM R100-READ-AP050.                                     09420000
094300                                                                  09430000
094400*--------------------------------------------------------------*  09440000
094500* PERFORM EDIT CHECKS PER SPECIFICATIONS                       *  09450000
094600* -- THE EDIT ONE CHECK ROUTINE WILL CHECK SPECIFIC ERRORS     *  09460000
094700*    PER RECORD TYPE AND WILL KEEP ANY SUMMARIZATION TOTALS    *  09470000
094800*    AND COUNTS THAT ARE NECESSARY FOR EDITTING AFTER THE      *  09480000
094900*    ENTIRE INVOICE IS LOADED                                  *  09490000
095000* -- THE EDIT ALL ROUTINE WILL CHECK MISSING RECORD TYPES,     *  09500000
095100*    DETAIL AND SUMMARY TOTAL DISCREPENCIES, ETC.              *  09510000
095200*--------------------------------------------------------------*  09520000
095300 E100-EDIT-CHECKS.                                                09530000
095400                                                                  09540000
095500     PERFORM E200-EDIT-ONE                                        09550000
095600        VARYING INV-INDX FROM 1 BY 1                              09560000
095700**      UNTIL INV-INDX > 11000 OR                                 09570000
095800        UNTIL INV-INDX > 10998 OR                                 09580000
095900           WS-AP050-KEY-AREA(INV-INDX) = HIGH-VALUES.             09590000
096000                                                                  09600000
096100***************************************************************** 09610000
096200*****8AT THIS POINT THE INV-INDX IS SET TO 11000 OR TO THE        09620000
096300***** AT THIS POINT THE INV-INDX IS SET TO 10998 OR TO THE        09630000
096400***** NUMBER OF INVOICE RECORDS + 1                               09640000
096500***** THE REJ-INDX IS RESET IN ORDER TO SET UP A RECORD           09650000
096600***** FOR ERRORS THAT MAY BE DETECTED IN THE NEXT ROUTINE.        09660000
096700***************************************************************** 09670000
096800                                                                  09680000
096900     SET REJ-INDX TO 1.                                           09690000
097000     SET REJ-INDX DOWN BY 1.                                      09700000
097100                                                                  09710000
097200     PERFORM E300-EDIT-ALL.                                       09720000
097300                                                                  09730000
097400*--------------------------------------------------------------*  09740000
097500* THIS PARAGRAPH PERFORMS THE FOLLOWING EDITS:                 *  09750000
097600*  -- VERIFIES THAT THERE IS ONLY ONE OF EACH SPECIFIC RECORD  *  09760000
097700*     TYPE                                                     *  09770000
097800*  -- VERIFIES THAT ALL NECESSARY FIELDS ARE POPULATED WITH    *  09780000
097900*     DATA                                                     *  09790000
098000*  -- VERIFIES THAT DATES ARE FORMATTED CORRECTLY              *  09800000
098100*  -- VERIFIES THAT NEGATIVE NUMERIC FIELDS DO NOT EXIST       *  09810000
098200*  -- DETERMINES THE MATCH LEVEL, STORE NUMBER, AND DC NUMBER  *  09820000
098300*     FOR EACH INVOICE                                         *  09830000
098400*  -- DETERMINES THE ITEM NUMBER IF THE UPC IS VALID           *  09840000
098500*  -- RETRIEVES THE PO_LNE_NBR AND STYLE CODE IF THE UPC/SKU   *  09850000
098600*     IS NOT FOUND OR INVALID                                  *  09860000
098700*  -- VERIFIES ANY ALLOWANCE AND/OR CHARGES                    *  09870000
098800*--------------------------------------------------------------*  09880000
098900 E200-EDIT-ONE.                                                   09890000
099000                                                                  09900000
099100     MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC.                    09910000
099200     SET REJ-INDX TO 1.                                           09920000
099300     SET REJ-INDX DOWN BY 1.                                      09930000
099400                                                                  09940000
099500*---------------------------------------------------------------  09950000
099600* RECORD TYPE VALIDATION -- VERIFIES THAT THERE IS ONLY ONE       09960000
099700* OF EACH SPECIFIC RECORD TYPE                                    09970000
099800*---------------------------------------------------------------  09980000
099900                                                                  09990000
100000     EVALUATE AP050-RECORD-TYPE-IND OF WS-WORK-REC                10000000
100100        WHEN '01'                                                 10010000
100200             ADD 1 TO WS-REC-01-CNT                               10020000
100300             IF WS-REC-01-CNT > 1                                 10030000
100400                IF REJ-INDX NOT = 25                              10040000
100500                   SET REJ-INDX UP BY 1                           10050000
100600                END-IF                                            10060000
100700                SET ERROR-EDI TO TRUE                             10070000
100800                SET MULT-01-REC-CD TO TRUE                        10080000
100900                MOVE EDI-ERROR-CD TO                              10090000
101000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            10100000
101100             END-IF                                               10110000
101200        WHEN '02'                                                 10120000
101300             ADD 1 TO WS-REC-02-CNT                               10130000
101400             IF WS-REC-02-CNT > 1                                 10140000
101500                IF REJ-INDX NOT = 25                              10150000
101600                   SET REJ-INDX UP BY 1                           10160000
101700                END-IF                                            10170000
101800                SET ERROR-EDI TO TRUE                             10180000
101900                SET MULT-02-REC-CD TO TRUE                        10190000
102000                MOVE EDI-ERROR-CD TO                              10200000
102100                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            10210000
102200             ELSE                                                 10220000
102300                MOVE AP050-INVOICE-DATE OF WS-WORK-REC TO         10230000
102400                                   WS-SAVE-INVOICE-DATE           10240000
102500                MOVE AP050-DATE-SHIPPED OF WS-WORK-REC TO         10250000
102600                                   WS-SAVE-SHIPPED-DATE           10260000
102700                MOVE AP050-EFFECTIVE-DATE OF WS-WORK-REC TO       10270000
102800                                   WS-SAVE-EFFECTIVE-DATE         10280000
102900             END-IF                                               10290000
103000        WHEN '03'                                                 10300000
103100             ADD 1 TO WS-REC-03-CNT                               10310000
103200             IF WS-REC-03-CNT > 1                                 10320000
103300                IF REJ-INDX NOT = 25                              10330000
103400                   SET REJ-INDX UP BY 1                           10340000
103500                END-IF                                            10350000
103600                SET ERROR-EDI TO TRUE                             10360000
103700                SET MULT-03-REC-CD TO TRUE                        10370000
103800                MOVE EDI-ERROR-CD   TO                            10380000
103900                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            10390000
104000             END-IF                                               10400000
104100        WHEN '04'                                                 10410000
104200             ADD 1 TO WS-REC-04-CNT                               10420000
104300        WHEN '05'                                                 10430000
104400             ADD 1 TO WS-REC-05-CNT                               10440000
104500             IF AP050-ALLOWANCE OF WS-WORK-REC                    10450000
104600                COMPUTE WS-DETAIL-ALLW-AMT                        10460000
104700                   =    WS-DETAIL-ALLW-AMT                        10470000
104800                   +    AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC      10480000
104900*                  -    AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC      10490000
105000                ADD AP050-ALLW-CHRG-PCT OF WS-WORK-REC            10500000
105100                                        TO PV-ACCUM-ALLW          10510000
105200             ELSE                                                 10520000
105300                IF AP050-CHARGE OF WS-WORK-REC                    10530000
105400                   COMPUTE WS-DETAIL-CHRG-AMT                     10540000
105500                      =    WS-DETAIL-CHRG-AMT                     10550000
105600                      +    AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC   10560000
105700                   ADD AP050-ALLW-CHRG-PCT OF WS-WORK-REC         10570000
105800                                           TO PV-ACCUM-CHRG       10580000
105900                END-IF                                            10590000
106000             END-IF                                               10600000
106100        WHEN '06'                                                 10610000
106200             ADD 1 TO WS-REC-06-CNT                               10620000
106300             IF WS-REC-06-CNT > 1                                 10630000
106400                IF REJ-INDX NOT = 25                              10640000
106500                   SET REJ-INDX UP BY 1                           10650000
106600                END-IF                                            10660000
106700                SET ERROR-EDI TO TRUE                             10670000
106800                SET MULT-06-REC-CD TO TRUE                        10680000
106900                MOVE EDI-ERROR-CD   TO                            10690000
107000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            10700000
107100             END-IF                                               10710000
107200        WHEN '07'                                                 10720000
107300             ADD 1 TO WS-REC-07-CNT                               10730000
107400             IF (AP050-IT1-UNIT-MEASURE OF WS-WORK-REC = 'AS') AND10740000
107500                (AP050-UPC-CANT-EXPLODE-IND OF WS-WORK-REC = 'N') 10750000
107600                CONTINUE                                          10760000
107700             ELSE                                                 10770000
107800                INITIALIZE WS-QUANTITY-INVOICED                   10780000
107900                MOVE AP050-QUANTITY-INVOICED OF WS-WORK-REC       10790000
108000                  TO WS-QUANTITY-INVOICED                         10800000
108100                COMPUTE WS-CALC-EXTEN-INVOICE-AMT ROUNDED         10810000
108200                   =    WS-QUANTITY-INVOICED                      10820000
108300                   *    AP050-WHOLSALE-UNIT-COST OF WS-WORK-REC   10830000
108400                COMPUTE WS-DETAIL-GROSS-INVOICE-AMT               10840000
108500                   =    WS-DETAIL-GROSS-INVOICE-AMT               10850000
108600                   +    WS-CALC-EXTEN-INVOICE-AMT                 10860000
108700                COMPUTE WS-DETAIL-TOT-UNITS                       10870000
108800                   =    WS-DETAIL-TOT-UNITS                       10880000
108900                   +    WS-QUANTITY-INVOICED                      10890000
109000             END-IF                                               10900000
109100             IF (AP050-IT1-UNIT-MEASURE OF WS-WORK-REC = 'AS')    10910000
109200                PERFORM E600-EDIT-PKITEM-WARN-INDS                10920000
109300             END-IF                                               10930000
109400        WHEN OTHER                                                10940000
109500             ADD 1 TO WS-REC-OTHER-CNT                            10950000
109600             IF REJ-INDX NOT = 25                                 10960000
109700                SET REJ-INDX UP BY 1                              10970000
109800             END-IF                                               10980000
109900             SET ERROR-EDI TO TRUE                                10990000
110000             SET INVALID-REC-TYPE-CD TO TRUE                      11000000
110100             MOVE EDI-ERROR-CD TO                                 11010000
110200                  WS-INV-ERR-CD(INV-INDX, REJ-INDX)               11020000
110300     END-EVALUATE.                                                11030000
110400                                                                  11040000
110500*---------------------------------------------------------------  11050000
110600* REQUIRED FIELD VALIDATION -- VERIFIES THAT ALL REQUIRED         11060000
110700* FIELDS AND 88 LEVEL ENTRIES ARE POPULATED WITH DATA             11070000
110800*---------------------------------------------------------------  11080000
110900                                                                  11090000
111000     IF AP050-KOHLS-PO-NBR OF WS-WORK-REC NOT NUMERIC             11100000
111100       OR                                                         11110000
111200        AP050-KOHLS-PO-NBR OF WS-WORK-REC = ZEROS                 11120000
111300        IF REJ-INDX NOT = 25                                      11130000
111400           SET REJ-INDX UP BY 1                                   11140000
111500        END-IF                                                    11150000
111600        SET ERROR-EDI TO TRUE                                     11160000
111700        SET NO-PO-NBR-CD TO TRUE                                  11170000
111800        MOVE EDI-ERROR-CD TO                                      11180000
111900                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            11190000
112000      END-IF.                                                     11200000
112100                                                                  11210000
112200     IF AP050-VENDOR-INVOICE-NBR OF WS-WORK-REC = SPACES          11220000
112300        IF REJ-INDX NOT = 25                                      11230000
112400           SET REJ-INDX UP BY 1                                   11240000
112500        END-IF                                                    11250000
112600        SET ERROR-EDI TO TRUE                                     11260000
112700        SET NO-INV-NBR-CD TO TRUE                                 11270000
112800        MOVE EDI-ERROR-CD TO                                      11280000
112900                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           11290000
113000                                                                  11300000
113100     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '01'               11310000
113200        IF AP050-EDI-SENDER-ID OF WS-WORK-REC =                   11320000
113300                                     TRDPRT-VEND-INCHG-ID AND     11330000
113400           AP050-EDI-SENDER-ID-QUAL OF WS-WORK-REC =              11340000
113500                                     TRDPRT-VEND-INCHG-ID-DESC    11350000
113600           IF WS-NOT-VALID-TRADE-PART                             11360000
113700              IF REJ-INDX NOT = 25                                11370000
113800                 SET REJ-INDX UP BY 1                             11380000
113900              END-IF                                              11390000
114000              SET ERROR-EDI TO TRUE                               11400000
114100              SET NO-VALID-TRADE-PART TO TRUE                     11410000
114200              MOVE EDI-ERROR-CD TO                                11420000
114300                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      11430000
114400           END-IF                                                 11440000
114500        ELSE                                                      11450000
114600           SET WS-NOT-VALID-TRADE-PART TO TRUE                    11460000
114700           PERFORM R800-SELECT-ENT-ID                             11470000
114800           IF WS-NOT-VALID-TRADE-PART                             11480000
114900              IF REJ-INDX NOT = 25                                11490000
115000                 SET REJ-INDX UP BY 1                             11500000
115100              END-IF                                              11510000
115200              SET ERROR-EDI TO TRUE                               11520000
115300              SET NO-VALID-TRADE-PART TO TRUE                     11530000
115400              MOVE EDI-ERROR-CD TO                                11540000
115500                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      11550000
115600           END-IF                                                 11560000
115700        END-IF                                                    11570000
115800        MOVE ENTNME-ENT-NAME-DESC TO AP050-ENT-ID-DESC            11580000
115900                                               OF WS-WORK-REC     11590000
116000        MOVE EXTENT-DUN-NBR TO WS-DUN-NBR-X                       11600000
116100        MOVE WS-DUN-NBR-9S  TO AP050-EXTENT-DUN-NBR               11610000
116200                                               OF WS-WORK-REC     11620000
569100*       NEED TO IDENTIFY INVOICES FROM INFOR NEXUS                11621008
569100*       IF INFOR NEXUS, THE INVOICE MUST BE IMPORT (IM,IE,IF)     11622008
569100        MOVE AP050-EDI-SENDER-ID OF WS-WORK-REC                   11624011
569100                                 TO WS-VEND-INCHG-ID              11624111
569100        IF WS-INFOCHAIN                                           11625007
569100            PERFORM R750-SELECT-PO-TYPE                           11626008
292500            IF WS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'               11627008
292500              CONTINUE                                            11628010
292500            ELSE                                                  11629008
114900              IF REJ-INDX NOT = 25                                11629110
115000                 SET REJ-INDX UP BY 1                             11629210
115100              END-IF                                              11629310
115200              SET ERROR-EDI TO TRUE                               11629410
218000              SET NEXUS-INVC-PO-NOT-IMPORT TO TRUE                11629510
115400              MOVE EDI-ERROR-CD TO                                11629710
115500                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      11629810
292500            END-IF                                                11630108
292500        END-IF                                                    11630409
116300        MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)                  11631000
116400     END-IF.                                                      11640000
116500                                                                  11650000
116600     SET WS-VALID-DATE TO TRUE.                                   11660000
116700     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '02'               11670000
116800        IF AP050-INVOICE-DATE OF WS-WORK-REC NOT NUMERIC          11680000
116900          OR                                                      11690000
117000           AP050-INVOICE-DATE OF WS-WORK-REC = '000000'           11700000
117100           IF REJ-INDX NOT = 25                                   11710000
117200              SET REJ-INDX UP BY 1                                11720000
117300           END-IF                                                 11730000
117400           SET ERROR-EDI TO TRUE                                  11740000
117500           SET NO-INV-DATE-CD TO TRUE                             11750000
117600           MOVE EDI-ERROR-CD TO                                   11760000
117700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         11770000
117800        ELSE                                                      11780000
117900           MOVE AP050-INVOICE-DATE OF WS-WORK-REC TO WS-YYMMDD    11790000
118000           PERFORM E400-CHECK-DATE                                11800000
118100           IF WS-NOT-VALID-DATE                                   11810000
118200              IF REJ-INDX NOT = 25                                11820000
118300                 SET REJ-INDX UP BY 1                             11830000
118400              END-IF                                              11840000
118500              SET ERROR-EDI TO TRUE                               11850000
118600              SET INV-DATE-INVALID-CD TO TRUE                     11860000
118700              MOVE EDI-ERROR-CD TO                                11870000
118800                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     11880000
118900                                                                  11890000
119000                                                                  11900000
119100     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '04'               11910000
119200        IF AP050-BASIC        OF WS-WORK-REC OR                   11920000
119300           AP050-EOM          OF WS-WORK-REC OR                   11930000
119400           AP050-FIXED-DATE   OF WS-WORK-REC OR                   11940000
119500           AP050-DEF-INSTALL  OF WS-WORK-REC OR                   11950000
119600           AP050-NO-DISC      OF WS-WORK-REC OR                   11960000
119700           AP050-MIXED        OF WS-WORK-REC OR                   11970000
119800           AP050-EXTENDED     OF WS-WORK-REC OR                   11980000
119900           AP050-BASIC-DISC   OF WS-WORK-REC OR                   11990000
120000           AP050-PROXIMO      OF WS-WORK-REC OR                   12000000
120100           AP050-INSTANT      OF WS-WORK-REC OR                   12010000
120200           AP050-ELECTIVE     OF WS-WORK-REC OR                   12020000
120300           AP050-10-DAYS-EOM  OF WS-WORK-REC OR                   12030000
120400           AP050-PREV-AGREED  OF WS-WORK-REC OR                   12040000
120500           AP050-MUTUAL-DEFIN OF WS-WORK-REC                      12050000
120600           NEXT SENTENCE                                          12060000
120700        ELSE                                                      12070000
120800           IF REJ-INDX NOT = 25                                   12080000
120900              SET REJ-INDX UP BY 1                                12090000
121000           END-IF                                                 12100000
121100           SET ERROR-EDI TO TRUE                                  12110000
121200           SET INVALID-TERMS-TYPE-CD TO TRUE                      12120000
121300           MOVE EDI-ERROR-CD TO                                   12130000
121400                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        12140000
121500                                                                  12150000
121600     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '04'               12160000
121700        MOVE AP050-TRMS-BASIS-DTE-CODE OF WS-WORK-REC TO          12170000
121800             WS-CHECK-BASIS-DTE-CODE                              12180000
121900        IF WS-CHECK-BASIS-DTE-CODE(1:1) NUMERIC AND               12190000
122000           WS-CHECK-BASIS-DTE-CODE(2:1) = SPACE                   12200000
122100           PERFORM E500-CONVERT-CODE                              12210000
122200        END-IF                                                    12220000
122300        IF AP050-SHIP-DATE    OF WS-WORK-REC OR                   12230000
122400           AP050-DELIV-DATE   OF WS-WORK-REC OR                   12240000
122500           AP050-INVC-DATE    OF WS-WORK-REC OR                   12250000
122600           AP050-EFFECT-DATE  OF WS-WORK-REC                      12260000
122700           EVALUATE AP050-TRMS-BASIS-DTE-CODE OF WS-WORK-REC      12270000
122800              WHEN '01'                                           12280000
122900                 IF WS-SAVE-SHIPPED-DATE = SPACES OR '000000'     12290000
123000                    IF REJ-INDX NOT = 25                          12300000
123100                       SET REJ-INDX UP BY 1                       12310000
123200                    END-IF                                        12320000
123300                    SET ERROR-EDI TO TRUE                         12330000
123400                    SET TERM-01-NO-SHIP-DATE TO TRUE              12340000
123500                    MOVE EDI-ERROR-CD TO                          12350000
123600                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      12360000
123700                 END-IF                                           12370000
123800              WHEN '07'                                           12380000
123900                 IF WS-SAVE-EFFECTIVE-DATE =                      12390000
124000                                           SPACES OR '000000'     12400000
124100                    IF REJ-INDX NOT = 25                          12410000
124200                       SET REJ-INDX UP BY 1                       12420000
124300                    END-IF                                        12430000
124400                    SET ERROR-EDI TO TRUE                         12440000
124500                    SET TERM-07-NO-EFFECT-DATE TO TRUE            12450000
124600                    MOVE EDI-ERROR-CD TO                          12460000
124700                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      12470000
124800                 END-IF                                           12480000
124900           END-EVALUATE                                           12490000
125000        ELSE                                                      12500000
125100           IF REJ-INDX NOT = 25                                   12510000
125200              SET REJ-INDX UP BY 1                                12520000
125300           END-IF                                                 12530000
125400           SET ERROR-EDI TO TRUE                                  12540000
125500           SET INVALID-BASIS-DATE-CD TO TRUE                      12550000
125600           MOVE EDI-ERROR-CD TO                                   12560000
125700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        12570000
125800                                                                  12580000
125900     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '05' AND           12590000
126000        (AP050-ALLW-CHG-TYPE OF WS-WORK-REC = 'A' OR 'C')         12600000
126100        IF AP050-ALLOWANCE OF WS-WORK-REC                         12610000
126200           IF AP050-VALID-ALLW-CDES OF WS-WORK-REC                12620000
126300              CONTINUE                                            12630000
126400           ELSE                                                   12640000
126500              IF REJ-INDX NOT = 25                                12650000
126600                 SET REJ-INDX UP BY 1                             12660000
126700              END-IF                                              12670000
126800              SET ERROR-EDI TO TRUE                               12680000
126900              SET INVALID-ALLOW-CD TO TRUE                        12690000
127000              MOVE EDI-ERROR-CD TO                                12700000
127100                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      12710000
127200        ELSE                                                      12720000
127300           IF AP050-CHARGE OF WS-WORK-REC                         12730000
127400              IF AP050-VALID-CHRG-CDES OF WS-WORK-REC             12740000
127500                 NEXT SENTENCE                                    12750000
127600              ELSE                                                12760000
127700                 IF REJ-INDX NOT = 25                             12770000
127800                    SET REJ-INDX UP BY 1                          12780000
127900                 END-IF                                           12790000
128000                 SET ERROR-EDI TO TRUE                            12800000
128100                 SET INVALID-CHRG-CD TO TRUE                      12810000
128200                 MOVE EDI-ERROR-CD TO                             12820000
128300                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      12830000
128400           ELSE                                                   12840000
128500              IF AP050-NO-ALLW-CHGS OF WS-WORK-REC                12850000
128600                 IF AP050-ALLW-CHRG-CODE     OF WS-WORK-REC =     12860000
128700                                                   SPACES   AND   12870000
128800                    AP050-ALLW-CHRG-MTHD     OF WS-WORK-REC =     12880000
128900                                                   SPACES   AND   12890000
129000                    AP050-ALLW-CHRG-TOTAL    OF WS-WORK-REC =     12900000
129100                                                   ZEROS    AND   12910000
129200                    AP050-ALLW-CHRG-PCT      OF WS-WORK-REC =     12920000
129300                                                   ZEROS    AND   12930000
129400                    AP050-ALLW-CHRG-PCT-QUAL OF WS-WORK-REC =     12940000
129500                                                   SPACE          12950000
129600                    NEXT SENTENCE                                 12960000
129700                 ELSE                                             12970000
129800                    IF REJ-INDX NOT = 25                          12980000
129900                       SET REJ-INDX UP BY 1                       12990000
130000                    END-IF                                        13000000
130100                    SET ERROR-EDI TO TRUE                         13010000
130200                    SET CHRG-CD-N-DATA-PRESENT TO TRUE            13020000
130300                    MOVE EDI-ERROR-CD TO                          13030000
130400                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   13040000
130500              ELSE                                                13050000
130600                 IF REJ-INDX NOT = 25                             13060000
130700                    SET REJ-INDX UP BY 1                          13070000
130800                 END-IF                                           13080000
130900                 SET ERROR-EDI TO TRUE                            13090000
131000                 SET NOT-VALID-ALLW-CHG-TYPE-CD TO TRUE           13100000
131100                 MOVE EDI-ERROR-CD TO                             13110000
131200                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     13120000
131300                                                                  13130000
131400     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '05'               13140000
131500        IF AP050-SPEC-SRVC-CODE OF WS-WORK-REC  = SPACES          13150000
131600          OR                                                      13160000
131700          (AP050-FREE-GOODS OF WS-WORK-REC OR                     13170000
131800           AP050-TICKETING-SRVC OF WS-WORK-REC OR                 13180000
131900           AP050-DELIVERY-SRVC  OF WS-WORK-REC OR                 13190000
132000           AP050-MUTL-DEFN-SRVC OF WS-WORK-REC OR                 13200000
132100           AP050-HANGER-CHRG    OF WS-WORK-REC )                  13210000
132200             IF AP050-HANGER-CHRG OF WS-WORK-REC                  13220000
132300                SET AP050-CHARGE OF WS-WORK-REC TO TRUE           13230000
132400                MOVE 'HGR' TO AP050-ALLW-CHRG-CODE OF WS-WORK-REC 13240000
132500                IF WS-VENDOR-IS-LI-FUNG                           13250000
132600                   MOVE AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC TO   13260000
132700                        WS-LI-FUNG-HANGER-AMT                     13270000
132800                END-IF                                            13280000
132900             END-IF                                               13290000
133000        ELSE                                                      13300000
133100           IF REJ-INDX NOT = 25                                   13310000
133200              SET REJ-INDX UP BY 1                                13320000
133300           END-IF                                                 13330000
133400           SET ERROR-EDI TO TRUE                                  13340000
133500           SET INVALID-SPEC-SRV-CD TO TRUE                        13350000
133600           MOVE EDI-ERROR-CD TO                                   13360000
133700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        13370000
133800                                                                  13380000
133900     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '05'               13390000
134000        IF AP050-ALLW-CHRG-PCT-QUAL OF WS-WORK-REC NOT = SPACES   13400000
134100           IF AP050-DISCOUNT-GROSS OF WS-WORK-REC                 13410000
134200               NEXT SENTENCE                                      13420000
134300           ELSE                                                   13430000
134400              IF REJ-INDX NOT = 25                                13440000
134500                 SET REJ-INDX UP BY 1                             13450000
134600              END-IF                                              13460000
134700              SET ERROR-EDI TO TRUE                               13470000
134800              SET INVALID-ALLW-CHRG-PCT-CD TO TRUE                13480000
134900              MOVE EDI-ERROR-CD TO                                13490000
135000                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      13500000
135100        ELSE                                                      13510000
135200           SET AP050-DISCOUNT-GROSS OF WS-WORK-REC TO TRUE        13520000
135300           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX).              13530000
135400                                                                  13540000
135500     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '06'               13550000
135600        IF AP050-GROSS-INVOICE-AMT OF WS-WORK-REC = 0             13560000
135700           IF REJ-INDX NOT = 25                                   13570000
135800              SET REJ-INDX UP BY 1                                13580000
135900           END-IF                                                 13590000
136000           SET ERROR-EDI TO TRUE                                  13600000
136100           SET NO-GROSS-INVC-CD TO TRUE                           13610000
136200           MOVE EDI-ERROR-CD TO                                   13620000
136300                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        13630000
136400                                                                  13640000
136500     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               13650000
136600        IF AP050-ID-QUALIFIER OF WS-WORK-REC NOT = SPACES         13660000
136700           IF NOT AP050-EAN OF WS-WORK-REC AND                    13670000
136800              NOT AP050-UPC OF WS-WORK-REC                        13680000
136900              IF REJ-INDX NOT = 25                                13690000
137000                 SET REJ-INDX UP BY 1                             13700000
137100              END-IF                                              13710000
137200              SET ERROR-EDI TO TRUE                               13720000
137300              SET INVALID-ID-QUAL-CD TO TRUE                      13730000
137400              MOVE EDI-ERROR-CD TO                                13740000
137500                              WS-INV-ERR-CD(INV-INDX, REJ-INDX).  13750000
137600                                                                  13760000
137700     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               13770000
137800        IF ((AP050-EAN OF WS-WORK-REC OR                          13780000
137900             AP050-UPC OF WS-WORK-REC)                            13790000
138000           AND                                                    13800000
138100             AP050-EAN-UPC OF WS-WORK-REC NOT = SPACES)           13810000
138200          OR                                                      13820000
138300           AP050-VENDOR-STYLE OF WS-WORK-REC NOT = SPACES         13830000
138400           NEXT SENTENCE                                          13840000
138500        ELSE                                                      13850000
138600           IF REJ-INDX NOT = 25                                   13860000
138700              SET REJ-INDX UP BY 1                                13870000
138800           END-IF                                                 13880000
138900           SET ERROR-EDI TO TRUE                                  13890000
139000           SET NO-ITEM-ID-CD TO TRUE                              13900000
139100           MOVE EDI-ERROR-CD TO                                   13910000
139200                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     13920000
139300                                                                  13930000
139400     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               13940000
139500        IF AP050-QUANTITY-INVOICED OF WS-WORK-REC                 13950000
139600                                         NOT NUMERIC              13960000
139700           IF REJ-INDX NOT = 25                                   13970000
139800              SET REJ-INDX UP BY 1                                13980000
139900           END-IF                                                 13990000
140000           SET ERROR-EDI TO TRUE                                  14000000
140100           SET NO-QUANTITY-INVOICED-CD TO TRUE                    14010000
140200           MOVE EDI-ERROR-CD TO                                   14020000
140300                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     14030000
140400                                                                  14040000
140500     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               14050000
140600        IF NOT AP050-IT1-MSR-EACH    OF WS-WORK-REC AND           14060000
140700           NOT AP050-IT1-MSR-PACK    OF WS-WORK-REC AND           14070000
140800           NOT AP050-IT1-MSR-PAIR    OF WS-WORK-REC AND           14080000
140900           NOT AP050-IT1-MSR-SET     OF WS-WORK-REC AND           14090000
141000           NOT AP050-IT1-MSR-PK-HDR  OF WS-WORK-REC AND           14100000
141100           NOT AP050-IT1-MSR-PK-ITEM OF WS-WORK-REC               14110000
141200           IF REJ-INDX NOT = 25                                   14120000
141300              SET REJ-INDX UP BY 1                                14130000
141400           END-IF                                                 14140000
141500           SET ERROR-EDI TO TRUE                                  14150000
141600           SET INVALID-QTY-INVD-UOM-CD TO TRUE                    14160000
141700           MOVE EDI-ERROR-CD TO                                   14170000
141800                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     14180000
141900                                                                  14190000
142000     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               14200000
142100        IF AP050-IT1-MSR-PK-ITEM  OF WS-WORK-REC AND              14210000
142200           WS-VENDOR-IS-LI-FUNG                                   14220000
142300           SET LI-FUNG-PREPACK-FOUND TO TRUE                      14230000
142400        END-IF                                                    14240000
142500     END-IF.                                                      14250000
142600                                                                  14260000
142700     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               14270000
142800        IF AP050-WHOLSALE-UNIT-COST OF WS-WORK-REC                14280000
142900                                       NOT NUMERIC OR             14290000
143000           AP050-WHOLSALE-UNIT-COST OF WS-WORK-REC = 0            14300000
143100           IF REJ-INDX NOT = 25                                   14310000
143200              SET REJ-INDX UP BY 1                                14320000
143300           END-IF                                                 14330000
143400           SET ERROR-EDI TO TRUE                                  14340000
143500           SET NO-UNIT-COST-CD TO TRUE                            14350000
143600           MOVE EDI-ERROR-CD TO                                   14360000
143700                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     14370000
143800                                                                  14380000
143900*---------------------------------------------------------------  14390000
144000* DATE VALIDATION                                                 14400000
144100*---------------------------------------------------------------  14410000
144200                                                                  14420000
144300     SET WS-VALID-DATE TO TRUE.                                   14430000
144400     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '01'               14440000
144500        IF AP050-INTRCHG-DATE  OF WS-WORK-REC NOT NUMERIC         14450000
144600           SET WS-NOT-VALID-DATE TO TRUE                          14460000
144700        ELSE                                                      14470000
144800           IF AP050-INTRCHG-DATE OF WS-WORK-REC NOT = '000000'    14480000
144900              MOVE AP050-INTRCHG-DATE OF WS-WORK-REC TO           14490000
145000                                                  WS-YYMMDD       14500000
145100              PERFORM E400-CHECK-DATE                             14510000
145200           END-IF                                                 14520000
145300        END-IF                                                    14530000
145400        IF WS-NOT-VALID-DATE                                      14540000
145500           IF REJ-INDX NOT = 25                                   14550000
145600              SET REJ-INDX UP BY 1                                14560000
145700           END-IF                                                 14570000
145800           SET ERROR-EDI TO TRUE                                  14580000
145900           SET INTERCHG-DATE-NOT-VALID-CD TO TRUE                 14590000
146000           MOVE EDI-ERROR-CD TO                                   14600000
146100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        14610000
146200                                                                  14620000
146300     SET WS-VALID-DATE TO TRUE.                                   14630000
146400     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '02'               14640000
146500        IF AP050-DATE-SHIPPED OF WS-WORK-REC NOT NUMERIC          14650000
146600           SET WS-NOT-VALID-DATE TO TRUE                          14660000
146700        ELSE                                                      14670000
146800           IF AP050-DATE-SHIPPED OF WS-WORK-REC NOT = '000000'    14680000
146900              MOVE AP050-DATE-SHIPPED OF WS-WORK-REC TO           14690000
147000                                                  WS-YYMMDD       14700000
147100              PERFORM E400-CHECK-DATE                             14710000
147200           END-IF                                                 14720000
147300        END-IF                                                    14730000
147400        IF WS-NOT-VALID-DATE                                      14740000
147500           IF REJ-INDX NOT = 25                                   14750000
147600              SET REJ-INDX UP BY 1                                14760000
147700           END-IF                                                 14770000
147800           SET ERROR-EDI TO TRUE                                  14780000
147900           SET DATE-SHIPPED-NOT-VALID-CD TO TRUE                  14790000
148000           MOVE EDI-ERROR-CD TO                                   14800000
148100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        14810000
148200                                                                  14820000
148300     SET WS-VALID-DATE TO TRUE.                                   14830000
148400     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '02'               14840000
148500        IF AP050-EFFECTIVE-DATE OF WS-WORK-REC NUMERIC AND        14850000
148600           AP050-EFFECTIVE-DATE OF WS-WORK-REC NOT = '000000'     14860000
148700           MOVE AP050-EFFECTIVE-DATE OF WS-WORK-REC TO            14870000
148800                                               WS-YYMMDD          14880000
148900           PERFORM E400-CHECK-DATE                                14890000
149000        ELSE                                                      14900000
149100           IF AP050-EFFECTIVE-DATE OF WS-WORK-REC = SPACES OR     14910000
149200                                                  '000000'        14920000
149300              CONTINUE                                            14930000
149400           ELSE                                                   14940000
149500              SET WS-NOT-VALID-DATE TO TRUE                       14950000
149600           END-IF                                                 14960000
149700        END-IF                                                    14970000
149800        IF WS-NOT-VALID-DATE                                      14980000
149900           IF REJ-INDX NOT = 25                                   14990000
150000              SET REJ-INDX UP BY 1                                15000000
150100           END-IF                                                 15010000
150200           SET ERROR-EDI TO TRUE                                  15020000
150300           SET EFFECT-DATE-NOT-VALID-CD TO TRUE                   15030000
150400           MOVE EDI-ERROR-CD TO                                   15040000
150500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        15050000
150600                                                                  15060000
150700*---------------------------------------------------------------  15070000
150800* CALCULATE DISCOUNT DAYS DUE IF DISCOUNT DATE IS PRESENT AND     15080000
150900* VALID                                                           15090000
151000*---------------------------------------------------------------  15100000
151100                                                                  15110000
151200     SET WS-VALID-DATE TO TRUE.                                   15120000
151300     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '04'               15130000
151400        IF AP050-DISC-DUE-DATE OF WS-WORK-REC NUMERIC AND         15140000
151500           AP050-DISC-DUE-DATE OF WS-WORK-REC NOT = '000000'      15150000
151600           MOVE AP050-DISC-DUE-DATE  OF WS-WORK-REC TO            15160000
151700                                        WS-YYMMDD                 15170000
151800           PERFORM E400-CHECK-DATE                                15180000
151900        ELSE                                                      15190000
152000           IF AP050-DISC-DUE-DATE OF WS-WORK-REC = SPACES OR      15200000
152100                                                  '000000'        15210000
152200              CONTINUE                                            15220000
152300           ELSE                                                   15230000
152400              SET WS-NOT-VALID-DATE TO TRUE                       15240000
152500           END-IF                                                 15250000
152600        END-IF                                                    15260000
152700        IF WS-NOT-VALID-DATE                                      15270000
152800           IF REJ-INDX NOT = 25                                   15280000
152900              SET REJ-INDX UP BY 1                                15290000
153000           END-IF                                                 15300000
153100           SET ERROR-EDI TO TRUE                                  15310000
153200           SET DISC-DUE-DATE-NOT-VALID-CD TO TRUE                 15320000
153300           MOVE EDI-ERROR-CD TO                                   15330000
153400                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         15340000
153500        END-IF                                                    15350000
153600        SET WS-VALID-DATE TO TRUE                                 15360000
153700        IF AP050-NET-DUE-DATE OF WS-WORK-REC NUMERIC AND          15370000
153800           AP050-NET-DUE-DATE OF WS-WORK-REC NOT = '000000'       15380000
153900           MOVE AP050-NET-DUE-DATE   OF WS-WORK-REC TO            15390000
154000                                           WS-YYMMDD              15400000
154100           PERFORM E400-CHECK-DATE                                15410000
154200        ELSE                                                      15420000
154300           IF AP050-NET-DUE-DATE OF WS-WORK-REC = SPACES OR       15430000
154400                                                 '000000'         15440000
154500              CONTINUE                                            15450000
154600           ELSE                                                   15460000
154700              SET WS-NOT-VALID-DATE TO TRUE                       15470000
154800           END-IF                                                 15480000
154900        END-IF                                                    15490000
155000        IF WS-NOT-VALID-DATE                                      15500000
155100           IF REJ-INDX NOT = 25                                   15510000
155200              SET REJ-INDX UP BY 1                                15520000
155300           END-IF                                                 15530000
155400           SET ERROR-EDI TO TRUE                                  15540000
155500           SET NET-DUE-DATE-NOT-VALID-CD TO TRUE                  15550000
155600           MOVE EDI-ERROR-CD TO                                   15560000
155700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         15570000
155800        END-IF                                                    15580000
155900        SET WS-VALID-DATE TO TRUE                                 15590000
156000        IF AP050-DEFERRED-DUE-DATE OF WS-WORK-REC NUMERIC AND     15600000
156100           AP050-DEFERRED-DUE-DATE OF WS-WORK-REC NOT = '000000'  15610000
156200           MOVE AP050-DEFERRED-DUE-DATE OF WS-WORK-REC TO         15620000
156300                                              WS-YYMMDD           15630000
156400           PERFORM E400-CHECK-DATE                                15640000
156500        ELSE                                                      15650000
156600           IF AP050-DEFERRED-DUE-DATE OF WS-WORK-REC              15660000
156700                                  = SPACES OR '000000'            15670000
156800              CONTINUE                                            15680000
156900           ELSE                                                   15690000
157000              SET WS-NOT-VALID-DATE TO TRUE                       15700000
157100           END-IF                                                 15710000
157200        END-IF                                                    15720000
157300        IF WS-NOT-VALID-DATE                                      15730000
157400           IF REJ-INDX NOT = 25                                   15740000
157500              SET REJ-INDX UP BY 1                                15750000
157600           END-IF                                                 15760000
157700           SET ERROR-EDI TO TRUE                                  15770000
157800           SET DEFER-DUE-DATE-NOT-VALID-CD TO TRUE                15780000
157900           MOVE EDI-ERROR-CD TO                                   15790000
158000                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         15800000
158100        END-IF                                                    15810000
158200     END-IF.                                                      15820000
158300                                                                  15830000
158400*---------------------------------------------------------------  15840000
158500* STORE VALIDATION                                                15850000
158600*---------------------------------------------------------------  15860000
158700                                                                  15870000
158800     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '02'               15880000
158900        IF AP050-KOHLS-STORE-NBR1 OF WS-WORK-REC = SPACES         15890000
159000           SET WS-NOT-VALID-STORE TO TRUE                         15900000
159100           MOVE SPACES TO WS-SAVE-STORE-NBR                       15910000
159200        END-IF                                                    15920000
159300        IF AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC = SPACES         15930000
159400           SET WS-NOT-VALID-STORE2 TO TRUE                        15940000
159500           MOVE SPACES TO WS-SAVE-STORE-NBR2                      15950000
159600        END-IF                                                    15960000
159700        IF AP050-KOHLS-STORE-NBR1 OF WS-WORK-REC NOT = SPACES     15970000
159800           IF AP050-KOHLS-STORE-NBR1 OF WS-WORK-REC NOT =         15980000
159900                                     WS-SAVE-STORE-NBR            15990000
160000              PERFORM R300-VALIDATE-STORE                         16000000
160100           END-IF                                                 16010000
160200        END-IF                                                    16020000
160300        MOVE ZEROS TO WS-AP055-STORE                              16030000
160400        IF WS-VALID-STORE                                         16040000
160500           MOVE AP050-KOHLS-STORE-NBR1 OF WS-WORK-REC             16050000
160600                TO WS-AP055-STORE                                 16060000
160700           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               16070000
160800        ELSE                                                      16080000
160900           IF WS-VALID-DC                                         16090000
161000              IF AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC            16100000
161100                                        NOT = SPACES              16110000
161200                 IF AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC         16120000
161300                              NOT =  WS-SAVE-STORE-NBR2           16130000
161400                    PERFORM R350-VALIDATE-STORE                   16140000
161500                 END-IF                                           16150000
161600                 IF WS-VALID-STORE2                               16160000
161700                    MOVE AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC    16170000
161800                               TO WS-AP055-STORE                  16180000
161900                    MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)      16190000
162000                 END-IF                                           16200000
162100              END-IF                                              16210000
162200           ELSE                                                   16220000
162300              MOVE SPACES TO WS-SAVE-STORE-NBR                    16230000
162400              IF AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC            16240000
162500                                        NOT = SPACES              16250000
162600                 IF AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC         16260000
162700                              NOT =  WS-SAVE-STORE-NBR2           16270000
162800                    PERFORM R350-VALIDATE-STORE                   16280000
162900                 END-IF                                           16290000
163000                 IF WS-VALID-STORE2                               16300000
163100                    MOVE AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC    16310000
163200                               TO WS-AP055-STORE                  16320000
163300                    MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)      16330000
163400                 ELSE                                             16340000
163500                    IF WS-VALID-DC2                               16350000
163600                       CONTINUE                                   16360000
163700                    ELSE                                          16370000
163800                       MOVE SPACES TO WS-SAVE-STORE-NBR2          16380000
163900                       IF REJ-INDX NOT = 25                       16390000
164000                          SET REJ-INDX UP BY 1                    16400000
164100                       END-IF                                     16410000
164200                       SET ERROR-EDI TO TRUE                      16420000
164300                       SET STORE-NBR-NOT-VALID TO TRUE            16430000
164400                       MOVE EDI-ERROR-CD TO                       16440000
164500                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   16450000
164600                    END-IF                                        16460000
164700                 END-IF                                           16470000
164800              ELSE                                                16480000
164900                 IF REJ-INDX NOT = 25                             16490000
165000                    SET REJ-INDX UP BY 1                          16500000
165100                 END-IF                                           16510000
165200                 SET ERROR-EDI TO TRUE                            16520000
165300                 SET STORE-NBR-NOT-VALID TO TRUE                  16530000
165400                 MOVE EDI-ERROR-CD TO                             16540000
165500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         16550000
165600              END-IF                                              16560000
165700           END-IF                                                 16570000
165800        END-IF.                                                   16580000
165900                                                                  16590000
166000*---------------------------------------------------------------  16600000
166100* UPC/SKU VALIDATION - IF THE UPC AND SKU ARE NOT SENT OR ARE     16610000
166200* NOT VALID, RETRIEVE THE PO_LNE_NBR FROM THE TPURITM TABLE       16620000
166300* WITH THE STYLE CODE.                                            16630000
166400*---------------------------------------------------------------  16640000
166500                                                                  16650000
166600     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               16660000
166700        MOVE ZEROS TO AP050-PO-LNE-NBR OF WS-WORK-REC             16670000
166800        MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)                  16680000
166900        INITIALIZE DCLTPURCHS                                     16690000
167000        INITIALIZE DCLTPURITM                                     16700000
167100        IF AP050-UPC OF WS-WORK-REC                               16710000
167200           IF AP050-UPC-CODE OF WS-WORK-REC NUMERIC               16720000
167300              MOVE AP050-UPC-CODE OF WS-WORK-REC TO WS-UPC-CODE   16730000
167400              MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3               16740000
167500              PERFORM R400-SELECT-TUPCSKU                         16750000
167600           ELSE                                                   16760000
167700              SET WS-NOT-VALID-UPC TO TRUE                        16770000
167800           END-IF                                                 16780000
167900           IF WS-NOT-VALID-UPC                                    16790000
168000              CONTINUE                                            16800000
168100           ELSE                                                   16810000
168200              PERFORM R450-SELECT-PO-BY-ITEM-NBR                  16820000
168300              MOVE PURITM-PO-LNE-NBR TO AP050-PO-LNE-NBR          16830000
168400                                              OF WS-WORK-REC      16840000
168500              MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)            16850000
168600           END-IF                                                 16860000
168700        END-IF                                                    16870000
168800     END-IF.                                                      16880000
168900                                                                  16890000
169000** IF THE UPC AND SKU ARE NOT SENT OR ARE NOT VALID,              16900000
169100** RETRIEVE THE PO_LNE_NBR FROM THE TPURITM TABLE WITH THE        16910000
169200** STYLE CODE                                                     16920000
169300     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '07'               16930000
169400        IF AP050-PO-LNE-NBR OF WS-WORK-REC NOT = ZEROS            16940000
169500           CONTINUE                                               16950000
169600        ELSE                                                      16960000
169700           IF AP050-VENDOR-STYLE OF WS-WORK-REC NOT = SPACES      16970000
169800              MOVE AP050-VENDOR-STYLE OF WS-WORK-REC TO           16980000
169900                                         WS-STYLE                 16990000
170000              MOVE SPACES TO WS-STYLE2                            17000000
170100              INSPECT WS-STYLE REPLACING LEADING '0' BY ' '       17010000
170200              SET STYLE-INDX2 TO 1                                17020000
170300              PERFORM VARYING STYLE-INDX FROM 1 BY 1              17030000
170400                UNTIL STYLE-INDX > 20                             17040000
170500                IF WS-STYLE-ONE(STYLE-INDX) = ' ' OR '-' OR '/'   17050000
170600                   CONTINUE                                       17060000
170700                ELSE                                              17070000
170800                   MOVE WS-STYLE-ONE(STYLE-INDX) TO               17080000
170900                           WS-STYLE2-ONE(STYLE-INDX2)             17090000
171000                   SET STYLE-INDX2 UP BY 1                        17100000
171100                END-IF                                            17110000
171200              END-PERFORM                                         17120000
171300              PERFORM R485-SELECT-PO-LNE-NBR                      17130000
171400              MOVE PURITM-PO-LNE-NBR TO AP050-PO-LNE-NBR          17140000
171500                                        OF WS-WORK-REC            17150000
171600              MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX).           17160000
171700                                                                  17170000
171800*---------------------------------------------------------------  17180000
171900* ALLOWANCE OR CHARGE VALIDATION                                  17190000
172000*---------------------------------------------------------------  17200000
172100                                                                  17210000
172200     IF AP050-RECORD-TYPE-IND OF WS-WORK-REC = '05'               17220000
172300        IF NOT AP050-NO-ALLW-CHGS OF WS-WORK-REC                  17230000
172400           IF AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC > 0            17240000
172500             AND                                                  17250000
172600              AP050-ALLW-CHRG-PCT OF WS-WORK-REC > 0              17260000
172700              IF REJ-INDX NOT = 25                                17270000
172800                 SET REJ-INDX UP BY 1                             17280000
172900              END-IF                                              17290000
173000              SET ERROR-EDI TO TRUE                               17300000
173100              SET NOT-BOTH-ALLW-CHRG-CD TO TRUE                   17310000
173200              MOVE EDI-ERROR-CD TO                                17320000
173300                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      17330000
173400           ELSE                                                   17340000
173500              IF AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC = 0         17350000
173600                AND                                               17360000
173700                 AP050-ALLW-CHRG-PCT   OF WS-WORK-REC = 0         17370000
173800                 IF REJ-INDX NOT = 25                             17380000
173900                    SET REJ-INDX UP BY 1                          17390000
174000                 END-IF                                           17400000
174100                 SET ERROR-EDI TO TRUE                            17410000
174200                 SET ONE-ALLW-CHRG-CD TO TRUE                     17420000
174300                 MOVE EDI-ERROR-CD TO                             17430000
174400                           WS-INV-ERR-CD(INV-INDX, REJ-INDX).     17440000
174500                                                                  17450000
174600*--------------------------------------------------------------*  17460000
174700* EDITS TO VERIFY THAT THERE ARE IS AT LEAST ONE OF EACH OF THE*  17470000
174800* FOLLOWING RECORD TYPES: 01, 02, 03, 06, AND 07.  THE SAVED   *  17480000
174900* INVOICE NUMBER MUST BE MOVED TO THE OCCURANCE OF THE INV-INDX*  17490000
175000* BECAUSE AT THIS POINT THE INV-INDX IS AT 10998 OR AT THE     *  17500000
175100* NUMBER OF INVOICE RECORDS +1 AND THERE IS NOT A TRANSMITTED  *  17510000
175200* EDI INVOICE RECORD LOADED THERE.                             *  17520000
175300*--------------------------------------------------------------*  17530000
175400 E300-EDIT-ALL.                                                   17540000
175500                                                                  17550000
175600*---------------------------------------------------------------  17560000
175700* EDIT TO VERIFY THAT THE FIRST RECORD TYPE WAS AN 01             17570000
175800*---------------------------------------------------------------  17580000
175900                                                                  17590000
176000     IF WS-AP050-REC-TYPE(1) NOT = '01'                           17600000
176100        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     17610000
176200        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    17620000
176300        IF REJ-INDX NOT = 25                                      17630000
176400           SET REJ-INDX UP BY 1                                   17640000
176500        END-IF                                                    17650000
176600        SET ERROR-EDI TO TRUE                                     17660000
176700        SET FIRST-REC-NOT-01 TO TRUE                              17670000
176800        MOVE EDI-ERROR-CD TO                                      17680000
176900             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    17690000
177000     END-IF.                                                      17700000
177100                                                                  17710000
177200     IF WS-REC-01-CNT = 0                                         17720000
177300        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     17730000
177400        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    17740000
177500        IF REJ-INDX NOT = 25                                      17750000
177600           SET REJ-INDX UP BY 1                                   17760000
177700        END-IF                                                    17770000
177800        SET ERROR-EDI TO TRUE                                     17780000
177900        SET NO-01-REC-CD TO TRUE                                  17790000
178000        MOVE EDI-ERROR-CD TO                                      17800000
178100                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           17810000
178200                                                                  17820000
178300     IF WS-REC-02-CNT = 0                                         17830000
178400        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     17840000
178500        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    17850000
178600        IF REJ-INDX NOT = 25                                      17860000
178700           SET REJ-INDX UP BY 1                                   17870000
178800        END-IF                                                    17880000
178900        SET ERROR-EDI TO TRUE                                     17890000
179000        SET NO-02-REC-CD TO TRUE                                  17900000
179100        MOVE EDI-ERROR-CD TO                                      17910000
179200                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           17920000
179300                                                                  17930000
179400     IF WS-REC-06-CNT = 0                                         17940000
179500        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     17950000
179600        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    17960000
179700        IF REJ-INDX NOT = 25                                      17970000
179800           SET REJ-INDX UP BY 1                                   17980000
179900        END-IF                                                    17990000
180000        SET ERROR-EDI TO TRUE                                     18000000
180100        SET NO-06-REC-CD TO TRUE                                  18010000
180200        MOVE EDI-ERROR-CD TO                                      18020000
180300                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           18030000
180400                                                                  18040000
180500     IF WS-REC-07-CNT = 0                                         18050000
180600        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     18060000
180700        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    18070000
180800        IF REJ-INDX NOT = 25                                      18080000
180900           SET REJ-INDX UP BY 1                                   18090000
181000        END-IF                                                    18100000
181100        SET ERROR-EDI TO TRUE                                     18110000
181200        SET NO-07-REC-CD TO TRUE                                  18120000
181300        MOVE EDI-ERROR-CD TO                                      18130000
181400                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           18140000
181500                                                                  18150000
181600*---------------------------------------------------------------  18160000
181700* EDIT TO VERIFY THAT THE LAST RECORD TYOE WAS AN 07              18170000
181800*---------------------------------------------------------------  18180000
181900                                                                  18190000
182000     IF WS-LAST-REC-TYPE = '07'                                   18200000
182100        NEXT SENTENCE                                             18210000
182200     ELSE                                                         18220000
182300        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     18230000
182400        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    18240000
182500        IF REJ-INDX NOT = 25                                      18250000
182600           SET REJ-INDX UP BY 1                                   18260000
182700        END-IF                                                    18270000
182800        SET ERROR-EDI TO TRUE                                     18280000
182900        SET LAST-REC-NOT-07 TO TRUE                               18290000
183000        MOVE EDI-ERROR-CD TO                                      18300000
183100             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    18310000
183200     END-IF.                                                      18320000
183300                                                                  18330000
183400*---------------------------------------------------------------  18340000
183500* EDITS FOR SUMMARIZATION OF EXTENDED AMOUNTS                     18350000
183600*---------------------------------------------------------------  18360000
183700                                                                  18370000
183800*    MOVE PV-ACCUM-CHRG TO PV-ACCUM-CHRG-PCT                      18380000
183900*    COMPUTE WS-DETAIL-ALLW-CHRG-AMT                              18390000
184000*       =    WS-DETAIL-ALLW-CHRG-AMT                              18400000
184100*       +    (((PV-ACCUM-CHRG-PCT                                 18410000
184200*              / 100) * WS-DETAIL-GROSS-INVOICE-AMT) + .005)      18420000
184300* 08-08-2001 CODE COPIED HERE FROM APKED201 TO GET ALLOWANCE      18430000
184400*            AMOUNT                                               18440000
184500     DIVIDE PV-ACCUM-CHRG BY 100 GIVING PV-ACCUM-CHRG-PCT.        18450000
184600     COMPUTE WS-DETAIL-CHRG-AMT = WS-DETAIL-CHRG-AMT +            18460000
184700     ((PV-ACCUM-CHRG-PCT * WS-DETAIL-GROSS-INVOICE-AMT) + .005).  18470000
184800* 08-08-2001 END                                                  18480000
184900                                                                  18490000
185000* IF LI & FUNG SENT PREPACKS WITH A HANGER CHARGE, THEN THE HANGER18500000
185100* CHARGE MUST BE SUBTRACTED OUT OF THE TOTAL CHARGES.  THIS IS    18510000
185200* BECAUSE THE HANGER CHARGE IS ALREADY IMBEDDED AS PART OF THE    18520000
185300* WS-DETAIL-GROSS-INVOICE-AMT.                                    18530000
185400     IF WS-VENDOR-IS-LI-FUNG AND                                  18540000
185500        LI-FUNG-PREPACK-FOUND                                     18550000
185600        COMPUTE WS-DETAIL-CHRG-AMT = WS-DETAIL-CHRG-AMT -         18560000
185700                WS-LI-FUNG-HANGER-AMT                             18570000
185800     END-IF.                                                      18580000
185900                                                                  18590000
186000*    MOVE PV-ACCUM-ALLW TO PV-ACCUM-ALLW-PCT                      18600000
186100*    COMPUTE WS-DETAIL-ALLW-CHRG-AMT                              18610000
186200*       =    WS-DETAIL-ALLW-CHRG-AMT                              18620000
186300*       -    (((PV-ACCUM-ALLW-PCT                                 18630000
186400*                 / 100) * WS-DETAIL-GROSS-INVOICE-AMT) + .005)   18640000
186500* 08-08-2001 CODE INSERTED HERE FROM APKED201 TO GET ALLOWANCE    18650000
186600*            CHARGE AMOUNT                                        18660000
186700     DIVIDE PV-ACCUM-ALLW BY 100 GIVING PV-ACCUM-ALLW-PCT.        18670000
186800     COMPUTE WS-DETAIL-ALLW-AMT = WS-DETAIL-ALLW-AMT +            18680000
186900     ((PV-ACCUM-ALLW-PCT * WS-DETAIL-GROSS-INVOICE-AMT) + .005).  18690000
187000* 08-08-2001 END                                                  18700000
187100                                                                  18710000
187200* 08-08-2001 ADDED NEXT CODE FROM APKED201                        18720000
187300     COMPUTE WS-DIFFERENCE                                        18730000
187400        =    WS-SAVE-GROSS-INVOICE-AMT                            18740000
187500        -   ((WS-DETAIL-GROSS-INVOICE-AMT +                       18750000
187600              WS-DETAIL-CHRG-AMT) - WS-DETAIL-ALLW-AMT).          18760000
187700* 08-08-2001 END                                                  18770000
187800                                                                  18780000
187900* 08-08-2001 COMMENT OUT NEXT IF STATEMENT                        18790000
188000*    IF WS-SAVE-GROSS-INVOICE-AMT NOT =                           18800000
188100*         (WS-DETAIL-GROSS-INVOICE-AMT  +                         18810000
188200*             WS-DETAIL-ALLW-CHRG-AMT)                            18820000
188300* 08-08-2001 WS-DIFFERENCE IS FROM APKED201                       18830000
188400     IF WS-DIFFERENCE NOT = 0                                     18840000
188500        IF WS-DIFFERENCE < 0                                      18850000
188600           COMPUTE WS-DIFFERENCE                                  18860000
188700              =    WS-DIFFERENCE                                  18870000
188800              *    -1                                             18880000
188900        END-IF                                                    18890000
189000        IF WS-DIFFERENCE < 0                                      18900000
189100           COMPUTE WS-DIFFERENCE =                                18910000
189200                   WS-DIFFERENCE *                                18920000
189300                   -1                                             18930000
189400        END-IF                                                    18940000
189500        IF WS-DIFFERENCE <= +1.25                                 18950000
189600           NEXT SENTENCE                                          18960000
189700        END-IF                                                    18970000
189800        MOVE WS-SAVE-PO-NBR      TO WS-AP050-PO-NBR(INV-INDX)     18980000
189900        MOVE WS-SAVE-INVOICE-NBR TO WS-AP050-INV-NBR(INV-INDX)    18990000
190000        SET ERR-DETAIL-GROSS-INVOICE TO TRUE                      19000000
190100        IF REJ-INDX NOT = 25                                      19010000
190200           SET REJ-INDX UP BY 1                                   19020000
190300        END-IF                                                    19030000
190400        SET ERROR-EDI TO TRUE                                     19040000
190500        SET SUM-EXTEN-NOT-EQ-GROSS-CD TO TRUE                     19050000
190600        MOVE EDI-ERROR-CD TO                                      19060000
190700                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           19070000
190800                                                                  19080000
190900*---------------------------------------------------------------  19090000
191000* EDIT TO VERIFY THAT THIS PURCHASE ORDER/INVOICE NUMBER          19100000
191100* COMBINATION HAS NOT BEEN PREVIOUSLY RECEIVED IN THIS            19110000
191200* PROCESSING.                                                     19120000
191300*---------------------------------------------------------------  19130000
191400                                                                  19140000
191500     MOVE WS-SAVE-PO-NBR-X    TO WS-SAVE-PO-INV-NBR(1:9).         19150001
191600     MOVE WS-SAVE-INVOICE-NBR TO WS-SAVE-PO-INV-NBR(10:22).       19160001
191700     PERFORM VARYING PO-INDX FROM 1 BY 1                          19170000
191800        UNTIL PO-INDX > 15000 OR                                  19180000
191900              WS-PO-INV-NBR(PO-INDX) = SPACES OR                  19190000
192000              WS-PO-INV-NBR(PO-INDX) = WS-SAVE-PO-INV-NBR         19200000
192100     END-PERFORM.                                                 19210000
192200                                                                  19220000
192300     IF PO-INDX > 15000                                           19230000
192400        DISPLAY '************** ABEND *************'              19240000
192500        DISPLAY '*   PO-INV  TABLE IS FULL -      *'              19250000
192600        DISPLAY '*   15000 PO-INV COMBINATIONS    *'              19260000
192700        DISPLAY '*   HAVE BEEN RECEIVED           *'              19270000
192800        DISPLAY '*   PROGRAM ** = APKED200        *'              19280000
192900        DISPLAY '*   PARAGRAPH  = E300-EDIT-ALL   *'              19290000
193000        DISPLAY '**********************************'              19300000
193100        SET PO-TABLE-FULL TO TRUE                                 19310000
193200        CALL 'ILBOABN0' USING ABEND-CODE                          19320000
193300     ELSE                                                         19330000
193400        IF WS-PO-INV-NBR(PO-INDX) = SPACES                        19340000
193500           MOVE WS-SAVE-PO-INV-NBR TO WS-PO-INV-NBR(PO-INDX)      19350000
193600        ELSE                                                      19360000
193700           MOVE WS-SAVE-PO-NBR   TO WS-AP050-PO-NBR(INV-INDX)     19370000
193800           MOVE WS-SAVE-INVOICE-NBR TO                            19380000
193900                                    WS-AP050-INV-NBR(INV-INDX)    19390000
194000           IF REJ-INDX NOT = 25                                   19400000
194100              SET REJ-INDX UP BY 1                                19410000
194200           END-IF                                                 19420000
194300           SET ERROR-EDI TO TRUE                                  19430000
194400           SET DUPL-PO-INV-COMBIN-CD TO TRUE                      19440000
194500           MOVE EDI-ERROR-CD TO                                   19450000
194600                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        19460000
194700                                                                  19470000
194800*--------------------------------------------------------------*  19480000
194900* CHECK THAT THE DATE ENTERED IS A VALID DATE                  *  19490000
195000*--------------------------------------------------------------*  19500000
195100 E400-CHECK-DATE.                                                 19510000
195200                                                                  19520000
195300     SET WS-NOT-VALID-DATE TO TRUE.                               19530000
195400                                                                  19540000
195500     IF  WS-YYMMDD                     > '000000'                 19550000
195600         IF WS-YY > 80                                            19560000
195700            MOVE '19' TO WS-CENTURY                               19570000
195800         ELSE                                                     19580000
195900            MOVE '20' TO WS-CENTURY                               19590000
196000         END-IF                                                   19600000
196100         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   19610000
196200         SET DPG52-LK-DTE-ISO           TO TRUE                   19620000
196300         MOVE WS-CCYYMMDD       TO DPG52-LK-DATE-INPUT            19630000
196400         MOVE SPACES                    TO WS-DATE-INVALID        19640000
196500                                                                  19650000
196600         CALL DP500-KOHLS-CALENDAR-ROUTINE                        19660000
196700                                     USING DPG51 DPG52 DPG53      19670000
196800                                           DPG54 DPG55 DPG56      19680000
196900                                                                  19690000
197000          IF (DPG54-SEVERE-ERROR                                  19700000
197100             OR                                                   19710000
197200              DPG54-WARNING-ERROR)                                19720000
197300              SET WS-NOT-VALID-DATE TO TRUE                       19730000
197400          ELSE                                                    19740000
197500             SET WS-VALID-DATE TO TRUE                            19750000
197600          END-IF                                                  19760000
197700     END-IF.                                                      19770000
197800                                                                  19780000
197900*--------------------------------------------------------------*  19790000
198000* CONVERT A ONE DIGIT TERMS BASIS CODE TO A TWO DIGIT WITH A   *  19800000
198100* LEADING ZERO                                                 *  19810000
198200*--------------------------------------------------------------*  19820000
198300 E500-CONVERT-CODE.                                               19830000
198400                                                                  19840000
198500     MOVE WS-CHECK-BASIS-DTE-CODE(1:1) TO                         19850000
198600             WS-CHECK-BASIS-DTE-CODE(2:1).                        19860000
198700                                                                  19870000
198800     MOVE '0' TO WS-CHECK-BASIS-DTE-CODE(1:1).                    19880000
198900     MOVE WS-CHECK-BASIS-DTE-CODE TO                              19890000
199000          AP050-TRMS-BASIS-DTE-CODE OF WS-WORK-REC.               19900000
199100                                                                  19910000
199200     MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX).                    19920000
199300                                                                  19930000
199400*--------------------------------------------------------------*  19940000
199500* FOR RECORD TYPE 07 AND UNIT MEASURE = AS RECORDS ONLY:       *  19950000
199600* CHECK THE PACKITEM WARNING INDICATORS FOR 'Y'.  IF THE       *  19960000
199700* INDICATORS ARE SET THEN SET THE APPROPRIATE WARNING MESSAGE  *  19970000
199800* FOR THE ERROR-CODE TABLE SO THAT THE WARNING WILL APPEAR ON  *  19980000
199900* ERROR REPORT OUTPUT FILE.                                    *  19990000
200000*--------------------------------------------------------------*  20000000
200100 E600-EDIT-PKITEM-WARN-INDS.                                      20010000
200200                                                                  20020000
200300     IF AP050-NO-DTL-SENT-IND OF WS-WORK-REC = 'Y'                20030000
200400        IF REJ-INDX NOT = 25                                      20040000
200500           SET REJ-INDX UP BY 1                                   20050000
200600        END-IF                                                    20060000
200700        SET PI-WARNING1-EXISTS TO TRUE                            20070000
200800        SET NO-PKITM-DTL-SENT-CD TO TRUE                          20080000
200900        MOVE EDI-ERROR-CD TO                                      20090000
201000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            20100000
201100     END-IF.                                                      20110000
201200                                                                  20120000
201300     IF AP050-DTL-SENT-NOT-BLNC-IND OF WS-WORK-REC = 'Y'          20130000
201400        IF REJ-INDX NOT = 25                                      20140000
201500           SET REJ-INDX UP BY 1                                   20150000
201600        END-IF                                                    20160000
201700        SET PI-WARNING2-EXISTS TO TRUE                            20170000
201800        SET PK-CST-NT-EQ-SUMD-PI-CST-CD TO TRUE                   20180000
201900        MOVE EDI-ERROR-CD TO                                      20190000
202000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            20200000
202100     END-IF.                                                      20210000
202200                                                                  20220000
202300     IF AP050-UPC-CANT-EXPLODE-IND OF WS-WORK-REC = 'Y'           20230000
202400        IF REJ-INDX NOT = 25                                      20240000
202500           SET REJ-INDX UP BY 1                                   20250000
202600        END-IF                                                    20260000
202700        SET ERROR-EDI TO TRUE                                     20270000
202800        SET PK-UPC-CANT-BE-EXPLODED-CD TO TRUE                    20280000
202900        MOVE EDI-ERROR-CD TO                                      20290000
203000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            20300000
203100     END-IF.                                                      20310000
203200                                                                  20320000
203300*--------------------------------------------------------------*  20330000
203400* GET DATE AND TIME, OPEN FILES, SET UP CONTROLS, ETC.         *  20340000
203500*--------------------------------------------------------------*  20350000
203600 H100-HOUSEKEEPING.                                               20360000
203700                                                                  20370000
203800     ACCEPT RUN-TIME FROM TIME.                                   20380000
203900     ACCEPT DATE-IN  FROM DATE.                                   20390000
204000                                                                  20400000
204100     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    20410000
204200                                                                  20420000
204300     OPEN  INPUT   EDIIN-AP050-FILE                               20430000
204400     OPEN  OUTPUT  REJOUT-AP051-FILE                              20440000
204500                   AFPOUT-AP055-FILE                              20450000
204600                   EDIOUT-AP051-CONS-FILE.                        20460000
204700                                                                  20470000
204800     INITIALIZE WS-PO-INV-TABLE-AREA.                             20480000
204900     INITIALIZE DCLTEXTENT.                                       20490000
205000     INITIALIZE DCLTMDSEAR.                                       20500000
205100     INITIALIZE DCLTPURCHS.                                       20510000
205200     INITIALIZE DCLTPURITM.                                       20520000
205300     INITIALIZE DCLXFT00017.                                      20530000
205400     INITIALIZE DCLTUPCSKU.                                       20540000
205500     INITIALIZE DCLTTRDPRT.                                       20550000
205600     INITIALIZE DCLTENTNME.                                       20560000
205700     INITIALIZE DCLTPOINST.                                       20570000
205800     INITIALIZE DCLTINSTCD.                                       20580000
205900                                                                  20590000
206000     PERFORM H200-INITIALIZE.                                     20600000
206100                                                                  20610000
206200*--------------------------------------------------------------*  20620000
206300* PERFORM SETTING THE TABLE KEY AREA TO HIGH VALUES SO THAT THE*  20630000
206400* END-OF-INVOICE CAN BE DETERMINED.  INITIALIZE THE REST OF THE*  20640000
206500* TABLE PER DATA DEFINITION.                                   *  20650000
206600*--------------------------------------------------------------*  20660000
206700 H200-INITIALIZE.                                                 20670000
206800                                                                  20680000
206900     PERFORM VARYING INV-INDX FROM 1 BY 1                         20690000
207000        UNTIL INV-INDX > 11000                                    20700000
207100        MOVE HIGH-VALUES TO WS-AP050-KEY-AREA(INV-INDX)           20710000
207200        INITIALIZE WS-AP050-DATA-AREA(INV-INDX)                   20720000
207300        INITIALIZE WS-INV-ERR-TBL-AREA(INV-INDX)                  20730000
207400     END-PERFORM.                                                 20740000
207500                                                                  20750000
207600     SET NO-ERR-DETAIL-GROSS-INVOICE TO TRUE.                     20760000
207700     SET WS-NOT-CONSOLIDATED TO TRUE.                             20770000
207800     SET LI-FUNG-PREPACK-NOT-FOUND TO TRUE.                       20780000
207900                                                                  20790000
208000     MOVE ZERO TO WS-TOT-INVC-LINES.                              20800000
208100     SET NOT-TOO-MANY-INVC-LINES     TO TRUE.                     20810000
208200     SET FIRST-07-REC-NOT-WRITTEN    TO TRUE.                     20820000
208300                                                                  20830000
208400     SET INV-INDX TO 1.                                           20840000
208500     SET INV-INDX DOWN BY 1.                                      20850000
208600     SET REJ-INDX TO 1.                                           20860000
208700     SET REJ-INDX DOWN BY 1.                                      20870000
208800                                                                  20880000
208900*--------------------------------------------------------------*  20890000
209000* READ IN THE FORMATTED EDI TRANSMISSION FILE                  *  20900000
209100*--------------------------------------------------------------*  20910000
209200 R100-READ-AP050.                                                 20920000
209300                                                                  20930000
209400     READ EDIIN-AP050-FILE INTO AP050-EDI-IN-FILE                 20940000
209500          AT END      SET END-OF-EDIIN TO TRUE.                   20950000
209600                                                                  20960000
209700     IF NOT END-OF-EDIIN                                          20970000
209800        ADD 1 TO WS-EDIIN-REC-CNT                                 20980000
209900        ADD 1 TO WS-TOT-INVC-LINES                                20990000
210000     END-IF.                                                      21000000
210100                                                                  21010000
210200*--------------------------------------------------------------*  21020000
210300* CHECK FOR VALID STORE NUMBER FOR STORES, DC'S AND BULK DC    *  21030000
210400*--------------------------------------------------------------*  21040000
210500 R300-VALIDATE-STORE.                                             21050000
210600                                                                  21060000
210700     INITIALIZE DCLXFT00017.                                      21070000
210800     MOVE ZERO TO PV-STORE-9                                      21080000
210900                  WS-SAVE-STORE-NBR-9                             21090000
211000                  WS-SAVE-STORE-NBR-9-UNPK.                       21100000
211100                                                                  21110000
211200     MOVE AP050-KOHLS-STORE-NBR1 OF WS-WORK-REC TO PV-STORE-9.    21120000
211300     MOVE PV-STORE-9 TO XFT00017-LOC-NBR.                         21130000
211400                                                                  21140000
211500     PERFORM WITH TEST AFTER                                      21150000
211600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 21160000
211700             UNTIL   WS-RETRY-COUNTER > 3  OR                     21170000
211800                     SQLCODE = ZERO OR                            21180000
211900                     SQLCODE = +100                               21190000
212000                                                                  21200000
212100             EXEC SQL                                             21210000
212200                 SELECT A.LOC_TYP_CDE                             21220000
212300                      , A.LOC_NBR                                 21230000
212400                 INTO  :XFT00017-LOC-TYP-CDE                      21240000
212500                     , :WS-SAVE-STORE-NBR-9                       21250000
212600                 FROM  XFT_LOC A                                  21260000
212700                 WHERE A.LOC_NBR      = :XFT00017-LOC-NBR         21270000
212800                   AND CURRENT DATE  <= A.FINCL_CLO_DTE           21280000
212900             END-EXEC                                             21290000
213000                                                                  21300000
213100             EVALUATE TRUE                                        21310000
213200                 WHEN SQLCODE = ZERO                              21320000
213300                 WHEN SQLCODE = +100                              21330000
213400                 WHEN SQLCODE = -904                              21340000
213500                 WHEN SQLCODE = -913                              21350000
213600                      CONTINUE                                    21360000
213700                                                                  21370000
213800                 WHEN SQLWARN0 NOT = SPACES                       21380000
213900                 WHEN SQLCODE  NOT = ZERO                         21390000
214000                      MOVE 'R300-VALIDATE-STORE           '       21400000
214100                                    TO WS-ABEND-PARAGRAPH         21410000
214200                      MOVE 'UNSUCCESSFUL SELECT STORE '           21420000
214300                                    TO WS-ABEND-OPERATION         21430000
214400                      MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1     21440000
214500                      MOVE '        ' TO WS-ABEND-STRUCTURE-2     21450000
214600                      PERFORM Z999-SQL-ERROR                      21460000
214700             END-EVALUATE                                         21470000
214800     END-PERFORM.                                                 21480000
214900                                                                  21490000
215000     IF WS-RETRY-COUNTER > 3                                      21500000
215100         MOVE 'R300-VALIDATE-STORE           '                    21510000
215200                       TO WS-ABEND-PARAGRAPH                      21520000
215300         MOVE 'MAX RETRIES EXCEEDED ON SELECT STORE '             21530000
215400                         TO WS-ABEND-OPERATION                    21540000
215500         PERFORM Z999-SQL-ERROR                                   21550000
215600     END-IF.                                                      21560000
215700                                                                  21570000
215800     EVALUATE TRUE                                                21580000
215900        WHEN SQLCODE = ZEROS                                      21590000
216000             MOVE ZERO                     TO PV-STORE-9          21600000
216100             MOVE WS-SAVE-STORE-NBR-9 TO WS-SAVE-STORE-NBR-9-UNPK 21610000
216200             MOVE WS-SAVE-STORE-NBR-9-UNPK TO PV-STORE-9          21620000
216300             MOVE PV-STORE-9               TO WS-SAVE-STORE-NBR   21630000
216400             IF XFT00017-LOC-TYP-CDE = 'DS' OR 'CS'               21640000
216500                SET WS-VALID-STORE TO TRUE                        21650000
216600             ELSE                                                 21660000
216700                IF XFT00017-LOC-TYP-CDE = 'DC' OR 'DE' OR 'NA'    21670000
216800                   SET WS-VALID-DC TO TRUE                        21680000
216900                ELSE                                              21690000
217000                   SET WS-NOT-VALID-STORE TO TRUE                 21700000
217100                END-IF                                            21710000
217200             END-IF                                               21720000
217300        WHEN SQLCODE = +100                                       21730000
217400             SET WS-NOT-VALID-STORE TO TRUE                       21740000
217500        WHEN OTHER                                                21750000
217600             MOVE 'R300-VALIDATE-STORE           ' TO             21760000
217700                                       WS-ABEND-PARAGRAPH         21770000
217800             MOVE 'UNSUCCESSFUL SELECT STORE '                    21780000
217900                           TO WS-ABEND-OPERATION                  21790000
218000             MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1              21800000
218100             MOVE '        ' TO WS-ABEND-STRUCTURE-2              21810000
218200             PERFORM Z999-SQL-ERROR                               21820000
218300     END-EVALUATE.                                                21830000
218400                                                                  21840000
218500     PERFORM U100-COMMIT.                                         21850000
218600                                                                  21860000
218700*--------------------------------------------------------------*  21870000
218800* CHECK FOR VALID STORE NUMBER FOR STORES, DC'S AND BULK DC    *  21880000
218900*--------------------------------------------------------------*  21890000
219000 R350-VALIDATE-STORE.                                             21900000
219100                                                                  21910000
219200     INITIALIZE DCLXFT00017.                                      21920000
219300     MOVE ZERO TO PV-STORE-9                                      21930000
219400                  WS-SAVE-STORE-NBR2-9                            21940000
219500                  WS-SAVE-STORE-NBR2-9-UNPK.                      21950000
219600                                                                  21960000
219700     MOVE AP050-KOHLS-STORE-NBR2 OF WS-WORK-REC TO PV-STORE-9.    21970000
219800     MOVE PV-STORE-9 TO XFT00017-LOC-NBR.                         21980000
219900                                                                  21990000
220000     PERFORM WITH TEST AFTER                                      22000000
220100             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 22010000
220200             UNTIL   WS-RETRY-COUNTER > 3  OR                     22020000
220300                     SQLCODE = ZERO OR                            22030000
220400                     SQLCODE = +100                               22040000
220500                                                                  22050000
220600             EXEC SQL                                             22060000
220700                 SELECT A.LOC_TYP_CDE                             22070000
220800                      , A.LOC_NBR                                 22080000
220900*                     , MAX(B.PO_STRT_DTE)                        22090000
221000                 INTO  :XFT00017-LOC-TYP-CDE                      22100000
221100                     , :WS-SAVE-STORE-NBR2-9                      22110000
221200                 FROM  XFT_LOC A                                  22120000
221300                 WHERE A.LOC_NBR      = :XFT00017-LOC-NBR         22130000
221400                   AND CURRENT DATE  <= A.FINCL_CLO_DTE           22140000
221500             END-EXEC                                             22150000
221600                                                                  22160000
221700             EVALUATE TRUE                                        22170000
221800                 WHEN SQLCODE = ZERO                              22180000
221900                 WHEN SQLCODE = +100                              22190000
222000                 WHEN SQLCODE = -904                              22200000
222100                 WHEN SQLCODE = -913                              22210000
222200                      CONTINUE                                    22220000
222300                                                                  22230000
222400                 WHEN SQLWARN0 NOT = SPACES                       22240000
222500                 WHEN SQLCODE  NOT = ZERO                         22250000
222600                      MOVE 'R350-VALIDATE-STORE           '       22260000
222700                                    TO WS-ABEND-PARAGRAPH         22270000
222800                      MOVE 'UNSUCCESSFUL SELECT STORE '           22280000
222900                                    TO WS-ABEND-OPERATION         22290000
223000                      MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1     22300000
223100                      MOVE '        ' TO WS-ABEND-STRUCTURE-2     22310000
223200                      PERFORM Z999-SQL-ERROR                      22320000
223300             END-EVALUATE                                         22330000
223400     END-PERFORM.                                                 22340000
223500                                                                  22350000
223600     IF WS-RETRY-COUNTER > 3                                      22360000
223700         MOVE 'R350-VALIDATE-STORE           '                    22370000
223800                       TO WS-ABEND-PARAGRAPH                      22380000
223900         MOVE 'MAX RETRIES EXCEEDED ON SELECT STORE '             22390000
224000                         TO WS-ABEND-OPERATION                    22400000
224100         PERFORM Z999-SQL-ERROR                                   22410000
224200     END-IF.                                                      22420000
224300                                                                  22430000
224400     EVALUATE TRUE                                                22440000
224500        WHEN SQLCODE = ZEROS                                      22450000
224600             MOVE ZERO                     TO PV-STORE-9          22460000
224700            MOVE WS-SAVE-STORE-NBR2-9 TO WS-SAVE-STORE-NBR2-9-UNPK22470000
224800            MOVE WS-SAVE-STORE-NBR2-9-UNPK TO PV-STORE-9          22480000
224900            MOVE PV-STORE-9                TO WS-SAVE-STORE-NBR2  22490000
225000             IF XFT00017-LOC-TYP-CDE = 'DS' OR 'CS'               22500000
225100                SET WS-VALID-STORE2 TO TRUE                       22510000
225200             ELSE                                                 22520000
225300                IF XFT00017-LOC-TYP-CDE = 'DC' OR 'DE' OR 'NA'    22530000
225400                   SET WS-VALID-DC2 TO TRUE                       22540000
225500                ELSE                                              22550000
225600                   SET WS-NOT-VALID-STORE2 TO TRUE                22560000
225700                END-IF                                            22570000
225800             END-IF                                               22580000
225900        WHEN SQLCODE = +100                                       22590000
226000             SET WS-NOT-VALID-STORE2 TO TRUE                      22600000
226100        WHEN OTHER                                                22610000
226200             MOVE 'R350-VALIDATE-STORE           ' TO             22620000
226300                                       WS-ABEND-PARAGRAPH         22630000
226400             MOVE 'UNSUCCESSFUL SELECT STORE '                    22640000
226500                           TO WS-ABEND-OPERATION                  22650000
226600             MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1              22660000
226700             MOVE '        ' TO WS-ABEND-STRUCTURE-2              22670000
226800             PERFORM Z999-SQL-ERROR                               22680000
226900     END-EVALUATE.                                                22690000
227000                                                                  22700000
227100     PERFORM U100-COMMIT.                                         22710000
227200                                                                  22720000
227300*--------------------------------------------------------------*  22730000
227400* CHECK FOR VALID UPC CODE                                     *  22740000
227500*--------------------------------------------------------------*  22750000
227600 R400-SELECT-TUPCSKU.                                             22760000
227700                                                                  22770000
227800     INITIALIZE DCLTUPCSKU.                                       22780000
227900                                                                  22790000
228000     PERFORM WITH TEST AFTER                                      22800000
228100             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 22810000
228200             UNTIL   WS-RETRY-COUNTER > 3  OR                     22820000
228300                     SQLCODE = ZERO OR                            22830000
228400                     SQLCODE = +100                               22840000
228500                                                                  22850000
228600             EXEC SQL                                             22860000
228700                 SELECT ITEM_NBR                                  22870000
228800                 INTO  :TUPCSKU-ITEM-NBR                          22880000
228900                 FROM  TUPCSKU                                    22890000
229000                 WHERE UPC_NBR = :WS-UPC-CODE-COMP3               22900000
229100             END-EXEC                                             22910000
229200                                                                  22920000
229300             EVALUATE TRUE                                        22930000
229400                 WHEN SQLCODE = ZERO                              22940000
229500                 WHEN SQLCODE = +100                              22950000
229600                 WHEN SQLCODE = -904                              22960000
229700                 WHEN SQLCODE = -913                              22970000
229800                      CONTINUE                                    22980000
229900                                                                  22990000
230000                 WHEN SQLWARN0 NOT = SPACES                       23000000
230100                 WHEN SQLCODE  NOT = ZERO                         23010000
230200                      MOVE 'R400-SELECT-TUPCSKU           '       23020000
230300                                    TO WS-ABEND-PARAGRAPH         23030000
230400                      MOVE 'UNSUCCESSFUL SELECT UPCSKU'           23040000
230500                                    TO WS-ABEND-OPERATION         23050000
230600                      MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1     23060000
230700                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     23070000
230800                      PERFORM Z999-SQL-ERROR                      23080000
230900             END-EVALUATE                                         23090000
231000     END-PERFORM.                                                 23100000
231100                                                                  23110000
231200     IF WS-RETRY-COUNTER > 3                                      23120000
231300         MOVE 'R400-SELECT-TUPCSKU           '                    23130000
231400                       TO WS-ABEND-PARAGRAPH                      23140000
231500         MOVE 'MAX RETRIES EXCEEDED ON SELECT UPCSKU'             23150000
231600                         TO WS-ABEND-OPERATION                    23160000
231700         PERFORM Z999-SQL-ERROR                                   23170000
231800     END-IF.                                                      23180000
231900                                                                  23190000
232000     EVALUATE TRUE                                                23200000
232100        WHEN SQLCODE = ZEROS                                      23210000
232200             SET WS-VALID-UPC TO TRUE                             23220000
232300        WHEN SQLCODE = +100                                       23230000
232400             SET WS-NOT-VALID-UPC TO TRUE                         23240000
232500        WHEN OTHER                                                23250000
232600             MOVE 'R400-SELECT-TUPCSKU           ' TO             23260000
232700                                       WS-ABEND-PARAGRAPH         23270000
232800             MOVE 'UNSUCCESSFUL SELECT UPCSKU'                    23280000
232900                           TO WS-ABEND-OPERATION                  23290000
233000             MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1              23300000
233100             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              23310000
233200             PERFORM Z999-SQL-ERROR                               23320000
233300     END-EVALUATE.                                                23330000
233400                                                                  23340000
233500*--------------------------------------------------------------*  23350000
233600* SELECT MATCHING SKU FOR PO LINE NBR FOR THE ITEM NBR         *  23360000
233700*--------------------------------------------------------------*  23370000
233800 R450-SELECT-PO-BY-ITEM-NBR.                                      23380000
233900                                                                  23390000
234000     INITIALIZE DCLTPURITM.                                       23400000
234100                                                                  23410000
234200     PERFORM WITH TEST AFTER                                      23420000
234300             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 23430000
234400             UNTIL   WS-RETRY-COUNTER > 3  OR                     23440000
234500                     SQLCODE = ZERO OR                            23450000
234600                     SQLCODE = +100 OR                            23460000
234700                     SQLCODE = -811                               23470000
234800                                                                  23480000
234900             EXEC SQL                                             23490000
235000                 SELECT C.PO_LNE_NBR                              23500000
235100                 INTO  :PURITM-PO-LNE-NBR                         23510000
235200                 FROM  TPURITM  C                                 23520000
235300                 WHERE C.PO_NBR         = :WS-SAVE-PO-NBR-COMP    23530000
235400                   AND C.ITM_NBR        = :TUPCSKU-ITEM-NBR       23540000
235500                   AND C.VER_STATUS_CDE = 'A'                     23550000
235600             END-EXEC                                             23560000
235700                                                                  23570000
235800             EVALUATE TRUE                                        23580000
235900                 WHEN SQLCODE = ZERO                              23590000
236000                 WHEN SQLCODE = +100                              23600000
236100                 WHEN SQLCODE = -904                              23610000
236200                 WHEN SQLCODE = -913                              23620000
236300                 WHEN SQLCODE = -811                              23630000
236400                      CONTINUE                                    23640000
236500                                                                  23650000
236600                 WHEN SQLWARN0 NOT = SPACES                       23660000
236700                 WHEN SQLCODE  NOT = ZERO                         23670000
236800                      MOVE 'R450-SELECT-PO-BY-ITEM-NBR    '       23680000
236900                                    TO WS-ABEND-PARAGRAPH         23690000
237000                      MOVE 'UNSUCCESSFUL SELECT UPCSKU'           23700000
237100                                    TO WS-ABEND-OPERATION         23710000
237200                      MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1     23720000
237300                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     23730000
237400                      PERFORM Z999-SQL-ERROR                      23740000
237500             END-EVALUATE                                         23750000
237600     END-PERFORM.                                                 23760000
237700                                                                  23770000
237800     IF WS-RETRY-COUNTER > 3                                      23780000
237900         MOVE 'R450-SELECT-PO-BY-ITEM-NBR    '                    23790000
238000                       TO WS-ABEND-PARAGRAPH                      23800000
238100         MOVE 'MAX RETRIES EXCEEDED ON SELECT UPCSKU'             23810000
238200                         TO WS-ABEND-OPERATION                    23820000
238300         PERFORM Z999-SQL-ERROR                                   23830000
238400     END-IF.                                                      23840000
238500                                                                  23850000
238600     EVALUATE TRUE                                                23860000
238700        WHEN SQLCODE = ZEROS                                      23870000
238800        WHEN SQLCODE = -811                                       23880000
238900             CONTINUE                                             23890000
239000        WHEN SQLCODE = +100                                       23900000
239100             MOVE ZEROS TO PURITM-PO-LNE-NBR                      23910000
239200        WHEN OTHER                                                23920000
239300             MOVE 'R450-SELECT-PO-BY-ITEM-NBR    ' TO             23930000
239400                                       WS-ABEND-PARAGRAPH         23940000
239500             MOVE 'UNSUCCESSFUL SELECT UPCSKU'                    23950000
239600                           TO WS-ABEND-OPERATION                  23960000
239700             MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1              23970000
239800             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              23980000
239900             PERFORM Z999-SQL-ERROR                               23990000
240000     END-EVALUATE.                                                24000000
240100                                                                  24010000
240200*--------------------------------------------------------------*  24020000
240300* SELECT THE PO LINE NUMBER FROM THE PURCHASE ITEM TABLE WITH  *  24030000
240400* THE VENDOR STYLE CODE.                                       *  24040000
240500*--------------------------------------------------------------*  24050000
240600 R485-SELECT-PO-LNE-NBR.                                          24060000
240700                                                                  24070000
240800     PERFORM WITH TEST AFTER                                      24080000
240900         VARYING WS-RETRY-COUNTER FROM 1 BY 1                     24090000
241000         UNTIL   WS-RETRY-COUNTER > 3  OR                         24100000
241100                 SQLCODE = ZERO OR                                24110000
241200                 SQLCODE = +100 OR                                24120000
241300                 SQLCODE = -811                                   24130000
241400                                                                  24140000
241500         EXEC SQL                                                 24150000
241600             SELECT PO_LNE_NBR                                    24160000
241700             INTO  :PURITM-PO-LNE-NBR                             24170000
241800             FROM  TPURITM                                        24180000
241900             WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP          24190000
242000               AND VER_STATUS_CDE = 'A'                           24200000
242100               AND VEND_STYL_NAME = :WS-STYLE2                    24210000
242200         END-EXEC                                                 24220000
242300                                                                  24230000
242400         EVALUATE TRUE                                            24240000
242500             WHEN SQLCODE = ZERO                                  24250000
242600             WHEN SQLCODE = +100                                  24260000
242700             WHEN SQLCODE = -904                                  24270000
242800             WHEN SQLCODE = -913                                  24280000
242900             WHEN SQLCODE = -811                                  24290000
243000                  CONTINUE                                        24300000
243100                                                                  24310000
243200             WHEN SQLWARN0 NOT = SPACES                           24320000
243300             WHEN SQLCODE  NOT = ZERO                             24330000
243400                  MOVE 'R485-SELECT-PO-LNE-NBR        '           24340000
243500                                TO WS-ABEND-PARAGRAPH             24350000
243600                  MOVE 'UNSUCCESSFUL SELECT PURITM'               24360000
243700                                TO WS-ABEND-OPERATION             24370000
243800                  MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1         24380000
243900                  MOVE '        ' TO WS-ABEND-STRUCTURE-2         24390000
244000                  PERFORM Z999-SQL-ERROR                          24400000
244100         END-EVALUATE                                             24410000
244200     END-PERFORM.                                                 24420000
244300                                                                  24430000
244400     IF WS-RETRY-COUNTER > 3                                      24440000
244500         MOVE 'R485-SELECT-PO-LNE-NBR        '                    24450000
244600                       TO WS-ABEND-PARAGRAPH                      24460000
244700         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURITM'             24470000
244800                         TO WS-ABEND-OPERATION                    24480000
244900         PERFORM Z999-SQL-ERROR                                   24490000
245000     END-IF.                                                      24500000
245100                                                                  24510000
245200     EVALUATE TRUE                                                24520000
245300         WHEN SQLCODE = ZEROS                                     24530000
245400         WHEN SQLCODE = -811                                      24540000
245500              CONTINUE                                            24550000
245600         WHEN SQLCODE = +100                                      24560000
245700              MOVE ZEROS TO PURITM-PO-LNE-NBR                     24570000
245800         WHEN OTHER                                               24580000
245900              MOVE 'R485-SELECT-PO-LNE-NBR        ' TO            24590000
246000                                        WS-ABEND-PARAGRAPH        24600000
246100              MOVE 'UNSUCCESSFUL SELECT PURITM'                   24610000
246200                            TO WS-ABEND-OPERATION                 24620000
246300              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1             24630000
246400              MOVE '        ' TO WS-ABEND-STRUCTURE-2             24640000
246500              PERFORM Z999-SQL-ERROR                              24650000
246600     END-EVALUATE.                                                24660000
246700                                                                  24670000
246800*--------------------------------------------------------------*  24680000
246900* SELECT THE DEPARTMENT NAME PER DEPT NUMBER FROM THE PO       *  24690000
247000*--------------------------------------------------------------*  24700000
247100 R700-SELECT-TMDSEAR.                                             24710000
247200                                                                  24720000
247300     INITIALIZE DCLTMDSEAR.                                       24730000
247400                                                                  24740000
247500     PERFORM WITH TEST AFTER                                      24750000
247600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 24760000
247700             UNTIL   WS-RETRY-COUNTER > 3  OR                     24770000
247800                     SQLCODE = ZERO OR                            24780000
247900                     SQLCODE = +100                               24790000
248000                                                                  24800000
248100             EXEC SQL                                             24810000
248200                 SELECT A.DEPT_NBR                                24820000
248300                      , B.MDSEAR_DESC                             24830000
248400                 INTO :PURCHS-DEPT-NBR                            24840000
248500                    , :MDSEAR-DESC                                24850000
248600                 FROM TPURCHS A                                   24860000
248700                    , TMDSEAR B                                   24870000
248800                 WHERE A.PO_NBR         = :WS-SAVE-PO-NBR-COMP    24880000
248900                   AND A.VER_STATUS_CDE = 'A'                     24890000
249000                   AND B.OPERCO_NBR     = '03'                    24900000
249100                   AND A.DEPT_NBR       = B.DEPT_NBR              24910000
249200                   AND B.MDSELV_CDE     = 'DPT'                   24920000
249300                   AND B.STRT_DTE      <= CURRENT DATE            24930000
249400                   AND B.END_DTE       >= CURRENT DATE            24940000
249500             END-EXEC                                             24950000
249600                                                                  24960000
249700             EVALUATE TRUE                                        24970000
249800                 WHEN SQLCODE = ZERO                              24980000
249900                 WHEN SQLCODE = +100                              24990000
250000                 WHEN SQLCODE = -904                              25000000
250100                 WHEN SQLCODE = -913                              25010000
250200                      CONTINUE                                    25020000
250300                                                                  25030000
250400                 WHEN SQLWARN0 NOT = SPACES                       25040000
250500                 WHEN SQLCODE  NOT = ZERO                         25050000
250600                      MOVE 'R700-SELECT-TMDSEAR           '       25060000
250700                                    TO WS-ABEND-PARAGRAPH         25070000
250800                      MOVE 'UNSUCCESSFUL SELECT MDSEAR'           25080000
250900                                    TO WS-ABEND-OPERATION         25090000
251000                      MOVE 'TMDSEAR ' TO WS-ABEND-STRUCTURE-1     25100000
251100                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     25110000
251200                      PERFORM Z999-SQL-ERROR                      25120000
251300             END-EVALUATE                                         25130000
251400     END-PERFORM.                                                 25140000
251500                                                                  25150000
251600     IF WS-RETRY-COUNTER > 3                                      25160000
251700         MOVE 'R700-SELECT-TMDSEAR           '                    25170000
251800                       TO WS-ABEND-PARAGRAPH                      25180000
251900         MOVE 'MAX RETRIES EXCEEDED ON SELECT MDSEAR'             25190000
252000                         TO WS-ABEND-OPERATION                    25200000
252100         PERFORM Z999-SQL-ERROR                                   25210000
252200     END-IF.                                                      25220000
252300                                                                  25230000
246800*--------------------------------------------------------------*  25231008
246900* SELECT THE PO TYPE CODE                                      *  25232008
247000*--------------------------------------------------------------*  25233008
247100 R750-SELECT-PO-TYPE.                                             25234008
247200                                                                  25235008
248100     EXEC SQL                                                     25239508
248200         SELECT PO_TYP_CDE                                        25239608
248400           INTO :WS-PO-TYP-CDE                                    25239808
248600           FROM TPURCHS                                           25240008
248700          WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP             25240208
248900            AND VER_STATUS_CDE = 'A'                              25240308
249500     END-EXEC.                                                    25240908
249600                                                                  25241008
249700     EVALUATE TRUE                                                25241108
249800         WHEN SQLCODE = ZERO                                      25241208
249900         WHEN SQLCODE = +100                                      25241308
250000         WHEN SQLCODE = -904                                      25241408
250100         WHEN SQLCODE = -913                                      25241508
250200              CONTINUE                                            25241608
250300                                                                  25241708
250400         WHEN SQLWARN0 NOT = SPACES                               25241808
250500         WHEN SQLCODE  NOT = ZERO                                 25241908
250600              MOVE 'R750-SELECT-PO-TYPE           '               25242008
250700                                    TO WS-ABEND-PARAGRAPH         25242108
250800              MOVE 'UNSUCCESSFUL SELECT TPURCHS'                  25242208
250900                                    TO WS-ABEND-OPERATION         25242308
251000              MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1             25242408
251100              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             25242508
251200              PERFORM Z999-SQL-ERROR                              25242608
251300     END-EVALUATE.                                                25242708
251500                                                                  25242908
251500                                                                  25243008
252400*--------------------------------------------------------------*  25244008
252500* CHECK THE TRADING PARTNER TABLE TO OBTAIN THE ENT-ID         *  25250000
252600*--------------------------------------------------------------*  25260000
252700 R800-SELECT-ENT-ID.                                              25270000
252800                                                                  25280000
252900     INITIALIZE DCLTTRDPRT.                                       25290000
253000     INITIALIZE DCLTENTNME.                                       25300000
253100     INITIALIZE DCLTEXTENT.                                       25310000
253200                                                                  25320000
253300     MOVE AP050-EDI-SENDER-ID OF WS-WORK-REC TO                   25330000
253400                                     TRDPRT-VEND-INCHG-ID.        25340000
253500     MOVE AP050-EDI-SENDER-ID-QUAL OF WS-WORK-REC TO              25350000
253600                                     TRDPRT-VEND-INCHG-ID-DESC.   25360000
253700                                                                  25370000
253800     PERFORM WITH TEST AFTER                                      25380000
253900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 25390000
254000             UNTIL   WS-RETRY-COUNTER > 3  OR                     25400000
254100                     SQLCODE = ZERO OR                            25410000
254200                     SQLCODE = +100                               25420000
254300                                                                  25430000
254400             EXEC SQL                                             25440000
254500                OPEN TRDPRT_CSR                                   25450000
254600             END-EXEC                                             25460000
254700                                                                  25470000
254800             EVALUATE TRUE                                        25480000
254900                 WHEN SQLCODE = ZERO                              25490000
255000                 WHEN SQLCODE = +100                              25500000
255100                 WHEN SQLCODE = -904                              25510000
255200                 WHEN SQLCODE = -913                              25520000
255300                      CONTINUE                                    25530000
255400                                                                  25540000
255500                 WHEN SQLWARN0 NOT = SPACES                       25550000
255600                 WHEN SQLCODE  NOT = ZERO                         25560000
255700                      MOVE 'R800-SELECT-ENT-ID            '       25570000
255800                                    TO WS-ABEND-PARAGRAPH         25580000
255900                      MOVE 'UNSUCCESSFUL OPEN   TRDPRT'           25590000
256000                                    TO WS-ABEND-OPERATION         25600000
256100                      MOVE 'TRDPRT  ' TO WS-ABEND-STRUCTURE-1     25610000
256200                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     25620000
256300                      PERFORM Z999-SQL-ERROR                      25630000
256400             END-EVALUATE                                         25640000
256500     END-PERFORM.                                                 25650000
256600                                                                  25660000
256700     IF WS-RETRY-COUNTER > 3                                      25670000
256800         MOVE 'R800-SELECT-ENT-ID            '                    25680000
256900                       TO WS-ABEND-PARAGRAPH                      25690000
257000         MOVE 'MAX RETRIES EXCEEDED ON OPEN   TRDPRT'             25700000
257100                         TO WS-ABEND-OPERATION                    25710000
257200         PERFORM Z999-SQL-ERROR                                   25720000
257300     ELSE                                                         25730000
257400        IF SQLCODE = +100                                         25740000
257500           CONTINUE                                               25750000
257600        ELSE                                                      25760000
257700           EXEC SQL                                               25770000
257800               FETCH TRDPRT_CSR                                   25780000
257900               INTO :TRDPRT-ENT-ID                                25790000
258000                  , :TRDPRT-VEND-INCHG-ID                         25800000
258100                  , :TRDPRT-VEND-INCHG-ID-DESC                    25810000
258200                  , :TRDPRT-INACTV-DTE                            25820000
258300           END-EXEC                                               25830000
258400                                                                  25840000
258500           EVALUATE TRUE                                          25850000
258600               WHEN SQLCODE = ZERO                                25860000
258700                    SET WS-VALID-TRADE-PART TO TRUE               25870000
258800               WHEN SQLCODE = +100                                25880000
258900                    SET WS-NOT-VALID-TRADE-PART TO TRUE           25890000
259000               WHEN SQLWARN0 NOT = SPACES                         25900000
259100               WHEN SQLCODE  NOT = ZERO                           25910000
259200                 MOVE 'R800-SELECT-ENT-ID            '            25920000
259300                               TO WS-ABEND-PARAGRAPH              25930000
259400                 MOVE 'UNSUCCESSFUL FETCH  TRDPRT'                25940000
259500                               TO WS-ABEND-OPERATION              25950000
259600                 MOVE 'TRDPRT  ' TO WS-ABEND-STRUCTURE-1          25960000
259700                 MOVE SPACES     TO WS-ABEND-STRUCTURE-2          25970000
259800                 PERFORM Z999-SQL-ERROR                           25980000
259900           END-EVALUATE                                           25990000
260000        END-IF                                                    26000000
260100     END-IF.                                                      26010000
260200                                                                  26020000
260300     IF WS-RETRY-COUNTER > 3                                      26030000
260400         MOVE 'R800-SELECT-ENT-ID            '                    26040000
260500                       TO WS-ABEND-PARAGRAPH                      26050000
260600         MOVE 'MAX RETRIES EXCEEDED ON OPEN   TRDPRT'             26060000
260700                         TO WS-ABEND-OPERATION                    26070000
260800         PERFORM Z999-SQL-ERROR                                   26080000
260900     END-IF.                                                      26090000
261000                                                                  26100000
261100     PERFORM WITH TEST AFTER                                      26110000
261200             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 26120000
261300             UNTIL   WS-RETRY-COUNTER > 3  OR                     26130000
261400                     SQLCODE = ZERO OR                            26140000
261500                     SQLCODE = +100                               26150000
261600                                                                  26160000
261700             EXEC SQL                                             26170000
261800                CLOSE TRDPRT_CSR                                  26180000
261900             END-EXEC                                             26190000
262000                                                                  26200000
262100             EVALUATE TRUE                                        26210000
262200                 WHEN SQLCODE = ZERO                              26220000
262300                 WHEN SQLCODE = +100                              26230000
262400                 WHEN SQLCODE = -904                              26240000
262500                 WHEN SQLCODE = -913                              26250000
262600                      CONTINUE                                    26260000
262700                                                                  26270000
262800                 WHEN SQLWARN0 NOT = SPACES                       26280000
262900                 WHEN SQLCODE  NOT = ZERO                         26290000
263000                      MOVE 'R800-SELECT-ENT-ID            '       26300000
263100                                    TO WS-ABEND-PARAGRAPH         26310000
263200                      MOVE 'UNSUCCESSFUL CLOSE  TRDPRT'           26320000
263300                                    TO WS-ABEND-OPERATION         26330000
263400                      MOVE 'TRDPRT  ' TO WS-ABEND-STRUCTURE-1     26340000
263500                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     26350000
263600                      PERFORM Z999-SQL-ERROR                      26360000
263700             END-EVALUATE                                         26370000
263800     END-PERFORM.                                                 26380000
263900                                                                  26390000
264000     IF WS-RETRY-COUNTER > 3                                      26400000
264100         MOVE 'R800-SELECT-ENT-ID            '                    26410000
264200                       TO WS-ABEND-PARAGRAPH                      26420000
264300         MOVE 'MAX RETRIES EXCEEDED ON CLOSE  TRDPRT'             26430000
264400                         TO WS-ABEND-OPERATION                    26440000
264500         PERFORM Z999-SQL-ERROR.                                  26450000
264600                                                                  26460000
264700     IF WS-VALID-TRADE-PART                                       26470000
264800        PERFORM R850-SELECT-TENTNME.                              26480000
264900                                                                  26490000
265000*--------------------------------------------------------------*  26500000
265100* CHECK THE TENTNME TO OBTAIN THE VENDOR ENT ID DESCRIPTION    *  26510000
265200*--------------------------------------------------------------*  26520000
265300 R850-SELECT-TENTNME.                                             26530000
265400                                                                  26540000
265500     PERFORM WITH TEST AFTER                                      26550000
265600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 26560000
265700             UNTIL   WS-RETRY-COUNTER > 3  OR                     26570000
265800                     SQLCODE = ZERO OR                            26580000
265900                     SQLCODE = +100                               26590000
266000                                                                  26600000
266100             EXEC SQL                                             26610000
266200                 SELECT A.ENT_NAME_DESC                           26620000
266300                      , B.DUN_NBR                                 26630000
266400                 INTO :ENTNME-ENT-NAME-DESC                       26640000
266500                    , :EXTENT-DUN-NBR                             26650000
266600                 FROM TENTNME A                                   26660000
266700                    , TEXTENT B                                   26670000
266800                 WHERE A.ENT_ID         = :TRDPRT-ENT-ID          26680000
266900                   AND B.ENT_ID         = A.ENT_ID                26690000
267000                   AND B.STATUS_CDE     = 'A'                     26700000
267100                   AND A.TYPE_CDE       = '01'                    26710000
267200             END-EXEC                                             26720000
267300                                                                  26730000
267400             EVALUATE TRUE                                        26740000
267500                 WHEN SQLCODE = ZERO                              26750000
267600                 WHEN SQLCODE = +100                              26760000
267700                 WHEN SQLCODE = -904                              26770000
267800                 WHEN SQLCODE = -913                              26780000
267900                      CONTINUE                                    26790000
268000                                                                  26800000
268100                 WHEN SQLWARN0 NOT = SPACES                       26810000
268200                 WHEN SQLCODE  NOT = ZERO                         26820000
268300                      MOVE 'R850-SELECT-TENTNME           '       26830000
268400                                    TO WS-ABEND-PARAGRAPH         26840000
268500                      MOVE 'UNSUCCESSFUL SELECT ENTNME'           26850000
268600                                    TO WS-ABEND-OPERATION         26860000
268700                      MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1     26870000
268800                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     26880000
268900                      PERFORM Z999-SQL-ERROR                      26890000
269000             END-EVALUATE                                         26900000
269100     END-PERFORM.                                                 26910000
269200                                                                  26920000
269300     IF WS-RETRY-COUNTER > 3                                      26930000
269400         MOVE 'R850-SELECT-TENTNME           '                    26940000
269500                       TO WS-ABEND-PARAGRAPH                      26950000
269600         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTNME'             26960000
269700                         TO WS-ABEND-OPERATION                    26970000
269800         PERFORM Z999-SQL-ERROR                                   26980000
269900     END-IF.                                                      26990000
270000                                                                  27000000
270100*--------------------------------------------------------------*  27010000
270200* CHECK THE TPOINST TO OBTAIN THE DESCRIPTION                  *  27020000
270300*--------------------------------------------------------------*  27030000
270400 S200-SELECT-TPOINST.                                             27040000
270500                                                                  27050000
270600     INITIALIZE DCLTPOINST.                                       27060000
270700     INITIALIZE DCLTINSTCD.                                       27070000
270800                                                                  27080000
270900     PERFORM WITH TEST AFTER                                      27090000
271000         VARYING WS-RETRY-COUNTER FROM 1 BY 1                     27100000
271100         UNTIL   WS-RETRY-COUNTER > 3  OR                         27110000
271200                 SQLCODE = ZERO OR                                27120000
271300                 SQLCODE = +100                                   27130000
271400                                                                  27140000
271500         EXEC SQL                                                 27150000
271600             SELECT B.INSTR_DESC                                  27160000
271700             INTO   :INSTCD-INSTR-DESC                            27170000
271800             FROM   TPOINST A                                     27180000
271900                  , TINSTCD B                                     27190000
272000             WHERE  A.PO_NBR    = :WS-SAVE-PO-NBR-COMP            27200000
272100               AND  A.RECIP_CDE = 'AP'                            27210000
272200               AND  B.INSTR_NBR = A.INSTR_NBR                     27220000
272300               AND  A.INSTR_NBR =                                 27230000
272400                    (SELECT MAX(INSTR_NBR)                        27240000
272500                     FROM   TPOINST                               27250000
272600                     WHERE  PO_NBR    = :WS-SAVE-PO-NBR-COMP      27260000
272700                       AND  RECIP_CDE = 'AP')                     27270000
272800         END-EXEC                                                 27280000
272900                                                                  27290000
273000         EVALUATE TRUE                                            27300000
273100             WHEN SQLCODE = ZERO                                  27310000
273200             WHEN SQLCODE = +100                                  27320000
273300             WHEN SQLCODE = -904                                  27330000
273400             WHEN SQLCODE = -913                                  27340000
273500                  CONTINUE                                        27350000
273600                                                                  27360000
273700             WHEN SQLWARN0 NOT = SPACES                           27370000
273800             WHEN SQLCODE  NOT = ZERO                             27380000
273900                  MOVE 'S200-SELECT-TPOINST           '           27390000
274000                                TO WS-ABEND-PARAGRAPH             27400000
274100                  MOVE 'UNSUCCESSFUL SELECT POINST'               27410000
274200                                TO WS-ABEND-OPERATION             27420000
274300                  MOVE 'TPOINST ' TO WS-ABEND-STRUCTURE-1         27430000
274400                  MOVE 'TINSTCD ' TO WS-ABEND-STRUCTURE-2         27440000
274500                  PERFORM Z999-SQL-ERROR                          27450000
274600         END-EVALUATE                                             27460000
274700     END-PERFORM.                                                 27470000
274800                                                                  27480000
274900     IF WS-RETRY-COUNTER > 3                                      27490000
275000         MOVE 'S200-SELECT-TPOINST           '                    27500000
275100                       TO WS-ABEND-PARAGRAPH                      27510000
275200         MOVE 'MAX RETRIES EXCEEDED ON SELECT POINST'             27520000
275300                         TO WS-ABEND-OPERATION                    27530000
275400         PERFORM Z999-SQL-ERROR                                   27540000
275500     END-IF.                                                      27550000
275600                                                                  27560000
275700*--------------------------------------------------------------*  27570000
275800* COMMITS DB2 UPDATES AFTER EACH SELECT FROM XFT TABLE.        *  27580000
275900*--------------------------------------------------------------*  27590000
276000 U100-COMMIT.                                                     27600000
276100                                                                  27610000
276200     EXEC SQL                                                     27620000
276300         COMMIT                                                   27630000
276400     END-EXEC.                                                    27640000
276500                                                                  27650000
276600     EVALUATE TRUE                                                27660000
276700         WHEN SQLCODE = ZEROS                                     27670000
276800              CONTINUE                                            27680000
276900         WHEN OTHER                                               27690000
277000             MOVE 'U100-COMMIT'  TO WS-ABEND-PARAGRAPH            27700000
277100             MOVE 'UNSUCCESSFUL COMMIT'                           27710000
277200                                 TO WS-ABEND-OPERATION            27720000
277300             MOVE SPACES         TO WS-ABEND-STRUCTURE-1          27730000
277400                                    WS-ABEND-STRUCTURE-2          27740000
277500             PERFORM Z999-SQL-ERROR                               27750000
277600     END-EVALUATE.                                                27760000
277700                                                                  27770000
277800*--------------------------------------------------------------*  27780000
277900* WRITE OUT RECORDS TO PRODUCE A FORMATTED INVOICE FOR 'PAPER' *  27790000
278000* COPY.                                                        *  27800000
278100*--------------------------------------------------------------*  27810000
278200 W200-WRITE-AFP.                                                  27820000
278300                                                                  27830000
278400     MOVE SPACES TO WS-AFP-OUT-REC                                27840000
278500                    WS-SAVE-AFP-HEADER.                           27850000
278600     MOVE 0 TO ALLW-INDX.                                         27860000
278700                                                                  27870000
278800     PERFORM VARYING INV-INDX FROM 1 BY 1                         27880000
278900        UNTIL INV-INDX > 11000 OR                                 27890000
279000              WS-AP050-REC-TYPE(INV-INDX) = '07'                  27900000
279100        MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC                  27910000
279200        EVALUATE AP050-RECORD-TYPE-IND OF WS-WORK-REC             27920000
279300          WHEN '01'                                               27930000
279400            MOVE AP050-KOHLS-PO-NBR OF WS-WORK-REC TO             27940000
279500                       WS-EDIT-PO-NMBR                            27950000
279600            MOVE WS-EDIT-PO-NMBR  TO                              27960000
279700                       AP055-PO-NMBR OF WS-SAVE-AFP-HEADER        27970000
279800            MOVE AP050-VENDOR-INVOICE-NBR OF WS-WORK-REC TO       27980000
279900                       AP055-INVOICE-NMBR OF WS-SAVE-AFP-HEADER   27990000
280000          WHEN '02'                                               28000000
280100            MOVE AP050-INV-DTE-YY OF WS-WORK-REC TO WS-DATE-YY    28010000
280200            MOVE AP050-INV-DTE-MM OF WS-WORK-REC TO WS-DATE-MM    28020000
280300            MOVE AP050-INV-DTE-DD OF WS-WORK-REC TO WS-DATE-DD    28030000
280400            MOVE WS-DATE TO AP055-INVOICE-DATE                    28040000
280500                                          OF WS-SAVE-AFP-HEADER   28050000
280600            MOVE AP050-LADING-CARRIER-NBR OF WS-WORK-REC TO       28060000
280700                 AP055-LADING-CARR-NMBR OF WS-SAVE-AFP-HEADER     28070000
280800          WHEN '03'                                               28080000
280900            MOVE AP050-REMIT-TO-NAME OF WS-WORK-REC TO            28090000
281000                   AP055-VND-NAME OF WS-SAVE-AFP-HEADER           28100000
281100            MOVE AP050-REMIT-TO-ADDR-1 OF WS-WORK-REC TO          28110000
281200                   AP055-VND-ADDR1 OF WS-SAVE-AFP-HEADER          28120000
281300            MOVE AP050-REMIT-TO-ADDR-2 OF WS-WORK-REC TO          28130000
281400                   AP055-VND-ADDR2 OF WS-SAVE-AFP-HEADER          28140000
281500            IF AP050-REMIT-TO-CITY OF WS-WORK-REC NOT = SPACES    28150000
281600             AND                                                  28160000
281700               AP050-REMIT-TO-STATE OF WS-WORK-REC NOT = SPACES   28170000
281800             AND                                                  28180000
281900               AP050-REMIT-TO-ZIP OF WS-WORK-REC NOT = SPACES     28190000
282000               STRING AP050-REMIT-TO-CITY OF WS-WORK-REC          28200000
282100                      DELIMITED BY '  '                           28210000
282200                      ', '                                        28220000
282300                      AP050-REMIT-TO-STATE OF WS-WORK-REC         28230000
282400                      '. '                                        28240000
282500                      AP050-REMIT-TO-ZIP OF WS-WORK-REC           28250000
282600                 DELIMITED BY SIZE                                28260000
282700                 INTO AP055-VND-ADDR3 OF WS-SAVE-AFP-HEADER       28270000
282800            ELSE                                                  28280000
282900               MOVE SPACES TO AP055-VND-ADDR3                     28290000
283000                                      OF WS-SAVE-AFP-HEADER       28300000
283100            END-IF                                                28310000
283200          WHEN '04'                                               28320000
283300            MOVE AP050-TERMS-TYPE-CODE OF WS-WORK-REC TO          28330000
283400                 AP055-TERM-TYPE-CODE OF WS-SAVE-AFP-HEADER       28340000
283500            MOVE AP050-TRMS-BASIS-DTE-CODE OF WS-WORK-REC TO      28350000
283600                 AP055-BASIS-DATE-CODE OF WS-SAVE-AFP-HEADER      28360000
283700            IF AP050-SHIP-DATE OF WS-WORK-REC                     28370000
283800               MOVE WS-SAVE-SHIP-YY TO WS-DATE-YY                 28380000
283900               MOVE WS-SAVE-SHIP-MM TO WS-DATE-MM                 28390000
284000               MOVE WS-SAVE-SHIP-DD TO WS-DATE-DD                 28400000
284100            ELSE                                                  28410000
284200               IF AP050-DELIV-DATE OF WS-WORK-REC                 28420000
284300                OR                                                28430000
284400                  AP050-INVC-DATE   OF WS-WORK-REC                28440000
284500                  MOVE WS-SAVE-INV-YY  TO WS-DATE-YY              28450000
284600                  MOVE WS-SAVE-INV-MM  TO WS-DATE-MM              28460000
284700                  MOVE WS-SAVE-INV-DD  TO WS-DATE-DD              28470000
284800               ELSE                                               28480000
284900                  MOVE WS-SAVE-EFF-YY  TO WS-DATE-YY              28490000
285000                  MOVE WS-SAVE-EFF-MM  TO WS-DATE-MM              28500000
285100                  MOVE WS-SAVE-EFF-DD  TO WS-DATE-DD              28510000
285200               END-IF                                             28520000
285300            END-IF                                                28530000
285400            MOVE WS-DATE TO AP055-BASIS-DATE                      28540000
285500                                        OF WS-SAVE-AFP-HEADER     28550000
285600            IF AP050-DISC-PCT OF WS-WORK-REC > 0                  28560000
285700               MOVE AP050-DISC-PCT OF WS-WORK-REC TO WS-PCT-6     28570000
285800               MOVE WS-PCT-14 TO AP055-DIS-PCT-AMT                28580000
285900                                         OF WS-SAVE-AFP-HEADER    28590000
286000            ELSE                                                  28600000
286100               MOVE AP050-DISC-AMT OF WS-WORK-REC TO              28610000
286200                                WS-DOL-14-2DEC                    28620000
286300               MOVE WS-DOL-14-2DEC TO AP055-DIS-PCT-AMT           28630000
286400                                         OF WS-SAVE-AFP-HEADER    28640000
286500            END-IF                                                28650000
286600            MOVE AP050-DISC-DAYS-DUE OF WS-WORK-REC TO WS-EDIT-3  28660000
286700            MOVE WS-EDIT-3 TO AP055-DISC-DAYS                     28670000
286800                                         OF WS-SAVE-AFP-HEADER    28680000
286900            MOVE AP050-NET-DUE-DTE-YY OF WS-WORK-REC TO           28690000
287000                                            WS-DATE-YY            28700000
287100            MOVE AP050-NET-DUE-DTE-MM OF WS-WORK-REC TO           28710000
287200                                            WS-DATE-MM            28720000
287300            MOVE AP050-NET-DUE-DTE-DD OF WS-WORK-REC TO           28730000
287400                                            WS-DATE-DD            28740000
287500            MOVE WS-DATE TO AP055-NET-DUE-DATE                    28750000
287600                                         OF WS-SAVE-AFP-HEADER    28760000
287700            EVALUATE AP055-TERM-TYPE-CODE  OF WS-SAVE-AFP-HEADER  28770000
287800              WHEN '01'                                           28780000
287900                MOVE 'BASIC       '        TO                     28790000
288000                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28800000
288100              WHEN '02'                                           28810000
288200                MOVE 'END OF MONTH'        TO                     28820000
288300                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28830000
288400              WHEN '03'                                           28840000
288500                MOVE 'FIXED DATE  '        TO                     28850000
288600                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28860000
288700              WHEN '04'                                           28870000
288800                MOVE 'DEFR INSTALL'        TO                     28880000
288900                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28890000
289000              WHEN '05'                                           28900000
289100                MOVE 'NO DISC     '        TO                     28910000
289200                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28920000
289300              WHEN '06'                                           28930000
289400                MOVE 'MIXED       '        TO                     28940000
289500                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28950000
289600              WHEN '07'                                           28960000
289700                MOVE 'EXTENDED    '        TO                     28970000
289800                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   28980000
289900              WHEN '08'                                           28990000
290000                MOVE 'BASIC DISC  '        TO                     29000000
290100                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29010000
290200              WHEN '09'                                           29020000
290300                MOVE 'PROXIMO     '        TO                     29030000
290400                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29040000
290500              WHEN '10'                                           29050000
290600                MOVE 'INSTANT     '        TO                     29060000
290700                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29070000
290800              WHEN '11'                                           29080000
290900                MOVE 'ELECTIVE    '        TO                     29090000
291000                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29100000
291100              WHEN '12'                                           29110000
291200                MOVE '10 DAYS EOM '        TO                     29120000
291300                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29130000
291400              WHEN '13'                                           29140000
291500                MOVE 'PREV AGREED '        TO                     29150000
291600                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29160000
291700              WHEN '14'                                           29170000
291800                MOVE 'MUTUAL DEFIN'        TO                     29180000
291900                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29190000
292000              WHEN OTHER                                          29200000
292100                MOVE AP050-TERMS-TYPE-CODE OF WS-WORK-REC TO      29210000
292200                   AP055-TERMS-TYPE-DEFIN OF WS-SAVE-AFP-HEADER   29220000
292300            END-EVALUATE                                          29230000
292400                                                                  29240000
292500            EVALUATE AP055-BASIS-DATE-CODE OF                     29250000
292600                                      WS-SAVE-AFP-HEADER          29260000
292700              WHEN '01'                                           29270000
292800                MOVE 'SHIPPED '            TO                     29280000
292900                     AP055-BASIS-DEFIN OF WS-SAVE-AFP-HEADER      29290000
293000              WHEN '02'                                           29300000
293100                MOVE 'DELIVER '            TO                     29310000
293200                     AP055-BASIS-DEFIN OF WS-SAVE-AFP-HEADER      29320000
293300              WHEN '03'                                           29330000
293400                MOVE 'INVOICE '            TO                     29340000
293500                     AP055-BASIS-DEFIN OF WS-SAVE-AFP-HEADER      29350000
293600              WHEN '04'                                           29360000
293700                MOVE 'EFFECT  '            TO                     29370000
293800                     AP055-BASIS-DEFIN OF WS-SAVE-AFP-HEADER      29380000
293900              WHEN OTHER                                          29390000
294000                MOVE AP055-BASIS-DATE-CODE OF WS-SAVE-AFP-HEADER  29400000
294100                  TO AP055-BASIS-DEFIN OF WS-SAVE-AFP-HEADER      29410000
294200            END-EVALUATE                                          29420000
294300                                                                  29430000
294400          WHEN '05'                                               29440000
294500            IF ALLW-INDX < 5                                      29450000
294600               ADD +1 TO ALLW-INDX                                29460000
294700            END-IF                                                29470000
294800            MOVE AP050-ALLW-CHRG-CODE OF WS-WORK-REC TO           29480000
294900                 AP055-ALLW-CHRG-CD OF WS-SAVE-AFP-HEADER         29490000
295000                                         (ALLW-INDX)              29500000
295100            EVALUATE AP050-ALLW-CHRG-CODE OF WS-WORK-REC          29510000
295200              WHEN '275'                                          29520000
295300              WHEN 'DSC'                                          29530000
295400                MOVE 'TERMS DISCOUNT'      TO                     29540000
295500                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29550000
295600                                                      (ALLW-INDX) 29560000
295700               WHEN 'TTD'                                         29570000
295800               WHEN 'TRD'                                         29580000
295900                 MOVE 'TRADE DISCOUNT'      TO                    29590000
296000                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29600000
296100                                                      (ALLW-INDX) 29610000
296200               WHEN 'CAC'                                         29620000
296300                 MOVE 'CASH DISCOUNT '      TO                    29630000
296400                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29640000
296500                                                      (ALLW-INDX) 29650000
296600               WHEN 'MOS'                                         29660000
296700                 MOVE 'MARKOUT/STOCK '      TO                    29670000
296800                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29680000
296900                                                      (ALLW-INDX) 29690000
297000               WHEN 'NSD'                                         29700000
297100               WHEN 'NSA'                                         29710000
297200                 MOVE 'NEW STRE/PROMO'      TO                    29720000
297300                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29730000
297400                                                      (ALLW-INDX) 29740000
297500               WHEN 'FFA'                                         29750000
297600                 MOVE 'FREIGHT ALLOW '      TO                    29760000
297700                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29770000
297800                                                      (ALLW-INDX) 29780000
297900               WHEN 'TAL'                                         29790000
298000                 MOVE 'TRUCKLOAD DISC'      TO                    29800000
298100                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29810000
298200                                                      (ALLW-INDX) 29820000
298300               WHEN 'VAB'                                         29830000
298400                 MOVE 'VOLUME DISCNT '      TO                    29840000
298500                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29850000
298600                                                      (ALLW-INDX) 29860000
298700               WHEN 'RCA'                                         29870000
298800                 MOVE 'NO RET CREDIT '      TO                    29880000
298900                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29890000
299000                                                      (ALLW-INDX) 29900000
299100               WHEN 'WSA'                                         29910000
299200                 MOVE 'WHAREHOUSE ALW'      TO                    29920000
299300                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29930000
299400                                                      (ALLW-INDX) 29940000
299500              WHEN 'DDA'                                          29950000
299600                MOVE 'DEFECTIVE ALLW'      TO                     29960000
299700                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  29970000
299800                                                      (ALLW-INDX) 29980000
299900              WHEN 'AAA'                                          29990000
300000              WHEN 'ADV'                                          30000000
300100                MOVE 'ADVERTISING AL'      TO                     30010000
300200                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30020000
300300                                                      (ALLW-INDX) 30030000
300400              WHEN 'EEA'                                          30040000
300500                MOVE 'EARLY BUY ALLW'      TO                     30050000
300600                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30060000
300700                                                      (ALLW-INDX) 30070000
300800              WHEN 'UUM'                                          30080000
300900                MOVE 'UNSALEABLE MER'      TO                     30090000
301000                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30100000
301100                                                      (ALLW-INDX) 30110000
301200              WHEN '400'                                          30120000
301300              WHEN 'FFC'                                          30130000
301400              WHEN 'PAB'                                          30140000
301500              WHEN 'SAB'                                          30150000
301600              WHEN 'PST'                                          30160000
301700              WHEN 'UUC'                                          30170000
301800                MOVE 'FREIGHT CHARGE'      TO                     30180000
301900                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30190000
302000                                                      (ALLW-INDX) 30200000
302100              WHEN 'MRK'                                          30210000
302200                MOVE 'PRETICKETING  '      TO                     30220000
302300                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30230000
302400                                                      (ALLW-INDX) 30240000
302500              WHEN '445'                                          30250000
302600              WHEN 'INS'                                          30260000
302700                MOVE 'INSURANCE     '      TO                     30270000
302800                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30280000
302900                                                      (ALLW-INDX) 30290000
303000               WHEN 'MSG'                                         30300000
303100                 MOVE 'MISCELLANEOUS '      TO                    30310000
303200                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30320000
303300                                                      (ALLW-INDX) 30330000
303400               WHEN 'SST'                                         30340000
303500               WHEN 'TTL'                                         30350000
303600               WHEN 'TTS'                                         30360000
303700                 MOVE 'TAX           '      TO                    30370000
303800                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30380000
303900                                                      (ALLW-INDX) 30390000
304000               WHEN 'SGG'                                         30400000
304100                 MOVE 'SMALL ORDR CHG'      TO                    30410000
304200                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30420000
304300                                                      (ALLW-INDX) 30430000
304400               WHEN 'MSC'                                         30440000
304500                 MOVE 'MISC/HANGR CHG'      TO                    30450000
304600                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30460000
304700                                                      (ALLW-INDX) 30470000
304800               WHEN 'HBG'                                         30480000
304900               WHEN '690'                                         30490000
305000                 MOVE 'HANDLING      '      TO                    30500000
305100                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30510000
305200                                                      (ALLW-INDX) 30520000
305300               WHEN 'LAE'                                         30530000
305400                 MOVE 'LICENSE FEE   '      TO                    30540000
305500                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30550000
305600                                                      (ALLW-INDX) 30560000
305700               WHEN 'PPN'                                         30570000
305800                 MOVE 'PALLET CHARGE '      TO                    30580000
305900                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30590000
306000                                                      (ALLW-INDX) 30600000
306100               WHEN OTHER                                         30610000
306200                 MOVE AP050-ALLW-CHRG-CODE OF WS-WORK-REC TO      30620000
306300                     AP055-ALLW-CHRG-DEFIN OF WS-SAVE-AFP-HEADER  30630000
306400                                                      (ALLW-INDX) 30640000
306500            END-EVALUATE                                          30650000
306600            IF AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC >  0          30660000
306700               MOVE AP050-ALLW-CHRG-TOTAL OF WS-WORK-REC TO       30670000
306800                          WS-DOL-14-2DEC                          30680000
306900               MOVE WS-DOL-14-2DEC TO                             30690000
307000                  AP055-ALLW-CHRG-DATA OF WS-SAVE-AFP-HEADER      30700000
307100                                         (ALLW-INDX)              30710000
307200            ELSE                                                  30720000
307300               MOVE AP050-ALLW-CHRG-PCT OF WS-WORK-REC TO         30730000
307400                          WS-PCT-6                                30740000
307500               MOVE WS-PCT-14 TO                                  30750000
307600                      AP055-ALLW-CHRG-DATA OF WS-SAVE-AFP-HEADER  30760000
307700                                                     (ALLW-INDX)  30770000
307800            END-IF                                                30780000
307900          WHEN '06'                                               30790000
308000            MOVE '1' TO AP055-REC-TYPE OF WS-SAVE-AFP-HEADER      30800000
308100            SET AP055-HEADER-IND OF WS-SAVE-AFP-HEADER TO TRUE    30810000
308200            MOVE AP050-GROSS-INVOICE-AMT OF WS-WORK-REC TO        30820000
308300                       WS-DOL-14-2DEC                             30830000
308400            MOVE WS-DOL-14-2DEC TO AP055-SUMM-GROSS-AMT           30840000
308500                                         OF WS-SAVE-AFP-HEADER    30850000
308600            MOVE WS-DETAIL-TOT-UNITS TO WS-EDIT-14                30860000
308700            MOVE WS-EDIT-14 TO AP055-SUMM-TOTAL-UNITS             30870000
308800                                         OF WS-SAVE-AFP-HEADER    30880000
308900        END-EVALUATE                                              30890000
309000     END-PERFORM.                                                 30900000
309100                                                                  30910000
309200     MOVE ' ' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER.           30920000
309300     MOVE '1' TO AP055-REC-TYPE  OF WS-SAVE-AFP-HEADER.           30930000
309400     MOVE 'INV' TO AP055-IND-CODE OF WS-SAVE-AFP-HEADER.          30940000
309500     MOVE 'APKED200-1' TO AP055-PROGRAM-NUMBER                    30950000
309600                                  OF WS-SAVE-AFP-HEADER.          30960000
309700     MOVE DATE-IN-MM TO WS-DATE-MM.                               30970000
309800     MOVE DATE-IN-DD TO WS-DATE-DD.                               30980000
309900     MOVE DATE-IN-YY TO WS-DATE-YY.                               30990000
310000     MOVE WS-DATE    TO AP055-REPORT-DATE  OF WS-SAVE-AFP-HEADER. 31000000
310100     MOVE WS-REC-07-CNT TO AP055-REC-07-CNT                       31010000
310200                                  OF WS-SAVE-AFP-HEADER.          31020000
310300                                                                  31030000
310400     MOVE EXTENT-DUN-NBR TO WS-VND-NMBR-9S.                       31040000
310500     MOVE WS-VND-NMBR-X TO AP055-VND-NMBR OF WS-SAVE-AFP-HEADER.  31050000
310600     MOVE ENTNME-ENT-NAME-DESC TO AP055-ENT-ID-DESC               31060000
310700                                        OF WS-SAVE-AFP-HEADER.    31070000
310800                                                                  31080000
310900     MOVE PURCHS-DEPT-NBR TO AP055-DEPT OF WS-SAVE-AFP-HEADER.    31090000
311000     MOVE MDSEAR-DESC     TO AP055-DEPT-NAME                      31100000
311100                                        OF WS-SAVE-AFP-HEADER.    31110000
311200     MOVE WS-AP055-STORE  TO AP055-STORE OF WS-SAVE-AFP-HEADER.   31120000
311300                                                                  31130000
311400     MOVE INSTCD-INSTR-DESC TO AP055-SPEC-INSTRUCT                31140000
311500                                     OF WS-SAVE-AFP-HEADER.       31150000
311600                                                                  31160000
311700     MOVE AP055-VND-NMBR OF WS-SAVE-AFP-HEADER TO                 31170000
311800                AP055-SORT-VENDOR-NBR OF WS-SAVE-AFP-HEADER.      31180000
311900                                                                  31190000
312000     MOVE AP055-INVOICE-NMBR OF WS-SAVE-AFP-HEADER TO             31200000
312100                AP055-SORT-INVOICE-NBR OF WS-SAVE-AFP-HEADER.     31210000
312200                                                                  31220000
312300     MOVE SPACES TO AP055-SORT-ITEM-SEQ OF WS-SAVE-AFP-HEADER     31230000
312400                  AP055-SORT-PO-LNE-NBR OF WS-SAVE-AFP-HEADER.    31240000
312500                                                                  31250000
312600     MOVE 0 TO WS-PAGE-NO.                                        31260000
312700     MOVE WS-PAGE-NO TO WS-EDITTED-PAGE-NO                        31270000
312800                      AP055-SORT-PAGE-NO OF WS-SAVE-AFP-HEADER.   31280000
312900     MOVE  WS-EDITTED-PAGE-NO TO                                  31290000
313000                           AP055-PAGE-NO OF WS-SAVE-AFP-HEADER.   31300000
313100                                                                  31310000
313200     MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC.                    31320000
313300                                                                  31330000
313400     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER.           31340000
313500     ADD 1 TO WS-AFPOUT-REC-CNT.                                  31350000
313600                                                                  31360000
313700     PERFORM UNTIL                                                31370000
313800          AP050-RECORD-TYPE-IND OF WS-WORK-REC NOT = '07'         31380000
313900        IF AP050-IT1-UNIT-MEASURE OF WS-WORK-REC NOT = 'AS'       31390000
314000           PERFORM W250-MOVE-AFP-DETAIL                           31400000
314100        END-IF                                                    31410000
314200        SET INV-INDX UP BY 1                                      31420000
314300        MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC                  31430000
314400     END-PERFORM.                                                 31440000
314500                                                                  31450000
314600*--------------------------------------------------------------*  31460000
314700* MOVE THE RECORD DETAIL TO THE OUTPUT RECORD                  *  31470000
314800*--------------------------------------------------------------*  31480000
314900 W250-MOVE-AFP-DETAIL.                                            31490000
315000                                                                  31500000
315100     MOVE SPACES TO AP055-DETAIL-AREA OF WS-AFP-OUT-REC           31510000
315200                    AP055-PAGE-TYPE OF WS-AFP-OUT-REC.            31520000
315300     MOVE '2' TO AP055-REC-TYPE OF WS-AFP-OUT-REC.                31530000
315400     SET AP055-NOT-HEADER-IND OF WS-AFP-OUT-REC TO TRUE.          31540000
315500                                                                  31550000
315600     MOVE 0 TO WS-ITEM-SEQ.                                       31560000
315700     MOVE WS-ITEM-SEQ TO AP055-ITEM-SEQ OF WS-AFP-OUT-REC         31570000
315800                         AP055-SORT-ITEM-SEQ OF WS-AFP-OUT-REC.   31580000
315900     IF AP050-PO-LNE-NBR OF WS-WORK-REC NOT = ZEROS               31590000
316000        MOVE AP050-PO-LNE-NBR OF WS-WORK-REC TO                   31600000
316100                AP055-SORT-PO-LNE-NBR-9S OF WS-AFP-OUT-REC        31610000
316200     ELSE                                                         31620000
316300        MOVE HIGH-VALUES TO                                       31630000
316400                AP055-SORT-PO-LNE-NBR OF WS-AFP-OUT-REC.          31640000
316500                                                                  31650000
316600     MOVE AP055-VND-NMBR OF WS-SAVE-AFP-HEADER TO                 31660000
316700                      AP055-SORT-VENDOR-NBR OF WS-AFP-OUT-REC.    31670000
316800     MOVE AP055-INVOICE-NMBR OF WS-SAVE-AFP-HEADER TO             31680000
316900                      AP055-SORT-INVOICE-NBR OF WS-AFP-OUT-REC.   31690000
317000                                                                  31700000
317100     MOVE  WS-PAGE-NO TO AP055-SORT-PAGE-NO OF WS-AFP-OUT-REC.    31710000
317200                                                                  31720000
317300     MOVE AP050-EAN-UPC OF WS-WORK-REC TO WS-EAN-UPC.             31730000
317400     IF AP050-ID-QUALIFIER OF WS-WORK-REC = 'UP'                  31740000
317500        MOVE WS-EAN-UPC(1:1)  TO WS-EAN-UPC-EDITTED(1:1)          31750000
317600        MOVE '-'              TO WS-EAN-UPC-EDITTED(2:1)          31760000
317700        MOVE WS-EAN-UPC(2:5)  TO WS-EAN-UPC-EDITTED(3:5)          31770000
317800        MOVE '-'              TO WS-EAN-UPC-EDITTED(8:1)          31780000
317900        MOVE WS-EAN-UPC(7:5)  TO WS-EAN-UPC-EDITTED(9:5)          31790000
318000        MOVE '-'              TO WS-EAN-UPC-EDITTED(14:1)         31800000
318100        MOVE WS-EAN-UPC(12:1) TO WS-EAN-UPC-EDITTED(15:1)         31810000
318200        MOVE SPACE            TO WS-EAN-UPC-EDITTED(16:1)         31820000
318300     ELSE                                                         31830000
318400        MOVE WS-EAN-UPC(1:2)  TO WS-EAN-UPC-EDITTED(1:2)          31840000
318500        MOVE '-'              TO WS-EAN-UPC-EDITTED(3:1)          31850000
318600        MOVE WS-EAN-UPC(3:5)  TO WS-EAN-UPC-EDITTED(4:5)          31860000
318700        MOVE '-'              TO WS-EAN-UPC-EDITTED(9:1)          31870000
318800        MOVE WS-EAN-UPC(8:5)  TO WS-EAN-UPC-EDITTED(10:5)         31880000
318900        MOVE '-'              TO WS-EAN-UPC-EDITTED(15:1)         31890000
319000        MOVE WS-EAN-UPC(13:1) TO WS-EAN-UPC-EDITTED(16:1).        31900000
319100        MOVE WS-EAN-UPC-EDITTED TO                                31910000
319200                 AP055-ID-QUAL-EAN-UPC OF WS-AFP-OUT-REC.         31920000
319300                                                                  31930000
319400     MOVE AP050-VENDOR-STYLE OF WS-WORK-REC TO                    31940000
319500                AP055-VND-STYLE OF WS-AFP-OUT-REC.                31950000
319600                                                                  31960000
319700     MOVE AP050-VENDOR-STYLE-DSCRPT OF WS-WORK-REC TO             31970000
319800                AP055-STYLE-DESC OF WS-AFP-OUT-REC.               31980000
319900                                                                  31990000
320000     MOVE AP050-NRMA-COLOR-CODE OF WS-WORK-REC TO                 32000000
320100                AP055-NRMA-COLOR-CODE OF WS-AFP-OUT-REC.          32010000
320200                                                                  32020000
320300     MOVE AP050-VENDOR-COLOR-DSCRPT OF WS-WORK-REC TO             32030000
320400                AP055-VND-COLOR-DESC OF WS-AFP-OUT-REC.           32040000
320500                                                                  32050000
320600     MOVE AP050-NRMA-SIZE-CODE OF WS-WORK-REC TO                  32060000
320700                AP055-NRMA-SIZE-CODE OF WS-AFP-OUT-REC.           32070000
320800                                                                  32080000
320900     MOVE AP050-VENDOR-SIZE-DSCRPT OF WS-WORK-REC TO              32090000
321000                AP055-VND-SIZE-DESC OF WS-AFP-OUT-REC.            32100000
321100                                                                  32110000
321200     MOVE AP050-QUANTITY-INVOICED OF WS-WORK-REC TO               32120000
321300                WS-EDIT-10.                                       32130000
321400     MOVE WS-EDIT-10 TO AP055-UNIT-QTY-INVOICED                   32140000
321500                                   OF WS-AFP-OUT-REC.             32150000
321600                                                                  32160000
321700     MOVE AP050-WHOLSALE-UNIT-COST OF WS-WORK-REC TO              32170000
321800                WS-DOL-14-2DEC.                                   32180000
321900     MOVE WS-DOL-14-2DEC TO AP055-UNIT-WHOLSALE-CST               32190000
322000                                   OF WS-AFP-OUT-REC.             32200000
322100                                                                  32210000
322200* 05-14-03                                                        32220000
322300* ADDED THIS INITIALIZATION OF AP050-PO-QTY AS TEMPOR. UNTIL      32230000
322400* FINANCIAL ITEM DOMAIN TABLES CAN BE ADDED AT A LATER DATE.      32240000
322500                                                                  32250000
322600     MOVE ZEROES TO AP050-PO-QTY OF WS-WORK-REC.                  32260000
322700     MOVE AP050-PO-QTY OF WS-WORK-REC TO WS-EDIT-10-NODEC.        32270000
322800     MOVE WS-EDIT-10-NODEC TO AP055-PO-QTY OF WS-AFP-OUT-REC.     32280000
322900                                                                  32290000
323000* 05-14-03                                                        32300000
323100* ADDED THIS INITIALIZATION OF AP050-PO-UNIT-COST TEMP UNTIL      32310000
323200* FINANCIAL ITEM DOMAIN TABLES CAN BE ADDED AT A LATER DATE.      32320000
323300                                                                  32330000
323400     MOVE ZEROES TO AP050-PO-UNIT-COST OF WS-WORK-REC.            32340000
323500     MOVE AP050-PO-UNIT-COST OF WS-WORK-REC TO WS-DOL-14-2DEC.    32350000
323600     MOVE WS-DOL-14-2DEC TO AP055-PO-UNIT-COST OF WS-AFP-OUT-REC. 32360000
323700                                                                  32370000
323800     COMPUTE WS-CALC-EXTEN-INVOICE-AMT ROUNDED                    32380000
323900        =    AP050-QUANTITY-INVOICED OF WS-WORK-REC               32390000
324000        *    AP050-WHOLSALE-UNIT-COST OF WS-WORK-REC.             32400000
324100                                                                  32410000
324200     MOVE WS-CALC-EXTEN-INVOICE-AMT TO WS-DOL-14-2DEC.            32420000
324300     MOVE WS-DOL-14-2DEC TO AP055-EXTEN-COST                      32430000
324400                                        OF WS-AFP-OUT-REC.        32440000
324500                                                                  32450000
324600     WRITE AFPOUT-AP055-RECORD FROM WS-AFP-OUT-REC.               32460000
324700     ADD 1 TO WS-AFPOUT-REC-CNT.                                  32470000
324800                                                                  32480000
324900*--------------------------------------------------------------*  32490000
325000* WRITE OUT AFP HEADER TO INDICATE THAT THERE WAS 'NO DATA' ON *  32500000
325100* A FORMATTED INVOICE FOR 'PAPER' COPY.                        *  32510000
325200*--------------------------------------------------------------*  32520000
325300 W260-WRITE-NODATA-AFP.                                           32530000
325400                                                                  32540000
325500     SET NODATA-AFP TO TRUE.                                      32550000
325600     MOVE SPACES TO WS-AFP-OUT-REC                                32560000
325700                    WS-SAVE-AFP-HEADER.                           32570000
325800                                                                  32580000
325900     MOVE NO-DATA-DESCRIPTION TO                                  32590000
326000                AP055-ND-DESCRIPTION OF WS-SAVE-AFP-HEADER.       32600000
326100                                                                  32610000
326200     MOVE ' ' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER.           32620000
326300     MOVE '1' TO AP055-REC-TYPE  OF WS-SAVE-AFP-HEADER.           32630000
326400     MOVE 'NDD' TO AP055-IND-CODE OF WS-SAVE-AFP-HEADER.          32640000
326500     MOVE 'APKED200-1' TO AP055-ND-PROGRAM-NUMBER                 32650000
326600                                  OF WS-SAVE-AFP-HEADER.          32660000
326700     MOVE DATE-IN-MM TO WS-DATE-MM.                               32670000
326800     MOVE DATE-IN-DD TO WS-DATE-DD.                               32680000
326900     MOVE DATE-IN-YY TO WS-DATE-YY.                               32690000
327000     MOVE WS-DATE  TO AP055-ND-REPORT-DATE  OF WS-SAVE-AFP-HEADER.32700000
327100                                                                  32710000
327200     MOVE WS-REC-07-CNT TO AP055-REC-07-CNT                       32720000
327300                                  OF WS-SAVE-AFP-HEADER.          32730000
327400                                                                  32740000
327500     MOVE SPACES TO AP055-SORT-ITEM-SEQ OF WS-SAVE-AFP-HEADER     32750000
327600                  AP055-SORT-PO-LNE-NBR OF WS-SAVE-AFP-HEADER     32760000
327700                  AP055-SORT-VENDOR-NBR OF WS-SAVE-AFP-HEADER     32770000
327800                 AP055-SORT-INVOICE-NBR OF WS-SAVE-AFP-HEADER.    32780000
327900                                                                  32790000
328000     MOVE 0 TO WS-PAGE-NO.                                        32800000
328100     MOVE WS-PAGE-NO TO WS-EDITTED-PAGE-NO                        32810000
328200                      AP055-SORT-PAGE-NO OF WS-SAVE-AFP-HEADER.   32820000
328300     MOVE  WS-EDITTED-PAGE-NO TO                                  32830000
328400                           AP055-PAGE-NO OF WS-SAVE-AFP-HEADER.   32840000
328500                                                                  32850000
328600     ADD  1 TO WS-PAGE-NO.                                        32860000
328700     MOVE WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                       32870000
328800     MOVE  WS-EDITTED-PAGE-NO TO                                  32880000
328900                           AP055-ND-PAGE-NO OF WS-SAVE-AFP-HEADER.32890000
329000                                                                  32900000
329100     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER.           32910000
329200     ADD 1 TO WS-AFPOUT-REC-CNT.                                  32920000
329300                                                                  32930000
329400*--------------------------------------------------------------*  32940000
329500* WRITE OUT THE REJECTED EDI INVOICE TRANSACTION RECORDS       *  32950000
329600*--------------------------------------------------------------*  32960000
329700 W300-WRITE-REJECT.                                               32970000
329800                                                                  32980000
329900     PERFORM VARYING INV-INDX FROM 1 BY 1                         32990000
330000        UNTIL INV-INDX > 11000 OR                                 33000000
330100              WS-AP050-KEY-AREA(INV-INDX) = HIGH-VALUES           33010000
330200        INITIALIZE WS-REJECT-REC                                  33020000
330300        MOVE WS-AP050-KEY-AREA(INV-INDX)  TO AP051-KEY            33030000
330400        MOVE WS-AP050-DATA-AREA(INV-INDX) TO AP051-DATA-AREA      33040000
330500        MOVE EXTENT-DUN-NBR      TO WS-DUN-NBR-X                  33050000
330600        MOVE WS-DUN-NBR-9S       TO AP051-SORT-VENDOR-NBR         33060000
330700        MOVE WS-SAVE-INVOICE-NBR TO AP051-SORT-INVOICE-NBR        33070000
330800        IF  WS-SAVE-INTERCHG-CNTL-NBR NUMERIC                     33080000
330900            MOVE WS-SAVE-INTERCHG-CNTL-NBR                        33090000
331000                               TO AP051-SAVE-INTERCHG-CNTL-NBR    33100000
331100        ELSE                                                      33110000
331200            MOVE ZEROS         TO AP051-SAVE-INTERCHG-CNTL-NBR    33120000
331300        END-IF                                                    33130000
331400        MOVE ENTNME-ENT-NAME-DESC TO AP051-VENDOR-DESC            33140000
331500        MOVE WS-INV-ERR-TBL-AREA(INV-INDX) TO                     33150000
331600                                      AP051-ERROR-CODE-AREA       33160000
331700        IF ERR-DETAIL-GROSS-INVOICE AND                           33170000
331800           WS-AP050-REC-TYPE(INV-INDX) = HIGH-VALUES              33180000
331900           COMPUTE WS-DETAIL-GROSS-INVOICE-AMT                    33190000
332000              =   (WS-DETAIL-GROSS-INVOICE-AMT                    33200000
332100              +    WS-DETAIL-CHRG-AMT)                            33210000
332200              -    WS-DETAIL-ALLW-AMT                             33220000
332300           MOVE WS-DETAIL-GROSS-INVOICE-AMT TO                    33230000
332400                                      AP051-CALC-SUM-EXTEN        33240000
332500           SET AP051-ERR-DETL-GROSS-INV TO TRUE                   33250000
332600           SET AP051-CHOSE-FOR-PRINT TO TRUE                      33260000
332700        END-IF                                                    33270000
332800        IF AP051-ERR-CD(1) NOT = '00' OR                          33280000
332900          (ERR-DETAIL-GROSS-INVOICE AND                           33290000
333000           (WS-AP050-REC-TYPE(INV-INDX) = '06' OR '07'))          33300000
333100           SET AP051-CHOSE-FOR-PRINT TO TRUE                      33310000
333200        END-IF                                                    33320000
333300        IF TOO-MANY-INVC-LINES                                    33330000
333400           IF FIRST-07-REC-NOT-WRITTEN                            33340000
333500              WRITE REJOUT-AP051-RECORD FROM WS-REJECT-REC        33350000
333600              ADD 1 TO WS-REJOUT-REC-CNT                          33360000
333700              IF AP051-INV-DETAILS                                33370000
333800                 SET FIRST-07-REC-WRITTEN TO TRUE                 33380000
333900              END-IF                                              33390000
334000           ELSE                                                   33400000
334100              IF WS-AP050-REC-TYPE(INV-INDX) = HIGH-VALUES        33410000
334200                 IF TOO-MANY-INVC-LINES                           33420000
334300                    SET AP051-ERR-TOO-MANY-LINES TO TRUE          33430000
334400                 END-IF                                           33440000
334500                 MOVE WS-TOT-INVC-LINES TO AP051-TOT-INVC-LINES   33450000
334600                 WRITE REJOUT-AP051-RECORD FROM WS-REJECT-REC     33460000
334700                 ADD 1 TO WS-REJOUT-REC-CNT                       33470000
334800              END-IF                                              33480000
334900           END-IF                                                 33490000
335000        ELSE                                                      33500000
335100           WRITE REJOUT-AP051-RECORD FROM WS-REJECT-REC           33510000
335200           ADD 1 TO WS-REJOUT-REC-CNT                             33520000
335300        END-IF                                                    33530000
335400     END-PERFORM.                                                 33540000
335500                                                                  33550000
335600*--------------------------------------------------------------*  33560000
335700* WRITE OUT THE CONSOLIDATED EDI INVOICE TRANSMISSION RECORDS  *  33570000
335800*--------------------------------------------------------------*  33580000
335900 W400-WRITE-CONSOLIDATED.                                         33590000
336000                                                                  33600000
336100     IF WS-AP050-REC-TYPE(1) = '01'                               33610000
336200        MOVE WS-INV-REC(1) TO WS-WORK-REC                         33620000
336300        PERFORM R800-SELECT-ENT-ID                                33630000
336400     ELSE                                                         33640000
336500        INITIALIZE DCLTEXTENT                                     33650000
336600        INITIALIZE DCLTENTNME.                                    33660000
336700                                                                  33670000
336800     PERFORM VARYING INV-INDX FROM 1 BY 1                         33680000
336900        UNTIL INV-INDX > 11000 OR                                 33690000
337000              WS-AP050-KEY-AREA(INV-INDX) = HIGH-VALUES           33700000
337100        INITIALIZE WS-REJECT-REC                                  33710000
337200        MOVE WS-AP050-KEY-AREA(INV-INDX)  TO AP051-KEY            33720000
337300        MOVE WS-AP050-DATA-AREA(INV-INDX) TO AP051-DATA-AREA      33730000
337400        MOVE EXTENT-DUN-NBR      TO WS-DUN-NBR-X                  33740000
337500        MOVE WS-DUN-NBR-9S       TO AP051-SORT-VENDOR-NBR         33750000
337600        MOVE WS-SAVE-INVOICE-NBR TO AP051-SORT-INVOICE-NBR        33760000
337700        IF WS-SAVE-INTERCHG-CNTL-NBR NUMERIC                      33770000
337800            MOVE WS-SAVE-INTERCHG-CNTL-NBR                        33780000
337900                               TO AP051-SAVE-INTERCHG-CNTL-NBR    33790000
338000        ELSE                                                      33800000
338100            MOVE ZEROES        TO AP051-SAVE-INTERCHG-CNTL-NBR    33810000
338200        END-IF                                                    33820000
338300        MOVE ENTNME-ENT-NAME-DESC TO AP051-VENDOR-DESC            33830000
338400        WRITE EDIOUT-CONS-RECORD  FROM WS-REJECT-REC              33840000
338500        ADD 1 TO WS-EDIOUT4-REC-CNT                               33850000
338600     END-PERFORM.                                                 33860000
338700                                                                  33870000
338800*--------------------------------------------------------------*  33880000
338900* FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS, AND    *  33890000
339000* CLOSE ALL FILES                                              *  33900000
339100*--------------------------------------------------------------*  33910000
339200 Z900-END-OF-JOB.                                                 33920000
339300                                                                  33930000
339400     CLOSE EDIIN-AP050-FILE                                       33940000
339500           REJOUT-AP051-FILE                                      33950000
339600           AFPOUT-AP055-FILE                                      33960000
339700           EDIOUT-AP051-CONS-FILE.                                33970000
339800                                                                  33980000
339900     DISPLAY '************************************************'.  33990000
340000     DISPLAY 'TOTAL INVOICES RECORDS READ    = '                  34000000
340100              WS-EDIIN-REC-CNT                                    34010000
340200     DISPLAY 'TOTAL REJECTED INVOICE RECORDS = '                  34020000
340300              WS-REJOUT-REC-CNT                                   34030000
340400     DISPLAY 'TOTAL AFP RECORDS WRITTEN      = '                  34040000
340500              WS-AFPOUT-REC-CNT.                                  34050000
340600     DISPLAY 'TOTAL CONSOLIDATED WRITTEN     = '                  34060000
340700              WS-EDIOUT4-REC-CNT.                                 34070000
340800     DISPLAY '************************************************'.  34080000
340900                                                                  34090000
341000     IF   NODATA-AFP                                              34100000
341100          DISPLAY ' THERE WAS NO DATA TO PROCESS FOR THE REPORT ' 34110000
341200     END-IF.                                                      34120000
341300                                                                  34130000
341400     IF   END-OF-EDIIN                                            34140000
341500          DISPLAY ' PROGRAM APKED200 ENDS NORMALLY '              34150000
341600     ELSE                                                         34160000
341700          DISPLAY ' PROGRAM APKED200 ENDS ABNORMALLY '            34170000
341800     END-IF.                                                      34180000
341900                                                                  34190000
342000     ACCEPT RUN-TIME FROM TIME.                                   34200000
342100     ACCEPT DATE-IN  FROM DATE.                                   34210000
342200                                                                  34220000
342300     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    34230000
342400     DISPLAY '************************************************'.  34240000
342500                                                                  34250000
342600*--------------------------------------------------------------*  34260000
342700* PROCESS DB2 ABENDS                                           *  34270000
342800*--------------------------------------------------------------*  34280000
342900 Z999-SQL-ERROR.                                                  34290000
343000                                                                  34300000
343100     DISPLAY '*** DB2 ERROR '.                                    34310000
343200     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 34320000
343300     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               34330000
343400     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               34340000
343500     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             34350000
343600     IF WS-ABEND-STRUCTURE-2 > SPACES                             34360000
343700         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         34370000
343800                                                                  34380000
343900     MOVE +4013                    TO ABEND-CODE.                 34390000
344000                                                                  34400000
344100     COPY DPPD004.                                                34410000
344200     CALL 'ILBOABN0' USING ABEND-CODE.                            34420000
344300                                                                  34430000
