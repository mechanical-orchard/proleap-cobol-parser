000100*                                                                 00010000
000200 IDENTIFICATION DIVISION.                                         00020001
000300*                                                                 00030001
000400 PROGRAM-ID.    SUKUT148.                                         00040001
000500 AUTHOR.        SUDHAN VEERASINGH.                                00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   APRIL 2011.                                       00070001
000800 DATE-COMPILED.                                                   00080001
000900*                                                                 00090001
001000******************************************************************00100001
001100*  THIS PROGRAM EXTRACTS THE RECORDS FOR CARTON PACKED QUERY      00110001
001200*  REPORT. IT EXECUTES 2 CURSORS TO BUILD THE OUTPUT.             00120001
001300******************************************************************00130001
001400*                                                                 00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600*                                                                 00160001
001700 CONFIGURATION SECTION.                                           00170001
001800*                                                                 00180001
001900 SOURCE-COMPUTER.        IBM-3090.                                00190001
002000 OBJECT-COMPUTER.        IBM-3090.                                00200001
002100*                                                                 00210001
002200 INPUT-OUTPUT SECTION.                                            00220001
002300*                                                                 00230001
002400 FILE-CONTROL.                                                    00240001
002500*                                                                 00250001
002600     SELECT INPUT-FILE                                            00260001
002700         ASSIGN TO CARDIN.                                        00270001
002800*                                                                 00280001
002900     SELECT OUTPUT-FILE                                           00290001
003000         ASSIGN TO OUT01.                                         00300001
003100*                                                                 00310001
003200 DATA DIVISION.                                                   00320001
003300*                                                                 00330001
003400 FILE SECTION.                                                    00340001
003500*                                                                 00350001
003600 FD  INPUT-FILE                                                   00360001
003700     RECORDING MODE IS F                                          00370001
003800     LABEL RECORDS ARE STANDARD                                   00380001
003900     BLOCK CONTAINS 0 RECORDS                                     00390001
004000     RECORD CONTAINS 080 CHARACTERS.                              00400001
004100 01  INPUT-RECORD                    PIC  X(080).                 00410001
004200*                                                                 00420001
004300 FD  OUTPUT-FILE                                                  00430001
004400     RECORDING MODE IS F                                          00440001
004500     BLOCK CONTAINS 0  RECORDS.                                   00450001
004600 01  OUTPUT-RECORD                   PIC  X(100).                 00460001
004700*                                                                 00470001
004800 WORKING-STORAGE SECTION.                                         00480001
004900*                                                                 00490001
005000******************************************************************00500001
005100*  DB2 FORMATTED MESSAGE AREA & OUTPUT FILE LAYOUT.               00510001
005200******************************************************************00520001
005300*                                                                 00530001
005400     COPY DPWS004.                                                00540001
005500*                                                                 00550001
005600     COPY SQLCA2.                                                 00560001
005700*                                                                 00570001
005800     COPY SURD101.                                                00580001
005900*                                                                 00590001
006000******************************************************************00600001
006100*  COMMUNICATIONS AREA FOR DB2                                    00610001
006200******************************************************************00620001
006300*                                                                 00630001
006400     EXEC SQL                                                     00640001
006500          INCLUDE SQLCA                                           00650001
006600     END-EXEC.                                                    00660001
006700*                                                                 00670001
006800******************************************************************00680001
006900*  SUT_OTBND_CART                                                 00690001
007000******************************************************************00700001
007100*                                                                 00710001
007200     EXEC SQL                                                     00720001
007300          INCLUDE SUT00024                                        00730001
007400     END-EXEC.                                                    00740001
007500*                                                                 00750001
007600******************************************************************00760001
007700*  SUT_OTBND_PKD_UPC                                              00770001
007800******************************************************************00780001
007900*                                                                 00790001
008000     EXEC SQL                                                     00800001
008100          INCLUDE SUT00025                                        00810001
008200     END-EXEC.                                                    00820001
008300*                                                                 00830001
008400******************************************************************00840001
008500*  SUT_OTBND_UPC                                                  00850001
008600******************************************************************00860001
008700*                                                                 00870001
008800     EXEC SQL                                                     00880001
008900          INCLUDE SUT00028                                        00890001
009000     END-EXEC.                                                    00900001
009100*                                                                 00910001
009200 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00920001
009300                                                   COMP SYNC.     00930001
009400 01  PS-PROGRAM-SWITCHES.                                         00940001
009500     05  PS-EOF-CURSOR-SW            PIC  X(01)    VALUE 'N'.     00950001
009600         88  PS-EOF-CURSOR-YES                     VALUE 'Y'.     00960001
009700         88  PS-EOF-CURSOR-NO                      VALUE 'N'.     00970001
009800     05  PS-EOF-MAIN-CURSOR-SW       PIC  X(01)    VALUE 'N'.     00980001
009900         88  PS-EOF-MAIN-CURSOR-YES                VALUE 'Y'.     00990001
010000         88  PS-EOF-MAIN-CURSOR-NO                 VALUE 'N'.     01000001
010100     05  PS-END-OF-INPUT-FILE-SW     PIC X(01)     VALUE 'N'.     01010001
010200         88  PS-END-OF-INPUT                       VALUE 'Y'.     01020001
010300         88  PS-NOT-END-OF-INPUT                   VALUE 'N'.     01030001
010400 01  DK-DB2-KEYS.                                                 01040001
010500     05  PV-NULL                     PIC S9(04) VALUE +0          01050001
010600                                                   COMP.          01060001
010700 01  PC-PROGRAM-CONSTANTS.                                        01070001
010800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01080001
010900         'SUKUT148'.                                              01090001
011000 01  PV-PROGRAM-VARIABLES.                                        01100001
011100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01110001
011200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01120001
011300     05  PV-SQLCODE                  PIC -9(09)    VALUE ZEROES.  01130001
011400     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01140001
011500     05  PV-CARTON-COUNT             PIC S9(04)    VALUE +0       01150001
011600                                                   COMP SYNC.     01160001
011700     05  PV-RECORDS-WRITTEN          PIC S9(09)    VALUE +0       01170001
011800                                                   COMP SYNC.     01180001
011900     05  PV-READ-COUNT               PIC S9(04)    VALUE +0       01190001
012000                                                   COMP SYNC.     01200001
012100     05  PV-SHIPT-UNT-ID             PIC S9(18)V   COMP-3         01210001
012200                                                   VALUE +0.      01220001
012300     05  PV-PO-NBR                   PIC S9(9)     COMP           01230001
012400                                                   VALUE +0.      01240001
012500 01  PV-IN-REC.                                                   01250001
012600     05  PV-PO-NUMBER                PIC 9(09)     VALUE ZEROES.  01260001
012700                                                                  01270001
012800*                                                                 01280001
012900     EXEC SQL                                                     01290001
013000     DECLARE CARTON-SEL-CSR CURSOR FOR                            01300001
013100       SELECT DISTINCT (A.SHIPT_UNT_ID)                           01310001
013200       FROM                                                       01320001
013300           SUT_OTBND_CART A                                       01330001
013400       ,   SUT_OTBND_UPC  B                                       01340001
013500       WHERE                                                      01350001
013600             A.CART_SRC_CDE  IN ('JWL','P2L')                     01360001
013700         AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                    01370001
013800         AND B.TRN_NBR        = :PV-PO-NBR                        01380001
013810         WITH UR                                                  01381001
013900     END-EXEC.                                                    01390001
014000*                                                                 01400001
014100     EXEC SQL                                                     01410001
014200     DECLARE CARTON-DTL-CSR CURSOR FOR                            01420001
014300       SELECT B.SHIPT_UNT_ID                                      01430001
014400       ,      C.ORGN_LOC_NBR                                      01440001
014500       ,      C.DEST_LOC_NBR                                      01450001
014600       ,      B.TRN_NBR                                           01460001
014700       ,      B.RCVR_SEQ_NBR                                      01470001
014800       ,      B.TRN_LNE_NBR                                       01480001
014900       ,      B.UPC_NBR                                           01490001
015000       ,      B.PKD_BY_USR_ID                                     01500001
015100       ,      B.PKD_TMST                                          01510001
015200       ,      B.PKD_QTY                                           01520001
015300       ,      B.MODU_NBR                                          01530001
015400       ,      C.OTBND_TRIP_ID                                     01540001
015500       FROM                                                       01550001
015600           SUT_OTBND_PKD_UPC B                                    01560001
015700       ,   SUT_OTBND_CART C                                       01570001
015800       WHERE                                                      01580001
015900             B.SHIPT_UNT_ID   = :PV-SHIPT-UNT-ID                  01590001
016000         AND B.TRN_NBR        = :PV-PO-NBR                        01600001
016100         AND B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                    01610001
016110         WITH UR                                                  01611001
016200     END-EXEC.                                                    01620001
016300*                                                                 01630001
016400 PROCEDURE DIVISION.                                              01640001
016500*                                                                 01650001
016600 0000-PROGRAM-MAINLINE.                                           01660001
016700*                                                                 01670001
016800******************************************************************01680001
016900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PGM*01690001
017000******************************************************************01700001
017100*                                                                 01710001
017200     DISPLAY '****** STARTING SUKUT148 ******'                    01720001
017300     PERFORM 1000-INITIALIZE.                                     01730001
017400     PERFORM 2000-PROCESS-INPUT                                   01740001
017500       UNTIL PS-EOF-MAIN-CURSOR-YES OR                            01750001
017600             PS-END-OF-INPUT                                      01760001
017700     PERFORM 9000-EOJ-ROUTINE.                                    01770001
017800*                                                                 01780001
017900     DISPLAY '****** EXECUTED SUKUT148 ******'                    01790001
018000     STOP RUN.                                                    01800001
018100*                                                                 01810001
018200 1000-INITIALIZE.                                                 01820001
018300*                                                                 01830001
018400******************************************************************01840001
018500*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01850001
018600******************************************************************01860001
018700*                                                                 01870001
018800     OPEN INPUT INPUT-FILE                                        01880001
018900          OUTPUT OUTPUT-FILE.                                     01890001
019000*                                                                 01900001
019100     SET PS-NOT-END-OF-INPUT TO TRUE.                             01910001
019200     SET PS-EOF-CURSOR-NO    TO TRUE.                             01920001
019300     PERFORM 1100-READ-EXTRACT-FILE.                              01930001
019400     MOVE PV-PO-NUMBER TO PV-PO-NBR                               01940001
019500     DISPLAY 'PO NBR : ' PV-PO-NBR                                01950001
019600     IF PS-END-OF-INPUT                                           01960001
019700        CONTINUE                                                  01970001
019800     ELSE                                                         01980001
019900        PERFORM 8000-OPEN-CURSOR                                  01990001
020000        PERFORM 8010-FETCH-CURSOR                                 02000001
020100        IF PS-EOF-MAIN-CURSOR-NO                                  02010001
020200           MOVE SUT00025-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID          02020001
020300           PERFORM 7000-OPEN-CURSOR                               02030001
020400        END-IF                                                    02040001
020500     END-IF.                                                      02050001
020600*                                                                 02060001
020700******************************************************************02070001
020800*  READS THE INPUT CARD                                          *02080001
020900******************************************************************02090001
021000*                                                                 02100001
021100 1100-READ-EXTRACT-FILE.                                          02110001
021200                                                                  02120001
021300     READ INPUT-FILE                                              02130001
021400       INTO PV-IN-REC                                             02140001
021500         AT END                                                   02150001
021600           SET PS-END-OF-INPUT TO TRUE                            02160001
021700         NOT AT END                                               02170001
021800             ADD 1                    TO PV-READ-COUNT            02180001
021900     END-READ.                                                    02190001
022000*                                                                 02200001
022100******************************************************************02210001
022200*  CONTROLS MAIN LOGIC OF THIS PROGRAM                            02220001
022300******************************************************************02230001
022400*                                                                 02240001
022500 2000-PROCESS-INPUT.                                              02250001
022600*                                                                 02260001
022700     PERFORM 7010-FETCH-CURSOR UNTIL  PS-EOF-CURSOR-YES           02270001
022800     IF PS-EOF-CURSOR-YES                                         02280001
022900        PERFORM 7020-CLOSE-CURSOR                                 02290001
023000        PERFORM 8010-FETCH-CURSOR                                 02300001
023100        MOVE SUT00025-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID             02310001
023200        PERFORM 7000-OPEN-CURSOR                                  02320001
023300     END-IF.                                                      02330001
023400*                                                                 02340001
023500******************************************************************02350001
023600*  OPENS THE DETAIL CURSOR                                        02360001
023700******************************************************************02370001
023800*                                                                 02380001
023900 7000-OPEN-CURSOR.                                                02390001
024000*                                                                 02400001
024100     EXEC SQL                                                     02410001
024200         OPEN CARTON-DTL-CSR                                      02420001
024300     END-EXEC.                                                    02430001
024400*                                                                 02440001
024500     EVALUATE TRUE                                                02450001
024600         WHEN SQLCODE = ZERO                                      02460001
024700             SET PS-EOF-CURSOR-NO     TO TRUE                     02470001
024800         WHEN SQLCODE = -904                                      02480001
024900         WHEN SQLCODE = -913                                      02490001
025000         WHEN SQLCODE = -911                                      02500001
025100         WHEN SQLWARN0 NOT = SPACES                               02510001
025200         WHEN SQLCODE NOT EQUAL ZERO                              02520001
025300             MOVE '7000-OPEN-CURSOR'  TO  PV-PARAGRAPH-NAME       02530001
025400             MOVE 'OPEN CURSOR '     TO                           02540001
025500                                   PV-DB2-OPERATION-ATTEMPTED     02550001
025600             MOVE SQLCODE  TO  PV-SQLCODE                         02560001
025700             PERFORM 9100-SQL-ABEND                               02570001
025800     END-EVALUATE.                                                02580001
025900*                                                                 02590001
026000******************************************************************02600001
026100*  FETCHES RECORDS FROM THE DETAIL CURSOR                         02610001
026200******************************************************************02620001
026300*                                                                 02630001
026400 7010-FETCH-CURSOR.                                               02640001
026500*                                                                 02650001
026600     EXEC SQL                                                     02660001
026700         FETCH CARTON-DTL-CSR                                     02670001
026800         INTO                                                     02680001
026900         :SUT00025-SHIPT-UNT-ID                                   02690001
027000       , :SUT00024-ORGN-LOC-NBR                                   02700001
027100       , :SUT00024-DEST-LOC-NBR                                   02710001
027200       , :SUT00025-TRN-NBR                                        02720001
027300       , :SUT00025-RCVR-SEQ-NBR                                   02730001
027400       , :SUT00025-TRN-LNE-NBR                                    02740001
027500       , :SUT00025-UPC-NBR                                        02750001
027600       , :SUT00025-PKD-BY-USR-ID                                  02760001
027700       , :SUT00025-PKD-TMST                                       02770001
027800       , :SUT00025-PKD-QTY                                        02780001
027900       , :SUT00025-MODU-NBR                                       02790001
028000       , :SUT00024-OTBND-TRIP-ID:PV-NULL                          02800001
028100     END-EXEC.                                                    02810001
028200*                                                                 02820001
028300     EVALUATE TRUE                                                02830001
028400         WHEN SQLCODE = ZERO                                      02840001
028500             ADD +1                      TO PV-CARTON-COUNT       02850001
028600             SET PS-EOF-CURSOR-NO  TO TRUE                        02860001
028700             MOVE SUT00025-SHIPT-UNT-ID  TO SU101-SHIPT-UNT-ID    02870001
028800             MOVE SUT00024-ORGN-LOC-NBR  TO SU101-ORGN-LOC-NBR    02880001
028900             MOVE SUT00024-DEST-LOC-NBR  TO SU101-DEST-LOC-NBR    02890001
029000             MOVE SUT00025-TRN-NBR       TO SU101-TRN-NBR         02900001
029100             MOVE SUT00025-RCVR-SEQ-NBR  TO SU101-RCVR-SEQ-NBR    02910001
029200             MOVE SUT00025-TRN-LNE-NBR   TO SU101-TRN-LNE-NBR     02920001
029300             MOVE SUT00025-UPC-NBR       TO SU101-UPC-NBR         02930001
029400             MOVE SUT00025-PKD-BY-USR-ID TO SU101-PKD-BY-USR-ID   02940001
029500             MOVE SUT00025-PKD-TMST      TO SU101-PKD-TMST        02950001
029600             MOVE SUT00025-PKD-QTY       TO SU101-PKD-QTY         02960001
029700             MOVE SUT00025-MODU-NBR      TO SU101-MODU-NBR        02970001
029710             IF PV-NULL = -1                                      02971001
029720                MOVE ZEROES              TO SU101-OTBND-TRIP-ID   02972001
029730             ELSE                                                 02973001
029740                MOVE SUT00024-OTBND-TRIP-ID                       02974001
029750                                         TO SU101-OTBND-TRIP-ID   02975001
029760             END-IF                                               02976001
029770             PERFORM 8500-WRITE-OUTPUT-RECORD                     02977001
029780         WHEN SQLCODE = +100                                      02978001
029790             SET PS-EOF-CURSOR-YES TO TRUE                        02979001
029800         WHEN SQLCODE = -904                                      02980001
029900         WHEN SQLCODE = -913                                      02990001
030000         WHEN SQLCODE = -911                                      03000001
030100         WHEN SQLWARN0 NOT = SPACES                               03010001
030200         WHEN SQLCODE NOT EQUAL ZERO                              03020001
030300             DISPLAY 'SHIPMENT UNIT ID : ' PV-SHIPT-UNT-ID        03030001
030400             MOVE '7010-FETCH-CURSOR'  TO  PV-PARAGRAPH-NAME      03040001
030500             MOVE 'FETCH CURSOR '     TO                          03050001
030600                                   PV-DB2-OPERATION-ATTEMPTED     03060001
030700             MOVE SQLCODE  TO  PV-SQLCODE                         03070001
030800             PERFORM 9100-SQL-ABEND                               03080001
030900     END-EVALUATE.                                                03090001
031000*                                                                 03100001
031100******************************************************************03110001
031200*  CLOSES THE DETAIL CURSOR                                       03120001
031300******************************************************************03130001
031400*                                                                 03140001
031500 7020-CLOSE-CURSOR.                                               03150001
031600*                                                                 03160001
031700     EXEC SQL                                                     03170001
031800         CLOSE CARTON-DTL-CSR                                     03180001
031900     END-EXEC.                                                    03190001
032000*                                                                 03200001
032100     EVALUATE TRUE                                                03210001
032200         WHEN SQLCODE = ZERO                                      03220001
032300             CONTINUE                                             03230001
032400         WHEN SQLCODE = -904                                      03240001
032500         WHEN SQLCODE = -913                                      03250001
032600         WHEN SQLCODE = -911                                      03260001
032700         WHEN SQLWARN0 NOT = SPACES                               03270001
032800         WHEN SQLCODE NOT EQUAL ZERO                              03280001
032900             MOVE '7020-CLOSE-CURSOR'  TO  PV-PARAGRAPH-NAME      03290001
033000             MOVE 'CLOSE CURSOR '     TO                          03300001
033100                                   PV-DB2-OPERATION-ATTEMPTED     03310001
033200             MOVE SQLCODE  TO  PV-SQLCODE                         03320001
033300             PERFORM 9100-SQL-ABEND                               03330001
033400     END-EVALUATE.                                                03340001
033500*                                                                 03350001
033600******************************************************************03360001
033700*  OPENS THE MAIN CURSOR                                          03370001
033800******************************************************************03380001
033900*                                                                 03390001
034000 8000-OPEN-CURSOR.                                                03400001
034100*                                                                 03410001
034200     EXEC SQL                                                     03420001
034300         OPEN CARTON-SEL-CSR                                      03430001
034400     END-EXEC.                                                    03440001
034500*                                                                 03450001
034600     EVALUATE TRUE                                                03460001
034700         WHEN SQLCODE = ZERO                                      03470001
034800             SET PS-EOF-MAIN-CURSOR-NO TO TRUE                    03480001
034900         WHEN SQLCODE = -904                                      03490001
035000         WHEN SQLCODE = -913                                      03500001
035100         WHEN SQLCODE = -911                                      03510001
035200         WHEN SQLWARN0 NOT = SPACES                               03520001
035300         WHEN SQLCODE NOT EQUAL ZERO                              03530001
035400             MOVE '8000-OPEN-CURSOR'  TO  PV-PARAGRAPH-NAME       03540001
035500             MOVE 'OPEN CURSOR '     TO                           03550001
035600                                   PV-DB2-OPERATION-ATTEMPTED     03560001
035700             MOVE SQLCODE  TO  PV-SQLCODE                         03570001
035800             PERFORM 9100-SQL-ABEND                               03580001
035900     END-EVALUATE.                                                03590001
036000*                                                                 03600001
036100******************************************************************03610001
036200*  FETCHES RECORDS FROM THE MAIN CURSOR                           03620001
036300******************************************************************03630001
036400*                                                                 03640001
036500 8010-FETCH-CURSOR.                                               03650001
036600                                                                  03660001
036700     EXEC SQL                                                     03670001
036800         FETCH CARTON-SEL-CSR                                     03680001
036900         INTO                                                     03690001
037000         :SUT00025-SHIPT-UNT-ID                                   03700001
037100     END-EXEC.                                                    03710001
037200*                                                                 03720001
037300     EVALUATE TRUE                                                03730001
037400         WHEN SQLCODE = ZERO                                      03740001
037500             SET PS-EOF-MAIN-CURSOR-NO  TO TRUE                   03750001
037600         WHEN SQLCODE = +100                                      03760001
037700             SET PS-EOF-MAIN-CURSOR-YES TO TRUE                   03770001
037800         WHEN SQLCODE = -904                                      03780001
037900         WHEN SQLCODE = -913                                      03790001
038000         WHEN SQLCODE = -911                                      03800001
038100         WHEN SQLWARN0 NOT = SPACES                               03810001
038200         WHEN SQLCODE NOT EQUAL ZERO                              03820001
038300             DISPLAY 'SHIPMENT UNIT ID : ' PV-SHIPT-UNT-ID        03830001
038400             MOVE '8010-FETCH-CURSOR'  TO  PV-PARAGRAPH-NAME      03840001
038500             MOVE 'FETCH CURSOR '     TO                          03850001
038600                                   PV-DB2-OPERATION-ATTEMPTED     03860001
038700             MOVE SQLCODE  TO  PV-SQLCODE                         03870001
038800             PERFORM 9100-SQL-ABEND                               03880001
038900     END-EVALUATE.                                                03890001
039000*                                                                 03900001
039100******************************************************************03910001
039200*  CLOSES THE MAIN CURSOR                                         03920001
039300******************************************************************03930001
039400*                                                                 03940001
039500 8020-CLOSE-CURSOR.                                               03950001
039600*                                                                 03960001
039700     EXEC SQL                                                     03970001
039800         CLOSE CARTON-SEL-CSR                                     03980001
039900     END-EXEC.                                                    03990001
040000*                                                                 04000001
040100     EVALUATE TRUE                                                04010001
040200         WHEN SQLCODE = ZERO                                      04020001
040300             CONTINUE                                             04030001
040400         WHEN SQLCODE = -904                                      04040001
040500         WHEN SQLCODE = -913                                      04050001
040600         WHEN SQLCODE = -911                                      04060001
040700         WHEN SQLWARN0 NOT = SPACES                               04070001
040800         WHEN SQLCODE NOT EQUAL ZERO                              04080001
040900             MOVE '8020-CLOSE-CURSOR'  TO  PV-PARAGRAPH-NAME      04090001
041000             MOVE 'CLOSE CURSOR '     TO                          04100001
041100                                   PV-DB2-OPERATION-ATTEMPTED     04110001
041200             MOVE SQLCODE  TO  PV-SQLCODE                         04120001
041300             PERFORM 9100-SQL-ABEND                               04130001
041400     END-EVALUATE.                                                04140001
041500*                                                                 04150001
041600******************************************************************04160001
041700*  WRITES RECORDS IN TO THE OUTPUT FILE.                          04170001
041800******************************************************************04180001
041900*                                                                 04190001
042000 8500-WRITE-OUTPUT-RECORD.                                        04200001
042100*                                                                 04210001
042200     WRITE OUTPUT-RECORD FROM SU101-EXTRACT-RECORD.               04220001
042300     INITIALIZE SU101-EXTRACT-RECORD.                             04230001
042400     ADD +1  TO PV-RECORDS-WRITTEN.                               04240001
042500*                                                                 04250001
042600******************************************************************04260001
042700*  CLOSES THE MAIN CURSOR & DISPLAYS THE RECORDS COUNT            04270001
042800******************************************************************04280001
042900*                                                                 04290001
043000 9000-EOJ-ROUTINE.                                                04300001
043100*                                                                 04310001
043200     IF PV-CARTON-COUNT > 1                                       04320001
043300        PERFORM 8020-CLOSE-CURSOR                                 04330001
043400     END-IF                                                       04340001
043500     MOVE PV-READ-COUNT      TO PV-DISPLAY-COUNT.                 04350001
043600     DISPLAY 'TOTAL RECORDS READ    : '  PV-DISPLAY-COUNT.        04360001
043700     MOVE PV-CARTON-COUNT    TO PV-DISPLAY-COUNT.                 04370001
043800     DISPLAY 'TOTAL CARTONS READ    : '  PV-DISPLAY-COUNT.        04380001
043900     MOVE PV-RECORDS-WRITTEN TO PV-DISPLAY-COUNT.                 04390001
044000     DISPLAY 'TOTAL RECORDS WRITTEN : '  PV-DISPLAY-COUNT.        04400001
044100*                                                                 04410001
044200******************************************************************04420001
044300*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04430001
044400*  ERROR OR WARNING CODE OCCURS.                                  04440001
044500******************************************************************04450001
044600*                                                                 04460001
044700 9100-SQL-ABEND.                                                  04470001
044800*                                                                 04480001
044900     PERFORM 9000-EOJ-ROUTINE.                                    04490001
045000     DISPLAY '** ABEND     **'.                                   04500001
045100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04510001
045200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04520001
045300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04530001
045400     DISPLAY '** SQLCODE   ** = ' PV-SQLCODE.                     04540001
045500     DISPLAY '***'                                                04550001
045600     EXEC SQL                                                     04560001
045700          ROLLBACK                                                04570001
045800     END-EXEC.                                                    04580001
045900******************************************************************04590001
046000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04600001
046100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04610001
046200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04620001
046300* FORMAT.                                                         04630001
046400******************************************************************04640001
046500     COPY DPPD004.                                                04650001
046600*                                                                 04660001
046700     MOVE +4013                  TO ABEND-CODE.                   04670001
046800     CALL 'ILBOABN0' USING ABEND-CODE.                            04680001
046900*                                                                 04690001
