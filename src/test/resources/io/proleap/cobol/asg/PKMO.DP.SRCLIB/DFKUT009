000200 IDENTIFICATION DIVISION.                                         00010001
000500 PROGRAM-ID.             DFKUT009.                                00020001
000600 AUTHOR.                 DEANNA BRANTNER.                         00030001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040001
000800 DATE-WRITTEN            DECEMBER 2009.                           00050001
000900 DATE-COMPILED.                                                   00060001
001200******************************************************************00070001
001300*  THIS PROGRAM IS A COPY OF DFKUT003 WITHOUT THE STORE CNTL CARD.00080001
001300*  THIS PROGRAM CREATES THE DAILY FLASH SALES FOR ALL STORES.     00081001
001400*  IT WILL BE A .CSV FILE SENT TO KRISTINE KENDER IN STORE ADMIN. 00090001
002700******************************************************************00150001
024500 ENVIRONMENT DIVISION.                                            00160001
024800 CONFIGURATION SECTION.                                           00170001
025000 SOURCE-COMPUTER.        IBM-3090.                                00190001
025100 OBJECT-COMPUTER.        IBM-3090.                                00200001
025200                                                                  00210001
025300 INPUT-OUTPUT SECTION.                                            00220001
025500 FILE-CONTROL.                                                    00230001
025600                                                                  00240001
026600     SELECT DATE-CONTROL-FILE                                     00280001
026700         ASSIGN TO INP01.                                         00290001
026800                                                                  00300001
027200     SELECT DAILY-FLASH-SALES                                     00310001
027300         ASSIGN TO OUT01.                                         00320001
027400                                                                  00330001
027500******************************************************************00340001
027600 DATA DIVISION.                                                   00350001
027900 FILE SECTION.                                                    00360001
028000                                                                  00370001
030800 FD  DATE-CONTROL-FILE                                            00450001
030900     LABEL RECORDS ARE STANDARD                                   00460001
031000     RECORDING MODE IS F                                          00470001
031100     BLOCK CONTAINS 0 RECORDS                                     00480001
031200     DATA RECORD IS DATE-CONTROL-RECORD.                          00490001
031300 01  DATE-CONTROL-RECORD        PIC X(80).                        00500001
032400                                                                  00510001
032400 FD  DAILY-FLASH-SALES                                            00520001
032500     RECORDING MODE F                                             00530001
032600     LABEL RECORDS ARE OMITTED                                    00540001
032700     BLOCK CONTAINS 0 RECORDS                                     00550001
032800     RECORD CONTAINS 600 CHARACTERS                               00560004
032900     DATA RECORD IS SALES-EXTRACT.                                00570001
033000                                                                  00580001
033100 01  SALES-EXTRACT               PIC X(600).                      00590004
O33200                                                                  00600001
027500******************************************************************00610001
033300 WORKING-STORAGE SECTION.                                         00620001
062900******************************************************************00630001
066300 01  COLUMN-HEADINGS.                                             00640001
066500     05  FILLER          PIC X(11)   VALUE 'METRO AREA,'.         00650001
066500     05  FILLER          PIC X(11)   VALUE 'METRO NAME,'.         00660004
066500     05  FILLER          PIC X(06)   VALUE 'STATE,'.              00661004
066500     05  FILLER          PIC X(06)   VALUE 'STORE,'.              00670001
066500     05  FILLER          PIC X(11)   VALUE 'STORE NAME,'.         00680001
066500     05  FILLER          PIC X(05)   VALUE 'DIST,'.               00681004
066500     05  FILLER          PIC X(05)   VALUE 'REGN,'.               00682004
066500     05  FILLER          PIC X(05)   VALUE 'TERR,'.               00683004
072500     05  FILLER          PIC X(19)   VALUE 'CMP DLY TY SALES $,'. 00690001
072700     05  FILLER          PIC X(19)   VALUE 'CMP DLY LY SALES $,'. 00700001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00710001
072500     05  FILLER          PIC X(19)   VALUE 'CMP WTD TY SALES $,'. 00720001
072700     05  FILLER          PIC X(19)   VALUE 'CMP WTD LY SALES $,'. 00730001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00740001
072500     05  FILLER          PIC X(19)   VALUE 'CMP MTD TY SALES $,'. 00750001
072700     05  FILLER          PIC X(19)   VALUE 'CMP MTD LY SALES $,'. 00760001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00770001
072500     05  FILLER          PIC X(19)   VALUE 'CMP QTD TY SALES $,'. 00780001
072700     05  FILLER          PIC X(19)   VALUE 'CMP QTD LY SALES $,'. 00790001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00800001
072500     05  FILLER          PIC X(19)   VALUE 'CMP STD TY SALES $,'. 00810001
072700     05  FILLER          PIC X(19)   VALUE 'CMP STD LY SALES $,'. 00820001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00830001
072500     05  FILLER          PIC X(19)   VALUE 'CMP YTD TY SALES $,'. 00840001
072700     05  FILLER          PIC X(19)   VALUE 'CMP YTD LY SALES $,'. 00850001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00860001
072500     05  FILLER          PIC X(19)   VALUE 'TOT DLY TY SALES $,'. 00870001
072700     05  FILLER          PIC X(19)   VALUE 'TOT DLY LY SALES $,'. 00880001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00890001
072500     05  FILLER          PIC X(19)   VALUE 'TOT WTD TY SALES $,'. 00900001
072700     05  FILLER          PIC X(19)   VALUE 'TOT WTD LY SALES $,'. 00910001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00920001
072500     05  FILLER          PIC X(19)   VALUE 'TOT MTD TY SALES $,'. 00930001
072700     05  FILLER          PIC X(19)   VALUE 'TOT MTD LY SALES $,'. 00940001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00950001
072500     05  FILLER          PIC X(19)   VALUE 'TOT QTD TY SALES $,'. 00960001
072700     05  FILLER          PIC X(19)   VALUE 'TOT QTD LY SALES $,'. 00970001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              00980001
072500     05  FILLER          PIC X(19)   VALUE 'TOT STD TY SALES $,'. 00990001
072700     05  FILLER          PIC X(19)   VALUE 'TOT STD LY SALES $,'. 01000001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              01010001
072500     05  FILLER          PIC X(19)   VALUE 'TOT YTD TY SALES $,'. 01020001
072700     05  FILLER          PIC X(19)   VALUE 'TOT YTD LY SALES $,'. 01030001
072900     05  FILLER          PIC X(06)   VALUE '% CHG,'.              01040001
074200                                                                  01050001
074300 01  DL-DETAIL-LINE.                                              01060001
074500     05  DL-METRO-AREA           PIC 9999    VALUE ZEROES.        01070001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01080001
075100     05  DL-METRO-NAME           PIC X(20)   VALUE SPACES.        01090001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01100001
075100     05  DL-STATE                PIC X(02)   VALUE SPACES.        01101004
074900     05  FILLER                  PIC X(01)   VALUE ','.           01102004
074500     05  DL-STORE                PIC 9999    VALUE ZEROES.        01110001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01120001
075100     05  DL-STORE-NAME           PIC X(20)   VALUE SPACES.        01130001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01140001
074500     05  DL-DIST                 PIC 9999    VALUE ZEROES.        01141004
074900     05  FILLER                  PIC X(01)   VALUE ','.           01142004
074500     05  DL-REGN                 PIC 9999    VALUE ZEROES.        01143004
074900     05  FILLER                  PIC X(01)   VALUE ','.           01144004
074500     05  DL-TERR                 PIC 9999    VALUE ZEROES.        01145004
074900     05  FILLER                  PIC X(01)   VALUE ','.           01146004
078300     05  DL-CMP-DLY-TY-SLS       PIC -999999999  VALUE ZERO.      01150001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01160001
078300     05  DL-CMP-DLY-LY-SLS       PIC -999999999  VALUE ZERO.      01170001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01180001
078900     05  DL-CMP-DLY-PCT-CHG      PIC -9999.9     VALUE ZERO.      01190001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01200001
078300     05  DL-CMP-WTD-TY-SLS       PIC -999999999  VALUE ZERO.      01210001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01220001
078300     05  DL-CMP-WTD-LY-SLS       PIC -999999999  VALUE ZERO.      01230001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01240001
078900     05  DL-CMP-WTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01250001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01260001
078300     05  DL-CMP-MTD-TY-SLS       PIC -999999999  VALUE ZERO.      01270001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01280001
078300     05  DL-CMP-MTD-LY-SLS       PIC -999999999  VALUE ZERO.      01290001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01300001
078900     05  DL-CMP-MTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01310001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01320001
078300     05  DL-CMP-QTD-TY-SLS       PIC -999999999  VALUE ZERO.      01330001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01340001
078300     05  DL-CMP-QTD-LY-SLS       PIC -999999999  VALUE ZERO.      01350001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01360001
078900     05  DL-CMP-QTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01370001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01380001
078300     05  DL-CMP-STD-TY-SLS       PIC -999999999  VALUE ZERO.      01390001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01400001
078300     05  DL-CMP-STD-LY-SLS       PIC -999999999  VALUE ZERO.      01410001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01420001
078900     05  DL-CMP-STD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01430001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01440001
078300     05  DL-CMP-YTD-TY-SLS       PIC -999999999  VALUE ZERO.      01450001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01460001
078300     05  DL-CMP-YTD-LY-SLS       PIC -999999999  VALUE ZERO.      01470001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01480001
078900     05  DL-CMP-YTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01490001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01500001
078300     05  DL-TOT-DLY-TY-SLS       PIC -999999999  VALUE ZERO.      01510001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01520001
078300     05  DL-TOT-DLY-LY-SLS       PIC -999999999  VALUE ZERO.      01530001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01540001
078900     05  DL-TOT-DLY-PCT-CHG      PIC -9999.9     VALUE ZERO.      01550001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01560001
078300     05  DL-TOT-WTD-TY-SLS       PIC -999999999  VALUE ZERO.      01570001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01580001
078300     05  DL-TOT-WTD-LY-SLS       PIC -999999999  VALUE ZERO.      01590001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01600001
078900     05  DL-TOT-WTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01610001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01620001
078300     05  DL-TOT-MTD-TY-SLS       PIC -999999999  VALUE ZERO.      01630001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01640001
078300     05  DL-TOT-MTD-LY-SLS       PIC -999999999  VALUE ZERO.      01650001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01660001
078900     05  DL-TOT-MTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01670001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01680001
078300     05  DL-TOT-QTD-TY-SLS       PIC -999999999  VALUE ZERO.      01690001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01700001
078300     05  DL-TOT-QTD-LY-SLS       PIC -999999999  VALUE ZERO.      01710001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01720001
078900     05  DL-TOT-QTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01730001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01740001
078300     05  DL-TOT-STD-TY-SLS       PIC -999999999  VALUE ZERO.      01750001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01760001
078300     05  DL-TOT-STD-LY-SLS       PIC -999999999  VALUE ZERO.      01770001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01780001
078900     05  DL-TOT-STD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01790001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01800001
078300     05  DL-TOT-YTD-TY-SLS       PIC -999999999  VALUE ZERO.      01810001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01820001
078300     05  DL-TOT-YTD-LY-SLS       PIC -999999999  VALUE ZERO.      01830001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01840001
078900     05  DL-TOT-YTD-PCT-CHG      PIC -9999.9     VALUE ZERO.      01850001
074900     05  FILLER                  PIC X(01)   VALUE ','.           01860001
074900     05  FILLER                  PIC X(03)   VALUE '   '.         01870001
075700                                                                  01880001
090700                                                                  01890001
103300 01  PC-CONSTANTS.                                                01900001
106100     05  PC-CURRENT-PROGRAM-NAME PIC   X(8) VALUE 'DFKUT009'.     01910001
106200                                                                  01920001
011800 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01930001
011900                                                  COMP SYNC.      01940001
012000     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01950001
012100     88  AC-DB2-ERROR                             VALUE +4013.    01960001
012200     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01970001
012300                                                                  01980001
106300 01  PS-PROGRAM-SWITCHES.                                         01990001
107100     05  PS-END-OF-STORE-SW      PIC X       VALUE 'N'.           02000001
107200         88 PS-END-OF-STORE-YES              VALUE 'Y'.           02010001
107100     05  PS-END-OF-FILE-SW       PIC X       VALUE 'N'.           02020001
107200         88 PS-END-OF-FILE-YES               VALUE 'Y'.           02030001
107100     05  PS-END-OF-DATE-SW       PIC X       VALUE 'N'.           02040001
107200         88 PS-END-OF-DATE-YES               VALUE 'Y'.           02050001
107100     05  PS-FOUND-TY-DATA-SW     PIC X       VALUE 'N'.           02060001
107200         88 PS-FOUND-TY-DATA-YES             VALUE 'Y'.           02070001
107100     05  PS-FOUND-LY-DATA-SW     PIC X       VALUE 'N'.           02080001
107200         88 PS-FOUND-LY-DATA-YES             VALUE 'Y'.           02090001
109700                                                                  02100001
109800 01  PV-PROGRAM-VARIABLES.                                        02190001
109900     05  PV-PARAGRAPH-NAME       PIC  X(30) VALUE SPACE.          02200001
109900     05  PV-OPERATION-MSG-1      PIC  X(30) VALUE SPACE.          02210001
109900     05  PV-OPERATION-MSG-2      PIC  X(30) VALUE SPACE.          02220001
109900     05  PV-SQLCODE              PIC S9(04) VALUE ZERO.           02230001
110000     05  PV-COMP-DATE            PIC  X(10) VALUE SPACE.          02240001
110000     05  PV-DATE                 PIC  X(10) VALUE SPACE.          02250001
115600                                                                  02260001
038100 01  PV-CMP-DLY-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02270001
038100 01  PV-CMP-WTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02280001
038100 01  PV-CMP-MTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02290001
038100 01  PV-CMP-QTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02300001
038100 01  PV-CMP-STD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02310001
038100 01  PV-CMP-YTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02320001
038100 01  PV-CMP-DLY-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02330001
038100 01  PV-CMP-WTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02340001
038100 01  PV-CMP-MTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02350001
038100 01  PV-CMP-QTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02360001
038100 01  PV-CMP-STD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02370001
038100 01  PV-CMP-YTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02380001
115600                                                                  02390001
038100 01  PV-TOT-DLY-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02400001
038100 01  PV-TOT-WTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02410001
038100 01  PV-TOT-MTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02420001
038100 01  PV-TOT-QTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02430001
038100 01  PV-TOT-STD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02440001
038100 01  PV-TOT-YTD-TY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02450001
038100 01  PV-TOT-DLY-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02460001
038100 01  PV-TOT-WTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02470001
038100 01  PV-TOT-MTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02480001
038100 01  PV-TOT-QTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02490001
038100 01  PV-TOT-STD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02500001
038100 01  PV-TOT-YTD-LY-SLS       PIC S9(11)V99 VALUE ZEROS COMP-3.    02510001
115600                                                                  02520001
066000     COPY DPWS004.                                                02530001
117500***************************************************************   02540001
117600*  DAILY FLASH LOCATION HIERARCHY TABLE - XSTW_DF_LOC_HIER        02550001
117500***************************************************************   02560001
117700     EXEC SQL                                                     02570001
117800        INCLUDE XST00125                                          02580001
117900     END-EXEC.                                                    02590001
118000                                                                  02600001
117500***************************************************************   02610001
118600*  DAILY FLASH SALE TABLE - DFT_DLY_FLSH_SUM                      02620001
117500***************************************************************   02630001
118700     EXEC SQL                                                     02640001
118800        INCLUDE DFT00000                                          02650001
118900     END-EXEC.                                                    02660001
119000                                                                  02670001
117500***************************************************************   02680001
118600*  HISTORY FLASH SALE TABLE - DFT_ML_FINCL_SUM                    02690001
117500***************************************************************   02700001
118700     EXEC SQL                                                     02710001
118800        INCLUDE DFT00002                                          02720001
118900     END-EXEC.                                                    02730001
119000                                                                  02740001
117500***************************************************************   02750001
118600*  DB2 TABLE DATE ATTRIBUTE                                       02760001
117500***************************************************************   02770001
118700     EXEC SQL                                                     02780001
118800        INCLUDE TDTATTR                                           02790001
118900     END-EXEC.                                                    02800001
119000                                                                  02810001
117500***************************************************************   02820001
117500*  DB2 COMMUNICATION AREA                                         02830001
117500***************************************************************   02840001
121200     EXEC SQL                                                     02850001
121300        INCLUDE SQLCA                                             02860001
121400     END-EXEC.                                                    02870001
121400                                                                  02880001
117500***************************************************************   02880101
117500*  CURSOR TO RETRIEVE STORE # FROM XSTW_DF_LOC_HIER               02880201
117500***************************************************************   02880301
122200     EXEC SQL                                                     02881001
022600        DECLARE STR-CURSOR CURSOR FOR                             02881101
122400         SELECT LOC_NBR                                           02882001
                    , DIST_NBR                                          02882104
                    , REGN_NBR                                          02882204
                    , TERR_NBR                                          02882304
                    , ST_CDE                                            02882404
                    , MN_SLS_INCL_DTE                                   02882504
122500              , QTR_SLS_INCL_DTE                                  02883001
122500              , SEA_SLS_INCL_DTE                                  02884001
122500              , YR_SLS_INCL_DTE                                   02885001
122900          FROM XSTW_DF_LOC_HIER                                   02889101
122900         WHERE  OPN_DTE     <= :PV-DATE                           02889201
024802           AND (CLO_DTE     >= :PV-DATE OR                        02889401
024803                CLO_DTE     IS NULL)                              02889501
024900         ORDER BY LOC_NBR                                         02889601
025100                  FOR READ ONLY                                   02889701
123400               WITH UR                                            02889801
123500     END-EXEC.                                                    02889901
063500                                                                  02890001
140200******************************************************************02891001
140300 PROCEDURE DIVISION.                                              02900001
048900******************************************************************02910001
049300 0000-MAINLINE-PARAGRAPH.                                         02920001
049400                                                                  02930001
049500     PERFORM 1000-INITIALIZATION.                                 02940001
049600                                                                  02950001
051700     PERFORM 1300-GET-LY-COMP-DATE.                               02960001
051600                                                                  02970001
092100     DISPLAY 'TY   DATE= '  PV-DATE.                              02980001
092100     DISPLAY 'LY   DATE= '  PV-COMP-DATE.                         02990001
092200                                                                  03000001
050000     PERFORM 2000-PROCESS-STORES                                  03020001
050000         UNTIL PS-END-OF-STORE-YES.                               03030001
050300                                                                  03040001
050200     CLOSE DAILY-FLASH-SALES.                                     03050001
050300                                                                  03060001
050400     STOP RUN.                                                    03070001
050500                                                                  03080001
050700******************************************************************03090001
050800 1000-INITIALIZATION.                                             03100001
050900*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS.   03110001
051000******************************************************************03120001
051200     OPEN INPUT DATE-CONTROL-FILE                                 03130001
051300         OUTPUT DAILY-FLASH-SALES.                                03150001
051400                                                                  03160001
075200     READ DATE-CONTROL-FILE INTO PV-DATE                          03170001
075300         AT END                                                   03180001
075400             SET PS-END-OF-DATE-YES TO TRUE.                      03190001
                                                                        03200001
052700     CLOSE DATE-CONTROL-FILE.                                     03210001
054600                                                                  03220001
057500     MOVE PV-DATE        TO DTATTR-KY-DTE                         03230001
036500                            DFT00000-SLS-DTE.                     03240001
057700                                                                  03250001
058300*------------------------------------------                       03330001
058200* WRITE COLUMN HEADINGS TO OUTPUT FILE.                           03340001
058300*------------------------------------------                       03350001
479800     WRITE SALES-EXTRACT                                          03360001
479900        FROM COLUMN-HEADINGS.                                     03370001
478300     INITIALIZE SALES-EXTRACT.                                    03380001
484400                                                                  03390001
058300*------------------------------------------                       03400001
058200* FETCH FIRST STORE RECORD.                                       03410001
058300*------------------------------------------                       03420001
479800     PERFORM 3000-OPEN-CURSOR.                                    03430001
479900     PERFORM 3100-FETCH-CURSOR.                                   03440001
484400                                                                  03460001
035700******************************************************************03510001
036200 1300-GET-LY-COMP-DATE.                                           03520001
035900*      GET LAST YEAR FISCAL DAY FOR INPUT DATE.                   03530001
036100******************************************************************03540001
036900     EXEC SQL                                                     03550001
037000         SELECT LY_THIS_DAY_KY_DTE                                03560001
037200           INTO :PV-COMP-DATE                                     03570001
037400           FROM  TDTATTR                                          03580001
037500          WHERE KY_DTE = :DTATTR-KY-DTE                           03590001
037600           WITH UR                                                03600001
037700     END-EXEC.                                                    03610001
037800                                                                  03620001
037900     EVALUATE TRUE                                                03630001
038000         WHEN SQLCODE = 0                                         03640001
038100             CONTINUE                                             03650001
038200         WHEN OTHER                                               03660001
038300             MOVE '1300-GET-LY-COMP-DATE' TO PV-PARAGRAPH-NAME    03670001
038500             MOVE SQLCODE                 TO PV-SQLCODE           03680001
038700             PERFORM 9100-SQL-ABEND                               03690001
038800     END-EVALUATE.                                                03700001
038900                                                                  03710001
061700******************************************************************03720001
061800 2000-PROCESS-STORES.                                             03730001
061900******************************************************************03740001
075400         MOVE 'N' TO PS-FOUND-TY-DATA-SW                          03790001
039700         PERFORM 4000-GET-TY-SALE                                 03800001
039700         IF PS-FOUND-TY-DATA-YES                                  03810001
122900             MOVE XST00125-METRO-ID      TO DL-METRO-AREA         03821003
122900             MOVE XST00125-METRO-NM      TO DL-METRO-NAME         03830001
122900             MOVE XST00125-ST-CDE        TO DL-STATE              03830104
122900             MOVE XST00125-LOC-NBR       TO DL-STORE              03831003
122900             MOVE XST00125-LOC-NM        TO DL-STORE-NAME         03840001
122900             MOVE XST00125-DIST-NBR      TO DL-DIST               03841004
122900             MOVE XST00125-REGN-NBR      TO DL-REGN               03842004
122900             MOVE XST00125-TERR-NBR      TO DL-TERR               03843004
122900             MOVE DFT00000-DLY-DOL-AMT   TO PV-TOT-DLY-TY-SLS     03850001
122900             MOVE DFT00000-WTD-DOL-AMT   TO PV-TOT-WTD-TY-SLS     03860001
122900             MOVE DFT00000-MTD-DOL-AMT   TO PV-TOT-MTD-TY-SLS     03870001
122900             MOVE DFT00000-QTD-DOL-AMT   TO PV-TOT-QTD-TY-SLS     03880001
122900             MOVE DFT00000-S-T-D-DOL-AMT TO PV-TOT-STD-TY-SLS     03890001
122900             MOVE DFT00000-YTD-DOL-AMT   TO PV-TOT-YTD-TY-SLS     03900001
122900             IF PV-DATE >= XST00125-YR-SLS-INCL-DTE               03910001
122900                MOVE DFT00000-DLY-DOL-AMT   TO PV-CMP-DLY-TY-SLS  03920001
122900                MOVE DFT00000-WTD-DOL-AMT   TO PV-CMP-WTD-TY-SLS  03930001
122900                MOVE DFT00000-MTD-DOL-AMT   TO PV-CMP-MTD-TY-SLS  03940001
122900                MOVE DFT00000-QTD-DOL-AMT   TO PV-CMP-QTD-TY-SLS  03950001
122900                MOVE DFT00000-S-T-D-DOL-AMT TO PV-CMP-STD-TY-SLS  03960001
122900                MOVE DFT00000-YTD-DOL-AMT   TO PV-CMP-YTD-TY-SLS  03970001
                   ELSE                                                 03980001
122900              IF PV-DATE >= XST00125-SEA-SLS-INCL-DTE             03990001
122900                 MOVE DFT00000-DLY-DOL-AMT TO PV-CMP-DLY-TY-SLS   04000001
122900                 MOVE DFT00000-WTD-DOL-AMT TO PV-CMP-WTD-TY-SLS   04010001
122900                 MOVE DFT00000-MTD-DOL-AMT TO PV-CMP-MTD-TY-SLS   04020001
122900                 MOVE DFT00000-QTD-DOL-AMT TO PV-CMP-QTD-TY-SLS   04030001
122900                 MOVE DFT00000-S-T-D-DOL-AMT TO PV-CMP-STD-TY-SLS 04040001
122900                 MOVE ZERO                   TO PV-CMP-YTD-TY-SLS 04050001
                    ELSE                                                04060001
122900               IF PV-DATE >= XST00125-QTR-SLS-INCL-DTE            04070001
122900                  MOVE DFT00000-DLY-DOL-AMT TO PV-CMP-DLY-TY-SLS  04080001
122900                  MOVE DFT00000-WTD-DOL-AMT TO PV-CMP-WTD-TY-SLS  04090001
122900                  MOVE DFT00000-MTD-DOL-AMT TO PV-CMP-MTD-TY-SLS  04100001
122900                  MOVE DFT00000-QTD-DOL-AMT TO PV-CMP-QTD-TY-SLS  04110001
122900                  MOVE ZERO                 TO PV-CMP-STD-TY-SLS  04120001
122900                                               PV-CMP-YTD-TY-SLS  04121001
                     ELSE                                               04122001
122900                IF PV-DATE >= XST00125-MN-SLS-INCL-DTE            04123001
122900                  MOVE DFT00000-DLY-DOL-AMT TO PV-CMP-DLY-TY-SLS  04124001
122900                  MOVE DFT00000-WTD-DOL-AMT TO PV-CMP-WTD-TY-SLS  04125001
122900                  MOVE DFT00000-MTD-DOL-AMT TO PV-CMP-MTD-TY-SLS  04126001
122900                  MOVE ZERO                 TO PV-CMP-QTD-TY-SLS  04126101
122900                                               PV-CMP-STD-TY-SLS  04126201
122900                                               PV-CMP-YTD-TY-SLS  04126301
                      ELSE                                              04126401
122900                  MOVE ZERO               TO PV-CMP-DLY-TY-SLS    04126501
122900                                             PV-CMP-WTD-TY-SLS    04126601
122900                                             PV-CMP-MTD-TY-SLS    04126701
122900                                             PV-CMP-QTD-TY-SLS    04126801
122900                                             PV-CMP-STD-TY-SLS    04126901
122900                                             PV-CMP-YTD-TY-SLS    04127001
                      END-IF                                            04127101
                     END-IF                                             04127201
                    END-IF                                              04127301
                   END-IF                                               04127401
               ELSE                                                     04127501
122900             MOVE SPACES TO DL-METRO-NAME                         04127601
122900                            DL-STORE-NAME                         04127701
063800             MOVE ZERO TO PV-CMP-DLY-TY-SLS                       04127801
063800                          PV-CMP-WTD-TY-SLS                       04127901
063800                          PV-CMP-MTD-TY-SLS                       04128001
063800                          PV-CMP-QTD-TY-SLS                       04129001
063800                          PV-CMP-STD-TY-SLS                       04130001
063800                          PV-CMP-YTD-TY-SLS                       04140001
063800                          PV-TOT-DLY-TY-SLS                       04150001
063800                          PV-TOT-WTD-TY-SLS                       04160001
063800                          PV-TOT-MTD-TY-SLS                       04170001
063800                          PV-TOT-QTD-TY-SLS                       04180001
063800                          PV-TOT-STD-TY-SLS                       04190001
063800                          PV-TOT-YTD-TY-SLS                       04200001
                                DL-METRO-AREA                           04210001
122900             MOVE XST00125-LOC-NBR  TO DL-STORE                   04220004
122900             MOVE XST00125-DIST-NBR TO DL-DIST                    04221004
122900             MOVE XST00125-REGN-NBR TO DL-REGN                    04222004
122900             MOVE XST00125-TERR-NBR TO DL-TERR                    04223004
122900             MOVE XST00125-ST-CDE   TO DL-STATE                   04224004
               END-IF                                                   04230001
075400         MOVE 'N' TO PS-FOUND-LY-DATA-SW                          04240001
039700         PERFORM 5000-GET-LY-SALE                                 04250001
039700         IF PS-FOUND-LY-DATA-YES                                  04260001
122900             MOVE DFT00002-DLY-DOL-AMT   TO PV-TOT-DLY-LY-SLS     04270001
122900             MOVE DFT00002-WTD-DOL-AMT   TO PV-TOT-WTD-LY-SLS     04280001
122900             MOVE DFT00002-MTD-DOL-AMT   TO PV-TOT-MTD-LY-SLS     04290001
122900             MOVE DFT00002-QTD-DOL-AMT   TO PV-TOT-QTD-LY-SLS     04300001
122900             MOVE DFT00002-S-T-D-DOL-AMT TO PV-TOT-STD-LY-SLS     04310001
122900             MOVE DFT00002-YTD-DOL-AMT   TO PV-TOT-YTD-LY-SLS     04320001
122900             IF PV-DATE >= XST00125-YR-SLS-INCL-DTE               04330001
122900                MOVE DFT00002-DLY-DOL-AMT   TO PV-CMP-DLY-LY-SLS  04340001
122900                MOVE DFT00002-WTD-DOL-AMT   TO PV-CMP-WTD-LY-SLS  04350001
122900                MOVE DFT00002-MTD-DOL-AMT   TO PV-CMP-MTD-LY-SLS  04360001
122900                MOVE DFT00002-QTD-DOL-AMT   TO PV-CMP-QTD-LY-SLS  04370001
122900                MOVE DFT00002-S-T-D-DOL-AMT TO PV-CMP-STD-LY-SLS  04380001
122900                MOVE DFT00002-YTD-DOL-AMT   TO PV-CMP-YTD-LY-SLS  04390001
                   ELSE                                                 04400001
122900              IF PV-DATE >= XST00125-SEA-SLS-INCL-DTE             04410001
122900                 MOVE DFT00002-DLY-DOL-AMT   TO PV-CMP-DLY-LY-SLS 04420001
122900                 MOVE DFT00002-WTD-DOL-AMT   TO PV-CMP-WTD-LY-SLS 04421001
122900                 MOVE DFT00002-MTD-DOL-AMT   TO PV-CMP-MTD-LY-SLS 04422001
122900                 MOVE DFT00002-QTD-DOL-AMT   TO PV-CMP-QTD-LY-SLS 04423001
122900                 MOVE DFT00002-S-T-D-DOL-AMT TO PV-CMP-STD-LY-SLS 04424001
122900                 MOVE ZERO                   TO PV-CMP-YTD-LY-SLS 04425001
                    ELSE                                                04426001
122900               IF PV-DATE >= XST00125-QTR-SLS-INCL-DTE            04427001
122900                  MOVE DFT00002-DLY-DOL-AMT TO PV-CMP-DLY-LY-SLS  04428001
122900                  MOVE DFT00002-WTD-DOL-AMT TO PV-CMP-WTD-LY-SLS  04429001
122900                  MOVE DFT00002-MTD-DOL-AMT TO PV-CMP-MTD-LY-SLS  04430001
122900                  MOVE DFT00002-QTD-DOL-AMT TO PV-CMP-QTD-LY-SLS  04430101
122900                  MOVE ZERO                 TO PV-CMP-STD-LY-SLS  04430201
122900                                               PV-CMP-YTD-LY-SLS  04430301
                     ELSE                                               04430401
122900                IF PV-DATE >= XST00125-MN-SLS-INCL-DTE            04430501
122900                  MOVE DFT00002-DLY-DOL-AMT TO PV-CMP-DLY-LY-SLS  04430601
122900                  MOVE DFT00002-WTD-DOL-AMT TO PV-CMP-WTD-LY-SLS  04430701
122900                  MOVE DFT00002-MTD-DOL-AMT TO PV-CMP-MTD-LY-SLS  04430801
122900                  MOVE ZERO                 TO PV-CMP-QTD-LY-SLS  04430901
122900                                               PV-CMP-STD-LY-SLS  04431001
122900                                               PV-CMP-YTD-LY-SLS  04431101
                      ELSE                                              04431201
122900                  MOVE ZERO               TO PV-CMP-DLY-LY-SLS    04431301
122900                                             PV-CMP-WTD-LY-SLS    04431401
122900                                             PV-CMP-MTD-LY-SLS    04431501
122900                                             PV-CMP-QTD-LY-SLS    04431601
122900                                             PV-CMP-STD-LY-SLS    04431701
122900                                             PV-CMP-YTD-LY-SLS    04431801
                      END-IF                                            04431901
                     END-IF                                             04432001
                    END-IF                                              04432101
                   END-IF                                               04432201
               ELSE                                                     04432301
063800             MOVE ZEROES TO  PV-CMP-DLY-LY-SLS                    04432401
122900                             PV-CMP-WTD-LY-SLS                    04432501
122900                             PV-CMP-MTD-LY-SLS                    04432601
122900                             PV-CMP-QTD-LY-SLS                    04432701
122900                             PV-CMP-STD-LY-SLS                    04432801
122900                             PV-CMP-YTD-LY-SLS                    04432901
063800                             PV-TOT-DLY-LY-SLS                    04433001
122900                             PV-TOT-WTD-LY-SLS                    04434001
122900                             PV-TOT-MTD-LY-SLS                    04435001
122900                             PV-TOT-QTD-LY-SLS                    04436001
122900                             PV-TOT-STD-LY-SLS                    04437001
122900                             PV-TOT-YTD-LY-SLS                    04438001
               END-IF                                                   04439001
039700         PERFORM 6000-PREP-DETAIL-ROW                             04440001
064000         PERFORM 7000-WRITE-STORE-ROW                             04450001
122900         IF PS-END-OF-STORE-SW = 'N'                              04460001
122900             PERFORM 3100-FETCH-CURSOR                            04470001
122900         END-IF.                                                  04480001
039900                                                                  04500001
061700******************************************************************04510001
061800 3000-OPEN-CURSOR.                                                04520001
061900******************************************************************04530001
056000     EXEC SQL                                                     04530101
056100          OPEN STR-CURSOR                                         04530201
056200     END-EXEC.                                                    04530301
056300                                                                  04530401
056400     EVALUATE TRUE                                                04530501
056500         WHEN SQLCODE = ZERO                                      04530601
056600              CONTINUE                                            04530701
056700         WHEN SQLWARN0 NOT EQUAL SPACE                            04530801
056800         WHEN SQLCODE NOT EQUAL ZERO                              04530901
056900             MOVE '3000-OPEN-CURSOR'   TO PV-PARAGRAPH-NAME       04531001
038500             MOVE SQLCODE              TO PV-SQLCODE              04531102
057100             MOVE 'ERROR ON OPEN OF STR-CURSOR'                   04531201
057200                                            TO PV-OPERATION-MSG-1 04531302
057300             PERFORM 9100-SQL-ABEND                               04531401
057400     END-EVALUATE.                                                04531501
057500                                                                  04531601
061700******************************************************************04531701
061800 3100-FETCH-CURSOR.                                               04532001
061900******************************************************************04533001
122200     EXEC SQL                                                     04540001
122400         FETCH STR-CURSOR                                         04550001
122900          INTO :XST00125-LOC-NBR                                  04590001
                    ,:XST00125-DIST-NBR                                 04590104
                    ,:XST00125-REGN-NBR                                 04590204
                    ,:XST00125-TERR-NBR                                 04590304
                    ,:XST00125-ST-CDE                                   04590404
122900              ,:XST00125-MN-SLS-INCL-DTE                          04591001
122900              ,:XST00125-QTR-SLS-INCL-DTE                         04600001
122900              ,:XST00125-SEA-SLS-INCL-DTE                         04610001
122900              ,:XST00125-YR-SLS-INCL-DTE                          04620001
123500     END-EXEC.                                                    04660001
063500                                                                  04670001
063600     EVALUATE TRUE                                                04680001
063700        WHEN SQLCODE = ZERO                                       04690001
075400            CONTINUE                                              04691001
063700        WHEN SQLCODE = +100                                       04700001
075400            SET PS-END-OF-STORE-YES TO TRUE                       04710001
038200        WHEN OTHER                                                04720001
038300            MOVE '3100-FETCH-CURSOR ' TO PV-PARAGRAPH-NAME        04730001
038500            MOVE SQLCODE              TO PV-SQLCODE               04730102
057100            MOVE 'ERROR ON FETCH OF STR-CURSOR'                   04731002
057200                                            TO PV-OPERATION-MSG-1 04732002
038700            PERFORM 9100-SQL-ABEND                                04750001
038800     END-EVALUATE.                                                04760001
065200                                                                  04770001
061700******************************************************************04771001
061800 3200-CLOSE-CURSOR.                                               04772001
061900******************************************************************04773001
056000     EXEC SQL                                                     04774001
056100          CLOSE STR-CURSOR                                        04775001
056200     END-EXEC.                                                    04776001
056300                                                                  04777001
056400     EVALUATE TRUE                                                04778001
056500         WHEN SQLCODE = ZERO                                      04779001
056600              CONTINUE                                            04779101
056700         WHEN SQLWARN0 NOT EQUAL SPACE                            04779201
056800         WHEN SQLCODE NOT EQUAL ZERO                              04779301
056900             MOVE '3200-CLOSE-CURSOR'   TO PV-PARAGRAPH-NAME      04779401
038500             MOVE SQLCODE               TO PV-SQLCODE             04779502
057100             MOVE 'ERROR ON CLOSE OF STR-CURSOR'                  04779601
057200                                            TO PV-OPERATION-MSG-1 04779702
057300             PERFORM 9100-SQL-ABEND                               04779801
057400     END-EVALUATE.                                                04779901
057500                                                                  04780001
061700******************************************************************04781001
061800 4000-GET-TY-SALE.                                                04790001
061900******************************************************************04800001
122200     EXEC SQL                                                     04810001
              SELECT  METRO_ID                                          04820001
                    , METRO_NM                                          04830001
                    , LOC_NM                                            04840001
122400              , COALESCE(SUM(DLY_DOL_AMT),0)                      04850001
122500              , COALESCE(SUM(WTD_DOL_AMT),0)                      04860001
122500              , COALESCE(SUM(MTD_DOL_AMT),0)                      04870001
122500              , COALESCE(SUM(QTD_DOL_AMT),0)                      04880001
122500              , COALESCE(SUM(S_T_D_DOL_AMT),0)                    04890001
122500              , COALESCE(SUM(YTD_DOL_AMT),0)                      04900001
122900          INTO :XST00125-METRO-ID                                 04910001
122900              ,:XST00125-METRO-NM                                 04920001
122900              ,:XST00125-LOC-NM                                   04930001
122900              ,:DFT00000-DLY-DOL-AMT                              04940001
122900              ,:DFT00000-WTD-DOL-AMT                              04950001
122900              ,:DFT00000-MTD-DOL-AMT                              04960001
122900              ,:DFT00000-QTD-DOL-AMT                              04970001
122900              ,:DFT00000-S-T-D-DOL-AMT                            04980001
122900              ,:DFT00000-YTD-DOL-AMT                              04990001
122900          FROM DFT_DLY_FLSH_SUM                                   05000001
122900             , XSTW_DF_LOC_HIER                                   05010001
122900         WHERE LOC_NBR = STR_NBR                                  05020001
122900           AND SLS_DTE = :DTATTR-KY-DTE                           05030001
122900           AND STR_NBR = :XST00125-LOC-NBR                        05040001
             GROUP BY METRO_ID                                          05050001
                    , METRO_NM                                          05060001
                    , LOC_NM                                            05070001
123400         WITH UR                                                  05080001
123500     END-EXEC.                                                    05090001
063500                                                                  05100001
063600     EVALUATE TRUE                                                05110001
063700        WHEN SQLCODE = ZERO                                       05120001
075400            SET PS-FOUND-TY-DATA-YES TO TRUE                      05130001
063700        WHEN SQLCODE = +100                                       05140001
075400            CONTINUE                                              05150001
038200        WHEN OTHER                                                05160001
038300            MOVE '4000-GET-TY-SALE'    TO PV-PARAGRAPH-NAME       05170001
061200            MOVE SQLCODE               TO PV-SQLCODE              05180001
038700            PERFORM 9100-SQL-ABEND                                05190001
038800     END-EVALUATE.                                                05200001
065200                                                                  05210001
061700******************************************************************05220001
061800 5000-GET-LY-SALE.                                                05230001
061900******************************************************************05240001
122200     EXEC SQL                                                     05250001
122400         SELECT COALESCE(SUM(DLY_DOL_AMT),0)                      05260001
122500              , COALESCE(SUM(WTD_DOL_AMT),0)                      05270001
122500              , COALESCE(SUM(MTD_DOL_AMT),0)                      05280001
122500              , COALESCE(SUM(QTD_DOL_AMT),0)                      05290001
122500              , COALESCE(SUM(S_T_D_DOL_AMT),0)                    05300001
122500              , COALESCE(SUM(YTD_DOL_AMT),0)                      05310001
122900          INTO :DFT00002-DLY-DOL-AMT                              05320001
122900              ,:DFT00002-WTD-DOL-AMT                              05330001
122900              ,:DFT00002-MTD-DOL-AMT                              05340001
122900              ,:DFT00002-QTD-DOL-AMT                              05350001
122900              ,:DFT00002-S-T-D-DOL-AMT                            05360001
122900              ,:DFT00002-YTD-DOL-AMT                              05370001
122900          FROM DFT_ML_FINCL_SUM                                   05380001
122900         WHERE SLS_DTE = :PV-COMP-DATE                            05390001
122900           AND STR_NBR = :XST00125-LOC-NBR                        05400001
123400               WITH UR                                            05410001
123500     END-EXEC.                                                    05420001
063500                                                                  05430001
063600     EVALUATE TRUE                                                05440001
063700        WHEN SQLCODE = ZERO                                       05450001
075400            SET PS-FOUND-LY-DATA-YES TO TRUE                      05460001
063700        WHEN SQLCODE = +100                                       05470001
075400            CONTINUE                                              05480001
038200        WHEN OTHER                                                05490001
038300            MOVE '5000-GET-LY-SALE'    TO PV-PARAGRAPH-NAME       05500001
061200            MOVE SQLCODE               TO PV-SQLCODE              05510001
038700            PERFORM 9100-SQL-ABEND                                05520001
038800     END-EVALUATE.                                                05530001
065200                                                                  05540001
061700******************************************************************05550001
061800 6000-PREP-DETAIL-ROW.                                            05560001
061900******************************************************************05570001
062000     IF PV-CMP-DLY-LY-SLS = 0                                     05580001
062000         MOVE 0         TO DL-CMP-DLY-PCT-CHG                     05590001
062000     ELSE                                                         05600001
122200         COMPUTE DL-CMP-DLY-PCT-CHG ROUNDED                       05610001
122200          = (PV-CMP-DLY-TY-SLS                                    05620001
122400          -  PV-CMP-DLY-LY-SLS)                                   05630001
122400          *  100                                                  05640001
122400          /  PV-CMP-DLY-LY-SLS                                    05650001
062000     END-IF.                                                      05660001
122500                                                                  05670001
122200     COMPUTE DL-CMP-DLY-TY-SLS ROUNDED = PV-CMP-DLY-TY-SLS.       05680001
122200     COMPUTE DL-CMP-DLY-LY-SLS ROUNDED = PV-CMP-DLY-LY-SLS.       05690001
122500                                                                  05700001
062000     IF PV-CMP-WTD-LY-SLS = 0                                     05710001
062000         MOVE 0         TO DL-CMP-WTD-PCT-CHG                     05720001
062000     ELSE                                                         05730001
122200         COMPUTE DL-CMP-WTD-PCT-CHG ROUNDED                       05740001
122200          = (PV-CMP-WTD-TY-SLS                                    05750001
122400          -  PV-CMP-WTD-LY-SLS)                                   05760001
122400          *  100                                                  05770001
122400          /  PV-CMP-WTD-LY-SLS                                    05780001
062000     END-IF.                                                      05790001
122500                                                                  05800001
122200     COMPUTE DL-CMP-WTD-TY-SLS ROUNDED = PV-CMP-WTD-TY-SLS.       05810001
122200     COMPUTE DL-CMP-WTD-LY-SLS ROUNDED = PV-CMP-WTD-LY-SLS.       05820001
122500                                                                  05830001
062000     IF PV-CMP-MTD-LY-SLS = 0                                     05840001
062000         MOVE 0         TO DL-CMP-MTD-PCT-CHG                     05850001
062000     ELSE                                                         05860001
122200         COMPUTE DL-CMP-MTD-PCT-CHG ROUNDED                       05870001
122200          = (PV-CMP-MTD-TY-SLS                                    05880001
122400          -  PV-CMP-MTD-LY-SLS)                                   05890001
122400          *  100                                                  05900001
122400          /  PV-CMP-MTD-LY-SLS                                    05910001
062000     END-IF.                                                      05920001
122500                                                                  05930001
122200     COMPUTE DL-CMP-MTD-TY-SLS ROUNDED = PV-CMP-MTD-TY-SLS.       05940001
122200     COMPUTE DL-CMP-MTD-LY-SLS ROUNDED = PV-CMP-MTD-LY-SLS.       05950001
122500                                                                  05960001
062000     IF PV-CMP-QTD-LY-SLS = 0                                     05970001
062000         MOVE 0         TO DL-CMP-QTD-PCT-CHG                     05980001
062000     ELSE                                                         05990001
122200         COMPUTE DL-CMP-QTD-PCT-CHG ROUNDED                       06000001
122200          = (PV-CMP-QTD-TY-SLS                                    06010001
122400          -  PV-CMP-QTD-LY-SLS)                                   06020001
122400          *  100                                                  06030001
122400          /  PV-CMP-QTD-LY-SLS                                    06040001
062000     END-IF.                                                      06050001
122500                                                                  06060001
122200     COMPUTE DL-CMP-QTD-TY-SLS ROUNDED = PV-CMP-QTD-TY-SLS.       06070001
122200     COMPUTE DL-CMP-QTD-LY-SLS ROUNDED = PV-CMP-QTD-LY-SLS.       06080001
122500                                                                  06090001
062000     IF PV-CMP-STD-LY-SLS = 0                                     06100001
062000         MOVE 0         TO DL-CMP-STD-PCT-CHG                     06110001
062000     ELSE                                                         06120001
122200         COMPUTE DL-CMP-STD-PCT-CHG ROUNDED                       06130001
122200          = (PV-CMP-STD-TY-SLS                                    06140001
122400          -  PV-CMP-STD-LY-SLS)                                   06150001
122400          *  100                                                  06160001
122400          /  PV-CMP-STD-LY-SLS                                    06170001
062000     END-IF.                                                      06180001
122500                                                                  06190001
122200     COMPUTE DL-CMP-STD-TY-SLS ROUNDED = PV-CMP-STD-TY-SLS.       06200001
122200     COMPUTE DL-CMP-STD-LY-SLS ROUNDED = PV-CMP-STD-LY-SLS.       06210001
122500                                                                  06220001
062000     IF PV-CMP-YTD-LY-SLS = 0                                     06230001
062000         MOVE 0         TO DL-CMP-YTD-PCT-CHG                     06240001
062000     ELSE                                                         06250001
122200         COMPUTE DL-CMP-YTD-PCT-CHG ROUNDED                       06260001
122200          = (PV-CMP-YTD-TY-SLS                                    06270001
122400          -  PV-CMP-YTD-LY-SLS)                                   06280001
122400          *  100                                                  06290001
122400          /  PV-CMP-YTD-LY-SLS                                    06300001
062000     END-IF.                                                      06310001
122500                                                                  06320001
122200     COMPUTE DL-CMP-YTD-TY-SLS ROUNDED = PV-CMP-YTD-TY-SLS.       06330001
122200     COMPUTE DL-CMP-YTD-LY-SLS ROUNDED = PV-CMP-YTD-LY-SLS.       06340001
122500                                                                  06350001
062000     IF PV-TOT-DLY-LY-SLS = 0                                     06360001
062000         MOVE 0         TO DL-TOT-DLY-PCT-CHG                     06370001
062000     ELSE                                                         06380001
122200         COMPUTE DL-TOT-DLY-PCT-CHG ROUNDED                       06390001
122200          = (PV-TOT-DLY-TY-SLS                                    06400001
122400          -  PV-TOT-DLY-LY-SLS)                                   06410001
122400          *  100                                                  06420001
122400          /  PV-TOT-DLY-LY-SLS                                    06430001
062000     END-IF.                                                      06440001
122500                                                                  06450001
122200     COMPUTE DL-TOT-DLY-TY-SLS ROUNDED = PV-TOT-DLY-TY-SLS.       06460001
122200     COMPUTE DL-TOT-DLY-LY-SLS ROUNDED = PV-TOT-DLY-LY-SLS.       06470001
122500                                                                  06480001
062000     IF PV-TOT-WTD-LY-SLS = 0                                     06490001
062000         MOVE 0         TO DL-TOT-WTD-PCT-CHG                     06500001
062000     ELSE                                                         06510001
122200         COMPUTE DL-TOT-WTD-PCT-CHG ROUNDED                       06520001
122200          = (PV-TOT-WTD-TY-SLS                                    06530001
122400          -  PV-TOT-WTD-LY-SLS)                                   06540001
122400          *  100                                                  06550001
122400          /  PV-TOT-WTD-LY-SLS                                    06560001
062000     END-IF.                                                      06570001
122500                                                                  06580001
122200     COMPUTE DL-TOT-WTD-TY-SLS ROUNDED = PV-TOT-WTD-TY-SLS.       06590001
122200     COMPUTE DL-TOT-WTD-LY-SLS ROUNDED = PV-TOT-WTD-LY-SLS.       06600001
122500                                                                  06610001
062000     IF PV-TOT-MTD-LY-SLS = 0                                     06620001
062000         MOVE 0         TO DL-TOT-MTD-PCT-CHG                     06630001
062000     ELSE                                                         06640001
122200         COMPUTE DL-TOT-MTD-PCT-CHG ROUNDED                       06650001
122200          = (PV-TOT-MTD-TY-SLS                                    06660001
122400          -  PV-TOT-MTD-LY-SLS)                                   06670001
122400          *  100                                                  06680001
122400          /  PV-TOT-MTD-LY-SLS                                    06690001
062000     END-IF.                                                      06700001
122500                                                                  06710001
122200     COMPUTE DL-TOT-MTD-TY-SLS ROUNDED = PV-TOT-MTD-TY-SLS.       06720001
122200     COMPUTE DL-TOT-MTD-LY-SLS ROUNDED = PV-TOT-MTD-LY-SLS.       06730001
122500                                                                  06740001
062000     IF PV-TOT-QTD-LY-SLS = 0                                     06750001
062000         MOVE 0         TO DL-TOT-QTD-PCT-CHG                     06760001
062000     ELSE                                                         06770001
122200         COMPUTE DL-TOT-QTD-PCT-CHG ROUNDED                       06780001
122200          = (PV-TOT-QTD-TY-SLS                                    06790001
122400          -  PV-TOT-QTD-LY-SLS)                                   06800001
122400          *  100                                                  06810001
122400          /  PV-TOT-QTD-LY-SLS                                    06820001
062000     END-IF.                                                      06830001
122500                                                                  06840001
122200     COMPUTE DL-TOT-QTD-TY-SLS ROUNDED = PV-TOT-QTD-TY-SLS.       06850001
122200     COMPUTE DL-TOT-QTD-LY-SLS ROUNDED = PV-TOT-QTD-LY-SLS.       06860001
122500                                                                  06870001
062000     IF PV-TOT-STD-LY-SLS = 0                                     06880001
062000         MOVE 0         TO DL-TOT-STD-PCT-CHG                     06890001
062000     ELSE                                                         06900001
122200         COMPUTE DL-TOT-STD-PCT-CHG ROUNDED                       06910001
122200          = (PV-TOT-STD-TY-SLS                                    06920001
122400          -  PV-TOT-STD-LY-SLS)                                   06930001
122400          *  100                                                  06940001
122400          /  PV-TOT-STD-LY-SLS                                    06950001
062000     END-IF.                                                      06960001
122500                                                                  06970001
122200     COMPUTE DL-TOT-STD-TY-SLS ROUNDED = PV-TOT-STD-TY-SLS.       06980001
122200     COMPUTE DL-TOT-STD-LY-SLS ROUNDED = PV-TOT-STD-LY-SLS.       06990001
122500                                                                  07000001
062000     IF PV-TOT-YTD-LY-SLS = 0                                     07010001
062000         MOVE 0         TO DL-TOT-YTD-PCT-CHG                     07020001
062000     ELSE                                                         07030001
122200         COMPUTE DL-TOT-YTD-PCT-CHG ROUNDED                       07040001
122200          = (PV-TOT-YTD-TY-SLS                                    07050001
122400          -  PV-TOT-YTD-LY-SLS)                                   07060001
122400          *  100                                                  07070001
122400          /  PV-TOT-YTD-LY-SLS                                    07080001
062000     END-IF.                                                      07090001
122500                                                                  07100001
122200     COMPUTE DL-TOT-YTD-TY-SLS ROUNDED = PV-TOT-YTD-TY-SLS.       07110001
122200     COMPUTE DL-TOT-YTD-LY-SLS ROUNDED = PV-TOT-YTD-LY-SLS.       07120001
122500                                                                  07130001
065400******************************************************************07140001
065500 7000-WRITE-STORE-ROW.                                            07150001
065600******************************************************************07160001
479800     WRITE SALES-EXTRACT                                          07170001
479900        FROM DL-DETAIL-LINE.                                      07180001
481500                                                                  07190001
063700     INITIALIZE DL-DETAIL-LINE.                                   07200001
481500                                                                  07210001
131600******************************************************************07220001
131700* 9100-SQL-ABEND                                                  07230001
131800*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.07240001
131900******************************************************************07250001
132000 9100-SQL-ABEND.                                                  07260001
132100     DISPLAY '** ABEND     **'.                                   07270001
132200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07280001
132300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07290001
132400     DISPLAY '** SQLCODE   ** = ' PV-SQLCODE.                     07300001
132500     DISPLAY '** DATE      ** = ' PV-DATE.                        07310001
132600     DISPLAY '** LOC NBR   ** = ' DL-STORE.                       07320001
132900                                                                  07330001
133000******************************************************************07340001
133100* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     07350001
133200* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      07360001
133300******************************************************************07370001
133400     COPY DPPD004.                                                07380001
133500                                                                  07390001
133600     SET AC-DB2-ERROR TO TRUE.                                    07400001
133700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07410001
133800                                                                  07420001
133900******************************************************************07430001
134000* .                                                               07440001
134100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  07450001
134200******************************************************************07460001
134300 9999-ABEND.                                                      07470001
134400     DISPLAY '** ABEND           **'.                             07480001
134500     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  07490001
134600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07500001
134700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07510001
134800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       07520001
134900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07530001
