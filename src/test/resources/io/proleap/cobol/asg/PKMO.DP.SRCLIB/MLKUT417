       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT417.                                         00020000
       AUTHOR.        BARBARA HULL.                                     00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  07-23-98.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKUT417 - DESCRIPTION.............                             00090000
      *                                                                 00100000
      * THIS PROGRAM WILL CREATE THE DATA INTEGRITY EXTRACT FILE FOR    00110000
      * TMNSCLS.                                                        00120000
      *                                                                 00130000
      *CHANGE HISTORY:                                                  00131010
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00132010
      * ------- ---------- ----------- -------------------------------- 00133010
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00134010
      ******************************************************************00140000
      *                                                                 00150000
       ENVIRONMENT DIVISION.                                            00160000
      *                                                                 00170000
       CONFIGURATION SECTION.                                           00180000
      *                                                                 00190000
       SOURCE-COMPUTER.        IBM-3090.                                00200000
       OBJECT-COMPUTER.        IBM-3090.                                00210000
      *                                                                 00220000
       INPUT-OUTPUT SECTION.                                            00230000
       FILE-CONTROL.                                                    00240000
                                                                        00250000
           SELECT DATA-INTEGRITY-CTL-FILE                               00260000
               ASSIGN TO INP01.                                         00270000
                                                                        00280000
           SELECT DATA-INTEGRITY-EXTR-FILE                              00290000
               ASSIGN TO OUT01.                                         00300000
                                                                        00310000
      ******************************************************************00320000
       DATA DIVISION.                                                   00330000
      ******************************************************************00340000
                                                                        00350000
       FILE SECTION.                                                    00360000
                                                                        00370000
       FD  DATA-INTEGRITY-CTL-FILE                                      00380000
           LABEL RECORDS ARE STANDARD                                   00390000
           RECORDING MODE IS F                                          00400000
           BLOCK CONTAINS 0 RECORDS.                                    00410000
       01  DATA-INTEGRITY-CTL-REC      PIC X(80).                       00420000
                                                                        00430000
       FD  DATA-INTEGRITY-EXTR-FILE                                     00440000
           RECORDING MODE IS F                                          00450000
           LABEL RECORDS ARE STANDARD                                   00460000
           BLOCK CONTAINS 0 RECORDS.                                    00470000
                                                                        00480000
W26603 01  DATA-INTEGRITY-EXTR-REC     PIC X(120).                      00490010
                                                                        00500000
      *                                                                 00510000
      ******************************************************************00520000
       WORKING-STORAGE SECTION.                                         00530000
      ******************************************************************00540000
                                                                        00550000
       01  PS-PROGRAM-SWITCHES.                                         00560000
           05  PS-TMNSCLS-DONE         PIC X       VALUE 'N'.           00570000
               88  PS-TMNSCLS-IS-DONE              VALUE 'Y'.           00580000
               88  PS-TMNSCLS-IS-NOT-DONE          VALUE 'N'.           00590000
                                                                        00600000
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00610000
           05  PA-TMNSCLS-ROWS-FETCHED PIC S9(13)  VALUE ZERO.          00620000
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00630000
                                                                        00640000
       01  PV-PROGRAM-VARIABLES.                                        00650000
           05  PV-SPLIT-SUB-CL-NBR.                                     00660000
               10  PV-SPLIT-SUB-CL-NBR-1                                00670000
                                       PIC X.                           00680000
               10  FILLER              PIC X.                           00690000
           05  PV-FRMT-MAJ-CL-NBR.                                      00700000
               10  PV-FRMT-MAJ-CL-NBR-1                                 00710000
                                       PIC X.                           00720000
               10  PV-FRMT-MAJ-CL-NBR-2                                 00730000
                                       PIC X.                           00740000
                                                                        00750000
       01  CD-COUNTER-DISPLAY.                                          00760000
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00770000
                                                                        00780000
       01 ABEND-AREAS.                                                  00790000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00800000
                                                   COMP SYNC.           00810000
               88  AC-BAD-DATA                     VALUE +4003.         00820000
               88  AC-DB2-ERROR                    VALUE +4013.         00830000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00840000
                 '*****       ABEND'.                                   00850000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00860000
                   '*****   PROGRAM: MLKUT417'.                         00870000
           05  AA-PARAGRAPH-LIT.                                        00880000
               10  FILLER              PIC X(17)   VALUE                00890000
                   '***** PARAGRAPH: '.                                 00900000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00910000
           05  AA-MESSAGE-LINE.                                         00920000
               10  FILLER              PIC X(06)   VALUE '*****'.       00930000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00940000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00950000
                   '*****    DB2 ERROR'.                                00960000
           05  AA-DB2-OPERATION-LIT.                                    00970000
               10  FILLER              PIC X(17)   VALUE                00980000
                   '***** OPERATION: '.                                 00990000
               10  AA-DB2-OPERATION.                                    01000000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01010000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01020000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01030000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01040000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01050000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01060000
                                                                        01070000
       EJECT                                                            01080000
                                                                        01090000
      *** DATA INTEGRITY CONTROL CARD                                   01100000
           COPY MLRD110.                                                01110005
                                                                        01120000
                                                                        01130000
      *** DATA INTEGRITY TMNSCLS EXTRACT FILE                           01140000
W26603     COPY MLRD111.                                                01150010
                                                                        01160000
       EJECT                                                            01170000
                                                                        01180000
      ******************************************************************01190000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01200000
      ******************************************************************01210000
           COPY DPWS004.                                                01220005
                                                                        01230000
      ******************************************************************01240000
      *  DB2 ERRORS                                                     01250000
      ******************************************************************01260000
           COPY SQLCA2.                                                 01270000
                                                                        01280000
      ******************************************************************01290000
      *  DB2 COMMUNICATION AREA                                         01300000
      ******************************************************************01310000
           EXEC SQL                                                     01320000
                INCLUDE SQLCA                                           01330000
           END-EXEC.                                                    01340000
                                                                        01350000
      ******************************************************************01360000
      *  DB2 TMNSCLS TABLE LAYOUT                                       01370000
      ******************************************************************01380000
           EXEC SQL                                                     01390000
                INCLUDE TMNSCLS                                         01400000
           END-EXEC.                                                    01410000
                                                                        01420000
      ******************************************************************01430000
      *  DB2 TMNSCLS CURSOR                                             01440000
      ******************************************************************01450000
           EXEC SQL                                                     01460000
               DECLARE TMNSCLS_CURSOR CURSOR FOR                        01470000
                SELECT FSCL_MN_END_DTE,                                 01480000
                       FSCL_MN_NBR,                                     01490000
                       DEPT_NBR,                                        01500000
                       SUB_CL_NBR,                                      01510000
                       STR_NBR,                                         01520000
                       SLS_RTL_AMT,                                     01530000
                       MKDN_RTL_AMT,                                    01540000
                       MKUP_RTL_AMT,                                    01550000
                       XFER_IN_RTL_AMT,                                 01560000
                       XFER_OUT_RTL_AMT,                                01570000
                       RCPT_RTL_AMT,                                    01580000
                       RCPT_NET_COST_AMT,                               01590000
                       PADJ_RTL_AMT,                                    01600000
                       PADJ_NET_COST_AMT,                               01610000
                       INV_ADJ_RTL_AMT,                                 01620000
                       SHNK_RTL_AMT,                                    01630009
                       END_INV_RTL_AMT                                  01631009
                  FROM TMNSCLS                                          01640000
                 WHERE (FSCL_MN_END_DTE >= :ML110-STRT-DTE)             01650000
                   AND (FSCL_MN_END_DTE <= :ML110-END-DTE)              01660000
              ORDER BY FSCL_MN_END_DTE,                                 01670000
                       DEPT_NBR,                                        01680000
                       SUB_CL_NBR,                                      01690001
                       STR_NBR                                          01700001
W26603        WITH UR                                                   01701010
           END-EXEC.                                                    01710000
                                                                        01720000
       EJECT                                                            01730000
                                                                        01740000
      ******************************************************************01750000
       PROCEDURE DIVISION.                                              01760000
      ******************************************************************01770000
                                                                        01780000
      ******************************************************************01790000
       0000-MAINLINE-MLKUT417.                                          01800006
      ******************************************************************01810000
      *                                                                 01820000
           PERFORM 1000-INITIALIZATION.                                 01830006
                                                                        01840000
           PERFORM 2000-MAIN-PROCESS.                                   01850006
                                                                        01860000
           PERFORM 8000-EOJ.                                            01870006
                                                                        01880000
           STOP RUN.                                                    01890000
                                                                        01900000
       EJECT                                                            01910000
                                                                        01920000
      ******************************************************************01930000
       1000-INITIALIZATION.                                             01940006
      ******************************************************************01950000
      *                                                                 01960000
           OPEN INPUT  DATA-INTEGRITY-CTL-FILE.                         01970000
           OPEN OUTPUT DATA-INTEGRITY-EXTR-FILE.                        01980000
                                                                        01990000
           PERFORM 4000-READ-CONTROL-CARD.                              02000006
                                                                        02010000
           DISPLAY ' '.                                                 02020000
           DISPLAY '*** MLKUT417 INPUT CONTROL CARD VALUES ***'         02030000
           DISPLAY ML110-DATA-INTEGRITY-CC-REC.                         02040000
                                                                        02050000
       EJECT                                                            02060000
                                                                        02070000
      ******************************************************************02080000
       2000-MAIN-PROCESS.                                               02090006
      ******************************************************************02100000
      *                                                                 02110000
           PERFORM 7100-OPEN-CURSOR-TMNSCLS.                            02120006
                                                                        02130000
           PERFORM 7200-FETCH-TMNSCLS.                                  02140006
                                                                        02150000
           PERFORM                                                      02160000
             UNTIL PS-TMNSCLS-IS-DONE                                   02170000
               PERFORM 5000-WRITE-EXTRACT                               02180006
               PERFORM 7200-FETCH-TMNSCLS                               02190006
           END-PERFORM.                                                 02200000
                                                                        02210000
           PERFORM 7300-CLOSE-CURSOR-TMNSCLS.                           02220006
                                                                        02230000
       EJECT                                                            02240000
                                                                        02250000
      ******************************************************************02260000
       4000-READ-CONTROL-CARD.                                          02270006
      ******************************************************************02280000
      *                                                                 02290000
           READ DATA-INTEGRITY-CTL-FILE                                 02300000
             INTO ML110-DATA-INTEGRITY-CC-REC                           02310000
               AT END                                                   02320000
                   MOVE '4000-READ-CONTROL-CARD'                        02330006
                                       TO AA-PARAGRAPH-NAME             02340000
                   MOVE 'CONTROL CARD IS MISSING'                       02350000
                                       TO AA-MESSAGE                    02360000
                   MOVE +4001          TO ABEND-CODE                    02370000
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    02380006
           END-READ.                                                    02390000
                                                                        02400000
       EJECT                                                            02410000
                                                                        02420000
      ******************************************************************02430006
       5000-WRITE-EXTRACT.                                              02440006
      ******************************************************************02450006
      *                                                                 02460006
           MOVE MNSCLS-FSCL-MN-END-DTE TO ML111-FSCL-MN-END-DTE.        02470006
           MOVE MNSCLS-FSCL-MN-NBR     TO ML111-FSCL-MN-NBR.            02480006
           MOVE MNSCLS-DEPT-NBR        TO ML111-DEPT-NBR.               02490006
           MOVE MNSCLS-SUB-CL-NBR      TO PV-SPLIT-SUB-CL-NBR.          02500006
           MOVE PV-SPLIT-SUB-CL-NBR-1  TO PV-FRMT-MAJ-CL-NBR-1.         02510006
           MOVE 0                      TO PV-FRMT-MAJ-CL-NBR-2.         02520006
           MOVE PV-FRMT-MAJ-CL-NBR     TO ML111-MAJ-CL-NBR.             02530006
           MOVE MNSCLS-SUB-CL-NBR      TO ML111-SUB-CL-NBR.             02540006
           MOVE MNSCLS-STR-NBR         TO ML111-STR-NBR.                02550006
           MOVE MNSCLS-SLS-RTL-AMT     TO ML111-SLS-RTL-AMT.            02560006
           MOVE MNSCLS-MKDN-RTL-AMT    TO ML111-MKDN-RTL-AMT.           02570006
           MOVE MNSCLS-MKUP-RTL-AMT    TO ML111-MKUP-RTL-AMT.           02580006
           MOVE MNSCLS-XFER-IN-RTL-AMT TO ML111-XFER-IN-RTL-AMT.        02590006
           MOVE MNSCLS-XFER-OUT-RTL-AMT TO ML111-XFER-OUT-RTL-AMT.      02600006
           MOVE MNSCLS-RCPT-RTL-AMT    TO ML111-RCPT-RTL-AMT.           02610006
           MOVE MNSCLS-RCPT-NET-COST-AMT                                02620006
                                       TO ML111-RCPT-NET-COST-AMT.      02630006
           MOVE MNSCLS-PADJ-RTL-AMT    TO ML111-PADJ-RTL-AMT.           02640006
           MOVE MNSCLS-PADJ-NET-COST-AMT                                02650006
                                       TO ML111-PADJ-NET-COST-AMT.      02660006
           MOVE MNSCLS-INV-ADJ-RTL-AMT TO ML111-INV-ADJ-RTL-AMT.        02670006
           MOVE MNSCLS-SHNK-RTL-AMT    TO ML111-SHNK-RTL-AMT.           02680006
           MOVE MNSCLS-END-INV-RTL-AMT TO ML111-END-INV-RTL-AMT.        02681008
                                                                        02690006
           WRITE DATA-INTEGRITY-EXTR-REC                                02700006
               FROM ML111-DATA-INTEGRITY-EXTR-REC.                      02710006
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       02720006
                                                                        02730006
       EJECT                                                            02740006
                                                                        02750006
      ******************************************************************02760000
       7100-OPEN-CURSOR-TMNSCLS.                                        02770006
      ******************************************************************02780000
      *                                                                 02790000
           EXEC SQL                                                     02800000
               OPEN TMNSCLS_CURSOR                                      02810000
           END-EXEC.                                                    02820000
                                                                        02830000
           EVALUATE TRUE                                                02840000
               WHEN SQLCODE = 0                                         02850007
                   CONTINUE                                             02850107
               WHEN OTHER                                               02851007
                   MOVE '7100-OPEN-CURSOR-TMNSCLS'                      02860006
                                       TO AA-PARAGRAPH-NAME             02870000
                   MOVE 'TMNSCLS TABLE ERROR'                           02880000
                                       TO AA-MESSAGE                    02890000
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              02900000
                   PERFORM 9901-SQL-ERROR                               02910006
           END-EVALUATE.                                                03000000
                                                                        03010000
       EJECT                                                            03020000
                                                                        03030000
      ******************************************************************03040000
       7200-FETCH-TMNSCLS.                                              03050006
      ******************************************************************03060000
      *                                                                 03070000
           EXEC SQL                                                     03080000
               FETCH TMNSCLS_CURSOR                                     03090000
                INTO :MNSCLS-FSCL-MN-END-DTE,                           03100000
                     :MNSCLS-FSCL-MN-NBR,                               03110000
                     :MNSCLS-DEPT-NBR,                                  03120000
                     :MNSCLS-SUB-CL-NBR,                                03130000
                     :MNSCLS-STR-NBR,                                   03140000
                     :MNSCLS-SLS-RTL-AMT,                               03150000
                     :MNSCLS-MKDN-RTL-AMT,                              03160000
                     :MNSCLS-MKUP-RTL-AMT,                              03170000
                     :MNSCLS-XFER-IN-RTL-AMT,                           03180000
                     :MNSCLS-XFER-OUT-RTL-AMT,                          03190000
                     :MNSCLS-RCPT-RTL-AMT,                              03200000
                     :MNSCLS-RCPT-NET-COST-AMT,                         03210000
                     :MNSCLS-PADJ-RTL-AMT,                              03220000
                     :MNSCLS-PADJ-NET-COST-AMT,                         03230000
                     :MNSCLS-INV-ADJ-RTL-AMT,                           03240000
                     :MNSCLS-SHNK-RTL-AMT,                              03250009
                     :MNSCLS-END-INV-RTL-AMT                            03251009
           END-EXEC.                                                    03260000
                                                                        03270000
           EVALUATE TRUE                                                03280000
               WHEN SQLCODE = 0                                         03290000
                   ADD +1              TO PA-TMNSCLS-ROWS-FETCHED       03300000
               WHEN SQLCODE = +100                                      03310000
                   MOVE 'Y'            TO PS-TMNSCLS-DONE               03320000
               WHEN OTHER                                               03330007
                   MOVE '7200-FETCH-TMNSCLS'                            03340006
                                       TO AA-PARAGRAPH-NAME             03350000
                   MOVE 'TMNSCLS TABLE ERROR'                           03360000
                                       TO AA-MESSAGE                    03370000
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              03380000
                   PERFORM 9901-SQL-ERROR                               03390006
           END-EVALUATE.                                                03480000
                                                                        03490000
       EJECT                                                            03500000
                                                                        03510000
      ******************************************************************03520000
       7300-CLOSE-CURSOR-TMNSCLS.                                       03530006
      ******************************************************************03540000
      *                                                                 03550000
           EXEC SQL                                                     03560000
               CLOSE TMNSCLS_CURSOR                                     03570000
           END-EXEC.                                                    03580000
                                                                        03590000
           EVALUATE TRUE                                                03600000
               WHEN SQLCODE = 0                                         03601007
                   CONTINUE                                             03602007
               WHEN OTHER                                               03603007
                   MOVE '7300-CLOSE-CURSOR-TMNSCLS'                     03620006
                                       TO AA-PARAGRAPH-NAME             03630000
                   MOVE 'TMNSCLS TABLE ERROR'                           03640000
                                       TO AA-MESSAGE                    03650000
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              03660000
                   PERFORM 9901-SQL-ERROR                               03670006
           END-EVALUATE.                                                03760000
                                                                        03770000
       EJECT                                                            03780000
                                                                        03790000
      ******************************************************************03800006
       8000-EOJ.                                                        03810006
      ******************************************************************03820006
      *                                                                 03830006
           DISPLAY ' '.                                                 03840006
           DISPLAY '  PROGRAM MLKUT417 PROCESSING SUMMARY'.             03850006
           DISPLAY '  -----------------------------------'.             03860006
           DISPLAY ' '.                                                 03870006
      *                                                                 03880006
           MOVE PA-TMNSCLS-ROWS-FETCHED TO CD-COUNT-HOLD1.              03890006
           DISPLAY 'TMNSCLS ROWS FETCHED =      ' CD-COUNT-HOLD1.       03900006
      *                                                                 03910006
           MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               03920006
           DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       03930006
      *                                                                 03940006
           DISPLAY ' '.                                                 03950006
                                                                        03960006
           CLOSE DATA-INTEGRITY-CTL-FILE.                               03970006
           CLOSE DATA-INTEGRITY-EXTR-FILE.                              03980006
                                                                        03990006
       EJECT                                                            04000006
                                                                        04010006
      ******************************************************************04020000
       9900-COMMON-ABEND-ROUTINE.                                       04030006
      ******************************************************************04040000
      *                                                                 04050000
           DISPLAY AA-ABEND-LIT.                                        04060000
           DISPLAY AA-PROGRAM-LIT.                                      04070000
           DISPLAY AA-PARAGRAPH-LIT.                                    04080000
           DISPLAY AA-MESSAGE-LINE.                                     04090000
           DISPLAY ABEND-CODE.                                          04100000
                                                                        04110000
           CALL 'ILBOABN0' USING ABEND-CODE.                            04120000
                                                                        04130000
       EJECT                                                            04140000
                                                                        04150000
      ******************************************************************04160000
       9901-SQL-ERROR.                                                  04170006
      ******************************************************************04180000
      *                                                                 04190000
           CLOSE DATA-INTEGRITY-CTL-FILE                                04200000
                 DATA-INTEGRITY-EXTR-FILE.                              04210000
                                                                        04220000
           DISPLAY AA-ABEND-LIT.                                        04230000
           DISPLAY AA-DB2-ERROR-LIT.                                    04240000
           DISPLAY AA-PROGRAM-LIT.                                      04250000
           DISPLAY AA-PARAGRAPH-LIT.                                    04260000
           DISPLAY AA-MESSAGE-LINE.                                     04270000
           DISPLAY AA-DB2-OPERATION-LIT.                                04280000
           SET AC-DB2-ERROR TO TRUE.                                    04290000
           MOVE +4013                  TO ABEND-CODE.                   04300000
                                                                        04310000
           COPY DPPD004.                                                04320000
           CALL 'ILBOABN0' USING ABEND-CODE.                            04330000
                                                                        04340000
