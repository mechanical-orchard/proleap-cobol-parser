000100*-----------------------*                                         10/26/95
000200 IDENTIFICATION DIVISION.                                         VNKCS005
000300*-----------------------*                                            LV001
000400                                                                          
000410 PROGRAM-ID.    VNKCS005.                                         VNKCS005
000420                                                                          
000500 AUTHOR.        TIM SMITH.                                        VNKCS005
000510                                                                          
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          VNKCS005
000610                                                                          
000700 DATE-WRITTEN.  06-21-93.                                         VNKCS005
000710                                                                          
000800 DATE-COMPILED.                                                   VNKCS005
000900                                                                  VNKCS005
001000*---------------------------------------------------------------* VNKCS005
001100*    V005 - BUSINESS FUNCTION LIST PROGRAM.                    *  VNKCS005
001200*                                                               * VNKCS005
001300*    THIS PROGRAM GENERATES A LIST OF BUSINESS FUNCTIONS.       * VNKCS005
001400*    THE APPROPRIATE ADDRESS/REP PROGRAM IS INVOKED WHEN THE    * VNKCS005
001500*    OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION  * VNKCS005
001600*    KEY.                                                       * VNKCS005
001700*                                                               * VNKCS005
001710*    WR # 21278                                                 * VNKCS005
001720*                                                               * VNKCS005
001730*    1  REMOVE ALL REFERECNES TO VN001-RN-NUMBER AND VN001-     * VNKCS005
001740*       WPL-NUMBER.                                             * VNKCS005
001750*                                                               * VNKCS005
001751*    2  REMOVE ALL RELATED CODE TO THE TFTCNBR TABLE. REMOVE ALL* VNKCS005
001752*       CURSOR, WORKING STORAGE VALUES, SWITCHES, DATABASE CALLS* VNKCS005
001753*       DK-RELATED FIELDS, AND PREFORMS REFERRING TO TFTCNBR.   * VNKCS005
001754*                                                               * VNKCS005
001755*    3  CHANGE ALL '++INCLUDE' TO 'COPY' STATEMENTS.            * VNKCS005
001756*                                                               * VNKCS005
001757* 09/01/2021 GERMAN BANDA                    WR/IR #: CHG0261091          
001758*            - CHANGE CALL OF DPKUT100 TO                       *         
001759*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 *         
001760*              MAKING THE CALL DYNAMIC VS STATIC                *         
001770*                                                               *         
001757* 01/05/2023 JEAN KURK                       WR/IR #: CHG0277999          
001758*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               *         
001780*---------------------------------------------------------------*         
001800*---------------------------------------------------------------* VNKCS005
001810                                                                  VNKCS005
001900 EJECT                                                            VNKCS005
001910                                                                  VNKCS005
002000 ENVIRONMENT DIVISION.                                            VNKCS005
002100                                                                  VNKCS005
002200 DATA DIVISION.                                                   VNKCS005
002300                                                                  VNKCS005
002400 WORKING-STORAGE SECTION.                                         VNKCS005
002500                                                                  VNKCS005
003202 01  DK-DB2-KEYS.                                                 VNKCS005
003203     15  DK-ENT-ID                      PIC S9(09)  COMP.         VNKCS005
003204     15  DK-DUNS-NUMBER                 PIC  X(09)  VALUE SPACES. VNKCS005
003205     15  DK-VENDOR-NAME                 PIC  X(30)  VALUE SPACES. VNKCS005
003206*    15  DK-FTC-NUMBER                  PIC S9(09)  COMP.         VNKCS005
003207*    15  DK-FTC-TYPE                    PIC  X(01)  VALUE SPACES. VNKCS005
003208                                                                  VNKCS005
003300 01  PC-PROGRAM-CONSTANTS.                                        VNKCS005
003400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         VNKCS005
003500                                                    'VN005A  '.   VNKCS005
003600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         VNKCS005
003700                                                    'VNKM005 '.   VNKCS005
003800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         VNKCS005
003900                                                    'VNKCS005'.   VNKCS005
004000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      VNKCS005
004100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      VNKCS005
004200     05  PC-INTER-APPL-CODES.                                     VNKCS005
004300         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    VNKCS005
004400         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '2'.    VNKCS005
004500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     VNKCS005
004600                                                    COMP SYNC.    VNKCS005
004700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      VNKCS005
004800                                                    COMP SYNC.    VNKCS005
004900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         VNKCS005
005000                                                    +1000000      VNKCS005
005100                                                    COMP-3.       VNKCS005
005200     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      VNKCS005
005300                                                    COMP SYNC.    VNKCS005
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       VNKCS005
005500                                                    COMP-3.       VNKCS005
005600     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  VNKCS005
005700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  VNKCS005
005800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  VNKCS005
005900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  VNKCS005
006000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  VNKCS005
006100                                                                  VNKCS005
006110     EJECT                                                        VNKCS005
006120                                                                  VNKCS005
006200     05  PC-TSYMSG-NUMBERS.                                       VNKCS005
006300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  VNKCS005
006400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  VNKCS005
006500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  VNKCS005
006600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  VNKCS005
006700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  VNKCS005
006800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  VNKCS005
006900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  VNKCS005
007000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  VNKCS005
007100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  VNKCS005
007200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  VNKCS005
007300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  VNKCS005
007400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  VNKCS005
007500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  VNKCS005
007600         10  PC-TSYMSG-00159            PIC  9(05)  VALUE 00159.  VNKCS005
007700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  VNKCS005
007800         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  VNKCS005
007900         10  PC-TSYMSG-00487            PIC  9(05)  VALUE 00487.  VNKCS005
008000         10  PC-TSYMSG-00499            PIC  9(05)  VALUE 00499.  VNKCS005
008100         10  PC-TSYMSG-00500            PIC  9(05)  VALUE 00500.  VNKCS005
008200         10  PC-TSYMSG-01061            PIC  9(05)  VALUE 01061.  VNKCS005
008300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  VNKCS005
008400*                                                                 VNKCS005
008500 01  PS-PROGRAM-SWITCHES.                                         VNKCS005
008600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    VNKCS005
008700         88  PS-NO-ERROR                            VALUE 'Y'.    VNKCS005
008800         88  PS-ERROR                               VALUE 'N'.    VNKCS005
008900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    VNKCS005
009000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    VNKCS005
009100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    VNKCS005
009200                                                                  VNKCS005
009210     EJECT                                                        VNKCS005
009220                                                                  VNKCS005
009300 01  PV-PROGRAM-VARIABLES.                                        VNKCS005
009400     05  PV-SUB                         PIC S9(04)  VALUE +0      VNKCS005
009500                                                    COMP SYNC.    VNKCS005
009600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      VNKCS005
009700                                                    COMP SYNC.    VNKCS005
009800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      VNKCS005
009900                                                    COMP-3.       VNKCS005
010000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      VNKCS005
010100                                                    COMP-3.       VNKCS005
010200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      VNKCS005
010300                                                    COMP-3.       VNKCS005
010400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VNKCS005
010500                                                    COMP-3.       VNKCS005
010600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      VNKCS005
010700                                                    COMP-3.       VNKCS005
010800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      VNKCS005
010900                                                    COMP-3.       VNKCS005
011000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      VNKCS005
011100                                                    COMP-3.       VNKCS005
011200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      VNKCS005
011300                                                    COMP SYNC.    VNKCS005
011400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      VNKCS005
011500                                                    COMP SYNC.    VNKCS005
011600     05  PV-ITEM                        PIC S9(04)  VALUE +0      VNKCS005
011700                                                    COMP SYNC.    VNKCS005
011800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VNKCS005
011900                                                    COMP SYNC.    VNKCS005
012000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      VNKCS005
012100                                                    COMP SYNC.    VNKCS005
012200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      VNKCS005
012300                                                    COMP SYNC.    VNKCS005
012400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      VNKCS005
012500                                                    COMP SYNC.    VNKCS005
012600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      VNKCS005
012700                                                    COMP SYNC.    VNKCS005
012800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VNKCS005
012900                                                    COMP SYNC.    VNKCS005
013000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VNKCS005
013100                                                    COMP SYNC.    VNKCS005
013200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      VNKCS005
013300                                                    COMP SYNC.    VNKCS005
013400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      VNKCS005
013500                                                    COMP SYNC.    VNKCS005
013600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      VNKCS005
013700                                                    COMP SYNC.    VNKCS005
013800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      VNKCS005
013900                                                    COMP SYNC.    VNKCS005
014000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      VNKCS005
014100                                                    COMP SYNC.    VNKCS005
014200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      VNKCS005
014300                                                    COMP SYNC.    VNKCS005
014400     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      VNKCS005
014500                                                    COMP-3.       VNKCS005
014600     05  PV-FUNCTION-SECURITY.                                    VNKCS005
014700         10  PV-RESOURCE-TYPE           PIC X(01).                VNKCS005
014800         10  FILLER                     PIC X.                    VNKCS005
014900         10  PV-RESOURCE-NAME           PIC X(08).                VNKCS005
015000                                                                  VNKCS005
015010     EJECT                                                        VNKCS005
015020                                                                  VNKCS005
015100******************************************************************VNKCS005
015200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VNKCS005
015300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VNKCS005
015400**  APPLICATION-SPECIFIC COMMAREA.                              **VNKCS005
015500******************************************************************VNKCS005
015510                                                                  VNKCS005
015600 01  LQW-LIST-QUEUE-WORK-AREA.                                    VNKCS005
015700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VNKCS005
015800     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           VNKCS005
015900                                        INDEXED BY LQW-IDX.       VNKCS005
016000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VNKCS005
016100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               VNKCS005
016200         10  LQW-SELECTED-SW            PIC  X(01).               VNKCS005
016300             88  LQW-SELECT                         VALUE 'S'.    VNKCS005
016400             88  LQW-DESELECT                       VALUE ' '.    VNKCS005
016500         10  LQW-ACTION                 PIC  X(03).               VNKCS005
016600         10  LQW-FUNCTION-NAME          PIC  X(25).               VNKCS005
016700         10  LQW-FUNCTION-ID            PIC S9(04)  COMP.         VNKCS005
016800         10  LQW-ADDRESS-COUNT          PIC  9(03).               VNKCS005
016900         10  LQW-UPDATE-FLAG            PIC  X(01).               VNKCS005
017000                                                                  VNKCS005
017100     EJECT                                                        VNKCS005
017110                                                                  VNKCS005
017200*---------------------------------------------------------------* VNKCS005
017300*  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * VNKCS005
017400*---------------------------------------------------------------* VNKCS005
017500                                                                  VNKCS005
017610     COPY VNWS003.                                                        
017700                                                                  VNKCS005
017800     EJECT                                                        VNKCS005
017810                                                                  VNKCS005
017900*---------------------------------------------------------------* VNKCS005
018000*    MAP LAYOUT                                                 * VNKCS005
018100*---------------------------------------------------------------* VNKCS005
018200                                                                  VNKCS005
018300     COPY VNKM005.                                                VNKCS005
018400*                                                                 VNKCS005
018410     EJECT                                                        VNKCS005
018420                                                                  VNKCS005
018500 01  MR-OCCURS-LAYOUT                   REDEFINES  VN005AO.       VNKCS005
018600     05  FILLER                         PIC X(83).                VNKCS005
018700     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          VNKCS005
018800         10  MR-SELECTL                 PIC S9(04) COMP.          VNKCS005
018900         10  MR-SELECTA                 PIC  X(01).               VNKCS005
019000         10  MR-SELECTC                 PIC  X(01).               VNKCS005
019100         10  MR-SELECTH                 PIC  X(01).               VNKCS005
019200         10  MR-SELECTI                 PIC  X(01).               VNKCS005
019300                                                                  VNKCS005
019400         10  MR-ACTIONL                 PIC S9(04) COMP.          VNKCS005
019500         10  MR-ACTIONA                 PIC  X(01).               VNKCS005
019600         10  MR-ACTIONC                 PIC  X(01).               VNKCS005
019700         10  MR-ACTIONH                 PIC  X(01).               VNKCS005
019800         10  MR-ACTION                  PIC  X(03).               VNKCS005
019900                                                                  VNKCS005
020000         10  MR-FUNCTION-NAMEL          PIC S9(04) COMP.          VNKCS005
020100         10  MR-FUNCTION-NAMEA          PIC  X(01).               VNKCS005
020200         10  MR-FUNCTION-NAMEC          PIC  X(01).               VNKCS005
020300         10  MR-FUNCTION-NAMEH          PIC  X(01).               VNKCS005
020400         10  MR-FUNCTION-NAME           PIC  X(25).               VNKCS005
020500                                                                  VNKCS005
020600         10  MR-ADDRESS-COUNTL          PIC S9(04) COMP.          VNKCS005
020700         10  MR-ADDRESS-COUNTA          PIC  X(01).               VNKCS005
020800         10  MR-ADDRESS-COUNTC          PIC  X(01).               VNKCS005
020900         10  MR-ADDRESS-COUNTH          PIC  X(01).               VNKCS005
021000         10  MR-ADDRESS-COUNT-X.                                  VNKCS005
021100             15  MR-ADDRESS-COUNT       PIC ZZ9.                  VNKCS005
021200                                                                  VNKCS005
021300         10  MR-UPDATE-FLAGL            PIC S9(04) COMP.          VNKCS005
021400         10  MR-UPDATE-FLAGA            PIC  X(01).               VNKCS005
021500         10  MR-UPDATE-FLAGC            PIC  X(01).               VNKCS005
021600         10  MR-UPDATE-FLAGH            PIC  X(01).               VNKCS005
021700         10  MR-UPDATE-FLAG             PIC  X(01).               VNKCS005
021710                                                                  VNKCS005
021800     EJECT                                                        VNKCS005
021810                                                                  VNKCS005
021900*---------------------------------------------------------------* VNKCS005
022000*    ATTRIBUTE SETTINGS COPYBOOK.                               * VNKCS005
022100*---------------------------------------------------------------* VNKCS005
022200                                                                  VNKCS005
022310     COPY DPWS015.                                                        
022400                                                                          
022410     EJECT                                                                
022420                                                                          
022500*---------------------------------------------------------------* VNKCS005
022600*    FUNCTION KEYS COPYBOOK.                                    * VNKCS005
022700*---------------------------------------------------------------* VNKCS005
022800                                                                  VNKCS005
022910     COPY DPWS016.                                                VNKCS005
023000                                                                  VNKCS005
023010     EJECT                                                        VNKCS005
023020                                                                  VNKCS005
023100*---------------------------------------------------------------* VNKCS005
023200*    COPYBOOK FOR THE CALL TO RACF SECURITY SUBROUTINE          * VNKCS005
023300*---------------------------------------------------------------* VNKCS005
023400                                                                  VNKCS005
023510     COPY DPWS008.                                                VNKCS005
023600                                                                  VNKCS005
023610     EJECT                                                        VNKCS005
023620                                                                  VNKCS005
023700*---------------------------------------------------------------* VNKCS005
023800*    NUMERIC EDIT LAYOUT.                                       * VNKCS005
023900*---------------------------------------------------------------* VNKCS005
024000                                                                  VNKCS005
024101     COPY DPWS010I.                                               VNKCS005
024110                                                                  VNKCS005
024200 EJECT                                                            VNKCS005
024210                                                                  VNKCS005
024300*---------------------------------------------------------------* VNKCS005
024400*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * VNKCS005
024500*---------------------------------------------------------------* VNKCS005
024600                                                                  VNKCS005
024701     COPY DPWS030.                                                VNKCS005
024701     COPY DPWS930.                                                VNKCS005
024710                                                                  VNKCS005
024800 EJECT                                                            VNKCS005
024810                                                                  VNKCS005
024900*---------------------------------------------------------------* VNKCS005
025000*    STANDARD COMMAREA.                                         * VNKCS005
025100*---------------------------------------------------------------* VNKCS005
025200                                                                  VNKCS005
025301     COPY DPWS020.                                                VNKCS005
025310                                                                  VNKCS005
025400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                VNKCS005
025500                                                                  VNKCS005
025600*---------------------------------------------------------------* VNKCS005
025700* INTER-APPLICATION COMMAREA.                                   * VNKCS005
025800*   VNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * VNKCS005
025900*             SPEC SCREEN.                                      * VNKCS005
026000*   VNWS002 - IS THE INPUT LAYOUT FOR THE LIST PROGRAM AND THE  * VNKCS005
026100*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * VNKCS005
026200*---------------------------------------------------------------* VNKCS005
026300                                                                  VNKCS005
026400         10  INTER-APPL-COMM-AREA       PIC X(200).               VNKCS005
026410                                                                  VNKCS005
026510     COPY VNWS001.                                                VNKCS005
026520                                                                  VNKCS005
026610     COPY VNWS002.                                                VNKCS005
026620                                                                  VNKCS005
026700*---------------------------------------------------------------* VNKCS005
026800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * VNKCS005
026900*---------------------------------------------------------------* VNKCS005
026910                                                                  VNKCS005
027000         10  ASC-SPECIFIC-COMMAREA.                               VNKCS005
027100             15  ASC-LIST-KEYS.                                   VNKCS005
027200                 20  ASC-KEY-ENT-ID                  PIC S9(09)   VNKCS005
027300                                                     COMP.        VNKCS005
027400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                VNKCS005
027500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VNKCS005
027600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VNKCS005
027700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VNKCS005
027800                                                                  VNKCS005
027900                 20  ASC-ITEM-ARRAY.                              VNKCS005
028000                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        VNKCS005
028100                         30  ASC-LIST-ITEM-NUMBER                 VNKCS005
028200                                                     PIC S9(09)   VNKCS005
028300                                                     COMP-3.      VNKCS005
028400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  VNKCS005
028500                             88  ASC-VALID-SELECT    VALUE ' '    VNKCS005
028600                                                           'S'    VNKCS005
028700                                                           'B'    VNKCS005
028800                                                           'E'.   VNKCS005
028900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   VNKCS005
029000                             88  ASC-TEMP-SELECT     VALUE 'S'.   VNKCS005
029100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   VNKCS005
029200                             88  ASC-TEMP-END        VALUE 'E'.   VNKCS005
029300                         30  ASC-SELECTED-SW         PIC  X(01).  VNKCS005
029400                             88  ASC-NO-SELECT       VALUE ' '.   VNKCS005
029500                             88  ASC-SELECT          VALUE 'S'.   VNKCS005
029600                             88  ASC-BEGIN           VALUE 'B'.   VNKCS005
029700                             88  ASC-END             VALUE 'E'.   VNKCS005
029800                         30  ASC-ACTION              PIC  X(03).  VNKCS005
029900                         30  ASC-FUNCTION-NAME       PIC  X(25).  VNKCS005
030000                         30  ASC-FUNCTION-ID         PIC S9(04)   VNKCS005
030100                                                          COMP.   VNKCS005
030200                         30  ASC-ADDRESS-COUNT       PIC  9(03).  VNKCS005
030300                         30  ASC-UPDATE-FLAG         PIC  X(01).  VNKCS005
030400                             88  ASC-UPDATE          VALUE 'Y'.   VNKCS005
030500                             88  ASC-NO-UPDATE       VALUE 'N'.   VNKCS005
030600             15  ASC-BLK-SUB                         PIC S9(04)   VNKCS005
030700                                                          COMP    VNKCS005
030800                                                          SYNC.   VNKCS005
030900             15  ASC-ITEM-SUB                        PIC S9(04)   VNKCS005
031000                                                          COMP    VNKCS005
031100                                                          SYNC.   VNKCS005
031200             15  ASC-SEL-SUB                         PIC S9(04)   VNKCS005
031300                                                          COMP.   VNKCS005
031400             15  ASC-SEL-ITEM                        PIC S9(04)   VNKCS005
031500                                                          COMP.   VNKCS005
031600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   VNKCS005
031700                                                          COMP-3. VNKCS005
031800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   VNKCS005
031900                                                          COMP-3. VNKCS005
032000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   VNKCS005
032100                                                          COMP-3. VNKCS005
032200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   VNKCS005
032300                                                          COMP-3. VNKCS005
032400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   VNKCS005
032500                                                          COMP-3. VNKCS005
032600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   VNKCS005
032700                                                          COMP-3. VNKCS005
032800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   VNKCS005
032900                                                          COMP    VNKCS005
033000                                                          SYNC.   VNKCS005
033100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   VNKCS005
033200                                                          COMP-3. VNKCS005
033300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   VNKCS005
033400                                                          COMP-3. VNKCS005
033500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  VNKCS005
033600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   VNKCS005
033700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   VNKCS005
033800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VNKCS005
033900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VNKCS005
034000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VNKCS005
034100             15  ASC-LIST-QUEUE-NAME.                             VNKCS005
034200                 20  ASC-LIST-TERM-ID                PIC  X(04).  VNKCS005
034300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   VNKCS005
034400                                                          COMP-3. VNKCS005
034500                 20  ASC-LIST-SEQ                    PIC  9(01).  VNKCS005
034600             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  VNKCS005
034700             15  ASC-SEL-QUEUE-NAME-OUT.                          VNKCS005
034800                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  VNKCS005
034900                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   VNKCS005
035000                                                          COMP-3. VNKCS005
035100                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  VNKCS005
035200                                                                  VNKCS005
035300             15  ASC-START-ITEM-REQUEST.                          VNKCS005
035400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  VNKCS005
035500             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  VNKCS005
035600                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   VNKCS005
035700             15  ASC-VENDOR-NAME                     PIC  X(30).  VNKCS005
035710                                                                  VNKCS005
035800     EJECT                                                        VNKCS005
035810                                                                  VNKCS005
035900*---------------------------------------------------------------* VNKCS005
036000*    ABEND PROCESSING COPYBOOK.                                 * VNKCS005
036100*---------------------------------------------------------------* VNKCS005
036200                                                                  VNKCS005
036310     COPY DPWS013.                                                VNKCS005
036400                                                                  VNKCS005
036500 EJECT                                                            VNKCS005
036510                                                                  VNKCS005
036600*---------------------------------------------------------------* VNKCS005
036700*    DB2 AREA FOR TENTNME                                       * VNKCS005
036800*---------------------------------------------------------------* VNKCS005
036900     EXEC SQL                                                     VNKCS005
037000          INCLUDE TENTNME                                         VNKCS005
037100     END-EXEC.                                                    VNKCS005
037110                                                                  VNKCS005
037120 EJECT                                                            VNKCS005
037130                                                                  VNKCS005
037200*---------------------------------------------------------------* VNKCS005
037300*    DB2 AREA FOR TEXTENT                                       * VNKCS005
037400*---------------------------------------------------------------* VNKCS005
037500     EXEC SQL                                                     VNKCS005
037600          INCLUDE TEXTENT                                         VNKCS005
037700     END-EXEC.                                                    VNKCS005
037710                                                                  VNKCS005
037720 EJECT                                                            VNKCS005
037730                                                                  VNKCS005
037800*---------------------------------------------------------------* VNKCS005
037900*    DB2 AREA FOR TBUSFNC                                       * VNKCS005
038000*---------------------------------------------------------------* VNKCS005
038100     EXEC SQL                                                     VNKCS005
038200          INCLUDE TBUSFNC                                         VNKCS005
038300     END-EXEC.                                                    VNKCS005
038310                                                                  VNKCS005
038320 EJECT                                                            VNKCS005
038330                                                                  VNKCS005
038400*---------------------------------------------------------------* VNKCS005
038500*    DB2 AREA FOR TENTREP                                       * VNKCS005
038600*---------------------------------------------------------------* VNKCS005
038700     EXEC SQL                                                     VNKCS005
038800          INCLUDE TENTREP                                         VNKCS005
038900     END-EXEC.                                                    VNKCS005
038910                                                                  VNKCS005
038920 EJECT                                                            VNKCS005
038930                                                                  VNKCS005
039000*---------------------------------------------------------------* VNKCS005
039100*    DB2 AREA FOR TBUSLOC                                       * VNKCS005
039200*---------------------------------------------------------------* VNKCS005
039300     EXEC SQL                                                     VNKCS005
039400          INCLUDE TBUSLOC                                         VNKCS005
039500     END-EXEC.                                                    VNKCS005
039510                                                                  VNKCS005
039520 EJECT                                                            VNKCS005
039530                                                                  VNKCS005
040200*---------------------------------------------------------------* VNKCS005
040300*    DB2 AREA FOR COMMUNICATIONS                                * VNKCS005
040400*---------------------------------------------------------------* VNKCS005
040500     EXEC SQL                                                     VNKCS005
040600          INCLUDE SQLCA                                           VNKCS005
040700     END-EXEC.                                                    VNKCS005
040800                                                                  VNKCS005
040820 EJECT                                                            VNKCS005
040830                                                                  VNKCS005
040900*---------------------------------------------------------------* VNKCS005
041000*    TVNDDPT CURSOR WHEN ENTERPRISE ID IS REQUESTED             * VNKCS005
041100*---------------------------------------------------------------* VNKCS005
041200                                                                  VNKCS005
041300     EXEC SQL                                                     VNKCS005
041400          DECLARE BUS-FUNC-CSR CURSOR                             VNKCS005
041500          FOR SELECT                                              VNKCS005
041600                FUNCTION_ID                                       VNKCS005
041700               ,FUNCTION_NAME                                     VNKCS005
041800               ,AUTHD_RACF_GP_ID                                  VNKCS005
041900          FROM                                                    VNKCS005
042000                TBUSFNC                                           VNKCS005
042100          WHERE                                                   VNKCS005
042200                 FUNCTION_ID    > 0                               VNKCS005
042300          ORDER BY                                                VNKCS005
042400                FUNCTION_NAME                                     VNKCS005
042500     END-EXEC.                                                    VNKCS005
042600                                                                  VNKCS005
042700 EJECT                                                            VNKCS005
042710                                                                  VNKCS005
042800 LINKAGE SECTION.                                                 VNKCS005
042900                                                                  VNKCS005
043000 01  DFHCOMMAREA.                                                 VNKCS005
043100     05  FILLER                         OCCURS  1 TO 4072 TIMES   VNKCS005
043200                                        DEPENDING ON EIBCALEN.    VNKCS005
043300         10  FILLER                     PIC X.                    VNKCS005
043400                                                                  VNKCS005
043500 EJECT                                                            VNKCS005
043510                                                                  VNKCS005
043600 PROCEDURE DIVISION.                                              VNKCS005
043610                                                                  VNKCS005
043700******************************************************************VNKCS005
043800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **VNKCS005
043900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **VNKCS005
044000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **VNKCS005
044100******************************************************************VNKCS005
044110                                                                  VNKCS005
044200 0000-MAIN-MODULE.                                                VNKCS005
044210                                                                  VNKCS005
044300     INITIALIZE DP030-CICS-API-FIELDS.                            VNKCS005
044310                                                                  VNKCS005
044400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       VNKCS005
044500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          VNKCS005
044600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         VNKCS005
044700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       VNKCS005
044800     MOVE LENGTH OF VN005AI        TO DP030-MAP-LENGTH (1).       VNKCS005
044900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     VNKCS005
045000     PERFORM 0001-CALL-CICS-ARCH-API.                             VNKCS005
045100*                                                                 VNKCS005
045200     PERFORM 1000-CONTROL-PROCESSING                              VNKCS005
045300*                                                                 VNKCS005
045400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     VNKCS005
045500     PERFORM 0001-CALL-CICS-ARCH-API.                             VNKCS005
045600                                                                  VNKCS005
045610     EJECT                                                        VNKCS005
045620                                                                  VNKCS005
045700******************************************************************VNKCS005
045800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **VNKCS005
045900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **VNKCS005
046000******************************************************************VNKCS005
046010                                                                  VNKCS005
046100 0001-CALL-CICS-ARCH-API.                                         VNKCS005
046110                                                                  VNKCS005
046200*    CALL 'DPKCS030' USING DFHEIBLK                               VNKCS005
046200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      VNKCS005
046300                           DFHCOMMAREA                            VNKCS005
046400                           DP030-CICS-API-FIELDS                  VNKCS005
046500                           DP020-STANDARD-COMMAREA                VNKCS005
046600                           VN005AI.                               VNKCS005
046700*                                                                 VNKCS005
046800     IF  DP030-RC-CALL-SUCCESSFUL                                 VNKCS005
046900         CONTINUE                                                 VNKCS005
047000     ELSE                                                         VNKCS005
047100         SET DP013-NO-ROLLBACK                                    VNKCS005
047200             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
047300             DP013-CICS-ABEND      TO TRUE                        VNKCS005
047400         MOVE '0001-CALL-CICS-ARCH-API'                           VNKCS005
047500                                   TO DP013-PARAGRAPH             VNKCS005
047600*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEXVNKCS005
047700*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      VNKCS005
047600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OVNKCS005
047700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      VNKCS005
047800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      VNKCS005
047900         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
048000     END-IF.                                                      VNKCS005
048010                                                                  VNKCS005
048020     EJECT                                                        VNKCS005
048030                                                                  VNKCS005
048100*----------------------------------------------------------------*VNKCS005
048200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *VNKCS005
048300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *VNKCS005
048400*                                                                *VNKCS005
048500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *VNKCS005
048600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *VNKCS005
048700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *VNKCS005
048800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *VNKCS005
048900*----------------------------------------------------------------*VNKCS005
049000                                                                  VNKCS005
049100 1000-CONTROL-PROCESSING.                                         VNKCS005
049200                                                                  VNKCS005
049300     EVALUATE TRUE                                                VNKCS005
049400         WHEN DP020-NEXT-ACT-INITIAL                              VNKCS005
049500             INITIALIZE ASC-SPECIFIC-COMMAREA                     VNKCS005
049600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            VNKCS005
049700                                      ASC-SEL-TERM-ID-OUT         VNKCS005
049800             MOVE DP020-SRC-TASK-NUMBER                           VNKCS005
049900                                   TO ASC-LIST-TASK-NUMBER        VNKCS005
050000                                      ASC-SEL-TASK-NUMBER-OUT     VNKCS005
050100             MOVE PC-LIST-QUEUE-SEQ                               VNKCS005
050200                                   TO ASC-LIST-SEQ                VNKCS005
050300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             VNKCS005
050400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 VNKCS005
050410                                                                  VNKCS005
050500***-----$TEMPLATE NOTE$-------------------------------------------VNKCS005
050600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,VNKCS005
050700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  VNKCS005
050800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.VNKCS005
050900***---------------------------------------------------------------VNKCS005
050910                                                                  VNKCS005
051000             IF  PS-COMMAREA-NOT-VALID                            VNKCS005
051300                 SET DP020-MSG-FATAL                              VNKCS005
051400                     DP020-NEXT-ACT-APPL-ERROR                    VNKCS005
051500                                   TO TRUE                        VNKCS005
051600             ELSE                                                 VNKCS005
051700                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS005
051800             END-IF                                               VNKCS005
051900                                                                  VNKCS005
052000         WHEN DP020-NEXT-ACT-READ-MAP                             VNKCS005
052100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VNKCS005
052200                                   TO PV-TOP-ITEM                 VNKCS005
052300             PERFORM 2000-PROCESS-PANEL                           VNKCS005
052400                                                                  VNKCS005
052500         WHEN DP020-NEXT-ACT-RETURN                               VNKCS005
052600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VNKCS005
052700                                   TO PV-TOP-ITEM                 VNKCS005
052800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS005
052900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 VNKCS005
053000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
053100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS005
053200                                                                  VNKCS005
053300         WHEN OTHER                                               VNKCS005
053400             SET DP013-LOGIC-ABEND TO TRUE                        VNKCS005
053500             SET DP013-NO-ROLLBACK TO TRUE                        VNKCS005
053600             MOVE '1000-CONTROL-PROCESSING'                       VNKCS005
053700                                   TO DP013-PARAGRAPH             VNKCS005
053800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    VNKCS005
053900                                   TO DP013-MESSAGE-TEXT(1)       VNKCS005
054000             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS005
054100     END-EVALUATE.                                                VNKCS005
054200                                                                  VNKCS005
054300 EJECT                                                            VNKCS005
054310                                                                  VNKCS005
054400*----------------------------------------------------------------*VNKCS005
054500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *VNKCS005
054600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *VNKCS005
054700*----------------------------------------------------------------*VNKCS005
054800                                                                  VNKCS005
054900 1100-PROCESS-INTER-APPL-COMM.                                    VNKCS005
055000                                                                  VNKCS005
055100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     VNKCS005
055110                                                                  VNKCS005
055200     EVALUATE DP020-INT-APPL-FORMAT-IND                           VNKCS005
055210*                                                                 VNKCS005
055220         WHEN PC-INTER-APPL-CRIT-SPEC                             VNKCS005
055221                                                                  VNKCS005
055230*             IF VN001-RN-NUMBER > ZEROES                         VNKCS005
055240*                 MOVE 'R'         TO DK-FTC-TYPE                 VNKCS005
055250*                 MOVE VN001-RN-NUMBER                            VNKCS005
055260*                                  TO DK-FTC-NUMBER               VNKCS005
055270*                 PERFORM 1125-SELECT-FTCNBR                      VNKCS005
055280*             ELSE                                                VNKCS005
055290*                 IF VN001-WPL-NUMBER > ZEROES                    VNKCS005
055300*                     MOVE 'W'     TO DK-FTC-TYPE                 VNKCS005
055400*                     MOVE VN001-WPL-NUMBER                       VNKCS005
055500*                                  TO DK-FTC-NUMBER               VNKCS005
055600*                     PERFORM 1125-SELECT-FTCNBR                  VNKCS005
055700*                 ELSE                                            VNKCS005
055800                      IF VN001-DUNS-NUMBER > SPACES               VNKCS005
055900                          MOVE VN001-DUNS-NUMBER                  VNKCS005
056000                                   TO DK-DUNS-NUMBER              VNKCS005
056100                          PERFORM 1110-SELECT-ENTERPRISE          VNKCS005
056200                      ELSE                                        VNKCS005
056300                          IF VN001-VENDOR-NAME > SPACES           VNKCS005
056400                              MOVE VN001-VENDOR-NAME              VNKCS005
056500                                   TO DK-VENDOR-NAME              VNKCS005
056600                              PERFORM 1115-SELECT-ENTERPRISE-NAME VNKCS005
056700                          ELSE                                    VNKCS005
056800                              MOVE PC-TSYMSG-00487                VNKCS005
056900                                   TO DP020-MSG-NUMBER            VNKCS005
057000                              SET PS-COMMAREA-NOT-VALID           VNKCS005
057100                                   TO TRUE                        VNKCS005
057200                          END-IF                                  VNKCS005
057300                     END-IF                                       VNKCS005
057400*                 END-IF                                          VNKCS005
057500*             END-IF                                              VNKCS005
058310                                                                          
058320                                                                          
058321*                                                                         
058330                                                                          
058400         WHEN PC-INTER-APPL-LIST                                  VNKCS005
058500              SET PS-COMMAREA-VALID                               VNKCS005
058600                  ASC-USE-SELECTION-QUEUE                         VNKCS005
058700                                   TO TRUE                        VNKCS005
058800              MOVE VN002-NUMBER-OF-SELECTED-ITEMS                 VNKCS005
058900                                   TO ASC-NUMBER-OF-SELECTED-ITEMSVNKCS005
059000              MOVE VN002-NUMBER-OF-TS-ITEMS                       VNKCS005
059100                                   TO ASC-NUMBER-OF-TS-ITEMS      VNKCS005
059200              MOVE VN002-SEL-QUEUE-NAME                           VNKCS005
059300                                   TO ASC-SEL-QUEUE-NAME-IN       VNKCS005
059400              PERFORM 1120-PREPARE-LIST-ENTRY                     VNKCS005
059500                                                                  VNKCS005
059600         WHEN OTHER                                               VNKCS005
060200                 MOVE PC-TSYMSG-00148                             VNKCS005
060300                                   TO DP020-MSG-NUMBER            VNKCS005
060400                 SET DP020-MSG-FATAL                              VNKCS005
060500                     DP020-NEXT-ACT-APPL-ERROR                    VNKCS005
060600                                   TO TRUE                        VNKCS005
060800     END-EVALUATE.                                                VNKCS005
060810                                                                          
060820     EJECT                                                                
060830                                                                          
060840*----------------------------------------------------------------*VNKCS005
060850* SELECT A ROW FROM THE DB2 EXTERNAL ENTERPRISE TABLE USING THE  *VNKCS005
060860* DUNS NUMBER PASSED FROM THE VENDOR CRITERIA SPECIFICATION      *VNKCS005
060870*----------------------------------------------------------------*VNKCS005
060871                                                                          
060880 1110-SELECT-ENTERPRISE.                                          VNKCS005
060881                                                                          
060890     PERFORM                                                      VNKCS005
060900         WITH TEST AFTER                                          VNKCS005
061000         VARYING PV-RETRY-COUNTER                                 VNKCS005
061100         FROM 1 BY 1                                              VNKCS005
061200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS005
061300                   OR (SQLCODE = ZERO)                            VNKCS005
061400                   OR (SQLCODE = +100))                           VNKCS005
061500*                                                                 VNKCS005
061600         EXEC SQL                                                 VNKCS005
061700             SELECT ENT_ID                                        VNKCS005
061800             INTO   :EXTENT-ENT-ID                                VNKCS005
061900             FROM   TEXTENT                                       VNKCS005
062000             WHERE  DUN_NBR = :DK-DUNS-NUMBER                     VNKCS005
062100         END-EXEC                                                 VNKCS005
062200*                                                                 VNKCS005
062300         EVALUATE TRUE                                            VNKCS005
062400             WHEN SQLCODE = ZERO                                  VNKCS005
062500             WHEN SQLCODE = +100                                  VNKCS005
062600             WHEN SQLCODE = -904                                  VNKCS005
062700             WHEN SQLCODE = -913                                  VNKCS005
062800                 CONTINUE                                         VNKCS005
062900             WHEN SQLWARN0 NOT = SPACES                           VNKCS005
063000             WHEN SQLCODE < ZERO                                  VNKCS005
063100             WHEN SQLCODE > ZERO                                  VNKCS005
063200                 MOVE '1110-SELECT-ENTERPIRSE'                    VNKCS005
063300                                   TO DP013-PARAGRAPH             VNKCS005
063400                 MOVE 'SELECT ENTERPRISE'                         VNKCS005
063500                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
063600                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS005
063700                 MOVE 'TEXTENT'    TO DP013-SQLCA                 VNKCS005
063800                 SET DP013-DB2-ABEND                              VNKCS005
063900                     DP013-XCTL-DISPLAY-RESTART                   VNKCS005
064000                                   TO TRUE                        VNKCS005
064100                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS005
064200         END-EVALUATE                                             VNKCS005
064300     END-PERFORM.                                                 VNKCS005
064400*                                                                 VNKCS005
064500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS005
064600         MOVE '1100-SELECT-ENTERPRISE'                            VNKCS005
064700                                   TO DP013-PARAGRAPH             VNKCS005
064800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS005
064900                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
065000         MOVE 'ENTERPRISE'         TO DP013-MESSAGE-TEXT (2)      VNKCS005
065100         MOVE SQLCA                TO DP013-SQLCA                 VNKCS005
065200         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    VNKCS005
065300         SET DP013-DB2-ABEND                                      VNKCS005
065400             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
065500                                   TO TRUE                        VNKCS005
065600         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
065700     END-IF.                                                      VNKCS005
065800*                                                                 VNKCS005
065900     IF SQLCODE = ZERO                                            VNKCS005
066000          SET PS-COMMAREA-VALID                                   VNKCS005
066100                                   TO TRUE                        VNKCS005
066200          MOVE EXTENT-ENT-ID       TO ASC-KEY-ENT-ID              VNKCS005
066300                                      DK-ENT-ID                   VNKCS005
066400     ELSE                                                         VNKCS005
066500          MOVE PC-TSYMSG-00159     TO DP020-MSG-NUMBER            VNKCS005
066600          SET PS-COMMAREA-NOT-VALID                               VNKCS005
066700                                   TO TRUE                        VNKCS005
066800     END-IF.                                                      VNKCS005
066900                                                                          
066910 EJECT                                                            VNKCS005
066920                                                                          
067000*----------------------------------------------------------------*VNKCS005
067100* SELECT A ROW FROM THE DB2 EXTERNAL ENTERPRISE NAME TABLE USING *VNKCS005
067200* THE NAME PASSED FROM THE VENDOR CRITERIA SPECIFICATION         *VNKCS005
067300*----------------------------------------------------------------*VNKCS005
067310                                                                          
067400 1115-SELECT-ENTERPRISE-NAME.                                     VNKCS005
067410                                                                          
067500     PERFORM                                                      VNKCS005
067600         WITH TEST AFTER                                          VNKCS005
067700         VARYING PV-RETRY-COUNTER                                 VNKCS005
067800         FROM 1 BY 1                                              VNKCS005
067900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS005
068000                   OR (SQLCODE = ZERO)                            VNKCS005
068100                   OR (SQLCODE = +100))                           VNKCS005
068200*                                                                 VNKCS005
068300         EXEC SQL                                                 VNKCS005
068400             SELECT ENT_ID                                        VNKCS005
068500             INTO   :ENTNME-ENT-ID                                VNKCS005
068600             FROM   TENTNME                                       VNKCS005
068700             WHERE  ENT_NAME_DESC = :DK-VENDOR-NAME               VNKCS005
068800         END-EXEC                                                 VNKCS005
068900*                                                                 VNKCS005
069000         EVALUATE TRUE                                            VNKCS005
069100             WHEN SQLCODE = ZERO                                  VNKCS005
069200             WHEN SQLCODE = +100                                  VNKCS005
069300             WHEN SQLCODE = -904                                  VNKCS005
069400             WHEN SQLCODE = -913                                  VNKCS005
069500                 CONTINUE                                         VNKCS005
069600             WHEN SQLWARN0 NOT = SPACES                           VNKCS005
069700             WHEN SQLCODE < ZERO                                  VNKCS005
069800             WHEN SQLCODE > ZERO                                  VNKCS005
069900                 MOVE '1115-SELECT-ENTERPIRSE-NAME'               VNKCS005
070000                                   TO DP013-PARAGRAPH             VNKCS005
070100                 MOVE 'SELECT ENTERPRISE NAME'                    VNKCS005
070200                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
070300                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS005
070400                 MOVE 'TENTNME'    TO DP013-SQLCA                 VNKCS005
070500                 SET DP013-DB2-ABEND                              VNKCS005
070600                     DP013-XCTL-DISPLAY-RESTART                   VNKCS005
070700                                   TO TRUE                        VNKCS005
070800                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS005
070900         END-EVALUATE                                             VNKCS005
071000     END-PERFORM.                                                 VNKCS005
071100*                                                                 VNKCS005
071200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS005
071300         MOVE '1115-SELECT-ENTERPRISE-NAME'                       VNKCS005
071400                                   TO DP013-PARAGRAPH             VNKCS005
071500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS005
071600                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
071700         MOVE 'ENTERPRISE NAME'    TO DP013-MESSAGE-TEXT (2)      VNKCS005
071800         MOVE SQLCA                TO DP013-SQLCA                 VNKCS005
071900         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    VNKCS005
072000         SET DP013-DB2-ABEND                                      VNKCS005
072100             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
072200                                   TO TRUE                        VNKCS005
072300         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
072400     END-IF.                                                      VNKCS005
072500*                                                                 VNKCS005
072600     IF SQLCODE = ZERO                                            VNKCS005
072700          SET PS-COMMAREA-VALID                                   VNKCS005
072800                                   TO TRUE                        VNKCS005
072900          MOVE ENTNME-ENT-ID       TO ASC-KEY-ENT-ID              VNKCS005
073000                                      DK-ENT-ID                   VNKCS005
073100     ELSE                                                         VNKCS005
073200          MOVE PC-TSYMSG-00398     TO DP020-MSG-NUMBER            VNKCS005
073300          SET PS-COMMAREA-NOT-VALID                               VNKCS005
073400                                   TO TRUE                        VNKCS005
073500     END-IF.                                                      VNKCS005
073600                                                                          
073700 EJECT                                                            VNKCS005
073800                                                                          
074300*----------------------------------------------------------------*VNKCS005
074400*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *VNKCS005
074500*  QUEUE PASSED FROM THE LIST.                                   *VNKCS005
074600*                                                                *VNKCS005
074700*----------------------------------------------------------------*VNKCS005
074800                                                                  VNKCS005
074900 1120-PREPARE-LIST-ENTRY.                                         VNKCS005
074910                                                                  VNKCS005
075000      MOVE VN003-MAX-ITEMS         TO ASC-SEL-SUB.                VNKCS005
075100      MOVE ZERO                    TO ASC-SEL-ITEM.               VNKCS005
075200      PERFORM 2300-GET-NEXT-MESSAGE.                              VNKCS005
075300                                                                  VNKCS005
075400 EJECT                                                            VNKCS005
075410                                                                  VNKCS005
082300*----------------------------------------------------------------*VNKCS005
082400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *VNKCS005
082500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *VNKCS005
082600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *VNKCS005
082700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *VNKCS005
082800* FUNCTION KEYS CAN GET THIS FAR.                                *VNKCS005
082900*----------------------------------------------------------------*VNKCS005
083000                                                                  VNKCS005
083100 2000-PROCESS-PANEL.                                              VNKCS005
083110                                                                  VNKCS005
083200     EVALUATE TRUE                                                VNKCS005
083300         WHEN DP020-SRC-AID = DP016-CLEAR                         VNKCS005
083400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS005
083500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS005
083600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
083700                                                                  VNKCS005
083800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    VNKCS005
083900             MOVE ASC-KEY-ENT-ID                                  VNKCS005
084000                                   TO DK-ENT-ID                   VNKCS005
084100             PERFORM 2050-DELETE-LIST-QUEUE                       VNKCS005
084200             PERFORM 4000-BUILD-INITIAL-PANEL                     VNKCS005
084300                                                                  VNKCS005
084400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    VNKCS005
084500             PERFORM 2140-DESELECT-ALL-ITEMS                      VNKCS005
084600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
084700                                                                  VNKCS005
084800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  VNKCS005
084900             PERFORM 2150-SELECT-ALL-ITEMS                        VNKCS005
085000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
085100                                                                  VNKCS005
085200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             VNKCS005
085300             IF ASC-USE-SELECTION-QUEUE                           VNKCS005
085400                 PERFORM 6200-DEL-LIST-QUEUE                      VNKCS005
085500                 PERFORM 2300-GET-NEXT-MESSAGE                    VNKCS005
085600                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS005
085700                 PERFORM 3200-RESET-ATTRIBUTES                    VNKCS005
085800             ELSE                                                 VNKCS005
085900*                --- BOTTOM OF LIST ---                           VNKCS005
086000                 MOVE PC-TSYMSG-00070                             VNKCS005
086100                                   TO DP020-MSG-NUMBER            VNKCS005
086200                 SET DP020-MSG-INFORMATIONAL                      VNKCS005
086300                                   TO TRUE                        VNKCS005
086400             END-IF                                               VNKCS005
086500*                                                                 VNKCS005
086600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             VNKCS005
086700             IF ASC-USE-SELECTION-QUEUE                           VNKCS005
086800                 PERFORM 6200-DEL-LIST-QUEUE                      VNKCS005
086900                 PERFORM 2310-GET-PREV-MESSAGE                    VNKCS005
087000                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS005
087100                 PERFORM 3200-RESET-ATTRIBUTES                    VNKCS005
087200             ELSE                                                 VNKCS005
087300*                --- TOP OF LIST ---                              VNKCS005
087400                 MOVE PC-TSYMSG-00069                             VNKCS005
087500                                   TO DP020-MSG-NUMBER            VNKCS005
087600                 SET DP020-MSG-INFORMATIONAL                      VNKCS005
087700                                   TO TRUE                        VNKCS005
087800             END-IF                                               VNKCS005
087900*                                                                 VNKCS005
088000         WHEN OTHER                                               VNKCS005
088100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 VNKCS005
088200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS005
088300             IF  PS-NO-ERROR                                      VNKCS005
088400                 SET DP030-CONTINUE-GO                            VNKCS005
088500                                   TO TRUE                        VNKCS005
088600                 PERFORM 2100-CHECK-FUNCTION-KEY                  VNKCS005
088700             ELSE                                                 VNKCS005
088800                 SET DP030-OVERRIDE-GO                            VNKCS005
088900                                 TO TRUE                          VNKCS005
089000             END-IF                                               VNKCS005
089100     END-EVALUATE.                                                VNKCS005
089110                                                                          
089200 EJECT                                                            VNKCS005
089210                                                                          
089300*----------------------------------------------------------------*VNKCS005
089400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *VNKCS005
089500*----------------------------------------------------------------*VNKCS005
089510                                                                          
089600 2050-DELETE-LIST-QUEUE.                                          VNKCS005
089700                                                                  VNKCS005
089800     EXEC CICS                                                    VNKCS005
089900         DELETEQ TS                                               VNKCS005
090000             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
090100             RESP  (PV-CICS-RESP)                                 VNKCS005
090200     END-EXEC.                                                    VNKCS005
090300                                                                  VNKCS005
090400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       VNKCS005
090500        (PV-CICS-RESP = DFHRESP(QIDERR))                          VNKCS005
090600         CONTINUE                                                 VNKCS005
090700     ELSE                                                         VNKCS005
090800         SET DP013-CICS-ABEND      TO TRUE                        VNKCS005
090900         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS005
091000                                                                  VNKCS005
091100         MOVE '2050-DELETE-LIST-QUEUE'                            VNKCS005
091200                                   TO DP013-PARAGRAPH             VNKCS005
091300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    VNKCS005
091400                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
091500         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
091600     END-IF.                                                      VNKCS005
091700                                                                  VNKCS005
091800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  VNKCS005
091810                                                                  VNKCS005
091900 EJECT                                                            VNKCS005
091910                                                                  VNKCS005
092000*----------------------------------------------------------------*VNKCS005
092100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*VNKCS005
092200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *VNKCS005
092300* CICS ARCHITECTURE API.                                         *VNKCS005
092400*----------------------------------------------------------------*VNKCS005
092410                                                                  VNKCS005
092500 2100-CHECK-FUNCTION-KEY.                                         VNKCS005
092510                                                                  VNKCS005
092600     EVALUATE TRUE                                                VNKCS005
092700         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  VNKCS005
092800              IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO             VNKCS005
092900                  SET ASC-NO-TSQ-UPDATE TO TRUE                   VNKCS005
093000              END-IF                                              VNKCS005
093100              INITIALIZE VN002-INTER-APPL-COMMAREA                VNKCS005
093200              MOVE ASC-NUMBER-OF-SELECTED-ITEMS                   VNKCS005
093300                                TO VN002-NUMBER-OF-SELECTED-ITEMS VNKCS005
093400              PERFORM 5000-PREPARE-SEL-QUEUE                      VNKCS005
093500                                                                  VNKCS005
093600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  VNKCS005
093700             MOVE +1               TO PV-TOP-ITEM                 VNKCS005
093800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
093900             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS005
094000                                                                  VNKCS005
094100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   VNKCS005
094200             PERFORM 2110-BROWSE-BACKWARD                         VNKCS005
094300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
094400             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS005
094500                                                                  VNKCS005
094600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   VNKCS005
094700             PERFORM 2120-BROWSE-FORWARD                          VNKCS005
094800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS005
094900             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS005
095000                                                                  VNKCS005
095100         WHEN DP020-SRC-AID = DP016-ENTER                         VNKCS005
095200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   VNKCS005
095300             IF  PS-ERROR                                         VNKCS005
095400                 CONTINUE                                         VNKCS005
095500             ELSE                                                 VNKCS005
095600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             VNKCS005
095700             END-IF                                               VNKCS005
095800                                                                  VNKCS005
095900         WHEN OTHER                                               VNKCS005
096000             SET DP013-NO-ROLLBACK                                VNKCS005
096100                 DP013-XCTL-DISPLAY-RESTART                       VNKCS005
096200                 DP013-CICS-ABEND  TO TRUE                        VNKCS005
096300             MOVE '2100-CHECK-FUNCTION-KEY'                       VNKCS005
096400                                   TO DP013-PARAGRAPH             VNKCS005
096500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      VNKCS005
096600                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
096700             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS005
096800     END-EVALUATE.                                                VNKCS005
096900                                                                  VNKCS005
096910     EJECT                                                        VNKCS005
096920                                                                  VNKCS005
097000*----------------------------------------------------------------*VNKCS005
097100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *VNKCS005
097200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *VNKCS005
097300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *VNKCS005
097400*    MESSAGE.                                                    *VNKCS005
097500*----------------------------------------------------------------*VNKCS005
097600                                                                  VNKCS005
097700 2110-BROWSE-BACKWARD.                                            VNKCS005
097710                                                                  VNKCS005
097800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    VNKCS005
097900         GIVING PV-TOP-ITEM.                                      VNKCS005
098000*                                                                 VNKCS005
098100     IF  ((PV-TOP-ITEM < +1)                                      VNKCS005
098200       OR (PV-TOP-ITEM = +1))                                     VNKCS005
098300         MOVE +1                   TO PV-TOP-ITEM                 VNKCS005
098400*        -- TOP OF LIST --                                        VNKCS005
098500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VNKCS005
098600         SET DP020-MSG-INFORMATIONAL TO TRUE                      VNKCS005
098700     END-IF.                                                      VNKCS005
098800                                                                  VNKCS005
098900 EJECT                                                            VNKCS005
098910                                                                  VNKCS005
099000*----------------------------------------------------------------*VNKCS005
099100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *VNKCS005
099200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *VNKCS005
099300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *VNKCS005
099400*----------------------------------------------------------------*VNKCS005
099500                                                                  VNKCS005
099600 2120-BROWSE-FORWARD.                                             VNKCS005
099700                                                                  VNKCS005
099800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              VNKCS005
099900         GIVING PV-TOP-ITEM.                                      VNKCS005
100000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   VNKCS005
100100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VNKCS005
100200                                   TO PV-TOP-ITEM                 VNKCS005
100300*        -- BOTTOM OF LIST --                                     VNKCS005
100400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VNKCS005
100500         SET DP020-MSG-INFORMATIONAL                              VNKCS005
100600                                   TO TRUE                        VNKCS005
100700     ELSE                                                         VNKCS005
100800         COMPUTE PV-BOTTOM-ITEM =                                 VNKCS005
100900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 VNKCS005
101000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            VNKCS005
101100*            -- BOTTOM OF LIST --                                 VNKCS005
101200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VNKCS005
101300             SET DP020-MSG-INFORMATIONAL                          VNKCS005
101400                                   TO TRUE                        VNKCS005
101500         END-IF                                                   VNKCS005
101600     END-IF.                                                      VNKCS005
101700                                                                          
101710 EJECT                                                            VNKCS005
101720                                                                          
101800*----------------------------------------------------------------*VNKCS005
101900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *VNKCS005
102000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *VNKCS005
102100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *VNKCS005
102200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *VNKCS005
102300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *VNKCS005
102400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *VNKCS005
102500*----------------------------------------------------------------*VNKCS005
102600                                                                  VNKCS005
102700 2130-CHECK-FOR-JUMP-BROWSE.                                      VNKCS005
102710                                                                          
102800     SET PS-NO-ERROR               TO TRUE.                       VNKCS005
102900     IF (ASC-START-ITEM-REQUEST = SPACE)                          VNKCS005
103000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VNKCS005
103100                                   TO PV-TOP-ITEM                 VNKCS005
103200     ELSE                                                         VNKCS005
103300         MOVE ASC-START-ITEM-REQUEST                              VNKCS005
103400                                   TO DP010I-UNEDITED-FIELD       VNKCS005
103500         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       VNKCS005
103600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     VNKCS005
103700         SET DP010I-NEGATIVE-NOT-ALLOWED                          VNKCS005
103800                                   TO TRUE                        VNKCS005
103910         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
103920                         USING DP010I-NUMERIC-EDIT-AREA                   
104000                                                                  VNKCS005
104100         IF  NOT DP010I-ERROR-DETECTED                            VNKCS005
104200             MOVE DP010I-NUMERIC-FIELD                            VNKCS005
104300                                   TO  ASC-START-ITEM-REQUEST-N   VNKCS005
104400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  VNKCS005
104500                 IF  ASC-START-ITEM-REQUEST-N >                   VNKCS005
104600                                          ASC-NUMBER-OF-ITEMS-READVNKCS005
104700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         VNKCS005
104800                     COMPUTE PV-TOP-ITEM =                        VNKCS005
104900                             ASC-NUMBER-OF-ITEMS-READ             VNKCS005
105000                             - PC-ITEMS-PER-PANEL + 1             VNKCS005
105100                     IF  PV-TOP-ITEM < +1                         VNKCS005
105200                         MOVE +1   TO PV-TOP-ITEM                 VNKCS005
105300                         MOVE PC-TSYMSG-00070                     VNKCS005
105400                                   TO DP020-MSG-NUMBER            VNKCS005
105500                         SET DP020-MSG-INFORMATIONAL              VNKCS005
105600                                   TO TRUE                        VNKCS005
105700                     END-IF                                       VNKCS005
105800                 ELSE                                             VNKCS005
105900                     MOVE ASC-START-ITEM-REQUEST-N                VNKCS005
106000                                   TO PV-TOP-ITEM                 VNKCS005
106100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      VNKCS005
106200                     COMPUTE PV-BOTTOM-ITEM =                     VNKCS005
106300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     VNKCS005
106400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READVNKCS005
106500*                        -- BOTTOM OF LIST --                     VNKCS005
106600                         MOVE PC-TSYMSG-00070                     VNKCS005
106700                                   TO DP020-MSG-NUMBER            VNKCS005
106800                         SET DP020-MSG-INFORMATIONAL              VNKCS005
106900                                   TO TRUE                        VNKCS005
107000                     END-IF                                       VNKCS005
107100                 END-IF                                           VNKCS005
107200             ELSE                                                 VNKCS005
107300*                --- VALUE OUT OF RANGE ----                      VNKCS005
107400                 MOVE PC-TSYMSG-00101                             VNKCS005
107500                                   TO DP020-MSG-NUMBER            VNKCS005
107600                 MOVE -1           TO ASTRTITL                    VNKCS005
107700                 SET DP030-SET-CURSOR-APPL-1                      VNKCS005
107800                                   TO TRUE                        VNKCS005
107900                 MOVE DP015-REVERSE                               VNKCS005
108000                                   TO ASTRTITH                    VNKCS005
108100                 MOVE DP015-RED    TO ASTRTITC                    VNKCS005
108200                 MOVE DP015-UNP-NUM-BRT-MDT                       VNKCS005
108300                                   TO ASTRTITA                    VNKCS005
108400                 SET DP020-MSG-FATAL                              VNKCS005
108500                                   TO TRUE                        VNKCS005
108600                 SET PS-ERROR      TO TRUE                        VNKCS005
108700             END-IF                                               VNKCS005
108800                                                                  VNKCS005
108900         ELSE                                                     VNKCS005
109000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            VNKCS005
109100             MOVE -1               TO ASTRTITL                    VNKCS005
109200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  VNKCS005
109300             MOVE DP015-REVERSE    TO ASTRTITH                    VNKCS005
109400             MOVE DP015-RED        TO ASTRTITC                    VNKCS005
109500             MOVE DP015-UNP-NUM-BRT-MDT                           VNKCS005
109600                                   TO ASTRTITA                    VNKCS005
109700             SET DP020-MSG-FATAL   TO TRUE                        VNKCS005
109800             SET PS-ERROR          TO TRUE                        VNKCS005
109900         END-IF                                                   VNKCS005
110000     END-IF.                                                      VNKCS005
110010                                                                  VNKCS005
110100 EJECT                                                            VNKCS005
110110                                                                  VNKCS005
110200*----------------------------------------------------------------*VNKCS005
110300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *VNKCS005
110400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *VNKCS005
110500*----------------------------------------------------------------*VNKCS005
110510                                                                  VNKCS005
110600 2140-DESELECT-ALL-ITEMS.                                         VNKCS005
110610                                                                  VNKCS005
110700     MOVE +1                       TO ASC-BLK-SUB.                VNKCS005
110800                                                                  VNKCS005
110900     PERFORM 2141-CLEAR-SELECTED-INDS                             VNKCS005
111000         VARYING ASC-ITEM-SUB                                     VNKCS005
111100         FROM 1 BY 1                                              VNKCS005
111200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
111300                                                                  VNKCS005
111400     ADD +1                        TO ASC-BLK-SUB.                VNKCS005
111500                                                                  VNKCS005
111600     PERFORM 2141-CLEAR-SELECTED-INDS                             VNKCS005
111700         VARYING ASC-ITEM-SUB                                     VNKCS005
111800         FROM 1 BY 1                                              VNKCS005
111900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
112000                                                                  VNKCS005
112100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS005
112200                                   TO PV-LIST-ITEM-NUMBER.        VNKCS005
112300                                                                  VNKCS005
112400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS005
112500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS005
112600                                                                  VNKCS005
112700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VNKCS005
112800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      VNKCS005
112900         MOVE +1                   TO ASC-BLK-SUB                 VNKCS005
113000                                                                  VNKCS005
113100         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS005
113200                                                                  VNKCS005
113300         MOVE +1                   TO PV-BLOCK-NUMBER             VNKCS005
113400                                                                  VNKCS005
113500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS005
113600             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS005
113700                                                                  VNKCS005
113800         PERFORM                                                  VNKCS005
113900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VNKCS005
114000                                                                  VNKCS005
114100             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
114200                                                                  VNKCS005
114300             PERFORM 2141-CLEAR-SELECTED-INDS                     VNKCS005
114400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 VNKCS005
114500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
114600                                                                  VNKCS005
114700             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
114800                                                                  VNKCS005
114900             ADD +1                TO PV-BLOCK-NUMBER             VNKCS005
115000                                                                  VNKCS005
115100         END-PERFORM                                              VNKCS005
115200                                                                  VNKCS005
115300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS005
115400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS005
115500                                                                  VNKCS005
115600         PERFORM                                                  VNKCS005
115700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS005
115800                   ASC-HIGHEST-BLOCK-WRITTEN                      VNKCS005
115900                                                                  VNKCS005
116000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS005
116100                                   TO PV-BLOCK-NUMBER             VNKCS005
116200                                                                  VNKCS005
116300             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
116400                                                                  VNKCS005
116500             PERFORM 2141-CLEAR-SELECTED-INDS                     VNKCS005
116600                 VARYING ASC-ITEM-SUB                             VNKCS005
116700                 FROM 1 BY 1                                      VNKCS005
116800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
116900                                                                  VNKCS005
117000             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
117100                                                                  VNKCS005
117200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS005
117300                                                                  VNKCS005
117400         END-PERFORM                                              VNKCS005
117500                                                                  VNKCS005
117600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS005
117700                                   TO PV-BLOCK-NUMBER             VNKCS005
117800                                                                  VNKCS005
117900         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS005
118000     END-IF.                                                      VNKCS005
118100                                                                  VNKCS005
118200                                                                  VNKCS005
118300     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSVNKCS005
118400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.VNKCS005
118500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  VNKCS005
118600                                                                  VNKCS005
118700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VNKCS005
118800                                                                  VNKCS005
118900 EJECT                                                            VNKCS005
118910                                                                  VNKCS005
119000*----------------------------------------------------------------*VNKCS005
119100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *VNKCS005
119200*----------------------------------------------------------------*VNKCS005
119300                                                                  VNKCS005
119400 2141-CLEAR-SELECTED-INDS.                                        VNKCS005
119500                                                                  VNKCS005
119600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS005
119700             NOT EQUAL ZERO                                       VNKCS005
119800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS005
119900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS005
120000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    VNKCS005
120100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VNKCS005
120200                                   TO TRUE                        VNKCS005
120300         END-IF                                                   VNKCS005
120400     END-IF.                                                      VNKCS005
120500                                                                  VNKCS005
120600 EJECT                                                            VNKCS005
120610                                                                  VNKCS005
120700*----------------------------------------------------------------*VNKCS005
120800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *VNKCS005
120900*  FOR ALL ITEMS.                                                *VNKCS005
121000*----------------------------------------------------------------*VNKCS005
121100                                                                  VNKCS005
121200 2150-SELECT-ALL-ITEMS.                                           VNKCS005
121300                                                                  VNKCS005
121400     MOVE +1                       TO ASC-BLK-SUB.                VNKCS005
121500                                                                  VNKCS005
121600     PERFORM 2151-SET-SELECTED-INDS                               VNKCS005
121700         VARYING ASC-ITEM-SUB                                     VNKCS005
121800         FROM 1 BY 1                                              VNKCS005
121900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
122000                                                                  VNKCS005
122100     ADD +1                        TO ASC-BLK-SUB.                VNKCS005
122200                                                                  VNKCS005
122300     PERFORM 2151-SET-SELECTED-INDS                               VNKCS005
122400         VARYING ASC-ITEM-SUB                                     VNKCS005
122500         FROM 1 BY 1                                              VNKCS005
122600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
122700                                                                  VNKCS005
122800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS005
122900                                   TO PV-LIST-ITEM-NUMBER.        VNKCS005
123000                                                                  VNKCS005
123100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS005
123200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS005
123300                                                                  VNKCS005
123400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VNKCS005
123500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    VNKCS005
123600         MOVE +1                   TO ASC-BLK-SUB                 VNKCS005
123700                                                                  VNKCS005
123800         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS005
123900                                                                  VNKCS005
124000         MOVE +1                   TO PV-BLOCK-NUMBER             VNKCS005
124100                                                                  VNKCS005
124200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS005
124300             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS005
124400                                                                  VNKCS005
124500         PERFORM                                                  VNKCS005
124600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VNKCS005
124700                                                                  VNKCS005
124800             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
124900                                                                  VNKCS005
125000             PERFORM 2151-SET-SELECTED-INDS                       VNKCS005
125100                 VARYING ASC-ITEM-SUB                             VNKCS005
125200                 FROM 1 BY 1                                      VNKCS005
125300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
125400                                                                  VNKCS005
125500             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
125600                                                                  VNKCS005
125700             ADD +1                TO PV-BLOCK-NUMBER             VNKCS005
125800                                                                  VNKCS005
125900         END-PERFORM                                              VNKCS005
126000                                                                  VNKCS005
126100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS005
126200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS005
126300                                                                  VNKCS005
126400         PERFORM                                                  VNKCS005
126500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS005
126600                   ASC-HIGHEST-BLOCK-WRITTEN                      VNKCS005
126700                                                                  VNKCS005
126800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS005
126900                                   TO PV-BLOCK-NUMBER             VNKCS005
127000                                                                  VNKCS005
127100             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
127200                                                                  VNKCS005
127300             PERFORM 2151-SET-SELECTED-INDS                       VNKCS005
127400                 VARYING ASC-ITEM-SUB                             VNKCS005
127500                 FROM 1 BY 1                                      VNKCS005
127600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
127700                                                                  VNKCS005
127800             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
127900                                                                  VNKCS005
128000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS005
128100                                                                  VNKCS005
128200         END-PERFORM                                              VNKCS005
128300                                                                  VNKCS005
128400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS005
128500                                   TO PV-BLOCK-NUMBER             VNKCS005
128600                                                                  VNKCS005
128700         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS005
128800     END-IF.                                                      VNKCS005
128900                                                                  VNKCS005
129000                                                                  VNKCS005
129100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             VNKCS005
129200                       ASC-NUMBER-OF-SELECTED-ITEMS.              VNKCS005
129300                                                                  VNKCS005
129400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VNKCS005
129500                                                                  VNKCS005
129600 EJECT                                                            VNKCS005
129610                                                                  VNKCS005
129700*----------------------------------------------------------------*VNKCS005
129800*    MARK EACH ITEM AS BEING SELECTED.                           *VNKCS005
129900*----------------------------------------------------------------*VNKCS005
130000                                                                  VNKCS005
130100 2151-SET-SELECTED-INDS.                                          VNKCS005
130200                                                                  VNKCS005
130300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS005
130400             NOT EQUAL ZERO                                       VNKCS005
130500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS005
130600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS005
130700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS005
130800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VNKCS005
130900                               TO  TRUE                           VNKCS005
131000         END-IF                                                   VNKCS005
131100     END-IF.                                                      VNKCS005
131110                                                                  VNKCS005
131120     EJECT                                                        VNKCS005
131130                                                                  VNKCS005
131200******************************************************************VNKCS005
131300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VNKCS005
131400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VNKCS005
131500******************************************************************VNKCS005
131510                                                                  VNKCS005
131600 2200-MOVE-SCREEN-TO-COMMAREA.                                    VNKCS005
131700                                                                  VNKCS005
131800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VNKCS005
131900     MOVE +1                       TO PV-SUB.                     VNKCS005
132000*                                                                 VNKCS005
132100     PERFORM 3100-SET-SUBSCRIPTS.                                 VNKCS005
132200     IF  ASTRTITL > ZERO                                          VNKCS005
132300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VNKCS005
132400     ELSE                                                         VNKCS005
132500         IF  ASTRTITF = DP015-ERASE-EOF                           VNKCS005
132600             INITIALIZE ASC-START-ITEM-REQUEST                    VNKCS005
132700         END-IF                                                   VNKCS005
132800     END-IF.                                                      VNKCS005
132900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VNKCS005
133000         VARYING PV-SUB                                           VNKCS005
133100         FROM 1 BY 1                                              VNKCS005
133200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VNKCS005
133210                                                                          
133220     EJECT                                                                
133230                                                                          
133300******************************************************************VNKCS005
133400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VNKCS005
133500******************************************************************VNKCS005
133510                                                                          
133600 2210-MOVE-LINES-TO-COMMAREA.                                     VNKCS005
133610                                                                          
133700     IF  MR-SELECTL (PV-SUB) > ZERO                               VNKCS005
133800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VNKCS005
133900         MOVE MR-SELECTI (PV-SUB)                                 VNKCS005
134000                                   TO ASC-TEMP-SELECTED-SW        VNKCS005
134100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VNKCS005
134200     ELSE                                                         VNKCS005
134300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                VNKCS005
134400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VNKCS005
134500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        VNKCS005
134600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VNKCS005
134700         END-IF                                                   VNKCS005
134800     END-IF.                                                      VNKCS005
134900     ADD +1                        TO ASC-ITEM-SUB.               VNKCS005
135000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VNKCS005
135100         ADD +1                    TO ASC-BLK-SUB                 VNKCS005
135200         MOVE +1                   TO ASC-ITEM-SUB                VNKCS005
135300     END-IF.                                                      VNKCS005
135400                                                                          
135410 EJECT                                                            VNKCS005
135420                                                                          
135500******************************************************************VNKCS005
135600* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *VNKCS005
135700* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *VNKCS005
135800******************************************************************VNKCS005
135810                                                                          
135900 2300-GET-NEXT-MESSAGE.                                           VNKCS005
135910                                                                          
136000     ADD +1                        TO ASC-SEL-SUB.                VNKCS005
136100     IF ASC-SEL-SUB > VN003-MAX-ITEMS                             VNKCS005
136200         ADD +1                    TO ASC-SEL-ITEM                VNKCS005
136300         MOVE +1                   TO ASC-SEL-SUB                 VNKCS005
136400     END-IF.                                                      VNKCS005
136500     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 VNKCS005
136600         PERFORM 9100-READ-SEL-QUEUE                              VNKCS005
136700         IF VN003-ITEM (ASC-SEL-SUB) > ZERO                       VNKCS005
136800             MOVE VN003-ENT-ID (ASC-SEL-SUB)                      VNKCS005
136900                                   TO ASC-KEY-ENT-ID              VNKCS005
137000             SET VN003-INQ (ASC-SEL-SUB)                          VNKCS005
137100                                   TO TRUE                        VNKCS005
137200             PERFORM 9200-REWRITE-LIST-QUEUE                      VNKCS005
137300         ELSE                                                     VNKCS005
137400             SUBTRACT +1 FROM ASC-SEL-SUB                         VNKCS005
137500*            --- BOTTOM OF LIST ---                               VNKCS005
137600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VNKCS005
137700             SET DP020-MSG-INFORMATIONAL                          VNKCS005
137800                                   TO TRUE                        VNKCS005
137900         END-IF                                                   VNKCS005
138000     ELSE                                                         VNKCS005
138100         SUBTRACT +1 FROM ASC-SEL-ITEM                            VNKCS005
138200         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 VNKCS005
138300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VNKCS005
138400         SET DP020-MSG-INFORMATIONAL                              VNKCS005
138500                                   TO TRUE                        VNKCS005
138600     END-IF.                                                      VNKCS005
138700                                                                          
138710 EJECT                                                            VNKCS005
138720                                                                          
138800******************************************************************VNKCS005
138900* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *VNKCS005
139000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *VNKCS005
139100******************************************************************VNKCS005
139110                                                                          
139200 2310-GET-PREV-MESSAGE.                                           VNKCS005
139210                                                                          
139300     SUBTRACT +1 FROM ASC-SEL-SUB.                                VNKCS005
139400     IF ASC-SEL-SUB < +1                                          VNKCS005
139500         SUBTRACT +1 FROM ASC-SEL-ITEM                            VNKCS005
139600         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 VNKCS005
139700     END-IF.                                                      VNKCS005
139800*                                                                 VNKCS005
139900     IF ASC-SEL-ITEM > ZERO                                       VNKCS005
140000         PERFORM 9100-READ-SEL-QUEUE                              VNKCS005
140100         MOVE VN003-ENT-ID (ASC-SEL-SUB)                          VNKCS005
140200                                   TO ASC-KEY-ENT-ID              VNKCS005
140300     ELSE                                                         VNKCS005
140400         MOVE +1                   TO ASC-SEL-ITEM                VNKCS005
140500                                      ASC-SEL-SUB                 VNKCS005
140600*        --- TOP OF LSIT ---                                      VNKCS005
140700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VNKCS005
140800         SET DP020-MSG-INFORMATIONAL                              VNKCS005
140900                                   TO TRUE                        VNKCS005
141000     END-IF.                                                      VNKCS005
141100                                                                          
141110 EJECT                                                            VNKCS005
141120                                                                          
141200******************************************************************VNKCS005
141300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VNKCS005
141400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VNKCS005
141500******************************************************************VNKCS005
141510                                                                          
141600 3000-EDIT-DATA-IN-COMMAREA.                                      VNKCS005
141610                                                                          
141700     SET PS-NO-ERROR               TO TRUE.                       VNKCS005
141800     PERFORM 3200-RESET-ATTRIBUTES.                               VNKCS005
141900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     VNKCS005
142000**                                                                VNKCS005
142100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              VNKCS005
142200* EDITTING IS DONE FROM THE BOTTOM UP.                            VNKCS005
142300**                                                                VNKCS005
142400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       VNKCS005
142500         ASC-ITEMS-DISPLAYED - 1.                                 VNKCS005
142600     PERFORM 3100-SET-SUBSCRIPTS.                                 VNKCS005
142700     PERFORM 3300-EDIT-SELECTIONS                                 VNKCS005
142800         VARYING PV-SUB                                           VNKCS005
142900         FROM PV-SUB BY -1                                        VNKCS005
143000         UNTIL PV-SUB < +1                                        VNKCS005
143100*                                                                 VNKCS005
143200     IF  PS-NO-ERROR                                              VNKCS005
143300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        VNKCS005
143400     END-IF.                                                      VNKCS005
143500*                                                                 VNKCS005
143600     IF  ((PS-NO-ERROR)                                           VNKCS005
143700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   VNKCS005
143800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    VNKCS005
143900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  VNKCS005
144000     END-IF.                                                      VNKCS005
144100 EJECT                                                            VNKCS005
144200*----------------------------------------------------------------*VNKCS005
144300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VNKCS005
144400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VNKCS005
144500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VNKCS005
144600*                                                                *VNKCS005
144700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VNKCS005
144800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VNKCS005
144900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VNKCS005
145000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *VNKCS005
145100*----------------------------------------------------------------*VNKCS005
145200                                                                  VNKCS005
145300 3100-SET-SUBSCRIPTS.                                             VNKCS005
145400                                                                  VNKCS005
145500     COMPUTE ASC-ITEM-SUB =                                       VNKCS005
145600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VNKCS005
145700                                                                  VNKCS005
145800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VNKCS005
145900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VNKCS005
146000                                                                  VNKCS005
146100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VNKCS005
146200     ELSE                                                         VNKCS005
146300         MOVE +1                     TO ASC-BLK-SUB               VNKCS005
146400     END-IF.                                                      VNKCS005
146500******************************************************************VNKCS005
146600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **VNKCS005
146700******************************************************************VNKCS005
146800                                                                  VNKCS005
146900 3200-RESET-ATTRIBUTES.                                           VNKCS005
147000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   VNKCS005
147100     MOVE DP015-GREEN              TO ASTRTITC.                   VNKCS005
147200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   VNKCS005
147300*                                                                 VNKCS005
147400     IF DP020-NEXT-ACT-RETURN                                     VNKCS005
147500     OR DP020-NEXT-ACT-READ-MAP                                   VNKCS005
147600        PERFORM                                                   VNKCS005
147700            VARYING PV-SUB                                        VNKCS005
147800            FROM 1 BY 1                                           VNKCS005
147900            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    VNKCS005
148000            MOVE DP015-UNP-ALP-NOR-OFF                            VNKCS005
148100                                   TO MR-SELECTA (PV-SUB)         VNKCS005
148200            MOVE DP015-GREEN       TO MR-SELECTC (PV-SUB)         VNKCS005
148300            MOVE DP015-UNDERLINE   TO MR-SELECTH (PV-SUB)         VNKCS005
148400            MOVE DP015-BLUE        TO MR-UPDATE-FLAGC (PV-SUB)    VNKCS005
148500            MOVE DP015-HL-OFF      TO MR-UPDATE-FLAGH (PV-SUB)    VNKCS005
148600        END-PERFORM                                               VNKCS005
148700     ELSE                                                         VNKCS005
148800        PERFORM                                                   VNKCS005
148900            VARYING PV-SUB                                        VNKCS005
149000            FROM 1 BY 1                                           VNKCS005
149100            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     VNKCS005
149200            MOVE DP015-UNP-ALP-NOR-OFF                            VNKCS005
149300                                   TO MR-SELECTA (PV-SUB)         VNKCS005
149400            MOVE DP015-GREEN       TO MR-SELECTC (PV-SUB)         VNKCS005
149500            MOVE DP015-UNDERLINE   TO MR-SELECTH (PV-SUB)         VNKCS005
149600            MOVE DP015-BLUE        TO MR-UPDATE-FLAGC (PV-SUB)    VNKCS005
149700            MOVE DP015-HL-OFF      TO MR-UPDATE-FLAGH (PV-SUB)    VNKCS005
149800        END-PERFORM                                               VNKCS005
149900     END-IF.                                                      VNKCS005
150000******************************************************************VNKCS005
150100** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **VNKCS005
150200** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **VNKCS005
150300** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **VNKCS005
150400** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **VNKCS005
150500******************************************************************VNKCS005
150600 3300-EDIT-SELECTIONS.                                            VNKCS005
150700     EVALUATE TRUE                                                VNKCS005
150800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VNKCS005
150900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         VNKCS005
151000                 CONTINUE                                         VNKCS005
151100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         VNKCS005
151200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS005
151300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   VNKCS005
151400                 MOVE ASC-TEMP-SELECTED-SW                        VNKCS005
151500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
151600                                TO ASC-SELECTED-SW                VNKCS005
151700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
151800             END-IF                                               VNKCS005
151900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VNKCS005
152000                 = SPACE                                          VNKCS005
152100             EVALUATE TRUE                                        VNKCS005
152200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       VNKCS005
152300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSVNKCS005
152400                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS005
152500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
152600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS005
152700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    VNKCS005
152800                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS005
152900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
153000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS005
153100                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      VNKCS005
153200                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS005
153300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
153400             END-EVALUATE                                         VNKCS005
153500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS005
153600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS005
153700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS005
153800             END-IF                                               VNKCS005
153900             PERFORM 3310-EDIT-RANGE                              VNKCS005
154000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS005
154100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS005
154200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS005
154300             END-IF                                               VNKCS005
154400             PERFORM 3310-EDIT-RANGE                              VNKCS005
154500         WHEN OTHER                                               VNKCS005
154600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           VNKCS005
154700             SET DP020-MSG-FATAL    TO TRUE                       VNKCS005
154800             MOVE -1                TO MR-SELECTL (PV-SUB)        VNKCS005
154900             SET DP030-SET-CURSOR-APPL-1                          VNKCS005
155000                                    TO TRUE                       VNKCS005
155100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        VNKCS005
155200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        VNKCS005
155300             SET PS-ERROR TO TRUE                                 VNKCS005
155400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS005
155500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     VNKCS005
155600                 MOVE SPACE         TO ASC-SELECTED-SW            VNKCS005
155700                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS005
155800             END-IF                                               VNKCS005
155900     END-EVALUATE.                                                VNKCS005
156000                                                                  VNKCS005
156100     IF DP020-SRC-AID = DP016-PF18                                VNKCS005
156200     OR DP020-SRC-AID = DP016-PF22                                VNKCS005
156300     OR DP020-SRC-AID = DP016-PF23                                VNKCS005
156400         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 VNKCS005
156500             IF ASC-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS005
156600                 CONTINUE                                         VNKCS005
156700             ELSE                                                 VNKCS005
156800                 MOVE PC-TSYMSG-01061                             VNKCS005
156900                                   TO DP020-MSG-NUMBER            VNKCS005
157000                 SET DP020-MSG-FATAL                              VNKCS005
157100                                   TO TRUE                        VNKCS005
157200                 MOVE -1           TO MR-SELECTL (PV-SUB)         VNKCS005
157300                 SET DP030-SET-CURSOR-APPL-1                      VNKCS005
157400                                   TO TRUE                        VNKCS005
157500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VNKCS005
157600                                      MR-UPDATE-FLAGC (PV-SUB)    VNKCS005
157700                 MOVE DP015-REVERSE                               VNKCS005
157800                                   TO MR-SELECTH (PV-SUB)         VNKCS005
157900                                      MR-UPDATE-FLAGH (PV-SUB)    VNKCS005
158000                 SET PS-ERROR      TO TRUE                        VNKCS005
158100             END-IF                                               VNKCS005
158200         END-IF                                                   VNKCS005
158300     END-IF                                                       VNKCS005
158400                                                                  VNKCS005
158500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 VNKCS005
158600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               VNKCS005
158700     IF  ASC-ITEM-SUB < 1                                         VNKCS005
158800         SUBTRACT +1 FROM ASC-BLK-SUB                             VNKCS005
158900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                VNKCS005
159000     END-IF.                                                      VNKCS005
159100******************************************************************VNKCS005
159200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **VNKCS005
159300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **VNKCS005
159400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**VNKCS005
159500** THE ENDING.                                                  **VNKCS005
159600******************************************************************VNKCS005
159700 3310-EDIT-RANGE.                                                 VNKCS005
159800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                VNKCS005
159900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   VNKCS005
160000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS005
160100                                   TO ASC-SELECTED-SW             VNKCS005
160200                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS005
160300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE VNKCS005
160400         ELSE                                                     VNKCS005
160500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     VNKCS005
160600                 CONTINUE                                         VNKCS005
160700             ELSE                                                 VNKCS005
160800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        VNKCS005
160900                 MOVE PC-TSYMSG-00054                             VNKCS005
161000                                   TO DP020-MSG-NUMBER            VNKCS005
161100                 SET DP020-MSG-FATAL                              VNKCS005
161200                                   TO TRUE                        VNKCS005
161300                 MOVE -1           TO MR-SELECTL (PV-SUB)         VNKCS005
161400                 SET DP030-SET-CURSOR-APPL-1                      VNKCS005
161500                                   TO TRUE                        VNKCS005
161600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VNKCS005
161700                 MOVE DP015-UNDERLINE                             VNKCS005
161800                                   TO MR-SELECTH (PV-SUB)         VNKCS005
161900                 SET PS-ERROR      TO TRUE                        VNKCS005
162000             END-IF                                               VNKCS005
162100         END-IF                                                   VNKCS005
162200     ELSE                                                         VNKCS005
162300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VNKCS005
162400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS005
162500                                   TO ASC-SELECTED-SW             VNKCS005
162600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   VNKCS005
162700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   VNKCS005
162800         ELSE                                                     VNKCS005
162900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       VNKCS005
163000                 CONTINUE                                         VNKCS005
163100             ELSE                                                 VNKCS005
163200*                -- ONLY ONE END-OF-RANGE ALLOWED --              VNKCS005
163300                 MOVE PC-TSYMSG-00055                             VNKCS005
163400                                   TO DP020-MSG-NUMBER            VNKCS005
163500                 SET DP020-MSG-FATAL                              VNKCS005
163600                                   TO TRUE                        VNKCS005
163700                 MOVE -1           TO MR-SELECTL (PV-SUB)         VNKCS005
163800                 SET DP030-SET-CURSOR-APPL-1                      VNKCS005
163900                                   TO TRUE                        VNKCS005
164000                 SET PS-ERROR      TO TRUE                        VNKCS005
164100             END-IF                                               VNKCS005
164200         END-IF                                                   VNKCS005
164300     END-IF.                                                      VNKCS005
164400*                                                                 VNKCS005
164500******************************************************************VNKCS005
164600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **VNKCS005
164700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **VNKCS005
164800******************************************************************VNKCS005
164900 3400-CHECK-RANGE-SEQUENCE.                                       VNKCS005
165000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VNKCS005
165100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      VNKCS005
165200       AND  ASC-START-OF-SELECTED-RANGE >                         VNKCS005
165300                                         ASC-END-OF-SELECTED-RANGEVNKCS005
165400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                VNKCS005
165500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 VNKCS005
165600         SET DP020-MSG-FATAL TO TRUE                              VNKCS005
165700         SET PS-ERROR TO TRUE                                     VNKCS005
165800         PERFORM 3410-POSITION-AT-ERROR                           VNKCS005
165900     END-IF.                                                      VNKCS005
166000******************************************************************VNKCS005
166100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **VNKCS005
166200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **VNKCS005
166300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **VNKCS005
166400******************************************************************VNKCS005
166500 3410-POSITION-AT-ERROR.                                          VNKCS005
166600     SET DP030-SET-CURSOR-APPL-1                                  VNKCS005
166700                                   TO TRUE.                       VNKCS005
166800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VNKCS005
166900                    - PV-TOP-ITEM + 1.                            VNKCS005
167000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS005
167100         CONTINUE                                                 VNKCS005
167200     ELSE                                                         VNKCS005
167300         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS005
167400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS005
167500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VNKCS005
167600     END-IF.                                                      VNKCS005
167700*                                                                 VNKCS005
167800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VNKCS005
167900                    - PV-TOP-ITEM + 1.                            VNKCS005
168000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS005
168100         CONTINUE                                                 VNKCS005
168200     ELSE                                                         VNKCS005
168300         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS005
168400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS005
168500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VNKCS005
168600     END-IF.                                                      VNKCS005
168700 EJECT                                                            VNKCS005
168800*----------------------------------------------------------------*VNKCS005
168900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *VNKCS005
169000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *VNKCS005
169100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *VNKCS005
169200*----------------------------------------------------------------*VNKCS005
169300                                                                  VNKCS005
169400 3500-MARK-RANGE-AS-SELECTED.                                     VNKCS005
169500     MOVE +1                       TO  ASC-BLK-SUB.               VNKCS005
169600     PERFORM 3510-MARK-SELECTED-INDS                              VNKCS005
169700         VARYING ASC-ITEM-SUB                                     VNKCS005
169800         FROM 1 BY 1                                              VNKCS005
169900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
170000                                                                  VNKCS005
170100     ADD +1                        TO ASC-BLK-SUB.                VNKCS005
170200     PERFORM 3510-MARK-SELECTED-INDS                              VNKCS005
170300         VARYING ASC-ITEM-SUB                                     VNKCS005
170400         FROM 1 BY 1                                              VNKCS005
170500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS005
170600                                                                  VNKCS005
170700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS005
170800                                   TO  PV-LIST-ITEM-NUMBER.       VNKCS005
170900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS005
171000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         VNKCS005
171100               PC-ITEMS-PER-PANEL).                               VNKCS005
171200                                                                  VNKCS005
171300     MOVE ASC-START-OF-SELECTED-RANGE                             VNKCS005
171400                                   TO PV-START-OF-SELECTED-RANGE. VNKCS005
171500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            VNKCS005
171600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  VNKCS005
171700               PC-ITEMS-PER-PANEL).                               VNKCS005
171800                                                                  VNKCS005
171900     MOVE ASC-END-OF-SELECTED-RANGE                               VNKCS005
172000                                   TO  PV-END-OF-SELECTED-RANGE.  VNKCS005
172100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             VNKCS005
172200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    VNKCS005
172300               PC-ITEMS-PER-PANEL).                               VNKCS005
172400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             VNKCS005
172500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             VNKCS005
172600                                                                  VNKCS005
172700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    VNKCS005
172800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        VNKCS005
172900         MOVE +1                   TO ASC-BLK-SUB                 VNKCS005
173000         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS005
173100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS005
173200             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS005
173300                                                                  VNKCS005
173400         PERFORM                                                  VNKCS005
173500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      VNKCS005
173600                   PV-PREV-BLOCK-IN-ARRAY                         VNKCS005
173700             MOVE PV-FIRST-BLOCK-IN-RANGE                         VNKCS005
173800                                   TO PV-BLOCK-NUMBER             VNKCS005
173900             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
174000             PERFORM 3510-MARK-SELECTED-INDS                      VNKCS005
174100                 VARYING ASC-ITEM-SUB                             VNKCS005
174200                 FROM 1 BY 1                                      VNKCS005
174300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
174400             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
174500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     VNKCS005
174600         END-PERFORM                                              VNKCS005
174700                                                                  VNKCS005
174800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS005
174900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS005
175000         PERFORM                                                  VNKCS005
175100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS005
175200                   PV-LAST-BLOCK-IN-RANGE                         VNKCS005
175300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS005
175400                                   TO PV-BLOCK-NUMBER             VNKCS005
175500             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
175600             PERFORM 3510-MARK-SELECTED-INDS                      VNKCS005
175700                 VARYING ASC-ITEM-SUB                             VNKCS005
175800                 FROM 1 BY 1                                      VNKCS005
175900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS005
176000             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
176100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS005
176200         END-PERFORM                                              VNKCS005
176300                                                                  VNKCS005
176400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS005
176500                                   TO PV-BLOCK-NUMBER             VNKCS005
176600         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS005
176700     END-IF.                                                      VNKCS005
176800                                                                  VNKCS005
176900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE VNKCS005
177000                                      ASC-END-OF-SELECTED-RANGE.  VNKCS005
177100                                                                  VNKCS005
177200 EJECT                                                            VNKCS005
177300*----------------------------------------------------------------*VNKCS005
177400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *VNKCS005
177500*----------------------------------------------------------------*VNKCS005
177600                                                                  VNKCS005
177700 3510-MARK-SELECTED-INDS.                                         VNKCS005
177800                                                                  VNKCS005
177900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VNKCS005
178000                                ASC-ITEM-SUB) >                   VNKCS005
178100         ASC-START-OF-SELECTED-RANGE)                             VNKCS005
178200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VNKCS005
178300                                ASC-ITEM-SUB) =                   VNKCS005
178400         ASC-START-OF-SELECTED-RANGE)                             VNKCS005
178500                                                                  VNKCS005
178600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VNKCS005
178700                                    ASC-ITEM-SUB) <               VNKCS005
178800             ASC-END-OF-SELECTED-RANGE)                           VNKCS005
178900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VNKCS005
179000                                    ASC-ITEM-SUB) =               VNKCS005
179100             ASC-END-OF-SELECTED-RANGE)                           VNKCS005
179200                                                                  VNKCS005
179300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS005
179400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   VNKCS005
179500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   VNKCS005
179600                               TO TRUE                            VNKCS005
179700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              VNKCS005
179800                               TO TRUE                            VNKCS005
179900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS005
180000             END-IF                                               VNKCS005
180100                                                                  VNKCS005
180200             IF DP020-SRC-AID = DP016-PF18                        VNKCS005
180300             OR DP020-SRC-AID = DP016-PF22                        VNKCS005
180400             OR DP020-SRC-AID = DP016-PF23                        VNKCS005
180500                 IF ASC-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)         VNKCS005
180600                     CONTINUE                                     VNKCS005
180700                 ELSE                                             VNKCS005
180800                     MOVE PC-TSYMSG-01061                         VNKCS005
180900                           TO DP020-MSG-NUMBER                    VNKCS005
181000                     SET DP020-MSG-FATAL                          VNKCS005
181100                           TO TRUE                                VNKCS005
181200                     MOVE -1                                      VNKCS005
181300                           TO MR-SELECTL (PV-SUB)                 VNKCS005
181400                     SET PS-ERROR      TO TRUE                    VNKCS005
181500                 END-IF                                           VNKCS005
181600             END-IF                                               VNKCS005
181700         END-IF                                                   VNKCS005
181800     END-IF.                                                      VNKCS005
181900                                                                  VNKCS005
182000 EJECT                                                            VNKCS005
182100*----------------------------------------------------------------*VNKCS005
182200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *VNKCS005
182300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *VNKCS005
182400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *VNKCS005
182500*    DISPLAY THE PANEL TO USER.                                  *VNKCS005
182600*----------------------------------------------------------------*VNKCS005
182700                                                                  VNKCS005
182800 4000-BUILD-INITIAL-PANEL.                                        VNKCS005
182900                                                                  VNKCS005
183000     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            VNKCS005
183100                                 ASC-BLOCK-ENTRIES (2).           VNKCS005
183200     MOVE +1                 TO ASC-BLK-SUB.                      VNKCS005
183300     SET ASC-ITEMS-LEFT-ON-DB                                     VNKCS005
183400                             TO TRUE.                             VNKCS005
183500                                                                  VNKCS005
183600     MOVE +0                 TO ASC-ITEM-SUB                      VNKCS005
183700                                ASC-NUMBER-OF-ITEMS-READ          VNKCS005
183800                                ASC-NUMBER-OF-SELECTED-ITEMS      VNKCS005
183900                                ASC-HIGHEST-BLOCK-WRITTEN         VNKCS005
184000                                ASC-START-OF-SELECTED-RANGE       VNKCS005
184100                                ASC-END-OF-SELECTED-RANGE         VNKCS005
184200                                ASC-ITEM-AT-TOP-OF-PANEL.         VNKCS005
184300     PERFORM 4100-PREPARE-CURSOR                                  VNKCS005
184400                                                                  VNKCS005
184500     PERFORM 4010-OPEN-CURSOR.                                    VNKCS005
184600                                                                  VNKCS005
184700     PERFORM 4300-READ-ITEMS-FROM-DB.                             VNKCS005
184800                                                                  VNKCS005
184900     PERFORM 4020-CLOSE-CURSOR.                                   VNKCS005
185000                                                                  VNKCS005
185100     MOVE +1                   TO  PV-TOP-ITEM.                   VNKCS005
185200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          VNKCS005
185300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    VNKCS005
185400         SET DP020-MSG-FATAL   TO  TRUE                           VNKCS005
185500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               VNKCS005
185600     ELSE                                                         VNKCS005
185700         MOVE -1               TO MR-SELECTL (1)                  VNKCS005
185800         SET DP030-SET-CURSOR-APPL-1                              VNKCS005
185900                               TO TRUE                            VNKCS005
186000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     VNKCS005
186100     END-IF.                                                      VNKCS005
186200*                                                                 VNKCS005
186300     PERFORM 4500-SELECT-ENT-NAME.                                VNKCS005
186400 EJECT                                                            VNKCS005
186500*----------------------------------------------------------------*VNKCS005
186600* OPEN THE TBUSFNC CURSOR.                                       *VNKCS005
186700*----------------------------------------------------------------*VNKCS005
186800                                                                  VNKCS005
186900 4010-OPEN-CURSOR.                                                VNKCS005
187000     PERFORM                                                      VNKCS005
187100         WITH TEST AFTER                                          VNKCS005
187200         VARYING PV-RETRY-COUNTER                                 VNKCS005
187300         FROM 1 BY 1                                              VNKCS005
187400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS005
187500                   OR (SQLCODE = ZERO))                           VNKCS005
187600*                                                                 VNKCS005
187700         EXEC SQL                                                 VNKCS005
187800             OPEN BUS-FUNC-CSR                                    VNKCS005
187900         END-EXEC                                                 VNKCS005
188000*                                                                 VNKCS005
188100         EVALUATE TRUE                                            VNKCS005
188200             WHEN SQLCODE = ZERO                                  VNKCS005
188300             WHEN SQLCODE = -904                                  VNKCS005
188400             WHEN SQLCODE = -913                                  VNKCS005
188500                 CONTINUE                                         VNKCS005
188600             WHEN SQLWARN0 NOT = SPACES                           VNKCS005
188700             WHEN SQLCODE < ZERO                                  VNKCS005
188800             WHEN SQLCODE > ZERO                                  VNKCS005
188900                 MOVE '4010-OPEN-CURSOR'                          VNKCS005
189000                                   TO DP013-PARAGRAPH             VNKCS005
189100                 MOVE 'OPEN BUSINESS FUNCTION CURSOR - '          VNKCS005
189200                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
189300                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS005
189400                 MOVE 'TBUSFNC '   TO DP013-DB2-TABLE-NAME (1)    VNKCS005
189500                 SET DP013-DB2-ABEND                              VNKCS005
189600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           VNKCS005
189700                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS005
189800         END-EVALUATE                                             VNKCS005
189900     END-PERFORM.                                                 VNKCS005
190000*                                                                 VNKCS005
190100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VNKCS005
190200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VNKCS005
190300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VNKCS005
190400                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
190500         MOVE SQLCA                TO DP013-SQLCA                 VNKCS005
190600         MOVE 'TBUSFNC '           TO DP013-DB2-TABLE-NAME (1)    VNKCS005
190700         SET DP013-DB2-ABEND                                      VNKCS005
190800             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
190900                                   TO TRUE                        VNKCS005
191000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
191100     END-IF.                                                      VNKCS005
191200                                                                  VNKCS005
191300 EJECT                                                            VNKCS005
191400*----------------------------------------------------------------*VNKCS005
191500* CLOSE THE TMESSAGE CURSOR.                                     *VNKCS005
191600*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *VNKCS005
191700*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *VNKCS005
191800*   USER.                                                        *VNKCS005
191900*----------------------------------------------------------------*VNKCS005
192000                                                                  VNKCS005
192100 4020-CLOSE-CURSOR.                                               VNKCS005
192200     EXEC SQL                                                     VNKCS005
192300         CLOSE BUS-FUNC-CSR                                       VNKCS005
192400     END-EXEC                                                     VNKCS005
192500*                                                                 VNKCS005
192600     EVALUATE TRUE                                                VNKCS005
192700         WHEN SQLCODE = ZERO                                      VNKCS005
192800             CONTINUE                                             VNKCS005
192900         WHEN SQLWARN0 NOT = SPACES                               VNKCS005
193000         WHEN SQLCODE < ZERO                                      VNKCS005
193100         WHEN SQLCODE > ZERO                                      VNKCS005
193200             MOVE '4020-CLOSE-CURSOR'                             VNKCS005
193300                               TO DP013-PARAGRAPH                 VNKCS005
193400             MOVE 'CLOSE BUSINESS FUNCTION CURSOR '               VNKCS005
193500                               TO DP013-MESSAGE-TEXT (1)          VNKCS005
193600             MOVE SQLCA        TO DP013-SQLCA                     VNKCS005
193700             MOVE 'TBUSFNC '   TO DP013-DB2-TABLE-NAME (1)        VNKCS005
193800             SET DP013-DB2-ABEND                                  VNKCS005
193900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               VNKCS005
194000             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS005
194100     END-EVALUATE.                                                VNKCS005
194200                                                                  VNKCS005
194300 EJECT                                                            VNKCS005
194400*----------------------------------------------------------------*VNKCS005
194500*    SET UP THE HOST VARIABLES.                                  *VNKCS005
194600*----------------------------------------------------------------*VNKCS005
194700                                                                  VNKCS005
194800 4100-PREPARE-CURSOR.                                             VNKCS005
194900                                                                  VNKCS005
195000     MOVE ASC-KEY-ENT-ID           TO DK-ENT-ID.                  VNKCS005
195100 EJECT                                                            VNKCS005
195200*----------------------------------------------------------------*VNKCS005
195300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VNKCS005
195400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VNKCS005
195500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VNKCS005
195600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VNKCS005
195700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VNKCS005
195800*                                                                *VNKCS005
195900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *VNKCS005
196000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *VNKCS005
196100*    UPON INITIALIZATION.                                        *VNKCS005
196200*----------------------------------------------------------------*VNKCS005
196300                                                                  VNKCS005
196400 4300-READ-ITEMS-FROM-DB.                                         VNKCS005
196500                                                                  VNKCS005
196600     PERFORM                                                      VNKCS005
196700         VARYING PV-READ-COUNT                                    VNKCS005
196800         FROM 1 BY 1                                              VNKCS005
196900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    VNKCS005
197000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         VNKCS005
197100                                                                  VNKCS005
197200         PERFORM 4310-FETCH                                       VNKCS005
197300                                                                  VNKCS005
197400         IF  ASC-ITEMS-LEFT-ON-DB                                 VNKCS005
197500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                VNKCS005
197600                 ADD +1            TO ASC-ITEM-SUB                VNKCS005
197700             ELSE                                                 VNKCS005
197800                 ADD +1            TO ASC-BLK-SUB                 VNKCS005
197900                 MOVE +1           TO ASC-ITEM-SUB                VNKCS005
198000                                                                  VNKCS005
198100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         VNKCS005
198200                     MOVE +1       TO ASC-BLK-SUB                 VNKCS005
198300                     SET ASC-BLOCK-MODIFIED (1)                   VNKCS005
198400                                   TO TRUE                        VNKCS005
198500                     PERFORM 5100-WRITE-TEMP-STORAGE              VNKCS005
198600                     MOVE ASC-BLOCK-ENTRIES                       VNKCS005
198700                               (PC-MAX-BLOCKS-IN-ARRAY)           VNKCS005
198800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) VNKCS005
198900                     ADD +1        TO ASC-BLK-SUB                 VNKCS005
199000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   VNKCS005
199100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      VNKCS005
199200                                   TO TRUE                        VNKCS005
199300                 END-IF                                           VNKCS005
199400             END-IF                                               VNKCS005
199500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    VNKCS005
199600             MOVE ASC-NUMBER-OF-ITEMS-READ                        VNKCS005
199700                                   TO ASC-LIST-ITEM-NUMBER        VNKCS005
199800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS005
199900             INITIALIZE PV-DB2-COUNT                              VNKCS005
200000             PERFORM 4320-COUNT-ADDRESS                           VNKCS005
200100             MOVE PV-DB2-COUNT     TO ASC-ADDRESS-COUNT           VNKCS005
200200                                       (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS005
200300             MOVE BUSFNC-FUNCTION-NAME                            VNKCS005
200400                                   TO ASC-FUNCTION-NAME           VNKCS005
200500                                       (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS005
200600             MOVE BUSFNC-FUNCTION-ID                              VNKCS005
200700                                   TO ASC-FUNCTION-ID             VNKCS005
200800                                       (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS005
200900             PERFORM 4330-RACF-ACCESS                             VNKCS005
201000         END-IF                                                   VNKCS005
201100     END-PERFORM.                                                 VNKCS005
201200                                                                  VNKCS005
201300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          VNKCS005
201400         MOVE +1                   TO ASC-BLK-SUB                 VNKCS005
201500         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS005
201600         ADD +1                TO ASC-BLK-SUB                     VNKCS005
201700         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS005
201800                                                                  VNKCS005
201900         MOVE 1                TO ASC-BLK-SUB                     VNKCS005
202000                                  PV-BLOCK-NUMBER                 VNKCS005
202100         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS005
202200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             VNKCS005
202300             MOVE 2            TO ASC-BLK-SUB                     VNKCS005
202400                                  PV-BLOCK-NUMBER                 VNKCS005
202500             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
202600         END-IF                                                   VNKCS005
202700     END-IF.                                                      VNKCS005
202800 EJECT                                                            VNKCS005
202900*----------------------------------------------------------------*VNKCS005
203000*    FETCH THE MESSAGE CURSOR.                                   *VNKCS005
203100*----------------------------------------------------------------*VNKCS005
203200                                                                  VNKCS005
203300 4310-FETCH.                                                      VNKCS005
203400                                                                  VNKCS005
203500     EXEC SQL                                                     VNKCS005
203600         FETCH BUS-FUNC-CSR                                       VNKCS005
203700         INTO  :BUSFNC-FUNCTION-ID                                VNKCS005
203800              ,:BUSFNC-FUNCTION-NAME                              VNKCS005
203900              ,:BUSFNC-AUTHD-RACF-GP-ID                           VNKCS005
204000     END-EXEC                                                     VNKCS005
204100                                                                  VNKCS005
204200     EVALUATE TRUE                                                VNKCS005
204300         WHEN SQLCODE = ZERO                                      VNKCS005
204400         WHEN SQLCODE = +100                                      VNKCS005
204500              CONTINUE                                            VNKCS005
204600         WHEN SQLWARN0 NOT = SPACE                                VNKCS005
204700         WHEN SQLCODE NOT = ZERO                                  VNKCS005
204800              MOVE '4310-FETCH-CURSOR'                            VNKCS005
204900                               TO DP013-PARAGRAPH                 VNKCS005
205000              MOVE 'FETCH BUSINESS FUNCTION CURSOR'               VNKCS005
205100                               TO DP013-MESSAGE-TEXT (1)          VNKCS005
205200              MOVE SQLCA       TO DP013-SQLCA                     VNKCS005
205300              SET DP013-DB2-ABEND                                 VNKCS005
205400                               TO TRUE                            VNKCS005
205500              PERFORM DP013-0000-PROCESS-ABEND                    VNKCS005
205600     END-EVALUATE.                                                VNKCS005
205700                                                                  VNKCS005
205800     IF  SQLCODE EQUAL +100                                       VNKCS005
205900         SET ASC-NO-ITEMS-LEFT-ON-DB                              VNKCS005
206000                                   TO TRUE                        VNKCS005
206100     END-IF.                                                      VNKCS005
206200                                                                  VNKCS005
206300 EJECT                                                            VNKCS005
206400 4320-COUNT-ADDRESS.                                              VNKCS005
206500                                                                  VNKCS005
206600     PERFORM                                                      VNKCS005
206700         WITH TEST AFTER                                          VNKCS005
206800         VARYING PV-RETRY-COUNTER                                 VNKCS005
206900         FROM 1 BY 1                                              VNKCS005
207000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS005
207100                   OR (SQLCODE = ZERO)                            VNKCS005
207200                   OR (SQLCODE = +100))                           VNKCS005
207300                                                                  VNKCS005
207400         EXEC SQL                                                 VNKCS005
207500             SELECT COUNT(*)                                      VNKCS005
207600             INTO :PV-DB2-COUNT                                   VNKCS005
207700             FROM TENTREP A                                       VNKCS005
207800                 ,TBUSLOC B                                       VNKCS005
207900                 ,TBUSFNC C                                       VNKCS005
208000             WHERE A.ENT_ID         = :DK-ENT-ID                  VNKCS005
208100               AND A.FUNCTION_ID    = :BUSFNC-FUNCTION-ID         VNKCS005
208200               AND A.ENT_ID         = B.ENT_ID                    VNKCS005
208300               AND A.ENT_BUS_LOC_ID = B.SEQ_NBR                   VNKCS005
208400               AND B.FUNCTION_ID    = C.FUNCTION_ID               VNKCS005
208500         END-EXEC                                                 VNKCS005
208600                                                                  VNKCS005
208700         EVALUATE TRUE                                            VNKCS005
208800             WHEN SQLCODE = ZERO                                  VNKCS005
208900             WHEN SQLCODE = +100                                  VNKCS005
209000             WHEN SQLCODE = -904                                  VNKCS005
209100             WHEN SQLCODE = -913                                  VNKCS005
209200                 CONTINUE                                         VNKCS005
209300             WHEN SQLWARN0 NOT = SPACES                           VNKCS005
209400             WHEN SQLCODE < ZERO                                  VNKCS005
209500             WHEN SQLCODE > ZERO                                  VNKCS005
209600                 MOVE '4320-COUNT-ADDRESS'                        VNKCS005
209700                                   TO DP013-PARAGRAPH             VNKCS005
209800                 MOVE 'COUNT TO GET NUMBER OF ADDRESSES'          VNKCS005
209900                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
210000                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS005
210100                 MOVE 'TENTREP'    TO DP013-DB2-TABLE-NAME (1)    VNKCS005
210200                 MOVE 'TBUSLOC'    TO DP013-DB2-TABLE-NAME (2)    VNKCS005
210300                 MOVE 'TBUSFNC'    TO DP013-DB2-TABLE-NAME (3)    VNKCS005
210400                 SET DP013-DB2-ABEND                              VNKCS005
210500                     DP013-XCTL-DISPLAY-RESTART                   VNKCS005
210600                                   TO TRUE                        VNKCS005
210700                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS005
210800         END-EVALUATE                                             VNKCS005
210900     END-PERFORM.                                                 VNKCS005
211000                                                                  VNKCS005
211100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS005
211200         MOVE '4320-COUNT-ADDRESSES'                              VNKCS005
211300                                   TO DP013-PARAGRAPH             VNKCS005
211400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT'      VNKCS005
211500                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
211600         MOVE 'ADDRESSES '         TO DP013-MESSAGE-TEXT (2)      VNKCS005
211700         MOVE SQLCA                TO DP013-SQLCA                 VNKCS005
211800         MOVE 'TENTREP'            TO DP013-DB2-TABLE-NAME (1)    VNKCS005
211900         MOVE 'TBUSLOC'            TO DP013-DB2-TABLE-NAME (2)    VNKCS005
212000         MOVE 'TBUSFNC'            TO DP013-DB2-TABLE-NAME (3)    VNKCS005
212100         SET DP013-DB2-ABEND                                      VNKCS005
212200             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
212300                                   TO TRUE                        VNKCS005
212400         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
212500     END-IF.                                                      VNKCS005
212600                                                                  VNKCS005
212700*----------------------------------------------------------------*VNKCS005
212800*    DETERMINE IF USER HAS RACF ACCESS TO UPDATE THE FUNCTION     VNKCS005
212900*----------------------------------------------------------------*VNKCS005
213000 4330-RACF-ACCESS.                                                VNKCS005
213100                                                                  VNKCS005
213200      MOVE BUSFNC-AUTHD-RACF-GP-ID       TO PV-FUNCTION-SECURITY  VNKCS005
213300      MOVE PV-RESOURCE-TYPE              TO DP008-RESOURCE-TYPE   VNKCS005
213400      MOVE PV-RESOURCE-NAME              TO DP008-RESOURCE-NAME   VNKCS005
213500      SET DP008-ACCESS-TYPE-READ         TO TRUE                  VNKCS005
213600                                                                  VNKCS005
213700      EXEC CICS                                                   VNKCS005
213800         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 VNKCS005
213900              COMMAREA (DP008-SECURITY-COMMAREA)                  VNKCS005
214000              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             VNKCS005
214100      END-EXEC                                                    VNKCS005
214200                                                                  VNKCS005
214300      IF DP008-CALL-SUCCESSFUL                                    VNKCS005
214400         IF DP008-ACCESS-ALLOWED                                  VNKCS005
214500             SET  ASC-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS005
214600                               TO TRUE                            VNKCS005
214700         ELSE                                                     VNKCS005
214800             SET  ASC-NO-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS005
214900                               TO TRUE                            VNKCS005
215000         END-IF                                                   VNKCS005
215100     ELSE                                                         VNKCS005
215200         MOVE '4330-RACF-ACCESS'                                  VNKCS005
215300                               TO DP013-PARAGRAPH                 VNKCS005
215400          MOVE 'UNABLE TO ACCESS CICS'                            VNKCS005
215500                               TO DP013-MESSAGE-TEXT (1)          VNKCS005
215600          MOVE SQLCA                 TO DP013-SQLCA               VNKCS005
215700          SET DP013-DB2-ABEND                                     VNKCS005
215800              DP013-XCTL-DISPLAY-RESTART                          VNKCS005
215900                               TO TRUE                            VNKCS005
216000          PERFORM DP013-0000-PROCESS-ABEND                        VNKCS005
216100      END-IF.                                                     VNKCS005
216200 EJECT                                                            VNKCS005
216300*----------------------------------------------------------------*VNKCS005
216400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *VNKCS005
216500*----------------------------------------------------------------*VNKCS005
216600                                                                  VNKCS005
216700 4400-MOVE-COMMAREA-TO-SCREEN.                                    VNKCS005
216800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             VNKCS005
216900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          VNKCS005
217000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          VNKCS005
217100             MOVE +1    TO ASC-BLK-SUB                            VNKCS005
217200             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
217300             ADD +1     TO ASC-BLK-SUB                            VNKCS005
217400             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS005
217500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             VNKCS005
217600                 GIVING PV-BLOCK-NUMBER                           VNKCS005
217700                 REMAINDER PV-REMAINDER                           VNKCS005
217800             IF  PV-REMAINDER > ZERO                              VNKCS005
217900                 ADD +1 TO PV-BLOCK-NUMBER                        VNKCS005
218000             END-IF                                               VNKCS005
218100             MOVE +1    TO ASC-BLK-SUB                            VNKCS005
218200             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
218300             ADD +1     TO ASC-BLK-SUB                            VNKCS005
218400                           PV-BLOCK-NUMBER                        VNKCS005
218500             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS005
218600     END-IF.                                                      VNKCS005
218700     MOVE +1            TO ASC-BLK-SUB.                           VNKCS005
218800     COMPUTE ASC-ITEM-SUB =                                       VNKCS005
218900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              VNKCS005
219000         + PC-ITEMS-PER-PANEL).                                   VNKCS005
219100*                                                                 VNKCS005
219200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VNKCS005
219300         ADD +1         TO ASC-BLK-SUB                            VNKCS005
219400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VNKCS005
219500     END-IF.                                                      VNKCS005
219600*                                                                 VNKCS005
219700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           VNKCS005
219800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                VNKCS005
219900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        VNKCS005
220000     PERFORM 4420-FORMAT-LIST-LINES                               VNKCS005
220100         VARYING PV-SUB                                           VNKCS005
220200         FROM PC-ITEMS-PER-PANEL BY -1                            VNKCS005
220300         UNTIL PV-SUB < +1.                                       VNKCS005
220400*                                                                 VNKCS005
220500     COMPUTE ASC-ITEMS-DISPLAYED =                                VNKCS005
220600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          VNKCS005
220700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS005
220800                                      ASTRTITO.                   VNKCS005
220900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    VNKCS005
221000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    VNKCS005
221100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VNKCS005
221200                                   TO ASELITO.                    VNKCS005
221300     MOVE ASC-VENDOR-NAME          TO AVENDO.                     VNKCS005
221400*                                                                 VNKCS005
221500     IF  DP020-MSG-NUMBER-X = SPACE                               VNKCS005
221600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  VNKCS005
221700*            --- MORE ITEMS TO DISPLAY ----                       VNKCS005
221800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            VNKCS005
221900             SET DP020-MSG-INFORMATIONAL TO TRUE                  VNKCS005
222000         END-IF                                                   VNKCS005
222100     END-IF.                                                      VNKCS005
222200*----------------------------------------------------------------*VNKCS005
222300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *VNKCS005
222400*----------------------------------------------------------------*VNKCS005
222500                                                                  VNKCS005
222600 4410-READ-TEMP-STORAGE.                                          VNKCS005
222700                                                                  VNKCS005
222800     EXEC CICS                                                    VNKCS005
222900         READQ TS                                                 VNKCS005
223000             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
223100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS005
223200             ITEM  (PV-BLOCK-NUMBER)                              VNKCS005
223300             RESP  (PV-CICS-RESP)                                 VNKCS005
223400     END-EXEC.                                                    VNKCS005
223500                                                                  VNKCS005
223600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       VNKCS005
223700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     VNKCS005
223800         CONTINUE                                                 VNKCS005
223900     ELSE                                                         VNKCS005
224000         SET DP013-CICS-ABEND     TO TRUE                         VNKCS005
224100         SET DP013-NO-ROLLBACK    TO TRUE                         VNKCS005
224200         MOVE '4410-READ-TEMP-STORAGE'                            VNKCS005
224300                                  TO DP013-PARAGRAPH              VNKCS005
224400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      VNKCS005
224500                                  TO DP013-MESSAGE-TEXT(1)        VNKCS005
224600         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
224700     END-IF.                                                      VNKCS005
224800                                                                  VNKCS005
224900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VNKCS005
225000*                                                                 VNKCS005
225100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         VNKCS005
225200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               VNKCS005
225300     END-IF.                                                      VNKCS005
225400 EJECT                                                            VNKCS005
225500*----------------------------------------------------------------*VNKCS005
225600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *VNKCS005
225700*----------------------------------------------------------------*VNKCS005
225800                                                                  VNKCS005
225900 4420-FORMAT-LIST-LINES.                                          VNKCS005
226000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      VNKCS005
226100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                VNKCS005
226200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           VNKCS005
226300         MOVE SPACE              TO MR-SELECTI (PV-SUB)           VNKCS005
226400                                    MR-ACTION (PV-SUB)            VNKCS005
226500                                    MR-FUNCTION-NAME (PV-SUB)     VNKCS005
226600                                    MR-ADDRESS-COUNT-X (PV-SUB)   VNKCS005
226700                                    MR-UPDATE-FLAG (PV-SUB)       VNKCS005
226800     ELSE                                                         VNKCS005
226900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VNKCS005
227000                                                   > SPACE        VNKCS005
227100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS005
227200                                 TO MR-SELECTI (PV-SUB)           VNKCS005
227300         ELSE                                                     VNKCS005
227400             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VNKCS005
227500                                 TO MR-SELECTI (PV-SUB)           VNKCS005
227600         END-IF                                                   VNKCS005
227700*                                                                 VNKCS005
227800         IF  DP030-SET-CURSOR-TRAILER                             VNKCS005
227900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS005
228000                 > SPACE)                                         VNKCS005
228100               OR (PV-SUB = 1))                                   VNKCS005
228200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               VNKCS005
228300                MOVE -1          TO MR-SELECTL (PV-SUB)           VNKCS005
228400             END-IF                                               VNKCS005
228500         END-IF                                                   VNKCS005
228600*                                                                 VNKCS005
228700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           VNKCS005
228800             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS005
228900                                 TO MR-ACTION (PV-SUB)            VNKCS005
229000             MOVE ASC-FUNCTION-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)   VNKCS005
229100                                 TO MR-FUNCTION-NAME  (PV-SUB)    VNKCS005
229200             MOVE ASC-ADDRESS-COUNT  (ASC-BLK-SUB ASC-ITEM-SUB)   VNKCS005
229300                                 TO MR-ADDRESS-COUNT  (PV-SUB)    VNKCS005
229400             MOVE ASC-UPDATE-FLAG  (ASC-BLK-SUB ASC-ITEM-SUB)     VNKCS005
229500                                 TO MR-UPDATE-FLAG  (PV-SUB)      VNKCS005
229600         END-IF                                                   VNKCS005
229700     END-IF.                                                      VNKCS005
229800     SUBTRACT +1 FROM ASC-ITEM-SUB                                VNKCS005
229900     IF  ASC-ITEM-SUB < + 1                                       VNKCS005
230000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  VNKCS005
230100         MOVE +1                 TO ASC-BLK-SUB                   VNKCS005
230200     END-IF.                                                      VNKCS005
230300******************************************************************VNKCS005
230400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **VNKCS005
230500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **VNKCS005
230600** ISSUE A WARNING.                                             **VNKCS005
230700******************************************************************VNKCS005
230800 4430-CHECK-FOR-BEGIN-AND-END.                                    VNKCS005
230900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VNKCS005
231000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VNKCS005
231100*            -- NO END-OF-RANGE SPECFIED ---                      VNKCS005
231200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            VNKCS005
231300             SET DP020-MSG-WARNING TO TRUE                        VNKCS005
231400             PERFORM 4431-POSITION-AT-WARNING                     VNKCS005
231500         END-IF                                                   VNKCS005
231600     ELSE                                                         VNKCS005
231700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     VNKCS005
231800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                VNKCS005
231900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            VNKCS005
232000             SET DP020-MSG-WARNING TO TRUE                        VNKCS005
232100             PERFORM 4431-POSITION-AT-WARNING                     VNKCS005
232200         END-IF                                                   VNKCS005
232300     END-IF.                                                      VNKCS005
232400******************************************************************VNKCS005
232500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **VNKCS005
232600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **VNKCS005
232700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **VNKCS005
232800** POSITION THE CURSOR THERE.                                   **VNKCS005
232900******************************************************************VNKCS005
233000 4431-POSITION-AT-WARNING.                                        VNKCS005
233100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VNKCS005
233200                    - PV-TOP-ITEM + 1.                            VNKCS005
233300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS005
233400         CONTINUE                                                 VNKCS005
233500     ELSE                                                         VNKCS005
233600         SET DP030-SET-CURSOR-APPL-1                              VNKCS005
233700                                   TO TRUE                        VNKCS005
233800         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS005
233900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS005
234000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VNKCS005
234100     END-IF.                                                      VNKCS005
234200*                                                                 VNKCS005
234300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VNKCS005
234400                    - PV-TOP-ITEM + 1.                            VNKCS005
234500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS005
234600         CONTINUE                                                 VNKCS005
234700     ELSE                                                         VNKCS005
234800         SET DP030-SET-CURSOR-APPL-1                              VNKCS005
234900                                   TO TRUE                        VNKCS005
235000         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS005
235100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS005
235200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VNKCS005
235300     END-IF.                                                      VNKCS005
235400 EJECT                                                            VNKCS005
235500*----------------------------------------------------------------*VNKCS005
235600* GET THE PRIMARY ENTERPRISE NAME FROM THE ENTERPRISE NAME DB2   *VNKCS005
235700* TABLE.                                                         *VNKCS005
235800*----------------------------------------------------------------*VNKCS005
235900 4500-SELECT-ENT-NAME.                                            VNKCS005
236000                                                                  VNKCS005
236100     PERFORM                                                      VNKCS005
236200         WITH TEST AFTER                                          VNKCS005
236300         VARYING PV-RETRY-COUNTER                                 VNKCS005
236400         FROM 1 BY 1                                              VNKCS005
236500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS005
236600                   OR (SQLCODE = ZERO)                            VNKCS005
236700                   OR (SQLCODE = +100))                           VNKCS005
236800*                                                                 VNKCS005
236900         EXEC SQL                                                 VNKCS005
237000             SELECT ENT_NAME_DESC                                 VNKCS005
237100             INTO   :ENTNME-ENT-NAME-DESC                         VNKCS005
237200             FROM   TENTNME                                       VNKCS005
237300             WHERE  ENT_ID   = :DK-ENT-ID                         VNKCS005
237400               AND  TYPE_CDE = '01'                               VNKCS005
237500         END-EXEC                                                 VNKCS005
237600*                                                                 VNKCS005
237700         EVALUATE TRUE                                            VNKCS005
237800             WHEN SQLCODE = ZERO                                  VNKCS005
237900             WHEN SQLCODE = +100                                  VNKCS005
238000             WHEN SQLCODE = -904                                  VNKCS005
238100             WHEN SQLCODE = -913                                  VNKCS005
238200                 CONTINUE                                         VNKCS005
238300             WHEN SQLWARN0 NOT = SPACES                           VNKCS005
238400             WHEN SQLCODE < ZERO                                  VNKCS005
238500             WHEN SQLCODE > ZERO                                  VNKCS005
238600                 MOVE '4500-SELECT-ENT-NAME'                      VNKCS005
238700                                   TO DP013-PARAGRAPH             VNKCS005
238800                 MOVE 'SELECT ENTERPRISE NAME'                    VNKCS005
238900                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
239000                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS005
239100                 MOVE 'TENTNME'    TO DP013-SQLCA                 VNKCS005
239200                 SET DP013-DB2-ABEND                              VNKCS005
239300                     DP013-XCTL-DISPLAY-RESTART                   VNKCS005
239400                                   TO TRUE                        VNKCS005
239500                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS005
239600         END-EVALUATE                                             VNKCS005
239700     END-PERFORM.                                                 VNKCS005
239800*                                                                 VNKCS005
239900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS005
240000         MOVE '4500-SELECT-ENT-NAME'                              VNKCS005
240100                                   TO DP013-PARAGRAPH             VNKCS005
240200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS005
240300                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
240400         MOVE 'SHORT MESSAGE'      TO DP013-MESSAGE-TEXT (2)      VNKCS005
240500         MOVE SQLCA                TO DP013-SQLCA                 VNKCS005
240600         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    VNKCS005
240700         SET DP013-DB2-ABEND                                      VNKCS005
240800             DP013-XCTL-DISPLAY-RESTART                           VNKCS005
240900                                   TO TRUE                        VNKCS005
241000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
241100     END-IF.                                                      VNKCS005
241200*                                                                 VNKCS005
241300     MOVE ENTNME-ENT-NAME-DESC     TO AVENDO                      VNKCS005
241400                                      ASC-VENDOR-NAME.            VNKCS005
241500 EJECT                                                            VNKCS005
241600*----------------------------------------------------------------*VNKCS005
241700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VNKCS005
241800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VNKCS005
241900* FOR THE SELECTED ITEMS QUEUE.                                  *VNKCS005
242000*                                                                *VNKCS005
242100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VNKCS005
242200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VNKCS005
242300* THE ARRAY IS FULL.                                             *VNKCS005
242400*----------------------------------------------------------------*VNKCS005
242500                                                                  VNKCS005
242600 5000-PREPARE-SEL-QUEUE.                                          VNKCS005
242700                                                                  VNKCS005
242800     MOVE +1                   TO  ASC-BLK-SUB.                   VNKCS005
242900     PERFORM 5100-WRITE-TEMP-STORAGE.                             VNKCS005
243000     ADD +1                    TO  ASC-BLK-SUB.                   VNKCS005
243100     PERFORM 5100-WRITE-TEMP-STORAGE.                             VNKCS005
243200                                                                  VNKCS005
243300     MOVE ASC-SEL-QUEUE-NAME-OUT                                  VNKCS005
243400                               TO  VN002-SEL-QUEUE-NAME.          VNKCS005
243500     PERFORM 6010-DELETE-SEL-QUEUE.                               VNKCS005
243600                                                                  VNKCS005
243700     SET ASC-UPDATE-TSQ        TO  TRUE.                          VNKCS005
243800                                                                  VNKCS005
243900     SET VN003-IDX             TO  1.                             VNKCS005
244000     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       VNKCS005
244100     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        VNKCS005
244200                                                                  VNKCS005
244300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           VNKCS005
244400             VARYING PV-ITEM                                      VNKCS005
244500             FROM 1 BY 1                                          VNKCS005
244600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     VNKCS005
244700                                                                  VNKCS005
244800     IF  VN003-IDX > 1                                            VNKCS005
244900         PERFORM 5205-WRITE-SEL-QUEUE                             VNKCS005
245000         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        VNKCS005
245100     END-IF.                                                      VNKCS005
245200 EJECT                                                            VNKCS005
245300*----------------------------------------------------------------*VNKCS005
245400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *VNKCS005
245500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *VNKCS005
245600*----------------------------------------------------------------*VNKCS005
245700                                                                  VNKCS005
245800 5100-WRITE-TEMP-STORAGE.                                         VNKCS005
245900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VNKCS005
246000                                   TO PV-LIST-ITEM-NUMBER.        VNKCS005
246100     COMPUTE PV-BLOCK-NUMBER =                                    VNKCS005
246200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS005
246300                                                                  VNKCS005
246400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VNKCS005
246500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VNKCS005
246600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VNKCS005
246700             PERFORM 5105-REWRITE-ASC-LISTQ                       VNKCS005
246800         END-IF                                                   VNKCS005
246900     ELSE                                                         VNKCS005
247000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VNKCS005
247100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            VNKCS005
247200         PERFORM 5110-WRITE-ASC-LISTQ                             VNKCS005
247300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VNKCS005
247400     END-IF.                                                      VNKCS005
247500                                                                  VNKCS005
247600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VNKCS005
247700******************************************************************VNKCS005
247800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VNKCS005
247900** SPECIFIC COMMAREA.                                           **VNKCS005
248000******************************************************************VNKCS005
248100 5105-REWRITE-ASC-LISTQ.                                          VNKCS005
248200     EXEC CICS                                                    VNKCS005
248300         WRITEQ TS                                                VNKCS005
248400             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
248500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS005
248600             ITEM  (PV-BLOCK-NUMBER)                              VNKCS005
248700             REWRITE                                              VNKCS005
248800             RESP  (PV-CICS-RESP)                                 VNKCS005
248900     END-EXEC.                                                    VNKCS005
249000                                                                  VNKCS005
249100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VNKCS005
249200         CONTINUE                                                 VNKCS005
249300     ELSE                                                         VNKCS005
249400         SET DP013-CICS-ABEND            TO TRUE                  VNKCS005
249500         SET DP013-NO-ROLLBACK           TO TRUE                  VNKCS005
249600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VNKCS005
249700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VNKCS005
249800                                         TO DP013-MESSAGE-TEXT(1) VNKCS005
249900         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
250000     END-IF.                                                      VNKCS005
250100                                                                  VNKCS005
250200******************************************************************VNKCS005
250300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VNKCS005
250400** SPECIFIC COMMAREA.                                           **VNKCS005
250500******************************************************************VNKCS005
250600 5110-WRITE-ASC-LISTQ.                                            VNKCS005
250700     EXEC CICS                                                    VNKCS005
250800         WRITEQ TS                                                VNKCS005
250900             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
251000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS005
251100             ITEM  (PV-BLOCK-NUMBER)                              VNKCS005
251200             RESP  (PV-CICS-RESP)                                 VNKCS005
251300     END-EXEC.                                                    VNKCS005
251400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VNKCS005
251500         SET DP013-CICS-ABEND      TO TRUE                        VNKCS005
251600         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS005
251700         MOVE '5110-WRITE-ASC-LISTQ'                              VNKCS005
251800                                   TO DP013-PARAGRAPH             VNKCS005
251900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VNKCS005
252000                                   TO DP013-MESSAGE-TEXT(1)       VNKCS005
252100         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
252200     END-IF.                                                      VNKCS005
252300 EJECT                                                            VNKCS005
252400*----------------------------------------------------------------*VNKCS005
252500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VNKCS005
252600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VNKCS005
252700*----------------------------------------------------------------*VNKCS005
252800                                                                  VNKCS005
252900 5200-FILL-SEL-QUEUE-RECORD.                                      VNKCS005
253000                                                                  VNKCS005
253100     PERFORM 6112-READ-LIST-QUEUE.                                VNKCS005
253200                                                                  VNKCS005
253300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VNKCS005
253400         PERFORM                                                  VNKCS005
253500         VARYING LQW-IDX                                          VNKCS005
253600         FROM 1 BY 1                                              VNKCS005
253700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VNKCS005
253800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VNKCS005
253900                                                                  VNKCS005
254000             IF  LQW-SELECT (LQW-IDX)                             VNKCS005
254100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              VNKCS005
254200                                   TO VN003-ITEM (VN003-IDX)      VNKCS005
254300                 MOVE LQW-FUNCTION-ID (LQW-IDX)                   VNKCS005
254400                                   TO VN003-FUNCTION-ID           VNKCS005
254500                                        (VN003-IDX)               VNKCS005
254600                 MOVE ASC-KEY-ENT-ID                              VNKCS005
254700                                   TO VN003-ENT-ID (VN003-IDX)    VNKCS005
254800                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) VNKCS005
254900                 SET VN003-IDX UP BY 1                            VNKCS005
255000                 IF  VN003-IDX > VN003-MAX-ITEMS                  VNKCS005
255100                     PERFORM 5205-WRITE-SEL-QUEUE                 VNKCS005
255200                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    VNKCS005
255300                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         VNKCS005
255400                     SET VN003-IDX TO  1                          VNKCS005
255500                 END-IF                                           VNKCS005
255600             END-IF                                               VNKCS005
255700         END-PERFORM                                              VNKCS005
255800     END-IF.                                                      VNKCS005
255900                                                                  VNKCS005
256000*----------------------------------------------------------------*VNKCS005
256100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *VNKCS005
256200*----------------------------------------------------------------*VNKCS005
256300                                                                  VNKCS005
256400 5205-WRITE-SEL-QUEUE.                                            VNKCS005
256500                                                                  VNKCS005
256600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VNKCS005
256700                                   TO VN003-SELECTED-ITEMS.       VNKCS005
256800                                                                  VNKCS005
256900     EXEC CICS                                                    VNKCS005
257000          WRITEQ TS                                               VNKCS005
257100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      VNKCS005
257200              FROM  (VN003-VENDOR-SEL-REC)                        VNKCS005
257300              ITEM  (PV-SEL-QUEUE-ITEM)                           VNKCS005
257400              RESP  (PV-CICS-RESP)                                VNKCS005
257500     END-EXEC.                                                    VNKCS005
257600                                                                  VNKCS005
257700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS005
257800         CONTINUE                                                 VNKCS005
257900     ELSE                                                         VNKCS005
258000         SET DP013-CICS-ABEND      TO TRUE                        VNKCS005
258100         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS005
258200         MOVE '5205-WRITE-SEL-QUEUE'                              VNKCS005
258300                                   TO DP013-PARAGRAPH             VNKCS005
258400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          VNKCS005
258500                                   TO DP013-MESSAGE-TEXT(1)       VNKCS005
258600         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
258700     END-IF.                                                      VNKCS005
258800 EJECT                                                            VNKCS005
258900******************************************************************VNKCS005
259000** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **VNKCS005
259100** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **VNKCS005
259200** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **VNKCS005
259300** THE USER.                                                    **VNKCS005
259400******************************************************************VNKCS005
259500 6000-REFRESH-PANEL-FROM-TEMP.                                    VNKCS005
259600     IF  ASC-UPDATE-TSQ                                           VNKCS005
259700         SET ASC-NO-TSQ-UPDATE TO TRUE                            VNKCS005
259800         MOVE ZERO                 TO PV-SAVE-ITEM                VNKCS005
259900                                      PV-SEL-QUEUE-ITEM           VNKCS005
260000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        VNKCS005
260100                                   TO PV-HOLD-SELECTED-ITEMS      VNKCS005
260200         PERFORM 6100-UPDATE-TSQ                                  VNKCS005
260300             UNTIL PV-ITEMS-PROCESSED >                           VNKCS005
260400                                     ASC-NUMBER-OF-SELECTED-ITEMS VNKCS005
260500         PERFORM 6010-DELETE-SEL-QUEUE                            VNKCS005
260600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         VNKCS005
260700                    ASC-BLOCK-ENTRIES (2)                         VNKCS005
260800     END-IF.                                                      VNKCS005
260900                                                                  VNKCS005
261000*----------------------------------------------------------------*VNKCS005
261100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *VNKCS005
261200*----------------------------------------------------------------*VNKCS005
261300 6010-DELETE-SEL-QUEUE.                                           VNKCS005
261400                                                                  VNKCS005
261500     EXEC CICS                                                    VNKCS005
261600         DELETEQ TS                                               VNKCS005
261700             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       VNKCS005
261800             RESP  (PV-CICS-RESP)                                 VNKCS005
261900     END-EXEC.                                                    VNKCS005
262000*                                                                 VNKCS005
262100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VNKCS005
262200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VNKCS005
262300         CONTINUE                                                 VNKCS005
262400     ELSE                                                         VNKCS005
262500         SET DP013-CICS-ABEND TO TRUE                             VNKCS005
262600         SET DP013-NO-ROLLBACK TO TRUE                            VNKCS005
262700         MOVE '6010-DELETE-SEL-QUEUE'                             VNKCS005
262800                        TO DP013-PARAGRAPH                        VNKCS005
262900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         VNKCS005
263000                        TO DP013-MESSAGE-TEXT (1)                 VNKCS005
263100         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
263200     END-IF.                                                      VNKCS005
263300                                                                  VNKCS005
263400*----------------------------------------------------------------*VNKCS005
263500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *VNKCS005
263600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *VNKCS005
263700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *VNKCS005
263800*    THE TEMP QUEUE.                                             *VNKCS005
263900*----------------------------------------------------------------*VNKCS005
264000                                                                  VNKCS005
264100 6100-UPDATE-TSQ.                                                 VNKCS005
264200                                                                  VNKCS005
264300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             VNKCS005
264400     PERFORM 6105-READ-SEL-QUEUE.                                 VNKCS005
264500     PERFORM                                                      VNKCS005
264600         VARYING VN003-IDX                                        VNKCS005
264700         FROM 1 BY 1                                              VNKCS005
264800         UNTIL ((PV-ITEMS-PROCESSED >                             VNKCS005
264900                              PV-HOLD-SELECTED-ITEMS)             VNKCS005
265000         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             VNKCS005
265100         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  VNKCS005
265200             PERFORM 6110-PROCESS-ITEMS                           VNKCS005
265300         END-IF                                                   VNKCS005
265400         ADD +1                TO PV-ITEMS-PROCESSED              VNKCS005
265500     END-PERFORM.                                                 VNKCS005
265600     PERFORM 6111-WRITE-LIST-QUEUE.                               VNKCS005
265700*----------------------------------------------------------------*VNKCS005
265800*    READ THE LIST QUEUE RECORD.                                 *VNKCS005
265900*----------------------------------------------------------------*VNKCS005
266000                                                                  VNKCS005
266100 6105-READ-SEL-QUEUE.                                             VNKCS005
266200                                                                  VNKCS005
266300     EXEC CICS                                                    VNKCS005
266400          READQ TS                                                VNKCS005
266500              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      VNKCS005
266600              INTO  (VN003-VENDOR-SEL-REC)                        VNKCS005
266700              ITEM  (PV-SEL-QUEUE-ITEM)                           VNKCS005
266800              RESP  (PV-CICS-RESP)                                VNKCS005
266900     END-EXEC.                                                    VNKCS005
267000*                                                                 VNKCS005
267100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS005
267200         CONTINUE                                                 VNKCS005
267300     ELSE                                                         VNKCS005
267400         SET DP013-CICS-ABEND      TO  TRUE                       VNKCS005
267500         SET DP013-NO-ROLLBACK     TO  TRUE                       VNKCS005
267600         MOVE '6105-READ-SEL-QUEUE'                               VNKCS005
267700                                   TO  DP013-PARAGRAPH            VNKCS005
267800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           VNKCS005
267900                                   TO  DP013-MESSAGE-TEXT(1)      VNKCS005
268000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
268100     END-IF.                                                      VNKCS005
268200 EJECT                                                            VNKCS005
268300*----------------------------------------------------------------*VNKCS005
268400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*VNKCS005
268500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*VNKCS005
268600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *VNKCS005
268700*----------------------------------------------------------------*VNKCS005
268800                                                                  VNKCS005
268900 6110-PROCESS-ITEMS.                                              VNKCS005
269000                                                                  VNKCS005
269100     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          VNKCS005
269200                     / PC-ITEMS-PER-PANEL).                       VNKCS005
269300                                                                  VNKCS005
269400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           VNKCS005
269500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          VNKCS005
269600             PERFORM 6111-WRITE-LIST-QUEUE                        VNKCS005
269700         END-IF                                                   VNKCS005
269800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    VNKCS005
269900                                                                  VNKCS005
270000         PERFORM 6112-READ-LIST-QUEUE                             VNKCS005
270100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               VNKCS005
270200             CONTINUE                                             VNKCS005
270300         END-IF                                                   VNKCS005
270400     END-IF.                                                      VNKCS005
270500                                                                  VNKCS005
270600     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     VNKCS005
270700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              VNKCS005
270800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         VNKCS005
270900     MOVE LQW-SELECTED-SW (PV-SUB)                                VNKCS005
271000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  VNKCS005
271100     EVALUATE TRUE                                                VNKCS005
271200         WHEN VN003-ADD (VN003-IDX)                               VNKCS005
271300              MOVE PC-ADD      TO LQW-ACTION (PV-SUB)             VNKCS005
271400                                                                  VNKCS005
271500         WHEN VN003-INQ (VN003-IDX)                               VNKCS005
271600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             VNKCS005
271700                                                                  VNKCS005
271800         WHEN VN003-UPD (VN003-IDX)                               VNKCS005
271900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             VNKCS005
272000                                                                  VNKCS005
272100         WHEN VN003-DEL (VN003-IDX)                               VNKCS005
272200              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             VNKCS005
272300                                                                  VNKCS005
272400         WHEN VN003-ERR (VN003-IDX)                               VNKCS005
272500              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             VNKCS005
272600     END-EVALUATE.                                                VNKCS005
272700                                                                  VNKCS005
272800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                VNKCS005
272900                                                                  VNKCS005
273000*----------------------------------------------------------------*VNKCS005
273100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *VNKCS005
273200*----------------------------------------------------------------*VNKCS005
273300                                                                  VNKCS005
273400 6111-WRITE-LIST-QUEUE.                                           VNKCS005
273500                                                                  VNKCS005
273600     EXEC CICS                                                    VNKCS005
273700         WRITEQ TS                                                VNKCS005
273800             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
273900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     VNKCS005
274000             ITEM  (PV-SAVE-ITEM)                                 VNKCS005
274100             REWRITE                                              VNKCS005
274200             RESP  (PV-CICS-RESP)                                 VNKCS005
274300     END-EXEC.                                                    VNKCS005
274400*                                                                 VNKCS005
274500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS005
274600         CONTINUE                                                 VNKCS005
274700     ELSE                                                         VNKCS005
274800         SET DP013-CICS-ABEND  TO  TRUE                           VNKCS005
274900         SET DP013-NO-ROLLBACK TO  TRUE                           VNKCS005
275000         MOVE '6111-WRITE-LIST-QUEUE'                             VNKCS005
275100                               TO  DP013-PARAGRAPH                VNKCS005
275200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  VNKCS005
275300                               TO  DP013-MESSAGE-TEXT(1)          VNKCS005
275400         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
275500     END-IF.                                                      VNKCS005
275600                                                                  VNKCS005
275700 EJECT                                                            VNKCS005
275800*----------------------------------------------------------------*VNKCS005
275900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*VNKCS005
276000*----------------------------------------------------------------*VNKCS005
276100                                                                  VNKCS005
276200 6112-READ-LIST-QUEUE.                                            VNKCS005
276300                                                                  VNKCS005
276400     EXEC CICS                                                    VNKCS005
276500         READQ TS                                                 VNKCS005
276600             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
276700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     VNKCS005
276800             ITEM  (PV-ITEM)                                      VNKCS005
276900             RESP  (PV-CICS-RESP)                                 VNKCS005
277000     END-EXEC.                                                    VNKCS005
277100*                                                                 VNKCS005
277200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS005
277300         CONTINUE                                                 VNKCS005
277400     ELSE                                                         VNKCS005
277500         SET DP013-CICS-ABEND        TO TRUE                      VNKCS005
277600         SET DP013-NO-ROLLBACK       TO TRUE                      VNKCS005
277700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           VNKCS005
277800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    VNKCS005
277900                                     TO DP013-MESSAGE-TEXT(1)     VNKCS005
278000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
278100     END-IF.                                                      VNKCS005
278200                                                                  VNKCS005
278300 EJECT                                                            VNKCS005
278400******************************************************************VNKCS005
278500* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *VNKCS005
278600******************************************************************VNKCS005
278700 6200-DEL-LIST-QUEUE.                                             VNKCS005
278800*                                                                 VNKCS005
278900     EXEC CICS                                                    VNKCS005
279000         DELETEQ TS                                               VNKCS005
279100             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS005
279200             RESP  (PV-CICS-RESP)                                 VNKCS005
279300     END-EXEC.                                                    VNKCS005
279400*                                                                 VNKCS005
279500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VNKCS005
279600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VNKCS005
279700         CONTINUE                                                 VNKCS005
279800     ELSE                                                         VNKCS005
279900        SET DP013-CICS-ABEND       TO TRUE                        VNKCS005
280000        SET DP013-NO-ROLLBACK      TO TRUE                        VNKCS005
280100        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             VNKCS005
280200        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               VNKCS005
280300                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
280400        PERFORM DP013-0000-PROCESS-ABEND                          VNKCS005
280500     END-IF.                                                      VNKCS005
280600 EJECT                                                            VNKCS005
280700******************************************************************VNKCS005
280800* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *VNKCS005
280900******************************************************************VNKCS005
281000 9100-READ-SEL-QUEUE.                                             VNKCS005
281100     EXEC CICS                                                    VNKCS005
281200         READQ TS                                                 VNKCS005
281300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        VNKCS005
281400             INTO  (VN003-VENDOR-SEL-REC)                         VNKCS005
281500             ITEM  (ASC-SEL-ITEM)                                 VNKCS005
281600             RESP  (PV-CICS-RESP)                                 VNKCS005
281700     END-EXEC.                                                    VNKCS005
281800                                                                  VNKCS005
281900     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        VNKCS005
282000         CONTINUE                                                 VNKCS005
282100     ELSE                                                         VNKCS005
282200         SET DP013-LOGIC-ABEND                                    VNKCS005
282300             DP013-NO-ROLLBACK     TO TRUE                        VNKCS005
282400         MOVE '9100-READ-SEL-QUEUE'                               VNKCS005
282500                                   TO DP013-PARAGRAPH             VNKCS005
282600         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    VNKCS005
282700                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
282800         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
282900     END-IF.                                                      VNKCS005
283000 EJECT                                                            VNKCS005
283100******************************************************************VNKCS005
283200* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *VNKCS005
283300******************************************************************VNKCS005
283400 9200-REWRITE-LIST-QUEUE.                                         VNKCS005
283500     EXEC CICS                                                    VNKCS005
283600          WRITEQ TS                                               VNKCS005
283700              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     VNKCS005
283800              FROM    (VN003-VENDOR-SEL-REC)                      VNKCS005
283900              ITEM    (ASC-SEL-ITEM)                              VNKCS005
284000              RESP    (PV-CICS-RESP)                              VNKCS005
284100              REWRITE                                             VNKCS005
284200     END-EXEC.                                                    VNKCS005
284300                                                                  VNKCS005
284400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    VNKCS005
284500         SET DP013-CICS-ABEND                                     VNKCS005
284600             DP013-NO-ROLLBACK     TO TRUE                        VNKCS005
284700         MOVE '9200-REWRITE-LIST-QUEUE'                           VNKCS005
284800                                   TO DP013-PARAGRAPH             VNKCS005
284900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   VNKCS005
285000                                   TO DP013-MESSAGE-TEXT (1)      VNKCS005
285100         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS005
285200     END-IF.                                                      VNKCS005
285210     EJECT                                                                
285300*----------------------------------------------------------------*VNKCS005
285400*    ABEND PROCESSOR MODULE                                      *VNKCS005
285500*----------------------------------------------------------------*VNKCS005
285600                                                                  VNKCS005
285800     COPY DPPD013.                                                VNKCS005
285900                                                                          
286000*                                                                         
286100*----------------------------------------------------------------*VNKCS005
