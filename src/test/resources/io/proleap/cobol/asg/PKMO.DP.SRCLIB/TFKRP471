      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.             TFKRP471.                                00050000
       AUTHOR.                 JACK KRAMER.                             00060000
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
       DATE-WRITTEN            MARCH 1997.                              00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      *    THIS PROGRAM PRODUCES A REPORT OF ASSUMPTIVE VERSUS POSITIVE 00120000
      *  RECEIPTS FOR A FISCAL PERIOD. IT BREAKS POSITIVE RECEIPTS BY   00130000
      *  HEADER RECEIPTS AND ITEM RECEIPTS; AND ALSO SHOWS VOIDED       00130169
      *  TRANSFERS. THE PERCENT OF TOTAL IS SHOWN FOR EACH CATEGORY.    00130200
      ******************************************************************00140000
100404** 10/04/2004 CHANGED BY: RAY GRAF                                        
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                        
      *****************************************************************         
                                                                        00150000
      ******************************************************************00160000
       ENVIRONMENT DIVISION.                                            00170000
      ******************************************************************00180000
                                                                        00190000
       CONFIGURATION SECTION.                                           00200000
                                                                        00210000
       SOURCE-COMPUTER.        IBM-3090.                                00220000
       OBJECT-COMPUTER.        IBM-3090.                                00230000
                                                                        00240000
       INPUT-OUTPUT SECTION.                                            00250000
                                                                        00260000
       FILE-CONTROL.                                                    00270000
                                                                        00280000
           SELECT TRANSFER-REPORT-FILE                                  00290000
               ASSIGN TO RPT01.                                         00300000
                                                                        00300100
           SELECT PROCESS-DATES-FILE                                    00300281
               ASSIGN TO INP01.                                         00300311
                                                                        00301691
           SELECT TRANSFER-RECEIPTS-FILE                                00301791
               ASSIGN TO INP02.                                         00302091
      *                                                                 00310000
      ******************************************************************00320000
       DATA DIVISION.                                                   00330000
      ******************************************************************00340000
                                                                        00350000
       FILE SECTION.                                                    00360000
                                                                        00370000
       FD  TRANSFER-REPORT-FILE                                         00380000
           LABEL RECORDS ARE STANDARD                                   00390000
           RECORDING MODE IS F                                          00400000
           BLOCK CONTAINS 0 RECORDS                                     00410000
           RECORD CONTAINS 132 CHARACTERS                               00420000
           DATA RECORD IS TRANSFER-REPORT-RECORD.                       00430000
                                                                        00440000
       01  TRANSFER-REPORT-RECORD PIC X(132).                           00450000
                                                                        00450100
       FD  PROCESS-DATES-FILE                                           00450281
           LABEL RECORDS ARE STANDARD                                   00450300
           RECORDING MODE IS F                                          00450400
           BLOCK CONTAINS 0 RECORDS                                     00450500
           RECORD CONTAINS 16 CHARACTERS.                               00450681
       01  PROCESS-DATES-RECORD            PIC X(16).                   00450781
                                                                        00410000
       FD  TRANSFER-RECEIPTS-FILE                                       00420000
           LABEL RECORDS ARE STANDARD                                   00430000
           RECORDING MODE IS F                                          00440000
           BLOCK CONTAINS 0 RECORDS                                     00450000
           RECORD CONTAINS 40 CHARACTERS                                00460001
           DATA RECORD IS TRANSFER-RECEIPTS-RECORD.                     00470000
                                                                        00480000
       01  TRANSFER-RECEIPTS-RECORD PIC X(40).                          00490001
      *                                                                 00460000
       WORKING-STORAGE SECTION.                                         00470000
                                                                        00480000
      *                                                                 00490000
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00500000
           COPY DPWS132O.                                               00510000
      *                                                                 00520000
      *----------------------------------------------------------------*00530000
      *  DATE VALIDATION CALLING PARAMETER LIST                        *00540000
      *----------------------------------------------------------------*00550000
           COPY DPWS500.                                                00560000
                                                                        00561100
      *                                                                 00561200
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00561381
      *                                                                 00561400
           COPY TFRD029.                                                00562081
                                                                        00561100
      *                                                                 00561200
      *  RECORD LAYOUT FOR THE RECEIPTS FILE                            00561381
      *                                                                 00561400
           COPY TFRD039.                                                00562081
           EJECT                                                        00570000
      *                                                                 00580000
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          00590000
                                       COMP SYNC.                       00600000
                                                                        00610000
       01  PS-PROGRAM-SWITCHES.                                         00620000
           05  PS-DIST-TOTAL-SW        PIC X(01)    VALUE 'N'.          00630000
               88  PS-DIST-TOTAL-REQUIRED           VALUE 'Y'.          00640000
               88  PS-DIST-TOTAL-NOT-REQUIRED       VALUE 'N'.          00650000
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          00660000
               88  PS-FIRST-TIME                    VALUE 'Y'.          00670000
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          00680000
           05  PS-ITEMS-READ-SW        PIC  X(01)   VALUE 'N'.          00690000
               88  PS-ITEMS-READ                    VALUE 'Y'.          00700000
               88  PS-NO-ITEMS-READ                 VALUE 'N'.          00710000
           05  PS-MORE-DATA-SW         PIC  X(01)   VALUE 'Y'.          00720000
               88  PS-MORE-DATA                     VALUE 'Y'.          00730000
               88  PS-NO-MORE-DATA                  VALUE 'N'.          00740000
                                                                        00780000
       01  PC-PROGRAM-CONSTANTS.                                        00790000
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'TFKRP471'.   00800000
           05  PC-CALENDAR-PGM           PIC  X(08)  VALUE  'DPKUT500'. 00810000
           05  PC-DISTRICT-LITERAL       PIC  X(14)  VALUE              00820000
                                         'DISTRICT TOTAL'.              00821069
           05  PC-COMPANY-LITERAL        PIC  X(14)  VALUE              00830000
                                         'COMPANY TOTAL'.               00830169
           05  PC-DIST-COMP-LITERAL      PIC  X(14)  VALUE              00830200
                                         'DISTRICT COMP '.              00830369
           05  PC-COMP-COMP-LITERAL      PIC  X(14)  VALUE              00830400
                                         'COMPANY COMP '.               00830569
           05  PC-ASSUMPTIVE             PIC  X(02)  VALUE  'AR'.       00840000
           05  PC-POSITIVE               PIC  X(02)  VALUE  'PR'.       00850069
           05  PC-VOIDED                 PIC  X(02)  VALUE  'VD'.       00851071
           05  PC-YES                    PIC  X(01)  VALUE  'Y'.        00852071
           05  PC-NO                     PIC  X(01)  VALUE  'N'.        00853071
           05  PC-PAGE-MAX               PIC  S9(03) VALUE  +60.        00860000
           05  PC-1-DAY                  PIC  S9(03) VALUE  +1  COMP-3. 00870000
           05  PC-365-DAYS               PIC  S9(03) VALUE +365 COMP-3. 00871004
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00880000
                                                           COMP-3.      00890000
                                                                        00900000
       01  PV-PROGRAM-VARIABLES.                                        00910000
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          00920000
                                       COMP SYNC.                       00930000
           05  PV-PAGE-COUNT           PIC 9(5)    VALUE ZERO.          00940000
           05  PV-ITEMS-READ           PIC 9(8)    VALUE ZERO.          00950000
           05  PV-YEAR-DIFFERENCE      PIC S9(04)  COMP VALUE +0.       01000004
           05  PV-NULL-IND             PIC S9(04)  COMP.                01001004
           05  PV-LINE-COUNT           PIC S9(4)   VALUE ZERO.          01030000
           05  PV-BYP-DTL-CK                   PIC X(01)   VALUE SPACE. 01031071
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 01040000
           05  PV-DB2-OPERATION                PIC X(30)   VALUE SPACE. 01050000
           05  PV-FISCAL-MONTH                 PIC 9(02).               01051001
           05  PV-LY-FISCAL-MONTH              PIC 9(02).               01051101
           05  PV-FISCAL-CCYY                  PIC 9(04).               01051201
           05  FILLER REDEFINES PV-FISCAL-CCYY.                         01051301
               10  PV-FISCAL-CENTURY           PIC 9(02).               01051401
               10  PV-FISCAL-YEAR              PIC 9(02).               01052001
           05  PV-LY-FISCAL-CCYY               PIC 9(04).               01052104
           05  FILLER REDEFINES PV-LY-FISCAL-CCYY.                      01053001
               10  PV-LY-FISCAL-CENTURY        PIC 9(02).               01054001
               10  PV-LY-FISCAL-YEAR           PIC 9(02).               01055001
           05  PV-BEG-POS-TIMESTAMP.                                    01055101
               10  PV-BEG-POS-DATE.                                     01055284
                   15  PV-BEG-POS-CC   PIC 9(02).                       01055390
                   15  PV-BEG-POS-YY   PIC 9(02).                       01055490
                   15  FILLER          PIC X(01)      VALUE '-'.        01055590
                   15  PV-BEG-POS-MM   PIC 9(02).                       01055690
                   15  FILLER          PIC X(01)      VALUE '-'.        01055790
                   15  PV-BEG-POS-DD   PIC 9(02).                       01055890
               10                      PIC X(16) VALUE                  01055901
                                       '-00.00.00.000000'.              01056069
           05  PV-BEG-POS-TMST REDEFINES                                01056101
                               PV-BEG-POS-TIMESTAMP  PIC X(26).         01056201
           05  PV-END-POS-TIMESTAMP.                                    01056301
               10  PV-END-POS-DATE.                                     01056484
                   15  PV-END-POS-CC   PIC 9(02).                       01056585
                   15  PV-END-POS-YY   PIC 9(02).                       01056685
                   15  FILLER          PIC X(01)      VALUE '-'.        01056785
                   15  PV-END-POS-MM   PIC 9(02).                       01056885
                   15  FILLER          PIC X(01)      VALUE '-'.        01056985
                   15  PV-END-POS-DD   PIC 9(02).                       01057085
               10                      PIC X(16) VALUE                  01057201
                                       '-23.59.59.999999'.              01057369
           05  PV-END-POS-TMST REDEFINES                                01057401
                               PV-END-POS-TIMESTAMP  PIC X(26).         01057501
           05  PV-BEG-ASM-TIMESTAMP.                                    01057601
               10  PV-BEG-ASM-DATE     PIC X(10).                       01057701
               10                      PIC X(16) VALUE                  01057801
                                       '-00.00.00.000000'.              01057969
           05  PV-BEG-ASM-TMST REDEFINES                                01058001
                               PV-BEG-ASM-TIMESTAMP  PIC X(26).         01058101
           05  PV-END-ASM-TIMESTAMP.                                    01058201
               10  PV-END-ASM-DATE     PIC X(10).                       01058301
               10                      PIC X(16) VALUE                  01058401
                                       '-23.59.59.999999'.              01058569
           05  PV-END-ASM-TMST REDEFINES                                01058601
                               PV-END-ASM-TIMESTAMP  PIC X(26).         01058701
           05  PV-DATE.                                                 01058890
               10  PV-MONTH            PIC 9(02).                       01058934
               10  FILLER              PIC X(01)   VALUE '/'.           01059034
               10  PV-DAY              PIC 9(02).                       01059134
               10  FILLER              PIC X(01)   VALUE '/'.           01059234
               10  PV-CENTURY          PIC 9(02).                       01059334
               10  PV-YEAR             PIC 9(02).                       01059434
           05  PV-POS-HDR              PIC S9(08)    VALUE ZERO COMP-3. 01101470
           05  PV-POS-ITM              PIC S9(08)    VALUE ZERO COMP-3. 01101570
           05  PV-ASM                  PIC S9(08)    VALUE ZERO COMP-3. 01101670
           05  PV-VOID                 PIC S9(08)    VALUE ZERO COMP-3. 01101770
           05  PV-POS-HDR-DS           PIC S9(08)    VALUE ZERO COMP-3. 01102070
           05  PV-POS-ITM-DS           PIC S9(08)    VALUE ZERO COMP-3. 01102170
           05  PV-ASM-DS               PIC S9(08)    VALUE ZERO COMP-3. 01102270
           05  PV-VOID-DS              PIC S9(08)    VALUE ZERO COMP-3. 01102370
           05  PV-POS-HDR-CO           PIC S9(08)    VALUE ZERO COMP-3. 01102670
           05  PV-POS-ITM-CO           PIC S9(08)    VALUE ZERO COMP-3. 01102770
           05  PV-ASM-CO               PIC S9(08)    VALUE ZERO COMP-3. 01102870
           05  PV-VOID-CO              PIC S9(08)    VALUE ZERO COMP-3. 01102970
           05  PV-TOTAL                PIC S9(08)    VALUE ZERO COMP-3. 01103072
           05  PV-VARIANCE            PIC S9(05)V999 VALUE ZERO COMP-3. 01104072
       01  HV-HOLD-VARIABLES.                                           01410000
100404*    05  HV-STORE-NBR            PIC 9(03)    VALUE ZEROES.       01420000
100404     05  HV-STORE-NBR            PIC 9(05)    VALUE ZEROES.       01420000
           05  HV-STORE-NAME           PIC X(10)    VALUE SPACES.       01420000
                                                                        01540000
       01  BLANK-LINE                  PIC X(132)   VALUE SPACES.       01660000
                                                                        01670000
       01  END-OF-REPORT-LINE.                                          01680000
           05  FILLER                  PIC X(52)    VALUE SPACES.       01690000
           05  FILLER                  PIC X(26)    VALUE               01700000
               '   *** END OF REPORT ***'.                              01710000
           05  FILLER                  PIC X(54)    VALUE SPACES.       01720000
                                                                        01730000
       01  NO-DATA-LINE.                                                01740000
           05  FILLER                  PIC X(35)    VALUE SPACES.       01750000
           05  FILLER                  PIC X(45)    VALUE               01760000
               '****  NO DATA TO PROCESS FOR THIS REPORT  ***'.         01770000
                                                                        01780000
       01  CD-CURRENT-DATE.                                             01790000
           05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         01800000
           05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         01810000
           05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         01820000
                                                                        01830000
       01  CT-CURRENT-TIME.                                             01840000
           05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         01850000
           05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         01860000
           05  FILLER                  PIC 9(4)     VALUE ZERO.         01870000
                                                                        01880000
       01  HL2-HEADING-LINE-2.                                          01890000
           05  FILLER                  PIC X(49)    VALUE SPACES.       01900000
           05  FILLER                  PIC X(35)    VALUE               01930000
               'ASSUMPTIVE VERSUS POSITIVE RECEIPTS'.                   01940000
           05  FILLER                  PIC X(52)    VALUE SPACES.       01950000
                                                                        01960000
       01  HL3-HEADING-LINE-3.                                          01970000
           05  FILLER                  PIC X(49)  VALUE SPACE.          01980069
           05  FILLER                  PIC X(11)    VALUE               01990069
               'FOR PERIOD'.                                            02000069
           05  HL3-FROM-DATE           PIC X(10)  VALUE SPACES.         02010069
           05  FILLER                  PIC X(04)  VALUE ' TO '.         02020069
           05  HL3-TO-DATE             PIC X(10)  VALUE SPACES.         02030069
                                                                        02040000
       01  HL4-HEADING-LINE-4.                                          02050000
           05  FILLER                  PIC X(10)  VALUE 'DISTRICT:'.    02060000
           05  HL4-DISTRICT            PIC X(4)   VALUE SPACE.          02070000
                                                                        02100000
       01  HL5-HEADING-LINE-5.                                          02110000
           05  FILLER                  PIC X(40)  VALUE SPACE.          02120069
           05  FILLER                  PIC X(25)  VALUE 'TOTAL'.        02140075
           05  FILLER                  PIC X(24)  VALUE 'TOTAL'.        02140169
       01  HL6-HEADING-LINE-6.                                          02140269
           05  FILLER                  PIC X(38)  VALUE SPACE.          02140374
           05  FILLER                  PIC X(25)  VALUE 'POSITIVE    %'.02140475
           05  FILLER                  PIC X(26)  VALUE 'POSITIVE    %'.02140577
           05  FILLER                  PIC X(36)  VALUE 'TOTAL      %'. 02140678
           05  FILLER                  PIC X(01)  VALUE '%'.            02140778
       01  HL7-HEADING-LINE-7.                                          02140876
           05  FILLER                  PIC X(24)  VALUE SPACE.          02140976
           05  FILLER                  PIC X(16)  VALUE 'TOTAL'.        02141076
           05  FILLER                  PIC X(24)  VALUE 'ITEM      OF'. 02141177
           05  FILLER                  PIC X(23)  VALUE 'HEADER     OF'.02141277
           05  FILLER                  PIC X(13)  VALUE 'ASSUMPTIVE'.   02141376
           05  FILLER                  PIC X(16)  VALUE 'OF'.           02141477
           05  FILLER                  PIC X(24)  VALUE 'TOTAL    OF'.  02141576
       01  HL8-HEADING-LINE-8.                                          02141676
           05  FILLER                  PIC X(22)  VALUE SPACE.          02141776
           05  FILLER                  PIC X(16)  VALUE 'TRANSFERS'.    02141876
           05  FILLER                  PIC X(11)  VALUE 'RECEIPTS'.     02141976
           05  FILLER                  PIC X(14)  VALUE 'TOTAL'.        02142076
           05  FILLER                  PIC X(11)  VALUE 'RECEIPTS'.     02142176
           05  FILLER                  PIC X(14)  VALUE 'TOTAL'.        02142276
           05  FILLER                  PIC X(11)  VALUE 'RECEIPTS'.     02142376
           05  FILLER                  PIC X(17)  VALUE 'TOTAL'.        02142477
           05  FILLER                  PIC X(08)  VALUE 'VOIDS'.        02142578
           05  FILLER                  PIC X(10)  VALUE 'TOTAL'.        02142676
                                                                        02270000
       01  DL1-DETAIL-LINE-1.                                           02430000
           05  DL1-LITERAL.                                             02440000
100404*        10  DL1-STR-NBR             PIC 9(03).                   02450000
100404         10  DL1-STR-NBR             PIC 9(04).                   02450000
               10  FILLER                  PIC X(01)  VALUE SPACES.     02460000
               10  DL1-STR-NAME            PIC X(10).                   02470000
100404*    05  FILLER                  PIC X(09)  VALUE SPACES.         02480073
100404     05  FILLER                  PIC X(08)  VALUE SPACES.         02480073
           05  DL1-TOTAL               PIC ZZZZZ9.                      02490069
           05  FILLER                  PIC X(10)  VALUE SPACE.          02520074
           05  DL1-POS-ITM             PIC ZZZZZZ.                      02531278
           05  FILLER                  PIC X(03)  VALUE SPACES.         02532069
           05  DL1-POS-ITM-PCT         PIC ZZZ9.9.                      02533070
           05  FILLER                  PIC X(10)  VALUE SPACE.          02536074
           05  DL1-POS-HDR             PIC ZZZZZZ.                      02536178
           05  FILLER                  PIC X(03)  VALUE SPACES.         02536269
           05  DL1-POS-HDR-PCT         PIC ZZZ9.9.                      02536369
           05  FILLER                  PIC X(10)  VALUE SPACE.          02536474
           05  DL1-ASM                 PIC ZZZZZZ.                      02539178
           05  FILLER                  PIC X(03)  VALUE SPACES.         02539773
           05  DL1-ASM-PCT             PIC ZZZ9.9.                      02539869
           05  FILLER                  PIC X(10)  VALUE SPACE.          02539974
           05  DL1-VOID                PIC ZZZZZZ.                      02540078
           05  FILLER                  PIC X(03)  VALUE SPACES.         02540175
           05  DL1-VOID-PCT            PIC ZZZ9.9.                      02540269
      *---------------------------------------------------------------*         
100404*    DB2 AREA FOR XST_LOC TABLE                                 *         
      *---------------------------------------------------------------*         
           EXEC SQL                                                             
100404          INCLUDE XST00001                                                
           END-EXEC.                                                            
                                                                        02820000
           EXEC SQL                                                     02830000
               INCLUDE SQLCA                                            02840000
           END-EXEC.                                                    02850000
      *                                                                 02860000
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           02870000
      *  SQL CODES FOR DISPLAY                                          02880000
      *                                                                 02890000
           COPY SQLCA2.                                                 02900000
                                                                        03610000
      ******************************************************************03620000
       PROCEDURE DIVISION.                                              03630000
      ******************************************************************03640000
       0000-MAINLINE.                                                   03650000
           PERFORM 1000-INITIALIZE.                                     03660000
           PERFORM 2000-PROCESS-RECEIPT-FILE.                           03675469
                                                                        03790000
           IF PS-FIRST-TIME                                             03800009
               PERFORM 9000-PRINT-HEADINGS                              03810009
               WRITE TRANSFER-REPORT-RECORD                             03820009
                   FROM NO-DATA-LINE                                    03830009
                   AFTER ADVANCING 2                                    03840009
           ELSE                                                         05360035
               PERFORM 8000-GRAND-TOTAL                                 05390035
           END-IF.                                                      05390169
                                                                        05390200
           WRITE TRANSFER-REPORT-RECORD                                 05390309
               FROM END-OF-REPORT-LINE                                  05390409
               AFTER ADVANCING 2.                                       05390509
           CLOSE TRANSFER-REPORT-FILE                                   05390601
                 PROCESS-DATES-FILE                                     05390781
                 TRANSFER-RECEIPTS-FILE.                                05390781
           STOP RUN.                                                    05390800
                                                                        05390900
      ******************************************************************05391000
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES/ CURSOR     05391100
      *  FILLING THE FIELDS OF THE STANDARD REPORT HEADER,              05391200
      *  READING FIRST RECORD, PRINT HEADINGS.                          05391300
      ******************************************************************05391400
                                                                        05391500
       1000-INITIALIZE.                                                 05391600
           OPEN OUTPUT TRANSFER-REPORT-FILE                             05391700
                INPUT  PROCESS-DATES-FILE                               05391881
                       TRANSFER-RECEIPTS-FILE.                          05391881
           ACCEPT CD-CURRENT-DATE FROM DATE.                            05391900
           MOVE CD-CURRENT-YEAR TO DP132O-RUN-YEAR.                     05392001
           MOVE CD-CURRENT-MONTH TO DP132O-RUN-MONTH.                   05392101
           MOVE CD-CURRENT-DAY TO DP132O-RUN-DAY.                       05392201
           MOVE 100 TO PV-LINE-COUNT.                                   05392300
                                                                        05392400
           ACCEPT CT-CURRENT-TIME FROM TIME.                            05392500
           MOVE CT-CURRENT-HOUR TO DP132O-RUN-HOUR.                     05392600
           MOVE CT-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 05392700
           MOVE PC-PROGRAM-NAME TO DP132O-PROGRAM-NAME.                 05392800
           MOVE 1 TO DP132O-REPORT-NUMBER.                              05392900
           PERFORM 7000-READ-PROCESS-DATES-FILE.                        05393081
           DISPLAY 'TF029-PROCESS-DATES-RECORD = '                      05393181
               TF029-PROCESS-DATES-RECORD.                              05393281
           MOVE TF029-PROCESS-START-MONTH    TO PV-BEG-POS-MM           05393383
                                                PV-MONTH.               05396686
           MOVE TF029-PROCESS-START-DAY      TO PV-BEG-POS-DD           05396790
                                                PV-DAY.                 05396886
           MOVE TF029-PROCESS-START-CENTURY  TO PV-BEG-POS-CC           05396983
                                                PV-CENTURY.             05397086
           MOVE TF029-PROCESS-START-YEAR     TO PV-BEG-POS-YY           05397183
                                                PV-YEAR.                05397286
           MOVE PV-DATE                      TO HL3-FROM-DATE.          05397386
           MOVE TF029-PROCESS-END-MONTH      TO PV-END-POS-MM           05397483
                                                PV-MONTH.               05397586
           MOVE TF029-PROCESS-END-DAY        TO PV-END-POS-DD           05397683
                                                PV-DAY.                 05397786
           MOVE TF029-PROCESS-END-CENTURY    TO PV-END-POS-CC           05397883
                                                PV-CENTURY.             05397986
           MOVE TF029-PROCESS-END-YEAR       TO PV-END-POS-YY           05398083
                                                PV-YEAR.                05398186
           MOVE PV-DATE                      TO HL3-TO-DATE.            05398286
      ******************************************************************05220035
      * CONTROL THE PROCESSING OF THE RECEIPTS FILE                     05230035
      ******************************************************************05240035
       2000-PROCESS-RECEIPT-FILE.                                       05250035
           PERFORM                                                      05260035
               UNTIL (PS-NO-MORE-DATA)                                  05270035
                                                                        05280035
               PERFORM 2100-READ-RECEIPT-FILE                           05290035
                                                                        05300035
               IF  PS-MORE-DATA                                         05310035
                   PERFORM 3000-PROCESS-DATA                            05330035
               END-IF                                                   05340030
           END-PERFORM.                                                 05350035
           IF PS-DIST-TOTAL-REQUIRED                                    05360035
               PERFORM 6000-NEW-DISTRICT                                        
           END-IF.                                                      05400035
       EJECT                                                            05410035
      *----------------------------------------------------------------*03250105
      *  READ THE TRANSFER RECEIPT FILE.                                03250205
      *----------------------------------------------------------------*03250305
       2100-READ-RECEIPT-FILE.                                          01880203
           READ TRANSFER-RECEIPTS-FILE                                  03250505
             INTO TF039-XFER-RECEIPTS-RECORD                            03250605
               AT END                                                           
                 SET PS-NO-MORE-DATA      TO TRUE                               
           END-READ.                                                    03251005
      ******************************************************************06560035
      * PROCESS THE REPORT DATA                                         06570035
      ******************************************************************06580035
       3000-PROCESS-DATA.                                               06590035
           IF PS-FIRST-TIME                                                     
               SET PS-NOT-FIRST-TIME     TO TRUE                                
               MOVE TF039-RECV-STR-NBR    TO HV-STORE-NBR                       
               MOVE TF039-DISTRICT-NMBR-X TO HL4-DISTRICT                       
               PERFORM 5000-NEW-STORE                                   06710035
           END-IF.                                                              
           IF TF039-DISTRICT-NMBR-X NOT = HL4-DISTRICT                          
               PERFORM 6000-NEW-DISTRICT                                38820069
           END-IF.                                                      38830069
           IF TF039-RECV-STR-NBR       NOT = HV-STORE-NBR               06700035
               PERFORM 5100-PRINT-LINE                                  06890001
               PERFORM 5000-NEW-STORE                                   06710035
           END-IF.                                                      06720035
           EVALUATE TRUE                                                        
               WHEN TF039-AR                                                    
                   ADD TF039-XFER-COUNT       TO PV-ASM                 07350001
               WHEN TF039-PR-AND-NO-DTL-CHK                                     
                   ADD TF039-XFER-COUNT       TO PV-POS-HDR             07350001
               WHEN TF039-PR-AND-DTL-CHK                                        
                   ADD TF039-XFER-COUNT       TO PV-POS-ITM             07350001
               WHEN TF039-VOID                                                  
                   ADD TF039-XFER-COUNT       TO PV-VOID                07350001
           END-EVALUATE.                                                        
           SET PS-DIST-TOTAL-REQUIRED        TO TRUE.                   38840069
      ******************************************************************06840035
      *  RECEIVE STORE NUMBER BREAK.                                    06850035
      ******************************************************************06860035
       5000-NEW-STORE.                                                  06870035
           MOVE TF039-RECV-STR-NBR       TO HV-STORE-NBR                07080035
100404                                      XST00001-LOC-NBR.           07090035
           PERFORM 5200-READ-STORE.                                             
100404     MOVE XST00001-LOC-10-ABBR-NM  TO HV-STORE-NAME.                      
      *----------------------------------------------------------------*38808369
      *  PRINT A DETAIL LINE FOR A STORE WITH REPORTABLE ACTIVITY.     *38808469
      *----------------------------------------------------------------*38808569
       5100-PRINT-LINE.                                                 38809069
           MOVE SPACES                       TO DL1-DETAIL-LINE-1.      38850069
           MOVE HV-STORE-NBR                 TO DL1-STR-NBR.            38860069
           MOVE HV-STORE-NAME                TO DL1-STR-NAME.           38870069
           ADD PV-POS-HDR PV-POS-ITM PV-ASM PV-VOID GIVING PV-TOTAL.    38880070
           MOVE PV-TOTAL                     TO DL1-TOTAL.              38890070
           MOVE PV-POS-ITM                   TO DL1-POS-ITM.            38910070
           IF PV-POS-ITM > 0 AND PV-TOTAL > 0                           38920070
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-ITM / PV-TOTAL      38930070
               MULTIPLY 100 BY PV-VARIANCE                              38950069
               MOVE PV-VARIANCE              TO DL1-POS-ITM-PCT         38960070
           END-IF.                                                      38970069
           MOVE PV-POS-HDR                   TO DL1-POS-HDR.            38971070
           IF PV-POS-HDR > 0 AND PV-TOTAL > 0                           38972070
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-HDR / PV-TOTAL      38973070
               MULTIPLY 100 BY PV-VARIANCE                              38974070
               MOVE PV-VARIANCE              TO DL1-POS-HDR-PCT         38975070
           END-IF.                                                      38976070
           MOVE PV-ASM                       TO DL1-ASM.                38976170
           IF PV-ASM > 0 AND PV-TOTAL > 0                               38976270
               COMPUTE PV-VARIANCE ROUNDED = PV-ASM / PV-TOTAL          38976370
               MULTIPLY 100 BY PV-VARIANCE                              38976470
               MOVE PV-VARIANCE              TO DL1-ASM-PCT             38976570
           END-IF.                                                      38976670
           MOVE PV-VOID                      TO DL1-VOID.               38977070
           IF PV-VOID > 0 AND PV-TOTAL > 0                              38978070
               COMPUTE PV-VARIANCE ROUNDED = PV-VOID / PV-TOTAL         38979070
               MULTIPLY 100 BY PV-VARIANCE                              38979170
               MOVE PV-VARIANCE              TO DL1-VOID-PCT            38979270
           END-IF.                                                      38979370
           IF PV-LINE-COUNT > PC-PAGE-MAX                               39680261
               PERFORM 9000-PRINT-HEADINGS                              39680361
           END-IF.                                                      39680461
           WRITE TRANSFER-REPORT-RECORD                                 39680561
               FROM DL1-DETAIL-LINE-1                                   39680661
               AFTER ADVANCING 1.                                       39680761
           ADD +1                           TO PV-LINE-COUNT.           39680869
           ADD  PV-POS-HDR                  TO PV-POS-HDR-DS.           39680970
           ADD  PV-POS-ITM                  TO PV-POS-ITM-DS.           39681070
           ADD  PV-ASM                      TO PV-ASM-DS.               39682070
           ADD  PV-VOID                     TO PV-VOID-DS.              39682170
           MOVE ZEROES                      TO PV-POS-HDR               39680970
                                               PV-POS-ITM               39681070
                                               PV-ASM                   39682070
                                               PV-VOID.                 39682170
      *----------------------------------------------------------------*        
      *    GET THE STORE NAME.                                                  
      *----------------------------------------------------------------*        
       5200-READ-STORE.                                                         
           PERFORM WITH TEST AFTER                                              
               VARYING PV-RETRY-COUNT FROM 1 BY 1                               
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                          
                    OR SQLCODE = ZERO                                           
                    OR SQLCODE = +100                                           
               EXEC SQL                                                         
100404             SELECT LOC_10_ABBR_NM                                        
100404                 INTO :XST00001-LOC-10-ABBR-NM                            
100404                 FROM XST_LOC                                             
100404                 WHERE LOC_NBR = :XST00001-LOC-NBR                        
100404                 WITH UR                                                  
               END-EXEC                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = +100                                          
100404                 MOVE 'INVALID'     TO XST00001-LOC-10-ABBR-NM            
                   WHEN OTHER                                                   
                       MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME          
                       MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION          
                       PERFORM 9100-SQL-ERROR                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                                   
               MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME                  
               MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION                  
               PERFORM 9100-SQL-ERROR                                           
           END-IF.                                                              
      *----------------------------------------------------------------*39682200
      *  PRINT THE DISTRICT TOTAL LINE.                                *39682302
      *----------------------------------------------------------------*39682469
       6000-NEW-DISTRICT.                                               39682500
           PERFORM 5100-PRINT-LINE.                                     06890001
           PERFORM 5000-NEW-STORE.                                      06710035
           SET PS-DIST-TOTAL-NOT-REQUIRED    TO TRUE.                   39682669
           MOVE SPACES                       TO DL1-DETAIL-LINE-1.      39682769
           MOVE PC-DISTRICT-LITERAL          TO DL1-LITERAL.            39682870
           ADD PV-POS-HDR-DS PV-POS-ITM-DS PV-ASM-DS PV-VOID-DS         39682970
                                         GIVING PV-TOTAL.               39683070
           MOVE PV-TOTAL                     TO DL1-TOTAL.              39683170
           MOVE PV-POS-ITM-DS                TO DL1-POS-ITM.            39683270
           IF PV-POS-ITM-DS > 0 AND PV-TOTAL > 0                        39683370
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-ITM-DS / PV-TOTAL   39683470
               MULTIPLY 100 BY PV-VARIANCE                              39683570
               MOVE PV-VARIANCE              TO DL1-POS-ITM-PCT         39683670
           END-IF.                                                      39683770
           MOVE PV-POS-HDR-DS                TO DL1-POS-HDR.            39683870
           IF PV-POS-HDR-DS > 0 AND PV-TOTAL > 0                        39683970
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-HDR-DS / PV-TOTAL   39684070
               MULTIPLY 100 BY PV-VARIANCE                              39684170
               MOVE PV-VARIANCE              TO DL1-POS-HDR-PCT         39684270
           END-IF.                                                      39684370
           MOVE PV-ASM-DS                    TO DL1-ASM.                39684470
           IF PV-ASM-DS > 0 AND PV-TOTAL > 0                            39684570
               COMPUTE PV-VARIANCE ROUNDED = PV-ASM-DS / PV-TOTAL       39684670
               MULTIPLY 100 BY PV-VARIANCE                              39684770
               MOVE PV-VARIANCE              TO DL1-ASM-PCT             39684870
           END-IF.                                                      39684970
           MOVE PV-VOID-DS                   TO DL1-VOID.               39685070
           IF PV-VOID-DS > 0 AND PV-TOTAL > 0                           39685170
               COMPUTE PV-VARIANCE ROUNDED = PV-VOID-DS / PV-TOTAL      39685270
               MULTIPLY 100 BY PV-VARIANCE                              39685370
               MOVE PV-VARIANCE              TO DL1-VOID-PCT            39685470
           END-IF.                                                      39685570
           WRITE TRANSFER-REPORT-RECORD                                 41020261
               FROM DL1-DETAIL-LINE-1                                   41020361
               AFTER ADVANCING 2.                                       41020461
           MOVE +90                          TO PV-LINE-COUNT.          41020569
           MOVE TF039-DISTRICT-NMBR-X        TO HL4-DISTRICT.           41020669
           ADD  PV-POS-HDR-DS                TO PV-POS-HDR-CO.                  
           ADD  PV-POS-ITM-DS                TO PV-POS-ITM-CO.                  
           ADD  PV-ASM-DS                    TO PV-ASM-CO.                      
           ADD  PV-VOID-DS                   TO PV-VOID-CO.                     
           MOVE ZEROES                       TO PV-POS-HDR-DS                   
                                                PV-POS-ITM-DS                   
                                                PV-ASM-DS                       
                                                PV-VOID-DS.                     
      *----------------------------------------------------------------*41060200
      *  READ THE SCHEDULE DATE CONTROL CARD.                          *41060302
      *----------------------------------------------------------------*41060469
       7000-READ-PROCESS-DATES-FILE.                                    41060581
           READ PROCESS-DATES-FILE                                      41060681
               INTO TF029-PROCESS-DATES-RECORD                          41060781
           END-READ.                                                    41060800
      *----------------------------------------------------------------*41060900
      *  PRINT THE COMPANY TOTAL LINE.                                 *41061002
      *----------------------------------------------------------------*41061169
       8000-GRAND-TOTAL.                                                41061200
           MOVE SPACES                       TO DL1-DETAIL-LINE-1       41700569
                                                HL4-HEADING-LINE-4.     41700569
           PERFORM 9000-PRINT-HEADINGS.                                 39680361
           MOVE PC-COMPANY-LITERAL           TO DL1-LITERAL.            41700669
           ADD PV-POS-HDR-CO PV-POS-ITM-CO PV-ASM-CO PV-VOID-CO         41700770
                                         GIVING PV-TOTAL.               41700870
           MOVE PV-TOTAL                     TO DL1-TOTAL.              41700970
           MOVE PV-POS-ITM-CO                TO DL1-POS-ITM.            41701070
           IF PV-POS-ITM-CO > 0 AND PV-TOTAL > 0                        41702070
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-ITM-CO / PV-TOTAL   41703070
               MULTIPLY 100 BY PV-VARIANCE                              41704070
               MOVE PV-VARIANCE              TO DL1-POS-ITM-PCT         41705070
           END-IF.                                                      41706070
           MOVE PV-POS-HDR-CO                TO DL1-POS-HDR.            41707070
           IF PV-POS-HDR-CO > 0 AND PV-TOTAL > 0                        41708070
               COMPUTE PV-VARIANCE ROUNDED = PV-POS-HDR-CO / PV-TOTAL   41709070
               MULTIPLY 100 BY PV-VARIANCE                              41710070
               MOVE PV-VARIANCE              TO DL1-POS-HDR-PCT         41720070
           END-IF.                                                      41730070
           MOVE PV-ASM-CO                    TO DL1-ASM.                41740070
           IF PV-ASM-CO > 0 AND PV-TOTAL > 0                            41750070
               COMPUTE PV-VARIANCE ROUNDED = PV-ASM-CO / PV-TOTAL       41760070
               MULTIPLY 100 BY PV-VARIANCE                              41770070
               MOVE PV-VARIANCE              TO DL1-ASM-PCT             41780070
           END-IF.                                                      41790070
           MOVE PV-VOID-CO                   TO DL1-VOID.               41800070
           IF PV-VOID-CO > 0 AND PV-TOTAL > 0                           41810070
               COMPUTE PV-VARIANCE ROUNDED = PV-VOID-CO / PV-TOTAL      41820070
               MULTIPLY 100 BY PV-VARIANCE                              41830070
               MOVE PV-VARIANCE              TO DL1-VOID-PCT            41840070
           END-IF.                                                      41850070
           WRITE TRANSFER-REPORT-RECORD                                 42350261
               FROM DL1-DETAIL-LINE-1                                   42350361
               AFTER ADVANCING 3.                                       42350476
      ******************************************************************42350500
      *  PRINT REPORT HEADINGS                                          42350600
      ******************************************************************42350700
                                                                        42350800
       9000-PRINT-HEADINGS.                                             42350900
           ADD 1 TO PV-PAGE-COUNT.                                      42351000
           MOVE 8             TO PV-LINE-COUNT.                         42351100
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    42351200
           WRITE TRANSFER-REPORT-RECORD                                 42351300
               FROM DP132O-STANDRD-HEADER-132-COLS                      42351400
               AFTER ADVANCING PAGE.                                    42351500
           WRITE TRANSFER-REPORT-RECORD                                 42351600
               FROM HL2-HEADING-LINE-2                                  42351700
               AFTER ADVANCING 1.                                       42351800
           WRITE TRANSFER-REPORT-RECORD                                 42351900
               FROM HL3-HEADING-LINE-3                                  42352000
               AFTER ADVANCING 1.                                       42352100
           WRITE TRANSFER-REPORT-RECORD                                 42352200
               FROM HL4-HEADING-LINE-4                                  42352300
               AFTER ADVANCING 1.                                       42352400
           WRITE TRANSFER-REPORT-RECORD                                 42352500
               FROM HL5-HEADING-LINE-5                                  42352600
               AFTER ADVANCING 1.                                       42352700
           WRITE TRANSFER-REPORT-RECORD                                 42352800
               FROM HL6-HEADING-LINE-6                                  42352900
               AFTER ADVANCING 1.                                       42353000
           WRITE TRANSFER-REPORT-RECORD                                 42353100
               FROM HL7-HEADING-LINE-7                                  42353200
               AFTER ADVANCING 1.                                       42353300
           WRITE TRANSFER-REPORT-RECORD                                 42353473
               FROM HL8-HEADING-LINE-8                                  42353573
               AFTER ADVANCING 1.                                       42353673
           WRITE TRANSFER-REPORT-RECORD                                 42353700
               FROM BLANK-LINE                                          42353800
               AFTER ADVANCING 1.                                       42353900
      ******************************************************************42354000
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *42354100
      *  PROGRAM.                                                      *42354200
      ******************************************************************42354300
       9100-SQL-ERROR.                                                  42354400
           MOVE SQLCODE TO SQLCODE2.                                    42354500
           MOVE SQLERRD(3) TO SQLERRD3.                                 42354600
           DISPLAY '** ABEND **'.                                       42354700
           DISPLAY 'TFKRP471 - SQL ERROR'.                              42354800
           DISPLAY '       SQLCODE = ' SQLCODE2.                        42354900
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        42355000
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        42355100
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        42355200
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        42355300
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        42355400
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        42355500
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        42355600
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        42355700
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        42355800
           DISPLAY                    '** PARAGRAPH ** = '              42355900
                                       PV-PARAGRAPH-NAME.               42356000
           DISPLAY                    '** OPERATION ** = '              42356100
                                       PV-DB2-OPERATION.                42356200
                                                                        42356300
           EXEC SQL                                                     42356400
               COMMIT                                                   42356500
           END-EXEC.                                                    42356600
                                                                        42356700
           MOVE +4013 TO ABEND-CODE.                                    42356800
           CALL 'ILBOABN0' USING ABEND-CODE.                            42356900
                                                                        42357000
